.************************************************************************
.*  Procedure: DGCLICCB  -  Send a Cancel Booking (Operations)          *
.*                                                                      *
.*  Author   : Mike Laming  (09/07/2001)                                *
.*                                                                      *
.*  Requires : BOKRC1FD (Booking Table - Operating)                     *
.*                                                                      *
.*             OPRCONFD (Operations Control File)                       *
.*             PATCONFD (Patient Control File)                          *
.*                                                                      *
.*  Mods     :                                                          *
.*  V9.02.01 : 08/11/2001  Davin & MikeL                                *
.*             Mods to use message holding file                         *
.*                                                                      *
.************************************************************************
          DEFPROC   DGCLICCB
.
          INC       HL7BMTFD/INC
.
. vars in here
.
DGCLI000  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,SIXTY8;*240,OPCNDGCB
.
.   check if we are using this feature
.
          COMPARE   ONE,OPCNDGCB
          GOTO      DGCLI999 IF NOT EQUAL
.
.         Open the broadcast message holding table file
.
          OPEN      HL7BMTA1,"hl7bmtaf"
.
.         Write message
.
          MOVE      "T",HLBMSTAT            * "T" - to be processed
          MOVE      "CCB",HLBMTYPE
          MOVE      SP8,HLBMURNO
          MOVE      BKREBOOK,HLBMVISN
.                                           * Key to OUTBOKA1 (key8)
          PACK      HLBMTKEY,SP30,SP30,SP30
          MOVE      SP1,HLBMFLAG
          PACK      HLBMSPAR,SP30,SP30
.
          CALL      DGMESSID                * Get Message ID, Date & Time
.
          CALL      DGHLSEND                * Send the HL7 message
.
          CLOSE     HL7BMTA1
.
DGCLI999  GOTO      DGCLIEND                        * end procedure
.
.      I/O's go in here
.
          INC       DGHLCOMN
	  INC       HL7BMTIO/INC
          INC       IBAOVRIO/INC
.
DGCLIEND  ENDPROC

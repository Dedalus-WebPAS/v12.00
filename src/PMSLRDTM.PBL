. *----------------------------------------------------------------------
. * Include Name  :   PMSLRDTM.PBL
. *
. * Function      :   Leave register details
. *
. * V11.01.00 18/05/2021  Jill Parkinson    TSK 0900650
. *                       Created Include
. *----------------------------------------------------------------------
.------------------------------------------------------------------------
. Clear CGI variables for overdue leave notifications
.------------------------------------------------------------------------
CLPMLR00  MOVE      Z70,PMLRD001
          MOVE      Z70,PMLRD002
          MOVE      Z70,PMLRD003
          MOVE      Z70,PMLRD004
          MOVE      Z70,PMLRD005
          MOVE      Z70,PMLRD006
          MOVE      Z70,PMLRD007
          MOVE      Z70,PMLRD008
          MOVE      Z70,PMLRD009
          MOVE      Z70,PMLRD010
          MOVE      Z70,PMLRD011
          MOVE      Z70,PMLRD012
          MOVE      Z70,PMLRD013
          MOVE      Z70,PMLRD014
          MOVE      Z70,PMLRD015
          MOVE      Z70,PMLRD016
          MOVE      Z70,PMLRD017
          MOVE      Z70,PMLRD018
          MOVE      Z70,PMLRD019
          MOVE      Z70,PMLRD020
          MOVE      Z70,PMLRD021
          MOVE      Z70,PMLRD022
          MOVE      Z70,PMLRD023
          MOVE      Z70,PMLRD024
          MOVE      Z70,PMLRD025
          MOVE      Z70,PMLRD026
          MOVE      Z70,PMLRD027
          MOVE      Z70,PMLRD028
          MOVE      Z70,PMLRD029
          MOVE      Z70,PMLRD030
          MOVE      Z70,PMLRD031
          MOVE      Z70,PMLRD032
          MOVE      Z70,PMLRD033
          MOVE      Z70,PMLRD034
          MOVE      Z70,PMLRD034
          MOVE      Z70,PMLRD036
          MOVE      Z70,PMLRD037
          MOVE      Z70,PMLRD038
.
          RETURN
+
.------------------------------------------------------------------------
. Tags for leave register details      
. ------------------------------------------------------------------------
PMLR0000  BRANCH    FLDITMNO,PMLR0010,PMLR0020,PMLR0030,PMLR0040,PMLR0050:
                             PMLR0060,PMLR0070,PMLR0080,PMLR0090,PMLR0100:
                             PMLR0110,PMLR0120,PMLR0130,PMLR0140,PMLR0150:
                             PMLR0160,PMLR0170,PMLR0180,PMLR0190,PMLR0200:
                             PMLR0210,PMLR0220,PMLR0230,PMLR0240,PMLR0250:
                             PMLR0260,PMLR0270,PMLR0280,PMLR0290,PMLR0300:
                             PMLR0310,PMLR0320,PMLR0330,PMLR0340,PMLR0350:
                             PMLR0360,PMLR0370,PMLR0380,PMLR0390,PMLR0400

          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMLR9999
.
PMLR0010  WRITE     HTMLFILE;PMLRVISN;       * visit number
          GOTO      PMLR9999
.
PMLR0020  MATCH     PMLRDATE,SP70             * on leave date
          GOTO      PMLR9999 IF EQUAL
          UNPACK    PMLRDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMLR9999
.
PMLR0030  MATCH     SP70,PMLRTIME            * on leave time
          GOTO      PMLR9999 IF EQUAL
          WRITE     HTMLFILE;PMLRTIME;
          GOTO      PMLR9999
.
PMLR0040  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Ward
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLR0041
          WRITE     HTMLFILE;PMLRWARD;
          GOTO      PMLR9999
.
PMLR0041  PACK      KEY6,PMLRWARD,SP70        * .1   Ward description
          CALL      RDWARD1
          BRANCH    OVRCD,PMLR9999
          WRITE     HTMLFILE;WBDESC;
          GOTO      PMLR9999
.
PMLR0050  WRITE     HTMLFILE;PMLRLBED;        * on leave from bed
          GOTO      PMLR9999
.
PMLR0060  WRITE     HTMLFILE;PMLRRECS;        * record status  
          GOTO      PMLR9999
.
PMLR0070  WRITE     HTMLFILE;PMLRCOUN;        * record counter
          GOTO      PMLR9999
.
PMLR0080  WRITE     HTMLFILE;PMLRACTV;
          GOTO      PMLR9999
.
PMLR0090  WRITE     HTMLFILE;PMLRLRCN;        * link to visucmaf
          GOTO      PMLR9999
.
PMLR0100  MOVE      "TL",CATEGORY                * Type of Leave (Cat TL)
          MOVE      PMLRTLEV,CODE
          CALL      CODITM00
          GOTO      PMLR9999
.
PMLR0110  MATCH     PMLREXRD,SP70                * Expected return date
          GOTO      PMLR9999 IF EQUAL
.
          UNPACK    PMLREXRD,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMLR9999
.
PMLR0120  WRITE     HTMLFILE;PMLREXRT;           * Expected return time
          GOTO      PMLR9999
.
PMLR0130  WRITE     HTMLFILE;PMLRDEST;
          GOTO      PMLR9999
.
PMLR0140  MOVE      "vd",CATEGORY                * Risk assessment(Cat vd)
          MOVE      PMLRRISK,CODE
          CALL      CODITM00
          GOTO      PMLR9999
.
PMLR0150  MOVE      "ve",CATEGORY                * Leave arrangement(Cat ve)
          MOVE      PMLRLARR,CODE
          CALL      CODITM00
          GOTO      PMLR9999
.
PMLR0160  MOVE      "r1",CATEGORY                * User defined code 1(Cat r1)
          MOVE      PMLRUDC1,CODE
          CALL      CODITM00
          GOTO      PMLR9999
.
PMLR0170  MOVE      "r2",CATEGORY                * User defined code 2 (Cat r2)
          MOVE      PMLRUDC2,CODE
          CALL      CODITM00
          GOTO      PMLR9999
.
PMLR0180  MOVE      "r3",CATEGORY                * User defined code 3 (Cat r3)
          MOVE      PMLRUDC3,CODE
          CALL      CODITM00
          GOTO      PMLR9999
.
PMLR0190  MOVE      "r4",CATEGORY                * User defined code 4 (Cat r4)
          MOVE      PMLRUDC4,CODE
          CALL      CODITM00
          GOTO      PMLR9999
.
PMLR0200  UNPACK    DIM127,D1,KEY1,DIM127     * medication given
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLR0201,PMLR0202
.
PMLR0201  MATCH     "1",PMLRMEDG
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      PMLR9999
          ENDIF
.
          MATCH     "2",PMLRMEDG
          IF        @EQUAL
            WRITE     HTMLFILE;"N/A";
            GOTO      PMLR9999
          ENDIF
.
          WRITE     HTMLFILE;"No";
          GOTO      PMLR9999
.
PMLR0202  WRITE     HTMLFILE;PMLRMEDG;
          GOTO      PMLR9999
.
PMLR0210  UNPACK    DIM127,D1,KEY1,DIM127     * bag search
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLR0211,PMLR0212
.
PMLR0211  MATCH     "1",PMLRBAGS
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      PMLR9999
          ENDIF
.
          MATCH     "2",PMLRBAGS
          IF        @EQUAL
            WRITE     HTMLFILE;"N/A";
            GOTO      PMLR9999
          ENDIF
.
          WRITE     HTMLFILE;"No";
          GOTO      PMLR9999
.
PMLR0212  WRITE     HTMLFILE;PMLRBAGS;
          GOTO      PMLR9999
.
PMLR0220  UNPACK    DIM127,D1,KEY1,DIM127     * bal screening
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLR0221,PMLR0222
.
PMLR0221  MATCH     "1",PMLRBALS
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      PMLR9999
          ENDIF
.
          MATCH     "2",PMLRBALS
          IF        @EQUAL
            WRITE     HTMLFILE;"N/A";
            GOTO      PMLR9999
          ENDIF
.
          WRITE     HTMLFILE;"No";
          GOTO      PMLR9999
.
PMLR0222  WRITE     HTMLFILE;PMLRBALS;
          GOTO      PMLR9999
.
PMLR0230  UNPACK    DIM127,D1,KEY1,DIM127     * uds screening
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLR0231,PMLR0232
.
PMLR0231  MATCH     "1",PMLRUDSS
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      PMLR9999
          ENDIF
.
          MATCH     "2",PMLRUDSS
          IF        @EQUAL
            WRITE     HTMLFILE;"N/A";
            GOTO      PMLR9999
          ENDIF
.
          WRITE     HTMLFILE;"No";
          GOTO      PMLR9999
.
PMLR0232  WRITE     HTMLFILE;PMLRUDSS;
          GOTO      PMLR9999
.
PMLR0240  UNPACK    DIM127,D1,KEY1,DIM127     * ud1 yes/no
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLR0241,PMLR0242
.
PMLR0241  MATCH     "1",PMLRUDY1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      PMLR9999
          ENDIF
.
          WRITE     HTMLFILE;"No";
          GOTO      PMLR9999
.
PMLR0242  WRITE     HTMLFILE;PMLRUDY1;
          GOTO      PMLR9999
.
PMLR0250  UNPACK    DIM127,D1,KEY1,DIM127     * ud2 yes/no
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLR0241,PMLR0242
.
PMLR0251  MATCH     "1",PMLRUDY2
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      PMLR9999
          ENDIF
.
          WRITE     HTMLFILE;"No";
          GOTO      PMLR9999
.
PMLR0252  WRITE     HTMLFILE;PMLRUDY2;
          GOTO      PMLR9999
.
PMLR0260  UNPACK    DIM127,D1,KEY1,DIM127     * ud3 yes/no
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLR0241,PMLR0242
.
PMLR0261  MATCH     "1",PMLRUDY3
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      PMLR9999
          ENDIF
.
          WRITE     HTMLFILE;"No";
          GOTO      PMLR9999
.
PMLR0262  WRITE     HTMLFILE;PMLRUDY3;
          GOTO      PMLR9999
.
PMLR0270  WRITE     HTMLFILE;PMLRVAL1;   * udf value 1
          GOTO      PMLR9999
.
PMLR0280  WRITE     HTMLFILE;PMLRVAL2;   * udf value 2
          GOTO      PMLR9999
.
PMLR0290  WRITE     HTMLFILE;PMLRVAL3;   * udf value 3
          GOTO      PMLR9999
.
PMLR0300  WRITE     HTMLFILE;PMLRCARN;   * carer name  
          GOTO      PMLR9999
.
PMLR0310  WRITE     HTMLFILE;PMLRCARC;   * carer contact number
          GOTO      PMLR9999
.
PMLR0320  MOVE      "tc",CATEGORY        * contact type(Cat tc)
          MOVE      PMLRCCNT,CODE
          CALL      CODITM00
          GOTO      PMLR9999
.
PMLR0330  WRITE     HTMLFILE;PMLRCCNT;   * carer contact counter
          GOTO      PMLR9999
.
PMLR0340  UNPACK    DIM127,D1,KEY1,DIM127     * carer consent yes/no
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLR0341,PMLR0342
.
PMLR0341  MATCH     "1",PMLRCCON
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      PMLR9999
          ENDIF
.
          WRITE     HTMLFILE;"No";
          GOTO      PMLR9999
.
PMLR0342  WRITE     HTMLFILE;PMLRCCON;
          GOTO      PMLR9999
.
PMLR0350  WRITE     HTMLFILE;PMLRTXT1;    * text 1
          GOTO      PMLR9999
.
PMLR0360  WRITE     HTMLFILE;PMLRTXT2;    * text 2
          GOTO      PMLR9999
.
PMLR0370  WRITE     HTMLFILE;PMLRTXT3;    * text 3
          GOTO      PMLR9999
.
PMLR0380  WRITE     HTMLFILE;PMLRREMN;    * reminder number sent
          GOTO      PMLR9999
.
PMLR0390  CALL      LEVT0000   * leave details table
          GOTO      PMLR9999
.
PMLR0400  PACK      KEY17,PMLRVISN,ZERO,ONE,TWO,PMLRLRCN,SP70
          CALL      RSVSUCM1
PMLR0410  CALL      RKVSUCM1
          BRANCH    OVRCD,PMLR9999
.
          MATCH     PMLRVISN,VSUCVISN
          GOTO      PMLR9999 IF NOT EQUAL
.
          MATCH     "012",VSUCCTYP
          GOTO      PMLR9999 IF NOT EQUAL
.
          MATCH     PMLRLRCN,VSUCUCNT
          GOTO      PMLR9999 IF NOT EQUAL
.
          MOVE      ONE,F1
          WRITE     HTMLFILE;VSUCLINE     
          GOTO      PMLR0410
.
PMLR9999  RETURN
+
.------------------------------------------------------------------------
. Set CGI variables for leave register details
. ------------------------------------------------------------------------
SPLRD000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPLRD001,SPLRD002,SPLRD003,SPLRD004,SPLRD005:
                       SPLRD006,SPLRD007,SPLRD008,SPLRD009,SPLRD010:
                       SPLRD011,SPLRD012,SPLRD013,SPLRD014,SPLRD015:
                       SPLRD016,SPLRD017,SPLRD018,SPLRD019,SPLRD020:
                       SPLRD021,SPLRD022,SPLRD023,SPLRD024,SPLRD025:
                       SPLRD026,SPLRD027,SPLRD028,SPLRD029,SPLRD030:
                       SPLRD031,SPLRD032,SPLRD033,SPLRD034,SPLRD035:
                       SPLRD036,SPLRD037,SPLRD038
.
          MOVE      ONE,EXIT
          GOTO      SPLRD999
.
SPLRD001  PACK      PMLRD001,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD002  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMLRD002,CCENT,CYEAR,CMON,CDAY
          GOTO      SPLRD999
.
SPLRD003  PACK      PMLRD003,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD004  PACK      PMLRD004,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD005  PACK      PMLRD005,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD006  PACK      PMLRD006,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD007  PACK      PMLRD007,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD008  PACK      PMLRD008,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD009  PACK      PMLRD009,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD010  PACK      PMLRD010,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD011  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PMLRD011,CCENT,CYEAR,CMON,CDAY
          GOTO      SPLRD999
.
SPLRD012  PACK      PMLRD012,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD013  PACK      PMLRD013,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD014  PACK      PMLRD014,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD015  PACK      PMLRD015,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD016  PACK      PMLRD016,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD017  PACK      PMLRD017,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD018  PACK      PMLRD018,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD019  PACK      PMLRD019,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD020  PACK      PMLRD020,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD021  PACK      PMLRD021,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD022  PACK      PMLRD022,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD023  PACK      PMLRD023,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD024  PACK      PMLRD024,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD025  PACK      PMLRD025,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD026  PACK      PMLRD026,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD027  PACK      PMLRD027,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD028  PACK      PMLRD028,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD029  PACK      PMLRD029,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD030  PACK      PMLRD030,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD031  PACK      PMLRD031,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD032  PACK      PMLRD032,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD033  PACK      PMLRD033,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD034  PACK      PMLRD034,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD035  PACK      PMLRD035,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD036  PACK      PMLRD036,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD037  PACK      PMLRD037,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD038  PACK      PMLRD038,QRYDATA,SP70
          GOTO      SPLRD999
.
SPLRD999  RETURN
.
.------------------------------------------------------------------------
. Update file variables for overdue leave notifications
. ------------------------------------------------------------------------
MVPMLR00  MATCH     PMLRD001,Z70
          IF        !@EQUAL
            PACK      PMLRVISN,PMLRD001,SP70
          ENDIF
.
          MATCH     PMLRD002,Z70
          IF        !@EQUAL
            PACK      PMLRDATE,PMLRD002,SP70
          ENDIF
.
          MATCH     PMLRD003,Z70
          IF        !@EQUAL
            PACK      PMLRTIME,PMLRD003,SP70
          ENDIF
.
          MATCH     PMLRD004,Z70
          IF        !@EQUAL
            PACK      PMLRWARD,PMLRD004,SP70
          ENDIF
.
          MATCH     PMLRD005,Z70
          IF        !@EQUAL
            PACK      PMLRLBED,PMLRD005,SP70
          ENDIF
.
          MATCH     PMLRD006,Z70
          IF        !@EQUAL
            MOVE      PMLRD006,PMLRRECS
          ENDIF
.
          MATCH     PMLRD007,Z70
          IF        !@EQUAL
            MOVE      PMLRD007,PMLRCOUN
          ENDIF
.
          MATCH     PMLRD008,Z70
          IF        !@EQUAL
            MOVE      PMLRD008,PMLRACTV
          ENDIF
.
          MATCH     PMLRD009,Z70
          IF        !@EQUAL
            MOVE      PMLRD009,PMLRLRCN
          ENDIF
.
          MATCH     PMLRD010,Z70
          IF        !@EQUAL
            MOVE      PMLRD010,PMLRTLEV
          ENDIF
.
          MATCH     PMLRD011,Z70
          IF        !@EQUAL
            MOVE      PMLRD011,PMLREXRD
          ENDIF
.
          MATCH     PMLRD012,Z70
          IF        !@EQUAL
            MOVE      PMLRD012,PMLREXRT
          ENDIF
.
          MATCH     PMLRD013,Z70
          IF        !@EQUAL
            MOVE      PMLRD013,PMLRDEST
          ENDIF
.
          MATCH     PMLRD014,Z70
          IF        !@EQUAL
            MOVE      PMLRD014,PMLRRISK
          ENDIF
.
          MATCH     PMLRD015,Z70
          IF        !@EQUAL
            MOVE      PMLRD015,PMLRLARR
          ENDIF
.
          MATCH     PMLRD016,Z70
          IF        !@EQUAL
            MOVE      PMLRD016,PMLRUDC1
          ENDIF
.
          MATCH     PMLRD017,Z70
          IF        !@EQUAL
            MOVE      PMLRD017,PMLRUDC2
          ENDIF
.
          MATCH     PMLRD018,Z70
          IF        !@EQUAL
            MOVE      PMLRD018,PMLRUDC3
          ENDIF
.
          MATCH     PMLRD019,Z70
          IF        !@EQUAL
            MOVE      PMLRD019,PMLRUDC4
          ENDIF
.
          MATCH     PMLRD020,Z70
          IF        !@EQUAL
            MOVE      PMLRD020,PMLRMEDG
          ENDIF
.
          MATCH     PMLRD021,Z70
          IF        !@EQUAL
            MOVE      PMLRD021,PMLRBAGS
          ENDIF
.
          MATCH     PMLRD022,Z70
          IF        !@EQUAL
            MOVE      PMLRD022,PMLRBALS
          ENDIF
.
          MATCH     PMLRD023,Z70
          IF        !@EQUAL
            MOVE      PMLRD023,PMLRUDSS
          ENDIF
.
          MATCH     PMLRD024,Z70
          IF        !@EQUAL
            MOVE      PMLRD024,PMLRUDY1
          ENDIF
.
          MATCH     PMLRD025,Z70
          IF        !@EQUAL
            MOVE      PMLRD025,PMLRUDY2
          ENDIF
.
          MATCH     PMLRD026,Z70
          IF        !@EQUAL
            MOVE      PMLRD026,PMLRUDY3
          ENDIF
.
          MATCH     PMLRD027,Z70
          IF        !@EQUAL
            MOVE      PMLRD027,PMLRVAL1
          ENDIF
.
          MATCH     PMLRD028,Z70
          IF        !@EQUAL
            MOVE      PMLRD028,PMLRVAL2
          ENDIF
.
          MATCH     PMLRD029,Z70
          IF        !@EQUAL
            MOVE      PMLRD029,PMLRVAL3
          ENDIF
.
          MATCH     PMLRD030,Z70
          IF        !@EQUAL
            MOVE      PMLRD030,PMLRCARN
          ENDIF
.
          MATCH     PMLRD031,Z70
          IF        !@EQUAL
            MOVE      PMLRD031,PMLRCARC
          ENDIF
.
          MATCH     PMLRD032,Z70
          IF        !@EQUAL
            MOVE      PMLRD032,PMLRCART
          ENDIF
.
          MATCH     PMLRD033,Z70
          IF        !@EQUAL
            MOVE      PMLRD033,PMLRCCNT
          ENDIF
.
          MATCH     PMLRD034,Z70
          IF        !@EQUAL
            MOVE      PMLRD034,PMLRCCON
          ENDIF
.
          MATCH     PMLRD035,Z70
          IF        !@EQUAL
            MOVE      PMLRD035,PMLRTXT1
          ENDIF
.
          MATCH     PMLRD036,Z70
          IF        !@EQUAL
            MOVE      PMLRD036,PMLRTXT2
          ENDIF
.
          MATCH     PMLRD037,Z70
          IF        !@EQUAL
            MOVE      PMLRD037,PMLRTXT3
          ENDIF
.
          MATCH     PMLRD038,Z70
          IF        !@EQUAL
            MOVE      PMLRD038,PMLRREMN
          ENDIF
.
MVPMLR99  RETURN
+
.------------------------------------------------------------
. Leave details table for a visit
.------------------------------------------------------------
LEVT0000  PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,LEVT9999
.
          MOVE      ZERO,COUNTER
          PACK      KEY27,ADMISSNO,SP70
          CALL      RSPMLRD1
LEVT1000  CALL      RKPMLRD1
          BRANCH    OVRCD,LEVT9999
.
          MATCH     ADMISSNO,PMLRVISN
          GOTO      LEVT9999 IF NOT EQUAL
.
          MOVE      SP70,TDESC
          MOVE      SP70,DIM20
.
          MATCH     SP70,PMLRTLEV
          IF        !@EQUAL
            PACK      KEY5,ANST,ANSL,PMLRTLEV,SP70
            CALL      RDCODE1
            IF        OVRCD<>1
              PACK     DIM20,TDESC
            ENDIF
          ENDIF
.
          MOVE      SP70,TDESC
          MATCH     SP70,PMLRRISK
          IF        !@EQUAL
            MOVE      "vd",CATEGORY
            PACK      KEY5,CATEGORY,PMLRRISK,SP70
            CALL      RDCODE1
          ENDIF
.
          PACK      KEY20,SP70
          MATCH     ANSL,PMLRRECS
          IF        @EQUAL
            MOVE      "On Leave",KEY20
          ENDIF
.
          MATCH     ANSR,PMLRRECS
          IF        @EQUAL
            MOVE      "Returned",KEY20
          ENDIF
.
          MATCH     ANSB,PMLRRECS
          IF        @EQUAL
            MOVE      "Before Update",KEY20
          ENDIF
.
          MATCH     ANSA,PMLRRECS
          IF        @EQUAL
            MOVE      "Absconded",KEY20
          ENDIF
.
          MATCH     ANSD,PMLRRECS
          IF        @EQUAL
            MOVE      "Deleted",KEY20
          ENDIF
.
          MATCH     ANSO,PMLRRECS
          IF        @EQUAL
            MOVE      "Discharged on Leave",KEY20
          ENDIF
.
          MOVE      SP70,RETNDATE
          MOVE      SP70,RETNTIME
.
          PACK      KEY30,ADMISSNO,PMLRDATE,PMLRTIME,SP70
          CALL      RDSTRAN2
LEVT1200  CALL      RDKTRAN2
          BRANCH    OVRCD,LEVT1300
.
          MATCH     ADMISSNO,DTADMN
          GOTO      LEVT1300 IF NOT EQUAL
.
          MATCH     TDATE,PMLRDATE
          GOTO      LEVT1300 IF NOT EQUAL
.
          MATCH     TTIME,PMLRTIME
          GOTO      LEVT1300 IF NOT EQUAL
.
          MATCH     ANSL,TMOVE
          GOTO      LEVT1300 IF NOT EQUAL
.
.    found leave record, next record must be return (unless discharged onleave)
          CALL      RDKTRAN2
          BRANCH    OVRCD,LEVT1300
.
          MATCH     ADMISSNO,DTADMN
          GOTO      LEVT1300 IF NOT EQUAL
.
          MATCH     ANSR,TMOVE
          GOTO      LEVT1300 IF NOT EQUAL
          PACK      RETNDATE,TDATE
          PACK      RETNTIME,TTIME
.
LEVT1300  PACK      KEY10,PMLRWEBC
          MATCH     ANSD,PMLRRECS
          IF        @EQUAL
            PACK      KEY10,PMLRWEBD,SP70
          ENDIF
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      KEY10,WBSENAM
          ENDIF
.
          MATCH     ANSD,PMLRRECS
          IF        @EQUAL
             MOVE     "redfont",FONTRED
          ENDIF
.
          MOVE      ZERO,LEAVTIME
          MOVE      ZERO,TOTLTIME
          PACK      FIRSTDAT,PMLRDATE
          UNPACK    PMLRTIME,D2,D1,KEY2
          PACK      FIRSTIME,D2,KEY2
          MATCH     SP70,RETNDATE
          IF        !@EQUAL
            PACK       LASTDATE,RETNDATE
            UNPACK     RETNTIME,D2,D1,KEY2
            PACK       LASTTIME,D2,KEY2
          ELSE
            PACK       LASTDATE,CCC,CYY,CMM,CDD
            REP        " 0",LASTDATE
            CLOCK      TIME,CTIMEIS
            UNPACK     CTIMEIS,D2,D1,KEY2
            PACK       LASTTIME,D2,KEY2
          ENDIF
          CALL      TIMEDIFF
          MOVE      CALCTIME,FORM6A
          ASSIGN    FORM6A/SIXTY,CALCTIME
          MOVE      CALCTIME,FORM6              * Set to Hrs
          MOVE      FORM6,F6                    * save the actual hrs
          ASSIGN    CALCTIME*SIXTY,CALCTIME     * Set hrs back to mins
          ASSIGN    (FORM6A-CALCTIME),FORM6A    * now subtract from sav var
          MOVE      FORM6A,F2                   * Now have remainding mins
          MOVE      F2,D2
          REP       " 0",D2
          PACK      LEAVTIME,F6,COLON,D2
.
          PROC      CALCLEAV   * calculate leave duration
          ASSIGN    FORM6A/SIXTY,CALCTIME
          MOVE      CALCTIME,FORM6              * Set to Hrs
          MOVE      FORM6,F6                    * save the actual hrs
          ASSIGN    CALCTIME*SIXTY,CALCTIME     * Set hrs back to mins
          ASSIGN    (FORM6A-CALCTIME),FORM6A    * now subtract from sav var
          MOVE      FORM6A,F2                   * Now have remainding mins
          MOVE      F2,D2
          REP       " 0",D2
          PACK      TOTLTIME,F6,COLON,D2
.
          ADD       ONE,COUNTER
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":      * 0
                         "#"",PMLRDATE,PMLRTIME,"#",":  * 1
                         "#"",PMLRCDAT,PMLRCTIM,"#",":  * 2
                         "#"",DIM20,"#",":              * 3
                         "#"",TDESC,"#",":              * 4
                         "#"",PMLREXRD,PMLREXRT,"#",":  * 5
                         "#"",LEAVTIME,SLASH,TOTLTIME,"#",": * 6
                         "#"",KEY20,"#",":              * 7
                         "#"",PMLRDEST,"#",":           * 8
                         "#"",PMLRCARN,SP1,PMLRCARC,"#",":  * 9
                         "#"",DIM10,"#",":              * 10
                         "#"",PMLRMEDG,"#",":           * 11
                         "#"",WBSENAM,"#",":            * 12
                         "#"",RETNDATE,RETNTIME,"#",";  * 13
.
          MOVE      ZERO,F1
          WRITE     HTMLFILE;"#""; 
          PACK      KEY17,PMLRVISN,ZERO,ONE,TWO,PMLRLRCN,SP70
          CALL      RSVSUCM1
LEVT1400  CALL      RKVSUCM1
          BRANCH    OVRCD,LEVT1500
.
          MATCH     PMLRVISN,VSUCVISN
          GOTO      LEVT1500 IF NOT EQUAL
.
          MATCH     "012",VSUCCTYP
          GOTO      LEVT1500 IF NOT EQUAL
.
          MATCH     PMLRLRCN,VSUCUCNT
          GOTO      LEVT1500 IF NOT EQUAL
.
          MOVE      ONE,F1
          WRITE     HTMLFILE;VSUCLINE;            *14
          GOTO      LEVT1400
.
LEVT1500  WRITE     HTMLFILE;"#",";                *14
          GOTO      LEVT1600
.  
LEVT1600  MATCH     "1",PMLRMEDG
          IF        @EQUAL
            WRITE     HTMLFILE;"#"","Yes","#",";  * 15
          ELSE
            MATCH     "2",PMLRMEDG
            IF        @EQUAL
              WRITE     HTMLFILE;"#"","N/A","#","; * 15
            ELSE
              WRITE     HTMLFILE;"#"","No","#","; * 15
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"#"",PMLRCOUN,"#","; * 16
.
          MATCH     "1",PMLRACTV
          IF        @EQUAL
            WRITE     HTMLFILE;"#"","LineThrough","#",";   * 17
          ELSE
            MATCH     ANSD,PMLRRECS
            IF        @EQUAL
              WRITE     HTMLFILE;"#"","LineThrough","#",";   * 17
            ELSE
              WRITE     HTMLFILE;"#"","","#",";   * 17
            ENDIF
          ENDIF
.
          MATCH     "1",PMLRACTV
          IF        @EQUAL
            WRITE     HTMLFILE;"#"","LineThrough","#",";   * 18
          ELSE
            MATCH     ANSD,PMLRRECS
            IF        @EQUAL
              WRITE     HTMLFILE;"#"","Red","#",";   * 18
            ELSE
              WRITE     HTMLFILE;"#"","","#",";   * 18
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"#"",COUNTER,"#");"   * 19

          GOTO      LEVT1000
.
LEVT9999  RETURN
+

.-------------------------------------------------------------------------------
.   System    :   FMS Accounting System  
.                           
.   Program   :   FMSCCAFM 
.                            
.   Requires  :   FMLALEDG Ledger Number
.                 FMLADESC Ledger Number Description
.                 FMSUUD4A Cost Centre Code Length (Sector 51 controlf)
.
.   Routines  :   KCCAFM00 Keyin Cost Centre   - Returns a valid record
.                 ACCAFM00 Accept Cost Centre  - Returns a key NOT on file
.   
.   Return    :   EXIT = 1 null entry EXIT = 2 EXITCHAR entered
.
.   Internal  :   HCCAFM00 Help Display for Cost Centre  
.                            
.   Redisplay :   RCCAFM00 Screen Redisplay Called for Cost Centre  
.-------------------------------------------------------------------------------
.   Mods      :   24/07/91  Neeriem Dye
.                           Fixed infinite loop on previous page
.                           Only occurred if first item on file is invalid
.-------------------------------------------------------------------------------
. Normal Code Keyin - Code Must Exist Exit = 1 if Null Entry
.-------------------------------------------------------------------------------
KCCAFM00  MOVE      "0",CKEYTYP
          MOVE      FMLALEDG,FMCCLEDG
          CALL      KFMCCA00
          RETURN
.-------------------------------------------------------------------------------
. Accept Code Keyin - Code Must Not Exist 
.-------------------------------------------------------------------------------
ACCAFM00  MOVE      "1",CKEYTYP
          MOVE      FMLALEDG,FMCCLEDG
          CALL      KFMCCA00
          RETURN
.---------------------------------------------------------------------------
.   System    :   Financial Management System        
.   Include   :   FMSCCAKY
.   Routine   :   HFMCCA00 Cost Centre         
.   Return    :   FMCAACC 
.-------------------------------------------------------------------------------
HFMCCA00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "10",HTOP
            MOVE      "24",HBOT
            MOVE      "40",HLEF
            MOVE      "80",HRIG
          ENDIF
HFMCCA04
          CALL      GSCRN000
          BRANCH    EXIT,HFMCCA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Cost Centre"        
.
          MOVE      STDCOL01,STDCOL02
          ADD       "13",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Description"        
.
          MOVE      STDCOL02,STDCOL03
          ADD       "40",STDCOL03
HFMCCA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,FMCCCOCE
          PACK      KEY14,FMCCLEDG,FMCCCOCE,SP70                                
          PACK      SAVKEY80,FMCCLEDG,FMCCCOCE,SP70                             
          SETLPTR   SAVKEY80,2                                                  
          CALL      RSFMCC1 
HFMCCA10
          CALL      RKFMCC1 
          BRANCH    OVRCD,HFMCCA15
          PACK      KEY14,FMCCLEDG,FMCCCOCE,SP70                                
          MATCH     SAVKEY80,KEY14                                              
          GOTO      HFMCCA15 IF NOT EQUAL                                       
          BRANCH    CSEARCH,HFMCCA12
          CALL      HFMCCA60
          BRANCH    OVRCD,HFMCCA10
HFMCCA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY14,XITEMNO,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,FMCCCOCE
          DISPLAY   *PSTDCOL02:STDROW,FMCCDESC
          COMPARE   MAXITEM,XITEMNO
          GOTO      HFMCCA10 IF NOT EQUAL
HFMCCA15
          UNPACK    SAVKEY80,FMCCLEDG,FMCCCOCE                                  
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HFMCCA20
          CALL      HSCRI000
          BRANCH    EXIT,HFMCCA30,HFMCCA35,HFMCCA40,HFMCCA45,HFMCCA04:
                              HFMCCA91,HFMCCA50
          GOTO      HFMCCA92
HFMCCA30
          CALL      RKFMCC1 
          BRANCH    OVRCD,HFMCCA85
          PACK      KEY14,FMCCLEDG,FMCCCOCE,SP70                                
          MATCH     SAVKEY80,KEY14                                              
          GOTO      HFMCCA85 IF NOT EQUAL                                       
          CALL      RPFMCC1 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMCCA10
HFMCCA35
          MOVE      ST1,KEY14
          CALL      RDFMCC1 
          CALL      RPFMCC1 
          BRANCH    OVRCD,HFMCCA85
          PACK      KEY14,FMCCLEDG,FMCCCOCE,SP70                                
          MATCH     SAVKEY80,KEY14                                              
          GOTO      HFMCCA85 IF NOT EQUAL                                       
          MATCH     SP70,FMCCCOCE                                               
          GOTO      HFMCCA85 IF EQUAL                                           
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HFMCCA36
          CALL      RPFMCC1 
          BRANCH    OVRCD,HFMCCA37
          PACK      KEY14,FMCCLEDG,FMCCCOCE,SP70                                
          MATCH     SAVKEY80,KEY14                                              
          GOTO      HFMCCA37 IF NOT EQUAL                                       
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMCCA36 IF NOT EQUAL
HFMCCA37
          MOVE      ZERO,XITEMNO
          GOTO      HFMCCA10
HFMCCA40
          MOVE      ST1,KEY14
          CALL      RDFMCC1 
          CALL      RPFMCC1 
          BRANCH    OVRCD,HFMCCA85
          PACK      KEY14,FMCCLEDG,FMCCCOCE,SP70                                
          MATCH     SAVKEY80,KEY14                                              
          GOTO      HFMCCA85 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMCCA08
HFMCCA45
          CALL      RKFMCC1 
          BRANCH    OVRCD,HFMCCA85
          PACK      KEY14,FMCCLEDG,FMCCCOCE,SP70                                
          MATCH     SAVKEY80,KEY14                                              
          GOTO      HFMCCA85 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY14,SAVKEY80,Z70                                          
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSFMCC1 
HFMCCA46
          CALL      RPFMCC1 
          BRANCH    OVRCD,HFMCCA47
          PACK      KEY14,FMCCLEDG,FMCCCOCE,SP70                                
          MATCH     SAVKEY80,KEY14                                              
          GOTO      HFMCCA47 IF NOT EQUAL                                       
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HFMCCA46 IF NOT EQUAL
HFMCCA47
          MOVE      ZERO,XITEMNO
          GOTO      HFMCCA10
HFMCCA50  COMPARE   ZERO,CSEARCH
          GOTO      HFMCCA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMCCA08
HFMCCA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HFMCCA08
HFMCCA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HFMCCA61 IF EQUAL
          MATCH     SCHFLD01,FMCCCOCE
          GOTO      HFMCCA72 IF NOT EQUAL
HFMCCA61
          MATCH     SP70,SCHFLD02
          GOTO      HFMCCA62 IF EQUAL
          MATCH     SCHFLD02,FMCCDESC
          GOTO      HFMCCA72 IF NOT EQUAL
HFMCCA62
HFMCCA63
HFMCCA64
HFMCCA65
HFMCCA66
HFMCCA67
HFMCCA68
HFMCCA69
HFMCCA70
          GOTO      HFMCCA75
HFMCCA72  MOVE      ONE,OVRCD
HFMCCA75  RETURN
HFMCCA85
          LOAD      KEY14,XITEMNO,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY14,FMCCLEDG,FMCCCOCE                                     
          CALL      RDFMCC1 
HFMCCA90
          UNPACK    SAVKEY80,FMCCLEDG,FMCCCOCE                                  
          BEEP
          GOTO      HFMCCA20
HFMCCA91
          MOVE      SP70,FMCCDESC
          MOVE      SP70,FMCCADES
          MOVE      SP70,FMCCPPOS
          MOVE      SP70,FMCCSECC
          MOVE      SP70,FMCCTELE
          MOVE      SP70,FMCCCONT
          MOVE      SP70,FMCCIDAY
          MOVE      SP70,FMCCSPAR
          MOVE      SP70,KEY14
          MOVE      SP70,FMCCCOCE
          GOTO      HFMCCA96
HFMCCA92
          MOVE      SP70,KEY14
          MOVE      SP70,FMCCCOCE
          LOAD      KEY14,CCITEM,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY14,FMCCLEDG,FMCCCOCE                                     
HFMCCA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HFMCCA99
          RETURN
.---------------------------------------------------------------------------
.   System    :   Financial Management System        
.   Include   :   FMSCCAKY
.   Routine   :   KFMCCA00 Keyin Cost Centre         
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KFMCCA00 TOPIC     "FMCCCOCE"
         MOVE      FMSUUD4A,CSTRLEN          * set up string length
         CALL      GSTR0000                  * get code
         PACK      FMCCCOCE,CSTRING,SP70
.
.          MOVE      UNDLN70,FMCCCOCE
.          KEYIN     *PCCOL:CVERT,*DV,FMCCCOCE:                  
.                    *PCCOL:CVERT,*V2LON,FMCCCOCE:                 
.                    *PCCOL:CVERT,*DV,FMCCCOCE
.
          ENDSET    FMCCCOCE
          APPEND    SP70,FMCCCOCE
          RESET     FMCCCOCE
.
          MATCH     SP70,FMCCCOCE
          GOTO      KFMCCA90 IF EQUAL
.
          CMATCH    EXITCHAR,FMCCCOCE
          GOTO      KFMCCA95 IF EQUAL
.
          CMATCH    QUEST,FMCCCOCE
          GOTO      KFMCCA10 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HFMCCA00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    FMCCCOCE
          APPEND    SP70,FMCCCOCE
          RESET     FMCCCOCE
.
          MATCH     SP70,FMCCCOCE
          GOTO      KFMCCA00 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,FMCCCOCE                                
KFMCCA10
          PACK      KEY14,FMCCLEDG,FMCCCOCE                                     
          CALL      RAFMCC1 
          BRANCH    OVRCD,KFMCCA80
          BRANCH    CKEYTYP,KFMCCA75
          CALL      RDFMCC1 
KFMCCA70
          MOVE      ZERO,EXIT
          GOTO      KFMCCA99
KFMCCA75
          MOVE      "Cost Centre Already Exist - ",DISPMSG                                           
          CALL      MESSAGE1
          GOTO      KFMCCA00
KFMCCA80
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KFMCCA99,KFMCCA99
          MOVE      "Cost Centre Does Not Exist - ",DISPMSG                                          
          CALL      MESSAGE1
          GOTO      KFMCCA00
KFMCCA90
          MOVE      ONE,EXIT
          GOTO      KFMCCA99
KFMCCA95
          MOVE      TWO,EXIT
KFMCCA99 TOPIC    PRGID
          RETURN

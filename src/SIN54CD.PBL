.
OPEN0000  MOVE      "01",HLEF
          MOVE      "80",HRIG
          MOVE      "23",HTOP
          MOVE      "24",HBOT
          CALL      GETSCR00
.
          CLEAR     DISPMSG
          APPEND    "Setting up Temp File",DISPMSG
          CALL      MESSAGE2
.
          PACK      FILENAMZ,NAMEZ,PORT,SP70     * set up and open temp file A
          REP       " 0",FILENAMZ
          PACK      MAKETMPZ,ISBUILD,FILENAMZ,TMP0ZDAT
          PACK      KILLTMPZ,ISERASE,FILENAMZ
          EXECUTE   KILLTMPZ,TASKID
          EXECUTE   MAKETMPZ,TASKID
          OPEN      NEZTMP01,FILENAMZ
          OPEN      NEZTMP02,FILENAMZ
          OPEN      NEZTMP03,FILENAMZ
          OPEN      NEZTMP04,FILENAMZ
.
          PACK      FILENAMZ,FNAMEB,PORT,SP70    * set up and open temp file B
          REP       " 0",FILENAMZ
          PACK      MAKETMPZ,ISBUILD,FILENAMZ,TMPFILEB
          PACK      KILFTMPB,ISERASE,FILENAMZ
          EXECUTE   KILFTMPB,TASKID
          EXECUTE   MAKETMPZ,TASKID
          OPEN      TMPFIL01,FILENAMZ
.
          DISPLAY   *P1:24,*EL,"Orders being Loaded: "
.
          PACK      KEY7,SP70
          CALL      RSSIPA1
.
OPEN1000  CALL      RKSIPA1            * loop through all purchase orders
          BRANCH    OVRCD,OPEN2000
          MATCH     SP70,SIPADCM       * check if purchase order completed
          GOTO      OPEN1000 IF NOT EQUAL
.
          MOVE      SIPAPON,NEZZPON    * write purchase order data to temp file
          MOVE      SIPASUP,NEZZSUP
          MOVE      SIPAORI,NEZZORI
          MOVE      SIPACST,NEZZCST
          MOVE      SIPAWAR,NEZZWAR
          PACK      KEY7,NEZZPON,SP70
          CALL      RANEZZ1
          IF        OVRCD=1
            CALL      WRNEZZ1
            DISPLAY   *P22:24,*V2LON,SIPAPON
          ENDIF
          GOTO      OPEN1000
.
OPEN2000  PACK      KEY7,SP70
          CALL      RSNEZZ1
OPEN2100  CALL      RKNEZZ1            * loop through all purchase orders
          BRANCH    OVRCD,OPEN9999
.
          PACK      KEY10,NEZZPON,SP70
          CALL      RSSIPC1
OPEN2300  CALL      RKSIPC1
          BRANCH    OVRCD,OPEN2100
.
          MATCH     NEZZPON,SIPCPON
          GOTO      OPEN2100 IF NOT EQUAL
.
          MATCH     "Stock",SIPCCST
          GOTO      OPEN2300 IF EQUAL
.
..          MATCH     FCOST,SIPCCST
..          GOTO      OPEN2300 IF LESS
.
..          MATCH     SIPCCST,TCOST
..          GOTO      OPEN2300 IF LESS
.
          MOVE      SIPCPON,TMPFPON    * write purchase order data to temp file
          MOVE      SIPCITM,TMPFITM
          MOVE      SIPCCST,TMPFCST
          MOVE      SIPCCAT,TMPFCAT
          PACK      KEY23,TMPFCST,TMPFCAT,TMPFPON,TMPFITM,SP70
          CALL      RATMPF1
          IF        OVRCD=1
            CALL      WRTMPF1
          ENDIF
          GOTO      OPEN2300
.
OPEN9999  CALL      MESSAGE3
          CALL      PUTSCR00
          MOVE      ONE,TMPFLFLG       * indicates that created temp file once
          RETURN
.
CLOS0000  CLOSE     NEZTMP01           * delete temp file
          CLOSE     NEZTMP02
          CLOSE     NEZTMP03
          CLOSE     NEZTMP04
          EXECUTE   KILLTMPZ,TASKID
.
          CLOSE     TMPFIL01
          EXECUTE   KILFTMPB,TASKID
          RETURN
.**********************************************************************
.  DTMA - clear temp file                              Called By lots
.**********************************************************************
DTMA0000  PACK      KEY7,SP70
.
DTMA0100  CALL      RSNEZZ1
          CALL      RKNEZZ1            * get next record
          BRANCH    OVRCD,DTMA9999     * no more records ?
.
          PACK      KEY7,NEZZPON,SP70
          CALL      DENEZZ1
          GOTO      DTMA0100
.
DTMA9999  RETURN
.**********************************************************************
. NEZTMP0A IO routines                           Called by Lots
.**********************************************************************
RSNEZZ1   RESET     KEY7
          READ      NEZTMP01,KEY7;;
          RETURN
.
RANEZZ1   RESET     KEY7
          MOVE      ZERO,OVRCD
          READ      NEZTMP01,KEY7;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDNEZZ1   RESET     KEY7
          MOVE      ZERO,OVRCD
          READ      NEZTMP01,KEY7;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RKNEZZ1   MOVE      ZERO,OVRCD
          READKS    NEZTMP01;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RPNEZZ1   MOVE      ZERO,OVRCD
          READKP    NEZTMP01;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
UPNEZZ1   UPDATE    NEZTMP01;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          RETURN
.
WRNEZZ1   RESET     KEY7
          WRITE     NEZTMP01,KEY7;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          RETURN
.
DENEZZ1   RESET     KEY7
          DELETE    NEZTMP01,KEY7
          RETURN
.
RSNEZZ2   RESET     KEY12
          READ      NEZTMP02,KEY12;;
          RETURN
.
RANEZZ2   RESET     KEY12
          MOVE      ZERO,OVRCD
          READ      NEZTMP02,KEY12;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDNEZZ2   RESET     KEY12
          MOVE      ZERO,OVRCD
          READ      NEZTMP02,KEY12;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RKNEZZ2   MOVE      ZERO,OVRCD
          READKS    NEZTMP02;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RPNEZZ2   MOVE      ZERO,OVRCD
          READKP    NEZTMP02;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
UPNEZZ2   UPDATE    NEZTMP02;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          RETURN
.
WRNEZZ2   RESET     KEY12
          WRITE     NEZTMP02,KEY12;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          RETURN
.
DENEZZ2   RESET     KEY12
          DELETE    NEZTMP02,KEY12
          RETURN
.
RSNEZZ3   RESET     KEY10
          READ      NEZTMP03,KEY10;;
          RETURN
.
RANEZZ3   RESET     KEY10
          MOVE      ZERO,OVRCD
          READ      NEZTMP03,KEY10;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDNEZZ3   RESET     KEY10
          MOVE      ZERO,OVRCD
          READ      NEZTMP03,KEY10;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RKNEZZ3   MOVE      ZERO,OVRCD
          READKS    NEZTMP03;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RPNEZZ3   MOVE      ZERO,OVRCD
          READKP    NEZTMP03;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
UPNEZZ3   UPDATE    NEZTMP03;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          RETURN
.
WRNEZZ3   RESET     KEY10
          WRITE     NEZTMP03,KEY10;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          RETURN
.
DENEZZ3   RESET     KEY10
          DELETE    NEZTMP03,KEY10
          RETURN
.
RSNEZZ4   RESET     KEY12
          READ      NEZTMP04,KEY12;;
          RETURN
.
RANEZZ4   RESET     KEY12
          MOVE      ZERO,OVRCD
          READ      NEZTMP04,KEY12;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDNEZZ4   RESET     KEY12
          MOVE      ZERO,OVRCD
          READ      NEZTMP04,KEY12;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RKNEZZ4   MOVE      ZERO,OVRCD
          READKS    NEZTMP04;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RPNEZZ4   MOVE      ZERO,OVRCD
          READKP    NEZTMP04;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
UPNEZZ4   UPDATE    NEZTMP04;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          RETURN
.
WRNEZZ4   RESET     KEY12
          WRITE     NEZTMP04,KEY12;NEZZPON,NEZZSUP,NEZZORI,NEZZCST,NEZZWAR
          RETURN
.
DENEZZ4   RESET     KEY12
          DELETE    NEZTMP04,KEY12
          RETURN
.**********************************************************************
. TMPFIL01 IO routines                           Called by Lots
.**********************************************************************
RSTMPF1   RESET     KEY23
          READ      TMPFIL01,KEY23;;
          RETURN
.
RATMPF1   RESET     KEY23
          MOVE      ZERO,OVRCD
          READ      TMPFIL01,KEY23;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDTMPF1   RESET     KEY23
          MOVE      ZERO,OVRCD
          READ      TMPFIL01,KEY23;TMPFPON,TMPFITM,TMPFCST,TMPFCAT
          GOTO      OVERCOND IF OVER
          RETURN
.
RKTMPF1   MOVE      ZERO,OVRCD
          READKS    TMPFIL01;TMPFPON,TMPFITM,TMPFCST,TMPFCAT
          GOTO      OVERCOND IF OVER
          RETURN
.
RPTMPF1   MOVE      ZERO,OVRCD
          READKP    TMPFIL01;TMPFPON,TMPFITM,TMPFCST,TMPFCAT
          GOTO      OVERCOND IF OVER
          RETURN
.
UPTMPF1   UPDATE    TMPFIL01;TMPFPON,TMPFITM,TMPFCST,TMPFCAT
          RETURN
.
WRTMPF1   RESET     KEY23
          WRITE     TMPFIL01,KEY23;TMPFPON,TMPFITM,TMPFCST,TMPFCAT
          RETURN
.
DETMPF1   RESET     KEY23
          DELETE    TMPFIL01,KEY23
          RETURN
.

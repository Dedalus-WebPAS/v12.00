.******************************************************************************
.* System         : CMH and ALL                                               *
.*                                                                            *
.* Include Name   : MRGURCMH.PBL                                              *
.*                                                                            *
.* Function       : This is called from CHANGEUR and IBAPMS05 when they have  *
.*                  a Community Health Visit.  The Details must be written to *
.*                  another file as TBL cant update the required Community    *
.*                  files.  It will write the OLD and NEW U/R Numbers to a    *
.*                  c-isam file called patcmhaf.                              *
.*                                                                            *
.* Author         : Justin Coates      12/07/1995                             *
.*                                                                            *
.* Parameters     : OLDURNO            the old urnumber                       *
.*                  NEWURNO            the new urnumber                       *
.*                                                                            *
.* Modifications  :                                                           *
.******************************************************************************
.
          DEFPROC   MRGURCMH  
.
          INC       PATCMHFD/INC
.
.*********************************************************************
.         mainline code
.*********************************************************************
MRGCMH00  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATCMHA1,"patcmhaf"     * open file
          TRAPCLR   IO
.
          IF        OVRCD = ONE
            EXECUTE   "iserase patcmhaf",TASKID
            EXECUTE   "isbuild patcmhaf 37 U1-8,9-16",TASKID
            OPEN      PATCMHA1,"patcmhaf";
          ENDIF
.
          IF        LOGERR = 1
            MOVE      "patcmhaf",XXFILE
            TRAP      WERR0000 NORESET GIVING XXDESC IF IO
          ENDIF
.
          MOVE      SP20,PTCMSPAR
          MOVE      OLDURNO,PTCMOURN
          MOVE      NEWURNO,PTCMNURN
.
          PACK      KEY16,PTCMOURN,PTCMNURN,SP20
          CALL      RAPTCMH1
          IF        OVRCD=1
            CALL      WRPTCMH1
          ENDIF
.
          GOTO      MRGCMH99
.
          INC       PATCMHIO/INC
          INC       IBAOVRIO/INC
.
MRGCMH99  ENDPROC
..............................................................................

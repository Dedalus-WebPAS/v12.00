. *----------------------------------------------------------------------
. * Include Name  :   NZPTFETM.PBL
. *
. * Function      :   File Def'n Include for New Zealand Private  
. *                   NZ Private Theatre Fee
. *
. * Modifications :
. *
.------------------------------------------------------------------------
. V11.04.02 27/06/2024  Thanh T       TSK 0947684
.           Changed NZPTTB00 to show the "No More records" at the end of
.           the list
. V11.04.01 26/06/2024  Thanh T       TSK 0947684
.           Changed NZPTAB00 to display the number of rows depending on
.           system parameter
.------------------------------------------------------------------------
. V9.08.02  15/02/2007 Ebon Clements CAR 130831
.           Fixed filter tests in NZPTTB00
. V9.08.01  17/01/2007 Ebon Clements CAR 130831
.           Read correct theatre fee record at the end of NZPTTB00
. V9.08.00  05/10/2006 Ebon Clements  CAR 120013
.           Created Include
.------------------------------------------------------------------------
.   Clear CGI Parameters for NZPTFEFD
.------------------------------------------------------------------------
CPNZTF00  MOVE      SP70,NZTFE001
          MOVE      SP70,NZTFE002
          MOVE      SP70,NZTFE003
          MOVE      SP70,NZTFE004
          MOVE      SP70,NZTFE005
          MOVE      SP70,NZTFE006
          MOVE      SP70,NZTFE007
          MOVE      SP70,NZTFE008
          MOVE      SP70,NZTFE009
          MOVE      SP70,NZTFE010
          MOVE      SP70,NZTFE011
          MOVE      SP70,NZTFE012
.
          MOVE      SP70,CPTFE001
          MOVE      SP70,CPTFE002
          MOVE      SP70,CPTFE003
          MOVE      SP70,CPTFE004
          MOVE      SP70,CPTFE005
          MOVE      SP70,CPTFE006
.
CPNZTF99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for NZPTFEFD
.------------------------------------------------------------
SPNZTF00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPNZTF01,SPNZTF02,SPNZTF03,SPNZTF04,SPNZTF05:
                       SPNZTF06,SPNZTF07,SPNZTF08,SPNZTF09,SPNZTF10:
                       SPNZTF11,SPNZTF12
.
          MOVE      ONE,EXIT
          GOTO      SPNZTF99
.
SPNZTF01  PACK      NZTFE001,QRYDATA,SP70
          GOTO      SPNZTF99
.
SPNZTF02  PACK      NZTFE002,QRYDATA,SP70
          GOTO      SPNZTF99
.
SPNZTF03  PACK      NZTFE003,QRYDATA,SP70
          GOTO      SPNZTF99
.
SPNZTF04  PACK      NZTFE004,QRYDATA,SP70
          GOTO      SPNZTF99
.
SPNZTF05  PACK      NZTFE005,QRYDATA,SP70
          GOTO      SPNZTF99
.
SPNZTF06  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      NZTFE006,CCENT,CYEAR,CMON,CDAY
          GOTO      SPNZTF99
.
SPNZTF07  PACK      NZTFE007,QRYDATA,SP70
          GOTO      SPNZTF99
.
SPNZTF08  MOVE      QRYDATA,NZTFE008
          GOTO      SPNZTF99
.
SPNZTF09  MOVE      QRYDATA,NZTFE009
          SQUEEZE   NZTFE009
          GOTO      SPNZTF99
.
SPNZTF10  MOVE      QRYDATA,NZTFE010
          SQUEEZE   NZTFE010
          GOTO      SPNZTF99
.
SPNZTF11  MOVE      QRYDATA,NZTFE011
          SQUEEZE   NZTFE011
          GOTO      SPNZTF99
.
SPNZTF12  MOVE      QRYDATA,NZTFE012
          SQUEEZE   NZTFE012
          GOTO      SPNZTF99
.
SPNZTF99  RETURN
.------------------------------------------------------------
. Output NZPTFEFD Fields
.------------------------------------------------------------
NZTF0000  BRANCH    FLDITMNO,NZTF0100,NZTF0200,NZTF0300,NZTF0400,NZTF0500:
                             NZTF0600,NZTF0700,NZTF0800,NZTF0900,NZTF1000:
                             NZTF1100,NZTF1200,NZTF1300,NZTF1400,NZTF1500:
                             NZTF1600,NZTF1700,NZTF1800,NZTF1900,NZTF2000:
                             NZTF2100,NZTF2200,NZTF2300,NZTF2400,NZTF2500:
                             NZTF2600,NZTF2700,NZTF2800,NZTF2900,NZTF3000
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      NZTF9999
.
NZTF0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          COMPARE   ONE,IBCNMHOS
          GOTO      NZTF9999 IF NOT EQUAL
.
          BRANCH    F1,NZTF0110,NZTF0120
.
          PACK      KEY3,NZTFHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,NZTF9999
.
          WRITE     HTMLFILE;PTHSNAME;           * hospital name
          GOTO      NZTF9999
.
NZTF0110  WRITE     HTMLFILE;NZTFHOSP;           * hospital code
          GOTO      NZTF9999
.
NZTF0120  MOVE      NZTFHOSP,DIM3      
          CALL      NZTH0000                     * hospital selectin list
          GOTO      NZTF9999
.
NZTF0200  MOVE      "TU",CATEGORY                * session type
          MOVE      NZTFSEST,CODE
          CALL      CODITM00 
          GOTO      NZTF9999
.
NZTF0300  MOVE      "CL",CATEGORY                * claim code
          MOVE      NZTFCLAM,CODE
          CALL      CODITM00
          GOTO      NZTF9999
.
NZTF0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,NZTF0410
.
          WRITE     HTMLFILE;NZTFFUND;           * health fund code
          GOTO      NZTF9999
.
NZTF0410  PACK      KEY14,NZTFFUND,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;           * health fund description
          ELSE
            WRITE     HTMLFILE;NZTFFUND;         * health fund code
          ENDIF
          GOTO      NZTF9999
.
NZTF0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,NZTF0510
.
          WRITE     HTMLFILE;NZTFFTAB;           * table code
          GOTO      NZTF9999
.
NZTF0510  PACK      KEY14 WITH NZTFFUND,NZTFFTAB,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;           * description of Table
          ELSE
            WRITE     HTMLFILE;NZTFFTAB;         * table code
          ENDIF
          GOTO      NZTF9999
.
NZTF0600  MATCH     SP70,NZTFEDAT
          GOTO      NZTF9999 IF EQUAL
. 
          UNPACK    NZTFEDAT,CCENT,CYEAR,CMON,CDAY * effective date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZTF9999
.
NZTF0700  WRITE     HTMLFILE;NZTFISEQ;           * sequence
          GOTO      NZTF9999
.
NZTF0800  WRITE     HTMLFILE;NZTFACTV;           * active
          GOTO      NZTF9999
.
NZTF0900  WRITE     HTMLFILE;NZTFMUNI;           * minutes per unit
          GOTO      NZTF9999
.
NZTF1000  WRITE     HTMLFILE;NZTFUNTP;           * unit price
          GOTO      NZTF9999
.
NZTF1100  WRITE     HTMLFILE;NZTFMINU;           * minimum units
          GOTO      NZTF9999
.
NZTF1200  WRITE     HTMLFILE;NZTFMAXU;           * maximum units
          GOTO      NZTF9999
.
NZTF1300  WRITE     HTMLFILE;FILEFLAG;           * current/new file flag
          GOTO      NZTF9999
.
NZTF1400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          COMPARE   ONE,IBCNMHOS
          GOTO      NZTF9999 IF NOT EQUAL
.
          BRANCH    F1,NZTF1410,NZTF1420
.
          PACK      KEY3,NZTFE001,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,NZTF9999
.
          WRITE     HTMLFILE;PTHSNAME;           * hospital name
          GOTO      NZTF9999
.
NZTF1410  WRITE     HTMLFILE;NZTFE001;           * hospital code
          GOTO      NZTF9999
.
NZTF1420  MOVE      NZTFE001,DIM3
          CALL      NZTH0000                     * hospital cgi
          GOTO      NZTF9999
.
NZTF1500  MOVE      "TU",CATEGORY                * session type cgi
          MOVE      NZTFE002,CODE
          CALL      CODITM00 
          GOTO      NZTF9999
.
NZTF1600  MOVE      "CL",CATEGORY                * claim code cgi
          MOVE      NZTFE003,CODE
          CALL      CODITM00
          GOTO      NZTF9999
.
NZTF1700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,NZTF1710
.
          WRITE     HTMLFILE;NZTFE004;           * health fund code cgi
          GOTO      NZTF9999
.
NZTF1710  PACK      KEY14,NZTFE004,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;           * health fund description cgi
          ELSE
            WRITE     HTMLFILE;NZTFE004;         * health fund code cgi
          ENDIF
          GOTO      NZTF9999
.
NZTF1800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,NZTF1810
.
          WRITE     HTMLFILE;NZTFE005;           * table code cgi
          GOTO      NZTF9999
.
NZTF1810  PACK      KEY14,NZTFE004,NZTFE005,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;           * description of Table cgi
          ELSE
            WRITE     HTMLFILE;NZTFE005;         * table code cgi
          ENDIF
          GOTO      NZTF9999
.  
NZTF1900  CALL      NZPTAB00                     * list nz priv theatre fee
          GOTO      NZTF9999
.  
NZTF2000  CALL      NXTNZT00                     * next nz priv theatre fee
          GOTO      NZTF9999
.  
NZTF2100  CALL      PRVNZT00                     * prev nz priv theatre fee
          GOTO      NZTF9999
.  
NZTF2200  UNPACK    NZTFE006,CCENT,CYEAR,CMON,CDAY * effective date cgi
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
.
          GOTO      NZTF9999
.
NZTF2300  CALL      NXTISQ00                     * next sequence number
          WRITE     HTMLFILE;F2;
          GOTO      NZTF9999
.
NZTF2400  CALL      NZPTTB00                     * Theatre Fee Detail Records
          GOTO      NZTF9999
.
NZTF2500  MATCH     NZTFCDAT,SP70
          GOTO      NZTF9999 IF EQUAL
.
          UNPACK    NZTFCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZTF9999
.
NZTF2600  WRITE     HTMLFILE;NZTFCTIM;
          GOTO      NZTF9999
.
NZTF2700  MATCH     SP70,NZTFCUID
          GOTO      NZTF9999 IF EQUAL
.
          PACK      KEY10,NZTFCUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      NZTFCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      NZTF9999
.
NZTF2800  MATCH     NZTFUDAT,SP70
          GOTO      NZTF9999 IF EQUAL
.
          UNPACK    NZTFUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZTF9999
.
NZTF2900  WRITE     HTMLFILE;NZTFUTIM;
          GOTO      NZTF9999
.
NZTF3000  MATCH     SP70,NZTFUUID
          GOTO      NZTF9999 IF EQUAL
.
          PACK      KEY10,NZTFUUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      NZTFUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      NZTF9999
.
NZTF9999  RETURN
.
.------------------------------------------------------------
.  Update NZPTFEFD file
.------------------------------------------------------------
MVNZTF00  MOVE      NZTFE001,NZTFHOSP
          MOVE      NZTFE002,NZTFSEST
          MOVE      NZTFE003,NZTFCLAM
          MOVE      NZTFE004,NZTFFUND
          MOVE      NZTFE005,NZTFFTAB
          MOVE      NZTFE006,NZTFEDAT
          MOVE      NZTFE007,NZTFISEQ
          MOVE      NZTFE008,NZTFACTV
          MOVE      NZTFE009,NZTFMUNI
          MOVE      NZTFE010,NZTFUNTP
          MOVE      NZTFE011,NZTFMINU
          MOVE      NZTFE012,NZTFMAXU
          MOVE      SP70,NZTFSPAR
.
MVNZTF99  RETURN
.
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
NZTH0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
NZTH0100  CALL      RKPTHSP1
          BRANCH    OVRCD,NZTH9999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     DIM3,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      NZTH0100
.
NZTH9999  RETURN
.
.------------------------------------------------------------
. Clear file variables for NZPTFEFD
.------------------------------------------------------------
CLNZTF00  MOVE      SP70,NZTFHOSP
          MOVE      SP70,NZTFSEST
          MOVE      SP70,NZTFCLAM
          MOVE      SP70,NZTFFUND
          MOVE      SP70,NZTFFTAB
          MOVE      SP70,NZTFEDAT
          MOVE      SP70,NZTFISEQ
          MOVE      SP70,NZTFACTV
          MOVE      SP70,NZTFMUNI
          MOVE      SP70,NZTFUNTP
          MOVE      SP70,NZTFMINU
          MOVE      SP70,NZTFMAXU
          MOVE      SP70,NZTFCDAT
          MOVE      SP70,NZTFCTIM
          MOVE      SP70,NZTFCUID
          MOVE      SP70,NZTFUDAT
          MOVE      SP70,NZTFUTIM
          MOVE      SP70,NZTFUUID
          MOVE      SP70,NZTFSPAR
.
CLNZTF99  RETURN
.
.-------------------------------------------------------------------------
. Link to Next Set NZ Private Theatre Fees
.-------------------------------------------------------------------------
NXTNZT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          MOVE      F2,DIM2
          REP       " +",DIM2
.
          REP       " +",NZTFE001
          REP       " +",NZTFE002
          REP       " +",NZTFE003
          REP       " +",NZTFE004
          REP       " +",NZTFE005
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZTFE006
          IF        !@EQUAL
            UNPACK    NZTFE006,CCENT,CYEAR,CMON,CDAY * effective date    
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
.
          REP       " +",NZTFE007
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nztfe001=",NZTFE001:
                                 "&nztfe002=",NZTFE002:
                                 "&nztfe003=",NZTFE003:
                                 "&nztfe004=",NZTFE004:
                                 "&nztfe005=",NZTFE005:
                                 "&nztfe006=",KEY11:
                                 "&nztfe007=",NZTFE007:
                                 "&fileflag=",FILEFLAG;
.
          REP       "+ ",NZTFE001
          REP       "+ ",NZTFE002
          REP       "+ ",NZTFE003
          REP       "+ ",NZTFE004
          REP       "+ ",NZTFE005
          MOVE      SP70,KEY11
          REP       "+ ",NZTFE007
.
NXTNZT99  RETURN
.-------------------------------------------------------------
. Link to Prev NZ Private Theatre
.-------------------------------------------------------------
PRVNZT00  MOVE      NORECORD,KEY2
          rEP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          MOVE      F2,DIM2
          REP       " +",DIM2
.
          REP       " +",NZTFE001
          REP       " +",NZTFE002
          REP       " +",NZTFE003
          REP       " +",NZTFE004
          REP       " +",NZTFE005
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZTFE006
          IF        !@EQUAL
            UNPACK    NZTFE006,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
.
          REP       " +",NZTFE007
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nztfe001=",NZTFE001:
                                 "&nztfe002=",NZTFE002:
                                 "&nztfe003=",NZTFE003:
                                 "&nztfe004=",NZTFE004:
                                 "&nztfe005=",NZTFE005:
                                 "&nztfe006=",KEY11:
                                 "&nztfe007=",NZTFE007:
                                 "&fileflag=",FILEFLAG;
.
          REP       "+ ",NZTFE001
          REP       "+ ",NZTFE002
          REP       "+ ",NZTFE003
          REP       "+ ",NZTFE004
          REP       "+ ",NZTFE005
          MOVE      SP70,KEY11
          REP       "+ ",NZTFE007
.
PRVNZT99  RETURN
.
.------------------------------------------------------------
. Table of NZ Private Theatre Fee Header Record Details
.------------------------------------------------------------
NZPTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      NZPTHD00              * Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD   * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     "N",FILEFLAG
          GOTO      NZPTAB10 IF EQUAL
.
          MOVE      ONE,F2
          PACK      KEY33,NZTFE001,F2,SP70  * Cur File
          CALL      RSNZTFE2
NZPTAB05  CALL      RKNZTFE2
          BRANCH    OVRCD,NZPTAB90
          GOTO      NZPTAB20
.
NZPTAB10  MOVE      ONE,F2
          PACK      KEY33,NZTFE001,F2,SP70  * New File
          CALL      RSNZTF12
NZPTAB15  CALL      RKNZTF12
          BRANCH    OVRCD,NZPTAB90
.
NZPTAB20  MATCH     NZTFE001,NZTFHOSP          * Hospital
          GOTO      NZPTAB90 IF NOT EQUAL
.
          MATCH     " 1",NZTFISEQ                * Only Sequence 1's
          GOTO      NZPTAB90 IF NOT EQUAL
.
          MATCH     SP70,NZTFE002
          IF        !@EQUAL
            MATCH     NZTFE002,NZTFSEST          * Session Type
            GOTO      NZPTAB50 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZTFE003 
          IF        !@EQUAL
            MATCH     NZTFE003,NZTFCLAM          * Claim Code
            GOTO      NZPTAB50 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZTFE004
          IF        !@EQUAL
            MATCH     NZTFE004,NZTFFUND          * Health Fund
            GOTO      NZPTAB50 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZTFE005 
          IF        !@EQUAL
            MATCH     NZTFE005,NZTFFTAB          * Table
            GOTO      NZPTAB50 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            MATCH     "N",FILEFLAG
            GOTO      NZPTAB15 IF EQUAL
            GOTO      NZPTAB05
          ENDIF
.
          CALL      NZPTRW00
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            MATCH     "N",FILEFLAG
            IF        @EQUAL
              GOTO      NZPTAB15
            ELSE
              GOTO      NZPTAB05
            ENDIF
          ENDIF
          GOTO      NZPTAB99
.
NZPTAB50  MATCH     "N",FILEFLAG
          IF        @EQUAL
            GOTO      NZPTAB15
          ELSE
            GOTO      NZPTAB05
          ENDIF
.
          GOTO      NZPTAB99
.
NZPTAB90  CALL      NOMORE00     * Display No More Records Message
.
NZPTAB99  RETURN
.------------------------------------------------------------
. NZ Private Theatre Fee Table (TABLE ROW)
.------------------------------------------------------------
NZPTRW00  MATCH     SP70,NZTFHOSP
          IF        !@EQUAL
            PACK      KEY3,NZTFHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD=1
              MOVE      NZTFHOSP,PTHSNAME        * hospital 
            ENDIF
          ENDIF
.
          MOVE     SP70,SESTDESC
          MATCH    SP70,NZTFSEST
          IF       !@EQUAL
            PACK     KEY5,ANST,ANSU,NZTFSEST,SP70
            CALL     RDCODE1
            IF       OVRCD=1
              MOVE     NZTFSEST,TDESC            * session type
            ENDIF
            MOVE    TDESC,SESTDESC
          ENDIF
.
          MOVE     SP70,CLAMDESC
          MATCH    SP70,NZTFCLAM
          IF       !@EQUAL
            PACK     KEY5,ANSC,ANSL,NZTFCLAM,SP70
            CALL     RDCODE1
            IF       OVRCD=1
              MOVE     NZTFCLAM,TDESC            * claim code
            ENDIF
            MOVE    TDESC,CLAMDESC
          ENDIF
.
          MOVE      SP70,DISPEDAT
          MATCH     SP70,NZTFEDAT
          IF        !@EQUAL
            UNPACK    NZTFEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPEDAT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MATCH     "1",NZTFACTV
            MOVE      "No ",ACTIDESC
          IF        @EQUAL
          ELSE
            MOVE      "Yes",ACTIDESC
          ENDIF
.
          REP       " +",NZTFHOSP
          REP       " +",NZTFSEST
          REP       " +",NZTFCLAM
          REP       " +",NZTFFUND
          REP       " +",NZTFFTAB
          REP       " +",NZTFEDAT
          REP       " +",NZTFISEQ
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZTFEDAT
          IF        !@EQUAL
            UNPACK    NZTFEDAT,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&nztfe001=",NZTFHOSP:
                             "&nztfe002=",NZTFSEST:
                             "&nztfe003=",NZTFCLAM:
                             "&nztfe004=",NZTFFUND:
                             "&nztfe005=",NZTFFTAB:
                             "&nztfe006=",KEY11:
                             "&nztfe007=",NZTFISEQ:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>";
.
          REP       "+ ",NZTFHOSP
          REP       "+ ",NZTFSEST
          REP       "+ ",NZTFCLAM
          REP       "+ ",NZTFFUND
          REP       "+ ",NZTFFTAB
          REP       "+ ",NZTFEDAT
          REP       "+ ",NZTFISEQ
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;PTHSNAME,"&nbsp;</td>":
                               "<td>",SESTDESC,"&nbsp;</td>":
                               "<td>",CLAMDESC,"&nbsp;</td>":
                               "<td>",NZTFFUND,"&nbsp;</td>":
                               "<td>",NZTFFTAB,"&nbsp;</td>":
                               "<td>",NZTFMUNI,"&nbsp;</td>":
                               "<td>",NZTFUNTP,"&nbsp;</td>":
                               "<td>",NZTFMINU,"&nbsp;</td>":
                               "<td>",NZTFMAXU,"&nbsp;</td>":
                               "<td>",DISPEDAT,"&nbsp;</td>":
                               "<td>",ACTIDESC,"&nbsp;</td></tr>"
          ELSE
            WRITE     HTMLFILE;SESTDESC,"&nbsp;</td>":
                               "<td>",CLAMDESC,"&nbsp;</td>":
                               "<td>",NZTFFUND,"&nbsp;</td>":
                               "<td>",NZTFFTAB,"&nbsp;</td>":
                               "<td>",NZTFMUNI,"&nbsp;</td>":
                               "<td>",NZTFUNTP,"&nbsp;</td>":
                               "<td>",NZTFMINU,"&nbsp;</td>":
                               "<td>",NZTFMAXU,"&nbsp;</td>":
                               "<td>",DISPEDAT,"&nbsp;</td>":
                               "<td>",ACTIDESC,"&nbsp;</td></tr>"
          ENDIF
.
NZPTRW99 RETURN
.------------------------------------------------------------
. NZ Private Theatre Fee's Details Table (TABLE HEADING)
.------------------------------------------------------------
NZPTHD00  WRITE     HTMLFILE;"<tr>";
.
          PACK      KEY5,ANSC,ANSL,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      SP70,TDESC
          ENDIF
.         
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell>Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>Session Type</td>":
                             "<td class=HeadingCell>",TDESC,"</td>":
                             "<td class=HeadingCell>Contract</td>":
                             "<td class=HeadingCell>Table</td>":
                             "<td class=HeadingCell>Minutes Per Unit</td>":
                             "<td class=HeadingCell>Unit Price</td>":
                             "<td class=HeadingCell>Min Units</td>":
                             "<td class=HeadingCell>Max Units</td>":
                             "<td class=HeadingCell>Effective Date</td>":
                             "<td class=HeadingCell>Active</td>":
                             "</tr>"
.
NZPTHD99  RETURN
.
.-------------------------------------------------------------------------
. Get Next Sequence No For NZ Private Theatre Fee
.-------------------------------------------------------------------------
NXTISQ00  MOVE      ONE,F2                 * Initialize Sequence to 1
.
          MATCH     "N",FILEFLAG
          GOTO      NXTISQ10 IF EQUAL
.
          PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,Z70  * Cur File
          CALL      RSNZTFE1
          CALL      RPNZTFE1
          BRANCH    OVRCD,NXTISQ99
          GOTO      NXTISQ20
.
NXTISQ10  PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,Z70  * Cur File
          CALL      RSNZTF11
          CALL      RPNZTF11
          BRANCH    OVRCD,NXTISQ99
.
NXTISQ20  MATCH     NZTFE001,NZTFHOSP          * Hospital
          GOTO      NXTISQ99 IF NOT EQUAL
.
          MATCH     NZTFE002,NZTFSEST          * Session Type
          GOTO      NXTISQ99 IF NOT EQUAL
.
          MATCH     NZTFE003,NZTFCLAM          * Claim Code
          GOTO      NXTISQ99 IF NOT EQUAL
.
          MATCH     NZTFE004,NZTFFUND          * Health Fund
          GOTO      NXTISQ99 IF NOT EQUAL
.
          MATCH     NZTFE005,NZTFFTAB          * Health Fund Table
          GOTO      NXTISQ99 IF NOT EQUAL
.
          MATCH     NZTFE006,NZTFEDAT          * Effective Date
          GOTO      NXTISQ99 IF NOT EQUAL
.
          MOVE      ZERO,F2
          MOVE      NZTFISEQ,F2
          ADD       ONE,F2
.
NXTISQ99  RETURN
.
.------------------------------------------------------------
. Table of NZ Private Theatre Fee detail Record Details
.------------------------------------------------------------
NZPTTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.                                
          CALL      NZPTTD00              * Heading
.                                
          IF        NORECORD=0   
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF     
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.         
          MATCH     "N",FILEFLAG
          GOTO      NZPTTB10 IF EQUAL
.
          PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,SP70  * Cur File
          CALL      RSNZTFE1
NZPTTB05  CALL      RKNZTFE1
          BRANCH    OVRCD,NZPTTB90
          GOTO      NZPTTB20
.
NZPTTB10  PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,SP70  * New File
          CALL      RSNZTF11
NZPTTB15  CALL      RKNZTF11
          BRANCH    OVRCD,NZPTTB90
.
NZPTTB20  MATCH     NZTFE001,NZTFHOSP          * Hospital
          GOTO      NZPTTB90 IF NOT EQUAL
.
          MATCH     NZTFE002,NZTFSEST          * Session Type
          GOTO      NZPTTB90 IF NOT EQUAL
.
          MATCH     NZTFE003,NZTFCLAM          * Claim Code
          GOTO      NZPTTB90 IF NOT EQUAL
.
          MATCH     NZTFE004,NZTFFUND          * Health Fund
          GOTO      NZPTTB90 IF NOT EQUAL
.
          MATCH     NZTFE005,NZTFFTAB          * Table
          GOTO      NZPTTB90 IF NOT EQUAL
.
          MATCH     NZTFE006,NZTFEDAT          * Effective Date
          GOTO      NZPTTB90 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            MATCH     "N",FILEFLAG
            GOTO      NZPTTB15 IF EQUAL
            GOTO      NZPTTB05
          ENDIF
.
          CALL      NZPTTR00
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            MATCH     "N",FILEFLAG
            IF        @EQUAL
              GOTO      NZPTTB15
            ELSE
              GOTO      NZPTTB05
            ENDIF
          ENDIF
          GOTO      NZPTTB60
.
NZPTTB50  MATCH     "N",FILEFLAG
          IF        @EQUAL
            GOTO      NZPTTB15
          ELSE
            GOTO      NZPTTB05
          ENDIF
.
NZPTTB60  PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,NZTFE007,SP70
.
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RDNZTF11
            IF        OVRCD=1
              CALL      CLNZTF00
            ENDIF
          ELSE
            CALL      RDNZTFE1
            IF        OVRCD=1
              CALL      CLNZTF00
            ENDIF
          ENDIF
.
          GOTO      NZPTTB99
.
NZPTTB90  CALL      NOMORE00     * Display No More Records Message 
.
NZPTTB99  RETURN
.------------------------------------------------------------
. NZ Private Theatre Fee Table (TABLE ROW)
.------------------------------------------------------------
NZPTTR00  MATCH     "1",NZTFACTV
            MOVE      "No ",ACTIDESC
          IF        @EQUAL
          ELSE
            MOVE      "Yes",ACTIDESC
          ENDIF
.
          REP       " +",NZTFHOSP
          REP       " +",NZTFSEST
          REP       " +",NZTFCLAM
          REP       " +",NZTFFUND
          REP       " +",NZTFFTAB
          REP       " +",NZTFISEQ
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZTFEDAT
          IF        !@EQUAL
            UNPACK    NZTFEDAT,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&nztfe001=",NZTFHOSP:
                             "&nztfe002=",NZTFSEST:
                             "&nztfe003=",NZTFCLAM:
                             "&nztfe004=",NZTFFUND:
                             "&nztfe005=",NZTFFTAB:
                             "&nztfe006=",KEY11:
                             "&nztfe007=",NZTFISEQ:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>";
.
          REP       "+ ",NZTFHOSP
          REP       "+ ",NZTFSEST
          REP       "+ ",NZTFCLAM
          REP       "+ ",NZTFFUND
          REP       "+ ",NZTFFTAB
          MOVE      SP70,KEY11
          REP       "+ ",NZTFISEQ
.
          WRITE     HTMLFILE;NZTFISEQ,"&nbsp;</td>":
                             "<td>",NZTFMUNI,"&nbsp;</td>":
                             "<td>",NZTFUNTP,"&nbsp;</td>":
                             "<td>",NZTFMINU,"&nbsp;</td>":
                             "<td>",NZTFMAXU,"&nbsp;</td>":
                             "<td>",ACTIDESC,"&nbsp;</td></tr>"
.
NZPTTR99 RETURN
.------------------------------------------------------------
. NZ Private Theatre Fee's Details Table (TABLE HEADING)
.------------------------------------------------------------
NZPTTD00  WRITE     HTMLFILE;"<tr>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>Sequence</td>":
                             "<td class=HeadingCell>Minutes Per Unit</td>":
                             "<td class=HeadingCell>Unit Price</td>":
                             "<td class=HeadingCell>Minimum Units</td>":
                             "<td class=HeadingCell>Maximum Units</td>":
                             "<td class=HeadingCell>Active</td>":
                             "</tr>"
.
NZPTTD99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for Copy NZPTFEFD
.------------------------------------------------------------
CCNZTF00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,CCNZTF01,CCNZTF02,CCNZTF03,CCNZTF04,CCNZTF05:
                       CCNZTF06
.
          MOVE      ONE,EXIT
          GOTO      CCNZTF99
.
CCNZTF01  PACK      CPTFE001,QRYDATA,SP70
          GOTO      CCNZTF99
.
CCNZTF02  PACK      CPTFE002,QRYDATA,SP70
          GOTO      CCNZTF99
.
CCNZTF03  PACK      CPTFE003,QRYDATA,SP70
          GOTO      CCNZTF99
.
CCNZTF04  PACK      CPTFE004,QRYDATA,SP70
          GOTO      CCNZTF99
.
CCNZTF05  PACK      CPTFE005,QRYDATA,SP70
          GOTO      CCNZTF99
.
CCNZTF06  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      CPTFE006,CCENT,CYEAR,CMON,CDAY
          GOTO      CCNZTF99
.
CCNZTF99  RETURN

.******************************************************************************
. Program        : OPRRCITM.PBL
.
. Function       : CGI variable functions & tags for Recovery Closed Incidents
.
. Modifications  :
.
. V10.12.01  28/02/2016  Ken Bell       TSK 0851092
.            Added the Hospital Code for MultiHospital client
.------------------------------------------------------------------------------
. V10.08.01  29/06/2016  Ebon Clements  TSK 0308881   
.            Added semi colon to recovery closed end time tag
. V10.08.00  19/05/2016  Ebon Clements  TSK 0308881   
.            Created include
.******************************************************************************
.------------------------------------------------------------------------
.   Clear Parameters for Recovery Closed Incidents
.----------------------------------------------------------------------
CPOPRC00  MOVE      Z70,OPRCI001
          MOVE      Z70,OPRCI002
          MOVE      Z70,OPRCI003
          MOVE      Z70,OPRCI004
          MOVE      Z70,OPRCI005
          MOVE      Z70,OPRCI006
          MOVE      Z70,OPRCI007
          MOVE      Z70,OPRCI008
          MOVE      Z70,OPRCI009
          MOVE      Z70,OPRCI010
          MOVE      Z70,OPRCI011
          MOVE      Z70,OPRCI012
          MOVE      Z70,OPRCI013
.
CPOPRC99  RETURN
.------------------------------------------------------------
. Tags for Recovery Closed Incidents
.------------------------------------------------------------
ORCL0000  BRANCH    FLDITMNO,ORCL0010,ORCL0020,ORCL0030,ORCL0040,ORCL0050:
                             ORCL0060,ORCL0070,ORCL0080,ORCL0090,ORCL0100:
                             ORCL0110,ORCL0120,ORCL0130
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ORCL9999
.
ORCL0010  MOVE      "YD",CATEGORY             * Location
          PACK      CODE,OPRCLOCN,SP70
          CALL      CODITM00
          GOTO      ORCL9999
.
ORCL0020  MATCH     OPRCSDAT,SP70             * Recovery Closed Start Date
          GOTO      ORCL9999 IF EQUAL
.
          UNPACK    OPRCSDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR; 
          GOTO      ORCL9999
.
ORCL0030  WRITE     HTMLFILE;OPRCSTIM;        * Recovery Closed Start Time
          GOTO      ORCL9999
.
ORCL0040  MATCH     OPRCEDAT,SP70             * Recovery Closed End Date
          GOTO      ORCL9999 IF EQUAL
.
          UNPACK    OPRCEDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ORCL9999
.
ORCL0050  WRITE     HTMLFILE;OPRCETIM;        * Recovery Closed End Time
          GOTO      ORCL9999
.
ORCL0060  MOVE      "Cr",CATEGORY             * Recovery Closed Reason
          PACK      CODE,OPRCREAS,SP70
          CALL      CODITM00 
          GOTO      ORCL9999
.
ORCL0070  MATCH     SP70,OPRCCSUI             * User Who Entered Recovery Closed
          GOTO      ORCL9999 IF EQUAL
.
          PACK      KEY10,OPRCCSUI,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      OPRCCSUI,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ORCL9999
.
ORCL0080  MATCH     OPRCCDAT,SP70             * Date Record Created
          GOTO      ORCL9999 IF EQUAL
.
          UNPACK    OPRCCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ORCL9999
.
ORCL0090  WRITE     HTMLFILE;OPRCCTIM;        * Time Record Created
          GOTO      ORCL9999
.
ORCL0100  MATCH     SP70,OPRCCEUI             * User Who Entered Recovery Closed
          GOTO      ORCL9999 IF EQUAL         * End
.
          PACK      KEY10,OPRCCEUI,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      OPRCCEUI,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM; 
          GOTO      ORCL9999
.
ORCL0110  MATCH     OPRCCEDT,SP70             * Date Recovery Close End
          GOTO      ORCL9999 IF EQUAL         * Entered
.
          UNPACK    OPRCCEDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ORCL9999
.
ORCL0120  WRITE     HTMLFILE;OPRCCETM;        * Time Recovery Close End Entered
          GOTO      ORCL9999
.
ORCL0130  WRITE     HTMLFILE;OPRCHOSP;        * Hospital Code for MultiHospital
          GOTO      ORCL9999
.
ORCL9999  RETURN
.
.------------------------------------------------------------
.   Set Parameters for Recovery Closed Incidents
.------------------------------------------------------------
SOPRC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SOPRC001,SOPRC002,SOPRC003,SOPRC004,SOPRC005:
                       SOPRC006,SOPRC007,SOPRC008,SOPRC009,SOPRC010:
                       SOPRC011,SOPRC012,SOPRC013
.
          MOVE      ONE,EXIT
          GOTO      SOPRC999
.
SOPRC001  PACK      OPRCI001,QRYDATA,SP70
          GOTO      SOPRC999
.
SOPRC002  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      OPRCI002,CCENT,CYEAR,CMON,CDAY
          GOTO      SOPRC999
.
SOPRC003  PACK      OPRCI003,QRYDATA,SP70
          GOTO      SOPRC999
.
SOPRC004  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      OPRCI004,CCENT,CYEAR,CMON,CDAY
          GOTO      SOPRC999
.
SOPRC005  PACK      OPRCI005,QRYDATA,SP70
          GOTO      SOPRC999
.
SOPRC006  PACK      OPRCI006,QRYDATA,SP70
          GOTO      SOPRC999
.
SOPRC007  PACK      OPRCI007,QRYDATA,SP70
          GOTO      SOPRC999
.
SOPRC008  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      OPRCI008,CCENT,CYEAR,CMON,CDAY
          GOTO      SOPRC999
.
SOPRC009  PACK      OPRCI009,QRYDATA,SP70
          GOTO      SOPRC999
.
SOPRC010  PACK      OPRCI010,QRYDATA,SP70
          GOTO      SOPRC999
.
SOPRC011  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      OPRCI011,CCENT,CYEAR,CMON,CDAY
          GOTO      SOPRC999
.
SOPRC012  PACK      OPRCI012,QRYDATA,SP70
          GOTO      SOPRC999
.
SOPRC013  PACK      OPRCI013,QRYDATA,SP70
          GOTO      SOPRC999
.
SOPRC999  RETURN
.
.------------------------------------------------------------
. Update file variables for Recovery Closed Incidents
.------------------------------------------------------------
MVOPRC00  MATCH     OPRCI001,Z70
          IF        !@EQUAL
            MOVE      OPRCI001,OPRCLOCN
          ENDIF
.
          MATCH     OPRCI002,Z70
          IF        !@EQUAL
            MOVE      OPRCI002,OPRCSDAT
          ENDIF
.
          MATCH     OPRCI003,Z70
          IF        !@EQUAL
            MOVE      OPRCI003,OPRCSTIM
          ENDIF
.
          MATCH     OPRCI004,Z70
          IF        !@EQUAL
            MOVE      OPRCI004,OPRCEDAT
          ENDIF
.
          MATCH     OPRCI005,Z70
          IF        !@EQUAL
            MOVE      OPRCI005,OPRCETIM
          ENDIF
.
          MATCH     OPRCI006,Z70
          IF        !@EQUAL
            MOVE      OPRCI006,OPRCREAS
          ENDIF
.
          MATCH     OPRCI007,Z70
          IF        !@EQUAL
            MOVE      OPRCI007,OPRCCSUI
          ENDIF
.
          MATCH     OPRCI008,Z70
          IF        !@EQUAL
            MOVE      OPRCI008,OPRCCDAT
          ENDIF
.
          MATCH     OPRCI009,Z70
          IF        !@EQUAL
            MOVE      OPRCI009,OPRCCTIM
          ENDIF
.
          MATCH     OPRCI010,Z70
          IF        !@EQUAL
            MOVE      OPRCI010,OPRCCEUI
          ENDIF
.
          MATCH     OPRCI011,Z70
          IF        !@EQUAL
            MOVE      OPRCI011,OPRCCEDT
          ENDIF
.
          MATCH     OPRCI012,Z70
          IF        !@EQUAL
            MOVE      OPRCI012,OPRCCETM
          ENDIF
.
          MATCH     OPRCI013,Z70
          IF        !@EQUAL
            MOVE      OPRCI013,OPRCHOSP
          ENDIF
.
MVOPRC99  RETURN

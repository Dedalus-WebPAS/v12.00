.
.----------------------------------------------------------------------
. Program       : PATWEB63
.
. Function      : Casemix Maintenance server
.
. Modifications : 
.----------------------------------------------------------------------
. V12.00.04 09/09/2025 Bella Turco     TSK 0961419
.           Changed read of Matrix File to check for Blank HF checkbox rule
. V12.00.03 25/07/2025 J.Tan           TSK 0961419
.           Fixed reposition read Matrix file after Checking rules
. V12.00.02 26/06/2025 J.Tan           TSK 0961419
.           Fixed reposition read Matrix file after Checking rules
. V12.00.01 09/05/2025 J.Tan           TSK 0946461
.           Mod to remove tempfiles for breakdown Revenue/invoice
. V11.05.01 06/12/2024 Alina Bhari     TSK 0940692
.           Fixed the issue with displaying record with all the search criteria
.           in Contract Procedure Matrix Maintenance - NZMTRX05
. V11.04.06 11/07/2024 J.Tan           TSK 0942678
.           Added CMXRULES to set a casemix code rule
. V11.04.05 03/07/2024  J.Tan         TSK 0942678
.           Mod to display first rule of Casemix Matrix
. V11.04.04 26/06/2024  Thanh T       TSK 0947684
.           Changed NZMTRX00 to display the number of rows depending
.           on system parameter
. V11.04.03 03/05/2024 J.Tan          TSK 0910994
.           Mod to display all Matrix rules
. V11.04.02 21/02/2024 J.Tan          TSK 0910994
.           Added Att.Doct,Concession card type and Disc.UDF to Matrix
. V11.04.02 04/03/2023  J.Tan         TSK 0942703
.           Mod Casemix Matrix for a selection Casemix code (INDEX=4)
. V11.04.01 21/12/2023  Thanh T       TSK 0910994
.           Replaced CLRPMMTX with CLPMSCMT function in CLPMSCMT.PBL
. V11.03.03 06/07/2023  J.Tan         TSK 0913418
.           Mod position read on Contract type and Contract for NZ Proc.matrix
. V11.03.02 17/04/2023  Don Nguyen    TSK 0919244
.           Recompiled for changes in PMSCMTTM - Fixed ICD Procedure code reads
. V11.03.01 15/12/2022  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.02 09/05/2022  Sunny         TSK 0916523
.           Added OPICO1 in INIT0000
. V11.02.01 10/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTMA1FD (PATMASTM) changes
. V11.01.03 28/09/2021 J.Tan            TSK 0901515
.           Added for Primary ICD procedures
. V11.01.02 07/04/2021  Tracey Nguyen   TSK 0901515
.           Recompiled for PMSCMTFD - Added new fields
.           a) 1 File type for ICD procedure (PMCCIPF)
.           b) 3 new CMBS Field Type (PMCCFTS4/PMCCFT5C/PMCCFT6C)
.           c) 3 new CMBS Codes From (PMCCPC4F,PMCCSC5F,PMCCTC6F)
.           d) 3 new CMBS Codes To   (PMCCPC4T/PMCCSC5T,PMCCTC6T)
. V11.01.01 11/03/2021  Tracey Nguyen   TSK 0901515                          
.           Recompiled for PMSCMTFD - Added Primary ICD Procedure 1-5        
.           (PMCCICP1-5)                                                     
.----------------------------------------------------------------------
. V11.00.02 09/12/2020  Thanh T        TSK 0872840
.           Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
. V11.00.01 10/03/2020  J.Tan          TSK 0838262
.           Added Effective from and to date to MBS Item file
. V10.11.04 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.03 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
. V10.11.02 26/07/2017  Thanh T.       TSK 0821710
.           Recompiled PASMISTM"
. V10.11.01 14/07/2017  Thanh T.       TSK 0821710
.           Audit Amission/outpatient visit comments. PATMISTM changed.
.----------------------------------------------------------------------
.V10.10.03  13/06/2017  J.Tan         TSK 0297904
.           Fixed description for Non-Accumulative inliers
.V10.10.02  17/05/2017  J.Tan         TSK 0297904
.           Changed description to 'No,ICU/CCU' Non-Accumulative inliers
.V10.10.01  04/04/2017  J.Tan         TSK 0297904
.           Mod for ICU/CCU Non-Accumulative inliers
.V10.08.01  18/10/2015  J.Tan          TSK 0822878
.           Changed CASMTX00 - index2 to check for Contract ID
.V10.07.01  30/10/2015  J.Tan          CAR 290448
.           Added 'Charge on No Pay Day' field to Overnight Additional Fee
.V10.06.02  15/07/2015  J.Tan          CAR 319342
.           Changed Casemix Matrix 'Disc.UDF' to 'Care Class'
.V10.06.01  02/04/2015  Ania P         CAR 261630
.           Removed use of temp file name
.V10.04.03  12/05/2013  J.Tan          CAR 233545
.           Fixed Global duplication for SX Contract Procedure Matrix
.V10.04.02  07/04/2014  Peter Vela     CAR 286258
.           Recompiled for PATMASTM
.V10.04.01  31.03.2014  B.G.Ackland    CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
.----------------------------------------------------------------------
.V10.03.06  24/01/2013  J.Tan          CAR 278330
.           Fixed Multiple Procedures listing
.V10.03.05  09/10/2012  J.Tan          CAR 274195
.           Fixed Casemix matrix search by Casemix code and Contract ID
.V10.03.04  21/09/2012  J.Tan          CAR 271474
.           Mods to write record to Matrix header file (patcmtaf)
.V10.03.03  16/05/2012  Jill Parkinson CAR 265369
.           Added 4th index on pmscmtaf
.V10.03.02  26/03/2012  J.Tan          CAR 262185
.           Mods Matrix search to using 3rd index if Health fund is selected
.V10.03.01  15/03/2012  J.Tan          CAR 261869
.           Mods for Global function Matrix Claim code/HF Duplication
.V10.01.05  04/02/2011  Ebon Clements  CAR 233928
.           Added audit of deleted billing contract records
.V10.01.04  01/02/2011  Davin          CAR 233055
.           Removed sameday casemix fees funding new files
.           Removed overnight casemix fees funding new files
.           27/01/2011  Ebon Clements  CAR 233050
.           Removed casemix funding new file
.V10.01.03  20/01/2011  Mike Laming    CAR 233054
.           Added Contract Id. & changed Indexes to Multiple Procedures Table
.V10.01.02  18/01/2011  Ebon Clements  CAR 233051
.           Added contract to casemix matrix and removed old/new file
.V10.01.01  09/12/2010  Ebon Clements  CAR 233149
.           Added fees invoiced group to sameday/overnight fees
.V10.00.09  19/10/2010  J.Tan          CAR 229299
.           Added Delete option to All Current Billing files
.V10.00.08  14/09/2010  Ebon Clements  CAR 229944
.           Fixed HF test on index 1 casemix matrix maintenance list - CASMTX10
.V10.00.07  30/08/2010  J.Tan          CAR 229168
.           Added Delete option to Current Matrix file
.V10.00.06  25/08/2010  J.Tan          CAR 226844
.           Checking for Total Rev.breakdown against Lumpsum if Total rev.<> 0
.V10.00.05  11/08/2010  Ebon Clements  CAR 227991
.           Fixed blank health fund test in global delete sameday fee - SDEL0000
.V10.00.04  12/07/2010  J.Tan          CAR 225026
.           Fixed matrix search
.V10.00.03  21/05/2010  J.Tan          CAR 220995
.           Mods for casemix overnight and sameday enquiry
.V10.00.02  Mike Laming   CAR 157391   
.           Recompiled for changes to PATEX1FD.
.V10.00.01  17/03/2010  J.Tan          CAR 218192
.           Fixed searching matrix list (timeout)
.----------------------------------------------------------------------
. V9.12.01  08/01/2009  J.Tan          CAR 205303
.           Added Casemix Contract ID
.----------------------------------------------------------------------
. V9.11.02  07/01/2009  Jill Habasque  CAR 187007
.           Added save of proccntr in TABCON00 to work the same as COMWEB80
. V9.11.01  06/11/2008  Peter McMullen CAR 174725
.           convert internal javascript to W3C standards
.----------------------------------------------------------------------
. V9.10.01  24/04/2008  Ebon Clements  CAR 163698
.           Added blank h/fund option to c/mix matrix global delete GDEL0000
.----------------------------------------------------------------------
. V9.09.05  27/11/2007  Peter Vela     CAR 155594
.           Fixed display of Extract File List EXTFIL00
. V9.09.04  13/11/2007  Peter Mcullen  CAR 151124
.           Allow delete of casemix matrix codes/rules from new file
. V9.09.03  10/09/2007  J.Tan          CAR 146067
.           Added Global function for Multiple Procedures
. V9.09.02  10/08/2007  J.Tan          CAR 144656
.           Added Non-Accumulative Inlier to Overnight Additional charge file
.           Added new option for Multiple Procedures
. V9.09.01  26/06/2007  Jill Habasque  CAR 142154 
.           Recompiled for NZPCMTTM
.----------------------------------------------------------------------
. V9.08.07  01/03/2007  J.Tan          CAR 120009 
.           Mods to search for contract funding
. V9.08.06  23/02/2007  Davin          CAR 120000 
.           Added 'copyflag' keystroke to CTRX0000
. V9.08.05  14/02/2007  Jill Habasque  CAR 120004 
.           Copied CCFN0000 from COMWEB80
. V9.08.04  14/02/2007  Davin         CAR 128957
.           Changed to allow misc item groups to be included/excluded from 
.           contract procedure matrix
. V9.08.03  31/01/2007  Peter Vela     CAR 127930
.           Recompiled for MRTMASFD
. V9.08.02  15/01/2007  Davin         CAR 128957
.           Removed 'Item Type' and 'Include Misc Items' fields from NZ
.           Contract Procedure Matrix Table (NZMTRW00)
. V9.08.01  27/10/2006  J.Tan         CAR 120000
.           Added NZ Contract procedure matrix maintenance
.----------------------------------------------------------------------
. V9.07.01  04/09/2006  Ebon Clements CAR 117025
.           Added WINALR00 to SAMEDY94 and OVERNT94
.----------------------------------------------------------------------
. V9.06.01  06/06/2006  J.Tan         CAR 103001
.           Fixed problem with HF duplication 
.----------------------------------------------------------------------
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B02 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
.----------------------------------------------------------------------
. V9.04.08  21/11/2005  Peter Vela    CAR 68675
.           Recompiled for PATDSCTM
. V9.04.07  14/09/2005  J.Tan   
.           Added field for Day type from Casemix Inlier/Outlier
. V9.04.06  04/08/2005  J.Tan        CAR 62750
.           Mods not to use the redefined amount variables
. V9.04.05  03/08/2005  Peter Vela    CAR 68675
.           Recompiled for PATDSCTM
. V9.04.04  03/08/2005  J.Tan         CAR 68836
.           Fixed sameday health fund duplication option
. V9.04.03  19/07/2005  Jill Habasque CAR 67990
.           Mods to go to WRRB5000 instead of continuing until EOF
. V9.04.02  01/03/2005  Peter Vela    CAR 57547
.           Recompiled for PATVADFD and PATVADIO
. V9.04.01  07/10/2004  J.Tan    CAR 54081                  
.           Mods checking if total revenue equal to lumpsum
.----------------------------------------------------------------------
. V9.03.04  27/07/2004  J.Tan    CAR 51991                  
.           Recompiled PMSCMTTM - checking for blank fields
. V9.03.03  26/07/2004  Pat Dirito               CAR 50673
.           Added reportno for Dr Summary Report
. V9.03.02  17/06/2004  Peter Vela CAR 49016
.           2004 Stat Changes PRS/2
.           Recompiled for PMSPX2TM
. V9.03.01  19/05/2004  J.Tan CAR 49644
.           Fixed updating cutoffs details
. V9.03.00  23/07/2003  Jill Habasque CAR 36491
.           Created Web Server 
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       PATDO1FD/INC   * Doctor File
          INC       PATMI1FD/INC
          INC       PATMA1FD/INC
          INC       PATVISFD/INC   * Patients Visits File
          INC       PMSVX1FD/INC   * Visit Extension File
          INC       PATCONFD/INC
          INC       PATALRFD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       OUTSITFD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       PATPR1FD/INC
          INC       PMSPX2FD/INC
          INC       PATFN1FD/INC
          INC       PATWR1FD/INC
          INC       MRTMASFD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       PATCALAG/INC
          INC       PMSPX2TD/INC
          INC       PATRE1FD/INC
          INC       PATDGWFD/INC
          INC       PATITMFD/INC
          INC       PATDADFD/INC
          INC       PATVADFD/INC
          INC       PATCMCFD/INC
          INC       PATCMXFD/INC
          INC       PATASDFD/INC
          INC       PATLSDFD/INC
          INC       PMSCIDFD/INC
          INC       PATHLFFD/INC
          INC       PATHDFFD/INC
          INC       PATLDFFD/INC
          INC       PATAFEFD/INC
          INC       PATOVBFD/INC
          INC       PATIOVFD/INC
          INC       PATSRBFD/INC
.
          INC       PMSCCDFD/INC   * Concession Card Details
          INC       PMSSINFD/INC
          INC       PMSCMTTD/INC
          INC       PMSDCAFD/INC
          INC       PATSMDTD/INC
          INC       PATOVNTD/INC
          INC       PMSCMTFD/INC
          INC       PATCMTFD/INC
          INC       PATASFFD/INC
          INC       PMSHCGTD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCPTD/INC
          INC       APSMASFD/INC
          INC       PATIN1FD/INC
          INC       PATDSCFD/INC
          INC       PATMCHFD/INC
          INC       PATHSPFD/INC
          INC       PMSMPRTD/INC
          INC       PMSMPRFD/INC
.
          INC       PATEX1FD/INC
          INC       PATEXBFD/INC
          INC       PATEXCFD/INC
.
          INC       NZPMCHFD/INC
          INC       NZPCMTFD/INC
          INC       NZPCM1FD/INC
          INC       NZPCMTTD/INC
          INC       NZPCFNFD/INC
          INC       MLTCFNFD/INC
          INC       TFILEVAR/INC
.
.----------------------------------------------------------------------
VALDTYPE  FORM      1         * Validation Type
VALDCODE  DIM       70        * Validation Code
BRKDCODE  DIM       3
CMNORULE  FORM      1
BLANKHFD  FORM      1
CONTRCID  DIM       6
CMDLINE   DIM       90
COPYFLAG  DIM       1         * Load flag to create new file with current data
CPROCODE  DIM       9
CURRDATE  DIM       8       * Current Date
DESC      DIM       15 
DIM9      DIM       9
DAYRANGE  DIM       13
DOCTCODE  DIM       8
DEFFLAG   FORM      1
FIGRDESC  DIM       20
FINISHR   FORM      1
FINISHI   FORM      1
FIRST     FORM      1
BRKDTYPE  DIM       1
FILEFLAG  DIM       1
FILETYPE  DIM       1
FLDTYPE   DIM       1
FORM6     FORM      6
FORM8     FORM      8 
FORM3     FORM      3 
FOUNDFLG  FORM      1
GDESC     DIM       40
HEADERRC  DIM       1
INDEX     FORM      1
ISERASE   INIT      "iserase "
KEY18A    DIM       18
KEY26A    DIM       26
KEY29A    DIM       29
LOOPCNTR  FORM      3       * Keep alive loop counter
LASTRULE  FORM      1
LOOPFLAG  FORM      2
LSTRANGE  FORM      5
MENUFLAG  DIM       1        * Menu Type (Maintenance/Enquiry)
MBSDESC   DIM       70
NEXTPAGE  DIM       1       * Nextpage parameter CGI parameter
NEWFLAG   FORM      1
PSAGECON  DIM       3
PSAGETYP  DIM       3
PTSRB001  DIM       3
PTSRB002  DIM       12.2
REDIREC1  DIM       227     * Redirect URL
RULEDESC  DIM       600
RULENUMB  DIM       6  
SAVBTYPE  DIM       3
SAVCASEM  DIM       9
SAVPCNTR  DIM       6
SAVKEY34  DIM       34
SHOWREVN  FORM      1       * Show revenue breakdown
SKEY21    DIM       21
SKEY20    DIM       20
..SKEY29    DIM       29
SKEY26    DIM       26
SKEY27    DIM       27
SKEY30    DIM       30
SKEY35    DIM       35
STARTKEY  DIM       10      * Starting Key
STAT1     INIT      " must be "
STAT2     INIT      " must be blank "
STAT3     INIT      " must not be "
TOTALAMT  FORM      12.2
TOTADDIT  FORM      12.2
UPDTTYPE  DIM       1       * Update Type
UPDATEFL  FORM      1       * Update Type
BLANK     INIT      "BLANK"
.
.
FILENUM   FORM      2
EXCDATE   DIM       11
EXFDATE   DIM       11
EXTDATE   DIM       11
SEC       FORM      2
VERT      FORM      2
FNAMEA    DIM       8
FNAMEB    DIM       8
FNAMEC    DIM       8
PROCADAT  DIM       8
PROCCODE  DIM       7
PROCCLMC  DIM       3
PROCCNTR  DIM       6
PROCHOSP  DIM       3
PROCSURG  DIM      10
PROCWARD  DIM       3
.
CPCMT001  DIM       3       * Claim code
CPCMT002  DIM       6       * Health Fund
CPCMT003  DIM       3       * Health Fund Type
CPCMT004  DIM       9       * Casemix Code
CPCMT064  DIM       6       * Contract ID
.
CPMPR001  DIM       3       * Claim code
CPMPR002  DIM       6       * Health Fund
CPMPR003  DIM       3       * Health Fund Type
CPMPR004  DIM       8       * Multiple Procedures Code
.
SAMED001  DIM       1       * Record Type
SAMED002  DIM       3       * Claim code
SAMED003  DIM       6       * Health Fund
SAMED004  DIM       3       * Health Fund Type
SAMED005  DIM       9       * Casemix Code
SAMED006  DIM       3       * Bed Type
SAMED007  DIM       6       * Contract ID
.
OVERN001  DIM       1       * Record Type
OVERN002  DIM       3       * Claim code
OVERN003  DIM       6       * Health Fund
OVERN004  DIM       3       * Health Fund Type
OVERN005  DIM       9       * Casemix Code
OVERN006  DIM       3       * Bed Type
OVERN007  DIM       6       * Contract ID
.
CPSAM001  DIM       1       * Copy Record Type
CPSAM002  DIM       3       * Copy Claim code
CPSAM003  DIM       6       * Copy Health Fund
CPSAM004  DIM       3       * Copy Health Fund Type
CPSAM005  DIM       9       * Copy Casemix Code
CPSAM006  DIM       3       * Copy Bed Type
.
CPOVR001  DIM       1       * Copy Record Type
CPOVR002  DIM       3       * Copy Claim code
CPOVR003  DIM       6       * Copy Health Fund
CPOVR004  DIM       3       * Copy Health Fund Type
CPOVR005  DIM       9       * Copy Casemix Code
CPOVR006  DIM       3       * Copy Bed Type
.
CNCMT001  DIM       3        Claim code
CNCMT002  DIM       6        Contract/Health Fund
CNCMT003  DIM       1        Record Type E=Either O=Overnight D=Daycase
CNCMT004  DIM       9        Contract Procedure code
.
CATD1     INIT      "D1"
CATD2     INIT      "D2"
CATD3     INIT      "D3"
CATD4     INIT      "D4"
CATD5     INIT      "D5"
CATU1     INIT      "U1"
CATU2     INIT      "U2"
CATU3     INIT      "U3"
CATU4     INIT      "U4"
CATU5     INIT      "U5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATU8     INIT      "U8"
CATU9     INIT      "U9"
CATV1     INIT      "V0"
CATV2     INIT      "V1"
DASH      INIT      " - "
FNAME     DIM       8
FNAME2    DIM       8
FILEEXTA  INIT      "patex1"
FILEEXTB  INIT      "patexb"
FILEEXTC  INIT      "patexc"
.
TEMPFILE  IFILE SQL, FIXED=39, KEY="U1-6,7-9,10-15,16-18,19-27,28-30"
TEMPFIL2  IFILE SQL, FIXED=39, KEY="U1-6,7-9,10-15,16-18,19-27,28-30"
.
. NAME    TYPE   LENGTH   PHYSICAL  START LOC    DESCRIPTION
. ----    ----   ------   --------  ---------    --------------
TEMPCNID  DIM       6       6          1         Contract ID
TEMPCLMN  DIM       3       3          7         Claim code
TEMPHFND  DIM       6       6          10        Health fund
TEMPTABT  DIM       3       3          16        Table Type
TEMPCASM  DIM       9       9          19        Casemix code
TEMPBRKD  DIM       3       3          28        * Breakdown Code
TEMPAMNT  FORM      12.2    8          31        * Breakdown Amount
.EOR                                   39
.
.----------------------------------------------------------------------
PRGID     INIT      "PATWEB63"
VERSION   INIT      "V12.00.04"
PRGNAM    INIT      "Casemix Maintenance Server"
.----------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      MATRIX00        * Casemix Matrix Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      SAMEDY00        * Sameday Fees Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      OVERNT00        * Overnight Fees Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      DOCSUM00        * Doctors Summary Report    
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      REMOTE00        * Remote Scripting Functions
          GOTO      MAIN1000
.
MAIN1600  CALL      CPTRIX00        * Contract procedure Matrix Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      MLPROC00        * Multiple Procedures Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      SELINL00        * output Non-accumulative inlier selection
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50,NXTPAG60:
                       NXTPAG70,NXTPAG80
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PREDIR00      * Redirect Parent
          GOTO      NXTPAG99
.
NXTPAG50  CALL      SETDIR00
          CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG60  CALL      OVRSET00        * redirect overnignt lumpsum 
          CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG70  CALL      SMDSET00        * redirect sameday lumpsum 
          CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG80  CALL      WINALR00        * WINCLS00 with alert
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Refresh Parent and Close Window
.------------------------------------------------------------
WINALR00  CALL      OPENHTML
          BRANCH    EXIT,WINALR99
          WRITE     HTMLFILE;"<script type=#"text/javascript#" ":
                             "src=#"../js/Standard.js#"></script>":
                             "<script type=#"text/javascript#" ":
                             "src=#"../js/Custom.js#"></script>":
                             "<script type=#"text/javascript#">  ":
                             " alert(#"",WEBTITLE,"#");":
                             " if (self.name.match(/PopUpFrame/)) {":
                             " reloadParentFrame();}":
                             " else { ":
                             "  opener.history.go(0);":
                             "  self.close(); }":
                             "</script>"
          CALL      CLOSHTML     * End of Document
.
WINALR99  RETURN
.
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  CALL      INTMAS00     * Open routine for PATMASTM 
          OPEN      PATVISA2,"patvisaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATASFA1,"patasfaf"
          OPEN      PATDSCH1,"patdschf"
.
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSCIDA1,"pmscidaf"
          OPEN      PMSCMTA1,"pmscmtaf"
          OPEN      PMSDCAA1,"pmsdcaaf"
          OPEN      PMSCMTA2,"pmscmtaf"
          OPEN      PMSCMTA3,"pmscmtaf"
          OPEN      PMSCMTA4,"pmscmtaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSMPRA1,"pmsmpraf"
          OPEN      PMSMPRA2,"pmsmpraf"
          OPEN      PMSMPRA4,"pmsmpraf"
          OPEN      PATASDA1,"patasdaf"
          OPEN      PATLSDA1,"patlsdaf"
          OPEN      PATLSDA2,"patlsdaf"
          OPEN      PATHLFA1,"pathlfaf"
          OPEN      PATHLFA2,"pathlfaf"
          OPEN      PATHDFA1,"pathdfaf"
          OPEN      PATLDFA1,"patldfaf"
          OPEN      PATAFEA1,"patafeaf"
          OPEN      PATOVBA1,"patovbaf"
          OPEN      PATIOVA1,"patiovaf"
          OPEN      PATSRBA1,"patsrbaf"
          OPEN      PMSSINA1,"pmssinaf"
          OPEN      PATCMXA2,"patcmxaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATCMCA1,"patcmcaf"
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATICDD1,"paticddf"
          OPEN      PATI10D1,"pati10df"
          OPEN      PATICDO1,"paticdof"
          OPEN      PATI10O1,"pati10of"
          OPEN      CONTROLF,"controlf"
.
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      NZPMCHA2,"nzpmchaf"
          OPEN      NZPMCHA3,"nzpmchaf"
          OPEN      NZPCMTA1,"nzpcmtaf"
          OPEN      NZPCMTA2,"nzpcmtaf"
          OPEN      NZPCMTA3,"nzpcmtaf"
          OPEN      NZPCM1A1,"nzpcm1af"
          OPEN      NZPCM1A2,"nzpcm1af"
          OPEN      NZPCFNA1,"nzpcfnaf"
          OPEN      MLTCFNA1,"mltcfnaf"
.
          READ      CONTROLF,EIGHTY8;*59,PTCNI10D
          READ      CONTROLF,TEN3;*144,COPRSIZ1,COPRSIZ2
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TWENTY;*193,PTCNDCLM
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          CALL      OPICO1 
.
          CALL      TFILENAM
          MOVE      TFILNAME,FNAME
          CALL      TFILENAM
          MOVE      TFILNAME,FNAME2
.
INIT9999  RETURN
.******************************************************************************
.*                             CRTM0000                                       *
.*                Open and create the temporary file                          *
.******************************************************************************
CRTM0000  CALL      DETM0000                 * delete temp file
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAME,CMDLINE
          APPEND    " 39 U1-6,7-9,10-15,16-18,19-27,28-30",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
          OPEN      TEMPFILE,FNAME
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAME2,CMDLINE
          APPEND    " 39 U1-6,7-9,10-15,16-18,19-27,28-30",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
          OPEN      TEMPFIL2,FNAME2
.
CRTM9999  RETURN
+
.----------------------------------------------------------------------------
. Delete temp file
.----------------------------------------------------------------------------
DETM0000  CLOSE     TEMPFILE                 * close temp file
          CLEAR     CMDLINE                  * clear command line
          PACK      CMDLINE,ISERASE,FNAME    * set command line for erase
          RESET     CMDLINE                  * reset FP
          EXECUTE   CMDLINE,TASKID           * delete the temp file
.
          CLOSE     TEMPFIL2                 * close temp file
          CLEAR     CMDLINE                  * clear command line
          PACK      CMDLINE,ISERASE,FNAME2   * set command line for erase
          RESET     CMDLINE                  * reset FP
          EXECUTE   CMDLINE,TASKID           * delete the temp file
.
DETM9999  RETURN
+
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      ZERO,UPDATEFL
          MOVE      SP70,BRKDCODE
          MOVE      ZERO,SHOWREVN
          MOVE      SP70,TEMPLATE
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          PACK      REDIREC1,SP70,SP70,SP70,SP70
          MOVE      SP70,STARTKEY
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,FILEFLAG
          MOVE      SP70,BRKDTYPE
          MOVE      SP70,FILETYPE
          MOVE      SP70,HEADERRC
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,VALDTYPE
          MOVE      SP70,VALDCODE
          MOVE      SP70,COPYFLAG
          MOVE      SP70,MENUFLAG
.
          MOVE      Z70,PTSRB001
          MOVE      ZERO,PTSRB002
.
          MOVE      Z70,CPCMT001
          MOVE      Z70,CPCMT002
          MOVE      Z70,CPCMT003
          MOVE      Z70,CPCMT004
          MOVE      Z70,CPCMT064
.
          MOVE      Z70,CPMPR001
          MOVE      Z70,CPMPR002
          MOVE      Z70,CPMPR003
          MOVE      Z70,CPMPR004
.
          MOVE      Z70,SAMED001
          MOVE      Z70,SAMED002
          MOVE      Z70,SAMED003
          MOVE      Z70,SAMED004
          MOVE      Z70,SAMED005
          MOVE      Z70,SAMED006
          MOVE      Z70,SAMED007
.
          MOVE      Z70,OVERN001
          MOVE      Z70,OVERN002
          MOVE      Z70,OVERN003
          MOVE      Z70,OVERN004
          MOVE      Z70,OVERN005
          MOVE      Z70,OVERN006
          MOVE      Z70,OVERN007
.
          MOVE      Z70,CPSAM001
          MOVE      Z70,CPSAM002
          MOVE      Z70,CPSAM003
          MOVE      Z70,CPSAM004
          MOVE      Z70,CPSAM005
          MOVE      Z70,CPSAM006
.
          MOVE      Z70,CPOVR001
          MOVE      Z70,CPOVR002
          MOVE      Z70,CPOVR003
          MOVE      Z70,CPOVR004
          MOVE      Z70,CPOVR005
          MOVE      Z70,CPOVR006
.
          MOVE      Z70,CNCMT001
          MOVE      Z70,CNCMT002
          MOVE      Z70,CNCMT003
          MOVE      Z70,CNCMT004
.
          CALL      CLRMTX00
          CALL      CLRCMT00
          CALL      CLRLSD00
          CALL      CLRASD00
          CALL      CLRHLF00
          CALL      CLRAFE00
          CALL      CLRHDF00
          CALL      CLRLDF00
          CALL      CLRMPR00
          MOVE      ZERO,NEWFLAG
          MOVE      ZERO,FILENUM
          MOVE      SP70,CPROCODE
          MOVE      SP70,PROCCLMC
          MOVE      SP70,PROCCNTR
          MOVE      SP70,PROCSURG
          MOVE      SP70,PROCADAT
          MOVE      SP70,PROCHOSP
          MOVE      SP70,PROCWARD
          MOVE      ZERO,LASTRULE
          MOVE      ZERO,CMNORULE
          MOVE      ZERO,BLANKHFD
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updatefl=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATEFL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brkdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRKDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showrevn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWREVN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.  
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF 
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirec1=",QRYNAME
          IF        @EQUAL
            ENDSET    REDIRECT
            APPEND    QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fileflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILEFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brkdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRKDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filetype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILETYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "headerrc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HEADERRC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "extractn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILENUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmcmt",QRYNAME
          IF        @EQUAL
            CALL      SVMTX000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmmpr",QRYNAME
          IF        @EQUAL
            CALL      SVMPR000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptlsd",QRYNAME
          IF        @EQUAL
            CALL      SVLSD000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptasd",QRYNAME
          IF        @EQUAL
            CALL      SVASD000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pthlf",QRYNAME
          IF        @EQUAL
            CALL      SVHLF000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptafe",QRYNAME
          IF        @EQUAL
            CALL      SVAFE000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pthdf",QRYNAME
          IF        @EQUAL
            CALL      SVHDF000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptldf",QRYNAME
          IF        @EQUAL
            CALL      SVLDF000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpcmt001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPCMT001
            PACK      CPCMT001,CPCMT001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpcmt002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPCMT002
            PACK      CPCMT002,CPCMT002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpcmt003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPCMT003
            PACK      CPCMT003,CPCMT003,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpcmt004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPCMT004
            PACK      CPCMT004,CPCMT004,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpcmt064=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPCMT064
            PACK      CPCMT064,CPCMT064,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpmpr001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPMPR001
            PACK      CPMPR001,CPMPR001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpmpr002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPMPR002
            PACK      CPMPR002,CPMPR002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpmpr003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPMPR003
            PACK      CPMPR003,CPMPR003,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpmpr004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPMPR004
            PACK      CPMPR004,CPMPR004,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "samed001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAMED001
            PACK      SAMED001,SAMED001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "samed002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAMED002
            PACK      SAMED002,SAMED002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "samed003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAMED003
            PACK      SAMED003,SAMED003,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "samed004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAMED004
            PACK      SAMED004,SAMED004,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "samed005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAMED005
            PACK      SAMED005,SAMED005,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "samed006=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAMED006
            PACK      SAMED006,SAMED006,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "samed007=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAMED007
            PACK      SAMED007,SAMED007,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "overn001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OVERN001
            PACK      OVERN001,OVERN001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "overn002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OVERN002
            PACK      OVERN002,OVERN002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "overn003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OVERN003
            PACK      OVERN003,OVERN003,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "overn004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OVERN004
            PACK      OVERN004,OVERN004,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "overn005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OVERN005
            PACK      OVERN005,OVERN005,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "overn006=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OVERN006
            PACK      OVERN006,OVERN006,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "overn007=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OVERN007
            PACK      OVERN007,OVERN007,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsam001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSAM001
            PACK      CPSAM001,CPSAM001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsam002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSAM002
            PACK      CPSAM002,CPSAM002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsam003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSAM003
            PACK      CPSAM003,CPSAM003,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsam004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSAM004
            PACK      CPSAM004,CPSAM004,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsam005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSAM005
            PACK      CPSAM005,CPSAM005,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsam006=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSAM006
            PACK      CPSAM006,CPSAM006,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpovr001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPOVR001
            PACK      CPOVR001,CPOVR001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpovr002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPOVR002
            PACK      CPOVR002,CPOVR002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpovr003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPOVR003
            PACK      CPOVR003,CPOVR003,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpovr004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPOVR004
            PACK      CPOVR004,CPOVR004,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpovr005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPOVR005
            PACK      CPOVR005,CPOVR005,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpovr006=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPOVR006
            PACK      CPOVR006,CPOVR006,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptsrb001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTSRB001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptsrb002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTSRB002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nzcmt",QRYNAME
          IF        @EQUAL
            CALL      SNCMT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cprocode=",QRYNAME
          IF        @EQUAL
            PACK      CPROCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procclmc=",QRYNAME
          IF        @EQUAL
            PACK      PROCCLMC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prochosp=",QRYNAME
          IF        @EQUAL
            PACK      PROCHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procward=",QRYNAME
          IF        @EQUAL
            PACK      PROCWARD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "proccntr=",QRYNAME
          IF        @EQUAL
            PACK      PROCCNTR,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procsurg=",QRYNAME
          IF        @EQUAL
            PACK      PROCSURG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procadat=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00            * Set CMON from MTHNAM3
            PACK      PROCADAT,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cncmt001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CNCMT001
            PACK      CNCMT001,CNCMT001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cncmt002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CNCMT002
            PACK      CNCMT002,CNCMT002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cncmt003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CNCMT003
            PACK      CNCMT003,CNCMT003,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cncmt004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CNCMT004
            PACK      CNCMT004,CNCMT004,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "copyflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,COPYFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "menuflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MENUFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastrule=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTRULE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cmnorule=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CMNORULE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "blankhfd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BLANKHFD
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.------------------------------------------------------------
.   Validate Functions - Remote Scripting
.   Required  -
.             - VALDTYPE : 1. Validate Extract File Number
.------------------------------------------------------------
REMOTE00  BRANCH    VALDTYPE,REMOTE10
          GOTO      REMOTE91
.
REMOTE10  CALL      VALEXT00        * Extract File Number
          GOTO      REMOTE99
.
REMOTE91  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTE99
.
REMOTE99  RETURN
.---------------------------------------------------------------
.   Return Laterality if found for a valid Cancer Code
.   Required  - STATNVAR - Variable Number
.---------------------------------------------------------------
VALEXT00  CALL      XMLHED00
          BRANCH    EXIT,VALEXT99
.
          COMPARE    "17",FILENUM
          GOTO       VALEXT90 IF NOT LESS
.
          CALL      ETAB0000               * get sector and position for dates
          READ      CONTROLF,SEC;*ETABPS,EDATE,EFDATE,ETDATE,EDOPERS
.
          CALL      ETOTPS00               * get sector and position for totals
          READ      CONTROLF,SEC;*ETABPS,EADMNS,ETPRIMOP,ETPRIMDS,EBDAYS:
                                  EDCASES,ENETAMT
.
          MATCH     SP8,EDATE
          GOTO      VALEXT90 IF EQUAL
.
          MATCH     "00000000",EDATE
          GOTO      VALEXT90 IF EQUAL
.
          PACK      FNAMEA,FILEEXTA,FILENUM
          REP       " 0",FNAMEA
          PACK      FNAMEB,FILEEXTB,FILENUM
          REP       " 0",FNAMEB
          PACK      FNAMEC,FILEEXTC,FILENUM
          REP       " 0",FNAMEC
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATEX1A1,FNAMEA
          TRAPCLR   IO
          BRANCH    OVRCD,VALEXT91
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATEXTB1,FNAMEB
          TRAPCLR   IO
          BRANCH    OVRCD,VALEXT92
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATEXTC1,FNAMEC
          TRAPCLR   IO
          BRANCH    OVRCD,VALEXT93
.
.  Output Dummy data for valid file
. 
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE,"|":
                             "</RETURN_VALUE>"
.
          GOTO      VALEXT98
.
VALEXT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Extraction file chosen: - ":
                             FILENUM,"</RETURN_VALUE>"
          GOTO      VALEXT98
.
VALEXT91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Extraction file ",FNAMEA," does not exist":
                             "</RETURN_VALUE>"
          GOTO      VALEXT98
.
VALEXT92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Extraction file ",FNAMEB," does not exist":
                             "</RETURN_VALUE>"
          GOTO      VALEXT98
.
VALEXT93  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Extraction file ",FNAMEC," does not exist":
                             "</RETURN_VALUE>"
          GOTO      VALEXT98
.
VALEXT98  CALL      XMLEND00
VALEXT99  RETURN
.------------------------------------------------------------------------------
. Casemix Matrix Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
MATRIX00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      MATRIX80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      MATRIX10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      MATRIX20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      MATRIX30 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Claim Code/HF Duplication
          GOTO      MATRIX50 IF EQUAL
.
          GOTO      MATRIX93
.
.   **********  ADD FORMACTION  **********
.
MATRIX10  CALL      CLPMSCMT
.
          MOVE      ZERO,PMCCCNTR
          MATCH     "1",HEADERRC
          IF        !@EQUAL
            PACK      KEY34,PMCMT001,PMCMT064,PMCMT002,PMCMT003,PMCMT063:
                            PMCMT004,Z70
            CALL      RSPMCMT1                 * Add into Current File
            CALL      RPPMCMT1
            ADD       ONE,PMCCCNTR
          ENDIF
.
          MOVE      PMCCCNTR,PMCMT005
.
          CALL      UPMATX00
          PACK      KEY34,PMCCCCOD,PMCCCONT,PMCCHFUN,PMCCHFTY,PMCCTYPE,PMCCCMCD:
                          PMCCCNTR,SP70
          CALL      RAPMCMT1
          IF        OVRCD=1
            CALL      WRPMCMT1
          ELSE
            MATCH     "1",HEADERRC
            GOTO      MATRIX92 IF EQUAL
          ENDIF
          CALL      CCMT0000               * Check Matrix header file
          GOTO      MATRIX98
.
.   **********  UPDATE FORMACTION  **********
.
MATRIX20  PACK      KEY34,PMCMT001,PMCMT064,PMCMT002,PMCMT003,PMCMT063,PMCMT004:
                          PMCMT005,SP70
          CALL      RDPMCMT1                 * Update into Current File
          BRANCH    OVRCD,MATRIX91
.
          CALL      UPMATX00
          CALL      UPPMCMT1
.
          MATCH     "     0",PMCMT005       * Updating the cutoffs
          GOTO      MATRIX98 IF NOT EQUAL
          CALL      RSPMCMT1
MATRIX22  CALL      RKPMCMT1
          BRANCH    OVRCD,MATRIX98
          CALL      UCUT0000
          BRANCH    EXIT,MATRIX98
          CALL      UPPMCMT1
          GOTO      MATRIX22
.
.   **********  DELETE FORMACTION  **********
.
MATRIX30  PACK      KEY34,PMCMT001,PMCMT064,PMCMT002,PMCMT003,PMCMT063,PMCMT004:
                          PMCMT005,SP70
          CALL      RDPMCMT1                * Locate target record
          BRANCH    OVRCD,MATRIX91
.
          BRANCH    LASTRULE,MATRIX31       * Last rule
.
          MOVE      KEY34,SAVKEY34          * save the key
          COMPARE   ZERO,PMCCCNTR           * is this the category record?
          GOTO      MATRIX32 IF NOT EQUAL
.
          CALL      RKPMCMT1                * read next sequential
          BRANCH    OVRCD,MATRIX32
.
          PACK      KEY22,PMCCCCOD,PMCCHFUN,PMCCHFTY,PMCCTYPE,PMCCCMCD,SP70
          MATCH     KEY22,KEY28             * same key? (child record)
          GOTO      MATRIX94 IF EQUAL
.
          CALL      RDPMCMT1                * reposition on target record
          GOTO      MATRIX32
.
.         if we are removing the Last rule, remove record counter=0
.
MATRIX31  MOVE      "     0",KEY6
          PACK      KEY34,PMCMT001,PMCMT064,PMCMT002,PMCMT003,PMCMT063,PMCMT004:
                          KEY6,SP70
          CALL      DEPMCMT1                * Delete from Current File
          CALL      ACMT0000                * Write delete audit
.
          MOVE      SAVKEY34,KEY34          * restore
.
MATRIX32  CALL      DEPMCMT1                * Delete from Current File
          CALL      ACMT0000                * Write delete audit
.
          CALL      CCMT0000                * Check Matrix header file
.
          GOTO      MATRIX98
.
MATRIX50  CALL      CHFD0000                * Schedule Contract ID duplication
          GOTO      MATRIX99
.
.   **********  DISPLAY FORMACTION  **********
.
MATRIX80  MOVE      ZERO,EXIT
          PACK      KEY34,PMCMT001,PMCMT064,PMCMT002,PMCMT003,PMCMT063:
                          PMCMT004,PMCMT005,SP70
          CALL      RDPMCMT1
          IF        OVRCD=1
            CALL      CLPMSCMT
          ENDIF
.
MATRIX82  CLEAR     WEBTITLE
          MOVE      "Casemix Funding Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,MATRIX99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      MATRIX99
.
MATRIX91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MATRIX99
.
MATRIX92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MATRIX99
.
MATRIX93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MATRIX99
.
MATRIX94  MOVE      "Cannot Delete, rules still exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MATRIX99
.
MATRIX98  MOVE      ZERO,EXIT
MATRIX99  RETURN
.
.--------------------------------------------------------------------------
.         Check Matrix Header file
.--------------------------------------------------------------------------
CCMT0000  MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      CCMT6000 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      CCMT9999 IF NOT EQUAL
.
CCMT1000  PACK      KEY18A,PMCMT001,PMCMT064,PMCMT002,PMCMT003,SP70
          PACK      KEY34,KEY18A,SP70
          CALL      RSPMCMT1
CCMT2000  CALL      RKPMCMT1
          BRANCH    OVRCD,CCMT4000
.
          PACK      KEY18,PMCCCCOD,PMCCCONT,PMCCHFUN,PMCCHFTY,SP70
          MATCH     KEY18,KEY18A
          GOTO      CCMT9999 IF EQUAL
.
CCMT4000  OPEN      PATCMTA1,"patcmtaf"
          PACK      KEY18,PMCMT001,PMCMT002,PMCMT003,PMCMT064,SP70
          CALL      DEPTCMT1
          GOTO      CCMT9999
.
CCMT6000  OPEN      PATCMTA1,"patcmtaf"
          PACK      KEY18,PMCMT001,PMCMT002,PMCMT003,PMCMT064,SP70
          CALL      RDPTCMT1
          IF        OVRCD=1
            UNPACK    KEY18,PTCMCCOD,PTCMHFUN,PTCMHFTY,PTCMCNTR
            MOVE      SP70,PTCMSPRE
            CALL      WRPTCMT1
          ENDIF
CCMT9999  RETURN
+
.--------------------------------------------------------------------------
.         Update cutoff screen details for the rest of records
.--------------------------------------------------------------------------
UCUT0000  MOVE      ZERO,EXIT
          MATCH     PMCCCCOD,PMCMT001
          GOTO      UCUT9000 IF NOT EQUAL
.
          MATCH     PMCCCONT,PMCMT064
          GOTO      UCUT9000 IF NOT EQUAL
.
          MATCH     PMCCHFUN,PMCMT002
          GOTO      UCUT9000 IF NOT EQUAL
.
          MATCH     PMCCHFTY,PMCMT003
          GOTO      UCUT9000 IF NOT EQUAL
.
          MATCH     PMCCCMCD,PMCMT004
          GOTO      UCUT9000 IF NOT EQUAL
.
          MOVE      PMCMT006,PMCCPODY
          MOVE      PMCMT007,PMCCNPDY
          MOVE      PMCMT065,PMCCMIND
          MOVE      PMCMT008,PMCCHBPT
          MOVE      PMCMT009,PMCCCCDY
          GOTO      UCUT9999
.
UCUT9000  MOVE      ONE,EXIT
UCUT9999  RETURN
.
.------------------------------------------------------------------------------
. Sameday Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
SAMEDY00  RESET     FILETYPE
          MATCH     "A",FILETYPE           * Additional table  
          IF        @EQUAL
            CALL      SDADD000
            GOTO      SAMEDY99
          ENDIF
.
          MATCH     "B",FILETYPE           * Breakdown table  
          IF        @EQUAL
            CALL      BRKD0000
            GOTO      SAMEDY99
          ENDIF
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      SAMEDY80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Lump sum
          GOTO      SAMEDY10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update lumpsum formaction
          GOTO      SAMEDY20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      SAMEDY30 IF EQUAL
.
          GOTO      SAMEDY93
.
.   **********  Add FORMACTION  **********
.
SAMEDY10  CALL      CLRPTLSD
.
          CALL      UPPTLS00
          PACK      KEY27,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RAPTLSD1
          IF        OVRCD=1
            CALL      WRPTLSD1
          ELSE
            GOTO      SAMEDY92
          ENDIF
          GOTO      SAMEDY32
.
.   **********  UPDATE FORMACTION  **********
.
SAMEDY20  PACK      KEY27,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          CALL      RDPTLSD1                 * Update into Current File
          BRANCH    OVRCD,SAMEDY91
.
          CALL      UPPTLS00
          CALL      UPPTLSD1
          GOTO      SAMEDY32
.
.   **********  DELETE FORMACTION  **********
.
SAMEDY30  CALL      CADT0000                 * Check additional charge
          BRANCH    EXIT,SAMEDY95
.
          PACK      KEY27,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          CALL      RDPTLSD1                 * Delete from Current File
          BRANCH    OVRCD,SAMEDY91
          CALL      DEPTLSD1
.
          CALL      ALSD0000                 * Write delete audit
.
          CALL      DEDCR000                 * Delete revenue breakdown
          CALL      DEDCI000                 * Delete invoice breakdown
          GOTO      SAMEDY98
.
SAMEDY32  CALL      SREV0000                * Check rev breakdown agains lumpsum
          BRANCH    EXIT,SAMEDY94
          GOTO      SAMEDY98
.
.   **********  DISPLAY FORMACTION  **********
.
SAMEDY80  MOVE      ZERO,EXIT
          CALL      CLRPTLSD
          CALL      CLRPTASD
.
          PACK      KEY27,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          CALL      RDPTLSD1
          IF        OVRCD=1
            CALL      CLRPTLSD
          ENDIF
          PACK      KEY30,PTASD010,PTASD001,PTASD002,PTASD003,PTASD004:
                          PTASD009,SP70
          CALL      RDPTASD1
          IF        OVRCD=1
            CALL      CLRPTASD
          ENDIF
          GOTO      SAMEDY82
.
SAMEDY82  CLEAR     WEBTITLE
          MOVE      "Sameday Fee Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SAMEDY99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      SAMEDY99
.
SAMEDY91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SAMEDY99
.
SAMEDY92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SAMEDY99
.
SAMEDY93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SAMEDY99
.
SAMEDY94  MOVE   "Warning: Total Revenue Breakdown must equal Lumpsum.",WEBTITLE
          MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          COMPARE   ZERO,F1
          IF        @EQUAL
            CALL      WINALR00
          ELSE
            CALL      WEBERR00
          ENDIF
          MOVE      ONE,EXIT
          GOTO      SAMEDY99
.
SAMEDY95  MOVE      "Additional Charges must be deleted.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SAMEDY99
.
SAMEDY98  MOVE      ZERO,EXIT
SAMEDY99  RETURN
.
.------------------------------------------------------------------------------
.         Check if there is any record in additional charge file
.------------------------------------------------------------------------------
CADT0000  PACK      KEY30,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          CALL      RSPTASD1
          CALL      RKPTASD1
          BRANCH    OVRCD,CADT9000
.
          MATCH     PTLSD012,PTADCNID
          GOTO      CADT9000 IF NOT EQUAL
.
          MATCH     PTLSD001,PTADCLMN
          GOTO      CADT9000 IF NOT EQUAL
.
          MATCH     PTLSD002,PTADHFND
          GOTO      CADT9000 IF NOT EQUAL
.
          MATCH     PTLSD003,PTADTABT
          GOTO      CADT9000 IF NOT EQUAL
.
          MATCH     PTLSD004,PTADCASM
          GOTO      CADT9000 IF NOT EQUAL
.
          MOVE      ONE,EXIT
          GOTO      CADT9999
.
CADT9000  MOVE      ZERO,EXIT
CADT9999  RETURN
+
.--------------------------------------------------------------------------
.*                             CHFD0000                                   *
.*   Schedule Casemix Matrix Contract ID Duplication from IBARSH10        *
.--------------------------------------------------------------------------
CHFD0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Casemix Matrix Contract ID Duplication",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      ONE,F2
.
          MOVE      TWENTY1,KEYSTARR[F2]     * Option
.
          ADD       ONE,F2
          MOVE      PMCMT001,KEYSTARR[F2]    * Claim Code
.
          MATCH     BLANK,PMCMT002
          IF        @EQUAL
            ADD       ONE,F2
            MOVE      SP70,KEYSTARR[F2]      * Health Fund
          ELSE
            ADD       ONE,F2
            MOVE      PMCMT002,KEYSTARR[F2]  * Health Fund
          ENDIF
.
          ADD       ONE,F2
          MOVE      PMCMT064,KEYSTARR[F2]  * Contract ID
.
          ADD       ONE,F2
          MOVE      CPCMT001,KEYSTARR[F2]  * Copy to Claim Code if not all
.
          MATCH     BLANK,PMCMT002
          IF        @EQUAL
            ADD       ONE,F2
            MOVE      SP70,KEYSTARR[F2]      * Health Fund
          ELSE
            MATCH     SP70,PMCMT002
            IF        !@EQUAL
              ADD       ONE,F2
              MOVE      CPCMT002,KEYSTARR[F2]  * Health Fund
            ENDIF
          ENDIF
.
          ADD       ONE,F2
          MOVE      CPCMT064,KEYSTARR[F2]  * Contract ID
.
          ADD       ONE,F2
          MOVE      "Y",KEYSTARR[F2]         * Yes Continue
          ADD       ONE,F2
          MOVE      SP70,KEYSTARR[F2]        * Enter to exit
          MOVE      F2,KEYSTCNT              * Key Strokes
.
          CALL      SCHPRO00   * Schedule Extract
.
CHFD9999  RETURN
+
.------------------------------------------------------------------------------
. Sameday Additional Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
SDADD000  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      SDADD080 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Additional charges
          GOTO      SDADD010 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Additional formaction
          GOTO      SDADD020 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      SDADD030 IF EQUAL
.
          GOTO      SDADD093 IF EQUAL
.
.   **********  Add FORMACTION  **********
.
SDADD010  CALL      CLRPTASD
.
          CALL      UPPTAS00
          PACK      KEY30,PTADCNID,PTADCLMN,PTADHFND,PTADTABT,PTADCASM:
                          PTADBTYP,SP70
          CALL      RAPTASD1
          IF        OVRCD=1
            CALL      WRPTASD1
          ELSE
            GOTO      SDADD092
          ENDIF
          GOTO      SDADD099
.
.   **********  UPDATE FORMACTION  **********
.
SDADD020  PACK      KEY30,PTASD010,PTASD001,PTASD002,PTASD003,PTASD004:
                          PTASD009,SP70
          CALL      RDPTASD1                 * Update into Current File
          BRANCH    OVRCD,SDADD091
.
          CALL      UPPTAS00
          CALL      UPPTASD1
          GOTO      SDADD098
.
.   **********  DELETE FORMACTION  **********
.
SDADD030  PACK      KEY30,PTASD010,PTASD001,PTASD002,PTASD003,PTASD004:
                          PTASD009,SP70
          CALL      RDPTASD1                 * Delete from File
          BRANCH    OVRCD,SDADD091
.
          CALL      DEPTASD1
.
          CALL      AASD0000                 * Write delete audit
.
          GOTO      SDADD098
.
.   **********  DISPLAY FORMACTION  **********
.
SDADD080  MOVE      ZERO,EXIT
.
          PACK      KEY30,PTASD010,PTASD001,PTASD002,PTASD003,PTASD004:
                          PTASD009,SP70
          CALL      RDPTASD1
          IF        OVRCD=1
            CALL      CLRPTASD
          ENDIF
          GOTO      SDADD082
.
SDADD082  CLEAR     WEBTITLE
          MOVE      "Sameday Additional Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SDADD099
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      SDADD099
.
SDADD091  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SDADD099
.
SDADD092  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SDADD099
.
SDADD093  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SDADD099
.
SDADD098  MOVE      ZERO,EXIT
SDADD099  RETURN
+
.------------------------------------------------------------------------------
. Overnight Maintenance: Display,Add,Update,Delete 
.------------------------------------------------------------------------------
OVERNT00  RESET     FILETYPE
          MATCH     "A",FILETYPE           * Additional table
          IF        @EQUAL
            CALL      OVADD000
            GOTO      OVERNT99
          ENDIF
.
          MATCH     "I",FILETYPE           * Inlier/high outlier table
          IF        @EQUAL
            CALL      OVINL000
            GOTO      OVERNT99
          ENDIF
.
          MATCH     "L",FILETYPE           * Low outlier table
          IF        @EQUAL
            CALL      OVLOW000
            GOTO      OVERNT99
          ENDIF
.
          MATCH     "B",FILETYPE           * Breakdown table
          IF        @EQUAL
            CALL      ORKD0000
            GOTO      OVERNT99
          ENDIF
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      OVERNT80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Lump sum
          GOTO      OVERNT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update lumpsum formaction
          GOTO      OVERNT20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      OVERNT30 IF EQUAL
.
          GOTO      OVERNT93
.
.   **********  Add FORMACTION  **********
.
OVERNT10  CALL      CLRPTHLF
.
          CALL      UPPTHL00
          PACK      KEY27,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RAPTHLF1
          IF        OVRCD=1
            CALL      WRPTHLF1
          ELSE
            GOTO      OVERNT92
          ENDIF
          GOTO      OVERNT32
.
.   **********  UPDATE FORMACTION  **********
.
OVERNT20  PACK      KEY27,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RDPTHLF1                 * Update into Current File
          BRANCH    OVRCD,OVERNT91
.
          CALL      UPPTHL00
          CALL      UPPTHLF1
          GOTO      OVERNT32
.
.   **********  DELETE FORMACTION  **********
.
OVERNT30  CALL      OADT0000                   * Check additional/Inlier/Outlier
          BRANCH    EXIT,OVERNT95
.
          PACK      KEY27,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RDPTHLF1                 * Delete from New File
          BRANCH    OVRCD,OVERNT91
          CALL      DEPTHLF1
.
          CALL      AHLF0000                 * Write delete audit
.
          CALL      DEOVR000                 * Delete revenue breakdown
          CALL      DEOVI000                 * Delete invoice breakdown
          GOTO      OVERNT98
.
OVERNT32  CALL      CREV0000                * Check rev breakdown agains lumpsum
          BRANCH    EXIT,OVERNT94
          GOTO      OVERNT98
.
.   **********  DISPLAY FORMACTION  **********
.
OVERNT80  MOVE      ZERO,EXIT
          CALL      CLRPTHLF
          CALL      CLRPTAFE
          CALL      CLRPTLDF
          CALL      CLRPTHDF
.
          PACK      KEY27,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RDPTHLF1
          IF        OVRCD=1
            CALL      CLRPTHLF
          ENDIF
          PACK      KEY34,PTAFE012,PTAFE001,PTAFE002,PTAFE003,PTAFE004:
                          PTAFE009,PTAFE010,SP70
          CALL      RDPTAFE1
          IF        OVRCD=1
            CALL      CLRPTAFE
          ENDIF
          PACK      KEY31,PTLDF010,PTLDF001,PTLDF002,PTLDF003,PTLDF004:
                          PTLDF009,SP70
          CALL      RDPTLDF1
          IF        OVRCD=1
            CALL      CLRPTLDF
          ENDIF
          PACK      KEY31,PTHDF011,PTHDF001,PTHDF002,PTHDF003,PTHDF004:
                          PTHDF009,SP70
          CALL      RDPTHDF1
          IF        OVRCD=1
            CALL      CLRPTHDF
          ENDIF
          GOTO      OVERNT82
.
OVERNT82  CLEAR     WEBTITLE
          MOVE      "Overnight Fee Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OVERNT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      OVERNT99
.
OVERNT91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVERNT99
.
OVERNT92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVERNT99
.
OVERNT93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVERNT99
.
OVERNT94  MOVE   "Warning: Total Revenue Breakdown must equal Lumpsum.",WEBTITLE
          MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          COMPARE   ZERO,F1
          IF        @EQUAL
            CALL      WINALR00
          ELSE
            CALL      WEBERR00
          ENDIF
          MOVE      ONE,EXIT
          GOTO      OVERNT99
.
OVERNT95  MOVE      "All Charges must be deleted.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVERNT99
.
OVERNT98  MOVE      ZERO,EXIT
OVERNT99  RETURN
.
.------------------------------------------------------------------------------
.         Check if there is any record in Additional/Inlier/Outlier
.------------------------------------------------------------------------------
OADT0000  MOVE      ZERO,F1
OADT1000  ADD       ONE,F1
          BRANCH    F1,OADT2000,OADT3000,OADT4000
          MOVE      ZERO,EXIT
          GOTO      OADT9999
.
.         Additional charges
.
OADT2000  PACK      KEY34,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RSPTAFE1
          CALL      RKPTAFE1
          BRANCH    OVRCD,OADT1000
          MOVE      PTFECNID,PTLDCNID
          MOVE      PTFECLMN,PTLDCLMN
          MOVE      PTFEHFND,PTLDHFND
          MOVE      PTFETABT,PTLDTABT
          MOVE      PTFECASM,PTLDCASM
          GOTO      OADT5000
.
.         Inlier charges
.
OADT3000  PACK      KEY31,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RSPTHDF1
          CALL      RKPTHDF1
          BRANCH    OVRCD,OADT1000
          MOVE      PTHDCNID,PTLDCNID
          MOVE      PTHDCLMN,PTLDCLMN
          MOVE      PTHDHFND,PTLDHFND
          MOVE      PTHDTABT,PTLDTABT
          MOVE      PTHDCASM,PTLDCASM
          GOTO      OADT5000
.
.         Low charges
.
OADT4000  PACK      KEY31,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RSPTLDF1
          CALL      RKPTLDF1
          BRANCH    OVRCD,OADT1000
.
OADT5000  MATCH     PTHLF013,PTLDCNID
          GOTO      OADT1000 IF NOT EQUAL
.
          MATCH     PTHLF001,PTLDCLMN
          GOTO      OADT1000 IF NOT EQUAL
.
          MATCH     PTHLF002,PTLDHFND
          GOTO      OADT1000 IF NOT EQUAL
.
          MATCH     PTHLF003,PTLDTABT
          GOTO      OADT1000 IF NOT EQUAL
.
          MATCH     PTHLF004,PTLDCASM
          GOTO      OADT1000 IF NOT EQUAL
          MOVE      ONE,EXIT
.
OADT9999  RETURN
.
.------------------------------------------------------------------------------
. Check Sameday lumpsum amount against total revenue
.------------------------------------------------------------------------------
SREV0000  MOVE      ZERO,EXIT
          MOVE      ZERO,TOTADDIT
          PACK      KEY30,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RSPTSRB1
SREV1000  CALL      RKPTSRB1
          BRANCH    OVRCD,SREV9000
.
          MATCH     PTSBCNID,PTLSCNID            * same Contract ID ?
          GOTO      SREV9000 IF NOT EQUAL
.
          MATCH     PTSBCODE,PTLSCLMN            * same claim code ?
          GOTO      SREV9000 IF NOT EQUAL
.
          MATCH     PTSBFUND,PTLSHFND            * same health fund ?
          GOTO      SREV9000 IF NOT EQUAL
.
          MATCH     PTSBTBLT,PTLSTABT            * same table type ?
          GOTO      SREV9000 IF NOT EQUAL
.
          MATCH     PTSBCSCD,PTLSCASM            * same casemix code ?
          GOTO      SREV9000 IF NOT EQUAL
.
          ADD       PTSBAMNT,TOTADDIT
          GOTO      SREV1000
.
SREV9000  COMPARE   ZERO,TOTADDIT
          GOTO      SREV9999 IF EQUAL
.
          SUB       PTLSLREB,TOTADDIT
          SUB       PTLSLPAT,TOTADDIT
          COMPARE   ZERO,TOTADDIT
          GOTO      SREV9999 IF EQUAL
          MOVE      ONE,EXIT                   * lumpsum <> total rev.breakdown
SREV9999  RETURN
+
.------------------------------------------------------------------------------
. Check Overnight lumpsum amount against total revenue
.------------------------------------------------------------------------------
CREV0000  MOVE      ZERO,EXIT
          MOVE      ZERO,TOTADDIT
          PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RSPTOVB1
CREV1000  CALL      RKPTOVB1
          BRANCH    OVRCD,CREV9000
.
          MATCH     PTHLCNID,PTOBCNID
          GOTO      CREV9000 IF NOT EQUAL
.
          MATCH     PTHLCLMN,PTOBCODE
          GOTO      CREV9000 IF NOT EQUAL
.
          MATCH     PTHLHFND,PTOBFUND
          GOTO      CREV9000 IF NOT EQUAL
.
          MATCH     PTHLTABT,PTOBTBLT
          GOTO      CREV9000 IF NOT EQUAL
.
          MATCH     PTHLCASM,PTOBCSCD
          GOTO      CREV9000 IF NOT EQUAL
.
          ADD       PTOBAMNT,TOTADDIT
          GOTO      CREV1000
.
CREV9000  COMPARE   ZERO,TOTADDIT
          GOTO      CREV9999 IF EQUAL
          SUB       PTHLLREB,TOTADDIT
          SUB       PTHLLPAT,TOTADDIT
          COMPARE   ZERO,TOTADDIT
          GOTO      CREV9999 IF EQUAL
          MOVE      ONE,EXIT               * lumpsum <> total revenue breakdown
CREV9999  RETURN
+
.------------------------------------------------------------------------------
. Dr Summary: Display
.------------------------------------------------------------------------------
DOCSUM00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      DOCSUM80 IF EQUAL
.
          GOTO      DOCSUM93
.
.   **********  DISPLAY FORMACTION  **********
.
DOCSUM80  CLEAR     WEBTITLE
          MOVE      "Doctors Summary Report",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,DOCSUM99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      DOCSUM99
.
DOCSUM93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DOCSUM99
.
DOCSUM99  RETURN
.------------------------------------------------------------------------------
. Overnight Additional Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
OVADD000  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      OVADD080 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Additional charges
          GOTO      OVADD010 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Additional formaction
          GOTO      OVADD020 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      OVADD030 IF EQUAL
.
          GOTO      OVADD093 IF EQUAL
.
.   **********  Add FORMACTION  **********
.
OVADD010  CALL      CLRPTAFE
.
          CALL      UPPTFE00
          PACK      KEY34,PTFECNID,PTFECLMN,PTFEHFND,PTFETABT,PTFECASM:
                          PTFEBTYP,PTFEEDAY,SP70
          CALL      RAPTAFE1
          IF        OVRCD=1
            CALL      WRPTAFE1
          ELSE
            GOTO      OVADD092
          ENDIF
          CALL      UPINLC00                 * Update Non-Accumulative Inlier
          GOTO      OVADD099
.
.   **********  UPDATE FORMACTION  **********
.
OVADD020  PACK      KEY34,PTAFE012,PTAFE001,PTAFE002,PTAFE003,PTAFE004:
                          PTAFE009,PTAFE010,SP70
          CALL      RDPTAFE1                 * Update into Current File
          BRANCH    OVRCD,OVADD091
.
          CALL      UPPTFE00
          CALL      UPPTAFE1
          CALL      UPINLC00                 * Update Non-Accumulative Inlier
          GOTO      OVADD098
.
.   **********  DELETE FORMACTION  **********
.
OVADD030  PACK      KEY34,PTAFE012,PTAFE001,PTAFE002,PTAFE003,PTAFE004:
                          PTAFE009,PTAFE010,SP70
          CALL      RDPTAFE1                 * Delete from File
          BRANCH    OVRCD,OVADD091
.
          CALL      DEPTAFE1
.
          CALL      AAFE0000                 * Write delete audit
.
          GOTO      OVADD098
.
.   **********  DISPLAY FORMACTION  **********
.
OVADD080  MOVE      ZERO,EXIT
.
          PACK      KEY34,PTAFE012,PTAFE001,PTAFE002,PTAFE003,PTAFE004:
                          PTAFE009,PTAFE010,SP70
          CALL      RDPTAFE1
          IF        OVRCD=1
            CALL      CLRPTAFE
          ENDIF
          GOTO      OVADD082
.
OVADD082  CLEAR     WEBTITLE
          MOVE      "Overnight Additional Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OVADD099
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      OVADD099
.
OVADD091  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVADD099
.
OVADD092  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVADD099
.
OVADD093  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVADD099
.
OVADD098  MOVE      ZERO,EXIT
OVADD099  RETURN
+
.------------------------------------------------------------------------------
. Update Non-Accumulative Inlier for the same Casemix/HF/bed type - Current file
.------------------------------------------------------------------------------
UPINLC00  MOVE      SP70,SKEY30
          UNPACK    KEY34,SKEY30
.
.         if this is the ICU/CCU bed type and we are updating ICU/CCU rules,
.         all other ICU/CCU bed type will also need to be updated
.
          UNPACK    SKEY30,KEY27,PTFEBTYP     * save the current bed type
          CALL      ICBT0000             * Check if ICU/CCU bed type
          COMPARE   ZERO,F1
          GOTO      UPINLC30 IF EQUAL    * Not ICU/CCU bed type
.
          MOVE      TWO,F1
          UNPACK    KEY34,SKEY27
          PACK      KEY34,SKEY27,SP70    * Position on Contract,Claim,HF
          CALL      RSPTAFE1
          GOTO      UPINLC40
.
UPINLC30  PACK      KEY34,SKEY30,SP70    * Position on Contract,Claim,HF,bedtype
          CALL      RSPTAFE1
UPINLC40  CALL      RKPTAFE1
          BRANCH    OVRCD,UPINLC99
.
          PACK      KEY30,PTFECNID,PTFECLMN,PTFEHFND,PTFETABT,PTFECASM:
                          PTFEBTYP,SP70
          PACK      KEY27,PTFECNID,PTFECLMN,PTFEHFND,PTFETABT,PTFECASM:
                          SP70
.
          COMPARE   TWO,F1
          GOTO      UPINLC70 IF NOT EQUAL
.
.         Update all ICU/CCU beds
.
          MATCH     KEY27,SKEY27
          GOTO      UPINLC99 IF NOT EQUAL
.
          PACK      KEY5,ANSB,ANST,PTFEBTYP    * check bed type
          CALL      RDCODE1
          BRANCH    OVRCD,UPINLC40
.
          MATCH     "1",TCINDC9
          GOTO      UPINLC80 IF EQUAL          * Intensive care
          MATCH     "3",TCINDC9
          GOTO      UPINLC80 IF EQUAL          * Critical Care
          GOTO      UPINLC40
.
UPINLC70  MATCH     KEY30,SKEY30
          GOTO      UPINLC99 IF NOT EQUAL
.
UPINLC80  MOVE      PTAFE011,PTFEACIN
          CALL      UPPTAFE1
          GOTO      UPINLC40
.
UPINLC99  RETURN
+
.------------------------------------------------------------------------------
. Overnight Inlier Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
OVINL000  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      OVINL080 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add charges
          GOTO      OVINL010 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update  formaction
          GOTO      OVINL020 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      OVINL030 IF EQUAL
.
          GOTO      OVINL093 IF EQUAL
.
.   **********  Add FORMACTION  **********
.
OVINL010  CALL      CLRPTHDF
.
          CALL      UPPTHD00
          PACK      KEY31,PTHDCNID,PTHDCLMN,PTHDHFND,PTHDTABT,PTHDCASM:
                          PTHDEDAY,PTHDDTYP,SP70
          CALL      RAPTHDF1
          IF        OVRCD=1
            CALL      WRPTHDF1
          ELSE
            GOTO      OVINL092
          ENDIF
          GOTO      OVINL099
.
.   **********  UPDATE FORMACTION  **********
.
OVINL020  PACK      KEY31,PTHDF011,PTHDF001,PTHDF002,PTHDF003,PTHDF004:
                          PTHDF009,PTHDF010,SP70
          CALL      RDPTHDF1                 * Update into Current File
          BRANCH    OVRCD,OVINL091
.
          CALL      UPPTHD00
          CALL      UPPTHDF1
          GOTO      OVINL098
.
.   **********  DELETE FORMACTION  **********
.
OVINL030  PACK      KEY31,PTHDF011,PTHDF001,PTHDF002,PTHDF003,PTHDF004:
                          PTHDF009,PTHDF010,SP70
          CALL      RDPTHDF1                 * Delete from File
          BRANCH    OVRCD,OVINL091
.
          CALL      DEPTHDF1
.
          CALL      AHDF0000                 * Write delete audit
.
          GOTO      OVINL098
.
.   **********  DISPLAY FORMACTION  **********
.
OVINL080  MOVE      ZERO,EXIT
.
          PACK      KEY31,PTHDF011,PTHDF001,PTHDF002,PTHDF003,PTHDF004:
                          PTHDF009,PTHDF010,SP70
          CALL      RDPTHDF1
          IF        OVRCD=1
            CALL      CLRPTHDF
          ENDIF
          GOTO      OVINL082
.
OVINL082  CLEAR     WEBTITLE
          MOVE      "Overnight Inlier/High Outlier Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OVINL099
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      OVINL099
.
OVINL091  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVINL099
.
OVINL092  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVINL099
.
OVINL093  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVINL099
.
OVINL098  MOVE      ZERO,EXIT
OVINL099  RETURN
+
.------------------------------------------------------------------------------
. Overnight Low outlier Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
OVLOW000  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      OVLOW080 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add charges
          GOTO      OVLOW010 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update  formaction
          GOTO      OVLOW020 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      OVLOW030 IF EQUAL
.
          GOTO      OVLOW093 IF EQUAL
.
.   **********  Add FORMACTION  **********
.
OVLOW010  CALL      CLRPTLDF
.
          CALL      UPPTLD00
          PACK      KEY31,PTLDCNID,PTLDCLMN,PTLDHFND,PTLDTABT,PTLDCASM:
                          PTLDEDAY,SP70
          CALL      RAPTLDF1
          IF        OVRCD=1
            CALL      WRPTLDF1
          ELSE
            GOTO      OVLOW092
          ENDIF
          GOTO      OVLOW099
.
.   **********  UPDATE FORMACTION  **********
.
OVLOW020  PACK      KEY31,PTLDF010,PTLDF001,PTLDF002,PTLDF003,PTLDF004:
                          PTLDF009,SP70
          CALL      RDPTLDF1                 * Update into Current File
          BRANCH    OVRCD,OVLOW091
.
          CALL      UPPTLD00
          CALL      UPPTLDF1
          GOTO      OVLOW098
.
.   **********  DELETE FORMACTION  **********
.
OVLOW030  PACK      KEY31,PTLDF010,PTLDF001,PTLDF002,PTLDF003,PTLDF004:
                          PTLDF009,SP70
          CALL      RDPTLDF1                 * Delete from File
          BRANCH    OVRCD,OVLOW091
.
          CALL      DEPTLDF1
.
          CALL      ALDF0000                 * Write delete audit
.
          GOTO      OVLOW098
.
.   **********  DISPLAY FORMACTION  **********
.
OVLOW080  MOVE      ZERO,EXIT
.
          PACK      KEY31,PTLDF010,PTLDF001,PTLDF002,PTLDF003,PTLDF004:
                          PTLDF009,SP70
          CALL      RDPTLDF1
          IF        OVRCD=1
            CALL      CLRPTLDF
          ENDIF
          GOTO      OVLOW082
.
OVLOW082  CLEAR     WEBTITLE
          MOVE      "Overnight Inlier/High Outlier Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OVLOW099
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      OVLOW099
.
OVLOW091  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVLOW099
.
OVLOW092  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVLOW099
.
OVLOW093  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVLOW099
.
OVLOW098  MOVE      ZERO,EXIT
OVLOW099  RETURN
+
.------------------------------------------------------------------------------
. Contract Procedure Matrix Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
CPTRIX00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      CPTRIX80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      CPTRIX10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      CPTRIX20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      CPTRIX30 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Create New File
          GOTO      CPTRIX40 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Health Fund Duplication
          GOTO      CPTRIX50 IF EQUAL
.
          MATCH     "E",UPDTTYPE            * Global Delete formaction
          GOTO      CPTRIX60 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Update New to Current file
          GOTO      CPTRIX70 IF EQUAL
.
          GOTO      CPTRIX93
.
.   **********  ADD FORMACTION  **********
.
CPTRIX10  CALL      CLRNZCMT                * clear variables
.
          MATCH     "N",FILEFLAG
          GOTO      CPTRIX16 IF EQUAL
.
          MOVE      ZERO,NZCMCCNT
          MATCH     "1",HEADERRC
          IF        !@EQUAL
            PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005,Z70
            CALL      RSNZCMT1                 * Add into Current File
            CALL      RPNZCMT1
          ENDIF
.
          MOVE      NZCMCCNT,NZCMT006
          CALL      UPCMTA00
.
          MATCH     "1",HEADERRC
          GOTO      CPTRIX12 IF EQUAL          * Header record
.
          ADD       ONE,NZCMCCNT
.
CPTRIX12  PACK      KEY26,NZCMCLMC,NZCMCNTR,NZCMRTYP,NZCMCPRC,NZCMITYP:
                          NZCMCCNT,SP70
          CALL      RANZCMT1
          COMPARE   ZERO,OVRCD
          GOTO      CPTRIX92 IF EQUAL          * already exists
.
          CALL      WRNZCMT1                   * write procedure header record
          MATCH     "1",HEADERRC
          IF        @EQUAL
. write second header record (patweb6306002 is only screen that writes this)
            MOVE      ONE,NZCMITYP
            PACK      KEY26,NZCMCLMC,NZCMCNTR,NZCMRTYP,NZCMCPRC,NZCMITYP:
                            NZCMCCNT,SP70
            CALL      RANZCMT1
            COMPARE   ZERO,OVRCD
            GOTO      CPTRIX92 IF EQUAL        * already exists
.
            CALL      WRNZCMT1                 * write misc item header record
            GOTO      CPTRIX98                 * Header record
          ENDIF
.
CPTRIX14  GOTO      CPTRIX98
.
CPTRIX16  MOVE      ZERO,NZCMCCNT
          MATCH     "1",HEADERRC
          IF        !@EQUAL
            PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005,Z70
            CALL      RSNZCM11                 * Add into New File
            CALL      RPNZCM11
            ADD       ONE,NZCMCCNT
          ENDIF
.
          MOVE      NZCMCCNT,NZCMT006
          CALL      UPCMTA00
.
          MATCH     "1",HEADERRC
          GOTO      CPTRIX17 IF EQUAL          * Header record
.
          ADD       ONE,NZCMCCNT
.
CPTRIX17  PACK      KEY26,NZCMCLMC,NZCMCNTR,NZCMRTYP,NZCMCPRC,NZCMITYP:
                          NZCMCCNT,SP70
          CALL      RANZCM11
          COMPARE   ZERO,OVRCD
          GOTO      CPTRIX92 IF EQUAL          * already exists
.
          CALL      WRNZCM11
          MATCH     "1",HEADERRC
          IF        @EQUAL
. write second header record (patweb6306002 is only screen that writes this)
            MOVE      ONE,NZCMITYP
            PACK      KEY26,NZCMCLMC,NZCMCNTR,NZCMRTYP,NZCMCPRC,NZCMITYP:
                            NZCMCCNT,SP70
            CALL      RANZCM11
            COMPARE   ZERO,OVRCD
            GOTO      CPTRIX92 IF EQUAL        * already exists
.
            CALL      WRNZCM11                 * write misc item header record
            GOTO      CPTRIX98                 * Header record
          ENDIF
.
CPTRIX18  GOTO      CPTRIX98
.
.   **********  UPDATE FORMACTION  **********
.
CPTRIX20  MATCH     "N",FILEFLAG
          GOTO      CPTRIX22 IF EQUAL
.
          PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005:
                          NZCMT006,SP70
          CALL      RDNZCMT1                 * Update into Current File
          BRANCH    OVRCD,CPTRIX91
.
          CALL      UPCMTA00
          CALL      UPNZCMT1
.
          MATCH     "1",HEADERRC
          IF        @EQUAL
            MOVE      ZERO,NZCMT005
            PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005:
                            NZCMT006,SP70
            CALL      RDNZCMT1                 * Update into Current File
            BRANCH    OVRCD,CPTRIX91
.
            CALL      UPCMTA00
            CALL      UPNZCMT1
          ENDIF
          GOTO      CPTRIX98
.
CPTRIX22  PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005:
                          NZCMT006,SP70
          CALL      RDNZCM11                 * Update into New File
          BRANCH    OVRCD,CPTRIX91
.
          CALL      UPCMTA00
          CALL      UPNZCM11
.
          MATCH     "1",HEADERRC
          IF        @EQUAL
            MOVE      ZERO,NZCMT005
            PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005:
                            NZCMT006,SP70
            CALL      RDNZCM11                 * Update into New File
            BRANCH    OVRCD,CPTRIX91
.
            CALL      UPCMTA00
            CALL      UPNZCM11
          ENDIF
          GOTO      CPTRIX98
.
.   **********  DELETE FORMACTION  **********
.
CPTRIX30  MATCH     "N",FILEFLAG
          GOTO      CPTRIX32 IF EQUAL
.
          PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005:
                          NZCMT006,SP70
          CALL      RDNZCMT1                 * Delete from Current File
          BRANCH    OVRCD,CPTRIX91
.
          CALL      DENZCMT1
          GOTO      CPTRIX98
.
CPTRIX32  PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005:
                          NZCMT006,SP70
          CALL      RDNZCM11                 * Delete from New File
          BRANCH    OVRCD,CPTRIX91
.
          CALL      DENZCM11
          GOTO      CPTRIX98
.
CPTRIX40  CALL      CTRX0000      * Schedule new file creation
          GOTO      CPTRIX99
.
CPTRIX50  CALL      UTRX0000      * Schedule health fund duplication
          GOTO      CPTRIX99
.
CPTRIX60  CALL      DTRX0000      * Schedule global deletion
          GOTO      CPTRIX99
.
CPTRIX70  CALL      PTRX0000      * Schedule Update New to Current
          GOTO      CPTRIX99
.
.   **********  DISPLAY FORMACTION  **********
.
CPTRIX80  MOVE      ZERO,EXIT
.
          MATCH     "N",FILEFLAG
          GOTO      CPTRIX81 IF EQUAL
.
          PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005:
                          NZCMT006,SP70
          CALL      RDNZCMT1
          IF        OVRCD=1
            CALL      CLRNZCMT                * clear variables
          ENDIF
          GOTO      CPTRIX82
.
CPTRIX81  PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005:
                          NZCMT006,SP70
          CALL      RDNZCM11
          IF        OVRCD=1
            CALL      CLRNZCMT                * clear variables
          ENDIF
.
CPTRIX82  CLEAR     WEBTITLE
          MOVE      "Contract Procedure Matrix Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CPTRIX99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      CPTRIX99
.
CPTRIX91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CPTRIX99
.
CPTRIX92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CPTRIX99
.
CPTRIX93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CPTRIX99
.
CPTRIX98  MOVE      ZERO,EXIT
CPTRIX99  RETURN
+
.---------------------------------------------------------------------------
. Clear Casemix Matrix Vars
.---------------------------------------------------------------------------
CLRCAS00  MOVE      SP70,PTCMCLMN    * Claim code
          MOVE      SP70,PTCMHFND    * Health Fund
          MOVE      SP70,PTCMCASM    * DRG/MBS Code
          MOVE      ZERO,PTCMXLOS    * Expected Length of Stay
          MOVE      ZERO,PTCMDIFG    * Detailed invoice flag
          MOVE      SP70,PTCMCNID    * Contract ID
          MOVE      SP70,PTCMSPAR    * Spare
.

CLRCAS99  RETURN
+
.--------------------------------------------------------------------------
.*                             CTRX0000                                   *
.*Schedule creation of new NZ Priv.Contract Proc.Matrix File from IBARSH17*
.--------------------------------------------------------------------------
CTRX0000  MOVE      "IBARSH17",SCHDPGID
          MOVE      "Create New Contract Procedure Matrix File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]          * Option 1 Create New File
          MOVE      ANSY,KEYSTARR[2]         * Yes to create new file
          MOVE      COPYFLAG,KEYSTARR[3]     * Start with a copy of current data
.         
          MATCH     ANSY,COPYFLAG
          IF        @EQUAL
            MOVE      SP70,KEYSTARR[4]       * Enter
            MOVE      FOUR,KEYSTCNT          * Number of Keyins
          ELSE
            MOVE      ANSY,KEYSTARR[4]       * Yes start with a empty file
            MOVE      SP70,KEYSTARR[5]       * Enter
            MOVE      FIVE,KEYSTCNT          * Number of Keyins
          ENDIF
.
          CALL      SCHPRO00                 * Schedule Extract
.
CTRX9999  RETURN
.
.--------------------------------------------------------------------------
.*                             UTRX0000                                   *
.*   Schedule Contract Proc.Matrix Duplication from IBARSH17              *
.--------------------------------------------------------------------------
UTRX0000  MOVE      "IBARSH17",SCHDPGID
          MOVE      "Contract Procedure Matrix Duplication",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      ONE,F2
          MOVE      TWO,KEYSTARR[F2]         * Option
.
          ADD       ONE,F2
          MOVE      NZCMT001,KEYSTARR[F2]    * Claim Code
.
          ADD       ONE,F2
          MOVE      NZCMT002,KEYSTARR[F2]  * Health Fund
.
          MATCH     BLANK,NZCMT004
          IF        @EQUAL
            ADD       ONE,F2
            MOVE      SP70,KEYSTARR[F2]      * Casemix Code
          ELSE
            ADD       ONE,F2
            MOVE      NZCMT004,KEYSTARR[F2]  * Casemix Code
            ADD       ONE,F2
            MOVE      NZCMT003,KEYSTARR[F2]    * Record Type
          ENDIF
.
          MATCH     SP70,NZCMT001
          IF        !@EQUAL
            ADD       ONE,F2
            MOVE      CNCMT001,KEYSTARR[F2]  * Copy to Claim Code if not all
          ENDIF
.
          MATCH     BLANK,NZCMT002
          IF        @EQUAL
            ADD       ONE,F2
            MOVE      CNCMT002,KEYSTARR[F2]  * Health Fund
          ELSE
            MATCH     SP70,NZCMT002
            IF        !@EQUAL
              ADD       ONE,F2
              MOVE      CNCMT002,KEYSTARR[F2]  * Health Fund
            ENDIF
          ENDIF
.
          MATCH     BLANK,NZCMT004
          IF        @EQUAL
            ADD       ONE,F2
            MOVE      SP70,KEYSTARR[F2]  * Contract Procedure Code
          ELSE
            MATCH     SP70,NZCMT004
            IF        !@EQUAL
              ADD       ONE,F2
              MOVE      CNCMT004,KEYSTARR[F2]  * Contract Procedure Code
            ENDIF
          ENDIF
.
          ADD       ONE,F2
          MOVE      "Y",KEYSTARR[F2]         * Yes Continue
          ADD       ONE,F2
          MOVE      SP70,KEYSTARR[F2]        * Enter to exit
          MOVE      F2,KEYSTCNT              * Key Strokes
.
          CALL      SCHPRO00   * Schedule Extract
.
UTRX9999  RETURN
+
.--------------------------------------------------------------------------
.*                             DTRX0000                                   *
.*  Schedule Global Deletion Contract Proc.Matrix (New file) from IBARSH17*
.--------------------------------------------------------------------------
DTRX0000  MOVE      "IBARSH17",SCHDPGID
          MOVE   "Global Deletion Contract Procedure Matrix (New file)",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      THREE,KEYSTARR[1]       * Option
          MOVE      NZCMT001,KEYSTARR[2]    * Claim Type
          MOVE      NZCMT002,KEYSTARR[3]  * Health Fund
.
          MATCH     SP70,NZCMT004
          IF        @EQUAL
            MOVE      NZCMT004,KEYSTARR[4]    * Casemix Code
            MOVE      "Y",KEYSTARR[5]         * Yes Delete
            MOVE      SP70,KEYSTARR[6]        * Yes Delete
            MOVE      SIX,KEYSTCNT
          ELSE
            MOVE      NZCMT004,KEYSTARR[4]    * Casemix Code
            MOVE      NZCMT003,KEYSTARR[5]    * Record Type
            MOVE      "Y",KEYSTARR[6]         * Yes Delete
            MOVE      SP70,KEYSTARR[7]        * Yes Delete
            MOVE      SEVEN,KEYSTCNT
          ENDIF
.
          GOTO      DTRX9000
.
DTRX9000  CALL      SCHPRO00   * Schedule Extract
.
DTRX9999  RETURN
+
.----------------------------------------------------------------------------
.*                             PTRX0000                                     *
.* Schedule Update of new to Current Contract Proc.Matrix File from IBARSH10*
.----------------------------------------------------------------------------
PTRX0000  MOVE      "IBARSH17",SCHDPGID
          MOVE      "Update New to Current Contract Proc.Matrix File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      FOUR,KEYSTARR[1]         * Option Four Update New to Current
          MOVE      ANSY,KEYSTARR[2]         * Yes to Update
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00                 * Schedule Extract
.
PTRX9999  RETURN
+
.------------------------------------------------------------------------------
.         Multiple Procedures Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
MLPROC00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      MLPROC80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      MLPROC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      MLPROC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      MLPROC30 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Health Fund Duplication
          GOTO      MLPROC50 IF EQUAL
.
          GOTO      MLPROC93
.
.   **********  ADD FORMACTION  **********
.
MLPROC10  CALL      CLRPMMPR
.
          MOVE      ZERO,PMMPCOUN
          MATCH     "1",HEADERRC
          IF        !@EQUAL
.
.           Check if item is already entered for the multiple procedure code
.
            PACK      SKEY35,PMMPR001,PMMPR002,PMMPR003,PMMPR008,PMMPR009:
                             PMMPR004,SP70
            PACK      KEY37,SKEY35,SP70
            CALL      RSPMMPR2                 * Add into Current File
            CALL      RKPMMPR2
            BRANCH    OVRCD,MLPROC12
            PACK      KEY35,PMMPCCOD,PMMPHFUN,PMMPHFTY,PMMPITMN,PMMPCNID:
                            PMMPMPRC,SP70
            MATCH     KEY35,SKEY35
            GOTO      MLPROC94 IF EQUAL
.
MLPROC12    PACK      KEY28,PMMPR009,PMMPR001,PMMPR002,PMMPR003,PMMPR004,Z70
            CALL      RSPMMPR1                 * Add into Current File
            CALL      RPPMMPR1
            ADD       ONE,PMMPCOUN
            MOVE      ZERO,PMMPPAMT
            MOVE      ZERO,PMMPRAMT
          ENDIF
.
          MOVE      PMMPCOUN,PMMPR005
.
          CALL      UPMPRC00
          PACK      KEY28,PMMPCNID,PMMPCCOD,PMMPHFUN,PMMPHFTY,PMMPMPRC:
                          PMMPCOUN,SP70
          CALL      RAPMMPR1
          IF        OVRCD=1
            CALL      WRPMMPR1
          ELSE
            MATCH     "1",HEADERRC
            GOTO      MLPROC92 IF EQUAL
          ENDIF
          GOTO      MLPROC98
.
.
.   **********  UPDATE FORMACTION  **********
.
MLPROC20  PACK      KEY28,PMMPR009,PMMPR001,PMMPR002,PMMPR003,PMMPR004:
                          PMMPR005,SP70
          CALL      RDPMMPR1                 * Update into Current File
          BRANCH    OVRCD,MLPROC91
.
          CALL      UPMPRC00
          CALL      UPPMMPR1
          GOTO      MLPROC98
.
.   **********  DELETE FORMACTION  **********
.
MLPROC30  PACK      KEY28,PMMPR009,PMMPR001,PMMPR002,PMMPR003,PMMPR004:
                          PMMPR005,SP70
          CALL      RDPMMPR1                 * Delete from Current File
          BRANCH    OVRCD,MLPROC91
.
          CALL      DEPMMPR1
.
.         Remove all the MBS items if we are removing header records
.
          MATCH     " 0",PMMPR005
          GOTO      MLPROC98 IF NOT EQUAL
.
          PACK      SKEY26,PMMPR009,PMMPR001,PMMPR002,PMMPR003,PMMPR004,SP70
MLPROC32  PACK      KEY28,PMMPR009,PMMPR001,PMMPR002,PMMPR003,PMMPR004,SP70
          CALL      RSPMMPR1                 * Delete from Current File
          CALL      RKPMMPR1
          BRANCH    OVRCD,MLPROC98
.
          PACK      KEY26,PMMPCNID,PMMPCCOD,PMMPHFUN,PMMPHFTY,PMMPMPRC,SP70
          MATCH     KEY26,SKEY26
          GOTO      MLPROC98 IF NOT EQUAL
.
          PACK      KEY28,PMMPCNID,PMMPCCOD,PMMPHFUN,PMMPHFTY,PMMPMPRC:
                          PMMPCOUN,SP70
          CALL      DEPMMPR1
          GOTO      MLPROC32
.
.
MLPROC50  CALL      MPDP0000                * Schedule health fund duplication
          GOTO      MLPROC99
.
.   **********  DISPLAY FORMACTION  **********
.
MLPROC80  MOVE      ZERO,EXIT
          PACK      KEY28,PMMPR009,PMMPR001,PMMPR002,PMMPR003,PMMPR004:
                          PMMPR005,SP70
          CALL      RDPMMPR1
          IF        OVRCD=1
            CALL      CLRPMMPR
          ENDIF
.
MLPROC82  CLEAR     WEBTITLE
          MOVE      "Multiple Procedures Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,MLPROC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      MLPROC99
.
MLPROC91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MLPROC99
.
MLPROC92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MLPROC99
.
MLPROC93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MLPROC99
.
MLPROC94  MOVE      "Item already exists in the Combination.",WEBTITLE
          CALL      WEBERR00 
          MOVE      ONE,EXIT
          GOTO      MLPROC99
.
MLPROC98  MOVE      ZERO,EXIT
MLPROC99  RETURN
+
.--------------------------------------------------------------------------
. Output Select Options for Non-Accumulative Inlier  depending on Bed type
.--------------------------------------------------------------------------
SELINL00  CALL      XMLHED00
          BRANCH    EXIT,SELINL99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
          PACK      KEY5,ANSB,ANST,VALDCODE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,SELINL80
.
          MOVE      "0",KEY1
          PACK      KEY45,ACODE,KEY40
          WRITE     HTMLFILE;KEY1,",No|";
.
          MOVE      "1",KEY1
          WRITE     HTMLFILE;KEY1,",Yes.Non-Accum.Inliers|";
.
          MATCH     "1",TCINDC9
          GOTO      SELINL10 IF EQUAL              * Intensive care
          MATCH     "3",TCINDC9
          GOTO      SELINL80 IF NOT EQUAL          * Critical Care
.
SELINL10  MOVE      "2",KEY1
          WRITE     HTMLFILE;KEY1,",No.ICU/CCU Rules|";
.
SELINL80  WRITE     HTMLFILE;"</RETURN_VALUE>"
          GOTO      SELINL98
.
SELINL98  CALL      XMLEND00
SELINL99  RETURN
+
.--------------------------------------------------------------------------
.*                             MPDP0000                                   *
.*   Schedule Multi.Proc.Code H/Fund Duplication from IBARSH10            *
.--------------------------------------------------------------------------
MPDP0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Multiple Procedures H/Fund Duplication",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      ONE,F2
.
          MOVE      TWENTY9,KEYSTARR[F2]     * Option
.
          ADD       ONE,F2
          MOVE      PMMPR001,KEYSTARR[F2]    * Claim Code
.
          MATCH     "All",PMMPR002
          GOTO      MPDP2000 IF EQUAL
.
          MATCH     SP70,PMMPR002
          GOTO      MPDP4000 IF NOT EQUAL
.
MPDP2000  ADD       ONE,F2
          MOVE      PMMPR002,KEYSTARR[F2]    * Health Fund
          GOTO      MPDP5000
.
MPDP4000  ADD       ONE,F2
          MOVE      PMMPR002,KEYSTARR[F2]    * Health Fund
          ADD       ONE,F2
          MOVE      PMMPR003,KEYSTARR[F2]    * Enter H/F table
.
MPDP5000  ADD       ONE,F2
          MOVE      PMMPR004,KEYSTARR[F2]  * Multi.Proc.Code
.
          MATCH     SP70,PMMPR001
          IF        !@EQUAL
            ADD       ONE,F2
            MOVE      CPMPR001,KEYSTARR[F2]  * Copy to Claim Code if not all
          ENDIF
.
          MATCH     "All",PMMPR002
          GOTO      MPDP6000 IF EQUAL
.
          MATCH     SP70,PMMPR002
          GOTO      MPDP7000 IF NOT EQUAL
.
MPDP6000  ADD       ONE,F2
          MOVE      CPMPR002,KEYSTARR[F2]  * Health Fund
          GOTO      MPDP8000
.
MPDP7000  ADD       ONE,F2
          MOVE      CPMPR002,KEYSTARR[F2]  * Health Fund
.
          MATCH     SP70,PMMPR003
          IF        !@EQUAL
            ADD       ONE,F2
            MOVE      CPMPR003,KEYSTARR[F2]  * Health Fund Table
          ENDIF
.
MPDP8000  ADD       ONE,F2
          MOVE      CPMPR004,KEYSTARR[F2]    * Multi.Procedures Code
.
          ADD       ONE,F2
          MOVE      "Y",KEYSTARR[F2]         * Yes Continue
          ADD       ONE,F2
          MOVE      SP70,KEYSTARR[F2]        * Enter to exit
          MOVE      F2,KEYSTCNT              * Key Strokes
.
          CALL      SCHPRO00   * Schedule Extract
.
MPDP9999  RETURN
+
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD99:
                             PROFLD60,PROFLD70
.
          GOTO      PROFLD99 
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12
          GOTO      PROFLD99
.
PROFLD11  CALL      CMTX0000    * Casemix matrix fields
          GOTO      PROFLD99
.
PROFLD12  CALL      CASM0000    * Casemix matrix table
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22,PROFLD23,PROFLD24,PROFLD25
          GOTO      PROFLD99
.
PROFLD21  CALL      CMTX0000    * Casemix matrix fields
          GOTO      PROFLD99
.
PROFLD22  CALL      CASM0000
          GOTO      PROFLD99
.
PROFLD23  CALL      PTLS0000     * Lumpsum sameday fields
          GOTO      PROFLD99
.
PROFLD24  CALL      SMDY0000     * Sameday lists
          GOTO      PROFLD99
.
PROFLD25  CALL      PTAS0000     * Sameday additional fields
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31,PROFLD32,PROFLD33,PROFLD34,PROFLD35:
                    PROFLD36,PROFLD37
          GOTO      PROFLD99
.
PROFLD31  CALL      CMTX0000    * Casemix matrix fields
          GOTO      PROFLD99
.
PROFLD32  CALL      CASM0000
          GOTO      PROFLD99
.
PROFLD33  CALL      PTHL0000     * Lumpsum sameday fields
          GOTO      PROFLD99
.
PROFLD34  CALL      OVNT0000     * Overnight lists
          GOTO      PROFLD99
.
PROFLD35  CALL      PTFE0000     * Overnight additional fields
          GOTO      PROFLD99
.
PROFLD36  CALL      PTHD0000     * Overnight inlier/high outlier fields
          GOTO      PROFLD99
.
PROFLD37  CALL      PTLD0000     * Overnight low outlier fields
          GOTO      PROFLD99
.
PROFLD40  CALL      DOCS0000     * Doctors Summary Report
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62
          GOTO      PROFLD99
.
PROFLD61  CALL      NZTX0000     * NZ Contract Procedure Matrix fields
          GOTO      PROFLD99
.
PROFLD62  CALL      NZMX0000     * NZ Contract Procedure matrix table
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71,PROFLD72
          GOTO      PROFLD99
.
PROFLD71  CALL      MPRC0000    * Multiple Procedures fields
          GOTO      PROFLD99
.
PROFLD72  CALL      MLPR0000    * Multiple Procedures table
          GOTO      PROFLD99
.
PROFLD99  RETURN
.------------------------------------------------------------
. NZ Contract Procedure Matrix table
.------------------------------------------------------------
NZMX0000  BRANCH    FLDITMNO,NZMX0100,NZMX0200,NZMX0300,NZMX0400,NZMX0500:
                             NZMX0600,NZMX0700,NZMX0800,NZMX0900,NZMX1000:
                             NZMX1100,NZMX1200,NZMX1300,NZMX1400
.
NZMX0100  CALL      NEXTNM00
          GOTO      NZMX9999
.
NZMX0200  CALL      PREVNM00
          GOTO      NZMX9999
.
NZMX0300  CALL      NZMTRX00                 * table
          GOTO      NZMX9999
.
NZMX0400  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      NZCMT001,CODE
          CALL      CODITM00
          GOTO      NZMX9999
.
NZMX0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     Z70,NZCMT002
          GOTO      NZMX9999 IF EQUAL
.
          BRANCH    F1,NZMX0510
          WRITE     HTMLFILE;NZCMT002;       * Health Fund
          GOTO      NZMX9999
.
NZMX0510  MATCH     SP70,NZCMT002
          GOTO      NZMX9999 IF EQUAL
.
          PACK      KEY14,NZCMT002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,NZMX9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      NZMX9999
.
NZMX0600  WRITE     HTMLFILE;NZCMT003;      * Record type
          GOTO      NZMX9999
.
NZMX0700  WRITE     HTMLFILE;NZCMT005;      * Item type
          GOTO      NZMX9999
.
NZMX0800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     Z70,NZCMT004
          GOTO      NZMX9999 IF EQUAL
.
          BRANCH    F1,NZMX0810
          WRITE     HTMLFILE;NZCMT004;      * Contract Procedure Code
          GOTO      NZMX9999
.
NZMX0810  MATCH     SP70,NZCMT004
          GOTO      NZMX9999 IF EQUAL
          PACK      KEY9,NZCMT004,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,NZMX9999
          WRITE     HTMLFILE;PTCADES1;      * Casemix Code Desc
          GOTO      NZMX9999
.
NZMX0900  WRITE     HTMLFILE;FILEFLAG;
          GOTO      NZMX9999
.
NZMX1000  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"New File";
          ELSE
            WRITE     HTMLFILE;"Current File";
          ENDIF
          GOTO      NZMX9999
.
NZMX1100  WRITE     HTMLFILE;NZCMT006;      * Contract Procedure Code
          GOTO      NZMX9999
.
NZMX1200  CALL      TABITM00               * Table of procedures/misc.item
          GOTO      NZMX9999
.
NZMX1300  CALL      TABCON00               * Table of contract codes available
          GOTO      NZMX9999
.
NZMX1400  CALL      CNTITM00               * misc item count for contract proc
          GOTO      NZMX9999
.
NZMX9999  RETURN
+
.------------------------------------------------------------
. Count number of misc items stored against the contract procedure
.------------------------------------------------------------
CNTITM00  MATCH     "N",FILEFLAG            
          GOTO      CNTITM30 IF EQUAL
.
          PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005,SP70
          CALL      RSNZCMT1
CNTITM05  CALL      RKNZCMT1
          BRANCH    OVRCD,CNTITM15
.
          MATCH     NZCMT001,NZCMCLMC
          GOTO      CNTITM15 IF NOT EQUAL
.
          MATCH     NZCMT002,NZCMCNTR
          GOTO      CNTITM15 IF NOT EQUAL
.
          MATCH     NZCMT003,NZCMRTYP
          GOTO      CNTITM15 IF NOT EQUAL
.
          MATCH     NZCMT004,NZCMCPRC
          GOTO      CNTITM15 IF NOT EQUAL
.
          MATCH     NZCMT005,NZCMITYP
          GOTO      CNTITM15 IF NOT EQUAL
.
          COMPARE   ZERO,NZCMCCNT
          GOTO      CNTITM05 IF EQUAL
.
CNTITM10  WRITE     HTMLFILE;ONE;           * items currently stored
          GOTO      CNTITM20
.
CNTITM15  WRITE     HTMLFILE;ZERO;          * no items currently stored
CNTITM20  PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005:
                          NZCMT006,SP70
          CALL      RDNZCMT1      
          GOTO      CNTITM99
. --------
. New file
. --------
CNTITM30  PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005,SP70
          CALL      RSNZCM11
CNTITM35  CALL      RKNZCM11
          BRANCH    OVRCD,CNTITM45
.
          MATCH     NZCMT001,NZCMCLMC
          GOTO      CNTITM45 IF NOT EQUAL
.
          MATCH     NZCMT002,NZCMCNTR
          GOTO      CNTITM45 IF NOT EQUAL
.
          MATCH     NZCMT003,NZCMRTYP
          GOTO      CNTITM45 IF NOT EQUAL
.
          MATCH     NZCMT004,NZCMCPRC       
          GOTO      CNTITM45 IF NOT EQUAL
.
          MATCH     NZCMT005,NZCMITYP
          GOTO      CNTITM45 IF NOT EQUAL
.
          COMPARE   ZERO,NZCMCCNT
          GOTO      CNTITM35 IF EQUAL
.
CNTITM40  WRITE     HTMLFILE;ONE;           * items currently stored
          GOTO      CNTITM50
.
CNTITM45  WRITE     HTMLFILE;ZERO;          * no items currently stored
CNTITM50  PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005:
                          NZCMT006,SP70
          CALL      RDNZCM11
.
CNTITM99  RETURN
+
.------------------------------------------------------------
. Header of Procedures/Misc.items for Contract Procedure Matrix 
.------------------------------------------------------------
HDRITM00  PACK      KEY80,SP70,SP70
          MOVE      "List of Valid Procedures",KEY80
          MATCH     "1",NZCMITYP           * Misc.item ?
          GOTO      HDRITM60 IF NOT EQUAL
.
          CLEAR     KEY80
          BRANCH    NZCMFTYP,HDRITM40      * Excluded items
.
          APPEND    "List of Misc.Items that are Included in Contract",KEY80
          APPEND    " (Items NOT to be Charged)",KEY80
          APPEND    SP70,KEY80
          RESET     KEY80
          GOTO      HDRITM60
.
HDRITM40  APPEND    "List of Misc.Items that are Excluded from Contract",KEY80
          APPEND    " (Items to be Charged)",KEY80
          APPEND    SP70,KEY80
          RESET     KEY80
.
HDRITM60  MATCH     "1",NZCMITYP           * Misc.item ?
          IF        @EQUAL
            WRITE     HTMLFILE;"<tr bgcolor=#99FFFF>":
                             "<td colspan=3 class=HeadingCell align=center>":
                             KEY80,"</td>":
                             "</tr>":
                             "<tr>"
            WRITE     HTMLFILE;"<td class=HeadingCell>":
                               "Misc.Item</td>":
                               "<td class=HeadingCell>":
                               "Item Group</td>";
          ELSE
            WRITE     HTMLFILE;"<tr bgcolor=#99FFFF>":
                             "<td colspan=2 class=HeadingCell align=center>":
                             KEY80,"</td>":
                             "</tr>":
                             "<tr>"
            WRITE     HTMLFILE;"<td class=HeadingCell>":
                               "Procedure Code</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Description</td>":
                             "</tr>"
HDRITM99  RETURN
+
.------------------------------------------------------------
. Table of Procedures/Misc.items for Contract Procedure Matrix 
.------------------------------------------------------------
TABITM00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          CALL      HDRITM00               * Table of procedures/misc.item
          MATCH     SP70,NZCMT001
          GOTO      TABITM99 IF EQUAL
.
          MATCH     "N",FILEFLAG
          GOTO      TABITM10 IF EQUAL
.
          PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005,SP70
          CALL      RSNZCMT1
TABITM05  CALL      RKNZCMT1
          BRANCH    OVRCD,TABITM99
          GOTO      TABITM20
.
TABITM10  PACK      KEY26,NZCMT001,NZCMT002,NZCMT003,NZCMT004,NZCMT005,SP70
          CALL      RSNZCM11
TABITM15  CALL      RKNZCM11
          BRANCH    OVRCD,TABITM99
.
TABITM20  MATCH     NZCMT001,NZCMCLMC
          GOTO      TABITM99 IF NOT EQUAL
.
          COMPARE   ZERO,NZCMCCNT
          IF        @EQUAL
            MATCH     "N",FILEFLAG
            GOTO      TABITM15 IF EQUAL
            GOTO      TABITM05
          ENDIF
.
          MATCH     NZCMT002,NZCMCNTR
          GOTO      TABITM99 IF NOT EQUAL
.
          MATCH     NZCMT003,NZCMRTYP
          GOTO      TABITM99 IF NOT EQUAL
.
          MATCH     NZCMT004,NZCMCPRC
          GOTO      TABITM99 IF NOT EQUAL
.
          MATCH     NZCMT005,NZCMITYP
          GOTO      TABITM99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            MATCH     "N",FILEFLAG
            GOTO      TABITM15 IF EQUAL
            GOTO      TABITM05
          ENDIF
.
          CALL      ITMLST00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            MATCH     "N",FILEFLAG
            GOTO      TABITM15 IF EQUAL
            GOTO      TABITM05
          ENDIF
.
TABITM99  RETURN
.------------------------------------------------------------
. List of Procedures/Misc.Items
.------------------------------------------------------------
ITMLST00  MOVE      SP70,IDESC
          PACK      KEY9,NZCMPROC
.
          MATCH     "1",NZCMITYP
          GOTO      ITMLST60 IF NOT EQUAL
.
          MATCH     SP70,NZCMMIGP
          IF        !@EQUAL
            PACK      KEY5,ANSF,ANSI,NZCMMIGP,SP70
            CALL      RDCODE1
            IF        OVRCD<>1
              MOVE      TDESC,IDESC         * use item group description
            ENDIF
            GOTO      ITMLST90
          ENDIF
.
          PACK      GDESC,SP70
          CALL      GMSC0000                * Get single Misc.item description
          IF        EXIT=1
            MOVE      "** ",GDESC
            MOVE      "** DEFAULT NOT SET UP FOR THIS ITEM **",IDESC
          ENDIF
          MATCH     SP70,GDESC
          IF        @EQUAL
            MOVE      "No group ",GDESC
          ENDIF
          GOTO      ITMLST80
.
ITMLST60  PACK      KEY17,KEY9,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,ITMLST99
.
          WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF=#"javascript:UpdateContMatrix":
                             "('",NZCMCLMC,"',":
                             "'",NZCMCNTR,"',":
                             "'",NZCMRTYP,"',":
                             "'",NZCMCPRC,"',":
                             "'",NZCMITYP,"',":
                             "'",FILEFLAG,"',":
                             "'",NZCMCCNT,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             NZCMPROC,"</td>":
                             "<td>",IDESC,"</td>":
                             "</tr>"
          GOTO      ITMLST99
.
ITMLST80  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF=#"javascript:UpdateContMatrix":
                             "('",NZCMCLMC,"',":
                             "'",NZCMCNTR,"',":
                             "'",NZCMRTYP,"',":
                             "'",NZCMCPRC,"',":
                             "'",NZCMITYP,"',":
                             "'",FILEFLAG,"',":
                             "'",NZCMCCNT,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             NZCMPROC,"</td>":
                             "<td>",GDESC,"</td>":
                             "<td>",IDESC,"</td>":
                             "</tr>"
          GOTO      ITMLST99
.
ITMLST90  WRITE     HTMLFILE;"<tr><td>&nbsp;</td><td nowrap>":
                             "<A HREF=#"javascript:UpdateItemGroup":
                             "('",NZCMCLMC,"',":
                             "'",NZCMCNTR,"',":
                             "'",NZCMRTYP,"',":
                             "'",NZCMCPRC,"',":
                             "'",NZCMITYP,"',":
                             "'",FILEFLAG,"',":
                             "'",NZCMCCNT,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             NZCMMIGP,"</td>":
                             "<td>",IDESC,"</td>":
                             "</tr>"
.
ITMLST99  RETURN
+
.------------------------------------------------------------
. Doctor Summary Report
.------------------------------------------------------------
DOCS0000  BRANCH    FLDITMNO,DOCS0100,DOCS0200,DOCS0300
.
DOCS0100  WRITE     HTMLFILE;COPRSIZ1;    * Operations less than $X1
          GOTO      DOCS9999
.
DOCS0200  WRITE     HTMLFILE;COPRSIZ2;    * Operations between $X1 and < $X2
          GOTO      DOCS9999
.
DOCS0300  CALL      EXTFIL00              * Table of Extract Files 
          GOTO      DOCS9999
.
DOCS9999  RETURN
.------------------------------------------------------------
. Casemix Matrix Details
.------------------------------------------------------------
CASM0000  BRANCH    FLDITMNO,CASM0100,CASM0200,CASM0300,CASM0400,CASM0500:
                             CASM0600,CASM0700,CASM0800,CASM0900,CASM1000:
                             CASM1100,CASM1200,CASM1300,CASM1400
.
CASM0100  CALL      NEXTMT00
          GOTO      CASM9999
.
CASM0200  CALL      PREVMT00
          GOTO      CASM9999
.
CASM0300  CALL      CASMTX00
          GOTO      CASM9999
.
CASM0400  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      PMCMT001,CODE
          CALL      CODITM00
          GOTO      CASM9999
.
CASM0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     Z70,PMCMT002
          GOTO      CASM9999 IF EQUAL
.
          BRANCH    F1,CASM0510
          WRITE     HTMLFILE;PMCMT002;       * Health Fund
          GOTO      CASM9999
.
CASM0510  MATCH     SP70,PMCMT002
          GOTO      CASM9999 IF EQUAL
          PACK      KEY14,PMCMT002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,CASM9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      CASM9999
.
CASM0600  MOVE      "HT",CATEGORY            * Table Type
          MOVE      PMCMT003,CODE
          CALL      CODITM00
          GOTO      CASM9999
.
CASM0700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     Z70,PMCMT004
          GOTO      CASM9999 IF EQUAL
.
          BRANCH    F1,CASM0710
          WRITE     HTMLFILE;PMCMT004;      * Casemix Code
          GOTO      CASM9999
.
CASM0710  MATCH     SP70,PMCMT004
          GOTO      CASM9999 IF EQUAL
          PACK      KEY9,PMCMT004,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,CASM9999
          WRITE     HTMLFILE;PTCADES1;      * Casemix Code Desc
          GOTO      CASM9999
.
CASM0800  WRITE     HTMLFILE;FILEFLAG;
          GOTO      CASM9999
.
CASM0900  MATCH     Z70,PMCMT063
          GOTO      CASM9999 IF EQUAL
.
          WRITE     HTMLFILE;PMCMT063;
          GOTO      CASM9999
.
CASM1000  CALL      TABRUL00               * Table of rules
          GOTO      CASM9999
.
CASM1100  UNPACK    DIM127,D1,KEY1,DIM127        * Contract ID
          MOVE      KEY1,F1
.
          MATCH     Z70,PMCMT064
          GOTO      CASM9999 IF EQUAL
.
          BRANCH    F1,CASM1110
.
          WRITE     HTMLFILE;PMCMT064;
          GOTO      CASM9999
.
CASM1110  PACK      KEY6,PMCMT064,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,CASM9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      CASM9999
.
CASM1200  CALL      CRUL0000         * Check if this is the only last rule
          WRITE     HTMLFILE;LASTRULE;
          GOTO      CASM9999
.
CASM1300  WRITE     HTMLFILE;CMNORULE;   * Show casemix code with no rule
          GOTO      CASM9999
.
CASM1400  WRITE     HTMLFILE;BLANKHFD;   * Show Blank Health Fund
          GOTO      CASM9999
.
CASM9999  RETURN
+
.------------------------------------------------------------
. Check if this is the only last rule
.------------------------------------------------------------
CRUL0000  MOVE      ZERO,LASTRULE
          PACK      SAVKEY34,PMCCCCOD,PMCCCONT,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                             PMCCCMCD,PMCCCNTR,SP70
          MOVE      ZERO,F1
          PACK      KEY34,PMCMT001,PMCMT064,PMCMT002,PMCMT003,PMCMT063,PMCMT004:
                          SP70
          CALL      RSPMCMT1
CRUL1000  CALL      RKPMCMT1
          BRANCH    OVRCD,CRUL8000
.
          PACK      KEY28,PMCCCCOD,PMCCCONT,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                          PMCCCMCD,SP70
          MATCH     KEY28,KEY34             * same key? (child record)
          GOTO      CRUL8000 IF NOT EQUAL
.
          MATCH     "     0",DPMCCCNT
          GOTO      CRUL1000 IF EQUAL      * header record
.
          ADD       ONE,F1
          BRANCH    F1,CRUL1000
.
CRUL8000  IF        F1=1
            MOVE      ONE,LASTRULE        * last rule
          ENDIF
          MOVE      SAVKEY34,KEY34
          CALL      RDPMCMT1
CRUL9999  RETURN
+
.------------------------------------------------------------
. Sameday Fee Details
.------------------------------------------------------------
SMDY0000  BRANCH    FLDITMNO,SMDY0100,SMDY0200,SMDY0300,SMDY0400,SMDY0500:
                             SMDY0600,SMDY0700,SMDY0800,SMDY0900,SMDY1000:
                             SMDY1100,SMDY1200,SMDY1300,SMDY1400,SMDY1500:
                             SMDY1600,SMDY1700,SMDY1800
.
SMDY0100  CALL      NEXTSD00
          GOTO      SMDY9999
.
SMDY0200  CALL      PREVSD00
          GOTO      SMDY9999
.
SMDY0300  CALL      SMDYTX00
          GOTO      SMDY9999
.
SMDY0400  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      PTLSD001,CODE
          CALL      CODITM00
          GOTO      SMDY9999
.
SMDY0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     Z70,PTLSD002
          GOTO      SMDY9999 IF EQUAL
.
          BRANCH    F1,SMDY0510
          WRITE     HTMLFILE;PTLSD002;       * Health Fund
          GOTO      SMDY9999
.
SMDY0510  MATCH     SP70,PTLSD002
          GOTO      SMDY9999 IF EQUAL
          PACK      KEY14,PTLSD002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,SMDY9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      SMDY9999
.
SMDY0600  MOVE      "HT",CATEGORY            * Table Type
          MOVE      PTLSD003,CODE
          CALL      CODITM00
          GOTO      SMDY9999
.
SMDY0700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     SP70,PTLSD004
          GOTO      SMDY9999 IF EQUAL
.
          MATCH     Z70,PTLSD004
          GOTO      SMDY9999 IF EQUAL
.
          BRANCH    F1,SMDY0710
          WRITE     HTMLFILE;PTLSD004;      * Casemix Code
          GOTO      SMDY9999
.
SMDY0710  MATCH     SP70,PTLSD004
          GOTO      SMDY9999 IF EQUAL
          PACK      KEY9,PTLSD004,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,SMDY9999
          WRITE     HTMLFILE;PTCADES1;      * Casemix Code Desc
          GOTO      SMDY9999
.
SMDY0800  WRITE     HTMLFILE;FILEFLAG;
          GOTO      SMDY9999
.
SMDY0900  CALL      SREVB000    * Modify Breakdown list
          GOTO      SMDY9999
.
SMDY1000  CALL      VREVB000    * View breakdown list
          GOTO      SMDY9999
.
SMDY1100  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"New File";
          ELSE
            WRITE     HTMLFILE;"Current File";
          ENDIF
          GOTO      SMDY9999
.
SMDY1200  WRITE     HTMLFILE;NEWFLAG;
          GOTO      SMDY9999
.
SMDY1300  CALL      SADD0000     * Additional sameday list
          GOTO      SMDY9999
.
SMDY1400  WRITE     HTMLFILE;BRKDTYPE; * Breakdown type - R=Revenue I=Invoice
          GOTO      SMDY9999
.
SMDY1500  MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            WRITE     HTMLFILE;"Revenue";
            GOTO      SMDY9999
          ENDIF
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            WRITE     HTMLFILE;"Invoice";
            GOTO      SMDY9999
          ENDIF
          GOTO      SMDY9999
.
SMDY1600  WRITE     HTMLFILE;SHOWREVN; * Show breakdown
          GOTO      SMDY9999
.
SMDY1700  WRITE     HTMLFILE;TOTALAMT; * Total breakdown amount
          GOTO      SMDY9999
.
SMDY1800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     Z70,PTLSD012
          GOTO      SMDY9999 IF EQUAL
.
          BRANCH    F1,SMDY1810
.
          WRITE     HTMLFILE;PTLSD012;      * Contract ID
          GOTO      SMDY9999
.
SMDY1810  PACK      KEY6,PTLSD012,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,SMDY9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      SMDY9999
.
SMDY9999  RETURN
.------------------------------------------------------------
. Table of Sameday additional charges
.------------------------------------------------------------
SADD0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          PACK      KEY30,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          CALL      RSPTASD1
SADD0010  CALL      RKPTASD1
          BRANCH    OVRCD,SADD9999
.
SADD0050  MATCH     PTLSD012,PTADCNID
          GOTO      SADD9999 IF NOT EQUAL
.
          MATCH     PTLSD001,PTADCLMN
          GOTO      SADD9999 IF NOT EQUAL
.
          MATCH     PTLSD002,PTADHFND
          GOTO      SADD9999 IF NOT EQUAL
.
          MATCH     PTLSD003,PTADTABT
          GOTO      SADD9999 IF NOT EQUAL
.
          MATCH     PTLSD004,PTADCASM
          GOTO      SADD9999 IF NOT EQUAL
.
          CALL      ADDROW00
.
          GOTO      SADD0010
.
SADD9999  RETURN
.
.------------------------------------------------------------
. Additional charges row
.------------------------------------------------------------
ADDROW00  MOVE      "FI",CATEGORY
          MOVE      PTADFIGR,CODE
          CALL      GETCOD00
          MOVE      TDESC,FIGRDESC
.
          MOVE      "BT",CATEGORY
          MOVE      PTADBTYP,CODE
          CALL      GETCOD00
.
          MOVE      ZERO,TOTADDIT
          MOVE      PTADDPAT,TOTADDIT
          ADD       PTADDREB,TOTADDIT
.
          WRITE     HTMLFILE;"<tr><td nowrap>";
.
          MATCH     "1",MENUFLAG
          GOTO      ADDROW10 IF EQUAL
.
          WRITE     HTMLFILE;"<A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptasd010=",PTADCNID:
                             "&ptasd001=",PTADCLMN:
                             "&ptasd002=",PTADHFND:
                             "&ptasd003=",PTADTABT:
                             "&ptasd004=",PTADCASM:
                             "&ptasd009=",PTADBTYP,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>";

ADDROW10  WRITE     HTMLFILE;TDESC,"</td>":
                             "<td>&nbsp;",PTADDES1,"</td>":
                             "<td>&nbsp;",PTADDPAT,"</td>":
                             "<td>&nbsp;",PTADDREB,"</td>":
                             "<td>&nbsp;",TOTADDIT,"</td>":
                             "<td>",FIGRDESC,"&nbsp;</td>":
                             "</tr>";
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"<tr>":
                               "<td>&nbsp;</td>":
                               "<td nowrap>&nbsp;",PTADDES2,"</td>":
                               "<td>&nbsp;</td>":
                               "<td>&nbsp;</td>":
                               "<td>&nbsp;</td>":
                               "<td>&nbsp;</td></tr>";
          ENDIF
.
ADDROW99  RETURN
.
.------------------------------------------------------------
. Table of Sameday breakdown charges
.------------------------------------------------------------
SREVB000  COMPARE   ONE,UPDATEFL
          IF        @EQUAL
            CALL      WRSBT000
          ENDIF
.
          MOVE      ZERO,TOTALAMT
.
          MATCH     ANSR,BRKDTYPE
          GOTO      SREVB100 IF NOT EQUAL
.
          PACK      KEY30,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          CALL      RSTEMP1
SREVB010  CALL      RKTEMP1
          BRANCH    OVRCD,SREVB100
.
SREVB050  MATCH     PTLSD012,TEMPCNID
          GOTO      SREVB100 IF NOT EQUAL
.
          MATCH     PTLSD001,TEMPCLMN
          GOTO      SREVB100 IF NOT EQUAL
.
          MATCH     PTLSD002,TEMPHFND
          GOTO      SREVB100 IF NOT EQUAL
.
          MATCH     PTLSD003,TEMPTABT
          GOTO      SREVB100 IF NOT EQUAL
.
          MATCH     PTLSD004,TEMPCASM
          GOTO      SREVB100 IF NOT EQUAL
.
          ADD       TEMPAMNT,TOTALAMT
          CALL      SRBROW00
          GOTO      SREVB010
.
SREVB100  MATCH     ANSI,BRKDTYPE
          GOTO      SREVB999 IF NOT EQUAL
.
          PACK      KEY30,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          CALL      RSTEMP2
SREVB110  CALL      RKTEMP2
          BRANCH    OVRCD,SREVB999
.
          MATCH     PTLSD012,TEMPCNID
          GOTO      SREVB999 IF NOT EQUAL
.
          MATCH     PTLSD001,TEMPCLMN
          GOTO      SREVB999 IF NOT EQUAL
.
          MATCH     PTLSD002,TEMPHFND
          GOTO      SREVB999 IF NOT EQUAL
.
          MATCH     PTLSD003,TEMPTABT
          GOTO      SREVB999 IF NOT EQUAL
.
          MATCH     PTLSD004,TEMPCASM
          GOTO      SREVB999 IF NOT EQUAL
.
          ADD       TEMPAMNT,TOTALAMT
          CALL      SIBROW00
.
          GOTO      SREVB110
.
SREVB999  RETURN
.
.------------------------------------------------------------
. Table of Sameday breakdown charges
.------------------------------------------------------------
VREVB000  MOVE      ZERO,FIRST
          MOVE      ZERO,FINISHR
          MOVE      ZERO,FINISHI
.
          PACK      KEY30,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          CALL      RSPTSRB1
VREVB010  CALL      RKPTSRB1
          BRANCH    OVRCD,VREVB090
.
VREVB050  MATCH     PTLSD012,PTSBCNID
          GOTO      VREVB090 IF NOT EQUAL
.
          MATCH     PTLSD001,PTSBCODE
          GOTO      VREVB090 IF NOT EQUAL
.
          MATCH     PTLSD002,PTSBFUND
          GOTO      VREVB090 IF NOT EQUAL
.
          MATCH     PTLSD003,PTSBTBLT
          GOTO      VREVB090 IF NOT EQUAL
.
          MATCH     PTLSD004,PTSBCSCD
          GOTO      VREVB090 IF NOT EQUAL
.
          CALL      VRBROW00
          GOTO      VREVB100
.
VREVB090  WRITE     HTMLFILE;"<tr><td>&nbsp</td>":
                             "<td>&nbsp;</td>"
          MOVE      ONE,FINISHR
.
VREVB100 IF        FIRST=0
            PACK      KEY30,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
            CALL      RSPMSIN1
            MOVE      ONE,FIRST
          ENDIF
.
VREVB110  CALL      RKPMSIN1
          BRANCH    OVRCD,VREVB190
.
VREVB150  MATCH     PTLSD012,PMSICNID
          GOTO      VREVB190 IF NOT EQUAL
.
          MATCH     PTLSD001,PMSICODE
          GOTO      VREVB190 IF NOT EQUAL
.
          MATCH     PTLSD002,PMSIFUND
          GOTO      VREVB190 IF NOT EQUAL
.
          MATCH     PTLSD003,PMSITBLT
          GOTO      VREVB190 IF NOT EQUAL
.
          MATCH     PTLSD004,PMSICSCD
          GOTO      VREVB190 IF NOT EQUAL
.
          CALL      VIBROW00
.
          GOTO      VREVB010
.
VREVB190  WRITE     HTMLFILE;"<td>&nbsp</td>":
                             "<td>&nbsp;</td></tr>"
          MOVE      ONE,FINISHI
.
          COMPARE   ONE,FINISHR
          GOTO      VREVB999 IF EQUAL
          GOTO      VREVB010
.
VREVB999  RETURN
.
.------------------------------------------------------------
. Sameday Revenue Breakdown row
.------------------------------------------------------------
VRBROW00  MOVE      "FI",CATEGORY
          MOVE      PTSBBRCD,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr><td>",TDESC,"</td>":
                             "<td>&nbsp;",PTSBAMNT,"</td>"
VRBROW99  RETURN
.
.------------------------------------------------------------
. Sameday Invoice Breakdown row
.------------------------------------------------------------
VIBROW00  MOVE      "FI",CATEGORY
          MOVE      PMSIBKCD,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<td>",TDESC,"</td>":
                             "<td>&nbsp;",PMSIAMNT,"</td>":
                             "</tr>";
VRIROW99  RETURN
.
.------------------------------------------------------------
. Sameday Revenue Breakdown row
.------------------------------------------------------------
SRBROW00  MOVE      "FI",CATEGORY
          MOVE      TEMPBRKD,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:DeleteInvoice":
                             "(#"",TEMPBRKD,"#")'>":
                             "<img src=../images/DeleteIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             TDESC,"</td>":
                             "<td>&nbsp;",TEMPAMNT,"</td>"
SRBROW99  RETURN
.
.------------------------------------------------------------
. Sameday Invoice Breakdown row
.------------------------------------------------------------
SIBROW00  MOVE      "FI",CATEGORY
          MOVE      TEMPBRKD,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:DeleteInvoice":
                             "(#"",TEMPBRKD,"#")'>":
                             "<img src=../images/DeleteIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             TDESC,"</td>":
                             "<td>&nbsp;",TEMPAMNT,"</td>":
                             "</tr>";
SRIROW99  RETURN
.
.------------------------------------------------------------
. Overnight Fee Details
.------------------------------------------------------------
OVNT0000  BRANCH    FLDITMNO,OVNT0100,OVNT0200,OVNT0300,OVNT0400,OVNT0500:
                             OVNT0600,OVNT0700,OVNT0800,OVNT0900,OVNT1000:
                             OVNT1100,OVNT1200,OVNT1300,OVNT1400,OVNT1500:
                             OVNT1600,OVNT1700,OVNT1800,OVNT1900,OVNT2000
          GOTO      OVNT9999
.
OVNT0100  CALL      NEXTOV00
          GOTO      OVNT9999
.
OVNT0200  CALL      PREVOV00
          GOTO      OVNT9999
.
OVNT0300  CALL      OVNTTX00
          GOTO      OVNT9999
.
OVNT0400  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      PTHLF001,CODE
          CALL      CODITM00
          GOTO      OVNT9999
.
OVNT0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     Z70,PTHLF002
          GOTO      OVNT9999 IF EQUAL
.
          BRANCH    F1,OVNT0510
          WRITE     HTMLFILE;PTHLF002;       * Health Fund
          GOTO      OVNT9999
.
OVNT0510  MATCH     SP70,PTHLF002
          GOTO      OVNT9999 IF EQUAL
          PACK      KEY14,PTHLF002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,OVNT9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      OVNT9999
.
OVNT0600  MOVE      "HT",CATEGORY            * Table Type
          MOVE      PTHLF003,CODE
          CALL      CODITM00
          GOTO      OVNT9999
.
OVNT0700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     SP70,PTHLF004
          GOTO      OVNT9999 IF EQUAL
.
          MATCH     Z70,PTHLF004
          GOTO      OVNT9999 IF EQUAL
.
          BRANCH    F1,OVNT0710
          WRITE     HTMLFILE;PTHLF004;      * Casemix Code
          GOTO      OVNT9999
.
OVNT0710  MATCH     SP70,PTHLF004
          GOTO      OVNT9999 IF EQUAL
          PACK      KEY9,PTHLF004,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,OVNT9999
          WRITE     HTMLFILE;PTCADES1;      * Casemix Code Desc
          GOTO      OVNT9999
.
OVNT0800  WRITE     HTMLFILE;FILEFLAG;
          GOTO      OVNT9999
.
OVNT0900  CALL      OREVB000    * Overnight Revenue/Invoice Breakdown list
          GOTO      OVNT9999
.
OVNT1000  CALL      OREVV000    * Overnight Revenue/Invoice Breakdown list
          GOTO      OVNT9999
.
OVNT1100  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"New File";
          ELSE
            WRITE     HTMLFILE;"Current File";
          ENDIF
          GOTO      OVNT9999
.
OVNT1200  WRITE     HTMLFILE;NEWFLAG;
          GOTO      OVNT9999
.
OVNT1300  CALL      OADD0000     * Additional overnight list
          GOTO      OVNT9999
.
OVNT1400  CALL      OINL0000     * inlier/high outlier list
          GOTO      OVNT9999
.
OVNT1500  CALL      OOTL0000     * low outlier list
          GOTO      OVNT9999
.
OVNT1600  WRITE     HTMLFILE;BRKDTYPE; * Breakdown type - R=Revenue I=Invoice
          GOTO      OVNT9999
.
OVNT1700  MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            WRITE     HTMLFILE;"Revenue";
            GOTO      OVNT9999
          ENDIF
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            WRITE     HTMLFILE;"Invoice";
            GOTO      OVNT9999
          ENDIF
          GOTO      OVNT9999
.
OVNT1800  WRITE     HTMLFILE;SHOWREVN; * Show breakdown
          GOTO      OVNT9999
.
OVNT1900  WRITE     HTMLFILE;TOTALAMT; * Total breakdown amount
          GOTO      OVNT9999
.
OVNT2000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     Z70,PTHLF013
          GOTO      OVNT9999 IF EQUAL
.
          BRANCH    F1,OVNT2010
.
          WRITE     HTMLFILE;PTHLF013;      * Contract ID
          GOTO      OVNT9999
.
OVNT2010  PACK      KEY6,PTHLF013,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,OVNT9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      OVNT9999
.
OVNT9999  RETURN
+
.--------------------------------------------------------------------------
.         Selection List for Contract ID
.--------------------------------------------------------------------------
CNID0000  MOVE      SP10,KEY6
          MOVE      ZERO,F1
          PACK      KEY24,SP70
          CALL      RSPTCMX2
CNID1000  CALL      RKPTCMX2
          BRANCH    OVRCD,CNID9999
.
          BRANCH    F1,CNID2000
          MOVE      PTCMCNID,KEY6
          MOVE      ONE,F1
          GOTO      CNID4000
.
CNID2000  MATCH     KEY6,PTCMCNID
          GOTO      CNID1000 IF EQUAL
          MOVE      PTCMCNID,KEY6
.
CNID4000  MATCH     KEY6,CONTRCID
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY6," selected>":
                               KEY6,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY6,">",KEY6,"</option>"
          ENDIF
          GOTO      CNID1000
.
CNID9999  RETURN
+
.------------------------------------------------------------
. Table of Overnight additional charges
.------------------------------------------------------------
OADD0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      SP70,SAVBTYPE
          MOVE      ONE,LSTRANGE
.
          PACK      KEY34,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004:
                          PTHLF009,SP70
          CALL      RSPTAFE1
OADD0010  CALL      RKPTAFE1
          BRANCH    OVRCD,OADD9999
.
OADD0050  MATCH     PTHLF013,PTFECNID
          GOTO      OADD9999 IF NOT EQUAL
.
          MATCH     PTHLF001,PTFECLMN
          GOTO      OADD9999 IF NOT EQUAL
.
          MATCH     PTHLF002,PTFEHFND
          GOTO      OADD9999 IF NOT EQUAL
.
          MATCH     PTHLF003,PTFETABT
          GOTO      OADD9999 IF NOT EQUAL
.
          MATCH     PTHLF004,PTFECASM
          GOTO      OADD9999 IF NOT EQUAL
.
          CALL      OADDRW00
.
          MOVE      PTFEBTYP,SAVBTYPE
          GOTO      OADD0010
.
OADD9999  RETURN
.
.------------------------------------------------------------
. Overnight Additional charges row
.------------------------------------------------------------
OADDRW00  MOVE      "FI",CATEGORY
          MOVE      PTFEFIGR,CODE
          CALL      GETCOD00
          MOVE      TDESC,FIGRDESC
.
          MOVE      "BT",CATEGORY
          MOVE      PTFEBTYP,CODE
          CALL      GETCOD00
.
          MATCH     SP70,SAVBTYPE
          IF        @EQUAL
            MOVE      "1",LSTRANGE
          ELSE
            MATCH     SAVBTYPE,PTFEBTYP
            IF        !@EQUAL
              MOVE      "1",LSTRANGE
            ENDIF
          ENDIF
.
          MOVE      SP70,DAYRANGE
          PACK      DAYRANGE,LSTRANGE,DASH,PTFEEDAY,SP70
          MOVE      ZERO,TOTADDIT
          MOVE      PTFEDREB,TOTADDIT
          ADD       PTFEDPAT,TOTADDIT
.
          MOVE      "No ",KEY21
          CMATCH    "1",PTFEACIN            * Non-Accumulative Inliers
          IF        @EQUAL
            MOVE      "Yes.Non-Accum.Inliers",KEY21
          ELSE
            MATCH     "2",PTFEACIN
            IF        @EQUAL
              MOVE      "No.ICU/CCU Rules",KEY21       * ICU/CCU rules
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap>";
.
          MATCH     "1",MENUFLAG
          GOTO      OADDRW10 IF EQUAL
.
          WRITE     HTMLFILE;"<A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptafe012=",PTFECNID:
                             "&ptafe001=",PTFECLMN:
                             "&ptafe002=",PTFEHFND:
                             "&ptafe003=",PTFETABT:
                             "&ptafe004=",PTFECASM:
                             "&ptafe009=",PTFEBTYP:
                             "&ptafe010=",PTFEEDAY,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>";
.
OADDRW10  WRITE    HTMLFILE;TDESC,"</td>":
                             "<td>&nbsp;",PTFEDES1,"</td>":
                             "<td>&nbsp;",DAYRANGE,"</td>":
                             "<td>&nbsp;",PTFEDREB,"</td>":
                             "<td>&nbsp;",PTFEDPAT,"</td>":
                             "<td>&nbsp;",TOTADDIT,"</td>":
                             "<td>&nbsp;",KEY21,"</td>":
                             "<td>",FIGRDESC,"&nbsp;</td>":
                             "</tr>";
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"<tr>":
                               "<td>&nbsp;</td>":
                               "<td nowrap>&nbsp;",PTFEDES2,"</td>":
                               "<td>&nbsp;</td>":
                               "<td>&nbsp;</td>":
                               "<td>&nbsp;</td>":
                               "<td>&nbsp;</td>":
                               "<td>&nbsp;</td>":
                               "<td>&nbsp;</td></tr>";
          ENDIF
.
          MOVE      PTFEEDAY,LSTRANGE
          ADD       ONE,LSTRANGE
.
OADDRW99  RETURN
+
.------------------------------------------------------------
. Table of Overnight inlier/high outlier charges
.------------------------------------------------------------
OINL0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      SP70,SAVCASEM
          MOVE      ONE,LSTRANGE
.
          PACK      KEY31,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RSPTHDF1
OINL0010  CALL      RKPTHDF1
          BRANCH    OVRCD,OINL9999
.
OINL0050  MATCH     PTHLF013,PTHDCNID
          GOTO      OINL9999 IF NOT EQUAL
.
          MATCH     PTHLF001,PTHDCLMN
          GOTO      OINL9999 IF NOT EQUAL
.
          MATCH     PTHLF002,PTHDHFND
          GOTO      OINL9999 IF NOT EQUAL
.
          MATCH     PTHLF003,PTHDTABT
          GOTO      OINL9999 IF NOT EQUAL
.
          MATCH     PTHLF004,PTHDCASM
          GOTO      OINL9999 IF NOT EQUAL
.
          CALL      OINLRW00
.
          MOVE      PTHDCASM,SAVCASEM
          GOTO      OINL0010
.
OINL9999  RETURN
.
.------------------------------------------------------------
. Overnight inlier/high outlier charges row
.------------------------------------------------------------
OINLRW00  MATCH     SP70,SAVCASEM
          IF        @EQUAL
            MOVE      "1",LSTRANGE
          ELSE
            MATCH     SAVCASEM,PTHDCASM
            IF        !@EQUAL
              MOVE      "1",LSTRANGE
            ENDIF
          ENDIF
.
          MOVE      SP70,DAYRANGE
          PACK      DAYRANGE,LSTRANGE,DASH,PTHDEDAY,SP70
          MOVE      ZERO,TOTADDIT
          MOVE      PTHDDREB,TOTADDIT
          ADD       PTHDDPAT,TOTADDIT
.
          MOVE      SP70,KEY8
          IF        PTHDDTYP=1
            MOVE      "Inlier  ",KEY8
          ELSE
            IF        PTHDDTYP=2
              MOVE      "Outlier ",KEY8
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap>";
.
          MATCH     "1",MENUFLAG
          GOTO      OINLRW10 IF EQUAL
.
          WRITE     HTMLFILE;"<A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pthdf011=",PTHDCNID:
                             "&pthdf001=",PTHDCLMN:
                             "&pthdf002=",PTHDHFND:
                             "&pthdf003=",PTHDTABT:
                             "&pthdf004=",PTHDCASM:
                             "&pthdf009=",PTHDEDAY,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>";
.
OINLRW10  WRITE     HTMLFILE;"&nbsp;",PTHDDES1;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            MATCH     SP70,PTHDDES2
            IF        !@EQUAL
              WRITE     HTMLFILE;"; ",PTHDDES2;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</td>":
                             "<td>&nbsp;",DAYRANGE,"</td>":
                             "<td>&nbsp;",KEY8,"</td>":
                             "<td>&nbsp;",PTHDDREB,"</td>":
                             "<td>&nbsp;",PTHDDPAT,"</td>":
                             "<td>&nbsp;",TOTADDIT,"</td>":
                             "</tr>";
.
          MOVE      PTHDEDAY,LSTRANGE
          ADD       ONE,LSTRANGE
.
OINLRW99  RETURN
.
.------------------------------------------------------------
. Table of Overnight low outlier charges
.------------------------------------------------------------
OOTL0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      SP70,SAVCASEM
          MOVE      ONE,LSTRANGE
.
          PACK      KEY31,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RSPTLDF1
OOTL0010  CALL      RKPTLDF1
          BRANCH    OVRCD,OOTL9999
.
OOTL0050  MATCH     PTHLF013,PTLDCNID
          GOTO      OOTL9999 IF NOT EQUAL
.
          MATCH     PTHLF001,PTLDCLMN
          GOTO      OOTL9999 IF NOT EQUAL
.
          MATCH     PTHLF002,PTLDHFND
          GOTO      OOTL9999 IF NOT EQUAL
.
          MATCH     PTHLF003,PTLDTABT
          GOTO      OOTL9999 IF NOT EQUAL
.
          MATCH     PTHLF004,PTLDCASM
          GOTO      OOTL9999 IF NOT EQUAL
.
          CALL      OOTLRW00
.
          MOVE      PTLDCASM,SAVCASEM
          GOTO      OOTL0010
.
OOTL9999  RETURN
.
.------------------------------------------------------------
. Overnight low outlier charges row
.------------------------------------------------------------
OOTLRW00  MATCH     SP70,SAVCASEM
          IF        @EQUAL
            MOVE      "1",LSTRANGE
          ELSE
            MATCH     SAVCASEM,PTLDCASM
            IF        !@EQUAL
              MOVE      "1",LSTRANGE
            ENDIF
          ENDIF
.
          MOVE      SP70,DAYRANGE
          PACK      DAYRANGE,LSTRANGE,DASH,PTLDEDAY,SP70
          MOVE      ZERO,TOTADDIT
          MOVE      PTLDDREB,TOTADDIT
          ADD       PTLDDPAT,TOTADDIT
.
          WRITE     HTMLFILE;"<tr><td nowrap>";
.
          MATCH     "1",MENUFLAG
          GOTO      OOTLRW10 IF EQUAL
.
          WRITE     HTMLFILE;"<A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptldf010=",PTLDCNID:
                             "&ptldf001=",PTLDCLMN:
                             "&ptldf002=",PTLDHFND:
                             "&ptldf003=",PTLDTABT:
                             "&ptldf004=",PTLDCASM:
                             "&ptldf009=",PTLDEDAY,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>";
.
OOTLRW10  WRITE     HTMLFILE;"&nbsp;",PTLDDES1;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            MATCH     SP70,PTLDDES2
            IF        !@EQUAL
              WRITE     HTMLFILE;"; ",PTLDDES2;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</td>":
                             "<td>&nbsp;",DAYRANGE,"</td>":
                             "<td>&nbsp;",PTLDDREB,"</td>":
                             "<td>&nbsp;",PTLDDPAT,"</td>":
                             "<td>&nbsp;",TOTADDIT,"</td>":
                             "</tr>";
.
          MOVE      PTLDEDAY,LSTRANGE
          ADD       ONE,LSTRANGE
.
OOTLRW99  RETURN
.
.------------------------------------------------------------
. Table of Overnight breakdown charges
.------------------------------------------------------------
OREVB000  COMPARE   ONE,UPDATEFL
          IF        @EQUAL
            CALL      WROBT000
          ENDIF
.
          MOVE      ZERO,TOTALAMT
.
          MATCH     ANSR,BRKDTYPE
          GOTO      OREVB100 IF NOT EQUAL
.
          PACK      KEY30,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RSTEMP1
OREVB010  CALL      RKTEMP1
          BRANCH    OVRCD,OREVB100
.
OREVB050  MATCH     PTHLF013,TEMPCNID
          GOTO      OREVB100 IF NOT EQUAL
.
          MATCH     PTHLF001,TEMPCLMN
          GOTO      OREVB100 IF NOT EQUAL
.
          MATCH     PTHLF002,TEMPHFND
          GOTO      OREVB100 IF NOT EQUAL
.
          MATCH     PTHLF003,TEMPTABT
          GOTO      OREVB100 IF NOT EQUAL
.
          MATCH     PTHLF004,TEMPCASM
          GOTO      OREVB100 IF NOT EQUAL
.
          ADD       TEMPAMNT,TOTALAMT
          CALL      OREROW00
          GOTO      OREVB010
.
OREVB100  MATCH     ANSI,BRKDTYPE
          GOTO      OREVB999 IF NOT EQUAL
.
          PACK      KEY30,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RSTEMP2
OREVB110  CALL      RKTEMP2
          BRANCH    OVRCD,OREVB999
.
          MATCH     PTHLF013,TEMPCNID
          GOTO      OREVB999 IF NOT EQUAL
.
          MATCH     PTHLF001,TEMPCLMN
          GOTO      OREVB999 IF NOT EQUAL
.
          MATCH     PTHLF002,TEMPHFND
          GOTO      OREVB999 IF NOT EQUAL
.
          MATCH     PTHLF003,TEMPTABT
          GOTO      OREVB999 IF NOT EQUAL
.
          MATCH     PTHLF004,TEMPCASM
          GOTO      OREVB999 IF NOT EQUAL
.
          ADD       TEMPAMNT,TOTALAMT
          CALL      OREROW00
.
          GOTO      OREVB110
.
OREVB999  RETURN
.
.------------------------------------------------------------
. Table of overnight breakdown charges
.------------------------------------------------------------
OREVV000  MOVE      ZERO,FIRST
          MOVE      ZERO,FINISHR
          MOVE      ZERO,FINISHI
.
          PACK      KEY30,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RSPTOVB1
OREVV010  CALL      RKPTOVB1
          BRANCH    OVRCD,OREVV090
.
OREVV050  MATCH     PTHLF013,PTOBCNID
          GOTO      OREVV090 IF NOT EQUAL
.
          MATCH     PTHLF001,PTOBCODE
          GOTO      OREVV090 IF NOT EQUAL
.
          MATCH     PTHLF002,PTOBFUND
          GOTO      OREVV090 IF NOT EQUAL
.
          MATCH     PTHLF003,PTOBTBLT
          GOTO      OREVV090 IF NOT EQUAL
.
          MATCH     PTHLF004,PTOBCSCD
          GOTO      OREVV090 IF NOT EQUAL
.
          CALL      ORBROW00
          GOTO      OREVV100
.
OREVV090  WRITE     HTMLFILE;"<tr><td>&nbsp</td>":
                             "<td>&nbsp;</td>"
          MOVE      ONE,FINISHR
.
OREVV100 IF        FIRST=0
            PACK      KEY30,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
            CALL      RSPTIOV1
            MOVE      ONE,FIRST
          ENDIF
.
OREVV110  CALL      RKPTIOV1
          BRANCH    OVRCD,OREVV190
.
OREVV150  MATCH     PTHLF013,PTIOCNID
          GOTO      OREVV190 IF NOT EQUAL
.
          MATCH     PTHLF001,PTIOCODE
          GOTO      OREVV190 IF NOT EQUAL
.
          MATCH     PTHLF002,PTIOFUND
          GOTO      OREVV190 IF NOT EQUAL
.
          MATCH     PTHLF003,PTIOTBLT
          GOTO      OREVV190 IF NOT EQUAL
.
          MATCH     PTHLF004,PTIOCSCD
          GOTO      OREVV190 IF NOT EQUAL
.
          CALL      OIBROW00
.
          GOTO      OREVV010
.
OREVV190  WRITE     HTMLFILE;"<td>&nbsp</td>":
                             "<td>&nbsp;</td></tr>"
          MOVE      ONE,FINISHI
.
          COMPARE   ONE,FINISHR
          GOTO      OREVV999 IF EQUAL
          GOTO      OREVV010
.
OREVV999  RETURN
.
.------------------------------------------------------------
. Overnight Revenue Breakdown row
.------------------------------------------------------------
ORBROW00  MOVE      "FI",CATEGORY
          MOVE      PTOBBRCD,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr><td>",TDESC,"</td>":
                             "<td>&nbsp;",PTOBAMNT,"</td>"
ORBROW99  RETURN
.
.------------------------------------------------------------
. Overnight Invoice Breakdown row
.------------------------------------------------------------
OIBROW00  MOVE      "FI",CATEGORY
          MOVE      PTIOBRCD,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<td>",TDESC,"</td>":
                             "<td>&nbsp;",PTIOAMNT,"</td>":
                             "</tr>";
OIBROW99  RETURN
.
.------------------------------------------------------------
. Overnight Revenue Breakdown row
.------------------------------------------------------------
OREROW00  MOVE      "FI",CATEGORY
          MOVE      TEMPBRKD,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:DeleteInvoice":
                             "(#"",TEMPBRKD,"#")'>":
                             "<img src=../images/DeleteIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             TDESC,"</td>":
                             "<td>&nbsp;",TEMPAMNT,"</td>"
OREROW99  RETURN
.
.
.------------------------------------------------------------
. Table of Casemix Matrix Details
.------------------------------------------------------------
CASMTX00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      ZERO,LOOPCNTR            * Keep alive loop counter
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          IF        BLANKHFD=1
            MOVE      SP70,PMCMT002          * Set health fund to blank
          ENDIF
.
          CALL      RSPM0000
CASMTX05  CALL      RKPM0000 
          BRANCH    OVRCD,CASMTX90
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.------------------------------------------------------
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
          MATCH     "     0",DPMCCCNT
          GOTO      CASMTX50 IF NOT EQUAL
.
          IF        INDEX=4
            MATCH     PMCMT004,PMCCCMCD
            GOTO      CASMTX90 IF NOT EQUAL
          ENDIF
.
          IF        INDEX=2
            MATCH     PMCMT064,PMCCCONT
            GOTO      CASMTX90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMCMT001               * claim code is mandatory
          IF        !@EQUAL
            MATCH     PMCMT001,PMCCCCOD
            GOTO      CASMTX07 IF EQUAL         * same Claim code
.
            COMPARE   ONE,INDEX
            GOTO      CASMTX90  IF EQUAL        * Index on Claim Code
            COMPARE   THREE,INDEX
            GOTO      CASMTX90  IF EQUAL        * Index on Claim Code
            COMPARE   FOUR,INDEX
            GOTO      CASMTX90 IF EQUAL
            GOTO      CASMTX50
          ENDIF
.
CASMTX07  COMPARE   FOUR,INDEX
          GOTO      CASMTX10 IF EQUAL           * By Casemix code
.
          MATCH     SP70,PMCMT064
          IF        !@EQUAL
            MATCH     PMCMT064,PMCCCONT
            GOTO      CASMTX08 IF EQUAL
.
            COMPARE   TWO,INDEX
            GOTO      CASMTX90  IF EQUAL        * Index on Contract Id
            GOTO      CASMTX50
          ENDIF
.
CASMTX08  MATCH     SP70,PMCMT004
          IF        !@EQUAL
            MATCH     PMCMT004,PMCCCMCD
            GOTO      CASMTX10 IF EQUAL
.
            COMPARE   FOUR,INDEX
            GOTO      CASMTX90  IF EQUAL        * Index on Casemix Code
            GOTO      CASMTX50
          ENDIF
.
CASMTX10  MATCH     SP70,PMCMT002
          IF        !@EQUAL
            MATCH     PMCMT002,PMCCHFUN
            GOTO      CASMTX20 IF EQUAL
.
            COMPARE   FOUR,INDEX
            GOTO      CASMTX90 IF EQUAL    * By casemix code,Claim,HF
            GOTO      CASMTX50
          ELSE
            COMPARE   ONE,BLANKHFD
            GOTO      CASMTX20 IF NOT EQUAL
            MATCH     SP70,PMCCHFUN
            GOTO      CASMTX05 IF NOT EQUAL
          ENDIF
.
CASMTX20  MATCH     SP70,PMCMT003
          IF        !@EQUAL
            MATCH     PMCMT003,PMCCHFTY
            GOTO      CASMTX50 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMCMT063
          IF        !@EQUAL
            MATCH     PMCMT063,PMCCTYPE
            GOTO      CASMTX50 IF NOT EQUAL
          ENDIF
.
          COMPARE   FOUR,INDEX
          GOTO      CASMTX30 IF NOT EQUAL      * Not by Casemix code
.
          MATCH     SP70,PMCMT064              * Contract ID entered?
          IF        !@EQUAL
            MATCH     PMCMT064,PMCCCONT
            GOTO      CASMTX05 IF NOT EQUAL
          ENDIF
.
CASMTX30  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CASMTX50
          ENDIF
.
          CALL      CASMRW00
          BRANCH    OVRCD,CASMTX50
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CASMTX50 IF NOT EQUAL
          GOTO      CASMTX99
.
CASMTX50  IF        INDEX=1
            PACK      KEY34,PMCCCCOD,PMCCCONT,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                            PMCCCMCD,Z70
          ELSE
            IF        INDEX=2
              PACK      KEY34,PMCCCONT,PMCCCCOD,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                              PMCCCMCD,Z70
            ELSE
              IF        INDEX=3
                COMPARE   ZERO,PMCCCNTR
                GOTO      CASMTX05 IF EQUAL
.
                MOVE      ZERO,PMCCCNTR
                PACK      KEY34,PMCCCCOD,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                                Z70
              ELSE
                PACK      KEY34,PMCCCMCD,PMCCCCOD,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                                Z70
              ENDIF
            ENDIF
          ENDIF
          CALL      RNPM0000
          GOTO      CASMTX05
.
CASMTX90  CALL      NOMORE00      * Display No More Records Message
.
CASMTX99  RETURN
+
.------------------------------------------------------------
. Save key variable depends on index
.------------------------------------------------------------
SKPM0000  BRANCH    INDEX,SKPM1000,SKPM2000,SKPM3000,SKPM4000
.
SKPM1000  PACK      SAVKEY34,PMCCCCOD,PMCCCONT,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                             PMCCCMCD,PMCCCNTR,SP70
          GOTO      SKPM9999
.
SKPM2000  PACK      SAVKEY34,PMCCCONT,PMCCCCOD,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                             PMCCCMCD,PMCCCNTR,SP70
          GOTO      SKPM9999
.
SKPM3000  PACK      SAVKEY34,PMCCCCOD,PMCCHFUN,PMCCHFTY,PMCCTYPE,PMCCCNTR:
                             PMCCCONT,PMCCCMCD,SP70
          GOTO      SKPM9999
.
SKPM4000  PACK      SAVKEY34,PMCCCMCD,PMCCCCOD,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                             PMCCCNTR,PMCCCONT,SP70
          GOTO      SKPM9999
.
SKPM9999  RETURN
+
.------------------------------------------------------------
. Position on first matrix rule  
.------------------------------------------------------------
RSPM0000  MOVE      ZERO,INDEX
.
          BRANCH    CMNORULE,RSPM3000        * Use index 3
.
          MATCH     SP70,PMCMT004
          GOTO      RSPM4000 IF NOT EQUAL
.
          MATCH     SP70,PMCMT064
          GOTO      RSPM1000 IF EQUAL
.
          MOVE      TWO,INDEX
          PACK      KEY34,PMCMT064,PMCMT001,PMCMT002,SP70
          CALL      RSPMCMT2
          GOTO      RSPM9999
.
RSPM1000  MATCH     SP70,PMCMT002
          GOTO      RSPM3000 IF NOT EQUAL
.
          MOVE      ONE,INDEX
          PACK      KEY34,PMCMT001,PMCMT064,PMCMT002,SP70
          CALL      RSPMCMT1
          GOTO      RSPM9999
.
RSPM3000  MOVE      THREE,INDEX
          PACK      KEY34,PMCMT001,PMCMT002,SP70
          CALL      RSPMCMT3
          GOTO      RSPM9999
.
RSPM4000  MOVE      FOUR,INDEX
          PACK      KEY34,PMCMT004,PMCMT001,PMCMT002,SP70
          CALL      RSPMCMT4
          GOTO      RSPM9999
.
RSPM9999  RETURN
.------------------------------------------------------------
. Readm next matrix rule  
.------------------------------------------------------------
RKPM0000  BRANCH    INDEX,RKPM1000,RKPM2000,RKPM3000,RKPM4000
          GOTO      RKPM9999
.
RKPM1000  CALL      RKPMCMT1
          GOTO      RKPM9999
.
RKPM2000  CALL      RKPMCMT2
          GOTO      RKPM9999
.
RKPM3000  CALL      RKPMCMT3
          GOTO      RKPM9999
.
RKPM4000  CALL      RKPMCMT4
          GOTO      RKPM9999
.
RKPM9999  RETURN
+
.------------------------------------------------------------
. Reads matrix rule
.------------------------------------------------------------
RNPM0000  BRANCH    INDEX,RNPM1000,RNPM2000,RNPM3000,RNPM4000
          GOTO      RNPM9999
.
RNPM1000  CALL      RSPMCMT1
          GOTO      RNPM9999
.
RNPM2000  CALL      RSPMCMT2
          GOTO      RNPM9999
.
RNPM3000  CALL      RSPMCMT3
          GOTO      RNPM9999
.
RNPM4000  CALL      RSPMCMT4
          GOTO      RNPM9999
.
RNPM9999  RETURN
+
.------------------------------------------------------------
. Full Read matrix rule
.------------------------------------------------------------
RFPM0000  BRANCH    INDEX,RFPM1000,RFPM2000,RFPM3000,RFPM4000
          GOTO      RFPM9999
.
RFPM1000  CALL      RDPMCMT1
          GOTO      RFPM9999
.
RFPM2000  CALL      RDPMCMT2
          GOTO      RFPM9999
.
RFPM3000  CALL      RDPMCMT3
          GOTO      RFPM9999
.
RFPM4000  CALL      RDPMCMT4
          GOTO      RFPM9999
.
RFPM9999  RETURN
+
.------------------------------------------------------------
. Table of Sameday  Records
.------------------------------------------------------------
SMDYTX00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,PTLSD001
          GOTO      SMDYTX99 IF EQUAL
          GOTO      SMDYTX99 IF EOS
.
          MATCH     SP70,PTLSD012
          IF        @EQUAL
            PACK      KEY27,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          ELSE
            PACK      KEY27,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          ENDIF
.
.         Try full reead if exists
.
          MATCH     SP70,PTLSD012
          IF        @EQUAL
            CALL      RDPTLSD2
          ELSE
            CALL      RDPTLSD1
          ENDIF
          IF        OVRCD=0
            GOTO      SMDYTX20
          ENDIF
.
.         Try position read
.
          MATCH     SP70,PTLSD012
          IF        @EQUAL
            CALL      RSPTLSD2
          ELSE
            CALL      RSPTLSD1
          ENDIF
.
.         Read next record
.
SMDYTX10  MATCH     SP70,PTLSD012
          IF        @EQUAL
            CALL      RKPTLSD2
          ELSE
            CALL      RKPTLSD1
          ENDIF
          BRANCH    OVRCD,SMDYTX90
.
SMDYTX20  MATCH     SP70,PTLSD012
          IF        !@EQUAL
            MATCH     PTLSD012,PTLSCNID
            GOTO      SMDYTX90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PTLSD001
          IF        !@EQUAL
            MATCH     PTLSD001,PTLSCLMN
            GOTO      SMDYTX90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PTLSD002
          IF        !@EQUAL
            MATCH     PTLSD002,PTLSHFND
            GOTO      SMDYTX90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PTLSD003
          IF        !@EQUAL
            MATCH     PTLSD003,PTLSTABT
            GOTO      SMDYTX10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PTLSD004
          IF        !@EQUAL
            MATCH     PTLSD004,PTLSCASM
            GOTO      SMDYTX10 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SMDYTX10
          ENDIF
.
          CALL      SMDROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SMDYTX10 IF NOT EQUAL
          GOTO      SMDYTX99
.
SMDYTX90  CALL      NOMORE00      * Display No More Records Message
.
SMDYTX99  RETURN
+
.------------------------------------------------------------
. Table of Overnight  Records
.------------------------------------------------------------
OVNTTX00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,PTHLF001
          GOTO      OVNTTX99 IF EQUAL
          GOTO      OVNTTX99 IF EOS
.
          MATCH     SP70,PTHLF013
          IF        @EQUAL
            PACK      KEY27,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          ELSE
            PACK      KEY27,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          ENDIF
.
.         Try full reead if exists
.
          MATCH     SP70,PTHLF013
          IF        @EQUAL
            CALL      RDPTHLF2
          ELSE
            CALL      RDPTHLF1
          ENDIF
          IF        OVRCD=0
            GOTO      OVNTTX20
          ENDIF
.
.         Try position read
.
          MATCH     SP70,PTHLF013
          IF        @EQUAL
            CALL      RSPTHLF2
          ELSE
            CALL      RSPTHLF1
          ENDIF
.
.         Read next record
.
OVNTTX10  MATCH     SP70,PTHLF013
          IF        @EQUAL
            CALL      RKPTHLF2
          ELSE
            CALL      RKPTHLF1
          ENDIF
          BRANCH    OVRCD,OVNTTX90
.
OVNTTX20  MATCH     SP70,PTHLF013
          IF        !@EQUAL
            MATCH     PTHLF013,PTHLCNID
            GOTO      OVNTTX90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PTHLF001
          IF        !@EQUAL
            MATCH     PTHLF001,PTHLCLMN
            GOTO      OVNTTX90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PTHLF002
          IF        !@EQUAL
            MATCH     PTHLF002,PTHLHFND
            GOTO      OVNTTX90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PTHLF003
          IF        !@EQUAL
            MATCH     PTHLF003,PTHLTABT
            GOTO      OVNTTX10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PTHLF004
          IF        !@EQUAL
            MATCH     PTHLF004,PTHLCASM
            GOTO      OVNTTX10 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      OVNTTX10
          ENDIF
.
          CALL      OVNROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      OVNTTX10 IF NOT EQUAL
          GOTO      OVNTTX99
.
OVNTTX90  CALL      NOMORE00     * Display No More Records Message
.
OVNTTX99  RETURN
.------------------------------------------------------------
. Table of Casemix Matrix Rules  
.------------------------------------------------------------
TABRUL00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,PMCMT001
          GOTO      TABRUL99 IF EQUAL
.
          PACK      KEY34,PMCMT001,PMCMT064,PMCMT002,PMCMT003,PMCMT063,PMCMT004:
                          SP70
          CALL      RSPMCMT1
TABRUL05  CALL      RKPMCMT1
          BRANCH    OVRCD,TABRUL99
.
          MATCH     PMCMT001,PMCCCCOD
          GOTO      TABRUL99 IF NOT EQUAL
.
          COMPARE   ZERO,PMCCCNTR
          GOTO      TABRUL05 IF EQUAL
.
          MATCH     PMCMT064,PMCCCONT
          GOTO      TABRUL99 IF NOT EQUAL
.
          MATCH     PMCMT002,PMCCHFUN
          GOTO      TABRUL99 IF NOT EQUAL
.
          MATCH     PMCMT003,PMCCHFTY
          GOTO      TABRUL99 IF NOT EQUAL
.
          MATCH     PMCMT063,PMCCTYPE
          GOTO      TABRUL99 IF NOT EQUAL
.
          MATCH     PMCMT004,PMCCCMCD
          GOTO      TABRUL99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TABRUL05
          ENDIF
.
          CALL      CASRUL00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      TABRUL05
          ENDIF
.
TABRUL99  RETURN
.------------------------------------------------------------
. Casemix Matrix Table (TABLE ROW)
.------------------------------------------------------------
CASMRW00  PACK      KEY9,PMCCCMCD,SP70
          CALL      RDPTCMC1
          IF        OVRCD=1
            MOVE      "&nbsp;",PTCADES1  * Casemix Code Description
          ENDIF
.
          MOVE      SP70,TDESC
          MATCH     SP70,PMCCCCOD
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,PMCCCCOD,SP70
            CALL      RDCODE1
          ENDIF
.
          CALL      FRSRUL00              * Get first rule
          IF        CMNORULE=1
            MATCH     SP70,KEY200
            GOTO      CASMRW90 IF NOT EQUAL     * show no rule only
          ENDIF
.
          MOVE      ZERO,LOOPCNTR           * Record outout reset counter
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"javascript:ShowMatrix":
                             "('",PMCCCCOD,"',":
                             "'",PMCCCONT,"',":
                             "'",PMCCHFUN,"',":
                             "'",PMCCHFTY,"',":
                             "'",PMCCTYPE,"',":
                             "'",PMCCCMCD,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMCCCMCD,"</td>":
                             "<td>",PTCADES1,"&nbsp;</td>":
                             "<td>",PMCCCONT,"&nbsp;</td>":
                             "<td>",TDESC,"&nbsp;</td>":
                             "<td>",PMCCHFUN,"&nbsp;</td>":
                             "<td>",PMCCHFTY,"&nbsp;</td>":
                             "<td>&nbsp;",KEY200,"</td>":
                             "<td>",PMCCTYPE,"&nbsp;</td>":
                             "<td>",PMCCPODY,"&nbsp;</td>":
                             "<td>",PMCCNPDY,"&nbsp;</td>":
                             "<td>",PMCCMIND,"&nbsp;</td>":
                             "<td>",PMCCHBPT,"&nbsp;</td>":
                             "<td>",PMCCCCDY,"&nbsp;</td>":
                             "</tr>"
         MOVE       ZERO,OVRCD
         GOTO       CASMRW99
.
CASMRW90 MOVE       ONE,OVRCD
CASMRW99 RETURN
+
.------------------------------------------------------------
. Get first rule
.------------------------------------------------------------
FRSRUL00  CALL      SKPM0000
.
          MOVE      SP70,KEY200
          PACK      KEY34,PMCCCCOD,PMCCCONT,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                          PMCCCMCD,SP70
          CALL      RSPMCMT1
FRSRUL10  CALL      RKPMCMT1
          BRANCH    OVRCD,FRSRUL20
.
          PACK      KEY28,PMCCCCOD,PMCCCONT,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                          PMCCCMCD,SP70
          MATCH     KEY28,KEY34
          GOTO      FRSRUL20 IF NOT EQUAL
.
          MATCH     "     0",DPMCCCNT
          GOTO      FRSRUL10 IF EQUAL    * skip header record
.
          CALL      CMXRULES              * setup rule
.
          UNPACK    RULEDESC,KEY200
          ENDSET    KEY200
          MOVE      SP70,KEY5
          UNPACK    KEY200,KEY5
          MATCH     SP70,KEY5
          IF        !@EQUAL
            BUMP      KEY200,-8
            APPEND    " etc....",KEY200
          ENDIF
          APPEND    SP70,KEY200
          RESET     KEY200
.
FRSRUL20  MOVE      SAVKEY34,KEY34       * restore
          CALL      RFPM0000             * reposition
.
FRSRUL99  RETURN
+
.------------------------------------------------------------
. Sameday Fee Table (TABLE ROW)
.------------------------------------------------------------
SMDROW00  PACK      KEY9,PTLSCASM,SP70
          CALL      RDPTCMC1
          IF        OVRCD=1
            MOVE      "&nbsp;",PTCADES1  * Casemix Code Description
          ENDIF
.
          MOVE      SP70,TDESC
          MATCH     SP70,PTLSCLMN
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,PTLSCLMN,SP70
            CALL      RDCODE1
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                             "<td>",PTLSCNID,"&nbsp;</td>":
                             "<td nowrap><A HREF=#"javascript:ShowSameday":
                             "('",PTLSCNID,"',":
                             "'",PTLSCLMN,"',":
                             "'",PTLSHFND,"',":
                             "'",PTLSTABT,"',":
                             "'",PTLSCASM,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTLSCASM,"</td>":
                             "<td>",PTCADES1,"&nbsp;</td>":
                             "<td>",PTLSHFND,"&nbsp;</td>":
                             "<td>",PTLSTABT,"&nbsp;</td>":
                             "<td>",PTLSDES1,"&nbsp;</td>":
                             "<td>",PTLSLREB,"&nbsp;</td>":
                             "<td>",PTLSLPAT,"&nbsp;</td>":
                             "</tr>"
.
SMDROW99 RETURN
.
.------------------------------------------------------------
. Overnight Fee Table (TABLE ROW)
.------------------------------------------------------------
OVNROW00  PACK      KEY9,PTHLCASM,SP70
          CALL      RDPTCMC1
          IF        OVRCD=1
            MOVE      "&nbsp;",PTCADES1  * Casemix Code Description
          ENDIF
.
          MOVE      SP70,TDESC
          MATCH     SP70,PTHLCLMN
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,PTHLCLMN,SP70
            CALL      RDCODE1
          ENDIF
.
          WRITE    HTMLFILE;"<tr>":
                             "<td>",PTHLCNID,"&nbsp;</td>":
                             "<td nowrap><A HREF=#"javascript:ShowOvernight":
                             "('",PTHLCNID,"',":
                             "'",PTHLCLMN,"',":
                             "'",PTHLHFND,"',":
                             "'",PTHLTABT,"',":
                             "'",PTHLCASM,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTHLCASM,"</td>":
                             "<td>",PTCADES1,"&nbsp;</td>":
                             "<td>",PTHLHFND,"&nbsp;</td>":
                             "<td>",PTHLTABT,"&nbsp;</td>":
                             "<td>",PTHLDES1,"&nbsp;</td>":
                             "<td>",PTHLLREB,"&nbsp;</td>":
                             "<td>",PTHLLPAT,"&nbsp;</td>":
                             "</tr>"
.
OVNROW99 RETURN
.
.------------------------------------------------------------
. Casemix Matrix Rule Table (TABLE ROW)
.------------------------------------------------------------
CASRUL00  CALL      CMXRULES              * setup rule
.
          MOVE      PMCCCNTR,RULENUMB
          REPLACE   " 0",RULENUMB 
          WRITE     HTMLFILE;"<tr><td nowrap id='rule",RULENUMB,"'>":
                             "<A HREF=#"javascript:UpdateMatrix":
                             "('",PMCCCCOD,"',":
                             "'",PMCCCONT,"',":
                             "'",PMCCHFUN,"',":
                             "'",PMCCHFTY,"',":
                             "'",PMCCTYPE,"',":
                             "'",PMCCCMCD,"',":
                             "'",PMCCCNTR,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMCCCNTR,"</td>":
                             "<td>",RULEDESC,"</td>":
                             "</tr>"
.
CASRUL99 RETURN
.
.-------------------------------------------------------------------------
. Link to Next Casemix Matrix
.-------------------------------------------------------------------------
NEXTMT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PMCMT001
          REP       " +",PMCMT002
          REP       " +",PMCMT003
          REP       " +",PMCMT063
          REP       " +",PMCMT004
          REP       " +",PMCMT064
.
          WRITE     HTMLFILE;"patweb63.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmcmt001=",PMCMT001:
                                 "&pmcmt002=",PMCMT002:
                                 "&pmcmt003=",PMCMT003:
                                 "&pmcmt063=",PMCMT063:
                                 "&pmcmt004=",PMCMT004:
                                 "&pmcmt064=",PMCMT064:
                                 "&cmnorule=",CMNORULE:
                                 "&blankhfd=",BLANKHFD;
.
          REP       "+ ",PMCMT001
          REP       "+ ",PMCMT002
          REP       "+ ",PMCMT003
          REP       "+ ",PMCMT063
          REP       "+ ",PMCMT004
          REP       "+ ",PMCMT064
.
NEXTMT99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Casemix Matrix
.-------------------------------------------------------------
PREVMT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PMCMT001
          REP       " +",PMCMT002
          REP       " +",PMCMT003
          REP       " +",PMCMT063
          REP       " +",PMCMT004
          REP       " +",PMCMT064
.
          WRITE     HTMLFILE;"patweb63.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmcmt001=",PMCMT001:
                                 "&pmcmt002=",PMCMT002:
                                 "&pmcmt003=",PMCMT003:
                                 "&pmcmt063=",PMCMT063:
                                 "&pmcmt004=",PMCMT004:
                                 "&pmcmt064=",PMCMT064:
                                 "&cmnorule=",CMNORULE:
                                 "&blankhfd=",BLANKHFD;
.
          REP       "+ ",PMCMT001
          REP       "+ ",PMCMT002
          REP       "+ ",PMCMT003
          REP       "+ ",PMCMT063
          REP       "+ ",PMCMT004
          REP       "+ ",PMCMT064
.
PREVMT99  RETURN
.
.-------------------------------------------------------------------------
. Link to Next Sameday Record
.-------------------------------------------------------------------------
NEXTSD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PTLSD001
          REP       " +",PTLSD002
          REP       " +",PTLSD003
          REP       " +",PTLSD004
          REP       " +",PTLSD012
.
          WRITE     HTMLFILE;"patweb63.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&ptlsd012=",PTLSD012:
                                 "&ptlsd001=",PTLSD001:
                                 "&ptlsd002=",PTLSD002:
                                 "&ptlsd003=",PTLSD003:
                                 "&ptlsd004=",PTLSD004;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",PTLSD001
          REP       "+ ",PTLSD002
          REP       "+ ",PTLSD003
          REP       "+ ",PTLSD004
          REP       "+ ",PTLSD012
.
NEXTSD99  RETURN
+
.-------------------------------------------------------------
. Link to Prev Sameday
.-------------------------------------------------------------
PREVSD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PTLSD001
          REP       " +",PTLSD002
          REP       " +",PTLSD003
          REP       " +",PTLSD004
          REP       " +",PTLSD012
.
          WRITE     HTMLFILE;"patweb63.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&ptlsd012=",PTLSD012:
                                 "&ptlsd001=",PTLSD001:
                                 "&ptlsd002=",PTLSD002:
                                 "&ptlsd003=",PTLSD003:
                                 "&ptlsd004=",PTLSD004;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",PTLSD001
          REP       "+ ",PTLSD002
          REP       "+ ",PTLSD003
          REP       "+ ",PTLSD004
          REP       "+ ",PTLSD012
.
PREVSD99  RETURN
.
.------------------------------------------------------------
. Set Redirect 
.------------------------------------------------------------
SETDIR00  REP       "+ ",PTLSD001
          REP       "+ ",PTLSD002
          REP       "+ ",PTLSD003
          REP       "+ ",PTLSD004
          REP       "+ ",PTLSD012
          CLEAR     REDIRECT
          APPEND    "patweb63.pbl?reportno=",REDIRECT
          APPEND    REPORTNO,REDIRECT
          APPEND    "&template=",REDIRECT
          APPEND    TEMPLATE,REDIRECT
          APPEND    "&ptlsd012=",REDIRECT
          APPEND    PTLSD012,REDIRECT
          APPEND    "&ptlsd001=",REDIRECT
          APPEND    PTLSD001,REDIRECT
          APPEND    "&ptlsd002=",REDIRECT
          APPEND    PTLSD002,REDIRECT
          APPEND    "&ptlsd003=",REDIRECT
          APPEND    PTLSD003,REDIRECT
          APPEND    "&ptlsd004=",REDIRECT
          APPEND    PTLSD004,REDIRECT
          APPEND    "&fileflag=",REDIRECT
          APPEND    FILEFLAG,REDIRECT
.
          REP       "+ ",PTLSD001
          REP       "+ ",PTLSD002
          REP       "+ ",PTLSD003
          REP       "+ ",PTLSD004
          REP       "+ ",PTLSD012
.
SETDIR99  RETURN
.-------------------------------------------------------------------------
. Link to Next Overnight Record
.-------------------------------------------------------------------------
NEXTOV00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PTHLF013
          REP       " +",PTHLF001
          REP       " +",PTHLF002
          REP       " +",PTHLF003
          REP       " +",PTHLF004
.
          WRITE     HTMLFILE;"patweb63.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pthlf013=",PTHLF013:
                                 "&pthlf001=",PTHLF001:
                                 "&pthlf002=",PTHLF002:
                                 "&pthlf003=",PTHLF003:
                                 "&pthlf004=",PTHLF004;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",PTHLF013
          REP       "+ ",PTHLF001
          REP       "+ ",PTHLF002
          REP       "+ ",PTHLF003
          REP       "+ ",PTHLF004
.
NEXTOV99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Overnight
.-------------------------------------------------------------
PREVOV00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PTHLF013
          REP       " +",PTHLF001
          REP       " +",PTHLF002
          REP       " +",PTHLF003
          REP       " +",PTHLF004
.
          WRITE     HTMLFILE;"patweb63.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pthlf013=",PTHLF013:
                                 "&pthlf001=",PTHLF001:
                                 "&pthlf002=",PTHLF002:
                                 "&pthlf003=",PTHLF003:
                                 "&pthlf004=",PTHLF004;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",PTHLF013
          REP       "+ ",PTHLF001
          REP       "+ ",PTHLF002
          REP       "+ ",PTHLF003
          REP       "+ ",PTHLF004
.
PREVOV99  RETURN
.
.------------------------------------------------------------
. Set Redirect
.------------------------------------------------------------
OVRSET00  REP       "+ ",PTHLF013
          REP       "+ ",PTHLF001
          REP       "+ ",PTHLF002
          REP       "+ ",PTHLF003
          REP       "+ ",PTHLF004
          CLEAR     REDIRECT
          APPEND    "patweb63.pbl?reportno=",REDIRECT
          APPEND    REPORTNO,REDIRECT
          APPEND    "&template=",REDIRECT
          APPEND    TEMPLATE,REDIRECT
          APPEND    "&pthlf013=",REDIRECT
          APPEND    PTHLF013,REDIRECT
          APPEND    "&pthlf001=",REDIRECT
          APPEND    PTHLF001,REDIRECT
          APPEND    "&pthlf002=",REDIRECT
          APPEND    PTHLF002,REDIRECT
          APPEND    "&pthlf003=",REDIRECT
          APPEND    PTHLF003,REDIRECT
          APPEND    "&pthlf004=",REDIRECT
          APPEND    PTHLF004,REDIRECT
          APPEND    "&fileflag=",REDIRECT
          APPEND    FILEFLAG,REDIRECT
.
          REP       "+ ",PTHLF013
          REP       "+ ",PTHLF001
          REP       "+ ",PTHLF002
          REP       "+ ",PTHLF003
          REP       "+ ",PTHLF004
.
OVRSET99  RETURN
.------------------------------------------------------------
. Set Redirect
.------------------------------------------------------------
SMDSET00  REP       "+ ",PTLSD001
          REP       "+ ",PTLSD002
          REP       "+ ",PTLSD003
          REP       "+ ",PTLSD004
          REP       "+ ",PTLSD012
          CLEAR     REDIRECT
          APPEND    "patweb63.pbl?reportno=",REDIRECT
          APPEND    REPORTNO,REDIRECT
          APPEND    "&template=",REDIRECT
          APPEND    TEMPLATE,REDIRECT
          APPEND    "&ptlsd012=",REDIRECT
          APPEND    PTLSD012,REDIRECT
          APPEND    "&ptlsd001=",REDIRECT
          APPEND    PTLSD001,REDIRECT
          APPEND    "&ptlsd002=",REDIRECT
          APPEND    PTLSD002,REDIRECT
          APPEND    "&ptlsd003=",REDIRECT
          APPEND    PTLSD003,REDIRECT
          APPEND    "&ptlsd004=",REDIRECT
          APPEND    PTLSD004,REDIRECT
          APPEND    "&fileflag=",REDIRECT
          APPEND    FILEFLAG,REDIRECT
.
          REP       "+ ",PTLSD001
          REP       "+ ",PTLSD002
          REP       "+ ",PTLSD003
          REP       "+ ",PTLSD004
          REP       "+ ",PTLSD012
.
SMDSET99  RETURN
+
.-------------------------------------------------------------------------
. Link to Next NZ Contract Procedure Matrix
.-------------------------------------------------------------------------
NEXTNM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",NZCMT001
          REP       " +",NZCMT002
          REP       " +",NZCMT003
          REP       " +",NZCMT004
          REP       " +",NZCMT005
.
          WRITE     HTMLFILE;"patweb63.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nzcmt001=",NZCMT001:
                                 "&nzcmt002=",NZCMT002:
                                 "&nzcmt003=",NZCMT003:
                                 "&nzcmt004=",NZCMT004:
                                 "&nzcmt005=",NZCMT005:
                                 "&fileflag=",FILEFLAG;
.
          REP       "+ ",NZCMT001
          REP       "+ ",NZCMT002
          REP       "+ ",NZCMT003
          REP       "+ ",NZCMT004
          REP       "+ ",NZCMT005
.
NEXTNM99  RETURN
.
.------------------------------------------------------------
. Table of NZ Contract Procedure Matrix Details
.------------------------------------------------------------
NZMTRX00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD   * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          CALL      RSNM0000
          BRANCH    EXIT,NZMTRX90
.
NZMTRX05  CALL      RKNM0000
          BRANCH    OVRCD,NZMTRX90
.
          MATCH     "0",NZCMITYP            * only display procedure headers
          GOTO      NZMTRX05 IF NOT EQUAL
.
          COMPARE   ZERO,NZCMCCNT
          GOTO      NZMTRX05 IF NOT EQUAL
.
          MATCH     SP70,NZCMT001
          IF        !@EQUAL
            MATCH     NZCMT001,NZCMCLMC
            GOTO      NZMTRX90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZCMT002
          IF        !@EQUAL
            MATCH     NZCMT002,NZCMCNTR
            GOTO      NZMTRX05 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZCMT003
          IF        !@EQUAL
            MATCH     NZCMT003,NZCMRTYP
            GOTO      NZMTRX05 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZCMT004
          IF        !@EQUAL
            MATCH     NZCMT004,NZCMCPRC
            GOTO      NZMTRX05 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZCMT005
          IF        !@EQUAL
            MATCH     NZCMT005,NZCMITYP
            GOTO      NZMTRX05 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      NZMTRX05
          ENDIF
.
          CALL      NZMTRW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      NZMTRX05 IF NOT EQUAL
.
          GOTO      NZMTRX99
.
NZMTRX90  CALL      NOMORE00     * Display No More Records Message
.
NZMTRX99  RETURN
+
.------------------------------------------------------------
. Position on first NZ Procedure matrix rule  
.------------------------------------------------------------
RSNM0000  MOVE      ZERO,INDEX
          MOVE      ZERO,EXIT
          MATCH     SP70,NZCMT004
          GOTO      RSNM1000 IF EQUAL
.
          MOVE      TWO,INDEX
          PACK      KEY26,NZCMT004,NZCMT001,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RSNZCM12
          ELSE
            CALL      RSNZCMT2
          ENDIF
          GOTO      RSNM9999
.
RSNM1000  MOVE      ONE,INDEX
          PACK      KEY26,NZCMT001,NZCMT002,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RSNZCM11
          ELSE
            CALL      RSNZCMT1
          ENDIF
          GOTO      RSNM9999
.
RSNM9000  MOVE      ZERO,EXIT
RSNM9999  RETURN
+
.------------------------------------------------------------
. Position on next NZ Procedure matrix rule  
.------------------------------------------------------------
RKNM0000  BRANCH    INDEX,RKNM1000,RKNM2000
          GOTO      RKNM9999
.
RKNM1000  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RKNZCM11
          ELSE
            CALL      RKNZCMT1
          ENDIF
          GOTO      RKNM9999
.
RKNM2000  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RKNZCM12
          ELSE
            CALL      RKNZCMT2
          ENDIF
RKNM9999  RETURN
+
.------------------------------------------------------------
. NZ Contract Procedure Matrix Table (TABLE ROW)
.------------------------------------------------------------
NZMTRW00  PACK      KEY9,NZCMCPRC,SP70
          CALL      RDPTCMC1
          IF        OVRCD=1
            MOVE      "&nbsp;",PTCADES1  * Casemix Code Description
          ENDIF
.
          MOVE      SP70,TDESC
          MATCH     SP70,NZCMCLMC
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,NZCMCLMC,SP70
            CALL      RDCODE1
          ENDIF
.
          MOVE      "Either    ",KEY10
          MATCH     "O",NZCMRTYP
          IF        @EQUAL
            MOVE      "Overnight ",KEY10
          ENDIF
          MATCH     "D",NZCMRTYP
          IF        @EQUAL
            MOVE      "Daycase   ",KEY10
          ENDIF
.
          MOVE      SP70,KEY3
          MOVE      "Procedure",KEY9
          MATCH     "1",NZCMITYP
          IF        @EQUAL
            MOVE      "Misc.Item",KEY9
            MOVE      "No",KEY3
            IF        NZCMFTYP=1
              MOVE      "Yes",KEY3      * Misc.Item Excluded
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"javascript:ShowProcMtrx":
                             "('",NZCMCLMC,"',":
                             "'",NZCMCNTR,"',":
                             "'",NZCMRTYP,"',":
                             "'",NZCMCPRC,"',":
                             "'",NZCMITYP,"',":
                             "'",FILEFLAG,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             NZCMCPRC,"</td>":
                             "<td>",PTCADES1,"&nbsp;</td>":
                             "<td>",TDESC,"&nbsp;</td>":
                             "<td>",NZCMCNTR,"&nbsp;</td>":
                             "<td>",KEY10,"&nbsp;</td>":
                             "</tr>"
NZMTRW99 RETURN
+
.-------------------------------------------------------------
. Link to Prev NZ Contract Procedure Matrix
.-------------------------------------------------------------
PREVNM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",NZCMT001
          REP       " +",NZCMT002
          REP       " +",NZCMT003
          REP       " +",NZCMT004
          REP       " +",NZCMT005
.
          WRITE     HTMLFILE;"patweb63.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nzcmt001=",NZCMT001:
                                 "&nzcmt002=",NZCMT002:
                                 "&nzcmt003=",NZCMT003:
                                 "&nzcmt004=",NZCMT004:
                                 "&nzcmt005=",NZCMT005:
                                 "&fileflag=",FILEFLAG;
.
          REP       "+ ",NZCMT001
          REP       "+ ",NZCMT002
          REP       "+ ",NZCMT003
          REP       "+ ",NZCMT004
          REP       "+ ",NZCMT005
.
PREVNM99  RETURN
.
.******************************************************************************
.*                             WRIB0000                                       *
.*                  Write to sameday Invoice Breakdown file                   *
.******************************************************************************
WRIB0000  PACK      KEY30,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RSPMSIN1
WRIB1000  CALL      RKPMSIN1
          BRANCH    OVRCD,WRIB5000
.
          MATCH     PMSICNID,PTLSCNID            * same Contract ID ?
          GOTO      WRIB5000 IF NOT EQUAL
.
          MATCH     PMSICODE,PTLSCLMN            * same claim code ?
          GOTO      WRIB5000 IF NOT EQUAL
.
          MATCH     PMSIFUND,PTLSHFND            * same health fund ?
          GOTO      WRIB5000 IF NOT EQUAL
.
          MATCH     PMSITBLT,PTLSTABT            * same table type ?
          GOTO      WRIB5000 IF NOT EQUAL
.
          MATCH     PMSICSCD,PTLSCASM            * same casemix code ?
          GOTO      WRIB5000 IF NOT EQUAL
.
          PACK      KEY30,PMSICNID,PMSICODE,PMSIFUND,PMSITBLT,PMSICSCD:
                          PMSIBKCD,SP70
          CALL      DEPMSIN1
.
          GOTO      WRIB1000
.
WRIB5000  PACK      KEY30,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RSTEMP2
WRIB6000  CALL      RKTEMP2
          BRANCH    OVRCD,WRIB9999
.
          MOVE      SP70,PMSICNID
          MOVE      SP3,PMSICODE             * clear variables before writing
          MOVE      SP6,PMSIFUND
          MOVE      SP3,PMSITBLT
          MOVE      SP9,PMSICSCD
          MOVE      SP3,PMSIBKCD
          MOVE      ZERO,PMSIAMNT
.
          MOVE      TEMPCNID,PMSICNID
          MOVE      TEMPCLMN,PMSICODE
          MOVE      TEMPHFND,PMSIFUND
          MOVE      TEMPTABT,PMSITBLT
          MOVE      TEMPCASM,PMSICSCD
          MOVE      TEMPBRKD,PMSIBKCD
          MOVE      TEMPAMNT,PMSIAMNT
.
          PACK      KEY30,PMSICNID,PMSICODE,PMSIFUND,PMSITBLT,PMSICSCD:
                          PMSIBKCD,SP70
          CALL      RAPMSIN1
          IF        OVRCD=1
            CALL      WRPMSIN1
          ENDIF
          GOTO      WRIB6000
.
WRIB9999  RETURN
+
.******************************************************************************
.*                             WOIB0000                                       *
.*                 Write to overnight Invoice Breakdown file                   *
.******************************************************************************
WOIB0000  PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RSPTIOV1
WOIB1000  CALL      RKPTIOV1
          BRANCH    OVRCD,WOIB5000
.
          MATCH     PTIOCNID,PTHLCNID            * same Contract ID ?
          GOTO      WOIB5000 IF NOT EQUAL
.
          MATCH     PTIOCODE,PTHLCLMN            * same claim code ?
          GOTO      WOIB5000 IF NOT EQUAL
.
          MATCH     PTIOFUND,PTHLHFND            * same health fund ?
          GOTO      WOIB5000 IF NOT EQUAL
.
          MATCH     PTIOTBLT,PTHLTABT            * same table type ?
          GOTO      WOIB5000 IF NOT EQUAL
.
          MATCH     PTIOCSCD,PTHLCASM            * same casemix code ?
          GOTO      WOIB5000 IF NOT EQUAL
.
          PACK      KEY30,PTIOCNID,PTIOCODE,PTIOFUND,PTIOTBLT,PTIOCSCD:
                          PTIOBRCD,SP70
          CALL      DEPTIOV1
.
          GOTO      WOIB1000
.
WOIB5000  PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RSTEMP2
WOIB6000  CALL      RKTEMP2
          BRANCH    OVRCD,WOIB9999
.
          MOVE      SP70,PTIOCNID
          MOVE      SP3,PTIOCODE             * clear variables before writing
          MOVE      SP6,PTIOFUND
          MOVE      SP3,PTIOTBLT
          MOVE      SP9,PTIOCSCD
          MOVE      SP3,PTIOBRCD
          MOVE      ZERO,PTIOAMNT
.
          MOVE      TEMPCNID,PTIOCNID
          MOVE      TEMPCLMN,PTIOCODE
          MOVE      TEMPHFND,PTIOFUND
          MOVE      TEMPTABT,PTIOTBLT
          MOVE      TEMPCASM,PTIOCSCD
          MOVE      TEMPBRKD,PTIOBRCD
          MOVE      TEMPAMNT,PTIOAMNT
.
          PACK      KEY30,PTIOCNID,PTIOCODE,PTIOFUND,PTIOTBLT,PTIOCSCD:
                          PTIOBRCD,SP70
          CALL      RAPTIOV1
          IF        OVRCD=1
            CALL      WRPTIOV1
          ENDIF
          GOTO      WOIB6000
.
WOIB9999  RETURN
+
.******************************************************************************
.*                             WRRB0000                                       *
.*                  Write to sameday revenue Breakdown file                   *
.******************************************************************************
WRRB0000  PACK      KEY30,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RSPTSRB1
WRRB1000  CALL      RKPTSRB1
          BRANCH    OVRCD,WRRB5000
.
          MATCH     PTSBCNID,PTLSCNID            * same Contract ID ?
          GOTO      WRRB5000 IF NOT EQUAL
.
          MATCH     PTSBCODE,PTLSCLMN            * same claim code ?
          GOTO      WRRB5000 IF NOT EQUAL
.
          MATCH     PTSBFUND,PTLSHFND            * same health fund ?
          GOTO      WRRB5000 IF NOT EQUAL
.
          MATCH     PTSBTBLT,PTLSTABT            * same table type ?
          GOTO      WRRB5000 IF NOT EQUAL
.
          MATCH     PTSBCSCD,PTLSCASM            * same casemix code ?
          GOTO      WRRB5000 IF NOT EQUAL
.
          PACK      KEY30,PTSBCNID,PTSBCODE,PTSBFUND,PTSBTBLT,PTSBCSCD:
                          PTSBBRCD,SP70
          CALL      DEPTSRB1
.
          GOTO      WRRB1000
.
WRRB5000  PACK      KEY30,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RSTEMP1
WRRB6000  CALL      RKTEMP1
          BRANCH    OVRCD,WRRB9999
.
          MOVE      SP70,PTSBCNID
          MOVE      SP3,PTSBCODE             * clear variables before writing
          MOVE      SP6,PTSBFUND
          MOVE      SP3,PTSBTBLT
          MOVE      SP9,PTSBCSCD
          MOVE      SP3,PTSBBRCD
          MOVE      ZERO,PTSBAMNT
.
          MOVE      TEMPCNID,PTSBCNID
          MOVE      TEMPCLMN,PTSBCODE
          MOVE      TEMPHFND,PTSBFUND
          MOVE      TEMPTABT,PTSBTBLT
          MOVE      TEMPCASM,PTSBCSCD
          MOVE      TEMPBRKD,PTSBBRCD
          MOVE      TEMPAMNT,PTSBAMNT
.
          PACK      KEY30,PTSBCNID,PTSBCODE,PTSBFUND,PTSBTBLT,PTSBCSCD:
                          PTSBBRCD,SP70
          CALL      RAPTSRB1
          IF        OVRCD=1
            CALL      WRPTSRB1
          ENDIF
          GOTO      WRRB6000
.
WRRB9999  RETURN
+
.******************************************************************************
.*                             WROB0000                                       *
.*                  Write to overnight revenue Breakdown file                 *
.******************************************************************************
WROB0000  PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RSPTOVB1
WROB1000  CALL      RKPTOVB1
          BRANCH    OVRCD,WROB5000
.
          MATCH     PTOBCNID,PTHLCNID            * same Contract ID ?
          GOTO      WROB5000 IF NOT EQUAL
.
          MATCH     PTOBCODE,PTHLCLMN            * same claim code ?
          GOTO      WROB5000 IF NOT EQUAL
.
          MATCH     PTOBFUND,PTHLHFND            * same health fund ?
          GOTO      WROB5000 IF NOT EQUAL
.
          MATCH     PTOBTBLT,PTHLTABT            * same table type ?
          GOTO      WROB5000 IF NOT EQUAL
.
          MATCH     PTOBCSCD,PTHLCASM            * same casemix code ?
          GOTO      WROB5000 IF NOT EQUAL
          PACK      KEY30,PTOBCNID,PTOBCODE,PTOBFUND,PTOBTBLT,PTOBCSCD:
                          PTOBBRCD,SP70
          CALL      DEPTOVB1
.
          GOTO      WROB1000
.
WROB5000  PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RSTEMP1
WROB6000  CALL      RKTEMP1
          BRANCH    OVRCD,WROB9999
.
          MOVE      SP70,PTOBCNID
          MOVE      SP3,PTOBCODE             * clear variables before writing
          MOVE      SP6,PTOBFUND
          MOVE      SP3,PTOBTBLT
          MOVE      SP9,PTOBCSCD
          MOVE      SP3,PTOBBRCD
          MOVE      ZERO,PTOBAMNT
.
          MOVE      TEMPCNID,PTOBCNID
          MOVE      TEMPCLMN,PTOBCODE
          MOVE      TEMPHFND,PTOBFUND
          MOVE      TEMPTABT,PTOBTBLT
          MOVE      TEMPCASM,PTOBCSCD
          MOVE      TEMPBRKD,PTOBBRCD
          MOVE      TEMPAMNT,PTOBAMNT
.
          PACK      KEY30,PTOBCNID,PTOBCODE,PTOBFUND,PTOBTBLT,PTOBCSCD:
                          PTOBBRCD,SP70
          CALL      RAPTOVB1
          IF        OVRCD=1
            CALL      WRPTOVB1
          ENDIF
          GOTO      WROB6000
.
WROB9999  RETURN
+
.******************************************************************************
.*                             WRSB0000                                       *
.*                  Write to sameday breakdown tempfile                       *
.******************************************************************************
WRSBT000  CALL      CRTM0000             * Create temp file
.
          PACK      KEY30,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RSTEMP1
WRSBT100  CALL      RKTEMP1
          BRANCH    OVRCD,WRSBT200
.
          MATCH     TEMPCNID,PTLSCNID            * same Contract ID ?
          GOTO      WRSBT200 IF NOT EQUAL
.
          MATCH     TEMPCLMN,PTLSCLMN            * same claim code ?
          GOTO      WRSBT200 IF NOT EQUAL
.
          MATCH     TEMPHFND,PTLSHFND            * same health fund ?
          GOTO      WRSBT200 IF NOT EQUAL
.
          MATCH     TEMPTABT,PTLSTABT            * same table type ?
          GOTO      WRSBT200 IF NOT EQUAL
.
          MATCH     TEMPCASM,PTLSCASM            * same casemix code ?
          GOTO      WRSBT200 IF NOT EQUAL
.
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          CALL      DETEMP1
          GOTO      WRSBT100
.
WRSBT200  PACK      KEY30,SP70
          CALL      RSTEMP2
WRSBT300  CALL      RKTEMP2
          BRANCH    OVRCD,WRSBT500
.
          MATCH     TEMPCNID,PTLSCNID            * same Contract ID ?
          GOTO      WRSBT500 IF NOT EQUAL
.
          MATCH     TEMPCLMN,PTLSCLMN            * same claim code ?
          GOTO      WRSBT500 IF NOT EQUAL
.
          MATCH     TEMPHFND,PTLSHFND            * same health fund ?
          GOTO      WRSBT500 IF NOT EQUAL
.
          MATCH     TEMPTABT,PTLSTABT            * same table type ?
          GOTO      WRSBT500 IF NOT EQUAL
.
          MATCH     TEMPCASM,PTLSCASM            * same casemix code ?
          GOTO      WRSBT500 IF NOT EQUAL
.
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          CALL      DETEMP2
          GOTO      WRSBT300
.
WRSBT500  PACK      KEY30,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RSPTSRB1
WRSBT600  CALL      RKPTSRB1
          BRANCH    OVRCD,WRSBT700
.
          MATCH     PTSBCNID,PTLSCNID            * same Contract ID ?
          GOTO      WRSBT700 IF NOT EQUAL
.
          MATCH     PTSBCODE,PTLSCLMN            * same claim code ?
          GOTO      WRSBT700 IF NOT EQUAL
.
          MATCH     PTSBFUND,PTLSHFND            * same health fund ?
          GOTO      WRSBT700 IF NOT EQUAL
.
          MATCH     PTSBTBLT,PTLSTABT            * same table type ?
          GOTO      WRSBT700 IF NOT EQUAL
.
          MATCH     PTSBCSCD,PTLSCASM            * same casemix code ?
          GOTO      WRSBT700 IF NOT EQUAL
.
          MOVE      SP70,TEMPCNID
          MOVE      SP70,TEMPCLMN             * clear variables before writing
          MOVE      SP70,TEMPHFND
          MOVE      SP70,TEMPTABT
          MOVE      SP70,TEMPCASM
          MOVE      SP70,TEMPBRKD
          MOVE      ZERO,TEMPAMNT
.
          MOVE      PTSBCNID,TEMPCNID
          MOVE      PTSBCODE,TEMPCLMN
          MOVE      PTSBFUND,TEMPHFND 
          MOVE      PTSBTBLT,TEMPTABT
          MOVE      PTSBCSCD,TEMPCASM
          MOVE      PTSBBRCD,TEMPBRKD
          MOVE      PTSBAMNT,TEMPAMNT
.
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          CALL      RATEMP1
          IF        OVRCD=1
            CALL      WRTEMP1
          ENDIF
          GOTO      WRSBT600
.
WRSBT700  PACK      KEY30,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RSPMSIN1
WRSBT800  CALL      RKPMSIN1
          BRANCH    OVRCD,WRSBT999
.
          MATCH     PMSICNID,PTLSCNID            * same Contract ID ?
          GOTO      WRSBT900 IF NOT EQUAL
.
          MATCH     PMSICODE,PTLSCLMN            * same claim code ?
          GOTO      WRSBT900 IF NOT EQUAL
.
          MATCH     PMSIFUND,PTLSHFND            * same health fund ?
          GOTO      WRSBT900 IF NOT EQUAL
.
          MATCH     PMSITBLT,PTLSTABT            * same table type ?
          GOTO      WRSBT900 IF NOT EQUAL
.
          MATCH     PMSICSCD,PTLSCASM            * same casemix code ?
          GOTO      WRSBT900 IF NOT EQUAL
.
          MOVE      SP70,TEMPCNID
          MOVE      SP70,TEMPCLMN             * clear variables before writing
          MOVE      SP70,TEMPHFND
          MOVE      SP70,TEMPTABT
          MOVE      SP70,TEMPCASM
          MOVE      SP70,TEMPBRKD
          MOVE      ZERO,TEMPAMNT
.
          MOVE      PMSICNID,TEMPCNID
          MOVE      PMSICODE,TEMPCLMN
          MOVE      PMSIFUND,TEMPHFND
          MOVE      PMSITBLT,TEMPTABT
          MOVE      PMSICSCD,TEMPCASM
          MOVE      PMSIBKCD,TEMPBRKD
          MOVE      PMSIAMNT,TEMPAMNT
.
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          CALL      RATEMP2
          IF        OVRCD=1
            CALL      WRTEMP2
          ENDIF
          GOTO      WRSBT800
.
WRSBT900
WRSBT999  RETURN
.
.******************************************************************************
.*                             WROBT000                                       *
.*                  Write to overnight breakdown tempfile                     *
.******************************************************************************
WROBT000  CALL      CRTM0000             * Create temp file
.
          PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RSTEMP1
WROBT100  CALL      RKTEMP1
          BRANCH    OVRCD,WROBT200
.
          MATCH     TEMPCNID,PTHLCNID            * same Contract ID ?
          GOTO      WROBT200 IF NOT EQUAL
.
          MATCH     TEMPCLMN,PTHLCLMN            * same claim code ?
          GOTO      WROBT200 IF NOT EQUAL
.
          MATCH     TEMPHFND,PTHLHFND            * same health fund ?
          GOTO      WROBT200 IF NOT EQUAL
.
          MATCH     TEMPTABT,PTHLTABT            * same table type ?
          GOTO      WROBT200 IF NOT EQUAL
.
          MATCH     TEMPCASM,PTHLCASM            * same casemix code ?
          GOTO      WROBT200 IF NOT EQUAL
.
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          CALL      DETEMP1
          GOTO      WROBT100
.
WROBT200  PACK      KEY30,SP70
          CALL      RSTEMP2
WROBT300  CALL      RKTEMP2
          BRANCH    OVRCD,WROBT500
.
          MATCH     TEMPCNID,PTHLCNID            * same Contract ID ?
          GOTO      WROBT500 IF NOT EQUAL
.
          MATCH     TEMPCLMN,PTHLCLMN            * same claim code ?
          GOTO      WROBT500 IF NOT EQUAL
.
          MATCH     TEMPHFND,PTHLHFND            * same health fund ?
          GOTO      WROBT500 IF NOT EQUAL
.
          MATCH     TEMPTABT,PTHLTABT            * same table type ?
          GOTO      WROBT500 IF NOT EQUAL
.
          MATCH     TEMPCASM,PTHLCASM            * same casemix code ?
          GOTO      WROBT500 IF NOT EQUAL
.
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          CALL      DETEMP2
          GOTO      WROBT300
.
WROBT500  PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RSPTOVB1
WROBT600  CALL      RKPTOVB1
          BRANCH    OVRCD,WROBT700
.
          MATCH     PTOBCNID,PTHLCNID            * same Contract ID ?
          GOTO      WROBT700 IF NOT EQUAL
.
          MATCH     PTOBCODE,PTHLCLMN            * same claim code ?
          GOTO      WROBT700 IF NOT EQUAL
.
          MATCH     PTOBFUND,PTHLHFND            * same health fund ?
          GOTO      WROBT700 IF NOT EQUAL
.
          MATCH     PTOBTBLT,PTHLTABT            * same table type ?
          GOTO      WROBT700 IF NOT EQUAL
.
          MATCH     PTOBCSCD,PTHLCASM            * same casemix code ?
          GOTO      WROBT700 IF NOT EQUAL
.
          MOVE      SP70,TEMPCNID
          MOVE      SP70,TEMPCLMN             * clear variables before writing
          MOVE      SP70,TEMPHFND
          MOVE      SP70,TEMPTABT
          MOVE      SP70,TEMPCASM
          MOVE      SP70,TEMPBRKD
          MOVE      ZERO,TEMPAMNT
.
          MOVE      PTOBCNID,TEMPCNID
          MOVE      PTOBCODE,TEMPCLMN
          MOVE      PTOBFUND,TEMPHFND
          MOVE      PTOBTBLT,TEMPTABT
          MOVE      PTOBCSCD,TEMPCASM
          MOVE      PTOBBRCD,TEMPBRKD
          MOVE      PTOBAMNT,TEMPAMNT
.
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          CALL      RATEMP1
          IF        OVRCD=1
            CALL      WRTEMP1
          ENDIF
          GOTO      WROBT600
.
WROBT700  PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RSPTIOV1
WROBT800  CALL      RKPTIOV1
          BRANCH    OVRCD,WROBT999
.
          MATCH     PTIOCNID,PTHLCNID            * same Contract ID ?
          GOTO      WROBT900 IF NOT EQUAL
.
          MATCH     PTIOCODE,PTHLCLMN            * same claim code ?
          GOTO      WROBT900 IF NOT EQUAL
.
          MATCH     PTIOFUND,PTHLHFND            * same health fund ?
          GOTO      WROBT900 IF NOT EQUAL
.
          MATCH     PTIOTBLT,PTHLTABT            * same table type ?
          GOTO      WROBT900 IF NOT EQUAL
.
          MATCH     PTIOCSCD,PTHLCASM            * same casemix code ?
          GOTO      WROBT900 IF NOT EQUAL
.
          MOVE      SP70,TEMPCNID
          MOVE      SP70,TEMPCLMN             * clear variables before writing
          MOVE      SP70,TEMPHFND
          MOVE      SP70,TEMPTABT
          MOVE      SP70,TEMPCASM
          MOVE      SP70,TEMPBRKD
          MOVE      ZERO,TEMPAMNT
.
          MOVE      PTIOCNID,TEMPCNID
          MOVE      PTIOCODE,TEMPCLMN
          MOVE      PTIOFUND,TEMPHFND
          MOVE      PTIOTBLT,TEMPTABT
          MOVE      PTIOCSCD,TEMPCASM
          MOVE      PTIOBRCD,TEMPBRKD
          MOVE      PTIOAMNT,TEMPAMNT
.
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          CALL      RATEMP2
          IF        OVRCD=1
            CALL      WRTEMP2
          ENDIF
          GOTO      WROBT800
.
WROBT900
WROBT999  RETURN
.
.--------------------------------------------------------------------------
.*                             DEDCR000                                   *
.*   Delete records from new daycase revenue breakdown                    *
.--------------------------------------------------------------------------
DEDCR000  PACK      KEY30,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RSPTSRB1
          CALL      RKPTSRB1
          BRANCH    OVRCD,DEDCR999
.
          MATCH     PTSBCNID,PTLSCNID            * same Contract ID ?
          GOTO      DEDCR999 IF NOT EQUAL
.
          MATCH     PTSBCODE,PTLSCLMN            * same claim code ?
          GOTO      DEDCR999 IF NOT EQUAL
.
          MATCH     PTSBFUND,PTLSHFND            * same health fund ?
          GOTO      DEDCR999 IF NOT EQUAL
.
          MATCH     PTSBTBLT,PTLSTABT            * same table type ?
          GOTO      DEDCR999 IF NOT EQUAL
.
          MATCH     PTSBCSCD,PTLSCASM            * same casemix code ?
          GOTO      DEDCR999 IF NOT EQUAL
.
          PACK      KEY30,PTSBCNID,PTSBCODE,PTSBFUND,PTSBTBLT,PTSBCSCD:
                          PTSBBRCD,SP70
          CALL      DEPTSRB1
          GOTO      DEDCR000
.
DEDCR999  RETURN
.--------------------------------------------------------------------------
.*                             DEDCI000                                   *
.*   Delete records from new daycase invoice breakdown                    *
.--------------------------------------------------------------------------
DEDCI000  PACK      KEY30,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
          CALL      RSPMSIN1
          CALL      RKPMSIN1
          BRANCH    OVRCD,DEDCI999
.
          MATCH     PMSICNID,PTLSCNID            * same Contract ID ?
          GOTO      DEDCI999 IF NOT EQUAL
.
          MATCH     PMSICODE,PTLSCLMN            * same claim code ?
          GOTO      DEDCI999 IF NOT EQUAL
.
          MATCH     PMSIFUND,PTLSHFND            * same health fund ?
          GOTO      DEDCI999 IF NOT EQUAL
.
          MATCH     PMSITBLT,PTLSTABT            * same table type ?
          GOTO      DEDCI999 IF NOT EQUAL
.
          MATCH     PMSICSCD,PTLSCASM            * same casemix code ?
          GOTO      DEDCI999 IF NOT EQUAL
.
          PACK      KEY30,PMSICNID,PMSICODE,PMSIFUND,PMSITBLT,PMSICSCD:
                          PMSIBKCD,SP70
          CALL      DEPMSIN1
          GOTO      DEDCI000
.
DEDCI999  RETURN
.
.--------------------------------------------------------------------------
.*                             DEOVR000                                   *
.*   Delete records from new overnight revenue breakdown                  *
.--------------------------------------------------------------------------
DEOVR000  PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RSPTOVB1
          CALL      RKPTOVB1
          BRANCH    OVRCD,DEOVR999
.
          MATCH     PTOBCNID,PTHLCNID            * same Contract ID ?
          GOTO      DEOVR999 IF NOT EQUAL
.
          MATCH     PTOBCODE,PTHLCLMN            * same claim code ?
          GOTO      DEOVR999 IF NOT EQUAL
.
          MATCH     PTOBFUND,PTHLHFND            * same health fund ?
          GOTO      DEOVR999 IF NOT EQUAL
.
          MATCH     PTOBTBLT,PTHLTABT            * same table type ?
          GOTO      DEOVR999 IF NOT EQUAL
.
          MATCH     PTOBCSCD,PTHLCASM            * same casemix code ?
          GOTO      DEOVR999 IF NOT EQUAL
.
          PACK      KEY30,PTOBCNID,PTOBCODE,PTOBFUND,PTOBTBLT,PTOBCSCD:
                          PTOBBRCD,SP70
          CALL      DEPTOVB1
          GOTO      DEOVR000
.
DEOVR999  RETURN
.--------------------------------------------------------------------------
.*                             DEOVI000                                   *
.*   Delete records from new overnight invoice breakdown                  *
.--------------------------------------------------------------------------
DEOVI000  PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CALL      RSPTIOV1
          CALL      RKPTIOV1
          BRANCH    OVRCD,DEOVI999
.
          MATCH     PTIOCNID,PTHLCNID            * same Contract ID ?
          GOTO      DEOVI999 IF NOT EQUAL
.
          MATCH     PTIOCODE,PTHLCLMN            * same claim code ?
          GOTO      DEOVI999 IF NOT EQUAL
.
          MATCH     PTIOFUND,PTHLHFND            * same health fund ?
          GOTO      DEOVI999 IF NOT EQUAL
.
          MATCH     PTIOTBLT,PTHLTABT            * same table type ?
          GOTO      DEOVI999 IF NOT EQUAL
.
          MATCH     PTIOCSCD,PTHLCASM            * same casemix code ?
          GOTO      DEOVI999 IF NOT EQUAL
.
          PACK      KEY30,PTIOCNID,PTIOCODE,PTIOFUND,PTIOTBLT,PTIOCSCD:
                          PTIOBRCD,SP70
          CALL      DEPTIOV1
          GOTO      DEOVI000
.
DEOVI999  RETURN
+
.--------------------------------------------------------------------------
.*                             BRKD0000                                   *
.*   Update breakdown codes                                               *
.--------------------------------------------------------------------------
BRKD0000  MOVE      ZERO,EXIT
          MATCH     ANSA,UPDTTYPE
          GOTO      BRKD1000 IF EQUAL
.
          MATCH     ANSU,UPDTTYPE
          GOTO      BRKD2000 IF EQUAL
.
          MATCH     ANSD,UPDTTYPE
          GOTO      BRKD3000 IF EQUAL
.
          CALL      DETM0000             * delete temp file
          GOTO      BRKD9999
.
BRKD1000  PACK      TEMPCNID,PTLSD012,SP70
          PACK      TEMPCLMN,PTLSD001,SP70
          PACK      TEMPHFND,PTLSD002,SP70
          PACK      TEMPTABT,PTLSD003,SP70
          PACK      TEMPCASM,PTLSD004,SP70
          PACK      TEMPBRKD,PTSRB001,SP70
          MOVE      PTSRB002,TEMPAMNT
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            CALL      RATEMP1
            IF        OVRCD=1
              CALL      WRTEMP1
            ENDIF
          ENDIF
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            CALL      RATEMP2
            IF        OVRCD=1
              CALL      WRTEMP2
            ENDIF
          ENDIF
          GOTO      BRKD9999
.
BRKD2000  PACK      KEY27,PTLSD012,PTLSD001,PTLSD002,PTLSD003,PTLSD004,SP70
          CALL      RDPTLSD1                 * Update into Current File
          BRANCH    OVRCD,BRKD9100
.
BRKD2200  MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            CALL      WRRB0000
            CALL      DETM0000               * delete temp file
            GOTO      BRKD9999
          ENDIF
.
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            CALL      WRIB0000
            CALL      DETM0000               * delete temp file
            GOTO      BRKD9999
          ENDIF
.
          GOTO      BRKD9999
.
BRKD3000  PACK      TEMPCNID,PTLSD012,SP70
          PACK      TEMPCLMN,PTLSD001,SP70
          PACK      TEMPHFND,PTLSD002,SP70
          PACK      TEMPTABT,PTLSD003,SP70
          PACK      TEMPCASM,PTLSD004,SP70
          PACK      TEMPBRKD,BRKDCODE,SP70
          MOVE      PTSRB002,TEMPAMNT
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            CALL      DETEMP1
          ENDIF
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            CALL      DETEMP2
          ENDIF
          GOTO      BRKD9999
.
BRKD9000  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BRKD9999
.
BRKD9100  MOVE      "Missing patlsdaf record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BRKD9999
.
BRKD9999  RETURN
.--------------------------------------------------------------------------
.*                             ORKD0000                                   *
.*   Update breakdown codes                                               *
.--------------------------------------------------------------------------
ORKD0000  MOVE      ZERO,EXIT
          MATCH     ANSA,UPDTTYPE
          GOTO      ORKD1000 IF EQUAL
.
          MATCH     ANSU,UPDTTYPE
          GOTO      ORKD2000 IF EQUAL
.
          MATCH     ANSD,UPDTTYPE
          GOTO      ORKD3000 IF EQUAL
.
          CALL      DETM0000             * delete temp file
          GOTO      ORKD9999
.
ORKD1000  PACK      TEMPCNID,PTHLF013,SP70
          PACK      TEMPCLMN,PTHLF001,SP70
          PACK      TEMPHFND,PTHLF002,SP70
          PACK      TEMPTABT,PTHLF003,SP70
          PACK      TEMPCASM,PTHLF004,SP70
          PACK      TEMPBRKD,PTSRB001,SP70
          MOVE      PTSRB002,TEMPAMNT
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            CALL      RATEMP1
            IF        OVRCD=1
              CALL      WRTEMP1
            ENDIF
          ENDIF
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            CALL      RATEMP2
            IF        OVRCD=1
              CALL      WRTEMP2
            ENDIF
          ENDIF
          GOTO      ORKD9999
.
ORKD2000  PACK      KEY27,PTHLF013,PTHLF001,PTHLF002,PTHLF003,PTHLF004,SP70
          CALL      RDPTHLF1
          BRANCH    OVRCD,ORKD9100
          GOTO      ORKD2200
.
ORKD2200  MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            CALL      WROB0000
            CALL      DETM0000             * delete temp file
            GOTO      ORKD9999
          ENDIF
.
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            CALL      WOIB0000
            CALL      DETM0000             * delete temp file
            GOTO      ORKD9999
          ENDIF
.
          GOTO      ORKD9999
.
ORKD3000  PACK      TEMPCNID,PTHLF013,SP70
          PACK      TEMPCLMN,PTHLF001,SP70
          PACK      TEMPHFND,PTHLF002,SP70
          PACK      TEMPTABT,PTHLF003,SP70
          PACK      TEMPCASM,PTHLF004,SP70
          PACK      TEMPBRKD,BRKDCODE,SP70
          MOVE      PTSRB002,TEMPAMNT
          PACK      KEY30,TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                          TEMPBRKD,SP70
          MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            CALL      DETEMP1
          ENDIF
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            CALL      DETEMP2
          ENDIF
          GOTO      ORKD9999
.
ORKD9000  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ORKD9999
.
ORKD9100  MOVE      "Missing pathlfaf record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BRKD9999
.
ORKD9999  RETURN
.******************************************************************************
.*                             I/O for Temporary file                         *
.******************************************************************************
RATEMP1   RESET     KEY30
          MOVE      ZERO,OVRCD
          READ      TEMPFILE,KEY30;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RSTEMP1   RESET     KEY30
          READ      TEMPFILE,KEY30;;
          RETURN
.
RKTEMP1   MOVE      ZERO,OVRCD
          READKS    TEMPFILE;TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                             TEMPBRKD,TEMPAMNT
          GOTO      OVERCOND IF OVER
          RETURN
.
RDTEMP1   MOVE      ZERO,OVRCD
          RESET     KEY30
          READ      TEMPFILE,KEY30;TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                             TEMPBRKD,TEMPAMNT
          GOTO      OVERCOND IF OVER
          RETURN
.
RPTEMP1   MOVE      ZERO,OVRCD
          READKP    TEMPFILE;TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                             TEMPBRKD,TEMPAMNT
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTEMP1   WRITE     TEMPFILE,KEY30;TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                             TEMPBRKD,TEMPAMNT
          RETURN
.
DETEMP1   RESET     KEY30
          DELETE    TEMPFILE,KEY30
          RETURN
.
UPTEMP1   UPDATE    TEMPFILE;TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                             TEMPBRKD,TEMPAMNT
          RETURN
.
+
RATEMP2   RESET     KEY30
          MOVE      ZERO,OVRCD
          READ      TEMPFIL2,KEY30;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RSTEMP2   RESET     KEY30
          READ      TEMPFIL2,KEY30;;
          RETURN
.
RKTEMP2   MOVE      ZERO,OVRCD
          READKS    TEMPFIL2;TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                             TEMPBRKD,TEMPAMNT
          GOTO      OVERCOND IF OVER
          RETURN
.
RDTEMP2   MOVE      ZERO,OVRCD
          RESET     KEY30
          READ      TEMPFIL2,KEY30;TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                             TEMPBRKD,TEMPAMNT
          GOTO      OVERCOND IF OVER
          RETURN
.
RPTEMP2   MOVE      ZERO,OVRCD
          READKP    TEMPFIL2;TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                             TEMPBRKD,TEMPAMNT
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTEMP2   WRITE     TEMPFIL2,KEY30;TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                             TEMPBRKD,TEMPAMNT
          RETURN
.
DETEMP2   RESET     KEY30
          DELETE    TEMPFIL2,KEY30
          RETURN
.
UPTEMP2   UPDATE    TEMPFIL2;TEMPCNID,TEMPCLMN,TEMPHFND,TEMPTABT,TEMPCASM:
                             TEMPBRKD,TEMPAMNT
          RETURN
.
+
.------------------------------------------------------------------------
. List of Doctor Summary Extract Files
.------------------------------------------------------------------------
EXTFIL00  MOVE      ONE,FILENUM
.  
          CALL      EXTHED00     * Table Heading
.
EXTFIL10  COMPARE   "17",FILENUM
	  GOTO      EXTFIL99 IF EQUAL
.
	  CALL      ETAB0000
          READ      CONTROLF,SEC;*ETABPS,EDATE,EFDATE,ETDATE
.
	  MOVE      FIVE,VERT
	  ADD       FILENUM,VERT
.
          MATCH     SP8,EDATE
	  GOTO      EXTFIL20 IF EQUAL
.
          UNPACK    EDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      EXCDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    EFDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      EXFDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    ETDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      EXTDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          CALL      EXTRW000        * Table Row
.
          ADD       ONE,FILENUM
	  GOTO      EXTFIL10
.
EXTFIL20  ADD       ONE,FILENUM
	  GOTO      EXTFIL10
.
EXTFIL99  RETURN
.------------------------------------------------------------
.  Doctor Summary Extract Fle (TABLE HEADING)
.------------------------------------------------------------
EXTHED00  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Ext File No.</td>":
                               "<td class=HeadingCell width=30%>":
                               "Created</td>":
                               "<td class=HeadingCell width=30%>":
                               "Period Covered</td>":
                             "</tr>"
.
EXTHED99  RETURN
.------------------------------------------------------------
.  Doctor Summary Extract Fle (TABLE Row)
.------------------------------------------------------------
EXTRW000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:UpdateField":
                             "(#"",FILENUM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             FILENUM,"</td>":
                             "<td>",EXCDATE,"</td>":
                             "<td>",EXFDATE," to ",EXTDATE,"</td>":
                             "</tr>"
.
EXTRW999  RETURN
.------------------------------------------------------------------------
.       CALCULATE SEC AND TAB POS FOR DATES
.------------------------------------------------------------------------
ETAB0000  MOVE      FILENUM,ETABPS
	  MOVE      TEN1,SEC       ***** SECTOR 11 & 12
	  COMPARE   "9",ETABPS
	  GOTO      ETAB1000 IF LESS
          SUB       "8",ETABPS
          ADD       ONE,SEC
.
ETAB1000  MULT      "30",ETABPS
	  SUB       "29",ETABPS
.
ETAB9999  RETURN
.------------------------------------------------------------------------
.           CALCULATE SEC AND TAB POS FOR TOTAL VALUES
.------------------------------------------------------------------------
ETOTPS00  MOVE      FILENUM,ETABPS
          MOVE      "93",SEC       ***** SECTOR 93,94,95
.
          COMPARE   "8",ETABPS
          GOTO      ETOTPS20 IF LESS
.
          COMPARE   "15",ETABPS
          GOTO      ETOTPS10 IF LESS
.
          SUB       "7",ETABPS
          ADD       ONE,SEC
.
ETOTPS10  SUB       "7",ETABPS
          ADD       ONE,SEC
.
ETOTPS20  MULT      "34",ETABPS
          SUB       "33",ETABPS
.
ETOTPS99  RETURN
.------------------------------------------------------------
.* Output table of valid contract procedure codes 
.* Requires       : CPROCODE -Procedure Code                                  *
.*                : PROCSURG -Surgeon                                         *
.*                : PROCCNTR -Contract                                        *
.*                : PROCCLMC -Claim code                                      *
.*                : PROCADAT -Admission Date                                  *
.*                : PROCHOSP -Hospital Code                                   *
.*                : PROCWARD -WardCode                                        *
.----------------------------------------------------------------------
TABCON00  MOVE      ZERO,FOUNDFLG
          MOVE      ZERO,LOOPFLAG
          PACK      SAVPCNTR,PROCCNTR,SP70
TABCON10  MOVE      "E",NZCMRTYP         * Either
          MOVE      "0",NZCMITYP         * set record flag to 0 for Procedure
          PACK      SKEY20,PROCCLMC,PROCCNTR,NZCMRTYP,NZCMITYP,CPROCODE,SP70
.
          PACK      KEY35,SKEY20,SP70
          CALL      RSNZCMT3
TABCON20  CALL      RKNZCMT3
          BRANCH    OVRCD,TABCON60
.
          PACK      KEY20,NZCMCLMC,NZCMCNTR,NZCMRTYP,NZCMITYP,NZCMPROC,SP70
          MATCH     SKEY20,KEY20
          GOTO      TABCON60 IF NOT EQUAL
.
          PACK      PROCCNTR,SAVPCNTR,SP70
          CALL      CCFN0000             * Check Contract funding
          BRANCH    EXIT,TABCON20        * Not valid
.
          PACK      KEY9,NZCMCPRC,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,TABCON20
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:UpdateParent":
                             "(#"",NZCMCPRC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             NZCMCPRC,"-",PTCADES1:
                             "</td><td>",PROCCLMC,"&nbsp;</td>":
                             "<td>",PROCCNTR,"&nbsp;</td>":
                             "<td>",PROCSURG,"&nbsp;</td>":
                             "<td>",CPROCODE,"&nbsp;</td></tr>";
          MOVE      ONE,FOUNDFLG
          GOTO      TABCON20
.
.         Using default if no match found
.
TABCON60  COMPARE   ZERO,FOUNDFLG
          GOTO      TABCON99 IF NOT EQUAL  * found a matching record
.
          ADD       ONE,LOOPFLAG
          BRANCH    LOOPFLAG,TABCON70    * try with the default
.
          GOTO      TABCON99
.
.         Try with blank contract/health fund
.
TABCON70  MOVE      SP70,PROCCNTR        * blank contract
          GOTO      TABCON10
.
TABCON99  RETURN
+
.******************************************************************************
. ----- Check the Contract Funding file ------
.******************************************************************************
CCFN0000  MOVE      ZERO,EXIT
          MOVE      ZERO,DEFFLAG
          MATCH     SP70,PROCHOSP
          GOTO      CCFN0500 IF NOT EQUAL
.
          MATCH     SP70,PROCWARD
          GOTO      CCFN0500 IF EQUAL
.
          PACK      KEY6,PROCWARD,SP70
          CALL      RDWARD1
          BRANCH    OVRCD,CCFN0500
          PACK      PROCHOSP,PTWDHOSN,SP70
.
CCFN0500  MOVE      ONE,NZCFSTYP           * default start type
          MOVE      ZERO,FORM1
          PACK      SKEY21,PROCHOSP,PROCCLMC,PROCCNTR,NZCMCPRC,SP70
.
CCFN2000  PACK      KEY30,SKEY21,ONE,SP70
          CALL      RSNZCFN1
          CALL      RKNZCFN1
          BRANCH    OVRCD,CCFN2200
          PACK      KEY21,NZCFHOSP,NZCFCLMC,NZCFCNTR,NZCFCPRC,SP70
.
          MATCH     KEY21,SKEY21
          GOTO      CCFN5000 IF EQUAL        * check the start and enddate
.
.         Try with Claim code,blank Health fund and Contract procedure code
.
CCFN2200  IF        DEFFLAG=7
            MOVE      EIGHT,DEFFLAG
            PACK      SKEY21,SP3,PROCCLMC,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=6
            MOVE      SEVEN,DEFFLAG
            PACK      SKEY21,SP3,PROCCLMC,SP6,NZCMCPRC,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=5
            MOVE      SIX,DEFFLAG
            PACK      SKEY21,SP3,PROCCLMC,PROCCNTR,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=4
            MOVE      FIVE,DEFFLAG
            PACK      SKEY21,SP3,PROCCLMC,PROCCNTR,NZCMCPRC,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=3
            MOVE      FOUR,DEFFLAG
            PACK      SKEY21,PROCHOSP,PROCCLMC,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=2
            MOVE      THREE,DEFFLAG
            PACK      SKEY21,PROCHOSP,PROCCLMC,SP6,NZCMCPRC,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=1
            MOVE      TWO,DEFFLAG
            PACK      SKEY21,PROCHOSP,PROCCLMC,PROCCNTR,SP6,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=8
            GOTO       CCFN9000
          ENDIF
.
.
.         Try with blank Health fund
.
          PACK      SKEY21,PROCHOSP,PROCCLMC,SP6,NZCMCPRC,SP70
          MOVE      ONE,DEFFLAG
          GOTO      CCFN2000
.
.         Check the admission date
.
CCFN5000  REP       " 0",PROCADAT
.
.         If patient admitted before the start date, No Contract
.
          MATCH     NZCFSDAT,PROCADAT       * Admit./disc.before start date?
          GOTO      CCFN2200 IF LESS        * Yes, invalid
.
          MATCH     SP70,NZCFEDAT
          GOTO      CCFN7000 IF EQUAL       * No end date, so it's valid
.
          MATCH     PROCADAT,NZCFEDAT       * Check End date
          GOTO      CCFN2200 IF LESS        * Date is after end date, invalid
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          COMPARE   ONE,IBCNMHOS
          GOTO      CCFN8000 IF NOT EQUAL
.
.         Check if this is for a specific Doctor
.
CCFN7000  MATCH     "1",NZCFDOCS
          GOTO      CCFN8000 IF NOT EQUAL   * Not for a specific doctor
.
          PACK      KEY40,NZCFHOSP,NZCFCLMC,NZCFCNTR,NZCFCPRC,NZCFSTYP:
                          NZCFSDAT,PROCSURG,SP70
          CALL      RDMLCFN1
          BRANCH    OVRCD,CCFN2200          * not valid for this hospital
.
CCFN8000  MOVE      ZERO,EXIT
          GOTO      CCFN9999
.
CCFN9000  MOVE      ONE,EXIT
CCFN9999  RETURN
.
+
.------------------------------------------------------------
. Multiple Procedures Details
.------------------------------------------------------------
MLPR0000  BRANCH    FLDITMNO,MLPR0100,MLPR0200,MLPR0300,MLPR0400,MLPR0500:
                             MLPR0600,MLPR0700,MLPR0800,MLPR0900,MLPR1000:
                             MLPR1100,MLPR1200
.
MLPR0100  CALL      NEXTPR00
          GOTO      MLPR9999
.
MLPR0200  CALL      PREVPR00
          GOTO      MLPR9999
.
MLPR0300  CALL      MPRLST00
          GOTO      MLPR9999
.
MLPR0400  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      PMMPR001,CODE
          CALL      CODITM00
          GOTO      MLPR9999
.
MLPR0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     Z70,PMMPR002
          GOTO      MLPR9999 IF EQUAL
.
          BRANCH    F1,MLPR0510
          WRITE     HTMLFILE;PMMPR002;       * Health Fund
          GOTO      MLPR9999
.
MLPR0510  MATCH     SP70,PMMPR002
          GOTO      MLPR9999 IF EQUAL
          PACK      KEY14,PMMPR002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,MLPR9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      MLPR9999
.
MLPR0600  MOVE      "HT",CATEGORY            * Table Type
          MOVE      PMMPR003,CODE
          CALL      CODITM00
          GOTO      MLPR9999
.
MLPR0700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     Z70,PMMPR004
          GOTO      MLPR9999 IF EQUAL
.
          WRITE     HTMLFILE;PMMPR004;      * Multiple Procedure Code
          GOTO      MLPR9999
.
MLPR0800  WRITE     HTMLFILE;FILEFLAG;
          GOTO      MLPR9999
.
MLPR0900  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"New File";
          ELSE
            WRITE     HTMLFILE;"Current File";
          ENDIF
          GOTO      MLPR9999
.
MLPR1000  WRITE     HTMLFILE;NEWFLAG;
          GOTO      MLPR9999
.
MLPR1100  CALL      TABPRC00               * Table of Procedures
          GOTO      CASM9999
.
MLPR1200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,MLPR1210
          MATCH     Z70,PMMPR009
          IF        @EQUAL
            MOVE      SP70,PMMPR009
          ENDIF
          WRITE     HTMLFILE;PMMPR009;      * Contract Id. Code
          GOTO      MLPR9999
.
MLPR1210  MOVE      PMMPR009,KEY6
          CALL      RDPMCID1                * Contract Id.
          BRANCH    OVRCD,MLPR9999
          WRITE     HTMLFILE;PMCIDESC;      * Contract Id. Desc.
          GOTO      MLPR9999
.
MLPR9999  RETURN
+
.------------------------------------------------------------
. Table of Multiple Procedures Details
.------------------------------------------------------------
MPRLST00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP3,PMMPR001
          IF        @EQUAL
            MATCH     SP6,PMMPR009
            GOTO      MPRLST99 IF EQUAL
            MOVE      ONE,INDEX
            PACK      KEY28,PMMPR009,SP70
            CALL      RSPMMPR1
          ELSE
            MOVE      FOUR,INDEX
            PACK      KEY28,PMMPR001,SP70
            CALL      RSPMMPR4
          ENDIF
.
MPRLST05  IF        INDEX = 1
            CALL      RKPMMPR1
            BRANCH    OVRCD,MPRLST99
            MATCH     PMMPR009,PMMPCNID
            GOTO      MPRLST90 IF NOT EQUAL
          ELSE
            CALL      RKPMMPR4
            BRANCH    OVRCD,MPRLST99
            MATCH     PMMPR001,PMMPCCOD
            GOTO      MPRLST90 IF NOT EQUAL
          ENDIF
.
          COMPARE   ZERO,PMMPCOUN
          GOTO      MPRLST05 IF NOT EQUAL
.
          MATCH     SP70,PMMPR001
          IF        !@EQUAL
            MATCH     PMMPR001,PMMPCCOD
            GOTO      MPRLST05 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMMPR009
          IF        !@EQUAL
            MATCH     PMMPR009,PMMPCNID
            GOTO      MPRLST05 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMMPR002
          IF        !@EQUAL
            MATCH     PMMPR002,PMMPHFUN
            GOTO      MPRLST05 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMMPR003
          IF        !@EQUAL
            MATCH     PMMPR003,PMMPHFTY
            GOTO      MPRLST05 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MPRLST05
          ENDIF
.
          CALL      MPRROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MPRLST05 IF NOT EQUAL
          GOTO      MPRLST99
.
MPRLST90  CALL      NOMORE00     * Display No More Records Message
.
MPRLST99  RETURN
+
.------------------------------------------------------------
. Multiple Procedures Table (TABLE ROW)
.------------------------------------------------------------
MPRROW00  MOVE      SP70,TDESC
          MATCH     SP70,PMMPCCOD
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,PMMPCCOD,SP70
            CALL      RDCODE1
          ENDIF
.
          MOVE      SP70,PMCIDESC
          MATCH     SP70,PMMPCNID
          IF        !@EQUAL
            PACK      KEY6,PMMPCNID
            CALL      RDPMCID1
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"javascript:ShowMProc":
                             "('",PMMPCNID,"',":
                             "'",PMMPCCOD,"',":
                             "'",PMMPHFUN,"',":
                             "'",PMMPHFTY,"',":
                             "'",PMMPMPRC,"',":
                             "'",PMMPCOUN,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMMPMPRC,"</td>":
                             "<td>",PMCIDESC,"&nbsp;</td>":
                             "<td>",TDESC,"&nbsp;</td>":
                             "<td>",PMMPHFUN,"&nbsp;</td>":
                             "<td>",PMMPHFTY,"&nbsp;</td>":
                             "<td>",PMMPPAMT,"&nbsp;</td>":
                             "<td>",PMMPRAMT,"&nbsp;</td>":
                             "</tr>"
.
MPRROW99 RETURN
+
.------------------------------------------------------------
. Table of Procedures
.------------------------------------------------------------
TABPRC00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,PMMPR001
          GOTO      TABPRC99 IF EQUAL
.
          PACK      KEY28,PMMPR009,PMMPR001,PMMPR002,PMMPR003,PMMPR004,SP70
          CALL      RSPMMPR1
TABPRC05  CALL      RKPMMPR1
          BRANCH    OVRCD,TABPRC99
.
          MATCH     PMMPR009,PMMPCNID
          GOTO      TABPRC99 IF NOT EQUAL
.
          MATCH     PMMPR001,PMMPCCOD
          GOTO      TABPRC99 IF NOT EQUAL
.
          COMPARE   ZERO,PMMPCOUN
          IF        @EQUAL
            GOTO      TABPRC05
          ENDIF
.
          MATCH     PMMPR002,PMMPHFUN
          GOTO      TABPRC99 IF NOT EQUAL
.
          MATCH     PMMPR003,PMMPHFTY
          GOTO      TABPRC99 IF NOT EQUAL
.
          MATCH     PMMPR004,PMMPMPRC
          GOTO      TABPRC99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TABPRC05
          ENDIF
.
          MOVE      PMMPITMN,KEY9
          PACK      KEY17,KEY9,SP70
          CALL      PATITMRD
          IF        OVRCD=1
            MOVE      SP70,IDESC
          ENDIF
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"javascript:UpdateMProc":
                             "('",PMMPCNID,"',":
                             "'",PMMPCCOD,"',":
                             "'",PMMPHFUN,"',":
                             "'",PMMPHFTY,"',":
                             "'",PMMPMPRC,"',":
                             "'",PMMPCOUN,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMMPITMN,"</td>":
                             "<td>",IDESC,"</td>":
                             "</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      TABPRC05
          ENDIF
.
TABPRC99  RETURN
.
.-------------------------------------------------------------------------
. Link to Next Multiple procedures
.-------------------------------------------------------------------------
NEXTPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PMMPR001
          REP       " +",PMMPR002
          REP       " +",PMMPR003
.
          WRITE     HTMLFILE;"patweb63.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmmpr001=",PMMPR001:
                                 "&pmmpr002=",PMMPR002:
                                 "&pmmpr003=",PMMPR003:
                                 "&fileflag=",FILEFLAG;
.
          REP       "+ ",PMMPR001
          REP       "+ ",PMMPR002
          REP       "+ ",PMMPR003
.
NEXTPR99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Casemix Matrix
.-------------------------------------------------------------
PREVPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PMMPR001
          REP       " +",PMMPR002
          REP       " +",PMMPR003
.
          WRITE     HTMLFILE;"patweb63.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmmpr001=",PMMPR001:
                                 "&pmmpr002=",PMMPR002:
                                 "&pmmpr003=",PMMPR003:
                                 "&fileflag=",FILEFLAG;
.
          REP       "+ ",PMMPR001
          REP       "+ ",PMMPR002
          REP       "+ ",PMMPR003
.
PREVPR99  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of patlsdaf record
.------------------------------------------------------------
ALSD0000  MOVE      "patlsdaf",PMDCFILE
          MOVE      PTLSCNID,PMDCCONT
          PACK      PMDCRKEY,PTLSCNID,PTLSCLMN,PTLSHFND,PTLSTABT,PTLSCASM,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR 
.
          MOVE      ZERO,F3
.
ALSD1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      ALSD1000
          ENDIF
.
ALSD9999  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of patasdaf record
.------------------------------------------------------------
AASD0000  MOVE      "patasdaf",PMDCFILE
          MOVE      PTADCNID,PMDCCONT
          PACK      PMDCRKEY,PTADCNID,PTADCLMN,PTADHFND,PTADTABT,PTADCASM:
                             PTADBTYP,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
AASD1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      AASD1000
          ENDIF
.
AASD9999  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of pathlfaf record
.------------------------------------------------------------
AHLF0000  MOVE      "pathlfaf",PMDCFILE
          MOVE      PTHLCNID,PMDCCONT
          PACK      PMDCRKEY,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
AHLF1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      AHLF1000
          ENDIF
.
AHLF9999  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of patldfaf record
.------------------------------------------------------------
ALDF0000  MOVE      "patldfaf",PMDCFILE
          MOVE      PTLDCNID,PMDCCONT
          PACK      PMDCRKEY,PTLDCNID,PTLDCLMN,PTLDHFND,PTLDTABT,PTLDCASM:    
                             PTLDEDAY,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
ALDF1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      ALDF1000
          ENDIF
.
ALDF9999  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of pathdfaf record
.------------------------------------------------------------
AHDF0000  MOVE      "pathdfaf",PMDCFILE
          MOVE      PTHDCNID,PMDCCONT
          PACK      PMDCRKEY,PTHDCNID,PTHDCLMN,PTHDHFND,PTHDTABT,PTHDCASM:
                             PTHDEDAY,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
AHDF1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      AHDF1000
          ENDIF
.
AHDF9999  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of patafeaf record
.------------------------------------------------------------
AAFE0000  MOVE      "patafeaf",PMDCFILE
          MOVE      PTFECNID,PMDCCONT
          PACK      PMDCRKEY,PTFECNID,PTFECLMN,PTFEHFND,PTFETABT,PTFECASM:
                             PTFEBTYP,PTFEEDAY,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
AAFE1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      AAFE1000
          ENDIF
.
AAFE9999  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of pmscmtaf record
.------------------------------------------------------------
ACMT0000  MOVE      "pmscmtaf",PMDCFILE
          MOVE      PMCCCONT,PMDCCONT
          PACK      PMDCRKEY,PMCCCCOD,PMCCCONT,PMCCHFUN,PMCCHFTY,PMCCTYPE:
                             PMCCCMCD,PMCCCNTR,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
ACMT1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      ACMT1000
          ENDIF
.
ACMT9999  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
+
.
.------------------------------------------------------------
.
          INC       IBAWEBCD
          INC       WEBDATCD
.
          INC       PMSCIDIO/INC
          INC       PATDO1IO/INC   * Doctor File
          INC       PATMI1IO/INC
          INC       PATMA1IO/INC
          INC       PATVISIO/INC   * Patients Visits File
          INC       PMSVX1IO/INC   * Visit Extension File
          INC       PATALRIO/INC
          INC       PATICDIO/INC
          INC       PATICOIO/INC
          INC       OUTSITIO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PATPR1IO/INC
          INC       PMSDCAIO/INC
          INC       PMSPX2IO/INC
          INC       PATFN1IO/INC
          INC       PATWR1IO/INC
          INC       MRTMASIO/INC
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       PATRE1IO/INC
          INC       PATDGWIO/INC
          INC       PATITMIO/INC
          INC       PATDADIO/INC
          INC       PATVADIO/INC
          INC       PATCMCIO/INC
          INC       PATCMXIO/INC
          INC       PATASDIO/INC
          INC       PATLSDIO/INC
          INC       PATHLFIO/INC
          INC       PATHDFIO/INC
          INC       PATLDFIO/INC
          INC       PATAFEIO/INC
          INC       PATOVBIO/INC
          INC       PATIOVIO/INC
          INC       PATSRBIO/INC
          INC       PMSSINIO/INC
          INC       PMSCMTIO/INC
          INC       PATCMTIO/INC
          INC       PATASFIO/INC
.
          INC       PMSCCDIO/INC   * Concession Card Details
          INC       PMSHCGIO/INC
          INC       PMSHCPIO/INC
          INC       APSMASIO/INC
          INC       PATIN1IO/INC
          INC       PATDSCIO/INC
          INC       PATMCHIO/INC
          INC       PATHSPIO/INC
          INC       PMSMPRIO/INC
.
          INC       NZPMCHIO/INC
          INC       MLTCFNIO/INC
          INC       NZPCMTIO/INC
          INC       NZPCM1IO/INC
          INC       NZPCFNIO/INC
.
          INC       CMXRULES
          INC       PATITMRD
          INC       PMSMPRTM
          INC       NZPCMTTM
          INC       CLNHIMAS                   * Clear nhimasaf file variables
          INC       CLPMSPX2
          INC       CLPMSCMT
          INC       PATMASTM
          INC       PATDOCTM
          INC       PMSHCGTM
          INC       PMSHCPTM
          INC       PATDSCTM
          INC       PMSCMTTM
          INC       PATSMDTM
          INC       PATOVNTM
          INC       PMSPX2TM
          INC       PATMSXTM
          INC       PATDOCCD
          INC       CALCAGE
          INC       NAMSTRCD
          INC       DAYOFWEK
          INC       RSHWEBCD
          INC       PATGEXT
          INC       TFILENAM


. *----------------------------------------------------------------------
. * Include Name  :   MLTHCPTM.PBL
. *
. * Function      :   CGI variables for MLTHCPFD - mlthcpaf.dat
. *
. * Includes Needed :
. *
. *----------------------------------------------------------------------
.  Modifications Done :
.
.  V10.03.01  12/02/2012  Jill Parkinson CAR 255142
.             Added MLHCSTAT values 11,12 and 13
.  V10.02.00  02/06/2011  Davin         CAR 240723
.             Created include
.------------------------------------------------------------------------
.   Clear parameters for multihosp hcp file
.------------------------------------------------------------------------
CPMLHC00  MOVE      Z70,MLHCP001
          MOVE      Z70,MLHCP002
          MOVE      Z70,MLHCP003
          MOVE      Z70,MLHCP004
          MOVE      Z70,MLHCP005
          MOVE      Z70,MLHCP006
          MOVE      Z70,MLHCP007
          MOVE      Z70,MLHCP008
          MOVE      Z70,MLHCP009
          MOVE      Z70,MLHCP010
          MOVE      Z70,MLHCP011
          MOVE      Z70,MLHCP012
          MOVE      Z70,MLHCP013
          MOVE      Z70,MLHCP014
CPMLHC99  RETURN
.------------------------------------------------------------
. Tags for multihosp hcp table
.------------------------------------------------------------
MLHC0000  BRANCH    FLDITMNO,MLHC0010,MLHC0020,MLHC0030,MLHC0040,MLHC0050:
                             MLHC0060,MLHC0070,MLHC0080,MLHC0090,MLHC0100:
                             MLHC0110,MLHC0120,MLHC0130,MLHC0140,MLHC0150
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MLHC9999
.
MLHC0010  WRITE     HTMLFILE;MLHCHOSP;
          GOTO      MLHC9999
.
MLHC0020  WRITE     HTMLFILE;MLHCHCPC;
          GOTO      MLHC9999
.
MLHC0030  WRITE     HTMLFILE;MLHCHSRI;
          GOTO      MLHC9999
.
MLHC0040  WRITE     HTMLFILE;MLHCPROV;
          GOTO      MLHC9999
.
MLHC0050  CALL      MHCSTA00                * HCP status selection
          GOTO      MLHC9999
.
MLHC0060  MOVE      "DL",CATEGORY
          MOVE      MLHCOSLV,CODE
          CALL      CODITM00
          GOTO      MLHC9999
.
MLHC0070  MATCH     MLHCSDAT,SP70
          GOTO      MLHC9999 IF EQUAL
.
          UNPACK    MLHCSDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MLHC9999
.
MLHC0080  MATCH     MLHCEDAT,SP70
          GOTO      MLHC9999 IF EQUAL
.
          UNPACK    MLHCEDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MLHC9999
.
MLHC0090  MOVE      "AT",CATEGORY
          MOVE      MLHCATYP,CODE
          CALL      CODITM00
          GOTO      MLHC9999
.
MLHC0100  MATCH     MLHCDFAC,SP70
          GOTO      MLHC9999 IF EQUAL
.
          UNPACK    MLHCDFAC,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MLHC9999
.
MLHC0110  MATCH     MLHCDLAC,SP70
          GOTO      MLHC9999 IF EQUAL
.
          UNPACK    MLHCDLAC,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MLHC9999
.
MLHC0120  WRITE     HTMLFILE;MLHCYACC;
          GOTO      MLHC9999
.
MLHC0130  MATCH     MLHCDEAC,SP70
          GOTO      MLHC9999 IF EQUAL
.
          UNPACK    MLHCDEAC,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MLHC9999
.
MLHC0140  WRITE     HTMLFILE;MLHCACTV;
          GOTO      MLHC9999
.
MLHC0150  CALL      HCPHSL00                * Hospital code selection
          GOTO      MLHC9999
.
MLHC9999  RETURN
.
.------------------------------------------------------------
.   Set Parameters for multihosp hcp table
.------------------------------------------------------------
SPMLC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPMLC001,SPMLC002,SPMLC003,SPMLC004,SPMLC005:
                       SPMLC006,SPMLC007,SPMLC008,SPMLC009,SPMLC010:
                       SPMLC011,SPMLC012,SPMLC013,SPMLC014
.
          MOVE      ONE,EXIT
          GOTO      SPMLC999
.
SPMLC001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,MLHCP001
          PACK      MLHCP001,MLHCP001,SP70
          GOTO      SPMLC999
.
SPMLC002  SQUEEZE   QRYDATA
          MOVE      QRYDATA,MLHCP002
          PACK      MLHCP002,MLHCP002,SP70
          GOTO      SPMLC999
.
SPMLC003  MOVE      QRYDATA,MLHCP003
          GOTO      SPMLC999
.
SPMLC004  MOVE      QRYDATA,MLHCP004
          GOTO      SPMLC999
.
SPMLC005  MOVE      QRYDATA,MLHCP005
          GOTO      SPMLC999
.
SPMLC006  MOVE      QRYDATA,MLHCP006
          GOTO      SPMLC999
.
SPMLC007  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MLHCP007,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMLC999
.
SPMLC008  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MLHCP008,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMLC999
.
SPMLC009  MOVE      QRYDATA,MLHCP009
          GOTO      SPMLC999
.
SPMLC010  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MLHCP010,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMLC999
.
SPMLC011  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MLHCP011,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMLC999
.
SPMLC012  MOVE      QRYDATA,MLHCP012
          GOTO      SPMLC999
.
SPMLC013  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MLHCP013,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMLC999
.
SPMLC014  MOVE      QRYDATA,MLHCP014
          GOTO      SPMLC999
.
SPMLC999  RETURN
.
.------------------------------------------------------------
.  Update multihosp hcp details
.------------------------------------------------------------
MVMLHC00  MATCH     MLHCP001,Z70
          IF        !@EQUAL
            MOVE      MLHCP001,MLHCHOSP
          ENDIF
.
          MATCH     MLHCP002,Z70
          IF        !@EQUAL
            MOVE      MLHCP002,MLHCHCPC
          ENDIF
.
          MATCH     MLHCP003,Z70
          IF        !@EQUAL
            MOVE      MLHCP003,MLHCHSRI
          ENDIF
.
          MATCH     MLHCP004,Z70
          IF        !@EQUAL
            MOVE      MLHCP004,MLHCPROV
          ENDIF
.
          MATCH     MLHCP005,Z70
          IF        !@EQUAL
            MOVE      MLHCP005,MLHCSTAT
          ENDIF
.
          MATCH     MLHCP006,Z70
          IF        !@EQUAL
            MOVE      MLHCP006,MLHCOSLV
          ENDIF
.
          MATCH     MLHCP007,Z70
          IF        !@EQUAL
            MOVE      MLHCP007,MLHCSDAT
          ENDIF
.
          MATCH     MLHCP008,Z70
          IF        !@EQUAL
            MOVE      MLHCP008,MLHCEDAT
          ENDIF
.
          MATCH     MLHCP009,Z70
          IF        !@EQUAL
            MOVE      MLHCP009,MLHCATYP
          ENDIF
.
          MATCH     MLHCP010,Z70
          IF        !@EQUAL
            MOVE      MLHCP010,MLHCDFAC
          ENDIF
.
          MATCH     MLHCP011,Z70
          IF        !@EQUAL
            MOVE      MLHCP011,MLHCDLAC
          ENDIF
.
          MATCH     MLHCP012,Z70
          IF        !@EQUAL
            MOVE      MLHCP012,MLHCYACC
          ENDIF
.
          MATCH     MLHCP013,Z70
          IF        !@EQUAL
            MOVE      MLHCP013,MLHCDEAC
          ENDIF
.
          MATCH     "2",MLHCP014
          IF        @EQUAL
            MOVE      ZERO,MLHCACTV       * active
          ELSE
            MOVE      ONE,MLHCACTV        * not active
          ENDIF
.
MVMLHC99  RETURN
+
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
HCPHSL00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,MLHCHOSP
          GOTO      HCPHSL20 IF EQUAL
.         
          PACK      KEY3,MLHCHOSP
          CALL      RDPTHSP1
          BRANCH    OVRCD,HCPHSL20
.         
          BRANCH    F1,HCPHSL10,HCPHSL20
          WRITE     HTMLFILE;PTHSHOSP;
          GOTO      HCPHSL99
.
HCPHSL10  WRITE     HTMLFILE;PTHSNAME;
          GOTO      HCPHSL99
.
HCPHSL20  CALL      MHCPL000
.
HCPHSL99  RETURN
.------------------------------------------------------------
. Hospital Selection List
.------------------------------------------------------------
MHCPL000  IF        IBCNMHOS=1
            OPEN      MLTSECA1,"mltsecaf"
          ENDIF
.
          PACK      KEY3,SP70
          CALL      RSPTHSP1
MHCPL100  CALL      RKPTHSP1
          BRANCH    OVRCD,MHCPL999
.
          IF        IBCNMHOS=1
            PACK      KEY13,USERID,SP70               * All hospital access
            CALL      RDMLSEC1
            IF        OVRCD=1
              PACK      KEY13,USERID,PTHSHOSP,SP70    * This hospital access
              CALL      RDMLSEC1
              BRANCH    OVRCD,MHCPL100
            ENDIF
          ENDIF
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     MLHCHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",PTHSNAME,"</option>"
          ENDIF
          GOTO      MHCPL100
.
MHCPL999  RETURN
+
.------------------------------------------------------------
. HCP Status Selection
.------------------------------------------------------------
MHCSTA00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          PACK      DISPNAME,SP70
.
          BRANCH    F1,MHCSTA01,MHCSTA02
.
          MOVE      PMHCP130,DISPNAME
          LOAD      DISPNAME,MLHCSTAT,PMHCP131,PMHCP132,PMHCP133,PMHCP134:
                                      PMHCP135,PMHCP136,PMHCP137,PMHCP138:
                                      PMHCP139,PMHCP140,PMHCP141,PMHCP142:
                                      PMHCP143
          WRITE     HTMLFILE;DISPNAME
          GOTO      MHCSTA99
.
MHCSTA01  WRITE     HTMLFILE;MLHCSTAT;
          GOTO      MHCSTA99
.
MHCSTA02  IF        MLHCSTAT=0
            WRITE     HTMLFILE;"<option value=0 selected>",PMHCP130,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=0>",PMHCP130,"</option>";
          ENDIF
.
          IF        MLHCSTAT=1
            WRITE     HTMLFILE;"<option value=1 selected>",PMHCP131,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=1>",PMHCP131,"</option>";
          ENDIF
.
          IF        MLHCSTAT=2
            WRITE     HTMLFILE;"<option value=2 selected>",PMHCP132,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=2>",PMHCP132,"</option>";
          ENDIF
.
          IF        MLHCSTAT=3
            WRITE     HTMLFILE;"<option value=3 selected>",PMHCP133,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=3>",PMHCP133,"</option>";
          ENDIF
.
          IF        MLHCSTAT=4
            WRITE     HTMLFILE;"<option value=4 selected>",PMHCP134,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=4>",PMHCP134,"</option>";
          ENDIF
.
          IF        MLHCSTAT=5
            WRITE     HTMLFILE;"<option value=5 selected>",PMHCP135,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=5>",PMHCP135,"</option>";
          ENDIF
.
          IF        MLHCSTAT=6
            WRITE     HTMLFILE;"<option value=6 selected>",PMHCP136,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=6>",PMHCP136,"</option>";
          ENDIF
.
          IF        MLHCSTAT=11
            WRITE     HTMLFILE;"<option value=11 selected>",PMHCP141,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=11>",PMHCP141,"</option>";
          ENDIF
.
          IF        MLHCSTAT=12
            WRITE     HTMLFILE;"<option value=12 selected>",PMHCP142,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=12>",PMHCP142,"</option>";
          ENDIF
.
          IF        MLHCSTAT=13
            WRITE     HTMLFILE;"<option value=13 selected>",PMHCP143,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=13>",PMHCP143,"</option>";
          ENDIF
.
          IF        MLHCSTAT=7
            WRITE     HTMLFILE;"<option value=7 selected>",PMHCP137,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=7>",PMHCP137,"</option>";
          ENDIF
.
          IF        MLHCSTAT=8
            WRITE     HTMLFILE;"<option value=8 selected>",PMHCP138,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=8>",PMHCP138,"</option>";
          ENDIF
.
          IF        MLHCSTAT=9
            WRITE     HTMLFILE;"<option value=9 selected>",PMHCP139,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=9>",PMHCP139,"</option>";
          ENDIF
.
          IF        MLHCSTAT=10
            WRITE     HTMLFILE;"<option value=10 selected>",PMHCP140,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=10>",PMHCP140,"</option>";
          ENDIF
.
          GOTO      MHCSTA99
.
MHCSTA99  RETURN
+

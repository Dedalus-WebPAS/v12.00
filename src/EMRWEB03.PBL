.----------------------------------------------------------------------
. Program       : EMRWEB03
.
. Function      : Print Emergency Patient Labels and ID Sheets 
.
. Modifications :
.
.----------------------------------------------------------------------
. V12.00.01 08/09/2025  Thanh T          TSK 0949457
.           Recompiled for EMRMR5N2 changes
. V11.05.05 07/04/2025  PJ Le Febour    TSK 0949428b
.           Recompiled for EMRMR5N2 amended PRFLS530 
. V11.05.04 26/02/2025  PJ Le Febour    TSK 0957621
.           Recompiled for EMRMR5N2 amended PRFLS530 
. V11.05.03 22/02/2025  PJ Le Febour    TSK 0949428
.           Recompiled for EMRMR5N2 amended PRFC2055 
. V11.05.02 30/01/2025  Thanh T         TSK 0956569
.           Recompiled for EMRMR5N2 changes
. V11.05.01 30/01/2025  Thanh T         TSK 0956569
.           Recompiled for EMRMR5N2 changes
. V11.04.10 08/10/2024  Thanh T         TSK 0952281
.           Recompiled for DXPATMAS changes
. V11.04.09 12/06/2024  Alina Bhari     TSK 0934133
.           Recompiled for WEBEMRDX                                   
. V11.04.08 07/06/2024  Alina Bhari     TSK 0934133
.           Recompiled for EMRMR5N2,WEBEMRDX                                   
. V11.04.07 31/05/2024  Alina Bhari     TSK 0934133
.           Recompiled for WEBEMRDX                                   
. V11.04.06 28/05/2024  Alina Bhari     TSK 0934133
.           Recompiled for EMRMR5N2,WEBEMRDX                                   
. V11.04.05 17/05/2024  Thanh T         TSK 0941543
.           Added GPMCEX00 section
. V11.04.04 13/05/2024  Thanh T         TSK 0941543
.           Recompiled for EMRMR5N2 
. V11.04.03 23/04/2024  Sunny           TSK 0931173
.           Recompiled for EMRMR5N2 - Presenting complaints
. V11.04.02 27/11/2023  Peter Vela      TSK 0935874
.           Recompiled for EMRMR5N2 - Added validation for PTCNUNET = 3
.           NIHC IHI functionality
.           Recompiled for DXPATMAS - Added validation for PTCNUNET = 3
.           NIHC IHI functionality
. V11.04.01 22/11/2023  Thanh T         TSK 0914124
.           Recompiled for PATSHT6 changes
. V11.03.04 09.11.2023  DA Sarkies       TSK 0939373
.           Recompiled for EMRMR5
. V11.03.03 17/10/2023  Peter Vela       TSK 0935874
.           Added parameter check for pmsihiaf
. V11.03.02 20/09/2023  Thanh T         TSK 0914124
.           Recompiled for EMMRR5N2 changes 
. V11.03.01 30/08/2023  Thanh T         TSK 0914124
.           Recompiled for EMMRR5N2 changes
. V11.02.04 29/08/2022  Thanh T         TSK 0914124
.           Recompiled for EMMRR5N2 changes
. V11.02.03 03/08/2022  Thanh T         TSK 0914124
.           Recompiled for EMMRR5N2 changes
. V11.02.02 19/04/2022  Thanh T         TSK 0903453          
.           Recompiled for EMRME5N2 changes
. V11.02.01 24/01/2022  Jacob Jackson     TSK 0864505
.           Recompiled for EMRME5N2, WEBLBEMR - Added preferred name labels
. V11.01.01 14/08/2021  Sunny             TSK 0893817
.           Recompiled for EMRMR5N2                   
.----------------------------------------------------------------------
. V11.00.03 16/11/2020  Thanh T          TSK 0878747
.           Added PATATRFD PATATRIO and PATATRTD for EMRMR5N2 
. V11.00.02 08/04/2020  Thanh T         TSK 0879163
.           Recompiled for EMRMR5N2 
. V11.00.01 19/03/2020  J.Tan           TSK 0838262
.           Added Effective from and to date to MBS Item file
.----------------------------------------------------------------------
. V10.15.02 07/02/2020  Ebon Clements    TSK 0887235
.           Recompiled for PMSCEXCD - extra contact postal address
. V10.15.01 15/10/2019  Ken Bell         TSK 0875392
.           Suppress Claim Number of Cancelled Claim
.           Recompiled for WEBEMRDX
. V10.14.03 11/06/2019  Nicole Torrisi   TSK 0870675
.           Recompiled for DXPATMAS
. V10.14.02 17/04/2019  Nicole Torrisi   TSK 0870675
.           Recompiled for DXPATMAS - 215 - Email address
. V10.14.01 08/02/2019  Don Nguyen       TSK 0833548
.           Recompiled for EMRMR5N2 - Added vars 1734-1936
. V10.13.10 25/01/2019  Ebon Clements    TSK 0862730
.           Changed LEBELHEC to print the service point code instead
.           of the ED site code - SETHEC00
. V10.13.09 19/11/2018  Ebon Clements    TSK 0862730
.           Recompiled for EMRMR5N2 - Var 1733 - HCP Practice post code
. V10.13.08 16/10/2018  Richa Phogat     TSK 0862844
.           Recompiled for DXPATMAS - Fixed Registered HCP name
. V10.13.07 12/10/2018  Thanht T         TSK 0833077
.           Changed BHS Emergency Label Format BRAD0000.
. V10.13.06 13/09/2018  Thanht T         TSK 0833077
.           Changed BHS Emergency Label Format BRAD0000.
. V10.13.05 12/09/2018  Thanht T         TSK 0833077
.           Changed BHS Emergency Label Format BRAD0000.
. V10.13.04 12/09/2018  Don Nguyen       TSK 0860275
.           Modified KNOX0000 to clear HCP variables if no Registered HCP.
.           Modified SETKNX00 to use Practice Phone Number if the
.           Registered HCP Phone Number is blank (as per request from site).
. V10.13.03 11/09/2018  Thanht T         TSK 0833077
.           Changed BHS Emergency Label Format BRAD0000.
. V10.13.02 29/08/2018  Thanht T         TSK 0833077
.           Changed BHS Emergency Label Format BRAD0000.
. V10.13.01 14/08/2018  Thanht T         TSK 0833077
.           Changed BHS Emergency Label Format BRAD0000.
. V10.12.03 10/07/2018  Nicole Torrisi   TSK 0857785
.           Recompiled for DXPATMAS - 214 - Alternate ID
. V10.12.02 20/04/2018  Ania P           TSK 0853187
.           Recompiled for EMRMR5N2
. V10.12.01 15/01/2018  Richa Phogat     TSK 0825792
.           Modified Emergency variables Stationery Type 7 to read variables
.           from pmshcpaf if EMCNURSE = 1
.           Recompiled for EMRMR5N2
.           Recompiled for WEBEMRDX
.           Recompiled for AAESETLB
. V10.11.04 17/11/2017  Ania P           TSK 0847796
.           Recompile for EMRMR5N2
. V10.11.03 13/11/2017  Peter Vela     TSK 0847796
.           Recompiled for EMRMR5N2
. V10.11.02 11/09/2017  Ania P           TSK 0839053
.           Recompiled for EMRMR5N2
. V10.11.01 07/09/2017  Ebon Clements   TSK 0823729
.           Allow multiple instances of server to be run.
.           Delete emrlpcaf after read lock and before printing begins
. V10.10.05 25/05/2017  Peter Vela      TSK 0833345
.           Recompiled for EMRCHMAN
. V10.10.04 09/05/2017  Peter Vela      TSK 0833345
.           Recompiled for EMRCHMAN
. V10.10.03 09/05/2017  Peter Vela      TSK 0833345
.           Recompiled for EMRCHMAN
. V10.10.02 22/03/2017  Thanh T.       TSK 0832066   
.           Changed DVA PREPAT/PMPXDVAC fields to use the new
.           concession card PMCDCNUM/PMCDDVAC fields
. V10.10.01 15/03/2017  Ebon Clements  TSK 0814747   
.           Recompiled for EMRMR5N2 - ED Breach
. V10.09.03 22/08/2016  Jill Parkinson TSK 0823729   
.           Moved incomplete processing to new server - EMRWEB10 
.           Changed to loop every 2 seconds
. V10.09.02 17/01/2017  Ebon Clements    TSK 0823900
.           Recompiled for EMRMR5N2 - Var 1040 concession card details
. V10.09.01 12/12/2016  Davin            TSK 0814742
.           Recompiled for EMRMR5N2 - Paediatric Hydration fields
. V10.09.01 07/06/2016  Jill Parkinson TSK 0820003                           
.           Recompiled for PMSCEXCD - allow patmx1af/patma1af details       
. V10.08.02 30/05/2016  Jill Parkinson    TSK 0814124
.           Recompiled for EMRCHMAN
. V10.08.01 05/05/2015  Ebon Clements     TSK 0816507
.           Added traps around UPEMINC1 - incase record has since been deleted
. V10.07.04 19/11/2015  Steve Armstrong   CAR 321458
.           Recompiled for changes to AAEPRLAB
. V10.07.03 09/10/2015  Peter Vela      CAR 317170
.           Recompiled for  EMRCHMAN
. V10.07.02 08/10/2015  Peter Vela        CAR 321082
.           Recompiled for EMRMR5N2
. V10.07.01 08/10/2015  Peter Vela        CAR 321082
.           Recompiled for EMRMR5N2
. V10.06.05 21/09/2015  Davin             CAR 313906
.           Recompiled for PMSCEXCD - allow patmx1af/patma1af details
. V10.06.04 10/09/2015  Steve Armstrong  CAR 315321
.           Recompiled for changes to AAESETLB & AAEPRLAB
. V10.06.03 15/07/2015  Steve Armstrong  CAR 315999
.           Recompiled for changes to AAESETLB, AAEPRLAB & IBADLABS
. V10.06.02 09/06/2015  Peter Vela       CAR 317319
.           Recompiled for EMEMR5N2
. V10.06.01 02/04/2015  Peter Vela       CAR 297061
.           Recompiled for EMRMR5
.--------------------------------------------------------
. V10.05.09 02/12/2014  Nicole Torrisi   CAR 304493
.           Recompiled for DXPATMAS
. V10.05.08 22/10/2014  Steve Armstrong  CAR 294204
.           Recompiled for changes to SJOGLABL
. V10.05.07 20/10/2014  Peter Vela       CAR 301311
.           Recompiled for DXPATMAS
. V10.05.06 13/10/2014  Ania P           CAR 303879
.           Recompiled for EMRMR5N2
. V10.05.05 26/09/2014  Steve Armstrong  CAR 306544
.           Recompiled for changes to SJOGLABL
. V10.05.04 23/09/2014  Steve Armstrong  CAR 294204
.           Recompiled for changes to SJOGLABL & IBADLABS.
.           Also added read of pmsvx1af record before printing
.           labels.
. V10.05.03 15/09/2014  Steve Armstrong  CAR 294204
.           Recompiled for changes to SJOGLABL & IBADLABS
. V10.05.02 10/09/2014  Steve Armstrong  CAR 294204
.           Recompiled for changes to SJOGLABL
. V10.05.01 29/07/2014  Steve Armstrong  CAR 294204
.           Mods to print SJOG Geelong labels.
.           Recompiled for changes to IBADLABS, AAEPRLAB,
.           AAESETLB for SJOG Geelong labels.
.           Also replaced HETYPLAB with AECNLABL.
.--------------------------------------------------------
. V10.04.04 22/05/2014  Peter Vela       CAR 292130
.           Recompiled for EMRCHMAN
. V10.04.03 28/05/2014  Don Nguyen       CAR 301096
.           Recompiled for changes to EMRMR5
. V10.04.02 12/03/2014  Ebon Clements    CAR 294181
.           2014 VEMD changes
. V10.04.01 03/03/2014  Don Nguyen       CAR 291879
.           Added GTIHINUM for DXPATMAS
.           24/02/2014  J.Tan            CAR 285504
.           Recompiled for DXPATMAS
.           18/02/2014  Don Nguyen       CAR 291879
.           Recompiled for EMRMR5N2 - added variable 1448 (IHI Number)
.           03/02/2014  Ania P           CAR 275582
.           Recompiled for EMRMR5N2
. V10.03.25 11/11/2013  Peter Vela       CAR 284858
.           Recompiled for WEBLBCOM
. V10.03.24 07/11/2013  Peter Vela       CAR 284858
.           Recompiled for WEBLBCOM
. V10.03.23 10/10/2013  Steve Armstrong  CAR 288277
.           Recompiled for changes to AAESETLB and AAEPRLAB
. V10.03.22 09/09/2013  Nicole Torrisi   CAR 287738
.           Recompiled for DXPATMAS
. V10.03.21 18/07/2013  Don Nguyen       CAR 288603
.           Recompiled for changes to EMRMR5N2 - Added variables 1445 & 1446
. V10.03.20 10/07/2013  Davin            CAR 283509
.           Recompiled for change to viscodfd
. V10.03.19 29/04/2013  Peter Vela       CAR 281388
.           Recompiled for EMRMR5
. V10.03.18 19/04/2013  Peter Vela       CAR 281388
.           Recompiled for EMRMR5 - Added BHS clinical notes
. V10.03.17 14/03/2013  J.Tan            CAR 281349
.           Recompiled for EMRCHMAN - Clinical notes from vismdtaf file
. V10.03.16 14/02/2013  Don Nguyen       CAR 277835
.           Recompiled for changes in EMRMR5 - Modified WANOTE00 to skip deleted
. V10.03.15 11/02/2013  Don Nguyen       CAR 277835
.           Recompiled for PRINTEMR - added stationery code 'WAPCLN'
. V10.03.14 12/10/2012  Peter Vela       CAR 274569
.           Recompiled for EMRMR5N2 - Fixed User Defined Code 5 - Variable 80
. V10.03.13 03/10/2012  Ebon Clements    CAR 273463
.           Recompiled for EMRMR5 - ED traige assessment fields
. V10.03.12 13/07/2012  Don Nguyen       CAR 268835
.           Recompiled for EMRMR5
. V10.03.11 12/07/2012  Don Nguyen       CAR 268189
.           Recompiled for EMRMR5
. V10.03.10 19/06/2012  Peter Vela       CAR 264245
.           Recompiled for EMRMR5
. V10.03.09 05.06.2012  Ebon Clements    CAR 265695
.           Recompiled for EMRMR5
. V10.03.08 04.06.2012  Ebon Clements    CAR 265695
.           Recompiled for EMRMR5
. V10.03.07 25/05/2012  Peter Vela       CAR 264245
.           Recompiled for EMRMR5N2
. V10.03.06 14/05/2012  Peter Vela       CAR 258648
.           Fixed PACFNAME in HECR0000
. V10.03.05 11/05/2012  Peter Vela       CAR 258648
.           Pack SP70 to LINEG37 after CMPH0000
. V10.03.04 17/04/2012 Don Nguyen        CAR 261728
.           Recompiled for WEBEMRDX - Print Local GP or Practice Name
. V10.03.03 21/02/2012  Ebon Clements    CAR 248285
.           Recompiled for PRINTEMR - fixed invalid ED visit error
. V10.03.02 01/02/2012  J.Tan            CAR 247090
.           Recompiled for EMRMR5N2 - Print indicator for Card Type
. V10.03.01 11/11/2011  Ebon Clements     CAR 248529
.           Added multiple contacts of the same type functionality
. V10.02.18 18/10/2011  Davin             CAR 253080
.           Recompiled for EMRMR5N2 (added mehdlsfd/io/open)
. V10.02.17 26/09/2011  Davin             CAR 248749
.           Recompiled for EMRMR5N2
. V10.02.16 19/09/2011  B.G.Ackland       CAR 249083
.           Recompiled for EMRMR5
. V10.02.15 19/09/2011  Ebon Clements     CAR 250135
.           Recompiled for EMRMR5N2 - Transfer source description
. V10.02.14 13/09/2011  Davin             CAR 248749
.           Recompiled for EMRMR5N2
. V10.02.13 31/08/2011  Davin             CAR 249921
.           Recompiled for EMRMR5N2
. V10.02.12 26/08/2011  Davin             CAR 249255
.           Changed label & form printer cgis to 6 chars
. V10.02.11 23/08/2011 B.G.Ackland    CAR 244020
.           Print All Clinical Notes/Management Notes for
.           Template Fields 1227 & 1352
. V10.02.10 08/08/2011 B.G.Ackland    CAR 243247
.           Fixed Clinical Notes Print Format for Healthscope
. V10.02.09 08/07/2011 B.G.Ackland    CAR 243247
.           Fixed Clinical Notes Print Format for Healthscope
. V10.02.08 08/07/2011 B.G.Ackland    CAR 243247
.           Clinical Notes Print Format for Healthscope
. V10.02.07 22/06/2011  Steve Armstrong   CAR 240722
.           Recompiled for changes to PMSCEXCD 
. V10.02.06 09/06/2011  Ebon Clements    CAR 239530
.           Added print extra contact functionality
. V10.02.05 25/05/2011  Saroeun Soeur    CAR 242008
.           Recompiled for PATSHT6
. V10.02.04 12/05/2011 Saroeun Soeur  CAR 242008
.           recompiled for PATSHT6
. V10.02.03 05/05/2011 Saroeun Soeur  CAR 240081
.           recompiled for EMRMR5N2
. V10.02.02 28/04/2011  Saroeun Soeur  CAR 237496
.           recompiled for EMRMR5N2
. V10.02.01 04/04/2011  Jill Parkinson CAR 239574
.           Removed open of ibaprntf
. V10.01.03 01/03/2011 Ebon Clements  CAR 223822
.           Recompiled for PRINTEMR
. V10.01.02 14/12/2010 Jill Parkinson CAR 235074
.           Recompiled for EMRMR5N2 - bug when item on the last line
. V10.01.01 03/12/2010 Ebon Clements  CAR 233551
.           Recompiled for EMRMR5N2 - Don't print deleted clinical notes
. V10.00.11 Steve Armstrong   CAR 231234
.           Further changes to Healthe Care hard-coded ED labels:
.            - added pension number (pmsccdaf.pmcdcnum)
.            - removed provider number
.            - added compensable/HF details for claim type
. V10.00.10 Steve Armstrong   CAR 231275
.           Recompiled for changes to DXPATMAS
. V10.00.09 04/10/2010  Steve Armstrong  CAR 231234
.           Added Healthe Care hard-coded ED labels
. V10.00.08 08/09/2010 Mike Laming    CAR 216634
.           Recompiled for EMRMR5N2 - Added variables 1379 (User Def. 1 Doctor)
. V10.00.07 30/08/2010 Jill Parkinson CAR 216634
.           Recompiled for EMRMR5N2 - Added variables 1373-1378
. V10.00.06 19/08/2010 Saroeun Soeur CAR 228038
.           added constant variables SETBOLD,NSETBOLD 
.           format KNOX label output
. V10.00.05 16/06/2010 Peter Vela    CAR 216620
.           Recompiled for EMRMR5N2 - Added EMVCFTXT Free Format Desc for 
.           Primary Diagnosis
. V10.00.04 10/05/2010 Peter Vela    CAR 221547
.           Recompiled for EMRMR5N2 - Added functionality to get alerts from
.           PATALTFD
. V10.00.03 19/04/2010 Jill Parkinson CAR 216634
.           Recompiled for EMRMR5N2 - variables 1368,69 and 70
. V10.00.02 14/04/2010 Steve Armstrong   CAR 219933
.           Recompiled for changes to EMRVCDFD
. V10.00.01 22/03/2010 Peter Vela    CAR 215079
.           Recompiled for EMRMR5N2 - Basic Observations Actions / Comments
.--------------------------------------------------------
. V9.12.24 11/03/2010 Ebon Clements CAR 216621 
.          Recompiled for EMRMR5N2 - Management notes 
. V9.12.23 03/03/2010 Ebon Clements CAR 215823 
.          Recompiled for EMRCHMAN - Ambulance case number
. V9.12.22 25/02/2010  Mike Laming   CAR 215117
.          Recompiled for EMRMR5 - Added "Procedures" to HDH summary
. V9.12.21 13/01/2010  Jill Parkinson    CAR 207035
.          Mods to print PTRLDESC for PTMXECRE    
. V9.12.20 04/01/2010  Ebon Clements CAR 210183
.          Recompiled for EMRMR5 - Print HDH summary at position 1 not 9
. V9.12.19 24/12/2009  Ebon Clements CAR 213034
.          Recompiled for EMRMR5 - Print this visits medical history - HDHCLIN0
. V9.12.18 22/12/2009  Ebon Clements   CAR 205439                   
.          Changed concession card print order to use cat ct ind 3 - GCCSJG00   
. V9.12.17 17/12/2009  Ebon Clements CAR 202314
.          Recompiled for EMRMR5N2 - Deceased patients PRFA
. V9.12.16 18/11/2009  Ebon Clements CAR 210183
.          Recompiled for EMRMR5 - 80 char notes on HDH summary
. V9.12.15 10/11/2009  Peter Vela    CAR 199757
.          Recompiled for EMRMR5N2 - Added Next Stationery Code Type 7
. V9.12.14 16/10/2009  Ebon Clements CAR 190680
.          Recompiled for WEBEMRDX -  Fixed pack of VAR after calls to CMPH0000
. V9.12.13 15/20/2009  Ebon Clements    CAR 202699
.          Recompiled for EMRMR5N2 - ATTDOC00
. V9.12.12 14/10/2009  WeeLee Koo   CAR 205308                          
.          Recompiled for DXPATMAS                                          
. V9.12.11 13/10/2009  Mike Laming    CAR 207911
.          Reset KEY8 & add ReadA before Update of "emrincaf" in CHKMNA00 (x2)
. V9.12.10 17/08/2009  Ebon Clements  CAR 202914
.          Added save of last label/form name, copies and printer
. V9.12.09 04/08/2009  Peter Vela       CAR 202478
.          Recompiled for DXPATMAS
. V9.12.08 03/08/2009  Ebon Clements    CAR 202829
.          Recompile for PRINTEMR - Fixed DOB for unknown patients
. V9.12.07 02/06/2009  Mike Laming      CAR 196463
.          Add variables for EMRMR5 Print changes for HDH - recompile for EMRMR5
. V9.12.06 18/06/2009  Saroeun Soeur    CAR 192829
.          Changed layout for LABELKNX, KNOX0000
. V9.12.05 25/05/2009  Ebon Clements    CAR 192431
.          Recompiled for EMRMR5N2  - Observations vars
. V9.12.04 11/05/2009  Peter Vela       CAR 196060
.          Recompiled for EMRMR5
. V9.12.03 08/05/2009  Peter Vela       CAR 196060
.          Recompiled for EMRMR5 hard coded clinical notes for HDH
. V9.12.02 11/05/2009  Saroeun Soeur    CAR 192829
.          Port over AEE label from 6.16, KNOX0000,SETKNX00,PRTKNX00
.          hard coded label changes for KNOX0000
. V9.12.01 05/05/2009  Saroeun Soeur    CAR 193658
.          added PATMI1FD and PATMI1IO includes
.          Recompiled for EMRMR5N2 - attending doc vars 
.--------------------------------------------------------
. V9.11.06 01/05/2009  Peter Vela       CAR 189171
.          Recompiled for EMRMR5
. V9.11.05 01/05/2009  Peter Vela       CAR 189171
.          Recompiled for EMRMR5 PRINTEMR
. V9.11.04 30/04/2009  Ebon Clements    CAR 195740
.          Recompiled for EMRMR5N2 - Injury and observation vars
. V9.11.03 28/04/2009  Ebon Clements    CAR 195452
.          Recompiled for EMRMR5N2 - Clinical note vars
. V9.11.02 04/03/2009  Jill Habasque    CAR 134681
.          Recompiled for EMRMR5N2
. V9.11.01 22/10/2008  Peter Vela       CAR 180404
.          Recompiled for DXPATMAS
. V9.10.06 09/09/2008  Ebon Clements CAR 175728
.          Recompiled for EMRMR5N2 - Compensable vars and pmi address
. V9.10.05 17/07/2008  Ebon Clements     CAR 172849
.          Recompiled for EMRMR5N2
. V9.10.04 19/06/2008  Ebon Clements     CAR 171198
.          Added GETR0000 to fix excessive reads of patcodes for cat EZ
. V9.10.03 20/05/2008  Ebon Clements     CAR 166566
.          Recompiled for EMRMR5N2
. V9.10.02 16/05/2008 Ebon Clements     CAR 166563
.          Recompiled for WEBEMRDX
. V9.10.01 14/05/2008  Ebon Clements     CAR 166566
.          Recompiled for EMRMR5N2
. V9.09.13 14/03/2008  Jill Habasque     CAR 163923
.          Recompiled for EMRMR5N2
. V9.09.12 22/02/2008  Peter Vela        CAR 150710
.          Recompiled for EMRMR5N2
. V9.09.11 22/02/2008  Peter Vela        CAR 150710
.          Recompiled for EMRMR5N2
. V9.09.10 12/12/2007  Ebon Clements     CAR 157081
.          Recompiled for EMRMR5N2 - Patient e-mail address
. V9.09.09 01/11/2007  Mike Laming       CAR 153218
.          Recompiled for changes to WEBLBEMR - Add calls to CLEMRVIS & CLPATVIS
. V9.09.08 26/10/2007  Peter Vela    CAR 151199
.          Added new Emergency Cancellation status
. V9.09.07 18.09.2007  Steve Armstrong   CAR 124435
.          Recompiled for changes to WEBEMRDX for item:
.             200 - ACC Number
. V9.09.06 10/08/2007 Peter Vela         CAR 147539
.          Recompiled for WEBLBCOM
. V9.09.05 01/08/2007 J.Tan              CAR 146650
.          Recompiled for DXPATMAS - Blank health fund
. V9.09.04 23/07/2007  Peter Vela       CAR 142913
.          Changed GCCSJG00 to read indicator 2
. V9.09.03 18/07/2007  Peter Vela       CAR 142913
.          Recompiled for EMRMR5N2 and PRINTEMR
. V9.09.02 16/07/2007  Peter Vela       CAR 144312
.          Recompiled for EMRMR5N2 - Added emr stationery template variables
. V9.09.01 12/07/2007  Peter Vela       CAR 142913
.          Added GCCSJG00 Get Concession Card Details for SJOG
. V9.08.07 09/03/2007  Ebon Clements    CAR 127423
.          Added check for no doctor to CHKMNA00 and set to discharge complete
. V9.08.06 06/02/2007  Neelkamal Pyla    CAR 120594
.          Recompiled for PATSHT6 - Added NOK Relation Desc and Title Desc
. V9.08.05 31/01/2007  Peter Vela        CAR 127930
.          Recompiled for EMRSITFD
. V9.08.04 13/12/2006  J.Tan             CAR 127625
.          Mods to JH HRN
. V9.08.03 27/11/2006  Steve Armstrong   CAR 126039
.          Recompiled for changes to SGCHKDIG
. V9.08.02 23/11/2006  Steve Armstrong   CAR 125800
.          Recompiled for changes to DXPATMAS
. V9.08.01 16/11/2006  Steve Armstrong   CAR 124160
.          Recompiled for EMRMR5N2 (Singapore HRN)
.--------------------------------------------------------
. V9.07.02 20/09/2006  Peter Vela        CAR 118225
.          Recompiled for DXPATMAS
. V9.07.01 08/09/2006  Peter Vela        CAR 118225
.          Recompiled for DXPATMAS
. V9.06.02 06/06/2006  Steve Armstrong   CAR 107577
.          Recompiled for STV label changes in AAEPRLAB
. V9.06.01 21/04/2006  Ebon Clements CAR 101705
.          Added check for left before seen by doctor to mandatory fields
.--------------------------------------------------------
. V9.05.02 24/03/2006  Peter Vela    CAR 61299
.          Recompiled for EMRMR5N2
. V9.05.01 09/03/2006  Ebon Clements CAR 78533
.          Mods for PATCODTM - Hospital specific category codes
. V9.04.28 05/12/2005  Ebon Clements     CAR 87088
.          Fixed default printer save for non zebra emr labels         
. V9.04.27 14/11/2005  Jill Habasque     CAR 84500
.          Recompiled for EMRMR5N2
. V9.04.26 03/11/2005  Peter Vela        CAR 79842
.          Recompiled for EMRMR5N2
. V9.04.25 19/08/2005  Peter Vela        CAR 71987
.          Recompiled for AAESETLB
.          Recompiled for WEBLBEMR
.          18/08/2005  Peter Vela        CAR 69456
.          Recompiled for EMRMR5N2
. V9.04.24 16/08/2005  Ebon Clements     CAR 58448
.          Recompiled for WEBLBCOM
. V9.04.23 10/08/2005  Peter Vela        CAR 58448
.          Recompiled for WEBLBCOM
.          08/08/2005  Peter Vela        CAR 67204
.          Recompiled for EMRMR5N2
. V9.04.22 27/07/2005  Steve Armstrong   CAR 66545
.          Recompiled for EMRMR5N2
. V9.04.21 19/07/2005 Peter Vela        CAR 63023
.          Recompiled for EMRMR5N2
. V9.04.20 12/07/2005 Peter Vela        CAR 65302
.          Changed GP field from EMVIREGF to PMPXRHC1 BRAD0000
.          Fixed left margin of small bradma labels HORZTB02,HORZTB05,HORZTB08
.          HORZTB10,HORZTB13,HORZTB16
.          23/06/2005  Steve Armstrong  CAR 64477
.          Recompiled for changes to AAESETLB, IBADLABS & AAEPRLAB
. V9.04.19 20/06/2005 Ebon Clements CAR 59678
.          Recompiled for EMRMR5 - doctor notes
. V9.04.18 01/06/2005 Peter Vela    CAR 60166
.          Recompiled for EMRCONFD
. V9.04.17 30/05/2005 Ebon Clements CAR 59676
.          Recompiled for EMRMR5 - visit notes from VISMTXFD for St Vincents
. V9.04.16 04/05/2005 Peter Vela    CAR 60700
.          Recompiled for EMRMR5N2
. V9.04.15 28/04/2005  Peter Vela    CAR 55214
.          Recompiled for EMRMR5N2
. V9.04.14 15/04/2005  Jill Habasque CAR 58756
.          Recompiled for EMRMR5N2
. V9.04.13 12/04/2005  Ebon Clements CAR 58443
.          Mods to make label HETYPLAB=4 Ballarat format
. V9.04.12 24/03/2005  Peter Vela    CAR 56364
.          Recompiled for WEBEMRDX
. V9.04.11 23/03/2005  Peter Vela    CAR 56364
.          Recompiled for WEBEMRDX
.          22/03/2005 Peter Vela    CAR 59548
.          Recompiled for EMRMR5N2
. V9.04.10 10/03/2005  Ebon Clements CAR 58443
.          Recompiled for EMRCHMAN - Place when injury occured mandatory field
. V9.04.09 01/03/2005  Peter Vela    CAR 57547
.          Recompiled for PATVADFD and PATVADIO
. V9.04.08 09/02/2005 Peter Vela    CAR 55217
.          Recompiled for EMRMR5N2
. V9.04.07 28/01/2005 Peter Vela    CAR 56012
.          Recompiled for EMRMR5N2
.          24/01/2005 Peter Vela    CAR 55331
.          Recompiled for DXPATMAS
. V9.04.06 06/12/2004 Peter Vela    CAR 55217
.          Recompiled for EMRMR5N2
. V9.04.05 26/11/2004 Peter Vela    CAR 55214
.          Recompiled for EMRMR5N2
.          Added includes and open for pmsvx1af
. V9.04.04 08/11/2004 Peter Vela    CAR 54627
.          Recompiled for EMRMR5N2
.          04/11/2004 Peter Vela    CAR 54309
.          Recompiled for EMRMR5N2
. V9.04.03 26/10/2004 Peter Vela    CAR 54627
.          Recompiled for PRINTEMR and EMRMR5N2
.          Added OPEN for PATALRT1,"patalrtf"
.          Added FORM1A
.          Added OBSDETFD, OBSDETIO and OPEN for obsdetaf
.          Added CONTROLF read of CSNAME (Company Name)
. V9.04.02 16/09/2004 Peter Vela    CAR 53465
.          Recompiled for EMRMR5N2
. V9.04.01 19/08/2004 Peter Vela    CAR 50421
.          Recompiled for EMRMR5N2
.          Added EMRPROFD,EMRPROIO
. V9.03.16 16/07/2004 Jill Habasque CAR 51539
.          Changed CALC000 to be CALCD000 and CALCN000
. V9.03.15 14/07/2004 Ebon Clements CAR 50421
.          Recompiled for EMRMR5N2
.          07/07/2004 Peter Vela    CAR 50310
.          Recompiled for EMRMR5
. V9.03.14 16/06/2004 Peter Vela    CAR 49485
.          Fixed update of emergency visit status
. V9.03.13 10/06/2004 Ebon Clements CAR 50570
.          Fixed schedule job description for emr form printing
. V9.03.12 27/05/2004 Ebon Clements CAR 50185
.          Added call to WEBU0000 to get web WBSEUID for printer defaults
. V9.03.11 26/03/2004 Peter Vela    CAR 13038
.          Recompiled for PATDOCCD - Doctor Name format Parameter
. V9.03.10 26/03/2004 Jill Habasque CAR 47769
.          Recompiled for more changes to HWK layout           
. V9.03.09 25/02/2004 Jill Habasque CAR
.          Added HWK hardcoded clinical print
. V9.03.08 19/02/2003 Jill Habasque CAR 47526
.          Recompiled for WEBBRGND
.          16/02/2003 Jill Habasque CAR 47526
.          Recompiled for AAESETLB
. V9.03.07 28/10/2003 Ebon Clements  CAR 44623
.          Changed mandatory fields to use category EZ for responsibility
. V9.03.06 13/10/2003 Davin         CAR 39038
.          Recompiled for change to viscmtfd
. V9.03.05 17/09/2003 Jill Habasque
.          Added move of one to nocopies if not zebra labels
.          01/09/2003 Jill Habasque
.          Fixed packing of key11
. V9.03.04 25/08/2003 Ebon Clements CAR 42813
.          Recompiled for EMRSITFD changes that were missing in V9 that
.          had been made in 5.09 - EMSTDLOC
. V9.03.03 13/08/2003 Sylvek Litewka  CAR 41293
.          Modified procedure PRTLAB00 to populate SCHEDDSC.
. V9.03.02 30/06/2003 Tonii  CAR 38920 (SV133928)
.          Recompiled for EMRMR5 
. V9.03.01 14/05/2003 Tonii  CAR 38920
.          Recompiled for EMRMR5 - fixed alignment for St Vincent form
.--------------------------------------------------------
. V9.02.18 03/04/2003 Lina Vo     CAR 37905
.          Fixed VICD0000 to check mandatory according to PRDGFLAG like
.          emrweb01 and emrweb02 server.
.          Changed call of EMERGV00 to every 30 seconds or 6th cycle.
. V9.02.17 24/02/2003 Dean Cramer CAR 36564
.          Recompiled for EMRMR5N2 - fixed Triage Nurse description
.          21/02/2003 Dean Cramer CAR 35451
.          Recompiled for EMRMR5N2 - fixed fields picked up 
. V9.02.16 23/01/2003 J.Tan SRF 35451  
.          Recompiled for EMRMR5N2 -added new fields
. V9.02.15 11/12/2002 Ebon Clements SRF 23449  
.          Recompiled for EMRCHMAN - Z099 primary diagnosis visit number
. V9.02.14 25/11/2002 Ebon Clements SRF 23449  
.          Recompiled for EMRCHMAN - Z099 primary diagnosis
. V9.02.13 16/09/2002  Jill Habasque SRF 20302  
.          Added EMRCHMAN            
. V9.02.12 22.04.2002 Bronko Sosic 
.          Fix St Vincents Labels
. V9.02.11 28.03.2002 Bronko Sosic 
.          Recompiled for EMRICDFD                             
. V9.02.10 28.03.2002 Bronko Sosic 
.          Recompiled for EMRICDFD                             
. V9.02.09 21.03.2002 Dean Cramer  
.          Recompiled for EMRMR5N2                             
. V9.02.08 19.03.2002 B.G.Ackland
.          Mods for Emergency module
. V9.02.07 17.03.2002 B.G.Ackland
.          Reduce Wait Time Between Checks
. V9.02.06 07.11.2001 Bronko sosic
.          Added Mandatory Feild checking
. V9.02.05 07.11.2001 Bronko sosic
.          Recompiled for EMRMR5N2
. V9.02.04 03.11.2001 Tonii
.          Recompiled for AAEPRLAB
. V9.02.03 10.10.2001 B.G.Ackland   
.          COMMIT Transaction Control
. V9.02.02 03.10.2001 B.G.Ackland   
.          COMMIT Transaction Control for WEBINT00
. V9.02.01 16.08.2001 Tonii         
.          Added ZEBRAL00 to print labels for St Vincent's
.--------------------------------------------------------
. V9.00.B02 13.07.2001 Sandra Barcham
.           Replaced GP with HCP
. V9.00.B01 24/04/2001  B.G.Ackland
.           Remove Unused Code.
.           Tidy Program Structure.
.--------------------------------------------------------
.                 V5.08.01 08/05/2000  Nicole Harrington
.                          Recompiled for changes to EMRMR5N2
.                 V5.08.03  16/08/2000  Caleb Sharman
.                          Changed Health Fund variables to be 8 chars
.                 V5.08.03  16/08/2000  Caleb Sharman
.                          Changed Health Fund variables to be 8 chars
.                 V5.07.05 28.01.2000  B.G.Ackland
.                          Recompile in Work
.                 V5.07.04 12/01/2000 Nicole Harrington
.                          Recompiled for EMRMR5N2
.                 V5.07.03 11/01/2000 Nicole Harrington
.                          Recompiled for PRINTEMR
.                 V5.07.02 11/01/2000 Nicole Harrington
.                          Recompiled for location and site file
.                 V5.07.01 09/11/1999 Nicole Harrington
.                          Recompiled for PRINTEMR - Added ULMAST1
.                 V5.07.00 14/10/1999 Nicole Harrington
.                          Port from 6.06 to 5.07
.----------------------------------------------------------------------
. Modifications : V6.06.01 22.06.1999 Katie Nelson
.                          Re-Compiled for PATMASDX and EMRVISTM
.                 V6.06.00 02.03.1999 Katie Nelson
.                          Created Program
.
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       CHKDIGVR/INC
          INC       EMRICDFD/INC
          INC       EMRHISFD/INC 
          INC       APSMASFD/INC
          INC       AAEDE1FD/INC
          INC       EMRLPCFD/INC
          INC       EMRCONFD/INC                                       *I-50421
          INC       EMRLOCFD/INC
          INC       EMRSITFD/INC
          INC       PATCALAG/INC
          INC       PATDHEAD/INC
          INC       ELTRONVR/INC
          INC       EOCLNKFD/INC
          INC       EOCREFFD/INC
          INC       EMRVISFD/INC
          INC       EMRCLIFD/INC
          INC       EMRGRCFD/INC
          INC       EMRPROFD/INC                                       *I-50421
          INC       EMRUNKFD/INC
          INC       IBADLABS/INC
          INC       IBATMDFD/INC
          INC       MEHDLSFD/INC
          INC       NHIETHFD/INC
          INC       NHIMASFD/INC
          INC       OUTBB1FD/INC
          INC       OUTBOAFD/INC
          INC       OPRNURFD/INC
          INC       PATCONFD/INC
          INC       AAECONFD/INC   *****
          INC       PATALRFD/INC   *****
          INC       PMSALNFD/INC
          INC       PATDO1FD/INC
          INC       PATFN1FD/INC
          INC       PATGO1FD/INC
          INC       PATHSPFD/INC
          INC       PMSCCDFD/INC
          INC       PMSCEXFD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
          INC       PMSIHIFD/INC
          INC       PMSMDTFD/INC
          INC       PMSMTXFD/INC
          INC       PATIN1FD/INC
          INC       PRIITMFD/INC
          INC       PATITMFD/INC                                       *I-50421
          INC       PATICDFD/INC                                       *I-50421
          INC       PATICOFD/INC                                       *I-50421
          INC       PATMA1FD/INC
          INC       PATMI1FD/INC
          INC       PMSPX2FD/INC
          INC       PMSRELFD/INC              
          INC       PMSTLEFD/INC   
          INC       PATNIDFD/INC
          INC       PATRE1FD/INC
          INC       PATVADFD/INC
          INC       PATVISFD/INC
          INC       PMSVX1FD/INC                                       *I-55214
          INC       PATWC1FD/INC 
          INC       PMSWX1FD/INC
          INC       PATWMAFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       SCRPSTFD/INC
          INC       SCRSBGFD/INC
          INC       SCRSLTFD/INC
          INC       SCRMASFD/INC
          INC       PATHGPFD/INC
.
          INC       PATATRFD/INC
          INC       PATATRTD/INC 
.
          INC       EMRDCMFD/INC       
          INC       OBSDETFD/INC                                       *I-54627
          INC       OBSMTXFD/INC
          INC       OBSMDTFD/INC
          INC       EMRISMFD/INC 
          INC       EMRINCFD/INC 
          INC       EMRWFMFD/INC
          INC       EMRVCDFD/INC
          INC       EMRMTXFD/INC
          INC       EMRVPRFD/INC
          INC       VISCMTFD/INC
          INC       VISCODFD/INC
          INC       VISMDTFD/INC
          INC       VISXDCFD/INC
          INC       EMRMANFD/INC 
          INC       VISMTXFD/INC

.
ANSLI     INIT      "i"
ANSLW     INIT      "w"
DAYDESC   DIM       9
DIM16     DIM       16
DIM30     DIM       30
DIM35     DIM       35
DIM50     DIM       50
DIM80     DIM       80
DIM100    DIM       100
DFNAME    DIM       60
DSMOKE    DIM       3
GPFRMTNM  DIM       40
LINEA17   DIM       17
LINEB17   DIM       17
LINEC17   DIM       17
LINED17   DIM       17
LINEE17   DIM       17
LINEF17   DIM       17
LINEG17   DIM       17
LINEH17   DIM       17
LINEI17   DIM       17
LINEA37   DIM       37
LINEB37   DIM       37
LINEC37   DIM       37
LINED37   DIM       37
LINEE37   DIM       37
LINEF37   DIM       37
LINEG37   DIM       37
LINEH37   DIM       37
LINEI37   DIM       37
TYPE4     INIT      "004"
TYPE5     INIT      "005"
SAVKEY5   DIM       5
SAVENCOM  FORM      1
SAVEDCOM  FORM      1
SAVDOC    DIM       10
SKEY8     DIM       8
DOCTIME   DIM       8
HOUR      DIM       2
MEDINUMB  DIM       13
MIN       DIM       2
MONTHDES  DIM       9
NUM3      FORM      3
PTFRMTNM  DIM       40
SEC       DIM       2
MEDNOTES  DIM       70
TEMPDATE  DIM       12
.
NEWCOUNT  FORM      10
.
ADLABEL   FORM      2
ATT       DIM       80         * attribute string
AFTDECP   FORM      2          * After Decimal Place
AFTDECPF  FORM      2          * After Decimal Place Format String
.
BEFDECP   FORM      2          * Before Decimal Place
BEFDECPF  FORM      2          * Before Decimal Place Format String
BIRTHDAT  DIM       10            * formatted DOB variable
.
CALDAYS    FORM      3
CDEFPRT2  DIM       6
CHG       FORM      1
CHKMNCNT  FORM      1          * check mandatory fields cycle counter
CLAIMCOD  DIM       3
CLMDET1   DIM       50
CLMDET2   DIM       50
CONTTYPE  DIM       1
CONTTYP2  FORM      1
COUNTER   FORM      1
CPPAPER2  FORM      2
CURRROW   FORM      3
CODEDESC  DIM       100                                                *I-50421
.
DANS1     DIM       20
DCASE     DIM       3
DECIMALP  INIT      "."  
DIM2L     DIM       2
DIM3      DIM       3
DIM6      DIM       6
DIM4      DIM       4
DIM4A     DIM       4
DIM4B     DIM       4
DIM4C     DIM       4
DIM5      DIM       5                                                  *I-54309
DIM8      DIM       8             * U/R variable (spaces removed)
DIM9      DIM       9
DIM10     DIM       10 
DIM10A    DIM       10
DIM10B    DIM       10
DIM11     DIM       11
DIM11G    DIM       11            * given name variable for small labels
DIM11S    DIM       11            * surname variable for small labels
DIM12     DIM       12
DIM14     DIM       14
DIM15     DIM       15
DIM17     DIM       17
DIM18     DIM       18            * given name variable for large labels
DIM20     DIM       20
DIM25     DIM       25
DIM31     DIM       31            * formatted address
DIM60     DIM       60
DOCTCODE  DIM       6
BURNO     DIM       9
BADMNO    DIM       9
PTURNO    DIM       8             * U/R variable (spaces removed)
PTADMNO   DIM       8             * Admission No variable (spaces removed)
EDOCNAME  DIM       23
PSURNAME  DIM       23
PGIVNAME  DIM       23
PCLMTYPD  DIM       20
PADDRSS1  DIM       23 
PADDRSS2  DIM       23
PAGEYRS   DIM       4
PGPNAME   DIM       30
PRTLABL1  DIM       17
PRTLABL2  DIM       20
PRTLABL3  DIM       16
PRTLABL4  DIM       15
PRTLABL5  DIM       17
PRTLABL6  DIM       24
.
EMRFLAG   FORM      1 
EMRPREV   DIM       20 
EMRSEEN   DIM       8
EMRDOCT   DIM       13
EMRINSUR  DIM       5
EMRDESC   DIM       20
EMRURNO   DIM       8
ENDFLG    FORM      1
.
FIRSTCH   FORM      1                                                  *I-60700
FIELDNO   FORM      5
FORM1A    FORM      1                                                  *I-54627
FORM1B    FORM      1                                                  *I-54627
FORM3     FORM      3
FORM3A    FORM      3                                                  *I-50421
FORM5     FORM      5
FORM21    FORM      21
FORMAT21  FORM      21
FRMPRINT  DIM       6
.                                                                     *I-196463
DIM3A     DIM       3
DIM3B     DIM       3
DIM15A    DIM       15
DIM50A    DIM       50
DIM80A    DIM       80
.
MBIRURNO  DIM       8
MBIRTYOR  DIM       24
.
LINSREQD  FORM      5
PAGENUMB  FORM      3
PAGETOTL  FORM      3
PAGEMAXL  FORM      3                       * Maximum lines per page
PASSNO    FORM      1
PGLINES   DIM       6
PRINTEND  FORM      1
.
WFLINE3A  DIM       20
WFLINE2A  DIM       20
WFLINE8A  DIM       20
WFLINE6A  DIM       20
WFLINE4A  DIM       20
WFLINE7A  DIM       20
WFLINE5A  DIM       20
WFLINE1A  DIM       20
.
HIGH14    DIM       4
HIGH24    DIM       4
HIGH34    DIM       4
.HELPAGE   FORM      1
.HELPRNT   FORM      3
.HELSIZE   FORM      1
.HEMR5COD  DIM       6            * Code for user defined stationary
HEPMR5B   FORM      "1"          * Patient MR5 form sheet 1=Yes, 0=No
.HEMR5L    FORM      "1"          * Layout for MR5.
.                                  0 = Modbury
.                                  1 = User Defined
.
IHINUMBR  DIM       20
JYEAR     FORM      2
.
LASTROW   FORM      3
LABSIZE   FORM      1
LARGELAB  DIM       16
SMALLLAB  DIM       21
LBLPRINT  DIM       6
LABELATT  DIM       80[24]
LABELDAT  DIM       80[24]
LABELTYP  DIM       10
LLCNT     FORM      5
LEFTBRAK  INIT      "(" 
LINE60    DIM       60                                                 *I-60700
.
MANDINUR  FORM      1
MADESC    DIM       3
MODE4     DIM       4
.
NEGOFSET  DIM       8             * U/R variable (spaces removed)
NMPNUMB   DIM       20
NOLABEL   FORM      3
NOTEFILT  DIM       3
.
OPFLG     FORM      1
.
PRDGFLAG  FORM      1
PRINTVAR  DIM       80
PRNTSTRT  FORM      3
PRIDSYET  FORM      1
.
QADD1     DIM       25
QADD2     DIM       25
QADD4     DIM       15
QGNAME    DIM       14
QLOCDOC   DIM       30
QMEDI     DIM       10
QOCCUP    DIM       14
QPOST     DIM       4
QSAGE     FORM      3
QSEX      DIM       1
QSNAME    DIM       15
QSUBRB    DIM       15
QTELEP    DIM       12
QTITL     DIM       4
.
RESPONSD  DIM       3             * Cat EZ code for doctor responsible
RESPONSN  DIM       3             * Cat EZ code for nurse responsible
RESPONSC  DIM       3             * Cat EZ code for psc responsible
.
RTAOVRCD  FORM      1
.
SAVTYP    DIM       3
SCRID     DIM       2
SHRTBDAT  DIM       8
SHRTMDAT  DIM       7
SHRTVDAT  DIM       8
SVSTNCOD  DIM       6
STATNCOD  DIM       6
SIT4      DIM       4
SRC4      DIM       4
.
UNIQF5    FORM      5
VADESC    DIM       3
VARIABLE  DIM       127
VISITDAT  DIM       10            * formatted emergency visit date variable
VISITNUM  DIM       8             * emergency visit number variable
VISNOTES  DIM       100
.
WAITTIME  FORM      4
WCDESC    DIM       3
WCNAME    DIM       20
WDATE1    DIM       8
WDATE2    DIM       8
XPRIDIAG  DIM       6      * Primary Diagnosis
XADDIAG1  DIM       6      * Additional Diagnosis 1
.
VISXDCIN  FORM      1
.
ANSHP     INIT      "HP"
ANSPP     INIT      "PP"
CODEA     INIT      "A "
CODEA1    INIT      "A1"
CODEA2    INIT      "A2"
CODEA3    INIT      "A3"
CODEA4    INIT      "A4"
CODEA5    INIT      "A5"
CODEA6    INIT      "A6"
CODEA7    INIT      "A7"
CODEA8    INIT      "A8"
CODEAA    INIT      "AA"
CODEAE    INIT      "AE"
CODEAI    INIT      "AI"
CODEAP    INIT      "AP"
CODEAR    INIT      "AR"
CODECL    INIT      "CL"
CODEC     INIT      "C "
CODECC    INIT      "CC"
CODECT    INIT      "ct"
CODEEA    INIT      "EA"
CODEES    INIT      "ES"
CODEEP    INIT      "EP"
CODEED    INIT      "ED"
CODEEW    INIT      "EW"
CODEEZ    INIT      "EZ"
CODEH1    INIT      "H1"
CODEH2    INIT      "H2"
CODEH3    INIT      "H3"
CODEM     INIT      "M "
CODEP     INIT      "P "
CODEP1    INIT      "P1"
CODEP2    INIT      "P2"
CODEP3    INIT      "P3"
CODEP4    INIT      "P4"
CODEP5    INIT      "P5"
CODEP6    INIT      "P6"
CODER     INIT      "R "
CODERA    INIT      "RA"
CODET     INIT      "T "
CODEU1    INIT      "U1"
CODEV6    INIT      "V6"
CODEV7    INIT      "V7"
CODEV8    INIT      "V8"
CODES     INIT      "S "
CATcw     INIT      "cw"
CATEA     INIT      "ea"
CATEB     INIT      "eb"
CATEC     INIT      "ec"
CATED     INIT      "ed"
CATEE     INIT      "ee"
CATEF     INIT      "ef"
CATEG     INIT      "eg"
CATEH     INIT      "eh"
CATEI     INIT      "ei"
CATEJ     INIT      "ej"
CATEK     INIT      "ek"
CATEL     INIT      "el"
CATEM     INIT      "em"
CATEN     INIT      "en"
CATEO     INIT      "eo"
CATEP     INIT      "ep"
CATEQ     INIT      "eq"
CATER     INIT      "er"
CATES     INIT      "es"
CATET     INIT      "et"
CATEU     INIT      "eu"
CATEV     INIT      "ev"
CATEW     INIT      "ew"
CATEY     INIT      "ey"
CATHP     INIT      "HP"
CATLS     INIT      "LS"
CATTC     INIT      "tc"
CATWS     INIT      "ws"                                               *I-59548
CATWT     INIT      "wt"
CATWU     INIT      "wu"
CATWQ     INIT      "wq"                                               *I-59548
CATWR     INIT      "wr"                                               *I-59548
CATW0     INIT      "w0"
DASH      INIT      "-"
OTHER     INIT      "Other"
SP12      INIT      "            "
SP127     INIT      "                                          ":
                    "                                          ":
                    "                                           "
SP40      INIT      "                                       "
X27       INIT      "XXXXXXXXXXXXXXXXXXXXXXXXXXX"
X100      INIT      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
ZERO4     INIT      "0000"
.
CARET     INIT      "^"
MJAN      INIT      "January"
MFEB      INIT      "February"
MMAR      INIT      "March"
MAPR      INIT      "April"
MMAY      INIT      "May"
MJUN      INIT      "June"
MJUL      INIT      "July"
MAUG      INIT      "August"
MSEP      INIT      "September"
MOCT      INIT      "October"
MNOV      INIT      "November"
MDEC      INIT      "December"
.
.
. PROGRAM CONSTANTS
. -----------------
.
. Site specific soft font (16602). Change to this when delivery to site
.
ARIAL10N  INIT      "(8U(s1p10.00v0s0b16602T"  * Arial 10pt font/normal
ARIAL10B  INIT      "(8U(s1p10.00v0s3b16602T"  * Arial 10pt font/bold
.
.ARIAL10N  INIT      "(8U(s1p10.00v0s0b0T"     * Time Roman 10pt font/normal
.ARIAL10B  INIT      "(8U(s1p10.00v0s3b0T"     * Time Roman 10pt font/bold
.
HORZT001  INIT      "&a1C"      * tab to column 1
HORZT028  INIT      "&a28C"     * tab to column 28 
HORZT049  INIT      "&a49C"     * tab to column 49 
HORZT050  INIT      "&a50C"     * tab to column 50 
HORZT057  INIT      "&a57C"     * tab to column 57
HORZT082  INIT      "&a82C"     * tab to column 82 
HORZT086  INIT      "&a86C"     * tab to column 86
HORZT099  INIT      "&a99C"     * tab to column 99
HORZT100  INIT      "&a100C"    * tab to column 100
HORZT113  INIT      "&a113C"    * tab to column 113
HORZT141  INIT      "&a141C"    * tab to column 141
HORZT148  INIT      "&a148C"    * tab to column 148
HORZT149  INIT      "&a149C"    * tab to column 149
HORZT155  INIT      "&a155C"    * tab to column 155 
HORZT170  INIT      "&a170C"    * tab to column 170 
.
LINESPAC  INIT      "&l6D"      * line spacing - 6 lines/inch
.
NBARCODE  INIT      "(6U(s0p6.25h18.0v0s-6b0T*"      * Barcode style
.
PRIRESET  INIT      "E"         * printer reset
.
TMARGIN   INIT      "&l1e68F"   * top margin - 1 line
.                                   text length - 68 lines
.
.         Vertical movement is required for the barcode otherwise
.         it will print above the top line of the large labels (verttab1/2)
.
VERTTAB1  INIT      "*p+30Y"    * move 30 PCL units down (for barcode)
VERTTAB2  INIT      "*p-30Y"    * move 30 PCL units up (for barcode)
VERTTAB3  INIT      "*p+5Y"     * move 5  PCL units up (vertical space between
VERTTAB5  INIT      "*p+5Y"     * move 2  PCL units up (vertical space between
CONST1    INIT      "ED  UR"
CONST2    INIT      "A/T"
CONST3    INIT      "GP:"
.--------------------------------------------------------------------------------
NSETBOLD  INIT      "(s0bT"
SETBOLD   INIT      "(s7bT"
.
ALRCOMM   DIM       100
MULTILIN  FORM      1  
.--------------------------------------------------------------------------------
PRGID     INIT      "EMRWEB03"
VERSION   INIT      "V12.00.01"
PRGNAM    INIT      "Print Emergency Patient Labels and ID Sheets"
.--------------------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
.
          CALL      INIT0000       * Open Files
          MOVE      ZERO,CHKMNCNT    * initialise check mandatory cycle counter
.
MAIN0000  COMMIT
.
          BEGIN
.
          DISPLAY   *W2
.
          MOVE      ZERO,EXIT
          PACK      KEY5,SP70
          CALL      RSEMLP1
MAIN1000  CALL      RKEMLP1
          BRANCH    OVRCD,MAIN0000
.
          MOVE      EMLPUNI,KEY5
          CALL      RLEMLP1                 * Read and lock
          BRANCH    OVRCD,MAIN1000,MAIN1000
.
          CALL      DEEMLP1                 * Delete record
.
          MOVE      EMLPADM,ADMISSNO
          MOVE      EMLPURN,URNUMBER
          MOVE      EMLPLPN,LBLPRINT
          MOVE      EMLPFPN,FRMPRINT
          MOVE      EMLPCNO,NOLABEL
          MOVE      EMLPCNO,NOCOPIES
          MOVE      EMLPSTC,STATNCOD
          MOVE      EMLPREP,REPORTNO
          MOVE      EMLPLTY,LABELTYP
          MOVE      EMLPPSC,PASSCODE
.
          CALL      WEBU0000                * Get web user id
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200
          GOTO      MAIN9000
.
MAIN1100  MOVE      LBLPRINT,SELPRINT
          IF        AECNLABL<>9
            IF        AECNLABL<>4
              MOVE      ONE,NOCOPIES
              MOVE      HELPAGE,LABCOS
            ENDIF
          ENDIF
          CALL      PRTLAB00                * Print Patient Labels
          GOTO      MAIN9000
.
MAIN1200  MOVE      FRMPRINT,SELPRINT
          CALL      PRTIDS00                * Print ID Sheets
          GOTO      MAIN9000
.
MAIN9000  MOVE      ZERO,EXIT
          PACK      KEY5,SP70
          CALL      RSEMLP1
.
          COMMIT
.
          BEGIN
.
          GOTO      MAIN1000
.
.------------------------------------------------------------
.   Print Patient Labels
.------------------------------------------------------------
PRTLAB00  MATCH     SP70,ADMISSNO 
          GOTO      PRTLAB99 IF EQUAL
          MATCH     SP70,URNUMBER
          IF        @EOS
            MOVE      SP70,URNUMBER
          ENDIF 
.
          MATCH     "LABELBRA01",LABELTYP
          IF        @EQUAL
            MOVE     "Bradma Label Printing",SCHEDDSC
            MOVE     "LABELBRA",PRGID
            CALL     BRAD0000                 * Hard Coded Bradma Label Sheet
            MOVE     "EMRWEB03",PRGID
            GOTO     PRTLAB99
          ENDIF
.
          MATCH     "LABELKNX01",LABELTYP
          IF        @EQUAL
            MOVE      ONE,NOCOPIES
            MOVE      "Knox Label Printing",SCHEDDSC
            MOVE      "LABELKNX",PRGID
            CALL      KNOX0000
            MOVE      "EMRWEB03",PRGID
            GOTO      PRTLAB99
          ENDIF
.
          MATCH     "LABELHEC01",LABELTYP
          IF        @EQUAL
            MOVE      ONE,NOCOPIES
            MOVE      "HEC Label Printing",SCHEDDSC
            MOVE      "LABELHEC",PRGID
            CALL      HECR0000
            MOVE      "EMRWEB03",PRGID
            GOTO      PRTLAB99
          ENDIF
.
          MOVE      "Emergency Label Printing",SCHEDDSC
.
          COMPARE   TEN,AECNLABL
          IF        @EQUAL
            CALL      SJOGLB00
            GOTO      PRTLAB90
          ENDIF
.
          IF        AECNLABL = 9 | AECNLABL = 5 | AECNLABL = 4
.            MOVE      ZERO,STOPQUE 
            CALL      ZEBRAL00
          ELSE
            PROC      LABELEMR                * Print Labels
            MOVE     "EMRWEB03",PRGID
            CALL      UPDFPL00                * Update default printer file
          ENDIF
.
PRTLAB90  MOVE      SP70,SCHEDDSC
.
PRTLAB99  RETURN
.
.------------------------------------------------------------
.    Print SJOG Geelong labels
.------------------------------------------------------------
.
SJOGLB00  PACK      KEY8,URNUMBER
          CALL      RDMAST1
          BRANCH    OVRCD,SJOGLB99
.
          PACK      KEY8,URNUMBER
          CALL      RDPMPX21
          BRANCH    OVRCD,SJOGLB99
.
          PACK      KEY8,ADMISSNO
          CALL      RDEMVIS1
          BRANCH    OVRCD,SJOGLB99
.
          CALL      CLPMSVX1
          PACK      KEY8,ADMISSNO
          CALL      RDPMVX11
.
          CALL      AAESETLB
          CALL      AAEPRLAB
.
SJOGLB99  RETURN
+
.------------------------------------------------------------
.    Print St Vincent Labels on the Zebra printer
.------------------------------------------------------------
ZEBRAL00  PACK      KEY8,URNUMBER
          CALL      RDMAST1
          IF        OVRCD=1
            IF        AECNLABL=4
              CALL      CLPATMAS                * clear master detils
              CALL      CLPMSPX2                * clear mast ext2 details
              GOTO      ZEBRAL20
            ENDIF
.
            GOTO      ZEBRAL99
          ENDIF
.
          PACK      KEY8,URNUMBER
          CALL      RDPMPX21
.
ZEBRAL20  PACK      KEY8,ADMISSNO
          CALL      RDEMVIS1          * Validate on the A&E Detail File
          IF        OVRCD=1
            MOVE      URNUMBER,EMVIURNO
            MOVE      SP70,EMVICOMP
            MOVE      SP70,EMVICLAS
          ENDIF
.
          CALL      AAESETLB
          CALL      AAEPRLAB
.
ZEBRAL99  RETURN
+
.------------------------------------------------------------
.   Print ID Sheets
.------------------------------------------------------------
PRTIDS00  MATCH     SP70,URNUMBER
          IF        @EOS
            MOVE      SP70,URNUMBER
          ENDIF 
.
          MOVE      "Emergency ID Sheets Printing",SCHEDDSC
.
          PROC      PRINTEMR
.
          MOVE      SP70,SCHEDDSC
.
PRTIDS99  RETURN
.------------------------------------------------------------
. Program Initialisation
.------------------------------------------------------------
INIT0000  MOVE      ONE,EMRFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      EMRVISA2,"emrvisaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ZERO,EMRFLAG
          ENDIF
          OPEN      EMRCLIA1,"emrcliaf"
.
          OPEN      EMRHISA1,"emrhisaf"
          OPEN      EMRDCMA1,"emrdcmaf"
          OPEN      OBSDETA1,"obsdetaf"                                *I-54627
          OPEN      OBSMDTA1,"obsmdtaf"     * Patient Medical Notes
          OPEN      OBSMTXA1,"obsmtxaf"     * Patient Medical Notes fre

          OPEN      VISCMTA1,"viscmtaf"
          OPEN      VISMTXA1,"vismtxaf"
          OPEN      EMRICDA1,"emricdaf"
          OPEN      EMRWFMA1,"emrwfmaf"
          OPEN      EMRWFMA2,"emrwfmaf"
          OPEN      EMRWFMA3,"emrwfmaf"
          OPEN      EMRWFMA4,"emrwfmaf"
          OPEN      EMRISMA1,"emrismaf"
          OPEN      EMRINCA1,"emrincaf"
          OPEN      EMRINCA2,"emrincaf"
          OPEN      EMRINCA3,"emrincaf"
          OPEN      EMRVCDA1,"emrvcdaf"
          OPEN      EMRVCDA2,"emrvcdaf"                               *I-215117
          OPEN      EMRMTXA3,"emrmtxaf"
.
          OPEN      EMRUNKA1,"emrunkaf"
          OPEN      EMRLPCA1,"emrlpcaf"
          OPEN      EMRLOCA1,"emrlocaf"
          OPEN      EMRPROA1,"emrproaf"                                *I-50421
          OPEN      EMRSITA1,"emrsitaf"
.
          OPEN      OPRNURA1,"oprnuraf"                   
          OPEN      PATALRT1,"patalrtf"                                *I-54627
          OPEN      PATALTT1,"pataltaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PMSMDTA1,"pmsmdtaf"
          OPEN      PMSALNA1,"pmsalnaf"
          OPEN      PMSMDTA1,"pmsmdtaf"
          OPEN      PMSMTXA1,"pmsmtxaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PATVISA1,"patvisaf"
          OPEN      AAEDE1A1,"aaede1af"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATITEM1,"patitemn"                                *I-50421
          OPEN      PATICDO1,"paticdof"                                *I-50421
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PATVADA1,"patvadaf"
          OPEN      PMSVX1A1,"pmsvx1af"                                *I-55214
          OPEN      PMSRELA1,"pmsrelaf"
          OPEN      PMSTLEA1,"pmstleaf"
          OPEN      PMSCEXA1,"pmscexaf"
          OPEN      PRIITEM1,"priitemf"
          OPEN      VISCODA1,"viscodaf"
          OPEN      VISMDTA1,"vismdtaf"
.
          OPEN      IBAPDFA1,"ibapdfaf"
          OPEN      IHAPASS1,"ihapassf"
          OPEN      IBACODE1,"ibacodef"
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
          OPEN      IBASPOL1,"ibaspolf"
          OPEN      MEHDLSA1,"mehdlsaf"
          OPEN      WEBSECA3,"websecaf"
.
          OPEN      SCRSBGA1,"scrsbgaf"
          OPEN      SCRPSTA1,"scrpstaf"
          OPEN      SCRMASA1,"scrmasaf"
          OPEN      PATHGRP1,"pathgrpf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TWO;*182,CSNAME                           *I-54627
.
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          READ      CONTROLF,THIRTY;*89,HELPAGE,*90,HELPRNT,HELSIZE
.
          READ      CONTROLF,FIFTY9;*132,CALRDESC
          READ      CONTROLF,SEVENTY8;*64,AECNLABL
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,EIGHTY9;*138,EMCNICDF                     *I-50421
          READ      CONTROLF,HUND03;*212,PTCNPFSN,PTCNPFGN,*220,PTCNDEES:
                    *221,PTCNDDES
          READ      CONTROLF,HUND18;*138,PTCNNEWC
          READ      CONTROLF,HUND20;*158,PTCNUNET
          READ      CONTROLF,HUND22;*8,EMCNURSE
          READ      CONTROLF,HUND28;*210,PTCNSTYP
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          IF        EMCNICDF=0
              OPEN      PATICDD1,"paticddf"
              OPEN      PATICDD2,"paticddf"
              OPEN      PATI10D1,"pati10df"
              OPEN      PATI10D2,"pati10df"
          ELSE
              OPEN      EMRICDA1,"emricdaf"
              OPEN      EMRICDA2,"emricdaf"
              OPEN      EMRICDA3,"emricdaf"
          ENDIF
.
          MATCH     "0",PTCNUNET
          IF        !@EQUAL
            OPEN      PMSIHIA1,"pmsihiaf"     * IHI Details
          ENDIF
.
          MOVE      ZERO,VISXDCIN
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      VISXDCA1,"visxdcaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,VISXDCIN
          ENDIF
.
          RETURN
.---------------------------------------------------------------
. Clear Parameters (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
CLRPAR00  RETURN 
.---------------------------------------------------------------
. Set Parameters   (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
SETPAR00  RETURN
.---------------------------------------------------------------
. Process Fields   (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
PROFLD00  RETURN
.------------------------------------------------------------
.*****************************************************************
.  Following should not be printed on Labels
.*****************************************************************
HDGNS000
..   Any diagnoses on file
HDGNS999  RETURN
.*****************************************************************
HCNT0000
..   Any clinical notes on file
HCNT9999  RETURN
.*****************************************************************
HPRC0000
..   Any procedures on file
HPRC9999  RETURN
.*****************************************************************
UPDURT00
..   Update duration of waiting
UPDURT99  RETURN
.*****************************************************************
.------------------------------------------------------------
. Get web user id according to the emrlpcaf passcode
.------------------------------------------------------------
WEBU0000  PACK      KEY14,EMLPPSC,SP70
          CALL      RSWBSE3
WEBU1000  CALL      RKWBSE3
          BRANCH    OVRCD,WEBU9000
.
          MATCH     EMLPPSC,WBSEPCD
          GOTO      WEBU9000 IF NOT EQUAL
.
          GOTO      WEBU9999
.
WEBU9000  MOVE      SP70,WBSEUID
          GOTO      WEBU9999
.
WEBU9999  RETURN
.
.------------------------------------------------------------
.  Hard Coded Bradma Sheet of labels
.------------------------------------------------------------
BRAD0000  PACK      KEY8,ADMISSNO,SP70
          CALL      RDEMVIS1          * Validate on the A&E Detail File
          BRANCH    OVRCD,BRAD9999
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,BRAD9999
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
.
          MOVE      SP70,PGPNAME
          MATCH     SP10,PMPXRHC1
          IF        !@EQUAL
            MOVE      PMPXRHC1,KEY10
            CALL      RDPMHCP1
            IF        OVRCD = 0
              SQUEEZE   PMHCSNAM
              SQUEEZE   PMHCGNAM
              PACK      PGPNAME,PMHCSNAM,COMMA,SP1,PMHCGNAM
            ENDIF
          ENDIF
.
.         Load U/R number for barcode
.
          MOVE      EMVIURNO,DIM8
          SQUEEZE   DIM8
          MOVE      DIM8,PTURNO
          PACK      BURNO,DIM8,ASK,SP9
.
          MOVE      ADMISSNO,DIM8
          SQUEEZE   DIM8
          MOVE      DIM8,PTADMNO
          PACK      BADMNO,DIM8,ASK,SP9
.
          MOVE      PSNAME,DIM11S                * load surname
          MOVE      PGNAME,DIM11G                * load given name
          MOVE      PGNAME,DIM18                 * load given name
.
.         Get sex description
.
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00
.         MOVE      PSEX,ANS
.         REP       "M1F2U3I4R5",ANS
.         MOVE      ANS,FORM1
.         LOAD      SEXDESCR,FORM1,SEXDESC1,SEXDESC2,SEXDESC3,SEXDESC4,SEXDESC5
.
.          CALL      PACADDRS                     * format address
.          MOVE      PACADDRS,DIM31
.
          CLEAR     PADDRSS1
          STRIP     PADD1
          APPEND    PADD1,PADDRSS1
          APPEND    SP1,PADDRSS1
          STRIP     PADD2
          APPEND    PADD2,PADDRSS1
          RESET     PADDRSS1
.
          CLEAR     PADDRSS2
          STRIP     PSUBRB
          APPEND    PSUBRB,PADDRSS2
          APPEND    SP1,PADDRSS2
          STRIP     PADD4
          APPEND    PADD4,PADDRSS2
          RESET     PADDRSS2
.
          MOVE      "y",PSAGETYP
          MOVE      PSAGE,PSAGECON
          IF        PTCNDATE = 1
            CALL      IBACLOCK
            IF        PCEASE=1
              MOVE      PDECDTE,AGEDATE            * Date of Death
            ELSE
              PACK      AGEDATE,CCC,CYY,CMM,CDD    * today's date
            ENDIF
            REP       " 0",AGEDATE
.
            CALL      CALCAGE
          ENDIF
          MOVE      PSAGECON,PAGEYRS                 * format age
          SQUEEZE   PAGEYRS
          ENDSET    PAGEYRS
          APPEND    PSAGETYP,PAGEYRS
          RESET     PAGEYRS
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY      * format DOB
          CALL      PACDATE
          MOVE      CPCDATE,BIRTHDAT
.
          UNPACK    EMVIDATE,CCENT,CYEAR,CMON,CDAY    * format visit date
          CALL      PACDATE
          MOVE      CPCDATE,VISITDAT
          MOVE      EMVITIME,DIM5
.
          CALL      OPNPRINT
.
          MOVE      SP70,PCLMTYPD
          MATCH     SP70,EMVICOMP
          IF        !@EQUAL & !@EOS
            PACK      KEY5,ANSC,ANSL,EMVICOMP,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      EMVICOMP,TDESC
            ENDIF
            MOVE      TDESC,PCLMTYPD
          ENDIF
.
          MOVE      SP70,EDOCNAME 
          MATCH     SP70,EMVIDOCT
          IF        !@EQUAL & !@EOS
            MOVE      EMVIDOCT,KEY6             * description
            CALL      RDDOCT1
            IF        OVRCD=0
              MOVE      DTITL,FMTTITLE
              MOVE      DGNAME,FMTGNAME
              MOVE      DSNAME,FMTSNAME
              STRIP     FMTTITLE
              STRIP     FMTGNAME
              STRIP     FMTSNAME
              CALL      DOCNM000
              MOVE      DOCFNAME,EDOCNAME
            ENDIF
          ENDIF
.
          SQUEEZE   PTMXMCCD 
          PACK      PRTLABL1,CONST1,SP1,PTURNO,SP70
          PACK      PRTLABL2,CONST2,SP1,VISITDAT,SP1,DIM5,SP70
          PACK      PRTLABL3,BIRTHDAT,SP1,PAGEYRS,SP1,PSEX,SP70
          PACK      PRTLABL6,CONST3,PGPNAME,SP70
          MOVE      PSNAME,PSURNAME
          MOVE      PGNAME,PGIVNAME  
.
          MOVE      SP70,PRTLABL4      
          MOVE      SP70,MEDINUMB
          MATCH     SP70,PMEDI                        * blank medicare number ?
          IF        !@EQUAL
            MOVE      PMEDI,MEDINUMB                  * no
            SQUEEZE   MEDINUMB
            MATCH     SP2,PTMXMCCD                    * m/c ref no blank ?
            IF        !@EQUAL
              ENDSET    MEDINUMB                      
              APPEND    SLASH,MEDINUMB
              APPEND    PTMXMCCD,MEDINUMB
              RESET     MEDINUMB
              SQUEEZE   MEDINUMB
            ENDIF
            PACK      PRTLABL4,ANSM,SP1,MEDINUMB,SP70
          ENDIF
.
          MOVE      SP70,PRTLABL5
          MATCH     SP70,PPENNO                       * blank pension number ?
          IF        !@EQUAL
            PACK      PRTLABL5,ANSP,SP1,PPENNO,SP70
          ENDIF
.
          PRINT     PRIRESET,TMARGIN
.
          MOVE      ZERO,COUNTER                 * initialise counter
          WHILE     COUNTER < 6
            ADD       ONE,COUNTER                * increment counter
.
            PRINT     *C,VERTTAB5;
            PRINT     ARIAL10N,VERTTAB1,NBARCODE,BURNO:
                      VERTTAB2,ARIAL10N,HORZT049,"":
                      HORZT050,VERTTAB1,NBARCODE,BADMNO:
                      VERTTAB2,ARIAL10N,HORZT099,"":
                      HORZT100,VERTTAB1,NBARCODE,BURNO:
                      VERTTAB2,ARIAL10N,HORZT148,"":
                      HORZT149,VERTTAB1,NBARCODE,BADMNO,*N,*C:
.
                      ARIAL10B,PRTLABL1:
                      HORZT050,ARIAL10B,EDOCNAME:
                      HORZT100,ARIAL10B,PRTLABL1:
                      HORZT149,ARIAL10B,EDOCNAME,*N,*C:
.
                      ARIAL10B,PSURNAME:
                      HORZT050,ARIAL10B,PRTLABL2:
                      HORZT100,ARIAL10B,PSURNAME:
                      HORZT149,ARIAL10B,PRTLABL2:
                      *N,*C:
.
                      ARIAL10B,PGIVNAME:
                      HORZT050,ARIAL10B,PRTLABL3:
                      HORZT100,ARIAL10B,PGIVNAME:
                      HORZT149,ARIAL10B,PRTLABL3:
                      *N,*C:
.
                      ARIAL10N,PRTLABL4:
                      HORZT050,ARIAL10N,PRTLABL5:
                      HORZT100,ARIAL10N,PRTLABL4:
                      HORZT149,ARIAL10N,PRTLABL5:
                      *N,*C:
.
                      ARIAL10N,PADDRSS1:
                      HORZT050,ARIAL10N,PFUNDH:
                      HORZT100,ARIAL10N,PADDRSS1:
                      HORZT149,ARIAL10N,PFUNDH:
                      *N,*C:
.
                      ARIAL10N,PADDRSS2:
                      HORZT050,ARIAL10N,PCLMTYPD:
                      HORZT100,ARIAL10N,PADDRSS2:
                      HORZT149,ARIAL10N,PCLMTYPD:
                      *N,*C:
.
                      ARIAL10N,PRTLABL6:
                      HORZT100,ARIAL10N,PRTLABL6:
                      *C,VERTTAB3
          DO
.
          PRINT     *C,VERTTAB5;
.
          MOVE      ZERO,COUNTER                 * initialise counter
          WHILE     COUNTER < 2
            ADD       ONE,COUNTER                * increment counter
.
            PRINT     ARIAL10B,PTURNO:
                      HORZT028,PTURNO:
                      HORZT057,PTURNO:
                      HORZT086,PTURNO:
                      HORZT113,PTURNO:
                      HORZT141,PTURNO:
                      HORZT170,PTURNO,*N,*C:
.
                      DIM11S:
                      HORZT028,DIM11S:
                      HORZT057,DIM11S:
                      HORZT086,DIM11S:
                      HORZT113,DIM11S:
                      HORZT141,DIM11S:
                      HORZT170,DIM11S,*N,*C:
.
                      DIM11G:
                      HORZT028,DIM11G:
                      HORZT057,DIM11G:
                      HORZT086,DIM11G:
                      HORZT113,DIM11G:
                      HORZT141,DIM11G:
                      HORZT170,DIM11G,*N,*C:
.
                      BIRTHDAT:
                      HORZT028,BIRTHDAT:
                      HORZT057,BIRTHDAT:
                      HORZT086,BIRTHDAT:
                      HORZT113,BIRTHDAT:
                      HORZT141,BIRTHDAT:
                      HORZT170,BIRTHDAT,*N,*C:
.
                      "Date:":
                      HORZT028,"Date:":
                      HORZT057,"Date:":
                      HORZT086,"Date:":
                      HORZT113,"Date:":
                      HORZT141,"Date:":
                      HORZT170,"Date:",*N,*C:
.
                      "Time:":
                      HORZT028,"Time:":
                      HORZT057,"Time:":
                      HORZT086,"Time:":
                      HORZT113,"Time:":
                      HORZT141,"Time:":
                      HORZT170,"Time:",*N,*C:
.
                      "Sign:":
                      HORZT028,"Sign:":
                      HORZT057,"Sign:":
                      HORZT086,"Sign:":
                      HORZT113,"Sign:":
                      HORZT141,"Sign:":
                      HORZT170,"Sign:",*C,VERTTAB3
          DO
.
          PRINT     PRIRESET
.
          CALL      CLSPRINT
.
BRAD9999  RETURN
.
.--------------------------------------------------------------------
KNOX0000  PACK      KEY8,ADMISSNO,SP70
          CALL      RDEMVIS1                      * Validate on the A&E Detail File
          BRANCH    OVRCD,KNOX9999
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,KNOX9999
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,KNOX9999
.
          MATCH     SP10,PMPXRHC1
          GOTO      KNOX2000 IF EQUAL
.
          PACK      KEY10,PMPXRHC1
          CALL      RDPMHCP1
          BRANCH    OVRCD,KNOX2000
.
          MOVE      PMHCTITL,PACTITLE                 * format local GP name
          MOVE      PMHCGNAM,PACGNAME
          MOVE      PMHCSNAM,PACSNAME
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          GOTO      KNOX3000
.
KNOX2000  CALL      CLPMSHCP
          MOVE      SP70,PACTITLE
          MOVE      SP70,PACGNAME
          MOVE      SP70,PACSNAME
          MOVE      ONE,PACFRMT
          CALL      PACNAME
.
KNOX3000  UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY      * format DOB
          CALL      PACDATE
          MOVE      CPCDATE,BIRTHDAT
.
          UNPACK    EMVIDATE,CCENT,CYEAR,CMON,CDAY    * format visit date
          CALL      PACDATE
          MOVE      CPCDATE,VISITDAT
.
          CALL      OPNPRINT
.
.         PRINT     PRIRESET,TMARGIN
.
          CALL      SETKNX00
          CALL      PRTKNX00
.
.         PRINT     PRIRESET

          CALL      CLSPRINT
.
KNOX9999  RETURN
+
.--------------------------------------------------------------------
.         SETKNX00 - set print lab knox
.--------------------------------------------------------------------
.
SETKNX00  MOVE      SP3,DCASE
          BRANCH    PCASE,SETKNX10,SETKNX20
          GOTO      SETKNX20
.
SETKNX10  MOVE      "*",DCASE
.
SETKNX20  PACK      WFLINE1,SP40
          CLEAR     WFLINE1
          APPEND    PSNAME,WFLINE1    * surname
.
SETKNX21  CMATCH    SP1,WFLINE1
          GOTO      SETKNX22 IF NOT EQUAL
          BUMP      WFLINE1,-1
          GOTO      SETKNX21
.
SETKNX22  RESET     WLINE1
          APPEND    SP1,WFLINE1
          APPEND    PTITL,WFLINE1     * title
          APPEND    SP40,WFLINE1
          RESET     WFLINE1,40
          LENSET    WFLINE1
          RESET     WFLINE1
.
          PACK      WFLINE1A,SP30
          CLEAR     WFLINE1A
          APPEND    PSNAME,WFLINE1A   * surname
          APPEND    SP30,WFLINE1A
          LENSET    WFLINE1A
          RESET     WFLINE1A
.
          PACK      WFLINE2,SP40
          CLEAR     WFLINE2
          APPEND    PGNAME,WFLINE2     * first name
          RESET     WFLINE2,24
          APPEND    "U/R: ",WFLINE2
          APPEND    EMVIURNO,WFLINE2   * u/r.
          APPEND    DCASE,WFLINE2
          APPEND    SP40,WFLINE2
          LENSET    WFLINE2
          RESET     WFLINE2
.
          PACK      WFLINE2A,SP30
          CLEAR     WFLINE2A
          APPEND    PGNAME,WFLINE2A     * first name
          APPEND    SP30,WFLINE2A
          LENSET    WFLINE2A
          RESET     WFLINE2A
.
          PACK      WFLINE3,SP40
          CLEAR     WFLINE3
          APPEND    "DOB:",WFLINE3
          APPEND    BIRTHDAT,WFLINE3     * DOB
          RESET     WFLINE3,18
          APPEND    PSEX,WFLINE3         * gender
          RESET     WFLINE3,24
          APPEND    PMEDI,WFLINE3        * medicare num.
          APPEND    SP40,WFLINE3
          LENSET    WFLINE3
          RESET     WFLINE3
.
          PACK      WFLINE3A,SP30
          CLEAR     WFLINE3A
          APPEND    "EMERGENCY DEPARTMENT",WFLINE3A
          APPEND    SP30,WFLINE3A
          LENSET    WFLINE3A
          RESET     WFLINE3A
.
          MATCH     PADD2,SP70
          IF        @EQUAL
            PACK      WFLINE5,SP40
            CLEAR     WFLINE5
            APPEND    PADD1,WFLINE5     * address 1
            RESET     WFLINE5,24
            APPEND    PTELEP,WFLINE5     * patient tel.
            APPEND    SP40,WFLINE5
            LENSET    WFLINE5
            RESET     WFLINE5
            PACK      WFLINE4,SP70
          ELSE
            PACK      WFLINE4,SP40
            CLEAR     WFLINE4
            APPEND    PADD1,WFLINE4     * address 1
            RESET     WFLINE4,24
            APPEND    PTELEP,WFLINE4     * patient tel.
            APPEND    SP40,WFLINE4
            LENSET    WFLINE4
            RESET     WFLINE4
.
            PACK      WFLINE5,SP40
            CLEAR     WFLINE5
            APPEND    PADD2,WFLINE5
            RESET     WFLINE5,24
.           APPEND    PREG,WFLINE5      * patient reg.
            APPEND    SP40,WFLINE5
            LENSET    WFLINE5
            RESET     WFLINE5
          ENDIF

          PACK      WFLINE4A,SP30
          CLEAR     WFLINE4A
          APPEND    BIRTHDAT,WFLINE4A * DOB
          APPEND    SP30,WFLINE4A
          LENSET    WFLINE4A
          RESET     WFLINE4A
.
          PACK      WFLINE5A,SP30
          CLEAR     WFLINE5A
          APPEND    "U/R:",WFLINE5A
          APPEND    EMVIURNO,WFLINE5A  *emr u/r no.
          APPEND    SP30,WFLINE5A
          LENSET    WFLINE5A
          RESET     WFLINE5A
.
          PACK      WFLINE6,SP40
          CLEAR     WFLINE6
          APPEND    PSUBRB,WFLINE6      * suburb
          RESET     WFLINE6,18
          APPEND    PPOST,WFLINE6       * post code
          APPEND    SP40,WFLINE6
          LENSET    WFLINE6
          RESET     WFLINE6
.
          PACK      WFLINE6A,SP30
          CLEAR     WFLINE6A
          APPEND    "DATE:",WFLINE6A
          APPEND    SP30,WFLINE6A
          LENSET    WFLINE6A
          RESET     WFLINE6A
.
          PACK      WFLINE7,SP40
          CLEAR     WFLINE7
          APPEND    PACFNAME,WFLINE7      * local dr
          RESET     WFLINE7,24
          MATCH     SP70,PMHCSTEL
          IF        !@EQUAL
            APPEND    PMHCSTEL,WFLINE7    * tel.
          ELSE
            MATCH     SP70,PMPXRHC1       * Registered HCP?
            IF        !@EQUAL
              MATCH     SP70,PMPXRH1G
              IF        !@EQUAL
                PACK      KEY12,PMPXRH1G,PMPXR1GC,SP70
                CALL      RDPMHCG1
                IF        OVRCD=0
                  APPEND    PMHGPTEL,WFLINE7       * Practice Phone Number
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          APPEND    SP40,WFLINE7
          LENSET    WFLINE7
          RESET     WFLINE7
.
          PACK      WFLINE7A,SP30
          CLEAR     WFLINE7A
          APPEND    "TIME:",WFLINE7A
          APPEND    SP30,WFLINE7A
          LENSET    WFLINE7A
          RESET     WFLINE7A
.
          PACK      WFLINE8,SP40
          CLEAR     WFLINE8
          APPEND    "Presented: ",WFLINE8
          APPEND    VISITDAT,WFLINE8          * emr vis date
          RESET     WFLINE8,24
          APPEND    "ED:",WFLINE8
          APPEND    ADMISSNO,WFLINE8         * emr vis no.
          APPEND    SP40,WFLINE8
          LENSET    WFLINE8
          RESET     WFLINE8
.
          PACK      WFLINE8A,SP30
          CLEAR     WFLINE8A
          APPEND    "SIGN:",WFLINE8A
          APPEND    SP30,WFLINE8A
          LENSET    WFLINE8A
          RESET     WFLINE8A
.
SETKNX99  RETURN
+
.--------------------------------------------------------------------
.         PRTKNX00 - print label
.--------------------------------------------------------------------
.
PRTKNX00  MOVE      TWO,LABCOS
          CLEAR     LARGELAB              * Setting up large label
          APPEND    ESC,LARGELAB
          APPEND    "(sp15h8vsb4099T",LARGELAB
          RESET     LARGELAB
.
          CLEAR     SMALLLAB              * Setting up small label
          APPEND    ESC,SMALLLAB
          APPEND    "(sp18.46h6.5vsb4099T",SMALLLAB
          RESET     SMALLLAB
.
PRTKNX10  COMPARE   NOLABEL,ZERO
          GOTO      PRTKNX99 IF NOT LESS        * <=0, exit
.
          COMPARE   NOLABEL,LABCOS
          GOTO      PRTKNX20 IF LESS
.
          MOVE      NOLABEL,LABCOS          * Print remainder
.
PRTKNX20  BRANCH    LABCOS,PRTKNX31,PRTKNX32
          GOTO      PRTKNX99
.
PRTKNX31  PRINT     *1,*+,LARGELAB,SETBOLD,WFLINE1,NSETBOLD,*98,SMALLLAB,WFLINE1A:
                    *N,*1,*+,LARGELAB,SETBOLD,WFLINE2,NSETBOLD,*98,SMALLLAB,WFLINE2A:
                    *N,*1,*+,LARGELAB,WFLINE3,*98,SMALLLAB,WFLINE3A:
                    *N,*1,*+,LARGELAB,WFLINE4,*98,SMALLLAB,WFLINE4A:
                    *N,*1,*+,LARGELAB,WFLINE5,*98,SMALLLAB,WFLINE5A:
                    *N,*1,*+,LARGELAB,WFLINE6,*98,WFLINE6A:
                    *N,*1,*+,LARGELAB,WFLINE7,*98,WFLINE7A:
                    *N,*1,*+,LARGELAB,WFLINE8,*98,WFLINE8A
.
          SUB       ONE,NOLABEL
          GOTO      PRTKNX10
.
PRTKNX32  PRINT     *1,*+,LARGELAB,SETBOLD,WFLINE1,*42,WFLINE1,NSETBOLD:
                       *83,SMALLLAB,WFLINE1A,*128,WFLINE1A:
                    *N,*1,*+,LARGELAB,SETBOLD,WFLINE2,*42,WFLINE2,NSETBOLD:
                       *83,SMALLLAB,WFLINE2A,*128,WFLINE2A:
                    *N,*1,*+,LARGELAB,WFLINE3,*42,WFLINE3:
                       *83,SMALLLAB,WFLINE3A,*128,WFLINE3A:
                    *N,*1,*+,LARGELAB,WFLINE4,*42,WFLINE4:
                       *83,SMALLLAB,WFLINE4A,*128,WFLINE4A:
                    *N,*1,*+,LARGELAB,WFLINE5,*42,WFLINE5:
                       *83,SMALLLAB,WFLINE5A,*128,WFLINE5A:
                    *N,*1,*+,LARGELAB,WFLINE6,*42,WFLINE6:
                       *83,WFLINE6A,*103,WFLINE6A:
                    *N,*1,*+,LARGELAB,WFLINE7,*42,WFLINE7:
                       *83,WFLINE7A,*103,WFLINE7A:
                    *N,*1,*+,LARGELAB,WFLINE8,*42,WFLINE8:
                       *83,WFLINE8A,*103,WFLINE8A
.
          SUB       TWO,NOLABEL
          GOTO      PRTKNX10
.
PRTKNX99  RETURN
+
.*****************************************************************************
.*                             HECR0000            Called by: PRTLAB00       *
.*             Load data for Healthe Care ED labels                          *
.*****************************************************************************
.
.         Read the relevant visit and pmi records
.
HECR0000  PACK      KEY8,ADMISSNO,SP70
          CALL      RDEMVIS1                     * emr record found ?
          BRANCH    OVRCD,HECR9999               * no - finish
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1                      * pmi record found ?
          BRANCH    OVRCD,HECR9999               * no - finish
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21                     * pmi extension found ?
          BRANCH    OVRCD,HECR9999               * no - finish
.
          MOVE      PTITL,PACTITLE              * format pt. name
          MOVE      PGNAME,PACGNAME
          MOVE      PSNAME,PACSNAME
          MOVE      TWO,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAME,PTFRMTNM
.
.         Get the local GP details
.
          MOVE      SP70,PACTITLE                * init. name format variables
          MOVE      SP70,PACGNAME
          MOVE      SP70,PACSNAME
          MOVE      SP70,PMHCFAXN                * init. GP fax
.
          MATCH     SP10,PMPXRHC1                * registered HCP 1 blank ?
          GOTO      HECR2000 IF EQUAL            * yes

          MOVE      PMPXRHC1,KEY10
          CALL      RDPMHCP1                     * no - HCP record found ?
          BRANCH    OVRCD,HECR2000               * no
.
HECR2000  MOVE      PMHCTITL,PACTITLE            * format local GP name
          MOVE      PMHCGNAM,PACGNAME
          MOVE      PMHCSNAM,PACSNAME
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAME,GPFRMTNM
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY      * format DOB
          CALL      PACDATE
          MOVE      CPDATE,SHRTBDAT
          MOVE      CPCDATE,BIRTHDAT
.
          MOVE      SP7,SHRTMDAT                      * init. m/c expiry date
          MATCH     SP7,PMPXMEDC                      * blank m/c expiry date ?
          IF        !@EQUAL
            UNPACK    PMPXMEDC,CCENT,CYEAR,CMON,CDAY  * no - format as mm/ccyy
            PACK      SHRTMDAT,CMON,SLASH,CCENT,CYEAR
            REP       " 0",SHRTMDAT
          ENDIF
.
          UNPACK    EMVIDATE,CCENT,CYEAR,CMON,CDAY    * format visit date
          CALL      PACDATE
          MOVE      CPDATE,SHRTVDAT
.
          MOVE      SP20,MEDINUMB                     * init. medicare number
          MATCH     SP10,PMEDI                        * blank medicare number ?
          IF        !@EQUAL
            MOVE      PMEDI,MEDINUMB                  * no
            SQUEEZE   MEDINUMB
            MATCH     SP2,PTMXMCCD                    * m/c ref no blank ?
            IF        !@EQUAL
              ENDSET    MEDINUMB                      * no
              APPEND    SLASH,MEDINUMB
              APPEND    PTMXMCCD,MEDINUMB
              RESET     MEDINUMB
              SQUEEZE   MEDINUMB
            ENDIF
            PACK      MEDINUMB,MEDINUMB,SP20
          ENDIF
.
.         Get the hospital approval number if using multi-hospital
.
          READ      CONTROLF,TEN;*79,CAPPRVNO         * load default approval #
.
          MOVE      EMVISITE,KEY3
          CALL      RDEMSIT1                          * site on file ?
          BRANCH    OVRCD,HECR5000                    * no
.
          COMPARE   ONE,IBCNMHOS                      * using multi-hospital ?
          GOTO      HECR5000 IF NOT EQUAL             * no
.
          MATCH     SP3,EMSTHSNO                      * blank hospital id ?
          GOTO      HECR5000 IF EQUAL                 * yes
.
          MOVE      EMSTHSNO,KEY3
          CALL      RDPTHSP1                          * hospital on file ?
          BRANCH    OVRCD,HECR5000                    * no
.
          MATCH     SP10,PTHSAPPR                     * hosp. approval blank ?
          GOTO      HECR5000 IF EQUAL                 * yes
.
          MOVE      PTHSAPPR,CAPPRVNO                 * override default
.
HECR5000  CALL      IBACLOCK                          * get patient age today
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          REP       " 0",AGEDATE
          CALL      CALCAGE
.
          MOVE      PSEX,DSEXCHAR                     * get patient gender
          CALL      SEXDSC00
.
.         Check if the patient has any concession cards
.
          CALL      GCCSJG00
.
HECR9000  CALL      OPNPRINT
.
.         PRINT     PRIRESET,TMARGIN
.
          CALL      SETHEC00
          CALL      PRTHEC00
.
.         PRINT     PRIRESET

          CALL      CLSPRINT
.
HECR9999  RETURN
+
.*****************************************************************************
.*                             HECR00000           Called by: HECR0000       *
.*             Set the print variables for the HEC label                     *
.*  LINEx37 is a 37 character variable for the large label.                  *
.*  LINEx17 is a 17 character variable for the small label.                  *
.*****************************************************************************
.
.         Set Line A variables
.         Large Label
.
SETHEC00  MOVE      PTFRMTNM,LINEA37             * load pt. formatted name
          STRIP     LINEA37
          ENDSET    LINEA37
          APPEND    SP70,LINEA37
          RESET     LINEA37
          SETLPTR   LINEA37,25                   * load U/R number
          ENDSET    LINEA37
          APPEND    SP1,LINEA37
          APPEND    "UR:",LINEA37
          APPEND    PURNO,LINEA37
          RESET     LINEA37
.
.         Small Label
.
          MOVE      EMSTSPCO,LINEA17             * load ED service point code
          ENDSET    LINEA17
          APPEND    SP1,LINEA17
          APPEND    "UR:",LINEA17                * load U/R number
          APPEND    PURNO,LINEA17
          RESET     LINEA17
.
.         Set Line B variables
.         Large Label
.
          MOVE      PADD1,LINEB37                * load address line 1
          STRIP     LINEB37
          ENDSET    LINEB37
          APPEND    SP70,LINEB37
          RESET     LINEB37
          SETLPTR   LINEB37,25                   * load visit number
          ENDSET    LINEB37
          APPEND    SP1,LINEB37
          APPEND    "AD:",LINEB37
          APPEND    EMVIADMN,LINEB37
          RESET     LINEB37
.
.         Small Label
.
          MOVE      "ED AD## ",LINEB17           * load visit number
          ENDSET    LINEB17
          APPEND    EMVIADMN,LINEB17
          RESET     LINEB17
.
.         Set Line C variables
.         Large Label
.
          MOVE      PSUBRB,LINEC37               * load address line 3
          STRIP     LINEC37
          ENDSET    LINEC37
          APPEND    SP70,LINEC37
          RESET     LINEC37
          SETLPTR   LINEC37,21                   * load postcode number
          ENDSET    LINEC37
          APPEND    SP1,LINEC37
          APPEND    PPOST,LINEC37
          RESET     LINEC37
          STRIP     LINEC37
          ENDSET    LINEC37
          APPEND    SP70,LINEC37
          RESET     LINEC37
          SETLPTR   LINEC37,26                   * load visit date
          ENDSET    LINEC37
          APPEND    SP1,LINEC37
          APPEND    "A:",LINEC37
          APPEND    SHRTVDAT,LINEC37
          RESET     LINEC37
.
.         Small Label
.
          MOVE      PSNAME,LINEC17               * load suname
.
.         Set Line D variables
.         Large Label
.
          MOVE      "NurseHome: ",LINED37        * load address line 2
          ENDSET    LINED37
          APPEND    PADD2,LINED37
          APPEND    SP70,LINED37
          RESET     LINED37
.
.         Small Label
.
          MOVE      PGNAME,LINED17               * load given names
.
.         Set Line E variables
.         Large Label
.
          MOVE      "PH:",LINEE37                * load home phone
          ENDSET    LINEE37
          APPEND    PTELEP,LINEE37
          RESET     LINEE37
          SQUEEZE   LINEE37
          ENDSET    LINEE37
          APPEND    SP70,LINEE37
          RESET     LINEE37
          SETLPTR   LINEE37,18                   * load gender
          ENDSET    LINEE37
          APPEND    DSEXDESC,LINEE37
          APPEND    SP70,LINEE37
          RESET     LINEE37
          SETLPTR   LINEE37,24                   * load date of birth
          ENDSET    LINEE37
          APPEND    SHRTBDAT,LINEE37
          APPEND    "(",LINEE37
          APPEND    PSAGEYRS,LINEE37             * load age
          APPEND    ")",LINEE37
          RESET     LINEE37
.
.         Small Label
.
          MOVE      BIRTHDAT,LINEE17             * load DOB
          ENDSET    LINEE17
          APPEND    " -",LINEE17
          APPEND    PSAGEYRS,LINEE17             * load age
          RESET     LINEE17
.
.         Set Line F variables
.         Large Label
.
          MOVE      "MC:",LINEF37                * load medicare number
          ENDSET    LINEF37
          APPEND    MEDINUMB,LINEF37
          ENDSET    LINEF37
          APPEND    SP70,LINEF37
          RESET     LINEF37
          SETLPTR   LINEF37,18                   * load m/c card expiry date
          ENDSET    LINEF37
          APPEND    SP1,LINEF37
          APPEND    SHRTMDAT,LINEF37
          APPEND    SP70,LINEF37
          RESET     LINEF37
          SETLPTR   LINEF37,30                   * load marital status
          ENDSET    LINEF37
          APPEND    "MAR:",LINEF37
          APPEND    PMSTAT,LINEF37
          RESET     LINEF37
.
.         Small Label
.
          PACK      LINEF17,DSEXDESC,SP70        * load gender
.
.         Set Line G variables
.         Large Label
.
          MOVE      EMVIADMN,ADMISSNO
          MOVE      EMVICOMP,CLAIMCOD
          CALL      CMPH0000                     * get claim details
          PACK      LINEG37,SP70,SP70
          MOVE      "CL:",LINEG37                * load Claim Type
          ENDSET    LINEG37
          APPEND    EMVICOMP,LINEG37
          APPEND    SP1,LINEG37
          APPEND    CLMDET1,LINEG37
          RESET     LINEG37
          SETLPTR   LINEG37,21
          ENDSET    LINEG37
          APPEND    SP1,LINEG37
          APPEND    CLMDET2,LINEG37
          RESET     LINEG37
.
.         Small Label
.
          MOVE      "DATE:",LINEG17
.
.         Set Line H variables
.         Large Label
.
          MOVE      "LocGP:",LINEH37             * load Local GP formatted name
          ENDSET    LINEH37
          APPEND    GPFRMTNM,LINEH37
          APPEND    SP70,LINEH37
          RESET     LINEH37
.
.         Small Label
.
          MOVE      "TIME:",LINEH17
.
.         Set Line I variables
.         Large Label
.
          MOVE      "GP Fax:",LINEI37            * load Local GP fax number
          ENDSET    LINEI37
          APPEND    PMHCFAXN,LINEI37
          RESET     LINEI37
          SQUEEZE   LINEI37
          ENDSET    LINEI37
          APPEND    SP70,LINEI37
          RESET     LINEI37
          SETLPTR   LINEI37,17                   * load concession card
          ENDSET    LINEI37                      * type and number 
          APPEND    PMCDCTYP,LINEI37
.
          MATCH     SP70,PMCDCTYP
          IF        !@EQUAL
            APPEND    ":",LINEI37
          ELSE
            APPEND    " ",LINEI37
          ENDIF
.
          APPEND    PMCDCNUM,LINEI37
          APPEND    SP70,LINEI37
          RESET     LINEI37
          SETLPTR   LINEI37,33                   * load Ed site code
          ENDSET    LINEI37
          APPEND    SP1,LINEI37
          APPEND    EMSTSPCO,LINEI37             * load ED service point code
          RESET     LINEI37
.
.         Small Label
.
          MOVE      "SIGNATURE:",LINEI17
.
SETHEC99  RETURN
+
.*****************************************************************************
.*                             PRTHEC00            Called by: HECR0000       *
.*            Print the Healthe Care ED label                                *
.*  PCL5 Font Related Printer Commands used in this routine:                 *
.*     Note: Where # is indicated, this represents a numeric value.          *
.*           Multiple escape commands can be set in a single command.        *
.*           Lowercase characters can also be used instead of uppercase.     *
.*     Esc(s#P - Line spacing                                                *
.*                    where # = 0, sets to fixed spacing                     *
.*                    if no number is supplied it defaults to 0              *
.*     Esc(s#H - Pitch in characters/inch                                    *
.*     Esc(s#S - Style                                                       *
.*                    where # = 0, sets to Upright style                     *
.*                    if no number is supplied it defaults to 0              *
.*     Esc(s#B - Stroke Weight                                               *
.*                    where # = 0, sets to medium, book or text              *
.*                    if no number is supplied it defaults to 0              *
.*****************************************************************************
.
PRTHEC00  MOVE      TWO,LABCOS                   * set for 2 labels across page
.
          CLEAR     SMALLLAB                     * Setting up small label fonts
          APPEND    ESC,SMALLLAB
          APPEND    "(sp15hsb",SMALLLAB
          RESET     SMALLLAB
.
.         Set the Vertical Motion Index (row height) to be 8 lines/inch.
.         The index is set to 6/48 inch.
.
          CLEAR     PGLINES 
          APPEND    ESC,PGLINES 
          APPEND    "&l6C",PGLINES 
          RESET     PGLINES 
.
.         Set the Vertical Cursor Positioning.  Using 8 lines/inch, will mean
.         that as we move down the sheet, each label will be offset slightly
.         and the offset will increase down the page.  To counteract this, we
.         need to reset the vertical cursor position after each label is
.         printed.  The offset is -12/300 inch.
.
          CLEAR     NEGOFSET
          APPEND    ESC,NEGOFSET
          APPEND    "*p-12Y",NEGOFSET
          RESET     NEGOFSET
.
PRTHEC10  COMPARE   NOLABEL,ZERO
          GOTO      PRTHEC99 IF NOT LESS        * <=0, exit
.
          COMPARE   NOLABEL,LABCOS
          GOTO      PRTHEC20 IF LESS
.
          MOVE      NOLABEL,LABCOS          * Print remainder
.
PRTHEC20  BRANCH    LABCOS,PRTHEC31,PRTHEC32
          GOTO      PRTHEC99
.
PRTHEC31  PRINT     PGLINES:
                    SMALLLAB:
                    *+,*N,*1,LINEA37,*83,LINEA17:
                    *N,*1,LINEB37,*83,LINEB17:
                    *N,*1,LINEC37,*83,LINEC17:
                    *N,*1,LINED37,*83,LINED17:
                    *N,*1,LINEE37,*83,LINEE17:
                    *N,*1,LINEF37,*83,LINEF17:
                    *N,*1,LINEG37,*83,LINEG17:
                    *N,*1,LINEH37,*83,LINEH17:
                    *N,*1,LINEI37,*83,LINEI17:
                    *N,NEGOFSET
.
          SUB       ONE,NOLABEL
          GOTO      PRTHEC10
.
PRTHEC32  PRINT     PGLINES:
                    SMALLLAB:
                    *+,*N,*1,LINEA37,*41,LINEA37,*83,LINEA17,*103,LINEA17:
                    *N,*1,LINEB37,*41,LINEB37,*83,LINEB17,*103,LINEB17:
                    *N,*1,LINEC37,*41,LINEC37,*83,LINEC17,*103,LINEC17:
                    *N,*1,LINED37,*41,LINED37,*83,LINED17,*103,LINED17:
                    *N,*1,LINEE37,*41,LINEE37,*83,LINEE17,*103,LINEE17:
                    *N,*1,LINEF37,*41,LINEF37,*83,LINEF17,*103,LINEF17:
                    *N,*1,LINEG37,*41,LINEG37,*83,LINEG17,*103,LINEG17:
                    *N,*1,LINEH37,*41,LINEH37,*83,LINEH17,*103,LINEH17:
                    *N,*1,LINEI37,*41,LINEI37,*83,LINEI17,*103,LINEI17:
                    *N,NEGOFSET
.
          SUB       TWO,NOLABEL
          GOTO      PRTHEC10
.
PRTHEC99  RETURN
+
.--------------------------------------------------------------------
. Get concession card details for sjog
.--------------------------------------------------------------------
GCCSJG00  MOVE      "ct",DIM2
          MOVE      ONE,F1
.
GCCSJG10  LOAD      DIM1,F1,ONE,TWO,THREE,FOUR,FIVE
.
          PACK      KEY19,PURNO,SP70
          CALL      RSPMCCD1
GCCSJG20  CALL      RKPMCCD1
          BRANCH    OVRCD,GCCSJG70
.
          MATCH     PURNO,PMCDURNO
          GOTO      GCCSJG70 IF NOT EQUAL
.
          PACK      KEY5,DIM2,PMCDCTYP
          CALL      RDCODE1
          BRANCH    OVRCD,GCCSJG20
.
          MATCH     DIM1,TCINDC3
          GOTO      GCCSJG99 IF EQUAL
.
          GOTO      GCCSJG20
.
GCCSJG70  COMPARE   F1,FIVE
          IF        !@EQUAL
            ADD       ONE,F1
            GOTO      GCCSJG10
          ENDIF
          GOTO      GCCSJG80
.
GCCSJG80  MOVE      SP70,PMCDCNUM
          MOVE      SP70,PMCDCTYP
          MOVE      SP70,PMCDEXDT
          GOTO      GCCSJG99
.
GCCSJG99  RETURN
.
.--------------------------------------------------------------------
. Set the person responsible codes used for the doctor, nurse and
. psc incomplete tests.
. RETURN : RESPONSD - Category EZ code for doctor responsible
.          RESPONSN - Category EZ code for nurse responsible
.          RESPONSC - Category EZ code for psc responsible
.--------------------------------------------------------------------
GETR0000  MOVE      SP70,RESPONSD
          MOVE      SP70,RESPONSN
          MOVE      SP70,RESPONSC
.
          PACK      KEY5,CODEEZ,SP70
          CALL      RDSCODE1
GETR1000  CALL      RDKCODE1
          BRANCH    OVRCD,GETR9999
.
          MATCH     CODEEZ,TCODE
          GOTO      GETR9999 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      GETR1000 IF EQUAL
.
          MATCH     "1",TCINDC1
          IF        @EQUAL
            MOVE      ACODE,RESPONSC      * psc responsible
            GOTO      GETR1000
          ENDIF
.
          MATCH     "2",TCINDC1
          IF        @EQUAL
            MOVE      ACODE,RESPONSD      * doctor responsible
            GOTO      GETR1000
          ENDIF
.
          MATCH     "3",TCINDC1
          IF        @EQUAL
            MOVE      ACODE,RESPONSN      * nurse responsible
            GOTO      GETR1000
          ENDIF
.
          GOTO      GETR1000
.
GETR9999  RETURN
.
.
.--------------------------------------------------------------------
. Get the patients compensable details if any.
.--------------------------------------------------------------------
. REQUIRES: CLAIMCOD - Claim Code
.           ADMISSNO - Admission number
.
. RETURNS : CLMDET1 = If private the patients health fund name
.                     or W/C, TAC, DVA if compensable
.                     or NILL if not compensable and not private
.           CLMDET2 = If private the patients health fund member number
.                     or W/C, TAC claim numbers, DVA number and (Card Colour)
.                        if compensable
.                     or blank if not compensable and not private
.--------------------------------------------------------------------
CMPH0000  MOVE      SP70,CLMDET1
          MOVE      SP70,CLMDET2
.
          MATCH     SP70,CLAIMCOD
          GOTO      CMPH9999 IF EQUAL
.
          PACK      KEY5,ANSC,ANSL,CLAIMCOD,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CMPH9999
.
          MATCH     "3",TCINDC5                  * Self insured
          GOTO      CMPH9000 IF EQUAL
.
.------ see what type of claim we have if any exists ------
.
          MOVE      ZERO,FORM2
CMPH1000  ADD       ONE,FORM2
          COMPARE   SIX,FORM2
          GOTO      CMPH5000 IF NOT LESS
.
          LOAD      ANS,FORM2,TCINDC1,TCINDC2,TCINDC3:
                    TCINDC4,TCINDC5
.
          CMATCH    "W",ANS                      * Work Cover
          GOTO      CMPH2000 IF EQUAL
.
          CMATCH    "M",ANS                      * TAC
          GOTO      CMPH3000 IF EQUAL
.
          CMATCH    "V",ANS                      * VET
          GOTO      CMPH4000 IF EQUAL
.
          GOTO      CMPH1000
.
CMPH2000  OPEN      PATWC1A1,"patwc1af"          * Work Cover
          MOVE      "W/C",CLMDET1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDWCOM1
          BRANCH    OVRCD,CMPH9999
.
          OPEN      PMSWX1A1,"pmswx1af"          * Extension
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMWX11
          IF        OVRCD = 0
            MATCH     "3",PMWXCSTA               * Cancelled
            GOTO      CMPH9999 IF EQUAL
          ENDIF
.
          MOVE      WCCLMNO,CLMDET2
          GOTO      CMPH9999
.
CMPH3000  OPEN      PATWMAB1,"patwmabf"          * TAC
          MOVE      "TAC",CLMDET1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDWMAB1
          BRANCH    OVRCD,CMPH9999
.
          MOVE      MREFNO,CLMDET2
          GOTO      CMPH9999
.
CMPH4000  OPEN      PATWVET1,"patwvetf"          * VET
          MOVE      "DVA",CLMDET1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDWVET1
          BRANCH    OVRCD,CMPH9999
.
          MOVE      SP70,TDESC
          MOVE      THREE,DIM1
          CALL      GCCARD00
          MATCH     SP70,PMCDDVAC
          IF        !@EQUAL & !@EOS
            PACK      KEY5,ANSD,ANSX,PMCDDVAC,SP10   * DVA Card colour
            CALL      RDCODE1
            IF        OVRCD = 1
              MOVE      PMCDDVAC,TDESC
            ENDIF
          ENDIF
.
          MOVE      TDESC,DIM1
.
          CLEAR     CLMDET2
          STRIP     VCLMNO
          APPEND    VCLMNO,CLMDET2
          APPEND    " (",CLMDET2
          APPEND    DIM1,CLMDET2
          APPEND    ")",CLMDET2
          RESET     CLMDET2
          GOTO      CMPH9999
.
CMPH5000  MATCH     SP70,PFUNDH
          GOTO      CMPH9999 IF EQUAL
.
          PACK      KEY14,PFUNDH,ZERO4,SP70      * Display health fund
          CALL      RDFUND1
          IF        OVRCD=1
            MOVE      PFUNDH,HFNAME
          ENDIF
.
          MOVE      HFNAME,CLMDET1
          MOVE      PFNDMM,CLMDET2
          GOTO      CMPH9999
.
CMPH9000  MOVE      "NIL",CLMDET1                * Self insured
          MOVE      SP70,CLMDET2
.
CMPH9999  RETURN
.
.**********************************************************************
.         Update Default Printer File for User - LABELS
.**********************************************************************
UPDFPL00  MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          PACK      KEY20,PRGID,KEY2,WBSEUID,SP70
          UNPACK    KEY20,IBPDPID,IBPDREP,IBPDUID
.
          MOVE      SELPRINT,IBPDPRT             * Printer
          MOVE      NOLABEL,IBPDCOP              * Number of copies
          UNPACK    LABELTYP,IBPDDOC,IBPDNUM     * Label name and number
.
          MOVE      SP70,IBPDSPA
          CALL      RAIBPD1
          IF        OVRCD=0
            CALL      UPIBPD1
          ELSE
            CALL      WRIBPD1
          ENDIF
.
UPDFPL99  RETURN
.
+
          INC       IBAWEBCD
.
          INC       CLPMSVX1
          INC       DXPATCOD
          INC       DXPATMAS
          INC       GPMCEX00
          INC       GCCARD00
          INC       GTIHINUM
          INC       NAMSTRCD
          INC       SJOGLABL
          INC       WEBDITEM
          INC       WEBBGRND
          INC       WEBLBEMR
.
          INC       APSMASIO/INC
          INC       EMRCHMAN
          INC       EMRLPCIO/INC
          INC       EMRLOCIO/INC
          INC       EMRSITIO/INC
          INC       EMRVISIO/INC
          INC       EMRCLIIO/INC
          INC       EMRGRCIO/INC
          INC       EMRPROIO/INC                                       *I-50421
          INC       EMRUNKIO/INC
          INC       IBATMDIO/INC
          INC       MEHDLSIO/INC
          INC       NHIETHIO/INC
          INC       NHIMASIO/INC
          INC       PATGO1IO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCGIO/INC
          INC       AAEDE1IO/INC    *****
          INC       PATALRIO/INC
          INC       PMSALNIO/INC
          INC       PMSRELIO/INC
          INC       PMSTLEIO/INC
          INC       PMSHCPTM
          INC       PMSHCGTM 
          INC       AAESETLB        *****
          INC       AAEPRLAB        *****
          INC       OPRNURIO/INC
          INC       PRIITMIO/INC
          INC       PATITMIO/INC                                       *I-50421
          INC       PATICOIO/INC                                       *I-50421
          INC       PATICDIO/INC                                       *I-50421
          INC       PATNIDIO/INC
          INC       PATVISIO/INC
          INC       PMSVX1IO/INC                                       *I-55214
          INC       PATDO1IO/INC
          INC       PATHSPIO/INC
          INC       PATIN1IO/INC
          INC       PMSCCDIO/INC
          INC       PMSCEXIO/INC
          INC       PMSIHIIO/INC
          INC       PMSMDTIO/INC
          INC       PMSMTXIO/INC
          INC       PMSPX2IO/INC
          INC       PATFN1IO/INC
          INC       PATMA1IO/INC
          INC       PATMI1IO/INC
          INC       PATRE1IO/INC
          INC       PATWC1IO/INC
          INC       PMSWX1IO/INC 
          INC       PATWMAIO/INC
          INC       PATWR1IO/INC
          INC       PATWVEIO/INC
          INC       PATVADIO/INC
.
          INC       PATATRIO/INC
          INC       MULBIR00
.
          INC       SCRPSTIO/INC
          INC       SCRSBGIO/INC
          INC       SCRSLTIO/INC
          INC       SCRMASIO/INC

.
          INC       EOCLNKIO/INC
          INC       EOCREFIO/INC
          INC       EMRISMIO/INC
          INC       EMRINCIO/INC
          INC       EMRWFMIO/INC
          INC       EMRVCDIO/INC
          INC       EMRMTXIO/INC
          INC       EMRVPRIO/INC
          INC       VISCMTIO/INC
          INC       VISCODIO/INC
          INC       VISMTXIO/INC
          INC       VISMDTIO/INC
          INC       VISXDCIO/INC
          INC       EMRMANIO/INC
          INC       OBSDETIO/INC                                       *I-54627
          INC       OBSMTXIO/INC
          INC       OBSMDTIO/INC
          INC       EMRDCMIO/INC   
          INC       EMRHISIO/INC 
          INC       EMRICDIO/INC 
          INC       PATHGPIO/INC

          INC       PATDOCTM
          INC       PATITMRD
.
          INC       PACADDRS
          INC       PMIGTNID
          INC       PMSCEXCD
          INC       PRINTEMR
          INC       CALCAGE
          INC       CALCYRS
          INC       AGECHK
          INC       PATDOCCD
          INC       CLPATMAS
          INC       CLPMSCEX
          INC       CLPMSHCP
          INC       CLPMSPX2
          INC       CLEMRVIS                                          *I-153218
          INC       CLPATVIS                                          *I-153218
          INC       DAYOFWEK
          INC       SGCHKDIG
          INC       GETALTID
.

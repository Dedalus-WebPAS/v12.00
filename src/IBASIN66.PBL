.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V10.02.01 19.05.2011 Sandra Barcham   239574
.           New printer/department table mods
.-------------------------------------------------------
. V9.04.01  19.04.2005 Peter Vela CAR 59696
.           Recompiled for SINTMPDF
. V9.03.00  12.05.2003  Davin Sloan Quote/CAR 37864
.           Created program for Faxing Outstanding P/Os
.-------------------------------------------------------
CODECHG   FORM      1
CURCOD5   DIM       5
ENDORI    DIM       3
ENDPON    DIM       7
ENDSUP    DIM       5
ENDWAR    DIM       5
FAXNUMB   DIM       20
LASTCOD5  DIM       5
LASTPON   DIM       7
MYCOL     FORM      2
MYVERT    FORM      2
REPTSTKF  FORM      1
STRORI    DIM       3
STRPON    DIM       7
STRSUP    DIM       5
STRWAR    DIM       5
SUPLIN1   DIM       35
SUPLIN2   DIM       35
SUPLIN3   DIM       35
SUPLIN4   DIM       35
SUPLIN5   DIM       35
.-------------------------------------------------------
.
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASIN66
.   Function      :   Fax Outstanding Purchase Orders         
.   Generated  On :   19/05/2011
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       APSMASFD/INC
          INC       APSMXRFD/INC
          INC       IBAPRNFD/INC
          INC       SIN54DF     
          INC       SINCCAFD/INC
          INC       SINCIAFD/INC
          INC       SINCIEFD/INC
          INC       SINCONFD/INC
          INC       SINFACFD/INC
          INC       SINNATFD/INC
          INC       SINORIFD/INC
          INC       SINPOAFD/INC
          INC       SINPOCFD/INC
          INC       SINPOFFD/INC
          INC       SINTMPDF/INC
          INC       SINWARFD/INC
          INC       SINWSEFD/INC
.=========================
.Local Variable Definition
.-------------------------
FROMSUPP  DIM      36 * Scr 01 Fld     4
TOSUPP    DIM      36 * Scr 01 Fld     5
PRTLOWST  FORM      1 * Scr 01 Fld     8
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASIN66"
PRGNAM    INIT      "Fax Outstanding Purchase Orders         "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SELPRT00
          CALL      SC01L000
          CALL      CLOS0000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA1,"apsmasaf"
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA2,"apsmasaf"
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA3,"apsmasaf"
          DISPLAY   *P56:24,"Opening apsmxraf";
          OPEN      APSMXRA1,"apsmxraf"
          DISPLAY   *P56:24,"Opening apsmxraf";
          OPEN      APSMXRA2,"apsmxraf"
          MOVE      "   24",AUDTSECT
          MOVE      "223",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudwa";
            OPEN      SINAUDWA,"sinaudwa"
          ENDIF
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA1,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA2,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA1,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA2,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA3,"sinciaaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA1,"sincieaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA2,"sincieaf"
          DISPLAY   *P56:24,"Opening sinfacaf";
          OPEN      SINFACA1,"sinfacaf"
          DISPLAY   *P56:24,"Opening sinfacaf";
          OPEN      SINFACA2,"sinfacaf"
          DISPLAY   *P56:24,"Opening sinoriaf";
          OPEN      SINORIA1,"sinoriaf"
          DISPLAY   *P56:24,"Opening sinpoaaf";
          OPEN      SINPOAA1,"sinpoaaf"
          DISPLAY   *P56:24,"Opening sinpoaaf";
          OPEN      SINPOAA2,"sinpoaaf"
          DISPLAY   *P56:24,"Opening sinpoaaf";
          OPEN      SINPOAA3,"sinpoaaf"
          DISPLAY   *P56:24,"Opening sinpoaaf";
          OPEN      SINPOAA4,"sinpoaaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA1,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA2,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA3,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA4,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA5,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA6,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA7,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA1,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA2,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA3,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA4,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA1,"sinwaraf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA2,"sinwaraf"
          DISPLAY   *P56:24,"Opening sinwseaf";
          OPEN      SINWSEA1,"sinwseaf"
          DISPLAY   *P56:24,"Opening sinwseaf";
          OPEN      SINWSEA2,"sinwseaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Screen                        
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * By Supplier                        
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Screen                        
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      ONAT0000
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Screen                        
.-------------------------------------------------------
CF00L000
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Screen                        
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Screen                        
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Screen                        
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Screen                        
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Screen                        
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                           PS00L999,PS00L999
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Screen                        
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L006,SF00L006:
                           SF00L006,SF00L102
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          CALL      SC01L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L102
          MOVE      ZERO,EXIT
          GOTO      SF00L999
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - By Supplier                        
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
          CALL      SETSCR01
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : By Supplier                        
.-------------------------------------------------------
CF01L000  COMPARE   ZERO,ACCEPT
              GOTO      CF01L999 IF EQUAL
          MOVE      SP70,FROMSUPP
          MOVE      SP70,TOSUPP  
          MOVE      ZERO,PRTLOWST
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for By Supplier                        
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : By Supplier                        
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : By Supplier                        
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : By Supplier                        
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : By Supplier                        
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L101:
                            PS01L102,PS01L999,PS01L999,PS01L103
          GOTO     PS01L999
.
PS01L101
          MOVE      FROMSUPP,VAR     
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      TOSUPP,VAR       
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTLOWST,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : By Supplier                        
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L103:
                            SF01L006,SF01L006,SF01L006,SF01L104
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L103:
                            SF01L020,SF01L020,SF01L020,SF01L104
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      PRNT0000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOSUPP  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ESUP0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L103
            ENDIF
            BRANCH    EXIT,SF01L103,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMSUPP,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOSUPP,VAR       
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L104
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,PRTLOWST
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTLOWST,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF01L001
SF01L990  MOVE      FOUR,EXIT * Exit Char Exit
SF01L999  RETURN
.@@@@@ Function Restart Point @@@@@
.**********************************************************************
. SELPRT00 - select printer routine
. Requires IBACODFD/INC IBAPRNFD/INC
.          IBAIOCOD/INC IBAIOPRN/INC IBAPRINT
.  Note : already includes IBAPASFD & IBAPASIO
.**********************************************************************
SELPRT00  OPEN      IBACODE1,"ibacodef"     * open files
...       OPEN      IBAPRNT1,"ibaprntf"                               *D-239574
          MOVE      SP70,SPLFILE
          CALL      SELPRINT
          RETURN
.------------------------------------------------------------------------
. Open Nato X-Ref File if required
.------------------------------------------------------------------------
ONAT0000  OPEN      CONTROLF,"controlf"
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*143,HNONUSAG
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ONE,HNONUSAG
            WRITAB    CONTROLF,SIXTY3;*143,HNONUSAG
          ENDIF
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*141,INCNNATO
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ZERO,INCNNATO
            WRITAB    CONTROLF,SIXTY3;*141,INCNNATO
          ENDIF
.
          IF        INCNNATO=1
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      SINNATA1,"sinnataf"
            TRAPCLR   IO
            IF        OVRCD=1
              DISPLAY   *P1:24,*EL,*B,"Nato file does not exist. Run fixit.  ";
              CALL      HITENTER
              CHAIN     PGM
            ENDIF
.
            OPEN      SINNATA2,"sinnataf"
          ENDIF
.
ONAT9999  RETURN
.----------------------------------------------------------------------
. Set up for screen 1
.----------------------------------------------------------------------
SETSCR01  CALL      ONAT0000
          MOVE      ONE,ACCEPT
          RETURN
.********************************************************************
. PRNT - print report for SIPA                      Called by ML
.         Returns  : EXIT            (1=illegal range entered)
.********************************************************************
PRNT0000  BRANCH    TMPFLFLG,PRNT0010            * create temp file ?
          CALL      OPEN0000
.
PRNT0010  PACK      DISPMSG,SP70,SP70            * save line 24
          CALL      MESSAGE2
.
          DISPLAY   *P1:24,*EL,"Faxing Supplier : ";
          UNPACK    SP70,CURCOD3,CURCOD5,CURCOD7
          UNPACK    SP70,LASTCOD3,LASTCOD5,LASTCOD7
          MOVE      SP70,LASTPON
          MOVE      ZERO,CPAGENO                 * reset page no.
          MOVE      ONE,NOPRINT
          MOVE      ZERO,ATOTAL01
          MOVE      ZERO,ATOTAL02
          CLOCK     TIME,CTIMEIS                 * get current time
          MOVE      "0",CLNO                     * init line number
          MOVE      "47",MAXITEMS
.
          CALL      FILE0000                    * go to correct position in file
.
PRNT1000  CALL      NREC0000                     * get next record
          BRANCH    OVRCD,PRNT8000               * end of file ?
.
.>>>>     DISPLAY   *P61:24,*V2LON,SIPAPON,*EL;
.
          CALL      WRIT0000                     * print details
.
          GOTO      PRNT1000                     * get next record
.
PRNT8000  MOVE      FALSE,CODECHG
          COMPARE   ZERO,CPAGENO
          CALL      HEAD0000 IF EQUAL          * print header if nothing printed
          CALL      BRKTOT00
.>>>>     CALL      UND132                       * print line
.>>>>     PRINT     *1,"| Report Total",*98,ATOTAL02,*132,"|"
.>>>>     CALL      UND132                       * print line
          MOVE      ZERO,ATOTAL01
          MOVE      ZERO,ATOTAL02
.>>>>     PRINT     "****   End of Report   ****"
.
PRNT9000  MOVE      ZERO,EXIT                    * exit screen
          GOTO      PRNT9999
.
PRNT9500  MOVE      ONE,EXIT                     * continue
.
PRNT9999
          CALL      MESSAGE3                     * restore line 24
          RETURN
.**********************************************************************
.  FILE - Set file pointer                             Called By PRNT
.**********************************************************************
FILE0000  PACK      KEY12,STRSUP,SP70
          CALL      RSNEZZ2
          CALL      RPNEZZ2
FILE9999  RETURN
.**********************************************************************
.  NREC - Get next record                              Called By PRNT
.**********************************************************************
NREC0000  CALL      RKNEZZ2
          BRANCH    OVRCD,NREC9500
.
          PACK      CURCOD5,NEZZSUP,SP70
          MATCH     CURCOD5,ENDSUP
          GOTO      NREC9500 IF LESS             * out of range ?
.
          PACK      KEY7,NEZZPON,SP70  * read purchase order
          CALL      RDSIPA1
          BRANCH    OVRCD,NREC0000     * should not be missing
          MATCH     SP70,SIPADCN       * skip if cancelled
          GOTO      NREC0000 IF NOT EQUAL
.
          MOVE      ZERO,OVRCD         * continue
          GOTO      NREC9999
.
NREC9500  MOVE      ONE,OVRCD          * quit
.
NREC9999  RETURN
.********************************************************************
. HEAD - print report                               Called by PRNT
.********************************************************************
HEAD0000  IF        CLNO>=MAXITEMS
            CALL      FILPAG00
            CALL      HEADBOT0       * if over page
          ELSE
            IF        CODECHG=TRUE
              CALL      OPNPRINT
              CALL      HEADBOT0     * if new supplier
              ADD       ONE,CPAGENO
            ENDIF
          ENDIF
.
HEAD9999  RETURN
.********************************************************************
. HEADBOT - print top of new page header               Called by HEAD
.********************************************************************
HEADBOT0  MOVE      "0",CLNO
          MOVE      SP70,APMASN1
          MOVE      SP70,APMASN2
          MOVE      SP70,APMASTEL
          PACK      KEY5,CURCOD5,SP70
          CALL      RDAPMA1
.
          CALL      FSUPP000             * Format Supplier Name & Address
          PRINT        "To Supplier: ",APMACRD:
                      *N,SUPLIN1:
                      *N,SUPLIN2:
                      *N,SUPLIN3:
                         *38,"Phn:       ",APMASTEL:
                      *N,SUPLIN4:
                         *38,"Fax:       ",APMASFAX:
                      *N,SUPLIN5
          ADD       "6",CLNO
.
          PRINT     "----------------------------------------------":
                    "-----------------------------------------------"
          PRINT     "Purchase Catalog Description  ":
                    "Supplier                       ":
                    " Original   Outstand ":
                    "  Date Due "
          PRINT     " Order                        ":
                    "Part No                        ":
                    " Quantity   Quantity ":
                    "           "
          PRINT     "----------------------------------------------":
                    "-----------------------------------------------"
          ADD       "4",CLNO
.
HEADBOT9  RETURN
.********************************************************************
. WRIT - print data line                            Called by PRNT
.********************************************************************
WRIT0000  PACK      PURCHORD,SIPAPON,SP70
.
          PACK      KEY10,SIPAPON,SP70
          CALL      RSSIPC1
.
WRIT1000  CALL      RKSIPC1
          BRANCH    OVRCD,WRIT9999
          MATCH     SIPAPON,SIPCPON
          GOTO      WRIT9999 IF NOT EQUAL
          MATCH     SP70,SIPCEDD
          GOTO      WRIT1000 IF EQUAL
.
          CALL      CKLOW000                     * check for low stock
          BRANCH    EXIT,WRIT1000
.
          PACK      KEY8,CCC,CYY,CMM,CDD,SP70
          REP       " 0",KEY8
          MATCH     KEY8,SIPCEDD
          IF        !(@LESS)
            GOTO      WRIT1000
          ENDIF
.
WRIT1050  MATCH     SP7,SIPCCAT
          IF        !@EQUAL
            PACK      KEY7,SIPCCAT
            CALL      RDSIIA1
            BRANCH    OVRCD,WRIT1100
          ELSE
            GOTO      WRIT1100
          ENDIF
          PACK      KEY30,SIIAISS,SIPCSUT,SP70
          CALL      RDSIFA1
          BRANCH    OVRCD,WRIT1100
.
          ASSIGN   ((SIPCOQT*SIFACTOR)-SIPCRQT)/SIFACTOR,F12P2
          GOTO     WRIT1200
.
WRIT1100  ASSIGN    SIPCOQT-SIPCRQT,F12P2
.
WRIT1200  MOVE      F12P2,F7P2B
          IF        F7P2B<0
            MOVE      ZERO,F7P2B
            MOVE      ZERO,F12P2
          ENDIF
.
          MOVE      SIPCOQT,F7P2A
          MOVE      SIPCECT,F7P4A
          ASSIGN    F7P2B*F7P4A,F7P2C
          ASSIGN    F12P2*SIPCECT,F12P2
.
          MOVE      FALSE,CODECHG
.
          REP       " 0",SIPCEDD
          MATCH     "00000000",SIPCEDD
          IF        @EQUAL
            MOVE      SP70,CPCDATE
          ELSE
            UNPACK    SIPCEDD,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
          ENDIF
.
          PACK      KEY8,CCC,CYY,CMM,CDD,SP70
          REP       " 0",KEY8
          MATCH     KEY8,SIPCEDD
          IF        @LESS
            MOVE      "OVERDUE",KEY7
          ELSE
            MOVE      SP70,KEY7
          ENDIF
.
          MATCH     SP70,CPCDATE
          IF        @EQUAL
            MOVE      SP70,KEY7
          ENDIF
.
          MOVE      F7P4A,KEY12
          COMPARE   "-1",F7P4A
          IF        @EQUAL
            MOVE      "T.B.A.",KEY12
            MOVE      ZERO,F12P2
            MOVE      ZERO,F7P2C
          ENDIF
          PACK      KEY12,KEY12,SP20
.
          MATCH     LASTCOD5,CURCOD5
          IF        !@EQUAL
            IF        CPAGENO<>0
              CALL      BRKTOT00
            ENDIF
            MOVE      ZERO,ATOTAL01
            MOVE      TRUE,CODECHG
            CALL      HEAD0000
          ELSE
            MOVE      FALSE,CODECHG
          ENDIF
          MOVE      CURCOD5,LASTCOD5
.
          COMPARE   MAXITEMS,CLNO
          CALL      HEAD0000 IF NOT LESS
.
          MATCH     SP70,SIPCPD
          IF        @EQUAL
            MOVE      SIIADES,KEY20
          ELSE
            MOVE      SIPCPD,KEY20
          ENDIF
.
          PRINT     SP1,PURCHORD,SP1,KEY20,SP1,SIPCPN,SP1,F7P2A:
                    SP1,F7P2B,SP1,CPCDATE
.
.>>>>     PRINT     "| ",PURCHORD,"| ",SIPCCAT,SP1,KEY30,"|",F7P2A:
.>>>>               "|",F7P2B:
.>>>>               "|",CPCDATE
          ADD       "1",CLNO           * add one to line number
          MOVE      SP70,PURCHORD
          ADD       F12P2,ATOTAL01
          ADD       F12P2,ATOTAL02
.
          GOTO      WRIT1000
.
WRIT9999  RETURN
.
BRKTOT00  CALL      GETSCR00
          DISPLAY   *P19:24,*V2LON,APMACRD,*EL;
          MOVE      APMAUR2,FAXNUMB
          CALL      FAXPRINT
          CALL      PUTSCR00
.
.>>>>     CALL      UND132                       * print line
.>>>>     PRINT     *1,"| Total ",*98,ATOTAL01,*132,"|"
BRKTOT99  RETURN
.********************************************************************
. CKLOW - print data line                            Called by PRNT
.********************************************************************
CKLOW000  COMPARE   ONE,PRTLOWST       * print all or just low stock ?
          GOTO      CKLOW900 IF NOT EQUAL
.
..........MATCH     SP70,SIPCCAT       * Ignore Non Cataloged
..........GOTO      CKLOW950 IF EQUAL
          PACK      SIIADES,SP70,SP70
          MATCH     SIPCCAT,SP7
          IF        !@EQUAL
            PACK      KEY7,SIPCCAT,SP70
            CALL      RDSIIA1
            BRANCH    OVRCD,CKLOW950
            PACK      KEY12,SIPCCAT,SIPCWAR,SP70
            CALL      RDSIIE1            * get catalog/warehouse data
            BRANCH    OVRCD,CKLOW950
            COMPARE   SIIESOH,SIIEROQ    * greater than reorder level ?
            GOTO      CKLOW950 IF LESS
          ENDIF
.
CKLOW900  MOVE      ZERO,EXIT
          GOTO      CKLOW999
.
CKLOW950  MOVE      ONE,EXIT
.
CKLOW999  RETURN
.
.------------------------------------------------------------
. Format Supplier Name & Address (remove blank lines)
.------------------------------------------------------------
FSUPP000  PACK     APMASN1,APMASN1,SP70
          PACK     APMASN2,APMASN2,SP70
          PACK     APMASA1,APMASA1,SP70
          PACK     APMASA2,APMASA2,SP70
          PACK     APMASA3,APMASA3,SP70
.
          MOVE     APMASN1,SUPLIN1
          MOVE     APMASN2,SUPLIN2
          MOVE     APMASA1,SUPLIN3
          MOVE     APMASA2,SUPLIN4
          MOVE     APMASA3,SUPLIN5
.
          MOVE      "0",SECTOR              * consolidate data lines
          MATCH     SP70,SUPLIN1
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      SUPLIN2,SUPLIN1
            MOVE      SUPLIN3,SUPLIN2
            MOVE      SUPLIN4,SUPLIN3
            MOVE      SUPLIN5,SUPLIN4
            MOVE      SP70,SUPLIN5
            MATCH     SP70,SUPLIN1
          DO
          MATCH     SP70,SUPLIN2
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      SUPLIN3,SUPLIN2
            MOVE      SUPLIN4,SUPLIN3
            MOVE      SUPLIN5,SUPLIN4
            MOVE      SP70,SUPLIN5
            MATCH     SP70,SUPLIN2
          DO
          MATCH     SP70,SUPLIN3
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      SUPLIN4,SUPLIN3
            MOVE      SUPLIN5,SUPLIN4
            MOVE      SP70,SUPLIN5
            MATCH     SP70,SUPLIN3
          DO
          MATCH     SP70,SUPLIN4
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      SUPLIN5,SUPLIN4
            MOVE      SP70,SUPLIN5
            MATCH     SP70,SUPLIN4
          DO
.
          PACK      SUPLIN1,SUPLIN1,SP70
          PACK      SUPLIN2,SUPLIN2,SP70
          PACK      SUPLIN3,SUPLIN3,SP70
          PACK      SUPLIN4,SUPLIN4,SP70
          PACK      SUPLIN5,SUPLIN5,SP70
.
          MATCH     SP70,SUPLIN5
          IF        !@EQUAL
            STRIP     SUPLIN5
            ENDSET    SUPLIN5
            APPEND    ", ",SUPLIN5
            APPEND    APMASPC,SUPLIN5
            APPEND    SP70,SUPLIN5
            RESET     SUPLIN5
            GOTO      FSUPP999
         ENDIF
.
          MATCH     SP70,SUPLIN4
          IF        !@EQUAL
            STRIP     SUPLIN4
            ENDSET    SUPLIN4
            APPEND    ", ",SUPLIN4
            APPEND    APMASPC,SUPLIN4
            APPEND    SP70,SUPLIN4
            RESET     SUPLIN4
            GOTO      FSUPP999
          ENDIF
.
          MATCH     SP70,SUPLIN3
          IF        !@EQUAL
            STRIP     SUPLIN3
            ENDSET    SUPLIN3
            APPEND    ", ",SUPLIN3
            APPEND    APMASPC,SUPLIN3
            APPEND    SP70,SUPLIN3
            RESET     SUPLIN3
            GOTO      FSUPP999
          ENDIF
.
          MATCH     SP70,SUPLIN2
          IF        !@EQUAL
            STRIP     SUPLIN2
            ENDSET    SUPLIN2
            APPEND    ", ",SUPLIN2
            APPEND    APMASPC,SUPLIN2
            APPEND    SP70,SUPLIN2
            RESET     SUPLIN2
            GOTO      FSUPP999
          ENDIF
.
FSUPP999  RETURN
.
.********************************************************************
.*                          FAXPRINT                                *
.*                       Fax a Print File                           *
.********************************************************************
FAXPRINT  COMPARE   ZERO,CPRTFLG
          GOTO      FAXPR999 IF NOT EQUAL
.
.         Check if file is of non-zero size
.
          CALL      SPLEMPTY
          BRANCH    OVRCD,FAXPR800,FAXPR900
.
          CLEAR     KEY80
          APPEND    "ibasin66.us1 ",KEY80
          APPEND    SPLFILE,KEY80
          APPEND    SP1,KEY80
          APPEND    "#"",KEY80
          APPEND    FAXNUMB,KEY80
          APPEND    "#"",KEY80
          APPEND    SP1,KEY80
          APPEND    PASSCODE,KEY80
          RESET     KEY80
.
          MOVE      "23",EVERT
          MOVE      "3",ECOL
          GETVAR    DIM2,KEY2,ECOL,EVERT
          MATCH     "eX",DIM2
          IF        @EQUAL
            CALL      CLRBX000                * Clear the Box
            DISPLAY   *P25:23,*V2LON,"Fax being queued. Please wait.";
            EXECUTE   KEY80,TASKID
            CALL      OPTNS000                * Redisplay the Option Line
          ELSE
            DISPLAY   *P25:24,*EL,*V2LON,"Fax being queued. Please wait";
            EXECUTE   KEY80,TASKID
          ENDIF
.
          GOTO      FAXPR900
.
.         Quick delete of spool file
.
FAXPR800  MOVE      FILENAME,CSPDESC       * name of file to be deleted
          CALL      SPLDELET
.
FAXPR900  MOVE      SP8,SPLFILE
          GOTO      FAXPR9999
.
FAXPR999  RETURN
.
.----------------------------------------------------------------------
. FILPAG00 - fill to end of page
.----------------------------------------------------------------------
FILPAG00  WHILE     MAXITEMS>CLNO
            ADD       "1",CLNO                   * print blank lines
            PRINT     SP1
          DO
          PRINT     *N,*N,*77," CONTINUED",*N,*N
          RETURN
.
.----------------------------------------------------------------------
. Enter Range of Supplier
.----------------------------------------------------------------------
ESUP0000  MOVE      "    4",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          CALL      KAPMAA00
          BRANCH    EXIT,ESUP0100,ESUP9999
          MOVE      APMACRD,STRSUP
          PACK      FROMSUPP,APMACRD,SP1,APMASN1
          GOTO      ESUP0150
.
ESUP0100  MOVE      "Start                               ",FROMSUPP
          PACK      STRSUP,SP70
.
ESUP0150  MOVE      FROMSUPP,VAR
          CALL      DISPITEM
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          CALL      KAPMAA00
          BRANCH    EXIT,ESUP0200,ESUP9999
          MOVE      APMACRD,ENDSUP
          PACK      TOSUPP,APMACRD,SP1,APMASN1
          MATCH     STRSUP,ENDSUP
          GOTO      ESUP9000 IF EQUAL
          GOTO      ESUP9000 IF NOT LESS
          BEEP
          MOVE      "To Supplier Code Must Be > From Supplier Code - ",DISPMSG
          CALL      MESSAGE1
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
          GOTO      ESUP0000
.
ESUP0200  MOVE      "Finish                              ",TOSUPP
          PACK      ENDSUP,Z70
          GOTO      ESUP9000
.
ESUP9000  MOVE      "    4",FLDID
          CALL      GETPOSIT
.
ESUP9999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       APSCKIKY    
          INC       APSMASIO/INC
          INC       APSMASKY    
          INC       APSMXRIO/INC
          INC       IBAPRINT    
          INC       IBAPRNIO/INC
          INC       SIN54CD     
          INC       SINCCAIO/INC
          INC       SINCCAKY    
          INC       SINCIAIO/INC
          INC       SINCIEIO/INC
          INC       SINFACIO/INC
          INC       SINNATIO/INC
          INC       SINORIIO/INC
          INC       SINORIKY    
          INC       SINPOAIO/INC
          INC       SINPOAKY    
          INC       SINPOCIO/INC
          INC       SINPOFIO/INC
          INC       SINWARIO/INC
          INC       SINWSEIO/INC
          INC       SINWSEKY    
.
          INC       STDGENCD
.

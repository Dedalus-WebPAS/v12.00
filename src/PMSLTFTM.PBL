. *----------------------------------------------------------------------
. * Include Name  :   PMSLTFTM.PBL
. *
. * Function      :   CGI Variables for PMSLTFFD - pmsltfaf
. *
. * Mods          :   
. *       V10.07.01 23/10/2015  Ebon Clements  CAR 320819
. *                 Added Inactive test to letter selection lists
. *       V10.05.01 02/09/2014 J.Tan         CAR 298984
. *                 Added Patient on a Payment plan
. *       V10.03.01 09/07/2013  Peter Vela        CAR 287592
. *                 Fixed PMLTRCNT functionality
. *       V10.01.01 03/12/2010  Mike Laming       CAR 233046
. *                 Mods for PATMCHFD using Table Type (replacing H/F Table)
. *       V10.00.03 25/05/2010  Mike Laming       CAR 169939
. *                 Add test for "Active" (PTINACTV) flag at DINS1000
. *       V10.00.03 25/05/2010  Mike Laming       CAR 169939
. *                 Add test for "Active" (PTINACTV) flag at DINS1000
. *       V10.00.02 30/04/2010  J.Tan        CAR 220887
. *                 Mods checking for Active/Inactive of Misc.charge
. *       V10.00.01 01.04.2010 J.Tan         CAR 218426
. *                 Added new fields to pmsltfaf file
. *        V9.10.01 06.08.2008 J.Tan         CAR 167967
. *                 Mods checking for Multi Hospital security table
. *        V9.09.01 10.09.2007 Ebon Clements CAR 149753
. *                 Added multi hospital test to HSLI0000
. *        V9.04.01 30.08.2004 Jill Habasque CAR 53046
. *                 Added hospital ID
. *        V9.02.03 16.07.2004 Lina Vo   CAR 51732
. *                 Initalise PMLTRCNT in CLPMSF00 & MVPMFL00
. *                 Added PMLTRCNT tag in PMFL0000 
. *        V9.02.02 08.06.2004 Lina Vo   CAR 50536
. *                 Changed handling of PMSFL021 because it is
. *                 now a FORM 7.2
. *        V9.02.01 03.10.2001 Kuldeep Singh 
. *                 Created include
. *----------------------------------------------------------------------
.------------------------------------------------------------------------
.   Clear Parameters for Financial letter 
.------------------------------------------------------------------------
CPPMFL00  MOVE      SP70,PMSFL001
          MOVE      SP70,PMSFL002 
          MOVE      SP70,PMSFL003
          MOVE      SP70,PMSFL004
          MOVE      SP70,PMSFL005
          MOVE      SP70,PMSFL006
          MOVE      SP70,PMSFL007
          MOVE      SP70,PMSFL008
          MOVE      SP70,PMSFL009
          MOVE      SP70,PMSFL010
          MOVE      SP70,PMSFL011
          MOVE      SP70,PMSFL012
          MOVE      SP70,PMSFL013
          MOVE      SP70,PMSFL014
          MOVE      SP70,PMSFL015
          MOVE      SP70,PMSFL016
          MOVE      SP70,PMSFL017
          MOVE      SP70,PMSFL018
          MOVE      SP70,PMSFL019
          MOVE      SP70,PMSFL020
          MOVE      ZERO,PMSFL021
          MOVE      SP70,PMSFL022
          MOVE      SP70,PMSFL023
          MOVE      SP70,PMSFL024
          MOVE      SP70,PMSFL025
          MOVE      SP70,PMSFL026
          MOVE      SP70,PMSFL027
          MOVE      SP70,PMSFL028
          MOVE      SP70,PMSFL029
          MOVE      SP70,PMSFL030
          MOVE      SP70,PMSFL031
          MOVE      SP70,PMSFL032
          MOVE      SP70,PMSFL033
          MOVE      SP70,PMSFL034
.
CPPMFL99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for patient selection file
.------------------------------------------------------------
SPPMFL00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPPMFL01,SPPMFL02,SPPMFL03,SPPMFL04,SPPMFL05:
                       SPPMFL06,SPPMFL07,SPPMFL08,SPPMFL09,SPPMFL10:
                       SPPMFL11,SPPMFL12,SPPMFL13,SPPMFL14,SPPMFL15:
                       SPPMFL16,SPPMFL17,SPPMFL18,SPPMFL19,SPPMFL20:
                       SPPMFL21,SPPMFL22,SPPMFL23,SPPMFL24,SPPMFL25:
                       SPPMFL26,SPPMFL27,SPPMFL28,SPPMFL29,SPPMFL30:
                       SPPMFL31,SPPMFL32,SPPMFL33,SPPMFL34
.
          MOVE      ONE,EXIT
          GOTO      SPPMFL99
.
SPPMFL01  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PMSFL001
          PACK      PMSFL001,PMSFL001,SP70
          GOTO      SPPMFL99
.
SPPMFL02  MOVE      QRYDATA,PMSFL002
          GOTO      SPPMFL99
.
SPPMFL03  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL003,CCENT,CYEAR,CMON,CDAY
          GOTO      SPPMFL99 
.
SPPMFL04  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL004,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPPMFL99
.
SPPMFL05  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL005,CCENT,CYEAR,CMON,CDAY  
          GOTO      SPPMFL99
.
SPPMFL06  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL006,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPPMFL99
.
SPPMFL07  MOVE      QRYDATA,PMSFL007 
          GOTO      SPPMFL99
.
SPPMFL08  MOVE      QRYDATA,PMSFL008 
          GOTO      SPPMFL99
.
SPPMFL09  MOVE      QRYDATA,PMSFL009
          GOTO      SPPMFL99
.
SPPMFL10  MOVE      QRYDATA,PMSFL010
          GOTO      SPPMFL99
.
SPPMFL11  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL011,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPPMFL99
.
SPPMFL12  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL012,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPPMFL99
.
SPPMFL13  MOVE      QRYDATA,PMSFL013
          GOTO      SPPMFL99
.
SPPMFL14  MOVE      QRYDATA,PMSFL014
          GOTO      SPPMFL99
.
SPPMFL15  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL015,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPPMFL99
.
SPPMFL16  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL016,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPPMFL99
.
SPPMFL17  MOVE      QRYDATA,PMSFL017
          GOTO      SPPMFL99
.
SPPMFL18  MOVE      QRYDATA,PMSFL018
          GOTO      SPPMFL99
.
SPPMFL19  MOVE      QRYDATA,PMSFL019
          GOTO      SPPMFL99
.
SPPMFL20  MOVE      QRYDATA,PMSFL020
          GOTO      SPPMFL99
.
SPPMFL21  MOVE      QRYDATA,PMSFL021
          GOTO      SPPMFL99
.
SPPMFL22  MOVE      QRYDATA,PMSFL022
          GOTO      SPPMFL99
.
SPPMFL23  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL023,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPPMFL99
.
SPPMFL24  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL024,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPPMFL99
.
SPPMFL25  MOVE      QRYDATA,PMSFL025
          GOTO      SPPMFL99
.
SPPMFL26  MOVE      QRYDATA,PMSFL026
          GOTO      SPPMFL99
.
SPPMFL27  MOVE      QRYDATA,PMSFL027
          GOTO      SPPMFL99
.
SPPMFL28  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPMFL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSFL028,CCENT,CYEAR,CMON,CDAY
          GOTO      SPPMFL99
.
SPPMFL29  MOVE      QRYDATA,PMSFL029
          GOTO      SPPMFL99
.
SPPMFL30  MOVE      QRYDATA,PMSFL030
          GOTO      SPPMFL99
.
SPPMFL31  MOVE      QRYDATA,PMSFL031
          GOTO      SPPMFL99
.
SPPMFL32  MOVE      QRYDATA,PMSFL032
          GOTO      SPPMFL99
.
SPPMFL33  MOVE      QRYDATA,PMSFL033
          GOTO      SPPMFL99
.
SPPMFL34  MOVE      QRYDATA,PMSFL034
          GOTO      SPPMFL99
.
SPPMFL99  RETURN
.------------------------------------------------------------
. Clear Letter selection variables Variables
.------------------------------------------------------------
CLPMSF00  MOVE      SP70,PMLTSEID           * Selection ID.
          MOVE      SP70,PMLTSEDC           * Selection Description
          MOVE      SP70,PMLTVDFR           * Visit Date From (ccyymmdd)
          MOVE      SP70,PMLTVDTO           * Visit Date To (ccyymmdd)
          MOVE      SP70,PMLTDDFR           * Discharge Date From (ccyymmdd)
          MOVE      SP70,PMLTDDTO           * Dischrage Date To (ccyymmdd)
          MOVE      SP70,PMLTSNFR           * Surname From
          MOVE      SP70,PMLTSNTO           * Surname To
          MOVE      SP70,PMLTLLFR          *  Last Letter Sent Code From
          MOVE      SP70,PMLTLLTO           * Last Letter Sent Code To
          MOVE      SP70,PMLTLDFR           * Last Letter Date From (ccyymmdd)
          MOVE      SP70,PMLTLDTO           * Last Letter Date To (ccyymmdd)
          MOVE      SP70,PMLTFCFR           * Future Action From (category FA)
          MOVE      SP70,PMLTFCTO           * Future Action To (category FA)
          MOVE      SP70,PMLTFDFR           * Future Action Date From (ccyymmdd)
          MOVE      SP70,PMLTFDTO           * Future Action Date To (ccyymmdd)
          MOVE      SP70,PMLTCCFR           * Claim Code From (category CL)
          MOVE      SP70,PMLTCCTO           * Claim Code To (category CL)
          MOVE      SP70,PMLTATFR           * Admission Type From (category A)
          MOVE      SP70,PMLTATTO           * Admission Type To (category A)
          MOVE      ZERO,PMLTOAMT           * Outstanding Amount Lower Limit
          MOVE      SP70,PMLTIIIN           * Ignore Insurance Invoices
          MOVE      SP70,PMLTPDFR           * Fund Payment Date From (ccyymmdd)
          MOVE      SP70,PMLTPDTO           * Fund Payment Date To (ccyymmdd)
          MOVE      SP70,PMLTDSTT           * Deceased Status
          MOVE      SP70,PMLTSYST           * System
          MOVE      SP70,PMLTLCOD           * Letter Code
          MOVE      SP70,PMLTLDAT           * Date of letter
          MOVE      "    0",PMLTRCNT        * Number of Records(right justified)
          MOVE      SP70,PMLTMHOS           * Hospital ID
          MOVE      SP70,PMLTHFUN           * Health Fund
          MOVE      SP70,PMLTINSR           * Insurance
          MOVE      SP70,PMLTMISC           * Misc.Charge Code
          MOVE      SP70,PMLTPPLN           * Patient on Payment plan
          MOVE      SP70,PMLTUDAT           * Date record updated
          MOVE      SP70,PMLTUTIM           * Time record updated
          MOVE      SP70,PMLTSPAR           * Spare variable
.
CLPMSF99  RETURN
.------------------------------------------------------------
. Add Patient Letter Fields
.------------------------------------------------------------
PMFL0000  BRANCH    FLDITMNO,PMFL0100,PMFL0200,PMFL0300,PMFL0400,PMFL0500:
                             PMFL0600,PMFL0700,PMFL0800,PMFL0900,PMFL1000:
                             PMFL1100,PMFL1200,PMFL1300,PMFL1400,PMFL1500:
                             PMFL1600,PMFL1700,PMFL1800,PMFL1900,PMFL2000:
                             PMFL2100,PMFL2200,PMFL2300,PMFL2400,PMFL2500:
                             PMFL2600,PMFL2700,PMFL2800,PMFL2900,PMFL3000:
                             PMFL3100,PMFL3200,PMFL3300,PMFL3400,PMFL3500:
                             PMFL3600
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMFL9999
.
PMFL0100  WRITE     HTMLFILE;PMLTSEID;
          GOTO      PMFL9999
.
PMFL0200  WRITE     HTMLFILE;PMLTSEDC;
          GOTO      PMFL9999
.
PMFL0300  MATCH     PMLTVDFR,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTVDFR,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMFL9999 
.
PMFL0400  MATCH     PMLTVDTO,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTVDTO,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMFL9999 
.
PMFL0500  MATCH     PMLTDDFR,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTDDFR,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMFL9999 
.
PMFL0600  MATCH     PMLTDDTO,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTDDTO,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMFL9999 
.
PMFL0700  WRITE     HTMLFILE;PMLTSNFR;
          GOTO      PMFL9999
.
PMFL0800  WRITE     HTMLFILE;PMLTSNTO;
          GOTO      PMFL9999
.
PMFL0900  MOVE      PMLTLLFR,CODE  
          CALL      SELFLT00  
          GOTO      PMFL9999
.
PMFL1000  MOVE      PMLTLLTO,CODE 
          CALL      SELFLT00 
          GOTO      PMFL9999
.
PMFL1100  MATCH     PMLTLDFR,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTLDFR,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR 
          GOTO      PMFL9999
.
PMFL1200  MATCH     PMLTLDTO,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTLDTO,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR 
          GOTO      PMFL9999
.
PMFL1300  MOVE      "FA",CATEGORY
          MOVE      PMLTFCFR,CODE
          CALL      CODITM00
          GOTO      PMFL9999
.
PMFL1400  MOVE      "FA",CATEGORY
          MOVE      PMLTFCTO,CODE
          CALL      CODITM00
          GOTO      PMFL9999
.
PMFL1500  MATCH     PMLTFDFR,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTFDFR,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR  
          GOTO      PMFL9999
.
PMFL1600  MATCH     PMLTFDTO,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTFDTO,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR 
          GOTO      PMFL9999
.
PMFL1700  MOVE      "CL",CATEGORY
          MOVE      PMLTCCFR,CODE
          CALL      CODITM00
          GOTO      PMFL9999
.
PMFL1800  MOVE      "CL",CATEGORY
          MOVE      PMLTCCTO,CODE
          CALL      CODITM00
          GOTO      PMFL9999
.
PMFL1900  MOVE      "A ",CATEGORY
          MOVE      PMLTATFR,CODE
          CALL      CODITM00
          GOTO      PMFL9999
.
PMFL2000  MOVE      "A ",CATEGORY
          MOVE      PMLTATTO,CODE
          CALL      CODITM00
          GOTO      PMFL9999
.
PMFL2100  WRITE     HTMLFILE;PMLTOAMT; 
          GOTO      PMFL9999
.
PMFL2200  WRITE     HTMLFILE;PMLTIIIN;
          GOTO      PMFL9999
.
PMFL2300  MATCH     PMLTPDFR,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTPDFR,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMFL9999 
.
PMFL2400  MATCH     PMLTPDTO,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTPDTO,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMFL9999 
.
PMFL2500  WRITE     HTMLFILE;PMLTDSTT;
          GOTO      PMFL9999
.
PMFL2600  WRITE     HTMLFILE;PMLTSYST;
          GOTO      PMFL9999
.
PMFL2700  CALL      FLPTAB00   
          GOTO      PMFL9999
.
PMFL2800  MOVE      PMLTLCOD,CODE
          CALL      SELFLT00
          GOTO      PMFL9999
.
PMFL2900  MATCH     PMLTLDAT,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTLDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PMFL9999
.
PMFL3000  MATCH     PMLTRCNT,SP70
          IF        @EQUAL
            MOVE      "    0",PMLTRCNT
          ENDIF
          WRITE     HTMLFILE;PMLTRCNT;
          GOTO      PMFL9999
.
PMFL3100  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMFL3110
.
          WRITE     HTMLFILE;PMLTMHOS;
          GOTO      PMFL9999
.
PMFL3110  CALL      HSLI0000
          GOTO      PMFL9999
.
PMFL3200  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMFL3210
.
          WRITE     HTMLFILE;PMLTHFUN;
          GOTO      PMFL9999
.
PMFL3210  MOVE      PMLTHFUN,HFUND001
          CALL      DFND0000
          GOTO      PMFL9999
.
PMFL3300  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMFL3310
.
          WRITE     HTMLFILE;PMLTINSR;
          GOTO      PMFL9999
.
PMFL3310  CALL      DINS0000
          GOTO      PMFL9999
.
PMFL3400  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMFL3410
.
          WRITE     HTMLFILE;PMLTMISC;
          GOTO      PMFL9999
.
PMFL3410  MOVE      SP1,KEY1
....      OPEN      PATMCHG4,"patmchgf"
          PACK      KEY29,PMLTMISC,SP70                               *C-233046
          CALL      RDSMCHG4
          CALL      RDKMCHG4
          BRANCH    OVRCD,PMFL9999
          MATCH     PMLTMISC,MCHARGE
          GOTO      PMFL9999 IF NOT EQUAL
          MATCH     "1",PTMCACTV               * Inactive ?
          GOTO      PMFL9999 IF EQUAL          * Yes
          WRITE     HTMLFILE;MDESC;
          GOTO      PMFL9999
.
PMFL3500  MATCH     PMLTUDAT,SP70
          GOTO      PMFL9999 IF EQUAL
          UNPACK    PMLTUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP2,PMLTUTIM;
          GOTO      PMFL9999
.
PMFL3600  WRITE     HTMLFILE;PMLTPPLN;
          GOTO      PMFL9999
.
PMFL9999  RETURN
.------------------------------------------------------------
.         Display Selection of Insurance
.------------------------------------------------------------
DINS0000  PACK      KEY6,SP70
          CALL      RDSINSR1
DINS1000  CALL      RDKINSR1
          BRANCH    OVRCD,DINS9999
.
          MATCH     "1",PTINACTV            * (1=inactive)            *I-169939
          GOTO      DINS1000 IF EQUAL                                 *I-169939
.
          MATCH     ICODE,PMLTINSR
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",ICODE,"#" selected> ":
                                 ICODE,": ",INAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ICODE,">":
                                ICODE,": ",INAME,"</option>"
          ENDIF
          GOTO      DINS1000
.
DINS9999  RETURN
+
.------------------------------------------------------------
.  move CGI variable to file variable 
.------------------------------------------------------------
MVPMFL00  MATCH     PMSFL001,SP70
          IF        !@EQUAL
            MOVE      PMSFL001,PMLTSEID
          ENDIF
.
          MATCH     PMSFL002,SP70
          IF        !@EQUAL
            MOVE      PMSFL002,PMLTSEDC
          ENDIF
.
          MATCH     PMSFL003,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTVDFR
          ELSE
            MOVE      PMSFL003,PMLTVDFR
          ENDIF
.
          MATCH     PMSFL004,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTVDTO
          ELSE
            MOVE      PMSFL004,PMLTVDTO
          ENDIF
.
          MATCH     PMSFL005,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTDDFR
          ELSE
            MOVE      PMSFL005,PMLTDDFR
          ENDIF
.
          MATCH     PMSFL006,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTDDTO
          ELSE
            MOVE      PMSFL006,PMLTDDTO
          ENDIF
.
          MATCH     PMSFL007,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTSNFR
          ELSE
            MOVE      PMSFL007,PMLTSNFR
          ENDIF
.
          MATCH     PMSFL008,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTSNTO
          ELSE
            MOVE      PMSFL008,PMLTSNTO
          ENDIF
.
          MATCH     PMSFL009,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTLLFR
          ELSE
            MOVE      PMSFL009,PMLTLLFR
          ENDIF
.
          MATCH     PMSFL010,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTLLTO
          ELSE
            MOVE      PMSFL010,PMLTLLTO
          ENDIF
.
          MATCH     PMSFL011,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTLDFR
          ELSE
            MOVE      PMSFL011,PMLTLDFR
          ENDIF
.
          MATCH     PMSFL012,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTLDTO
          ELSE
            MOVE      PMSFL012,PMLTLDTO
          ENDIF
.
          MATCH     PMSFL013,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTFCFR
          ELSE
            MOVE      PMSFL013,PMLTFCFR
          ENDIF
.
          MATCH     PMSFL014,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTFCTO
          ELSE
            MOVE      PMSFL014,PMLTFCTO
          ENDIF
.
          MATCH     PMSFL015,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTFDFR
          ELSE
            MOVE      PMSFL015,PMLTFDFR
          ENDIF
.
          MATCH     PMSFL016,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTFDTO
          ELSE
            MOVE      PMSFL016,PMLTFDTO
          ENDIF
.
          MATCH     PMSFL017,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTCCFR
          ELSE
            MOVE      PMSFL017,PMLTCCFR
          ENDIF
.
          MATCH     PMSFL018,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTCCTO
          ELSE
            MOVE      PMSFL018,PMLTCCTO
          ENDIF
.
          MATCH     PMSFL019,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTATFR
          ELSE
            MOVE      PMSFL019,PMLTATFR
          ENDIF
.
          MATCH     PMSFL020,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTATTO
          ELSE
            MOVE      PMSFL020,PMLTATTO
          ENDIF
.
          MOVE      PMSFL021,PMLTOAMT
.
          MATCH     PMSFL022,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTIIIN
          ELSE
            MOVE      PMSFL022,PMLTIIIN
          ENDIF
.
          MATCH     PMSFL023,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTPDFR
          ELSE
            MOVE      PMSFL023,PMLTPDFR
          ENDIF
.
          MATCH     PMSFL024,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTPDTO
          ELSE
            MOVE      PMSFL024,PMLTPDTO
          ENDIF
.
          MATCH     PMSFL025,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTDSTT
          ELSE
            MOVE      PMSFL025,PMLTDSTT
          ENDIF
.
          MATCH     PMSFL026,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTSYST
          ELSE
            MOVE      PMSFL026,PMLTSYST
          ENDIF
.
          MATCH     PMSFL027,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTLCOD
          ELSE
            MOVE      PMSFL027,PMLTLCOD
          ENDIF
.
          MATCH     PMSFL028,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTLDAT
          ELSE
            MOVE      PMSFL028,PMLTLDAT
          ENDIF
.
.          MOVE      "    0",PMLTRCNT   * initialise number of record (RJ)
.
          MATCH     PMSFL029,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTMHOS
          ELSE
            MOVE      PMSFL029,PMLTMHOS
          ENDIF
.
          MATCH     PMSFL030,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTHFUN
          ELSE
            MOVE      PMSFL030,PMLTHFUN
          ENDIF
.
          MATCH     PMSFL031,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTINSR
          ELSE
            MOVE      PMSFL031,PMLTINSR
          ENDIF
.
          MATCH     PMSFL032,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTMISC
          ELSE
            MOVE      PMSFL032,PMLTMISC
          ENDIF
.
          MATCH     PMSFL033,SP70
          IF        @EQUAL
            MOVE      "    0",PMLTRCNT
          ELSE
            MOVE      PMSFL033,PMLTRCNT
          ENDIF
.
          MATCH     PMSFL034,SP70
          IF        @EQUAL
            MOVE      SP70,PMLTPPLN
          ELSE
            MOVE      PMSFL034,PMLTPPLN
          ENDIF
.
          PACK      PMLTUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMLTUDAT
          CLOCK     TIME,PMLTUTIM
.
MVPMFL99  RETURN
.------------------------------------------------------------
. List of patient lists
.------------------------------------------------------------
FLPTAB00  IF        IBCNMHOS=1
            OPEN      MLTSECA1,"mltsecaf"
          ENDIF
          MOVE      SP70,KEY4
          CALL      RSPMLTF1
FLPTAB10  CALL      RKPMLTF1
          BRANCH    OVRCD,FLPTAB99
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateItem('",HTMLLINK
          APPEND    PMLTSEID,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          MATCH     PMLTVDFR,SP70
          IF        @EQUAL
            PACK      PMLDAT01,SP1
          ELSE
            UNPACK    PMLTVDFR,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      PMLDAT01,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MATCH     PMLTVDTO,SP70
          IF        @EQUAL
            PACK      PMLDAT02,SP1
          ELSE
            UNPACK    PMLTVDTO,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      PMLDAT02,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        IBCNMHOS=1
            MATCH     SP70,PMLTMHOS
            IF        !@EQUAL
              PACK      KEY13,USERID,SP70                * All hospital access
              CALL      RDMLSEC1
              IF        OVRCD=1
                PACK      KEY13,USERID,PMLTMHOS,SP70     * This hospital access
                CALL      RDMLSEC1
                BRANCH    OVRCD,FLPTAB10
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      SP70,KEY12
          MATCH     PMLTUDAT,SP70
          IF        !@EQUAL
            UNPACK    PMLTUDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PMLTSEID,"#",":
                             "#"",PMLTSEDC,"#",":
                             "#"",PMLDAT01,"#",":
                             "#"",PMLDAT02,"#",":
                             "#"",PMLTSNFR,"#",":
                             "#"",PMLTSNTO,"#",":
                             "#"",KEY12,"#");"
.
          GOTO      FLPTAB10
.
FLPTAB99  RETURN
.
.------------------------------------------------------------
. Patient Financial Letters Type
.------------------------------------------------------------
SELFLT00  PACK      KEY6,SP2,ZERO,SP3
          CALL      RSPTFL2
SELFLT10  CALL      RKPTFL2
          BRANCH    OVRCD,SELFLT99

          MATCH     "EW",PTFLTEXT
          GOTO      SELFLT10 IF EQUAL
          COMPARE   ZERO,PTFLLINO               * header line ?
          GOTO      SELFLT10 IF NOT EQUAL       * no
.
          PACK      KEY25,PTFLTEXT,SP30
          PACK      KEY8,QUOTE,DPTFLLTN,QUOTE
.
          MATCH     DPTFLLTN,CODE
          IF        @EQUAL
             WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                    "(",DPTFLLTN,") ",KEY25,"</option>"
          ELSE
            MATCH     "1",PTFLACTV                 * Skip Inactive
            GOTO      SELFLT10 IF EQUAL
.
             WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",DPTFLLTN,") ",KEY25,"</option>"
          ENDIF
.
          GOTO      SELFLT10
.
SELFLT99  RETURN
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
HSLI0000  IF        IBCNMHOS=1
            OPEN      MLTSECA1,"mltsecaf"
          ENDIF
          MATCH     SP70,PMLTMHOS
          IF        @EQUAL
            MOVE      WBSEHOSP,PMLTMHOS                * default hospital
          ENDIF
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HSLI0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSLI9999
.
          IF        IBCNMHOS=1
            PACK      KEY13,USERID,SP70                * All hospital access
            CALL      RDMLSEC1
            IF        OVRCD=1
              PACK      KEY13,USERID,PTHSHOSP,SP70     * This hospital access
              CALL      RDMLSEC1
              BRANCH    OVRCD,HSLI0100
            ENDIF
          ENDIF
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     PMLTMHOS,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",PTHSNAME,"</option>"
          ENDIF
          GOTO      HSLI0100
.
HSLI9999  RETURN

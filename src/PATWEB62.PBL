.------------------------------------------------------------------------------
. Program       : PATWEB62
.
. Function      : System Maintenance Server for 
.                 Report 1: Emergency Flag Clear - Clear Program Locking
.
. Modifications :
.       V10.14.01 29/08/2019  Peter Vela       TSK 0879284
.                 Modified CLMFLS00 to use "ls -1t" instead of "find"
.       V10.13.05 28/11/2018  Peter Vela       TSK 0859743
.                 Added Eclipse Bulk Billing Functionality
.       V10.13.04 22/10/2018  Steve Armstrong  TSK 0859742
.                 Fixed PCS VCH field names from VCHSEG..(for IMC) to VCHSES..
.       V10.13.03 26/09/2018  Peter Vela    TSK 0859742
.                 Added Module to Store and Forward
.       V10.13.02 31/08/2018  Peter Vela    TASK 0859742
.                 Added Eclipse Store and Forward Functionality
.       V10.13.01 23/07/2018  J.Tan         TASK 0851232
.                 Added locking for Final Cash Reconciliation
.       V10.11.04 13.10.2017  Peter McMullen    TSK 0846740
.                 Extended length of TFNPID from 5 to 10 char
.       V10.11.03 14/09/2017  Peter Vela         TSK 0837619
.                 Fixed SRVSEG13
.       V10.11.02 25.08.2017  Ebon Clements      TSK 0842977
.                 Changed file list to use a find command - CLMFLS10
.       V10.11.01 22.08.2017  Ebon Clements      TSK 0842977
.                 Changes ls *.txt to grep for .txt to stop argument list
.                 too long error - CLMFLS10
.       V10.08.04 05.10.2016  Peter Vela         TSK 0294177
.                 Added VCHSEG26
.       V10.08.03 15.09.2016  Peter McMullen     CAR 0317711
.                 Fix formatting error in DMG segment
.       V10.08.02 29.08.2016  Peter McMullen     CAR 0825115
.                 Fix formatting error in SRV segment
.       V10.08.01 19.07.2016  Peter McMullen     CAR 0294177
.                 Add support for IMC files, segemts CLM, VCH,SRV
.       V10.06.02 27.08.2015  Peter Mc     CAR 313872
.                 Fix segment layout problem in CCG segment
.       V10.06.01 20.05.2015  J.Tan        CAR 294739
.                 Added a remote script to update ibapdfaf
.       V10.05.01 12.12.2014  Peter Mc     CAR 282328
.                 Adjust mapping of Eclipse segmnets in line with car 294157
.       V10.04.01 31.03.2014  B.G.Ackland  CAR 299363
.                 Replace META Tag Redirect with Javascript in Common RDIREC00
.                 Routine
.------------------------------------------------------------------------------
.       V10.00.02 16/08/2010  Peter Vela      CAR 228283
.                 Changed PTCNOECO to PTCNOECI
.       V10.00.01 04/06/2010  J.Tan           CAR 222746
.                 Added paramters for Cash release
.------------------------------------------------------------------------------
.        V9.12.01 29/09/2009  Peter McMullen  CAR 206704 
.                 Add support for PTCNECSA SA console URL                    
.------------------------------------------------------------------------------
.        V9.11.02 17/12/2008  Peter McMullen  CAR 197463 
.                 extend report 3 to cater for OEC files                     
.        V9.11.01 17/12/2008  Peter McMullen  CAR 183976
.                 Add report 3, browser for eclipse claim files              
.------------------------------------------------------------------------------
.        V9.05.01 09/03/2006  Ebon Clements CAR 78533
.                 Mods for PATCODTM - Hospital specific category codes
.        V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.                 Mods for REDIRECT length change. Recompiled for IBAWEBDF
.        V9.03.05 15/07/2004  Pat Dirito     CAR 50842
.                 Added remote script unlock Web Stationery Programs
.        V9.03.04 23/06/2004 Ebon Clements  CAR 50746
.                 Added remote script unlock program option
.        V9.03.03 Lina Vo         CAR 48824
.                 Changed locking to display both web locking and old port
.                 locking.                                               
.        V9.03.02 Lina Vo         CAR 48824
.                 Changed Web locking to use userid rather than passcode.
.        V9.03.01 Sylvek Litewka  CAR 41293
.                 Removed references to WEBSCHFD and WEBSCHIO includes.
.------------------------------------------------------------------------------
.
.------------------------------------------------------------------------------
. FD Includes
.------------------------------------------------------------------------------
.
          INC       IBAWEBDF
          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       PATCOMM/INC             * IBA Control file
.
          INC       PATCONFD/INC            * Patient Control file
          INC       RCPCONFD/INC            * Receipt Control file
.         INC       PATDRGFD/INC            * Period Date Range file
.
.-----------------------------------------------------------------------------
. Variable Declarations
.-----------------------------------------------------------------------------
.
. CGI Parameters
. **************
.
NEXTPAGE  FORM      1         * Nextpage parameter
UPDTTYPE  DIM       1         * Update Type (A)dd,(U)pdate,(D)elete,Blank=disp
STARTKEY  DIM       3         * Starting Key for search
.
. 
. Program Variables
. *****************
.
FORM1A    FORM      1        
CURRDATE  DIM       8
CLMCOUNT  FORM      4         * Claim sequence number
CLMNO     DIM       4         * Claim sequence number
CLAIMREC  DIM       647       * generic  claim record work area 
DIM8      DIM       8
DIM12     DIM       12

ECLMFILE  DIM       127       * Claim file name 
EXECCMD   DIM       227       * Shell command
FILEPATH  DIM       127       * Fully qualified file name and path
FILECNT   FORM      4         * Count of files collected                 
FUNDCODE  DIM       6         * Health Fund Code
REPTNUMB  DIM       2         * Report number
SAVKEY3   DIM       3         
SEGMENT   DIM       3         * Current Claim Segment
SEGCOUNT  FORM      4         * Segment sequence number
SEGNO     DIM       4         * Segment sequence number
TFILENM   DIM       20        * Temporary file name
TILDE     DIM       1         * Junk byte for head of record read 
PRNTCODE  DIM       6         * Printer code
PROGNAME  DIM       8         * Program name
PORTLOCK  DIM       2         * Locking port number          
WUSRLOCK  DIM       10        * Locking web user             
TFNPID    DIM       10        * procesID for temp file name
LOOPCT    FORM      3
.
FILELIST  FILE      ASCII, FIXED=127  * Output of ls shell command
EXTRFILE  FILE      ASCII, FIXED=615  * Extract file to be processed


. ----- Eclipse Data Variables -----
.
. HDR segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.HDR      DIM       3      2
HDRSEG01  DIM       8      5     * Batch Number
HDRSEG02  DIM       8      13    * Location Id
HDRSEG03  DIM       10     21    * Certificate Id
HDRSEG04  DIM       60     31    * Sender Id
HDRSEG05  DIM       1      91    * Test/Production (T/P)
. End of Segment           92
.
.
. CID segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.CID      DIM       3      2
CIDSEG01  DIM       20     5     * AccountReferenceId
CIDSEG02  DIM       2      25    * ClaimTypeCode
CIDSEG03  DIM       1      27    * CompensableClaimCode
CIDSEG04  DIM       1      28    * ContiguousClaimCode
CIDSEG05  DIM       8      29    * FacilityId
CIDSEG06  DIM       1      37    * FacilityTypeCode
CIDSEG07  DIM       3      38    * FundBrandId
CIDSEG08  DIM       20     41    * PaymentModel
CIDSEG09  DIM       1      61    * PreviousClaimCode
CIDSEG10  DIM       24     62    * PreviousTransactionId
CIDSEG11  DIM       128    86    * SenderContactEmail
.SP1      DIM       1      213   * makes 128 characters for CIDSEG11
CIDSEG12  DIM       40     214   * SenderContactPersonName
CIDSEG13  DIM       19     254   * SenderContactPersonPhone
CIDSEG14  DIM       9      273   * TotalChargeAmount
CIDSEG15  DIM       9      282   * TotalHospitalChargeAmount
CIDSEG16  DIM       9      291   * TotalMedicalChargeAmount
CIDSEG17  DIM       1      300   * UrgencyCode
. End of Segment           301
.
. PAT segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.PAT      DIM       3      2
PATSEG01  DIM       4      5     * PatientAddressPostcode
PATSEG02  DIM       4      9     * PatientAdmissionWeight
PATSEG03  DIM       40     13    * PatientAliasFamilyName
PATSEG04  DIM       40     53    * PatientAliasFirst
PATSEG05  DIM       8      93    * PatientDateOfBirth
PATSEG06  DIM       40     101   * PatientFamilyName
PATSEG07  DIM       40     141   * PatientFirstName
PATSEG08  DIM       19     181   * PatientFundMembershipNum
PATSEG09  DIM       2      200   * PatientFundUPI
PATSEG10  DIM       1      202   * PatientGender
PATSEG11  DIM       10     203   * PatientMedicareCardNum
PATSEG12  DIM       20     213   * PatientMedicalRecordId
PATSEG13  DIM       1      233   * PatientReferenceNum
PATSEG14  DIM       1      234   * PatientSecondInitial
PATSEG15  DIM       8      235   * SymptomAwarenessDate
. End of Segment           243
.
.
. EPD segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.EPD      DIM       3      2
EPDSEG01  DIM       1      5     * AccommodationStatusCode
EPDSEG02  DIM       1      6     * AdmissionCategoryCode
EPDSEG03  DIM       8      7     * AdmissionDate
EPDSEG04  DIM       4      15    * AdmissionTime
EPDSEG05  DIM       4      19    * AnticipatedLengthOfStay
EPDSEG06  DIM       8      23    * DischargeDate
EPDSEG07  DIM       1      31    * DischargeIntentionCode
EPDSEG08  DIM       4      32    * DischargeTime
EPDSEG09  DIM       2      36    * DischargeTypeCode
EPDSEG10  DIM       15     38    * EpisodeId
EPDSEG11  DIM       3      53    * EpisodeTypeCode
EPDSEG12  DIM       1      56    * FacilityContractStatusCode
EPDSEG13  DIM       4      57    * LengthOfStay
EPDSEG14  DIM       1      61    * MentalHealthLegalStatusCode
EPDSEG15  DIM       1      62    * PalliativeCareStatusCode
EPDSEG16  DIM       2      63    * PatientClassificationCode
EPDSEG17  DIM       1      65    * ReadmissionCode
EPDSEG18  DIM       1      66    * ReferralSourceCode
EPDSEG19  DIM       1      67    * SamedayCode
EPDSEG20  DIM       1      68    * UnplannedTheatreCode
EPDSEG21  DIM       5      69    * TotalPsychiatricCareDays
EPDSEG22  DIM       4      74    * PalliativeCareDays
EPDSEG23  DIM       5      78    * NumberOfQualifiedDaysForNewborns
. End of Segment           83

.
. SVB segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.SVB      DIM       3      2
SVBSEG01  DIM       9      5     * ChargeAmount
SVBSEG02  DIM       1      14    * ChargeRaisedCde
SVBSEG03  DIM       8      15    * FromDate
SVBSEG04  DIM       4      23    * NumberOfDays
SVBSEG05  DIM       11     27    * ServiceCode
SVBSEG06  DIM       1      38    * ServiceCodeTypeCode
SVBSEG07  DIM       8      39    * ToDate
. End of Segment           47
.
.
. ANB segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.ANB      DIM       3      2
ANBSEG01  DIM       8      5     * BabyDateOfBirth
ANBSEG02  DIM       40     13    * BabyFamilyName
ANBSEG03  DIM       40     53    * BabyFirstName
ANBSEG04  DIM       1      93    * BabyGender
ANBSEG05  DIM       1      94    * BabySecondInitial
. End of Segment           95
.
.
. TFR segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.TFR      DIM       3      2
TFRSEG01  DIM       8      5     * FacilityId
TFRSEG02  DIM       4      13    * PreviousProviderDays
TFRSEG03  DIM       2      17    * PreviousProviderHours
TFRSEG04  DIM       8      19    * ServiceDate
TFRSEG05  DIM       1      27    * TransferCde
TFRSEG06  DIM       1      28    * TransferTypeCode
. End of Segment           29
.
.
. ACS segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.ACS      DIM       3      2
ACSSEG01  DIM       4      5     * AccommodationDays
ACSSEG02  DIM       1      9     * ChargeRaisedCde
ACSSEG03  DIM       8      10    * FromDate
ACSSEG04  DIM       4      18    * LeaveDays
ACSSEG05  DIM       4      22    * NumberOfDays
ACSSEG06  DIM       8      26    * ToDate
ACSSEG07  DIM       9      34    * TotalChargeAmount
ACSSEG08  DIM       4      43    * NonCertifiedDaysOfStay
. End of Segment           47
.
.
. ACD segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.ACD      DIM       3      2
ACDSEG01  DIM       1      5     * BedBandCode
ACDSEG02  DIM       1      6     * BedLevelAddOnInd
ACDSEG03  DIM       2      7     * BedLevelCode
ACDSEG04  DIM       9      9     * ChargeAmount
ACDSEG05  DIM       1      18    * ChargeRaisedCde
ACDSEG06  DIM       9      19    * DayRate
ACDSEG07  DIM       8      28    * FromDate
ACDSEG08  DIM       4      36    * NumberOfDays
ACDSEG09  DIM       2      40    * PatientClassificationCode
ACDSEG10  DIM       11     42    * ProgramNum
ACDSEG11  DIM       11     53    * ServiceCode
ACDSEG12  DIM       1      64    * ServiceCodeTypeCode
ACDSEG13  DIM       8      65    * ToDate
. End of Segment           73
.
.
. CCG segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.CCG      DIM       3      2
CCGSEG01  DIM       9      5     * ChargeAmount
CCGSEG02  DIM       1      14    * ChargeRaisedCde
CCGSEG03  DIM       1      15    * CriticalCareAddOnInd
CCGSEG04  DIM       1      16    * CriticalCareLevelCode
CCGSEG05  DIM       3      17    * CriticalCareTypeCode
CCGSEG06  DIM       9      20    * DayRate
CCGSEG07  DIM       8      29    * FromDate
CCGSEG08  DIM       4      37    * ICUHrs
CCGSEG09  DIM       4      41    * NumberOfDays
CCGSEG10  DIM       11     45    * ServiceCode
CCGSEG11  DIM       1      56    * ServiceCodeTypeCode
CCGSEG12  DIM       8      57    * ToDate
CCGSEG13  DIM       4      65    * CCUHrs
. End of Segment           69
.
.
. LPD segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.LPD      DIM       3      2
LPDSEG01  DIM       8      5     * FromDate
LPDSEG02  DIM       8      13    * ToDate
LPDSEG03  DIM       4      21    * NumberOfDays
. End of Segment           25
.
. PSG segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.PSG      DIM       3      2
PSGSEG01  DIM       1      5     * AnaestheticTypeCode
PSGSEG02  DIM       9      6     * ChargeAmount
PSGSEG03  DIM       1      15    * ChargeRaisedCde
PSGSEG04  DIM       11     16    * ServiceCode
PSGSEG05  DIM       1      27    * ServiceCodeTypeCode
PSGSEG06  DIM       8      28    * ServiceDate
PSGSEG07  DIM       4      36    * ServiceTime
PSGSEG08  DIM       3      40    * TheatreBandCode
PSGSEG09  DIM       1      43    * TheatreBandTypeCode
PSGSEG10  DIM       1      44    * TheatreCategoryCode
PSGSEG11  DIM       4      45    * TheatreMins
PSGSEG12  DIM       9      49    * TotalChargeAmount
. End of Segment           58
.
.
. MSG segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.MSG      DIM       3      2
MSGSEG01  DIM       9      5     * ChargeAmount
MSGSEG02  DIM       1      14    * ChargeRaisedCde
MSGSEG03  DIM       11     15    * ServiceCode
MSGSEG04  DIM       1      26    * ServiceCodeTypeCode
MSGSEG05  DIM       3      27    * TheatreBandCode
MSGSEG06  DIM       1      30    * TheatreBandTypeCode
MSGSEG07  DIM       1      31    * TheatreCategoryCode
. End of Segment           32
.
.
. TRG segment
.-------------
TRGSEG01  DIM       15           * AmbulanceReferenceId
TRGSEG02  DIM       9            * ChargeAmount
TRGSEG03  DIM       1            * ChargeRaisedCde
TRGSEG04  DIM       4            * DistanceKms
TRGSEG05  DIM       40           * FromLocality
TRGSEG06  DIM       8            * ServiceDate
TRGSEG07  DIM       4            * StartTime
TRGSEG08  DIM       40           * ToLocality
TRGSEG09  DIM       4            * TransportHoursMins
TRGSEG10  DIM       1            * TransportTypeCode
.
.
. MIG segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.MIG      DIM       3      2
MIGSEG01  DIM       9      5     * ChargeAmount
MIGSEG02  DIM       1      14    * ChargeRaisedCde
MIGSEG03  DIM       11     15    * ServiceCode
MIGSEG04  DIM       8      26    * ServiceDate
MIGSEG05  DIM       9      34    * ServiceRate
MIGSEG06  DIM       2      43    * ServiceQuantity
MIGSEG07  DIM       30     45    * Text
. End of Segment           75
.
.
. DMG segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.DMG      DIM       3      2
DMGSEG01  DIM       4      5     * DRGCode
DMGSEG02  DIM       2      9     * DRGVersion
DMGSEG03  DIM       6      11    * PrincipalDiagnosis
DMGSEG04  DIM       4      17    * VentilationHrs
DMGSEG05  DIM       294    21    * Additional Diagnoses
DMGSEG06  DIM       350    315   * Additional Procedures
.
OLDDMG03  DIM       5      11    * PrincipalDiagnosis
OLDDMG05  DIM       245    20    * 49x5 diagnoses     	
OLDDIAG   DIM       5 

.
. Additional Diagnosis Segment (49 times)
.----------------------------------------------
ADDSEG01  DIM       6      21    * AdditionalDiagnosis
ADDSEG02  DIM       6      27    * AdditionalDiagnosis
ADDSEG03  DIM       6      33    * AdditionalDiagnosis
ADDSEG04  DIM       6      39    * AdditionalDiagnosis
ADDSEG05  DIM       6      45    * AdditionalDiagnosis
ADDSEG06  DIM       6      51    * AdditionalDiagnosis
ADDSEG07  DIM       6      57    * AdditionalDiagnosis
ADDSEG08  DIM       6      63    * AdditionalDiagnosis
ADDSEG09  DIM       6      69    * AdditionalDiagnosis
ADDSEG10  DIM       6      75    * AdditionalDiagnosis
ADDSEG11  DIM       6      81    * AdditionalDiagnosis
ADDSEG12  DIM       6      87    * AdditionalDiagnosis
ADDSEG13  DIM       6      93    * AdditionalDiagnosis
ADDSEG14  DIM       6      99    * AdditionalDiagnosis
ADDSEG15  DIM       6      105   * AdditionalDiagnosis
ADDSEG16  DIM       6      111   * AdditionalDiagnosis
ADDSEG17  DIM       6      117   * AdditionalDiagnosis
ADDSEG18  DIM       6      123   * AdditionalDiagnosis
ADDSEG19  DIM       6      129   * AdditionalDiagnosis
ADDSEG20  DIM       6      135   * AdditionalDiagnosis
ADDSEG21  DIM       6      141   * AdditionalDiagnosis
ADDSEG22  DIM       6      147   * AdditionalDiagnosis
ADDSEG23  DIM       6      153   * AdditionalDiagnosis
ADDSEG24  DIM       6      159   * AdditionalDiagnosis
ADDSEG25  DIM       6      165   * AdditionalDiagnosis
ADDSEG26  DIM       6      171   * AdditionalDiagnosis
ADDSEG27  DIM       6      177   * AdditionalDiagnosis
ADDSEG28  DIM       6      183   * AdditionalDiagnosis
ADDSEG29  DIM       6      189   * AdditionalDiagnosis
ADDSEG30  DIM       6      195   * AdditionalDiagnosis
ADDSEG31  DIM       6      201   * AdditionalDiagnosis
ADDSEG32  DIM       6      207   * AdditionalDiagnosis
ADDSEG33  DIM       6      213   * AdditionalDiagnosis
ADDSEG34  DIM       6      219   * AdditionalDiagnosis
ADDSEG35  DIM       6      225   * AdditionalDiagnosis
ADDSEG36  DIM       6      231   * AdditionalDiagnosis
ADDSEG37  DIM       6      237   * AdditionalDiagnosis
ADDSEG38  DIM       6      243   * AdditionalDiagnosis
ADDSEG39  DIM       6      249   * AdditionalDiagnosis
ADDSEG40  DIM       6      255   * AdditionalDiagnosis
ADDSEG41  DIM       6      261   * AdditionalDiagnosis
ADDSEG42  DIM       6      267   * AdditionalDiagnosis
ADDSEG43  DIM       6      273   * AdditionalDiagnosis
ADDSEG44  DIM       6      279   * AdditionalDiagnosis
ADDSEG45  DIM       6      285   * AdditionalDiagnosis
ADDSEG46  DIM       6      291   * AdditionalDiagnosis
ADDSEG47  DIM       6      297   * AdditionalDiagnosis
ADDSEG48  DIM       6      303   * AdditionalDiagnosis
ADDSEG49  DIM       6      309   * AdditionalDiagnosis
.
. Procedures Segment (50 times)
.------------------------------------
PROSEG01  DIM       7      315   * Procedures
PROSEG02  DIM       7      322   * Procedures
PROSEG03  DIM       7      329   * Procedures
PROSEG04  DIM       7      336   * Procedures
PROSEG05  DIM       7      343   * Procedures
PROSEG06  DIM       7      350   * Procedures
PROSEG07  DIM       7      357   * Procedures
PROSEG08  DIM       7      364   * Procedures
PROSEG09  DIM       7      371   * Procedures
PROSEG10  DIM       7      378   * Procedures
PROSEG11  DIM       7      385   * Procedures
PROSEG12  DIM       7      392   * Procedures
PROSEG13  DIM       7      399   * Procedures
PROSEG14  DIM       7      406   * Procedures
PROSEG15  DIM       7      413   * Procedures
PROSEG16  DIM       7      420   * Procedures
PROSEG17  DIM       7      427   * Procedures
PROSEG18  DIM       7      434   * Procedures
PROSEG19  DIM       7      441   * Procedures
PROSEG20  DIM       7      448   * Procedures
PROSEG21  DIM       7      455   * Procedures
PROSEG22  DIM       7      462   * Procedures
PROSEG23  DIM       7      469   * Procedures
PROSEG24  DIM       7      476   * Procedures
PROSEG25  DIM       7      483   * Procedures
PROSEG26  DIM       7      490   * Procedures
PROSEG27  DIM       7      497   * Procedures
PROSEG28  DIM       7      504   * Procedures
PROSEG29  DIM       7      511   * Procedures
PROSEG30  DIM       7      518   * Procedures
PROSEG31  DIM       7      525   * Procedures
PROSEG32  DIM       7      532   * Procedures
PROSEG33  DIM       7      539   * Procedures
PROSEG34  DIM       7      546   * Procedures
PROSEG35  DIM       7      553   * Procedures
PROSEG36  DIM       7      560   * Procedures
PROSEG37  DIM       7      567   * Procedures
PROSEG38  DIM       7      574   * Procedures
PROSEG39  DIM       7      581   * Procedures
PROSEG40  DIM       7      588   * Procedures
PROSEG41  DIM       7      595   * Procedures
PROSEG42  DIM       7      602   * Procedures
PROSEG43  DIM       7      609   * Procedures
PROSEG44  DIM       7      616   * Procedures
PROSEG45  DIM       7      623   * Procedures
PROSEG46  DIM       7      630   * Procedures
PROSEG47  DIM       7      637   * Procedures
PROSEG48  DIM       7      644   * Procedures
PROSEG49  DIM       7      651   * Procedures
PROSEG50  DIM       7      658   * Procedures
. End of Segment           665


.
.
. MOR segment
.-------------
.~        DIM       1      1
.MOR      DIM       3      2
MORSEG01  DIM       4      5     * ANSNAPClass
MORSEG02  DIM       7      9     * AROCImpairmentCode
MORSEG03  DIM       1      16    * AssessmentOnlyCode
MORSEG04  DIM       11     17    * CasemixCode
MORSEG05  DIM       1      28    * CasemixCodeTypeCode
MORSEG06  DIM       15     29    * ANSNAPId
MORSEG07  DIM       8      44    * DischargePlanDate
MORSEG08  DIM       8      52    * MultiDisciplinaryRehabPlanDate
.
.
. Admission FIM Score
.--------------------
AFSSEG01  DIM       1            * AdmissionFIMScore
.
.
. Discharge FIM Score
.--------------------
DFSSEG01  DIM       1            * DischargeFIMScore
.
.
. CER segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.CER      DIM       3      2
CERSEG01  DIM       2      5     * CertificateTypeCode
CERSEG02  DIM       8      7     * CertifyingProviderNum
CERSEG03  DIM       40     15    * CertifyingProviderName
CERSEG04  DIM       8      55    * IssueDateDate
CERSEG05  DIM       8      63    * FromDate
CERSEG06  DIM       4      71    * NumberOfDays
CERSEG07  DIM       8      75    * ToDate
CERSEG08  DIM       500    83    * Text
. End of Segment           583
.
.
. MED segment
.-------------
MEDSEG01  DIM       9            * ChargeAmount
MEDSEG02  DIM       1            * ChargeRaisedCde
MEDSEG03  DIM       8            * PayeeProviderNum
MEDSEG04  DIM       11           * ServiceCode
MEDSEG05  DIM       1            * ServiceCodeTypeCode
MEDSEG06  DIM       8            * ServiceDate
MEDSEG07  DIM       40           * ServicingProviderName
MEDSEG08  DIM       8            * ServicingProviderNum
.
.
. REM segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.REM      DIM       3      2
REMSEG01  DIM       500    5     * Text
. End of Segment           505
.
.
. Segments used in Online Eligibility Check files:
.
.
. OEH segment       Len    Pos   * Only 1 segment/request
.-------------      ---    ---
.~        DIM       1      1
.OEH      DIM       3      2
OEHSEG01  DIM       3      5     * OECTypeCde
OEHSEG02  DIM       1      8     * SubmissionAuthoriseInd
OEHSEG03  DIM       8      9     * AccidentDate
OEHSEG04  DIM       1      17    * AccidentInd
OEHSEG05  DIM       20     18    * AccountReferenceId
OEHSEG06  DIM       2      38    * ClaimTypeCde
OEHSEG07  DIM       1      40    * EmergencyAdmissionInd
OEHSEG08  DIM       8      41    * FacilityId
OEHSEG09  DIM       3      49    * FundBrandId
OEHSEG10  DIM       3      52    * LengthOfStay
OEHSEG11  DIM       1      55    * PEARequestInd
OEHSEG12  DIM       3      56    * PresentingIllnessCode
OEHSEG13  DIM       5      59    * PresentingIllnessItemNum
OEHSEG14  DIM       8      64    * PrincipalProviderNum
OEHSEG15  DIM       1      72    * SameDayInd
OEHSEG16  DIM       128    73    * SenderContactEmail
OEHSEG17  DIM       40     201   * SenderContactPersonName
OEHSEG18  DIM       19     241   * SenderContactPersonPhone
OEHSEG19  DIM       1      260   * ServiceTypeCde
OEHSEG20  DIM       3      261   * iSOFT report counter
. End of Segment           264
.
. OEV segment       Len    Pos   * Only 1 segment/request
.-------------      ---    ---
.~        DIM       1      1
.OEV      DIM       3      2
OEVSEG01  DIM       8      5     * AdmissionDate
OEVSEG02  DIM       1      13    * CompensationClaimInd
OEVSEG03  DIM       8      14    * DischargeDate
OEVSEG04  DIM       12     22    * FundPayeeId
OEVSEG05  DIM       40     34    * PatientAliasFamilyName
OEVSEG06  DIM       40     74    * PatientAliasFirstName
OEVSEG07  DIM       8      114   * PatientDateOfBirth
OEVSEG08  DIM       40     122   * PatientFamilyName
OEVSEG09  DIM       40     162   * PatientFirstName
OEVSEG10  DIM       19     202   * PatientFundMembershipNum
OEVSEG11  DIM       2      221   * PatientFundUPI
OEVSEG12  DIM       1      223   * PatientGender
OEVSEG13  DIM       10     224   * PatientMedicareCardNum
OEVSEG14  DIM       1      234   * PatientReferenceNum
OEVSEG15  DIM       1      235   * PatientSecondInitial
OEVSEG16  DIM       8      236   * ServicingProviderNum
. End of Segment           244
.
.
. OES segment       Len    Pos   * Maximum of 5 segments/request
.-------------      ---    ---
.~        DIM       1      1
.OES      DIM       3      2
OESSEG01  DIM       1      5     * AfterCareOverrideInd
OESSEG02  DIM       9      6     * ChargeAmount
OESSEG03  DIM       8      15    * DateOfService
OESSEG04  DIM       1      23    * DuplicateServiceOverrideInd
OESSEG05  DIM       1      24    * FieldQuantity
OESSEG06  DIM       5      25    * ItemNum
OESSEG07  DIM       2      30    * NumberOfPatientsSeen
OESSEG08  DIM       1      32    * RestrictionOverrideInd
OESSEG09  DIM       11     33    * ServiceCode
OESSEG10  DIM       1      44    * ServiceCodeTypeCode
OESSEG11  DIM       2      45    * ServiceQuantity
OESSEG12  DIM       9      47    * ServiceRate
OESSEG13  DIM       1      56    * TimeDependantOverrideInd
. End of Segment           57
.
.## Segments for IMC 
.
.
. CLM segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.CLM      DIM       3      2
CLMSEG01  DIM       1      5     * AccidentInd
CLMSEG02  DIM       1      6     * AccountPaidInd
CLMSEG03  DIM      20      7     * AccountReferenceId
CLMSEG04  DIM      30     27     * BankAccountName
CLMSEG05  DIM       9     57     * BankAccountNum
CLMSEG06  DIM       6     66     * BSBCode
CLMSEG07  DIM       1     72     * BenefitAssignmentAuthorised
CLMSEG08  DIM       8     73     * BillingAgentId
CLMSEG09  DIM      40     81     * ClaimantAddressLine1
CLMSEG10  DIM      40    121     * ClaimantAddressLine2
CLMSEG11  DIM      40    161     * ClaimantAddressLocality
CLMSEG12  DIM       4    201     * ClaimantAddressPostcode
CLMSEG13  DIM       8    205     * ClaimantDateOfBirth
CLMSEG14  DIM      40    213     * ClaimantFamilyName
CLMSEG15  DIM      40    253     * ClaimantFirstName
CLMSEG16  DIM      10    293     * ClaimantMedicareCardNum
CLMSEG17  DIM       1    303     * ClaimantReferenceNum
CLMSEG18  DIM       1    304     * ClaimSubmissionAuthorised
CLMSEG19  DIM       2    305     * ClaimTypeCde
CLMSEG20  DIM       8    307     * FacilityId
CLMSEG21  DIM       3    315     * FundBrandId
CLMSEG22  DIM      12    318     * FundPayeeId
CLMSEG23  DIM       8    330     * PrincipalProviderNum
CLMSEG24  DIM      19    338     * SenderContactPersonPhone
CLMSEG25  DIM      40    357     * SenderContactPersonName
. End of Segment         397
.
.
. VCH segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.VCH      DIM       3      2
VCHSEG01  DIM       8      5     * AdmissionDate
VCHSEG02  DIM       1     13     * CompensationClaimInd
VCHSEG03  DIM       8     14     * DischargeDate
VCHSEG04  DIM       1     22     * FinancialInterestDisclosureInd
VCHSEG05  DIM       1     23     * IFCIssueCde
VCHSEG06  DIM      40     24     * PatientAliasFamilyName
VCHSEG07  DIM      40     64     * PatientAliasFirstName
VCHSEG08  DIM       8    104     * PatientDateOfBirth
VCHSEG09  DIM      40    112     * PatientFamilyName
VCHSEG10  DIM      40    152     * PatientFirstName
VCHSEG11  DIM      19    192     * PatientFundMembershipNum
VCHSEG12  DIM       2    211     * PatientFundUPI
VCHSEG13  DIM       1    213     * PatientGender
VCHSEG14  DIM      10    214     * PatientMedicareCardNum
VCHSEG15  DIM       1    224     * PatientReferenceNum
VCHSEG16  DIM       1    225     * PatientSecondInitial
VCHSEG17  DIM       1    226     * ReferralPeriodTypeCde
VCHSEG18  DIM       8    227     * ReferralIssueDate
VCHSEG19  DIM       1    235     * ReferralOverrideTypeCde
VCHSEG20  DIM       2    236     * ReferralPeriod
VCHSEG21  DIM       8    238     * ReferringProviderNum
VCHSEG22  DIM       8    246     * RequestIssueDate
VCHSEG23  DIM       8    254     * RequestingProviderNum
VCHSEG24  DIM       1    262     * RequestTypeCde
VCHSEG25  DIM       1    263     * ServiceTypeCde
VCHSEG26  DIM       8    264     * ServicingProviderNum
. End of Segment         272
.
.
. SRV segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.SRV      DIM       3      2
SRVSEG01  DIM      12      5     * AccessionDateTime
SRVSEG02  DIM       1     17     * AfterCareOverrideInd
SRVSEG03  DIM       9     18     * ChargeAmount
SRVSEG04  DIM      12     27     * CollectionDateTime
SRVSEG05  DIM       8     39     * DateOfService
SRVSEG06  DIM       1     47     * DuplicateServiceOverrideInd
SRVSEG07  DIM       5     48     * EquipmentId
SRVSEG08  DIM       2     53     * FieldQuantity
SRVSEG09  DIM       5     55     * ItemNum
SRVSEG10  DIM       6     60     * LSPNum
SRVSEG11  DIM       1     66     * MultipleProcedureOverrideInd
SRVSEG12  DIM       2     67     * NoOfPatientsSeen
SRVSEG13  DIM       2     69     * RestrictiveOverrideCde
SRVSEG14  DIM       1     71     * Rule3ExemptInd
SRVSEG15  DIM       1     72     * S4B3ExemptInd
SRVSEG16  DIM       5     73     * SCPId
SRVSEG17  DIM       2     78     * SelfDeemedCde
SRVSEG18  DIM      50     80     * ServiceText
SRVSEG19  DIM       3    130     * TimeDuration
SRVSEG20  DIM       4    133     * TimeOfService
. End of Segment         137
.
. ## End if IMC segments
.
.## Segments for PCS
.
.
. CLM segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.CLM      DIM       3      2
CLMSES01  DIM       1      5     * AccountPaidInd
CLMSES02  DIM       9      6     * AccountReferenceId
CLMSES03  DIM      30     15     * BankAccountName
CLMSES04  DIM       9     45     * BankAccountNum
CLMSES05  DIM       6     54     * BSBCode
CLMSES06  DIM      40     60     * ClaimantAddressLine1
CLMSES07  DIM      40    100     * ClaimantAddressLine2          
CLMSES08  DIM      40    140     * ClaimantAddressLocality
CLMSES09  DIM       4    180     * ClaimantAddressPostcode
CLMSES10  DIM       8    184     * ClaimantDateOfBirth  
CLMSES11  DIM      40    192     * ClaimantFamilyName
CLMSES12  DIM      40    232     * ClaimantFirstName
CLMSES13  DIM      10    272     * ClaimantMedicareCardNum
CLMSES14  DIM       1    282     * ClaimantReferenceNum
CLMSES15  DIM       1    283     * ClaimSubmissionAuthorised
CLMSES16  DIM      10    284     * ContactPhoneNum
CLMSES17  DIM       8    294     * DateOfLodgement
CLMSES18  DIM       8    302     * PatientDateOfBirth
CLMSES19  DIM      40    310     * PatientFamilyName
CLMSES20  DIM      40    350     * PatientFirstName
CLMSES21  DIM      10    390     * PatientMedicareCardNum
CLMSES22  DIM       1    400     * PatientReferenceNum
CLMSES23  DIM       8    401     * PayeeProviderNum
CLMSES24  DIM       8    409     * ServicingProviderNum
CLMSES25  DIM       6    417     * TimeOfLodgement
CLMSES26  DIM      24    423     * TransactionId
CLMSES27  DIM      1     447     * Module Emergency (1) or Private Practice (2)
. End of Segment         448

.
. VCH segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.VCH      DIM       3      2
VCHSES01  DIM       8      5     * DateOfService
VCHSES02  DIM       4     13     * TimeOfService
VCHSES03  DIM       1     17     * ReferralOverrideTypeCde    
VCHSES04  DIM       8     18     * ReferringProviderNum or RequestingProviderNum
VCHSES05  DIM       8     26     * ReferralIssueDate or RequestIssueDate 
VCHSES06  DIM       1     34     * ReferralPeriodTypeCde 
VCHSES07  DIM       1     35     * RequestTypeCde 
. End of Segment          36
.
. SRV segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.SRV      DIM       3      2
SRVSES01  DIM      12      5     * AccessionDateTime
SRVSES02  DIM       1     17     * AfterCareOverrideInd
SRVSES03  DIM      12     18     * CollectionDateTime
SRVSES04  DIM       7     30     * ChargeAmount      
SRVSES05  DIM       1     37     * DuplicateServiceOverrideInd
SRVSES06  DIM       5     38     * EquipmentId
SRVSES07  DIM       2     43     * FieldQuantity
SRVSES08  DIM       1     45     * HospitalInd
SRVSES09  DIM       5     46     * ItemNum
SRVSES10  DIM       5     51     * SCPId 
SRVSES11  DIM       6     56     * LSPNum
SRVSES12  DIM       1     62     * MultipleProcedureOverrideInd
SRVSES13  DIM       2     63     * NoOfPatientsSeen
SRVSES14  DIM       7     65     * PatientContribAmt
SRVSES15  DIM       2     72     * RestrictiveOverrideCde 
SRVSES16  DIM       1     74     * Rule3ExemptInd 
SRVSES17  DIM       1     75     * S4b3ExemptInd
SRVSES18  DIM       2     76     * SelfDeemedCde
SRVSES19  DIM      50     78     * ServiceText
SRVSES20  DIM       3    128     * TimeDuration 
. End of Segment         131
.
. ## End if PCS segments
.
. ## Segments for DBS
.
. CLM segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.CLM      DIM       3      2
CLMSEB01  DIM       8      5     * AuthorisationDate
CLMSEB02  DIM       6     13     * PmsClaimId
CLMSEB03  DIM       8     19     * ServicingProviderNum
CLMSEB04  DIM       8     27     * PayeeProviderNum
CLMSEB05  DIM       1     35     * ServiceTypeCde
CLMSEB06  DIM      24     36     * TransactionId
CLMSEB07  DIM       9     60     * AccountReferenceId
CLMSEB08  DIM       1     69     * Module
.                                    1 = Emergency
.                                    2 = Private Practice
.                                    3 = Outpatient
. End of Segment          70
.
.
. VCH segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.VCH      DIM       3      2
VCHSEB01  DIM       1      5     * BenefitAssignmentAuthorised
VCHSEB02  DIM       8      6     * DateOfService
VCHSEB03  DIM       8     14     * PatientDateOfBirth
VCHSEB04  DIM      40     22     * PatientFamilyName
VCHSEB05  DIM      40     62     * PatientFirstName
VCHSEB06  DIM      10    102     * PatientMedicareCardNum
VCHSEB07  DIM       1    112     * PatientReferenceNum
VCHSEB08  DIM       1    113     * ReferralOverrideTypeCde
VCHSEB09  DIM       8    114     * ReferringProviderNum/RequestingProviderNum
VCHSEB10  DIM       8    122     * ReferralIssueDate/RequestIssueDate
VCHSEB11  DIM       1    130     * ReferralPeriodTypeCde
VCHSEB12  DIM       1    131     * RequestTypeCde
VCHSEB13  DIM       4    132     * TimeOfService
. End of Segment         136
.
.
. SRV segment       Len    Pos
.-------------      ---    ---
.~        DIM       1      1
.SRV      DIM       3      2
SRVSEB01  DIM      12      5     * AccessionDateTime
SRVSEB02  DIM       1     17     * AfterCareOverrideInd
SRVSEB03  DIM       7     18     * ChargeAmount
SRVSEB04  DIM      12     25     * CollectionDateTime
SRVSEB05  DIM       1     37     * DuplicateServiceOverrideInd
SRVSEB06  DIM       5     38     * EquipmentId
SRVSEB07  DIM       2     43     * FieldQuantity
SRVSEB08  DIM       1     45     * HospitalInd
SRVSEB09  DIM       5     46     * ItemNum
SRVSEB10  DIM       5     51     * SCPId
SRVSEB11  DIM       6     56     * LSPNum
SRVSEB12  DIM       1     62     * MultipleProcedureOverrideInd
SRVSEB13  DIM       2     63     * NoOfPatientsSeen
SRVSEB14  DIM       2     65     * RestrictiveOverrideCde
SRVSEB15  DIM       1     67     * Rule3ExemptInd
SRVSEB16  DIM       1     68     * S4B3ExemptInd
SRVSEB17  DIM       2     69     * SelfDeemedCde
SRVSEB18  DIM      50     71     * ServiceText
SRVSEB19  DIM       3    121     * TimeDuration
. End of Segment         124
.
. ## End if DBS segments
.
. Program Constants
. *****************
FIVE9     FORM      "59"
SEVEN9    FORM      "79"
NBSP      INIT      "&nbsp;"
+
.-----------------------------------------------------------------------------
.
PRGID     INIT      "PATWEB62"
VERSION   INIT      "V12.00.00"
PRGNAM    INIT      "System Maintenance Server"
+
.------------------------------------------------------------------------------
.
          CALL      WEBINT00                * Initialise Fifo Etc.
          CALL      INIT0000                * Open Files
.
MAIN1000  CALL      WEBRED00                * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO          * End Server Process if Option=999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00                * Output File & Write HTML Pg Header
          GOTO      MAIN1000
.
MAIN1100  CALL      UNLKPG00                * Unlock Maintenance program
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000                * next page
          GOTO      MAIN1000
. 
MAIN1200  CALL      REMULK00                * Remote Script Unlock program
          GOTO      MAIN1000
. 
MAIN1300  CALL      ECLAIM00                * Display Eclipse - claim files 
          GOTO      MAIN1000
. 
MAIN1400  CALL      REUPDF00                * Remote Script for Printer ibapdfaf
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
+
.------------------------------------------------------------------------------
.  Next Page URL
.------------------------------------------------------------------------------
.
NXTPG000  IF        NEXTPAGE=0
            CALL      WINCLS00              * Refresh parent and close window
          ENDIF

          IF        NEXTPAGE=1
            CALL      RDIREC00              * Redirect URL
          ENDIF
.
          IF        NEXTPAGE=2
            CALL      GOBACK00              * Go Back 1 html page
          ENDIF
.
          IF        NEXTPAGE=3
            CALL      DAH20000              * Go Back 2 html pages
          ENDIF
.
NXTPG999  RETURN
.------------------------------------------------------------------------------
.  Goes back 1 page
.------------------------------------------------------------------------------
.
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"

          CALL      CLOSHTML
.
GOBACK99  RETURN
+
.------------------------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------------------------
.
INIT0000  OPEN      WEBSECA1,"websecaf"
          OPEN      WEBSECA3,"websecaf"
.
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      IBAPDFA1,"ibapdfaf"
.
.-------------------------------------------------------------------------------
. Open and Read the Control file variables
.-------------------------------------------------------------------------------
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND23;*122,PTCNECUP
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
          CLOCK     PID,TFNPID
          SQUEEZE   TFNPID
.
INIT9999  RETURN
+
.------------------------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------------------------
.
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          PACK      FILEPATH,SP70,SP70
          MOVE      SP70,ECLMFILE
          MOVE      SP70,REPTNUMB
          MOVE      SP70,PROGNAME
          MOVE      SP70,PRNTCODE
.
CLRPAR99  RETURN
+
.------------------------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------------------------
.
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filepath=",QRYNAME 
          IF        @EQUAL
            MOVE      QRYDATA,FILEPATH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "eclmfile=",QRYNAME 
          IF        @EQUAL
            MOVE      QRYDATA,ECLMFILE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "progname=",QRYNAME 
          IF        @EQUAL
            MOVE      QRYDATA,PROGNAME
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "reptnumb=",QRYNAME 
          IF        @EQUAL
            MOVE      QRYDATA,REPTNUMB
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prntcode=",QRYNAME 
          IF        @EQUAL
            MOVE      QRYDATA,PRNTCODE
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------------------------
. Clear Web Program Locking
.------------------------------------------------------------------------------
.
UNLKPG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      UNLKPG40 IF EQUAL
.
          MATCH     "T",UPDTTYPE            * Unlock Theatre Fee File Main.
          GOTO      UNLKPG11 IF EQUAL
.
          MATCH     "B",UPDTTYPE            * Unlock Bed Fee File Main.
          GOTO      UNLKPG12 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Unlock DRG Fee File Main.
          GOTO      UNLKPG13 IF EQUAL
.
          MATCH     "M",UPDTTYPE            * Unlock Misc. Charge File Main.
          GOTO      UNLKPG14 IF EQUAL
.
          MATCH     "R",UPDTTYPE            * Unlock Rates Table Main.
          GOTO      UNLKPG15 IF EQUAL
.
          MATCH     "I",UPDTTYPE            * Unlock Mbs/Item File Main.
          GOTO      UNLKPG16 IF EQUAL
.
          MATCH     "S",UPDTTYPE            * Unlock Stationery Template Main.
          GOTO      UNLKPG17 IF EQUAL
.
          MATCH     "V",UPDTTYPE            * Unlock Template Variable Main.
          GOTO      UNLKPG18 IF EQUAL
.
          MATCH     "M",UPDTTYPE            * Unlock Misc. Charge File Main.
          GOTO      UNLKPG14 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Unlock Cash Release Program
          GOTO      UNLKPG19 IF EQUAL
.
          MATCH     "F",UPDTTYPE            * Unlock Final Cash Reconciliation
          GOTO      UNLKPG20 IF EQUAL
.
          GOTO      UNLKPG91
.
.
UNLKPG11  PACK      PTCNTFEM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*1,PTCNTFEM 
          MOVE      SP10,PTCNWTFE
          WRITAB    CONTROLF,HUND10;*1,PTCNWTFE
          GOTO      UNLKPG99
.
UNLKPG12  PACK      PTCNBFEM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*3,PTCNBFEM 
          MOVE      SP10,PTCNWBFE
          WRITAB    CONTROLF,HUND10;*11,PTCNWBFE
          GOTO      UNLKPG99
.
UNLKPG13  PACK      PTCNDRGM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*13,PTCNDRGM 
          MOVE      SP10,PTCNWDRG
          WRITAB    CONTROLF,HUND10;*21,PTCNWDRG
          GOTO      UNLKPG99
.
UNLKPG14  PACK      PTCNMCHM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*15,PTCNMCHM 
          MOVE      SP10,PTCNWMCH
          WRITAB    CONTROLF,HUND10;*31,PTCNWMCH
          GOTO      UNLKPG99
.
UNLKPG15  PACK      PTCNRATM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*17,PTCNRATM 
          MOVE      SP10,PTCNWRAT
          WRITAB    CONTROLF,HUND10;*41,PTCNWRAT
          GOTO      UNLKPG99
.
UNLKPG16  PACK      PTCNITMM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*21,PTCNITMM 
          MOVE      SP10,PTCNWITM
          WRITAB    CONTROLF,HUND10;*51,PTCNWITM
          GOTO      UNLKPG99
.
UNLKPG17  PACK      IBCNTMDM,ZERO,ZERO
          WRITAB    CONTROLF,ZERO;*81,IBCNTMDM 
          MOVE      SP10,IBCNWTMD
          WRITAB    CONTROLF,ZERO;*112,IBCNWTMD
          GOTO      UNLKPG99
.
UNLKPG18  PACK      IBCNVARM,ZERO,ZERO
          WRITAB    CONTROLF,ZERO;*83,IBCNVARM 
          MOVE      SP10,IBCNWVAR
          WRITAB    CONTROLF,ZERO;*122,IBCNWVAR
          GOTO      UNLKPG99
.
UNLKPG19  PACK      RCCNCSHL,ZERO,ZERO
          WRITAB    CONTROLF,HUND08;*97,RCCNCSHL
          MOVE      SP10,RCCNCSHU
          WRITAB    CONTROLF,HUND08;*99,RCCNCSHU
          GOTO      UNLKPG99
.
UNLKPG20  PACK      RCCNRCNL,ZERO,ZERO
          WRITAB    CONTROLF,HUND08;*112,RCCNRCNL
          MOVE      SP10,RCCNRCNW
          WRITAB    CONTROLF,HUND08;*114,RCCNRCNW
          GOTO      UNLKPG99
.
.         ************ DISPLAY FORMACTION **********
.
UNLKPG40  CLEAR     WEBTITLE
          MOVE      "Clear Web Program Locking",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,UNLKPG99
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      UNLKPG99
.
.         ************ DISPLAY ERROR MESSAGE **********
.
UNLKPG91  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UNLKPG99
.
UNLKPG99  RETURN
+
.------------------------------------------------------------------------------
. Process Fields called from WEBBOD00
.------------------------------------------------------------------------------
.
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD99,PROFLD30
.
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11
          GOTO      PROFLD99
.
PROFLD11  CALL      CLLK0000                * Clear Program Locking          
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31                       
          GOTO      PROFLD99
.
PROFLD31  CALL      EFLDS000
          GOTO      PROFLD99
.
                 
PROFLD99  RETURN
+
.------------------------------------------------------------------------------
. Clear Program Locking Maintenance
.------------------------------------------------------------------------------
.
CLLK0000  BRANCH    FLDITMNO,CLLK0100,CLLK0200,CLLK0300,CLLK0400,CLLK0500:
                             CLLK0600,CLLK0700,CLLK0800,CLLK0900,CLLK1000
          GOTO      CLLK9999
.
CLLK0100  READ      CONTROLF,SEVEN9;*1,PTCNTFEM   * IBABIL14 Port No. Locking 
          READ      CONTROLF,HUND10;*1,PTCNWTFE   * IBABIL14 Web Userid Locking
          MOVE      PTCNTFEM,PORTLOCK
          MOVE      PTCNWTFE,WUSRLOCK
          CALL      GTLWU000
          GOTO      CLLK9999
.
CLLK0200  READ      CONTROLF,SEVEN9;*3,PTCNBFEM   * IBABIL56 Port No. Locking
          READ      CONTROLF,HUND10;*11,PTCNWBFE  * IBABIL56 Web Userid Locking
          MOVE      PTCNBFEM,PORTLOCK
          MOVE      PTCNWBFE,WUSRLOCK
          CALL      GTLWU000
          GOTO      CLLK9999
.
CLLK0300  READ      CONTROLF,SEVEN9;*13,PTCNDRGM  * IBAPMS40 Port No. Locking
          READ      CONTROLF,HUND10;*21,PTCNWDRG  * IBAPMS40 Web Userid Locking
          MOVE      PTCNDRGM,PORTLOCK
          MOVE      PTCNWDRG,WUSRLOCK
          CALL      GTLWU000
          GOTO      CLLK9999
.
CLLK0400  READ      CONTROLF,SEVEN9;*15,PTCNMCHM   * IBAHOS10 Port No. Locking
          READ      CONTROLF,HUND10;*31,PTCNWMCH   * IBAHOS10 Web Userid Locking
          MOVE      PTCNMCHM,PORTLOCK
          MOVE      PTCNWMCH,WUSRLOCK
          CALL      GTLWU000
          GOTO      CLLK9999
.
CLLK0500  READ      CONTROLF,SEVEN9;*17,PTCNRATM   * IBAHOS60 Port No. Locking
          READ      CONTROLF,HUND10;*41,PTCNWRAT   * IBAHOS60 Web Userid Locking
          MOVE      PTCNRATM,PORTLOCK
          MOVE      PTCNWRAT,WUSRLOCK
          CALL      GTLWU000
          GOTO      CLLK9999
.
CLLK0600  READ      CONTROLF,SEVEN9;*21,PTCNITMM  * IBAPAT14 Port No. Locking 
          READ      CONTROLF,HUND10;*51,PTCNWITM  * IBAPAT14 Web Userid Locking
          MOVE      PTCNITMM,PORTLOCK
          MOVE      PTCNWITM,WUSRLOCK
          CALL      GTLWU000
          GOTO      CLLK9999
.
CLLK0700  READ      CONTROLF,ZERO;*81,IBCNTMDM:  * IBATEM01 Port No. Locking
                                  *112,IBCNWTMD  * IBATEM01 Web Userid Locking
          MOVE      IBCNTMDM,PORTLOCK
          MOVE      IBCNWTMD,WUSRLOCK
          CALL      GTLWU000
          GOTO      CLLK9999
.
CLLK0800  READ      CONTROLF,ZERO;*83,IBCNVARM:  * IBATEM02 Port No. Locking
                                  *122,IBCNWVAR  * IBATEM02 Web Userid Locking
          MOVE      IBCNVARM,PORTLOCK
          MOVE      IBCNWVAR,WUSRLOCK
          CALL      GTLWU000
          GOTO      CLLK9999
.
CLLK0900  READ      CONTROLF,HUND08;*97,RCCNCSHL: * IBARCP76 Port No. Locking
                                    *99,RCCNCSHU  * IBARCP76 Web Userid Locking
          MOVE      RCCNCSHL,PORTLOCK
          MOVE      RCCNCSHU,WUSRLOCK
          CALL      GTLWU000
          GOTO      CLLK9999
.
CLLK1000  READ      CONTROLF,HUND08;*112,RCCNRCNL: * IBARCP02 Port No. Locking
                                    *114,RCCNRCNW  * IBARCP02 Web Userid Locking
          MOVE      RCCNRCNL,PORTLOCK
          MOVE      RCCNRCNW,WUSRLOCK
          CALL      GTLWU000
          GOTO      CLLK9999
.
CLLK9999  RETURN
+
.------------------------------------------------------------------------------
. Get Locking Web user             
.------------------------------------------------------------------------------
.
GTLWU000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GTLWU100,GTLWU200,GTLWU300,GTLWU400
.
GTLWU100  MATCH     SP10,WUSRLOCK
          GOTO      GTLWU999 IF EQUAL
.
          WRITE     HTMLFILE;WUSRLOCK;        
          GOTO      GTLWU999
.
GTLWU200  MATCH     SP10,WUSRLOCK
          GOTO      GTLWU291 IF EQUAL
.
          PACK      KEY10,WUSRLOCK,SP10
          CALL      RDWBSE1
          BRANCH    OVRCD,GTLWU210
          GOTO      GTLWU220 
.
GTLWU210  MOVE      "Unknown User",WBSENAM
.
GTLWU220  CLEAR     KEY60
          APPEND    "Web: ",KEY60
          APPEND    WUSRLOCK,KEY60
          APPEND    " - ",KEY60
          APPEND    WBSENAM,KEY60
          RESET     KEY60
          WRITE     HTMLFILE;KEY60;
          GOTO      GTLWU999
.
GTLWU291  WRITE     HTMLFILE;"&nbsp";
          GOTO      GTLWU999
.
GTLWU300  MATCH     SP10,PORTLOCK
          GOTO      GTLWU999 IF EQUAL
          MATCH     "00",PORTLOCK
          GOTO      GTLWU999 IF EQUAL
.
          WRITE     HTMLFILE;PORTLOCK;        
          GOTO      GTLWU999
.
GTLWU400  MATCH     SP10,PORTLOCK
          GOTO      GTLWU491 IF EQUAL
          MATCH     "00",PORTLOCK
          GOTO      GTLWU491 IF EQUAL
.
GTLWU420  CLEAR     KEY60
          APPEND    "Port: ",KEY60
          APPEND    PORTLOCK,KEY60
          RESET     KEY60
          WRITE     HTMLFILE;KEY60;
          GOTO      GTLWU999
.
GTLWU491  WRITE     HTMLFILE;"&nbsp";
          GOTO      GTLWU999
.
GTLWU999  RETURN
.
.------------------------------------------------------------
. Remote Script to unlock program
.------------------------------------------------------------
REMULK00  CALL      XMLHED00
          BRANCH    EXIT,REMULK99
.
          MATCH     SP1,UPDTTYPE            * Error no program to unlock
          GOTO      REMULK90 IF EQUAL
.
          MATCH     "T",UPDTTYPE            * Unlock Theatre Fee File Main.
          GOTO      REMULK10 IF EQUAL
.
          MATCH     "B",UPDTTYPE            * Unlock Bed Fee File Main.
          GOTO      REMULK11 IF EQUAL
.
          MATCH     "M",UPDTTYPE            * Unlock Misc. Charge File Main.
          GOTO      REMULK12 IF EQUAL
.
          MATCH     "I",UPDTTYPE            * Unlock Mbs/Item File Main.
          GOTO      REMULK13 IF EQUAL
.
          MATCH     "S",UPDTTYPE            * Unlock Stationery Template Main.
          GOTO      REMULK14 IF EQUAL
.
          MATCH     "V",UPDTTYPE            * Unlock Template Variable Main.
          GOTO      REMULK15 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Unlock Template Variable Main.
          GOTO      REMULK16 IF EQUAL
.
          GOTO      REMULK90
.
REMULK10  PACK      PTCNTFEM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*1,PTCNTFEM
          MOVE      SP10,PTCNWTFE
          WRITAB    CONTROLF,HUND10;*1,PTCNWTFE
          GOTO      REMULK80
.
REMULK11  PACK      PTCNBFEM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*3,PTCNBFEM
          MOVE      SP10,PTCNWBFE
          WRITAB    CONTROLF,HUND10;*11,PTCNWBFE
          GOTO      REMULK80
.
REMULK12  PACK      PTCNMCHM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*15,PTCNMCHM
          MOVE      SP10,PTCNWMCH
          WRITAB    CONTROLF,HUND10;*31,PTCNWMCH
          GOTO      REMULK80
.
REMULK13  PACK      PTCNITMM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*21,PTCNITMM
          MOVE      SP10,PTCNWITM
          WRITAB    CONTROLF,HUND10;*51,PTCNWITM
          GOTO      REMULK80
.
REMULK14  PACK      IBCNTMDM,ZERO,ZERO
          WRITAB    CONTROLF,ZERO;*81,IBCNTMDM
          MOVE      SP10,IBCNWTMD
          WRITAB    CONTROLF,ZERO;*112,IBCNWTMD
          GOTO      REMULK80
.
REMULK15  PACK      IBCNVARM,ZERO,ZERO
          WRITAB    CONTROLF,ZERO;*83,IBCNVARM
          MOVE      SP10,IBCNWVAR
          WRITAB    CONTROLF,ZERO;*122,IBCNWVAR
          GOTO      REMULK80
.
REMULK16  PACK      RCCNCSHL,ZERO,ZERO
          WRITAB    CONTROLF,HUND08;*97,RCCNCSHL
          MOVE      SP10,RCCNCSHU
          WRITAB    CONTROLF,HUND08;*99,RCCNCSHU
          GOTO      REMULK80
.
REMULK80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "OK":
                             "</RETURN_VALUE>"
          GOTO      REMULK98
.
REMULK90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Error unlocking program - ":
                             UPDTTYPE,"</RETURN_VALUE>"
          GOTO      REMULK98
.
REMULK98  CALL      XMLEND00
REMULK99  RETURN
.
.------------------------------------------------------------
. E-claim file display                
.------------------------------------------------------------
ECLAIM00  CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      "Eclipse File Browse",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,ECLAIM99
          CALL      WEBBOD00
          CALL      WEBEND00

ECLAIM99  RETURN
.
.------------------------------------------------------------
. Remote Script to printer selection
.------------------------------------------------------------
REUPDF00  CALL      XMLHED00
          BRANCH    EXIT,REUPDF99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
          MOVE      REPTNUMB,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          PACK      KEY20,PROGNAME,KEY2,WBSEUID,SP70
          UNPACK    KEY20,IBPDPID,IBPDREP,IBPDUID
.
          MOVE      PRNTCODE,IBPDPRT         * Printer
          MOVE      ONE,IBPDCOP              * Number of copies
          MOVE      SP70,IBPDDOC             * Form name
          MOVE      SP70,IBPDNUM                 * Label number
.
          MOVE      SP70,IBPDSPA
          CALL      RAIBPD1
          IF        OVRCD=0
            CALL      UPIBPD1
          ELSE
            CALL      WRIBPD1
          ENDIF
.
          WRITE     HTMLFILE;"</RETURN_VALUE>";
          CALL      XMLEND00
.
REUPDF99  RETURN
+
.------------------------------------------------------------------------------
. Eclipse file Fields 
.------------------------------------------------------------------------------
EFLDS000  BRANCH    FLDITMNO,EFLDS010,EFLDS020,EFLDS030,EFLDS040,EFLDS050:
                             EFLDS999,EFLDS070,EFLDS080,EFLDS090,EFLDS100:
                             EFLDS110,EFLDS120,EFLDS130,EFLDS140,EFLDS150:
                             EFLDS160,EFLDS170,EFLDS180
          GOTO      EFLDS999
.
EFLDS010  CALL      CLMFLS00                     * list of IHC files
          GOTO      EFLDS999
. 
EFLDS020  WRITE     HTMLFILE;ECLMFILE
          GOTO      EFLDS999
. 
EFLDS030  CALL      IHCFIL00                     * build IHC file display
          GOTO      EFLDS999
. 
EFLDS040  READ      CONTROLF,HUND16;*1,PTCNECLI  * directory for IHC files
          WRITE     HTMLFILE;PTCNECLI
          GOTO      EFLDS999
. 
EFLDS050  CALL      OECFLS00
          GOTO      EFLDS999
. 
EFLDS070  CALL      OECFIL00                     * build elig check file display
          GOTO      EFLDS999
. 
EFLDS080  READ      CONTROLF,HUND17;*61,PTCNOECI  * directory for  OEC files
          WRITE     HTMLFILE;PTCNOECI
          GOTO      EFLDS999
. 
EFLDS090  READ      CONTROLF,HUND17;*145,PTCNECSA  * Eclipse SA Console URL    
          WRITE     HTMLFILE;PTCNECSA
          GOTO      EFLDS999
. 
EFLDS100  CALL      IMCFLS00                     * build IMC file list
          GOTO      EFLDS999
. 
EFLDS110  CALL      IMCFIL00                     * build IMC file display      
          GOTO      EFLDS999
. 
EFLDS120  READ      CONTROLF,HUND19;*61,PTCNIMCI * directory for OEC files
          WRITE     HTMLFILE;PTCNIMCI
          GOTO      EFLDS999
.
EFLDS130  CALL      STFFLS00                     * build STF file list
          GOTO      EFLDS999
.
EFLDS140  CALL      STFFIL00                     * build STF file display
          GOTO      EFLDS999
.
EFLDS150  READ      CONTROLF,HUND27;*61,PTCNESFI * directory for STF files
          WRITE     HTMLFILE;PTCNESFI
          GOTO      EFLDS999
.
EFLDS160  CALL      DBSFLS00                     * build DBS file list
          GOTO      EFLDS999
.
EFLDS170  CALL      DBSFIL00                     * build DBS file display
          GOTO      EFLDS999
.
EFLDS180  READ      CONTROLF,HUND27;*183,PTCNEDBI * directory for DBS files
          WRITE     HTMLFILE;PTCNEDBI
          GOTO      EFLDS999
. 
EFLDS999  RETURN
.------------------------------------------------------------------------------
. Get Eclipse Claim file list
.------------------------------------------------------------------------------
CLMFLS00  CLEAR     TFILENM                      * set up temp file name 
          APPEND    "tweb62.",TFILENM
          APPEND    TFNPID,TFILENM
          APPEND    ".txt",TFILENM
          RESET     TFILENM
          CLEAR     EXECCMD
          APPEND    "ls -1t ",EXECCMD            * set up ls command
.                                                * (note it's reverse date order)
.                                 * now get the name of the output directory
          READ      CONTROLF,HUND16;*1,PTCNECLI
          SQUEEZE   PTCNECLI
          MOVELPTR  PTCNECLI,F3                  * get length of output dir string
          IF        F3 > 0
            SUBTRACT  ONE,F3
            BUMP      PTCNECLI,F3                * go to last char of string
            CMATCH    "/",PTCNECLI               * is last char a '/'?
            GOTO      CLMFLS10 IF EQUAL
            APPEND    "/",PTCNECLI
          ENDIF
.
CLMFLS10  RESET     PTCNECLI
          SQUEEZE   PTCNECLI
          MOVELPTR  PTCNECLI,F3             * get length of output dir string
.
          APPEND    PTCNECLI,EXECCMD
          APPEND    "*.txt > ",EXECCMD
          APPEND    TFILENM,EXECCMD
          RESET     EXECCMD
          EXECUTE   EXECCMD,TASKID
.
          MOVELPTR  PTCNECLI,F3                  * get length of target dir
.
          MOVE      ZERO,FILECNT 
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FILELIST,TFILENM          
          TRAPCLR   IO
          BRANCH    OVRCD,CLMFLS90
.
CLMFLS20  PACK      FILEPATH,SP70,SP70
          READ      FILELIST,SEQ;FILEPATH
          GOTO      CLMFLS90 IF OVER
.         
          BUMP      FILEPATH,F3
          MOVE      FILEPATH,DIM19
.
          RESET     FILEPATH
          MOVELPTR  DIM19,F2                * strip off '.txt'
          SUBTRACT  FOUR,F2
          SETLPTR   DIM19,F2 
          STRIP     FILEPATH
          MOVE      DIM19,DIM8 
.
          WRITE     HTMLFILE;*+,"<a class=#"linkbox#"":
                    " href=#"patweb62.pbl?reportno=3&template=2":
                    "&eclmfile=",DIM8: 
                    "&filepath=",FILEPATH:
                    "#">",DIM8,"</a>"
          ADD       ONE,FILECNT
          GOTO      CLMFLS20          
. 
CLMFLS90  CLOSE     FILELIST,DELETE
          MOVE      FILECNT,SEGNO 
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;*+,"<div class=#"hdrbox#">",SEGNO:
                             " files found.</div>"
.
CLMFLS99  RETURN
.
.------------------------------------------------------------------------------
. Get Eclipse Eligibility Check file list
.------------------------------------------------------------------------------
OECFLS00  CLEAR     TFILENM                      * set up temp file name 
          APPEND    "tweb62.",TFILENM
          APPEND    TFNPID,TFILENM
          APPEND    ".txt",TFILENM
          RESET     TFILENM
          CLEAR     EXECCMD
          APPEND    "ls -1t ",EXECCMD            * set up ls command
.                                                * (note it's reverse date order)
.                                 * now get the name of the output directory
          READ      CONTROLF,HUND17;*61,PTCNOECI
          SQUEEZE   PTCNOECI
          MOVELPTR  PTCNOECI,F3                  * get length of output dir string
          IF        F3 > 0
            SUBTRACT  ONE,F3
            BUMP      PTCNOECI,F3                * go to last char of string
            CMATCH    "/",PTCNOECI               * is last char a '/'?
            GOTO      OECFLS10 IF EQUAL
            APPEND    "/",PTCNOECI
          ENDIF
.
OECFLS10  RESET     PTCNOECI
          SQUEEZE   PTCNOECI
          MOVELPTR  PTCNOECI,F3             * get length of output dir string
.
          APPEND    PTCNOECI,EXECCMD
          APPEND    "*.txt > ",EXECCMD
          APPEND    TFILENM,EXECCMD
          RESET     EXECCMD
          EXECUTE   EXECCMD,TASKID
.
          MOVELPTR  PTCNOECI,F3                  * get length of target dir
.
          MOVE      ZERO,FILECNT 
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FILELIST,TFILENM          
          TRAPCLR   IO
          BRANCH    OVRCD,OECFLS90
.
OECFLS20  PACK      FILEPATH,SP70,SP70
          READ      FILELIST,SEQ;FILEPATH
          GOTO      OECFLS90 IF OVER
.         
          BUMP      FILEPATH,F3
          MOVE      FILEPATH,DIM19
.
          RESET     FILEPATH
          MOVELPTR  DIM19,F2                * strip off '.txt'
          SUBTRACT  FOUR,F2
          SETLPTR   DIM19,F2 
          STRIP     FILEPATH
          MOVE      DIM19,DIM12
.
          WRITE     HTMLFILE;*+,"<a class=#"linkbox#"":
                    " href=#"patweb62.pbl?reportno=3&template=4":
                    "&eclmfile=",DIM12:
                    "&filepath=",FILEPATH:
                    "#">",DIM12,"</a>"
          ADD       ONE,FILECNT
          GOTO      OECFLS20          
. 
OECFLS90  CLOSE     FILELIST,DELETE
          MOVE      FILECNT,SEGNO 
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;*+,"<div class=#"hdrbox#">",SEGNO:
                             " files found.</div>"
.
OECFLS99  RETURN
.
.------------------------------------------------------------------------------
. Get Eclipse Inpatient Medical Claim (IMC)   file list
.------------------------------------------------------------------------------
IMCFLS00  CLEAR     TFILENM                      * set up temp file name 
          APPEND    "tweb62.",TFILENM
          APPEND    TFNPID,TFILENM
          APPEND    ".txt",TFILENM
          RESET     TFILENM
          CLEAR     EXECCMD
          APPEND    "ls -1t ",EXECCMD            * set up ls command
.                                                * (note it's reverse date order)
.                                 * now get the name of the output directory
          READ      CONTROLF,HUND19;*61,PTCNIMCI
          SQUEEZE   PTCNIMCI
          MOVELPTR  PTCNIMCI,F3                  * get length of output dir string
          IF        F3 > 0
            SUBTRACT  ONE,F3
            BUMP      PTCNIMCI,F3                * go to last char of string
            CMATCH    "/",PTCNIMCI               * is last char a '/'?
            GOTO      IMCFLS10 IF EQUAL
            APPEND    "/",PTCNIMCI
          ENDIF
.
IMCFLS10  RESET     PTCNIMCI
          SQUEEZE   PTCNIMCI
          MOVELPTR  PTCNIMCI,F3                  * get length of output dir string
.
          APPEND    PTCNIMCI,EXECCMD
          APPEND    "*.txt > ",EXECCMD
          APPEND    TFILENM,EXECCMD
          RESET     EXECCMD
          EXECUTE   EXECCMD,TASKID
.
          MOVELPTR  PTCNIMCI,F3                  * get length of target dir
.
          MOVE      ZERO,FILECNT 
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FILELIST,TFILENM          
          TRAPCLR   IO
          BRANCH    OVRCD,IMCFLS90
.
IMCFLS20  PACK      FILEPATH,SP70,SP70
          READ      FILELIST,SEQ;FILEPATH
          GOTO      IMCFLS90 IF OVER
.         
          BUMP      FILEPATH,F3
          MOVE      FILEPATH,DIM19
.
          RESET     FILEPATH
          MOVELPTR  DIM19,F2                * strip off '.txt'
          SUBTRACT  FOUR,F2
          SETLPTR   DIM19,F2 
          STRIP     FILEPATH
          MOVE      DIM19,DIM12
.
          WRITE     HTMLFILE;*+,"<a class=#"linkbox#"":
                    " href=#"patweb62.pbl?reportno=3&template=8":
                    "&eclmfile=",DIM12:
                    "&filepath=",FILEPATH:
                    "#">",DIM12,"</a>"
          ADD       ONE,FILECNT
          GOTO      IMCFLS20          
. 
IMCFLS90  CLOSE     FILELIST,DELETE
          MOVE      FILECNT,SEGNO 
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;*+,"<div class=#"hdrbox#">",SEGNO:
                             " files found.</div>"
.
IMCFLS99  RETURN
.
.------------------------------------------------------------------------------
. Process Claim File
.------------------------------------------------------------------------------
IHCFIL00  WRITE     HTMLFILE;"<div id=#"col1#">",012

          MOVE      ZERO,CLMCOUNT                     * clear counters
          MOVE      ZERO,SEGCOUNT
. 
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EXTRFILE,FILEPATH,RDONLY
          TRAPCLR   IO
          IF        OVRCD = 1
            STRIP     FILEPATH
            WRITE     HTMLFILE;*+,"<p class=#"Red#"><strong>Error: </strong>":
                               "File ",FILEPATH," not found.</p>"
            GOTO      IHCFIL99
          ENDIF
.
          CALL      P1IHC000                          * first pass of claim file
          CLOSE     EXTRFILE
          OPEN      EXTRFILE,FILEPATH,RDONLY
          MOVE      ZERO,SEGCOUNT
          CALL      P2IHC000                          * second pass of claim file
.
          CLOSE     EXTRFILE
.
IHCFIL99  WRITE    HTMLFILE;"</div>",012
          RETURN
.
.------------------------------------------------------------------------------
. First pass of Claim File
.------------------------------------------------------------------------------
P1IHC000  READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          GOTO      P1IHC999 IF OVER
.
          ADD       ONE,SEGCOUNT                     * count the segment
          MATCH     "HDR",SEGMENT
          GOTO       P1IHC000 IF EQUAL               * ignore header  segments
.
          MATCH     "TLR",SEGMENT
          GOTO       P1IHC000 IF EQUAL               * ignore trailer segments
.
          MATCH     "CID",SEGMENT
          IF        @EQUAL
            CALL      IHCBLK00                       * build the claim block 
            GOTO      P1IHC000
          ENDIF  
.
          MOVE      SEGCOUNT,SEGNO                   * just link to the segment
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ": 
                    " onmouseover=#"showseg(this)#">",SEGMENT,"</div><br />",012
          GOTO     P1IHC000
.
P1IHC999  RETURN    
.
.------------------------------------------------------------------------------
. Second  pass of Claim File
.------------------------------------------------------------------------------
P2IHC000  READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          GOTO      P2IHC999 IF OVER
.
          ADD       ONE,SEGCOUNT                     * count the segment
          MATCH     "HDR",SEGMENT
          GOTO       P2IHC000 IF EQUAL               * ignore header  segments
.
          MATCH     "TLR",SEGMENT
          GOTO       P2IHC000 IF EQUAL               * ignore trailer segments
.
          MOVE      SEGCOUNT,SEGNO                   * write the div header     
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;"<div class=#"nodisplay#" id=#"seg",SEGNO,"#">":
                    012,"<table class=#"segment#">",012:
                    "<tr><th>Segment</th><td>",SEGMENT,"</td></tr>",012
.
          MATCH     "ACS",SEGMENT
          IF        @EQUAL
            CALL      SEGACS00                       * build the ACS segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "ACD",SEGMENT
          IF        @EQUAL
            CALL      SEGACD00                       * build the ACD segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "AFS",SEGMENT
          IF        @EQUAL
            CALL      SEGAFS00                       * build the AFS segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "ANB",SEGMENT
          IF        @EQUAL
            CALL      SEGANB00                       * build the ANB segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "CCG",SEGMENT
          IF        @EQUAL
            CALL      SEGCCG00                       * build the CCG segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "CER",SEGMENT
          IF        @EQUAL
            CALL      SEGCER00                       * build the CER segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "CID",SEGMENT
          IF        @EQUAL
            CALL      SEGCID00                       * build the CID segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "DFS",SEGMENT
          IF        @EQUAL
            CALL      SEGDFS00                       * build the DFS segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "DMG",SEGMENT
          IF        @EQUAL
            CALL      SEGDMG00                       * build the DMG segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "EPD",SEGMENT
          IF        @EQUAL
            CALL      SEGEPD00                       * build the EPD segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "LPD",SEGMENT
          IF        @EQUAL
            CALL      SEGLPD00                       * build the LPD segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "MED",SEGMENT
          IF        @EQUAL
            CALL      SEGMED00                       * build the MED segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "MIG",SEGMENT
          IF        @EQUAL
            CALL      SEGMIG00                       * build the MIG segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "MOR",SEGMENT
          IF        @EQUAL
            CALL      SEGMOR00                       * build the MOR segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "MSG",SEGMENT
          IF        @EQUAL
            CALL      SEGMSG00                       * build the MSG segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "PAT",SEGMENT
          IF        @EQUAL
            CALL      SEGPAT00                       * build the PAT segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "PSG",SEGMENT
          IF        @EQUAL
            CALL      SEGPSG00                       * build the PSG segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "REM",SEGMENT
          IF        @EQUAL
            CALL      SEGREM00                       * build the REM segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "SVB",SEGMENT
          IF        @EQUAL
            CALL      SEGSVB00                       * build the SVB segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "TFR",SEGMENT
          IF        @EQUAL
            CALL      SEGTFR00                       * build the TFR segment 
            GOTO      P2IHC900
          ENDIF  
.
          MATCH     "TRG",SEGMENT
          IF        @EQUAL
            CALL      SEGTRG00                       * build the TRG segment 
            GOTO      P2IHC900
          ENDIF  
.
P2IHC900  WRITE     HTMLFILE;"</table>",012,"</div>",012    * end the segement div 
          GOTO      P2IHC000
.
P2IHC999  RETURN    
.
.------------------------------------------------------------------------------
. ICHBLK : build a div for each claim and start a div for segments
.------------------------------------------------------------------------------
IHCBLK00  UNPACK   CLAIMREC,CIDSEG01
.
          PACK     PATSEG06,SP70                     * clear the fields we will use
          PACK     PATSEG07,SP70
          PACK     PATSEG12,SP70
          PACK     EPDSEG10,SP70
.
          IF       CLMCOUNT > 0                       
            WRITE    HTMLFILE;"</div>",012            * close prev claim block  
          ENDIF
          ADD      ONE,CLMCOUNT
          MOVE     CLMCOUNT,CLMNO
          REPLACE  " 0",CLMNO
.
          READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          MATCH     "PAT",SEGMENT
          IF        @EQUAL
            UNPACK    CLAIMREC,PATSEG01,PATSEG02,PATSEG03,PATSEG04,PATSEG05:
                               PATSEG06,PATSEG07,PATSEG08,PATSEG09,PATSEG10:
                               PATSEG11,PATSEG12
          ENDIF
.
          READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          MATCH     "EPD",SEGMENT
          IF        @EQUAL
            UNPACK    CLAIMREC,EPDSEG01,EPDSEG02,EPDSEG03,EPDSEG04,EPDSEG05:            
                               EPDSEG06,EPDSEG07,EPDSEG08,EPDSEG09,EPDSEG10
          ENDIF
.
          STRIP     PATSEG06
          STRIP     PATSEG07
          MOVE      SEGCOUNT,SEGNO
          REPLACE  " 0",SEGNO
.
          WRITE     HTMLFILE;*+,"<div class=#"eclaim#" id=#"c",CLMNO,"#"":
                    " onmouseover=#"showcsegs(this);#">",012:
                    PATSEG07," ",PATSEG06,"<br />",012:
                    "U/R: ",PATSEG12,"<br />",012:
                    "Admission: ",EPDSEG10,"<br />",012:
                    "Invoice #: ",CIDSEG01,"</div>",012:
                    "<div class=#"nodisplay#" id=#"clm",CLMNO,"#">",012:
                    "<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
                    "onmouseover=#"showseg(this);#">CID</div><br />",012
.
          MATCH   SP70,PATSEG12  * did we get a patient segment? 
          GOTO    ICHBLK20 IF EQUAL
.
          ADD     ONE,SEGCOUNT
          MOVE    SEGCOUNT,SEGNO    
          REPLACE  " 0",SEGNO
          WRITE   HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
                  "onmouseover=#"showseg(this);#">PAT</div><br />",012
.
ICHBLK20  MATCH   SP70,EPDSEG10  * did we get an episode segment?
          GOTO    IHCBLK99 IF EQUAL
.
          ADD     ONE,SEGCOUNT
          MOVE    SEGCOUNT,SEGNO    
          REPLACE  " 0",SEGNO
          WRITE   HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
                  "onmouseover=#"showseg(this);#">EPD</div><br />",012
.
IHCBLK99  RETURN   
.
.------------------------------------------------------------------------------
. Process OEC  File
.------------------------------------------------------------------------------
OECFIL00  WRITE     HTMLFILE;"<div id=#"col1#">",012
.
. Note: this code is cloned from the original IHCFIL00, hence the use of a 'claim' count.
. It's not worth a new declaration as the two pieces of code will never conflict, so it's safe.
. 
          MOVE      ZERO,CLMCOUNT                     * clear counters
          MOVE      ZERO,SEGCOUNT
. 
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EXTRFILE,FILEPATH,RDONLY
          TRAPCLR   IO
          IF        OVRCD = 1
            STRIP     FILEPATH
            WRITE     HTMLFILE;*+,"<p class=#"Red#"><strong>Error: </strong>":
                               "File ",FILEPATH," not found.</p>"
            GOTO      OECFIL99
          ENDIF
.
          CALL      P1OEC000                          * first pass of OEC file
          CLOSE     EXTRFILE
          OPEN      EXTRFILE,FILEPATH,RDONLY
          MOVE      ZERO,SEGCOUNT
          CALL      P2OEC000                          * second pass of OEC file
.
          CLOSE     EXTRFILE
.
OECFIL99  WRITE    HTMLFILE;"</div>",012
          RETURN
.
.------------------------------------------------------------------------------
. First pass of OEC File
.------------------------------------------------------------------------------
P1OEC000  READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          GOTO      P1OEC999 IF OVER
.
          ADD       ONE,SEGCOUNT                     * count the segment
          MATCH     "HDR",SEGMENT
          GOTO       P1OEC000 IF EQUAL               * ignore header  segments
.
          MATCH     "TLR",SEGMENT
          GOTO       P1OEC000 IF EQUAL               * ignore trailer segments
.
          MATCH     "OEH",SEGMENT
          IF        @EQUAL
            CALL      OECBLK00                       * build the OEC block 
            GOTO      P1OEC000
          ENDIF  
.
          MOVE      SEGCOUNT,SEGNO                   * just link to the segment
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ": 
                    " onmouseover=#"showseg(this)#">",SEGMENT,"</div><br />",012
          GOTO     P1OEC000
.
P1OEC999  RETURN    
.
.------------------------------------------------------------------------------
. Second  pass of Claim File
.------------------------------------------------------------------------------
P2OEC000  READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          GOTO      P2OEC999 IF OVER
.
          ADD       ONE,SEGCOUNT                     * count the segment
          MATCH     "HDR",SEGMENT
          GOTO       P2OEC000 IF EQUAL               * ignore header  segments
.
          MATCH     "TLR",SEGMENT
          GOTO       P2OEC000 IF EQUAL               * ignore trailer segments
.
          MOVE      SEGCOUNT,SEGNO                   * write the div header     
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;"<div class=#"nodisplay#" id=#"seg",SEGNO,"#">":
                    012,"<table class=#"segment#">",012:
                    "<tr><th>Segment</th><td>",SEGMENT,"</td></tr>",012
.
          MATCH     "OEH",SEGMENT
          IF        @EQUAL
            CALL      SEGOEH00                       * build the OEH segment 
            GOTO      P2OEC900
          ENDIF  
.
          MATCH     "OES",SEGMENT
          IF        @EQUAL
            CALL      SEGOES00                       * build the OES segment 
            GOTO      P2OEC900
          ENDIF  
.
          MATCH     "OEV",SEGMENT
          IF        @EQUAL
            CALL      SEGOEV00                       * build the OEV segment 
            GOTO      P2OEC900
          ENDIF  
.
P2OEC900  WRITE     HTMLFILE;"</table>",012,"</div>",012    * end the segement div 
          GOTO      P2OEC000
.
P2OEC999  RETURN    
.------------------------------------------------------------------------------
. OECBLK : build a div for each eligibilty check  and start a div for segments
.------------------------------------------------------------------------------
OECBLK00  UNPACK   CLAIMREC,CIDSEG01
.
          PACK     OEHSEG05,SP70                     * clear the fields we will use
          PACK     OEVSEG08,SP70
          PACK     OEVSEG09,SP70
.
          IF       CLMCOUNT > 0                     
            WRITE    HTMLFILE;"</div></div>",012           * end previous oec check block
          ENDIF
          ADD      ONE,CLMCOUNT
          MOVE     CLMCOUNT,CLMNO
          REPLACE  " 0",CLMNO
.
.          READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          MATCH     "OEH",SEGMENT
          IF        @EQUAL
            UNPACK    CLAIMREC,OEHSEG01,OEHSEG02,OEHSEG03,OEHSEG04,OEHSEG05 
          ENDIF
.
          READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          MATCH     "OEV",SEGMENT
          IF        @EQUAL
            UNPACK    CLAIMREC,OEVSEG01,OEVSEG02,OEVSEG03,OEVSEG04,OEVSEG05:
                               OEVSEG06,OEVSEG07,OEVSEG08,OEVSEG09             
          ENDIF
.
          STRIP     OEVSEG08
          STRIP     OEVSEG09
          MOVE      SEGCOUNT,SEGNO
          REPLACE  " 0",SEGNO
.
          WRITE     HTMLFILE;*+,"<div class=#"eclaim#" id=#"c",CLMNO,"#"":
                    " onmouseover=#"showcsegs(this);#">",012:
                    OEVSEG09," ",OEVSEG08,"<br />",012:
                    "U/R: ",OEHSEG05,"<br />",012:
                    "<div class=#"nodisplay#" id=#"clm",CLMNO,"#">",012:
                    "<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
                    "onmouseover=#"showseg(this);#">OEH</div><br />",012
.
          ADD     ONE,SEGCOUNT
          MOVE    SEGCOUNT,SEGNO    
          REPLACE  " 0",SEGNO
          WRITE   HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
                  "onmouseover=#"showseg(this);#">OEV</div><br />",012
.
OECBLK99  RETURN   
.
.
.------------------------------------------------------------------------------
. Process IMC  File
.------------------------------------------------------------------------------
IMCFIL00  WRITE     HTMLFILE;"<div id=#"col1#">",012
.
.
. Note: this code is cloned from the original IHCFIL00, hence the use of a 'claim' count.
. It's not worth a new declaration as the two pieces of code will never conflict, so it's safe.
. 
          MOVE      ZERO,CLMCOUNT                     * clear counters
          MOVE      ZERO,SEGCOUNT
. 
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EXTRFILE,FILEPATH,RDONLY
          TRAPCLR   IO
          IF        OVRCD = 1
            STRIP     FILEPATH
            WRITE     HTMLFILE;*+,"<p class=#"Red#"><strong>Error: </strong>":
                               "File ",FILEPATH," not found.</p>"
            GOTO      IMCFIL99
          ENDIF
.
          CALL      P1IMC000                         * first pass of IMC file
          CLOSE     EXTRFILE
          OPEN      EXTRFILE,FILEPATH,RDONLY
          MOVE      ZERO,SEGCOUNT
          CALL      P2IMC000                          * second pass of IMC file
.
          CLOSE     EXTRFILE
.
.
IMCFIL99  WRITE    HTMLFILE;"</div>",012
          RETURN
.
.
.------------------------------------------------------------------------------
. First pass of IMC File
.------------------------------------------------------------------------------
P1IMC000  READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          GOTO      P1IMC999 IF OVER
.
          ADD       ONE,SEGCOUNT                     * count the segment
          MATCH     "HDR",SEGMENT
          GOTO       P1IMC000 IF EQUAL               * ignore header  segments
.
          MATCH     "TLR",SEGMENT
          GOTO       P1IMC000 IF EQUAL               * ignore trailer segments
.
          MATCH     "CLM",SEGMENT
          IF        @EQUAL
            CALL      IMCBLK00                       * build the claim block 
            GOTO      P1IMC000
          ENDIF  
.
          MOVE      SEGCOUNT,SEGNO                   * just link to the segment
          REPLACE   " 0",SEGNO
          WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ": 
                    " onmouseover=#"showseg(this)#">",SEGMENT,"</div><br />",012
          GOTO      P1IMC000
.
P1IMC999  RETURN    
.
.------------------------------------------------------------------------------
. Second  pass of IMC File
.------------------------------------------------------------------------------
P2IMC000  READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          GOTO      P2IMC999 IF OVER
.
          ADD       ONE,SEGCOUNT                     * count the segment

          MATCH     "HDR",SEGMENT
          GOTO       P2IMC000 IF EQUAL               * ignore header  segments
.
          MATCH     "TLR",SEGMENT
          GOTO       P2IMC000 IF EQUAL               * ignore trailer segments
.
          MOVE      SEGCOUNT,SEGNO                   * write the div header     
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;"<div class=#"nodisplay#" id=#"seg",SEGNO,"#">":
                    012,"<table class=#"segment#">",012:
                    "<tr><th>Segment</th><td>",SEGMENT,"</td></tr>"
.
          MATCH     "CLM",SEGMENT
          IF        @EQUAL
            CALL      SEGCLM00                       * build the CLM segment 
            GOTO      P2IMC900
          ENDIF  
.
          MATCH     "VCH",SEGMENT
          IF        @EQUAL
            CALL      SEGVCH00                       * build the VCH segment 
            GOTO      P2IMC900
          ENDIF  
.
          MATCH     "SRV",SEGMENT
          IF        @EQUAL
            CALL      SEGSRV00                       * build the SRV segment 
            GOTO      P2IMC900
          ENDIF  
.
P2IMC900  WRITE     HTMLFILE;"</table>",012,"</div>",012    * end the segement div 
          GOTO      P2IMC000
.
P2IMC999  RETURN    
.
.------------------------------------------------------------------------------
. IMCBLK : build a div for each inpatient claim  and start a div for segments
.------------------------------------------------------------------------------
IMCBLK00  UNPACK   CLAIMREC,CLMSEG01,CLMSEG02,CLMSEG03,CLMSEG04,CLMSEG05:
                            CLMSEG06,CLMSEG07,CLMSEG08,CLMSEG09,CLMSEG10:
                            CLMSEG11,CLMSEG12,CLMSEG13,CLMSEG14,CLMSEG15
.
.
          IF       CLMCOUNT > 0                     
            WRITE    HTMLFILE;"</div></div>",012     *end previous imc block
          ENDIF
          ADD      ONE,CLMCOUNT
          MOVE     CLMCOUNT,CLMNO
          REPLACE  " 0",CLMNO
.

          MOVE      SEGCOUNT,SEGNO
          REPLACE  " 0",SEGNO
.
          PACK      VCHSEG09,SP70
          PACK      VCHSEG10,SP70

          READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          MATCH     "VCH",SEGMENT
          IF        @EQUAL
            UNPACK   CLAIMREC,VCHSEG01,VCHSEG02,VCHSEG03,VCHSEG04,VCHSEG05:
                              VCHSEG06,VCHSEG07,VCHSEG08,VCHSEG09,VCHSEG10
          ENDIF
          STRIP     VCHSEG09 
          STRIP     VCHSEG10
.
          STRIP     CLMSEG14
          WRITE     HTMLFILE;*+,"<div class=#"eclaim#" id=#"c",CLMNO,"#"":
                    " onmouseover=#"showcsegs(this);#">",012:
                    VCHSEG10," ",VCHSEG09,"<br />",012:
                    "Inv: ",CLMSEG03,"<br />",012:
                    "<div class=#"nodisplay#" id=#"clm",CLMNO,"#">"
          WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ": 
                    " onmouseover=#"showseg(this)#">CLM</div><br />"
.
          ADD       ONE,SEGCOUNT
          MOVE      SEGCOUNT,SEGNO
          REPLACE  " 0",SEGNO
.
          WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ": 
                    " onmouseover=#"showseg(this)#">",SEGMENT,"</div><br />"
.
IMCBLK99  RETURN   
.
.------------------------------------------------------------------------------
. SEGACS : Report on the ACS segment                                   
.------------------------------------------------------------------------------
SEGACS00  UNPACK   CLAIMREC,ACSSEG01,ACSSEG02,ACSSEG03,ACSSEG04,ACSSEG05:
                            ACSSEG06,ACSSEG07,ACSSEG08                            
.
          WRITE   HTMLFILE;"<tr><th>Accommodation Days</th>":
                           "<td>",ACSSEG01,"</td></tr>",012:
                           "<tr><th>Charge Raised Code</th>":
                           "<td>",ACSSEG02,"</td></tr>",012:
                           "<tr><th>From Date</th>":
                           "<td>",ACSSEG03,"</td></tr>",012:
                           "<tr><th>Leave Days</th>":
                           "<td>",ACSSEG04,"</td></tr>",012:
                           "<tr><th>Number of Days</th>":
                           "<td>",ACSSEG05,"</td></tr>",012:
                           "<tr><th>To Date</th>":
                           "<td>",ACSSEG06,"</td></tr>",012:
                           "<tr><th>Total Charge Amount</th>":
                           "<td>",ACSSEG07,"</td></tr>",012:
                           "<tr><th>Non Cert. Days os Stay</th>":
                           "<td>",ACSSEG08,"</td></tr>"
.
SEGACS99  RETURN
.
.------------------------------------------------------------------------------
. SEGACD : Report on the ACD segment                                   
.------------------------------------------------------------------------------
SEGACD00  UNPACK   CLAIMREC,ACDSEG01,ACDSEG02,ACDSEG03,ACDSEG04,ACDSEG05:
                            ACDSEG06,ACDSEG07,ACDSEG08,ACDSEG09,ACDSEG10:
                            ACDSEG11,ACDSEG12,ACDSEG13
.
          WRITE   HTMLFILE;"<tr><th>Bed Band Code</th>":
                           "<td>",ACDSEG01,"</td></tr>",012:
                           "<tr><th>Bed Level Add-on Ind</th>":
                           "<td>",ACDSEG02,"</td></tr>",012:
                           "<tr><th>Bed Level Code</th>":
                           "<td>",ACDSEG03,"</td></tr>",012:
                           "<tr><th>Charge Amount</th>":
                           "<td>",ACDSEG04,"</td></tr>",012:
                           "<tr><th>Charge Raised Code</th>":
                           "<td>",ACDSEG05,"</td></tr>",012:
                           "<tr><th>Day Rate</th>":
                           "<td>",ACDSEG06,"</td></tr>",012:
                           "<tr><th>From Date</th>":
                           "<td>",ACDSEG07,"</td></tr>",012:
                           "<tr><th>Number of Days</th>":
                           "<td>",ACDSEG08,"</td></tr>",012:
                           "<tr><th>Patient Classification Code</th>":
                           "<td>",ACDSEG09,"</td></tr>",012:
                           "<tr><th>Program Number</th>":
                           "<td>",ACDSEG10,"</td></tr>",012:
                           "<tr><th>Service Code</th>":
                           "<td>",ACDSEG11,"</td></tr>",012:
                           "<tr><th>Service Code Type Code</th>":
                           "<td>",ACDSEG12,"</td></tr>",012:
                           "<tr><th>To Date</th>":
                           "<td>",ACDSEG13,"</td></tr>"
.
SEGACD99  RETURN
.
.------------------------------------------------------------------------------
. SEGADD : Report on the ADD pseudo segment                                   
.          Note - this is really part of the DMG segemnt
.------------------------------------------------------------------------------
SEGADD00  UNPACK   DMGSEG05,ADDSEG01,ADDSEG02,ADDSEG03,ADDSEG04,ADDSEG05:
                            ADDSEG06,ADDSEG07,ADDSEG08,ADDSEG09,ADDSEG10:
                            ADDSEG11,ADDSEG12,ADDSEG13,ADDSEG14,ADDSEG15:
                            ADDSEG16,ADDSEG17,ADDSEG18,ADDSEG19,ADDSEG20:
                            ADDSEG21,ADDSEG22,ADDSEG23,ADDSEG24,ADDSEG25:
                            ADDSEG26,ADDSEG27,ADDSEG28,ADDSEG29,ADDSEG30:
                            ADDSEG31,ADDSEG32,ADDSEG33,ADDSEG34,ADDSEG35:
                            ADDSEG36,ADDSEG37,ADDSEG38,ADDSEG39,ADDSEG40:
                            ADDSEG41,ADDSEG42,ADDSEG43,ADDSEG44,ADDSEG45:
                            ADDSEG46,ADDSEG47,ADDSEG48,ADDSEG49           
.
          WRITE   HTMLFILE;"<tr><th>Additional Diagnosis</th>":
                           "<td>",ADDSEG01,"</td></tr>",012
.
          MATCH   SP70,ADDSEG02
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG02,"</td></tr>",012
.
          MATCH   SP70,ADDSEG03
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG03,"</td></tr>",012
.
          MATCH   SP70,ADDSEG04
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG04,"</td></tr>",012
.
          MATCH   SP70,ADDSEG05
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG05,"</td></tr>",012
.
          MATCH   SP70,ADDSEG06
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG06,"</td></tr>",012
.
          MATCH   SP70,ADDSEG07
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG07,"</td></tr>",012
.
          MATCH   SP70,ADDSEG08
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG08,"</td></tr>",012
.
          MATCH   SP70,ADDSEG09
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG09,"</td></tr>",012
.
          MATCH   SP70,ADDSEG10
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG10,"</td></tr>",012
.
          MATCH   SP70,ADDSEG11
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG11,"</td></tr>",012
.
          MATCH   SP70,ADDSEG12
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG12,"</td></tr>",012
.
          MATCH   SP70,ADDSEG13
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG13,"</td></tr>",012
.
          MATCH   SP70,ADDSEG14
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG14,"</td></tr>",012
.
          MATCH   SP70,ADDSEG15
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG15,"</td></tr>",012
.
          MATCH   SP70,ADDSEG16
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG16,"</td></tr>",012
.
          MATCH   SP70,ADDSEG17
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG17,"</td></tr>",012
.
          MATCH   SP70,ADDSEG18
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG18,"</td></tr>",012
.
          MATCH   SP70,ADDSEG19
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG19,"</td></tr>",012
.
          MATCH   SP70,ADDSEG20
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG20,"</td></tr>",012
.
          MATCH   SP70,ADDSEG21
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG21,"</td></tr>",012
.
          MATCH   SP70,ADDSEG22
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG22,"</td></tr>",012
.
          MATCH   SP70,ADDSEG23
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG23,"</td></tr>",012
.
          MATCH   SP70,ADDSEG24
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG24,"</td></tr>",012
.
          MATCH   SP70,ADDSEG25
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG25,"</td></tr>",012
.
          MATCH   SP70,ADDSEG26
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG26,"</td></tr>",012
.
          MATCH   SP70,ADDSEG27
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG27,"</td></tr>",012
.
          MATCH   SP70,ADDSEG28
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG28,"</td></tr>",012
.
          MATCH   SP70,ADDSEG29
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG29,"</td></tr>",012
.
          MATCH   SP70,ADDSEG30
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG30,"</td></tr>",012
.
          MATCH   SP70,ADDSEG31
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG31,"</td></tr>",012
.
          MATCH   SP70,ADDSEG32
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG32,"</td></tr>",012
.
          MATCH   SP70,ADDSEG33
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG33,"</td></tr>",012
.
          MATCH   SP70,ADDSEG34
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG34,"</td></tr>",012
.
          MATCH   SP70,ADDSEG35
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG35,"</td></tr>",012
.
          MATCH   SP70,ADDSEG36
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG36,"</td></tr>",012
.
          MATCH   SP70,ADDSEG37
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG37,"</td></tr>",012
.
          MATCH   SP70,ADDSEG38
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG38,"</td></tr>",012
.
          MATCH   SP70,ADDSEG39
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG39,"</td></tr>",012
.
          MATCH   SP70,ADDSEG40
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG40,"</td></tr>",012
.
          MATCH   SP70,ADDSEG41
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG41,"</td></tr>",012
.
          MATCH   SP70,ADDSEG42
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG42,"</td></tr>",012
.
          MATCH   SP70,ADDSEG43
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG43,"</td></tr>",012
.
          MATCH   SP70,ADDSEG44
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG44,"</td></tr>",012
.
          MATCH   SP70,ADDSEG45
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG45,"</td></tr>",012
.
          MATCH   SP70,ADDSEG46
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG46,"</td></tr>",012
.
          MATCH   SP70,ADDSEG47
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG47,"</td></tr>",012
.
          MATCH   SP70,ADDSEG48
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG48,"</td></tr>",012
.
          MATCH   SP70,ADDSEG49
          GOTO    SEGADD99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",ADDSEG49,"</td></tr>",012
.
SEGADD99  RETURN
.
.------------------------------------------------------------------------------
. SEGAFS : Report on the AFS segment                                   
.------------------------------------------------------------------------------
SEGAFS00  UNPACK   CLAIMREC,AFSSEG01
.
          WRITE   HTMLFILE;"<tr><th>Admission FIM Score</th>":
                           "<td>",AFSSEG01,"</td></tr>"
.
SEGAFS99  RETURN
.
.------------------------------------------------------------------------------
. SEGANB : Report on the ANB segment                                   
.------------------------------------------------------------------------------
SEGANB00  UNPACK   CLAIMREC,ANBSEG01,ANBSEG02,ANBSEG03,ANBSEG04,ANBSEG05
.
          WRITE   HTMLFILE;"<tr><th>Baby Date of Birth</th>":
                           "<td>",ANBSEG01,"</td></tr>",012:
                           "<tr><th>Baby Family Name</th>":
                           "<td>",ANBSEG02,"</td></tr>",012:
                           "<tr><th>Baby First Name</th>":
                           "<td>",ANBSEG03,"</td></tr>",012:
                           "<tr><th>Baby Gender</th>":
                           "<td>",ANBSEG04,"</td></tr>",012:
                           "<tr><th>Baby Second Initial</th>":
                           "<td>",ANBSEG05,"</td></tr>"
.
SEGANB99  RETURN
.
.------------------------------------------------------------------------------
. SEGCCG : Report on the CCG segment                                   
.------------------------------------------------------------------------------
SEGCCG00  UNPACK   CLAIMREC,CCGSEG01,CCGSEG02,CCGSEG03,CCGSEG04,CCGSEG05:
                            CCGSEG06,CCGSEG07,CCGSEG08,CCGSEG09,CCGSEG10:
                            CCGSEG11,CCGSEG12,CCGSEG13
.
          WRITE   HTMLFILE;"<tr><th>Charge Amount</th>":
                           "<td>",CCGSEG01,"</td></tr>",012:
                           "<tr><th>Charge Raised Code</th>":
                           "<td>",CCGSEG02,"</td></tr>",012:
                           "<tr><th>Critical Care Add-on Ind</th>":
                           "<td>",CCGSEG03,"</td></tr>",012:
                           "<tr><th>Critical Care Level Code</th>":
                           "<td>",CCGSEG04,"</td></tr>",012:
                           "<tr><th>Critical Care Type Code</th>":
                           "<td>",CCGSEG05,"</td></tr>",012:
                           "<tr><th>Day Rate</th>":
                           "<td>",CCGSEG06,"</td></tr>",012:
                           "<tr><th>From Date</th>":
                           "<td>",CCGSEG07,"</td></tr>",012:
                           "<tr><th>ICU Hours</th>":
                           "<td>",CCGSEG08,"</td></tr>",012:
                           "<tr><th>Number of Days</th>":
                           "<td>",CCGSEG09,"</td></tr>",012:
                           "<tr><th>Service Code</th>":
                           "<td>",CCGSEG10,"</td></tr>",012:
                           "<tr><th>Service Code Type Code</th>":
                           "<td>",CCGSEG11,"</td></tr>",012:
                           "<tr><th>To Date</th>":
                           "<td>",CCGSEG12,"</td></tr>",012: 
                           "<tr><th>Critical Care Unit Hours</th>":
                           "<td>",CCGSEG13,"</td></tr>"
.
SEGCCG99  RETURN
.
.------------------------------------------------------------------------------
. SEGCER : Report on the CER segment                                   
.------------------------------------------------------------------------------
SEGCER00  UNPACK   CLAIMREC,CERSEG01,CERSEG02,CERSEG03,CERSEG04,CERSEG05:
                            CERSEG06,CERSEG07,CERSEG08                       
.
          WRITE   HTMLFILE;"<tr><th>Certificate Type Code</th>":
                           "<td>",CERSEG01,"</td></tr>",012:
                           "<tr><th>Certifying Provider No.</th>":
                           "<td>",CERSEG02,"</td></tr>",012:
                           "<tr><th>Certifying Provider Name</th>":
                           "<td>",CERSEG03,"</td></tr>",012:
                           "<tr><th>Issue Date</th>":
                           "<td>",CERSEG04,"</td></tr>",012:
                           "<tr><th>From Date</th>":
                           "<td>",CERSEG05,"</td></tr>",012:
                           "<tr><th>Number of Days</th>":
                           "<td>",CERSEG06,"</td></tr>",012:
                           "<tr><th>To Date</th>":
                           "<td>",CERSEG07,"</td></tr>",012:
                           "<tr><th>Text</th>":
                           "<td>",CERSEG08,"</td></tr>"
.
SEGCER99  RETURN
.
.------------------------------------------------------------------------------
. SEGCID : Report on the CID segment                                   
.------------------------------------------------------------------------------
SEGCID00  UNPACK   CLAIMREC,CIDSEG01,CIDSEG02,CIDSEG03,CIDSEG04,CIDSEG05:
                            CIDSEG06,CIDSEG07,CIDSEG08,CIDSEG09,CIDSEG10:
                            CIDSEG11,CIDSEG12,CIDSEG13,CIDSEG14,CIDSEG15:
                            CIDSEG16,CIDSEG17                            
.
          WRITE   HTMLFILE;"<tr><th>Account Reference Id</th>":
                           "<td>",CIDSEG01,"</td></tr>",012:
                           "<tr><th>Claim Type Code</th>":
                           "<td>",CIDSEG02,"</td></tr>",012:
                           "<tr><th>Compensable Claim Code</th>":
                           "<td>",CIDSEG03,"</td></tr>",012:
                           "<tr><th>Contiguous Claim Code</th>":
                           "<td>",CIDSEG04,"</td></tr>",012:
                           "<tr><th>Facility Id</th>":
                           "<td>",CIDSEG05,"</td></tr>",012:
                           "<tr><th>Facility Type Code</th>":
                           "<td>",CIDSEG06,"</td></tr>",012:
                           "<tr><th>Fund Brand Id</th>":
                           "<td>",CIDSEG07,"</td></tr>",012:
                           "<tr><th>Payment Model</th>":
                           "<td>",CIDSEG08,"</td></tr>",012:
                           "<tr><th>Previous Claim Code</th>":
                           "<td>",CIDSEG09,"</td></tr>",012:
                           "<tr><th>Previous Transaction Id</th>":
                           "<td>",CIDSEG10,"</td></tr>",012:
                           "<tr><th>Sender Contact Email</th>":
                           "<td>",CIDSEG11,"</td></tr>",012:
                           "<tr><th>Sender Contact Person Name</th>":
                           "<td>",CIDSEG12,"</td></tr>",012:
                           "<tr><th>Sender Contact Person Phone</th>":
                           "<td>",CIDSEG13,"</td></tr>",012:
                           "<tr><th>Total Charge Amount</th>":
                           "<td>",CIDSEG14,"</td></tr>",012:
                           "<tr><th>Total Hospital Charge Amount</th>":
                           "<td>",CIDSEG15,"</td></tr>",012:
                           "<tr><th>Total Medical Charge Amount</th>":
                           "<td>",CIDSEG16,"</td></tr>",012:
                           "<tr><th>Urgency Code</th>":
                           "<td>",CIDSEG17,"</td></tr>"

.
SEGCID99  RETURN
.
.------------------------------------------------------------------------------
. SEGDFS : Report on the DFS segment                                   
.------------------------------------------------------------------------------
SEGDFS00  UNPACK   CLAIMREC,DFSSEG01
.
          WRITE   HTMLFILE;"<tr><th>Discharge FIM Score</th>":
                           "<td>",DFSSEG01,"</td></tr>"
.
SEGDFS99  RETURN
.
.------------------------------------------------------------------------------
. SEGDMG : Report on the DMG segment                                   
.------------------------------------------------------------------------------
SEGDMG00  MATCH     "1",PTCNECUP
          IF        @EQUAL
            UNPACK   CLAIMREC,DMGSEG01,DMGSEG02,DMGSEG03,DMGSEG04,DMGSEG05:
                              DMGSEG06           
          ELSE
            UNPACK   CLAIMREC,DMGSEG01,DMGSEG02,OLDDMG03,DMGSEG04,OLDDMG05:
                              DMGSEG06
.
            PACK     DMGSEG03,OLDDMG03,SP1
            CLEAR    DMGSEG05
            MOVE     1,LOOPCT
            REPEAT 
              MOVE      OLDDMG05,OLDDIAG
              APPEND    OLDDIAG,DMGSEG05
              APPEND    SP1,DMGSEG05
              BUMP      OLDDMG05,5
              ADD       ONE,LOOPCT                 * increment counter
            UNTIL     LOOPCT > 49
            RESET     OLDDMG05
            RESET     DMGSEG05
          ENDIF
.
          WRITE    HTMLFILE;"<tr><th>DRG Code</th>":
                           "<td>",DMGSEG01,"</td></tr>",012:
                           "<tr><th>DRG Version</th>":
                           "<td>",DMGSEG02,"</td></tr>",012:
                           "<tr><th>Principal Diagnosis</th>":
                           "<td>",DMGSEG03,"</td></tr>",012:
                           "<tr><th>Ventilation Hours</th>":
                           "<td>",DMGSEG04,"</td></tr>"
          MATCH    SP70,DMGSEG05
          IF       !@EQUAL
            CALL     SEGADD00
          ENDIF
.           
          MATCH    SP70,DMGSEG06
          IF       !@EQUAL
            CALL     SEGPRO00
          ENDIF
.           
SEGDMG99  RETURN
.
.------------------------------------------------------------------------------
. SEGEPD : Report on the EPD segment                                   
.------------------------------------------------------------------------------
SEGEPD00  UNPACK   CLAIMREC,EPDSEG01,EPDSEG02,EPDSEG03,EPDSEG04,EPDSEG05:
                            EPDSEG06,EPDSEG07,EPDSEG08,EPDSEG09,EPDSEG10:
                            EPDSEG11,EPDSEG12,EPDSEG13,EPDSEG14,EPDSEG15:
                            EPDSEG16,EPDSEG17,EPDSEG18,EPDSEG19,EPDSEG20:
                            EPDSEG21,EPDSEG22,EPDSEG23                            
.
          WRITE   HTMLFILE;"<tr><th>Accommodation Status Code</th>":
                           "<td>",EPDSEG01,"</td></tr>",012:
                           "<tr><th>Admission Category Code</th>":
                           "<td>",EPDSEG02,"</td></tr>",012:
                           "<tr><th>Admission Date</th>":
                           "<td>",EPDSEG03,"</td></tr>",012:
                           "<tr><th>Admission Time</th>":
                           "<td>",EPDSEG04,"</td></tr>",012:
                           "<tr><th>Anticipated Length of Stay</th>":
                           "<td>",EPDSEG05,"</td></tr>",012:
                           "<tr><th>Discharge Date</th>":
                           "<td>",EPDSEG06,"</td></tr>",012:
                           "<tr><th>Discharge Intention Code</th>":
                           "<td>",EPDSEG07,"</td></tr>",012:
                           "<tr><th>Discharge Time</th>":
                           "<td>",EPDSEG08,"</td></tr>",012:
                           "<tr><th>Discharge Type Code</th>":
                           "<td>",EPDSEG09,"</td></tr>",012:
                           "<tr><th>Episode Id</th>":
                           "<td>",EPDSEG10,"</td></tr>",012:
                           "<tr><th>Episode Type Code</th>":
                           "<td>",EPDSEG11,"</td></tr>",012:
                           "<tr><th>Facility Contract Status Code</th>":
                           "<td>",EPDSEG12,"</td></tr>",012:
                           "<tr><th>Length of Stay</th>":
                           "<td>",EPDSEG13,"</td></tr>",012:
                           "<tr><th>Mental Health Legal Status Code</th>":
                           "<td>",EPDSEG14,"</td></tr>",012:
                           "<tr><th>Palliative Care Status Code</th>":
                           "<td>",EPDSEG15,"</td></tr>",012:
                           "<tr><th>Patient Classification Code</th>":
                           "<td>",EPDSEG16,"</td></tr>",012:
                           "<tr><th>Readmission Code</th>":
                           "<td>",EPDSEG17,"</td></tr>",012:
                           "<tr><th>Referral Source Code</th>":
                           "<td>",EPDSEG18,"</td></tr>",012:
                           "<tr><th>Sameday Code</th>":
                           "<td>",EPDSEG19,"</td></tr>",012:
                           "<tr><th>Unplanned Theatre Code</th>":
                           "<td>",EPDSEG20,"</td></tr>",012:
                           "<tr><th>Total Psych Care Days</th>":
                           "<td>",EPDSEG21,"</td></tr>",012:
                           "<tr><th>Pallaitive Care Days</th>":
                           "<td>",EPDSEG22,"</td></tr>",012:
                           "<tr><th>Qualified Days for Newborns</th>":
                           "<td>",EPDSEG23,"</td></tr>"

.
SEGEPD99  RETURN
.
.------------------------------------------------------------------------------
. SEGLPD : Report on the LPD segment                                   
.------------------------------------------------------------------------------
SEGLPD00  UNPACK   CLAIMREC,LPDSEG01,LPDSEG02,LPDSEG03                     
.
          WRITE   HTMLFILE;"<tr><th>From Date</th>":
                           "<td>",LPDSEG01,"</td></tr>",012:
                           "<tr><th>To Date</th>":
                           "<td>",LPDSEG02,"</td></tr>",012:
                           "<tr><th>Number of Days</th>":
                           "<td>",LPDSEG03,"</td></tr>"
.
SEGLPD99  RETURN
.
.------------------------------------------------------------------------------
. SEGMED : Report on the MED segment                                   
.------------------------------------------------------------------------------
SEGMED00  UNPACK   CLAIMREC,MEDSEG01,MEDSEG02,MEDSEG03,MEDSEG04,MEDSEG05:
                            MEDSEG06,MEDSEG07,MEDSEG08                     
.
          WRITE   HTMLFILE;"<tr><th>Charge Amount</th>":
                           "<td>",MEDSEG01,"</td></tr>",012:
                           "<tr><th>Charge Raised Code</th>":
                           "<td>",MEDSEG02,"</td></tr>",012:
                           "<tr><th>Payee Provider Number</th>":
                           "<td>",MEDSEG03,"</td></tr>",012:
                           "<tr><th>Service Code</th>":
                           "<td>",MEDSEG04,"</td></tr>",012:
                           "<tr><th>Service Code Type Code</th>":
                           "<td>",MEDSEG05,"</td></tr>",012:
                           "<tr><th>Service Date</th>":
                           "<td>",MEDSEG06,"</td></tr>",012:
                           "<tr><th>Service Provider Name</th>":
                           "<td>",MEDSEG07,"</td></tr>",012:
                           "<tr><th>Service Provider Number</th>":
                           "<td>",MEDSEG08,"</td></tr>"
.
SEGMED99  RETURN
.
.------------------------------------------------------------------------------
. SEGMIG : Report on the MIG segment                                   
.------------------------------------------------------------------------------
SEGMIG00  UNPACK   CLAIMREC,MIGSEG01,MIGSEG02,MIGSEG03,MIGSEG04,MIGSEG05:
                            MIGSEG06,MIGSEG07                              
.
          WRITE   HTMLFILE;"<tr><th>Charge Amount</th>":
                           "<td>",MIGSEG01,"</td></tr>",012:
                           "<tr><th>Charge Raised Code</th>":
                           "<td>",MIGSEG02,"</td></tr>",012:
                           "<tr><th>Service Code</th>":
                           "<td>",MIGSEG03,"</td></tr>",012:
                           "<tr><th>Service Date</th>":
                           "<td>",MIGSEG04,"</td></tr>",012:
                           "<tr><th>Service Rate</th>":
                           "<td>",MIGSEG05,"</td></tr>",012:
                           "<tr><th>Service Quantity</th>":
                           "<td>",MIGSEG06,"</td></tr>",012:
                           "<tr><th>Text</th>":
                           "<td>",MIGSEG07,"</td></tr>"
.
SEGMIG99  RETURN
.
.------------------------------------------------------------------------------
. SEGMOR : Report on the MOR segment                                   
.------------------------------------------------------------------------------
SEGMOR00  UNPACK   CLAIMREC,MORSEG01,MORSEG02,MORSEG03,MORSEG04,MORSEG05:
                            MORSEG06,MORSEG07,MORSEG08 
.
          WRITE   HTMLFILE;"<tr><th>ANSNAP Class</th>":
                           "<td>",MORSEG01,"</td></tr>",012:
                           "<tr><th>ARO Impairment Code</th>":
                           "<td>",MORSEG02,"</td></tr>",012:
                           "<tr><th>Assessment Only Code</th>":
                           "<td>",MORSEG03,"</td></tr>",012:
                           "<tr><th>Casemix Code</th>":
                           "<td>",MORSEG04,"</td></tr>",012:
                           "<tr><th>Casemix Code Type Code</th>":
                           "<td>",MORSEG05,"</td></tr>",012:
                           "<tr><th>ANDNAP Id</th>":
                           "<td>",MORSEG06,"</td></tr>",012:
                           "<tr><th>Discharge Plan Date</th>":
                           "<td>",MORSEG07,"</td></tr>",012:
                           "<tr><th>Multi-disciplinary Rehab Plan Date</th>":
                           "<td>",MORSEG08,"</td></tr>"
.
SEGMOR99  RETURN
.
.------------------------------------------------------------------------------
. SEGMSG : Report on the MSG segment                                   
.------------------------------------------------------------------------------
SEGMSG00  UNPACK   CLAIMREC,MSGSEG01,MSGSEG02,MSGSEG03,MSGSEG04,MSGSEG05:
                            MSGSEG06,MSGSEG07                              
.
          WRITE   HTMLFILE;"<tr><th>Charge Amount</th>":
                           "<td>",MSGSEG01,"</td></tr>",012:
                           "<tr><th>Charge Raised Code</th>":
                           "<td>",MSGSEG02,"</td></tr>",012:
                           "<tr><th>Service Code</th>":
                           "<td>",MSGSEG03,"</td></tr>",012:
                           "<tr><th>Service Code Type Code</th>":
                           "<td>",MSGSEG04,"</td></tr>",012:
                           "<tr><th>Theatre Band Code</th>":
                           "<td>",MSGSEG05,"</td></tr>",012:
                           "<tr><th>Theatre Band Type Code</th>":
                           "<td>",MSGSEG06,"</td></tr>",012:
                           "<tr><th>Theatre Category Code</th>":
                           "<td>",MSGSEG07,"</td></tr>"
.
SEGMSG99  RETURN
.
.------------------------------------------------------------------------------
. SEGPAT : Report on the PAT segment                                   
.------------------------------------------------------------------------------
SEGPAT00  UNPACK   CLAIMREC,PATSEG01,PATSEG02,PATSEG03,PATSEG04,PATSEG05:
                            PATSEG06,PATSEG07,PATSEG08,PATSEG09,PATSEG10:
                            PATSEG11,PATSEG12,PATSEG13,PATSEG14,PATSEG15 

          WRITE   HTMLFILE;"<tr><th>Patient Address Postcode</th>":
                           "<td>",PATSEG01,"</td></tr>",012:
                           "<tr><th>Patient Admission Weight</th>":
                           "<td>",PATSEG02,"</td></tr>",012:
                           "<tr><th>Patient Alias Family Name</th>":
                           "<td>",PATSEG03,"</td></tr>",012:
                           "<tr><th>Patient Alias First Name</th>":
                           "<td>",PATSEG04,"</td></tr>",012:
                           "<tr><th>Patient Date of Birth</th>":
                           "<td>",PATSEG05,"</td></tr>",012:
                           "<tr><th>Patient Family Name</th>":
                           "<td>",PATSEG06,"</td></tr>",012:
                           "<tr><th>Patient First Name</th>":
                           "<td>",PATSEG07,"</td></tr>",012:
                           "<tr><th>Patient Fund Membership No</th>":
                           "<td>",PATSEG08,"</td></tr>",012:
                           "<tr><th>Patient Fund UPI</th>":
                           "<td>",PATSEG09,"</td></tr>",012:
                           "<tr><th>Patient Gender</th>":
                           "<td>",PATSEG10,"</td></tr>",012:
                           "<tr><th>Patient Medicare Card No</th>":
                           "<td>",PATSEG11,"</td></tr>",012:
                           "<tr><th>Patient Medical Record Id</th>":
                           "<td>",PATSEG12,"</td></tr>",012:
                           "<tr><th>Patient Reference No</th>":
                           "<td>",PATSEG13,"</td></tr>",012:
                           "<tr><th>Patient Second Initial</th>":
                           "<td>",PATSEG14,"</td></tr>",012:
                           "<tr><th>Symptom Awarness Date</th>":
                           "<td>",PATSEG15,"</td></tr>"
.
SEGPAT99  RETURN
.
.------------------------------------------------------------------------------
. SEGPRO : Report on the PRO pseudo segment                                   
.          Note: this is part of the DNG segment 
.------------------------------------------------------------------------------
SEGPRO00  UNPACK   DMGSEG06,PROSEG01,PROSEG02,PROSEG03,PROSEG04,PROSEG05:
                            PROSEG06,PROSEG07,PROSEG08,PROSEG09,PROSEG10:
                            PROSEG11,PROSEG12,PROSEG13,PROSEG14,PROSEG15:
                            PROSEG16,PROSEG17,PROSEG18,PROSEG19,PROSEG20:
                            PROSEG21,PROSEG22,PROSEG23,PROSEG24,PROSEG25:
                            PROSEG26,PROSEG27,PROSEG28,PROSEG29,PROSEG30:
                            PROSEG31,PROSEG32,PROSEG33,PROSEG34,PROSEG35:
                            PROSEG36,PROSEG37,PROSEG38,PROSEG39,PROSEG40:
                            PROSEG41,PROSEG42,PROSEG43,PROSEG44,PROSEG45:
                            PROSEG46,PROSEG47,PROSEG48,PROSEG49,PROSEG50  
.
          WRITE   HTMLFILE;"<tr><th>Procedures</th>":
                           "<td>",PROSEG01,"</td></tr>",012
.
          MATCH   SP70,PROSEG02
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG02,"</td></tr>",012
.
          MATCH   SP70,PROSEG03
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG03,"</td></tr>",012
.
          MATCH   SP70,PROSEG04
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG04,"</td></tr>",012
.
          MATCH   SP70,PROSEG05
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG05,"</td></tr>",012
.
          MATCH   SP70,PROSEG06
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG06,"</td></tr>",012
.
          MATCH   SP70,PROSEG07
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG07,"</td></tr>",012
.
          MATCH   SP70,PROSEG08
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG08,"</td></tr>",012
.
          MATCH   SP70,PROSEG09
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG09,"</td></tr>",012
.
          MATCH   SP70,PROSEG10
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG10,"</td></tr>",012
.
          MATCH   SP70,PROSEG11
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG11,"</td></tr>",012
.
          MATCH   SP70,PROSEG12
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG12,"</td></tr>",012
.
          MATCH   SP70,PROSEG13
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG13,"</td></tr>",012
.
          MATCH   SP70,PROSEG14
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG14,"</td></tr>",012
.
          MATCH   SP70,PROSEG15
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG15,"</td></tr>",012
.
          MATCH   SP70,PROSEG16
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG16,"</td></tr>",012
.
          MATCH   SP70,PROSEG17
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG17,"</td></tr>",012
.
          MATCH   SP70,PROSEG18
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG18,"</td></tr>",012
.
          MATCH   SP70,PROSEG19
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG19,"</td></tr>",012
.
          MATCH   SP70,PROSEG20
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG20,"</td></tr>",012
.
          MATCH   SP70,PROSEG21
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG21,"</td></tr>",012
.
          MATCH   SP70,PROSEG22
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG22,"</td></tr>",012
.
          MATCH   SP70,PROSEG23
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG23,"</td></tr>",012
.
          MATCH   SP70,PROSEG24
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG24,"</td></tr>",012
.
          MATCH   SP70,PROSEG25
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG25,"</td></tr>",012
.
          MATCH   SP70,PROSEG26
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG26,"</td></tr>",012
.
          MATCH   SP70,PROSEG27
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG27,"</td></tr>",012
.
          MATCH   SP70,PROSEG28
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG28,"</td></tr>",012
.
          MATCH   SP70,PROSEG29
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG29,"</td></tr>",012
.
          MATCH   SP70,PROSEG30
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG30,"</td></tr>",012
.
          MATCH   SP70,PROSEG31
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG31,"</td></tr>",012
.
          MATCH   SP70,PROSEG32
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG32,"</td></tr>",012
.
          MATCH   SP70,PROSEG33
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG33,"</td></tr>",012
.
          MATCH   SP70,PROSEG34
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG34,"</td></tr>",012
.
          MATCH   SP70,PROSEG35
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG35,"</td></tr>",012
.
          MATCH   SP70,PROSEG36
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG36,"</td></tr>",012
.
          MATCH   SP70,PROSEG37
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG37,"</td></tr>",012
.
          MATCH   SP70,PROSEG38
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG38,"</td></tr>",012
.
          MATCH   SP70,PROSEG39
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG39,"</td></tr>",012
.
          MATCH   SP70,PROSEG40
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG40,"</td></tr>",012
.
          MATCH   SP70,PROSEG41
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG41,"</td></tr>",012
.
          MATCH   SP70,PROSEG42
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG42,"</td></tr>",012
.
          MATCH   SP70,PROSEG43
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG43,"</td></tr>",012
.
          MATCH   SP70,PROSEG44
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG44,"</td></tr>",012
.
          MATCH   SP70,PROSEG45
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG45,"</td></tr>",012
.
          MATCH   SP70,PROSEG46
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG46,"</td></tr>",012
.
          MATCH   SP70,PROSEG47
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG47,"</td></tr>",012
.
          MATCH   SP70,PROSEG48
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG48,"</td></tr>",012
.
          MATCH   SP70,PROSEG49
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG49,"</td></tr>",012
.
          MATCH   SP70,PROSEG50
          GOTO    SEGPRO99 IF EQUAL
          WRITE   HTMLFILE;"<tr><th>&nbsp;</th><td>",PROSEG50,"</td></tr>",012
.
SEGPRO99  RETURN
.
.------------------------------------------------------------------------------
. SEGPSG : Report on the PSG segment                                   
.------------------------------------------------------------------------------
SEGPSG00  UNPACK   CLAIMREC,PSGSEG01,PSGSEG02,PSGSEG03,PSGSEG04,PSGSEG05:
                            PSGSEG06,PSGSEG07,PSGSEG08,PSGSEG09,PSGSEG10:
                            PSGSEG11,PSGSEG12
.
          WRITE   HTMLFILE;"<tr><th>Anaesthetic Type Code</th>":
                           "<td>",PSGSEG01,"</td></tr>",012:
                           "<tr><th>Charge Amount</th>":
                           "<td>",PSGSEG02,"</td></tr>",012:
                           "<tr><th>Charge Raised Code</th>":
                           "<td>",PSGSEG03,"</td></tr>",012:
                           "<tr><th>Service Code</th>":
                           "<td>",PSGSEG04,"</td></tr>",012:
                           "<tr><th>Service Code Type Code</th>":
                           "<td>",PSGSEG05,"</td></tr>",012:
                           "<tr><th>Service Date</th>":
                           "<td>",PSGSEG06,"</td></tr>",012:
                           "<tr><th>Service Time</th>":
                           "<td>",PSGSEG07,"</td></tr>",012:
                           "<tr><th>Theatre Band Code</th>":
                           "<td>",PSGSEG08,"</td></tr>",012:
                           "<tr><th>Theatre Band Type Code</th>":
                           "<td>",PSGSEG09,"</td></tr>",012:
                           "<tr><th>Theatre Category Code</th>":
                           "<td>",PSGSEG10,"</td></tr>",012:
                           "<tr><th>Theatre Minutes</th>":
                           "<td>",PSGSEG11,"</td></tr>",012:
                           "<tr><th>Total Charge Amount</th>":
                           "<td>",PSGSEG12,"</td></tr>"
.
SEGPSG99  RETURN
.
.------------------------------------------------------------------------------
. SEGREM : Report on the REM segment                                   
.------------------------------------------------------------------------------
SEGREM00  UNPACK   CLAIMREC,REMSEG01                                        
.
          WRITE   HTMLFILE;"<tr><th>Text</th>":
                           "<td>",REMSEG01,"</td></tr>"
.
SEGREM99  RETURN
.
.------------------------------------------------------------------------------
. SEGSVB : Report on the SVB segment                                   
.------------------------------------------------------------------------------
SEGSVB00  UNPACK   CLAIMREC,SVBSEG01,SVBSEG02,SVBSEG03,SVBSEG04,SVBSEG05:
                            SVBSEG06,SVBSEG07                                   
.
          WRITE   HTMLFILE;"<tr><th>Charge Amount</th>":
                           "<td>",SVBSEG01,"</td></tr>",012:
                           "<tr><th>Charge Raised Code</th>":
                           "<td>",SVBSEG02,"</td></tr>",012:
                           "<tr><th>From Date</th>":
                           "<td>",SVBSEG03,"</td></tr>",012:
                           "<tr><th>Number of Days</th>":
                           "<td>",SVBSEG04,"</td></tr>",012:
                           "<tr><th>Service Code</th>":
                           "<td>",SVBSEG05,"</td></tr>",012:
                           "<tr><th>Service Code Type Code</th>":
                           "<td>",SVBSEG06,"</td></tr>",012:
                           "<tr><th>To Date</th>":
                           "<td>",SVBSEG07,"</td></tr>"
.
SEGSVB99  RETURN
.
.------------------------------------------------------------------------------
. SEGTFR : Report on the TFR segment                                   
.------------------------------------------------------------------------------
SEGTFR00  UNPACK   CLAIMREC,TFRSEG01,TFRSEG02,TFRSEG03,TFRSEG04,TFRSEG05:
                            TFRSEG06                               
.
          WRITE   HTMLFILE;"<tr><th>Facility Id</th>":
                           "<td>",TFRSEG01,"</td></tr>",012:
                           "<tr><th>Previous Provider days</th>":
                           "<td>",TFRSEG02,"</td></tr>",012:
                           "<tr><th>Previouse Provider Hours</th>":
                           "<td>",TFRSEG03,"</td></tr>",012:
                           "<tr><th>Service Date</th>":
                           "<td>",TFRSEG04,"</td></tr>",012:
                           "<tr><th>Transfer Code</th>":
                           "<td>",TFRSEG05,"</td></tr>",012:
                           "<tr><th>Transfer Type Code</th>":
                           "<td>",TFRSEG06,"</td></tr>"
.
SEGTFR99  RETURN
.
.------------------------------------------------------------------------------
. SEGTRG : Report on the TRG segment                                   
.------------------------------------------------------------------------------
SEGTRG00  UNPACK   CLAIMREC,TRGSEG01,TRGSEG02,TRGSEG03,TRGSEG04,TRGSEG05:
                            TRGSEG06,TRGSEG07,TRGSEG08,TRGSEG09,TRGSEG10                                   
.
          WRITE   HTMLFILE;"<tr><th>Ambulance Reference Id</th>":
                           "<td>",TRGSEG01,"</td></tr>",012:
                           "<tr><th>Charge Amount</th>":
                           "<td>",TRGSEG02,"</td></tr>",012:
                           "<tr><th>Charge Raised Code</th>":
                           "<td>",TRGSEG03,"</td></tr>",012:
                           "<tr><th>Distance (Kms)</th>":
                           "<td>",TRGSEG04,"</td></tr>",012:
                           "<tr><th>From Locality</th>":
                           "<td>",TRGSEG05,"</td></tr>",012:
                           "<tr><th>Service Date</th>":
                           "<td>",TRGSEG06,"</td></tr>",012:
                           "<tr><th>Start Time</th>":
                           "<td>",TRGSEG07,"</td></tr>",012:
                           "<tr><th>To Locality</th>":
                           "<td>",TRGSEG08,"</td></tr>",012:
                           "<tr><th>Transport Hours Mins</th>":
                           "<td>",TRGSEG09,"</td></tr>",012:
                           "<tr><th>Transport Type Code</th>":
                           "<td>",TRGSEG10,"</td></tr>"
.
SEGTRG99  RETURN
.
.------------------------------------------------------------------------------
. SEGOEH : Report on the OEH segment                                   
.------------------------------------------------------------------------------
SEGOEH00  UNPACK   CLAIMREC,OEHSEG01,OEHSEG02,OEHSEG03,OEHSEG04,OEHSEG05:
                            OEHSEG06,OEHSEG07,OEHSEG08,OEHSEG09,OEHSEG10:
                            OEHSEG11,OEHSEG12,OEHSEG13,OEHSEG14,OEHSEG15:
                            OEHSEG16,OEHSEG17,OEHSEG18,OEHSEG19,OEHSEG20
.
          WRITE   HTMLFILE;"<tr><th>OEC Type Code</th>":
                           "<td>",OEHSEG01,"</td></tr>",012:
                           "<tr><th>Submission Authorised Id</th>":
                           "<td>",OEHSEG02,"</td></tr>",012:
                           "<tr><th>Accident Date</th>":
                           "<td>",OEHSEG03,"</td></tr>",012:
                           "<tr><th>Accident Ind</th>":
                           "<td>",OEHSEG04,"</td></tr>",012:
                           "<tr><th>Account Reference ID</th>":
                           "<td>",OEHSEG05,"</td></tr>",012:
                           "<tr><th>Claim Type Code</th>":
                           "<td>",OEHSEG06,"</td></tr>",012:
                           "<tr><th>Emergency Admission Ind</th>":
                           "<td>",OEHSEG07,"</td></tr>",012:
                           "<tr><th>Facility Id</th>":
                           "<td>",OEHSEG08,"</td></tr>",012:
                           "<tr><th>Fund Brand Id</th>":
                           "<td>",OEHSEG09,"</td></tr>",012:
                           "<tr><th>Length of Stay</th>":
                           "<td>",OEHSEG10,"</td></tr>",012:
                           "<tr><th>PEA Request Id</th>":
                           "<td>",OEHSEG11,"</td></tr>",012:
                           "<tr><th>Presenting Illness Code</th>":
                           "<td>",OEHSEG12,"</td></tr>",012:
                           "<tr><th>Presenting Illness Item #</th>":
                           "<td>",OEHSEG13,"</td></tr>",012:
                           "<tr><th>Principal Provider Num</th>":
                           "<td>",OEHSEG14,"</td></tr>",012:
                           "<tr><th>Same Day Ind</th>":
                           "<td>",OEHSEG15,"</td></tr>",012:
                           "<tr><th>Sender Contact E-mail</th>":
                           "<td>",OEHSEG16,"</td></tr>",012:
                           "<tr><th>Sender Contact Person Name</th>":
                           "<td>",OEHSEG17,"</td></tr>",012:
                           "<tr><th>Sender Contact Person Phone</th>":
                           "<td>",OEHSEG18,"</td></tr>",012:
                           "<tr><th>Service Type Code</th>":
                           "<td>",OEHSEG19,"</td></tr>",012:
                           "<tr><th>iSoft Report Number</th>":
                           "<td>",OEHSEG20,"</td></tr>"
.
SEGOEH99  RETURN
.
.------------------------------------------------------------------------------
. SEGOEV : Report on the OEV segment                                   
.------------------------------------------------------------------------------
SEGOEV00  UNPACK   CLAIMREC,OEVSEG01,OEVSEG02,OEVSEG03,OEVSEG04,OEVSEG05:
                            OEVSEG06,OEVSEG07,OEVSEG08,OEVSEG09,OEVSEG10:
                            OEVSEG11,OEVSEG12,OEVSEG13,OEVSEG14,OEVSEG15:
                            OEVSEG16
.
          WRITE   HTMLFILE;"<tr><th>Admission Date</th>":
                           "<td>",OEVSEG01,"</td></tr>",012:
                           "<tr><th>Compensation Claim Ind</th>":
                           "<td>",OEVSEG02,"</td></tr>",012:
                           "<tr><th>Discharge Date</th>":
                           "<td>",OEVSEG03,"</td></tr>",012:
                           "<tr><th>Fund Payee Id</th>":
                           "<td>",OEVSEG04,"</td></tr>",012:
                           "<tr><th>Patient Alias Family Name</th>":
                           "<td>",OEVSEG05,"</td></tr>",012:
                           "<tr><th>Patient Alias First Name</th>":
                           "<td>",OEVSEG06,"</td></tr>",012:
                           "<tr><th>Patient Date of Birth</th>":
                           "<td>",OEVSEG07,"</td></tr>",012:
                           "<tr><th>Patient Family Name</th>":
                           "<td>",OEVSEG08,"</td></tr>",012:
                           "<tr><th>Patient First Name</th>":
                           "<td>",OEVSEG09,"</td></tr>",012:
                           "<tr><th>Patient Fund Membership Num</th>":
                           "<td>",OEVSEG10,"</td></tr>",012:
                           "<tr><th>Patient Fund UPI</th>":
                           "<td>",OEVSEG11,"</td></tr>",012:
                           "<tr><th>Patient Gender</th>":
                           "<td>",OEVSEG12,"</td></tr>",012:
                           "<tr><th>Patient Medicare Card Num</th>":
                           "<td>",OEVSEG13,"</td></tr>",012:
                           "<tr><th>Patient Reference Num</th>":
                           "<td>",OEVSEG14,"</td></tr>",012:
                           "<tr><th>Patient Second Initial</th>":
                           "<td>",OEVSEG15,"</td></tr>",012:
                           "<tr><th>Servicing Provider Num</th>":
                           "<td>",OEHSEG16,"</td></tr>"
.
SEGOEV99  RETURN
.
.------------------------------------------------------------------------------
. SEGOES : Report on the OES segment                                   
.------------------------------------------------------------------------------
SEGOES00  UNPACK   CLAIMREC,OESSEG01,OESSEG02,OESSEG03,OESSEG04,OESSEG05:
                            OESSEG06,OESSEG07,OESSEG08,OESSEG09,OESSEG10:
                            OESSEG11,OESSEG12,OESSEG13                   
.
          WRITE   HTMLFILE;"<tr><th>After Care Override Ind</th>":
                           "<td>",OESSEG01,"</td></tr>",012:
                           "<tr><th>Charge Amount</th>":
                           "<td>",OESSEG02,"</td></tr>",012:
                           "<tr><th>Date of Service</th>":
                           "<td>",OESSEG03,"</td></tr>",012:
                           "<tr><th>Duplicate Service Override Ind</th>":
                           "<td>",OESSEG04,"</td></tr>",012:
                           "<tr><th>Field Quantity</th>":
                           "<td>",OESSEG05,"</td></tr>",012:
                           "<tr><th>Item Number</th>":
                           "<td>",OESSEG06,"</td></tr>",012:
                           "<tr><th>Number of Patients Seen</th>":
                           "<td>",OESSEG07,"</td></tr>",012:
                           "<tr><th>Restriction Override Ind</th>":
                           "<td>",OESSEG08,"</td></tr>",012:
                           "<tr><th>Service Code</th>":
                           "<td>",OESSEG09,"</td></tr>",012:
                           "<tr><th>Service Code Type Code</th>":
                           "<td>",OESSEG10,"</td></tr>",012:
                           "<tr><th>Service Quantity</th>":
                           "<td>",OESSEG11,"</td></tr>",012:
                           "<tr><th>Service Rate</th>":
                           "<td>",OESSEG12,"</td></tr>",012:
                           "<tr><th>Time Dependant Override Ind</th>":
                           "<td>",OESSEG13,"</td></tr>"
.
SEGOES99  RETURN
.
.------------------------------------------------------------------------------
. SEGCLM : Report on the CLM segment                                   
.------------------------------------------------------------------------------
SEGCLM00  UNPACK   CLAIMREC,CLMSEG01,CLMSEG02,CLMSEG03,CLMSEG04,CLMSEG05:
                            CLMSEG06,CLMSEG07,CLMSEG08,CLMSEG09,CLMSEG10:
                            CLMSEG11,CLMSEG12,CLMSEG13,CLMSEG14,CLMSEG15:
                            CLMSEG16,CLMSEG17,CLMSEG18,CLMSEG19,CLMSEG20:
                            CLMSEG21,CLMSEG22,CLMSEG23,CLMSEG24,CLMSEG25
.
          WRITE   HTMLFILE;"<tr><th>Accident Ind</th>":
                           "<td>",CLMSEG01,"</td></tr>",012:
                           "<tr><th>Account Paid Ind</th>":
                           "<td>",CLMSEG02,"</td></tr>",012:
                           "<tr><th>Account Reference Id</th>":
                           "<td>",CLMSEG03,"</td></tr>",012:
                           "<tr><th>Bank Account Name</th>":
                           "<td>",CLMSEG04,"</td></tr>",012:
                           "<tr><th>Bank Account Number</th>":
                           "<td>",CLMSEG05,"</td></tr>",012:
                           "<tr><th>BSB Code</th>":
                           "<td>",CLMSEG06,"</td></tr>",012:
                           "<tr><th>Benefit Assign Authorised</th>":
                           "<td>",CLMSEG07,"</td></tr>",012:
                           "<tr><th>Billing Agent Id</th>":
                           "<td>",CLMSEG08,"</td></tr>",012:
                           "<tr><th>Claimant Address Line 1</th>":
                           "<td>",CLMSEG09,"</td></tr>",012:
                           "<tr><th>Claimant Address Line 2</th>":
                           "<td>",CLMSEG10,"</td></tr>",012:
                           "<tr><th>Claimant Address Locality</th>":
                           "<td>",CLMSEG11,"</td></tr>",012:
                           "<tr><th>Claimant Address Postcode</th>":
                           "<td>",CLMSEG12,"</td></tr>",012:
                           "<tr><th>Claimant Date of Birth</th>":
                           "<td>",CLMSEG13,"</td></tr>",012: 
                           "<tr><th>Claimant Family Name</th>":
                           "<td>",CLMSEG14,"</td></tr>",012: 
                           "<tr><th>Claimant First Name</th>":
                           "<td>",CLMSEG15,"</td></tr>",012: 
                           "<tr><th>Claimant Medicare Number</th>":
                           "<td>",CLMSEG16,"</td></tr>",012: 
                           "<tr><th>Claimant Reference Number</th>":
                           "<td>",CLMSEG17,"</td></tr>",012: 
                           "<tr><th>Claim Submission Authorised</th>":
                           "<td>",CLMSEG18,"</td></tr>",012: 
                           "<tr><th>Claim Type Code</th>":
                           "<td>",CLMSEG19,"</td></tr>",012: 
                           "<tr><th>Facility id</th>":
                           "<td>",CLMSEG20,"</td></tr>",012: 
                           "<tr><th>Fund Brand Id</th>":
                           "<td>",CLMSEG21,"</td></tr>",012: 
                           "<tr><th>Fund Payee Id</th>":
                           "<td>",CLMSEG22,"</td></tr>",012: 
                           "<tr><th>Principal Provider Number</th>":
                           "<td>",CLMSEG23,"</td></tr>",012: 
                           "<tr><th>Sender Contact Person Phone</th>":
                           "<td>",CLMSEG24,"</td></tr>",012: 
                           "<tr><th>Sender Contact Person Name</th>":
                           "<td>",CLMSEG25,"</td></tr>"
.
SEGCLM99  RETURN
.
.
.------------------------------------------------------------------------------
. SEGVCH : Report on the VCH (IMC Voucher) segment                                   
.------------------------------------------------------------------------------
SEGVCH00  UNPACK   CLAIMREC,VCHSEG01,VCHSEG02,VCHSEG03,VCHSEG04,VCHSEG05:
                            VCHSEG06,VCHSEG07,VCHSEG08,VCHSEG09,VCHSEG10:
                            VCHSEG11,VCHSEG12,VCHSEG13,VCHSEG14,VCHSEG15:
                            VCHSEG16,VCHSEG17,VCHSEG18,VCHSEG19,VCHSEG20:
                            VCHSEG21,VCHSEG22,VCHSEG23,VCHSEG24,VCHSEG25:
                            VCHSEG26
.
          WRITE   HTMLFILE;"<tr><th>Admission Date</th>":
                           "<td>",VCHSEG01,"</td></tr>",012:
                           "<tr><th>Compensated Claim Ind</th>":
                           "<td>",VCHSEG02,"</td></tr>",012:
                           "<tr><th>Discharge Date</th>":
                           "<td>",VCHSEG03,"</td></tr>",012:
                           "<tr><th>Financial Interest Disclosure Ind</th>":
                           "<td>",VCHSEG04,"</td></tr>",012:
                           "<tr><th>IFC Issue Code</th>":
                           "<td>",VCHSEG05,"</td></tr>",012:
                           "<tr><th>Patient Alias Family Name</th>":
                           "<td>",VCHSEG06,"</td></tr>",012:
                           "<tr><th>Patient Alias First Name</th>":
                           "<td>",VCHSEG07,"</td></tr>",012:
                           "<tr><th>Patient Date of Birth</th>":
                           "<td>",VCHSEG08,"</td></tr>",012:
                           "<tr><th>Patient Family Name</th>":
                           "<td>",VCHSEG09,"</td></tr>",012:
                           "<tr><th>Patient First Name</th>":
                           "<td>",VCHSEG10,"</td></tr>",012:
                           "<tr><th>Patient Fund Membership No.</th>":
                           "<td>",VCHSEG11,"</td></tr>",012:
                           "<tr><th>Patient Fund UPI</th>":
                           "<td>",VCHSEG12,"</td></tr>",012:
                           "<tr><th>Patient Gender</th>":
                           "<td>",VCHSEG13,"</td></tr>",012:
                           "<tr><th>Patient Medicare Card No.</th>":
                           "<td>",VCHSEG14,"</td></tr>",012:
                           "<tr><th>Patient Reference Num</th>":
                           "<td>",VCHSEG15,"</td></tr>",012:
                           "<tr><th>Patient Second Initial</th>":
                           "<td>",VCHSEG16,"</td></tr>",012:
                           "<tr><th>Referral Period Type Code</th>":
                           "<td>",VCHSEG17,"</td></tr>",012:
                           "<tr><th>Referral Issue Date</th>":
                           "<td>",VCHSEG18,"</td></tr>",012:
                           "<tr><th>Referral Override Type Code</th>":
                           "<td>",VCHSEG19,"</td></tr>",012:
                           "<tr><th>Referral Period</th>":
                           "<td>",VCHSEG20,"</td></tr>",012:
                           "<tr><th>Referring Provider No.</th>":
                           "<td>",VCHSEG21,"</td></tr>",012:
                           "<tr><th>Request Issue Date</th>":
                           "<td>",VCHSEG22,"</td></tr>",012:
                           "<tr><th>Requesting Provider No.</th>":
                           "<td>",VCHSEG23,"</td></tr>",012:
                           "<tr><th>Request Type Code</th>":
                           "<td>",VCHSEG24,"</td></tr>",012:
                           "<tr><th>Service Type Code</th>":
                           "<td>",VCHSEG25,"</td></tr>",012:
                           "<tr><th>Servicing Provider No.</th>":
                           "<td>",VCHSEG26,"</td></tr>"
.
SEGVCH99  RETURN
.
.------------------------------------------------------------------------------
. SEGSRV : Report on the SRV (IMC service) segment                                   
.------------------------------------------------------------------------------
SEGSRV00  UNPACK   CLAIMREC,SRVSEG01,SRVSEG02,SRVSEG03,SRVSEG04,SRVSEG05:
                            SRVSEG06,SRVSEG07,SRVSEG08,SRVSEG09,SRVSEG10:
                            SRVSEG11,SRVSEG12,SRVSEG13,SRVSEG14,SRVSEG15:
                            SRVSEG16,SRVSEG17,SRVSEG18,SRVSEG19,SRVSEG20 
.
          WRITE   HTMLFILE;"<tr><th>Accession Date/Time</th>":
                           "<td>",SRVSEG01,"</td></tr>",012:
                           "<tr><th>After Care Over Ind</th>":
                           "<td>",SRVSEG02,"</td></tr>",012:
                           "<tr><th>Charge Amount</th>":
                           "<td>",SRVSEG03,"</td></tr>",012:
                           "<tr><th>Collection Date/Time</th>":
                           "<td>",SRVSEG04,"</td></tr>",012:
                           "<tr><th>Date of Service</th>":
                           "<td>",SRVSEG05,"</td></tr>",012:
                           "<tr><th>Duplicated Service Override Ind</th>":
                           "<td>",SRVSEG06,"</td></tr>",012:
                           "<tr><th>Equipment Id</th>":
                           "<td>",SRVSEG07,"</td></tr>",012:
                           "<tr><th>Field Quantity</th>":
                           "<td>",SRVSEG08,"</td></tr>",012:
                           "<tr><th>Item Num</th>":
                           "<td>",SRVSEG09,"</td></tr>",012:
                           "<tr><th>LSP Number</th>":
                           "<td>",SRVSEG10,"</td></tr>",012:
                           "<tr><th>Multiple Procedure Override Ind</th>":
                           "<td>",SRVSEG11,"</td></tr>",012:
                           "<tr><th>No of Patients Seen</th>":
                           "<td>",SRVSEG12,"</td></tr>",012:
                           "<tr><th>Restricted Override Code</th>":
                           "<td>",SRVSEG13,"</td></tr>",012:
                           "<tr><th>Rule 3 Exempt Ind</th>":
                           "<td>",SRVSEG14,"</td></tr>",012:
                           "<tr><th>S4B3 Exempt Ind</th>":
                           "<td>",SRVSEG15,"</td></tr>",012:
                           "<tr><th>SCP Id</th>":
                           "<td>",SRVSEG16,"</td></tr>",012:
                           "<tr><th>Self Deemed Code</th>":
                           "<td>",SRVSEG17,"</td></tr>",012:
                           "<tr><th>Service text</th>":
                           "<td>",SRVSEG18,"</td></tr>",012:
                           "<tr><th>Time Duration</th>":
                           "<td>",SRVSEG19,"</td></tr>",012:
                           "<tr><th>Time of Service</th>":
                           "<td>",SRVSEG20,"</td></tr>"
.
SEGSRV99  RETURN
.
.------------------------------------------------------------------------------
. Get Eclipse Store and Forward (STF)   file list
.------------------------------------------------------------------------------
STFFLS00  CLEAR     TFILENM                      * set up temp file name
          APPEND    "tweb62.",TFILENM
          APPEND    TFNPID,TFILENM
          APPEND    ".txt",TFILENM
          RESET     TFILENM
          CLEAR     EXECCMD
          APPEND    "ls -1t ",EXECCMD            * set up ls command
.                                                * (note it's reverse date order)
.                                 * now get the name of the output directory
          READ      CONTROLF,HUND27;*61,PTCNESFI
          SQUEEZE   PTCNESFI
          MOVELPTR  PTCNESFI,F3                  * get length of output dir string
          IF        F3 > 0
            SUBTRACT  ONE,F3
            BUMP      PTCNESFI,F3                * go to last char of string
            CMATCH    "/",PTCNESFI               * is last char a '/'?
            GOTO      STFFLS10 IF EQUAL
            APPEND    "/",PTCNESFI
          ENDIF
.
STFFLS10  RESET     PTCNESFI
          SQUEEZE   PTCNESFI
          MOVELPTR  PTCNESFI,F3                  * get length of output dir string
.
          APPEND    PTCNESFI,EXECCMD
          APPEND    "*.txt > ",EXECCMD
          APPEND    TFILENM,EXECCMD
          RESET     EXECCMD
          EXECUTE   EXECCMD,TASKID
.
          MOVELPTR  PTCNESFI,F3                  * get length of target dir
.
          MOVE      ZERO,FILECNT
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FILELIST,TFILENM
          TRAPCLR   IO
          BRANCH    OVRCD,STFFLS90
.
STFFLS20  PACK      FILEPATH,SP70,SP70
          READ      FILELIST,SEQ;FILEPATH
          GOTO      STFFLS90 IF OVER
.
          BUMP      FILEPATH,F3
          MOVE      FILEPATH,DIM19
.
          RESET     FILEPATH
          MOVELPTR  DIM19,F2                * strip off '.txt'
          SUBTRACT  FOUR,F2
          SETLPTR   DIM19,F2
          STRIP     FILEPATH
          MOVE      DIM19,DIM12
.
          WRITE     HTMLFILE;*+,"<a class=#"linkbox#"":
                    " href=#"patweb62.pbl?reportno=3&template=10":
                    "&eclmfile=",DIM12:
                    "&filepath=",FILEPATH:
                    "#">",DIM12,"</a>"
          ADD       ONE,FILECNT
          GOTO      STFFLS20
.
STFFLS90  CLOSE     FILELIST,DELETE
          MOVE      FILECNT,SEGNO
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;*+,"<div class=#"hdrbox#">",SEGNO:
                             " files found.</div>"
.
STFFLS99  RETURN
.
.------------------------------------------------------------------------------
. Process STF  File
.------------------------------------------------------------------------------
STFFIL00  WRITE     HTMLFILE;"<div id=#"col1#">",012
.
.
. Note: this code is cloned from the original IHCFIL00, hence the use of a 'claim' count.
. It's not worth a new declaration as the two pieces of code will never conflict, so it's safe.
.
          MOVE      ZERO,CLMCOUNT                     * clear counters
          MOVE      ZERO,SEGCOUNT
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EXTRFILE,FILEPATH,RDONLY
          TRAPCLR   IO
          IF        OVRCD = 1
            STRIP     FILEPATH
            WRITE     HTMLFILE;*+,"<p class=#"Red#"><strong>Error: </strong>":
                               "File ",FILEPATH," not found.</p>"
            GOTO      STFFIL99
          ENDIF
.
          CALL      P1STF000                         * first pass of STF file
          CLOSE     EXTRFILE
          OPEN      EXTRFILE,FILEPATH,RDONLY
          MOVE      ZERO,SEGCOUNT
          CALL      P2STF000                          * second pass of STF file
.
          CLOSE     EXTRFILE
.
.
STFFIL99  WRITE    HTMLFILE;"</div>",012
          RETURN
.
.
.------------------------------------------------------------------------------
. First pass of STF File
.------------------------------------------------------------------------------
P1STF000  READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          GOTO      P1STF999 IF OVER
.
          ADD       ONE,SEGCOUNT                     * count the segment
          MATCH     "HDR",SEGMENT
          GOTO       P1STF000 IF EQUAL               * ignore header  segments
.
          MATCH     "TLR",SEGMENT
          GOTO       P1STF000 IF EQUAL               * ignore trailer segments
.
          MATCH     "CLM",SEGMENT
          IF        @EQUAL
            CALL      STFBLK00                       * build the claim block
            GOTO      P1STF000
          ENDIF
.
          MOVE      SEGCOUNT,SEGNO                   * just link to the segment
          REPLACE   " 0",SEGNO
          WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
                    " onmouseover=#"showseg(this)#">",SEGMENT,"</div><br />",012
          GOTO      P1STF000
.
P1STF999  RETURN
.
.------------------------------------------------------------------------------
. Second  pass of STF File
.------------------------------------------------------------------------------
P2STF000  READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          GOTO      P2STF999 IF OVER
.
          ADD       ONE,SEGCOUNT                     * count the segment

          MATCH     "HDR",SEGMENT
          GOTO       P2STF000 IF EQUAL               * ignore header  segments
.
          MATCH     "TLR",SEGMENT
          GOTO       P2STF000 IF EQUAL               * ignore trailer segments
.
          MOVE      SEGCOUNT,SEGNO                   * write the div header
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;"<div class=#"nodisplay#" id=#"seg",SEGNO,"#">":
                    012,"<table class=#"segment#">",012:
                    "<tr><th>Segment</th><td>",SEGMENT,"</td></tr>"
.
          MATCH     "CLM",SEGMENT
          IF        @EQUAL
            CALL      SEGCLS00                       * build the CLM segment
            GOTO      P2STF900
          ENDIF
.
          MATCH     "VCH",SEGMENT
          IF        @EQUAL
            CALL      SEGVCS00                       * build the VCH segment
            GOTO      P2STF900
          ENDIF
.
          MATCH     "SRV",SEGMENT
          IF        @EQUAL
            CALL      SEGSRS00                       * build the SRV segment
            GOTO      P2STF900
          ENDIF
.
P2STF900  WRITE     HTMLFILE;"</table>",012,"</div>",012    * end the segement div
          GOTO      P2STF000
.
P2STF999  RETURN
.
.------------------------------------------------------------------------------
. STFBLK : build a div for each inpatient claim  and start a div for segments
.------------------------------------------------------------------------------
STFBLK00  UNPACK   CLAIMREC,CLMSES01,CLMSES02,CLMSES03,CLMSES04,CLMSES05:
                            CLMSES06,CLMSES07,CLMSES08,CLMSES09,CLMSES10:
                            CLMSES11,CLMSES12,CLMSES13,CLMSES14,CLMSES15:
                            CLMSES16,CLMSES17,CLMSES18,CLMSES19,CLMSES20
.
.
          IF       CLMCOUNT > 0
            WRITE    HTMLFILE;"</div></div>",012     *end previous stf block
          ENDIF
          ADD      ONE,CLMCOUNT
          MOVE     CLMCOUNT,CLMNO
          REPLACE  " 0",CLMNO
.

          MOVE      SEGCOUNT,SEGNO
          REPLACE  " 0",SEGNO
.
.         PACK      VCHSES09,SP70
.         PACK      VCHSES10,SP70
.
.         READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
.         MATCH     "VCH",SEGMENT
.         IF        @EQUAL
.           UNPACK   CLAIMREC,VCHSES01,VCHSES02,VCHSES03,VCHSES04,VCHSES05:
.                             VCHSES06,VCHSES07,VCHSES08,VCHSES09,VCHSES10
.         ENDIF
.         STRIP     VCHSES09
.         STRIP     VCHSES10
.
          STRIP     CLMSES02
          STRIP     CLMSES19
          STRIP     CLMSES20
          WRITE     HTMLFILE;*+,"<div class=#"eclaim#" id=#"c",CLMNO,"#"":
                    " onmouseover=#"showcsegs(this);#">",012:
                    CLMSES20," ",CLMSES19,"<br />",012:
                    "Inv: ",CLMSES02,"<br />",012:
                    "<div class=#"nodisplay#" id=#"clm",CLMNO,"#">"
.         WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
.                   " onmouseover=#"showseg(this)#">CLM</div><br />"
.
.         ADD       ONE,SEGCOUNT
.         MOVE      SEGCOUNT,SEGNO
.         REPLACE  " 0",SEGNO
.
          WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
                    " onmouseover=#"showseg(this)#">",SEGMENT,"</div><br />"
.
STFBLK99  RETURN
.------------------------------------------------------------------------------
. SEGCLS : Report on the CLM segment
.------------------------------------------------------------------------------
SEGCLS00  UNPACK   CLAIMREC,CLMSES01,CLMSES02,CLMSES03,CLMSES04,CLMSES05:
                            CLMSES06,CLMSES07,CLMSES08,CLMSES09,CLMSES10:
                            CLMSES11,CLMSES12,CLMSES13,CLMSES14,CLMSES15:
                            CLMSES16,CLMSES17,CLMSES18,CLMSES19,CLMSES20:
                            CLMSES21,CLMSES22,CLMSES23,CLMSES24,CLMSES25:
                            CLMSES26,CLMSES27
.
          WRITE   HTMLFILE;"<tr><th>Account Paid Ind</th>":
                           "<td>",CLMSES01,"</td></tr>",012:
                           "<tr><th>Account Reference Id</th>":
                           "<td>",CLMSES02,"</td></tr>",012:
                           "<tr><th>Bank Account Name</th>":
                           "<td>",CLMSES03,"</td></tr>",012:
                           "<tr><th>Bank Account Number</th>":
                           "<td>",CLMSES04,"</td></tr>",012:
                           "<tr><th>BSB Code</th>":
                           "<td>",CLMSES05,"</td></tr>",012:
                           "<tr><th>Claimant Address Line 1</th>":
                           "<td>",CLMSES06,"</td></tr>",012:
                           "<tr><th>Claimant Address Line 2</th>":
                           "<td>",CLMSES07,"</td></tr>",012:
                           "<tr><th>Claimant Address Locality</th>":
                           "<td>",CLMSES08,"</td></tr>",012:
                           "<tr><th>Claimant Address Postcode</th>":
                           "<td>",CLMSES09,"</td></tr>",012:
                           "<tr><th>Claimant Date of Birth</th>":
                           "<td>",CLMSES10,"</td></tr>",012:
                           "<tr><th>Claimant Family Name</th>":
                           "<td>",CLMSES11,"</td></tr>",012:
                           "<tr><th>Claimant First Name</th>":
                           "<td>",CLMSES12,"</td></tr>",012:
                           "<tr><th>Claimant Medicare Number</th>":
                           "<td>",CLMSES13,"</td></tr>",012:
                           "<tr><th>Claimant Reference Number</th>":
                           "<td>",CLMSES14,"</td></tr>",012:
                           "<tr><th>Claim Submission Authorised<</th>":
                           "<td>",CLMSES15,"</td></tr>",012:
                           "<tr><th>Contact Phone Num</th>":
                           "<td>",CLMSES16,"</td></tr>",012:
                           "<tr><th>Date of Lodgement</th>":
                           "<td>",CLMSES17,"</td></tr>",012:
                           "<tr><th>Patient Date of Birth</th>":
                           "<td>",CLMSES18,"</td></tr>",012:
                           "<tr><th>Patient Family Name</th>":
                           "<td>",CLMSES19,"</td></tr>",012:
                           "<tr><th>Patient First Name</th>":
                           "<td>",CLMSES20,"</td></tr>",012:
                           "<tr><th>Patient Medicare Number</th>":
                           "<td>",CLMSES21,"</td></tr>",012:
                           "<tr><th>Patient Reference Number</th>":
                           "<td>",CLMSES22,"</td></tr>",012:
                           "<tr><th>Payee Provider Number</th>":
                           "<td>",CLMSES23,"</td></tr>",012:
                           "<tr><th>Servicing Provider Number</th>":
                           "<td>",CLMSES24,"</td></tr>",012:
                           "<tr><th>Time of Ledgement</th>":
                           "<td>",CLMSES25,"</td></tr>",012:
                           "<tr><th>Transaction Id</th>":
                           "<td>",CLMSES26,"</td></tr>":
                     "<tr><th>Module Emergency (1) or Private Practice (2)</th>":
                           "<td>",CLMSES27,"</td></tr>"
.
SEGCLS99  RETURN
+
.------------------------------------------------------------------------------
. SEGVCS : Report on the VCH (VCS Voucher) segment                              
.------------------------------------------------------------------------------
SEGVCS00  UNPACK   CLAIMREC,VCHSES01,VCHSES02,VCHSES03,VCHSES04,VCHSES05:
                            VCHSES06,VCHSES07
.
          WRITE   HTMLFILE;"<tr><th>Date of Service</th>":
                           "<td>",VCHSES01,"</td></tr>",012:
                           "<tr><th>Time of Service</th>":
                           "<td>",VCHSES02,"</td></tr>",012:
                           "<tr><th>Referral Override Type Code</th>":
                           "<td>",VCHSES03,"</td></tr>",012:
                           "<tr><th>Referring/Requesting Provider Number</th>":
                           "<td>",VCHSES04,"</td></tr>",012:
                           "<tr><th>Referral/Request Issue Date</th>":
                           "<td>",VCHSES05,"</td></tr>",012:
                           "<tr><th>Referral Period Type Code</th>":
                           "<td>",VCHSES06,"</td></tr>",012:
                           "<tr><th>Request Type Code</th>":
                           "<td>",VCHSES07,"</td></tr>"
.
SEGVCS99  RETURN
.
.------------------------------------------------------------------------------
. SEGSRS : Report on the SRV (PCS service) segment                              
.------------------------------------------------------------------------------
SEGSRS00  UNPACK   CLAIMREC,SRVSES01,SRVSES02,SRVSES03,SRVSES04,SRVSES05:
                            SRVSES06,SRVSES07,SRVSES08,SRVSES09,SRVSES10:
                            SRVSES11,SRVSES12,SRVSES13,SRVSES14,SRVSES15:
                            SRVSES16,SRVSES17,SRVSES18,SRVSES19,SRVSES20
.
          WRITE   HTMLFILE;"<tr><th>Accession Date/Time</th>":
                           "<td>",SRVSES01,"</td></tr>",012:
                           "<tr><th>After Care Over Ind</th>":
                           "<td>",SRVSES02,"</td></tr>",012:
                           "<tr><th>Collection Date/Time</th>":
                           "<td>",SRVSES03,"</td></tr>",012:
                           "<tr><th>Charge Amount</th>":
                           "<td>",SRVSES04,"</td></tr>",012:
                           "<tr><th>Duplicated Service Override Ind</th>":
                           "<td>",SRVSES05,"</td></tr>",012:
                           "<tr><th>EquipmentId</th>":
                           "<td>",SRVSES06,"</td></tr>",012:
                           "<tr><th>Field Quantity</th>":
                           "<td>",SRVSES07,"</td></tr>",012:
                           "<tr><th>Hospital Ind</th>":
                           "<td>",SRVSES08,"</td></tr>",012:
                           "<tr><th>Item Num</th>":
                           "<td>",SRVSES09,"</td></tr>",012:
                           "<tr><th>SCP Id</th>":
                           "<td>",SRVSES10,"</td></tr>",012:
                           "<tr><th>LSP Num</th>":
                           "<td>",SRVSES11,"</td></tr>",012:
                           "<tr><th>Multiple Procedure Override Ind</th>":
                           "<td>",SRVSES12,"</td></tr>",012:
                           "<tr><th>No Of Patients Seen</th>":
                           "<td>",SRVSES13,"</td></tr>",012:
                           "<tr><th>Patient Contribution Amount</th>":
                           "<td>",SRVSES14,"</td></tr>",012:
                           "<tr><th>Restrictive Override Code</th>":
                           "<td>",SRVSES15,"</td></tr>",012:
                           "<tr><th>Rule 3 Exempt Ind</th>":
                           "<td>",SRVSES16,"</td></tr>",012:
                           "<tr><th>S4b3 Exempt Ind</th>":
                           "<td>",SRVSES17,"</td></tr>",012:
                           "<tr><th>Self Deemed Code</th>":
                           "<td>",SRVSES18,"</td></tr>",012:
                           "<tr><th>Service Text</th>":
                           "<td>",SRVSES19,"</td></tr>",012:
                           "<tr><th>Time Duration</th>":
                           "<td>",SRVSES20,"</td></tr>"
.
SEGSRS99  RETURN
.
.------------------------------------------------------------------------------
. Get Eclipse Bulk Billing      (DBS)   file list
.------------------------------------------------------------------------------
DBSFLS00  CLEAR     TFILENM                      * set up temp file name
          APPEND    "tweb62.",TFILENM
          APPEND    TFNPID,TFILENM
          APPEND    ".txt",TFILENM
          RESET     TFILENM
          CLEAR     EXECCMD
          APPEND    "ls -1t ",EXECCMD            * set up ls command
.                                                * (note it's reverse date order)
.                                 * now get the name of the output directory
          READ      CONTROLF,HUND27;*183,PTCNEDBI
          SQUEEZE   PTCNEDBI
          MOVELPTR  PTCNEDBI,F3                  * get length of output dir string
          IF        F3 > 0
            SUBTRACT  ONE,F3
            BUMP      PTCNEDBI,F3                * go to last char of string
            CMATCH    "/",PTCNEDBI               * is last char a '/'?
            GOTO      DBSFLS10 IF EQUAL
            APPEND    "/",PTCNEDBI
          ENDIF
.
DBSFLS10  RESET     PTCNEDBI
          SQUEEZE   PTCNEDBI
          MOVELPTR  PTCNEDBI,F3                  * get length of output dir string
.
          APPEND    PTCNEDBI,EXECCMD
          APPEND    "*.txt > ",EXECCMD
          APPEND    TFILENM,EXECCMD
          RESET     EXECCMD
          EXECUTE   EXECCMD,TASKID
.
          MOVELPTR  PTCNEDBI,F3                  * get length of target dir
.
          MOVE      ZERO,FILECNT
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FILELIST,TFILENM
          TRAPCLR   IO
          BRANCH    OVRCD,DBSFLS90
.
DBSFLS20  PACK      FILEPATH,SP70,SP70
          READ      FILELIST,SEQ;FILEPATH
          GOTO      DBSFLS90 IF OVER
.
          BUMP      FILEPATH,F3
          MOVE      FILEPATH,DIM19
.
          RESET     FILEPATH
          MOVELPTR  DIM19,F2                * strip off '.txt'
          SUBTRACT  FOUR,F2
          SETLPTR   DIM19,F2
          STRIP     FILEPATH
          MOVE      DIM19,DIM12
.
          WRITE     HTMLFILE;*+,"<a class=#"linkbox#"":
                    " href=#"patweb62.pbl?reportno=3&template=12":
                    "&eclmfile=",DIM12:
                    "&filepath=",FILEPATH:
                    "#">",DIM12,"</a>"
          ADD       ONE,FILECNT
          GOTO      DBSFLS20
.
DBSFLS90  CLOSE     FILELIST,DELETE
          MOVE      FILECNT,SEGNO
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;*+,"<div class=#"hdrbox#">",SEGNO:
                             " files found.</div>"
.
DBSFLS99  RETURN
.
.------------------------------------------------------------------------------
. Process DBS  File
.------------------------------------------------------------------------------
DBSFIL00  WRITE     HTMLFILE;"<div id=#"col1#">",012
.
.
. Note: this code is cloned from the original IHCFIL00, hence the use of a 'claim' count.
. It's not worth a new declaration as the two pieces of code will never conflict, so it's safe.
.
          MOVE      ZERO,CLMCOUNT                     * clear counters
          MOVE      ZERO,SEGCOUNT
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EXTRFILE,FILEPATH,RDONLY
          TRAPCLR   IO
          IF        OVRCD = 1
            STRIP     FILEPATH
            WRITE     HTMLFILE;*+,"<p class=#"Red#"><strong>Error: </strong>":
                               "File ",FILEPATH," not found.</p>"
            GOTO      DBSFIL99
          ENDIF
.
          CALL      P1DBS000                         * first pass of STF file
          CLOSE     EXTRFILE
          OPEN      EXTRFILE,FILEPATH,RDONLY
          MOVE      ZERO,SEGCOUNT
          CALL      P2DBS000                          * second pass of STF file
.
          CLOSE     EXTRFILE
.
.
DBSFIL99  WRITE    HTMLFILE;"</div>",012
          RETURN
.
.------------------------------------------------------------------------------
. First pass of DBS File
.------------------------------------------------------------------------------
P1DBS000  READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          GOTO      P1DBS999 IF OVER
.
          ADD       ONE,SEGCOUNT                     * count the segment
          MATCH     "HDR",SEGMENT
          GOTO       P1DBS000 IF EQUAL               * ignore header  segments
.
          MATCH     "TLR",SEGMENT
          GOTO       P1DBS000 IF EQUAL               * ignore trailer segments
.
          MATCH     "CLM",SEGMENT
          IF        @EQUAL
            CALL      DBSBLK00                       * build the claim block
            GOTO      P1DBS000
          ENDIF
.
          MOVE      SEGCOUNT,SEGNO                   * just link to the segment
          REPLACE   " 0",SEGNO
          WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
                    " onmouseover=#"showseg(this)#">",SEGMENT,"</div><br />",012
          GOTO      P1DBS000
.
P1DBS999  RETURN
.
.------------------------------------------------------------------------------
. DBSBLK : build a div for each inpatient claim  and start a div for segments
.------------------------------------------------------------------------------
DBSBLK00  UNPACK   CLAIMREC,CLMSEB01,CLMSEB02,CLMSEB03,CLMSEB04,CLMSEB05:
                            CLMSEB06,CLMSEB07,CLMSEB08
.
.
          IF       CLMCOUNT > 0
            WRITE    HTMLFILE;"</div></div>",012     *end previous stf block
          ENDIF
          ADD      ONE,CLMCOUNT
          MOVE     CLMCOUNT,CLMNO
          REPLACE  " 0",CLMNO
.

          MOVE      SEGCOUNT,SEGNO
          REPLACE  " 0",SEGNO
.
          PACK      VCHSEB04,SP70
          PACK      VCHSEB05,SP70
.
          READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          MATCH     "VCH",SEGMENT
          IF        @EQUAL
            UNPACK   CLAIMREC,VCHSEB01,VCHSEB02,VCHSEB03,VCHSEB04,VCHSEB05 
          ENDIF
          STRIP     VCHSEB04
          STRIP     VCHSEB05
.
          STRIP     CLMSEB07
          WRITE     HTMLFILE;*+,"<div class=#"eclaim#" id=#"c",CLMNO,"#"":
                    " onmouseover=#"showcsegs(this);#">",012:
                    VCHSEB05," ",VCHSEB04,"<br />",012:
                    "Inv: ",CLMSEB07,"<br />",012:
                    "<div class=#"nodisplay#" id=#"clm",CLMNO,"#">"
          WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
                    " onmouseover=#"showseg(this)#">CLM</div><br />"
.
          ADD       ONE,SEGCOUNT
          MOVE      SEGCOUNT,SEGNO
          REPLACE  " 0",SEGNO
.
          WRITE     HTMLFILE;"<div class=#"eclaimseg#" id=#"s",SEGNO,"#" ":
                    " onmouseover=#"showseg(this)#">",SEGMENT,"</div><br />"
.
DBSBLK99  RETURN
.
.------------------------------------------------------------------------------
. Second  pass of DBS File
.------------------------------------------------------------------------------
P2DBS000  READ      EXTRFILE,SEQ;TILDE,SEGMENT,CLAIMREC
          GOTO      P2DBS999 IF OVER
.
          ADD       ONE,SEGCOUNT                     * count the segment

          MATCH     "HDR",SEGMENT
          GOTO       P2DBS000 IF EQUAL               * ignore header  segments
.
          MATCH     "TLR",SEGMENT
          GOTO       P2DBS000 IF EQUAL               * ignore trailer segments
.
          MOVE      SEGCOUNT,SEGNO                   * write the div header
          REPLACE  " 0",SEGNO
          WRITE     HTMLFILE;"<div class=#"nodisplay#" id=#"seg",SEGNO,"#">":
                    012,"<table class=#"segment#">",012:
                    "<tr><th>Segment</th><td>",SEGMENT,"</td></tr>"
.
          MATCH     "CLM",SEGMENT
          IF        @EQUAL
            CALL      SEGCLB00                       * build the CLM segment
            GOTO      P2DBS900
          ENDIF
.
          MATCH     "VCH",SEGMENT
          IF        @EQUAL
            CALL      SEGVCB00                       * build the VCH segment
            GOTO      P2DBS900
          ENDIF
.
          MATCH     "SRV",SEGMENT
          IF        @EQUAL
            CALL      SEGSRB00                       * build the SRV segment
            GOTO      P2DBS900
          ENDIF
.
P2DBS900  WRITE     HTMLFILE;"</table>",012,"</div>",012    * end the segement div
          GOTO      P2DBS000
.
P2DBS999  RETURN
.
.------------------------------------------------------------------------------
. SEGCLB : Report on the CLM segment
.------------------------------------------------------------------------------
SEGCLB00  UNPACK   CLAIMREC,CLMSEB01,CLMSEB02,CLMSEB03,CLMSEB04,CLMSEB05:
                            CLMSEB06,CLMSEB07,CLMSEB08
.
          WRITE   HTMLFILE;"<tr><th>Authorisation Date</th>":
                           "<td>",CLMSEB01,"</td></tr>",012:
                           "<tr><th>Pms Claim Id</th>":
                           "<td>",CLMSEB02,"</td></tr>",012:
                           "<tr><th>Servicing Provider Number</th>":
                           "<td>",CLMSEB03,"</td></tr>",012:
                           "<tr><th>Payee Provider Number</th>":
                           "<td>",CLMSEB04,"</td></tr>",012:
                           "<tr><th>Service Type Code</th>":
                           "<td>",CLMSEB05,"</td></tr>",012:
                           "<tr><th>Transaction Id</th>":
                           "<td>",CLMSEB06,"</td></tr>",012:
                           "<tr><th>Account Reference Number</th>":
                           "<td>",CLMSEB07,"</td></tr>",012:
                     "<tr><th>Module Emergency (1) or Private Practice (2) or Outpatients (3)</th>":
                           "<td>",CLMSEB08,"</td></tr>"
.
SEGCLB99  RETURN
+
.------------------------------------------------------------------------------
. SEGVCB : Report on the VCH (VCS Voucher) segment
.------------------------------------------------------------------------------
SEGVCB00  UNPACK   CLAIMREC,VCHSEB01,VCHSEB02,VCHSEB03,VCHSEB04,VCHSEB05:
                            VCHSEB06,VCHSEB07,VCHSEB08,VCHSEB09,VCHSEB10:
                            VCHSEB11,VCHSEB12,VCHSEB13
.
          WRITE   HTMLFILE;"<tr><th>Benefit Assignment Authorised</th>":
                           "<td>",VCHSEB01,"</td></tr>",012:
                           "<tr><th>Date Of Service</th>":
                           "<td>",VCHSEB02,"</td></tr>",012:
                           "<tr><th>Patient Date Of Birth</th>":
                           "<td>",VCHSEB03,"</td></tr>",012:
                           "<tr><th>Patient Family Name</th>":
                           "<td>",VCHSEB04,"</td></tr>",012:
                           "<tr><th>Patient First Name</th>":
                           "<td>",VCHSEB05,"</td></tr>",012:
                           "<tr><th>Patient Medicare Card Num</th>":
                           "<td>",VCHSEB06,"</td></tr>",012:
                           "<tr><th>Patient Reference Num</th>":
                           "<td>",VCHSEB07,"</td></tr>",012:
                           "<tr><th>Referral Override Type Cde</th>":
                           "<td>",VCHSEB08,"</td></tr>",012:
                           "<tr><th>Referring Provider Num/Requesting Provider Num</th>":
                           "<td>",VCHSEB09,"</td></tr>",012:
                           "<tr><th>Referral Issue Date/Request Issue Date</th>":
                           "<td>",VCHSEB10,"</td></tr>",012:
                           "<tr><th>Referral Period Type Cde</th>":
                           "<td>",VCHSEB11,"</td></tr>",012:
                           "<tr><th>Request Type Cde</th>":
                           "<td>",VCHSEB12,"</td></tr>",012:
                           "<tr><th>Time Of Service</th>":
                           "<td>",VCHSEB13,"</td></tr>"
.
SEGVCB99  RETURN
+
.------------------------------------------------------------------------------
. SEGSRB : Report on the SRV (SRB service) segment
.------------------------------------------------------------------------------
SEGSRB00  UNPACK   CLAIMREC,SRVSEB01,SRVSEB02,SRVSEB03,SRVSEB04,SRVSEB05:
                            SRVSEB06,SRVSEB07,SRVSEB08,SRVSEB09,SRVSEB10:
                            SRVSEB11,SRVSEB12,SRVSEB13,SRVSEB14,SRVSEB15:
                            SRVSEB16,SRVSEB17,SRVSEB18,SRVSEB19
.
          WRITE   HTMLFILE;"<tr><th>AccessionDateTime</th>":
                           "<td>",SRVSEB01,"</td></tr>",012:
                           "<tr><th>AfterCareOverrideInd</th>":
                           "<td>",SRVSEB02,"</td></tr>",012:
                           "<tr><th>ChargeAmount</th>":
                           "<td>",SRVSEB03,"</td></tr>",012:
                           "<tr><th>CollectionDateTime</th>":
                           "<td>",SRVSEB04,"</td></tr>",012:
                           "<tr><th>DuplicateServiceOverrideInd</th>":
                           "<td>",SRVSEB05,"</td></tr>",012:
                           "<tr><th>EquipmentId</th>":
                           "<td>",SRVSEB06,"</td></tr>",012:
                           "<tr><th>FieldQuantity</th>":
                           "<td>",SRVSEB07,"</td></tr>",012:
                           "<tr><th>HospitalInd</th>":
                           "<td>",SRVSEB08,"</td></tr>",012:
                           "<tr><th>ItemNum</th>":
                           "<td>",SRVSEB09,"</td></tr>",012:
                           "<tr><th>SCPId</th>":
                           "<td>",SRVSEB10,"</td></tr>",012:
                           "<tr><th>LSPNum</th>":
                           "<td>",SRVSEB11,"</td></tr>",012:
                           "<tr><th>MultipleProcedureOverrideInd</th>":
                           "<td>",SRVSEB12,"</td></tr>",012:
                           "<tr><th>NoOfPatientsSeen</th>":
                           "<td>",SRVSEB13,"</td></tr>",012:
                           "<tr><th>RestrictiveOverrideCde</th>":
                           "<td>",SRVSEB14,"</td></tr>",012:
                           "<tr><th>Rule3ExemptInd</th>":
                           "<td>",SRVSEB15,"</td></tr>",012:
                           "<tr><th>S4B3ExemptInd</th>":
                           "<td>",SRVSEB16,"</td></tr>",012:
                           "<tr><th>SelfDeemedCde</th>":
                           "<td>",SRVSEB17,"</td></tr>",012:
                           "<tr><th>ServiceText</th>":
                           "<td>",SRVSEB18,"</td></tr>",012:
                           "<tr><th>TimeDuration</th>":
                           "<td>",SRVSEB19,"</td></tr>"
.
SEGSRB99  RETURN
+
.------------------------------------------------------------------------------
. I/O and Subroutine Includes
.------------------------------------------------------------------------------
.
          INC       IBAWEBCD
          INC       DAYOFWEK
          INC       RSHWEBCD
          INC       WEBDATCD
+
.------------------------------------------------------------------------------
. End Of Program
.------------------------------------------------------------------------------

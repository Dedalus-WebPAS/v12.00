.******************************************************************************
.* WEBLBPMI - This is a proc to display the variables painted for PMI Labels  *
.*                                                                            *
.* PARAMETERS  : This procedure requires that the master file record  has     *
.*               been read.                                                   *
.*               URNUMBER = UR Number                                         *
.*               LABELTYP = Label Type                                        *
.*               USINGELT - Using Eltron printer for labels                   *
.*                      0 = No                                                *
.*                      1 = Yes                                               *
.* RETURNS     : EXIT 0 = Labels Printed / Zero Labels Selected               *
.*                    1 = Not Screen Painted                                  *
.*               NOLABEL = Number of labels to print                          *
.* Mods        :                                                              *
.*        V9.09.01  12/07/2007  Peter Vela       CAR 142913                   *
.*                  Added call to GCCSJG00                                    *
.*        V9.05.01  22/12/2005  Steve Armstrong  CAR 89599                    *
.*                  Added READ on PMSPX2A1 to populate pmspx2af variables     *
.*                  before printing PMI labels.                               *
.******************************************************************************
.*               28/09/2000 Dean Cramer                                       *
.*                          Recomplied for DXPATMAS                           *
.*                          Changed for SLA code in PATMX1FD                  *
.*               27/04/98   Nick                                              *
.*                          Added LABSIZE & LABCOS for screen paint. labels   *
.*               14/10/1997  Steve Armstrong                                  *
.*               Mods for Wrist Band Labels                                   *
.*               19/05/1997  Steve Armstrong      WHL                         *
.*               Mods for Eltron printer                                      *
.*                                                                            *
.******************************************************************************
          DEFPROC   LABELPMI
.
          INC       IBAPASFD/INC
          INC       NHIETHFD/INC
.
FORM3     FORM      3
.
DIM80     DIM       80
DIM3      DIM       3
DIM6      DIM       6
FIELDNO   FORM      5
PROCADMN  DIM       8
NMPNUMB   DIM       20
NOTSCPT   FORM      1          * not screen painted flag
PAGELIMT  FORM      "55"
.
CYRSFDTE  DIM       8
CYRSTDTE  DIM       8
CYRSYEAR  FORM      3
.
CODEC     INIT      "C "
CODEDA    INIT      "DA"
CODEDC    INIT      "DC"
CODEH1    INIT      "H1"
CODEH2    INIT      "H2"
CODEH3    INIT      "H3"
CODEM     INIT      "M "
CODEP1    INIT      "P1"
CODEP2    INIT      "P2"
CODEP3    INIT      "P3"
CODEP4    INIT      "P4"
CODEP5    INIT      "P5"
CODEP6    INIT      "P6"
CODER     INIT      "R "
CODET     INIT      "T "
CODEV6    INIT      "V6"
CODEV7    INIT      "V7"
CODEV8    INIT      "V8"
.
+
MAIN0000  CALL      INIT0000
          BRANCH    CEXIT,MAIN9999          * invalid details
.
          CALL      LABELCOM                * process screen painted labels
.
MAIN9999  GOTO      LABPMI99
.******************************************************************************
.*        INIT0000  Initalise routine                                         *
.******************************************************************************
INIT0000  UNPACK    LABELTYP,PRGID,SCRID
.
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          READ      CONTROLF,TEN;*126,CLABPG
          READ      CONTROLF,TEN3;*143,CSIZLAB
.
          MOVE      CLABPG,LABCOS
          MOVE      CSIZLAB,LABSIZE
.
          PACK      KEY8,URNUMBER,SP10
          CALL      RDMAST1
          BRANCH    OVRCD,INIT9100
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD = 1
            CALL     CLPMSPX2
          ENDIF
.
          CALL      GCCSJG00
.
.         set the PMI GP details
.
...          OPEN      PMSHCPA1,"pmshcpaf"
          MOVE      SP30,PMHCSNAM
          PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1
.
...          OPEN      PMSHCGA1,"pmshcgaf"
          MOVE      SP70,PMHGADD1
          PACK      KEY10,PMPXRH1G,SP70  * GP Practice code
          PACK      KEY12,KEY10,PMPXR1GC,SP70  * GP Practice code
          CALL      RDPMHCG1
.
          IF        PTCNNHII = 1
            MOVE      SP10,NHMARES
            MOVE      SP10,NHMAETH
            MOVE      SP30,NMPNUMB 
...            OPEN      NHIMASA2,"nhimasaf"
            MOVE      URNUMBER,KEY8
            CALL      RDNHMAS2
          ELSE
            MOVE      SP20,NMPNUMB
...            OPEN      PATNIDA1,"patnidaf"
            PACK      KEY10,CHOSINDX,URNUMBER,SP10 
            CALL      RDPTNID1
            MOVE      PTNINMPI,NMPNUMB
          ENDIF 
.
.         See if using Eltron printer
.
          READ      CONTROLF,EIGHTY8;*1,PTCNPELT
          MOVE      PTCNPELT,USINGELT       * save parameter
.
          MOVE      ZERO,CEXIT
          GOTO      INIT9999
.
INIT9100  MOVE      "Invalid U/R Number",WEBTITLE
          CALL      WEBERR00
          MOVE      TWO,EXIT
          MOVE      ONE,CEXIT
INIT9999  RETURN
+
.*****************************************************************
.*        DISPVARS  Display Items            Called By :         *
.*****************************************************************
DISPVARS  MOVE      SCPSITM,FIELDNO
          MOVE      SCPSLEN,LLCNT
          CALL      DXPATMAS
DVARS999  RETURN
.
.         I/O includes needed
. 
          INC       AGECHK
          INC       CALCYRS
.
          INC       DSPFIELD
          INC       DXPATCOD
          INC       DXPATMAS
          INC       IBAOVRIO/INC
          INC       IBAPASIO/INC
          INC       NHIETHIO/INC
          INC       WEBLBCOM    
          INC       PMIGTNID
.
LABPMI99  ENDPROC
................................................................................

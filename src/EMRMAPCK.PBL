.-------------------------------------------------------------------------
. Include       : EMRMAPCK
.
. Function      : Check if Discharged/Cancalled ED Patient Should have a 
.                 location
.
. Modifications :
.------------------------------------------------------------------------------
. V11.01.00  26/10/2021  Ebon Clements TSK 0911480
.            Moved code from EMRWEB01 to a common include
.-------------------------------------------------------------------------
MAPCHK00  MOVE      ZERO,EXIT
.
          COMPARE   "4",EMVISTAT            * Clear location - Visit cancelled
          GOTO      MAPCHK70 IF EQUAL
.
          MATCH     SP70,EMVIPADM
          GOTO      MAPCHK50 IF NOT EQUAL
.
          CALL      DISLOC00
.
          MATCH     SP70,EMVILOCN
          GOTO      MAPCHK70 IF EQUAL
          GOTO      MAPCHK99
.
MAPCHK50  MATCH     "1",EMCNDDSS
          IF        @EQUAL
.
            PACK      KEY3,EMVILOCN,SP70
            CALL      RDEMLOC1
            BRANCH    OVRCD,MAPCHK70
.
            MATCH     "1",EMLOSSIN
            GOTO      MAPCHK60 IF EQUAL
.
            GOTO      MAPCHK70
          ENDIF
.
MAPCHK60  MOVE      EMVIPADM,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,MAPCHK99
.
          COMPARE   TWO,ASTAT
          GOTO      MAPCHK70 IF NOT EQUAL
.
          PACK      KEY6,AWARD,SP70
          CALL      RDWARD1
          BRANCH    OVRCD,MAPCHK99
.
          MATCH     SP70,WEFRBT
          GOTO      MAPCHK70 IF EQUAL
.
          PACK      KEY5,ANSB,ANST,WEFRBT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,MAPCHK70
          MATCH     ANSE,TCINDC11         * Emergency ward - leave on map
          GOTO      MAPCHK99 IF EQUAL
.
          MATCH     ANSM,TCINDC11         * Emergency ward - leave on map
          GOTO      MAPCHK99 IF EQUAL
.
MAPCHK70  MOVE      EMVIADMN,KEY8
          CALL      RDEMVIS1
          IF        OVRCD<>1
            MOVE      SP70,EMVILOCN
            MOVE      SP70,EMVIPRLO
            MOVE      SP70,EMVIPRTM
            CALL      UPEMVIS1
          ENDIF
          MOVE      ONE,EXIT
.
MAPCHK99  RETURN
.
.---------------------------------------------------------------------
. Check for Discharge Location to be Cleared on Discharge of Patient
.---------------------------------------------------------------------
DISLOC00  IF        EMVIYN02=1
            MOVE      SP70,EMVILOCN
            MOVE      SP70,EMVIPRLO
            MOVE      SP70,EMVIPRTM
            GOTO      DISLOC99
          ENDIF
.
          MATCH     SP70,EMVIDSTA
          GOTO      DISLOC99 IF EQUAL
.
          MOVE      "ED",CATEGORY
          MOVE      EMVIDSTA,CODE
          CALL      GETCOD00
          MATCH     "2",TCINDC2
          IF        !@EQUAL
            MOVE      SP70,EMVILOCN
            MOVE      SP70,EMVIPRLO
            MOVE      SP70,EMVIPRTM
          ENDIF
.
DISLOC99  RETURN

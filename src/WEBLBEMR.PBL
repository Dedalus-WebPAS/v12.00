.******************************************************************************
.* WEBLBEMR - ***** WEB version of LABELEMR  ******************************   *
.* LABELEMR - This is a proc to display the variables painted for Emergency   *
.*            Labels (EMR).                                                   *
.* PARAMETERS  : This proc needs the Emergency Visit and Patient Master file  *
.*               Records read.                                                *
.*                                                                            *
.*               KEY8 = Visit Number                                          *
.*               USINGELT - Using Eltron printer                              *
.*                     0 = No                                                 *
.*                     1 = Yes                                                *
.*                                                                            *
.* RETURNS     : EXIT 0 = Labels Printed / Zero Labels Selected               *
.*                    1 = Not Screen Painted                                  *
.*               NOLABEL = Number of labels to print                          *
.* Mods        :                                                              *
.*               V10.08.01 17/10/2016  Peter Vela    TSK 0826301              *
.*                         Added NHI to INIT0000                              *
.*               V9.09.01  01/11/2007  Mike Laming   CAR 153218               *
.*                           Add calls to CLEMRVIS & CLPATVIS at INIT0000     *
.*               12/07/2007  Peter Vela CAR 142913                            *
.*                           Added call to GCCSJG00                           *
.*               19/08/2005  Pete Vela CAR 71987                              *
.*                           Added read of pmspx2af                           *
.*               28/09/2000  Dean Cramer                                      *
.*                           Recomplied for DXPATMAS                          *
.*                           Changed for SLA code in PATMX1FD                 *
.*               11/01/2000 Nicole Harrington                                 *
.*                          Changed DXEMRDET to WEBEMRDX                      *
.*               02/03/1999 Katie Nelson                                      *
.*                          Ported from V5.06                                 *
.*               27/04/98   Nick                                              *
.*                          Added LABSIZE & LABCOS for screen paint. labels   *
.*                                                                            *
.******************************************************************************
          DEFPROC   LABELEMR
.
          INC       IBAPASFD/INC
          INC       NHIMASFD/INC
..          INC       NHIETHFD/INC
+
FORM3     FORM      3
FORM5     FORM      5
DIM6      DIM       6
DIM80     DIM       80
.
DIM3      DIM       3
FIELDNO   FORM      5
NMPNUMB   DIM       20
NOTSCPT   FORM      1          * not screen painted flag
PAGELIMT  FORM      "55"
.
BJDAY     FORM      3
CJDAY     FORM      3
.
SP80      INIT      "                                   ":
                    "                                             "
SP100     INIT      "                                                      ":
                    "                                              "
.
ZERO4     INIT      "04"
.
CYRSFDTE  DIM       8
CYRSTDTE  DIM       8
CYRSYEAR  FORM      3
.
CATAI     INIT      "AI"
IND1AI    FORM      1
CATAP     INIT      "AP"
CATAR     INIT      "AR"
.
CODEA     INIT      "A "
CODEA1    INIT      "A1"
CODEA2    INIT      "A2"
CODEA3    INIT      "A3"
CODEA4    INIT      "A4"
CODEA5    INIT      "A5"
CODEAC    INIT      "AC"
CODEBT    INIT      "BT"
CODECL    INIT      "CL"
CODEC     INIT      "C "
CODECC    INIT      "CC"
CODEDA    INIT      "DA"
CODEEA    INIT      "EA"
CODEEP    INIT      "EP"
CODEES    INIT      "ES"
CODEEW    INIT      "EW"
CODEDC    INIT      "DC"
CODEH1    INIT      "H1"
CODEH2    INIT      "H2"
CODEH3    INIT      "H3"
CODELT    INIT      "LT"
CODEM     INIT      "M "
CODEP     INIT      "P "
CODEP1    INIT      "P1"
CODEP2    INIT      "P2"
CODEP3    INIT      "P3"
CODEP4    INIT      "P4"
CODEP5    INIT      "P5"
CODEP6    INIT      "P6"
CODER     INIT      "R "
CODERS    INIT      "RS"
CODES     INIT      "S "
CODET     INIT      "T "
CODETY    INIT      "TY"
CODEU1    INIT      "U1"
CODEU2    INIT      "U2"
CODEU3    INIT      "U3"
CODEU4    INIT      "U4"
CODEU5    INIT      "U5"
CODEU6    INIT      "U6"
CODEU7    INIT      "U7"
CODEUNK   INIT      "UNK"
CODEV6    INIT      "V6"
CODEV7    INIT      "V7"
CODEV8    INIT      "V8"
CODEXM    INIT      "XM"
USINGELT  FORM      "0"
.
.-------------------------------------------------------------------------
MAIN0000  CALL      INIT0000
          BRANCH    EXIT,MAIN9999
.
          READ      CONTROLF,THIRTY;*89,HELPAGE,*90,HELPRNT,HELSIZE
          MOVE      HELPAGE,LABCOS
          MOVE      HELSIZE,LABSIZE
.
          CALL      LABELCOM                * process screen painted labels
.
MAIN9999  GOTO      LABEMR99
.
+
.******************************************************************************
.*        INIT0000 - Open some files.                                         *
.******************************************************************************
.
INIT0000  IF        EMRFLAG<>1
            GOTO      INIT0900
          ENDIF
.
          UNPACK    LABELTYP,PRGID,SCRID
.
          OPEN      CONTROLF,"controlf"
..          READ      CONTROLF,TWENTY;*196,PTCNUCRD
.
.-------  Open Patient Files  -------
.
          CALL      CLEMRVIS                                          *I-153218
          CALL      CLPATVIS                                          *I-153218
.
          IF        EMRFLAG=1
            PACK      KEY8,ADMISSNO,SP10
            CALL      RDEMVIS1
          ENDIF
.
          MATCH     URNUMBER,SP70    
          IF        !@EQUAL
            PACK      KEY8,ADMISSNO,SP10
            CALL      RDVISA1
            BRANCH    OVRCD,INIT0910
.
            PACK      KEY8,PVIURNO
            CALL      RDMAST1
            CALL      RDPMPX21
.
            CALL      GCCSJG00
.
          ELSE
            PACK      KEY8,ADMISSNO
            CALL      RDEMUNK1
            BRANCH    OVRCD,INIT0910
.
            MOVE      EMUNDET1,PSNAME
            MOVE      EMUNDET2,PGNAME
            MOVE      EMUNSEX,PSEX    
            MOVE      EMUNAGE,PSAGE   
            MOVE      SP70,PURNO 
            MOVE      SP70,PBDATE
.
            MOVE      SP70,PMCDCTYP
            MOVE      SP70,PMCDEXDT
            MOVE      SP70,PMCDCNUM
.
          ENDIF
.
.         set the PMI GP details
.
            MOVE      SP20,NMPNUMB
            OPEN      PATNIDA1,"patnidaf"
            PACK      KEY10,CHOSINDX,PVIURNO,SP10
            CALL      RDPTNID1
            MOVE      PTNINMPI,NMPNUMB
.

          UNPACK    SP100,PKNAME
          UNPACK    SP100,PKADD1,PKADD2
          UNPACK    SP100,PKSUBR,PKPOST,PKTELEP
          UNPACK    SP100,PKTELEB,PKRELP
          PACK      KEY8,ADMISSNO
          CALL      RDRESP1
.
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
.
          IF        PTCNNHII = 1
            MOVE      SP10,NHMARES
            MOVE      SP10,NHMAETH
            MOVE      SP30,NMPNUMB
            OPEN      NHIMASA2,"nhimasaf"
            MOVE      PVIURNO,KEY8
            CALL      RDNHMAS2
          ENDIF
.
          GOTO      INIT9999
.
INIT0900  MOVE      "EMR Labels not available",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INIT9999
.
INIT0910  MOVE      ONE,EXIT
.
INIT9999  RETURN
+
.*****************************************************************
.*        DISPVARS  Display Items            Called By :         *
.*****************************************************************
.
DISPVARS  MOVE      SCPSITM,FIELDNO
          MOVE      SCPSLEN,LLCNT
.
          COMPARE   "500",FIELDNO
          GOTO      DVARS100 IF LESS
          SUB       "500",FIELDNO
.
          MOVE      FIELDNO,SCPSITM
          CALL      WEBEMRDX  
..          CALL      EMRDETDX    (6.06)
          GOTO      DVARS999
.
DVARS100  CALL      DXPATMAS                ( 6.06 PATMASDX)
.
DVARS999  RETURN
.
.*****************************************************************
.  Following should not be printed on Labels
.*****************************************************************
HDGNS000
..   Any diagnoses on file
HDGNS999  RETURN
.*****************************************************************
HCNT0000
..   Any clinical notes on file
HCNT9999  RETURN
.*****************************************************************
HPRC0000
..   Any procedures on file
HPRC9999  RETURN
.*****************************************************************
UPDURT00
..   Update duration of waiting
UPDURT99  RETURN
.*****************************************************************
          INC       AGECHK
          INC       DSPFIELD
          INC       WEBEMRDX
          INC       DXPATCOD
          INC       DXPATDOC
          INC       DXPATMAS
          INC       IBAOVRIO/INC
          INC       IBALABPT
          INC       IBAPASIO/INC
          INC       NHIMASIO/INC
          INC       WEBLBCOM
.
LABEMR99  ENDPROC
...............................................................................

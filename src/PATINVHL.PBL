.******************************************************************************
.*                                                                            *
.*  PATINVHL - Invoice Header Fields                                          *
.*                                                                            *
.* &&&&& Make sure the file ibavaraf is updated with the new variables &&&&&  *
.*                                                                            *
.* Modifications  :                                                           *
.*----------------------------------------------------------------------------*
.* V12.00.02 30/09/2025  Thanh T           TSK 0937505                        *
.*           Added PRPH2550-PRPH2590 for Extended procedure Description line  *
.*           1 to 50                                                          *
.  V12.00.01 22/05/2025  J.Tan          TSK 0955096
.            Added Alphanumeric visit number changes
.* V11.04.02 30/04/2024  J.Tan             TSK 0945175                        *
.*           Fixed BPAY and Invoice number for Disc.Billing Statement         *
.* V11.04.01 01/02/2024  J.Tan             TSK 0936664                        *
.*           Fixed restoring variables from invoice file (field 73)           *
.* V11.03.03 08/01/2024  J.Tan             TSK 0936664                        *
.*           Added PRIH1132 to restore variables from invoice file (field 73) *
.* V11.03.02 02/10/2023  Nikitha B         TSK 0927699                        *
.*           Added CAPPRVNO and PTCNHABN for Hospital Approval Number and     *
.*           ABN Number for single hospital.                                  *
.* V11.03.01 10/08/2023  Nikitha B         TSK 0925704                        *
.*           Added SMAD0000 and SHAD0000 routine to have hospital full        *
.*           address in one variable                                          *
.* V11.02.01 24/01/2021  Jacob Jackson     TSK 0864505                        *
.*           Added preferred name field options -                             *
.*           PRIH2691, PRIH2692, PRIH2693, PRIH2694, PRIH2695                 *
.* V11.00.03 25/01/2021  Thanh T           TSK 0896396                        *
.*           Added Var 236 - PRIH2679 Add Proc 1 Insurer code                 *
.*                 Var 237 - PRIH2680 Add Proc 1 Insurer code short desc      *
.*                 Var 238 - PRIH2681 Add Proc 1 Insurer code long desc       *
.*                 Var 239 - PRIH2682 Add Proc 2 Insurer code                 *
.*                 Var 240 - PRIH2683 Add Proc 2 Insurer code short desc      *
.*                 Var 241 - PRIH2684 Add Proc 2 Insurer code long desc       *
.*                 Var 242 - PRIH2685 Add Proc 3 Insurer code                 *
.*                 Var 243 - PRIH2686 Add Proc 3 Insurer code short desc      *
.*                 Var 244 - PRIH2687 Add Proc 3 Insurer code long desc       *
.*                 Var 245 - PRIH2688 Add Proc 4 Insurer code                 *
.*                 Var 246 - PRIH2689 Add Proc 4 Insurer code short desc      *
.*                 Var 247 - PRIH2690 Add Proc 4 Insurer code long desc       *
.* V11.00.02 13/01/2021  Thanh T           TSK 0896396                        *
.*           Added Var 233 - PRIH2676 Primary Proc Insurer code               *
.*                 Var 234 - PRIH2677 Primary Proc Insurer code short desc    *
.*                 Var 235 - PRIH2678 Primary Proc Insurer code long desc     *
.* V11.00.01 06/04/2020  Thanh T           TSK 0879163                        *
.*           Added PRIH2671 for sex long description                          *
.*           08/04/2020 J.Tan              TSK 0868813                        *
.*           Added field 229,230,231,232 - Patient name                       *
.*----------------------------------------------------------------------------*
.*        V10.12.01 23/02/2018  J.Tan             TSK 0852351                 *
.*                  Added field 226,227 - Program Code/Description            *
.*        V10.08.01 07/11/2016  Ebon Clements     TSK 0827937                 *
.*                  Added field 225 - Hospital approval number - pthsappr     *
.*        V10.05.02 10/02/2015  J.Tan             CAR 311717                  *
.*                  Fixed field 21 and 22 for Emergency patients              *
.*        V10.05.01 27/10/2014  J.Tan             CAR 304455                  *
.*                  Fixed field 21 (Doctor Provider no) and 22 (Doctor Name)  *
.*        V10.04.01 27/02/2014  J.Tan             CAR 275810                  *
.*                  Mods to check for Defence force claim                     *
.*        V10.03.10 09/12/2013  Ania P            CAR 294740                  *
.*                  Added logic for DBILFLAG                                  *
.*        V10.03.09 06/06/2013  J.Tan             CAR 286530                  *
.*                  Fixed field 58 - GCLMD000 (Get claim details) for Emr     *
.*        V10.03.08 17/04/2013  Don Nguyen        CAR 282342                  *
.*                  Corrected pos read for PTCNURBP                           *
.*        V10.03.07 09/04/2013  Don Nguyen        CAR 282342                  *
.*                  Mods to use UR for BPAYINVN (if PTCNURBP=1)               *
.*        V10.03.06 18/03/2013  J.Tan             CAR 280802                  *
.*                  Fixed field 54 for Outpatient HF membership               *
.*        V10.03.05 14/09/2012  Saroeun Soeur     CAR 268841                  *
.*                  PRIHL450 - health fund membership number check extension  *
.*                  then check pmi                                            *
.*        V10.03.04 16/07/2012  J.Tan             CAR 257771                  *
.*                  Added variables for Theatre Chargeable duration           *
.*        V10.03.03 18/07/2012  Don Nguyen        CAR 264561                  *
.*                  Read in Hospital ID before calling GBCRN000               *
.*        V10.03.02 07/12/2011  J.Tan             CAR 254776                  *
.*                  Removed address line 2 from the new full address fields   *
.*        V10.03.01 28/11/2011  J.Tan             CAR 254776                  *
.*                  Added a new variable for full PRA,Patient and Postal Addrs*
.*        V10.02.04 22/08/2010  J.Tan             CAR 235370                  *
.*                  Added fields for NHI patient name variables               *
.*        V10.02.03 27/09/2010  J.Tan             CAR 251945                  *
.*                  Fixed setting primary doctor for primary doctor(nzpspraf) *
.*        V10.02.02 22/08/2010  J.Tan             CAR 235765                  *
.*                  Added free text field for other insurer (viscmtaf)        *
.*        V10.02.01 29/03/2011  Jill Parkinson    CAR 239574                  *
.*                  Removed opens of ibaprntf                                 *
.*        V10.01.01 06/01/2011  Jill Parkinson    CAR 233088                  *
.*                  Changed to use PMVXFNDM instead of AFNDMM                 *
.*        V10.00.01 26/03/2010  J.Tan             CAR 174079                  *
.*                  Mods invoice number var.for Future Action letter IBABIL22 *
.*        V9.12.05  04/12/2009  Peter Vela        CAR 202333                  *
.*                  Changed variable 88 to surname only                       *
.*        V9.12.04  21/09/2009  J.Tan             CAR 194815                  *
.*                  Removed opening nzpcfnaf for JH Billing date              *
.*        V9.12.03  17/07/2009  J.Tan             CAR 199603                  *
.*                  Added hospital file number - CFILENO                      *
.*        V9.12.02  16/06/2009  J.Tan             CAR 194815                  *
.*                  Mods JH Billing Date to be in DEFPROC                     *
.*        V9.12.01  11/05/2009  J.Tan             CAR 194815                  *
.*                  Added Range of JH Billing date                            *
.*        V9.11.04  07/04/2009  Mike Laming       CAR 171702                  *
.*                  Added test for "IBABIL21" at PRIH1510 (print "(ACCOUNT)") *
.*        V9.11.03  20/03/2009  Davin             CAR 178015                  *
.*                  Added bpayinvn - generate bpay crn from INP or PRI        *
.*        V9.11.02  14/01/2009  J.Tan             CAR 187463                  *
.*                  Mods Vendor Id and Ref for Contract patient only (not FFS)*
.*        V9.11.01  14/10/2008  Peter Vela        CAR 159227                  *
.*                  Added emergency invoice arrival date and time             *
.*        V9.10.02  22/07/2008  J.Tan             CAR 169840                  *
.*                  Fixed field 62 for Credit Notes                           *
.*        V9.10.01  13/05/2008  Ebon Clements     CAR 166566                  *
.*                  Added medicare expiry date and current time               *
.*        V9.09.02  16/11/2007  Peter Vela        CAR 110766                  *
.*                  Fixed overseas patient STV address labels                 *
.*        V9.09.01  16/10/2007  J.Tan             CAR 150350                  *
.*                  Fixed claim code for Emergency event                      *
.*                  17/10/2007  J.Tan             CAR 151249                  *
.*                  Added a new field for Medicare Patient status             *
.*        V9.08.15  25/09/2007  Jill Habasque CAR 150448                      *
.*                  Add additional nzpspraf procedure fields                  *
.*        V9.08.14  10/07/2007  Mike Laming   CAR 140395                      *
.*                  Add test for Statements (STATMENT) at PRIHL100 & INVHL100 *
.*        V9.08.13  02/07/2007  Peter Vela        CAR 142173                  *
.*                  Added PVITYPE = 9 and PVITYPE = 1 validations for         *
.*                  Fund Membership Number                                    *
.*        V9.08.12  01/03/2007  Jill Habasque     CAR 120004                  *
.*                  Added output of nzspsurg and nzspanae                     *
.*        V9.08.11  14/02/2007  Peter Vela        CAR sjog-vic                *
.*                  Added Print/ Reprint indicator. St. John of God           *
.*        V9.08.10  20/02/2007  Jill Habasque     CAR 120004                  *
.*                  Changed NZPCFN00 to match to EXPPAYER instead of primary  *
.*        V9.08.09  01/02/2007  Ebon Clements     CAR 119998                  *
.*                  Added health fund full desc and biller name               *
.*        V9.08.08  24/01/2007  Jill Habasque     CAR 120009                  *
.*                  Added nzpspraf and nzpcfnaf fields                        *
.*        V9.08.07  15/12/2006  Peter Vela        CAR 128487                  *
.*                  Added ATIME DTIME                                         *
.*        V9.08.06  14/12/2006  J.Tan             CAR 127769                  *
.*                  Fixed HRN Number                                          *
.*        V9.08.05  13/12/2006  Jill Habasque    CAR 127698                   *
.*                  Added NZ private approval number and claim number         *
.*        V9.08.04  13/12/2006  J.Tan             CAR 127769                  *
.*                  Fixed PRNTSTRT for Alternate ID                           *
.*        V9.08.03  16/11/2006  Steve Armstrong   CAR 124160                  *
.*                  Added Singapore HRN                                       *
.*        V9.08.02  11/10/2006  Jill Habasque  CAR 121261                     *
.*                  Moved check for CNEXTINV to be below BIL21/PATWEB76 check *
.*        V9.08.01  29/09/2006 Peter Vela CAR 120319                          *
.*                  Added PSNAME patient surname                              *
.*                  Added PTDSDWRD discharge ward code desc                   *
.*        V9.07.01  06/09/2006 Jill Habasque CAR 109852                       *
.*                  Added check for alternate IDs PTCNDAUR                    *
.*                  15/09/2006  J.Tan    CAR 118944                           *
.*                  Added field for Business phone number                     *
.*        V9.06.02  17/05/2006 Peter Vela CAR 104103                          *
.*                  Changed doctor surname to doctor formatted full name      *
.*        V9.06.01  24/04/2006 J.Tan      CAR 102287                          *
.*                  Added fields for multi hospital details                   *
.*        V9.05.02  29/03/2006 Peter Vela CAR 95780                           *
.*                  Added EMG Contact mobile numbers                          *
.*        V9.05.01  24/03/2006 Peter Vela CAR 61299                           *
.*                  Increased field no size from DIM3 to DIM5                 *
.*        V9.05.B01 03/03/2006 J.Tan   CAR 95871                              *
.*                  Initialise field for claim type and ref.no                *
.*        V9.04.03  26/05/2004 J.Tan   CAR 61488                              *
.*                  Fixed heading Copy for Invoice
.*        V9.04.02  07/10/2004 Lina Vo CAR 54165                              *
.*                  Changed routine to use PTHSABNN instead of IBCNABNN       *
.*                  for Multi Hospital                                        *
.*        V9.04.01  01/09/2004 Lina Vo CAR 52998                              *
.*                  Added Page Number (Field 74).                             *
.*        V9.03.06  19/07/2004 J.Tan   CAR 51688                              *
.*                  Fixed I*C on patfn1af                                     *
.*        V9.03.05  06/07/2004 J.Tan   CAR 50781                              *
.*                  Mods variable 58 - claim code desc. to print 20 chars     *
.*        V9.03.04  02/04/2004 Peter Vela CAR 48227                           *
.*                  Added field for BPAY Customer Reference Number (generated)*
.*        V9.03.03  21/11/2003 J.Tan                                          *
.*                  Mods for Credit note                                      *
.*        V9.03.02  27/06/2002 J.Tan                                          *
.*                  Mods for WEB billing printing invoice                     *
.*        V9.03.01  13/06/2002 J.Tan   CAR 39525                              *
.*                  Fixed printing patient status                             *
.*        V9.02.09  28/10/2002 Dean Cramer                                    *
.*                  Initialise IREFNO                                         *
.*        V9.02.08  26/10/2002 Dean Cramer                                    *
.*                  Include OCADESC - Outpatient Clinic Name                  *
.*        V9.02.07  25/09/2002 Dean Cramer                                    *
.*                  Fix where Health Fund Name & Health Fund Table Name not   *
.*                  being picked up.                                          *
.*        V9.02.06  08/08/2002 Dean Cramer                                    *
.*                  Replace FORM2 with F2 in GCLM as is changed before use.   *
.*        V9.02.05  21/06/2002 J.Tan                                          *
.*                  Fixed insurance claim variable not to have hf membership  *
.*        V9.02.04  29/05/2002 J.Tan (defect 18098)                           *
.*                  Fixed insurance claim variable                            *
.*        V9.02.03  28/03/2002  J.Tan                                         *
.*                  Fixed spelling accomodation                               *
.*        V9.02.02  18/10/2001  Bronko Sosic                                  *
.*                  Added New Variabiles for Provisional Diagnosis            *
.*        V9.02.01  18/10/2001  Bronko Sosic                                  *
.*                  Added New Variabiles for printing                         *
.*        V5.08.03  29/09/2000  Jill Habasque SRF 3060                        *
.*                  Fixed printing of receipt for BIL21                       *
.*        V5.08.02  06/07/2000  Davin                                         *
.*                  Open controlf for ABN                                     *
.*                  Added discharge/interim indicator (field 32)              *
.*        V5.08.01  27/06/2000  Davin  SRF  2969                              *
.*                  Added admission weight & medicare code                    *
.*        V5.08.00  09/03/2000  Davin                                         *
.*                  Copied from PATSHT6 - modified to print invoice fields    *
.******************************************************************************
.*        Lineup Print for Invoice Header Fields                              *
.******************************************************************************
.
LINUPIHL  IF        WEBFLAG<>1
            CALL      OPNPRINT                 * open spool file
          ENDIF
          MOVE      ONE,CURRROW              * Initialise current row counter
          IF        IBDTROW < 1
            GOTO      INVHL999               * don't template anything
          ENDIF
.
INVHL000  COMPARE   CURRROW,IBDTROW          * Current row up to required row ?
          GOTO      INVHL200 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else print 1 extra line
          ADD       ONE,CURRROW              * Increment counter
          GOTO      INVHL000                 * Check counter again
.
. ------- Read through the details file -------
.
INVHL100  CALL      RKIBDET1                 * Read next detail record
          BRANCH    OVRCD,INVHL900           * No more records - pad out form
.
.                                                                     *I-140395
          IF        STATMENT = 1
            PACK      KEY6,PTCNSMTH,SP10     * printing statements header
          ELSE                               
            MOVE      SP6,KEY6               * printing Invoice header
            LOAD      KEY6,PINVSYS,AECNAEIH,OTCNOTIH,PTCNPAIH,PTCNPAIH
.                                    aae      out      inp      oth
          ENDIF
.
          MATCH     KEY6,IBDTSCOD            * Same form ?
          GOTO      INVHL900 IF NOT EQUAL    * No - pad out rest of form
.
INVHL110  COMPARE   CURRROW,IBDTROW          * Are we at required row ?
          GOTO      INVHL200 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else pad out form to req row
          ADD       ONE,CURRROW              * One more row printed
          GOTO      INVHL110                 * Check row count
.
. ------- Print actual data lines -------
.
INVHL200  BRANCH    IBDTINDC,INVHL300:       * Text field
                             INVHL400        * Data field
.
. ------- Print text field -------
.
INVHL300  PRINT     *IBDTCOL,IBDTTXFL;       * Print data
          MOVE      IBDTROW,CURRROW          * Row printed is current row
          GOTO      INVHL100                 * Read next record
.
. ------- Print data field -------
.
INVHL400  MOVE      IBDTTXFL,DIM5            * Data number 1st 3 chars of field
          MOVE      DIM5,FORM5               * Move to a FORM field for BRANCH
.
          BRANCH    FORM5,INVHL480,INVHL470,INVHL450,INVHL450,INVHL480:
                          INVHL450,INVHL450,INVHL450,INVHL450,INVHL450:    10
                          INVHL450,INVHL480,INVHL480,INVHL450,INVHL480:
                          INVHL450,INVHL450,INVHL470,INVHL470,INVHL450:    20
                          INVHL480,INVHL450,INVHL450,INVHL480,INVHL450:
                          INVHL450,INVHL450,INVHL450,INVHL470,INVHL450:    30
                          INVHL470,INVHL450,INVHL450,INVHL450,INVHL450:
                          INVHL480,INVHL450,INVHL450,INVHL480,INVHL450:    40
                          INVHL480,INVHL450,INVHL480,INVHL450,INVHL480:
                          INVHL450,INVHL450,INVHL450,INVHL450,INVHL450:    50
                          INVHL450,INVHL450,INVHL450,INVHL450,INVHL450:
                          INVHL450,INVHL480,INVHL450,INVHL470,INVHL450:    60
                          INVHL450,INVHL450,INVHL450,INVHL450,INVHL450:
                          INVHL470,INVHL450,INVHL450,INVHL450,INVHL450:    70
                          INVHL450,INVHL450,INVHL450,INVHL480,INVHL450:
                          INVHL450,INVHL450,INVHL450,INVHL450,INVHL450:    80
                          INVHL450,INVHL450,INVHL450,INVHL450,INVHL450:
                          INVHL450,INVHL450,INVHL450,INVHL450,INVHL450:    90
                          INVHL450,INVHL450,INVHL450
.
INVHL450  PACK      VARIABLE,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10
          GOTO      INVHL600
.
INVHL460  MOVE      "99:99:99",VARIABLE          * Time variables
          GOTO      INVHL600
.
INVHL470  IF        IBDTPLEN = 10
            MOVE      "99/99/9999",VARIABLE      * Date with century variables
          ELSE
            MOVE      "99/99/99",VARIABLE        * Date variables
          ENDIF
          GOTO      INVHL600
.
INVHL480  MOVE      "9999999999999999999999999",VARIABLE    * Form Field
          GOTO      INVHL600
.
INVHL490  MOVE      "9",VARIABLE                 * Indicator
          GOTO      INVHL600
.
INVHL520  CLEAR     VARIABLE                     * Address
          APPEND    X10,VARIABLE
          APPEND    X10,VARIABLE
          APPEND    X5,VARIABLE
          APPEND    COMMA,VARIABLE
          APPEND    X10,VARIABLE
          APPEND    X10,VARIABLE
          APPEND    X5,VARIABLE
          APPEND    COMMA,VARIABLE
          APPEND    " 9999",VARIABLE
          RESET     VARIABLE
          GOTO      INVHL600
.
INVHL530  MOVE      "99",VARIABLE            * Year
          GOTO      INVHL600
.
INVHL540  MOVE      "999999.99",VARIABLE     * Daily rate
          GOTO      INVHL600
.
. ------- Actual data print routine -------
.
INVHL600  RESET     VARIABLE,IBDTPLEN        * Reset pointer to required length
          LENSET    VARIABLE                 * Push logical length there
          RESET     VARIABLE                 * Reset form pointer to start
          PRINT     *IBDTCOL,*+,VARIABLE;    * Only print data between FP & LL
          MOVE      IBDTROW,CURRROW          * Move row number to one printed
          GOTO      INVHL100                 * Read next record
.
. ------- Finished all data for this form - pad out rest of form -------
.
INVHL900  COMPARE   CURRROW,IBTHLENG         * End of form ?
          GOTO      INVHL999 IF EQUAL        * Yes - exit
          PRINT     *N;                      * Otherwise pad out 1 more line
          ADD       ONE,CURRROW              * 1 more line printed
          GOTO      INVHL900                 * Test again
.
INVHL999  MOVE      FALSE,EXIT               * Set exit flag
.>>>>     CALL      CLSPRINT                 * close the spool file
          RETURN                             * Finished
+
.*******************************************************************************
.*        Actual Print Routine for Patient Invoice Header Fields               *
.*******************************************************************************
.
PRTINVHL  IF        WEBFLAG<>1
            CALL      OPNPRINT                 * open spool file
          ENDIF
          MOVE      ONE,CURRROW              * Initialise current row counter
          IF        IBDTROW < 1
            GOTO      PRIH9999               * don't template anything
          ENDIF
.
PRIHL000  COMPARE   CURRROW,IBDTROW          * Current row up to required row ?
          GOTO      PRIHL200 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else print 1 extra line
          ADD       ONE,CURRROW              * Increment counter
          GOTO      PRIHL000                 * Check counter again
.
. ------- Read through the details file -------
.
PRIHL100  CALL      RKIBDET1                 * Read next detail record
          BRANCH    OVRCD,PRIH8000           * No more records - pad out form
.
.                                                                     *I-140395
          IF        STATMENT = 1
            PACK      KEY6,PTCNSMTH,SP10     * printing statements header
          ELSE
            MOVE      SP6,KEY6               * printing Invoice header
            LOAD      KEY6,PINVSYS,AECNAEIH,OTCNOTIH,PTCNPAIH,PTCNPAIH
.                                    aae      out      inp      oth
          ENDIF
.
          MATCH     KEY6,IBDTSCOD            * Same form ?
          GOTO      PRIH8000 IF NOT EQUAL    * No - pad out rest of form
.
PRIHL110  COMPARE   CURRROW,IBDTROW          * Are we at the required row ?
          GOTO      PRIHL200 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else pad out to required row
          ADD       ONE,CURRROW              * One more row printed
          GOTO      PRIHL110                 * Check row count
.
. ------- Print actual data lines -------
.
PRIHL200  BRANCH    IBDTINDC,PRIHL300:       * Text field
                             PRIHL400        * Data field
.
. ------- Print text field -------
.
PRIHL300  RESET     IBDTTXFL,IBDTPLEN
          LENSET    IBDTTXFL
          RESET     IBDTTXFL
          PRINT     *IBDTCOL,*+,IBDTTXFL;    * Print data
          MOVE      IBDTROW,CURRROW          * Row printed is current row
          GOTO      PRIHL100                 * Read next record
.
. ------- Print data field -------
.
PRIHL400  MOVE      IBDTTXFL,DIM5            * Data number 1st 3 chars of field
          MOVE      DIM5,FORM5               * Move to a FORM field for BRANCH
.
          PACK      VARIABLE,SP30,SP30,SP30,SP30,SP10  * Initialise variable
          BRANCH    FORM5,PRIHL410,PRIHL420,PRIHL430,PRIHL440,PRIHL450:
                          PRIHL460,PRIHL470,PRIHL480,PRIHL490,PRIHL500:   10
                          PRIHL510,PRIHL520,PRIHL530,PRIHL540,PRIHL550:
                          PRIHL560,PRIHL570,PRIHL580,PRIHL590,PRIHL600:   20
                          PRIHL610,PRIHL620,PRIHL630,PRIHL640,PRIHL650:
                          PRIHL660,PRIHL670,PRIHL680,PRIHL690,PRIHL700:   30
                          PRIHL710,PRIHL720,PRIHL730,PRIHL740,PRIHL750:
                          PRIHL760,PRIHL770,PRIHL780,PRIHL790,PRIHL800:   40
                          PRIHL810,PRIHL820,PRIHL830,PRIHL840,PRIHL850:
                          PRIHL860,PRIHL870,PRIHL880,PRIHL890,PRIHL900:   50
                          PRIHL910,PRIHL920,PRIHL930,PRIHL940,PRIHL950:
                          PRIHL960,PRIHL970,PRIHL980,PRIHL990,PRIH1000:   60
                          PRIH1010,PRIH1020,PRIH1030,PRIH1040,PRIH1050:
                          PRIH1060,PRIH1070,PRIH1080,PRIH1090,PRIH1100:   70
                          PRIH1110,PRIH1120,PRIH1130,PRIH1140,PRIH1150:
                          PRIH1160,PRIH1170,PRIH1180,PRIH1190,PRIH1200:   80
                          PRIH1210,PRIH1220,PRIH1230,PRIH1240,PRIH1250:
                          PRIH1260,PRIH1270,PRIH1280,PRIH1290,PRIH1300:   90
                          PRIH1310,PRIH1320,PRIH1330,PRIH1340,PRIH1350:
                          PRIH1360,PRIH1370,PRIH1380,PRIH1390,PRIH1400:  100
                          PRIH1410,PRIH1420,PRIH1430,PRIH1440,PRIH1450:
                          PRIH1460,PRIH1470,PRIH1480,PRIH1490,PRIH1500:  110
                          PRIH1510,PRIH1520,PRIH1530,PRIH1540,PRIH1550:
                          PRIH1560,PRIH1570,PRIH1580,PRIH1590,PRIH1600:  120
                          PRIH1610,PRIH1620,PRIH1630,PRIH1640,PRIH1650:
                          PRIH1660,PRIH1670,PRIH1680,PRIH1690,PRIH1700:  130
                          PRIH1710,PRIH1720,PRIH1730,PRIH1740,PRIH1750:
                          PRIH1760,PRIH1770,PRIH1780,PRIH1790,PRIH1800:  140
                          PRIH1810,PRIH1820,PRIH1830,PRIH1840,PRIH1850:
                          PRIH1860,PRIH1870,PRIH1880,PRIH1890,PRIH1900:  150
                          PRIH1910,PRIH1920,PRIH1930,PRIH1940,PRIH1950:
                          PRIH1960,PRIH1970,PRIH1980,PRIH1990,PRIH2000:  160
                          PRIH2010,PRIH2020,PRIH2030,PRIH2040,PRIH2050:
                          PRIH2060,PRIH2070,PRIH2080,PRIH2090,PRIH2100:  170
                          PRIH2110,PRIH2120,PRIH2130,PRIH2140,PRIH2150:
                          PRIH2160,PRIH2170,PRIH2180,PRIH2190,PRIH2200:  180
                          PRIH2210,PRIH2220,PRIH2230,PRIH2240,PRIH2250:
                          PRIH2260,PRIH2270,PRIH2280,PRIH2290,PRIH2300:  190
                          PRIH2310,PRIH2320,PRIH2330,PRIH2340,PRIH2350:
                          PRIH2360,PRIH2370,PRIH2380,PRIH2390,PRIH2400:  200
                          PRIH2410,PRIH2420,PRIH2430,PRIH2440,PRIH2450:
                          PRIH2460,PRIH2470,PRIH2480,PRIH2490,PRIH2500:  210
                          PRIH2510,PRIH2520,PRIH2530,PRIH2540,PRIH2550:
                          PRIH2560,PRIH2570,PRIH2580,PRIH2590,PRIH2600:  220
                          PRIH2610,PRIH2620,PRIH2630,PRIH2640,PRIH2650:
                          PRIH2660,PRIH2670,PRIH2671,PRIH2672,PRIH2673:  230
                          PRIH2674,PRIH2675,PRIH2676,PRIH2677,PRIH2678:
                          PRIH2679,PRIH2680,PRIH2681,PRIH2682,PRIH2683:  240 
                          PRIH2684,PRIH2685,PRIH2686,PRIH2687,PRIH2688:
                          PRIH2689,PRIH2690,PRIH2691,PRIH2692,PRIH2693:  250
                          PRIH2694,PRIH2695,PRIH2696,PRIH2697,PRPH2550:
                          PRPH2560,PRPH2570,PRPH2580,PRPH2590
.
PRIHL410  MOVE      AADMNO,VARIABLE          * Admission number
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PRIH6000
.
PRIHL420  UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY    * Admission date
          CALL      PACDATE
          IF        IBDTPLEN = 10
            MOVE      CPCDATE,VARIABLE
          ELSE
            MOVE      CPDATE,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIHL430  MOVE      ADIAG1,VARIABLE          * admission diagnosis 1
          GOTO      PRIH5000
.
PRIHL440  MOVE      ADIAG2,VARIABLE          * admission diagnosis 2
          GOTO      PRIH5000
.
PRIHL450  MATCH     SP70,PMVXFNDM
          IF        !@EQUAL
            MOVE      PMVXFNDM,VARIABLE        * fund membership number
          ELSE
            MOVE      AFNDMM,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIHL460  MOVE      AFNDTB,VARIABLE          * Health Fund table
          GOTO      PRIH5000
.
PRIHL470  MOVE      AFUNDH,VARIABLE          * Health Fund
          GOTO      PRIH5000
.
PRIHL480  MOVE      AMBS,VARIABLE            * Admitting MBS
          GOTO      PRIH5000
.
PRIHL490  MOVE      AWARD,VARIABLE           * Ward
          GOTO      PRIH5000
.
PRIHL500  MOVE      CHADD1,VARIABLE          * Hospital Address 1
          GOTO      PRIH5000
.
PRIHL510  MOVE      CHADD2,VARIABLE          * Hospital Address 2
          GOTO      PRIH5000
.
PRIHL520  MOVE      CHPOST,VARIABLE          * Hospital Postcode
          GOTO      PRIH5000
.
PRIHL530  MOVE      CHTELEB,VARIABLE         * Hospital Telephone
          GOTO      PRIH5000
.
PRIHL540  MOVE      CNAME,VARIABLE           * Hospital Name
          GOTO      PRIH5000
.
PRIHL550  IF        DBSFLAG=1
            MATCH     "1",IVDETAIL
            GOTO      PRIH5000 IF NOT EQUAL       * No invoice details
.
            OPEN      PATINVR3,"patinvrf"
            PACK      KEY16,DAADMNO,Z70
            CALL      RDSINV3
PRIHL551    CALL      RDPINV3
            IF        OVRCD=0
              MATCH     DPINVADM,DAADMNO
              IF        @EQUAL
                MATCH     "1",PTINCRST
                GOTO      PRIHL551 IF EQUAL       * fully credited
                MATCH     "3",DPINVSYS
                GOTO      PRIHL551 IF NOT EQUAL   * not inpatient invoice
                GOTO      PRIHL552
              ENDIF
            ENDIF
            MOVE    THREE,PINVSYS
            GOTO    PRIH5000
          ENDIF
.
          MATCH     "PATWEB72",PRGID         * print statement
          GOTO      PRIH5000 IF EQUAL
.  
          MATCH     "IBABIL21",PRGID         * Invoice Number
          GOTO      PRIHL552 IF EQUAL
          MATCH     "PATWEB76",PRGID
          GOTO      PRIHL552 IF EQUAL
          MATCH     "IBABIL22",PRGID         * Invoice Number
          GOTO      PRIHL552 IF EQUAL
          COMPARE   ZERO,CNEXTINV
          GOTO      PRIH5000 IF EQUAL
.
          MOVE      CNEXTINV,VARIABLE        * print invoice
          GOTO      PRIHL558
.
PRIHL552  MOVE      PINVNO,VARIABLE          * reprint invoice
.
PRIHL558  MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PRIH6000
.
PRIHL560  MOVE      CNOCLMS,VARIABLE         * Invoice Claim Message 1
          GOTO      PRIH5000
. 
PRIHL570  MOVE      CONAME,VARIABLE          * Company Name
          GOTO      PRIH5000
. 
PRIHL580  CALL      IBACLOCK                 * Current Date
          MOVE      CCC,CCENT
          MOVE      CYY,CYEAR
          MOVE      CMM,CMON
          MOVE      CDD,CDAY
          CALL      PACDATE
          IF        IBDTPLEN = 10
            MOVE      CPCDATE,VARIABLE
          ELSE
            MOVE      CPCDATE,VARIABLE
          ENDIF
          GOTO      PRIH5000
. 
PRIHL590  UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY    * Discharge Date
          CALL      PACDATE
          IF        IBDTPLEN = 10
            MOVE      CPCDATE,VARIABLE
          ELSE
            MOVE      CPDATE,VARIABLE
          ENDIF
          GOTO      PRIH5000
. 
PRIHL600  MOVE      DDIAG,VARIABLE           * Discharge Diagnosis
          GOTO      PRIH5000
. 
PRIHL610                                     * Doctor Provider Number
          GOTO      PRIH1270                 * Same as field 87
.
PRIHL620  OPEN      PATDO1A1,"patdo1af"
.
          IF        PVITYPE=1
            MATCH     "1",EMCNGINV           * Group invoice by service doctor?
            IF        @EQUAL
              MATCH     SP70,SERVDOCT
              IF        !@EQUAL
                MATCH     "ALL",SERVDOCT
                IF        !@EQUAL
                  PACK      KEY6,SERVDOCT,SP70
                  CALL      RDDOCT1
                  BRANCH    OVRCD,PRIHL624
                  GOTO      PRIHL622
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          CALL      GETCON00
          MATCH     SP70,DOCTCODE
          IF        @EQUAL | @EOS
            GOTO      PRIHL624
          ELSE
            PACK      KEY6,DOCTCODE,SP70
            CALL      RDDOCT1
            BRANCH    OVRCD,PRIHL624
          ENDIF
.
PRIHL622  MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,PACGNAME
          MOVE      DTITL,PACTITLE
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAME,VARIABLE      * Formatted Doctor's Name
          GOTO      PRIH5000
.
PRIHL624  MOVE      SP70,VARIABLE
          GOTO      PRIH5000
. 
PRIHL630  MOVE      HINVDES,VARIABLE         * Desc. on top of Invoice (AAE98)
          GOTO      PRIH5000
. 
PRIHL640  MOVE      ABWGHT,VARIABLE          * Admission Weight
          GOTO      PRIH5000
. 
PRIHL650  MOVE      NHMANMPI,VARIABLE        * National HCU ID (N.Z.)
          GOTO      PRIH5000
. 
PRIHL660  MOVE      OSTDESC,VARIABLE         * Outpatient Site Code Description
          GOTO      PRIH5000
.
PRIHL670  MOVE      PADD1,VARIABLE           * Address line 1
          GOTO      PRIH5000
.
PRIHL680  MOVE      PADD2,VARIABLE           * Address line 2
          GOTO      PRIH5000
.
PRIHL690  UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY   * Birth date
          CALL      PACDATE
          IF        IBDTPLEN = 10
            MOVE      CPCDATE,VARIABLE
          ELSE
            MOVE      CPDATE,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIHL700  MOVE      PFNAME,VARIABLE          * PRA Name
          GOTO      PRIH5000
.
PRIHL710  MATCH     "PATWEB72",PRGID         * print statement
          GOTO      PRIH5000 IF EQUAL        * no invoice date on the heading
.
          COMPARE   FIVE,PROGFLAG
          GOTO      PRIH5000 IF EQUAL        * no invoice date on the heading
.
          UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY    * Invoice Date
          CALL      PACDATE
          IF        IBDTPLEN = 10
            MOVE      CPCDATE,VARIABLE
          ELSE
            MOVE      CPDATE,VARIABLE
          ENDIF
          GOTO      PRIH5000
. 
PRIHL720  MOVE      "INTERIM",VARIABLE           * Discharge/Interim indicator
          COMPARE   THREE,ASTAT
          IF        @EQUAL
            MOVE      "DISCHARGE",VARIABLE
          ENDIF
          GOTO      PRIH5000
. 
PRIHL730  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          READ      CONTROLF,ZERO;*70,IBCNABNN   * ABN Number
          MOVE      IBCNABNN,VARIABLE
          IF        IBCNMHOS=1
            OPEN      PMSVX1A1,"pmsvx1af"
            MOVE      AADMNO,KEY8
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
            OPEN       PATHSPA1,"pathspaf"
            MOVE      PMVXMHOS,KEY3
            CALL      RDPTHSP1
            BRANCH    OVRCD,PRIH5000
            MOVE      PTHSABNN,VARIABLE
          ENDIF
          GOTO      PRIH5000
. 
PRIHL740  MOVE      PKADD1,VARIABLE          * PRA Address 1
          GOTO      PRIH5000
.
PRIHL750  MOVE      PKADD2,VARIABLE          * PRA Address 2
          GOTO      PRIH5000
.
PRIHL760  MOVE      PKPOST,VARIABLE          * PRA Postcode
          GOTO      PRIH5000
.
PRIHL770  MOVE      PKRELP,VARIABLE          * PRA Relationship
          GOTO      PRIH5000
.
PRIHL780  MOVE      PKSUBR,VARIABLE          * PRA Suburb
          GOTO      PRIH5000
.
PRIHL790  MOVE      PMEDI,VARIABLE           * Medicare number
          GOTO      PRIH5000
.
PRIHL800  MOVE      PNAME,VARIABLE           * Patient Name
          IF        CFEETYP=5
            MOVE     PTMASNAM,PACSNAMX
            MOVE     PGNAME,PACGNAME
            MOVE     PTITL,PACTITLE
            MOVE     THREE,PACFRMT            * Title,Given name and Surname
            CALL     PACNAME
            PACK     KEY80,PACFNAMX,SP70
            MOVE     KEY80,VARIABLE         * Formatted patient Name
          ENDIF
          GOTO      PRIH5000
.
PRIHL810  MOVE      PPOST,VARIABLE           * Postcode
          GOTO      PRIH5000
.
PRIHL820  MOVE      PSUBRB,VARIABLE          * Suburb
          GOTO      PRIH5000
.
PRIHL830  MOVE      PTMXCARD,VARIABLE        * Card Number (NZ Billing)
          GOTO      PRIH5000
.
PRIHL840  MOVE      PTMXCXMP,VARIABLE        * Card Exemption Type (NZ Billing)
          GOTO      PRIH5000
.
PRIHL850  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND10;*249,PTCNDAUR * Display Alt ID instead of UR
.
          MATCH     "1",PTCNDAUR
          GOTO      PRIHL855 IF NOT EQUAL
          MOVE      SP70,KEY20
          PROC      GETALIDS
          MATCH     SP70,KEY20
          GOTO      PRIHL855 IF EQUAL
          MOVE      KEY20,VARIABLE
          MOVE      TWENTY,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PRIH6000
.
PRIHL855  MOVE      PURNO,VARIABLE           * U/R number
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PRIH6000
.
PRIHL860  MOVE      ACCPRIV,VARIABLE         * Private Accommodation Indicator
          GOTO      PRIH5000
.
PRIHL870  MOVE      ACCSHRD,VARIABLE         * Shared Accommodation Indicator
          GOTO      PRIH5000
.
PRIHL880  MOVE      SP9,DINVTP
          LOAD      DINVTP,IPASS,SP9,DINSUR
          MOVE      DINVTP,VARIABLE          * Invoice Type
          GOTO      PRIH5000
.
PRIHL890  MOVE      DISCODE,VARIABLE         * Discharge Status
          GOTO      PRIH5000
.
PRIHL900  MOVE      DSCHN,VARIABLE           * Discharge Indicator (X=No)
          GOTO      PRIH5000
.
PRIHL910  MOVE      DSCHY,VARIABLE           * Discharge Indicator (X=Yes)
          GOTO      PRIH5000
.
PRIHL920  MOVE      SP20,FUNDNM
          MATCH     SP6,AFUNDH
          IF        !@EQUAL
               OPEN      PATFN1A1,"patfn1af"
               PACK      KEY14,AFUNDH,ZERO8
               CALL      RDFUND1               * Read the health fund file
               IF        OVRCD<>1
                 MOVE      HFNAME,FUNDNM       * Health fund description
               ENDIF
             ENDIF
          MOVE      FUNDNM,VARIABLE          * Health Fund Name
          GOTO      PRIH5000
.
PRIHL930  MOVE      SP30,FUNDNM
          MATCH     SP6,AFUNDH
          IF        !@EQUAL
               OPEN      PATFN1A1,"patfn1af"
               PACK      KEY14,AFUNDH,ZERO8
               CALL      RDFUND1               * Read the health fund file
               IF        OVRCD<>1
                 MOVE      HFNAME,FUNDNM       * Health fund description
               ENDIF
             ENDIF
.
          MOVE      SP20,DIM20  
          MATCH     SP8,AFNDTB
          IF        !@EQUAL
               OPEN      PATFN1A1,"patfn1af"
               PACK      KEY14,AFUNDH,AFNDTB
               CALL      RDFUND1               * Read the health fund file
               IF        OVRCD<>1
                 MOVE      HFNAME,DIM20        * Health fund table desc  
               ENDIF
             ENDIF
.
          MOVE      "-",DIM1
          PACK      KEY60,FUNDNM,SP1,DIM1,SP1,DIM20,SP70
.
          MOVE      KEY60,VARIABLE          * Health Fund Name (& table)
          GOTO      PRIH5000
.
PRIHL940  MOVE      TABLNN,VARIABLE          * Fund Membership Number
.
          IF        PVITYPE=3
            MATCH     SP70,PMVXFNDM
            IF        !@EQUAL & !@EOS
              MOVE      PMVXFNDM,VARIABLE
            ENDIF
          ENDIF
.
          IF        PVITYPE=1 | PVITYPE=2| PVITYPE=9
            MATCH     SP70,PFNDMM
            IF        !@EQUAL & !@EOS
              MOVE      PFNDMM,VARIABLE
            ENDIF
          ENDIF
          GOTO      PRIH5000
.
PRIHL950  MOVE      SP10,VARIABLE            * Description of disch. status
          PACK      KEY5,ANSD,SP1,DSTAT
          CALL      RDCODE1
          IF        OVRCD <> 1
            MOVE      TDESC,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIHL960  MOVE      SP70,HFNMTB
          CALL      GCLMD000                 * get claim details
          MOVE      HFNMTB,VARIABLE          * claim type
          GOTO      PRIH5000
.
PRIHL970  MOVE      SP70,IREFNO
          CALL      GCLMD000                 * get claim details
          MOVE      IREFNO,VARIABLE          * claim reference number
          GOTO      PRIH5000
.
PRIHL980  MOVE      SP10,DIM10               * Description of ACLAIM
          MOVE      SP70,KEY20
.
          CALL      GCLMD000                 * get claim details
          MATCH     SP3,ACLAIM
          GOTO      PRIHL985 IF EQUAL
.
          MOVE      "CL",TCODE
          PACK      KEY5,TCODE,ACLAIM
          CALL      RDCODE1
          IF        OVRCD <> 1
            MOVE      TDESC,DIM10
            MOVE      TDESC,KEY20
          ENDIF
PRIHL985  
.         MOVE      DIM10,VARIABLE
          MOVE      KEY20,VARIABLE
          GOTO      PRIH5000
.
PRIHL990  UNPACK    CDATE,CDAY,DIM1,CMON,DIM1,CCENT,CYEAR
          MOVE      CDAY,DD
          MOVE      CMON,MM
          MOVE      CYEAR,YY
          MOVE      CCENT,CC
.
          CALL      DMYCON
          ADD       "7",JULDAY
          MOVE      JULDAY,JWKDAY
          MOVE      JULYR,JWKYER
          MOVE      JULCC,JWKCC
          CALL      JULCON
          PACK      DUEDATE,DD,SLASH,MM,SLASH,YY
          REP       " 0",DUEDATE
          MOVE      DUEDATE,VARIABLE         * week from current date
          GOTO      PRIH5000
.
PRIH1000  MOVE      PKADD4,VARIABLE          * PRA Address 4
          GOTO      PRIH5000
.
PRIH1010  MOVE      PADD4,VARIABLE           * Address 4
          GOTO      PRIH5000
.
PRIH1020  MOVE      "INVOICE",VARIABLE       * Receipt/Invoice indicator
          MATCH     "1",DBILFLAG
          IF        @EQUAL
            MOVE      "DISCHARGE BILLING STATEMENT",VARIABLE
            GOTO      PRIH5000
          ENDIF
.
          COMPARE   ZERO,PTINGSTA
          IF        !@EQUAL
            MOVE      "TAX INVOICE",VARIABLE
          ENDIF
          IF        CRDNFLAG=1
            IF        CFEETYP=5
              MOVE      "CRD NTE",VARIABLE
            ELSE
              MOVE      "CREDIT NOTE",VARIABLE
            ENDIF
          ENDIF
          GOTO      PRIH5000
.
PRIH1030  MOVE      PTMXMCCD,VARIABLE        * Medicare Code
          GOTO      PRIH5000
.
PRIH1040  MOVE      SP70,VARIABLE            * Not Available
          GOTO      PRIH5000
.
PRIH1050  MOVE      PSEX,VARIABLE            * Patients Sex 
          GOTO      PRIH5000
.
PRIH1060  MATCH     SP70,ADATE
          GOTO      PRIHL100 IF EQUAL
          CALL      IBACLOCK                 * Current Date
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          DAYSEP    ADATE,KEY8,DAYSDIFF
          IF        DAYSDIFF > MAXSEPDY
            MOVE      "Long Term Stay",VARIABLE      * Long stay or Short Stay 
          ELSE
            MOVE      "              ",VARIABLE      * Long stay or Short Stay 
          ENDIF
          GOTO      PRIH5000
.
. Service
.
PRIH1070  COMPARE   ONE,PVITYPE
          IF        @EQUAL
            MOVE      "Emergency   ",VARIABLE
            GOTO      PRIH5000
          ENDIF
.
          COMPARE   TWO,PVITYPE
          IF        @EQUAL
            MOVE      "Outpatient  ",VARIABLE
            GOTO      PRIH5000
          ENDIF
.
          COMPARE   THREE,PVITYPE
          IF        @EQUAL
            MOVE      "Accommodation",VARIABLE
            GOTO      PRIH5000
          ENDIF
          GOTO      PRIH5000
.
. Patient Status
.
PRIH1080  COMPARE   ONE,PVITYPE
          IF        @EQUAL
            PACK      KEY8,DPVIBILL,SP70
            CALL      RDEMVIS1
            IF        OVRCD=1
              MOVE      "Emergency - ",VARIABLE
              GOTO      PRIH5000
            ENDIF
            PACK      TDESC,SP70
            PACK      KEY5,CODECL,EMVICOMP,SP70    
            CALL      RDCODE1
            IF        OVRCD <> 1
              MOVE      "Emergency - ",VARIABLE
              PACK      VARIABLE,VARIABLE,TDESC
            ENDIF
            GOTO      PRIH5000
          ENDIF
.
          COMPARE   TWO,PVITYPE
          IF        @EQUAL
            PACK      KEY8,DPVIBILL,SP70
            CALL      RDBOKB1
            IF        OVRCD=1
              MOVE      "Outpatient - ",VARIABLE
              GOTO      PRIH5000
            ENDIF
            PACK      TDESC,SP70
            PACK      KEY5,CODECL,OBACOMP,SP70    
            CALL      RDCODE1
            IF        OVRCD <> 1
              MOVE      "Outpatient - ",VARIABLE
              PACK      VARIABLE,VARIABLE,TDESC
            ENDIF
            GOTO      PRIH5000
          ENDIF
.
          COMPARE   THREE,PVITYPE
          IF        @EQUAL
            PACK      TDESC,SP70
            PACK      KEY5,CODECL,ACLAIM,SP70    
            CALL      RDCODE1
            IF        OVRCD <> 1
              MOVE      "Inpatient - ",VARIABLE
              PACK      VARIABLE,VARIABLE,TDESC
            ENDIF
            GOTO      PRIH5000
          ENDIF
          GOTO      PRIH5000
.
. Class
.
PRIH1090  COMPARE   ONE,PVITYPE
          IF        @EQUAL
            PACK      KEY8,DPVIBILL,SP70
            CALL      RDEMVIS1
            IF        OVRCD=1
              GOTO      PRIH5000
            ENDIF
            MOVE      "EM",VARIABLE
            PACK      VARIABLE,VARIABLE,SP1,EMVICOMP,SP1,EMVICLAS
            GOTO      PRIH5000
          ENDIF
.
          COMPARE   TWO,PVITYPE
          IF        @EQUAL
            PACK      KEY8,DPVIBILL,SP70
            CALL      RDBOKB1
            IF        OVRCD=1
              GOTO      PRIH5000
            ENDIF
            MOVE      "OP",VARIABLE
            PACK      VARIABLE,VARIABLE,SP1,OBACOMP,SP1,OBACLASS
            GOTO      PRIH5000
          ENDIF
.
          COMPARE   THREE,PVITYPE
          IF        @EQUAL
            MOVE      "IP",VARIABLE
            PACK      VARIABLE,VARIABLE,SP1,ACLAIM,SP1,ATYPE
            GOTO      PRIH5000
          ENDIF
          GOTO      PRIH5000
.
. Provisional DRG
.
PRIH1100  PACK       KEY8,DPVIBILL,SP70
          OPEN       PMSVX1A1,"pmsvx1af"
          CALL       RDPMVX11
          BRANCH     OVRCD,PRIH5000
          MOVE       PMVXPICD,VARIABLE
          GOTO       PRIH5000
.
. Provisional DRG Description
.
PRIH1110  PACK       KEY8,DPVIBILL,SP70
          OPEN       PMSVX1A1,"pmsvx1af"
          CALL       RDPMVX11
          BRANCH     OVRCD,PRIH5000
          PACK       KEY9,PMVXPICD,SP70
          OPEN       PATICDD1,"paticddf"
          CALL       RD10T9D1
          CLOSE      PATICDD1
          IF         OVRCD=0
            MOVE       DDESC,VARIABLE
            GOTO       PRIH5000
          ENDIF
          GOTO      PRIH5000
.
PRIH1120  MOVE      OCADESC,VARIABLE        * Outpatient Clinic Name
          GOTO      PRIH5000
.
PRIH1130  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            IF        OVRCD=0
              MOVE      PMVXMHOS,BPAYHOSP
            ENDIF
          ENDIF
.
          READ      CONTROLF,HUND18;*249,PTCNURBP  * Use UR number as BPAYINVN?
          MATCH     "1",PTCNURBP
          IF        @EQUAL
            MOVE      PINVUR,BPAYINVN       * use UR number
          ELSE
            MOVE      PINVNO,BPAYINVN       * use last invno for BPAY CRN
.
            IF        DBSFLAG=1
              MATCH     "1",IVDETAIL
              GOTO      PRIH5000 IF NOT EQUAL       * No invoice details
.
.         Printing Discharged billing with Invoiced details, use last inv.no
.
              OPEN      PATINVR3,"patinvrf"
              PACK      KEY16,DAADMNO,Z70
              CALL      RDSINV3
PRIH1132      CALL      RDPINV3
              IF        OVRCD=0
                MATCH     DPINVADM,DAADMNO
                IF        @EQUAL
                  MATCH     "1",PTINCRST
                  GOTO      PRIH1132 IF EQUAL       * fully credited
                  MATCH     "3",DPINVSYS
                  GOTO      PRIH1132 IF NOT EQUAL   * not inpatient invoice
                  MOVE      PINVNO,BPAYINVN       * use last invno for BPAY CRN
                  GOTO      PRIH1134
                ENDIF
              ENDIF
              MOVE      THREE,PINVSYS
              GOTO      PRIH5000
            ENDIF
          ENDIF
.
PRIH1134  CALL      GBCRN000                ^ Generate BPAY CRN
          MOVE      BPAYREFN,VARIABLE
          GOTO      PRIH5000
.
PRIH1140  ADD       ONE,PAGENO               * Page Number
          MOVE      PAGENO,VARIABLE
          MOVE      THREE,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PRIH6000
.
PRIH1150  MOVE      PMPXKMOB,VARIABLE
          GOTO      PRIH5000
.
PRIH1160  MOVE      PMPXCMOB,VARIABLE
          GOTO      PRIH5000
.
PRIH1170  MOVE      PMPXRMOB,VARIABLE
          GOTO      PRIH5000
.
PRIH1180  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1 
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
            MOVE      PMVXMHOS,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1190  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1 
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
.
            OPEN      PATHSPA1,"pathspaf" 
            MOVE      PMVXMHOS,KEY3  
            CALL      RDPTHSP1
            BRANCH    OVRCD,PRIH5000
            MOVE      PTHSNAME,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1200  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1 
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
.
            OPEN      PATHSPA1,"pathspaf" 
            MOVE      PMVXMHOS,KEY3  
            CALL      RDPTHSP1
            BRANCH    OVRCD,PRIH5000
            MOVE      PTHSADD1,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1210  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1 
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
.
            OPEN      PATHSPA1,"pathspaf" 
            MOVE      PMVXMHOS,KEY3  
            CALL      RDPTHSP1
            BRANCH    OVRCD,PRIH5000
            MOVE      PTHSADD2,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1220  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1 
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
.
            OPEN      PATHSPA1,"pathspaf" 
            MOVE      PMVXMHOS,KEY3  
            CALL      RDPTHSP1
            BRANCH    OVRCD,PRIH5000
            MOVE      PTHSADD3,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1230  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1 
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
.
            OPEN      PATHSPA1,"pathspaf" 
            MOVE      PMVXMHOS,KEY3  
            CALL      RDPTHSP1
            BRANCH    OVRCD,PRIH5000
            MOVE      PTHSADD4,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1240  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1 
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
.
            OPEN      PATHSPA1,"pathspaf" 
            MOVE      PMVXMHOS,KEY3  
            CALL      RDPTHSP1
            BRANCH    OVRCD,PRIH5000
            MOVE      PTHSPCOD,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1250  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1 
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
.
            OPEN      PATHSPA1,"pathspaf" 
            MOVE      PMVXMHOS,KEY3  
            CALL      RDPTHSP1
            BRANCH    OVRCD,PRIH5000
            MOVE      PTHSTELE,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1260  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1 
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
.
            OPEN      PATHSPA1,"pathspaf" 
            MOVE      PMVXMHOS,KEY3  
            CALL      RDPTHSP1
            BRANCH    OVRCD,PRIH5000
            MOVE      PTHSFAXN,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1270  OPEN      PATDO1A1,"patdo1af"
.
          IF        PVITYPE=1
            MATCH     "1",EMCNGINV           * Group invoice by service doctor?
            IF        @EQUAL
              MATCH     SP70,SERVDOCT
              IF        !@EQUAL
                MATCH     "ALL",SERVDOCT
                IF        !@EQUAL
                  PACK      KEY6,SERVDOCT,SP70
                  CALL      RDDOCT1
                  BRANCH    OVRCD,PRIH1274
                  GOTO      PRIH1272
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          CALL      GETCON00
          MATCH     SP70,DOCTCODE
          IF        @EQUAL | @EOS
            GOTO      PRIH1274
          ELSE
            PACK      KEY6,DOCTCODE,SP70
            CALL      RDDOCT1
            BRANCH    OVRCD,PRIH1274
          ENDIF
.
PRIH1272  MOVE      DPROV,VARIABLE      * Doctor provider no.
          GOTO      PRIH5000
.
PRIH1274  MOVE      SP70,VARIABLE
          GOTO      PRIH5000
.
PRIH1280  OPEN      PATDO1A1,"patdo1af"
          CALL      GETCON00
          MATCH     SP70,DOCTCODE
          IF        @EQUAL | @EOS
            MOVE      SP70,VARIABLE
          ELSE
            PACK      KEY6,DOCTCODE,SP70
            CALL      RDDOCT1
            IF        OVRCD=1
              MOVE      SP70,VARIABLE
            ELSE
.             MOVE      DSNAME,PACSNAME
.             MOVE      DGNAME,PACGNAME
.             MOVE      DTITL,PACTITLE
.             MOVE      ONE,PACFRMT
.             CALL      PACNAME
.             MOVE      PACFNAME,VARIABLE
              MOVE      DSNAME,VARIABLE     * Doctor Surname
            ENDIF
          ENDIF
          GOTO      PRIH5000
.
PRIH1290  MOVE      PTELEB,VARIABLE          * Business Telephone no
          GOTO      PRIH5000
.
PRIH1300  MOVE      PSNAME,VARIABLE
          GOTO      PRIH5000
.
PRIH1310  MOVE      PTDSDWRD,VARIABLE
          GOTO      PRIH5000
.
PRIH1320  PACK      KEY6,PTDSDWRD,SP70
          CALL      RDWARD1
          IF        OVRCD=0
            MOVE      WBDESC,VARIABLE
          ELSE
            MOVE      PTDSDWRD,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1330  PROC      GETALTID
          GOTO      PRIH5000
.
PRIH1340  MOVE      ZERO,F1
          MOVE      ONE,F2
          PROC      NZPCFN00                 * NZ private approval number
          GOTO      PRIH5000
.
PRIH1350  MOVE      ZERO,F1
          MOVE      TWO,F2
          PROC      NZPCFN00                 * NZ private claim number
          GOTO      PRIH5000
.
PRIH1360  MOVE      ATIME,VARIABLE           * Admission Time
          GOTO      PRIH5000
.
PRIH1370  MOVE      DTIME,VARIABLE           * Discharge Time
          GOTO      PRIH5000
.
PRIH1380  MOVE      ZERO,F1
          MOVE      THREE,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1390  MOVE      ZERO,F1
          MOVE      FOUR,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1400  MOVE      ZERO,F1
          MOVE      FIVE,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1410  MOVE      ZERO,F1
          MOVE      SIX,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1420  MOVE      ZERO,F1
          MOVE      SEVEN,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1430  MOVE      ZERO,F1
          MOVE      EIGHT,F2               * reference number
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1440  MOVE      ZERO,F1
          MOVE      NINE,F2               * vendor ID
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1450  MOVE      ZERO,F1
          MOVE      TEN,F2
          PROC      NZPCFN00             * NZ private procedure code
          GOTO      PRIH5000
.
PRIH1460  MOVE      ZERO,F1
          MOVE      TEN1,F2
          PROC      NZPCFN00             * NZ private proc code desc
          GOTO      PRIH5000
.
PRIH1470  MOVE      ZERO,F1
          MOVE      TEN2,F2
          PROC      NZPCFN00             * NZ private approval date
          GOTO      PRIH5000
.
PRIH1480  MOVE      SP70,KEY40
          MATCH     SP6,AFUNDH
          IF        !@EQUAL
               OPEN      PATFN1A1,"patfn1af"
               PACK      KEY14,AFUNDH,ZERO8
               CALL      RDFUND1               * Read the health fund file
               IF        OVRCD<>1
                 MOVE      PTHFBILN,KEY40        Health fund Billing Name
               ENDIF
             ENDIF
          MOVE      KEY40,VARIABLE             * Health Fund Name
          GOTO      PRIH5000
.
PRIH1490  MOVE      SP70,KEY70
          MATCH     SP6,AFUNDH
          IF        !@EQUAL
               OPEN      PATFN1A1,"patfn1af"
               PACK      KEY14,AFUNDH,ZERO8
               CALL      RDFUND1               * Read the health fund file
               IF        OVRCD<>1
                 MOVE      PTHFFULD,KEY70        Health fund full description
               ENDIF
             ENDIF
          MOVE      KEY70,VARIABLE             * Health Fund Name
          GOTO      PRIH5000
.
PRIH1500  MOVE      ZERO,F1
          MOVE      TEN3,F2
          PROC      NZPCFN00             * NZ procedure desc line 2
          GOTO      PRIH5000
.
PRIH1510  MOVE      "TAX INVOICE",VARIABLE       * Receipt/Invoice indicator
          MATCH     "IBABIL21",PRGID                                  *I-171702
          IF        @EQUAL
            MOVE      "(ACCOUNT)  ",VARIABLE
          ENDIF
          MATCH     "PATWEB76",PRGID
          IF        @EQUAL
            MOVE      "(ACCOUNT)  ",VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH1520  MOVE      ZERO,F1
          MOVE      TEN4,F2
          PROC      NZPCFN00             * Surgeon description
          GOTO      PRIH5000
.
PRIH1530  MOVE      ZERO,F1
          MOVE      TEN5,F2
          PROC      NZPCFN00             * Anasthetist description
          GOTO      PRIH5000
.
PRIH1540  MOVE      ZERO,F1
          MOVE      TEN6,F2              * Procedure Code
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1550  MOVE      ZERO,F1
          MOVE      TEN7,F2              * Claim Code
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH1560  MOVE      ZERO,F1
          MOVE      TEN8,F2              * Contract/Expected payor
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH1570  MOVE      ZERO,F1
          MOVE      TEN9,F2              * Bill as separate/Include with Primary
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH1580  MOVE      ONE,F1
          MOVE      ONE,F2
          PROC      NZPCFN00                 * NZ private approval number
          GOTO      PRIH5000
.
PRIH1590  MOVE      ONE,F1
          MOVE      TWO,F2
          PROC      NZPCFN00                 * NZ private claim number
          GOTO      PRIH5000
.
PRIH1600  MOVE      ONE,F1
          MOVE      THREE,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1610  MOVE      ONE,F1
          MOVE      FOUR,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1620  MOVE      ONE,F1
          MOVE      FIVE,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1630  MOVE      ONE,F1
          MOVE      SIX,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1640  MOVE      ONE,F1
          MOVE      SEVEN,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1650  MOVE      ONE,F1
          MOVE      EIGHT,F2               * reference number
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1660  MOVE      ONE,F1
          MOVE      NINE,F2               * vendor ID
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1670  MOVE      ONE,F1
          MOVE      TEN,F2
          PROC      NZPCFN00             * NZ private procedure code
          GOTO      PRIH5000
.
PRIH1680  MOVE      ONE,F1
          MOVE      TEN1,F2
          PROC      NZPCFN00             * NZ private proc code desc
          GOTO      PRIH5000
.
PRIH1690  MOVE      ONE,F1
          MOVE      TEN2,F2
          PROC      NZPCFN00             * NZ private approval date
          GOTO      PRIH5000
.
PRIH1700  MOVE      ONE,F1
          MOVE      TEN3,F2
          PROC      NZPCFN00             * NZ procedure desc line 2
          GOTO      PRIH5000
.
PRIH1710  MOVE      ONE,F1
          MOVE      TEN4,F2
          PROC      NZPCFN00             * Surgeon description
          GOTO      PRIH5000
.
PRIH1720  MOVE      ONE,F1
          MOVE      TEN5,F2
          PROC      NZPCFN00             * Anasthetist description
          GOTO      PRIH5000
.
PRIH1730  MOVE      ONE,F1
          MOVE      TEN6,F2              * Procedure Code
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1740  MOVE      ONE,F1
          MOVE      TEN7,F2              * Claim Code
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1750  MOVE      ONE,F1
          MOVE      TEN8,F2              * Contract/Expected payor
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1760  MOVE      ONE,F1
          MOVE      TEN9,F2              * Bill as separate/Include with Primary
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH1770  MOVE      TWO,F1
          MOVE      ONE,F2
          PROC      NZPCFN00                 * NZ private approval number
          GOTO      PRIH5000
.
PRIH1780  MOVE      TWO,F1
          MOVE      TWO,F2
          PROC      NZPCFN00                 * NZ private claim number
          GOTO      PRIH5000
.
PRIH1790  MOVE      TWO,F1
          MOVE      THREE,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1800  MOVE      TWO,F1
          MOVE      FOUR,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1810  MOVE      TWO,F1
          MOVE      FIVE,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1820  MOVE      TWO,F1
          MOVE      SIX,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1830  MOVE      TWO,F1
          MOVE      SEVEN,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1840  MOVE      TWO,F1
          MOVE      EIGHT,F2               * reference number
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1850  MOVE      TWO,F1
          MOVE      NINE,F2               * vendor ID
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1860  MOVE      TWO,F1
          MOVE      TEN,F2
          PROC      NZPCFN00             * NZ private procedure code
          GOTO      PRIH5000
.
PRIH1870  MOVE      TWO,F1
          MOVE      TEN1,F2
          PROC      NZPCFN00             * NZ private proc code desc
          GOTO      PRIH5000
.
PRIH1880  MOVE      TWO,F1
          MOVE      TEN2,F2
          PROC      NZPCFN00             * NZ private approval date
          GOTO      PRIH5000
.
PRIH1890  MOVE      TWO,F1
          MOVE      TEN3,F2
          PROC      NZPCFN00             * NZ procedure desc line 2
          GOTO      PRIH5000
.
PRIH1900  MOVE      TWO,F1
          MOVE      TEN4,F2
          PROC      NZPCFN00             * Surgeon description
          GOTO      PRIH5000
.
PRIH1910  MOVE      TWO,F1
          MOVE      TEN5,F2
          PROC      NZPCFN00             * Anasthetist description
          GOTO      PRIH5000
.
PRIH1920  MOVE      TWO,F1
          MOVE      TEN6,F2              * Procedure Code
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1930  MOVE      TWO,F1
          MOVE      TEN7,F2              * Claim Code
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1940  MOVE      TWO,F1
          MOVE      TEN8,F2              * Contract/Expected payor
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1950  MOVE      TWO,F1
          MOVE      TEN9,F2              * Bill as separate/Include with Primary
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH1960  MOVE      THREE,F1
          MOVE      ONE,F2
          PROC      NZPCFN00                 * NZ private approval number
          GOTO      PRIH5000
.
PRIH1970  MOVE      THREE,F1
          MOVE      TWO,F2
          PROC      NZPCFN00                 * NZ private claim number
          GOTO      PRIH5000
.
PRIH1980  MOVE      THREE,F1
          MOVE      THREE,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH1990  MOVE      THREE,F1
          MOVE      FOUR,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2000  MOVE      THREE,F1
          MOVE      FIVE,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2010  MOVE      THREE,F1
          MOVE      SIX,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2020  MOVE      THREE,F1
          MOVE      SEVEN,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2030  MOVE      THREE,F1
          MOVE      EIGHT,F2               * reference number
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2040  MOVE      THREE,F1
          MOVE      NINE,F2               * vendor ID
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2050  MOVE      THREE,F1
          MOVE      TEN,F2
          PROC      NZPCFN00             * NZ private procedure code
          GOTO      PRIH5000
.
PRIH2060  MOVE      THREE,F1
          MOVE      TEN1,F2
          PROC      NZPCFN00             * NZ private proc code desc
          GOTO      PRIH5000
.
PRIH2070  MOVE      THREE,F1
          MOVE      TEN2,F2
          PROC      NZPCFN00             * NZ private approval date
          GOTO      PRIH5000
.
PRIH2080  MOVE      THREE,F1
          MOVE      TEN3,F2
          PROC      NZPCFN00             * NZ procedure desc line 2
          GOTO      PRIH5000
.
PRIH2090  MOVE      THREE,F1
          MOVE      TEN4,F2
          PROC      NZPCFN00             * Surgeon description
          GOTO      PRIH5000
.
PRIH2100  MOVE      THREE,F1
          MOVE      TEN5,F2
          PROC      NZPCFN00             * Anasthetist description
          GOTO      PRIH5000
.
PRIH2110  MOVE      THREE,F1
          MOVE      TEN6,F2              * Procedure Code
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2120  MOVE      THREE,F1
          MOVE      TEN7,F2              * Claim Code
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2130  MOVE      THREE,F1
          MOVE      TEN8,F2              * Contract/Expected payor
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2140  MOVE      THREE,F1
          MOVE      TEN9,F2              * Bill as separate/Include with Primary
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH2150  MOVE      FOUR,F1
          MOVE      ONE,F2
          PROC      NZPCFN00                 * NZ private approval number
          GOTO      PRIH5000
.
PRIH2160  MOVE      FOUR,F1
          MOVE      TWO,F2
          PROC      NZPCFN00                 * NZ private claim number
          GOTO      PRIH5000
.
PRIH2170  MOVE      FOUR,F1
          MOVE      CNAME,VARIABLE
          MOVE      THREE,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2180  MOVE      FOUR,F1
          MOVE      CHADD1,VARIABLE
          MOVE      FOUR,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2190  MOVE      FOUR,F1
          MOVE      CHADD2,VARIABLE
          MOVE      FIVE,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2200  MOVE      FOUR,F1
          MOVE      SIX,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2210  MOVE      FOUR,F1
          MOVE      SEVEN,F2
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2220  MOVE      FOUR,F1
          MOVE      EIGHT,F2               * reference number
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2230  MOVE      FOUR,F1
          MOVE      NINE,F2               * vendor ID
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2240  MOVE      FOUR,F1
          MOVE      TEN,F2
          PROC      NZPCFN00             * NZ private procedure code
          GOTO      PRIH5000
.
PRIH2250  MOVE      FOUR,F1
          MOVE      TEN1,F2
          PROC      NZPCFN00             * NZ private proc code desc
          GOTO      PRIH5000
.
PRIH2260  MOVE      FOUR,F1
          MOVE      TEN2,F2
          PROC      NZPCFN00             * NZ private approval date
          GOTO      PRIH5000
.
PRIH2270  MOVE      FOUR,F1
          MOVE      TEN3,F2
          PROC      NZPCFN00             * NZ procedure desc line 2
          GOTO      PRIH5000
.
PRIH2280  MOVE      FOUR,F1
          MOVE      TEN4,F2
          PROC      NZPCFN00             * Surgeon description
          GOTO      PRIH5000
.
PRIH2290  MOVE      FOUR,F1
          MOVE      TEN5,F2
          PROC      NZPCFN00             * Anasthetist description
          GOTO      PRIH5000
.
PRIH2300  MOVE      FOUR,F1
          MOVE      TEN6,F2              * Procedure Code
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2310  MOVE      FOUR,F1
          MOVE      TEN7,F2              * Claim Code
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2320  MOVE      FOUR,F1
          MOVE      TEN8,F2              * Contract/Expected payor
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2330  MOVE      FOUR,F1
          MOVE      TEN9,F2              * Bill as separate/Include with Primary
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH2340  MOVE      ZERO,F1
          MOVE      TWENTY,F2            * Full description(primary proc)
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH2350  MOVE      ONE,F1
          MOVE      TWENTY,F2            * Full description(add proc 1)
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH2360  MOVE      TWO,F1
          MOVE      TWENTY,F2            * Full description(add proc 2)
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH2370  MOVE      THREE,F1
          MOVE      TWENTY,F2            * Full description(add proc 3)
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
PRIH2380  MOVE      FOUR,F1
          MOVE      TWENTY,F2            * Full description(add proc 4)
          PROC      NZPCFN00 
          GOTO      PRIH5000
.
. Medicare patient status
.
PRIH2390  IF        PVITYPE=9
            MATCH     " 1",PVISYST         * Event ?
            IF        @EQUAL
              CALL      CEMD0000           * Check for Emergency Event Date/Time
            ENDIF
          ENDIF
.
          IF        PVITYPE=1
            MOVE      "(Outpatient)",VARIABLE
            PACK      KEY8,DPVIBILL,SP70
            CALL      RDEMVIS1
            IF        OVRCD=0
              PACK      KEY5,ANSE,ANSD,EMVIDSTA,SP70
              CALL      RDCODE1
              IF        OVRCD=0
                MATCH     "2    ",THCSCOD
                IF        @EQUAL
                  MOVE      "(Inpatient) ",VARIABLE
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          GOTO      PRIH5000
.
PRIH2400  MATCH     SP70,PTMXADD1
          GOTO      PRIH2405 IF EQUAL
          GOTO      PRIH2405 IF EOS
.
          MOVE      PTMXADD1,VARIABLE
          GOTO      PRIH5000
.
PRIH2405  MATCH     SP70,PKADD1
          GOTO      PRIH2407 IF EQUAL
          GOTO      PRIH2407 IF EOS
.
          MOVE      PKADD1,VARIABLE
          GOTO      PRIH5000
.
PRIH2407  MOVE      PADD1,VARIABLE
          GOTO      PRIH5000
.
PRIH2410  MATCH     SP70,PTMXADD1
          GOTO      PRIH2415 IF EQUAL
          GOTO      PRIH2415 IF EOS
.
          MOVE      PTMXADD2,VARIABLE
          GOTO      PRIH5000
.
PRIH2415  MATCH     SP70,PKADD1
          GOTO      PRIH2417 IF EQUAL
          GOTO      PRIH2417 IF EOS
.
          MOVE      PKADD2,VARIABLE
          GOTO      PRIH5000
.
PRIH2417  MOVE      PADD2,VARIABLE
          GOTO      PRIH5000
.
PRIH2420  MATCH     SP70,PTMXADD1
          GOTO      PRIH2425 IF EQUAL
          GOTO      PRIH2425 IF EOS
.
          MOVE      PTMXADD3,VARIABLE
          GOTO      PRIH5000
.   
PRIH2425  MATCH     SP70,PKADD1
          GOTO      PRIH2427 IF EQUAL
          GOTO      PRIH2427 IF EOS
.
          MOVE      PKSUBR,VARIABLE
          GOTO      PRIH5000
.
PRIH2427  MOVE      PSUBRB,VARIABLE
          GOTO      PRIH5000
.
PRIH2430  MATCH     SP70,PTMXADD1
          GOTO      PRIH2435 IF EQUAL
          GOTO      PRIH2435 IF EOS
.   
          MOVE      PTMXADD4,VARIABLE
          GOTO      PRIH5000
.   
PRIH2435  MATCH     SP70,PKADD1
          GOTO      PRIH2437 IF EQUAL
          GOTO      PRIH2437 IF EOS
.
          MOVE      PKADD4,VARIABLE
          GOTO      PRIH5000
.
PRIH2437  MOVE      PADD4,VARIABLE
          GOTO      PRIH5000
.
PRIH2440  MATCH     SP70,PTMXADD1
          GOTO      PRIH2445 IF EQUAL
          GOTO      PRIH2445 IF EOS
.
          MOVE      PTMXPOST,VARIABLE
          GOTO      PRIH5000
.
PRIH2445  MATCH     SP70,PKADD1
          GOTO      PRIH2447 IF EQUAL
          GOTO      PRIH2447 IF EOS
.
          MOVE      PKPOST,VARIABLE
          GOTO      PRIH5000
.
PRIH2447  MOVE      PPOST,VARIABLE
          GOTO      PRIH5000
.
PRIH2450  UNPACK    PMPXMEDC,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN=8
            MOVE      CPDATE,VARIABLE
          ELSE
            MOVE      CPCDATE,VARIABLE
          ENDIF
          GOTO      PRIH5000
.
PRIH2460  CLOCK     TIME,VARIABLE            * Current Time
          GOTO      PRIH5000
.
PRIH2470  UNPACK    EMVIDATE,CCENT,CYEAR,CMON,CDAY
          PACK      VARIABLE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          GOTO      PRIH5000
.
PRIH2480  MOVE      EMVITIME,VARIABLE
          GOTO      PRIH5000
.
.         Billing From date
.
PRIH2490  PROC      BFRDAT00
          GOTO      PRIH5000
.
.         JH Billing Todate
.
PRIH2500  PROC      BTODAT00
          GOTO      PRIH5000
.
PRIH2510  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TEN;*54,CFILENO
          MOVE      CFILENO,VARIABLE
          GOTO      PRIH5000
.
PRIH2520  PROC      VISCOMNT             * Read visit comment file
          GOTO      PRIH5000
.
PRIH2530  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          IF        PTCNNHII=1
            OPEN     NHIMASA2,"nhimasaf"
            MOVE     PURNO,KEY8
            CALL     RDNHMAS2
            IF       OVRCD=0
              MOVE     NHMAGIV1,VARIABLE     * NHI Given Name
            ENDIF
          ENDIF
          GOTO      PRIH5000
.
PRIH2540  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          IF        PTCNNHII=1
            OPEN     NHIMASA2,"nhimasaf"
            MOVE     PURNO,KEY8
            CALL     RDNHMAS2
            IF       OVRCD=0
              MOVE     SP70,PACTITLE
              CALL     PACNHIN
              MOVE     PACFNAME,VARIABLE      * Formatted NHI Name
            ENDIF
          ENDIF
          GOTO      PRIH5000
.
PRIH2550  MOVE     PSNAME,PACSNAME
          MOVE     PGNAME,PACGNAME
          MOVE     SP70,PACTITLE
          MOVE     TWO,PACFRMT            * Surname, Given Name
          CALL     PACNAME
          MOVE     PACFNAME,VARIABLE      * Formatted Patient's Name
          GOTO     PRIH5000
.
PRIH2560  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          IF        PTCNNHII=1
            OPEN     NHIMASA2,"nhimasaf"
            MOVE     PURNO,KEY8
            CALL     RDNHMAS2
            IF       OVRCD=0
              MOVE     NHMASURN,VARIABLE     * NHI Surname Name
            ENDIF
          ENDIF
          GOTO     PRIH5000
.
PRIH2570  CALL      SPRD0000                 * PRA Full Address
          GOTO      PRIH5000
.
PRIH2580  CALL      SPAD0000                 * Patient Full Address
          GOTO      PRIH5000
.
PRIH2590  CALL      SPOS0000                 * Postal Full Address
          GOTO      PRIH5000
.
PRIH2600  MOVE      ZERO,F1
          MOVE      TWENTY1,F2           * Theatre Duration (primary proc)
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2610  MOVE      ONE,F1
          MOVE      TWENTY1,F2           * Theatre Duration (add proc 1)
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2620  MOVE      TWO,F1
          MOVE      TWENTY1,F2           * Theatre Duration (add proc 2)
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2630  MOVE      THREE,F1
          MOVE      TWENTY1,F2           * Theatre Duration (add proc 3)
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2640  MOVE      FOUR,F1
          MOVE      TWENTY1,F2           * Theatre Duration (add proc 4)
          PROC      NZPCFN00
          GOTO      PRIH5000
.
PRIH2650  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS   * Multi Hospital
          IF        IBCNMHOS=1
            PACK      KEY8,DPVIBILL,SP70
            OPEN      PMSVX1A1,"pmsvx1af"
            CALL      RDPMVX11
            BRANCH    OVRCD,PRIH5000
.
            OPEN      PATHSPA1,"pathspaf"
            MOVE      PMVXMHOS,KEY3
            CALL      RDPTHSP1
            BRANCH    OVRCD,PRIH5000
            MOVE      PTHSAPPR,VARIABLE          * Hospital Approval Number
          ENDIF
          GOTO      PRIH5000
.
PRIH2660  OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PMSPRGA1,"pmsprgaf"
          PACK      KEY8,DPVIBILL,SP70
          CALL      RDPMVX11
          IF        OVRCD=0
            MOVE      PMVXPRGM,VARIABLE          * Program Code
          ENDIF
          GOTO      PRIH5000
.
PRIH2670  OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PMSPRGA1,"pmsprgaf"
          PACK      KEY8,DPVIBILL,SP70
          CALL      RDPMVX11
          IF        OVRCD=0
            MATCH     SP70,PMVXPRGM
            IF        !@EQUAL
              PACK      KEY8,PMVXPRGM,SP70
              CALL      RDPMPRG1
              IF        OVRCD=0
                PACK      VARIABLE,PMPGDESC,SP70    * Program Code description
              ENDIF
            ENDIF
          ENDIF
          GOTO      PRIH5000
.
PRIH2671  MOVE      PSEX,DSEXCHAR	  
          CALL      SEXDSP00	      
          MOVE      DSEXLDES,VARIABLE        * Get sex long description		
          GOTO      PRIH5000	      
.
PRIH2672  MOVE      PTMASNAM,VARIABLE        * Patient Surname
          GOTO      PRIH5000
.
PRIH2673  OPEN      PMSPX2A1,"pmspx2af"
          PACK      KEY8,PVIURNO,SP70
          CALL      RDPMPX21
          IF        OVRCD=0
            MOVE      PMPXFNAM,VARIABLE        * Patient First name
          ENDIF
          GOTO      PRIH5000
.
PRIH2674  OPEN      PMSPX2A1,"pmspx2af"
          PACK      KEY8,PVIURNO,SP70
          CALL      RDPMPX21
          IF        OVRCD=0
            MOVE      PMPXSNAM,VARIABLE        * Patient Second  name (pmpxsnam)
          ENDIF
          GOTO      PRIH5000
.
PRIH2675  OPEN      PMSTLEA1,"pmstleaf"
          PACK      KEY4,PTITL,SP70
          CALL      RDPMTLE1
          IF        OVRCD=0
            PACK      VARIABLE,PMTLDESC,SP70  * Patient Title Description
          ENDIF
          GOTO      PRIH5000
.
PRIH2676  MOVE      ZERO,F1
          MOVE      TWENTY2,F2
          PROC      NZPCFN00                 * NZ Insurer code (cat I)
          GOTO      PRIH5000
.
PRIH2677  MOVE      ZERO,F1
          MOVE      TWENTY3,F2
          PROC      NZPCFN00                 * NZ Insurer short desc (cat I)
          GOTO      PRIH5000
.
PRIH2678  MOVE      ZERO,F1
          MOVE      TWENTY4,F2
          PROC      NZPCFN00                 * NZ Insurer long desc (cat I)
          GOTO      PRIH5000
.
PRIH2679  MOVE      ONE,F1                   * Add Proc 1
          MOVE      TWENTY2,F2
          PROC      NZPCFN00                 * NZ Insurer code (cat I)
          GOTO      PRIH5000
.
PRIH2680  MOVE      ONE,F1                   * Add Proc 1
          MOVE      TWENTY3,F2
          PROC      NZPCFN00                 * NZ Insurer short desc (cat I)
          GOTO      PRIH5000
.
PRIH2681  MOVE      ONE,F1                   * Add Proc 1
          MOVE      TWENTY4,F2
          PROC      NZPCFN00                 * NZ Insurer long desc (cat I)
          GOTO      PRIH5000
.
PRIH2682  MOVE      TWO,F1                   * Add Proc 2
          MOVE      TWENTY2,F2
          PROC      NZPCFN00                 * NZ Insurer code (cat I)
          GOTO      PRIH5000
.
PRIH2683  MOVE      TWO,F1                   * Add Proc 2
          MOVE      TWENTY3,F2
          PROC      NZPCFN00                 * NZ Insurer short desc (cat I)
          GOTO      PRIH5000
.
PRIH2684  MOVE      TWO,F1                   * Add Proc 2
          MOVE      TWENTY4,F2
          PROC      NZPCFN00                 * NZ Insurer long desc (cat I)
          GOTO      PRIH5000
.
PRIH2685  MOVE      THREE,F1                 * Add Proc 3
          MOVE      TWENTY2,F2
          PROC      NZPCFN00                 * NZ Insurer code (cat I)
          GOTO      PRIH5000
.
PRIH2686  MOVE      THREE,F1                 * Add Proc 3
          MOVE      TWENTY3,F2
          PROC      NZPCFN00                 * NZ Insurer short desc (cat I)
          GOTO      PRIH5000
.
PRIH2687  MOVE      THREE,F1                 * Add Proc 3
          MOVE      TWENTY4,F2
          PROC      NZPCFN00                 * NZ Insurer long desc (cat I)
          GOTO      PRIH5000
.
PRIH2688  MOVE      FOUR,F1                  * Add Proc 4
          MOVE      TWENTY2,F2
          PROC      NZPCFN00                 * NZ Insurer code (cat I)
          GOTO      PRIH5000
.
PRIH2689  MOVE      FOUR,F1                  * Add Proc 4
          MOVE      TWENTY3,F2
          PROC      NZPCFN00                 * NZ Insurer short desc (cat I)
          GOTO      PRIH5000
.
PRIH2690  MOVE      FOUR,F1                  * Add Proc 4
          MOVE      TWENTY4,F2
          PROC      NZPCFN00                 * NZ Insurer long desc (cat I)
          GOTO      PRIH5000
.
PRIH2691  PACK      VARIABLE,PMPXPFSN,SP70   * Preferred Surname
          GOTO      PRIH5000  
.
PRIH2692  PACK      VARIABLE,PMPXPFGN,SP70   * Preferred Given Name
          GOTO      PRIH5000
.
PRIH2693  PACK      VARIABLE,PSNAME,SP70     * Pref Surname instead of Actual SN
          MATCH     "1",PTCNPFSN
          IF        @EQUAL
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFSN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PRIH5000
.
PRIH2694  PACK      VARIABLE,PGNAME,SP70     * Pref GN instead of Actual GN
          MATCH     "1",PTCNPFGN
          IF        @EQUAL
            MATCH     SP70,PMPXPFGN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFGN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PRIH5000
.
PRIH2695  PACK      VARIABLE,PTMASNAM,SP70   * Pref Surname instead of 40char SN
          MATCH     "1",PTCNPFSN
          IF        @EQUAL
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFSN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PRIH5000
.
PRIH2696  PACK      VARIABLE,CAPPRVNO,SP70   * Hospital Provider Approval Number
          GOTO      PRIH5000
.
PRIH2697  PACK      VARIABLE,PTCNHABN,SP70   * Hospital ABN Number
          GOTO      PRIH5000
.
PRPH2550  MOVE      1,FORM3
          MOVE      10,FORM3B
          PROC      EXPRCDSC
          GOTO      PRIHL100
.
PRPH2560  MOVE      11,FORM3
          MOVE      20,FORM3B
          PROC      EXPRCDSC
          GOTO      PRIHL100
.
PRPH2570  MOVE      21,FORM3
          MOVE      30,FORM3B
          PROC      EXPRCDSC
          GOTO      PRIHL100
.
PRPH2580  MOVE      31,FORM3
          MOVE      40,FORM3B
          PROC      EXPRCDSC
          GOTO      PRIHL100
.
PRPH2590  MOVE      41,FORM3
          MOVE      50,FORM3B
          PROC      EXPRCDSC
          GOTO      PRIHL100
.
.
. ------- Format the variable -------
.
PRIH5000  RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      PRIHL100               * Read next record
.
. ------- Formatting for Form fields and right justified variables -------
.
PRIH6000  COMPARE   ZERO,PRNTSTRT          * Don't bump if printing full length
          GOTO      PRIH7000 IF EQUAL
.
          BUMP      VARIABLE,PRNTSTRT      * bump to starting position
          PACK      VARIABLE,VARIABLE,SP70
.
. ------- Print the variable -------
.
PRIH7000  PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      PRIHL100                 * Read next record
.
.------ end of invoice reached ------
.
PRIH8000  MOVE      FALSE,EXIT
.
.------ print new-lines until the end of page is reached ------
.
PRIH9000  COMPARE   CURRROW,IBTHLENG          * test page length
          GOTO      PRIH9999 IF EQUAL
.
          PRINT     *N;
          ADD       ONE,CURRROW
          GOTO      PRIH9000
.
PRIH9999  MOVE      FALSE,EXIT               * Set exit flag
.>>>>     CALL      CLSPRINT                 * close the spool file
          RETURN                             * Finished
+
.******************************************************************************
.         Set PRA Full Address
.******************************************************************************
SPRD0000  CLEAR     VARIABLE
          APPEND    PKSUBR,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    PKADD4,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    PKPOST,VARIABLE          * PRA Postcode
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP70,VARIABLE
          RESET     VARIABLE
SPRD9999  RETURN
+
.******************************************************************************
.         Set Patient full Address
.******************************************************************************
SPAD0000  CLEAR     VARIABLE
          APPEND    PSUBRB,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    PADD4,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    PPOST,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP70,VARIABLE
          RESET     VARIABLE
SPAD9999  RETURN
+
.******************************************************************************
.         Set Postal Full Address
.******************************************************************************
SPOS0000  CLEAR     VARIABLE
          APPEND    PTMXADD3,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    PTMXADD4,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    PTMXPOST,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP70,VARIABLE
          RESET     VARIABLE
SPOS9999  RETURN
+
.******************************************************************************
.         Set Hospital Full Address for Non-Multi Hospital
.******************************************************************************
SHAD0000  CLEAR     VARIABLE
          APPEND    CHADD1,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    CHADD2,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    CHPOST,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP70,VARIABLE
          RESET     VARIABLE
SHAD9999  RETURN
.******************************************************************************
.         Set Hospital Full Address for Multi Hospital
.******************************************************************************
SMAD0000  CLEAR     VARIABLE
          APPEND    PTHSADD1,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    PTHSADD2,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    PTHSADD3,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    PTHSADD4,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP1,VARIABLE
          APPEND    PTHSPCOD,VARIABLE
          RESET     VARIABLE
          STRIP     VARIABLE
          ENDSET    VARIABLE
          APPEND    SP70,VARIABLE
          RESET     VARIABLE
SMAD9999  RETURN
.******************************************************************************
.*                         CEMD0000                                           *
.*              Check Emergency event date/time against Inpatient visit       *
.******************************************************************************
CEMD0000  OPEN      PMSEVTA1,"pmsevtaf"
.
          PACK      KEY8,DPVIBILL,SP70
          CALL      RDPMEVT1
          BRANCH    OVRCD,CEMD9999       * missing event record
          PACK      KEY5,ANSE,ANSV,PMEVEVNT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CEMD9999
          MATCH     ANSE,TCINDC1
          GOTO      CEMD9999 IF NOT EQUAL   * Not Emergency event
.
          MOVE      "(Outpatient)",VARIABLE
          PACK      KEY8,DPVIBILL,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,CEMD9999
.
          MOVE      DPVIBILL,D8          * Save admission number
          OPEN      PATVISA2,"patvisaf"
          OPEN      PATMI1A1,"patmi1af"
.
          MOVE      PVIURNO,AURNO
          PACK      KEY24,PVIURNO,Z70
          CALL      RDSVISA2
CEMD1000  CALL      RDPVISA2
          BRANCH    OVRCD,CEMD6000
          MATCH     PVIURNO,AURNO           * Same U/R number?
          GOTO      CEMD6000 IF NOT EQUAL
          COMPARE   THREE,PVITYPE           * Inpatient visit?
          GOTO      CEMD1000 IF NOT EQUAL
.
          MOVE      PVIBILL,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,CEMD1000
          COMPARE   TWO,ASTAT
          GOTO      CEMD1000 IF NOT EQUAL   * Not currently admitted
.
          MATCH     ADATE,PMEVADTE
          GOTO      CEMD6000 IF LESS
.
          MATCH     ADATE,PMEVADTE
          IF        @EQUAL
            MATCH     ATIME,PMEVATIM
            GOTO      CEMD6000 IF LESS
          ENDIF
.
          MOVE      "(Inpatient) ",VARIABLE
.
CEMD6000  MOVE      D8,KEY8                 * restore admission number
          CALL      RDVISA1
          CALL      RDMISS1
CEMD9999  RETURN
+
.******************************************************************************
.*                                 GCLMD000                                   *
.*                             Get claim details                              *
.******************************************************************************
GCLMD000  
.         Set the claim type indicator if this is a claim
.
          IF        PVITYPE=1
            PACK      KEY8,DPVIBILL,SP70
            CALL      RDEMVIS1
            IF        OVRCD=0
              MOVE      EMVICOMP,ACLAIM
            ENDIF
          ELSE
            IF        PVITYPE=2
              PACK      KEY8,DPVIBILL,SP70
              CALL      RDBOKB1
              IF        OVRCD=0
                MOVE      OBACOMP,ACLAIM
              ENDIF
            ELSE
              IF      PVITYPE=9
                MATCH     " 1",PVISYST
                IF        @EQUAL
                  PACK      KEY8,DPVIBILL,SP70
                  OPEN      PMSEVTA1,"pmsevtaf"
                  CALL      RDPMEVT1
                  IF        OVRCD=0
                    MOVE      PMEVCCOD,ACLAIM
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      ZERO,CLAIM
          PACK      KEY5 WITH CODECL,ACLAIM
          CALL      RDCODE1
          BRANCH    OVRCD OF GCLMD030
.
.         Check the indicators for a W, M, or V (these are the claims)
.
          MOVE      ZERO,F2
GCLMD010  ADD       ONE,F2
          COMPARE   SIX,F2
          GOTO      GCLMD030 IF NOT LESS
.
          LOAD      ANS USING F2 OF TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
.
          MATCH     "W",ANS
          GOTO      GCLMD020 IF EQUAL
          MATCH     "M",ANS
          GOTO      GCLMD020 IF EQUAL
          MATCH     "V",ANS
          GOTO      GCLMD020 IF EQUAL
          MATCH     "D",ANS
          GOTO      GCLMD020 IF EQUAL
          GOTO      GCLMD010
.
.         We have a claim
.
GCLMD020  MOVE      SP10,IREFNO
          REP       "W1M2V3D4",ANS
          MOVE      ANS,CLAIM
.
GCLMD030  BRANCH    CLAIM,GCLMD100,GCLMD200,GCLMD300
.
.         PACK      HFNMTB,AFUNDH,SLASH,AFNDTB
.         MOVE      AFNDMM,IREFNO
          GOTO      GCLMD999
.
GCLMD100  MOVE      "WCO/",HFNMTB                * worker's comp
          MOVE      AADMNO,KEY8
          OPEN      PATWC1A1,"patwc1af"
          CALL      RDWCOM1
          BRANCH    OVRCD,GCLMD999
          RESET     HFNMTB,4
          APPEND    WCICODE,HFNMTB
          RESET     HFNMTB
          MOVE      WCCLMNO,IREFNO               * claim number
          GOTO      GCLMD999
.
GCLMD200  MOVE      "MAB/TAC",HFNMTB             * TAC
          MOVE      AADMNO,KEY8
          OPEN      PATWMAB1,"patwmabf"
          CALL      RDWMAB1
          BRANCH    OVRCD,GCLMD999
          MOVE      MREFNO,IREFNO                * claim number
          GOTO      GCLMD999
.
GCLMD300  MOVE      "DVA",HFNMTB                 * DVA
          MOVE      AADMNO,KEY8
          OPEN      PATWVET1,"patwvetf"
          CALL      RDWVET1
          BRANCH    OVRCD,GCLMD999
          MOVE      VCLMNO,IREFNO                * claim number
.
GCLMD999  RETURN
+
.******************************************************************************
.*                                 GETCON00                                   *
.*                             Get consultant details                         *
.******************************************************************************
GETCON00  MOVE      SP70,DOCTCODE
          MATCH     ZEROVISN,AADMNO
          GOTO      GETCON99 IF EQUAL
.
          PACK      KEY8,AADMNO,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,GETCON05
          BRANCH    PVITYPE,GETCON10,GETCON20,GETCON30
          GOTO      GETCON99
.
GETCON05  MOVE      ZERO,PVITYPE
          MOVE      ONE,COPTION
          PROC      OUTDET00
          GOTO      GETCON99
.
.Emergency
GETCON10  MOVE      ONE,COPTION
          PROC      EMRCHK00
          GOTO      GETCON99
.
.Outpatient
GETCON20  MOVE      ONE,COPTION
          PROC      OUTDET00
          GOTO      GETCON99
.
.Inpatient
GETCON30  MATCH     SP70,PVIDOCT
          GOTO      GETCON99 IF EQUAL
          GOTO      GETCON99 IF EOS
          MOVE      PVIDOCT,DOCTCODE
          GOTO      GETCON99
.
GETCON99  RETURN
.
.***************************************************************************
.  This routine formats a name into the requested format from NHI name.
.     Surname dim25 and first given name dim20
.---------------------------------------------------------------------------
.
PACNHIN   PACK      PACFNAME,SP30,SP30       * Initialise to blanks.
.
.         Title Given_names Surname
.
PACNH100  CLEAR     PACFNAME
          APPEND    PACTITLE,PACFNAME        * Append title
.
.         Find the end of the title
.
PACNH150  CMATCH    SP1,PACFNAME
          GOTO      PACNH200 IF NOT EQUAL
.
          BUMP      PACFNAME,-1              * Try the previous character
          GOTO      PACNH150 IF NOT EOS
.
.         No title. Go directly to adding the given name
.
          CLEAR     PACFNAME                 * Make sure the name is cleared
          GOTO      PACNH210
.
.         Found the end of the title. Add the given name
.
PACNH200  APPEND    SP1,PACFNAME             * Add a blank after the title
PACNH210  APPEND    NHMAGIV1,PACFNAME        * Append the given names
.
.         Find the end of the given names
.
PACNH250  CMATCH    SP1,PACFNAME
          GOTO      PACNH300 IF NOT EQUAL
.
          BUMP      PACFNAME,-1              * Try the previous character
          GOTO      PACNH250 IF NOT EOS
.
.         No title or given name. Go directly to adding the surname
.
          CLEAR     PACFNAME                 * Make sure the name is cleared
          GOTO      PACNH310
.
.         Found the end of the given names. Add the surname
.
PACNH300  APPEND    SP1,PACFNAME             * Add a blank after the title
PACNH310  APPEND    NHMASURN,PACFNAME        * Append the surname
          APPEND    SP30,PACFNAME            * Pad out with spaces
          APPEND    SP30,PACFNAME            * Pad out with spaces
          RESET     PACFNAME
          GOTO      PACNH999
.
PACNH9999 RETURN
+
.******************************************************************************
.         SX Insurer free text field
.******************************************************************************
          DEFPROC   VISCOMNT
.
          INC       VISCMTFD/INC
.
VISC0000  MOVE      AADMNO,VSCTVIST
          MOVE      "006",VSCTTYPE
          MOVE      "  1",VSCTLINE
          OPEN      VISCMTA1,"viscmtaf"
          PACK      KEY14,VSCTVIST,VSCTTYPE,VSCTLINE,SP70
          CALL      RDVSCMT1
          IF        OVRCD=0
            MOVE      VSCTDATA,VARIABLE
          ENDIF
          GOTO      VISC9999
.
          INC       VISCMTIO/INC
          INC       IBAOVRIO/INC
.
VISC9999  ENDPROC
+
.******************************************************************************
. ----- Check the Contract Funding file ------
.******************************************************************************
          DEFPROC   NZPCFN00
.
COUNT     FORM      1
DEFFLAG   FORM      1
          INC       NZPCFNFD/INC
          INC       NZPSPRFD/INC
          INC       PATCMCFD/INC
.         
CHCF0000  OPEN      NZPCFNA1,"nzpcfnaf"
          OPEN      NZPSPRA1,"nzpspraf"
          OPEN      PATCMCA1,"patcmcaf"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TEN9;*212,CFEETYP
          COMPARE   FIVE,CFEETYP            * NZ Private only
          GOTO      CHCF9000 IF NOT EQUAL
.
          MOVE      ZERO,COUNT
          PACK      KEY11,AADMNO,SP70
          CALL      RSNZSPR1
CHCF0500  CALL      RKNZSPR1
          BRANCH    OVRCD,CHCF9000
          MATCH     NZSPADMN,DAADMNO
          GOTO      CHCF9000 IF NOT EQUAL
....      MATCH     "PRFA  ",EXPPAYER
....      IF        @EQUAL
....        MATCH     SP70,NZSPCNTR
....        GOTO      CHCF0500 IF NOT EQUAL
....      ELSE
....        MATCH     EXPPAYER,NZSPCNTR
....        GOTO      CHCF0500 IF NOT EQUAL
....      ENDIF
          COMPARE   ZERO,F1         * zero = primary procedure
          IF        @EQUAL
            COMPARE   ONE,NZSPPRIM
            GOTO      CHCF0500 IF NOT EQUAL
            GOTO      CHCF1000
          ENDIF
.
          COMPARE   ONE,NZSPPRIM
          GOTO      CHCF0500 IF EQUAL
.
          COMPARE   ONE,NZSPPIND
          GOTO      CHCF0500 IF NOT EQUAL
.
          ADD       ONE,COUNT
          COMPARE   F1,COUNT
          GOTO      CHCF0500 IF NOT EQUAL
.
CHCF1000  MOVE      PMVXMHOS,KEY3
.
          MOVE      ZERO,NZCFBDET
          PACK      KEY5,ANSC,ANSL,NZSPCLMN,SP70
          CALL      RDCODE1
          IF        OVRCD<>1
            MATCH     SP70,TCINDC7
            IF        !@EQUAL
              CALL      CCFN0000
              BRANCH    EXIT,CHCF9000
            ENDIF
          ENDIF
.
          COMPARE   ONE,F2
          IF        @EQUAL
            MOVE      NZSPAPRV,VARIABLE
          ENDIF
.
          COMPARE   TWO,F2
          IF        @EQUAL
            MOVE      NZSPCLNO,VARIABLE
          ENDIF
.
          COMPARE   THREE,F2
          IF        @EQUAL
            IF        NZCFBDET=1
              MOVE      NZCFHNAM,VARIABLE
            ENDIF
          ENDIF
.
          COMPARE   FOUR,F2
          IF        @EQUAL
            IF        NZCFBDET=1
              MOVE      NZCFHAD1,VARIABLE
            ENDIF
          ENDIF
.
          COMPARE   FIVE,F2
          IF        @EQUAL
            IF        NZCFBDET=1
              MOVE      NZCFHAD2,VARIABLE
            ENDIF
          ENDIF
.
          COMPARE   SIX,F2
          IF        @EQUAL
            IF        NZCFBDET=1
              MOVE      NZCFHAD3,VARIABLE
            ENDIF
          ENDIF
.
          COMPARE   SEVEN,F2
          IF        @EQUAL
            IF        NZCFBDET=1
              MOVE      NZCFHAD4,VARIABLE
            ENDIF
          ENDIF
.
          COMPARE   EIGHT,F2
          IF        @EQUAL
            CALL      CFFS0000               * Check for Fees for Service
            IF        F1=0
              MOVE      NZCFREFN,VARIABLE    * only for contract patient
            ENDIF
          ENDIF
.
          COMPARE   NINE,F2
          IF        @EQUAL
            CALL      CFFS0000               * Check for Fees for Service
            IF        F1=0
              MOVE      NZCFVNID,VARIABLE    * only for contract patient
            ENDIF
          ENDIF
.
          COMPARE   TEN,F2
          IF        @EQUAL
            MOVE      NZSPCPRC,VARIABLE
          ENDIF
.
          COMPARE   TEN1,F2
          IF        @EQUAL
            PACK      KEY9,NZSPCPRC,SP70
            CALL      RDPTCMC1
            IF        OVRCD<>1
              MOVE      PTCADES1,VARIABLE
            ENDIF
          ENDIF
.
          COMPARE   TEN2,F2
          IF        @EQUAL
            UNPACK    NZSPADTE,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      CPCDATE,VARIABLE
          ENDIF
.
          COMPARE   TEN3,F2
          IF        @EQUAL
            PACK      KEY9,NZSPCPRC,SP70
            CALL      RDPTCMC1
            IF        OVRCD<>1
              MOVE      PTCADES2,VARIABLE
            ENDIF
          ENDIF
.
          COMPARE   TEN4,F2
          IF        @EQUAL
            MATCH     SP70,NZSPSURG
            IF        @EQUAL | @EOS
              MOVE      SP70,VARIABLE
            ELSE
              PACK      KEY6,NZSPSURG,SP70
              CALL      RDDOCT1
              IF        OVRCD=1
                MOVE      SP70,VARIABLE
              ELSE
                MOVE      DSNAME,PACSNAME
                MOVE      DGNAME,PACGNAME
                MOVE      DTITL,PACTITLE
                MOVE      ONE,PACFRMT
                CALL      PACNAME
                MOVE      PACFNAME,VARIABLE
              ENDIF
            ENDIF
          ENDIF
.
          COMPARE   TEN5,F2
          IF        @EQUAL
            MATCH     SP70,NZSPANAE
            IF        @EQUAL | @EOS
              MOVE      SP70,VARIABLE
            ELSE
              PACK      KEY6,NZSPANAE,SP70
              CALL      RDDOCT1
              IF        OVRCD=1
                MOVE      SP70,VARIABLE
              ELSE
                MOVE      DSNAME,PACSNAME
                MOVE      DGNAME,PACGNAME
                MOVE      DTITL,PACTITLE
                MOVE      ONE,PACFRMT
                CALL      PACNAME
                MOVE      PACFNAME,VARIABLE
              ENDIF
            ENDIF
          ENDIF
.
          COMPARE   TEN6,F2
          IF        @EQUAL
            MOVE      NZSPPROC,VARIABLE
          ENDIF
.         
          COMPARE   TEN7,F2
          IF        @EQUAL
            PACK      KEY5,ANSC,ANSL,NZSPCLMN,SP70
            CALL      RDCODE1
            IF        OVRCD<>1
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
.         
          COMPARE   TEN8,F2
          IF        @EQUAL
            MOVE      NZSPCNTR,VARIABLE
          ENDIF
.
          COMPARE   TEN9,F2
          IF        @EQUAL
            MOVE      NZSPPRIM,VARIABLE
          ENDIF
.
          COMPARE   TWENTY,F2
          IF        @EQUAL
            MOVE      NZSPPDES,VARIABLE
          ENDIF
.
          COMPARE   TWENTY1,F2
          IF        @EQUAL
            IF        NZSPPIND=1 & NZSPPRIM<>2
              MOVE      NZSPTDUR,VARIABLE
            ENDIF
          ENDIF
.
          COMPARE   TWENTY2,F2
          IF        @EQUAL
            MOVE      NZSPINSR,VARIABLE
          ENDIF
.
          COMPARE   TWENTY3,F2
          IF        @EQUAL
            MATCH     SP70,NZSPINSR
            IF        !@EQUAL
              PACK      KEY5,ANSI,SP1,NZSPINSR
              CALL      RDCODE1
              IF        OVRCD <> 1
                MOVE      TDESC,VARIABLE
              ENDIF 
            ENDIF
          ENDIF
.
          COMPARE   TWENTY4,F2
          IF        @EQUAL
            MATCH     SP70,NZSPINSR
            IF        !@EQUAL
              PACK      KEY5,ANSI,SP1,NZSPINSR
              CALL      RDCODE1
              IF        OVRCD <> 1
                MOVE      PTCDLDES,VARIABLE
              ENDIF
            ENDIF
          ENDIF
.
          GOTO      CHCF9999
.
CHCF9000  MOVE      ONE,EXIT
CHCF9999  GOTO      NZPCFN99
+
.******************************************************************************
. ----- Check for FFS ----
.******************************************************************************
CFFS0000  MOVE      ZERO,F1
          MATCH     SP70,NZSPCPRC
          GOTO      CFFS9000 IF EQUAL      * No contract
.
          MATCH     "1",NZSPCONT           * Max funder contribution?
          GOTO      CFFS9999 IF NOT EQUAL
.
CFFS9000  MOVE      ONE,F1                 * FFS
CFFS9999  RETURN
+
.******************************************************************************
. ----- Check the Contract Funding file ------
.******************************************************************************
CCFN0000  MOVE      ZERO,EXIT
          MOVE      ZERO,DEFFLAG
          MATCH     SP70,PMVXMHOS
          GOTO      CCFN0500 IF NOT EQUAL
.
CCFN0500  MOVE      ONE,NZCFSTYP           * default start type
          MOVE      ZERO,FORM1
          PACK      SKEY21,PMVXMHOS,NZSPCLMN,NZSPCNTR,NZSPCPRC,SP70
.
CCFN2000  PACK      KEY30,SKEY21,ONE,SP70
          CALL      RSNZCFN1
          CALL      RKNZCFN1
          BRANCH    OVRCD,CCFN2200
          PACK      KEY21,NZCFHOSP,NZCFCLMC,NZCFCNTR,NZCFCPRC,SP70
.
          MATCH     KEY21,SKEY21
          GOTO      CCFN5000 IF EQUAL        * check the start and enddate
.
.         Try with Claim code,blank Health fund and Contract procedure code
.
CCFN2200  IF        DEFFLAG=7
            MOVE      EIGHT,DEFFLAG
            PACK      SKEY21,SP3,NZSPCLMN,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=6
            MOVE      SEVEN,DEFFLAG
            PACK      SKEY21,SP3,NZSPCLMN,SP6,NZSPCPRC,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=5
	    MOVE      SIX,DEFFLAG
            PACK      SKEY21,SP3,NZSPCLMN,NZSPCNTR,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=4
            MOVE      FIVE,DEFFLAG
            PACK      SKEY21,SP3,NZSPCLMN,NZSPCNTR,NZSPCPRC,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=3
            MOVE      FOUR,DEFFLAG
            PACK      SKEY21,PMVXMHOS,NZSPCLMN,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=2
            MOVE      THREE,DEFFLAG
            PACK      SKEY21,PMVXMHOS,NZSPCLMN,SP6,NZSPCPRC,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=1
            MOVE      TWO,DEFFLAG
            PACK      SKEY21,PMVXMHOS,NZSPCLMN,NZSPCNTR,SP6,SP70
            GOTO      CCFN2000
          ENDIF
          IF        DEFFLAG=8
            GOTO       CCFN9000
          ENDIF
.
.
.         Try with blank Health fund
.
          PACK      SKEY21,PMVXMHOS,NZSPCLMN,SP6,NZSPCPRC,SP70
          MOVE      ONE,DEFFLAG
          GOTO      CCFN2000
.
.         Check the admission date
.
CCFN5000  REP       " 0",ADATE
.
.         If patient admitted before the start date, No Contract
.
          MATCH     NZCFSDAT,ADATE       * Admit./disc.before start date?
          GOTO      CCFN2200 IF LESS        * Yes, invalid
.
          MATCH     SP70,NZCFEDAT
          GOTO      CCFN7000 IF EQUAL       * No end date, so it's valid
.
          MATCH     ADATE,NZCFEDAT       * Check End date
          GOTO      CCFN2200 IF LESS        * Date is after end date, invalid
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          COMPARE   ONE,IBCNMHOS
          GOTO      CCFN8000 IF NOT EQUAL
.
.         Check if this is for a specific Doctor
.
CCFN7000  MATCH     "1",NZCFDOCS
          GOTO      CCFN8000 IF NOT EQUAL   * Not for a specific doctor
.
          PACK      KEY40,NZCFHOSP,NZCFCLMC,NZCFCNTR,NZCFCPRC,NZCFSTYP:
                          NZCFSDAT,NZSPSURG,SP70
          CALL      RDMLCFN1
          BRANCH    OVRCD,CCFN2200          * not valid for this hospital
.
CCFN8000  MOVE      ZERO,EXIT
          GOTO      CCFN9999
.
CCFN9000  MOVE      ONE,EXIT
CCFN9999  RETURN
.
+
          INC       NZPCFNIO/INC
          INC       NZPSPRIO/INC
          INC       PATCMCIO/INC
          INC       IBAOVRIO/INC
.
NZPCFN99  ENDPROC
+
.******************************************************************************
. ----- Get JH Billing From date ------
.******************************************************************************
          DEFPROC   BFRDAT00
.
DTRDATE   DIM       8
.
          INC       PATDTRFD/INC
.
          MOVE      ADATE,DTRDATE            * default Billing From date
          MATCH     "PATWEB72",PRGID         * print statement
          GOTO      FDAT2000 IF EQUAL
          MATCH     ALACDTE,ADATE
          GOTO      FDAT2000 IF EQUAL        * First invoice
.
          MOVE      ALACDTE,DTRDATE
          MATCH     "PATWEB71",PRGID
          GOTO      FDAT2000 IF EQUAL        * Printing current invoice
.
          OPEN      PATDTRA5,"patdtraf"
          PACK      KEY23,PINVNO,SP70
          CALL      RDSDTRN5
FDAT1000  CALL      RDKDTRN5
          BRANCH    OVRCD,FDAT2000
          MATCH     PINVNO,TREF
          GOTO      FDAT2000 IF NOT EQUAL
          COMPARE   ONE,TRECTYPE
          GOTO      FDAT1000 IF NOT EQUAL    * Not accommodation record
          PACK      DTRDATE,TFCENT,TFYEAR,TFMONTH,TFDAY
          REP       " 0",DTRDATE
.
FDAT2000  UNPACK    DTRDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN=8
            MOVE      CPDATE,VARIABLE
          ELSE
            MOVE      CPCDATE,VARIABLE
          ENDIF
.
FDAT9999  GOTO      BFRDAT99
.
          INC       PATDTRIO/INC
          INC       IBAOVRIO/INC
.
BFRDAT99  ENDPROC
+
.******************************************************************************
. ----- Get JH Billing To date ------
.******************************************************************************
          DEFPROC   BTODAT00
.
DTRDATE   DIM       8
.
          INC       PATDTRFD/INC
.
          MOVE      SP70,DTRDATE
          COMPARE   THREE,ASTAT
          GOTO      TDAT9999 IF NOT EQUAL    * Not discharged
.
          MOVE      DDATE,DTRDATE
          MATCH     "PATWEB72",PRGID         * print statement
          GOTO      TDAT8000 IF EQUAL
.
.         Check if invoice raised to discharged date
.
          MATCH     "PATWEB71",PRGID
          GOTO      TDAT3000 IF EQUAL        * Printing current invoice
.
.         For reprint - check DTR for the Todate
.
          OPEN      PATDTRA5,"patdtraf"
          PACK      KEY23,PINVNO,Z70
          CALL      RDSDTRN5
TDAT2000  CALL      RDPDTRN5
          BRANCH    OVRCD,TDAT9999
          MATCH     PINVNO,TREF
          GOTO      TDAT9999 IF NOT EQUAL
          COMPARE   ONE,TRECTYPE
          GOTO      TDAT2000 IF NOT EQUAL    * Not accommodation record
          PACK      DTRDATE,TTCENT,TTYEAR,TTMONTH,TTDAY
          REP       " 0",DTRDATE
          MATCH     DTRDATE,DDATE
          GOTO      TDAT9999 IF NOT EQUAL    * Not invoice till disc.date
          GOTO      TDAT8000
.
.         Raising invoice
.
TDAT3000  MATCH     DDATE,BACKDATE
          GOTO      TDAT9999 IF LESS
.
          MOVE      DDATE,DTRDATE
          REP       " 0",DTRDATE
.
TDAT8000  UNPACK    DTRDATE,CCENT,CYEAR,CMON,CDAY      * Billing To date
          CALL      PACDATE
          IF        IBDTPLEN=8
            MOVE      CPDATE,VARIABLE
          ELSE
            MOVE      CPCDATE,VARIABLE
          ENDIF
.
TDAT9999  GOTO      BTODAT99
.
          INC       PATDTRIO/INC
          INC       IBAOVRIO/INC
.
BTODAT99  ENDPROC
+
.-----------------------------------------------------------------------------
. Procedure to print out the group of oprdedaf.PDDDATA lines.
. Input: DPVIBILL
.        FORM3  - the starting line number that will be including in print
.        FORM3B - the ending line number that will be including in print
.-----------------------------------------------------------------------------
          DEFPROC   EXPRCDSC
.
COUNT     FORM      3
LENGTH    FORM      3
.
          INC       OPRDEAFD/INC
          INC       OPRDEDFD/INC
.
EXPRDS00  OPEN      OPRDEDA1,"oprdedaf"
          OPEN      OPRDETA2,"oprdetaf"
          MOVE      ZERO,COUNT
.
          PACK      KEY31,PINVADM,SP70
          CALL      RSOPDEA2
EXPRDS20  CALL      RKOPDEA2
          BRANCH    OVRCD,EXPRDS99
.
          MATCH     DPVIBILL,OPDAADMN
          GOTO      EXPRDS99 IF NOT EQUAL
.
          COMPARE   THREE,OPDASTAT
          GOTO      EXPRDS20 IF EQUAL
.
          MOVE      "024",D3
          MOVE      FORM3,DIM3
          PACK      KEY16,OPDAUNIQ,D3,DIM3,SP70
          CALL      RDOPDED1
          BRANCH    OVRCD,EXPRDS99
.
          GOTO      EXPRDS40
.
EXPRDS30  CALL      RKOPDED1
          BRANCH    OVRCD,EXPRDS99
.
          MATCH     OPDAUNIQ,OPDDUNIQ
          GOTO      EXPRDS99 IF NOT EQUAL
.
          MATCH     D3,OPDDTYPE
          GOTO      EXPRDS99 IF NOT EQUAL
.
          MOVE      OPDDLINE,F3
          COMPARE   F3,FORM3B
          GOTO      EXPRDS99 IF LESS
.
EXPRDS40  ADD       ONE,COUNT
          STRIP     OPDDDATA
          MOVELPTR  OPDDDATA,LENGTH
          SFORMAT   VARIABLE,LENGTH
          MOVE      OPDDDATA,VARIABLE
.
. ------- Format the variable -------
.
EXPRDS50  IF        COUNT > 1
            ADD       ONE,CURRROW
            ADD       ONE,IBDTROW
          ENDIF
          RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
.
          GOTO      EXPRDS30
.
          INC       OPRDEAIO/INC
          INC       OPRDEDIO/INC
          INC       IBAOVRIO/INC
.
EXPRDS99  CLOSE     OPRDEDA1
          CLOSE     OPRDETA2
          ENDPROC
+

.---------------------------------------------------------------------------
. Program       : OUTWEB05
.
. Function      : Outpatient Maintenance
.
. Modifications :
.---------------------------------------------------------------------------
. V12.00.02 29/09/2025  Bella Turco     TSK 0966242
.           New tags OMAX0150/OMAX0160 to turn Labels & Letters and Slot
.           Template buttons red if any data exists
. V12.00.01 23/05/2025  Ebon Clements   TSK 0955096
.           Alphanueric visit number changes
. V11.05.02 20.12.2024 DA Sarkies      TSK 0954547
.           Commented out <cat> tags to prevent browser incompatibility
. V11.05.01 26/11/2024  Ebon Clements  TSK 0954547
.           Added <cat-c> start and end tag to category=XX tag
. V11.04.03 29/04/2024  PJ Le Febour   TSK 0906342c
.           recompiled following migration OUTHEDTM OUTHEDFD
. V11.04.02 22/01/2024  PJ Le Febour   TSK 0906342a
.           Added OTMAS094 variable for OTMAPCOD(Default Procedure) 
.                 OMAX0000 added OMAX0130 and OMAX0140              
.           Added OMAX0130 Clinic type procedure code & description 
.           Added OMAX0140 Clinic slot type procedure code & description 
. V11.04.01 18/12/2023  Thanh T        TSK 0906342
.           Added Clear OTMAPCOD field
. V11.03.02 18/08/2023  Alina Bhari    TSK 0935184
.           set clinic session value to copy to clinic clinic  while copying
.           clinics from clinic master into another clinic - OUTMAS50  
. V11.03.01 06/12/2022  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.05 16/08/2022  Bella Turco    TSK 0906597
.           Added OMAX0110 - Tier 2 Code selection list
. V11.02.04 05/04/2022  Ebon Clements  TSK 0918517
.           Fixed delete OP session year test - DELSES00
. V11.02.03 29.03.2022 DA Sarkies      TSK 0905641
.           Added cgi variables for additional HCPs
. V11.02.02 09/02/2022 Thanh T         TSK 0905641
.           Added Additional HCP Code (1-4) for outma1af 
. V11.02.01 07/02/2022  Thanh T       TSK 0896905
.           Recompiled for ALLDEPFD changes
. V11.01.05 08/12/2021  Alina Bhari  TSK 0896097
.           Filtered Active , Inactive result (FILTACTV,OMASTAT) - OMTAB000
.           Added addition subroutine for Outpatient clinic schedule - 0MAX0000
. V11.01.04 04/10/2021  Ebon Clements  TSK 0892844
.           Added apache keep alive to delete OP sessions - DELSES00
. V11.01.03 06/08/2021  DA Sarkies     TSK 0908977
.           Fixed some cross browser issues for in table produced in template
.           patweb0513001
. V11.01.02 19/05/2021  Ebon Clements  TSK 0906170
.           Update the clinic and slot template last session open date when
.           deleting sessions - ULODAT00
. V11.01.01 15/02/2021  Ebon Clements  TSK 0876663
.           Clear last session open date when copying slot templates -  COPT0000
. V11.00.09 11/02/2021  Ebon Clements  TSK 0876663
.           Clear last session open date when copying clinic master - OUTMAS50
. V11.00.08 23/11/2020  Ebon Clements  TSK 0876663
.           Recompiled for IBAWEBCD - New common system parameters
.           Added auto open clinic functionality 
. V11.00.07 17/11/2020  J.Tan          TSK 0896724
.           Added OTCNLCST - parameter to display Ledger/Cost centre
. V11.00.06 29/06/2020  Ebon Clements  TSK 0893340
.           Added ListIcon class to MaintenanceIcon outputs
. V11.00.05 30/04/2020  Ebon Clements  TSK 0876663
.           Added auto open fields to OUTMA1FD and OUTHEDFD
. V11.00.04 20/03/2020  Peter Vela     TSK 0889143
.           Fixed OUTLET IO calls
. V11.00.03 18/03/2020  Peter Vela     TSK 0889143
.           Recompiled for OUTLETFD
. V11.00.02 10/03/2020  Tracey Nguyen      TSK 0823386
.           Updated error message as per updated spec in OUTSES95 
. V11.00.01 04/03/2020  Tracey Nguyen      TSK 0823386
.           Checked if OTSTACTV is active before opening sessions - OUTSES00
.------------------------------------------------------------------------------
. V10.15.03 13/11/2019  Ebon Clements      TSK 0308709
.           Clear outmab file vars after slot list - OBTAB000
. V10.15.02 21/10/2019  Ebon Clements      TSK 0308709
.           Added default visit type functionality to slot template maintenance
. V10.15.01 16/10/2019  Ebon Clements      TSK 0308709
.           Added default visit type to clinic type file - OCTDEFCV
.           Added report 13 - Clinic type linked visit type maintenance   
. V10.14.01 08/03/2019  Peter Vela         TSK 0870906
.           Added Inpatient Referral validation in ARFD0000 ARFT0000
. V10.12.01 09/02/2018  Ania P             TSK 0847252
.           Added OCTY1700-OCTY2000
. V10.11.02 14/11/2017  Don Nguyen         TSK 0816814
.           Added code to manage SNOMED Coding System Mappings (DELCSM00).
.           Recompiled for OUTCDCTM, OUTCPBTM, OUTCPCTM.
.           10/11/2017  Davin              TSK 0846915
.           Added HERO Clinic ID and Campus ID (fields OTMAHCLI & OTMAHCAI)
. V10.11.01 19/07/2017  Ebon Clements      TSK 0286970
.           Removed duplicate record test on index 2 when adding clinics.
.           OUTCLI10 
. V10.08.03 25/10/2016  Ebon Clements      TSK 0827827
.           Fixed leave exists test for delete clinic - CHKLVE00
. V10.08.02 21/07/2016  Peter Vela         TSK 0818477
.           Commented out mandatory validation for OTMAS006 in CHKMAS00
. V10.08.01 01/06/2016  Ebon Clements      CAR 0322766
.           Fixed copy to duplicate error for procedure, diagnosis and problems
. V10.07.08 17/12/2015  Ebon Clements      CAR 294154
.           Added SMS notification functionality
. V10.07.07 27/11/2015  Ebon Clements  CAR 324925
.           Fixed clinic leave site code populaton - CLVSAV00
. V10.07.06 13/11/2015  Don Nguyen     CAR 323028
.           Added MAXRECRD - Max num records allowed for Proc, Diag & Probs.
.           Also modified corresponding error messages to use this value.
. V10.07.05 28/10/2015  Ebon Clements  CAR 268970
.           Changed CLMA0000 to use OUTCLIFD index 6
. V10.07.04 27/10/2015  Ebon Clements  CAR 268970
.           Updated clinic leave maintenance for OUTCLVFD index change 
. V10.07.03 26/10/2015  Ebon Clements  CAR 268970
.           Updated template map maintenance for OUTWMPFD index change 
. V10.07.02 23/10/2015  Ebon Clements  CAR 320819
.           Added Inactive test to letter selection lists
. V10.07.01 14/10/2015  Ebon Clements  CAR 316629
.           Added hospital to holiday file key  - OUTPHOFD
. V10.06.06 03/09/2015  Peter Vela     CAR 316627
.           Added Clinic Type Description to LSTS0000
. V10.06.05 19/08/2015  Peter Vela     CAR 316627
.           Added submit and tag for MANDTYID
.           Added mandatory fields validation in LSTS0000
. V10.06.04 05/08/2015  Ebon Clements  CAR 315905
.           Fixed max of 100 diagnosis edit - OUTCDC12                      
. V10.06.02 14/05/2015  Ebon Clements  CAR 303890
.           Added reports 11 and 12. Procedure and problem maintenance
. V10.06.01 19/03/2015  Ebon Clements  CAR 268970
.           Change to use OUTCLIFD index 1 instead of index 2
. V10.05.03 12/12/2014  Ebon Clements  CAR 307538
.           Do not count unavailable slots in slot totals - SLOTOT00
. V10.05.02 22/09/2014  Ebon Clements  CAR 304958
.           Recompiled for OUTCDCTM - display all diagnosis records on search
. V10.05.01 16.07.2014  Ebon Clements  CAR 251384
. V10.06.03 12/06/2015  Ebon Clements  CAR 317878
.           Restored duplicate record test on index 2 when adding clinics.
.           OUTCLI10 - This will be removed as part of CAR 268970
. V10.06.02 14/05/2015  Ebon Clements  CAR 303890
.           Added reports 11 and 12. Procedure and problem maintenance
. V10.06.01 19/03/2015  Ebon Clements  CAR 268970
.           Change to use OUTCLIFD index 1 instead of index 2
. V10.05.03 12/12/2014  Ebon Clements  CAR 307538
.           Do not count unavailable slots in slot totals - SLOTOT00
. V10.05.02 22/09/2014  Ebon Clements  CAR 304958
.           Recompiled for OUTCDCTM - display all diagnosis records on search
. V10.05.01 16.07.2014  Ebon Clements  CAR 251384
.           Added tier 2 code functionality
. V10.04.08 12.05.2014  Ania P         CAR 208234
.           Replace spaces with zeros for OTCCCDAT
. V10.04.07 06.05.2014  Ania P         CAR 208234
.           Added sections for new contract code tables
. V10.04.06 01/05/2014  Ebon Clements  CAR 295378
.           Check multi hospital before mandatory hospital test - CHKMAS88
. V10.04.05 10/04/2014  Ebon Clements  CAR 298805
.           Added next and prev functionality to diagnosis list
. V10.04.04 09/04/2014  Ebon Clements  CAR 298805
.           Increased clinic type diagnosis max to 100 - OUTCDC00
. V10.04.03 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.02 26/03/2014  Ebon Clements  CAR 296560
.           Added hidden commment display of open month and time to
.           keep apache alive when opening sessions - OPNSES00
.           18/03/2014  Ania P         CAR 208234
.           Added OCTY1700
. V10.04.01 06/02/2014  Ebon Clements  CAR 291879
.           Recompiled for OUTHEDFD
.---------------------------------------------------------------------------
. V10.03.13 14/10/2013  Ania P         CAR 278232
.           Refactored code - now using COUNTSLT for session recalculation
. V10.03.12 30/08/2013  Peter Vela        CAR 290701
.           Fixed selection list validation in SETLET00
. V10.03.11 29/08/2013  Peter Vela        CAR 290701
.           Added separate hospital tag for OTMAHOSP
. V10.03.10 14/08/2013  Ebon Clements     CAR 290061
.           Fixed exit branches after WEBERR00 calls
. V10.03.09 06/08/2013  Ebon Clements     CAR 289451
.           Added max of 149 test to MULTSLOT[] array in - ARRA0000
.           Changed MULTCONT and MULTLOOP to FORM 3 from FORM 2
.           Increased MULTSLOT[] to 150 from 100
. V10.03.08 30/06/2013  Davin             CAR 283202
.           Recompiled for changes to hl7 messaging
. V10.03.07 26/02/2013  Ebon Clements  CAR 277428
.           Removed call to DGCLIOCM when opening sessions SESBOK00
. V10.03.06 18/02/2013  Ebon Clements  CAR 277862
.           Added mandatory referral functionality
. V10.03.05 04/01/2013  Jill Parkinson CAR 278849
.           Added clear of OSESCSTT in SESSAV00
. V10.03.04 16/11/2012  Ebon Clements  CAR 256111
.           Added extended slot functionality to update multiple slot - MULU0000
. V10.03.03 06/08/2012  Ebon Clements  CAR 270604
.           Fixed user id OP site test for suspended session list - 
.           UPDS0000 & LSTS0000
. V10.03.02 06/03/2012  Peter McMullen CAR 259587
.           Remove all references to file patyear1
. V10.03.01 11/01/2012  Davin          CAR 252936
.           Added HL7 triggers for clinic master/type maintenance
.           (M01 messages - DGCLIOCM & DGCLIOCT)
. V10.02.11 21/10/2011  Ebon Clements  CAR 253590
.           Added OTMANMDS,OTMACART and OTMASRVD to CLRMAS00
. V10.02.10 11/08/2011  Ebon Clements  CAR 244957
.           Changed clinic type selection list to be by description - CSEL0000
. V10.02.09 15/07/2011  Peter McMullen CAR 246597
.           Added xclude pull list fields for OUTHED and OUTMA1                
. V10.02.08 04/07/2011  Ebon Clements  CAR 240724
.           Mods for MRT hospital/location - Added hospital to location key
. V10.02.07 27/06/2011  Ebon Clements  CAR 242246
.           Added OTMAS075 to OTMAS080 cgi vars
. V10.02.06 24/06/2011  Ebon Clements  CAR 242246
.           Recompiled for clinic and header file changes
. V10.02.05 16/06/2011  Ebon Clements  CAR 239534
.           Added using check in page functionality
. V10.02.04 14/06/2011  Ebon Clements  CAR 244625
.           Added duplicate clinic test on index 2 of OUTCLIAF - OUTCLI10
. V10.02.03 06/06/2011  Ebon Clements  CAR 239554
.           Recompiled for OUTHEDFD - Number of days prior to send letter
. V10.02.02 03/06/2011  Ebon Clements  CAR 239525
.           Added confirm demographics functionality
. V10.02.01 19/05/2011  Ebon Clements  CAR 239554
.           Recompiled for OUTHEDFD - Number of days prior to send letter
. V10.00.02 07/05/2010  Ebon Clements  CAR 221322
.           Fixed clinic master list loop - OMTAB000 
. V10.00.01 31/03/2010  Ebon Clements  CAR 219087
.           Reset values of MULTCONT and MULTLOOP in CLRPAR00 not INIT0000
. V9.12.04  17/12/2009  Peter McMullen CAR 210130
.           Concert to newer Dr name format routine DOCNM000
. V9.12.03  21/10/2009  Ebon Clements  CAR 208353
.           Changed STDUR00 to allow slots to 3 hours long
. V9.12.02  07/08/2009  Saroeun Soeur  CAR 197314
.           MSTAB000 - added MSTAB900 to check if there is any closed template
.           slots
. V9.12.01  10/07/2009  Saroeun Soeur  CAR 150767
.           created subroutine MULU0000,MULD0000,VLSF0000,ARRA0000,GKIN0000
.           for multiple slots
. V9.11.04  26/02/2009  Peter McMullen CAR 173243
.           Correct end time for clinic sesions
. V9.11.03  23/02/2009  Ebon Clements  CAR 184752
.           Added status filter to clinic master and clinic type lists
. V9.11.02  06/11/2008  Peter Vela     CAR 181690
.           Added OSESGHCP on write to outsesaf
. V9.11.01  06/11/2008  Peter McMullen CAR 174725
.           convert internal javascript to W3C standards
. V9.10.02  08/08/2008  Peter Vela    CAR 173226
.           Added clinic type validation to CITAB000
. V9.10.01  04/08/2008  Ebon Clements CAR 173860
.           Fixed clear of letter fields in CLRMAS00
. V9.09.10  21/04/2008  Ebon Clements CAR 153338
.           Fixed open session slot status when using extended reviews -SESBOK00
. V9.09.06  28/03/2008  Ebon Clements CAR 164827
.           Fixed slot time problem when using slots over one hour long STDUR000
. V9.09.05  29/02/2008  Ebon Clements CAR 155211
.           Fixed CLMA0000 suspend clinics for the same doctor
. V9.09.04  25/02/2008  Ebon Clements CAR 161753
.           Don't clear OMADATE when updating the clinic master
. V9.09.03  24/08/2007  Ebon Clements CAR 133923
.           Changed department selection lists to be in alphabetical order
. V9.09.02  23/08/2007  Peter Vela     CAR 145689
.           Modified maximum amount of Clinic Type diagnosis
. V9.09.01  21/06/2007  Ebon Clements  CAR 141877
.           Changed norecord to 99 in CVTAB000 as next and prev are not used
. V9.08.04  23/02/2007  Jill Habasque  CAR 119811
.           Changed UPDS0000 to loop backwards so records output newest date 1st
. V9.08.03  08/01/2007  Janet George   CAR 129912
.           3 Digits can be entered at Slot Time.So error message commented
. V9.08.02  27/10/2006  Ebon Clements  CAR 121804
.           Recompiled for OUTCTYFD - Added user defined field 1 
. V9.08.01  06/10/2006  Ebon Clements  CAR 121109
.           Recompiled for OUTMA1FD - Added spare variable to IO
. V9.07.02  18/08/2006  Ebon Clements  CAR 110245
.           Added collect transport details to clinic maintenance
. V9.07.01  15/08/2006  Ebon Clements  CAR 112175
.           Allow multi hospital A/H department with a blank hospital
. V9.06.03  31/05/2006  Sandeep
.           Opened MRTLOCA3 and used read routines to sort based on Description
. V9.06.02  17/05/2006  Ebon Clements CAR 104150
.           Added multi hospital test to mr location and A/H Dept drowdowns
. V9.06.01  17/05/2006  Ebon Clements CAR 105541
.           Added multi hospital test to VTYSEL00
. V9.05.02  22/03/2006  Ebon Clements CAR 79277
.           Added collect carer details to clinic maintenance
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B03 01/02/2006  Ebon Clements CAR 91752
.           Recompiled for OUTHEDTM - Entering doctor on attendance
. V9.05.B02 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.05.B01 12/01/2006  Ebon Clements CAR 76341
.           Added collection encounter datails to clinic maintenance
. V9.04.12  28/10/2005  Ebon Clements CAR 79637
.           Added USTA0000 session status update to report 5
. V9.04.11  21/10/2005  Ebon Clements CAR 81070
.           Recompiled for CLOUTHED
. V9.04.10  14/10/2005  Ebon Clements CAR 59229
.           Changed RCAL0000,ADDTIM00 and SUBTIM00 to use slot 
.           duration OTHEDURN not OMADURN
. V9.04.09  22/06/2005 Ebon Clements CAR 64184
.           Fixed key match in EXTSLT20 should be KEY31 not KEY21
. V9.04.08  16/06/2005 Ebon Clements CAR 58654
.           Added allow group bookings to clinic template headers
. V9.04.07  08/06/2005 Peter Vela    CAR 58732
.           Added functionality for OTMALDNA (OTMAS067) - Non Attendance Letter
. V9.04.06  25/05/2005 Ebon Clements CAR 62018
.           Added Apply CMBS template to booking                  
. V9.04.05  23/05/2005 Ebon Clements CAR 61339
.           Added active inactive option to clinic type selection list CLITYP00
. V9.04.04  05/05/2005 Ebon Clements CAR 61122
.           Added site code check for clinic search in CITAB000
. V9.04.03  09/03/2004 Peter Vela    CAR 57627
.           Fixed assignment of zero to otmas026 to otmas031, otmas049, otmas050
. V9.04.02  04.02/2005  Ebon Clements CAR 56680
.           Added unavailable slot comments 
.           31/01/2005  J.Tan        CAR 56702
.           Added new fields to outmas
. V9.04.01  27/01/2005  Davin        CAR 56663
.           Added otmas059/otmaumci - Using Medclaims
. V9.03.17  29/07/2004 Ebon Clements CAR 19975     
.           Added waiting list unit to clinic type maintenance
. V9.03.16  29/06/2004 Ebon Clements CAR 51216     
.           Disable delete session checkbox if the session is not from
.           the same schedule number and date 
. V9.03.15  04/06/2004 Ebon Clements CAR 50448
.           Changes CHKSUS00 to use cgi variables for key not session file.
. V9.03.14  13/04/2004 Ebon Clements  CAR 48981
.           Added clinic type to open session list for clinic templates
.           Added edit check for template header closed date updates
. V9.03.13  26/03/2004 Peter Vela     CAR 13038
.           Recompiled for PATDOCCD - Doctor Name format Parameter
. V9.03.12  19/01/2004  Davin         CAR 46040
.           Added extra info ('Cannot proceed with this function.') to 
.           copy error message.
. V9.03.11  12/11/2003  Davin         CAR 19983
.           Added report option 9 (Clinic Type Diagnosis Maintenance)
. V9.03.10  10/10/2003 Ebon Clements  CAR 44206
.           Created new opened by schedule list OPNL0000
. V9.03.09  09/10/2003 Ebon Clements  CAR 43741 & 44206
.           Added edit checks to template/clinic master open date ranges.
. V9.03.08  30/09/2003 Ebon Clements  CAR 43674
.           Close files before opening in OPNOUT00
. V9.03.07  24/09/2003  Ebon Clements  CAR 41801
.           Added series booking letter to the clinic maintenance screen.
. V9.03.06  24/09/2003  Ebon Clements  CAR 43607
.           Fixed open date range for the clinic master slots
. V9.03.05  19/09/2003  Ebon Clements  CAR 22361
.           Mods for extend outpatient clinics with schedule number and date.
. V9.03.04  05/08/2003  Ebon Clements  CAR 41801
.           Added OSESCTYP to SESSAV00 to populate the clinic type from the  
.           clinic master.
.           Changed BOKCHK00 to ignore unavailable slots when allowing deletion
.           of sessions.
. V9.03.03  09/07/2003  Ebon Clements  CAR 40633
.           Made changes to the clinic slot template to handle over bookings.
. V9.03.02  15.05.2003  Sylvek Litewka CAR 39071
.           Modified procedures CLSES000 and SUSPEN00 to populate new 
.           "outmspaf" fields OTMSRFDT and OTMSRTDT (Suspension Range Dates).
.           Also modified procedures LSTS0000 and UPST0000 to use the new 
.           fields for displaying Suspension From and To Dates.
. V9.03.01  12.05.2003  Sylvek Litewka CAR 38038
.           Added procedure LSTOPN00 to return the Date of the Last Open
.           Session for given Clinic Master Schedule. 
.---------------------------------------------------------------------------
. V9.02.46  02.04.2003  Sylvek Litewka CAR 36816
.           Modified procedure USUS0000 to call RCAL0000 to recalculate slot
.           counts when unsuspending a session.
. V9.02.45  26.03.2003  Sylvek Litewka CAR 37499
.           Modified OUTCLI30 and added new procedure CHKCNT00.
. V9.02.44  17.03.2003  Sylvek Litewka SRF 22931
.           Modified procedures CLSES000 and SUSPEN00 to insert one row into
.           "outmspaf" file for each suspended session with suspension 'From'
.           and 'To' dates being equal to session date. Created a new procedure
.           VALSUS00 (Validate Suspension) to ensure that only one row is 
.           inserted into "outmspaf" per each suspended session.
. V9.02.43  26.02.2003  Sylvek Litewka CAR 35256
.           Modified process for generating slots to allow for visit types
.           with extended slots. Modified procedure AVSLOT00 and FXSLOT00 and 
.           added new procedures AVEXSL00, FXEXSL00 and CRSLOT00.
.           Modified OUTMAB10. Added new procedures VALADD00 and EXTADD00.
.           Modified OUTMAB20. Added new procedure VALUPD00.
. V9.02.42  05.02.2003  Lina Vo        SRF 22709
.           Open outpatient audit file with site prefix.                
. V9.02.41  24.01.2003  Dean Cramer    SRF 22993
.           Write to OPen Sessions File                                 
. V9.02.40  22.01.2003  Ebon Clements  SRF 35433
.           Added clear of OSESCOMM in SESSAV00 for session open.       
. V9.02.39  12.12.2002  Sylvek Litewka SRF 33677
.           Fixed processing for Clinic Status field OMASTAT (OTMAS014)
.           in procedure MASSAV00. 
. V9.02.38  30.11.2002  Lina Vo        SRF 22709
.           Changed program to open outpatient files with site prefix.
. V9.02.37  04.11.2002  Sylvek Litewka SRF 22712
.           Added processing for Outpatients Extra Templates file.
. V9.02.36  11.10.2002  Ebon Clements  SRF 22664
.           Changed AVSLOT00 to use parameter HORVCODE as the default visit type
. V9.02.35  23.08.2002  Ebon Clements  SRF 17673
.           Mods to allow for the new slot visit type - Unavailable
. V9.02.34  05.07.2002  Ebon Clements  SRF 20191
.           Added TRAP to WRSESA1 in OPNSES00 to stop I * D
. V9.02.33  01.07.2002  Ebon Clements  SRF 18689
.           Added outpatient site tag to OCTY0000
. V9.02.32  05.06.2002  Ebon Clements 18438
.           Fixed incorrect key in CLSES000 for suspending session on leave
.           dates
. V9.02.31  21.05.2002  Ebon Clements 17504
.           Added new class suspendcell to sesrow00 so suspeneded sessions
.           can not be opened
. V9.02.30  20.05.2002  Ebon Clements 17795
.           Added new option for unsuspend sessions and new report to 
.           display suspended sessions.
.           Changed suspend sessions to change all appointments to
.           suspended and not remove the session master
. V9.02.29  08.02.2002  J.Tan
.           Display warning for changing on clinic indicator
. V9.02.28  21.02.2002  Ebon Clements
.           Added function FXSLOT00 to delete any slot template
.           records that exceed to booking end time
. V9.02.27  19.02.2002  Ebon Clements
.           Added code to ignore extended slots in BOKCHK00
. V9.02.26  08.02.2002  Ebon Clements
.           Fixed next and prev routines for clinic master
. V9.02.25  13.12.2001  Ashwin
.           Open the Clinic file for 3rd index
. V9.02.24  07.12.2001  B.G.Ackland
.           Fix Update of Active Status
. V9.02.23  05.12.2001  B.G.Ackland
.           Fix Clinic Leave
. V9.02.22  02.12.2001  B.G.Ackland
.           Copy Clinic Master Don't Update Clinic Session
. V9.02.21  30.11.2001  B.G.Ackland
.           Try to fix Time Out Issue for Opening Sessions
. V9.02.20  27.11.2001  B.G.Ackland
.           Check for Change in Times for Update of Clinic Master
. V9.02.19  19.11.2001  B.G.Ackland
.           Remove pi from IO
. V9.02.18  18.11.2001  B.G.Ackland
.           Fix Copy
. V9.02.17  14.11.2001  B.G.Ackland
.           Fix Clinic Search Page
. V9.02.16  13.11.2001  B.G.Ackland
.           Validate Slot Times in Clinic Master Template
.           Fix Leave to Suspend or Delete Sessions
.           Slot Creation Problem
.           Read prior to Slot Delete
. V9.02.15  13.11.2001  B.G.Ackland
.           Fix Odd/Even Row Class Output for Rows
. V9.02.14  12.11.2001  B.G.Ackland
.           Stop Duplicate Clinic in Add
. V9.02.13  02.11.2001  BGA
.           Fixed Suspension
. V9.02.12  01.11.2001  BGA
.           Fixed Suspension
. V9.02.11  27/10/2001  BGA
.           Fixed Suspension
. V9.02.10  26/10/2001  BGA
.           Fixed O/P problems
. V9.02.09  23.10.2001 Ashwin - HPS
.           Add slots if booking time is changed during update
. V9.02.08  19.10.2001 Ashwin - HPS
.           Fixed AVSLOT00 to create slot till booking end time
. V9.02.07  05.10.2001 Sai - HPS
.           Changed OPNOUT00 to always open outphoaf 
. V9.02.06  21.08.2001 Ashwin - HPS
.           Fixed to default Clinic Session after copy Removed
.           the check for Slot visit type controlled check in
.           Open Sessions funtionality
. V9.02.05  17.08.2001 Ashwin,Sai - HPS
.           Changed for Clinic Status to be shown,Added routine 
.           to delete sessions when clinic on leave,Fixed for 
.           clinic inactive to clinic active. 
. V9.02.04  12.09.2001 Ebon Clements 
.            Changed clinic maintenance screen to display HCP   
.            name not doctor name
.  V9.02.03  08.09.2001 Ashwin - HPS
.             Changed for Slot copying,MR Location,Open Sessions
.  V9.02.02  07.09.2001 B.G.Ackland
.            Slot Template updated for Extended Slots
.  V9.02.01  20.08.2001 HPS-ODC
.            Changes for Fixing IBA and OffShore Raised Defects
.  V9.00.B07 11.06.01 Bronko Sosic
.            Changed reads and writes       
.  V9.00.B06 28.06.01 HPS
.            Modified for VAC codes display
.  V9.00.B05 28.06.01 HPS
.            Modified for suspend date validation
.  V9.00.B04 27.06.01 HPS
.            Modified for correct time display
.  V9.00.B03 26.06.01 Modifed by HPS
.            for tag of Clinic Lookup Page 
.  V9.00.B01 15/06/2001 Ashwin - HPS
.            Changed the Existing Clinic Maintenance to Clinic
.            Leave Maintenance
.  V9.00.B00 24/05/2001 Ashwin,Jaideep
.            Add New Copy and Suspend Function,Modified Clinic
.            Leave Maintenance,Clinic Schedule 
.  V5.08.03 22/05/2000 Pat Dirito   
.           Resized Effective Date Column width         
.  V5.08.02 01/05/2000 Bronko Sosic
.           Removed Edit button becase of effective date
.  V5.08.00 07/04/2000 Bronko Sosic
.           Added option 7, Clinic template mapping
.----------------------------------------------------------------------
.  V5.07.06 25/03/2000 Bronko Sosic
.           Added startkey for GOTO button
.  V5.07.05 28/02/2000 Pat Dirito   
.           Added added Instances for ShowDetail
.           Added Active Column to Clinic Master List 
.           CSEL0000 Clinic Type selection list now 
.           matchs on site code.
.  V5.07.04 19/01/2000 Katie Nelson 
.           Added open for years file in INIT0000
.  V5.07.03 12/01/2000 Bronko Sosic
.           Added REP " 0" after CYY 
.  V5.07.02 20/12/1999 Katie Nelson 
.           Recompiled for IBAWEBDF/IBAWEBCD
.  V5.07.01 03/11/1999 Katie Nelson 
.           Recompiled for WEBDATCD/DAYOFWEK
.  V5.07.00 28/07/1999 Pat Dirito
.           Created Program 
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
.
          INC       ALLDEPFD/INC   * Allied Health Department
          INC       IBAPOLFD/INC
          INC       OUTBOAFD/INC   * Outpatients - Clinic Session Booking File A
          INC       OUTCLIFD/INC   * Outpatients - Clinic Table
          INC       OUTCTYFD/INC   * Outpatients - Clinic Type Table  
          INC       OUTCDCFD/INC   * Outpatients - Clinic Type Diagnosis Table
          INC       OUTCDCTD/INC   * Outpatients - Clinic Type Diagnosis TD
          INC       OUTCLVFD/INC   * Outpatients - Clinic Leave Table
          INC       OUTCONFD/INC   * Outpatients - Control File
          INC       OUTMA1FD/INC   * Outpatients - Clinic Master Table  
          INC       OUTMABFD/INC   * Outpatients - Clinic Master Slots Table
          INC       OUTOSFFD/INC   * Outpatients - Open Session File
          INC       OUTPHOFD/INC   * Outpatients - Public Holiday File
          INC       OUTSESFD/INC   * Outpatients - Clinic Sessions Table 
          INC       OUTSITFD/INC   * Outpatients - Site Code File
          INC       OUTWMPFD/INC   * Outpatients - Clinic Template Mapping
          INC       OUTCCTFD/INC   * Outpatients - Contract Codes
          INC       OUTCVTFD/INC   * Outpatients - Clinic Type Visit Types
          INC       PATCONFD/INC   * Patient control file
          INC       OUTCPBTD/INC   * Clinic type problems
          INC       OUTCPBFD/INC   * Clinic type problems
          INC       OUTCPCTD/INC   * Clinic type procedures
          INC       OUTCPCFD/INC   * Clinic type procedures
          INC       PATICDFD/INC   * ICD Disease codes file
          INC       PATICOFD/INC   * ICD Procedure codes file
          INC       PATDO1FD/INC   * Doctor File 
          INC       OUTLETFD/INC   * Outpatient Letter File
          INC       SCRMASFD/INC   * Screen Sys - Screen Master 
          INC       PATHSPFD/INC   * Hospital File
          INC       PRITHDFD/INC   * MBS Item template File
          INC       PRIPRAFD/INC   * Medical Practice File
          INC       PATWR1FD/INC   * Patient Ward File
          INC       OUTMSPFD/INC   * Client Master Suspension Table(HPS01I)
          INC       MLTSECFD/INC   
          INC       MRTLOCFD/INC   * Medical Records Location (HPS01I)
          INC       PMSHCPFD/INC   * HCP Doctors file
          INC       OUTTXSFD/INC   * Outpatient Extra Templates File FD
          INC       OUTTXSTD/INC   * Outpatient Extra Templates File TD
          INC       OUTHEDFD/INC   * Outpatient slot template Header file
          INC       OUTHEDTD/INC
          INC       OUTBOXFD/INC   * Unavailable slot comments
.
          INC       FMSLMAFD/INC   * G/L
          INC       FMSAMAFD/INC
.
          INC       PMSVMTFD/INC
          INC       PMSVMTTD/INC
          INC       PMSVSTFD/INC
          INC       PMSVSTTD/INC
.
CHKGRPIN  FORM      1
CHECKSIT  DIM       6
CONTCODE  DIM       3        * Contract Code (NZ Grouping only)
UPDTSLOT  FORM      1
SLOTNUMB  FORM      3
SHOWCLOS  FORM      1        * Show closed or open flag
SVCVCLIN  DIM       6 
SVCVFDTE  DIM       8 
SVCVTDTE  DIM       8 
SVCVREAS  DIM       3 
SVCVLAST  DIM       8 
SVCVSITE  DIM       6
SAVECLIN  DIM       6
SAVESITE  DIM       6
SAVDOCT   DIM       6
SUSPCNTR  FORM      2        * Total number of unsuspend session keys
SUSCOUNT  FORM      2        * Current suspension record count
SUSPEND   FORM      1        * Suspended session flag
SHOWSESS  FORM      1        * Flag for a suspension record with no sessions
SHOWINAC  FORM      1        * Show inactive clinic types 1=YES 0=NO
COUNT     FORM      3
.
SAVINDC   DIM       3
SAVKEY24  DIM       24
SAVKEY28  DIM       28
SAVKEY36  DIM       36
DIM8      DIM       8
DISPDATE  DIM       11
DISPDAT1  DIM       11
DISPDAT2  DIM       11
LASTOPEN  DIM       8
LINKVTYP  FORM      1
DISPDAT3  DIM       11
SESSKEYS  DIM       25
SAVSKEYS  DIM       25       * Save Session Keys (used by RCAL0000)
SAVKEY31  DIM       31
SAVETCOD  DIM       3        * Save Tier 2 Code (category NC)
SAVETCED  DIM       8        * Save Tier 2 Code Effective Date (CCYYMMDD)
OLDVTYP   DIM       3
NEWVTYP   DIM       3
NEWSLOTS  FORM      3
NUMSLOTS  FORM      1
OLDSLOTS  FORM      3
CNTSLOTS  FORM      3
VALSLOTS  FORM      3
SLPARENT  FORM      3
SRCHCLTY  DIM       6
SRCHCLID  DIM       6
SRCHLTYP  DIM       3
SRCHDOWK  DIM       1
SRCHSTIM  DIM       8
TMCLV001  FORM      8
TMCLV002  FORM      8
TMCLV003  FORM      8
.----------------------------------------------------------------------
. CGI Parameters
.----------------------------------------------------------------------
NEXTPAGE  DIM       1
UPDTTYPE  DIM       1     * Update Type
SHOWYEAR  DIM       4     * Year of Dates to Show (Leave/Sessions etc) 
STARTKEY  DIM       10    * Starting Key
.
OTCTY001  DIM       6     * Clinic Type
OTCTY002  DIM       30    * Clinic Type Description
OTCTY003  DIM       3     * Group Code (CG)
OTCTY004  DIM       3     * Attendance Template 
OTCTY005  DIM       3     * Booking Template           
OTCTY006  DIM       1     * Inactive Indicator     
OTCTY007  DIM       3     * Group Code (CQ)
OTCTY008  DIM       3     * Waiting List Unit (WU)
OTCTY009  DIM       1     * User defined field 1   
OTCTY010  DIM       1     * User defined field 2   
OTCTY011  DIM       3     * Default Visit Type (Category CV)
.
OTCLI001  DIM       6     * Clinic ID
OTCLI002  DIM       8     * Doctor Code 
OTCLI003  DIM       30    * Clinic Description
OTCLI004  DIM       6     * Consultant Code (CMDS)
OTCLI005  DIM       1     * Inactive Indicator
OTCLI006  DIM       8     * Effective Date    
.
OTCLV001  DIM       11    * Clinic Leave From Date eg. (03 Jun 1999) format  
OTCLV002  DIM       11    * Clinic Leave To Date eg. (03 Jun 1999) format  
OTCLV003  DIM       3     * Reason for leave (Cat DH) 
.
OTCVT001  DIM       6     * Clinic Type
OTCVT002  DIM       1     * Linked Visit Type
.
OTMAS001  DIM       1     * Day Indicator 1-7 1=Monday
OTMAS002  DIM       5     * Start Time 
OTMAS003  DIM       5     * Finish Booking Time
OTMAS004  DIM       5     * End Session Time
OTMAS005  DIM       6     * Clinic Type
OTMAS006  DIM       3     * Clinic Indicator
OTMAS007  DIM       1     * Registrar's Clinic
OTMAS008  DIM       1     * Accept Doctor Code (Keyin Doctor Y/N)
OTMAS009  DIM       40    * Comments Line 1
OTMAS010  DIM       40    * Comments Line 2  
OTMAS011  DIM       3     * Slot Duration (Mins)
OTMAS012  DIM       1     * Number of Slots For a new Patient(Visit)
OTMAS013  DIM       1     * Number of Slots For a special Patient(Visit) 
OTMAS014  DIM       1     * Active Status 0=Active 1=Non Active
OTMAS015  DIM       4     * Report Sequence
OTMAS016  DIM       1     * Allocate visit type when booking? Y=Yes else No
OTMAS017  DIM       1     * Slot times visit type controlled? Y=Yes else No
OTMAS018  DIM       1     * Suppress extended slots on displays? Y=Yes else No
OTMAS019  DIM       1     * Using RUS Automated Extract 0=No, 1=Yes
OTMAS020  DIM       1     * Display Comments at Booking Time 0=No, 1=Yes
OTMAS021  DIM       1     * Input Extra Screen when Attending? Y=Yes else No
OTMAS022  DIM       8     * Defualt Doctor Code
OTMAS023  DIM       1     * Using Attendence Register (Y/N)? 0=No, 1=Yes
OTMAS024  DIM       2     * Discharge patient after x no. of days
OTMAS025  DIM       2     * No. of days for reappointment
OTMAS026  DIM       3     * Letter to patient on reapointment
OTMAS027  DIM       3     * Letter to GP on Discharge
OTMAS028  DIM       3     * Letter to Patient on Dischrage
OTMAS029  DIM       3     * Standard Booking Letter
OTMAS030  DIM       3     * Standard reappointment Letter
OTMAS031  DIM       3     * Standard reschedule letter (Patient)
OTMAS032  DIM       6     * Clinic Session
OTMAS033  DIM       3     * Hospital Code
OTMAS034  DIM       30    * Clinic Location
OTMAS035  DIM       1     * Ward Clinic? Y=yes, N=no
OTMAS036  DIM       3     * Ward code if a Ward Clinic
OTMAS037  DIM       3     * Location Type (Category CT)
OTMAS038  DIM       1     * Default value for send letter
OTMAS039  DIM       1     * Generate case notes on attendance(Y/N)
OTMAS040  DIM       1     * Group Session (Y/N)? 0=No, 1=Yes
OTMAS041  DIM       1     * Security Level to Overbook
OTMAS042  DIM       2     * Number of Overbookings allowed
OTMAS043  DIM       1     * Security Level to Forcebook
OTMAS044  DIM       1     * Security Level to use Reserved Slots
OTMAS045  DIM       2     * Booking Label Screen ID
OTMAS046  DIM       2     * Appointment Label Screen ID
OTMAS047  DIM       2     * PMI Mailing Label Screen ID
OTMAS048  DIM       2     * G.P. Mailing Label Screen ID
OTMAS049  DIM       3     * Letter to Patient on Cancellation
OTMAS050  DIM       3     * Standard Reschedule Letter (Hospital)
OTMAS051  DIM       1     * Non-Consultant Clinic (Y/N)      
.******************************************************************
. HPS01 STARTS
.******************************************************************
OTMAS052  DIM       12    * Date Clinic Created   
OTMAS053  DIM       12    * Date Clinic Closed 
OTMAS054  DIM       40    * Instruction 1
OTMAS055  DIM       40    * Instruction 2
OTMAS056  DIM       40    * Instruction 3
OTMAS057  DIM       4     * MR Location      HPS ODC Code Starts
OTMAS058  DIM       3     * Series booking letter
OTMAS059  DIM       1     * Using Medclaims Interface
OTMAS060  DIM       10    * Provider number
OTMAS061  DIM       9     * Default CMBS item
OTMAS062  DIM       3     * Room type
OTMAS063  DIM       2     * Ledger number
OTMAS064  DIM       12    * Cost centre
OTMAS065  DIM       6     * Medical Practice
OTMAS066  DIM       1     * Auto default CMBS items template to booking
OTMAS067  DIM       3     * Non Attendance Letter
OTMAS068  DIM       3     * Allied Health Department
OTMAS069  DIM       1     * Collect Encouter Details
OTMAS070  DIM       1     * Collect Carer Details
OTMAS071  DIM       1     * Collect Transport Details
OTMAS072  DIM       3     * Number of days prior to send letter
OTMAS073  DIM       1     * Using Confirm PMI
OTMAS074  DIM       1     * Using Check in Page
OTMAS075  DIM       20    * Clinic Telephone Number
OTMAS076  DIM       3     * NMDS Code (Category NM)
OTMAS077  DIM       3     * Care Type (Category CC)
OTMAS078  DIM       3     * Service Delivery Mode (Category sd)
OTMAS079  DIM       1     * Clinical High Risk
OTMAS080  DIM       1     * Multidisciplinary Clinic
OTMAS081  DIM       1     * Exclude from pulling list (Y/N)      
OTMAS082  DIM       1     * Referral mandatory (Y/N)      
OTMAS083  DIM       3     * Tier 2 Code (category NC)
OTMAS084  DIM       20    * HERO Clinic Identifier
OTMAS085  DIM       20    * HERO Campus Identifier
OTMAS086  DIM       1     * Auto Open Clinic
OTMAS087  DIM       1     * Auto Open Frequency
OTMAS088  DIM       5     * Auto Open Week of Month
OTMAS089  DIM       3     * Auto Open Number of Weeks in Advance
OTMAS090  DIM       10    * Additional Health Care Provider 1    
OTMAS091  DIM       10    * Additional Health Care Provider 2   
OTMAS092  DIM       10    * Additional Health Care Provider 3   
OTMAS093  DIM       10    * Additional Health Care Provider 4   
OTMAS094  DIM        9    * Default Procedure                   
.
OVERRIDE  FORM      1     * Override slot template edits
TMPCLTYP  DIM       6                       
TMPFLG    FORM      1                       * HPS ODC Code Ends
TMPKEY31  DIM       31    * temp slot key
TMPSLTN   DIM       3     * temp slot number

.
. Copy Parameters
COPYTEMP  FORM      1     * Copy template header details flag
COPYTO01  DIM       6     * Copy to Clinic ID
COPYTO02  DIM       1     * Copy to Day of Week
COPYTO03  DIM       6     * Copy to Clinic Type
COPYTO04  DIM       8     * Copy to Clinic Type
.
. Suspend Parameters
SUSPEN01  DIM       8     * Suspend From Date (CCYYMMDD)
SUSPEN02  DIM       8     * Suspend To Date (CCYYMMDD)
SUSPEN03  DIM       3     * Suspend Reason
.
. File Variables for Suspend Client Master Table
SPMAS001  DIM       3     * Suspend Number   
SPMAS002  DIM       8     * Suspend From Date
SPMAS003  DIM       8     * Suspend To Date  
SPMAS004  DIM       3     * Suspend Reason Code
SPMAS005  DIM       8     * Suspend Entered Date
SPMAS006  DIM       8     * Suspend Entered Time
.********************************************************************
. HPS01 ENDS
.********************************************************************
OTMAB001  FORM      3     * Slot Number
OTMAB002  DIM       3     * Visit Type
OTMAB003  DIM       5     * Slot Time
.
OTWMP001  DIM       6     * Clinic ID
OTWMP002  DIM       8     * Map From Server
OTWMP003  DIM       2     * Map From Report
OTWMP004  DIM       3     * Map From Template
OTWMP005  DIM       3     * Map To Template
OTWMP006  DIM       30    * Description 
OTWMP007  DIM       6     * Site Code
.
MTHDTE    DIM       8[12][5]  * Session Dates    Months & Weekno contains Date 
SUSPKEYS  DIM       24[100]   * Array of suspension record keys for unsuspend
.
.**********************************************************************
.         multiple slot variables
.***********************************************************************
MULTSLOT  DIM       31[150]   * multiple slot array
MULTCONT  FORM      3         * multiple slot count
MULTLOOP  FORM      3         * multiple slot loop counter
DIM3      DIM       3
DIMA5     DIM       5
DIMB5     DIM       5
FORMA5    DIM       5
FORMB5    DIM       5
FORM10    FORM      10
.----------------------------------------------------------------------
. Program Variables
.----------------------------------------------------------------------
ACTIDESC  DIM       8   * Active or Inactive Description
CLINTYPE  DIM       6   * Clinic type
CLSTFLAG  FORM      1
COUNTER   FORM      3
NEWCTYPE  DIM       6   * New Clinic type (for copy)
CFILEPRE  DIM       3   * Current Open File Prefix for Outpatient Files
CLOSNUMB  FORM      1   * count number of closed slots
DATE1     FORM      8
DATE2     FORM      8
DATE3     FORM      8
DATE4     FORM      8
DOCTOR    DIM       30  * Formatted Doctor 
DOCTCODE  DIM       8   * Doctor Code
PBYEAR    DIM       4   * Year
PBYR      FORM      4   * Year
FILTACTV  DIM       1   * Active/Inactive status filter
FROMDATE  DIM       11  * From Date formatted for Table display
LVISTCNT  FORM      3         * Count of Array of visit types to link
LVISTARR  DIM       6[500]    * Array of visit types to link
TODATE    DIM       11  * To Date formatted for Table display
FROMDTE   FORM      8   * Date in Form Format 
TODTE     FORM      8   * Date in Form Format 
RECCOUNT  FORM      8   * Record Count
OTHRTEMP  FORM      1   * Session opened by another template flag 1=Yes
OTCMACTN  DIM       1   * HL7 add/upd/del flag
.
AVALTIME  DIM       5   * Slot Time in Format: (HH:MM)
CLINICID  DIM       6   * Clinic ID   
CLNCTYPE  DIM       6   * Clinic type
CHECKED   DIM       17  * Checked and diabled value 
COUNTS    FORM      2   * Counter in routine SESBOK00      
DAYDESC   DIM       10  * Day of Week Description  
DATE      DIM       8   * Date Displayed to HTML 
DATECGI   DIM       8   * Date cgi parameter
DAYNO     FORM      2   * Day Number
DELSES    FORM      1   * Delete Form Sessions Display indicator  
DISPCOL   FORM      2   * Last Column in Session Date Table
ENDSESST  FORM      4   * End Session Time Format: (HHMM)  
ENDHOUR   FORM      2   * End Session Hour
ENDMIN    FORM      2   * End Session Minutes   
FINSHTME  FORM      4   * Finish Booking Time
FIRSTDAY  FORM      1   * First day of the year eg Mon=1.....Sun=7
HOUR      FORM      2   * Hour Variable
HUND49    FORM      "149"
ID        DIM       11  * id=checked html output 
LABEL     DIM       2   * Screen Labels
LETTERNO  FORM      3   * Letter Number
LETTER    DIM       3   * Letter Number
LOOKDAY   FORM      1   * Day to be searched 
LNK2PRT   FORM      1   * Table Type : Update Parent
MANDTYID  DIM       1
MIN       DIM       2   * Minutes Variable
MINUTES   FORM      3   * Minutes Variable
MONTHTOT  FORM      2   * Total No of days in a month
MONTHNO   FORM      2   * Actual month no eg; Jan=1.....Dec=12 
MONTHROW  DIM       2   * Actual month no eg; Jan=01.....Dec=12 
MONDESC   DIM       10  * Month of Year Description  
SCHDLDAY  DIM       1   * Day Indicator 
STARTIME  FORM      4   * Session Start Time   
STATTIME  DIM       5   * Slot Time in Format: (HH:MM)
STRTHOUR  FORM      2   * Start HOUR
STRTMIN   FORM      2   * Start MIN
SESNDATF  DIM       8   * Session date from
SESNDATT  DIM       8   * Session date from
SLCOUNT   FORM      3   * Available Slot Number
REVSLOTS  FORM      3   * Available Slot Number
SPCSLOTS  FORM      3   * Available Slot Number
SLOTTIME  FORM      4   * Slot Time in Format: (HHMM)  
SLOTOPT   DIM       3   * Save the slot number for Special & New
TIME      FORM      3   * Allows for negative Symbol 
MINTIME   FORM      2   * Set minutes to a form after computation 
WEEKNO    FORM      2   * Actual week no. in each month
MONTH     DIM       2   * Month no
USAGDATE  DIM       8   * Date of Clinic
KSECONDS  INIT      ":00"                   * HPS-ODC Code Added
KEEPCNTR  FORM      2   * Keep alive counter
VISTFLAG  FORM      1
SERVPROG  DIM       8   * Stores Server Program name
NUMSLGEN  FORM      3   * Number of slots generated
NUMSLVIS  FORM      3   * Number of slots per visit type
NUMSLPRO  FORM      3   * Num of slots to process when creating extended slots
TOTSLCNT  FORM      3   * Total number of slots processed so far
VISSLCNT  FORM      3   * Number of slots processed so far for a single visit
SAVSLKEY  DIM       31  * Holds saved key for a particular slot
PARNTSLT  FORM      3   * Holds the slot number of the parent slot
STARTSLT  FORM      3   * Starting slot number for AVEXSL00
CURRSLOT  FORM      4   * Current slot number
NEXTSLOT  FORM      4   * Next slot number
NSLTSTRT  FORM      4   * New slot start time 
NSLTENDT  FORM      4   * New slot end time 
PREVTIME  FORM      4   * Previous slot end time 
NEXTTIME  FORM      4   * Next slot start time 
RESULT    FORM      2   * Used as temp storage of result from Modulus operation
OLDTIME   DIM       5   * Stores start time of the slot before change (HH:MM)
NEWTIME   DIM       5   * Stores new start time of the slot (HH:MM)
SESNSTAT  DIM       3   * Session status
SUSCLIID  DIM       6   * Stores Clinic Id when suspending clinic
CLICOUNT  FORM      3   * Count of outcliaf records for given Clinic Id.
OVERBOOK  FORM      1   * Over booking flag
FILEOPEN  DIM       30
CATCV     INIT      "CV"
CATgb     INIT      "gb"
FMSAMA    INIT      "fmsamaaf"
FMSLMA    INIT      "fmslmaaf"
XLCNT     FORM      2
.
MAXRECRD  FORM      "250"    * Max num records for Procedures, Diagnosis & Probs
.
.*******************************************************************
. HPS01 STARTS
.*******************************************************************
CURDUM1   FORM      8   * Dummy Variable for Suspend File 
CURDUM2   FORM      8  
CURDUM3   DIM       8  
CURDUM4   FORM      1  
CURDUM5   FORM      3
CURDUM6   FORM      3
.******************************************************************
. HPS01 ENDS
.*******************************************************************
LABELOUT  INIT      "LABELOUT"
.----------------------------------------------------------------------
PRGID     INIT      "OUTWEB05"
VERSION   INIT      "V12.00.02"
PRGNAM    INIT      "Outpatient Maintenance"
.----------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          CALL      OUTFIL00       * Check Correct Files Are Open & Valid Site
          BRANCH    EXIT,MAIN1000
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200,MAIN2300
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70 
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      OUTCTY00        * Outpatient Clinic Type Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      OUTCLI00        * Outpatient Clinic Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      OUTCLV00        * Outpatient Clinic Leave Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      OUTMAS00        * Outpatient Clinic Schedule 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      OUTMAB00        * Outpatient Clinic Slot Template
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      OUTSES00        * Outpatient Clinic Session Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      OUTCTM00        * Outpatient Clinic Template Mapping
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      SUSP0000        * Outpatient Suspended Appointments  
          GOTO      MAIN1000
.
MAIN1900  CALL      OUTCDC00        * Outpatient Clinic Type Diagnosis Maintnce
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2000  CALL      OUTCCT00
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2100  CALL      OUTCPC00        * Outpatient Clinic Type Procedures
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2200  CALL      OUTCPB00        * Outpatient Clinic Type Problems
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2300  CALL      OUTCVT00        * Outpatient Clinic Type linked visit types
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50,NXTPAG60
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG30  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  MOVE      SP70,UPDTTYPE
          CALL      OUTSES00
          GOTO      NXTPAG99
.
NXTPAG60  CALL      WINPAR00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.-------------------------------------------------------------------------------
.  Goes back x number of pages
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
.
          MOVE      NEXTPAGE,F1
          SUB       TWO,F1
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
.                            "    self.close();":
                             "    window.history.go(-",F1,");":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.*******************************************************************************
.                Close Window or Frame and Goto New Location
.*******************************************************************************
WINPAR00  CALL      OPENHTML
          BRANCH    EXIT,WINPAR99
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#" ":
                             "src=#"../js/Standard.js#"></script>":
                             "<script type=#"text/javascript#" ":
                             "src=#"../js/Custom.js#"></script>":
                             "<script type=#"text/javascript#"> ":
                             " if (self.name==#"PopUpFrame#") {":
                             "  redirectParentFrame(#"",REDIRECT,"#"); }":
                             " else { ":
                             "  opener.location.href=#"",REDIRECT,"#";":
                             "  self.close(); }":
                             "</script>"
          CALL      CLOSHTML
WINPAR99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      ALLDEPA1,"alldepaf"   * Open the A/H Department file
          OPEN      IBAPOLA1,"ibapolaf"
          OPEN      OUTSITA1,"outsitaf"   * Open the Site Code file 
          OPEN      OUTPHOA1,"outphoaf"   * Open the file (Public Holidays)
          OPEN      PATCODE1,"patcodes"   * Codes Table File 
          OPEN      PATCODE2,"patcodes"   * Codes Table File  
          OPEN      SCRMASA1,"scrmasaf"   * Screen Sys screen master (LABELS)
          OPEN      PATHSPA1,"pathspaf"   * Hospital File
          OPEN      PATWR1A1,"patwr1af"   * Patient Ward File
          OPEN      PATDO1A1,"patdo1af"   * Doctor File
          OPEN      PMSHCPA1,"pmshcpaf"   * HCP doctors file
          OPEN      PATI10D1,"pati10df"   * ICD10 disease file
          OPEN      PATICDD1,"paticddf"   * ICD9 disease file
          OPEN      PATI10O1,"pati10of"   * ICD10 disease file
          OPEN      PATICDO1,"paticdof"   * ICD9 disease file
          OPEN      PRITHDA1,"prithdaf"   * MBS template id file
          OPEN      PRIPRAC1,"pripracf"   * Medical Practice file
.
          OPEN      MRTLOCA1,"mrtlocaf"   * Medical Records Location File
          OPEN      MRTLOCA3,"mrtlocaf"   * Medical Records Location File
.
          OPEN      OUTLETR1,"outletrf"   * Outpatient Letter File
          OPEN      OUTWMPA1,"outwmpaf"   * Clinic Template Mapping
          OPEN      OUTTXSA1,"outtxsaf"   * Outpatients Extra Templates File
          OPEN      OUTCCTA1,"outcctaf"   * Clinic Type Contract Codes
.
          READ      CONTROLF,TEN8;*163,CGLPATH
          READ      CONTROLF,THIRTY1;*51,HOAUDA  * Read O/P audit indicator  
          READ      CONTROLF,THIRTY2;*111,OTCNAUPD: * Read update review date   
                                     *149,OTCNLCST
.
          MOVE      "out",CFILEPRE        * Save Current File Prefix
          CALL      OPNOUT00              * Open Outpatient Files
.
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS     * Multi hospital parameter
          READ      CONTROLF,THIRTY1;*95,HORVCODE,*154,OTCNSTVT
          OPEN      OUTOSFA1,"outosfaf"
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
          OPEN      MLTSECA1,"mltsecaf"
.
          CALL      OPNFMS00
.
          OPEN      PMSVMTA1,"pmsvmtaf"
          OPEN      PMSVSTA1,"pmsvstaf"
.
INIT9999  RETURN
.------------------------------------------------------------
. Check Correct Files are Open for System
.------------------------------------------------------------
OUTFIL00  MOVE      WBSESIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,OUTFIL90
          MATCH     OSTFILE,CFILEPRE       * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE     * Save Current File Prefix
            CALL      OPNOUT00             * Open Outpatient Files
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL90  MOVE      "Outpatient Site Invalid",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
OUTFIL99  RETURN
.------------------------------------------------------------
. Open Outpateint Files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILCLIA1  * Get the name of the CLIA1 file
          CLOSE     OUTCLIA1
          OPEN      OUTCLIA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCLIA6  * Get the name of the CLIA6 file
          CLOSE     OUTCLIA6
          OPEN      OUTCLIA6,CFNAME           *
.
          PACK      CFNAME,CFILEPRE,FILCTYA1  * Get the name of the CTYA1 file
          CLOSE     OUTCTYA1
          OPEN      OUTCTYA1,CFNAME           * Open the file
          PACK      CFNAME,CFILEPRE,FILCTYA2  * Get the name of the CTYA2 file
          CLOSE     OUTCTYA2
          OPEN      OUTCTYA2,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCDCA1  * Get the name of the CDCA1 file
          CLOSE     OUTCDCA1
          OPEN      OUTCDCA1,CFNAME           * Open the file
          PACK      CFNAME,CFILEPRE,FILCDCA2  * Get the name of the CDCA2 file
          CLOSE     OUTCDCA2
          OPEN      OUTCDCA2,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCLVA1  * Get the name of the CLVA1 file
          CLOSE     OUTCLVA1
          OPEN      OUTCLVA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILMA1A1  * Get the name of the MA1A1 file
          CLOSE     OUTMA1A1
          OPEN      OUTMA1A1,CFNAME           * Open the file
          CLOSE     OUTMA1A2
          OPEN      OUTMA1A2,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILMASB1  * Get the name of the MASB1 file
          CLOSE     OUTMASB1
          OPEN      OUTMASB1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILSESA1  * Get the name of the SESA1 file
          CLOSE     OUTSESA1
          OPEN      OUTSESA1,CFNAME           * Open the file
          PACK      CFNAME,CFILEPRE,FILSESA2  * Get the name of the SESA2 file
          CLOSE     OUTSESA2
          OPEN      OUTSESA2,CFNAME           * Open the file
          PACK      CFNAME,CFILEPRE,FILSESA3  * Get the name of the SESA3 file
          CLOSE     OUTSESA3
          OPEN      OUTSESA3,CFNAME           * Open the file
          PACK      CFNAME,CFILEPRE,FILSESA5  * Get the name of the SESA3 file
          CLOSE     OUTSESA5
          OPEN      OUTSESA5,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILBOKA1  * Get the name of the BOKA1 file
          CLOSE     OUTBOKA1
          OPEN      OUTBOKA1,CFNAME           * Open Clinic Session Booking 
.                                             * File A
          PACK      CFNAME,CFILEPRE,FILMSPA1  * Get the name of the MSPA1 file
          CLOSE     OUTMSPA1
          OPEN      OUTMSPA1,CFNAME           * Clinic Master Suspension Table
          PACK      CFNAME,CFILEPRE,FILMSPA2  * Get the name of the MSPA2 file
          CLOSE     OUTMSPA2
          OPEN      OUTMSPA2,CFNAME           * Clinic Master Suspension Table
.
          PACK      CFNAME,CFILEPRE,FILHEDA1  * Get the name of the HEDA1 file
          CLOSE     OUTHEDA1
          OPEN      OUTHEDA1,CFNAME           * Slot templat header file      
.
          PACK      CFNAME,CFILEPRE,FILBOXA1  * Get the name of the BOXA1 file
          CLOSE     OUTBOXA1
          OPEN      OUTBOXA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCPCA1  * Get the name of the CPCA1 file
          CLOSE     OUTCPCA1
          OPEN      OUTCPCA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCPCA2  * Get the name of the CPCA2 file
          CLOSE     OUTCPCA2
          OPEN      OUTCPCA2,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCPBA1  * Get the name of the CPBA1 file
          CLOSE     OUTCPBA1
          OPEN      OUTCPBA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCPBA2  * Get the name of the CPBA2 file
          CLOSE     OUTCPBA2
          OPEN      OUTCPBA2,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCVTA1  * Get the name of the CVTA1 file
          CLOSE     OUTCVTA1
          OPEN      OUTCVTA1,CFNAME           * Open the file
.
          IF HOAUDA=0
            PACK      CFNAME,CFILEPRE,FILAUDBA
            CLOSE     OUTAUDBA
            OPEN      OUTAUDBA,CFNAME     * Clinic Session Booking File A Audit
          ENDIF
.
          RETURN
.
.------------------------------------------------------------
. Open Financial Management System Files
.------------------------------------------------------------
OPNFMS00  MOVE      TWENTY,XLCNT
OPNFMS10  RESET     CGLPATH,XLCNT
          CMATCH    SP1,CGLPATH
          GOTO      OPNFMS20 IF NOT EQUAL
          SUB       ONE,XLCNT
          COMPARE   ZERO,XLCNT
          GOTO      OPNFMS10 IF NOT EQUAL
          CLEAR     CGLPATH
          GOTO      OPNFMS30
.
OPNFMS20  LENSET    CGLPATH
          RESET     CGLPATH
.
OPNFMS30  PACK      FILEOPEN,CGLPATH,FMSAMA
          OPEN      FMSAMAA1,FILEOPEN
.
          PACK      FILEOPEN,CGLPATH,FMSLMA
          OPEN      FMSLMAA1,FILEOPEN
.
OPNFMS99  RETURN
.
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,SHOWYEAR
          MOVE      SP70,PBYEAR
          MOVE      SP70,SCHDLDAY
          MOVE      SP70,STARTKEY
          MOVE      SP70,SUSCLIID
          MOVE      ZERO,COPYTEMP
          MOVE      ZERO,OVERRIDE
          MOVE      SP70,SESNSTAT
          MOVE      SP70,SESNDATF
          MOVE      SP70,SESNDATT
          MOVE      ZERO,NUMSLOTS
          MOVE      SP70,CLINTYPE
.
          MOVE      SP70,OTCVT001
          MOVE      SP70,OTCVT002
.
          MOVE      SP70,OTCTY001
          MOVE      SP70,OTCTY002
          MOVE      SP70,OTCTY003
          MOVE      SP70,OTCTY004
          MOVE      SP70,OTCTY005
          MOVE      SP70,OTCTY006
          MOVE      SP70,OTCTY007
          MOVE      SP70,OTCTY008
          MOVE      SP70,OTCTY009
          MOVE      SP70,OTCTY010
          MOVE      SP70,OTCTY011
          MOVE      SP70,OTCLI001
          MOVE      SP70,OTCLI002
          MOVE      SP70,OTCLI003
          MOVE      SP70,OTCLI004
          MOVE      SP70,OTCLI005
          MOVE      SP70,OTCLI006
          MOVE      SP70,FILTACTV
.
          MOVE      SP70,OTCLV001
          MOVE      SP70,OTCLV002
          MOVE      SP70,OTCLV003
.
          MOVE      Z70,OTMAS001  
          MOVE      Z70,OTMAS002  
.----------------------------------------------------------------
          MOVE      Z70,OTMAS003  
          MOVE      Z70,OTMAS004  
          MOVE      Z70,OTMAS005  
          MOVE      Z70,OTMAS006  
          MOVE      Z70,OTMAS007  
          MOVE      Z70,OTMAS008  
          MOVE      Z70,OTMAS009  
          MOVE      Z70,OTMAS010  
          MOVE      Z70,OTMAS011  
          MOVE      Z70,OTMAS012  
          MOVE      Z70,OTMAS013  
          MOVE      Z70,OTMAS014  
          MOVE      Z70,OTMAS015  
          MOVE      Z70,OTMAS016  
          MOVE      Z70,OTMAS017  
          MOVE      Z70,OTMAS018  
          MOVE      Z70,OTMAS019  
          MOVE      Z70,OTMAS020  
          MOVE      Z70,OTMAS021  
          MOVE      Z70,OTMAS022  
          MOVE      Z70,OTMAS023  
          MOVE      Z70,OTMAS024  
          MOVE      Z70,OTMAS025  
          MOVE      Z70,OTMAS026  
          MOVE      Z70,OTMAS027  
          MOVE      Z70,OTMAS028  
          MOVE      Z70,OTMAS029  
          MOVE      Z70,OTMAS030  
          MOVE      Z70,OTMAS031  
          MOVE      Z70,OTMAS032  
          MOVE      Z70,OTMAS033  
          MOVE      Z70,OTMAS034  
          MOVE      Z70,OTMAS035  
          MOVE      Z70,OTMAS036  
          MOVE      Z70,OTMAS037  
          MOVE      Z70,OTMAS038  
          MOVE      Z70,OTMAS039  
          MOVE      Z70,OTMAS040  
          MOVE      Z70,OTMAS041  
          MOVE      Z70,OTMAS042  
          MOVE      Z70,OTMAS043  
          MOVE      Z70,OTMAS044  
          MOVE      Z70,OTMAS045  
          MOVE      Z70,OTMAS046  
          MOVE      Z70,OTMAS047  
          MOVE      Z70,OTMAS048  
          MOVE      Z70,OTMAS049  
          MOVE      Z70,OTMAS050  
          MOVE      Z70,OTMAS051
.***********************************************************************
. HPS01 STARTS
.***********************************************************************
          MOVE      Z70,OTMAS052  
          MOVE      Z70,OTMAS053
          MOVE      Z70,OTMAS054  
          MOVE      Z70,OTMAS055  
          MOVE      Z70,OTMAS056  
          MOVE      Z70,OTMAS057  
          MOVE      Z70,OTMAS058  
          MOVE      Z70,OTMAS059  
          MOVE      Z70,OTMAS060  
          MOVE      Z70,OTMAS061  
          MOVE      Z70,OTMAS062  
          MOVE      Z70,OTMAS063  
          MOVE      Z70,OTMAS064  
          MOVE      Z70,OTMAS065  
          MOVE      Z70,OTMAS066  
          MOVE      Z70,OTMAS067
          MOVE      Z70,OTMAS068
          MOVE      Z70,OTMAS069
          MOVE      Z70,OTMAS070
          MOVE      Z70,OTMAS071
          MOVE      Z70,OTMAS072
          MOVE      Z70,OTMAS073
          MOVE      Z70,OTMAS074
          MOVE      Z70,OTMAS075
          MOVE      Z70,OTMAS076
          MOVE      Z70,OTMAS077
          MOVE      Z70,OTMAS078
          MOVE      Z70,OTMAS079
          MOVE      Z70,OTMAS080
          MOVE      Z70,OTMAS081
          MOVE      Z70,OTMAS082
          MOVE      Z70,OTMAS083
          MOVE      Z70,OTMAS084
          MOVE      Z70,OTMAS085
          MOVE      Z70,OTMAS086
          MOVE      Z70,OTMAS087
          MOVE      Z70,OTMAS088
	  MOVE      Z70,OTMAS089
          MOVE      Z70,OTMAS090
          MOVE      Z70,OTMAS091
          MOVE      Z70,OTMAS092
          MOVE      Z70,OTMAS093
          MOVE      Z70,OTMAS094
.
          MOVE      SP70,COPYTO01  
          MOVE      SP70,COPYTO02  
          MOVE      SP70,COPYTO03  
          MOVE      SP70,COPYTO04  
          MOVE      SP70,SUSPEN01  
          MOVE      SP70,SUSPEN02
          MOVE      SP70,SUSPEN03  
          MOVE      SP70,SPMAS001  
          MOVE      SP70,SPMAS002
          MOVE      SP70,SPMAS003  
          MOVE      SP70,SPMAS004  
          MOVE      SP70,SPMAS005
          MOVE      SP70,SPMAS006
.************************************************************************
. HPS01 ENDS
.************************************************************************
          MOVE      ZERO,OTMAB001  
          MOVE      SP70,OTMAB002  
          MOVE      SP70,OTMAB003  
          MOVE      ZERO,STARTSLT  
.
          MOVE      SP70,MTHDTE[1][1]
          MOVE      SP70,MTHDTE[1][2]
          MOVE      SP70,MTHDTE[1][3]
          MOVE      SP70,MTHDTE[1][4]
          MOVE      SP70,MTHDTE[1][5]
.
          MOVE      SP70,MTHDTE[2][1]
          MOVE      SP70,MTHDTE[2][2]
          MOVE      SP70,MTHDTE[2][3]
          MOVE      SP70,MTHDTE[2][4]
          MOVE      SP70,MTHDTE[2][5]
.
          MOVE      SP70,MTHDTE[3][1]
          MOVE      SP70,MTHDTE[3][2]
          MOVE      SP70,MTHDTE[3][3]
          MOVE      SP70,MTHDTE[3][4]
          MOVE      SP70,MTHDTE[3][5]
.
          MOVE      SP70,MTHDTE[4][1]
          MOVE      SP70,MTHDTE[4][2]
          MOVE      SP70,MTHDTE[4][3]
          MOVE      SP70,MTHDTE[4][4]
          MOVE      SP70,MTHDTE[4][5]
.
          MOVE      SP70,MTHDTE[5][1]
          MOVE      SP70,MTHDTE[5][2]
          MOVE      SP70,MTHDTE[5][3]
          MOVE      SP70,MTHDTE[5][4]
          MOVE      SP70,MTHDTE[5][5]
.
          MOVE      SP70,MTHDTE[6][1]
          MOVE      SP70,MTHDTE[6][2]
          MOVE      SP70,MTHDTE[6][3]
          MOVE      SP70,MTHDTE[6][4]
          MOVE      SP70,MTHDTE[6][5]
.
          MOVE      SP70,MTHDTE[7][1]
          MOVE      SP70,MTHDTE[7][2]
          MOVE      SP70,MTHDTE[7][3]
          MOVE      SP70,MTHDTE[7][4]
          MOVE      SP70,MTHDTE[7][5]
.
          MOVE      SP70,MTHDTE[8][1]
          MOVE      SP70,MTHDTE[8][2]
          MOVE      SP70,MTHDTE[8][3]
          MOVE      SP70,MTHDTE[8][4]
          MOVE      SP70,MTHDTE[8][5]
.
          MOVE      SP70,MTHDTE[9][1]
          MOVE      SP70,MTHDTE[9][2]
          MOVE      SP70,MTHDTE[9][3]
          MOVE      SP70,MTHDTE[9][4]
          MOVE      SP70,MTHDTE[9][5]
.
          MOVE      SP70,MTHDTE[10][1]
          MOVE      SP70,MTHDTE[10][2]
          MOVE      SP70,MTHDTE[10][3]
          MOVE      SP70,MTHDTE[10][4]
          MOVE      SP70,MTHDTE[10][5]
.
          MOVE      SP70,MTHDTE[11][1]
          MOVE      SP70,MTHDTE[11][2]
          MOVE      SP70,MTHDTE[11][3]
          MOVE      SP70,MTHDTE[11][4]
          MOVE      SP70,MTHDTE[11][5]
.
          MOVE      SP70,MTHDTE[12][1]
          MOVE      SP70,MTHDTE[12][2]
          MOVE      SP70,MTHDTE[12][3]
          MOVE      SP70,MTHDTE[12][4]
          MOVE      SP70,MTHDTE[12][5]
.
          MOVE      SP70,OTWMP001
          MOVE      SP70,OTWMP002
          MOVE      SP70,OTWMP003
          MOVE      SP70,OTWMP004
          MOVE      SP70,OTWMP005
          MOVE      SP70,OTWMP006
          MOVE      SP70,OTWMP007
.
          MOVE      SP70,SRCHCLTY
          MOVE      SP70,SRCHCLID
          MOVE      SP70,SRCHLTYP
          MOVE      SP70,SRCHDOWK
          MOVE      SP70,SRCHSTIM
          MOVE      ZERO,VIEWTYPE
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,VYEARMTH
          MOVE      ZERO,SUSPCNTR
.
          MOVE      ZERO,NUMSLGEN    
          MOVE      ZERO,NUMSLVIS   
          MOVE      ZERO,NUMSLPRO   
          MOVE      ZERO,TOTSLCNT
          MOVE      ZERO,VISSLCNT     
          MOVE      SP70,SAVSLKEY   
          MOVE      ZERO,PARNTSLT    
          MOVE      ZERO,STARTSLT   
          MOVE      ZERO,CURRSLOT   
          MOVE      ZERO,NEXTSLOT   
          MOVE      ZERO,NSLTSTRT   
          MOVE      ZERO,NSLTENDT   
          MOVE      ZERO,PREVTIME   
          MOVE      ZERO,NEXTTIME   
          MOVE      ZERO,RESULT     
          MOVE      SP70,OLDTIME     
          MOVE      SP70,NEWTIME     
          MOVE      SP70,CHECKSIT
          MOVE      SP70,CLNCTYPE
.
          MOVE      ONE,COUNT
          WHILE     COUNT <= 100
            MOVE      SP70,SUSPKEYS[COUNT]
            ADD       ONE,COUNT
          DO
.
          MOVE      ZERO,MULTCONT        * initialise multiple slot array count
          MOVE      ONE,MULTLOOP
.
          CALL      CPOTTX00           * Outpatients Extra Templates file
          CALL      CPOTHE00           * Clear clinic header cgi vars
          MOVE      Z70,CLINTYPE
          MOVE      Z70,NEWCTYPE
          CALL      CPOTCD00           * Outpatients Clinic Type Diagnosis
          CALL      CPOTCP00           * Outpatient Clinic Type Procedures
          CALL      CPOTCB00           * Outpatient Clinic Type Problems
          MOVE      SP70,MANDTYID
.
          MOVE      ONE,LVISTCNT
          WHILE     LVISTCNT <= 500
            MOVE      SP70,LVISTARR[LVISTCNT]
            ADD       ONE,LVISTCNT
          DO
          MOVE      ZERO,LVISTCNT
.
          RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clintype=",QRYNAME
          IF        @EQUAL
            PACK      CLINTYPE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clnctype=",QRYNAME
          IF        @EQUAL
            PACK      CLNCTYPE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "newctype=",QRYNAME
          IF        @EQUAL
            PACK      NEWCTYPE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showyear=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWYEAR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otcty",QRYNAME
          IF        @EQUAL
            CALL      STCOD000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otcvt",QRYNAME
          IF        @EQUAL
            CALL      SPCVT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otcdc",QRYNAME
          IF        @EQUAL
            CALL      SPOTCD00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otcpc",QRYNAME
          IF        @EQUAL
            CALL      SPOTCP00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otcpb",QRYNAME
          IF        @EQUAL
            CALL      SPOTCB00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otcli",QRYNAME
          IF        @EQUAL
            CALL      STCLI000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otclv",QRYNAME
          IF        @EQUAL
            CALL      STCLV000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otmas",QRYNAME
          IF        @EQUAL
            CALL      STMAS000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "copytemp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,COPYTEMP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "checksit=",QRYNAME
          IF        @EQUAL
            PACK      CHECKSIT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "slotn",QRYNAME
          IF        @EQUAL
            CALL      ARRA0000          * set array of slots
          ENDIF
.
          MATCH     "contcode=",QRYNAME
          IF        @EQUAL
            PACK      CONTCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
.*************************************************************************
. HPS01 STARTS
.************************************************************************
          MATCH     "copyto",QRYNAME
          IF        @EQUAL
            CALL      STCOP000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "suspen",QRYNAME
          IF        @EQUAL
            CALL      STSUS000
            GOTO      SETPAR99
          ENDIF
.***********************************************************************
. HPS01 ENDS
.************************************************************************
          MATCH     "otmab",QRYNAME
          IF        @EQUAL
            CALL      STMAB000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otwmp",QRYNAME
          IF        @EQUAL
            CALL      STCTM000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "date",QRYNAME       * Will contain a date   
          IF        @EQUAL
            CALL      STMON000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchclty=",QRYNAME
          IF        @EQUAL
            PACK      SRCHCLTY,QRYDATA,SP70
            PACK      SRCHCLTY,SRCHCLTY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchdowk=",QRYNAME
          IF        @EQUAL
            PACK      SRCHDOWK,QRYDATA,SP70
            PACK      SRCHDOWK,SRCHDOWK,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchstim=",QRYNAME
          IF        @EQUAL
            PACK      SRCHSTIM,QRYDATA,SP70
            PACK      SRCHSTIM,SRCHSTIM,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchclid=",QRYNAME
          IF        @EQUAL
            PACK      SRCHCLID,QRYDATA,SP70
            PACK      SRCHCLID,SRCHCLID,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchltyp=",QRYNAME
          IF        @EQUAL
            PACK      SRCHLTYP,QRYDATA,SP70
            PACK      SRCHLTYP,SRCHLTYP,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "override=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OVERRIDE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "suspkeys",QRYNAME    * Contains suspension file keys
          IF        @EQUAL
            CALL      STSKY000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ottxs",QRYNAME
          IF        @EQUAL
            CALL      SPTXS000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "othed",QRYNAME
          IF        @EQUAL
            CALL      SPOTHE00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sesnstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SESNSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtactv=",QRYNAME
          IF        @EQUAL
            PACK      FILTACTV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sesndatf=",QRYNAME
          IF        @EQUAL
            MATCH     SP70,QRYDATA
            GOTO      SETPAR99 IF EQUAL
            GOTO      SETPAR99 IF EOS
.
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * Set CMON from MTHNAM3
            PACK      SESNDATF,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sesndatt=",QRYNAME
          IF        @EQUAL
            MATCH     SP70,QRYDATA
            GOTO      SETPAR99 IF EQUAL
            GOTO      SETPAR99 IF EOS
.
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * Set CMON from MTHNAM3
            PACK      SESNDATT,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "numslots=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NUMSLOTS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startslt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTSLT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mandtyid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MANDTYID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lvistarr=",QRYNAME
          IF        @EQUAL
            COMPARE   "501",LVISTCNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,LVISTCNT
            PACK      LVISTARR[LVISTCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Option 1: Outpatient Clinic Type Maintenance 
.-------------------------------------------------------------------------------
STCOD000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STCOD001,STCOD002,STCOD003,STCOD004,STCOD005:
                       STCOD006,STCOD007,STCOD008,STCOD009,STCOD010:
                       STCOD011
.
          MOVE      ONE,EXIT
          GOTO      STCOD999
.
STCOD001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,OTCTY001
          PACK      OTCTY001,OTCTY001,SP70
          GOTO      STCOD999
STCOD002  MOVE      QRYDATA,OTCTY002
          GOTO      STCOD999
STCOD003  MOVE      QRYDATA,OTCTY003
          GOTO      STCOD999
STCOD004  MOVE      QRYDATA,OTCTY004
          GOTO      STCOD999
STCOD005  MOVE      QRYDATA,OTCTY005
          GOTO      STCOD999
STCOD006  MOVE      QRYDATA,OTCTY006
          GOTO      STCOD999
STCOD007  MOVE      QRYDATA,OTCTY007
          GOTO      STCOD999
STCOD008  MOVE      QRYDATA,OTCTY008
          GOTO      STCOD999
STCOD009  MOVE      QRYDATA,OTCTY009
          GOTO      STCOD999
STCOD010  MOVE      QRYDATA,OTCTY010
          GOTO      STCOD999
STCOD011  MOVE      QRYDATA,OTCTY011
          GOTO      STCOD999
.
STCOD999  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Option 2: Outpatient Clinic Maintenance 
.-------------------------------------------------------------------------------
STCLI000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STCLI001,STCLI002,STCLI003,STCLI004,STCLI005,STCLI006
.
          MOVE      ONE,EXIT
          GOTO      STCLI999
.
STCLI001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,OTCLI001
          PACK      OTCLI001,OTCLI001,SP70
          REP       "+ ",OTCLI001
          GOTO      STCLI999
STCLI002  MOVE      QRYDATA,OTCLI002
          GOTO      STCLI999
STCLI003  MOVE      QRYDATA,OTCLI003
          GOTO      STCLI999
STCLI004  MOVE      QRYDATA,OTCLI004
          GOTO      STCLI999
STCLI005  MOVE      QRYDATA,OTCLI005
          GOTO      STCLI999
STCLI006  PACK      QRYDATA,QRYDATA,SP30
          UNPACK    QRYDATA,KEY8,KEY3 * Check for formatted or unformatted date
          MATCH     SP70,KEY3
          IF        @EQUAL
            MOVE      QRYDATA,OTCLI006 * Do not change date format = (CCYYMMDD)
          ELSE
            MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
            PACK      KEY11,KEY11,SP70
            MATCH     SP70,KEY11
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      OTCLI006,CCENT,CYEAR,CMON,CDAY
              REP       " 0",OTCLI006
            ENDIF
          ENDIF 
          GOTO      STCLI999
.
STCLI999  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Option 3: Outpatient Clinic Leave  
.-------------------------------------------------------------------------------
STCLV000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STCLV001,STCLV002,STCLV003
.
          MOVE      ONE,EXIT
          GOTO      STCLV999
.
STCLV001  PACK      QRYDATA,QRYDATA,SP30
          UNPACK    QRYDATA,KEY8,KEY3 * Check for formatted or unformatted date
          MATCH     SP70,KEY3
          IF        @EQUAL
            MOVE      QRYDATA,OTCLV001 * Do not change date format = (CCYYMMDD)
          ELSE
            MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
            PACK      KEY11,KEY11,SP70
            MATCH     SP70,KEY11
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      OTCLV001,CCENT,CYEAR,CMON,CDAY
              REP       " 0",OTCLV001
            ENDIF
          ENDIF 
          GOTO      STCLV999
.
STCLV002  MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      OTCLV002,CCENT,CYEAR,CMON,CDAY
            REP       " 0",OTCLV002
          ENDIF 
          GOTO      STCLV999
.
STCLV003  MOVE      QRYDATA,OTCLV003
          GOTO      STCLV999
.
STCLV999  RETURN
.------------------------------------------------------------
. Set Parameters for Option 4: Outpatient Clinic Schedule          
.------------------------------------------------------------
STMAS000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          IF        (F3=52|F3=53)
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      QRYDATA,CCENT,CYEAR,CMON,CDAY,SP70
          ENDIF
.
          STORE     QRYDATA,F3,OTMAS001,OTMAS002,OTMAS003,OTMAS004,OTMAS005:
                               OTMAS006,OTMAS007,OTMAS008,OTMAS009,OTMAS010:
                               OTMAS011,OTMAS012,OTMAS013,OTMAS014,OTMAS015:
                               OTMAS016,OTMAS017,OTMAS018,OTMAS019,OTMAS020:
                               OTMAS021,OTMAS022,OTMAS023,OTMAS024,OTMAS025:
                               OTMAS026,OTMAS027,OTMAS028,OTMAS029,OTMAS030:
                               OTMAS031,OTMAS032,OTMAS033,OTMAS034,OTMAS035:
                               OTMAS036,OTMAS037,OTMAS038,OTMAS039,OTMAS040:
                               OTMAS041,OTMAS042,OTMAS043,OTMAS044,OTMAS045:
                               OTMAS046,OTMAS047,OTMAS048,OTMAS049,OTMAS050:
                               OTMAS051,OTMAS052,OTMAS053,OTMAS054,OTMAS055:
                               OTMAS056,OTMAS057,OTMAS058,OTMAS059,OTMAS060:
                               OTMAS061,OTMAS062,OTMAS063,OTMAS064,OTMAS065:
                               OTMAS066,OTMAS067,OTMAS068,OTMAS069,OTMAS070:
                               OTMAS071,OTMAS072,OTMAS073,OTMAS074,OTMAS075:
                               OTMAS076,OTMAS077,OTMAS078,OTMAS079,OTMAS080:
                               OTMAS081,OTMAS082,OTMAS083,OTMAS084,OTMAS085:
                               OTMAS086,OTMAS087,OTMAS088,OTMAS089,OTMAS090:
                               OTMAS091,OTMAS092,OTMAS093,OTMAS094
.
STMAS999  RETURN
.**************************************************************************
. HPS01 STARTS
.**************************************************************************
STCOP000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY6,KEY2
          MOVE      KEY2,F2
.
          IF        (F2=4)
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      QRYDATA,CCENT,CYEAR,CMON,CDAY,SP70
          ENDIF
.
          STORE     QRYDATA,F2,COPYTO01,COPYTO02,COPYTO03,COPYTO04
          MOVE      ONE,EXIT
.
STCOP999  RETURN
.
STSUS000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY6,KEY2
          MOVE      KEY2,F2
          BRANCH    F2,STSUS100,STSUS200,STSUS300
          MOVE      ONE,EXIT
          GOTO      STSUS999
.
STSUS100  PACK      QRYDATA,QRYDATA,SP30
          UNPACK    QRYDATA,KEY8,KEY3 * Check for formatted or unformatted date
          MATCH     SP70,KEY3
          IF        @EQUAL
            MOVE      QRYDATA,SUSPEN01 * Do not change date format = (CCYYMMDD)
          ELSE
            MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
            PACK      KEY11,KEY11,SP70
            MATCH     SP70,KEY11
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      SUSPEN01,CCENT,CYEAR,CMON,CDAY
              REP       " 0",SUSPEN01
            ENDIF
          ENDIF
          GOTO        STSUS999
.
STSUS200  PACK      QRYDATA,QRYDATA,SP30
          UNPACK    QRYDATA,KEY8,KEY3 * Check for formatted or unformatted date
          MATCH     SP70,KEY3
          IF        @EQUAL
            MOVE      QRYDATA,SUSPEN02 * Do not change date format = (CCYYMMDD)
          ELSE
            MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
            PACK      KEY11,KEY11,SP70
            MATCH     SP70,KEY11
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      SUSPEN02,CCENT,CYEAR,CMON,CDAY
              REP       " 0",SUSPEN02
            ENDIF
          ENDIF
          GOTO        STSUS999
.
STSUS300  MOVE        QRYDATA,SUSPEN03
STSUS999  RETURN
.*******************************************************************
. HPS01 ENDS
.------------------------------------------------------------
. Set Parameters for Option 5: Outpatient Clinic Slot Template     
.------------------------------------------------------------
STMAB000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,OTMAB001,OTMAB002,OTMAB003
.
STMAB999  RETURN
.------------------------------------------------------------
. Set Parameters for Option 6: Outpatient Clinic Session Details  
.             ********* January...December **********
.------------------------------------------------------------
STMON000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY4,MONTH,KEY2
          MOVE      MONTH,MONTHNO 
          MOVE      KEY2,F2
          PACK      MTHDTE[MONTHNO][F2],QRYDATA,SP70
.
STMON999  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Option 7: Clinic Template Maintenance
.-------------------------------------------------------------------------------
STCTM000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STCTM001,STCTM002,STCTM003,STCTM004,STCTM005,STCTM006:
                       STCTM007
.
          MOVE      ONE,EXIT
          GOTO      STCTM999
.
STCTM001  PACK      OTWMP001,QRYDATA,SP70
          GOTO      STCTM999
.
STCTM002  PACK      OTWMP002,QRYDATA,SP70
          GOTO      STCTM999
.
STCTM003  PACK      OTWMP003,QRYDATA,SP70
          GOTO      STCTM999
.
STCTM004  PACK      OTWMP004,QRYDATA,SP70
          GOTO      STCTM999
.
STCTM005  PACK      OTWMP005,QRYDATA,SP70
          GOTO      STCTM999
.
STCTM006  PACK      OTWMP006,QRYDATA,SP70
          GOTO      STCTM999
.
STCTM007  PACK      OTWMP007,QRYDATA,SP70
          GOTO      STCTM999
.
STCTM999  RETURN      
.------------------------------------------------------------
. Outpatient Clinic Type Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
OUTCTY00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTCTY40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OUTCTY10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OUTCTY20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTCTY30 IF EQUAL
.
          GOTO      OUTCTY93
.
.         ************ ADD FORMACTION ***********
.
OUTCTY10  CALL      CHKCTY00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,OUTCTY99
          PACK      KEY12,WBSESIT,OTCTY001,SP70  * ADD FORMACTION
          CALL      RDCTYA1
          COMPARE   ZERO,OVRCD
          GOTO      OUTCTY92 IF EQUAL
          CALL      CTYSAV00      * Moves input variables to file variables
          CALL      WRCTYA1       * Writes away the data
          MOVE      "A",OTCMACTN    * action flag for HL7
          MOVE      ONE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIOCT        * send HL7 message for Clinic Type Add
          CALL      INOTTX00      * Write to Extra Templates File
          BRANCH    EXIT,OUTCTY99
.
          MOVE      ZERO,EXIT
          GOTO      OUTCTY99
.
.         ************ UPDATE FORMACTION **********
.
OUTCTY20  PACK      KEY12,WBSESIT,OTCTY001,SP70  * UPDATE FORMACTION
          CALL      RDCTYA1
          BRANCH    OVRCD,OUTCTY91
.
          CALL      CDVT0000      * Check default visit type is valid
          BRANCH    EXIT,OUTCTY94
.
          CALL      CHKCTY00      * Checks mandatory fields
          BRANCH    EXIT,OUTCTY99
          CALL      CTYSAV00      * Moves input variables to file variables
          CALL      UPCTYA1       * Writes away the data
          MOVE      "U",OTCMACTN    * action flag for HL7
          MOVE      TWO,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIOCT        * send HL7 message for Clinic Type Upd
          CALL      UPOTTX00      * Update Extra Templates File
          MOVE      ZERO,EXIT
          GOTO      OUTCTY99
.
.         ************ DELETE FORMACTION **********
.
OUTCTY30  PACK      KEY12,WBSESIT,OTCTY001,SP70   * DELETE FORMACTION
          CALL      RDCTYA1
          BRANCH    OVRCD,OUTCTY91
          CALL      DECTYA1       * Deletes the data
          MOVE      "D",OTCMACTN    * action flag for HL7
          MOVE      THREE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIOCT        * send HL7 message for Clinic Type Del
          CALL      DLOTTX00      * Delete Extra Templates File
          MOVE      ZERO,EXIT
          GOTO      OUTCTY99
.
.         ************ DISPLAY FORMACTION **********
.
OUTCTY40  PACK      KEY12,WBSESIT,OTCTY001,SP70 
          CALL      RDCTYA1
          IF        OVRCD=1
            CALL      CLRCTY00    * Clear all the file variables
          ENDIF
. 
          PACK      KEY12,WBSESIT,OTCTY001,SP70
          CALL      RDOTTXS1      * Read Extra Template file
          IF        OVRCD=1
            CALL      CLOTTX00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Type Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTCTY99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTCTY99
.
OUTCTY91  MOVE      "Clinic Type does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCTY99
.
OUTCTY92  MOVE      "Clinic Type exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCTY99
.
OUTCTY93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCTY99
.
OUTCTY94  CLEAR     WEBTITLE
          APPEND    "The default visit type in not linked to this",WEBTITLE
          APPEND    " clinic type",WEBTITLE
          RESET     WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      OUTCTY99
.
OUTCTY99  RETURN
.------------------------------------------------------------
. Contract Codes
.------------------------------------------------------------
OUTCCT00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTCCT30 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OUTCCT10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTCCT20 IF EQUAL
.
          GOTO      OUTCCT93
.
.         ************ ADD FORMACTION ***********
.
OUTCCT10  PACK      KEY15,WBSESIT,CLINTYPE,CONTCODE,SP70
          CALL      RDOTCCT1
          IF        OVRCD=1
            UNPACK    KEY15,OTCCSITE,OTCCCTYP,OTCCCONT
            PACK      OTCCCDAT,CCC,CYY,CMM,CDD
            REP       " 0",OTCCCDAT
            CLOCK     TIME,OTCCCTIM
            MOVE      USERID,OTCCCUID
            CALL      WROTCCT1
          ELSE
            GOTO      OUTCCT94
          ENDIF
.
          GOTO      OUTCCT99
.
.         ************ DELETE FORMACTION **********
.
OUTCCT20  PACK      KEY15,WBSESIT,CLINTYPE,CONTCODE,SP70
          CALL      RDOTCCT1
          IF        OVRCD=0
            CALL      DEOTCCT1
          ELSE
            CALL      OUTCCT95
          ENDIF
.
          GOTO      OUTCCT99
.
OUTCCT30  CLEAR     WEBTITLE
          MOVE      "Clinic Type Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          PACK      OTCCCTYP,CLINTYPE,SP70
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTCTY99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          PACK      CLINTYPE,OTCCCTYP,SP70
.         
          MOVE      ONE,EXIT
          GOTO      OUTCTY99
.
OUTCCT93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCCT99
.
OUTCCT94  MOVE      "Category Code already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCCT99
.
OUTCCT95  MOVE      "Category Code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCCT99
.

OUTCCT99  RETURN
.------------------------------------------------------------
. Process Clinic Type Diagnoses
.------------------------------------------------------------
OUTCDC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTCDC60 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OUTCDC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OUTCDC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTCDC30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy formaction
          GOTO      OUTCDC40 IF EQUAL
.
          MATCH     "L",UPDTTYPE    * Delete all formaction
          GOTO      OUTCDC50 IF EQUAL
.
          GOTO      OUTCDC93
.
.         ************ ADD FORMACTION ***********
.
OUTCDC10  MOVE      ZERO,COUNTER
          MOVE      CLINTYPE,OTCDC002
          PACK      KEY21,WBSESIT,OTCDC002,SP70
          CALL      RSOTCDC1
OUTCDC12  CALL      RKOTCDC1                * loop through ctype diagnosis file
          BRANCH    OVRCD,OUTCDC15
.
          MATCH     OTCDSITE,WBSESIT        * check if same clinic type
          GOTO      OUTCDC15 IF NOT EQUAL
.
          MATCH     OTCDCTYP,OTCDC002       * check if same clinic type
          GOTO      OUTCDC15 IF NOT EQUAL
.
          ADD       ONE,COUNTER
          COMPARE   MAXRECRD,COUNTER
          GOTO      OUTCDC96 IF EQUAL       * check no more than 250 diagnoses
.
          GOTO      OUTCDC12
.
OUTCDC15  PACK      KEY21,WBSESIT,OTCDC002,OTCDC003,SP70
          CALL      RAOTCDC1
          COMPARE   ZERO,OVRCD
          GOTO      OUTCDC92 IF EQUAL
          CALL      MVOTCD00                     * Move cgi to file variables

          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,OTCDCDAT                * System date
          CLOCK     TIME,OTCDCTIM                * System time
          MOVE      USERID,OTCDCUID              * web user id
          MOVE      SP70,OTCDUDAT
          MOVE      SP70,OTCDUTIM
          MOVE      SP70,OTCDUUID
          PACK      KEY21,WBSESIT,OTCDC002,OTCDC003,SP70
          CALL      WROTCDC1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      OUTCDC99
.
.         ************ UPDATE FORMACTION **********
.
OUTCDC20  MOVE      CLINTYPE,OTCDC002
          PACK      KEY21,WBSESIT,OTCDC002,OTCDC003,SP70
          CALL      RDOTCDC1
          BRANCH    OVRCD,OUTCDC91
          CALL      MVOTCD00                     * Moves cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,OTCDUDAT                * System Date
          CLOCK     TIME,OTCDUTIM                * System time
          MOVE      USERID,OTCDUUID              * web user id
          PACK      KEY21,WBSESIT,OTCDC002,OTCDC003,SP70
          CALL      UPOTCDC1                     * Updates the data
.
          MOVE      ZERO,EXIT
          GOTO      OUTCDC99
.
.         ************ DELETE FORMACTION **********
.
OUTCDC30  MOVE      CLINTYPE,OTCDC002
          PACK      KEY21,WBSESIT,OTCDC002,OTCDC003,SP70
          CALL      RDOTCDC1
          BRANCH    OVRCD,OUTCDC91
          CALL      DEOTCDC1                     * Deletes the data
.
          MOVE      "outcdcaf",MAPTBNAM
          PACK      MAPTBIND,WBSESIT,OTCDC002,OTCDC003,SP70
          CALL      DELCSM00                * Delete Coding System Mappings
.
          MOVE      ZERO,EXIT
          GOTO      OUTCDC99
.
.         ************ COPY FORMACTION **********
.
OUTCDC40  MOVE      CLINTYPE,OTCDC002
          PACK      KEY21,WBSESIT,NEWCTYPE,SP70
          CALL      RSOTCDC1
          CALL      RKOTCDC1                * loop through ctype diagnosis file
          BRANCH    OVRCD,OUTCDC42
.
          MATCH     OTCDSITE,WBSESIT        * check if same site        
          GOTO      OUTCDC42 IF NOT EQUAL
.
          MATCH     OTCDCTYP,NEWCTYPE       * check if same clinic type
          GOTO      OUTCDC42 IF NOT EQUAL
.
          MATCH     SP70,OTCDDIAG           * error if diags exist for ctype
          GOTO      OUTCDC95 IF NOT EQUAL
.
.         Copy diagnoses to new clinic type
.
OUTCDC42  PACK      KEY21,WBSESIT,OTCDC002,SP70
          CALL      RSOTCDC1
OUTCDC43  CALL      RKOTCDC1                * loop through ctype diagnosis file
          BRANCH    OVRCD,OUTCDC45
.
          MATCH     OTCDCTYP,OTCDC002       * check if still same clinic type
          GOTO      OUTCDC45 IF NOT EQUAL
.
          MOVE      NEWCTYPE,OTCDCTYP       * write to new clinic type
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,OTCDCDAT                * System date
          CLOCK     TIME,OTCDCTIM                * System time
          MOVE      USERID,OTCDCUID              * web user id
          MOVE      SP70,OTCDUDAT
          MOVE      SP70,OTCDUTIM
          MOVE      SP70,OTCDUUID
          PACK      KEY21,WBSESIT,OTCDCTYP,OTCDDIAG
          CALL      WROTCDC1                * copy diagnosis to new clinic type
          GOTO      OUTCDC43
.
OUTCDC45  MOVE      ZERO,EXIT
          GOTO      OUTCDC99
.
.         ************ DELETE ALL FORMACTION **********
.
OUTCDC50  MOVE      CLINTYPE,OTCDC002
          PACK      KEY21,WBSESIT,OTCDC002,SP70
          CALL      RSOTCDC1
OUTCDC55  CALL      RKOTCDC1                * loop through ctype diagnosis file
          BRANCH    OVRCD,OUTCDC58
.
          MATCH     OTCDCTYP,OTCDC002       * check if still same clinic type
          GOTO      OUTCDC58 IF NOT EQUAL
.
          PACK      KEY21,OTCDSITE,OTCDCTYP,OTCDDIAG,SP70
          CALL      DEOTCDC1                * deletes the record
          GOTO      OUTCDC55
.
OUTCDC58  MOVE      ZERO,EXIT
          GOTO      OUTCDC99
.
.         ************ DISPLAY FORMACTION **********
.
OUTCDC60  MOVE      CLINTYPE,OTCDC002
          PACK      KEY21,WBSESIT,OTCDC002,OTCDC003,SP70
          CALL      RDOTCDC1
          IF        OVRCD=1
            CALL      CLOUTCDC                   * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Type Diagnosis Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTCDC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTCDC99
.
OUTCDC91  MOVE      "Clinic Type Diagnosis Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCDC99
.
OUTCDC92  MOVE      "Clinic Type Diagnosis Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCDC99
.
OUTCDC93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCDC99
.
OUTCDC94  MOVE      "Invalid Clinic Type Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCDC99
.
OUTCDC95  MOVE      "Diagnoses exist for this Clinic Type. Cannot proceed with this function.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCDC99
.
OUTCDC96  CLEAR     WEBTITLE
          APPEND    "Only ",WEBTITLE
          APPEND    MAXRECRD,WEBTITLE
          APPEND    " diagnoses allowed for each Clinic Type",WEBTITLE
          RESET     WEBTITLE
.         MOVE      "Only 100 diagnoses allowed for each Clinic Type",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCDC99
.
OUTCDC99  RETURN
.-----------------------------------------------------------
. Insert into Extra Templates File
.-----------------------------------------------------------
INOTTX00  MATCH     SP70,OTTXS003           * Is booking template populated?
          GOTO      INOTTX10 IF NOT EQUAL
          MATCH     SP70,OTTXS006           * Is attendance template populated?
          GOTO      INOTTX10 IF NOT EQUAL
.
          MOVE      ZERO,EXIT
          GOTO      INOTTX99
.
INOTTX10  PACK      KEY12,OCTSITE,OCTCTYP,SP70
          CALL      RAOTTXS1
          COMPARE   ZERO,OVRCD
          GOTO      INOTTX90 IF EQUAL
.
          CALL      MVOTTX00                    * Set Extra Templ file fields
          MOVE      OCTSITE,OTTXSITE            * Set site code
          MOVE      OCTCTYP,OTTXCTYP            * Set Clinic Type
          CALL      WROTTXS1                    * Write Extra Templates record
.
          MOVE      ZERO,EXIT
          GOTO      INOTTX99
.
INOTTX90  MOVE      "Extra Templates exist for this Clinic Type!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INOTTX99
.
INOTTX99  RETURN
.-----------------------------------------------------------
. Update Extra Templates File
.-----------------------------------------------------------
UPOTTX00  PACK      KEY12,OCTSITE,OCTCTYP,SP70
          CALL      RDOTTXS1
          BRANCH    OVRCD,UPOTTX20          * Record not found
.
          MATCH     SP70,OTTXS003           * Is booking template populated?
          GOTO      UPOTTX10 IF NOT EQUAL
          MATCH     SP70,OTTXS006           * Is attendance template populated?
          GOTO      UPOTTX10 IF NOT EQUAL
.
.         Record exists and extra template fields have been blanked out.
.         Therefore delete this record.
.
          CALL      DEOTTXS1
          GOTO      UPOTTX99
.
.         Record exists and extra template fields are populated - update record
.
UPOTTX10  CALL      MVOTTX00           * Move input vars to Extra Templ. file
          MOVE      OCTSITE,OTTXSITE   * Set site code
          MOVE      OCTCTYP,OTTXCTYP   * Set Clinic Type
          CALL      UPOTTXS1           * Update Extra Templates file record
          GOTO      UPOTTX99
.
UPOTTX20  MATCH     SP70,OTTXS003           * Is booking template populated?
          GOTO      UPOTTX30 IF NOT EQUAL
          MATCH     SP70,OTTXS006           * Is attendance template populated?
          GOTO      UPOTTX30 IF NOT EQUAL
.
.         Record does not exist and extra template fields are blank
.
          GOTO      UPOTTX99
.
.         Record does not exist and extra template fields are populated.
.         Insert record.
.
UPOTTX30  CALL      MVOTTX00                    * Set Extra Templ file fields
          MOVE      OCTSITE,OTTXSITE            * Set site code
          MOVE      OCTCTYP,OTTXCTYP            * Set Clinic Type
          PACK      KEY12,OTTXSITE,OTTXCTYP,SP70
          CALL      WROTTXS1                    * Update Extra Templates record
.
UPOTTX99  RETURN
.-----------------------------------------------------------
. Delete Extra Templates File
.-----------------------------------------------------------
DLOTTX00  PACK      KEY12,OCTSITE,OCTCTYP,SP70
          CALL      RDOTTXS1
          BRANCH    OVRCD,DLOTTX99          * Record not found
.
          CALL      DEOTTXS1
.
DLOTTX99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRCTY00  MOVE      SP70,OCTSITE   
          MOVE      SP70,OCTCTYP   
          MOVE      SP70,OCTGRP    
          MOVE      SP70,OCTDESC   
          MOVE      SP70,OCTXBOK   
          MOVE      SP70,OCTXATT   
          MOVE      SP70,OCTBKT    
          MOVE      SP70,OCTATT    
          MOVE      SP70,OCTACT     
          MOVE      SP70,OCTVACS     
          MOVE      SP70,OCTUSDF1   
          MOVE      SP70,OCTUSDF2   
          MOVE      SP70,OCTDEFCV   
          MOVE      SP70,OCTSPARE         
.
CLRCTY99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
CTYSAV00  MOVE      WBSESIT,OCTSITE
          MOVE      OTCTY001,KEY6
          SQUEEZE   KEY6
          MOVE      KEY6,OCTCTYP
          MOVE      OTCTY002,OCTDESC
          MOVE      OTCTY003,OCTGRP 
          MOVE      OTCTY004,OCTBKT 
          MOVE      OTCTY005,OCTATT  
          MOVE      OTCTY007,OCTVACS  
          MOVE      OTCTY008,OCTWUNIT
          MOVE      OTCTY009,OCTUSDF1
          MOVE      OTCTY010,OCTUSDF2
          MOVE      OTCTY011,OCTDEFCV
.
          MATCH     SP70,OTCTY006
          IF        @EQUAL 
            MOVE      "1",OCTACT                  * Clinic Inactive
          ELSE   
            MOVE      "0",OCTACT                  * Active Clinic
          ENDIF
.
          MOVE      SP70,OCTXBOK   
          MOVE      SP70,OCTXATT
          MOVE      SP70,OCTSPARE         
.
CTYSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields and checks for blank
.------------------------------------------------------------------
CHKCTY00  RESET     OTCTY001
          MATCH     SP70,OTCTY001
          GOTO      CHKCTY90 IF EQUAL
.
          RESET     OTCTY002
          MATCH     SP70,OTCTY002
          GOTO      CHKCTY91 IF EQUAL
.
          RESET     OTCTY003
          MATCH     SP70,OTCTY003
          GOTO      CHKCTY92 IF EQUAL
.
          MATCH     SP70,OTTXS003
          IF        !@EQUAL
            MOVE      OTTXS003,SERVPROG
            REP       UPPLOW,SERVPROG
            PACK      KEY13,SERVPROG,OTTXS004,OTTXS005,SP70
            CALL      RAWBTP1
            BRANCH    OVRCD,CHKCTY93
          ENDIF
.
          MATCH     SP70,OTTXS006
          IF        !@EQUAL
            MOVE      OTTXS006,SERVPROG
            REP       UPPLOW,SERVPROG
            PACK      KEY13,SERVPROG,OTTXS007,OTTXS008,SP70
            CALL      RAWBTP1
            BRANCH    OVRCD,CHKCTY94
          ENDIF
.
          GOTO      CHKCTY98
.
CHKCTY90  MOVE      "Clinic Type is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCTY99
.
CHKCTY91  MOVE      "Clinic Type Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCTY99
.
CHKCTY92  MOVE      "Group Code is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCTY99
.
CHKCTY93  MOVE      "Invalid Booking Screen!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCTY99
.
CHKCTY94  MOVE      "Invalid Attendance Screen!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCTY99
.
CHKCTY98  MOVE      ZERO,EXIT
.
CHKCTY99  RETURN
.------------------------------------------------------------
. Outpatient Clinic Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
OUTCLI00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTCLI40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OUTCLI10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OUTCLI20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTCLI30 IF EQUAL
.
          GOTO      OUTCLI93
.
.         ************ ADD FORMACTION **************           
. For some reason this was reading INDEX 2 don't know wy so chaged to read
. INDEX 1 with full key....
.
OUTCLI10  CALL      CHKCLI00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,OUTCLI99
.
          PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70  * Duplicate Clinics ?
          CALL      RDCLIA1
          COMPARE   ZERO,OVRCD
          GOTO      OUTCLI92 IF EQUAL
.          
          CALL      CLISAV00      * Moves input variables to file variables
          CALL      WRCLIA1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      OUTCLI99
.
.         ************ UPDATE FORMACTION ************                      
.
OUTCLI20  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70  
          CALL      RDCLIA1
          BRANCH    OVRCD,OUTCLI91
          CALL      CHKCLI00      * Checks mandatory fields
          BRANCH    EXIT,OUTCLI99
          CALL      CLISAV00      * Moves input variables to file variables
          CALL      UPCLIA1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      OUTCLI99
.
.         ************ DELETE FORMACTION **********
.
OUTCLI30  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70   
          CALL      RDCLIA1
          BRANCH    OVRCD,OUTCLI91
.
          CALL      CHKCNT00    * Count outcliaf records for this Clinic Id.
          IF        CLICOUNT > 1
            GOTO      OUTCLI35  * Not last record, delete without further checks
          ENDIF
.
          CALL      CHKSCH00    * Check if any schedule exist if Y no delete
          BRANCH    EXIT,OUTCLI99
.
          CALL      CHKLVE00    * Check if any Leave Detes exist if Y no delete
          BRANCH    EXIT,OUTCLI99
.
OUTCLI35  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70
          CALL      DECLIA1       * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      OUTCLI99
.
.         ************ DISPLAY FORMACTION **********
.
OUTCLI40  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70 
          CALL      RDCLIA1
          IF        OVRCD=1
            CALL      CLRCLI00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Leave Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTCLI99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTCLI99
.
OUTCLI91  MOVE      "Clinic does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCLI99
.
OUTCLI92  MOVE      "Clinic and effective date already exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCLI99
.
OUTCLI93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCLI99
.
OUTCLI99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRCLI00  MOVE      SP70,OCASITE   
          MOVE      SP70,OCACLIN   
          MOVE      SP70,OCADOCT   
          MOVE      SP70,OCADESC   
          MOVE      SP70,OCACCONS  
          MOVE      SP70,OTCLIACT  
          MOVE      SP70,OCASPARE         
.
CLRCLI99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
CLISAV00  MOVE      WBSESIT,OCASITE
          MOVE      OTCLI001,OCACLIN
          MOVE      OTCLI002,OCADOCT
          MOVE      OTCLI003,OCADESC
          MOVE      OTCLI004,OCACCONS
.
          MATCH     "2",OTCLI005
          IF        @EQUAL 
            MOVE      "0",OTCLIACT
          ELSE   
            MOVE      "1",OTCLIACT
          ENDIF
.
          MOVE      SP70,OCASPARE         
.
          MOVE      OTCLI006,OCADATE
.
CLISAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields and checks for blank
.------------------------------------------------------------------
CHKCLI00  RESET     OTCLI001
          MATCH     SP70,OTCLI001
          GOTO      CHKCLI90 IF EQUAL
.
.          MATCH     "A",UPDTTYPE
.          IF        !@EQUAL
.            RESET     OTCLI003
.            MATCH     SP70,OTCLI003
.            GOTO      CHKCLI91 IF EQUAL
.          ENDIF
.
          GOTO      CHKCLI98
.
CHKCLI90  MOVE      "Clinic is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCLI99
.
CHKCLI91  MOVE      "Clinic Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCLI99
.
CHKCLI98  MOVE      ZERO,EXIT
CHKCLI99  RETURN
.------------------------------------------------------------
.                     CHKCNT00
.   Counts the number of records on the Clinic file (outcliaf)
.   with the given Clinic Id.
.                                         called by: OUTCLI00 
.------------------------------------------------------------
CHKCNT00  MOVE      ZERO,CLICOUNT
          PACK      KEY20,WBSESIT,OTCLI001,SP70
          CALL      RDSCLIA1 
CHKCNT10  CALL      RDKCLIA1
          BRANCH    OVRCD,CHKCNT99
          MATCH     WBSESIT,OCASITE
          GOTO      CHKCNT99 IF NOT EQUAL
          MATCH     OTCLI001,OCACLIN
          GOTO      CHKCNT99 IF NOT EQUAL
          ADD       ONE,CLICOUNT
          GOTO      CHKCNT10
.
CHKCNT99  RETURN
.------------------------------------------------------------
.                     CHKSCH00
.   Checks Clinic Master File A for records if yes cannot
.   perform delete on Clinic
.                                         called by: OUTCLI00 
.------------------------------------------------------------
CHKSCH00  PACK      KEY18,WBSESIT,OTCLI001,SP70
          CALL      RDSMASA1
          CALL      RDKMASA1
          BRANCH    OVRCD,CHKSCH98
.
          MATCH     OTCLI001,OMACLIN
          GOTO      CHKSCH90 IF EQUAL 
.
          GOTO      CHKSCH98   * No Record Found 
.
CHKSCH90  MOVE      "Cannot Perform Delete as Clinic Master Exists!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKSCH99
.
CHKSCH98  MOVE      ZERO,EXIT
CHKSCH99  RETURN
.------------------------------------------------------------
.                     CHKLVE00
.   Checks Clinic Clinic Leave file for records if yes cannot
.   perform delete on Clinic
.                                         called by: OUTCLI00 
.------------------------------------------------------------
CHKLVE00  PACK      KEY20,WBSESIT,OTCLI001,SP70
          CALL      RSOTCLV1
          CALL      RKOTCLV1
          BRANCH    OVRCD,CHKLVE98
.
          MATCH     WBSESIT,OTCVSITE
          GOTO      CHKLVE98 IF NOT EQUAL 
.
          MATCH     OTCLI001,OTCVCLIN
          GOTO      CHKLVE90 IF EQUAL 
.
          GOTO      CHKLVE98   * No Record Found 
.
CHKLVE90  MOVE      "Cannot Perform Delete as Clinic Leave Exists!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKLVE99
.
CHKLVE98  MOVE      ZERO,EXIT
CHKLVE99  RETURN
.------------------------------------------------------------
. Outpatient Clinic Leave Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
OUTCLV00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTCLV40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OUTCLV10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OUTCLV20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTCLV30 IF EQUAL
.
          GOTO      OUTCLV93
.
.         ************ ADD FORMACTION **********
.
OUTCLV10  CALL      CHKCLV00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,OUTCLV99
.
          PACK      KEY20,WBSESIT,OTCLI001,OTCLV001,SP70   * ADD FORMACTION
          CALL      RDOTCLV1
          COMPARE   ZERO,OVRCD
          GOTO      OUTCLV92 IF EQUAL
.
          MATCH     OTCLI006,OTCLV001       * HPS-ODC Code Added
          GOTO      OUTCLV90 IF LESS        * HPS-ODC Code Added
.
          CALL      CLVSAV00      * Moves input variables to file variables
          CALL      WROTCLV1      * Writes away the data
.
          CALL      CLSES000      * Delete session if on leave
          CALL      CLMA0000
.
          MOVE      ZERO,EXIT
          GOTO      OUTCLV99
.
.         ************ UPDATE FORMACTION **********
.
OUTCLV20  PACK      KEY20,WBSESIT,OTCLI001,OTCLV001,SP70   * UPDATE FORMACTION
          CALL      RDOTCLV1
          BRANCH    OVRCD,OUTCLV91
.
          CALL      CHKCLV00      * Checks mandatory fields
          BRANCH    EXIT,OUTCLV99
.
          CALL      CLVSAV00      * Moves input variables to file variables
          CALL      UPOTCLV1      * Writes away the data
.
          CALL      CLSES000      * Delete session if on leave
          CALL      CLMA0000
.
          MOVE      ZERO,EXIT
          GOTO      OUTCLV99
.
.         ************ DELETE FORMACTION **********
.
OUTCLV30  PACK      KEY20,WBSESIT,OTCLI001,OTCLV001,SP70    * DELETE FORMACTION
          CALL      RDOTCLV1
          BRANCH    OVRCD,OUTCLV91
.
          CALL      DEOTCLV1      * Deletes the data
          CALL      CLMA0000
.
          MOVE      ZERO,EXIT
          GOTO      OUTCLV99
.
.         ************ DISPLAY FORMACTION **********
.
OUTCLV40  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70   
          CALL      RDCLIA1
          BRANCH    OVRCD,OUTCLV94         
.
          PACK      KEY20,WBSESIT,OTCLI001,OTCLV001,SP70 
          CALL      RDOTCLV1
          IF        OVRCD=1
            CALL      CLRCLV00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Leave Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTCLV99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTCLV99
.                                           * HPS-ODC Code Start for Def.7(Off)
OUTCLV90  MOVE      "From Date cannot be < Effective Date",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCLV99
.                                           * HPS-ODC Code End for Def.7(Off)
OUTCLV91  MOVE      "Clinic Leave does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCLV99
.
OUTCLV92  MOVE      "Clinic Leave exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCLV99
.
OUTCLV93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCLV99
.
OUTCLV94  MOVE      "Invalid Clinic.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCLV99
.
OUTCLV99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRCLV00  MOVE      SP70,OTCVCLIN  
          MOVE      SP70,OTCVFDTE  
          MOVE      SP70,OTCVTDTE  
          MOVE      SP70,OTCVREAS  
          MOVE      SP70,OTCVLAST  
          MOVE      SP70,OTCVSITE  
          MOVE      SP70,OTCVSPAR         
.
CLRCLV99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
CLVSAV00  MOVE      OTCLI001,KEY6    * Clinic ID
          SQUEEZE   KEY6
          MOVE      KEY6,OTCVCLIN
          PACK      OTCVCLIN,OTCVCLIN,SP70
.
          MOVE      OTCLV001,KEY8    * From Date
          SQUEEZE   KEY8
          MOVE      KEY8,OTCVFDTE 
.
CLVSAV10  MOVE      OTCLV002,KEY8    * To Date
          SQUEEZE   KEY8
          MOVE      KEY8,OTCVTDTE 
.
          MOVE      OTCLV003,OTCVREAS  * Reason for Leave 
          CALL      IBACLOCK
          PACK      OTCVLAST,CCC,CYY,CMM,CDD   * Date Last Modified
          REP       " 0",OTCVLAST 
          MOVE      SP70,OTCVSPAR        
          MOVE      WBSESIT,OTCVSITE
.
CLVSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields and checks for blank
.------------------------------------------------------------------
CHKCLV00  RESET     OTCLV001
          MATCH     SP70,OTCLV001
          GOTO      CHKCLV90 IF EQUAL
.
          RESET     OTCLV002
          MATCH     SP70,OTCLV002
          GOTO      CHKCLV91 IF EQUAL
.
          RESET     OTCLV003
          MATCH     SP70,OTCLV003
          GOTO      CHKCLV92 IF EQUAL
.
          RESET     OTCLV001
          RESET     OTCLV002
          MATCH     OTCLV001,OTCLV002
          GOTO      CHKCLV93 IF LESS
.
          GOTO      CHKCLV98
.
CHKCLV90  MOVE      "Clinic Leave From Date is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCLV99
.
CHKCLV91  MOVE      "Clinic Leave To Date is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCLV99
.
CHKCLV92  MOVE      "Reason for Leave is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCLV99
.
CHKCLV93  MOVE      "To Date Can't be Prior to From Date",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCLV99
.
CHKCLV98  MOVE      ZERO,EXIT
CHKCLV99  RETURN
.------------------------------------------------------------
. Outpatient Clinic Schedule Maintenance: Display,Add,Update,Delete
. HPS01 Copy and Suspension newly included with addition fields
.------------------------------------------------------------
OUTMAS00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTMAS40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OUTMAS10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OUTMAS20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTMAS30 IF EQUAL
.
          MATCH     "C",UPDTTYPE     * Copy formaction
          GOTO      OUTMAS50 IF EQUAL
.
          MATCH     "S",UPDTTYPE     * Suspend formaction
          GOTO      OUTMAS60 IF EQUAL
.
          MATCH     "R",UPDTTYPE     * Reinstate suspended clinic (Unsuspend)
          GOTO      OUTMAS70 IF EQUAL
.
          GOTO      OUTMAS93
.
.         ************ ADD FORMACTION **********
.
OUTMAS10  CALL      CHKMAS00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,OUTMAS99
.
          CALL      CLRMAS00    * Clear all the file variables
.
          PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70   
          CALL      RDMASA1
          COMPARE   ZERO,OVRCD
          GOTO      OUTMAS92 IF EQUAL
          CALL      CHKTME00  * Check Start, End, Finish Times
          BRANCH    EXIT,OUTMAS99
.
          MOVE      SP70,OMADATE        * LAST SESSION DATE OPENED
.
          CALL      MASSAV00      * Moves input variables to file variables
          CALL      WRMASA1       * Writes away the data
          MOVE      "A",OTCMACTN    * action flag for HL7
          MOVE      FOUR,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIOCM        * send HL7 message for Clinic Master Add
.
          PACK      REDIRECT,REDIRECT,SP70,SP70
          STRIP     REDIRECT
          ENDSET    REDIRECT
          APPEND    DOMADAY,REDIRECT
          APPEND    "&otmas002=",REDIRECT
          APPEND    OMASTART,REDIRECT
          RESET     REDIRECT 
          MOVE      ZERO,EXIT
          GOTO      OUTMAS99
.
.         ************ UPDATE FORMACTION ********
.
OUTMAS20  PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70   
          CALL      RDMASA1
          BRANCH    OVRCD,OUTMAS91
.
          CALL      CHKMAS00      * Checks mandatory fields
          BRANCH    EXIT,OUTMAS99
.
          CALL      RLOTMAS1      * Readlock, no unlock needed 
          BRANCH    OVRCD,OUTMAS91,OUTMAS90
.
          MOVE      OMACIND,SAVINDC  * save original clinic indicator
.
          CALL      CHKDAT00      * Check Close date range with templates
          BRANCH    EXIT,OUTMAB99
.
          CALL      MASSAV00      * Moves input variables to file variables
          CALL      UPMASA1       * Writes away the data
          CALL      UUOTMAS1      * Readlock, no unlock needed 
          MOVE      "U",OTCMACTN    * action flag for HL7
          MOVE      FIVE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIOCM        * send HL7 message for Clinic Master Upd
.
          MOVE      ZERO,EXIT
          GOTO      OUTMAS99
.
.         *********** DELETE FORMACTION *********
.
OUTMAS30  PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70    
          CALL      RDMASA1
          BRANCH    OVRCD,OUTMAS91
.
          CALL      CHKSES00   * Check for Session Bookings and Delete
          BRANCH    EXIT,OUTMAS95   * A session is booked no delete
.          
          PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70    
          CALL      DEMASA1      * Deletes the data
          MOVE      "D",OTCMACTN    * action flag for HL7
          MOVE      SIX,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIOCM        * send HL7 message for Clinic Master Del
.
          CALL      DELH0000      * Delete all template header records
.
          MOVE      ZERO,EXIT
          GOTO      OUTMAS99
.
.         ************ DISPLAY FORMACTION ********
.
OUTMAS40  CALL      CURPER00                * Display Routine
          CALL      CALCDT00   * Calculate Next and Last Period Dates
. 
          PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70   
          CALL      RDCLIA1
          IF        OVRCD=1
.               clear file          
          ENDIF
          MOVE      OCACLIN,CLINICID
.
          PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70 
          CALL      RDMASA1
          IF        OVRCD=1
            CALL      CLRMAS00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Master Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTMAS99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.----------------------------------------------------------------------
. Copy Form Action
.----------------------------------------------------------------------
OUTMAS50  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70
          CALL      RDCLIA1
          BRANCH    OVRCD,OUTMAS94 
.
          PACK      COPYTO01,COPYTO01,SP70
          PACK      COPYTO02,COPYTO02,SP70
          PACK      KEY20,WBSESIT,COPYTO01,Z70
          CALL      RDSCLIA1
          CALL      RDPCLIA1
          BRANCH    OVRCD,OUTMAS96
          MATCH     COPYTO01,OCACLIN
          GOTO      OUTMAS96 IF NOT EQUAL          
.
          CALL      MANMAS00         * Check for mandatory fields
          BRANCH    EXIT,OUTMAS99   
.
          PACK      KEY18,WBSESIT,COPYTO01,COPYTO02,OTMAS002,SP70
          CALL      RDMASA1
          COMPARE   ZERO,OVRCD       
          GOTO      OUTMAS97 IF EQUAL
.
          PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RLOTMAS1
          BRANCH    OVRCD,OUTMAS98,OUTMAS90
.
          MOVE      KEY6,OMACLIN 
          MOVE      COPYTO02,OMADAY
          MOVE      COPYTO03,OMATYP
          PACK      KEY18,WBSESIT,COPYTO01,COPYTO02,OTMAS002,SP70
          CALL      RDMASA1
          IF        OVRCD=1
            MOVE      WBSESIT,OMASITE
            MOVE      COPYTO01,OMACLIN
            MOVE      COPYTO01,OTMACLSE
            MOVE      COPYTO02,OMADAY
            MOVE      OTMAS002,OMASTART 
.. Reported as Defect 02.12.2001
..            MOVE      COPYTO01,OTMACLSE
            MOVE      COPYTO04,OTMADTCO
.
            MOVE      SP70,OMADATE          * Clear last session opened date
.
            CALL      WRMASA1             
            MOVE      "A",OTCMACTN    * action flag for HL7
            MOVE      SEVEN,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIOCM        * send HL7 message for Clinic Master Add
          ELSE
            GOTO      OUTMAS87 
          ENDIF
.
          CALL      UUOTMAS1
.
          COMPARE   ONE,COPYTEMP
          GOTO      OUTMAS59 IF NOT EQUAL
.
          CALL      COPT0000                * Copy template headers
.
OUTMAS59  MOVE      ZERO,EXIT
          GOTO      OUTMAS99
.
.           ********** Suspend Formaction **************
.
OUTMAS60  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70
          CALL      RDCLIA1
          BRANCH    OVRCD,OUTMAS94   
.
          CALL      SUSMAS00           * Validate the dates
          BRANCH    EXIT,OUTMAS99
.
          PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RLOTMAS1
          BRANCH    OVRCD,OUTMAS89,OUTMAS90
.
          CALL      SUSPEN00
.
          CALL      UUOTMAS1
          MOVE      ZERO,EXIT
          GOTO      OUTMAS99  
.
.           ********** Reinstate Suspended Clinic (Unsuspend) **************
.
OUTMAS70  CALL      UNSP0000                     * Unsuspend session
          BRANCH    EXIT,OUTMAS99
.
          MOVE      ZERO,EXIT
          GOTO      OUTMAS99
.
OUTMAS85  MOVE      "Ran out of slot numbers. Max slot number is 890",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.
OUTMAS86  MOVE      "Unsuspend Limit Reached",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.
OUTMAS87  MOVE      "Record already exists ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.
OUTMAS88  MOVE      "Record already exists in Suspend File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.
OUTMAS89  MOVE      "Record doesn't exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99 
.
OUTMAS90  MOVE      "Record is Locked",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99 
.************************************************************************
. HPS01 ENDS
.************************************************************************
OUTMAS91  MOVE      "Clinic Master does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.
OUTMAS92  MOVE      "Clinic Master exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.
OUTMAS93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.
OUTMAS94  MOVE      "Invalid Clinic.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.
OUTMAS95  MOVE      "Cannot perform delete as Sessions have been ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "booked!",WEBTITLE 
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.************************************************************************
. HPS01 STARTS
.***********************************************************************
OUTMAS96  MOVE      "Copy to Clinic must exit",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.
OUTMAS97  MOVE      "Copy to record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
.
OUTMAS98  MOVE      "Copy from record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAS99
OUTMAS99  RETURN
.------------------------------------------------------------
. Suspend Sessions
.------------------------------------------------------------
SUSPEN00  PACK      KEY26,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SUSPEN01,SP70
          CALL      RDSESA3
          COMPARE   ZERO,OVRCD
          GOTO      SUSPEN20 IF EQUAL
.
SUSPEN10  CALL      RDKSESA3
          BRANCH    OVRCD,SUSPEN99
          MATCH     WBSESIT,OSESITE
          GOTO      SUSPEN99 IF NOT EQUAL
          MATCH     OTCLI001,OSECLIN
          GOTO      SUSPEN99 IF NOT EQUAL
          MATCH     OTMAS001,DOSEDAY
          GOTO      SUSPEN99 IF NOT EQUAL
          MATCH     OTMAS002,OSESTRT
          GOTO      SUSPEN99 IF NOT EQUAL
          MATCH     OSEDATE,SUSPEN02
          GOTO      SUSPEN99 IF LESS
.
SUSPEN20  PACK      KEY24,WBSESIT,OTCLI001,DOSEDAY,Z70
          CALL      RSOTMSP1
          CALL      RPOTMSP1
          BRANCH    OVRCD,SUSPEN30
          MATCH     WBSESIT,OTMSSITE
          GOTO      SUSPEN30 IF NOT EQUAL
          MATCH     OTCLI001,OTMSCLIN
          GOTO      SUSPEN30 IF NOT EQUAL
          MATCH     DOSEDAY,OTMSDOWK
          GOTO      SUSPEN30 IF NOT EQUAL
          MOVE      OTMSSUSP,F3
          ADD       ONE,F3
.
          MOVE      OTCLI001,SUSCLIID
          CALL      VALSUS00
          IF        EXIT = 1
            MOVE      ZERO,EXIT
            GOTO      SUSPEN10         * Session already suspended
          ENDIF
.
          GOTO      SUSPEN40
.
SUSPEN30  MOVE      ONE,F3
.
SUSPEN40  MOVE      WBSESIT,OTMSSITE
          MOVE      OTCLI001,OTMSCLIN
          MOVE      OSEDAY,OTMSDOWK
          MOVE      OSESTRT,OTMSSTIM
          MOVE      OSEDATE,OTMSFDAT          * Suspend From date = session date
          MOVE      OSEDATE,OTMSTDAT          * Suspend To date = session date
          MOVE      SUSPEN01,OTMSRFDT         * Suspend Range From date
          MOVE      SUSPEN02,OTMSRTDT         * Suspend Range To date
          MOVE      SUSPEN03,OTMSREAS         * Suspend Reason
          PACK      OTMSEDAT,CCC,CYY,CMM,CDD  * Get Current Date
          REP       " 0",OTMSEDAT
          CLOCK     TIME,OTMSETIM             * Get Current Time
          MOVE      WBSEUID,OTMSEUID          * Set user id

          MOVE      F3,OTMSSUSP
          PACK      KEY24,OTMSSITE,OTMSCLIN,OTMSDOWK,OTMSSUSP,OTMSFDAT
          CALL      RDOTMSP1
          IF        OVRCD=0
            ADD       ONE,F3
            GOTO      SUSPEN40
          ENDIF
          CALL      WROTMSP1
.
          PACK      SESSKEYS,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
          CALL      SLTSUS00
.
          GOTO      SUSPEN10
.
SUSPEN99  RETURN
.--------------------------------------------------------------------
. Change the Status(DOBASTAT) in the Outboaaf table
.--------------------------------------------------------------------
SLTSUS00  PACK      KEY28,SESSKEYS,SP70
          CALL      RDSBOKA1
SLTSUS10  CALL      RDKBOKA1
          BRANCH    OVRCD,SLTSUS99
          PACK      KEY25,OBASITE,OBACLIN,OBADATE,OBASTRT
          MATCH     SESSKEYS,KEY25
          GOTO      SLTSUS99 IF NOT EQUAL   * different sessio
.
          IF       (OBASTAT=1|OBASTAT=0)
            PACK      KEY28,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT
            CALL      RLOTBOA1
            MOVE      "6",OBASTAT
            CALL      UPBOKA1
            CALL      UUOTBOA1
            GOTO      SLTSUS10
          ENDIF
.
          COMPARE   FOUR,OBASTAT
          GOTO      SLTSUS10 IF EQUAL
          COMPARE   FIVE,OBASTAT
          GOTO      SLTSUS10 IF EQUAL
.
          GOTO      SLTSUS10
.
SLTSUS99  RETURN
.-----------------------------------------------------------
. Initialize's file data : Clinic Master File A  
.-----------------------------------------------------------
CLRMAS00  MOVE      SP70,OMASITE      
          MOVE      SP70,OMACLIN 
          MOVE      SP70,OMATYP  
          MOVE      SP70,DOMADAY  
          MOVE      ZERO,OMADAY  
          MOVE      SP70,OMASTART 
          MOVE      SP70,OMAFIN  
          MOVE      SP70,OMAEND  
          MOVE      SP70,OMACIND 
          MOVE      SP70,OMAREG  
          MOVE      SP70,OMAKDOC 
          MOVE      SP70,OMACOM1 
          MOVE      SP70,OMACOM2 
          MOVE      ZERO,OMADURN   
          MOVE      ZERO,OMANEWSL  
          MOVE      ZERO,OMASPCSL  
          MOVE      ZERO,OMASTAT  
          MOVE      SP70,OMAFREQM 
          MOVE      SP70,DOMASEQ  
          MOVE      ZERO,OMASEQ  
          MOVE      SP70,OMALOCK  
          MOVE      ZERO,OMAFREQF 
          MOVE      SP70,OMAFREQY 
          MOVE      SP70,OMADATE  
          MOVE      SP70,OTMAAVIS 
          MOVE      SP70,OTMASTVT 
          MOVE      SP70,OTMASUPX 
          MOVE      SP70,OTMARUSE 
          MOVE      SP70,OTMADCMB 
          MOVE      SP70,OTMAIXTA 
          MOVE      SP70,OTMADEFD 
          MOVE      SP70,OTMAUATR 
          MOVE      ZERO,OTMADDNA 
          MOVE      ZERO,OTMANDRP 
          MOVE      ZERO,OTMALPTR 
          MOVE      ZERO,OTMALGPD 
          MOVE      ZERO,OTMALPTD 
          MOVE      ZERO,OTMABKLT  
          MOVE      ZERO,OTMARALT 
          MOVE      ZERO,OTMARSLT 
          MOVE      SP70,OTMACLSE  
          MOVE      SP70,OTMAHOSP  
          MOVE      SP70,OTMACLOC  
          MOVE      SP70,OTMAWDCL  
          MOVE      SP70,OTMAWARD  
          MOVE      SP70,OTMALTYP 
          MOVE      SP70,OTMADFSL  
          MOVE      SP70,OTMADFGN  
          MOVE      SP70,OTMAGRPS  
          MOVE      SP70,DOTMASOV  
          MOVE      ZERO,OTMASOVB 
          MOVE      SP70,DOTMANOO 
          MOVE      ZERO,OTMANOOB 
          MOVE      SP70,DOTMASLF
          MOVE      ZERO,OTMASLFB
          MOVE      SP70,DOTMASLR  
          MOVE      ZERO,OTMASLRV 
          MOVE      SP70,OTMASBKL
          MOVE      SP70,OTMASAPL 
          MOVE      SP70,OTMASPMM 
          MOVE      SP70,OTMASGPM 
          MOVE      SP70,DOTMALPP 
          MOVE      ZERO,OTMALPPC
          MOVE      SP70,DOTMASRL 
          MOVE      ZERO,OTMASRLH
          MOVE      SP70,DOTMANCO 
          MOVE      ZERO,OTMANCOC
          MOVE      SP70,OTMALOCN
          MOVE      SP70,OTMADTCO 
          MOVE      SP70,OTMADTCC 
          MOVE      SP70,OTMAINS1 
          MOVE      SP70,OTMAINS2
          MOVE      SP70,OTMAINS3
          MOVE      SP70,OTMALSER
          MOVE      SP70,OTMAUMCI
          MOVE      SP70,OTMAPROV
          MOVE      SP70,OTMAMBST
          MOVE      SP70,OTMAROOM
          MOVE      SP70,OTMALEDG
          MOVE      SP70,OTMACCTR
          MOVE      SP70,OTMAMPRC
          MOVE      SP70,OTMAMBSA
          MOVE      SP70,OTMALDNA
          MOVE      SP70,OTMAADEP
          MOVE      SP70,OTMACENC
          MOVE      SP70,OTMACCAR
          MOVE      SP70,OTMACTRN
          MOVE      SP70,OTMADPSL
          MOVE      SP70,OTMACPMI
          MOVE      SP70,OTMACPAG
          MOVE      SP70,OTMAXPUL
          MOVE      SP70,OTMACTEL
          MOVE      SP70,OTMANMDS
          MOVE      SP70,OTMACART
          MOVE      SP70,OTMASRVD
          MOVE      SP70,OTMACLHR
          MOVE      SP70,OTMAMLTD
          MOVE      SP70,OTMAMREF
          MOVE      SP70,OTMATCOD
          MOVE      SP70,OTMAHCLI
          MOVE      SP70,OTMAHCAI
          MOVE      SP70,OTMAAOPN
          MOVE      SP70,OTMAAOFR
          MOVE      SP70,OTMAAOWM
          MOVE      SP70,OTMAAOWA
          MOVE      SP70,OTMAHCP1
          MOVE      SP70,OTMAHCP2
          MOVE      SP70,OTMAHCP3
          MOVE      SP70,OTMAHCP4
          MOVE      SP70,OTMAPCOD
          MOVE      SP70,OTMASPAR
.
CLRMAS99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
MASSAV00  MOVE      WBSESIT,OMASITE    * Site Code 

          MOVE      OTCLI001,KEY6      * Clinic ID
          SQUEEZE   KEY6
          MOVE      KEY6,OMACLIN 
.
          MATCH     Z70,OTMAS001
          IF        !@EQUAL
            MOVE      OTMAS001,OMADAY    * Day Indicator
          ENDIF
          MATCH     Z70,OTMAS002
          IF        !@EQUAL
            MOVE      OTMAS002,OMASTART  * Start Time
          ENDIF
          MATCH     Z70,OTMAS003
          IF        !@EQUAL
            MOVE      OTMAS003,OMAFIN    * FINISH BOOKING TIME   (HH:MM)
          ENDIF
          MATCH     Z70,OTMAS004
          IF        !@EQUAL
            MOVE      OTMAS004,OMAEND    * END SESSION TIME      (HH:MM)
          ENDIF
          MATCH     Z70,OTMAS005
          IF        !@EQUAL
            MOVE      OTMAS005,OMATYP    * CLINIC TYPE
          ENDIF
          MATCH     Z70,OTMAS006
          IF        !@EQUAL
            MOVE      OTMAS006,OMACIND   * CLINIC INDICATOR (CI) M=MEDICAL
          ENDIF
.
          MATCH     Z70,OTMAS007      * REGISTRAR'S CLINIC(Y/N)
          IF        @EQUAL 
            MOVE      "N",OMAREG
          ELSE
            MOVE      OTMAS007,OMAREG 
          ENDIF
.
          MATCH     Z70,OTMAS008      * ACCEPT DOCTOR CODE (Y/N)
          IF        @EQUAL
            MOVE      "N",OMAKDOC
          ELSE
            MOVE      OTMAS008,OMAKDOC    
          ENDIF
.
          MATCH     Z70,OTMAS009
          IF        !@EQUAL
            MOVE      OTMAS009,OMACOM1    * COMMENTS LINE 1
          ENDIF
          MATCH     Z70,OTMAS010
          IF        !@EQUAL
            MOVE      OTMAS010,OMACOM2    * COMMENTS LINE 2
          ENDIF
          MATCH     Z70,OTMAS011
          IF        !@EQUAL
            MOVE      OTMAS011,OMADURN    * SLOT DURATION (MINS)
          ENDIF
          MATCH     Z70,OTMAS012
          IF        !@EQUAL
            MOVE      OTMAS012,OMANEWSL   * NO. OF SLOTS FOR A NEW PATIENT
          ENDIF
          MATCH     Z70,OTMAS013
          IF        !@EQUAL
            MOVE      OTMAS013,OMASPCSL   * NO. OF SLOTS FOR A SPECIAL PATIENT
          ENDIF
.
          MATCH     Z70,OTMAS014
          IF        @EQUAL
            MOVE      "1",OMASTAT         * STATUS   1 = INACTIVE
          ELSE
            MOVE      OTMAS014,OMASTAT
          ENDIF
.
          MOVE      SP70,OMAFREQM       * SESSION FREQUENCY  (MONTHLY)
          MOVE      OTMAS015,OMASEQ     * REPORT SEQUENCE
          MOVE      SP70,OMALOCK        * PORT NO. FOR LOCKING
          MOVE      ZERO,OMAFREQF       * SESSION FREQUENCY FLAG
          MOVE      SP70,OMAFREQY       * SESSION FREQUENCY  (YEARLY)
.
          MATCH     Z70,OTMAS016       * Allocate visit type when booking ?
          IF        @EQUAL
            MOVE      "N",OTMAAVIS
          ELSE
            MOVE      OTMAS016,OTMAAVIS   
          ENDIF
.
          MATCH     Z70,OTMAS017       * Slot times visit type controlled ?
          IF        @EQUAL
            MOVE      "N",OTMASTVT
          ELSE
            MOVE      OTMAS017,OTMASTVT   
          ENDIF
.
          MATCH     Z70,OTMAS018       * Suppress extended slots on displays ?
          IF        @EQUAL
            MOVE      "N",OTMASUPX
          ELSE
            MOVE      OTMAS018,OTMASUPX   
          ENDIF
.
          MATCH     Z70,OTMAS019       * Using RUS Automated Extract
          IF        @EQUAL
            MOVE      "N",OTMARUSE
          ELSE
            MOVE      OTMAS019,OTMARUSE  
          ENDIF 
.
          MATCH     Z70,OTMAS020       * Display Comments at Booking Time
          IF        @EQUAL
            MOVE      "0",OTMADCMB
          ELSE
            MOVE      OTMAS020,OTMADCMB   
          ENDIF
.
          MATCH     Z70,OTMAS021       * Input EXTRA screen when Attending ?
          IF        @EQUAL
            MOVE      "N",OTMAIXTA
          ELSE
            MOVE      OTMAS021,OTMAIXTA   
          ENDIF
.
          MATCH     Z70,OTMAS022       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            MOVE      OTMAS022,OTMADEFD   * Default Doctor Code
          ENDIF
.
          MATCH     Z70,OTMAS023       * Using Attendance Register (Y/N) ?
          IF        @EQUAL
            MOVE      "0",OTMAUATR
          ELSE
            MOVE      OTMAS023,OTMAUATR   
          ENDIF
.
          MATCH     Z70,OTMAS024       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            MOVE      OTMAS024,OTMADDNA   * Disch. pat. after x no. of days
          ENDIF
          MATCH     Z70,OTMAS025       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            MOVE      OTMAS025,OTMANDRP   * No. of days for reappointment
          ENDIF
          MATCH     Z70,OTMAS026       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            IF        @EOS
              MOVE      ZERO,OTMALPTR                                  *I-57627
            ELSE
              MOVE      OTMAS026,OTMALPTR   * Letter to pat. on reappointment
            ENDIF
          ENDIF
          MATCH     Z70,OTMAS027       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            IF        @EOS
              MOVE      ZERO,OTMALGPD                                  *I-57627
            ELSE
              MOVE      OTMAS027,OTMALGPD   * Letter to GP on discharge
            ENDIF
          ENDIF
          MATCH     Z70,OTMAS028       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            IF        @EOS
              MOVE      ZERO,OTMALPTD                                  *I-57627
            ELSE
              MOVE      OTMAS028,OTMALPTD   * Letter to pat. on discharge
            ENDIF
          ENDIF
          MATCH     Z70,OTMAS029       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            IF        @EOS
              MOVE      ZERO,OTMABKLT                                  *I-57627
            ELSE
              MOVE      OTMAS029,OTMABKLT   * Standard Booking Letter
            ENDIF
          ENDIF
          MATCH     Z70,OTMAS030       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            IF        @EOS
              MOVE      ZERO,OTMARALT                                  *I-57627
            ELSE
              MOVE      OTMAS030,OTMARALT   * Standard Reappointment Letter
            ENDIF
          ENDIF
          MATCH     Z70,OTMAS031       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            IF        @EOS
              MOVE      ZERO,OTMARSLT                                  *I-57627
            ELSE
              MOVE      OTMAS031,OTMARSLT   * Standard Reschedule Letter (Patient)
            ENDIF
          ENDIF
          MATCH     Z70,OTMAS032       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            MOVE      OTMAS032,OTMACLSE   * Clinic Session
          ENDIF
          MATCH     Z70,OTMAS033       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            MOVE      OTMAS033,OTMAHOSP   * Hospital code
          ENDIF
          MATCH     Z70,OTMAS034       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            MOVE      OTMAS034,OTMACLOC   * Clinic Location
          ENDIF
.
          MATCH     Z70,OTMAS035       * Ward Clinic ? Y = yes , N = no
          IF        @EQUAL
            MOVE      "N",OTMAWDCL
          ELSE
            MOVE      OTMAS035,OTMAWDCL   
          ENDIF
.
          MATCH     Z70,OTMAS036       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            MOVE      OTMAS036,OTMAWARD   * Ward code if a ward clinic
          ENDIF
          MATCH     Z70,OTMAS037       * Using Attendance Register (Y/N) ?
          IF        !@EQUAL
            MOVE      OTMAS037,OTMALTYP   * Location Type (Category CT)
          ENDIF
.
          MATCH     Z70,OTMAS038       * Default value for send letter (Y/N)
          IF        @EQUAL
            MOVE      "N",OTMADFSL
          ELSE
            MOVE      OTMAS038,OTMADFSL   
          ENDIF
.
          MATCH     Z70,OTMAS039       * Generate case notes on attendance(Y/N)
          IF        @EQUAL
            MOVE      "N",OTMADFGN
          ELSE
            MOVE      OTMAS039,OTMADFGN   
          ENDIF
.
          MATCH     Z70,OTMAS040       * Group Session O=No 1=Yes 
          IF        @EQUAL
            MOVE      "0",OTMAGRPS
          ELSE
            MOVE      OTMAS040,OTMAGRPS   
          ENDIF
.
          MATCH     Z70,OTMAS041       * Security Level to Overbook 0=No 1=Yes 
          IF        @EQUAL
            MOVE      ZERO,OTMASOVB
          ELSE
            MOVE      OTMAS041,OTMASOVB   
          ENDIF
.
          MATCH     Z70,OTMAS042       * Security Level to Overbook 0=No 1=Yes 
          IF        !@EQUAL
            MOVE      OTMAS042,OTMANOOB   * Number of overbookings allowed
          ENDIF
.
          MATCH     Z70,OTMAS043      * Security Level to Forcebook 0=No 1=Yes
          IF        @EQUAL
            MOVE      ZERO,OTMASLFB
          ELSE
            MOVE      OTMAS043,OTMASLFB   
          ENDIF 
.
          MATCH     Z70,OTMAS044 * Security Level to use Reserved slots 0=N 1=Y
          IF        @EQUAL
            MOVE      ZERO,OTMASLRV
          ELSE
            MOVE      OTMAS044,OTMASLRV   
          ENDIF
.
          MATCH     Z70,OTMAS045
          IF        !@EQUAL
            MOVE      OTMAS045,OTMASBKL * Booking Label Screen ID
          ENDIF
          MATCH     Z70,OTMAS046
          IF        !@EQUAL
            MOVE      OTMAS046,OTMASAPL * Appointment Label Screen ID
          ENDIF
          MATCH     Z70,OTMAS047
          IF        !@EQUAL
            MOVE      OTMAS047,OTMASPMM * PMI Mailing Label Screen ID
          ENDIF
          MATCH     Z70,OTMAS048
          IF        !@EQUAL
            MOVE      OTMAS048,OTMASGPM * G.P. Mailing Label Screen ID
          ENDIF
          MATCH     Z70,OTMAS049
          IF        !@EQUAL
            IF        @EOS
              MOVE      ZERO,OTMALPPC                                  *I-57627
            ELSE
              MOVE      OTMAS049,OTMALPPC * Letter to Patient on Cancellation
            ENDIF
          ENDIF
          MATCH     Z70,OTMAS050
          IF        !@EQUAL
            IF        @EOS
              MOVE      ZERO,OTMASRLH                                  *I-57627
            ELSE
              MOVE      OTMAS050,OTMASRLH * Standard Reschedule Letter (Hospital)
            ENDIF
          ENDIF
.
          MATCH     Z70,OTMAS051       * Non-Consultant Clinic 0=No 1=Yes 
          IF        @EQUAL
            MOVE      ZERO,OTMANCOC
          ELSE
            MOVE      OTMAS051,OTMANCOC   
          ENDIF
.
          MATCH      Z70,OTMAS052
          IF         !@EQUAL
            MOVE       OTMAS052,OTMADTCO              * Date Clinic Created
          ENDIF
.
          MATCH      Z70,OTMAS053
          IF         !@EQUAL
            MOVE       OTMAS053,OTMADTCC              * Date Clinic Closed     
          ENDIF
.
          MATCH      Z70,OTMAS054
          IF         !@EQUAL
            MOVE       OTMAS054,OTMAINS1              * Instruction 1
          ENDIF
          MATCH      Z70,OTMAS055
          IF         !@EQUAL
            MOVE       OTMAS055,OTMAINS2              * Instruction 2
          ENDIF
          MATCH      Z70,OTMAS056
          IF         !@EQUAL
            MOVE       OTMAS056,OTMAINS3              * Instruction 3
          ENDIF
          MATCH      Z70,OTMAS057
          IF         !@EQUAL
            MOVE       OTMAS057,OTMALOCN              * MR Location
          ENDIF
.
          MATCH      Z70,OTMAS058
          IF         !@EQUAL
            MOVE       OTMAS058,OTMALSER              * Series booking letter
          ENDIF
.
          MATCH      Z70,OTMAS059
          IF         @EQUAL
            MOVE       "0",OTMAUMCI
          ELSE
            MOVE       OTMAS059,OTMAUMCI              * Using Medclaims
          ENDIF
.
          MATCH      Z70,OTMAS060
          IF         !@EQUAL
            MOVE       OTMAS060,OTMAPROV              * Provider number
          ENDIF
          MATCH      Z70,OTMAS061
          IF         !@EQUAL
            MOVE       OTMAS061,OTMAMBST              * Default MBS Item
          ENDIF
          MATCH      Z70,OTMAS062
          IF         !@EQUAL
            MOVE       OTMAS062,OTMAROOM              * Room type
          ENDIF
          MATCH      Z70,OTMAS063
          IF         !@EQUAL
            MOVE       OTMAS063,OTMALEDG              * General Ledger
          ENDIF
          MATCH      Z70,OTMAS064
          IF         !@EQUAL
            MOVE       OTMAS064,OTMACCTR              * Cost centre
          ENDIF
.
          MATCH      Z70,OTMAS065
          IF         !@EQUAL
            MOVE       OTMAS065,OTMAMPRC              * Medical Practice
          ENDIF
.
          MATCH      Z70,OTMAS066
          IF         @EQUAL
            MOVE       "0",OTMAMBSA
          ELSE
            MOVE       OTMAS066,OTMAMBSA              * Apply def CMBS items
          ENDIF
.
          MATCH      Z70,OTMAS067
          IF         !@EQUAL
            MOVE       OTMAS067,OTMALDNA              * Non Attendance Letter
          ENDIF
.
          MATCH      Z70,OTMAS068
          IF         !@EQUAL
            MOVE       OTMAS068,OTMAADEP              * A/H Department        
          ENDIF
.
          MATCH      Z70,OTMAS069
          IF         @EQUAL
            MOVE       ZERO,OTMACENC
          ELSE
            MOVE       OTMAS069,OTMACENC              * Collect Enc Details
          ENDIF
.
          MATCH      Z70,OTMAS070
          IF         @EQUAL
            MOVE       ZERO,OTMACCAR
          ELSE
            MOVE       OTMAS070,OTMACCAR              * Collect Carer Details
          ENDIF
.
          MATCH      Z70,OTMAS071
          IF         @EQUAL
            MOVE       ZERO,OTMACTRN
          ELSE
            MOVE       OTMAS071,OTMACTRN              * Collect Transport
          ENDIF
.
          MATCH     Z70,OTMAS072
          IF        !@EQUAL
            MOVE      ZERO,F3
            SQUEEZE   OTMAS072
            MOVE      OTMAS072,F3
            MOVE      F3,OTMADPSL
            RESET     OTMAS072
          ENDIF
.
          MATCH     Z70,OTMAS073
          IF        !@EQUAL
            MOVE      OTMAS073,OTMACPMI
          ELSE
            MOVE      ZERO,OTMACPMI
          ENDIF
.
          MATCH     Z70,OTMAS074
          IF        !@EQUAL
            MOVE      OTMAS074,OTMACPAG
          ELSE
            MOVE      ZERO,OTMACPAG
          ENDIF
.
          MATCH      Z70,OTMAS075
          IF         !@EQUAL
            MOVE       OTMAS075,OTMACTEL              * Clinic Location Phone 
          ENDIF
.
          MATCH      Z70,OTMAS076
          IF         !@EQUAL
            MOVE       OTMAS076,OTMANMDS              * NMDS Code
          ENDIF
.
          MATCH      Z70,OTMAS077
          IF         !@EQUAL
            MOVE       OTMAS077,OTMACART              * Care Type
          ENDIF
.
          MATCH      Z70,OTMAS078
          IF         !@EQUAL
            MOVE       OTMAS078,OTMASRVD              * Service Delivery Mode
          ENDIF
.
          MATCH     Z70,OTMAS079
          IF        !@EQUAL
            MOVE      OTMAS079,OTMACLHR               * Clinical High Risk
          ELSE
            MOVE      ZERO,OTMACLHR
          ENDIF
.
          MATCH     Z70,OTMAS080
          IF        !@EQUAL
            MOVE      OTMAS080,OTMAMLTD               * Multidisciplinary clinic
          ELSE
            MOVE      ZERO,OTMAMLTD
          ENDIF
.
          MATCH     Z70,OTMAS081
          IF        !@EQUAL
            MOVE      OTMAS081,OTMAXPUL               * Exclude from pull list? 
          ELSE
            MOVE      ZERO,OTMAXPUL
          ENDIF
.
          MATCH     Z70,OTMAS082
          IF        !@EQUAL
            MOVE      OTMAS082,OTMAMREF               * Mandatory Referral? 
          ELSE
            MOVE      ZERO,OTMAMREF
          ENDIF
.
          MATCH     Z70,OTMAS083
          IF        !@EQUAL
            MOVE      OTMAS083,OTMATCOD               * Tier 2 code
          ENDIF
.
          MATCH     Z70,OTMAS084
          IF        !@EQUAL
            MOVE      OTMAS084,OTMAHCLI               * HERO Clinic ID
          ENDIF
.
          MATCH     Z70,OTMAS085
          IF        !@EQUAL
            MOVE      OTMAS085,OTMAHCAI               * HERO Campus ID
          ENDIF
.
          MATCH     Z70,OTMAS086
          IF        !@EQUAL
            MOVE      OTMAS086,OTMAAOPN               * Auto Open Clinic
          ENDIF
.
          MATCH     Z70,OTMAS087
          IF        !@EQUAL
            MOVE      OTMAS087,OTMAAOFR               * Auto Open Frequency
          ENDIF
.
          MATCH     Z70,OTMAS088
          IF        !@EQUAL
            MOVE      OTMAS088,OTMAAOWM               * Auto Open Week of Month
          ENDIF
.
          MATCH     Z70,OTMAS089
          IF        !@EQUAL
            MOVE      ZERO,F3
            SQUEEZE   OTMAS089
            MOVE      OTMAS089,F3                     * Auto Open Number of
            MOVE      F3,OTMAAOWA                     * weeks in advance
            RESET     OTMAS089
          ENDIF
.
          MATCH     Z70,OTMAS090
          IF        !@EQUAL
            MOVE      OTMAS090,OTMAHCP1               * Additional HCP 1       
          ENDIF
.
          MATCH     Z70,OTMAS091
          IF        !@EQUAL
            MOVE      OTMAS091,OTMAHCP2               * Additional HCP 2
          ENDIF
.
          MATCH     Z70,OTMAS092
          IF        !@EQUAL
            MOVE      OTMAS092,OTMAHCP3               * Additional HCP 3
          ENDIF
.
          MATCH     Z70,OTMAS093
          IF        !@EQUAL
            MOVE      OTMAS093,OTMAHCP4               * Additional HCP 4
          ENDIF
.
          MATCH     Z70,OTMAS094
          IF        !@EQUAL
            MOVE      OTMAS094,OTMAPCOD               * Default Procedure
          ENDIF
.
          MOVE      SP70,OTMASPAR
.
MASSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields for copy Client Master and checks for blank
.------------------------------------------------------------------
MANMAS00  RESET     COPYTO01
          MATCH     SP70,COPYTO01
          GOTO      MANMAS90 IF EQUAL
.
          RESET     COPYTO02
          MATCH     SP70,COPYTO02
          GOTO      MANMAS91 IF EQUAL
.
          RESET     COPYTO03
          MATCH     SP70,COPYTO03
          GOTO      MANMAS92 IF EQUAL
.
          GOTO      MANMAS98
.
MANMAS90  MOVE      "Copy to Clinic is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MANMAS99
.
MANMAS91  MOVE      "Copy to Day of Week is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MANMAS99
.
MANMAS92  MOVE      "Copy to Clinic Type is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MANMAS99
.
MANMAS98  MOVE      ZERO,EXIT
MANMAS99  RETURN
.-------------------------------------------------------------------
. Suspend Routine for Validating dates
.-------------------------------------------------------------------
SUSMAS00  CALL      IBACLOCK 
          PACK      CURDUM3,CCC,CYY,CMM,CDD        * Get Current Date
          REP       " 0",CURDUM3
          MOVE      CURDUM3,CURDUM1  
          MOVE      SUSPEN01,CURDUM2  
.
. Compare whether Suspend From date is greater than Current Date
.          IF        CURDUM1>CURDUM2
.            GOTO      SUSMAS91
.          ENDIF
.          MOVE      SUSPEN01,SPMAS002
.
. Compare whether Suspend To date is greater than From Date 
         MATCH     SP70,SUSPEN02
         GOTO      SUSMAS99 IF EQUAL
.      
          MOVE      SUSPEN02,CURDUM1  
          IF        CURDUM1>CURDUM2 | CURDUM1=CURDUM2 
            MOVE      SUSPEN02,SPMAS003
            GOTO      SUSMAS98
          ELSE
            GOTO      SUSMAS92
          ENDIF
.
SUSMAS91  MOVE      "From date not greater than Current date",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SUSMAS99
.
SUSMAS92  MOVE      "To date not greater than From date",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SUSMAS99
.
SUSMAS98  MOVE      ZERO,EXIT
SUSMAS99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields and checks for blank
.------------------------------------------------------------------
CHKMAS00  RESET     OTMAS001
          MATCH     SP70,OTMAS001
          GOTO      CHKMAS80 IF EQUAL
.
          RESET     OTMAS002
          MATCH     SP70,OTMAS002
          GOTO      CHKMAS81 IF EQUAL
.
          RESET     OTMAS003
          MATCH     SP70,OTMAS003
          GOTO      CHKMAS82 IF EQUAL
.
          RESET     OTMAS004
          MATCH     SP70,OTMAS004
          GOTO      CHKMAS83 IF EQUAL
.
          RESET     OTMAS005
          MATCH     SP70,OTMAS005
          GOTO      CHKMAS84 IF EQUAL
.
.         RESET     OTMAS006
.         MATCH     SP70,OTMAS006
.         GOTO      CHKMAS85 IF EQUAL
.
          RESET     OTMAS011
          MATCH     SP70,OTMAS011
          GOTO      CHKMAS86 IF EQUAL
          MOVE      OTMAS011,MINUTES
.
.         User can enter a 3 digit number.
.
.          IF        MINUTES > SIXTY
.            GOTO      CHKMAS89
.          ENDIF 
.
          RESET     OTMAS032
          MATCH     SP70,OTMAS032
          GOTO      CHKMAS87 IF EQUAL
.
          RESET     OTMAS033
          IF        IBCNMHOS=1
            MATCH     SP70,OTMAS033
            GOTO      CHKMAS88 IF EQUAL
          ENDIF
.
          MATCH     "U",UPDTTYPE             * Test close date on update screen
          GOTO      CHKMAS98 IF NOT EQUAL
.
          MATCH     Z70,OTMAS053             * Skip test if not close date
          GOTO      CHKMAS98 IF EQUAL
.
          MATCH     SP70,OTMAS053            * Skip test if not close date
          GOTO      CHKMAS98 IF EQUAL
.
          PACK      KEY26,WBSESIT,OTCLI001,OTMAS001,OTMAS002,Z70
          CALL      RDSSESA3
          CALL      RDPSESA3
          BRANCH    OVRCD,CHKMAS98
.
          MATCH     OSESITE,WBSESIT         * Same Site Code?
          GOTO      CHKMAS98 IF NOT EQUAL   * No, go to exit
          MATCH     OSECLIN,OTCLI001        * Same Clinic Id?
          GOTO      CHKMAS98 IF NOT EQUAL   * No, go to exit
          MATCH     DOSEDAY,OTMAS001        * Same Day Indicator?
          GOTO      CHKMAS98 IF NOT EQUAL   * No, go to exit
          MATCH     OSESTRT,OTMAS002        * Same Session Start Time?
          GOTO      CHKMAS98 IF NOT EQUAL   * No, go to exit
.
          MATCH     OSEDATE,OTMAS053        * Are sessions open after the
          GOTO      CHKMAS98 IF NOT LESS    * header close date.
.
          GOTO      CHKMAS90
.
CHKMAS80  MOVE      "Day is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS81  MOVE      "Start Time is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS82  MOVE      "Booking Finish Time is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS83  MOVE      "End of Session Time is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS84  MOVE      "Clinic Type is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS85  MOVE      "Clinic Indicator is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS86  MOVE      "Slot Time Allocated is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS87  MOVE      "Clinic Sessions is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS88  MOVE      "Hospital Code is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS89  MOVE      "Slot duration cannot be greater than 60 minutes!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS90  CLEAR     WEBTITLE
          APPEND    "There are open sessions after the close date. ",WEBTITLE
          APPEND    "Please delete sessions.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAS99
.
CHKMAS98  MOVE      ZERO,EXIT
CHKMAS99  RETURN
.----------------------------------------------------------------
.                         CHKTME00
. Make Sure Booking Finish Time > Start time & End Session >
. Booking Finish Time.                         called by: OUTMAS00
.----------------------------------------------------------------
CHKTME00  UNPACK    OTMAS002,KEY2,KEY1,MIN   * Start Time (HH:MM)
          PACK      KEY4,KEY2,MIN
          MOVE      KEY4,STARTIME            * Change to a form (HHMM for loop)
.
          UNPACK    OTMAS003,KEY2,KEY1,MIN   * Finish Booking Time (HH:MM)
          PACK      KEY4,KEY2,MIN
          MOVE      KEY4,FINSHTME            * Change to a form (HHMM for loop)
.
          UNPACK    OTMAS004,KEY2,KEY1,MIN   * End Session Time (HH:MM)
          PACK      KEY4,KEY2,MIN
          MOVE      KEY4,ENDSESST            * Change to a form (HHMM for loop)
.
          IF        FINSHTME < STARTIME
            GOTO      CHKTME90
          ENDIF 
.
          IF        ENDSESST < FINSHTME
            GOTO      CHKTME91
          ENDIF 
.
          GOTO      CHKTME98
.
CHKTME90  MOVE      "Booking Finish Time must be after Session ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "Start Time!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTME99
.
CHKTME91  MOVE      "Session End Time must be after Bookings ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "Finish Time!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTME99
.
CHKTME98  MOVE      ZERO,EXIT
CHKTME99  RETURN
.----------------------------------------------------------------
. Generate Slots for a Given Day             called by: OUTMAB00
.----------------------------------------------------------------
AVSLOT00  UNPACK    OTHESTRT,KEY2,KEY1,MIN   * (HH:MM)
          PACK      KEY4,KEY2,MIN
          REP       " 0",KEY4
          MOVE      KEY4,SLOTTIME            * Change to a form (HHMM for loop)
          MOVE      OTHESTRT,AVALTIME        * (HH:MM) Available Slot 
.
          UNPACK    OTHEBFIN,KEY2,KEY1,MIN   * (HH:MM)
          PACK      KEY4,KEY2,MIN         
          REP       " 0",KEY4
          MOVE      KEY4,ENDSESST            * Change to a form (HHMM for loop)
.          
          MOVE      ZERO,CURRSLOT            * Slot No.
          MOVE      ZERO,STARTSLT            * Starting Slot No. for AVEXSL00
          MOVE      ZERO,NUMSLGEN            * Reset number of slots generated
.
          MOVE      WBSESIT,OMBSITE
          MOVE      OTHESTRT,OMBSTRT  
          MOVE      OTHECLIN,OMBCLIN
          MOVE      OTHEWDAY,OMBDAY
          MOVE      OTHESHNO,OTMBSHNO
          MOVE      OTHESDAT,OTMBSDAT
.
          MATCH     SP70,HORVCODE       * Set default visit type for new slots
          IF        @EQUAL
            MOVE      "R  ",OMBVTYP
          ELSE
            MOVE      HORVCODE,OMBVTYP
          ENDIF
.
          PACK      KEY12,OTHESITE,OTHECTYP,SP70
          CALL      RDCTYA1
          IF        OVRCD<>1
            MATCH     SP70,OCTDEFCV          * Clinic Type Default Visit Type
            IF        !@EQUAL
              MOVE      OCTDEFCV,OMBVTYP
            ENDIF
          ENDIF
.
AVSLOT20  IF        SLOTTIME <= ENDSESST  
            ADD       TEN,CURRSLOT         * Increment Slot No.
            IF        CURRSLOT > 890
              GOTO      AVSLOT50           * Ran out of slot numbers
            ENDIF
            MOVE      CURRSLOT,OMBSLOT
.
            MOVE      AVALTIME,OMBTIME
            MOVE      ZERO,OMBEXSL
            MOVE      SP70,DOTMBRES 
AVSLOT30    PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                            OTMBSHNO,OTMBSDAT,OMBSLOT
            CALL      RDAMASB1
            IF        OVRCD=1
              CALL      WRMASB1      * write record
              ADD       ONE,NUMSLGEN * Increment number of slots generated
            ELSE
              GOTO      AVSLOT99   
            ENDIF
.
AVSLOT40    CALL      STDUR000     * Calculate difference b/w scheduled hours 
            GOTO      AVSLOT20     * Loop 
          ENDIF 
.
AVSLOT50  MOVE      OMBVTYP,CODE
          CALL      GETSCT00   * Get Slot Count
          MOVE      CNTSLOTS,NUMSLVIS
          IF        NUMSLVIS > ONE
            CALL      AVEXSL00
          ENDIF
          GOTO      AVSLOT99
.
AVSLOT99  RETURN 
.
.-----------------------------------------------------------------
. Generate Extended Slots                     called by: AVSLOT00
.                                                        CRSLOT00
. This procedure loops through all slots generated by AVSLOT00/CRSLOT00 and
. converts required slots to extended slots. As the number of slots 
. generated by AVSLOT00/CRSLOT00 might not be a multiple of the number of 
. slots in the visit type to be generated, the number of slots to be processed 
. (NUMSLPRO) is determined. Those slots are processed and the remaining slots 
. are deleted.
. E.g. If AVSLOT00 has generated 8 slots and visit type to be generated
. occupies 3 slots, then 6 slots will be processed and extended as required
. and 2 slots will be deleted from the template.
.
. Input: NUMSLGEN - Total number of slots generated in AVSLOT00
.        NUMSLVIS - Number of slots per visit type
.        STARTSLT - Starting slot number (when called from AVSLOT00 the 
.                   value is always ZERO, when called from CRSLOT00 it 
.                   holds the number of the last slot before additional 
.                   slots were generated.
.
.-----------------------------------------------------------------
AVEXSL00  MOVE      NUMSLGEN,NUMSLPRO
AVEXSL10  COMPARE   ZERO,NUMSLPRO
          GOTO      AVEXSL20 IF EQUAL
          ASSIGN    (NUMSLPRO % NUMSLVIS),RESULT  
          IF        RESULT <> ZERO
            SUB       ONE,NUMSLPRO   * Not compatible number of slots
            GOTO      AVEXSL10       * Subtract one and try again 
          ENDIF
.
AVEXSL20  MOVE      ZERO,TOTSLCNT
          MOVE      ZERO,VISSLCNT
          MOVE      WBSESIT,OMBSITE
          MOVE      OTHECLIN,OMBCLIN
          MOVE      OTHEWDAY,OMBDAY
          MOVE      OTHESTRT,OMBSTRT
          MOVE      OTHESHNO,OTMBSHNO
          MOVE      OTHESDAT,OTMBSDAT
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,STARTSLT
AVEXSL30  CALL      RDSMASB1      * Position before first slot to be processed
AVEXSL40  CALL      RDKMASB1
          BRANCH    OVRCD,AVEXSL99
.
          MATCH     OTHECLIN,OMBCLIN      * Make sure it's the same template
          GOTO      AVEXSL99 IF NOT EQUAL
          MATCH     OTHEWDAY,DOMBDAY
          GOTO      AVEXSL99 IF NOT EQUAL
          MATCH     OTHESTRT,OMBSTRT
          GOTO      AVEXSL99 IF NOT EQUAL
          MATCH     OTHESHNO,OTMBSHNO
          GOTO      AVEXSL99 IF NOT EQUAL
          MATCH     OTHESDAT,OTMBSDAT
          GOTO      AVEXSL99 IF NOT EQUAL
.   
          ADD       ONE,TOTSLCNT       * Increment number of slots read
          ADD       ONE,VISSLCNT       * Increment slot number in visit
.
          IF        TOTSLCNT <= NUMSLPRO  
            GOTO      AVEXSL50         * Process slot
          ENDIF
          IF        ((TOTSLCNT > NUMSLPRO) & (TOTSLCNT <= NUMSLGEN))
            GOTO      AVEXSL60         * Delete remaining slot
          ENDIF
          IF        TOTSLCNT > NUMSLGEN
            GOTO      AVEXSL99
          ENDIF 
.
          GOTO      AVEXSL99
.
AVEXSL50  IF        VISSLCNT = ONE
            MOVE      OMBSLOT,PARNTSLT * Save slot number as parent slot
            GOTO      AVEXSL40         * First slot in visit, do not extend
          ENDIF
.          
          MOVE      PARNTSLT,OMBEXSL   * Populate parent slot number
          CALL      UPMASB1
.
          IF        VISSLCNT = NUMSLVIS
            MOVE      ZERO,VISSLCNT   
          ENDIF
.
          GOTO      AVEXSL40           * Fetch next record
.
AVEXSL60  PACK      SAVSLKEY,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT,OTHESHNO:
                             OTHESDAT,OMBSLOT
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT,OTHESHNO:
                          OTHESDAT,OMBSLOT
          CALL      DEMASB1
          MOVE      SAVSLKEY,KEY31     * Restore key
          GOTO      AVEXSL30           * Reposition and fetch next record
.
AVEXSL99  RETURN
.
.--------------------------------------------------------------------------
. Create additional slots on clinic master update       called by: OUTMAS00
. This procedure add slots to the template after the last existing slot and
. upto the new session end time.
.--------------------------------------------------------------------------
CRSLOT00  PACK      KEY28,WBSESIT,OTHECLIN,OTHEWDAY,OTHESTRT:
                          OTHESHNO,OTHESDAT,SP70
          PACK      KEY31,WBSESIT,OTHECLIN,OTHEWDAY,OTHESTRT:
                          OTHESHNO,OTHESDAT,Z70
          CALL      RDSMASB1
          CALL      RDPMASB1                 * Read last slot in the template
          BRANCH    OVRCD,CRSLOT10           * Template is empty, set defaults
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          MATCH     KEY28,KEY31
          GOTO      CRSLOT10 IF NOT EQUAL    * Template is empty, set defaults
.
.         Last slot in the template was found. Therefore:
.         Get the slot start time of the last slot and call STDUR00 to set
.         the start time for the new slot. Use slot number found as the
.         starting point for additional slots.
.
          UNPACK    OMBTIME,KEY2,KEY1,MIN    * (HH:MM)
          PACK      KEY4,KEY2,MIN
          REP       " 0",KEY4
          MOVE      KEY4,SLOTTIME            * Change to a form (HHMM for loop)
          MOVE      OMBTIME,AVALTIME         * (HH:MM) Available Slot
          CALL      STDUR000                 * Set time for new slot
.
          MOVE      OMBSLOT,CURRSLOT         * Set Slot No.
.
          GOTO      CRSLOT20
.
.         The template is currently empty. Use session start time as the
.         start time of the first slot to be added and set starting point for
.         slot numbers to ZERO.
.
CRSLOT10  CALL      MABSAV00
          MOVE      OTHESTRT,AVALTIME
          MOVE      ZERO,CURRSLOT
.
.         Set the new session end time
.
CRSLOT20  UNPACK    OTHEBFIN,KEY2,KEY1,MIN     * (HH:MM)
          PACK      KEY4,KEY2,MIN
          REP       " 0",KEY4
          MOVE      KEY4,ENDSESST            * Change to a form (HHMM for loop)
.
          MOVE      CURRSLOT,STARTSLT        * Starting Slot No. for AVEXSL00
          MOVE      ZERO,NUMSLGEN            * Reset number of slots generated
.
          MATCH     SP70,HORVCODE       * Set default visit type for new slots
          IF        @EQUAL
            MOVE      "R  ",OMBVTYP
          ELSE
            MOVE      HORVCODE,OMBVTYP
          ENDIF
.
CRSLOT30  IF        SLOTTIME <= ENDSESST
            ADD       TEN,CURRSLOT           * Increment Slot No.
            IF        CURRSLOT > 890
              MOVE      ONE,EXIT
              GOTO      CRSLOT60
            ENDIF
            MOVE      CURRSLOT,OMBSLOT
.
            MOVE      AVALTIME,OMBTIME
            MOVE      ZERO,OMBEXSL
            MOVE      SP70,DOTMBRES
CRSLOT40    PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                            OTMBSHNO,OTMBSDAT,OMBSLOT
            CALL      RDAMASB1
            IF        OVRCD=1
              CALL      WRMASB1      * write record
              ADD       ONE,NUMSLGEN * Increment number of slots generated
            ELSE
              GOTO      CRSLOT99
            ENDIF
.
CRSLOT50    CALL      STDUR000     * Calculate difference b/w scheduled hours
            GOTO      CRSLOT30     * Loop
          ENDIF
.
CRSLOT60  MOVE      OMBVTYP,CODE
          CALL      GETSCT00   * Get Slot Count
          MOVE      CNTSLOTS,NUMSLVIS
          IF        NUMSLVIS > ONE
            CALL      AVEXSL00
          ENDIF
          GOTO      CRSLOT99
.
CRSLOT99  RETURN
.
.------------------------------------------------------------
.                             STDUR000                        
.              Calculate difference b/w scheduled hours      
.         N.B. Result is to get number of hours scheduled   
.                                            called by: AVSLOT00
.------------------------------------------------------------
STDUR000  UNPACK    AVALTIME,KEY2,KEY1,MIN  * HH:MM
          MOVE      KEY2,HOUR               * HH to Form
          MOVE      MIN,MINUTES             * MM to Form
.
          ADD       OTHEDURN,MINUTES   * Add Duration time to minutes
          ASSIGN    MINUTES-SIXTY,TIME    
          IF        TIME >= 0 
            IF        TIME >= 120
                MOVE      TIME,MINUTES
                ASSIGN    MINUTES-HUND20,TIME
                MOVE      TIME,MINTIME
                MOVE      MINTIME,MIN
                ADD       THREE,HOUR               * Add Three Hours
            ELSE
              IF        TIME >= 60
                MOVE      TIME,MINUTES
                ASSIGN    MINUTES-SIXTY,TIME
                MOVE      TIME,MINTIME
                MOVE      MINTIME,MIN
                ADD       TWO,HOUR                 * Add Two Hours
              ELSE
                MOVE      TIME,MINTIME
                MOVE      MINTIME,MIN
                ADD       ONE,HOUR                 * Add One Hour
              ENDIF
            ENDIF
          ELSE
            MOVE      MINUTES,MINTIME            * No Hour Change
            MOVE      MINTIME,MIN
          ENDIF 
.
          PACK      AVALTIME,HOUR,COLON,MIN  * pack time save variable (HH:MM) 
          REPLACE   " 0",AVALTIME            * replace spaces with zero
.
          UNPACK    AVALTIME,KEY2,KEY1,MIN
          PACK      KEY4,KEY2,MIN  
          MOVE      KEY4,SLOTTIME  * pack time Form variable (Loop Control) 
.
STDUR999  RETURN
.----------------------------------------------------------------------
. Delete any slots the have a start time after the new booking end time
.----------------------------------------------------------------------
FXSLOT00  PACK      KEY31,WBSESIT,OTHECLIN,OTHEWDAY,OTHESTRT:
                          OTHESHNO,OTHESDAT,Z70 
          CALL      RDSMASB1 
FXSLOT10  CALL      RDPMASB1
          BRANCH    OVRCD,FXSLOT99
.
          MATCH     WBSESIT,OMBSITE
          GOTO      FXSLOT99 IF NOT EQUAL           
.
          MATCH     OTHECLIN,OMBCLIN
          GOTO      FXSLOT99 IF NOT EQUAL           
.
          MATCH     OTHEWDAY,DOMBDAY
          GOTO      FXSLOT99 IF NOT EQUAL           
.
          MATCH     OTHESTRT,OMBSTRT
          GOTO      FXSLOT99 IF NOT EQUAL           
.
          MATCH     OMBTIME,OTHEBFIN             * Check slot time to booking
          GOTO      FXSLOT99 IF NOT LESS         * end time
.
          MOVE      ZERO,PARNTSLT
          IF        OMBEXSL > ZERO
            MOVE      OMBEXSL,PARNTSLT
          ENDIF
.
          PACK      KEY31,OMBSITE,OMBCLIN,DOMBDAY,OMBSTRT,OTMBSHNO:
                          OTMBSDAT,OMBSLOT,SP70
          CALL      DEMASB1  
          IF        PARNTSLT > ZERO
            CALL      FXEXSL00
          ENDIF
          GOTO      FXSLOT00 

FXSLOT99  RETURN
.
.----------------------------------------------------------------------
. Delete all slots for a visit with extended slots where the last slot 
. have a start time after the new booking end time.
.
. Input: PARNTSLT: Slot number of the parent slot. This routine will delete
.                  all slots that are the extended slots of the parent
.                  as well as the parent slot.
.----------------------------------------------------------------------
FXEXSL00  PACK      KEY31,WBSESIT,OTHECLIN,OTHEWDAY,OTHESHNO:
                          OTHESDAT,Z70
          CALL      RDSMASB1
FXEXSL10  CALL      RDPMASB1
          BRANCH    OVRCD,FXEXSL99
. 
          MATCH     WBSESIT,OMBSITE
          GOTO      FXEXSL99 IF NOT EQUAL
.
          MATCH     OTHECLIN,OMBCLIN
          GOTO      FXEXSL99 IF NOT EQUAL
.
          MATCH     OTHEWDAY,DOMBDAY
          GOTO      FXEXSL99 IF NOT EQUAL
.
          MATCH     OTHESTRT,OMBSTRT
          GOTO      FXEXSL99 IF NOT EQUAL
.
          MATCH     OTHESHNO,OTMBSHNO
          GOTO      FXEXSL99 IF NOT EQUAL
.
          MATCH     OTHESDAT,OTMBSDAT
          GOTO      FXEXSL99 IF NOT EQUAL
.
.         If this is an extended slot, delete it and go back to the start
.
          IF        OMBEXSL = PARNTSLT
            PACK      KEY31,OMBSITE,OMBCLIN,DOMBDAY,OMBSTRT:
                            OTMBSHNO,OTMBSDAT,OMBSLOT
            CALL      DEMASB1
            GOTO      FXEXSL00
          ENDIF
.
.         If this is the parent slot, delete it and exit
.
          IF        OMBSLOT = PARNTSLT
            PACK      KEY31,OMBSITE,OMBCLIN,DOMBDAY,OMBSTRT:
                            OTMBSHNO,OTMBSDAT,OMBSLOT
            CALL      DEMASB1
          ENDIF
.
FXEXSL99  RETURN
.
.------------------------------------------------------------
. Delete Slots for Given Day 
.------------------------------------------------------------
DLSLOT00  PACK      KEY31,OTHESITE,OTHECLIN,OTHEWDAY,OTHESTRT:
                          OTHESHNO,OTHESDAT,SP70
          CALL      RDSMASB1 
DLSLOT10  CALL      RDKMASB1
          BRANCH    OVRCD,DLSLOT99
          MATCH     OTHESITE,OMBSITE
          GOTO      DLSLOT99 IF NOT EQUAL           
          MATCH     OTHECLIN,OMBCLIN
          GOTO      DLSLOT99 IF NOT EQUAL           
          MATCH     OTHEWDAY,DOMBDAY
          GOTO      DLSLOT99 IF NOT EQUAL           
          MATCH     OTHESTRT,OMBSTRT
          GOTO      DLSLOT99 IF NOT EQUAL           
          MATCH     OTHESHNO,OTMBSHNO
          GOTO      DLSLOT99 IF NOT EQUAL           
          MATCH     OTHESDAT,OTMBSDAT
          GOTO      DLSLOT99 IF NOT EQUAL           
.
          PACK      KEY31,OMBSITE,OMBCLIN,DOMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT
          CALL      DEMASB1  
          GOTO      DLSLOT10 

DLSLOT99  RETURN
.---------------------------------------------------------------------
.                            CHKSES00
.  Reads through each corresponding session date on file. 
.  Then checks if a session is Booked for the corresponding date, 
.  if booked no records are deleted. The next date is read in. 
.                                                 called by: OUTMAS00
.---------------------------------------------------------------------
CHKSES00  PACK      KEY26,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70 
          CALL      RDSSESA3
CHKSES10  CALL      RDKSESA3 
          BRANCH    OVRCD,CHKSES99
.
          MATCH     WBSESIT,OSESITE
          GOTO      CHKSES99 IF NOT EQUAL
.
          MATCH     OTCLI001,OSECLIN 
          GOTO      CHKSES99 IF NOT EQUAL
.
          MATCH     OTMAS001,DOSEDAY 
          GOTO      CHKSES99 IF NOT EQUAL
.
          MATCH     OTMAS002,OSESTRT 
          GOTO      CHKSES99 IF NOT EQUAL
.
          CALL      BOKCHK00    * Check if Ok to delete! Date has no bookings?
          BRANCH    EXIT,CHKSES99  * A record is Booked read next date!  
.
          CALL      DELBOK00    * No records are booked, delete booking.
.
          CALL      SESDEL00    * Delete Session Record 
.
          GOTO      CHKSES10    * Read Next Date.
.
CHKSES99  RETURN
.------------------------------------------------------------
. Outpatient Clinic Slot Template: Display,Add,Update,Delete
.------------------------------------------------------------
OUTMAB00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTMAB80 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OUTMAB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OUTMAB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTMAB30 IF EQUAL
.
          MATCH     "S",UPDTTYPE    * Add template header formaction
          GOTO      OUTMAB40 IF EQUAL
.
          MATCH     "T",UPDTTYPE    * Update template header formaction
          GOTO      OUTMAB50 IF EQUAL
.
          MATCH     "R",UPDTTYPE    * Delete template header formaction
          GOTO      OUTMAB60 IF EQUAL
.
          MATCH     "N",UPDTTYPE    * Update session status
          GOTO      OUTMAB70 IF EQUAL
.
          MATCH     "M",UPDTTYPE    * multiple slot update form action
          GOTO      OUTMAB75 IF EQUAL
.
          MATCH     "O",UPDTTYPE    * multiple slot delete form action
          GOTO      OUTMAB76 IF EQUAL
.
          MATCH     "G",UPDTTYPE    * multiple slot - allow group booking
          GOTO       OUTMAB77 IF EQUAL
.
          MATCH     "B",UPDTTYPE    * Add multiple slot for group booking
          GOTO       OUTMAB78 IF EQUAL
.
          GOTO      OUTMAB93
.
.         ************ ADD FORMACTION **********
.
OUTMAB10  CALL      CHKMAB00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,OUTMAB99
          PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,OTMAB001,SP70
          CALL      RDMASB1
          COMPARE   ZERO,OVRCD
          GOTO      OUTMAB92 IF EQUAL
.
          PACK      SAVSLKEY,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                             OTHED005,OTHED006,OTMAB001,SP70
          CALL      VALADD00
          BRANCH    EXIT,OUTMAB97,OUTMAB97
          MOVE      SAVSLKEY,KEY31
.
          MOVE      OTMAB002,CODE
          CALL      GETSCT00           * Get slot count for visit to be added
          MOVE      CNTSLOTS,NUMSLVIS
.
          CALL      MABSAV00      * Moves input variables to file variables
          CALL      WRMASB1       * Writes away the data
.
          SUB       ONE,NUMSLVIS
          IF        NUMSLVIS > ZERO
            MOVE      OMBSLOT,PARNTSLT
            CALL      EXTADD00
            BRANCH    EXIT,OUTMAB98
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTMAB99
.
.         ************ UPDATE FORMACTION **********
.
OUTMAB20  PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,OTMAB001,SP70
          CALL      RDMASB1
          BRANCH    OVRCD,OUTMAB91
          CALL      CHKMAB00      * Checks mandatory fields
          BRANCH    EXIT,OUTMAB99
.
          MOVE      OMBVTYP,OLDVTYP
          MOVE      OTMAB002,NEWVTYP
.
          MOVE      OMBTIME,OLDTIME
          MOVE      OTMAB003,NEWTIME
          MATCH     OLDTIME,NEWTIME
          IF        !@EQUAL
            CALL      VALUPD00    * Validate start time
            BRANCH    EXIT,OUTMAB90
          ENDIF
.
          CALL      VALEXT00      * Validate Extended Slots
          BRANCH    EXIT,OUTMAB99
.
          CALL      MABSAV00      * Moves input variables to file variables
          CALL      UPMASB1       * Writes away the data
.
          CALL      CHKEXT00      * Check for Extended Slots
.
          MOVE      ZERO,EXIT
          GOTO      OUTMAB99
.
.         ************ DELETE FORMACTION **********
.
OUTMAB30  PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,OTMAB001,SP70
          PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
          CALL      RDMASB1
          BRANCH    OVRCD,OUTMAB91
          CALL      DEMASB1      * Deletes the data
.
OUTMAB31  CALL      RDSMASB1
          CALL      RDKMASB1
          BRANCH    OVRCD,OUTMAB91
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          MATCH     KEY28,KEY31
          GOTO      OUTMAB39 IF NOT EQUAL
          COMPARE   ZERO,OMBEXSL
          GOTO      OUTMAB39 IF EQUAL
          CALL      DEMASB1      * Deletes the data
          GOTO      OUTMAB31

OUTMAB39  MOVE      ZERO,EXIT
          GOTO      OUTMAB99
.
.         ************ ADD TEMPLATE FORMACTION **********
.
OUTMAB40  PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,OUTMAB94
.
          PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
          CALL      RDOTHED1
          COMPARE   ZERO,OVRCD
          GOTO      OUTMAB88 IF EQUAL
.
          CALL      CHKOPN00      * Check Open and Close Template Dates
          BRANCH    EXIT,OUTMAB99
.
          PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
          CALL      MVOTHE00      * Moves input variables to file variables
          CALL      WROTHED1      * Writes away the data
.
          CALL      AVSLOT00      * Generate Slots
.
          MOVE      ZERO,EXIT
          GOTO      OUTMAS99
.
.         ************ UPDATE TEMPLATE FORMACTION **********
.
OUTMAB50  PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,OUTMAB94
.
          PACK      KEY28,WBSESIT,OTHED002,OTHED003,OTHED004,OTHED005:
                          OTHED006,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,OUTMAB89
.
          CALL      CHKCDT00      * Check if a template header closed date can
          BRANCH    EXIT,OUTMAB99 * be deleted or updated
.
          CALL      CHKOPN00      * Check Open and Close Template Dates on
          BRANCH    EXIT,OUTMAB99 * update if a close date is entered
.
          CALL      CHKCLS00      * Check that no sessions exist after the 
          BRANCH    EXIT,OUTMAB99 * template master close date
.
          PACK      KEY28,WBSESIT,OTHED002,OTHED003,OTHED004,OTHED005:
                          OTHED006,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,OUTMAB89
.
          MOVE      OTHETCOD,SAVETCOD  * Save Tier 2 Code
          MOVE      OTHETCED,SAVETCED  * Save Tier 2 Code Effective Date
.
          MOVE      ZERO,UPDTSLOT
          MATCH     Z70,OTHED014
          IF        !@EQUAL
            MATCH     OTHED014,OTHEBFIN
            IF        !@EQUAL
              MOVE       ONE,UPDTSLOT  * Update Slots on Change of Finish Time
            ENDIF
          ENDIF
.
          MATCH     Z70,OTHED004
          IF        !@EQUAL
            MATCH     OTHED004,OTHESTRT
            IF        !@EQUAL
              MOVE       ONE,UPDTSLOT  * Update Slots on Change of Start Time
            ENDIF
          ENDIF
.
          CALL      MVOTHE00      * Moves input variables to file variables
          CALL      UPOTHED1      * Writes away the data
.
          CALL      TIER0000      * Schedule background update of tier 2 codes
.
          COMPARE   ONE,UPDTSLOT
          IF        @EQUAL
            CALL      FXSLOT00    * Remove slots after new booking end time
            CALL      CRSLOT00    * Create new slots up to booking end time
            BRANCH    EXIT,OUTMAS85
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTMAS99
.
.
.         ************ DELETE TEMPLATE FORMACTION **********
.
OUTMAB60  PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,OUTMAB94
.
          PACK      KEY28,WBSESIT,OTHED002,OTHED003,OTHED004,OTHED005:
                          OTHED006,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,OUTMAB89
.
          CALL      CHKDEL00      * Check if we can delete this header    
          BRANCH    EXIT,OUTMAB99 * update if a close date is entered
.
          CALL      DLSLOT00      * Delete all templated slots for this header
.
          PACK      KEY28,WBSESIT,OTHED002,OTHED003,OTHED004,OTHED005:
                          OTHED006,SP70
          CALL      DEOTHED1
.
          MOVE      ZERO,EXIT
          GOTO      OUTMAS99
.
.         ************ UPDATE SESSION STATUS FORMACTION **********
.
OUTMAB70  CALL      USTA0000      * Update session status
          BRANCH    EXIT,OUTMAB99
.
          MOVE      ZERO,EXIT
          GOTO      OUTMAS99
.
.         ************ Multiple slot update/delete form action ***********
.
OUTMAB75  CALL      MULU0000  * multiple slot update
          BRANCH    EXIT,OUTMAB99
.
          MOVE      ZERO,EXIT
          GOTO      OUTMAB99
.
OUTMAB76  CALL      MULD0000  * multiple slot delete
          MOVE      ZERO,EXIT
          GOTO      OUTMAB99
.
OUTMAB77  CALL      GKIN0000  * multiple slot - allow group booking
          BRANCH    EXIT,OUTMAB87,OUTMAB86
          GOTO      OUTMAB99
.
OUTMAB78  CALL      AMUL0000                     * Add multiple slot at same
          BRANCH    EXIT,OUTMAB99                * time for group booking
.          
          GOTO      OUTMAB99
.
.         ************ DISPLAY FORMACTION **********
.
OUTMAB80  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70   
          CALL      RDCLIA1
          BRANCH    OVRCD,OUTMAB94         
.
          PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,OUTMAB95         
.
          PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002,OTHED005:
                          OTHED006,OTMAB001,SP70
          CALL      RDMASB1
          IF        OVRCD=0
            COMPARE   ZERO,OMBEXSL
            GOTO      OUTMAB96 IF NOT EQUAL
          ELSE
            CALL      CLRMAB00    * Clear all the file variables
          ENDIF
.
          PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002,OTHED005:
                          OTHED006,SP70
          CALL      RDOTHED1
          IF        OVRCD=1
            CALL      CLOUTHED    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Slot Template Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTMAB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB86  MOVE      "Group booking is time is out of range",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB87  MOVE      "Group booking is disabled for this session",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB88  MOVE      "Slot Template Master exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB89  MOVE      "Invalid slot Template Master",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB90  MOVE      "Invalid slot time entered",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB91  MOVE      "Clinic Slot Number does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB92  MOVE      "Clinic Slot Number exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB94  MOVE      "Invalid Clinic.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB95  MOVE      "Invalid Clinic Master.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB96  MOVE      "Extended Slot Cannot be Updated.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB97  IF        EXIT = ONE
            MOVE      "No Time Space Available for This Visit Type",WEBTITLE
          ELSE
            MOVE      "Invalid slot number selected",WEBTITLE
          ENDIF
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB98  MOVE      "Error occured while writing extended slots",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
OUTMAB99  RETURN
.
.---------------------------------------------------------------------
. Check if the tier 2 code and effective date has been updated in outhedaf
. Is so schedule an update of the tier 2 code on any bookings after 
. the effective date with the new tier 2 code if they currently have
. the old tier 2 code.
.---------------------------------------------------------------------
TIER0000  MATCH     Z70,OTHED041        * Exit if tier 2 code not on screen
          GOTO      TIER9999 IF EQUAL
.
          MATCH     Z70,OTHED042        * Exit if tier 2 effective date 
          GOTO      TIER9999 IF EQUAL   * not on screen
.
          MATCH     SP70,OTHETCOD       * Exit if no tier 2 code
          GOTO      TIER9999 IF EQUAL
.
          MATCH     SP70,OTHETCED       * Exit if no tier 2 code effective date
          GOTO      TIER9999 IF EQUAL
.
          MATCH     SAVETCOD,OTHETCOD                                        
          IF        @EQUAL
            MATCH     SAVETCED,OTHETCED * Exit if the tier 2 code and effective
            GOTO      TIER9999 IF EQUAL * date have not been changed
          ENDIF
.
          MOVE      ZERO,FORM10
          PACK      KEY10,Z70
          CALL      RSIBPOL1
          CALL      RPIBPOL1
          BRANCH    OVRCD,TIER1000
.
          MOVE      IBPLUNIQ,FORM10
TIER1000  ADD       ONE,FORM10
.
          MOVE      FORM10,IBPLUNIQ
          MOVE      "006",IBPLTYPE     * Update OP Booking Tier 2 Code
          MOVE      SP70,IBPLURNO
          MOVE      SP70,IBPLVISN
          PACK      IBPLSKEY,OTHESITE,OTHECLIN,OTHEWDAY,OTHESTRT:
                             OTHESHNO,OTHESDAT,SAVETCOD,SP70
          MOVE      SP70,IBPLSPAR
.
          MOVE      FORM10,KEY10
          CALL      RAIBPOL1
          IF        OVRCD=1
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            CALL      WRIBPOL1
            TRAPCLR   IO
            BRANCH    OVRCD,TIER1000
          ELSE
            GOTO      TIER1000
          ENDIF
.
TIER9999  RETURN
.
.---------------------------------------------------------------------
. VALADD00                                        Called By: OUTMAB10
. Validate for available space when adding a new slot to the template.
. This procedure determines whether a new slot of selected visit type
. will fit into the selected spot in the template taking into account
. the extended slots. The slot/visit is allowed to be added to the 
. template only if there is enough time available and all slot numbers
. can be allocated.
. Return values:  EXIT=0 - success, new slot/visit will fit into template
.                 EXIT=1 - error, not enough time space available 
.                 EXIT=2 - error, not enough slot numbers available
. Note: Slot numbers for extended slots are allocated in increaments of 1
.       starting with the slot number entered for the new slot/visit.
.---------------------------------------------------------------------
VALADD00  PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,VALADD91
.
          PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,VALADD91
.
          MOVE      OTMAB002,CODE
          CALL      GETSCT00           * Get slot count for visit to be added
          MOVE      CNTSLOTS,NUMSLVIS
.
          MOVE      OTMAB001,CURRSLOT
.
.         Get details of the previous slot and validate against slot
.         to be added.
.
          PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
          PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,OTMAB001,SP70
          CALL      RDSMASB1                * Position key on slot to be added 
          CALL      RDPMASB1                * Read previous slot
          BRANCH    OVRCD,VALADD10          * No previous slot, set defaults
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          MATCH     KEY28,KEY31
          GOTO      VALADD10 IF NOT EQUAL   * No previous slot, set defaults
.
.         Previous slot found. Therefore:
.         Previous slot end time = start time of slot found + duration 
.
          MOVE      OMBTIME,AVALTIME
          CALL      STDUR000
          MOVE      SLOTTIME,PREVTIME       * Previous slot end time
.         
          GOTO      VALADD20
.
.         Previous slot not found. Therfore:
.         Previus lost end time = session start time
.
VALADD10  UNPACK    OTHESTRT,KEY2,KEY1,MIN
          PACK      KEY4,KEY2,MIN
          REP       " 0",KEY4
          MOVE      KEY4,PREVTIME           * Previous slot end time
.
VALADD20  UNPACK    OTMAB003,KEY2,KEY1,MIN
          PACK      KEY4,KEY2,MIN
          REP       " 0",KEY4
          MOVE      KEY4,NSLTSTRT            * New slot start time
.
          IF        NSLTSTRT < PREVTIME
            IF        OVERRIDE=0
              GOTO      VALADD91
            ENDIF
          ENDIF
.
.         Get details of the next slot and validate against slot to be addded 
.
          PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,OTMAB001,SP70
          CALL      RDSMASB1                * Position key on slot to be added
          CALL      RDKMASB1                * Read next slot
          BRANCH    OVRCD,VALADD30
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          MATCH     KEY28,KEY31
          GOTO      VALADD30 IF NOT EQUAL 
.
.         Next slot found. Therefore:
.         Next slot number = slot number found
.         Next slot start time = start time of slot found
.
          MOVE      OMBSLOT,NEXTSLOT   * Slot number of the next slot
          UNPACK    OMBTIME,KEY2,KEY1,MIN
          PACK      KEY4,KEY2,MIN
          REP       " 0",KEY4
          MOVE      KEY4,NEXTTIME      * Start time of the next slot
.
          GOTO      VALADD40
.
.         Next slot not found. Therefore:
.         Next slot number = 999
.         Next slot start time = session end time + duration
.
VALADD30  MOVE      "1000",NEXTSLOT     * Slot number of the next slot
          MOVE      OTHEBFIN,AVALTIME    
          CALL      STDUR000
          MOVE      SLOTTIME,NEXTTIME  * Start time of the next slot
.
VALADD40  MOVE      OTMAB003,AVALTIME
VALADD50  CALL      STDUR000
          MOVE      SLOTTIME,NSLTENDT        * New slot end time
.
          IF        NSLTENDT > NEXTTIME
            IF        OVERRIDE=0
              GOTO      VALADD91
            ENDIF
          ENDIF
          IF        CURRSLOT >= NEXTSLOT
            GOTO      VALADD92
          ENDIF
.
.         Check that there is space available for all slots (including any
.         extended slots). 
.
          SUB       ONE,NUMSLVIS
          IF        NUMSLVIS > ZERO
            ADD       ONE,CURRSLOT     * Increament slot number
            GOTO      VALADD50
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      VALADD99
.
VALADD91  MOVE      ONE,EXIT
          GOTO      VALADD99    
.
VALADD92  MOVE      TWO,EXIT
          GOTO      VALADD99    
.
VALADD99  RETURN
.
.--------------------------------------------------------------------
. EXTADD00                                        Called by: OUTMAB10
. This procedure is used to add extended slots to the template when 
. a new slot/visit is added that contains extended slots. The slot 
. numbers for extended slots are allocated in increaments of 1.
. The slot start time is calculated using the slot duration specified
. on the clinic master.
.--------------------------------------------------------------------
EXTADD00  IF        NUMSLVIS = ZERO
            GOTO      EXTADD99
          ENDIF
.
          ADD       ONE,OMBSLOT        * Set slot number
          MOVE      PARNTSLT,OMBEXSL   * Set parent slot number
          MOVE      OMBTIME,AVALTIME
          CALL      STDUR000
          MOVE      AVALTIME,OMBTIME   * Set slot starting time
.
          PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,OMBSLOT,SP70
          CALL      RDMASB1
          IF        OVRCD = ZERO       
            GOTO      EXTADD90         * Record found, error
          ENDIF
.
          CALL      WRMASB1
          SUB       ONE,NUMSLVIS
          GOTO      EXTADD00
.
EXTADD90  MOVE      ONE,EXIT
          GOTO      EXTADD99 
.
EXTADD99  RETURN
.
.---------------------------------------------------------------------
. VALUPD00                                        Called By: OUTMAB20
. Validate for available space when changing the start time of a slot.
. This procedure determines whether a slot with a new start time 
. will fit into the template taking into account previous and next slot
. and slot duration.
. Return values:  EXIT=0 - success, slot with new time will fit into template
.                 EXIT=1 - error, not enough time space available
.---------------------------------------------------------------------
VALUPD00  PACK      SAVSLKEY,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                             OTHED005,OTHED006,OTMAB001,SP70
          PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,VALUPD91
.
          PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,VALUPD91
.
.         Get details of the previous slot and validate against slot
.         to be added.
.
          PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
          PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,OTMAB001,SP70
          CALL      RDSMASB1                * Position key on current slot
          CALL      RDPMASB1                * Read previous slot
          BRANCH    OVRCD,VALUPD10          * No previous slot, set defaults
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          MATCH     KEY28,KEY31
          GOTO      VALUPD10 IF NOT EQUAL   * No previous slot, set defaults
.
.         Previous slot found. Therefore:
.         Previous slot end time = start time of slot found + duration
.
          MOVE      OMBTIME,AVALTIME
          CALL      STDUR000
          MOVE      SLOTTIME,PREVTIME       * Previous slot end time
.
          GOTO      VALUPD20
.
.         Previous slot not found. Therfore:
.         Previus lost end time = session start time
.
VALUPD10  UNPACK    OTHESTRT,KEY2,KEY1,MIN
          PACK      KEY4,KEY2,MIN
          REP       " 0",KEY4
          MOVE      KEY4,PREVTIME           * Previous slot end time
.
VALUPD20  UNPACK    OTMAB003,KEY2,KEY1,MIN
          PACK      KEY4,KEY2,MIN
          REP       " 0",KEY4
          MOVE      KEY4,NSLTSTRT           * New slot start time
.
          IF        NSLTSTRT < PREVTIME
            GOTO      VALUPD91
          ENDIF
.
.         Get details of the next slot and validate against slot to be addded
.
          PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,OTMAB001,SP70
          CALL      RDSMASB1                * Position key on current slot
          CALL      RDKMASB1                * Read next slot
          BRANCH    OVRCD,VALUPD30
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          MATCH     KEY28,KEY31
          GOTO      VALUPD30 IF NOT EQUAL
.
.         Next slot found. Therefore:
.         Next slot start time = start time of slot found
.
          UNPACK    OMBTIME,KEY2,KEY1,MIN
          PACK      KEY4,KEY2,MIN
          REP       " 0",KEY4
          MOVE      KEY4,NEXTTIME      * Start time of the next slot
.
          GOTO      VALUPD40
.
.         Next slot not found. Therefore:
.         Next slot start time = session end time + duration
.
VALUPD30  MOVE      OTHEBFIN,AVALTIME
          CALL      STDUR000
          MOVE      SLOTTIME,NEXTTIME  * Start time of the next slot
.
VALUPD40  MOVE      OTMAB003,AVALTIME
          CALL      STDUR000
          MOVE      SLOTTIME,NSLTENDT        * New slot end time
.
          IF        NSLTENDT > NEXTTIME
            GOTO      VALUPD91
          ENDIF
.
          MOVE      ZERO,EXIT
          MOVE      SAVSLKEY,KEY31
          CALL      RDMASB1     * Read Current Slot 
          GOTO      VALUPD99
.
VALUPD91  MOVE      ONE,EXIT
          GOTO      VALUPD99
.
VALUPD99  RETURN
.
.-----------------------------------------------------------
. Validate for Extended Slot Update
.-----------------------------------------------------------
VALEXT00  MOVE      ZERO,EXIT
          MATCH     NEWVTYP,OLDVTYP    * Any Change ?
          GOTO      VALEXT99 IF EQUAL 
.
          MOVE      NEWVTYP,CODE
          CALL      GETSCT00   * Get Slot Count
          MOVE      CNTSLOTS,NEWSLOTS
.
          MOVE      OLDVTYP,CODE
          CALL      GETSCT00   * Get Slot Count
          MOVE      CNTSLOTS,OLDSLOTS
.
          MOVE      ZERO,EXIT
          COMPARE   NEWSLOTS,OLDSLOTS
          GOTO      VALEXT99 IF EQUAL 
.
          IF        NEWSLOTS<OLDSLOTS
            GOTO      VALEXT99
          ENDIF
.
          MOVE      NEWSLOTS,VALSLOTS
          MOVE      ZERO,TOTSLCNT
.
          PACK      SAVKEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                             OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
.
          PACK      KEY18,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT,SP70
          CALL      RDMASB1     * Read Current Slot
.
          PACK      KEY28,OMBSITE,OMBCLIN,OMBDAY:
                          OMBSTRT,OTMBSHNO,OTMBSDAT,SP70
          CALL      RDOTHED1

.  
          MOVE      OMBVTYP,CODE
          CALL      GETSCT00    * Get Slot Count
          MOVE      CNTSLOTS,NUMSLVIS 
.
VALEXT10  ADD       ONE,TOTSLCNT
          SUB       ONE,NUMSLVIS
.
.         Process all slots that belong to this visit type
.
          IF        NUMSLVIS > ZERO
            CALL      RDKMASB1
            BRANCH    OVRCD,VALEXT90
            PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                            OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
            MATCH     KEY28,KEY31
            GOTO      VALEXT90 IF NOT EQUAL
.
            GOTO      VALEXT10
          ENDIF
.
.         All slots for this visit type have been processed. 
.         If Total number of slots processed is equal to number of slots
.         in the new visit type, then Update can be successful
.
          IF        TOTSLCNT = VALSLOTS
            GOTO      VALEXT20
          ENDIF
.
.         If total number of slots processed is greater than number of slots
.         in the new visit type, then Update can not proceed as it would result
.         in partial conversion of exisiting visit to the new visit.
.
          IF        TOTSLCNT > VALSLOTS
            GOTO      VALEXT90
          ENDIF
.
.         The total number of slots processed is less then number of slots in 
.         the new visit type. Therefore fetch next visit, get number of slots
.         in this visit and go back to process all slots in this visit.
.
          CALL      RDKMASB1
          BRANCH    OVRCD,VALEXT90
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          MATCH     KEY28,KEY31
          GOTO      VALEXT90 IF NOT EQUAL
.
          MOVE      OMBVTYP,CODE
          CALL      GETSCT00    * Get Slot Count
          MOVE      CNTSLOTS,NUMSLVIS
          GOTO      VALEXT10            
.
VALEXT20  MOVE      ZERO,EXIT
          MOVE      SAVKEY31,KEY31
          CALL      RDMASB1     * Read Current Slot
          GOTO      VALEXT99
.
VALEXT90  MOVE      "No Space Available for Extended Slots.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
VALEXT99  RETURN
.
.-----------------------------------------------------------
. Check for Extended Slot Update
.-----------------------------------------------------------
CHKEXT00  MATCH     NEWVTYP,OLDVTYP    * Any Change ?
          GOTO      CHKEXT99 IF EQUAL 
          MOVE      OMBSLOT,SLPARENT
.
          MOVE      NEWVTYP,CODE
          CALL      GETSCT00   * Get Slot Count
          MOVE      CNTSLOTS,NEWSLOTS
          MOVE      NEWSLOTS,NUMSLVIS
.
          MOVE      OLDVTYP,CODE
          CALL      GETSCT00   * Get Slot Count
          MOVE      CNTSLOTS,OLDSLOTS
.
          IF        (NEWSLOTS=OLDSLOTS & NEWSLOTS=1)
            GOTO      CHKEXT99
          ENDIF
.
          CALL      EXTSLT00          * Extend Slots
.
CHKEXT99  RETURN
.------------------------------------------------------------
. Get Slot Count from Code File
.------------------------------------------------------------
GETSCT00  MOVE      ONE,CNTSLOTS
          MOVE      "CV",CATEGORY
          PACK      KEY5,CATEGORY,CODE
          CALL      RDCODE1
          IF        (OVRCD=0 & TCFORM6<>0)
            MOVE      TCFORM6,CNTSLOTS
          ENDIF
          RETURN
.------------------------------------------------------------
. Extend Slot
.------------------------------------------------------------
EXTSLT00  PACK      KEY28,OMBSITE,OMBCLIN,OMBDAY:
                          OMBSTRT,OTMBSHNO,OTMBSDAT,SP70
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          CALL      RDMASB1     * Read Current Slot
EXTSLT10  CALL      RDKMASB1     * Read Next Slot
          BRANCH    OVRCD,EXTSLT99
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          MATCH     KEY28,KEY31
          GOTO      EXTSLT99 IF NOT EQUAL
.
          SUB       ONE,NEWSLOTS
          COMPARE   ZERO,NEWSLOTS
          GOTO      EXTSLT30 IF EQUAL
.
          MOVE      NEWVTYP,OMBVTYP
          MOVE      SLPARENT,OMBEXSL
          CALL      UPMASB1
          GOTO      EXTSLT10
.
EXTSLT20  CALL      RDKMASB1     * Read Next Slot
          BRANCH    OVRCD,EXTSLT99
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
          MATCH     KEY28,KEY31
          GOTO      EXTSLT99 IF NOT EQUAL
.
EXTSLT30  COMPARE   SLPARENT,OMBEXSL
          GOTO      EXTSLT99 IF NOT EQUAL
.
          IF        NUMSLVIS = ONE
            MOVE      NEWVTYP,OMBVTYP
          ELSE    
            MOVE      "R  ",OMBVTYP
          ENDIF
          MOVE      ZERO,OMBEXSL
          CALL      UPMASB1
          GOTO      EXTSLT20
.
EXTSLT99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRMAB00  MOVE      SP70,OMBSITE 
          MOVE      SP70,OMBCLIN
          MOVE      ZERO,OMBDAY
          MOVE      SP70,OMBSTRT
          MOVE      ZERO,OMBSLOT
          MOVE      SP70,OMBVTYP
          MOVE      SP70,OMBTIME
          MOVE      ZERO,OMBEXSL
          MOVE      SP70,DOTMBRES
          MOVE      SP70,OTMBSHNO
          MOVE      SP70,OTMBSDAT
          MOVE      SP70,OMBSPARE
.
CLRMAB99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
MABSAV00  MOVE      WBSESIT,OMBSITE 
          MOVE      OTCLI001,OMBCLIN
          MOVE      OTMAS001,OMBDAY
          MOVE      OTMAS002,OMBSTRT
          MOVE      OTMAB001,OMBSLOT
          MOVE      OTMAB002,OMBVTYP
          MOVE      OTMAB003,OMBTIME
          MOVE      OTHED005,OTMBSHNO
          MOVE      OTHED006,OTMBSDAT
          MOVE      ZERO,OMBEXSL
          MOVE      SP70,DOTMBRES
          MOVE      SP70,OMBSPARE
.
MABSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields and checks for blank
.------------------------------------------------------------------
CHKMAB00  COMPARE   ZERO,OTMAB001 
          GOTO      CHKMAB90 IF EQUAL
.
          IF        OTMAB001>=900
            GOTO      CHKMAB95         * Slots > than 900 are for over bookings
          ENDIF
.
          PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,CHKMAB94
.
          PACK      KEY28,WBSESIT,OTHED002,OTHED003,OTHED004:
                          OTHED005,OTHED006,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,CHKMAB94
.
          MATCH     OTHESTRT,OTMAB003
          GOTO      CHKMAB93 IF LESS
          MATCH     OTMAB003,OTHESEND
          GOTO      CHKMAB93 IF LESS
.
          RESET     OTMAB002
          MATCH     SP70,OTMAB002
          GOTO      CHKMAB91 IF EQUAL
.
          RESET     OTMAB003
          MATCH     SP70,OTMAB003
          GOTO      CHKMAB92 IF EQUAL
.
          MATCH     Z70,OTHED005
          GOTO      CHKMAB96 IF EQUAL
.
          MATCH     Z70,OTHED006
          GOTO      CHKMAB96 IF EQUAL
.
          GOTO      CHKMAB98
.
CHKMAB90  MOVE      "Slot Number is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAB99
.
CHKMAB91  MOVE      "Visit Type is mandatory.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAB99
.
CHKMAB92  MOVE      "Slot Time is mandatory.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAB99
.
CHKMAB93  MOVE      "Slot Time Out of Range.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAB99
.
CHKMAB94  MOVE      "Invalid Clinic Master.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAB99
.
CHKMAB95  MOVE      "Slot numbers => 900 are for over bookings only.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAB99
.
CHKMAB96  MOVE      "Schedule Number/Open date are Mandatory Fields.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKMAB99
.
CHKMAB98  MOVE      ZERO,EXIT
CHKMAB99  RETURN
.---------------------------------------------------------------------
. Outpatient Clinic Session Details: Display Date Table, Open Sessions 
.---------------------------------------------------------------------
OUTSES00  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70   
          CALL      RDCLIA1
          BRANCH    OVRCD,OUTSES91         
.
          PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,OUTSES92         
.
          PACK      KEY28,WBSESIT,OTHED002,OTHED003,OTHED004:
                          OTHED005,OTHED006,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,OUTSES94         
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTSES40 IF EQUAL
.
.--------*T0823386-Check if site is active before opening sessions
          MATCH     "A",UPDTTYPE    * Add formaction
          IF        @EQUAL
            MATCH     "1",OTSTACTV               * Inactive site?
            GOTO      OUTSES95 IF EQUAL           * Yes then error message
            GOTO      OUTSES10 IF NOT EQUAL       * No then open sessions
          ENDIF
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTSES20 IF EQUAL
.
          GOTO      OUTSES90
.
.         ************ ADD FORMACTION **********
.
OUTSES10  MOVE      "Clinic Session Detail Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,OUTSES99
.
          CALL      SLOTOT00      * Get total slot & time statistics
          CALL      SAVMON00      * Loop through months and save Sessions 
.
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      OUTSES99
.
.         ************ DELETE FORMACTION **********
.
OUTSES20  MOVE      "Clinic Session Detail Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,OUTSES99
.
          CALL      DELSES00      * Delete Sessions 
          CALL      ULODAT00      * Update Last Session Open Date
.
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      OUTSES99
.
.         ************ DISPLAY FORMACTION **********
.
OUTSES40  COMPARE   ONE,OMASTAT  * Check if Clinic Master is Active
          IF        @EQUAL 
            GOTO      OUTSES93 
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Session Detail Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTSES99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTSES99
.
OUTSES90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTSES99
.
OUTSES91  MOVE      "Invalid Clinic.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTSES99
.
OUTSES92  MOVE      "Invalid Clinic Master.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTSES99
.
OUTSES93  MOVE      "Clinic Master Inactive! You can't open/",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "delete sessions.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTSES99
.
OUTSES94  MOVE      "Invalid Slot Template Master.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTSES99
.
OUTSES95  CLEAR     WEBTITLE
          APPEND    "Error:\nOP Site ",WEBTITLE
          MOVE      OSTSITE,D6
          STRIP     D6
          APPEND    D6,WEBTITLE
          APPEND    " is Inactive.\n",WEBTITLE
          APPEND    "Clinics cannot be opened in Inactive sites.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTSES99
.
OUTSES99  RETURN
.
.---------------------------------------------------------------------
.                            DELSES00
.  Matches input cgi date and dates on file if equal no delete. 
.  Then checks if a session is Booked for the corresponding date 
.  if booked no records are deleted. The next date is read in. 
.                                                 called by: OUTSES00
.---------------------------------------------------------------------
DELSES00  MOVE      ZERO,KEEPCNTR
.
          PACK      KEY26,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70 
          CALL      RDSSESA3
DELSES10  CALL      RDKSESA3 
          BRANCH    OVRCD,DELSES99
.
          MATCH     WBSESIT,OSESITE
          GOTO      DELSES99 IF NOT EQUAL
.
          MATCH     OTCLI001,OSECLIN 
          GOTO      DELSES99 IF NOT EQUAL
.
          MATCH     OTMAS001,DOSEDAY 
          GOTO      DELSES99 IF NOT EQUAL
.
          MATCH     OTMAS002,OSESTRT 
          GOTO      DELSES99 IF NOT EQUAL
.
          UNPACK    OSEDATE,KEY4            * Check that Deleting for selected
          MATCH     KEY4,SHOWYEAR           * year....
          IF        !@EQUAL
            ADD       ONE,KEEPCNTR
            IF        KEEPCNTR >= 50
              WRITE     HTMLFILE;"<!-- Keep Alive -->"
              MOVE      ZERO,KEEPCNTR
            ENDIF
            GOTO      DELSES10
          ENDIF
.
          CALL      SESDTE00    * Match OSEDATE with cgi paramater ticked  
          BRANCH    EXIT,DELSES10  * They are equal no delete! 
.
          CALL      BOKCHK00    * Check if Ok to delete! Date has no bookings?
          BRANCH    EXIT,DELSES10  * A record is Booked read next date!  
.
          CALL      DELBOK00    * No records are booked, delete booking.
          CALL      SESDEL00    * Delete Session Record 
.
          GOTO      DELSES10    * Read Next Date.
.
DELSES99  RETURN
.---------------------------------------------------------------------
.    Match OSEDATE with cgi paramater ticked 
.                                                  called by: DELSES00 
.--------------------------------------------------------------------
SESDTE00  MOVE      ZERO,EXIT
          MOVE      ONE,MONTHNO
          MOVE      ONE,WEEKNO
          WHILE     (MONTHNO<=12)
            WHILE     (WEEKNO<=5)
              MATCH     SP70,MTHDTE[MONTHNO][WEEKNO]   * = corresponding date
              IF        !@EQUAL
                MATCH     OSEDATE,MTHDTE[MONTHNO][WEEKNO]            
                IF        @EQUAL
                  MOVE      ONE,EXIT
                  GOTO      SESDTE99
                ENDIF 
              ENDIF
.
              MATCH     OSESSHNO,OTHESHNO
              IF        !@EQUAL
                MOVE      ONE,EXIT                  * Can only delete session
                GOTO      SESDTE99                  * that are from the same
              ENDIF                                 * schedule number and date
              MATCH     OSESSDAT,OTHESDAT
              IF        !@EQUAL
                MOVE      ONE,EXIT
                GOTO      SESDTE99
              ENDIF
.
              ADD       ONE,WEEKNO
            DO
          ADD       ONE,MONTHNO
          MOVE      ONE,WEEKNO
          DO
.
SESDTE99  RETURN
.---------------------------------------------------------------------
.                            BOKCHK00
. Reads through each Slot or Time for Date and returns whether there
. is a booking or not!                           called by: DELSES00 
. Ignore extended and unavailable slots
.---------------------------------------------------------------------
BOKCHK00  MOVE      ZERO,EXIT
.
          PACK      KEY28,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
          CALL      RDSBOKA1
BOKCHK10  CALL      RDKBOKA1
          BRANCH    OVRCD,BOKCHK99
.
          MATCH     OSESITE,OBASITE
          GOTO      BOKCHK99 IF NOT EQUAL
.
          MATCH     OSECLIN,OBACLIN 
          GOTO      BOKCHK99 IF NOT EQUAL
.
          MATCH     OSEDATE,OBADATE 
          GOTO      BOKCHK99 IF NOT EQUAL
.
          MATCH     OSESTRT,OBASTRT 
          GOTO      BOKCHK99 IF NOT EQUAL
.
          IF        OBASTAT = 3
            GOTO      BOKCHK10                   * Ignore extended slots
          ENDIF
.
          MOVE      "CV",CATEGORY
          MOVE      OBAVISIT,CODE
          CALL      GETCOD00
.
          MATCH     ANSU,TCINDC6
          GOTO      BOKCHK10 IF EQUAL            * Ignore unavailable slots
.
          IF        OBASTAT <> 0
            MOVE      ONE,EXIT
            GOTO      BOKCHK99
          ENDIF
.
          GOTO      BOKCHK10
.           
BOKCHK99  RETURN
.---------------------------------------------------------------------
.                            DELBOK00
.  Reads through each Slot or Time for Date and Deletes Session Booking 
.  record.                                          called by: DELSES00  
.---------------------------------------------------------------------
DELBOK00  PACK      KEY28,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
          CALL      RDSBOKA1
DELBOK10  CALL      RDKBOKA1
          BRANCH    OVRCD,DELBOK99
          MATCH     OSESITE,OBASITE
          GOTO      DELBOK99 IF NOT EQUAL
          MATCH     OSECLIN,OBACLIN 
          GOTO      DELBOK99 IF NOT EQUAL
          MATCH     OSEDATE,OBADATE 
          GOTO      DELBOK99 IF NOT EQUAL
          MATCH     OSESTRT,OBASTRT 
          GOTO      DELBOK99 IF NOT EQUAL
.
          PACK      KEY28,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          CALL      RDBOKA1
          IF        OVRCD=0
            CALL      DEBOKA1
            CALL      RDSBOKA1
          ENDIF
.
          PACK      KEY28,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          CALL      DEOTBOX1
.
          GOTO      DELBOK10
.           
DELBOK99  RETURN
.---------------------------------------------------------------------
.                            SESDEL00
.  Reads session record with INDEX1 and Deletes with INDEX1
.                                            called by: DELSES00  
.---------------------------------------------------------------------
SESDEL00  PACK      KEY25,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
          CALL      RDSESA1
          BRANCH    OVRCD,SESDEL99
.
          CALL      DESESA1
.
SESDEL99  RETURN
.------------------------------------------------------------
. Outpatient Clinic Template Mapping Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
OUTCTM00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTCTM40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OUTCTM10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OUTCTM20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTCTM30 IF EQUAL
.
          GOTO      OUTCTM93
.
.         ************ ADD FORMACTION **************           
.
OUTCTM10  CALL      CHKCTM00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,OUTCTM99
.
          PACK      KEY25,OTWMP007,OTCLI001,OTWMP002,OTWMP003,OTWMP004,SP70 
          CALL      RDOTWM1
          COMPARE   ZERO,OVRCD
          GOTO      OUTCTM92 IF EQUAL
.
          CALL      CTMSAV00      * Moves input variables to file variables
.
          CALL      WROTWM1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      OUTCTM99
.
.         ************ UPDATE FORMACTION ************                      
.
OUTCTM20  PACK      KEY25,OTWMP007,OTCLI001,OTWMP002,OTWMP003,OTWMP004,SP70 
          CALL      RDOTWM1
          BRANCH    OVRCD,OUTCTM91
.
          CALL      CHKCTM00      * Checks mandatory fields
          BRANCH    EXIT,OUTCTM99
.
          CALL      CTMSAV00      * Moves input variables to file variables
.
          CALL      UPOTWM1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      OUTCTM99
.
.         ************ DELETE FORMACTION **********
.
OUTCTM30  PACK      KEY25,OTWMP007,OTCLI001,OTWMP002,OTWMP003,OTWMP004,SP70 
          CALL      RDOTWM1
          BRANCH    OVRCD,OUTCTM91
.
          CALL      DEOTWM1       * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      OUTCTM99
.
.         ************ DISPLAY FORMACTION **********
.
OUTCTM40  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70
          CALL      RDCLIA1
          BRANCH    OVRCD,OUTCTM94 
.
          PACK      KEY25,OTWMP007,OTCLI001,OTWMP002,OTWMP003,OTWMP004,SP70 
          CALL      RDOTWM1
          IF        OVRCD=1
            CALL      CLRCTM00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Template Mapping Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTCTM99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTCTM99
.
OUTCTM91  MOVE      "Clinic mapping does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCTM99
.
OUTCTM92  MOVE      "Clinic mapping exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCTM99
.
OUTCTM93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCTM99
.
OUTCTM94  MOVE      "Invalid Clinic.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCTM99
.
OUTCTM99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRCTM00  MOVE      SP70,OTWMCLID   
          MOVE      SP70,OTWMMPSV   
          MOVE      SP70,OTWMMPRP   
          MOVE      SP70,OTWMMPTP   
          MOVE      SP70,OTWMMPTT
          MOVE      SP70,OTWMDESC  
          MOVE      SP70,OTWMSITE
          MOVE      SP70,OTWMSPAR  
.
CLRCTM99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
CTMSAV00  MOVE      OTWMP001,OTWMCLID
          MOVE      OTWMP002,OTWMMPSV
          MOVE      OTWMP003,OTWMMPRP
          MOVE      OTWMP004,OTWMMPTP
          MOVE      OTWMP005,OTWMMPTT
          MOVE      OTWMP006,OTWMDESC
          MOVE      OTWMP007,OTWMSITE
.
CTMSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields and checks for blank
.------------------------------------------------------------------
CHKCTM00  RESET     OTWMP002
          MATCH     SP70,OTWMP002
          GOTO      CHKCTM90 IF EQUAL
.
          RESET     OTWMP003
          MATCH     SP70,OTWMP003
          GOTO      CHKCTM91 IF EQUAL
.
          RESET     OTWMP004
          MATCH     SP70,OTWMP004
          GOTO      CHKCTM92 IF EQUAL
.
          RESET     OTWMP007
          MATCH     SP70,OTWMP007
          GOTO      CHKCTM93 IF EQUAL
.
          GOTO      CHKCTM98
.
CHKCTM90  MOVE      "Map from Server is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCTM99
.
CHKCTM91  MOVE      "Map from Report is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCTM99
.
CHKCTM92  MOVE      "Map from Template is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCTM99
.
CHKCTM93  MOVE      "Map from Site is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCTM99
.
CHKCTM98  MOVE      ZERO,EXIT
.
CHKCTM99  RETURN
.
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110,PROFL120,PROFL130
          GOTO      PROFLD99
.
.   Outpatient Clinic Type Maintenance
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12
.
PROFLD11  CALL      OCTY0000    * Outpatient Clinic Type Maintenance
          GOTO      PROFLD99 
.
PROFLD12  CALL      OTTX0000    * Outpatient Extra Templates
          GOTO      PROFLD99
.
.   Outpatient Clinic Maintenance
.
PROFLD20  CALL      OCLI0000    
          GOTO      PROFLD99 
.
.   Outpatient Clinic Leave Maintenance
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31,PROFLD32
          GOTO      PROFLD99 
.
PROFLD31  CALL      OCLI0000     * Outpatient Clinic 
          GOTO      PROFLD99 
.
PROFLD32  CALL      OCLV0000     * Outpatient Clinic Leave   
          GOTO      PROFLD99 
.
.   Outpatient Clinic Schedule
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41,PROFLD42,PROFLD43,PROFLD44:
                             PROFLD45
          GOTO      PROFLD99 
.
PROFLD41  CALL      OCLI0000     * Outpatient Clinic 
          GOTO      PROFLD99 
.
PROFLD42  CALL      OMAS0000     * Outpatient Clinic Schedule 
          GOTO      PROFLD99 
.
PROFLD43  CALL      OMSP0000
          GOTO      PROFLD99
.
PROFLD44  CALL      OWMP0000     * Outpatient Clinic Template Details
          GOTO      PROFLD99 
.
PROFLD45  CALL      OTMS0000     * Suspended Appointment Details
          GOTO      PROFLD99
.
.   Outpatient Clinic Slot Template
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51,PROFLD52,PROFLD53,PROFLD54
          GOTO      PROFLD99 
.
PROFLD51  CALL      OCLI0000     * Outpatient Clinic 
          GOTO      PROFLD99 
.
PROFLD52  CALL      OMAS0000     * Outpatient Clinic Schedule 
          GOTO      PROFLD99 
.
PROFLD53  CALL      OMAB0000     * Outpatient Clinic Slot Details
          GOTO      PROFLD99 
.
PROFLD54  CALL      OHED0000     * Outpatient Header Template File
          GOTO      PROFLD99 
.
.   Outpatient Clinic Session Details
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62,PROFLD63,PROFLD64
          GOTO      PROFLD99
.
PROFLD61  CALL      OCLI0000     * Outpatient Clinic 
          GOTO      PROFLD99 
.
PROFLD62  CALL      OMAS0000     * Outpatient Clinic Schedule 
          GOTO      PROFLD99 
.
PROFLD63  CALL      OSES0000     * Outpatient Clinic Session Details
          GOTO      PROFLD99 
.
PROFLD64  CALL      OHED0000     * Outpatient Header Template File
          GOTO      PROFLD99
.
.   Outpatient Clinic Template Details
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71,PROFLD72
          GOTO      PROFLD99 
.
PROFLD71  CALL      OCLI0000     * Outpatient Clinic 
          GOTO      PROFLD99 
.
PROFLD72  CALL      OWMP0000     * Outpatient Clinic Template Details
          GOTO      PROFLD99 
.
.   Suspended Appointment Tags         
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81
          GOTO      PROFLD99 
.
PROFLD81  CALL      OTMS0000
          GOTO      PROFLD99
.
.   Clinic Type Diagnosis Maintenance
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91
          GOTO      PROFLD99
.
PROFLD91  CALL      OTCD0000     * Clinic Type Diagnosis Maintenance
          GOTO      PROFLD99
.
PROFL100  CALL      OCCC0000
          GOTO      PROFLD99
.
.   Clinic Type Procedure Maintenance
.
PROFL110  BRANCH    FLDSETNO,PROFL111
          GOTO      PROFLD99
.
PROFL111  CALL      OTCP0000     * Clinic Type Procedure Maintenance
          GOTO      PROFLD99
.
.
.   Clinic Type Problem Maintenance
.
PROFL120  BRANCH    FLDSETNO,PROFL121
          GOTO      PROFLD99
.
PROFL121  CALL      OTPB0000     * Clinic Type Problem Maintenance
          GOTO      PROFLD99
.
.   Clinic Type Linked Visit Type Maintenance
.
PROFL130  BRANCH    FLDSETNO,PROFL131,PROFL132
          GOTO      PROFLD99
.
PROFL131  CALL      OTCV0000    * Outpatient Linked Visit Type Maintenance
          GOTO      PROFLD99

PROFL132  CALL      OCTY0000    * Outpatient Clinic Type Maintenance
          GOTO      PROFLD99

PROFLD99  RETURN
.------------------------------------------------------------
. Outpatient Clinic Type : Option 1
.------------------------------------------------------------
OCTY0000  BRANCH    FLDITMNO,OCTY0100,OCTY0200,OCTY0300,OCTY0400,OCTY0500:
                             OCTY0600,OCTY0700,OCTY0800,OCTY0900,OCTY1000:
                             OCTY1100,OCTY1200,OCTY1300,OCTY1400,OCTY1500:
                             OCTY1600,OCTY1700,OCTY1800,OCTY1900,OCTY2000:
                             OCTY2100,OCTY2200
          GOTO      OCTY9999
.
OCTY0100  WRITE     HTMLFILE;OCTCTYP;
          GOTO      OCTY9999
.
OCTY0200  WRITE     HTMLFILE;OCTDESC; 
          GOTO      OCTY9999
.
OCTY0300  MOVE      "CG",CATEGORY
          MOVE      OCTGRP,CODE
          CALL      CODITM00
          GOTO      OCTY9999
.
OCTY0400  WRITE     HTMLFILE;OCTBKT; 
          GOTO      OCTY9999
.
OCTY0500  WRITE     HTMLFILE;OCTATT; 
          GOTO      OCTY9999
.
OCTY0600  WRITE     HTMLFILE;OCTACT; 
          GOTO      OCTY9999
.
OCTY0700  CALL      OCTAB000   * Table of Outpatient Clinic Type
          GOTO      OCTY9999
.
OCTY0800  CALL      NEXTGR00   * Next set of Clinic Types 
          GOTO      OCTY9999
.
OCTY0900  CALL      PREVGR00   * Previous set of Clinic Types 
          GOTO      OCTY9999
.                                           
OCTY1000  MOVE      "CQ",CATEGORY           * adding option here HPS 
          MOVE      OCTVACS,CODE
          CALL      CODITM00
          GOTO      OCTY9999
.
OCTY1100  CALL      OUTSIT00   * Outpatient site code 
          GOTO      OCTY9999
.                                           
OCTY1200  MOVE      "WU",CATEGORY 
          MOVE      OCTWUNIT,CODE
          CALL      CODITM00
          GOTO      OCTY9999
.
OCTY1300  WRITE     HTMLFILE;OTCNAUPD; 
          GOTO      OCTY9999
.
OCTY1400  WRITE     HTMLFILE;OCTUSDF1; 
          GOTO      OCTY9999
.
OCTY1500  WRITE     HTMLFILE;OCTUSDF2; 
          GOTO      OCTY9999
.
OCTY1600  WRITE     HTMLFILE;FILTACTV; 
          GOTO      OCTY9999
.
OCTY1700  PACK      KEY21,WBSESIT,OCTCTYP,SP70       * Diagnosis record exists?
          CALL      RSOTCDC1
          CALL      RKOTCDC1
          BRANCH    OVRCD,OCTY9999
.
          MATCH     WBSESIT,OTCDSITE
          GOTO      OCTY9999 IF NOT EQUAL
.
          MATCH     OCTCTYP,OTCDCTYP
          GOTO      OCTY9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;"1";                     * Make button red
          GOTO      OCTY9999
.
OCTY1800  PACK      KEY15,WBSESIT,OCTCTYP,SP70       * Owner record exists?
          CALL      RSOTCCT1
          CALL      RKOTCCT1
          BRANCH    OVRCD,OCTY9999
.
          MATCH     WBSESIT,OTCCSITE
          GOTO      OCTY9999 IF NOT EQUAL
.
          MATCH     OTCCCTYP,OCTCTYP
          GOTO      OCTY9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;"1";                     * Make button red
          GOTO      OCTY9999
.
OCTY1900  PACK      KEY21,WBSESIT,OCTCTYP,SP70       * Procedure record exists?
          CALL      RSOTCPC1
          CALL      RKOTCPC1
          BRANCH    OVRCD,OCTY9999
.
          MATCH     WBSESIT,OTCPSITE
          GOTO      OCTY9999 IF NOT EQUAL
.
          MATCH     OCTCTYP,OTCPCTYP
          GOTO      OCTY9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;"1";                     * Make button red
          GOTO      OCTY9999
.
OCTY2000  PACK      KEY21,WBSESIT,OCTCTYP,SP70       * Problem record exists
          CALL      RSOTCPB1
          CALL      RKOTCPB1
          BRANCH    OVRCD,OCTY9999
.
          MATCH     WBSESIT,OTPBSITE
          GOTO      OCTY9999 IF NOT EQUAL
.
          MATCH     OCTCTYP,OTPBCTYP
          GOTO      OCTY9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;"1";                     * Make button red
          GOTO      OCTY9999
.
OCTY2100  MOVE      "CV",CATEGORY
          MOVE      OCTDEFCV,CODE
          CALL      CODITM00
          GOTO      OCTY9999
.
OCTY2200  PACK      KEY15,WBSESIT,OCTCTYP,SP70       * Visit Type record exists?
          CALL      RSOTCVT1
          CALL      RKOTCVT1
          BRANCH    OVRCD,OCTY9999
.
          MATCH     WBSESIT,OCVTSITE
          GOTO      OCTY9999 IF NOT EQUAL
.
          MATCH     OCTCTYP,OCVTCTYP
          GOTO      OCTY9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;"1";                     * Make button red
          GOTO      OCTY9999
.
OCTY9999  RETURN
.
.-------------------------------------------------------------------------------
. Outpatient Contract Codes
.-------------------------------------------------------------------------------
OCCC0000  BRANCH    FLDITMNO,OCCC0100,OCCC0200,OCCC0300,OCCC0400,OCCC0500:
                             OCCC0600,OCCC0700,OCCC0800,OCCC0900,OCCC1000:
                             OCCC1100,OCCC1200,OCCC1300,OCCC1400,OCCC1500
          GOTO      OCCC9999
.
OCCC0100  IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY15,WBSESIT,CLINTYPE,STARTKEY,SP70
          CALL      RSOTCCT1
OCCC0101  CALL      RKOTCCT1
.
          BRANCH    OVRCD,OCCC9999
.
          MATCH     WBSESIT,OTCCSITE 
          GOTO      OCCC9999 IF NOT EQUAL
.
          MATCH     OTCCCTYP,CLINTYPE
          GOTO      OCCC9999 IF NOT EQUAL
.
          PACK      KEY5,CATgb,OTCCCONT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,OCCC0101
.
          MATCH     "A",PTCOACTV
          IF        @EQUAL
            MOVE      "Active  ",DIM8
          ELSE
            MOVE      "Inactive",DIM8
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      OCCC0101 
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td><a href='javascript:ShowDetail10":
                             "(#"outweb05.pbl?reportno=10&template=003":
                             "&clintype=",CLINTYPE,"&contcode=",OTCCCONT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif ":
                             "class=ListIcon></a>",OTCCCONT,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",DIM8,"</td></tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      OCCC0101 IF NOT EQUAL
.
          GOTO      OCCC9999
.
OCCC0200  MOVE      CATgb,CATEGORY
          CALL      CODSEL00
.
          GOTO      OCCC9999
.
OCCC0300  WRITE     HTMLFILE;CLINTYPE;
          GOTO      OCCC9999
.
OCCC0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OCCC0401

          WRITE     HTMLFILE;CONTCODE;
          GOTO      OCCC9999
.
OCCC0401  PACK      KEY5,CATgb,CONTCODE
          CALL      RDCODE1
          IF        OVRCD=1
            WRITE     HTMLFILE;"Unknown Code: ",CONTCODE;
          ELSE
            WRITE     HTMLFILE;TDESC;
          ENDIF
          GOTO      OCCC9999
.
OCCC0500  WRITE     HTMLFILE;OTCCSITE;
          GOTO      OCCC9999
.
OCCC0600  WRITE     HTMLFILE;OTCCCTYP;
          GOTO      OCCC9999
.
OCCC0700  WRITE     HTMLFILE;OTCCCONT;
          GOTO      OCCC9999
.
OCCC0800  WRITE     HTMLFILE;OTCCCDAT;
          GOTO      OCCC9999
.
OCCC0900  WRITE     HTMLFILE;OTCCCTIM;
          GOTO      OCCC9999
.
OCCC1000  WRITE     HTMLFILE;OTCCCUID;
          GOTO      OCCC9999
.
OCCC1100  WRITE     HTMLFILE;OTCCUDAT;
          GOTO      OCCC9999
.
OCCC1200  WRITE     HTMLFILE;OTCCUTIM;
          GOTO      OCCC9999
.
OCCC1300  WRITE     HTMLFILE;OTCCUUID;
          GOTO      OCCC9999
.
OCCC1400  CALL      PRVCCC00
          GOTO      OCCC9999
.
OCCC1500  CALL      NXTCCC00
          GOTO      OCCC9999
.
OCCC9999  RETURN
.------------------------------------------------------------
. Outpatient Clinic Maintenance : Option 2 
.------------------------------------------------------------
OCLI0000  BRANCH    FLDITMNO,OCLI0100,OCLI0200,OCLI0300,OCLI0400,OCLI0500:
                             OCLI0600,OCLI0700,OCLI0800,OCLI0900,OCLI1000:
                             OCLI1100,OCLI1200,OCLI1300,OCLI1400,OCLI1500
                                            * HPS ODC Code Added OCLI1300
          GOTO      OCLI9999
.
OCLI0100  WRITE     HTMLFILE;OCACLIN;
          GOTO      OCLI9999
.
OCLI0200  WRITE     HTMLFILE;OCADOCT; 
          GOTO      OCLI9999
.
OCLI0300  WRITE     HTMLFILE;OCADESC; 
          GOTO      OCLI9999
.
OCLI0400  WRITE     HTMLFILE;OCACCONS; 
          GOTO      OCLI9999
.
OCLI0500  MATCH     "1",OTCLIACT  
          IF        @EQUAL 
            WRITE     HTMLFILE;OTCLIACT; 
          ELSE
            WRITE     HTMLFILE;"0"; 
          ENDIF 
          GOTO      OCLI9999
.
OCLI0600  MOVE      ZERO,LNK2PRT 
          CALL      CITAB000   * Table of Outpatient Clinics 
          GOTO      OCLI9999
.
OCLI0700  CALL      NEXTGR00   * Next set of Clinic Types 
          GOTO      OCLI9999
.
OCLI0800  CALL      PREVGR00   * Previous set of Clinic Types 
          GOTO      OCLI9999
.
OCLI0900  MOVE      OCADOCT,KEY10     * Doctor Formatted Name
          CALL      RDPMHCP1
          IF        OVRCD=1
            GOTO      OCLI9999 
          ENDIF
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          CLEAR     DOCTOR
          APPEND    DOCFNAME,DOCTOR 
          WRITE     HTMLFILE;DOCTOR;
          GOTO      OCLI9999
.
OCLI1000  MOVE      OCACCONS,KEY6    * Consultant Formatted Name
          CALL      RDDOCT1
          IF        OVRCD=1
            GOTO      OCLI9999 
          ENDIF
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          CLEAR     DOCTOR
          APPEND    DOCFNAME,DOCTOR 
          WRITE     HTMLFILE;DOCTOR;
          GOTO      OCLI9999
.
OCLI1100  MOVE      ONE,LNK2PRT   * Update Parent 
          CALL      CITAB000      * Table of Outpatient Clinics 
          GOTO      OCLI9999
.
OCLI1200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OCLI1250
          UNPACK    OCADATE,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY12;
          GOTO      OCLI9999

OCLI1250  WRITE     HTMLFILE;OCADATE;
          GOTO      OCLI9999
.
OCLI1300  MATCH     SP70,OCADESC            * HPS-ODC Code Starts here 
          IF        @EQUAL
            MOVE      OCADOCT,KEY6          * Doctor Formatted Name
            CALL      RDDOCT1
            IF        OVRCD=1
              GOTO      OCLI9999
            ENDIF
            MOVE      DTITL,FMTTITLE
            MOVE      DGNAME,FMTGNAME
            MOVE      DSNAME,FMTSNAME
            CALL      DOCNM000
            CLEAR     DOCTOR
            APPEND    DOCFNAME,DOCTOR
            WRITE     HTMLFILE;DOCTOR; 
          ELSE  
              WRITE     HTMLFILE;OCADESC;
          ENDIF
          GOTO      OCLI9999                * HPS-ODC Code Ends Here
.
OCLI1400  CALL      OPNL0000                * Open session list by date range  
          GOTO      OCLI9999
.
OCLI1500  WRITE     HTMLFILE;FILTACTV;
          GOTO      OCLI9999
.
OCLI9999  RETURN
.------------------------------------------------------------
. Outpatient Clinic Leave Maintenance : Option 3 
.------------------------------------------------------------
OCLV0000  BRANCH    FLDITMNO,OCLV0100,OCLV0200,OCLV0300,OCLV0400,OCLV0500:
                             OCLV0600,OCLV0700
          GOTO      OCLV9999
.
OCLV0100  UNPACK    OTCVFDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      FROMDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;FROMDATE;
          GOTO      OCLV9999
.
OCLV0200  UNPACK    OTCVTDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      TODATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR 
          WRITE     HTMLFILE;TODATE;
          GOTO      OCLV9999
.
OCLV0300  MOVE      "DH",CATEGORY
          MOVE      OTCVREAS,CODE
          CALL      CODITM00 
          GOTO      OCLV9999
.
OCLV0400  CALL      CVTAB000   * Table of Outpatient Clinic Leave 
          GOTO      OCLV9999
.
OCLV0500  CALL      NEXTYR00   * Link to Next Year 
          GOTO      OCLV9999
.
OCLV0600  CALL      PREVYR00   * Link to Previous Year 
          GOTO      OCLV9999
.
OCLV0700  CALL      SETYR000 * Sets current year Depending Next or Prev Page   
          GOTO      OCLV9999
.
OCLV9999  RETURN
.------------------------------------------------------------
. Outpatient Clinic Schedule : Option 4 
.------------------------------------------------------------
OMAS0000  BRANCH    FLDITMNO,OMAS0100,OMAS0200,OMAS0300,OMAS0400,OMAS0500:
                             OMAS0600,OMAS0700,OMAS0800,OMAS0900,OMAS1000:
                             OMAS1100,OMAS1200,OMAS1300,OMAS1400,OMAS1500:
                             OMAS1600,OMAS1700,OMAS1800,OMAS1900,OMAS2000:
                             OMAS2100,OMAS2200,OMAS2300,OMAS2400,OMAS2500:
                             OMAS2600,OMAS2700,OMAS2800,OMAS2900,OMAS3000:
                             OMAS3100,OMAS3200,OMAS3300,OMAS3400,OMAS3500:
                             OMAS3600,OMAS3700,OMAS3800,OMAS3900,OMAS4000:
                             OMAS4100,OMAS4200,OMAS4300,OMAS4400,OMAS4500:
                             OMAS4600,OMAS4700,OMAS4800,OMAS4900,OMAS5000:
                             OMAS5100,OMAS5200,OMAS5300,OMAS5400,OMAS5500:
                             OMAS5600,OMAS5700,OMAS5800,OMAS5900,OMAS6000:
                             OMAS6100,OMAS6200,OMAS6300,OMAS6400,OMAS6500:
                             OMAS6600,OMAS6700,OMAS6800,OMAS6900,OMAS7000:
                             OMAS7100,OMAS7200,OMAS7300,OMAS7400,OMAS7500:
                             OMAS7600,OMAS7700,OMAS7800,OMAS7900,OMAS8000:
                             OMAS8100,OMAS8200,OMAS8300,OMAS8400,OMAS8500:
                             OMAS8600,OMAS8700,OMAS8800,OMAS8900,OMAS9000:
                             OMAS9100,OMAS9200,OMAS9300,OMAS9400,OMAS9500:
                             OMAS9600,OMAS9700,OMAS9800,OMAS9900
.
          GOTO      OMAS9999
.
OMAS0100  MATCH     SP70,DOMADAY         * Set Table Day of Week Display
          IF        !@EQUAL
            WRITE     HTMLFILE;DOMADAY;   * Day Indicator
          ENDIF
          GOTO      OMAS9999
.
OMAS0200  WRITE     HTMLFILE;OMASTART;  * Start Time
          GOTO      OMAS9999
.
OMAS0300  WRITE     HTMLFILE;OMAFIN,KSECONDS;    * Finish Booking Time 
          GOTO      OMAS9999                     * HPS-ODC KSECONDS is added
.
OMAS0400  WRITE     HTMLFILE;OMAEND,KSECONDS;    * End Session Time 
          GOTO      OMAS9999                     * HPS-ODC KSECONDS is added 
.
OMAS0500  CALL      CLITYP00            * Clinic Type Selection List     
          GOTO      OMAS9999
.
OMAS0600  MOVE      "CI",CATEGORY       * Clinic Indicator M=MEDICAL
          MOVE      OMACIND,CODE        *                  N=NON-MEDICAL
          CALL      CODITM00  
          GOTO      OMAS9999
.
OMAS0700  MATCH     SP70,OMAREG
          GOTO      OMAS9999 IF EQUAL
          WRITE     HTMLFILE;OMAREG;    * Registrars Clinic (Y/N) 
          GOTO      OMAS9999
.
OMAS0800  MATCH     SP70,OMAKDOC
          GOTO      OMAS9999 IF EQUAL
          WRITE     HTMLFILE;OMAKDOC;   * Accept Doctor Code (Y/N) 
          GOTO      OMAS9999
.
OMAS0900  MATCH     SP70,OMACOM1 
          GOTO      OMAS9999 IF EQUAL
          WRITE     HTMLFILE;OMACOM1;   * Comment Line 1 
          GOTO      OMAS9999
.
OMAS1000  MATCH     SP70,OMACOM2
          GOTO      OMAS9999 IF EQUAL
          WRITE     HTMLFILE;OMACOM2;   * Comment Line 2 
          GOTO      OMAS9999
.
OMAS1100  WRITE     HTMLFILE;OMADURN;   * Slot Duration (MINS)
          GOTO      OMAS9999
.
OMAS1200  COMPARE   ZERO,OMANEWSL
          GOTO      OMAS9999 IF EQUAL
          WRITE     HTMLFILE;OMANEWSL;  * No. of Slots for New Visit
          GOTO      OMAS9999
.
OMAS1300  COMPARE   ZERO,OMASPCSL 
          GOTO      OMAS9999 IF EQUAL
          WRITE     HTMLFILE;OMASPCSL;  * No. of Slots for Special Visit
          GOTO      OMAS9999
.
OMAS1400  WRITE     HTMLFILE;OMASTAT;   * Active Status  0=Active 1=Non-active
          GOTO      OMAS9999
.
OMAS1500  MATCH     SP70,DOMASEQ 
          GOTO      OMAS9999 IF EQUAL
          WRITE     HTMLFILE;DOMASEQ;   * Report sequence
          GOTO      OMAS9999
.
OMAS1600  WRITE     HTMLFILE;OTMAAVIS;  * Allocate Visit Type When Booking
          GOTO      OMAS9999
.
OMAS1700  WRITE     HTMLFILE;OTMASTVT;  * Slot Times Visit Type Controlled
          GOTO      OMAS9999
.
OMAS1800  WRITE     HTMLFILE;OTMASUPX;  * Suppress extended slots on Displays
          GOTO      OMAS9999
.
OMAS1900  WRITE     HTMLFILE;OTMARUSE;  * Using RUS Automated Ectract
          GOTO      OMAS9999
.
OMAS2000  WRITE     HTMLFILE;OTMADCMB;  * Display Coments at Booking Time
          GOTO      OMAS9999
.
OMAS2100  WRITE     HTMLFILE;OTMAIXTA;  * Input Extra Screen when Attending 
          GOTO      OMAS9999
.
OMAS2200  MATCH     SP70,OTMADEFD
          GOTO      OMAS9999 IF EQUAL
          WRITE     HTMLFILE;OTMADEFD;  * Default Doctor
          GOTO      OMAS9999
.
OMAS2300  WRITE     HTMLFILE;OTMAUATR;  * Using Attendance Register
          GOTO      OMAS9999
.
OMAS2400  COMPARE   ZERO,OTMADDNA
          GOTO      OMAS9999 IF EQUAL
          WRITE     HTMLFILE;OTMADDNA;  * Disch Patient after X no. days
          GOTO      OMAS9999
.
OMAS2500  COMPARE   ZERO,OTMANDRP
          GOTO      OMAS9999 IF EQUAL
          WRITE     HTMLFILE;OTMANDRP;  * No. of Days for Reappointment
          GOTO      OMAS9999
.
OMAS2600  MOVE      OTMALPTR,LETTER     * Letter to Pat. on reappointment
          CALL      SETLET00            * Letter Selection List           
          GOTO      OMAS9999        
.
OMAS2700  MOVE      OTMALGPD,LETTER     * Letter to G.P. on discharge
          CALL      SETLET00            * Letter Selection List        
          GOTO      OMAS9999
.
OMAS2800  MOVE      OTMALPTD,LETTER     * Letter to Pat. on discharge
          CALL      SETLET00            * Letter Selection List        
          GOTO      OMAS9999
.
OMAS2900  MOVE      OTMABKLT,LETTER     * Standard Booking Letter
          CALL      SETLET00            * Letter Selection List        
          GOTO      OMAS9999
.
OMAS3000  MOVE      OTMARALT,LETTER     * Standard Reappointment Letter
          CALL      SETLET00            * Letter Selection List         
          GOTO      OMAS9999
.
OMAS3100  MOVE      OTMARSLT,LETTER     * Standard Res-Sch Letter (Patient) 
          CALL      SETLET00            * Letter Selection List        
          GOTO      OMAS9999
.
OMAS3200  MATCH     SP70,OTMACLSE       * Clinic Session
          GOTO      OMAS9999 IF EQUAL 
          WRITE     HTMLFILE;OTMACLSE;
          GOTO      OMAS9999
.
OMAS3300  CALL      HOSSEL00            * Hospital Code Selection List 
          GOTO      OMAS9999
.
OMAS3400  MATCH     SP70,OTMACLOC       * Clinic Location
          GOTO      OMAS9999 IF EQUAL 
          WRITE     HTMLFILE;OTMACLOC;
          GOTO      OMAS9999
.
OMAS3500  WRITE     HTMLFILE;OTMAWDCL;  * Ward Clinic (Y/N)        
          GOTO      OMAS9999
.
OMAS3600  MATCH     SP70,OTMAWARD
          GOTO      OMAS9999 IF EQUAL 
          WRITE     HTMLFILE;OTMAWARD;  * Ward Code if Ward Clinic       
          GOTO      OMAS9999
.
OMAS3700  MOVE      "CT",CATEGORY       * Location Type 
          MOVE      OTMALTYP,CODE
          CALL      CODITM00 
          GOTO      OMAS9999
.
OMAS3800  WRITE     HTMLFILE;OTMADFSL; * Default value for send letter in OUT66
          GOTO      OMAS9999
.
OMAS3900  WRITE     HTMLFILE;OTMADFGN; * Generate Case Notes on attendance (Y/N)
          GOTO      OMAS9999
.
OMAS4000  WRITE     HTMLFILE;OTMAGRPS; * Group Session (Y/N)? 0=No 1=Yes 
          GOTO      OMAS9999
.
OMAS4100  WRITE     HTMLFILE;DOTMASOV; * Security Level Overbook
          GOTO      OMAS9999
.
OMAS4200  WRITE     HTMLFILE;DOTMANOO; * Number of Overbookings allowed
          GOTO      OMAS9999
.
OMAS4300  WRITE     HTMLFILE;DOTMASLF; * Security Level to Forcebook
          GOTO      OMAS9999
.
OMAS4400  WRITE     HTMLFILE;DOTMASLR; * Security Level to use reserved slots 
          GOTO      OMAS9999
.
OMAS4500  MOVE      OTMASBKL,LABEL     * Booking Label Screen ID 
          CALL      LABEL000           * Screen ID Selection List
          GOTO      OMAS9999
.
OMAS4600  MOVE      OTMASAPL,LABEL     * Appointment Label Screen ID 
          CALL      LABEL000           * Screen ID Selection List
          GOTO      OMAS9999
.
OMAS4700  MOVE      OTMASPMM,LABEL     * PMI Mailing Label Screen ID 
          CALL      LABEL000           * Screen ID Selection List
          GOTO      OMAS9999
.
OMAS4800  MOVE      OTMASGPM,LABEL     * G.P. Mailing Label Screen ID 
          CALL      LABEL000           * Screen ID Selection List
          GOTO      OMAS9999
.
OMAS4900  MOVE      DOTMALPP,LETTER    * Letter to Paitient on Cancellation
          CALL      SETLET00           * Letter Selection List        
          GOTO      OMAS9999
.
OMAS5000  MOVE      DOTMASRL,LETTER    * Standard Reschedule Letter (Hospital)
          CALL      SETLET00           * Letter Selection List        
          GOTO      OMAS9999
.
OMAS5100  WRITE     HTMLFILE;DOTMANCO; * Non-Consultant Clinic (Y/N) 0=No 1=Yes
          GOTO      OMAS9999
.
OMAS5200  CALL      OMTAB000          * Table of Clinics Scheduled
          GOTO      OMAS9999
.
OMAS5300  MOVE      OTMADEFD,KEY6     * Defualt Doctor Formatted Name
          CALL      RDDOCT1
          IF        OVRCD=1
            GOTO      OMAS9999
          ENDIF
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          CLEAR     DOCTOR
          APPEND    DOCFNAME,DOCTOR
          WRITE     HTMLFILE;DOCTOR;
          GOTO      OMAS9999 
.
OMAS5400  MATCH     SP70,OTMAWARD
          GOTO      OMAS9999  IF EQUAL
          PACK      KEY6,OTMAWARD,SP70  * Ward Formated Description 
          CALL      RDWARD1
          IF        OVRCD=1
            GOTO      OMAS9999
          ENDIF
          CLEAR     DISPNAME
          PACK      NAME35,WBDESC,SP70
          CALL      NAMSTR00
          RESET     DISPNAME
          MOVE      SP70,KEY20
          MOVE      DISPNAME,KEY20
          WRITE     HTMLFILE;KEY20;
          GOTO      OMAS9999 
.
OMAS5500  PACK      KEY20,WBSESIT,OTMACLSE,Z70  
          CALL      RDSCLIA1            * Formated Clinic Session Desc 
          CALL      RDPCLIA1            * Formated Clinic Session Desc 
          BRANCH    OVRCD,OMAS5590
          MATCH     WBSESIT,OCASITE
          GOTO      OMAS5590 IF NOT EQUAL
          MATCH     OTMACLSE,OCACLIN
          GOTO      OMAS5590 IF NOT EQUAL
          CLEAR     DISPNAME
          WRITE     HTMLFILE;OCADESC;
.
OMAS5590  PACK      KEY20,WBSESIT,OTCLI001,OTCLI006,SP70  * Back to Clinic    
          CALL      RDCLIA1
          IF        OVRCD=1
            GOTO      OMAS9999
          ENDIF
          GOTO      OMAS9999 
.
OMAS5600  MATCH     SP70,DOMADAY         * Set Table Day of Week Display
          IF        !@EQUAL
            LOAD      DAYDESC,OMADAY,MON,TUE,WED,THU,FRI,SAT,SUN
            WRITE     HTMLFILE;DAYDESC;   * Day Indicator
          ENDIF
          GOTO      OMAS9999
.
OMAS5700  REP       " +",CLINICID
          WRITE     HTMLFILE;CLINICID;
          GOTO      OMAS9999
.
OMAS5800  MATCH     SP70,OTMADTCO 
          GOTO      OMAS9999 IF EQUAL
          UNPACK    OTMADTCO,CCENT,CYEAR,CMON,CDAY * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OMAS9999
.
OMAS5900  MATCH     SP70,OTMADTCC
          GOTO      OMAS9999 IF EQUAL
          UNPACK    OTMADTCC,CCENT,CYEAR,CMON,CDAY * To Date in (DD MON CCYY)  
          MOVE      CMON,F2                                                    
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC 
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OMAS9999
.
OMAS6000  WRITE     HTMLFILE;OTMAINS1;
          GOTO      OMAS9999
.
OMAS6100  WRITE     HTMLFILE;OTMAINS2;
          GOTO      OMAS9999
.
OMAS6200  WRITE     HTMLFILE;OTMAINS3;
          GOTO      OMAS9999
.
OMAS6300  CALL      LNKPRG00
          GOTO      OMAS9999
.
OMAS6400  WRITE     HTMLFILE;OTMALOCN;  * MRT Location Code
          GOTO      OMAS9999
.
OMAS6500  MOVE      OTMALSER,LETTER     * Series booking letter
          MATCH     SP70,LETTER
          IF        @EQUAL
            MOVE      ZERO,LETTER
          ENDIF
          CALL      SETLET00            * Letter Selection List        
          GOTO      OMAS9999
.
OMAS6600  WRITE     HTMLFILE;OTMAUMCI;  * Using Medclaims (0=No/1=Yes)
          GOTO      OMAS9999
.
OMAS6700  MATCH     SP70,OTMAPROV       * Provider number
          GOTO      OMAS9999 IF EQUAL 
          WRITE     HTMLFILE;OTMAPROV;
          GOTO      OMAS9999
.
OMAS6800  PACK      KEY4,SP70
          CALL      RSPRTHD1
OMAS6810  CALL      RKPRTHD1
          BRANCH    OVRCD,OMAS9999
.         MATCH     "1",PRTHINDC    
.         IF        !@EQUAL
.           GOTO      OMAS6810        * Not Active
.         ENDIF
          PACK      KEY6,QUOTE,PRTHTMID,QUOTE
          MATCH     PRTHTMID,OTMAMBST
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY6," selected>":
                               PRTHDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY6,">",PRTHDESC,"</option>"
          ENDIF
          GOTO      OMAS6810
.   
OMAS6900  MATCH     SP70,OTMAROOM       * Room Number
          GOTO      OMAS9999 IF EQUAL 
          WRITE     HTMLFILE;OTMAROOM;
          GOTO      OMAS9999
.
.         Ledger
.
OMAS7000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OMAS7010
          WRITE     HTMLFILE;OTMALEDG;
          GOTO      OMAS9999
.
OMAS7010  PACK      OTCNLCST,OTCNLCST,SP70
          MOVE      ZERO,F1
          MOVE      OTCNLCST,F1
          BRANCH    F1,OMAS9999,OMAS9999,OMAS9999
          PACK      KEY2,SP70
          CALL      RSFMLA1
OMAS7015  CALL      RKFMLA1
          BRANCH    OVRCD,OMAS9999
.
          MATCH     FMLALEDG,OTMALEDG
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMLALEDG," selected>":
                               FMLADESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMLALEDG,">":
                               FMLADESC,"</option>"
          ENDIF
          GOTO      OMAS7015
.
.         Cost centre
.
OMAS7100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,OTMACCTR
          GOTO      OMAS9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;OTMACCTR;  * Cost centre
          ELSE
            PACK      KEY14,OTMALEDG,OTMACCTR
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Credit account
            ENDIF
          ENDIF
          GOTO      OMAS9999
.
OMAS7200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OMAS7210
          WRITE     HTMLFILE;OTMAMPRC;
          GOTO      OMAS9999
.
OMAS7210  PACK      KEY6,SP70
          CALL      RSPRPR1
OMAS7220  CALL      RKPRPR1
          BRANCH    OVRCD,OMAS9999
.
          MATCH     OTMAMPRC,PRPRCODE    * Default Medical Records Location
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#" selected>":
                                 "(",PRPRCODE,") ",PRPRDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#">":
                                 "(",PRPRCODE,") ",PRPRDESC,"</option>"
          ENDIF
          GOTO      OMAS7220
.
OMAS7300  MATCH     "1",OTMAMBSA       * Apply CMBS template to booking
          IF        @EQUAL
            WRITE     HTMLFILE;OTMAMBSA;
          ELSE
            WRITE     HTMLFILE;ZERO;
          ENDIF
         
          GOTO      OMAS9999
.
OMAS7400  MOVE      OTMALDNA,LETTER    * Non Attendance Letter
          MATCH     SP70,LETTER
          IF        @EQUAL
            MOVE      ZERO,LETTER
          ENDIF
          CALL      SETLET00
          GOTO      OMAS9999
.
OMAS7500  CALL      ARFD0000                * Allied Health Department
          GOTO      OMAS9999
.
OMAS7600  WRITE     HTMLFILE;OTMACENC;      * Collect Enc Details
          GOTO      OMAS9999
.
OMAS7700  WRITE     HTMLFILE;OTMACCAR;      * Collect Carer Details
          GOTO      OMAS9999
.
OMAS7800  WRITE     HTMLFILE;OTMACTRN;      * Collect Transport Details
          GOTO      OMAS9999
.
OMAS7900  WRITE     HTMLFILE;OTMADPSL;      * No. Days prior to send letter
          GOTO      OMAS9999
.
OMAS8000  WRITE     HTMLFILE;OTMACPMI;      * Using Confirm PMI
          GOTO      OMAS9999
.
OMAS8100  WRITE     HTMLFILE;OTMACPAG;      * Using Check in Page
          GOTO      OMAS9999
.
OMAS8200  WRITE     HTMLFILE;OTMACTEL;      * Clinic Telephone Number
          GOTO      OMAS9999
.
OMAS8300  MOVE      "NM",CATEGORY           * NMDS Code
          MOVE      OTMANMDS,CODE
          CALL      CODITM00
          GOTO      OMAS9999
.
OMAS8400  MOVE      "CC",CATEGORY           * Care Type
          MOVE      OTMACART,CODE
          CALL      CODITM00
          GOTO      OMAS9999
.
OMAS8500  MOVE      "sd",CATEGORY           * Service Delivery Mode
          MOVE      OTMASRVD,CODE
          CALL      CODITM00
          GOTO      OMAS9999
.
OMAS8600  WRITE     HTMLFILE;OTMACLHR;      * Clinical High Risk
          GOTO      OMAS9999
.
OMAS8700  WRITE     HTMLFILE;OTMAMLTD;      * Multidisciplinary Clinic
          GOTO      OMAS9999
.
OMAS8800  WRITE     HTMLFILE;OTMAXPUL;      * Exclude From Pulling List 
          GOTO      OMAS9999
.
OMAS8900  WRITE     HTMLFILE;OTMAMREF;      * Mandatory Referral
          GOTO      OMAS9999
.
OMAS9000  WRITE     HTMLFILE;OTMAHOSP;      * Hospital
          GOTO      OMAS9999
.
OMAS9100  MOVE      "NC",CATEGORY           * Tier 2 Code
          MOVE      OTMATCOD,CODE
          CALL      CODITM00
          GOTO      OMAS9999
.
OMAS9200  WRITE     HTMLFILE;OTMAHCLI;      * HERO Clinic ID
          GOTO      OMAS9999
.
OMAS9300  WRITE     HTMLFILE;OTMAHCAI;      * HERO Campus ID
          GOTO      OMAS9999
.
OMAS9400  WRITE     HTMLFILE;OTMAAOPN;      * Auto Open Clinic 
          GOTO      OMAS9999
.
OMAS9500  WRITE     HTMLFILE;OTMAAOFR;      * Auto Open Frequency
          GOTO      OMAS9999
.
OMAS9600  WRITE     HTMLFILE;OTMAAOWM;      * Auto Open Week of Month
          GOTO      OMAS9999
.
OMAS9700  WRITE     HTMLFILE;OTMAAOWA;      * Auto Open Number of weeks in 
          GOTO      OMAS9999                * advance
.
OMAS9800  MATCH     SP70,OMADATE            * Last session open date
          GOTO      OMAS9999 IF EQUAL
.
          UNPACK    OMADATE,CCENT,CYEAR,CMON,CDAY * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OMAS9999
.
OMAS9900  UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,FLDITMNO
          CALL      OMAX0000
          GOTO      OMAS9999   
.
OMAS9999  RETURN
.------------------------------------------------------------
. Additional Outpatient Clinic Schedule : Option 4
.------------------------------------------------------------
OMAX0000  BRANCH    FLDITMNO,OMAX0010,OMAX0020,OMAX0030,OMAX0040,OMAX0050:
                             OMAX0060,OMAX0070,OMAX0080,OMAX0090,OMAX0100: 
                             OMAX0110,OMAX0120,OMAX0130,OMAX0140,OMAX0150:
                             OMAX0160
.
OMAX0010  WRITE     HTMLFILE;FILTACTV;
          GOTO      OMAX9999
.
OMAX0020  WRITE     HTMLFILE;OTMAHCP1;
          GOTO      OMAX9999
.
OMAX0030  WRITE     HTMLFILE;OTMAHCP2;
          GOTO      OMAX9999
.
OMAX0040  WRITE     HTMLFILE;OTMAHCP3;
          GOTO      OMAX9999
.
OMAX0050  WRITE     HTMLFILE;OTMAHCP4;
          GOTO      OMAX9999
.
OMAX0060  WRITE     HTMLFILE;OTHEHCP1;
          GOTO      OMAX9999
.
OMAX0070  WRITE     HTMLFILE;OTHEHCP2;
          GOTO      OMAX9999
.
OMAX0080  WRITE     HTMLFILE;OTHEHCP3;
          GOTO      OMAX9999
.
OMAX0090  WRITE     HTMLFILE;OTHEHCP4;
          GOTO      OMAX9999
.
OMAX0100  WRITE     HTMLFILE;OTMAMLTD;
          GOTO      OMAX9999
.
OMAX0110  MOVE      "NC",CATEGORY           * Tier 2 Code
          MOVE      OTMATCOD,CODE
          CALL      CODITM00
          GOTO      OMAX9999
.
OMAX0120  WRITE     HTMLFILE;OTMAPCOD;
          GOTO      OMAX9999
.
OMAX0130  UNPACK    DIM127,D1,KEY1,DIM127 
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,OTMAPCOD
          GOTO      OMAX9999 IF EQUAL

          IF        F1=0
            WRITE    HTMLFILE;OTMAPCOD;        . Clinic type procedure code
           ELSE
            PACK     KEY21,OMASITE,OMATYP,OTMAPCOD,SP70
	    CALL     RDOTCPC1
            IF       OVRCD<>1
              WRITE    HTMLFILE;OTCPDESC;      . Clinic type procedure desc
            ENDIF
          ENDIF
          GOTO      OMAX9999 
.
OMAX0140  UNPACK    DIM127,D1,KEY1,DIM127 
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,OTHEPCOD
          GOTO      OMAX9999 IF EQUAL

          IF        F1=0
            WRITE    HTMLFILE;OTHEPCOD;        . Clinic slot type procedure code
           ELSE
            PACK     KEY21,OTHESITE,OTHECTYP,OTHEPCOD,SP70
	    CALL     RDOTCPC1
            IF       OVRCD<>1
              WRITE    HTMLFILE;OTCPDESC;      . Clinic slot type procedure desc
            ENDIF
          ENDIF
          GOTO      OMAX9999 
.
OMAX0150  COMPARE   ZERO,OTMALPTR
          GOTO      OMAX0155 IF NOT EQUAL
          COMPARE   ZERO,OTMALGPD
          GOTO      OMAX0155 IF NOT EQUAL 
          COMPARE   ZERO,OTMALPTD
          GOTO      OMAX0155 IF NOT EQUAL
          COMPARE   ZERO,OTMABKLT
          GOTO      OMAX0155 IF NOT EQUAL
          COMPARE   ZERO,OTMARALT
          GOTO      OMAX0155 IF NOT EQUAL
          COMPARE   ZERO,OTMARSLT
          GOTO      OMAX0155 IF NOT EQUAL
          COMPARE   ZERO,OTMALPPC
          GOTO      OMAX0155 IF NOT EQUAL
          COMPARE   ZERO,OTMASRLH
          GOTO      OMAX0155 IF NOT EQUAL
          MATCH     SP70,OTMALSER
          GOTO      OMAX0155 IF NOT EQUAL
          MATCH     SP70,OTMALDNA
          GOTO      OMAX0155 IF NOT EQUAL
          MATCH     SP70,OTMASBKL
          GOTO      OMAX0155 IF NOT EQUAL
          MATCH     SP70,OTMASAPL
          GOTO      OMAX0155 IF NOT EQUAL
          MATCH     SP70,OTMASPMM
          GOTO      OMAX0155 IF NOT EQUAL
          MATCH     SP70,OTMASGPM
          GOTO      OMAX0155 IF NOT EQUAL
.
          WRITE     HTMLFILE;ZERO;
          GOTO      OMAX9999
.
OMAX0155  WRITE     HTMLFILE;ONE;                 * Labels & Letters exists 
          GOTO      OMAX9999
.
OMAX0160  PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RSOTHED1
OMAX0161  CALL      RKOTHED1
          BRANCH    OVRCD,OMAX0162
.
          MATCH     WBSESIT,OTHESITE
          GOTO      OMAX0162 IF NOT EQUAL
          MATCH     OTCLI001,OTHECLIN
          GOTO      OMAX0162 IF NOT EQUAL
          MATCH     OTMAS001,OTHEWDAY
          GOTO      OMAX0162 IF NOT EQUAL
          MATCH     OTMAS002,OTHESTRT
          GOTO      OMAX0162 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;                 * Slot Templates exist
          GOTO      OMAX9999
.
OMAX0162  WRITE     HTMLFILE;ZERO;              
          GOTO      OMAX9999
.
OMAX9999  RETURN
.
.------------------------------------------------------------
. Outpatient Clinic Slot Templates : Option 5 
.------------------------------------------------------------
OMAB0000  BRANCH    FLDITMNO,OMAB0100,OMAB0200,OMAB0300,OMAB0400,OMAB0500:
                             OMAB0600,OMAB0700,OMAB0800,OMAB0900
          GOTO      OMAB9999
.
OMAB0100  WRITE     HTMLFILE;OMBSLOT;   * Slot Number  
          GOTO      OMAB9999
.
OMAB0200  MOVE      OMBVTYP,CODE
          MOVE      ZERO,VISTFLAG
          CALL      VTYSEL00
          GOTO      OMAB9999
.
OMAB0300  WRITE     HTMLFILE;OMBTIME;   * Available Slot Start Time (HH:MM)
          GOTO      OMAB9999
.
OMAB0400  CALL      OBTAB000            * Table of Clinic Slot Templates  
          CALL      CLRMAB00            * Clear outmab vars 
          GOTO      OMAB9999
.
OMAB0500  MOVE      OMBVTYP,CODE
          MOVE      ONE,VISTFLAG
          CALL      VTYSEL00
          GOTO      OMAB9999
.
OMAB0600  MOVE      ZERO,SHOWCLOS       * Display open schedules only
          CALL      MSTAB000            * Table of Clinic Slot Templates  
          GOTO      OMAB9999
.
OMAB0700  MOVE      ONE,SHOWCLOS        * Show closed schedules only
          CALL      MSTAB000            * Table of Clinic Slot Templates  
          GOTO      OMAB9999
.
OMAB0800  PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
          CALL      RDSMASB1
OMAB0810  CALL      RDKMASB1
          BRANCH    OVRCD,OMAB9999
.
          MATCH     WBSESIT,OMBSITE
          GOTO      OMAB9999 IF NOT EQUAL
.
          MATCH     OTCLI001,OMBCLIN
          GOTO      OMAB9999 IF NOT EQUAL
.
          MATCH     OTMAS001,DOMBDAY
          GOTO      OMAB9999 IF NOT EQUAL
.
          MATCH     OTMAS002,OMBSTRT
          GOTO      OMAB9999 IF NOT EQUAL
.
          MATCH     OTHED005,OTMBSHNO
          GOTO      OMAB9999 IF NOT EQUAL
.
          MATCH     OTHED006,OTMBSDAT
          GOTO      OMAB9999 IF NOT EQUAL
.
          MOVE      OMBVTYP,CODE
          CALL      GETSCT00           * Get slot count
          IF        CNTSLOTS>1
            GOTO      OMAB0810
          ENDIF
.
          WRITE     HTMLFILE;"<option value=",OMBSLOT,">":
                               OMBSLOT,"</option>"
          IF        OMBSLOT<900
            GOTO      OMAB0810
          ENDIF
.
OMAB0900  MOVE      OMBVTYP,CODE
          MOVE      TWO,VISTFLAG
          CALL      VTYSEL00
          GOTO      OMAB9999
.
OMAB9999  RETURN
.------------------------------------------------------------
. Outpatient Clinic Session Details : Option 6
.------------------------------------------------------------
OSES0000  BRANCH    FLDITMNO,OSES0100,OSES0200,OSES0300,OSES0400,OSES0500:
                             OSES0600
          GOTO      OSES9999
.
OSES0100  MOVE      ZERO,DELSES  * Standard Display Dates set
          CALL      SESTBL00     * Table Session Dates 
          GOTO      OSES9999
.
OSES0200  CALL      SETYR000   * Sets current year Depending Next or Prev Page 
          GOTO      OSES9999
.
OSES0300  CALL      NEXTYR00   * Link to Next Year
          GOTO      OSES9999
.
OSES0400  CALL      PREVYR00   * Link to Previous Year
          GOTO      OSES9999
.
OSES0500  MOVE      ONE,DELSES * Delete Display Dates set
          CALL      SESTBL00   * Table Session Dates that can be deleted 
          GOTO      OSES9999
.
OSES0600  CALL      LSTOPN00   * Returns date of the last open session
          GOTO      OSES9999
.
OSES9999  RETURN
.------------------------------------------------------------
. Outpatient Clinic Template Mapping : Option 7
.------------------------------------------------------------
OWMP0000  BRANCH    FLDITMNO,OWMP0100,OWMP0200,OWMP0300,OWMP0400,OWMP0500:
                             OWMP0600,OWMP0700,OWMP0800,OWMP0900,OWMP1000
          GOTO      OWMP9999
.
OWMP0100  WRITE     HTMLFILE;OTWMCLID;
          GOTO      OWMP9999
.
OWMP0200  WRITE     HTMLFILE;OTWMMPSV;
          GOTO      OWMP9999
.
OWMP0300  WRITE     HTMLFILE;OTWMMPRP;
          GOTO      OWMP9999
.
OWMP0400  WRITE     HTMLFILE;OTWMMPTP;
          GOTO      OWMP9999
.
OWMP0500  WRITE     HTMLFILE;OTWMMPTT;
          GOTO      OWMP9999
.
OWMP0600  WRITE     HTMLFILE;OTWMDESC;
          GOTO      OWMP9999
.
OWMP0700  CALL      OUTTB000   * Table of Outpatient Clinic Type
          GOTO      OWMP9999
.
OWMP0800  CALL      NEXTGR00   * Next set of Clinic Types 
          GOTO      OWMP9999
.
OWMP0900  CALL      PREVGR00   * Previous set of Clinic Types 
          GOTO      OWMP9999
.
OWMP1000  WRITE     HTMLFILE;OTWMSITE;
          GOTO      OWMP9999
.
OWMP9999  RETURN
.-----------------------------------------------------------
. HPS A01 Starts Here
.-----------------------------------------------------------
OMSP0000  BRANCH    FLDITMNO,OMSP0100
          GOTO      OMSP9999
.
OMSP0100  MOVE      "CE",CATEGORY
          CALL      CODITM00
          GOTO      OMSP9999
.
OMSP9999  RETURN
.----------------------------------------------------------
. HPS A01 Ends Here
.******************************************************************************
.              Clinic Type Selection List HPS ODC Code Starts Here
.*******************************************************************************
. Standard Coded Field Option
.
.  Parameters    CLINIC TYPES
.
.  Tag Parameter 0=Description
.                1=Code
.                2=Selection List
.                3=Code with Indicators
.*******************************************************************************
.CLITYP00  ASSIGN    ONE,TMPFLG
.          UNPACK    DIM127,D1,KEY1,DIM127
.          MOVE      ZERO,F1
.          MOVE      KEY1,F1
.          BRANCH    F1,CLITYP10,CLITYP20,CLITYP30
.          GOTO      CLITYP99
.
.CLITYP10  GOTO      CLITYP99
.
.CLITYP20  MOVE      SP70,KEY12
.          CALL      RDSCTYA1
.CLITYP25  CALL      RDKCTYA1
.          BRANCH    OVRCD,CLITYP99
.          MATCH     SP1,OTMAS005
.          IF        @EQUAL
.            MOVE      TMPCLTYP,OTMAS005 
.          ELSE
.            MATCH     OCTCTYP,OTMAS005
.          ENDIF
.          IF        @EQUAL
.                    WRITE     HTMLFILE;"<option value=",OCTCTYP," selected>":
.                              OCTDESC,"</option>"
.                    MOVE      OCTCTYP,TMPCLTYP
.          ELSE	
.                    WRITE     HTMLFILE;"<option value=",OCTCTYP,">":
.                              OCTDESC,"</option>"
.          ENDIF
.          GOTO      CLITYP25
.
.CLITYP30  GOTO      CLITYP99
.                                     
.CLITYP99  RETURN
.******************************************************************************
.                   Clinic Type Selection List HPS Code Ends Here
.******************************************************************************
.------------------------------------------------------------
. Clinic Type Selection List
.  Tag Parameter 0=Description
.                1=Code
.                2=Selection List all clinic types
.                3=Selection List of active clinic types
.------------------------------------------------------------
CLITYP00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          PACK      KEY12,WBSESIT,OMATYP,SP70
          CALL      RDCTYA1
          IF        OVRCD=1
            MOVE     SP70,OCTCTYP
            MOVE     SP70,OCTDESC
          ENDIF
.
          BRANCH    F1,CLITYP10,CLITYP20,CLITYP30
.
          CLEAR     DISPNAME
          PACK      NAME35,OCTDESC,SP70  * 0 = Description 
          CALL      NAMSTR00             * Formatted
          RESET     DISPNAME
          MOVE      DISPNAME,KEY30
          WRITE     HTMLFILE;KEY30;
          GOTO      CLITYP99
.
CLITYP10  WRITE     HTMLFILE;OCTCTYP;       * 1 = Code
          GOTO      CLITYP99
.
CLITYP20  MOVE      ONE,SHOWINAC            * 2 = Show inactive 
          CALL      CSEL0000
          GOTO      CLITYP99
.
CLITYP30  MOVE      ZERO,SHOWINAC           * 3 = Don't show inactive
          CALL      CSEL0000
.
CLITYP99  RETURN
.------------------------------------------------------------
. Clinic Type Selection
.------------------------------------------------------------
CSEL0000  PACK      KEY42,WBSESIT,SP70
          CALL      RDSCTYA2
CSEL0100  CALL      RDKCTYA2
          BRANCH    OVRCD,CSEL9999
.
          IF        SHOWINAC=0
            MATCH     "1",OCTACT            * Skip inactive clinic types
            GOTO      CSEL0100 IF EQUAL
          ENDIF 
.
          MATCH     WBSESIT,OCTSITE
          GOTO      CSEL9999 IF NOT EQUAL
.
          MOVE      OCTDESC,KEY30
          PACK      KEY8,QUOTE,OCTCTYP,QUOTE
          MATCH     OMATYP,OCTCTYP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                               KEY30,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY8,">",KEY30,"</option>"
          ENDIF
          GOTO      CSEL0100
.
CSEL9999  RETURN
.-----------------------------------------------------------
. Displays Letter Selection List 
.-----------------------------------------------------------
SETLET00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MOVE      ZERO,F3
          MOVE      LETTER,LETTERNO
          PACK      KEY6,LETTER,F3,SP70
          CALL      RDOTLET1
          BRANCH    OVRCD,SETLET20
          BRANCH    F1,SETLET10,SETLET20
          WRITE     HTMLFILE;OTLTTEXT;
          GOTO      SETLET99
.
SETLET10  WRITE     HTMLFILE;DOTLTLTN;
          GOTO      SETLET99
.
SETLET20  COMPARE   TWO,F1
          GOTO      SETLET99 IF NOT EQUAL
.
          CALL      LSEL0000
.
SETLET99  RETURN
.------------------------------------------------------------
. Letter Selection List
.------------------------------------------------------------
LSEL0000  PACK      KEY6,SP70
          CALL      RSOTLET1
LSEL0100  CALL      RKOTLET1
          BRANCH    OVRCD,LSEL9999
.
          COMPARE   ZERO,OTLTLINO
          GOTO      LSEL0100 IF NOT EQUAL
.
          MOVE      OTLTTEXT,KEY40
          PACK      KEY5,QUOTE,DOTLTLTN,QUOTE
          COMPARE   LETTERNO,OTLTLTNO
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY40,"</option>"
          ELSE
            MATCH     "1",OTLTACTV                 * Skip Inactive
            GOTO      LSEL0100 IF EQUAL
.
            MATCH     "1",OTLTCOMM                 * Skip if SMS
            GOTO      LSEL0100 IF EQUAL
.
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY40,"</option>"
          ENDIF
          GOTO      LSEL0100
.
LSEL9999  RETURN
.------------------------------------------------------------
. Hospital Selection List
.------------------------------------------------------------
HOSSEL00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,OTMAHOSP
          GOTO      HOSSEL20 IF EQUAL
          PACK      KEY3,OTMAHOSP
          CALL      RDPTHSP1
          BRANCH    OVRCD,HOSSEL20
          BRANCH    F1,HOSSEL10,HOSSEL20
          WRITE     HTMLFILE;PTHSHOSP;
          GOTO      HOSSEL99
.
HOSSEL10  WRITE     HTMLFILE;PTHSNAME;
          GOTO      HOSSEL99
.
HOSSEL20  CALL      HSEL0000
.
HOSSEL99  RETURN
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
HSEL0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSEL0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSEL9999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
.
          MATCH     OTMAHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            IF        IBCNMHOS=1
              PACK      KEY13,USERID,SP70            * All hospital access
              CALL      RDMLSEC1
              IF        OVRCD=1
                PACK      KEY13,USERID,PTHSHOSP,SP70 * This hospital access
                CALL      RDMLSEC1
                BRANCH    OVRCD,HSEL0100
              ENDIF
            ENDIF
.
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSEL0100
.
HSEL9999  RETURN
.------------------------------------------------------------
. Display Label Selection List
.------------------------------------------------------------
LABEL000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     SP70,LABEL
          GOTO      LABEL020 IF EQUAL
.
          PACK      KEY10,LABELOUT,LABEL,SP70
          CALL      RDSCMA1
          BRANCH    OVRCD,LABEL020
.
          BRANCH    F1,LABEL010,LABEL020
.
          WRITE     HTMLFILE;SCMASID;
          GOTO      LABEL099
.
LABEL010  WRITE     HTMLFILE;SCMADES;
          GOTO      LABEL099
.
LABEL020  CALL      LBLSEL00
.
LABEL099  RETURN
.------------------------------------------------------------
. Label Selection
.------------------------------------------------------------
LBLSEL00  PACK      KEY10,LABELOUT,SP70
          CALL      RSSCMA1 
LBLSEL10  CALL      RKSCMA1 
          BRANCH    OVRCD,LBLSEL99
.
          MATCH     LABELOUT,SCMAPID
          GOTO      LBLSEL10 IF NOT EQUAL 
.
          MOVE      SCMADES,KEY35
          PACK      KEY4,QUOTE,SCMASID,QUOTE
          MATCH     LABEL,SCMASID
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY4," selected>":
                               KEY35,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY4,">",KEY35,"</option>"
          ENDIF
          GOTO      LBLSEL10
.
LBLSEL99  RETURN
.-----------------------------------------------------------
. Sets Year to current or to next or prev
.-----------------------------------------------------------
SETYR000  RESET     SHOWYEAR
          MATCH     SP70,SHOWYEAR
          GOTO      SETYR100 IF NOT EQUAL
.
          CALL      IBACLOCK
          PACK      SHOWYEAR,CCC,CYY
          REP       " 0",SHOWYEAR
          WRITE     HTMLFILE;SHOWYEAR;
          GOTO      SETYR999
.
SETYR100  WRITE     HTMLFILE;SHOWYEAR;  * Year set to Next or Previous Year
.
SETYR999  RETURN
.-----------------------------------------------------------
. Link to Next Years 
.-----------------------------------------------------------
NEXTYR00  UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          MOVE      PBYEAR,PBYR
          ASSIGN    PBYR+ONE,F4
          MOVE      F4,KEY4
          REP       " +",OCACLIN
.
          WRITE     HTMLFILE;"outweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&otcli001=",OCACLIN:
                                 "&otcli006=",OCADATE:
                                 "&otmas001=",OMADAY:
                                 "&otmas002=",OMASTART:
                                 "&showyear=",KEY4;
.
          REP       "+ ",OCACLIN 
.
NEXTYR99  RETURN
.-------------------------------------------------------------
. Link to Prev Years 
.-------------------------------------------------------------
PREVYR00  UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          MOVE      PBYEAR,PBYR
          ASSIGN    PBYR-ONE,F4
          MOVE      F4,KEY4
          REP       " +",OCACLIN
.
          WRITE     HTMLFILE;"outweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&otcli001=",OCACLIN:
                                 "&otcli006=",OCADATE:
                                 "&otmas001=",OMADAY:
                                 "&otmas002=",OMASTART:
                                 "&showyear=",KEY4;
.
          REP       "+ ",OCACLIN 
.
PREVYR99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REPLACE   " +",OCACLIN
          REPLACE   " +",OCADATE   
          REPLACE   " +",STARTKEY  
          REPLACE   " +",CLNCTYPE
          REPLACE   " +",FILTACTV
          WRITE     HTMLFILE;"outweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&otcli001=",OCACLIN:
                                 "&otcli006=",OCADATE:
                                 "&startkey=",STARTKEY:
                                 "&clnctype=",CLNCTYPE:
                                 "&filtactv=",FILTACTV;
          REPLACE   "+ ",OCACLIN
          REPLACE   "+ ",OCADATE  
          REPLACE   "+ ",STARTKEY 
          REPLACE   "+ ",CLNCTYPE
          REPLACE   "+ ",FILTACTV
.
NEXTGR99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REPLACE   " +",OCACLIN
          REPLACE   " +",OCADATE
          REPLACE   " +",STARTKEY
          REPLACE   " +",CLNCTYPE
          REPLACE   " +",FILTACTV
          WRITE     HTMLFILE;"outweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&otcli001=",OCACLIN:
                                 "&otcli006=",OCADATE:
                                 "&startkey=",STARTKEY:
                                 "&clnctype=",CLNCTYPE:
                                 "&filtactv=",FILTACTV;
          REPLACE   "+ ",OCACLIN
          REPLACE   "+ ",OCADATE
          REPLACE   "+ ",STARTKEY
          REPLACE   "+ ",CLNCTYPE
          REPLACE   "+ ",FILTACTV
.
PREVGR99  RETURN
.-----------------------------------------------------------
. Link to previous Contract Codes
.-----------------------------------------------------------
PRVCCC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REPLACE   " +",WBSESIT
          REPLACE   " +",CLINTYPE
          REPLACE   " +",STARTKEY
.
          WRITE     HTMLFILE;"outweb05.pbl":
                             "?reportno=10":
                             "&template=001":
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&wbsesit=",WBSESIT:
                             "&clintype=",CLINTYPE:
                             "&startkey=",STARTKEY,"#"";
.
          REPLACE   "+ ",WBSESIT
          REPLACE   "+ ",CLINTYPE
          REPLACE   "+ ",STARTKEY
.
PRVCCC99  RETURN
.-----------------------------------------------------------
. Link to next Contract Codes
.-----------------------------------------------------------
NXTCCC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REPLACE   " +",WBSESIT
          REPLACE   " +",CLINTYPE
          REPLACE   " +",STARTKEY
.
          WRITE     HTMLFILE;"outweb05.pbl":
                             "?reportno=10":
                             "&template=001":
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&wbsesit=",WBSESIT:
                             "&clintype=",CLINTYPE:
                             "&startkey=",STARTKEY,"#"";
.
          REPLACE   "+ ",WBSESIT
          REPLACE   "+ ",CLINTYPE
          REPLACE   "+ ",STARTKEY
.
NXTCCC99  RETURN
.-----------------------------------------------------------
. Link to Another Program
.-----------------------------------------------------------
LNKPRG00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127

          REP       " +",OMACLIN
          REP       " +",OCADATE
          REP       " +",DOMADAY
          REP       " +",OMASTART
.
          WRITE     HTMLFILE;LINKPRG,".pbl?reportno=",LINKREP:
                                     "&template=",LINKTEM:
                                     "&otcli001=",OMACLIN:
                                     "&otcli006=",OCADATE:
                                     "&otmas001=",DOMADAY:
                                     "&otmas002=",OMASTART;
.
          REP       "+ ",OMACLIN
          REP       "+ ",OCADATE
          REP       "+ ",DOMADAY
          REP       "+ ",OMASTART
.
LNKPRG99  RETURN
.------------------------------------------------------------
. Table of Outpatient Clinic Types : Report 1
.------------------------------------------------------------
OCTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      OCHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY12,WBSESIT,STARTKEY,SP70
          CALL      RDSCTYA1
          IF        OVRCD=0
            CALL      RDPCTYA1
          ENDIF
OCTAB100  CALL      RDKCTYA1
          BRANCH    OVRCD,OCTAB900
.
          MATCH     WBSESIT,OCTSITE
          GOTO      OCTAB100 IF NOT EQUAL
.
          MATCH     "1",FILTACTV            * Active Only
          IF        @EQUAL
            MATCH     "1",OCTACT              
            GOTO      OCTAB100 IF EQUAL
          ENDIF
.
          MATCH     "2",FILTACTV            * Inactive Only
          IF        @EQUAL
            MATCH     "1",OCTACT              
            GOTO      OCTAB100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      OCTAB100
          ENDIF
.
          CALL      OCROW000      * Display Clinic Type Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      OCTAB100 IF NOT EQUAL
          GOTO      OCTAB999
.
OCTAB900  CALL      NOMORE00      * Display No More Records Message
.
OCTAB999  RETURN
.------------------------------------------------------------
. Outpatient Clinic Type (TABLE HEADING)
.------------------------------------------------------------
OCHED000  WRITE     HTMLFILE;"<tr>": 
                               "<td class=HeadingCell width=20%>":
                               "<b>Clinic Type</b></td>":
                               "<td class=HeadingCell width=40%>":
                               "<b>Description</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Group</b></td>":
                               "<td class=HeadingCell width=15%>":
                               "Status</td>":
                             "</tr>"
.
OCHED999  RETURN
.------------------------------------------------------------
. Clinic Type (TABLE ROW)
.------------------------------------------------------------
OCROW000  MOVE      "CG",CATEGORY
          MOVE      OCTGRP,CODE
          CALL      GETCOD00 
.
          MATCH     "1",OCTACT
          IF        @EQUAL
            MOVE      "Inactive",D8
          ELSE
            MOVE      "Active",D8
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&otcty001=",OCTCTYP,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif":
                             " class=ListIcon></a>":
                             OCTCTYP,"&nbsp; </td>":
                             "<td>",OCTDESC,"&nbsp;</td><td>":
                             TDESC,"&nbsp;</td>":
                             "<td>",D8,"</td>":
                            "</tr>"
.
OCROW999 RETURN
.------------------------------------------------------------
. Table of Outpatient Clinics : Report 2
.------------------------------------------------------------
CITAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MATCH     SP70,CHECKSIT           * Check outpatient site file prefix
          IF        !@EQUAL
            CALL      VOTFIL00
            MOVE       CHECKSIT,WBSESIT
          ENDIF
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY20,WBSESIT,STARTKEY,SP70
          CALL      RDSCLIA1
          IF        OVRCD=0
            CALL      RDPCLIA1 
          ENDIF
CITAB100  CALL      RDKCLIA1
          BRANCH    OVRCD,CITAB900
.
          MATCH     WBSESIT,OCASITE
          GOTO      CITAB100 IF NOT EQUAL
.
          MATCH     "1",FILTACTV            * Active Only
          IF        @EQUAL
            MATCH     "1",OTCLIACT
            GOTO      CITAB100 IF EQUAL
          ENDIF
.
          MATCH     "2",FILTACTV            * Inactive Only
          IF        @EQUAL     
            MATCH     "1",OTCLIACT
            GOTO      CITAB100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLNCTYPE
          GOTO      CITAB500 IF EQUAL
          GOTO      CITAB500 IF EOS
.
          PACK      KEY24,OCASITE,CLNCTYPE,OCACLIN,SP70
          CALL      RDSMASA2
CITAB300  CALL      RDKMASA2
          BRANCH    OVRCD,CITAB100
.
          MATCH     OCASITE,OMASITE
          GOTO      CITAB100 IF NOT EQUAL
.
          MATCH     OCACLIN,OMACLIN
          GOTO      CITAB100 IF NOT EQUAL
.
          MATCH     CLNCTYPE,OMATYP
          GOTO      CITAB100 IF NOT EQUAL 
.
CITAB500  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CITAB100
          ENDIF
.
          CALL      CIROW000      * Display Clinic Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CITAB100 IF NOT EQUAL
          GOTO      CITAB999
.
CITAB900  CALL      NOMORE00      * Display No More Records Message
.
CITAB999  RETURN
.------------------------------------------------------------
. Clinic (TABLE ROW)
.------------------------------------------------------------
CIROW000  MATCH     "1",OTCLIACT
          IF        @EQUAL
            MOVE      "No ",KEY3
          ELSE
            MOVE      "Yes",KEY3
          ENDIF
.
          MATCH     SP70,OCADOCT
          IF        @EQUAL 
            MOVE      "&nbsp;",DOCTOR
            GOTO      CIROW010 
          ENDIF   
.
          MOVE      OCADOCT,KEY10
          CALL      RDPMHCP1
          IF        OVRCD=1
            MOVE      "&nbsp;",DOCTOR
          ELSE 
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            CLEAR     DOCTOR 
            APPEND    DOCFNAME,DOCTOR
          ENDIF
.
CIROW010  UNPACK    OCADATE,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      OCADESC,KEY30
          MATCH     SP70,OCADESC
          IF        @EQUAL 
            MOVE      "&nbsp;",KEY30
          ENDIF   
.
          BRANCH    LNK2PRT,CIROW020       * Update Parent   
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail02":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&otcli001=",OCACLIN:
                             "&otcli006=",OCADATE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif":
                             " class=ListIcon></a>":
                             OCACLIN,"</td>":
                             "<td>",KEY12,"</td>":
                             "<td>",KEY30,"</td><td>",DOCTOR,"</td>":
                             "<td>",KEY3,"</td>":
                             "</tr>"
.
          GOTO      CIROW999
.
CIROW020  REP       "' ",KEY30  * Get Rid of them as when present stuff up link
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><img src=../images/MaintenanceIcon.gif ":
                             " class=ListIcon onclick=#"UpdateParent('":
                             OCACLIN,"','",KEY30,"');#">":
                             OCACLIN,"</td>":
                             "<td>",KEY30,"</td><td>",DOCTOR,"</td>":
                             "<td>",KEY3,"</td>":
                             "</tr>"
. 
CIROW999 RETURN
.------------------------------------------------------------
. Table of Outpatient Clinics Leave : Report 3
.------------------------------------------------------------
CVTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CVHED000      * Output Table Heading
.
          RESET     SHOWYEAR
          MATCH     SP70,SHOWYEAR
          IF        @EQUAL
            CALL      IBACLOCK
            PACK      SHOWYEAR,CCC,CYY   * Set to current year
            REP       " 0",SHOWYEAR
          ENDIF
          MOVE      SHOWYEAR,PBYEAR      * Variable set to Prev & Next Years
.
          IF        NORECORD=0
            MOVE      "99",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY20,WBSESIT,OTCLI001,SP70
          CALL      RSOTCLV1
CVTAB100  CALL      RKOTCLV1
          BRANCH    OVRCD,CVTAB999
.
          MATCH     WBSESIT,OTCVSITE       * Check Clinic ID 
          GOTO      CVTAB999 IF NOT EQUAL
.
          MATCH     OTCLI001,OTCVCLIN      * Check Clinic ID 
          GOTO      CVTAB999 IF NOT EQUAL
.
          UNPACK    OTCVFDTE,KEY4,KEY5
          MATCH     SHOWYEAR,KEY4
          GOTO      CVTAB100 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CVTAB100
          ENDIF
.
          CALL      CVROW000      * Display Clinic Leave Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CVTAB100 IF NOT EQUAL
.
CVTAB999  RETURN
.------------------------------------------------------------
. Outpatient Clinics (TABLE HEADING)
.------------------------------------------------------------
CVHED000  WRITE     HTMLFILE;"<tr>": 
                               "<td class=HeadingCell width=30%>":
                               "<b>From</b></td>":
                               "<td class=HeadingCell width=30%>":
                               "<b>To</b></td>":
                               "<td class=HeadingCell width=40%>":
                               "<b>Reason</b></td>":
                             "</tr>"
.
CVHED999  RETURN
.------------------------------------------------------------
. Clinic (TABLE ROW)
.------------------------------------------------------------
CVROW000  UNPACK    OTCVFDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      FROMDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR 
.
          UNPACK    OTCVTDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      TODATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      "DH",CATEGORY
          MOVE      OTCVREAS,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail03":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&otcli001=",OCACLIN:
                             "&otcli006=",OCADATE:
                             "&otclv001=",OTCVFDTE:
                             "&showyear=",SHOWYEAR,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif ":
                             "class=ListIcon></a>":
                             FROMDATE,"</td>":
                             "<td>",TODATE,"</td><td>",TDESC,"</td>":
                             "</tr>"
.
CVROW999 RETURN
.------------------------------------------------------------
. Table of Clinics Scheduled: Report 4
.------------------------------------------------------------
OMTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      OMHED000      * Output Table Heading
.
          PACK      KEY18,WBSESIT,OTCLI001,SP70
          CALL      RDSMASA1
OMTAB100  CALL      RDKMASA1
          BRANCH    OVRCD,OMTAB999
.
          MATCH     WBSESIT,OMASITE
          GOTO      OMTAB999 IF NOT EQUAL
.
          MATCH     OTCLI001,OMACLIN
          GOTO      OMTAB999 IF NOT EQUAL
.
          COMPARE   ZERO,OMADAY
          GOTO      OMTAB100 IF EQUAL 
.
          MATCH     "1",FILTACTV            * Active Only
          IF        @EQUAL
            COMPARE   ONE,OMASTAT
            GOTO      OMTAB100 IF EQUAL
          ENDIF
.
          MATCH     "2",FILTACTV            * Inactive Only
          IF        @EQUAL
            COMPARE   ONE,OMASTAT
            GOTO      OMTAB100 IF NOT EQUAL
          ENDIF

.
          CALL      OMROW000      * Display Clinic Scheduled Row
          GOTO      OMTAB100 
.
OMTAB999  RETURN
.------------------------------------------------------------
. Outpatient Clinics Scheduled (TABLE HEADING)
.------------------------------------------------------------
OMHED000  WRITE     HTMLFILE;"<tr>": 
                               "<td class=HeadingCell width=20%>":
                               "Day of Week</td>":
                               "<td class=HeadingCell width=20%>":
                               "Time</td>":
                               "<td class=HeadingCell width=20%>":
                               "Clinic Type</td>":
                               "<td class=HeadingCell width=20%>":
                               "Clinic Indicator</td>":
                               "<td class=HeadingCell width=15%>":
                               "Active</td>":
                             "</tr>"
.
OMHED999  RETURN
.------------------------------------------------------------
. Clinic Scheduled (TABLE ROW)
.------------------------------------------------------------
OMROW000  MATCH     SP70,SCHDLDAY         * Set Table Day of Week Display 
          IF        @EQUAL                    
            LOAD      DAYDESC,OMADAY,MON,TUE,WED,THU,FRI,SAT,SUN
            MOVE      OMADAY,SCHDLDAY 
          ELSE
            MATCH     SCHDLDAY,DOMADAY    * Check if Day if Same
            IF        @EQUAL
              MOVE      "&nbsp;",DAYDESC
            ELSE
              LOAD      DAYDESC,OMADAY,MON,TUE,WED,THU,FRI,SAT,SUN
              MOVE      OMADAY,SCHDLDAY 
            ENDIF
          ENDIF
.
          PACK      KEY12,WBSESIT,OMATYP     * Get Clinic Type
          CALL      RDCTYA1
          IF        OVRCD=1
            MOVE      "&nbsp;",KEY30 
          ELSE
            CLEAR     DISPNAME
            PACK      NAME35,OCTDESC,SP70
            CALL      NAMSTR00
            RESET     DISPNAME
            MOVE      DISPNAME,KEY30
          ENDIF
.
          MOVE      "CI",CATEGORY        * Clinic Indicator
          MOVE      OMACIND,CODE
          CALL      GETCOD00 
          REP       " +",OMACLIN
.
          COMPARE   ZERO,OMASTAT
          IF        @EQUAL
            MOVE      "Yes",KEY3
          ELSE
            MOVE      "No ",KEY3
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap>",DAYDESC,"</td>":
                             "<td><A HREF=#"",LINKPRG,".pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&otcli001=",OMACLIN:
                             "&otcli006=",OCADATE:
                             "&otmas001=",DOMADAY:
                             "&otmas002=",OMASTART,"#">":
                             "<img src=#"../images/MaintenanceIcon.gif#"":
                             " class=ListIcon></a>":
                             OMASTART," to ",OMAEND,"</td>":
                             "<td>",KEY30,"</td><td>",TDESC,"</td>":
                             "<td>",KEY3,"</td>":
                             "</tr>"
.
OMROW999 RETURN
.------------------------------------------------------------
. Table of Clinics Slot Templates: Report 5
.------------------------------------------------------------
OBTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      OBHED000      * Output Table Heading
.
          PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
          CALL      RDSMASB1
OBTAB100  CALL      RDKMASB1
          BRANCH    OVRCD,OBTAB999
          MATCH     WBSESIT,OMBSITE
          GOTO      OBTAB999 IF NOT EQUAL
          MATCH     OTCLI001,OMBCLIN
          GOTO      OBTAB999 IF NOT EQUAL
          MATCH     OTMAS001,DOMBDAY
          GOTO      OBTAB999 IF NOT EQUAL
          MATCH     OTMAS002,OMBSTRT
          GOTO      OBTAB999 IF NOT EQUAL
          MATCH     OTHED005,OTMBSHNO
          GOTO      OBTAB999 IF NOT EQUAL
          MATCH     OTHED006,OTMBSDAT
          GOTO      OBTAB999 IF NOT EQUAL
.
          CALL      OBROW000      * Display Clinic Slot Template Row
          GOTO      OBTAB100 
.
OBTAB999  RETURN
.------------------------------------------------------------
. Outpatient Clinics Slot Template (TABLE HEADING)
.------------------------------------------------------------
OBHED000  WRITE     HTMLFILE;"<tr>": 
                               "<td class=HeadingCell width=20%>":
                               "Slot</td>":
                               "<td class=HeadingCell width=30%>":
                               "Time</td>":
                               "<td class=HeadingCell width=30%>":
                               "Visit Type</td>":
                               "<td class=#"HeadingCell#" ":
                                   "style=#"text-align:center;#"":
                                   "width=#"20%#">":
                               "Mark":
                               "</td>":
                             "</tr>"
.
OBHED999  RETURN
.------------------------------------------------------------
. Clinic Scheduled (TABLE ROW)
.------------------------------------------------------------
OBROW000  MATCH     SP70,OMBVTYP 
          IF        @EQUAL
            MOVE      "&nbsp;",TDESC
            MOVE      SP70,TCINDC6
          ELSE      
            MOVE      "CV",CATEGORY
            MOVE      OMBVTYP,CODE
            CALL      GETCOD00
          ENDIF
.
          MATCH     "U",TCINDC6
          IF        @EQUAL
            WRITE     HTMLFILE;"<tr bgcolor=red><td nowrap>":
                               "<A HREF='javascript:ShowDetail05";
          ELSE
            WRITE     HTMLFILE;"<tr><td nowrap>":
                               "<A HREF='javascript:ShowDetail05";
          ENDIF
.
.
.         replace slot number, 2 digit with 3 digits 10 become 010
          MOVE      OMBSLOT,TMPSLTN
          REP       " 0",TMPSLTN
.
.         slot key
          PACK      TMPKEY31,OMBSITE,OMBCLIN,DOMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
.         urlencode
          REP       " +",TMPKEY31

          WRITE     HTMLFILE;"(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&otcli001=",OMBCLIN:
                             "&otcli006=",OCADATE:
                             "&otmas001=",DOMBDAY:
                             "&otmas002=",OMBSTRT:
                             "&othed005=",OTMBSHNO:
                             "&othed006=",OTMBSDAT:
                             "&otmab001=",OMBSLOT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif":
                             " class=ListIcon></a>":
                             DOMBSLOT,"/",OMBEXSL,"</td>":
                            "<td>",OMBTIME,"&nbsp;</td>":
                            "<td>",TDESC,"&nbsp;</td>":
                            "<td style=#"text-align:center#" >";
.
          COMPARE   ZERO,OMBEXSL
          IF        @EQUAL
            WRITE     HTMLFILE;"<input type=#"checkbox#" ":
                               " name=#"slotn",TMPSLTN,"#" ":
                               " id=#"slotn",TMPSLTN,"#"":
                               " value=#"",TMPKEY31,"#" />";
          ENDIF
.
          WRITE   HTMLFILE;"&nbsp;</td></tr>"
.
OBROW999 RETURN
.------------------------------------------------------------
. Table of Clinics Slot Templates: Report 5
.------------------------------------------------------------
MSTAB000  MOVE      ZERO,CLOSNUMB
          CALL      MSHED000      * Output Table Heading
.
          PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RSOTHED1
MSTAB100  CALL      RKOTHED1
          BRANCH    OVRCD,MSTAB900
.
          MATCH     WBSESIT,OTHESITE
          GOTO      MSTAB900 IF NOT EQUAL
          MATCH     OTCLI001,OTHECLIN
          GOTO      MSTAB900 IF NOT EQUAL
          MATCH     OTMAS001,OTHEWDAY
          GOTO      MSTAB900 IF NOT EQUAL
          MATCH     OTMAS002,OTHESTRT
          GOTO      MSTAB900 IF NOT EQUAL
.
          IF        SHOWCLOS=1
            MATCH     SP70,OTHEDTCC              * Show Close schedules only
            GOTO      MSTAB100 IF EQUAL
          ELSE
            MATCH     SP70,OTHEDTCC
            IF        !@EQUAL
              ADD       ONE,CLOSNUMB
              GOTO      MSTAB100
            ENDIF
          ENDIF
.
          CALL      MSROW000      * Display Clinic Slot Template Row
.        
          GOTO      MSTAB100
.
.         checking if there is any closed template slot
.
MSTAB900  IF        CLOSNUMB>0
            WRITE     HTMLFILE;"<input type=#"hidden#" id=#"closnum#" name=#"closnum#" value=#"1#" />"
          ELSE
            WRITE     HTMLFILE;"<input type=#"hidden#" id=#"closnum#" name=#"closnum#" value=#"0#" />"
          ENDIF
.
MSTAB999  RETURN
.------------------------------------------------------------
. Outpatient Clinics Slot Template (TABLE HEADING)
.------------------------------------------------------------
MSHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell>":
                               "Schedule</td>":
                               "<td class=HeadingCell>":
                               "Open Date</td>":
                               "<td class=HeadingCell>":
                               "Finish Time</td>":
                               "<td class=HeadingCell>":
                               "Slot Time Allocated</td>";
          IF        SHOWCLOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell>":
                               "Close Date</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Slot Template/Open</td>";
.
          WRITE     HTMLFILE;"</tr>"
.
MSHED999  RETURN
.------------------------------------------------------------
. Clinic Scheduled (TABLE ROW)
.------------------------------------------------------------
MSROW000  MATCH     SP70,OTHESDAT
          IF        !@EQUAL
            UNPACK    OTHESDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDATE
          ENDIF
.
          MATCH     SP70,OTHEDTCC
          IF        !@EQUAL
            UNPACK    OTHEDTCC,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDAT1
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<img src=../images/MaintenanceIcon.gif ":
                             " class=ListIcon onclick=#"UpdateHeader05('":
                               OTHESHNO,"','",OTHESDAT,"');#">":
                               OTHESHNO,"&nbsp;</td>":
                             "<td>",DISPDATE,"&nbsp;</td>":
                             "<td>",OTHEBFIN,"</td>": 
                             "<td>",OTHEDURN,"&nbsp;</td>";
.
          IF        SHOWCLOS=1
            WRITE     HTMLFILE;"<td>",DISPDAT1,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td nowrap>":
                              "<img src=../images/AppointmentIcon.gif ":
                              " class=ListIcon onclick=#"ShowTemplate05('":
                                OTHESHNO,"','",OTHESDAT,"');#">":
                                OTHESHNO,"&nbsp;</td>";

.
          WRITE     HTMLFILE;"</tr>"
.
MSROW999 RETURN
.-----------------------------------------------------------------
.                         SESTBL00 
. Table of Clinics Session Details Dates : Report 6
. Outputs occurances of a particular Day. eg; Mondays for the Year  
.                                              called by: OSES0000
.-----------------------------------------------------------------
SESTBL00  RESET     SHOWYEAR
          MATCH     SP70,SHOWYEAR
          IF        @EQUAL
            CALL      IBACLOCK
            PACK      SHOWYEAR,CCC,CYY   * Set to current year
            REP       " 0",SHOWYEAR
          ENDIF
          MOVE      SHOWYEAR,PBYEAR      * Variable set to Prev & Next Years 
.
          MOVE      OTMAS001,LOOKDAY     * Day to Searched
.
          MOVE      SHOWYEAR,KEY4        * Get first day of year
          CALL      DOFYR000
          BRANCH    EXIT,SESTBL90  
          MOVE      FSTDAY,FIRSTDAY
.
.  Set months(no. of days) and call display routine      
.
          MOVE      ONE,MONTHNO
          MOVE      THIRTY1,MONTHTOT        * January 
          CALL      SESDAT00          
.
          MOVE      TWO,MONTHNO             * February 
          CALL      LEAPYR00                * Check if Leap Year 
          CALL      SESDAT00          
.
          MOVE      THREE,MONTHNO
          MOVE      THIRTY1,MONTHTOT        * March
          CALL      SESDAT00
.
          MOVE      FOUR,MONTHNO
          MOVE      THIRTY,MONTHTOT         * April
          CALL      SESDAT00
.
          MOVE      FIVE,MONTHNO
          MOVE      THIRTY1,MONTHTOT        * May 
          CALL      SESDAT00   
.
          MOVE      SIX,MONTHNO
          MOVE      THIRTY,MONTHTOT         * June 
          CALL      SESDAT00
.
          MOVE      SEVEN,MONTHNO
          MOVE      THIRTY1,MONTHTOT        * July
          CALL      SESDAT00   
.
          MOVE      EIGHT,MONTHNO
          MOVE      THIRTY1,MONTHTOT        * August
          CALL      SESDAT00   
.
          MOVE      NINE,MONTHNO
          MOVE      THIRTY,MONTHTOT         * September
          CALL      SESDAT00
.
          MOVE      TEN,MONTHNO
          MOVE      THIRTY1,MONTHTOT        * October
          CALL      SESDAT00   
.
          MOVE      TEN1,MONTHNO
          MOVE      THIRTY,MONTHTOT         * November
          CALL      SESDAT00
.
          MOVE      TEN2,MONTHNO
          MOVE      THIRTY1,MONTHTOT        * December
          CALL      SESDAT00   
.
          GOTO      SESTBL99 
.
.
.  Error must be displayed this way as within profields
.
SESTBL90  WRITE     HTMLFILE;"<tr>":
                             "<td align=center><br><b>First day of year not ":
                             "set!</td></tr>";
.
SESTBL99  RETURN
.----------------------------------------------------------------
.  If Leap Year, set Febuary to 29 days else set to 28 
.                                             called by: SESTBL00  
.----------------------------------------------------------------
LEAPYR00  MOVE      SHOWYEAR,F4
          ASSIGN    F4%FOUR,F2
          COMPARE   ZERO,F2  
          IF        @EQUAL
            MOVE      TWENTY9,MONTHTOT   * Leap Year Feb has 29 days
          ELSE
            MOVE      TWENTY8,MONTHTOT   * Not a Leap Year Feb has 28 days
          ENDIF    
.
LEAPYR99  RETURN
.-----------------------------------------------------------------
. Outputs occurances of a particula Day. eg; Mondays for the Year      
.       INPUTS: LOOKDAY,MONTHNO,MONTHTOT       called by: SESTBL00 
.-----------------------------------------------------------------
SESDAT00  MOVE      ONE,DAYNO      * Day of month
          MOVE      ZERO,DISPCOL   * Number of columns to be displayed.
.
          CALL      SESHED00       * Diplay Month Heading  
.                                  * Loops through Month 
          WHILE     (DAYNO<=MONTHTOT)
            IF        LOOKDAY = FIRSTDAY   
              ADD       ONE,DISPCOL
              CALL      SESROW00     * Display Date & CheckBox
            ENDIF
            ADD       ONE,FIRSTDAY
            IF        FIRSTDAY>7
              MOVE      ONE,FIRSTDAY   * Reset Day to 1=Monday
            ENDIF
            ADD       ONE,DAYNO
          DO
          IF          DISPCOL<5    
            CALL        SESBLK00   * Last Column in table must be set to "&nbsp"
          ENDIF 
.
          WRITE       HTMLFILE;"<tr>" * Close Row 
.
SESDAT99  RETURN
.----------------------------------------------------------------------
.  Displays Month left justified                    called by: SESDAT00
.----------------------------------------------------------------------
SESHED00  LOAD      MONDESC,MONTHNO,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP:
                                    OCT,NOV,DEC   
.
          MOVE      MONTHNO,MONTHROW
          REP       " 0",MONTHROW
          ASSIGN    MONTHNO%2,F2 
          COMPARE   ZERO,F2          
          IF        @EQUAL
            WRITE     HTMLFILE;"<tr class=MonthRowEven><td>";
          ELSE
            WRITE     HTMLFILE;"<tr class=MonthRowOdd><td>";
          ENDIF
          IF        DELSES=1
            WRITE     HTMLFILE;"<input type=button class=button value=":
                               MONDESC:
                               " onclick=DeleteRow06(",MONTHROW,")></td>"
          ELSE
            WRITE     HTMLFILE;"<input type=button class=button value=":
                               MONDESC:
                               " onclick=UpdateRow06(",MONTHROW,")></td>"
          ENDIF
.
SESHED99  RETURN
.----------------------------------------------------------------------
.  Display Date & CheckBox row column               called by: SESDAT00
.----------------------------------------------------------------------
SESROW00  MOVE      "date",KEY4
          MOVE      MONTHNO,KEY2
          REP       " 0",KEY2
          MOVE      DISPCOL,LABEL
          REP       " 0",LABEL
          PACK       DATECGI,KEY4,KEY2,LABEL     * format = "date0101" 
.
          MOVE      DAYNO,LABEL
          REP       " 0",LABEL
          PACK      DATE,SHOWYEAR,KEY2,LABEL 
.
          CALL      SESSTA00
.
.         Was this session opened by another slot master template
.  
          IF        OTHRTEMP=1
            WRITE     HTMLFILE;"<td align=right class=OtherTemplate width=5%>":
                               DAYNO,"</td><td class=OtherTemplate":
                               "><input type=checkbox name=":
                               DATECGI," value=",DATE," id=HolidayCell":
                               CHECKED,">":
                               "</td>"
            GOTO      SESROW99
          ENDIF
.
          PACK      KEY11,DATE,SP70  * Check for Public Holiday all hospitals
          CALL      RDPHOA1
          IF        OVRCD=1    
            IF        IBCNMHOS=1
              PACK      KEY11,DATE,OTHEHOSP,SP70  * Check for Public Holiday
              CALL      RDPHOA1                   * for the clinics hospital
              BRANCH    OVRCD,SESROW10
            ELSE
              GOTO      SESROW10
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<td align=right class=HolidayCell width=5%>":
                             DAYNO,"</td><td class=HolidayCell": 
                             "><input type=checkbox name=": 
                             DATECGI," value=",DATE," id=HolidayCell":
                             CHECKED,">":
                             "</td>"
.
          GOTO      SESROW99
.
SESROW10  PACK      KEY20,WBSESIT,OTCLI001,DATE,SP70  * Check for Clinic Leave
          CALL      RDOTCLV1                          * Dates
          BRANCH    OVRCD,SESROW20      * Not found do positional read 
          GOTO      SESROW30            * Record found output row 
.
SESROW20  PACK      KEY20,WBSESIT,OTCLI001,DATE,Z70  * Check for Clinic Leave
          CALL      RSOTCLV1                         * Dates
          CALL      RPOTCLV1
          BRANCH    OVRCD,SESROW40   
.
          MATCH     WBSESIT,OTCVSITE
          GOTO      SESROW40 IF NOT EQUAL
.
          MATCH     OTCLI001,OTCVCLIN
          GOTO      SESROW40 IF NOT EQUAL
.
          MOVE      DATE,F8               * Move variables to forms...
          MOVE      OTCVTDTE,TODTE
          MOVE      OTCVFDTE,FROMDTE 
.                                       * Check if date within leave dates
          IF        F8 >= FROMDTE & F8 <= TODTE 
            GOTO      SESROW30          * Output Clinic Leave color to html 
          ELSE
            GOTO      SESROW40          * Go on and check for public holiday  
          ENDIF
.         
SESROW30  IF          F2>FORM2
           WRITE    HTMLFILE;"<td align=right class=LeaveCell width=5%>":
                             DAYNO,"</td><td class=LeaveCell":
                             "><input type=checkbox disabled name=":
                             DATECGI," value=",DATE," id=LeaveCell":
                             CHECKED,">":
                             "</td>"
          ELSE   
           WRITE     HTMLFILE;"<td align=right class=LeaveCell width=5%>":
                             DAYNO,"</td><td class=LeaveCell": 
                             "><input type=checkbox name=": 
                             DATECGI," value=",DATE," id=LeaveCell":
                             CHECKED,">":
                             "</td>"
          ENDIF.
          GOTO      SESROW99
.
SESROW40  CALL      CHKSUS00                     * Session Suspended Yes / No
          BRANCH    SUSPEND,SESROW50             * 0 = No  and 1 = Yes
.          
          WRITE     HTMLFILE;"<td align=right width=5%>":
                            DAYNO,"</td><td><input type=checkbox name=": 
                            DATECGI," value=",DATE,CHECKED,ID,">":
                            "</td>"
.
.
          GOTO      SESROW99
.
SESROW50  WRITE     HTMLFILE;"<td align=right width=5% class=SuspendCell>":
                             DAYNO,"</td><td class=SuspendCell":
                             "><input type=checkbox disabled  name=": 
                             DATECGI," value=",DATE,CHECKED,ID,">":
                             "</td>"


SESROW99  RETURN
.------------------------------------------------------------
. Determine Checked/Disable Status
.------------------------------------------------------------
SESSTA00  MOVE      SP70,CHECKED
          MOVE      SP70,ID
          MOVE      ZERO,OTHRTEMP
.
          MATCH     OTHESDAT,DATE
          GOTO      SESSTA10 IF LESS
          MATCH     SP70,OTHEDTCC
          IF        !@EQUAL
            MATCH     DATE,OTHEDTCC
            GOTO      SESSTA10 IF LESS
          ENDIF
.
          PACK      KEY25,WBSESIT,OTCLI001,DATE,OTMAS002,SP70
          CALL      RDSESA1     * Check if Session date allready set  
          BRANCH    OVRCD,SESSTA99
.
          MATCH     OTHESHNO,OSESSHNO
          IF        !@EQUAL
            MOVE      ONE,OTHRTEMP
          ENDIF
          MATCH     OTHESDAT,OSESSDAT
          IF        !@EQUAL
            MOVE      ONE,OTHRTEMP
          ENDIF
.
          CALL      BOKCHK00   * Returns whether there is a booking or not!
          BRANCH    EXIT,SESSTA20
.
          IF        DELSES=1
            IF        OTHRTEMP=1
              MOVE      " disabled checked",CHECKED  
            ELSE
              MOVE      " checked",CHECKED  
            ENDIF
          ELSE
            MOVE      " disabled checked",CHECKED  
          ENDIF
          MOVE      " id=checked",ID
          MOVE      ZERO,EXIT
.
          GOTO      SESSTA99
.
SESSTA10  MOVE      " disabled ",CHECKED  
          MOVE      SP70,ID
          MOVE      ZERO,EXIT
          GOTO      SESSTA99
.
SESSTA20  MOVE      " disabled checked",CHECKED  
          MOVE      " id=checked",ID
          MOVE      ZERO,EXIT
          GOTO      SESSTA99
.
SESSTA99  RETURN
.----------------------------------------------------------------------
.  Display row column with Blanks
.  And Output cgi parameter for Javascript Column 5 ticks. As date__05 
.  must be present else Javascript error is raised.
.                                                   called by: SESDAT00
.----------------------------------------------------------------------
SESBLK00  MOVE      "&nbsp;",KEY6 
.
          MOVE      "date",KEY4
          MOVE      MONTHNO,KEY2
          REP       " 0",KEY2
          ADD       ONE,DISPCOL  
          MOVE      DISPCOL,LABEL 
          REP       " 0",LABEL
          PACK       DATECGI,KEY4,KEY2,LABEL * format = "date0101"
.
          WRITE     HTMLFILE;"<td align=right width=5%>":
                             KEY6,"</td><td><input type=hidden name=":
                             DATECGI,">",KEY6,"</td>"
.
SESBLK99  RETURN
.
.--------------------------------------------------------------------
. Returns the date of the last open session for a given Clinic Master
. Parameter : 0 = returns date in "DD MMM CCYY" format 
.             1 = returns date in "CCYYMMDD" format
.--------------------------------------------------------------------
LSTOPN00  PACK      KEY26,WBSESIT,OTCLI001,OTMAS001,OTMAS002,Z70
          CALL      RDSSESA3
          CALL      RDPSESA3
          BRANCH    OVRCD,LSTOPN50
.
          MATCH     OSESITE,WBSESIT         * Same Site Code?
          GOTO      LSTOPN50 IF NOT EQUAL   * No, go to exit
          MATCH     OSECLIN,OTCLI001        * Same Clinic Id?
          GOTO      LSTOPN50 IF NOT EQUAL   * No, go to exit
          MATCH     DOSEDAY,OTMAS001        * Same Day Indicator?
          GOTO      LSTOPN50 IF NOT EQUAL   * No, go to exit
          MATCH     OSESTRT,OTMAS002        * Same Session Start Time?
          GOTO      LSTOPN50 IF NOT EQUAL   * No, go to exit
.
LSTOPN10  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,LSTOPN20
          UNPACK    OSEDATE,CCENT,CYEAR,CMON,CDAY   * Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY12;
          GOTO      LSTOPN99

LSTOPN20  WRITE     HTMLFILE;OSEDATE;
          GOTO      LSTOPN99
.
LSTOPN50  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,LSTOPN60
          MOVE      SP70,KEY12
          WRITE     HTMLFILE;KEY12;
          GOTO      LSTOPN99
.
LSTOPN60  WRITE     HTMLFILE;ZERO;
          GOTO      LSTOPN99
.
LSTOPN99  RETURN
.
.------------------------------------------------------------
. Table of Outpatient Clinic Template Mapping : Report 7
.------------------------------------------------------------
OUTTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      OUTHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY25,OCASITE,OTCLI001,SP70
          CALL      RDOTWM1 
          IF        OVRCD=0
            CALL      RPOTWM1 
          ENDIF
OUTTB100  CALL      RKOTWM1 
          BRANCH    OVRCD,OUTTB900
.
          MATCH     OCASITE,OTWMSITE
          GOTO      OUTTB900 IF NOT EQUAL
.
          MATCH     OTWMCLID,OTCLI001
          GOTO      OUTTB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      OUTTB100
          ENDIF
.
          CALL      OUTRW000      * Display Clinic Template Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      OUTTB100 IF NOT EQUAL
          GOTO      OUTTB999
.
OUTTB900  CALL      NOMORE00      * Display No More Records Message
.
OUTTB999  RETURN
.------------------------------------------------------------
. Outpatient Clinic Template Mappping (TABLE HEADING)
.------------------------------------------------------------
OUTHD000  WRITE     HTMLFILE;"<tr>": 
                               "<td class=HeadingCell width=20%>":
                               "<b>Map from Server</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Map from Report</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Map from Template</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Map to Template</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Description</b></td>":
                             "</tr>"
.
OUTHD999  RETURN
.------------------------------------------------------------
. Clinic Type (TABLE ROW)
.------------------------------------------------------------
OUTRW000  MATCH     SP70,OTWMMPTT
          IF        @EQUAL
            MOVE      "&nbsp;",KEY6
          ELSE
            MOVE      OTWMMPTT,KEY6
          ENDIF
.
          MATCH     SP70,OTWMDESC
          IF        @EQUAL
            MOVE      "&nbsp;",OTWMDESC
          ELSE
            MOVE      OTWMDESC,OTWMDESC
          ENDIF

          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail07":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&otcli001=",OCACLIN:
                             "&otcli006=",OCADATE:
                             "&otwmp002=",OTWMMPSV:
                             "&otwmp003=",OTWMMPRP:
                             "&otwmp004=",OTWMMPTP:
                             "&otwmp001=",OTWMCLID:
                             "&otwmp007=",OTWMSITE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif":
                             " class=ListIcon></a>":
                             OTWMMPSV,"</td>":
                             "<td>",OTWMMPRP,"</td>":
                             "<td>",OTWMMPTP,"</td><td>",KEY6,"</td>":
                             "<td>",OTWMDESC,"</td>":
                             "</tr>"
.
OUTRW999 RETURN
.----------------------------------------------------------------------
. Update Matching Doctors 
.----------------------------------------------------------------------
CLMA0000  MOVE      OTCVCLIN,SVCVCLIN
          MOVE      OTCVFDTE,SVCVFDTE
          MOVE      OTCVTDTE,SVCVTDTE
          MOVE      OTCVREAS,SVCVREAS
          MOVE      OTCVLAST,SVCVLAST
          MOVE      OTCVSITE,SVCVSITE
.
          PACK      KEY20,SVCVSITE,SVCVCLIN,SVCVFDTE,SP70 
          CALL      RDCLIA1
          IF        OVRCD=0
            GOTO      CLMA1100
          ENDIF
.
          CALL      RDSCLIA1                * Get a valid clinic record       
CLMA1000  CALL      RDPCLIA1                * for the leave from date
          BRANCH    OVRCD,CLMA9999     
.
          MATCH     SVCVSITE,OCASITE        * Same site  
          GOTO      CLMA9999 IF NOT EQUAL
.
          MATCH     SVCVCLIN,OCACLIN        * Same clinic
          GOTO      CLMA9999 IF NOT EQUAL
.
CLMA1100  MATCH     OCADOCT,SP6             * Exit if no doctor
          GOTO      CLMA9999 IF EQUAL
.
          MOVE      OCADOCT,SAVDOCT         * Doctor
.
          PACK      KEY26,OCADOCT,SP70      
          CALL      RDSCLIA6                * Check if any other clinics are
CLMA2000  CALL      RDKCLIA6                * run by the same doctor
          BRANCH    OVRCD,CLMA9999 
.
          MATCH     OCADOCT,SAVDOCT         * Same doctor
          GOTO      CLMA9999 IF NOT EQUAL
.
          MOVE      OCACLIN,SAVECLIN
.
          PACK      KEY20,SVCVSITE,SAVECLIN,SVCVFDTE,SP70
          CALL      RDCLIA1
          IF        OVRCD=0
            GOTO     CLMA3100
          ENDIF
.
          CALL      RDSCLIA1                * Check to see if the clinic is
CLMA3000  CALL      RDPCLIA1                * still run by the same doctor
          BRANCH    OVRCD,CLMA2000          * at the leave from date
.
          MATCH     SVCVSITE,OCASITE        * Same site
          GOTO      CLMA2000 IF NOT EQUAL
.
          MATCH     SAVECLIN,OCACLIN        * Same clinic
          GOTO      CLMA2000 IF NOT EQUAL
.
CLMA3100  MATCH     SAVDOCT,OCADOCT         * Same doctor
          GOTO      CLMA2000 IF NOT EQUAL
.
          MATCH     "A",UPDTTYPE
          IF        @EQUAL
            MOVE      OCACLIN,OTCVCLIN    
            MOVE      OCASITE,OTCVSITE    
            PACK      KEY20,OTCVSITE,OTCVCLIN,OTCVFDTE,SP70
	    CALL      RDOTCLV1
	    COMPARE   ZERO,OVRCD
            GOTO      CLMA2000 IF EQUAL
.
            CALL      WROTCLV1          * write to the Clinic Leave Table
.
            CALL      CLSES000      * Delete session if on leave
.
          ENDIF
.
          MATCH     "D",UPDTTYPE
          IF        @EQUAL
            MOVE      OCACLIN,OTCVCLIN    
            MOVE      OCASITE,OTCVSITE
            PACK      KEY20,OTCVSITE,OTCVCLIN,OTCVFDTE,SP70
	    CALL      RDOTCLV1
            IF        OVRCD=0
              CALL      DEOTCLV1         * write to the Clinic Leave Table
            ENDIF
          ENDIF
.
          MATCH     "U",UPDTTYPE
          IF        @EQUAL
            MOVE      OCACLIN,OTCVCLIN    
            MOVE      OCASITE,OTCVSITE
            PACK      KEY20,OTCVSITE,OTCVCLIN,OTCVFDTE,SP70
            CALL      RDOTCLV1          * Read from the Clinic Leave Table
            COMPARE   ONE,OVRCD
            GOTO      CLMA2000 IF EQUAL 
            CALL      CLVSAV10
            CALL      UPOTCLV1          * write to the Clinic Leave Table
.
            CALL      CLSES000          * Delete session if on leave
.
          ENDIF
.
          GOTO      CLMA2000            * go to read another record
.
CLMA9999  RETURN
.------------------------------------------------------------
. Suspend/Delete Sessions if clinic on leave
.------------------------------------------------------------
CLSES000  PACK      KEY25,WBSESIT,OTCVCLIN,OTCVFDTE,SP70 
          CALL      RDSSESA1
CLSES100  CALL      RDKSESA1 
          BRANCH    OVRCD,CLSES999
          MATCH     WBSESIT,OSESITE
          GOTO      CLSES999 IF NOT EQUAL
          MATCH     OTCVCLIN,OSECLIN 
          GOTO      CLSES999 IF NOT EQUAL
          MATCH     OSEDATE,OTCVTDTE
          GOTO      CLSES999 IF LESS
.
          PACK      KEY24,WBSESIT,OTCVCLIN,DOSEDAY,Z70
          CALL      RSOTMSP1
          CALL      RPOTMSP1
          BRANCH    OVRCD,CLSES200
.
          MATCH     WBSESIT,OTMSSITE
          GOTO      CLSES200 IF NOT EQUAL
          MATCH     OTCVCLIN,OTMSCLIN
          GOTO      CLSES200 IF NOT EQUAL
          MATCH     DOSEDAY,OTMSDOWK
          GOTO      CLSES200 IF NOT EQUAL
          MOVE      OTMSSUSP,F3
          ADD       ONE,F3
.
          MOVE      OTCVCLIN,SUSCLIID
          CALL      VALSUS00
          IF        EXIT = 1      
            MOVE      ZERO,EXIT
            GOTO      CLSES100         * Session already suspended
          ENDIF
.
          GOTO      CLSES300
.
CLSES200  MOVE      ONE,F3
.
CLSES300  MOVE      WBSESIT,OTMSSITE
          MOVE      OTCVCLIN,OTMSCLIN
          MOVE      OSEDAY,OTMSDOWK
          MOVE      OSESTRT,OTMSSTIM
          MOVE      OSEDATE,OTMSFDAT          * Suspend From date = session date
          MOVE      OSEDATE,OTMSTDAT          * Suspend To date = session date
          MOVE      OTCVFDTE,OTMSRFDT         * Suspend Range From date
          MOVE      OTCVTDTE,OTMSRTDT         * Suspend Range To date
          MOVE      SUSPEN03,OTMSREAS         * Suspend Reason
          PACK      OTMSEDAT,CCC,CYY,CMM,CDD  * Get Current Date
          REP       " 0",OTMSEDAT
          CLOCK     TIME,OTMSETIM             * Get Current Time
          MOVE      WBSEUID,OTMSEUID          * Set user id

          MOVE      F3,OTMSSUSP
          PACK      KEY24,OTMSSITE,OTMSCLIN,OTMSDOWK,OTMSSUSP,OTMSFDAT
          CALL      RDOTMSP1
          IF        OVRCD=0
            ADD       ONE,F3
            GOTO      CLSES300
          ENDIF
          CALL      WROTMSP1
.
          PACK      SESSKEYS,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
          CALL      SLTSUS00
.
          GOTO      CLSES100

CLSES999  RETURN
.------------------------------------------------------------
. Validate Suspension for a particular clinic session.
. This procedure reads through the suspended sessions on "outmspaf.dat"
. to check if a particular session is already suspended.
.
. Inputs:
.    OSEDATE - Date of the session to be suspended
.    OSESTRT - Start time of the session to be suspended
. Return Values:
.    EXIT = 0 : Session not suspended.
.    EXIT = 1 : Session already suspended.     
.------------------------------------------------------------
VALSUS00  MOVE      ZERO,EXIT
          PACK      KEY24,WBSESIT,SUSCLIID,DOSEDAY,SP70
          CALL      RSOTMSP1
VALSUS10  CALL      RKOTMSP1
          BRANCH    OVRCD,VALSUS99
.
          MATCH     WBSESIT,OTMSSITE
          GOTO      VALSUS99 IF NOT EQUAL
          MATCH     SUSCLIID,OTMSCLIN
          GOTO      VALSUS99 IF NOT EQUAL
          MATCH     DOSEDAY,OTMSDOWK
          GOTO      VALSUS99 IF NOT EQUAL
.
          MATCH     OTMSSTIM,OSESTRT        * Are start times the same?
          GOTO      VALSUS10 IF NOT EQUAL   * No, check next record
          MATCH     OTMSFDAT,OSEDATE        * Are session dates the same?
          GOTO      VALSUS10 IF NOT EQUAL   * No, check next record
.
VALSUS90  MOVE      ONE,EXIT                * Yes, session already suspended
          GOTO      VALSUS99
.
VALSUS99  RETURN
.
.------------------------------------------------------------
. Suspend Appointment Update functions      
.------------------------------------------------------------
SUSP0000  CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          MOVE      "Suspended Clinics",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,SUSP9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
          GOTO      SUSP9999
.
SUSP9999  RETURN
.*******************************************************************************
. LSTS0000 List suspended clinics for the given clinic id and type         
.*******************************************************************************
LSTS0000  MOVE      ZERO,RECCOUNT
.
          MATCH     "1",MANDTYID
          IF        @EQUAL
.
.           MATCH     SP70,SRCHCLID
.           GOTO      LSTS0500 IF NOT EQUAL
.
.           MATCH     SP70,SRCHCLTY
.           GOTO      LSTS0500 IF NOT EQUAL
.
.           GOTO      LSTS9999
.
          ELSE
.
            MATCH     SP70,SRCHCLID                * Exit if no clinic id
            GOTO      LSTS9999 IF EQUAL
.
            MATCH     SP70,SRCHCLTY                * Exit if no clinic type
            GOTO      LSTS9999 IF EQUAL
.
          ENDIF
.
LSTS0500  MOVE      WBSESIT,SAVESITE             * Save users OP site
.
          PACK      KEY24,SAVESITE,FRSTDATE,SRCHCLID,SP70
          CALL      RSOTMSP2
LSTS1000  CALL      RKOTMSP2
          BRANCH    OVRCD,LSTS9000
.
          MATCH     SAVESITE,OTMSSITE
          GOTO      LSTS9000 IF NOT EQUAL
.
          MATCH     OTMSFDAT,LASTDATE
          GOTO      LSTS9000 IF LESS
.
          MATCH     SP70,SRCHCLID     
          IF        !@EQUAL
            MATCH     OTMSCLIN,SRCHCLID          * Same Clinic Id
            GOTO      LSTS1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHDOWK     
          IF        !@EQUAL
            MATCH     OTMSDOWK,SRCHDOWK          * Same Day of week 
            GOTO      LSTS1000 IF NOT EQUAL
          ENDIF
.
          MOVE      SP70,OCADESC                 * Get Clinic Name
          PACK      KEY20,OTMSSITE,OTMSCLIN,OTMSFDAT,SP70
          CALL      RDCLIA1
          IF        OVRCD <> 1
            GOTO      LSTS2000
          ENDIF
.
          PACK      KEY20,OTMSSITE,OTMSCLIN,OTMSFDAT,Z70
          CALL      RDSCLIA1
          CALL      RDPCLIA1
          BRANCH    OVRCD,LSTS2000               * Get Clinic Name
.
          MATCH     OTMSSITE,OCASITE
          IF        @EQUAL
            MATCH     OTMSCLIN,OCACLIN
            GOTO      LSTS2000 IF EQUAL
          ENDIF
.
          MOVE      SP70,OCADESC
.
LSTS2000  MOVE      "CE",CATEGORY
          MOVE      OTMSREAS,CODE                * Suspension Reason
          CALL      GETCOD00
.
          PACK      KEY10,OTMSEUID,SP70          * User Id
          CALL      RDWBSE1
          IF        OVRCD = 1
            MOVE      SP70,WBSENAM
          ENDIF
. 
          MOVE      OTMSSTIM,D5
LSTS3000  PACK      KEY26,OTMSSITE,OTMSCLIN,OTMSDOWK,D5,OTMSFDAT,SP70
          CALL      RDSESA3
          IF        OVRCD=0
            CALL      CHKB0000                   * Check for Suspended Patients
            BRANCH    EXIT,LSTS3500
            GOTO      LSTS5000
          ENDIF
.
LSTS3500  CALL      RDKSESA3                     * Check All Sessions in
          BRANCH    OVRCD,LSTS1000               * date range
.
          MATCH     OTMSSITE,OSESITE
          GOTO      LSTS1000 IF NOT EQUAL
.
          MATCH     OTMSCLIN,OSECLIN
          GOTO      LSTS1000 IF NOT EQUAL
.
          MATCH     OTMSDOWK,DOSEDAY
          GOTO      LSTS1000 IF NOT EQUAL
.
          MATCH     D5,OSESTRT
          GOTO      LSTS1000 IF NOT EQUAL
.
          MATCH     OSEDATE,OTMSTDAT
          GOTO      LSTS1000 IF LESS 
.
          MATCH     OTMSFDAT,OSEDATE
          GOTO      LSTS3500 IF LESS 
.
          CALL      CHKB0000                     * Check for Suspended Patients
          BRANCH    EXIT,LSTS3500
.
LSTS5000  PACK      KEY28,OSESITE,OSECLIN,OSEDAY,OSESTRT,OSESSHNO,OSESSDAT,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,LSTS1000
.
          MATCH     SP70,SRCHLTYP
          IF        !@EQUAL
            MATCH     OTHELTYP,SRCHLTYP
            GOTO      LSTS1000 IF NOT EQUAL
          ENDIF
.
          PACK      KEY12,OTHESITE,OTHECTYP,SP70
          CALL      RDCTYA1
          IF        OVRCD=1
            MOVE      SP70,OCTDESC
          ENDIF
.
          APPEND    LINKPRG,HTMLLINK
          APPEND    ".pbl?reportno=",HTMLLINK
          APPEND    LINKREP,HTMLLINK
          APPEND    "&template=",HTMLLINK
          APPEND    LINKTEM,HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",OTMSRFDT,"#",": 
                             "#"",OTMSRTDT,"#",":
                             "#"",TDESC,"#",":
                             "#"",D3,"#",":
                             "#"",OTMSEDAT,OTMSETIM,"#",":
                             "#"",WBSENAM,"#",":
                             "#"",OCADESC,"#",":
                             "#"",OTMSSUSP,"#",":
                             "#"",OSEDATE,"#",":
                             "#"",OCTDESC,"#");"
.
          ADD      ONE,RECCOUNT
          IF       RECCOUNT<50
            GOTO     LSTS3500
          ENDIF
.
          WRITE     HTMLFILE;"alert('Too Many Clinics to View');";
.
LSTS9000  PACK     KEY10,USERID,SP70             * Re read logged in user id
          CALL     RDWBSE1
.
LSTS9999  RETURN
.*******************************************************************************
. CHKB0000 - Check to see if there are any suspended patients in session
.*******************************************************************************
CHKB0000  MOVE      "No ",D3                      * Patients Yes / No
          MOVE      ZERO,EXIT
.
          PACK      KEY28,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
          CALL      RDSBOKA1
CHKB1000  CALL      RDKBOKA1                      * next read on details file
          BRANCH    OVRCD,CHKB9999
.
          MATCH     OSESITE,OBASITE
          GOTO      CHKB9999 IF NOT EQUAL
.
          MATCH     OSECLIN,OBACLIN
          GOTO      CHKB9999 IF NOT EQUAL
.
          MATCH     OSEDATE,OBADATE
          GOTO      CHKB9999 IF NOT EQUAL
.
          MATCH     OSESTRT,OBASTRT
          GOTO      CHKB9999 IF NOT EQUAL
.
          MATCH     SP70,SRCHCLTY
          IF        !@EQUAL
            MATCH     OBACTYP,SRCHCLTY           * Correct Clinic type
            GOTO      CHKB9000 IF NOT EQUAL
          ENDIF
.
          COMPARE     SIX,OBASTAT                * Suspended
          GOTO        CHKB1000 IF NOT EQUAL
.
          MATCH       ZEROVISN,OBAOUTNO          * Are There Supsended Patients
          GOTO        CHKB1000 IF EQUAL
.
          MOVE        "Yes",D3
          GOTO        CHKB9999
.
CHKB9000  MOVE        ONE,EXIT
          GOTO        CHKB9999
.
CHKB9999  RETURN
.*******************************************************************************
.                    Get Outpatient Sessions for a Range
.*******************************************************************************
OTMS0000  BRANCH    FLDITMNO,OTMS0100,OTMS0200,OTMS0300,OTMS0400,OTMS0500:
                             OTMS0600,OTMS0700,OTMS0800,OTMS0900,OTMS1000:
                             OTMS1100
.
          GOTO      OTMS9999
.
OTMS0100  CALL      CTYOPT00
          GOTO      OTMS9999
.
OTMS0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,SRCHCLID
          GOTO      OTMS9999 IF EQUAL
.
          BRANCH    F1,OTMS0210
.
          PACK      KEY20,WBSESIT,SRCHCLID,Z70
          CALL      RDSCLIA1          * Read Clinic Record
          CALL      RDPCLIA1          * Read Clinic Record
          BRANCH    OVRCD,OTMS0290
.
          MATCH     WBSESIT,OCASITE
          GOTO      OTMS0290 IF NOT EQUAL
.
          MATCH     SRCHCLID,OCACLIN
          GOTO      OTMS0290 IF NOT EQUAL
.
          WRITE     HTMLFILE;OCADESC;
          GOTO      OTMS0290
.
OTMS0210  WRITE     HTMLFILE;SRCHCLID;
          GOTO      OTMS9999
.
OTMS0290  PACK      KEY20,WBSESIT,CLINICID,Z70
          CALL      RDSCLIA1          * Read Clinic Record
          CALL      RDPCLIA1          * Read Clinic Record
          GOTO      OTMS9999
.
OTMS0300  CALL      NEXT0000           
          GOTO      OTMS9999
.
OTMS0400  CALL      PREV0000           
          GOTO      OTMS9999
.
OTMS0500  CALL      SELV0000           
          GOTO      OTMS9999
.
OTMS0600  WRITE     HTMLFILE;VIEWTYPE; 
          GOTO      OTMS9999
.
OTMS0700  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      LSTS0000                     * Suspended clinics by date
          GOTO      OTMS9999                     * clinic type and clinic id
.
OTMS0800  WRITE     HTMLFILE;SRCHDOWK; 
          GOTO      OTMS9999
.
OTMS0900  CALL      UPDS0000                     * Update Suspended Clinics
          GOTO      OTMS9999
.
OTMS1000  WRITE     HTMLFILE;MANDTYID;
          GOTO      OTMS9999
.
OTMS1100  WRITE     HTMLFILE;SRCHLTYP;
          GOTO      OTMS9999
.
OTMS9999  RETURN
.
.*******************************************************************************
.                           Clinic Option List
.*******************************************************************************
CTYOPT00  PACK      KEY42,SP70
          CALL      RDSCTYA2
CTYOPT10  CALL      RDKCTYA2
          BRANCH    OVRCD,CTYOPT99
          MATCH     OCTSITE,WBSESIT     * Must be in the Same Site
          GOTO      CTYOPT10 IF NOT EQUAL
          MATCH     "1",OCTACT
          GOTO      CTYOPT10 IF EQUAL
.
          MATCH     SRCHCLTY,OCTCTYP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",OCTCTYP,"#" selected>":
                               OCTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",OCTCTYP,"#">":
                               OCTDESC,"</option>"
          ENDIF
.
          GOTO      CTYOPT10
.
CTYOPT99  RETURN
.*******************************************************************************
.                          Next Day, Week, Month
.*******************************************************************************
NEXT0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          REP       " +",CLINICID
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;"outweb05.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&srchclid=",SRCHCLID:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&viewtype=",VIEWTYPE:
                             "&srchdowk=",SRCHDOWK:
                             "&srchclty=",SRCHCLTY:
                             "&otcli001=",OTCLI001:
                             "&otcli006=",OTCLI006:
                             "&otmas001=",OTMAS001:
                             "&otmas002=",OTMAS002:
                             "&mandtyid=",MANDTYID:
                             "&srchltyp=",SRCHLTYP;
          REP       "+ ",CLINICID
.
NEXT9999  RETURN
.*******************************************************************************
.                          Previous Day, Week, Month
.*******************************************************************************
PREV0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          REP       " +",CLINICID
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;"outweb05.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&srchclid=",SRCHCLID:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&viewtype=",VIEWTYPE:
                             "&srchclty=",SRCHCLTY:
                             "&srchdowk=",SRCHDOWK:
                             "&otcli001=",OTCLI001:
                             "&otcli006=",OTCLI006:
                             "&otmas001=",OTMAS001:
                             "&otmas002=",OTMAS002:
                             "&mandtyid=",MANDTYID:
                             "&srchltyp=",SRCHLTYP;
          REP       "+ ",CLINICID
.
PREV9999  RETURN
.*******************************************************************************
. UPDS0000 - Unsuspened clinic list by clinic master
.*******************************************************************************
UPDS0000  MATCH     SP70,SRCHCLID
          GOTO      UPDS9999 IF EQUAL
.
          MATCH     SP70,SRCHDOWK
          GOTO      UPDS9999 IF EQUAL
.
          MOVE      WBSESIT,SAVESITE             * Save users OP site
.
          PACK      KEY24,SAVESITE,SRCHCLID,SRCHDOWK,Z70
          CALL      RSOTMSP1
UPDS1000  CALL      RPOTMSP1
          BRANCH    OVRCD,UPDS9000
.
          MATCH     SAVESITE,OTMSSITE
          GOTO      UPDS9000 IF NOT EQUAL
.
          MATCH     OTMSCLIN,SRCHCLID            * Same Clinic Id
          GOTO      UPDS9000 IF NOT EQUAL
.
          MATCH     OTMSDOWK,SRCHDOWK            * Same Day of week
          GOTO      UPDS9000 IF NOT EQUAL
.
          MATCH     OTMSSTIM,SRCHSTIM            * Same session start time   
          GOTO      UPDS1000 IF NOT EQUAL
.
          MOVE      SP70,OCADESC                 * Get Clinic Name
          PACK      KEY20,OTMSSITE,OTMSCLIN,OTMSFDAT,SP70
          CALL      RDCLIA1
          IF        OVRCD <> 1
            GOTO      UPDS2000
          ENDIF
.
          PACK      KEY20,OTMSSITE,OTMSCLIN,OTMSFDAT,Z70
          CALL      RDSCLIA1
          CALL      RDPCLIA1
          BRANCH    OVRCD,UPDS2000               * Get Clinic Name
.
          MATCH     OTMSSITE,OCASITE
          GOTO      UPDS2000 IF EQUAL
.
          MATCH     OTMSCLIN,OCACLIN
          GOTO      UPDS2000 IF EQUAL
.
          MOVE      SP70,OCADESC
.
UPDS2000  MOVE      "CE",CATEGORY
          MOVE      OTMSREAS,CODE                * Suspension Reason
          CALL      GETCOD00
.
          PACK      KEY10,OTMSEUID,SP70          * User Id
          CALL      RDWBSE1
          IF        OVRCD = 1
            MOVE      SP70,WBSENAM
          ENDIF
.
          MOVE      ZERO,SHOWSESS                * Set session found flag to no
          MOVE      OTMSSTIM,D5
UPDS3000  PACK      KEY26,OTMSSITE,OTMSCLIN,OTMSDOWK,D5,OTMSFDAT,SP70
          CALL      RDSESA3
          IF        OVRCD = 0
            CALL      CHKB0000                   * Check for Suspended Patients
            BRANCH    EXIT,UPDS3500
            MOVE      ONE,SHOWSESS               * Set session found flag to yes
            GOTO      UPDS5000
          ENDIF
.
UPDS3500  CALL      RDKSESA3                     * Check All Sessions in
          BRANCH    OVRCD,UPDS6000               * date range
.
          MATCH     OTMSSITE,OSESITE
          GOTO      UPDS6000 IF NOT EQUAL
.
          MATCH     OTMSCLIN,OSECLIN
          GOTO      UPDS6000 IF NOT EQUAL
.
          MATCH     OTMSDOWK,DOSEDAY
          GOTO      UPDS6000 IF NOT EQUAL
.
          MATCH     D5,OSESTRT
          GOTO      UPDS6000 IF NOT EQUAL
.
          MATCH     OSEDATE,OTMSTDAT
          GOTO      UPDS6000 IF LESS
.
          MATCH     OTMSFDAT,OSEDATE
          GOTO      UPDS3500 IF LESS
.
          CALL      CHKB0000                     * Check for Suspended Patients
          BRANCH    EXIT,UPDS3500
          MOVE      ONE,SHOWSESS                 * Set session found flag to yes
.
UPDS5000  CALL      UPST0000                     * Set up display variables
.
          PACK      SAVKEY24,OTMSSITE,OTMSCLIN,OTMSDOWK,OTMSSUSP,OTMSFDAT,SP70
          WRITE     HTMLFILE;"<tr>":
                             "<tr><td>&nbsp;",DISPDATE,"</td>":
                             "<td>&nbsp;",DISPDAT1,"</td>":
                             "<td>&nbsp;",DISPDAT2,"</td>":
                             "<td>&nbsp;",TDESC,"</td>":
                             "<td>&nbsp;",D3,"</td>":
                             "<td>&nbsp;",DISPDAT3,SP1,OTMSETIM,"</td>":
                             "<td>&nbsp;",WBSENAM,"</td>":
                             "<td><input type=checkbox name=suspkeys value='":
                              SAVKEY24,"'></td><tr>"
.
          GOTO     UPDS3500
.
UPDS6000  COMPARE   ZERO,SHOWSESS               * Print a suspend record that
          GOTO      UPDS1000 IF NOT EQUAL       * does not have an open session
.
          MOVE     SP70,OSEDATE                 * Print suspend with no session
          CALL     UPST0000                     * Set up display variables
.
          PACK      SAVKEY24,OTMSSITE,OTMSCLIN,OTMSDOWK,OTMSSUSP,OTMSFDAT,SP70
          WRITE     HTMLFILE;"<tr>":
                             "<tr><td>&nbsp;",DISPDATE,"</td>":
                             "<td>&nbsp;",DISPDAT1,"</td>":
                             "<td>&nbsp;","No session","</td>":
                             "<td>&nbsp;",TDESC,"</td>":
                             "<td>&nbsp;","No","</td>":
                             "<td>&nbsp;",DISPDAT3,SP1,OTMSETIM,"</td>":
                             "<td>&nbsp;",WBSENAM,"</td>":
                             "<td><input type=checkbox name=suspkeys value='":
                              SAVKEY24,"'></td><tr>"
          GOTO     UPDS1000
.
UPDS9000  PACK     KEY10,USERID,SP70             * Re read logged in user id
          CALL     RDWBSE1                     
.
UPDS9999  RETURN
.----------------------------------------------------------------
. Set up display variables for unsuspend session list
.----------------------------------------------------------------
UPST0000  MATCH     SP70,OTMSRFDT
          IF        !@EQUAL
            UNPACK    OTMSRFDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDATE"
          ENDIF
.
          MATCH     SP70,OTMSRTDT
          IF        !@EQUAL
            UNPACK    OTMSRTDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDAT1"
          ENDIF
.
          MATCH     SP70,OSEDATE
          IF        !@EQUAL
            UNPACK    OSEDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDAT2"
          ENDIF
.
          MATCH     SP70,OTMSEDAT
          IF        !@EQUAL
            UNPACK    OTMSEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT3,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDAT3"
          ENDIF
.
UPST9999  RETURN
.----------------------------------------------------------------
. Set Parameters for suspension file keys
.----------------------------------------------------------------
STSKY000  COMPARE   "99",SUSPCNTR
          GOTO      STSKY999 IF EQUAL
.
          ADD       ONE,SUSPCNTR
          PACK      SUSPKEYS[SUSPCNTR],QRYDATA,SP70
          GOTO      STSKY999
.
STSKY999  RETURN
.----------------------------------------------------------------
. UNSP0000 Reinstate suspended sessions (Unsuspend)
.----------------------------------------------------------------
UNSP0000  MOVE      ZERO,SUSCOUNT

UNSP1000  COMPARE   "99",SUSCOUNT                 * Unsuspend Limit Reached
          GOTO      UNSP9000 IF EQUAL

          ADD       ONE,SUSCOUNT
          IF        SUSCOUNT>SUSPCNTR
            GOTO      UNSP9999
          ENDIF
.
          MATCH     SP70,SUSPKEYS[SUSCOUNT]
          GOTO      UNSP9999 IF EQUAL
.
          PACK      KEY24,SUSPKEYS[SUSCOUNT],SP70
          CALL      RDOTMSP1
          BRANCH    OVRCD,UNSP1000
.
          CALL      USUS0000                      * Unsuspend Sessions
.
          PACK      KEY24,SUSPKEYS[SUSCOUNT],SP70 * Delete suspension record
          CALL      DEOTMSP1
.
          GOTO      UNSP1000
.
UNSP8000  MOVE      ZERO,EXIT
          GOTO      UNSP9999
.
UNSP9000  MOVE      "Unsuspend Limit Reached",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UNSP9999
.
UNSP9999  RETURN
.----------------------------------------------------------------
. USUS0000 - Reinstate suspended sessions (Unsuspend)
.----------------------------------------------------------------
USUS0000  MOVE      OTMSSTIM,D5
          PACK      KEY26,OTMSSITE,OTMSCLIN,OTMSDOWK,D5,OTMSFDAT,SP70
          CALL      RDSESA3
          COMPARE   ZERO,OVRCD
          GOTO      USUS5000 IF EQUAL
.
USUS1000  CALL      RDKSESA3                     * Check all sessions in date
          BRANCH    OVRCD,USUS9999               * range OTMSFDAT - OTMSTDAT
.
          MATCH     OTMSSITE,OSESITE
          GOTO      USUS9999 IF NOT EQUAL
.
          MATCH     OTMSCLIN,OSECLIN
          GOTO      USUS9999 IF NOT EQUAL
.
          MATCH     OTMSDOWK,DOSEDAY
          GOTO      USUS9999 IF NOT EQUAL
.
          MATCH     D5,OSESTRT
          GOTO      USUS9999 IF NOT EQUAL
.
          MATCH     OSEDATE,OTMSTDAT
          GOTO      USUS9999 IF LESS
.
USUS5000  PACK      SESSKEYS,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
.
          MOVE      SESSKEYS,SAVSKEYS
          CALL      UNSL0000                    * Changed status of bookings
          CALL      RCAL0000                    * Recalculate slot counts
.
          GOTO      USUS1000
.
USUS9999  RETURN
.--------------------------------------------------------------------
. UNSL0000 - Unsuspend Change the Status(DOBASTAT)
.--------------------------------------------------------------------
UNSL0000  PACK      KEY28,SESSKEYS,SP70
          CALL      RDSBOKA1
UNSL1000  CALL      RDKBOKA1
          BRANCH    OVRCD,UNSL9999
.
          PACK      KEY25,OBASITE,OBACLIN,OBADATE,OBASTRT
          MATCH     SESSKEYS,KEY25
          GOTO      UNSL9999 IF NOT EQUAL   * different session
.
          IF        OBASTAT=6
            PACK      KEY28,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT
            CALL      RLOTBOA1
            MATCH     ZEROVISN,OBAOUTNO
            IF        @EQUAL
              MOVE      "0",OBASTAT          * If there is no patient change  
            ELSE                             * status to NOT booked
              MOVE      "1",OBASTAT          * If there is a patient change 
            ENDIF                            * status to booked
            CALL      UPBOKA1
            CALL      UUOTBOA1
            GOTO      UNSL1000
          ENDIF
.
          GOTO      UNSL1000
.
UNSL9999  RETURN
.
.------------------------------------------------------------------------------
. Re calculate the session statistics
.------------------------------------------------------------------------------
RCAL0000  MATCH     SP70,SAVSKEYS
          GOTO      RCAL9999 IF EQUAL
.
          MOVE      SAVSKEYS,SESSKEYS
.
          PACK      KEY25,SESSKEYS,SP70
          CALL      RDSESA1
          BRANCH    OVRCD,RCAL9999
.
          PACK      KEY28,OSESITE,OSECLIN,OSEDAY,OSESTRT,OSESSHNO,OSESSDAT,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,RCAL9999
.
          PACK      KEY18,OSESITE,OSECLIN,OSEDAY,OSESTRT,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,RCAL9999
.
          MOVE      "00:00",OSETIMEU
          MOVE      ZERO,OSESLOTB              * slots booked
          MOVE      ZERO,OSESLOTS              * slots scheduled
          MOVE      ZERO,OSESSLTN              * New slots scheduled
          MOVE      ZERO,OSESSLTR              * Review slots scheduled
          MOVE      ZERO,OSESSLTS              * Special slots scheduled
          MOVE      ZERO,OSEBNEW               * New slots scheduled
          MOVE      ZERO,OSEBRV                * Review slots scheduled
          MOVE      ZERO,OSEBSPC               * Special slots scheduled
          MOVE      ZERO,OSEANEW               * New slots scheduled
          MOVE      ZERO,OSEARV                * Review slots scheduled
          MOVE      ZERO,OSEASPC               * Special slots scheduled
.
          CALL      CNTSLT00
.
          CALL      UPSESA1
.
RCAL9999  RETURN
.
.**********************************************************************
.*                               CNTSLT00                             *
.*        Count Slots                                                 *
.**********************************************************************
CNTSLT00  PACK      KEY28,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
          CALL      RDSBOKA1
CNTSLT10  CALL      RDKBOKA1
          BRANCH    OVRCD,CNTSLT99
          MATCH     OSESITE,OBASITE
          GOTO      CNTSLT99 IF NOT EQUAL
          MATCH     OSECLIN,OBACLIN
          GOTO      CNTSLT99 IF NOT EQUAL
          MATCH     OSEDATE,OBADATE
          GOTO      CNTSLT99 IF NOT EQUAL
          MATCH     OSESTRT,OBASTRT
          GOTO      CNTSLT99 IF NOT EQUAL
.
          COMPARE   THREE,OBASTAT
          GOTO      CNTSLT10 IF EQUAL
.
          COMPARE   SEVEN,OBASTAT
          GOTO      CNTSLT10 IF EQUAL
.
          PACK      KEY5,ANSC,ANSV,OBAVISIT
          CALL      RDCODE1
          BRANCH    OVRCD,CNTSLT10
.
          IF        TCFORM6=0
            MOVE      ONE,TCFORM6
          ENDIF
          ADD       TCFORM6,OSESLOTS
.
          IF        (OBASTAT=1|OBASTAT=4|OBASTAT=5)
            ADD       TCFORM6,OSESLOTB
            CALL      ADDTIM00
          ENDIF
.
          MATCH     ANSN,TCINDC1
          GOTO      CNTSLT20 IF NOT EQUAL
.
          ADD       ONE,OSESSLTN
          IF        (OBASTAT=1|OBASTAT=5)
            ADD       ONE,OSEBNEW
          ENDIF
          IF        OBASTAT=4
            ADD       ONE,OSEBNEW
            ADD       ONE,OSEANEW
          ENDIF
          GOTO      CNTSLT10
.
CNTSLT20  MATCH     ANSR,TCINDC1
          GOTO      CNTSLT30 IF NOT EQUAL
.
          ADD       ONE,OSESSLTR
          IF        (OBASTAT=1|OBASTAT=5)
            ADD       ONE,OSEBRV
          ENDIF
          IF        OBASTAT=4
            ADD       ONE,OSEBRV
            ADD       ONE,OSEARV
          ENDIF

          GOTO      CNTSLT10
.
CNTSLT30  MATCH     ANSS,TCINDC1
          GOTO      CNTSLT10 IF NOT EQUAL
.
          ADD       ONE,OSESSLTS
          IF        (OBASTAT=1|OBASTAT=5)
            ADD       ONE,OSEBSPC
          ENDIF
          IF        OBASTAT=4
            ADD       ONE,OSEBSPC
            ADD       ONE,OSEASPC
          ENDIF
          GOTO      CNTSLT10
.
CNTSLT99  RETURN
.
.------------------------------------------------------------
. Check for Master Suspension
.------------------------------------------------------------
CHKSUS00  MOVE      ZERO,SUSPEND
          PACK      KEY24,WBSESIT,OTCLI001,OTMAS001,Z70
          CALL      RSOTMSP1
CHKSUS10  CALL      RPOTMSP1
          BRANCH    OVRCD,CHKSUS99
.
          MATCH     WBSESIT,OTMSSITE
          GOTO      CHKSUS99 IF NOT EQUAL
.
          MATCH     OTCLI001,OTMSCLIN
          GOTO      CHKSUS99 IF NOT EQUAL
.
          MOVE      OTMAS001,KEY1
          MATCH     KEY1,OTMSDOWK
          GOTO      CHKSUS99 IF NOT EQUAL
.
          MATCH     OTMAS002,OTMSSTIM             * Same session start time
          GOTO      CHKSUS10 IF NOT EQUAL
.
          MATCH     OTMSFDAT,DATE
          GOTO      CHKSUS10 IF LESS
          GOTO      CHKSUS20 IF EQUAL
.
          MATCH     DATE,OTMSTDAT
          GOTO      CHKSUS10 IF LESS
.
CHKSUS20  MOVE      ONE,SUSPEND
.
CHKSUS99  RETURN
.
.------------------------------------------------------------
.  Outpatient Site code
.  Parameter : 0=Description, 1=Code, 2=Selection List
.------------------------------------------------------------
OUTSIT00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OUTSIT10,OUTSIT20
.
          PACK      KEY6,WBSESIT,SP70         * description
          CALL      RDSITA1
          IF        OVRCD=1
            MOVE      SP70,OSTDESC
          ENDIF
.
          WRITE     HTMLFILE;OSTDESC
          GOTO      OUTSIT99
.
OUTSIT10  WRITE     HTMLFILE;WBSESIT;         * code
          GOTO      OUTSIT99
.
OUTSIT20  PACK      KEY6,SP70                 * selection list
          CALL      RDSSITA1
OUTSIT30  CALL      RDKSITA1
          BRANCH    OVRCD,OUTSIT99
          MATCH     SP70,OSTSITE
          GOTO      OUTSIT30 IF EQUAL
          PACK      KEY10,QUOTE,OSTSITE,QUOTE
          MATCH     WBSESIT,OSTSITE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY10," selected>":
                               OSTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY10,">",OSTDESC,"</option>"
          ENDIF
          GOTO      OUTSIT30
.
OUTSIT99  RETURN
.
.------------------------------------------------------------
. Visit Type Selection Options
. Category CV - Indictor 6 ="U"navailable slot type
. Only display visit types linked to the clinic type if any exists
. otherwise display all
.------------------------------------------------------------
VTYSEL00  MOVE      ZERO,LINKVTYP           * Display all visit types
.
          PACK      KEY15,OTHESITE,OTHECTYP,SP70
          CALL      RSOTCVT1
          CALL      RKOTCVT1                * Check the clinic type for
          BRANCH    OVRCD,VTYSEL05          * linked visit types
.
          MATCH     OTHESITE,OCVTSITE       * Same Site
          GOTO      VTYSEL05 IF NOT EQUAL
.
          MATCH     OTHECTYP,OCVTCTYP       * Same Clinic Type
          GOTO      VTYSEL05 IF NOT EQUAL
.
          MOVE      ONE,LINKVTYP            * Only display linked visit types
.
VTYSEL05  MOVE      "CV",CATEGORY
          MOVE      SP70,TDESC
          PACK      KEY5,CATEGORY,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      CATEGORY,TCODE
            MOVE      "Invalid Category",TDESC
          ENDIF
          REP       " _",TCODE
          REP       " _",THCSCOD
          WRITE     HTMLFILE;"<!--<cat-c category=#"",TCODE,"#" name=#"",TDESC:
                             "#" map=#"",THCSCOD,"#"></cat-c>-->"
.
          PACK      PTCDKEY2,CATEGORY,SP70
          CALL      RDSCODE2
VTYSEL10  CALL      RDKCODE2
          BRANCH    OVRCD,VTYSEL99
.
          MATCH     CATEGORY,TCODE
          GOTO      VTYSEL99 IF NOT EQUAL
.
          MATCH     SP70,ACODE
          GOTO      VTYSEL10 IF EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      VTYSEL10 IF EQUAL
.
          IF        VISTFLAG=1
            MATCH     "U",TCINDC6
            GOTO      VTYSEL10 IF NOT EQUAL
          ELSE
            MATCH     "U",TCINDC6
            GOTO      VTYSEL10 IF EQUAL
.
            MATCH     ANSZ,TCINDC2
            GOTO      VTYSEL10 IF EQUAL
          ENDIF
.
          IF        VISTFLAG=2
            IF        TCFORM6>1
              GOTO      VTYSEL10            * Only display sigle slot types
            ENDIF
          ENDIF
.
          PACK      KEY15,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10:
                          TCINDC11,THCSCOD
          PACK      KEY20,QUOTE,ACODE,KEY15,QUOTE
          MATCH     CODE,ACODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY20," selected>":
                               TDESC,"</option>"
          ELSE
            IF        LINKVTYP=1        
              PACK      KEY15,OTHESITE,OTHECTYP,ACODE,SP70
              CALL      RDOTCVT1          * Only display linked visit types
              BRANCH    OVRCD,VTYSEL10     
            ENDIF
.
            IF        IBCNMHOS=1
              MATCH    "1",PTCDHOSS
              IF       @EQUAL
                PACK     KEY8,WBSEHOSP,TCODE,ACODE,SP70
                CALL     RDMLCOD1
                BRANCH   OVRCD,VTYSEL10
              ENDIF
            ENDIF
            WRITE     HTMLFILE;"<option value=",KEY20,">",TDESC,"</option>"
          ENDIF
          GOTO      VTYSEL10
.
VTYSEL99  RETURN
.
.----------------------------------------------------------------
.                         CHKOPN00
. Check that the template header open and close dates do not overlap any
. other open and close dates for this template schedule. Called by OUTMAB00
.----------------------------------------------------------------
CHKOPN00  MATCH     Z70,OTHED006            * Open date is mandatory
          GOTO      CHKOPN90 IF EQUAL
.
          MATCH     Z70,OTHED007            * Is there a close date
          GOTO      CHKOPN10 IF EQUAL
.
          MATCH     SP70,OTHED007           * Is there a close date
          GOTO      CHKOPN10 IF EQUAL
.
          MATCH     OTHED006,OTHED007
          GOTO      CHKOPN93 IF LESS        * Is the close date before open date
.
CHKOPN10  MATCH     OTMADTCO,OTHED006       * Check template open date with the
          GOTO      CHKOPN92 IF LESS        * clinic master open date
.
          MATCH     SP70,OTMADTCC           * Clinic is not closed
          GOTO      CHKOPN40 IF EQUAL
.
          MATCH     Z70,OTHED006            * Template is not closed
          GOTO      CHKOPN20 IF EQUAL
.
          MATCH     OTHED006,OTMADTCC       * Check template open date with the
          GOTO      CHKOPN92 IF LESS        * clinic master close date
.
CHKOPN20  MATCH     Z70,OTHED007            * Template is not closed
          GOTO      CHKOPN40 IF EQUAL
.
          MATCH     SP70,OTHED007           * Template is not closed
          GOTO      CHKOPN40 IF EQUAL
.
          MATCH     OTHED007,OTMADTCC       * Check template close date with the
          GOTO      CHKOPN92 IF LESS        * clinic master close date
.
CHKOPN40  MOVE      ZERO,DATE1              * Clear date variable
          MOVE      ZERO,DATE2              * Clear date variable
          SQUEEZE   OTHED006
          MOVE      OTHED006,DATE1          * Move Open date to Date1
.
          MATCH     Z70,OTHED007
          IF        !@EQUAL
            MATCH     SP70,OTHED007
            IF        !@EQUAL
              SQUEEZE  OTHED007
              MOVE     OTHED007,DATE2        * Move Close date to Date2
            ENDIF
          ENDIF
.
          MATCH     "T",UPDTTYPE             * No need to check other open
          GOTO      CHKOPN98 IF EQUAL        * templates when you are updating
.
.--------- loop through the outhedaf and check if there is any other ------
.--------- open or closed template header for this clinic and schedule -----
.
          PACK      KEY28,WBSESIT,OTHED002,OTHED003,OTHED004:
                          OTHED005,SP70
          CALL      RSOTHED1
CHKOPN50  CALL      RKOTHED1
          BRANCH    OVRCD,CHKOPN98
.
          MATCH     WBSESIT,OTHESITE
          GOTO      CHKOPN98 IF NOT EQUAL       * Exit if not the same site
.
          MATCH     OTHED002,OTHECLIN
          GOTO      CHKOPN98 IF NOT EQUAL       * Exit if not the same clinic
.
          MATCH     OTHED003,OTHEWDAY
          GOTO      CHKOPN98 IF NOT EQUAL       * Exit if not the same day
.
          MATCH     OTHED004,OTHESTRT
          GOTO      CHKOPN98 IF NOT EQUAL       * Exit if not same start time
.
          MATCH     OTHED005,OTHESHNO
          GOTO      CHKOPN98 IF NOT EQUAL       * Exit if not same schedule no
.
          MATCH     OTHED006,OTHESDAT           * Skip record that we are
          GOTO      CHKOPN50 IF EQUAL           * currently updating(OPEN DATE)
.
          MOVE      ZERO,DATE3
          MOVE      ZERO,DATE4
          MOVE      OTHESDAT,DATE3
          MOVE      OTHEDTCC,DATE4
.
.--------case when the ToDate is not entered ------------------------
.
          COMPARE   ZERO,DATE2
          IF        @EQUAL
            IF        DATE1 >= DATE3 & DATE1 <= DATE4
              GOTO      CHKOPN91
            ENDIF
            IF        DATE4 = 0
              GOTO      CHKOPN94
            ENDIF
          GOTO      CHKOPN50
          ENDIF
.
.--------case when the Fromdate and Todate are Entered----------------
.
CHKOPN70  IF        DATE3 <= DATE1 & DATE4 >= DATE1 & DATE4 <> 0
            GOTO      CHKOPN91
          ENDIF
          IF        DATE3 <= DATE2 & DATE4 >= DATE2 & DATE4 <> 0
            GOTO      CHKOPN91
          ENDIF
          IF        DATE1 < DATE3 & DATE2 > DATE4 & DATE4 <> 0
            GOTO      CHKOPN91
          ENDIF
          IF        DATE4 = 0
            GOTO      CHKOPN94
          ENDIF
          GOTO        CHKOPN50
.
CHKOPN90  MOVE      "Schedule open date is a Mandatory field",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPN99
.
CHKOPN91  CLEAR     WEBTITLE
          APPEND    "ERROR: Schedule Open/Close date conflict.",WEBTITLE
          APPEND    "Schedule not added/Updated.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPN99
.
CHKOPN92  CLEAR     WEBTITLE
          APPEND    "Schedule Open/Close dates must be ",WEBTITLE
          APPEND    "within the clinic master open/close dates.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPN99
.
CHKOPN93  CLEAR     WEBTITLE
          APPEND    "Schedule close date must be after the ",WEBTITLE
          APPEND    "schedule open date.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPN99
.
CHKOPN94  CLEAR     WEBTITLE
          APPEND    "All matching schedules must be close ",WEBTITLE
          APPEND    "before any additions.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPN99
.
CHKOPN98  PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                         OTHED005,OTHED006,SP70
          CALL      RDOTHED1
          IF        OVRCD=1
            CALL      CLOUTHED    * Clear all the file variables 
          ENDIF
          MOVE      ZERO,EXIT
.
CHKOPN99  RETURN
.
.----------------------------------------------------------------
.                         CHKCDT00
. Check that there are no template headers that are after the current 
. template. If there are the closed date can not be deleted or updated.
.----------------------------------------------------------------
CHKCDT00  MATCH     SP70,OTHEDTCC           * Exit if no closed date
          GOTO      CHKCDT99 IF EQUAL
.
          MATCH     Z70,OTHED007            * Is there a close date cgi
          GOTO      CHKCDT99 IF EQUAL
.
.         MATCH     SP70,OTHED007           * Is the close date cgi blank
.         GOTO      CHKCDT99 IF EQUAL
.
          MATCH     OTHEDTCC,OTHED007       * Is the closed date being updated
          GOTO      CHKCDT99 IF EQUAL
.
CHKCDT10  PACK      KEY28,WBSESIT,OTHED002,OTHED003,OTHED004,OTHED005:
                          OTHED006,SP70
          CALL      RDOTHED1                * Re read original template header
          BRANCH    OVRCD,CHKCDT91
.
          CALL      RKOTHED1
          BRANCH    OVRCD,CHKCDT98          * Ok to update no newer headers
.
          MATCH     OTHESITE,WBSESIT        * Same Site
          GOTO      CHKCDT98 IF NOT EQUAL
.
          MATCH     OTHECLIN,OTHED002       * Same clinic
          GOTO      CHKCDT98 IF NOT EQUAL
.
          MATCH     OTHEWDAY,OTHED003       * Same week day
          GOTO      CHKCDT98 IF NOT EQUAL
.
          MATCH     OTHESTRT,OTHED004       * Same session start time
          GOTO      CHKCDT98 IF NOT EQUAL
.
          MATCH     OTHESHNO,OTHED005       * Same schedule number
          GOTO      CHKCDT98 IF NOT EQUAL
.
CHKCDT90  CLEAR     WEBTITLE
          APPEND    "ERROR: Schedules exist after this closed date.",WEBTITLE
          APPEND    "Closed date can not be modified.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCDT99
.
CHKCDT91  CLEAR     WEBTITLE
          APPEND    "ERROR: Invalid slot template master record.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCDT99
.
CHKCDT98  PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                         OTHED005,OTHED006,SP70
          CALL      RDOTHED1
          IF        OVRCD=1
            CALL      CLOUTHED    * Clear all the file variables
          ENDIF
          MOVE      ZERO,EXIT
.
CHKCDT99  RETURN
.
.----------------------------------------------------------------
.                         CHKDAT00
. Check that the clinic master close date is after all schedule template
. open and closer dates.                                Called by OUTMAB00
.----------------------------------------------------------------
CHKDAT00  MATCH     Z70,OTMAS053            * It there a clinic close date
          GOTO      CHKDAT99 IF EQUAL
.
          MATCH     SP70,OTMAS053           * Is there a clinic close date
          GOTO      CHKDAT99 IF EQUAL
.
          PACK      KEY28,OMASITE,OMACLIN,OMADAY,OMASTART,SP70
          CALL      RSOTHED1
CHKDAT50  CALL      RKOTHED1
          BRANCH    OVRCD,CHKDAT99
.
          MATCH     OMASITE,OTHESITE
          GOTO      CHKDAT99 IF NOT EQUAL       * Exit if not the same site
.
          MATCH     OMACLIN,OTHECLIN
          GOTO      CHKDAT99 IF NOT EQUAL       * Exit if not the same clinic
.
          MATCH     DOMADAY,OTHEWDAY
          GOTO      CHKDAT99 IF NOT EQUAL       * Exit if not the same day
.
          MATCH     OMASTART,OTHESTRT
          GOTO      CHKDAT99 IF NOT EQUAL       * Exit if not same start time
.
          MATCH     SP70,OTHEDTCC               * All templates must be closed
          GOTO      CHKDAT90 IF EQUAL
.
          MATCH     OTHESDAT,OTMAS053           * Check schedule date
          GOTO      CHKDAT91 IF LESS
.
          MATCH     OTHEDTCC,OTMAS053           * Check schedule close date
          GOTO      CHKDAT91 IF LESS
.
          GOTO      CHKDAT50
.
CHKDAT90  CLEAR     WEBTITLE
          APPEND    "Please close all schedule templates ",WEBTITLE
          APPEND    "before closing this clinic.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKDAT99
.
CHKDAT91  CLEAR     WEBTITLE
          APPEND    "Clinic close date must be after all",WEBTITLE
          APPEND    "schedule template open/close dates.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKDAT99
.
CHKDAT99  RETURN
.
.----------------------------------------------------------------
.                         CHKDEL00
. Check to see if we can delete this template header. If there are any sessions
. that have been opened we can not delete it. Called by OUTMAB00
.----------------------------------------------------------------
CHKDEL00  MOVE      ZERO,EXIT
          PACK      KEY36,OTHESITE,OTHECLIN,OTHEWDAY,OTHESTRT,OTHESHNO:
                          OTHESDAT,SP70
          CALL      RDSSESA5
          CALL      RDKSESA5
          BRANCH    OVRCD,CHKDEL99
.
          MATCH     OTHESITE,OSESITE             * Same Site
          GOTO      CHKDEL99 IF NOT EQUAL
.
          MATCH     OTHECLIN,OSECLIN             * Same Clinic
          GOTO      CHKDEL99 IF NOT EQUAL
.
          MATCH     OTHEWDAY,DOSEDAY             * Same Day
          GOTO      CHKDEL99 IF NOT EQUAL
.
          MATCH     OTHESTRT,OSESTRT             * Same Start Time
          GOTO      CHKDEL99 IF NOT EQUAL
.
          MATCH     OTHESHNO,OSESSHNO            * Same Schedule
          GOTO      CHKDEL99 IF NOT EQUAL
.
          MATCH     OTHESDAT,OSESSDAT            * Same Schedule Date
          GOTO      CHKDEL99 IF NOT EQUAL
.
CHKDEL90  MOVE      "Cannot perform delete as Sessions have been ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "opened!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKDEL99
.
CHKDEL99  RETURN
.----------------------------------------------------------------
.                         COPT0000
. Copy active records from outhedaf and outmsbaf to the new clinic
.----------------------------------------------------------------
COPT0000  PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RSOTHED1
COPT1000  CALL      RKOTHED1
          BRANCH    OVRCD,COPT9999
.
          MATCH     WBSESIT,OTHESITE
          GOTO      COPT9999 IF NOT EQUAL
.
          MATCH     OTCLI001,OTHECLIN
          GOTO      COPT9999 IF NOT EQUAL
.
          MATCH     OTMAS001,OTHEWDAY
          GOTO      COPT9999 IF NOT EQUAL
.
          MATCH     OTMAS002,OTHESTRT
          GOTO      COPT9999 IF NOT EQUAL
.
          MATCH     SP70,OTHEDTCC                * Only copy open templates
          GOTO      COPT1000 IF NOT EQUAL 
.
          PACK      SAVKEY28,OTHESITE,OTHECLIN,OTHEWDAY,OTHESTRT:
                             OTHESHNO,OTHESDAT,SP70
.
          PACK      KEY28,OTHESITE,OMACLIN,OMADAY,OMASTART:
                             OTHESHNO,OTMADTCO,SP70
.
          CALL      RDOTHED1
          IF        OVRCD=1
            MOVE      OMACLIN,OTHECLIN
            MOVE      OMADAY,OTHEWDAY
            MOVE      OMASTART,OTHESTRT
            MOVE      OTMADTCO,OTHESDAT
            MOVE      SP70,OTHEDATE          * Clear last session opened date
            CALL      WROTHED1
          ENDIF
.
          MOVE      SAVKEY28,KEY28
          CALL      RDOTHED1
          BRANCH    OVRCD,COPT1000
.
          PACK      KEY31,OTHESITE,OTHECLIN,OTHEWDAY,OTHESTRT:
                          OTHESHNO,OTHESDAT,SP70
          CALL      RDSMASB1
COPT5000  CALL      RDKMASB1
          BRANCH    OVRCD,COPT1000
.
          PACK      SAVKEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                             OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
.
          MATCH     OTHESITE,OMBSITE
          GOTO      COPT1000 IF NOT EQUAL
.
          MATCH     OTHECLIN,OMBCLIN
          GOTO      COPT1000 IF NOT EQUAL
.
          MATCH     OTHEWDAY,DOMBDAY
          GOTO      COPT1000 IF NOT EQUAL
.
          MATCH     OTHESTRT,OMBSTRT
          GOTO      COPT1000 IF NOT EQUAL
.
          MATCH     OTHESHNO,OTMBSHNO
          GOTO      COPT1000 IF NOT EQUAL
.
          MATCH     OTHESDAT,OTMBSDAT
          GOTO      COPT1000 IF NOT EQUAL
.
          PACK      KEY31,OMASITE,OMACLIN,OMADAY,OMASTART:
                          OTHESHNO,OTMADTCO,OMBSLOT,SP70
          CALL      RDAMASB1
          IF        OVRCD=1
            UNPACK    KEY31,OMBSITE,OMBCLIN,DOMBDAY,OMBSTRT:
                            OTMBSHNO,OTMBSDAT,DOMBSLOT
            MOVE      DOMBDAY,OMBDAY
            MOVE      DOMBSLOT,OMBSLOT
            CALL      WRMASB1
          ENDIF
          MOVE      SAVKEY31,KEY31
          CALL      RDMASB1
          GOTO      COPT5000
.
COPT9999  RETURN
.
.----------------------------------------------------------------
.                         DELH0000
. Delete all records from outhedaf and outmsbaf
.----------------------------------------------------------------
DELH0000  PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RSOTHED1
          CALL      RKOTHED1
          BRANCH    OVRCD,DELH5000
.
          MATCH     WBSESIT,OTHESITE
          GOTO      DELH5000 IF NOT EQUAL
.
          MATCH     OTCLI001,OTHECLIN
          GOTO      DELH5000 IF NOT EQUAL
.
          MATCH     OTMAS001,OTHEWDAY
          GOTO      DELH5000 IF NOT EQUAL
.
          MATCH     OTMAS002,OTHESTRT
          GOTO      DELH5000 IF NOT EQUAL
.
          PACK      KEY28,OTHESITE,OTHECLIN,OTHEWDAY,OTHESTRT:
                             OTHESHNO,OTHESDAT,SP70
.
          CALL      DEOTHED1
.
          GOTO      DELH0000
.
DELH5000  PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002
          CALL      RDSMASB1
          CALL      RDKMASB1
          BRANCH    OVRCD,DELH9999
.
          MATCH     WBSESIT,OMBSITE
          GOTO      DELH9999 IF NOT EQUAL
.
          MATCH     OTCLI001,OMBCLIN
          GOTO      DELH9999 IF NOT EQUAL
.
          MATCH     OTMAS001,DOMBDAY
          GOTO      DELH9999 IF NOT EQUAL
.
          MATCH     OTMAS002,OMBSTRT
          GOTO      DELH9999 IF NOT EQUAL
.
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT,OTMBSHNO:
                          OTMBSDAT,OMBSLOT
          CALL      DEMASB1
          GOTO      DELH5000
.
DELH9999  RETURN
.
.
.----------------------------------------------------------------
.                         CHKCLS00
. Check to see if we can delete this template header. If there are any sessions
. that have been opened we can not delete it. Called by OUTMAB00
.----------------------------------------------------------------
CHKCLS00  MOVE      ZERO,EXIT
          MATCH     Z70,OTHED007                 * Exit if no header close date
          GOTO      CHKCLS99 IF EQUAL
.
          MATCH     SP70,OTHED007                * Exit if no header close date
          GOTO      CHKCLS99 IF EQUAL
.
          PACK      KEY36,OTHESITE,OTHECLIN,OTHEWDAY,OTHESTRT,OTHESHNO:
                          OTHESDAT,Z70
          CALL      RDSSESA5
          CALL      RDPSESA5
          BRANCH    OVRCD,CHKCLS99
.
          MATCH     OTHESITE,OSESITE             * Same Site
          GOTO      CHKCLS99 IF NOT EQUAL
.
          MATCH     OTHECLIN,OSECLIN             * Same Clinic
          GOTO      CHKCLS99 IF NOT EQUAL
.
          MATCH     OTHEWDAY,DOSEDAY             * Same Day
          GOTO      CHKCLS99 IF NOT EQUAL
.
          MATCH     OTHESTRT,OSESTRT             * Same Start Time
          GOTO      CHKCLS99 IF NOT EQUAL
.
          MATCH     OTHESHNO,OSESSHNO            * Same Schedule
          GOTO      CHKCLS99 IF NOT EQUAL
.
          MATCH     OTHESDAT,OSESSDAT            * Same Schedule Date
          GOTO      CHKCLS99 IF NOT EQUAL
.
          MATCH     OSEDATE,OTHED007             * Are sessions open after the
          GOTO      CHKCLS99 IF NOT LESS         * header close date.
.
CHKCLS90  CLEAR     WEBTITLE
          APPEND    "Sessions have been opened after the template ",WEBTITLE
          APPEND    "close date. Please delete sessions.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCLS99
.
CHKCLS99  RETURN
.*******************************************************************************
.  List open session for a date range
.*******************************************************************************
OPNL0000  PACK      KEY26,WBSESIT,OTCLI001,OTMAS001,OTMAS002,FRSTDATE,SP70
          CALL      RDSESA3
.
          COMPARE   ZERO,OVRCD
          GOTO      OPNL1100 IF EQUAL
.
OPNL1000  CALL      RDKSESA3
          BRANCH    OVRCD,OPNL9999
.
OPNL1100  MATCH     WBSESIT,OSESITE
          GOTO      OPNL9999 IF NOT EQUAL
.
          MATCH     OTCLI001,OSECLIN
          GOTO      OPNL9999 IF NOT EQUAL
.
          MATCH     OTMAS001,DOSEDAY
          GOTO      OPNL9999 IF NOT EQUAL
.
          MATCH     OTMAS002,OSESTRT
          GOTO      OPNL9999 IF NOT EQUAL
.
          MATCH     OSEDATE,LASTDATE
          GOTO      OPNL9999 IF LESS
.
          MOVE      SP70,DISPDATE
          UNPACK    OSEDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          PACK      KEY28,OSESITE,OSECLIN,OSEDAY,OSESTRT:
                             OSESSHNO,OSESSDAT,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,OPNL8000
.
          MOVE      SP70,DISPDAT1
          UNPACK    OTHESDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          PACK      KEY12,WBSESIT,OTHECTYP     * Get Clinic Type
          CALL      RDCTYA1
          IF        OVRCD=1
            MOVE      "&nbsp;",KEY30
          ELSE
            CLEAR     DISPNAME
            PACK      NAME35,OCTDESC,SP70
            CALL      NAMSTR00
            RESET     DISPNAME
            MOVE      DISPNAME,KEY30
          ENDIF
.
.
          WRITE     HTMLFILE;"<tr>":
                             "<td nowrap>",DISPDATE,"&nbsp;</td>":
                             "<td>",OTHESTRT,"&nbsp;</td>":
                             "<td>",OTHEBFIN,"&nbsp;</td>":
                             "<td>",OTHESEND,"&nbsp;</td>":
                             "<td>",OTHESHNO,"&nbsp;</td>":
                             "<td>",DISPDAT1,"&nbsp;</td>":
                             "<td>",KEY30,"&nbsp;</td>":
                             "</tr>"
          GOTO      OPNL1000
.
OPNL8000  WRITE     HTMLFILE;"<tr>":
                             "<td nowrap>",DISPDATE:
                             "Invalid Schedule</td>":
                             "<td>&nbsp;</td>":
                             "<td>&nbsp;</td>":
                             "<td>&nbsp;</td>":
                             "<td>&nbsp;</td>":
                             "<td>&nbsp;</td>":
                             "</tr>"
          GOTO      OPNL1000
.
OPNL9999  RETURN
.
.*******************************************************************************
. VOTFIL00 - Check that the correct outpatient site prefix files are open
.            according to the site we want to check. If the site is invalid
.            or blank just open the default site of out.

.*******************************************************************************
VOTFIL00  MATCH     SP70,CHECKSIT             * Does the visit have a site
          GOTO      VOTFIL50 IF NOT EQUAL
.
VOTFIL10  MATCH     "out",CFILEPRE           * Is out currently open
          IF        !@EQUAL
            MOVE      "out",OSTFILE          * open default prefix of out
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open out Outpatient Files
          ENDIF
.
          GOTO      VOTFIL99
.
VOTFIL50  MOVE      CHECKSIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,VOTFIL10           * error invalid site code
.
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          GOTO      VOTFIL99
.
VOTFIL99  RETURN
.*******************************************************************************
. Update session status for the given date range
.*******************************************************************************
USTA0000  MATCH     SP70,SESNDATF           * from date is madatory
          GOTO      USTA9000 IF EQUAL
.
          MATCH     SP70,SESNDATT           * to date is mandatory
          GOTO      USTA9000 IF EQUAL
.
          PACK      KEY36,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SESNDATF,SP70
.
          CALL      RDSESA5
          COMPARE   ZERO,OVRCD
          GOTO      USTA2000 IF EQUAL
.
          CALL      RDSSESA5
USTA1000  CALL      RDKSESA5
          BRANCH    OVRCD,USTA8000
.
          MATCH     WBSESIT,OSESITE         * same site
          GOTO      USTA8000 IF NOT EQUAL
.
          MATCH     OTCLI001,OSECLIN        * same clinic
          GOTO      USTA8000 IF NOT EQUAL
.
          MATCH     OTMAS001,DOSEDAY        * same day
          GOTO      USTA8000 IF NOT EQUAL
.
          MATCH     OTMAS002,OSESTRT        * same start time
          GOTO      USTA8000 IF NOT EQUAL
.
          MATCH     OTHED005,OSESSHNO       * same schedule number
          GOTO      USTA8000 IF NOT EQUAL
.
          MATCH     OTHED006,OSESSDAT       * same schedule date
          GOTO      USTA8000 IF NOT EQUAL
.
          MATCH     OSEDATE,SESNDATT        * session date
          GOTO      USTA8000 IF LESS
.
USTA2000  PACK      SAVKEY36,OSESITE,OSECLIN,OSEDAY,OSESTRT:
                             OSESSHNO,OSESSDAT,OSEDATE,SP70
.
          PACK      KEY25,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
          CALL      RDSESA1
          IF        OVRCD=0
            MOVE      SESNSTAT,OSESCSTT
            CALL      UPSESA1
          ENDIF
.
          MOVE      SAVKEY36,KEY36          * repositioin index 5
          CALL      RDSSESA5
.
          GOTO      USTA1000
.
USTA8000  MOVE      ZERO,EXIT
          GOTO      USTA9999
.
USTA9000  MOVE      "Session From/To dates are mandatory fields",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTMAB99
.
USTA9999  RETURN
.
.-------------------------------------------------------------------
.     writing here for allied health department drop down
.-------------------------------------------------------------------
ARFD0000  PACK      PTCDKEY2,ANSC,ANSG,SP70
          CALL      RDSCODE2                      * positional read
ARFD0100  CALL      RDKCODE2                      * read a record
          BRANCH    OVRCD,ARFD9999 
.
          MATCH     "CG",TCODE
          GOTO      ARFD9999 IF NOT EQUAL
.
          MATCH     "I",TCINDC3
          GOTO      ARFD0100 IF EQUAL
.
          PACK      KEY3,ACODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ARFD0100
.
          MATCH     "1",ALDEACTV
          GOTO      ARFD0100 IF EQUAL       * Skip Inactive
.
          MATCH     OTMAADEP,ALDEDEPT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option selected value=",ALDEDEPT,">":
                               TDESC,"</option>"
          ELSE
            IF        IBCNMHOS=1
              MATCH     SP70,ALDEHOSP
              IF        !@EQUAL
                MATCH     WBSEHOSP,ALDEHOSP
                GOTO      ARFD0100 IF NOT EQUAL
              ENDIF
            ENDIF
            WRITE     HTMLFILE;"<option value=",ALDEDEPT,">":
                               TDESC,"</option>"
          ENDIF
          GOTO      ARFD0100
.
ARFD9999  RETURN
.
.-------------------------------------------------------------------
.     writing here for allied health department drop down
.-------------------------------------------------------------------
ARFT0000  PACK      PTCDKEY2,ANSC,ANSG,SP70
          CALL      RDSCODE2                      * positional read
ARFT0100  CALL      RDKCODE2                      * read a record
          BRANCH    OVRCD,ARFT9999
.
          MATCH     "CG",TCODE
          GOTO      ARFT9999 IF NOT EQUAL
.
          MATCH     "I",TCINDC3
          GOTO      ARFT0100 IF EQUAL
.
          PACK      KEY3,ACODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ARFT0100
.
          MATCH     "1",ALDEACTV
          GOTO      ARFT0100 IF EQUAL       * Skip Inactive
.
          MATCH     OTHEADEP,ALDEDEPT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option selected value=",ALDEDEPT,">":
                               TDESC,"</option>"
          ELSE
            IF        IBCNMHOS=1
              MATCH     SP70,ALDEHOSP
              IF        !@EQUAL
                MATCH     WBSEHOSP,ALDEHOSP
                GOTO      ARFT0100 IF NOT EQUAL
              ENDIF
            ENDIF
            WRITE     HTMLFILE;"<option value=",ALDEDEPT,">":
                               TDESC,"</option>"
          ENDIF
          GOTO      ARFT0100
.
ARFT9999  RETURN
.
.------------------------------------------------------------------------
.         multiple slot update
.-----------------------------------------------------------------------
.
MULU0000   WHILE     MULTLOOP <= MULTCONT
             MOVE      MULTSLOT[MULTLOOP],KEY31
             CALL      RDMASB1
             BRANCH    OVRCD,MULU9000
.
             MOVE      OMBVTYP,OLDVTYP
             MOVE      OTMAB002,NEWVTYP
.
             CALL      VALEXT00             * Validate Extended Slots
             BRANCH    EXIT,MULU9999
.
             MOVE      OTMAB002,OMBVTYP
.
             CALL      UPMASB1              * Writes away the data
.
             CALL      CHKEXT00             * Check for Extended Slots
.
MULU9000    ADD     ONE,MULTLOOP
          DO
.
          MOVE      ZERO,EXIT
.
MULU9999  RETURN
+
.------------------------------------------------------------------------
.         multiple slot delete
.-----------------------------------------------------------------------
.
MULD0000  WHILE      MULTLOOP <= MULTCONT
            UNPACK    MULTSLOT[MULTLOOP],WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                      OTHED005,OTHED006,DIM3

            PACK      KEY31,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                      OTHED005,OTHED006,DIM3,SP70
.
            PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                      OTHED005,OTHED006,SP70
.
            CALL      RDMASB1
            BRANCH    OVRCD,MULD9000
            CALL      DEMASB1      * Deletes the data
.
MULD1000    CALL      RDSMASB1
            CALL      RDKMASB1
            BRANCH    OVRCD,MULD9000
            PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                            OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
            MATCH     KEY28,KEY31
            GOTO      MULD9000 IF NOT EQUAL
            COMPARE   ZERO,OMBEXSL
            GOTO      MULD9000 IF EQUAL
            CALL      DEMASB1      * Deletes the data
            GOTO      MULD1000
.
MULD9000    ADD      ONE,MULTLOOP
          DO
.
MULD9999  MOVE      ONE,MULTLOOP        * reset multiple slot loop counter
          MOVE      ZERO,MULTCONT        * reset multiple slot array count
          RETURN
+

.------------------------------------------------------------------------
.         multiple slot - allow group booking
.-----------------------------------------------------------------------
.
GKIN0000  PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
.
          CALL      RDOTHED1
          BRANCH    OVRCD,GKIN9999
          MATCH     "1",OTHEGBOK
          IF        @EQUAL
            WHILE     MULTLOOP <= MULTCONT
               MOVE      MULTSLOT[MULTLOOP],KEY31
               CALL      RDMASB1
               BRANCH    OVRCD,GKIN1000
.
               MOVE      OTMAB003,OMBTIME   * update time
               CALL      VLSF0000           * validate start/end time for sess
               BRANCH    EXIT,GKIN9200      * invalid time
               CALL      UPMASB1            * Writes away the data
.
               PACK      KEY28,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                               OTMBSHNO,OTMBSDAT,SP70
.
GKIN0500       CALL      RDKMASB1
               BRANCH    OVRCD,GKIN1000
.
               PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                               OTMBSHNO,OTMBSDAT,OMBSLOT,SP70
               MATCH     KEY28,KEY31
               GOTO      GKIN1000 IF NOT EQUAL
.
               COMPARE   ZERO,OMBEXSL
               GOTO      GKIN1000 IF EQUAL
.
               MOVE      OTMAB003,OMBTIME   * update time
               CALL      UPMASB1            * Writes away the data
               GOTO      GKIN0500
.
GKIN1000       ADD     ONE,MULTLOOP
            DO
          ELSE
            GOTO    GKIN9100
          ENDIF
.
GKIN9000  MOVE      ZERO,EXIT
          GOTO      GKIN9999
.
GKIN9100  MOVE      ONE,EXIT
          GOTO      GKIN9999
.
GKIN9200  MOVE      TWO,EXIT
          GOTO      GKIN9999
.
GKIN9999  MOVE      ONE,MULTLOOP        * reset multiple slot loop counter
          MOVE      ZERO,MULTCONT        * reset multiple slot array count
          RETURN
+
.------------------------------------------------------------------------
.         set multiple slot array
.-----------------------------------------------------------------------
.
ARRA0000 MATCH      QRYDATA,SP70
         GOTO       ARRA9999 IF EQUAL
.
         REP        "+ ",QRYDATA
.
         COMPARE    HUND49,MULTCONT         * Can only update 149 slots
         GOTO       ARRA9999 IF EQUAL       * at a time
.      
         ADD        ONE,MULTCONT
         MOVE       QRYDATA,MULTSLOT[MULTCONT]
.
ARRA9999 RETURN
+
.------------------------------------------------------------------------
.        validate start and end time for session
.-----------------------------------------------------------------------
.
VLSF0000  PACK      KEY28,WBSESIT,OTCLI001,OTMAS001,OTMAS002:
                          OTHED005,OTHED006,SP70
.
          CALL      RDOTHED1
          BRANCH    OVRCD,VLSF9999
.
          MOVE      OTHESTRT,DIMA5
          REP       ":0",DIMA5
          MOVE      DIMA5,FORMA5
.
          MOVE      OMBTIME,DIMB5
          REP       ":0",DIMB5
          MOVE      DIMB5,FORMB5
.
          MATCH     FORMA5,FORMB5
          GOTO      VLSF9100 IF LESS
.
          MOVE      OTHEBFIN,DIMA5
          REP       ":0",DIMA5
          MOVE      DIMA5,FORMA5
.
          MATCH     FORMA5,FORMB5
          GOTO      VLSF9100 IF NOT LESS
.
          GOTO      VLSF9000
.
VLSF9000  MOVE      ZERO,EXIT
          GOTO      VLSF9999
.
VLSF9100  MOVE      ONE,EXIT
          GOTO      VLSF9999
.
VLSF9999  RETURN
+
.------------------------------------------------------------------------
. Add multiple slot at the same time for group bookings 
.-----------------------------------------------------------------------
AMUL0000  CALL      CHKA0000  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,AMUL9999
.
          MOVE      STARTSLT,SLOTNUMB       * Generate new slot number
.
AMUL1000  ADD       ONE,SLOTNUMB
          SUB       ONE,NUMSLOTS            * Subtract 1 from number to add
.
          CALL      MABSAV00           * Moves input variables to file variables
          MOVE      SLOTNUMB,OMBSLOT   * Set new slot number
.
          PACK      KEY31,OMBSITE,OMBCLIN,OMBDAY,OMBSTRT:
                          OTMBSHNO,OTMBSDAT,OMBSLOT
          CALL      RDAMASB1
          IF        OVRCD=1
            CALL      WRMASB1          * Writes new slot 
          ELSE
            GOTO      AMUL9000
          ENDIF
.
          COMPARE   ZERO,NUMSLOTS
          GOTO      AMUL1000 IF NOT EQUAL
.
          MOVE      ZERO,EXIT
          GOTO      AMUL9999
.
AMUL9000  MOVE      "Error adding new slots - Slot number already used",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      AMUL9999
.
AMUL9999  RETURN
+
.------------------------------------------------------------------
. * Checks mandatory fields when adding multiple slots
.------------------------------------------------------------------
CHKA0000  COMPARE   ZERO,STARTSLT
          GOTO      CHKA9000 IF EQUAL
.
          COMPARE   ZERO,NUMSLOTS     * Must be adding at least one slot
          GOTO      CHKA9150 IF EQUAL
.
          IF        OTMAB001>=900
            GOTO      CHKA9500         * Slots > than 900 are for over bookings
          ENDIF
.
          PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RDMASA1
          BRANCH    OVRCD,CHKA9400
.
          PACK      KEY28,WBSESIT,OTHED002,OTHED003,OTHED004:
                          OTHED005,OTHED006,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,CHKA9400
.
          MATCH     OTHESTRT,OTMAB003
          GOTO      CHKA9300 IF LESS
.
          MATCH     OTMAB003,OTHESEND
          GOTO      CHKA9300 IF LESS
.
          RESET     OTMAB002
          MATCH     SP70,OTMAB002
          GOTO      CHKA9100 IF EQUAL
.
          MOVE      OTMAB002,CODE
          CALL      GETSCT00           * Get slot count
          IF        CNTSLOTS>1
            GOTO      CHKA9700
          ENDIF
.
          RESET     OTMAB003
          MATCH     SP70,OTMAB003
          GOTO      CHKA9200 IF EQUAL
.
          MATCH     Z70,OTHED005
          GOTO      CHKA9600 IF EQUAL
.
          MATCH     Z70,OTHED006
          GOTO      CHKA9600 IF EQUAL
.
          GOTO      CHKA9800
.
CHKA9000  MOVE      "Starting Slot Number is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKA9999
.
CHKA9100  MOVE      "Visit Type is mandatory.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKA9999
.
CHKA9150  MOVE      "Number of Slots to Add is mandatory.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKA9999
.
CHKA9200  MOVE      "Slot Time is mandatory.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKA9999
.
CHKA9300  MOVE      "Slot Time Out of Range.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKA9999
.
CHKA9400  MOVE      "Invalid Clinic Master.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKA9999
.
CHKA9500  MOVE      "Slot numbers => 900 are for over bookings only.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKA9999
.
CHKA9600  MOVE      "Schedule Number/Open date are Mandatory Fields.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKA9999
.
CHKA9700  MOVE      "Invalid visit type for group bookings.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKA9999
.
CHKA9800  MOVE      ZERO,EXIT
CHKA9999  RETURN
.
.------------------------------------------------------------
. Process Clinic Type Procedures
.------------------------------------------------------------
OUTCPC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTCPC60 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OUTCPC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OUTCPC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTCPC30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy formaction
          GOTO      OUTCPC40 IF EQUAL
.
          MATCH     "L",UPDTTYPE    * Delete all formaction
          GOTO      OUTCPC50 IF EQUAL
.
          GOTO      OUTCPC93
.
.         ************ ADD FORMACTION ***********
.
OUTCPC10  MOVE      ZERO,COUNTER
          MOVE      CLINTYPE,OTCPC002
          PACK      KEY21,WBSESIT,OTCPC002,SP70
          CALL      RSOTCPC1
OUTCPC12  CALL      RKOTCPC1                * loop through ctype procedure file
          BRANCH    OVRCD,OUTCPC15
.
          MATCH     OTCPCTYP,OTCPC002       * check if same clinic type
          GOTO      OUTCPC15 IF NOT EQUAL
.
          ADD       ONE,COUNTER
          COMPARE   MAXRECRD,COUNTER
          GOTO      OUTCPC96 IF EQUAL       * check no more than 250 procedures
.
          GOTO      OUTCPC12
.
OUTCPC15  PACK      KEY21,WBSESIT,OTCPC002,OTCPC003,SP70
          CALL      RAOTCPC1
          COMPARE   ZERO,OVRCD
          GOTO      OUTCPC92 IF EQUAL
          CALL      MVOTCP00                     * Move cgi to file variables

          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,OTCPCDAT                * System date
          CLOCK     TIME,OTCPCTIM                * System time
          MOVE      USERID,OTCPCUID              * web user id
          MOVE      SP70,OTCPUDAT
          MOVE      SP70,OTCPUTIM
          MOVE      SP70,OTCPUUID
          PACK      KEY21,WBSESIT,OTCPC002,OTCPC003,SP70
          CALL      WROTCPC1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      OUTCPC99
.
.         ************ UPDATE FORMACTION **********
.
OUTCPC20  MOVE      CLINTYPE,OTCPC002
          PACK      KEY21,WBSESIT,OTCPC002,OTCPC003,SP70
          CALL      RDOTCPC1
          BRANCH    OVRCD,OUTCPC91
          CALL      MVOTCP00                     * Moves cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,OTCPUDAT                * System Date
          CLOCK     TIME,OTCPUTIM                * System time
          MOVE      USERID,OTCPUUID              * web user id
          PACK      KEY21,WBSESIT,OTCPC002,OTCPC003,SP70
          CALL      UPOTCPC1                     * Updates the data
.
          MOVE      ZERO,EXIT
          GOTO      OUTCPC99
.
.         ************ DELETE FORMACTION **********
.
OUTCPC30  MOVE      CLINTYPE,OTCPC002
          PACK      KEY21,WBSESIT,OTCPC002,OTCPC003,SP70
          CALL      RDOTCPC1
          BRANCH    OVRCD,OUTCPC91
          CALL      DEOTCPC1                     * Deletes the data
.
          MOVE      "outcpcaf",MAPTBNAM
          PACK      MAPTBIND,WBSESIT,OTCPC002,OTCPC003,SP70
          CALL      DELCSM00                * Delete Coding System Mappings
.
          MOVE      ZERO,EXIT
          GOTO      OUTCPC99
.
.         ************ COPY FORMACTION **********
.
OUTCPC40  MOVE      CLINTYPE,OTCPC002
          PACK      KEY21,WBSESIT,NEWCTYPE,SP70
          CALL      RSOTCPC1
          CALL      RKOTCPC1                * loop through ctype procedures file
          BRANCH    OVRCD,OUTCPC42
.
          MATCH     OTCPSITE,WBSESIT        * check if same site          
          GOTO      OUTCPC42 IF NOT EQUAL
.
          MATCH     OTCPCTYP,NEWCTYPE       * check if same clinic type
          GOTO      OUTCPC42 IF NOT EQUAL
.
          MATCH     SP70,OTCPPROC           * error if procedure exist for ctype
          GOTO      OUTCPC95 IF NOT EQUAL
.
.         Copy procedures to new clinic type
.
OUTCPC42  PACK      KEY21,WBSESIT,OTCPC002,SP70
          CALL      RSOTCPC1
OUTCPC43  CALL      RKOTCPC1                * loop through ctype procedures file
          BRANCH    OVRCD,OUTCPC45
.
          MATCH     OTCPCTYP,OTCPC002       * check if still same clinic type
          GOTO      OUTCPC45 IF NOT EQUAL
.
          MOVE      NEWCTYPE,OTCPCTYP       * write to new clinic type
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,OTCPCDAT                * System date
          CLOCK     TIME,OTCPCTIM                * System time
          MOVE      USERID,OTCPCUID              * web user id
          MOVE      SP70,OTCPUDAT
          MOVE      SP70,OTCPUTIM
          MOVE      SP70,OTCPUUID
          PACK      KEY21,WBSESIT,OTCPCTYP,OTCPPROC
          CALL      WROTCPC1                * copy procedure to new clinic type
          GOTO      OUTCPC43
.
OUTCPC45  MOVE      ZERO,EXIT
          GOTO      OUTCPC99
.
.         ************ DELETE ALL FORMACTION **********
.
OUTCPC50  MOVE      CLINTYPE,OTCPC002
          PACK      KEY21,WBSESIT,OTCPC002,SP70
          CALL      RSOTCPC1
OUTCPC55  CALL      RKOTCPC1                * loop through ctype procedure file
          BRANCH    OVRCD,OUTCPC58
.
          MATCH     OTCPCTYP,OTCPC002       * check if still same clinic type
          GOTO      OUTCPC58 IF NOT EQUAL
.
          PACK      KEY21,OTCPSITE,OTCPCTYP,OTCPPROC,SP70
          CALL      DEOTCPC1                * deletes the record
          GOTO      OUTCPC55
.
OUTCPC58  MOVE      ZERO,EXIT
          GOTO      OUTCPC99
.
.         ************ DISPLAY FORMACTION **********
.
OUTCPC60  MOVE      CLINTYPE,OTCPC002
          PACK      KEY21,WBSESIT,OTCPC002,OTCPC003,SP70
          CALL      RDOTCPC1
          IF        OVRCD=1
            CALL      CLOUTCPC                   * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Type Procedure Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTCPC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTCPC99
.
OUTCPC91  MOVE      "Clinic Type Procedure Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPC99
.
OUTCPC92  MOVE      "Clinic Type Procedure Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPC99
.
OUTCPC93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPC99
.
OUTCPC94  MOVE      "Invalid Clinic Type Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPC99
.
OUTCPC95  MOVE      "Procedures exist for this Clinic Type. Cannot proceed with this function.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPC99
.
OUTCPC96  CLEAR     WEBTITLE
          APPEND    "Only ",WEBTITLE
          APPEND    MAXRECRD,WEBTITLE
          APPEND    " procedures allowed for each Clinic Type",WEBTITLE
          RESET     WEBTITLE
.         MOVE      "Only 100 procedures allowed for each Clinic Type",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPC99
.
OUTCPC99  RETURN
.
.------------------------------------------------------------
. Process Clinic Type Problems
.------------------------------------------------------------
OUTCPB00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTCPB60 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OUTCPB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OUTCPB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OUTCPB30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy formaction
          GOTO      OUTCPB40 IF EQUAL
.
          MATCH     "L",UPDTTYPE    * Delete all formaction
          GOTO      OUTCPB50 IF EQUAL
.
          GOTO      OUTCPB93
.
.         ************ ADD FORMACTION ***********
.
OUTCPB10  MOVE      ZERO,COUNTER
          MOVE      CLINTYPE,OTCPB002
          PACK      KEY21,WBSESIT,OTCPB002,SP70
          CALL      RSOTCPB1
OUTCPB12  CALL      RKOTCPB1                * loop through ctype problem file
          BRANCH    OVRCD,OUTCPB15
.
          MATCH     OTPBCTYP,OTCPB002       * check if same clinic type
          GOTO      OUTCPB15 IF NOT EQUAL
.
          ADD       ONE,COUNTER
          COMPARE   MAXRECRD,COUNTER
          GOTO      OUTCPB96 IF EQUAL       * check no more than 250 problems
.
          GOTO      OUTCPB12
.
OUTCPB15  PACK      KEY21,WBSESIT,OTCPB002,OTCPB003,SP70
          CALL      RAOTCPB1
          COMPARE   ZERO,OVRCD
          GOTO      OUTCPB92 IF EQUAL
          CALL      MVOTCB00                     * Move cgi to file variables

          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,OTPBCDAT                * System date
          CLOCK     TIME,OTPBCTIM                * System time
          MOVE      USERID,OTPBCUID              * web user id
          MOVE      SP70,OTPBUDAT
          MOVE      SP70,OTPBUTIM
          MOVE      SP70,OTPBUUID
          PACK      KEY21,WBSESIT,OTCPB002,OTCPB003,SP70
          CALL      WROTCPB1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      OUTCPB99
.
.         ************ UPDATE FORMACTION **********
.
OUTCPB20  MOVE      CLINTYPE,OTCPB002
          PACK      KEY21,WBSESIT,OTCPB002,OTCPB003,SP70
          CALL      RDOTCPB1
          BRANCH    OVRCD,OUTCPB91
          CALL      MVOTCB00                     * Moves cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,OTPBUDAT                * System Date
          CLOCK     TIME,OTPBUTIM                * System time
          MOVE      USERID,OTPBUUID              * web user id
          PACK      KEY21,WBSESIT,OTCPB002,OTCPB003,SP70
          CALL      UPOTCPB1                     * Updates the data
.
          MOVE      ZERO,EXIT
          GOTO      OUTCPB99
.
.         ************ DELETE FORMACTION **********
.
OUTCPB30  MOVE      CLINTYPE,OTCPB002
          PACK      KEY21,WBSESIT,OTCPB002,OTCPB003,SP70
          CALL      RDOTCPB1
          BRANCH    OVRCD,OUTCPB91
          CALL      DEOTCPB1                     * Deletes the data
.
          MOVE      "outcpbaf",MAPTBNAM
          PACK      MAPTBIND,WBSESIT,OTCPB002,OTCPB003,SP70
          CALL      DELCSM00                * Delete Coding System Mappings
.
          MOVE      ZERO,EXIT
          GOTO      OUTCPB99
.
.         ************ COPY FORMACTION **********
.
OUTCPB40  MOVE      CLINTYPE,OTCPB002
          PACK      KEY21,WBSESIT,NEWCTYPE,SP70
          CALL      RSOTCPB1
          CALL      RKOTCPB1                * loop through ctype problem file
          BRANCH    OVRCD,OUTCPB42
.
          MATCH     OTPBSITE,WBSESIT        * check if same site
          GOTO      OUTCPB42 IF NOT EQUAL
.
          MATCH     OTPBCTYP,NEWCTYPE       * check if same clinic type
          GOTO      OUTCPB42 IF NOT EQUAL
.
          MATCH     SP70,OTPBPROB           * error if problem exist for ctype
          GOTO      OUTCPB95 IF NOT EQUAL
.
.         Copy problem to new clinic type
.
OUTCPB42  PACK      KEY21,WBSESIT,OTCPB002,SP70
          CALL      RSOTCPB1
OUTCPB43  CALL      RKOTCPB1                * loop through ctype problem file
          BRANCH    OVRCD,OUTCPB45
.
          MATCH     OTPBCTYP,OTCPB002       * check if still same clinic type
          GOTO      OUTCPB45 IF NOT EQUAL
.
          MOVE      NEWCTYPE,OTPBCTYP       * write to new clinic type
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,OTPBCDAT                * System date
          CLOCK     TIME,OTPBCTIM                * System time
          MOVE      USERID,OTPBCUID              * web user id
          MOVE      SP70,OTPBUDAT
          MOVE      SP70,OTPBUTIM
          MOVE      SP70,OTPBUUID
          PACK      KEY21,WBSESIT,OTPBCTYP,OTPBPROB
          CALL      WROTCPB1                * copy problem to new clinic type
          GOTO      OUTCPB43
.
OUTCPB45  MOVE      ZERO,EXIT
          GOTO      OUTCPB99
.
.         ************ DELETE ALL FORMACTION **********
.
OUTCPB50  MOVE      CLINTYPE,OTCPB002
          PACK      KEY21,WBSESIT,OTCPB002,SP70
          CALL      RSOTCPB1
OUTCPB55  CALL      RKOTCPB1                * loop through ctype problem file
          BRANCH    OVRCD,OUTCPB58
.
          MATCH     OTPBCTYP,OTCPB002       * check if still same clinic type
          GOTO      OUTCPB58 IF NOT EQUAL
.
          PACK      KEY21,OTPBSITE,OTPBCTYP,OTPBPROB,SP70
          CALL      DEOTCPB1                * deletes the record
          GOTO      OUTCPB55
.
OUTCPB58  MOVE      ZERO,EXIT
          GOTO      OUTCPB99
.
.         ************ DISPLAY FORMACTION **********
.
OUTCPB60  MOVE      CLINTYPE,OTCPB002
          PACK      KEY21,WBSESIT,OTCPB002,OTCPB003,SP70
          CALL      RDOTCPB1
          IF        OVRCD=1
            CALL      CLOUTCPB                   * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Type Problem Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTCPB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTCPB99
.
OUTCPB91  MOVE      "Clinic Type Problem Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPB99
.
OUTCPB92  MOVE      "Clinic Type Problem Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPB99
.
OUTCPB93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPB99
.
OUTCPB94  MOVE      "Invalid Clinic Type Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPB99
.
OUTCPB95  MOVE      "Problems exist for this Clinic Type. Cannot proceed with this function.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPB99
.
OUTCPB96  CLEAR     WEBTITLE
          APPEND    "Only ",WEBTITLE
          APPEND    MAXRECRD,WEBTITLE
          APPEND    " problems allowed for each Clinic Type",WEBTITLE
          RESET     WEBTITLE
.         MOVE      "Only 100 problems allowed for each Clinic Type",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCPB99
.
OUTCPB99  RETURN
+
.------------------------------------------------------------
. Outpatient Clinic Type Lined Visit Type Maintenance
.------------------------------------------------------------
OUTCVT00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OUTCVT60 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add formaction
          GOTO      OUTCVT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update formaction
          GOTO      OUTCVT20 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete formaction
          GOTO      OUTCVT30 IF EQUAL
.
          MATCH     "M",UPDTTYPE       * Multi Link/Unlink formaction
          GOTO      OUTCVT40 IF EQUAL
.
          GOTO      OUTCVT93
.
.         ************ ADD FORMACTION ***********
.
OUTCVT10  PACK      KEY15,WBSESIT,OTCVT001,OTCVT002,SP70
          CALL      RDOTCVT1
          COMPARE   ZERO,OVRCD
          GOTO      OUTCVT92 IF EQUAL
.
          CALL      CVTSAV00      * Moves input variables to file variables
.
          CALL      WROTCVT1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OUTCVT99
.
.         ************ UPDATE FORMACTION **********
.
OUTCVT20  PACK      KEY15,WBSESIT,OTCVT001,OTCVT002,SP70
          CALL      RDOTCVT1
          BRANCH    OVRCD,OUTCVT91
.
          CALL      CVTSAV00      * Moves input variables to file variables
.
          CALL      UPOTCVT1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      OUTCVT99
.
.         ************ DELETE FORMACTION **********
.
OUTCVT30  PACK      KEY15,WBSESIT,OTCVT001,OTCVT002,SP70
          CALL      RDOTCVT1
          BRANCH    OVRCD,OUTCVT91
.
          CALL      DEOTCVT1      * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      OUTCVT99
.
.         ************ MULTI LINK/UNLINK FORMACTION **********
.
OUTCVT40  PACK      KEY15,WBSESIT,OTCVT001,SP70
          CALL      RSOTCVT1
          CALL      RKOTCVT1                     * Delete all current linked
          BRANCH    OVRCD,OUTCVT44               * visit types
.
          MATCH     WBSESIT,OCVTSITE
          GOTO      OUTCVT44 IF NOT EQUAL
.
          MATCH     OTCVT001,OCVTCTYP
          GOTO      OUTCVT44 IF NOT EQUAL
.
          PACK      KEY15,OCVTSITE,OCVTCTYP,OCVTCVTY,SP70
          CALL      DEOTCVT1
          GOTO      OUTCVT40
.
OUTCVT44  MOVE      ZERO,F3                 * Loop the array of selected visit
OUTCVT45  ADD       ONE,F3                  * types 
          IF        F3>LVISTCNT
            GOTO      OUTCVT49
          ENDIF
.
          MATCH     SP70,LVISTARR[F3]       * Skip blanks
          GOTO      OUTCVT45 IF EQUAL
.
          PACK      OCVTSITE,WBSESIT,SP70
          PACK      OCVTCTYP,OTCVT001,SP70
          PACK      OCVTCVTY,LVISTARR[F3],SP70
          PACK      OCVTSPAR,SP70
.
          PACK      KEY15,OCVTSITE,OCVTCTYP,OCVTCVTY,SP70
          CALL      RAOTCVT1
          IF        OVRCD=1
            CALL      WROTCVT1              * Link visit type to clinic type
          ENDIF
          GOTO      OUTCVT45
.
OUTCVT49  MOVE      ZERO,EXIT
          GOTO      OUTCVT99
.
.         ************ DISPLAY FORMACTION **********
.
OUTCVT60  PACK      KEY12,WBSESIT,OTCVT001,SP70
          CALL      RDCTYA1
          BRANCH    OVRCD,OUTCVT94
.
          PACK      KEY15,WBSESIT,OTCVT001,OTCVT002,SP70
          CALL      RDOTCVT1
          IF        OVRCD=1
            CALL      CLRCVT00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinic Type Linked Visit Type Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTCVT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OUTCVT99
.
OUTCVT91  MOVE      "Linked Visit Type does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCVT99
.
OUTCVT92  MOVE      "Linked Visit Type exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCVT99
.
OUTCVT93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCVT99
.
OUTCVT94  MOVE      "Invalid Clinic Type.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTCVT99
.
OUTCVT99  RETURN
.
.-----------------------------------------------------------
. Clear OUTCVTFD file vars
.-----------------------------------------------------------
CLRCVT00  MOVE      SP70,OCVTSITE
          MOVE      SP70,OCVTCTYP
          MOVE      SP70,OCVTCVTY
          MOVE      SP70,OCVTSPAR
.
CLRCVT99  RETURN
.
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
CVTSAV00  PACK      OCVTSITE,WBSESIT,SP70
          PACK      OCVTCTYP,OTCVT001,SP70
          PACK      OCVTCVTY,OTCVT002,SP70
          MOVE      SP70,OCTSPARE
.
CVTSAV99  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Option 13 - Clinic Type Linked Visit Types
.-------------------------------------------------------------------------------
SPCVT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPCVT001,SPCVT002
.
          MOVE      ONE,EXIT
          GOTO      SPCVT999
.
SPCVT001  PACK      OTCVT001,QRYDATA,SP70
          GOTO      SPCVT999
.
SPCVT002  PACK      OTCVT002,QRYDATA,SP70
          GOTO      SPCVT999
.
SPCVT999  RETURN
.
.------------------------------------------------------------
. Outpatient Clinic Type : Option 1
.------------------------------------------------------------
OTCV0000  BRANCH    FLDITMNO,OTCV0100,OTCV0200,OTCV0300,OTCV0400
          GOTO      OTCV9999
.
OTCV0100  WRITE     HTMLFILE;OCVTSITE;
          GOTO      OTCV9999
.
OTCV0200  WRITE     HTMLFILE;OCVTCTYP;
          GOTO      OTCV9999
.
OTCV0300  WRITE     HTMLFILE;OCVTCVTY;
          GOTO      OTCV9999
.
OTCV0400  CALL      TABV0000           * LINked visit type table
          GOTO      OTCV9999
.
OTCV9999  RETURN
.
.------------------------------------------------------------------------------
. Table of O/P Site Codes for user WBSEC001. %WEBSEC01.03.075
.------------------------------------------------------------------------------
TABV0000  MOVE      ZERO,F3
.
          PACK      KEY5,CATCV,SP70
          CALL      RDSCODE1
TABV1000  CALL      RDKCODE1                   * Cat CV codes
          BRANCH    OVRCD,TABV9999
.
          MATCH     CATCV,TCODE
          GOTO      TABV9999 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV               * Display active only
          IF        @EQUAL
            PACK      KEY15,OCTSITE,OCTCTYP,ACODE,SP70
            CALL      DEOTCVT1                 * Delete the link if the visit
            GOTO      TABV1000                 * type is inactive
          ENDIF
.
          IF        IBCNMHOS=1
            MATCH    ACODE,OCTDEFCV            * Default visit type ?
            IF       !@EQUAL
              MATCH    "1",PTCDHOSS            * Hospital specific cat code
              IF       @EQUAL
                PACK     KEY8,WBSEHOSP,TCODE,ACODE,SP70
                CALL     RDMLCOD1
                IF       OVRCD=1
                  PACK     KEY15,OCTSITE,OCTCTYP,ACODE,SP70
                  CALL     DEOTCVT1            * Delete the link if not for   
                  GOTO     TABV1000            * this hospital
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          ADD       ONE,F3
          IF        F3=501
            WRITE     HTMLFILE;"<tr><td colspan=2 class=RedBackground ":
                               "align=center>500 Visit Type":
                               " Maximum Limit Reached</td></tr>"
            GOTO      TABV9999
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                             "<td align=left width=15%>&nbsp;":
                             "<input type=checkbox name=lvistarr";
.
          PACK      KEY15,OCTSITE,OCTCTYP,ACODE,SP70
          CALL      RDOTCVT1
          IF        OVRCD=0
            WRITE     HTMLFILE;" checked ";
          ENDIF
.
          WRITE     HTMLFILE;" value='",ACODE,"'>",ACODE:
                             "</td><td>",TDESC,"</td>":
                             "</tr>"
.
          GOTO      TABV1000
.
TABV9999  RETURN
.
.------------------------------------------------------------------------------
. Check if the default visit type is valid for this clinic type
.------------------------------------------------------------------------------
CDVT0000  PACK      KEY15,OCTSITE,OCTCTYP,OTCTY011,SP70
          CALL      RDOTCVT1                * Is the visit type linked
          IF        OVRCD<>1
            GOTO      CDVT8000
          ENDIF
.
          PACK      KEY15,OCTSITE,OCTCTYP,SP70
          CALL      RSOTCVT1                * The visit type is not linked so
          CALL      RKOTCVT1                * it's only valid if no links exist
          BRANCH    OVRCD,CDVT8000
.
          MATCH     OCTSITE,OCVTSITE        * Site Code
          GOTO      CDVT8000 IF NOT EQUAL
.
          MATCH     OCTCTYP,OCVTCTYP        * Clinic Type
          GOTO      CDVT8000 IF NOT EQUAL
.
          GOTO      CDVT9000
.
CDVT8000  MOVE      ZERO,EXIT               * Valid default visit type
          GOTO      CDVT9999
.
CDVT9000  MOVE      ONE,EXIT                * Invalid default visit type
          GOTO      CDVT9999
.
CDVT9999  RETURN
+
.---------------------------------------------------------------------
. Update the clinic master and slot template header last session
. open date
.---------------------------------------------------------------------
ULODAT00  MOVE      SP70,LASTOPEN           * Clear last open date
.
          PACK      KEY26,WBSESIT,OTCLI001,OTMAS001,OTMAS002,Z70
          CALL      RDSSESA3
          CALL      RDPSESA3                * Find last open session for
          BRANCH    OVRCD,ULODAT40          * the clinic
.
          MATCH     WBSESIT,OSESITE         * Site
          GOTO      ULODAT40 IF NOT EQUAL
.
          MATCH     OTCLI001,OSECLIN        * Clinic
          GOTO      ULODAT40 IF NOT EQUAL
.
          MATCH     OTMAS001,DOSEDAY        * Day
          GOTO      ULODAT40 IF NOT EQUAL
.
          MATCH     OTMAS002,OSESTRT        * Start time
          GOTO      ULODAT40 IF NOT EQUAL
.
          MOVE      OSEDATE,LASTOPEN        * Set last session open date
.
ULODAT40  PACK      KEY18,WBSESIT,OTCLI001,OTMAS001,OTMAS002,SP70
          CALL      RDMASA1                 * Read clinic master
          BRANCH    OVRCD,ULODAT99
.
          MOVE      LASTOPEN,OMADATE        * Update last session open date
.
          CALL      UPMASA1                 * Update clinic master
.
          MOVE      SP70,LASTOPEN           * Clear last open date
.
          PACK      KEY36,WBSESIT,OTHED002,OTHED003,OTHED004:
                          OTHED005,OTHED006,Z70
          CALL      RDSSESA5
          CALL      RDPSESA5                * Find last open session for the
          BRANCH    OVRCD,ULODAT60          * slot template
.
          MATCH     WBSESIT,OTHESITE        * Site
          GOTO      ULODAT60 IF NOT EQUAL
.
          MATCH     OTHED002,OTHECLIN       * Clinic
          GOTO      ULODAT60 IF NOT EQUAL
.
          MATCH     OTHED003,OTHEWDAY       * Day
          GOTO      ULODAT60 IF NOT EQUAL
.
          MATCH     OTHED004,OTHESTRT       * Start Time
          GOTO      ULODAT60 IF NOT EQUAL
.
          MATCH     OTHED005,OTHESHNO       * Schedule
          GOTO      ULODAT60 IF NOT EQUAL
.
          MATCH     OTHED006,OTHESDAT       * Schedule Date
          GOTO      ULODAT60 IF NOT EQUAL
.
          MOVE      OSEDATE,LASTOPEN        * Set last session open date
.
ULODAT60  PACK      KEY28,WBSESIT,OTHED002,OTHED003,OTHED004:
                          OTHED005,OTHED006,SP70
          CALL      RDOTHED1                * Read slot template header
          BRANCH    OVRCD,ULODAT99
.
          MOVE      LASTOPEN,OTHEDATE       * Update last session open date
.
          CALL      UPOTHED1                * Update slot template header
.
ULODAT99  RETURN
+
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
+
.-------------------------------------------------------------------------
          INC       ALLDEPIO/INC  * Allied Health Department
          INC       IBAPOLIO/INC
          INC       OUTBOAIO/INC  * Outpatients - Clinic Session Booking File A
          INC       OUTCLIIO/INC  * Outpatients - Clinic Table   
          INC       OUTCPBIO/INC  * Outpatients - Clinic Type Problems
          INC       OUTCPCIO/INC  * Outpatients - Clinic Type Procedures
          INC       OUTCTYIO/INC  * Outpatients - Clinic Type Table 
          INC       OUTCLVIO/INC  * Outpatients - Clinic Leave Table
          INC       OUTMA1IO/INC  * Outpatients - Clinic Master Table
          INC       OUTMABIO/INC  * Outpatients - Clinic Master Slots Table
          INC       OUTPHOIO/INC  * Outpatients - Public Holiday File
          INC       OUTSESIO/INC  * Outpatients - Clinic Sessions Table
          INC       OUTOSFIO/INC  * Outpatients - Open Sessions File
          INC       OUTSITIO/INC  * Outpatients - Site Code File
          INC       OUTWMPIO/INC  * Outpatients - Template Mapping
          INC       OUTCCTIO/INC  * Outpatients - Contract Codes
          INC       PATDO1IO/INC  * Doctor File
          INC       SCRMASIO/INC  * Screen Sys - Screen Master 
          INC       OUTLETIO/INC  * Outpatient Letter File 
          INC       PATHSPIO/INC  * Hospital File
          INC       PRITHDIO/INC  * MBS Item template File
          INC       PRIPRAIO/INC  * Medical Practice File
          INC       PATWR1IO/INC  * Patient Ward File
          INC       OUTMSPIO/INC  * Client Master Suspension Table (HPS01)
          INC       MLTSECIO/INC
          INC       MRTLOCIO/INC  * Medical Records Location (HPS01I)
          INC       PMSHCPIO/INC  * HCP Doctors file
          INC       OUTTXSIO/INC  * Outpatient Extra Templates File
          INC       OUTHEDIO/INC  * Outpatient slot template Header file
          INC       OUTCDCIO/INC  * Outpatients - Clinic Type Diagnosis Table  
          INC       OUTCVTIO/INC  * Outpatients - Clinic Type Visit Types
          INC       PATICDIO/INC  * ICD Disease codes file
          INC       PATICOIO/INC  * ICD Disease codes file
          INC       FMSLMAIO/INC  * G/L
          INC       FMSAMAIO/INC
          INC       OUTBOXIO/INC
          INC       PMSVMTIO/INC
          INC       PMSVSTIO/INC
.
          INC       COUNTSLT
          INC       PATDOCCD
          INC       PATDOCTM
          INC       NAMSTRCD
          INC       DAYOFWEK   
          INC       IBAWEBCD
          INC       WEBDATCD
          INC       OUTTXSTM
          INC       OUTHEDTM
          INC       OPENSESS
          INC       CLOUTHED
          INC       CLOUTCDC
          INC       CLOUTCPB
          INC       CLOUTCPC
          INC       OUTCPBTM
          INC       OUTCPCTM
          INC       OUTCDCTM
          INC       DGCLIOCM                * HL7 O/P Clinic Master
          INC       DGCLIOCT                * HL7 O/P Clinic Type
          INC       PMSVMTTM
          INC       PMSVSTTM


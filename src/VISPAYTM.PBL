. *----------------------------------------------------------------------
. * Include Name  :   VISPAYTM.PBL
. *
. * Function      :   CGI variables for VISPAYFD - vispayaf.dat
. *----------------------------------------------------------------------
.  Modifications Done :
.
.  V9.08.01   08/02/07 J.Tan    CAR 120001
.             Mods for NZ Billing
.  V9.07.00   07/07/2006  Ebon Clements CAR 103365
.             Created include
. *----------------------------------------------------------------------
.
.------------------------------------------------------------------------
.   Clear Parameters for visit based payor details file
.------------------------------------------------------------------------
.
CPVSPA00  MOVE      Z70,VSPAY001
          MOVE      Z70,VSPAY002
          MOVE      Z70,VSPAY003
          MOVE      Z70,VSPAY004
          MOVE      Z70,VSPAY005
          MOVE      Z70,VSPAY006
.
CPVSPA99  RETURN
.
.------------------------------------------------------------
. Add visit based payor details file
.------------------------------------------------------------
VSPA0000  BRANCH    FLDITMNO,VSPA0010,VSPA0020,VSPA0030,VSPA0040,VSPA0050:
                             VSPA0060,VSPA0070,VSPA0080,VSPA0090,VSPA0100:
                             VSPA0110,VSPA0120
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      VSPA9999
.
VSPA0010  WRITE     HTMLFILE;VSPAVISN;
          GOTO      VSPA9999
.
VSPA0020  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VSPA0025
.
          WRITE     HTMLFILE;VSPAPAYC;
          GOTO      VSPA9999
.
VSPA0025  PACK      KEY14,VSPAPAYC,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
          ELSE
            WRITE     HTMLFILE;VSPAPAYC;
          ENDIF
          GOTO      VSPA9999
.
VSPA0030  WRITE     HTMLFILE;VSPASEQN;
          GOTO      VSPA9999
.
VSPA0040  WRITE     HTMLFILE;VSPACOMM;
          GOTO      VSPA9999
.
VSPA0050  WRITE     HTMLFILE;VSPAACTV;
          GOTO      VSPA9999
.
VSPA0060  MATCH     VSPACDAT,SP70
          GOTO      VSPA9999 IF EQUAL
.
          UNPACK    VSPACDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VSPA9999
.
VSPA0070  WRITE     HTMLFILE;VSPACTIM;
          GOTO      VSPA9999
.
VSPA0080  MATCH     SP70,VSPACUID
          GOTO      VSPA9999 IF EQUAL
.
          PACK      KEY10,VSPACUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      VSPACUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      VSPA9999
.
VSPA0090  MATCH     VSPAUDAT,SP70
          GOTO      VSPA9999 IF EQUAL
.
          UNPACK    VSPAUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VSPA9999
.
VSPA0100  WRITE     HTMLFILE;VSPAUTIM;
          GOTO      VSPA9999
.         
VSPA0110  MATCH     SP70,VSPAUUID
          GOTO      VSPA9999 IF EQUAL
.
          PACK      KEY10,VSPAUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      VSPAUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      VSPA9999
.
VSPA0120  CALL      EPAY0000           * Expected payer
          GOTO      VSPA9999
.
VSPA9999  RETURN
.
.------------------------------------------------------------
. Expected Payeer Selection
.------------------------------------------------------------
EPAY0000  OPEN      VISPAYA2,"vispayaf"
          PACK      KEY10,ADMISSNO,SP70
          CALL      RSVSPAY2
EPAY1000  CALL      RKVSPAY2
          BRANCH    OVRCD,EPAY8000
          MATCH     ADMISSNO,VSPAVISN        * Same visit no?
          GOTO      EPAY8000 IF NOT EQUAL
.
          PACK      KEY14,VSPAPAYC,ZERO8,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,EPAY1000
.
          MATCH     EXPPAYER,VSPAPAYC
          GOTO      EPAY2000 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=",VSPAPAYC," selected>":
                               HFNAME,"</option>"
          GOTO      EPAY1000
.
EPAY2000  WRITE     HTMLFILE;"<option value=",VSPAPAYC,">",HFNAME,"</option>"
          GOTO      EPAY1000
.
EPAY8000  MATCH     "PRFA",EXPPAYER
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=PRFA selected>":
                               "Person Responsible for Account</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=PRFA >":
                               "Person Responsible for Account</option>"
          ENDIF
EPAY9999  RETURN
+
.------------------------------------------------------------
. Expected Payeer Selection for NZ Private
.------------------------------------------------------------
SPAY0000  MATCH     "PRFA",EXPPAYER
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=PRFA selected>":
                               "Person Responsible for Account</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=PRFA >":
                               "Person Responsible for Account</option>"
          ENDIF
.
          OPEN      VISPAYA2,"vispayaf"
          PACK      KEY10,ADMISSNO,SP70
          CALL      RSVSPAY2
SPAY1000  CALL      RKVSPAY2
          BRANCH    OVRCD,SPAY8000
          MATCH     ADMISSNO,VSPAVISN        * Same visit no?
          GOTO      SPAY8000 IF NOT EQUAL
.
          PACK      KEY14,VSPAPAYC,ZERO8,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,SPAY1000
.
          MATCH     EXPPAYER,VSPAPAYC
          GOTO      SPAY2000 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=",VSPAPAYC," selected>":
                               HFNAME,"</option>"
          GOTO      SPAY1000
.
SPAY2000  WRITE     HTMLFILE;"<option value=",VSPAPAYC,">",HFNAME,"</option>"
          GOTO      SPAY1000
.
SPAY8000  MATCH     "ALL",EXPPAYER
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=ALL selected>":
                               "All</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=ALL >":
                               "All</option>"
          ENDIF
.
SPAY9999  RETURN
+
.------------------------------------------------------------
. Default Expected Payeer Selection
.------------------------------------------------------------
DPAY0000  OPEN      VISPAYA2,"vispayaf"
          MOVE      ZERO,FORM1
          PACK      KEY10,ADMISSNO,SP70
          CALL      RSVSPAY2
DPAY1000  CALL      RKVSPAY2
          BRANCH    OVRCD,DPAY8000
          MATCH     ADMISSNO,VSPAVISN        * Same visit no?
          GOTO      DPAY8000 IF NOT EQUAL
.
          PACK      KEY14,VSPAPAYC,ZERO8,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,DPAY1000
.
          BRANCH    VSPAISEN,DPAY2000        * already sent
          BRANCH    FORM1,DPAY2000
          MOVE      ONE,FORM1
.
          WRITE     HTMLFILE;"<option value=",VSPAPAYC," selected>":
                               HFNAME,"</option>"
          GOTO      DPAY1000
.
DPAY2000  WRITE     HTMLFILE;"<option value=",VSPAPAYC,">",HFNAME,"</option>"
          GOTO      DPAY1000
.
DPAY8000  IF        FORM1=0
            WRITE     HTMLFILE;"<option value=PRFA selected>":
                               "Person Responsible for Account</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=PRFA >":
                               "Person Responsible for Account</option>"
          ENDIF
.
DPAY9999  RETURN
+
.------------------------------------------------------------
. Default PRFA Selection
.------------------------------------------------------------
DPRA0000  WRITE     HTMLFILE;"<option value=ALL selected>":
                             "All</option>":
                             "<option value=PRFA>":
                             "Person Responsible for Account</option>"
.
          OPEN      VISPAYA2,"vispayaf"
          PACK      KEY10,ADMISSNO,SP70
          CALL      RSVSPAY2
DPRA1000  CALL      RKVSPAY2
          BRANCH    OVRCD,DPRA9999
          MATCH     ADMISSNO,VSPAVISN        * Same visit no?
          GOTO      DPRA9999 IF NOT EQUAL
.
          PACK      KEY14,VSPAPAYC,ZERO8,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,DPRA1000
.
          WRITE     HTMLFILE;"<option value=",VSPAPAYC,">",HFNAME,"</option>"
          GOTO      DPRA1000
.
DPRA9999  RETURN
+
.------------------------------------------------------------
.   Set Parameters for visit based payor details file
.------------------------------------------------------------
SPVSP000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPVSP001,SPVSP002,SPVSP003,SPVSP004,SPVSP005:
                       SPVSP006
.
          MOVE      ONE,EXIT
          GOTO      SPVSP999
.
SPVSP001  PACK      VSPAY001,QRYDATA,SP70
          GOTO      SPVSP999
.
SPVSP002  PACK      VSPAY002,QRYDATA,SP70
          GOTO      SPVSP999
.
SPVSP003  PACK      VSPAY003,QRYDATA,SP70
          GOTO      SPVSP999
.
SPVSP004  MOVE      QRYDATA,VSPAY004
          GOTO      SPVSP999
.
SPVSP005  MOVE      QRYDATA,VSPAY005
          GOTO      SPVSP999
.
SPVSP006  MOVE      QRYDATA,VSPAY006
          GOTO      SPVSP999
.
SPVSP999  RETURN
.
.------------------------------------------------------------
.  Update visit based payor details file
.------------------------------------------------------------
MVVSPA00  MATCH     VSPAY001,Z70
          IF        !@EQUAL
            MOVE      VSPAY001,VSPAVISN
          ENDIF
.
          MATCH     VSPAY002,Z70
          IF        !@EQUAL
            MOVE      VSPAY002,VSPAPAYC
          ENDIF
.
          MATCH     VSPAY003,Z70
          IF        !@EQUAL
            MOVE      VSPAY003,VSPASEQN
          ENDIF
.
          MATCH     VSPAY004,Z70
          IF        !@EQUAL
            MOVE      VSPAY004,VSPACOMM
          ENDIF
.
          MATCH     VSPAY005,Z70
          IF        !@EQUAL
            MOVE      VSPAY005,VSPAACTV
          ENDIF
.
          MATCH     VSPAY006,Z70
          IF        !@EQUAL
            MOVE      VSPAY006,VSPAISEN
          ENDIF
.
MVVSPA99  RETURN

. **********************************************************
. *              P R O G R A M  S U M M A R Y              *
. *              -------------  -------------              *
. *                                                        *
. *     PROGRAM NAME  :   IBASYS99                         *
. *                                                        *
. *     FUNCTION      :   Chaining Program For All Systems *
. *                                                        *
. *     DATE WRITTEN  :   06/08/91                         *
. *                                                        *
. *     AUTHOR        :   Steve O'Gorman                   *
. *                                                        *
. *     MODIFICATIONS :                                    *
. *       V10.04.01  15/04/2014 Ebon Clements CAR 299449   *
. *                   Recompiled for IBAPRINT 6 character  *
. *                   printers                             *
. *       V10.02.01 01/04/2011  Jill Parkinson CAR 239574  *
. *                 Removed open of ibaprntf               *
. *                      V6.00.03 14.04.93 B.G.Ackland     *
. *                               Check Forking            *
. *                      V6.00.04 15.04.93 D.Jones         *
. *                               Fix deleting of files    *
. *                      V6.00.05 21.04.93 D.Jones         *
. *                               Fix deleting of files    *
. *                      V6.00.06 19/08/93    Gabrielle  SRF 123850           *
. *                               Allow for numbers to be keyed-in            *
. *       V6.00.07  21/10/1993  Graeme Williams                               *
. *                 Clear the number of copies after printing                 *
. *       V6.00.08  22/12/1993  Graeme Williams SRF 125074                    *
. *                 Recompiled for IBAPRINT                                   *
. *       V6.01.01  10/02/1994  Graeme Williams SRF 127532                    *
. *                 Recompiled for IBAPRINT                                   *
. *       V6.01.02  17/02/1994  Graeme Williams SRF 127813                    *
. *                 Modified to release the port if this is a forked process  *
. *       C1.00.01  22/11/1994  B.G.Ackland                                   *
. *                 Enabled More & First Printer options in IBAPRINT          *
. *       C1.00.02  05/12/1994  B.G.Ackland                                   *
. *                 Reset Help Topic                                          *
. *       C1.00.03  13/02/1995  Greg Horvat      SRF 134920 134922 134932     *
. *                 Recompiled for IBAPRINT                                   *
. *       C1.00.04  21.05.1996  B.G.Ackland                                   *
. *                 Display Spool Features for Last,End,Find                  *
. *                                                                           *
. *****************************************************************************
.
          INC       STD001FD
.
          INC       IBAPRNFD/INC
          INC       CHECKDAT/INC
.
.********************************************************************** 
.*                            Variables                               *
.********************************************************************** 
.
CMDLINE   DIM       50
FLAG      FORM      1
FNAMER    DIM       8
TFILE     FILE      ASCII, FIXED=256
VERT      FORM      2
.
PRGID     INIT      "IBASYS99"
PRGNAM    INIT      "Chaining Program For All Systems"
VERSION   INIT      "V12.00.00"
.
.         Security check on company name
.
ML0000    TOPIC     SP8                    * Reset any Help Topics
          OPEN      IBACODE1,"ibacodef"
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,TWO;*4,PCEMPNA:
                                *42,PCD6
.
          MOVE      "01",ICOMP
          CALL      SECURITY
.
          COMPARE   ZERO,FLAG
          GOTO      ML0005 IF EQUAL
.
          DISPLAY   *P20:24,*EL,*B,*V2LON,*BLINKON:
                    "**** SYSTEM FAILURE ****",*W2;
          SHUTDOWN  " "
.
ML0005    LOAD      CPRTFLG USING CPRTFLG OF ONE,TWO,ZERO
          CALL      SPLEMPTY
          BRANCH    OVRCD,ML1000,ML2000
.
          CALL      SELPRINT                     * Select printer
.
          CALL      CLSPRINT                     * Print & delete spool file
          GOTO      ML2000
.
ML1000    CALL      SPLDELET                     * Delete spool file
.
.         If spooling inside a program was selected, reset at this point
.         (ie. If CPRTFLG is 3, change it to zero)
.
ML2000    LOAD       CPRTFLG USING CPRTFLG OF ONE,TWO,ZERO
          MOVE       "  1",CNOCOPY               * default number of copies
          CLOCK      FORK,KEY2
          MATCH      " 0",KEY2
          IF         @EQUAL
            CHAIN     CCMENU
          ELSE
            CLEAR     FNAMER
            APPEND    "tmport",FNAMER
            APPEND    PORT,FNAMER
            RESET     FNAMER
            REP       " 0",FNAMER
            RESET     FNAMER
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      TFILE,FNAMER
            TRAPCLR   IO
.
            IF        OVRCD = 0
              CLOSE     TFILE
              CLEAR     CMDLINE
              APPEND    "uniq_port ",CMDLINE
              APPEND    FNAMER,CMDLINE
              APPEND    ".txt",CMDLINE
              RESET     CMDLINE
.
              EXECUTE   CMDLINE,TASKID
.
            ENDIF
            STOP
          ENDIF
.
SECURITY  INC       CHECKSEC
.
          INC       IBAPRINT
          INC       IBAPRNIO/INC
          INC       STD001IO

. *----------------------------------------------------------------------
. * Include Name  :   PMSNEPTM.PBL
. *
. * Function      :   CGI variables for PMSNEPFD - pmsnepaf.dat
. *
. * Includes Needed : PMSNEPFD - Multiple NEP Values
. *                   PMSNEPIO - IO for Multiple NEP Values
. * Modifications :
. *      V11.03.01 24/01/2023 PJ Le Febour   TSK 0928588
. *                to accommodate the new size for Type of Visit 
.                  amended KEY10 to be KEY15 
. *      V11.01.01 11/11/2021 J.Tan   TSK 0913621
. *                Removed Events Visit type from selection list
. *
. *----------------------------------------------------------------------
.
.------------------------------------------------------------------------
.   Clear Parameters for Multiple NEP Values
.------------------------------------------------------------------------
.
CLRNEP00  MOVE      SP70,PMNEP001
          MOVE      SP70,PMNEP002
          MOVE      SP70,PMNEP003
          MOVE      SP70,PMNEP004
          MOVE      SP70,PMNEP005
          MOVE      ZERO,PMNEP006
          MOVE      SP70,PMNEP007
          RETURN
.
.------------------------------------------------------------
. Multiple NEP Values Fields
.-----------------------------------------------------------
PNEP0000  BRANCH    FLDITMNO,PNEP0010,PNEP0020,PNEP0030,PNEP0040,PNEP0050:
                             PNEP0060,PNEP0070,PNEP0080,PNEP0090,PNEP0100:
                             PNEP0110,PNEP0120,PNEP0130
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PNEP9999
.
PNEP0010  UNPACK    DIM127,D1,KEY1,DIM127        * Contract ID
          MOVE      KEY1,F1
          BRANCH    F1,PNEP0012
.
          WRITE     HTMLFILE;PMNECNTR;
          GOTO      PNEP9999
.
PNEP0012  PACK      KEY6,PMNECNTR,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,PNEP9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      PNEP9999
.
PNEP0020  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PNEP0022
.
          WRITE     HTMLFILE;PMNEVTYP;
          GOTO      PNEP9999
.
PNEP0022  MOVE      SP70,KEY15
          MOVE      ZERO,F2
          MOVE      PMNEVTYP,F2
          IF        F2<>0
            LOAD      KEY15,F2,VTYPE01,VTYPE02,VTYPE03
            IF        F2=9
              PACK      KEY15,VTYPE04,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;KEY15;
          GOTO      PNEP9999
.
PNEP0030  WRITE     HTMLFILE;PMNECODE;
          GOTO      PNEP9999
.
PNEP0040  WRITE     HTMLFILE;PMNEINDC;
          GOTO      PNEP9999
.
PNEP0050  WRITE     HTMLFILE;PMNEINDV;
          GOTO      PNEP9999
.
PNEP0060  WRITE     HTMLFILE;PMNENEPP;
          GOTO      PNEP9999
.
PNEP0070  MATCH     PMNECDAT,SP70
          GOTO      PNEP9999 IF EQUAL
.
          UNPACK    PMNECDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PNEP9999
.
PNEP0080  MOVE      "@ ",ANS
          PACK      KEY10,ANS,PMNECTIM
          WRITE     HTMLFILE;KEY10;
          GOTO      PNEP9999
.
PNEP0090  MATCH     SP70,PMNECUID
          GOTO      PNEP9999 IF EQUAL
.
          PACK      KEY10,PMNECUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMNECUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PNEP9999
.
PNEP0100  MATCH     PMNEUDAT,SP70
          GOTO      PNEP9999 IF EQUAL
.
          UNPACK    PMNEUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PNEP9999
.
PNEP0110  MATCH     SP70,PMNEUTIM
          IF        !@EQUAL
            MOVE      "@ ",ANS
            PACK      KEY10,ANS,PMNEUTIM
            WRITE     HTMLFILE;KEY10;
          ENDIF
          GOTO      PNEP9999
.
PNEP0120  MATCH     SP70,PMNEUUID
          GOTO      PNEP9999 IF EQUAL
.
          PACK      KEY10,PMNEUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMNEUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PNEP9999
.
PNEP0130  WRITE     HTMLFILE;PMNEACTV;
          GOTO      PNEP9999
.
PNEP9999  RETURN
.
.------------------------------------------------------------
.   Select type of visit
.------------------------------------------------------------
SVIS0000  IF        F2 = 0
            WRITE    HTMLFILE;"<option value=1>",VTYPE01,"</option>":
                              "<option value=2>",VTYPE02,"</option>":
                              "<option value=3>",VTYPE03,"</option>";
.                             "<option value=9>",VTYPE04,"</option>";
          ENDIF
          IF        F2 = 1
            WRITE    HTMLFILE;"<option value=1 selected>",VTYPE01,"</option>":
                              "<option value=2>",VTYPE02,"</option>":
                              "<option value=3>",VTYPE03,"</option>";
.                             "<option value=9>",VTYPE04,"</option>";
          ENDIF
          IF        F2 = 2
            WRITE    HTMLFILE;"<option value=1>",VTYPE01,"</option>":
                              "<option value=2 selected>",VTYPE02,"</option>":
                              "<option value=3>",VTYPE03,"</option>";
.                             "<option value=9>",VTYPE04,"</option>";
          ENDIF
          IF        F2 = 3
            WRITE    HTMLFILE;"<option value=1>",VTYPE01,"</option>":
                              "<option value=2>",VTYPE02,"</option>":
                              "<option value=3 selected>",VTYPE03,"</option>";
.                             "<option value=9>",VTYPE04,"</option>";
          ENDIF
.         IF        F2 = 9
.           WRITE    HTMLFILE;"<option value=1>",VTYPE01,"</option>":
.                             "<option value=2>",VTYPE02,"</option>":
.                             "<option value=3>",VTYPE03,"</option>":
.                             "<option value=9 selected>",VTYPE04,"</option>";
.         ENDIF
SVIS9999  RETURN
+
.------------------------------------------------------------
.   Select Code Set
.------------------------------------------------------------
SCOD0000  IF        F2 = 3
            WRITE    HTMLFILE;"<option value='CC'>Category CC</option>";
          ELSE
            WRITE    HTMLFILE;"<option value='CL'>Category CL</option>";
          ENDIF
SCOD9999  RETURN
+
.------------------------------------------------------------
.   Set Parameters for ABF Admitted Acute PW
.------------------------------------------------------------
SPPNE000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPPNE001,SPPNE002,SPPNE003,SPPNE004,SPPNE005:
                       SPPNE006,SPPNE007
.
          MOVE      ONE,EXIT
          GOTO      SPPNE999
.
SPPNE001  MOVE      QRYDATA,PMNEP001
          PACK      PMNEP001,PMNEP001,SP70
          GOTO      SPPNE999
.
SPPNE002  SQUEEZE   QRYDATA
          MOVE      ZERO,F2
          MOVE      QRYDATA,F2
          MOVE      F2,PMNEP002
          PACK      PMNEP002,PMNEP002,SP70
          GOTO      SPPNE999
.
SPPNE003  MOVE      QRYDATA,PMNEP003
          PACK      PMNEP003,PMNEP003,SP70
          GOTO      SPPNE999
.
SPPNE004  MOVE      QRYDATA,PMNEP004
          PACK      PMNEP004,PMNEP004,SP70
          GOTO      SPPNE999
.
SPPNE005  MOVE      QRYDATA,PMNEP005
          PACK      PMNEP005,PMNEP005,SP70
          GOTO      SPPNE999
.
SPPNE006  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PMNEP006
          GOTO      SPPNE999
.
SPPNE007  MOVE      QRYDATA,PMNEP007
          PACK      PMNEP007,PMNEP007,SP70
          GOTO      SPPNE999
.
SPPNE999  RETURN
+
.------------------------------------------------------------------------
.         Move work variables to Multiple NEP Values file variables
.------------------------------------------------------------------------
MVPMNE00  MATCH     PMNEP001,SP70
          IF        !@EQUAL
            MOVE      PMNEP001,PMNECNTR
          ENDIF
.
          MATCH     PMNEP002,SP70
          IF        !@EQUAL
            MOVE      ZERO,F2
            SQUEEZE   PMNEP002
            MOVE      PMNEP002,F2
            MOVE      F2,PMNEVTYP
          ENDIF
.
          MATCH     PMNEP003,SP70
          IF        !@EQUAL
            MOVE      PMNEP003,PMNECODE
          ENDIF
.
          MATCH     PMNEP004,SP70
          IF        !@EQUAL
            MOVE      PMNEP004,PMNEINDC
          ENDIF
.
          MATCH     PMNEP005,SP70
          IF        !@EQUAL
            MOVE      PMNEP005,PMNEINDV
          ENDIF
.
          COMPARE   PMNEP006,ZERO
          IF        !@EQUAL
            MOVE      PMNEP006,PMNENEPP
          ENDIF
.
          MATCH     SP70,PMNEP007
          IF        !@EQUAL
            MOVE      PMNEP007,PMNEACTV
          ENDIF
.
MVPMNE99  RETURN
+

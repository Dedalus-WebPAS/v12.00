.----------------------------------------------------------------------- 
. Program       : PATWEB99 
.
. Function      : DoctorTemplate Server
.
. Modifications :
.----------------------------------------------------------------------
. V12.00.01 07/07/2025 Alina Bhari            TSK 0961176
.            Added check in deactivating HCP practice to ensure all the linked
.            HCP's are inactive  - CHKHCG10,CHKHCG95
. V11.05.01 20/12/2024 Alina Bhari            TSK 0955335
.            Checked if the linked HCP record exist for the HCP practice code
.            - GPPF1600                                                      
. V11.04.04 19/06/2024 Thanh T                TSK 0947086
.            Recompiled for PMSHCGTM/PMSHCPTM changes
. V11.04.03 07/06/2024 Thanh T                TSK 0944174
.           Added GPPF1500. Changed NEXTPR00, PREVPR00, LNKSER00 and
.           GCLRW000 to add menuflag parameter when menuflag = 1  
. V11.04.02 28/03/2024 Thanh T                TSK 0935314
.           Recompiled for PMSQDRFD changes
. V11.04.01 19/02/2024  Ebon Clements TSK 0943018
.           Fixed no more record display - GPLTB000
. V11.03.18 16/11/2023  Sunny         TSK 0916075
.           Recompiled for PMSIDWXX/EDWINDSP - Changes for AHPRA ID
. V11.03.17 10/11/2023  Sunny         TSK 0916075
.           Recompiled for PMSIDWXX/EDWINDSP - Changes for AHPRA ID
. V11.03.16 24.10.2023  DA Sarkies    TSK 0939039
.           Switched the filter for state and status around
. V11.03.15 23.10.2023  DA Sarkies    TSK 0939039
.           Added code to allow for HCP Practice Maintainance next and prev
.           to work, and change ALL to spaces
. V11.03.14 13/10/2023  Sunny         TSK 0916075
.           Recompiled for PMSIDWXX
. V11.03.13 10/10/2023 Thanh T        TSK 0938574
.           Changed GPMHCP18, GPMHCP26, GGSRW300, PATDKA20, PATDKA30,
.           GPSRW100, GPSRW200, GPSRW300 and HCPSCH10 to comment out the
.           codes for PTCNUNET = '1' since it is no longer used
. V11.03.12 25.09.2023  DA Sarkies    TSK 0914515
.           Recompiled for PMSPKIPR       
. V11.03.11 18.09.2023  Jacob Jackson TSK 0935594
.           Add PROFLD64 to call GPPF0000 
. V11.03.10 08.09.2023  DA Sarkies    TSK 0914515
.           Recompiled for PMSPKIPR
. V11.03.09 24/08/2023  Davin         TSK 0918552
.           Added hl7 trigger 19 for practice update (wahealth/UDHCP000)
. V11.03.08 09/08/2023  Davin         TSK 0918552
.           Only trigger one hl7 message when adding practice (ADHCP000)
. V11.03.07 08/08/2023  Thanh T       TSK 0918552
.           Changed ADHCP000 to default "Practitioner" to surname (PMHCSNAM)
.           and "Attending" to given name (PMHCGNAM) 
. V11.03.06 03.03.2023  DA Sarkies    TSK 0914515
.           Added line to load PTCNHDPS from CONTROLF. Added filter for state
. V11.03.05 14/07/2023  Davin         TSK 0918552
.           Changed hl7 trigger ids (HL7TRGID) in ADHCP000 to 17 and 18
. V11.03.04 10/07/2023  Thanh T       TSK 0918552
.           Added ADHCP000 and UDHCP000 to insert pmshcpaf and pmshclaf 
.           rows automatically when HCP Practice is added/updated,
.           new HL7 message triggers are also created     
. V11.03.03 05/12/2022  Bella Turco   TSK 0921957
.           Added NOMORE00 to PATDKA00 routine
. V11.03.02 25/11/2022  Bella Turco   TSK 0921957
.           Added NOMORE00 to GGSRH000 routine
. V11.03.01 22/11/2022  Bella Turco   TSK 0921957
.           Continued adding PTCNNRTD & NOMORE00 to maintenance lists
. V11.02.03 02/08/2022  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.02 28/07/2022  Ebon Clements  TSK 0918434
.           Added keep alive to GP practice search - GGSRH000
.           26/07/2022  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.01 07/07/2022  Bella Turco    TSK 0921997
.           Added a Unit Filter dropdown menu
. V11.01.02 23/12/2021  P Le Febour    TSK 0915313
.           Spelling mistake in the message HCP Pracice Code does not exist
. V11.01.01 26/02/2021  Don Nguyen     TSK 0903415
.           Fixed output of HCPTDESC, SPECIALT, HCPROLE for HCPFORM (PTCNHCPI).
.           Fixed read position of PTCSXOFF parameter (before PTCNHCPI) in INIT.
. V11.00.03 02/02/2021  Ebon Clements  TSK 0901974
.           Clear all MLTHCLFD file vars before the write - LHOS0000
. V11.00.02 04/09/2020  Don Nguyen     TSK 0884373
.           Modified Doctor Search Results Table (PATDKA00) output to remove
.           unnecessary </tr> for cross-browser.
. V11.00.01 02/07/2020  Ebon Clements  TSK 0893888
.           Recompiled for PMSHCPTM - Blank gender description
. V10.15.03 11/12/2019  Ebon Clements  TSK 0883012
.           Fixed HCP status zero attending display for HCP search types
.           HCPSSTAT = 1, 6, 11, 15 & 16
. V10.15.02 18/11/2019  Davin          TSK 0864392
.           Added hcp search types 17-22 (PMSHKB04)
. V10.15.01 07/11/2019  Thanh T.       TSK 0879283
.           Recompiled for PMSHCPTM changes
. V10.14.06 26/09/2019  Sunny          TSK 0846427
.           Removed condition MAINTFLG<>1 from GPSRH000 to display              .           GP's surgical address if linked practice address in inactive
. V10.14.05 05/09/2019  Ebon Clements  TSK 0881147
.           Added EDWARD ISP speciality audit write to HCP maintenance
. V10.14.04 17/05/2019  Davin          TSK 0821139
.           Skip hospital check for ETS userid when validating doctor (ETSOGFLG)
. V10.14.03 08/03/2019  Ania P         TSK 0870099
.           Make GP Search ull GPs with inactive practice
. V10.14.02 05/03/2019  J.Tan          TSK 0870487
.           Mod PMSHKB00 for HCPSSTAT=16 - Show Related Provider
. V10.14.01 01/03/2019  Ebon Clements  TSK 0871097
.           Fixed EDWARD ISP audit writes - Add multiple doctor units in a day
. V10.13.05 14/01/2019  Ebon Clements  TSK 0868909
.           Added EDWARD ISP audit writes - Doctor unit
. V10.13.04 09/01/2019  Ebon Clements  TSK 0868909
.           Added EDWARD ISP audit writes
. V10.13.03 12/12/2018  Jill Parkinson Task 0867207
.           Added updates of pmshcpaf when adding/updating/deleting pmsdunaf
. V10.13.02 11/12/2018  Ania P         TSK 0866112
.           Stop GP search from culling GPs that have an inactive practice
. V10.13.01 29/10/2018  Davin          TSK 0846219
.           Added read of pmshcpaf for M02 broadcast triggers 5,6,7 (GPPGPL00)
.           Added M02 broadcast triggers 14,15,16 for add/upd/del of hcp links
.           to practices (GPPGCL00)
. V10.12.08 12/07/2018  Tracey Nguyen  TSK 0858712
.           Added CPRC0000 to check if practice has already been displayed in
.           the search
. V10.12.07 26.06.2018  B.G.Ackland    TSK 0835482 
.           Fix output of formatted name in FHIR Practitioner Resource
. V10.12.05 28/05/2018  Ebon Clements  TSK 0848318
.           Don't clear HCP date record created. Set PMHCP098, PMHCP099,
.           PMHCP100, PMHCL013, PMHCL014 and PMHCL015 to Z70 not SP70 
.           in CLRPAR00
. V10.12.04 14/05/2018  J.Tan          TSK 0855395
.           Mod to check blank KEYWRD01
. V10.12.03 10/04/2017  J.Tan          TSK 0855074
.           Mod Soundex key to check for blank keyword
. V10.12.02 05/03/2018  Tracey Nguyen  TSK 0825792
.           Added new doctor search type 5 (DOCSTAT=5) in PATDKB00 
. V10.12.01 10/01/2018  Tracey Nguyen  TSK 0825792
.           1) Recompiled for PMSHCPTD/TM
.           2) Added all references to PMHCHCST=14/15 for HCP type Nurse/
.              Nurse & Other
.           3) Added PMSHKB14/15 for Search option 14/15
.           4) Changed "HCP Name" to "HCP Name and Type" in GPSHD000
.           12.01.2018  B.G.Ackland    TSK 0835482 
.           Add Email to FHIR Practitioner Output
. V10.11.05 12/10/2017  Jill Parkinson TSK 0846520 
.           Changed tag 12.406 from outputting DCODE (which has not been read)
.           to PMDUN001
. V10.11.04 13.09.2017  B.G.Ackland    TSK 0835482 
.           Include Practice Name as First Line of Address in FHIR Search Results
. V10.11.03 24/08/2017  Richa Phogat   TSK 0844249
.           Display HCP type/Specialty/Role on HCP search
. V10.11.02 08/08/2017  Tracey Nguyen  TSK 0299206
.           1) Recompiled for PMSHKIPR, PMSPKIPR and PATDKIPR
.           2) Added PTCSXOFF to determine if Soundex should be used in 
.              HCP, Practice and Doctor searches - in GPSRH000, GGSRH000 and
.              PATDKA00 respectively
.           3) Added GENSNDVR(Variables) and GENSNDEX to generate Soundex key
. V10.11.01 17/07/2017  Peter Vela     TSK 0837619
.           Added Health Fund Payee Id functionality
. V10.10.02 14/06/2017  Richa Phogat   TSK 0826255
.           Display HCP Type/Specialty/Role on HCP & Doctor Searches
. V10.10.01 01/05/2017  Ebon Clements  TSK 0837575 
.           Added trap to HCP search if keywords are still generating.   
.           isclear causes P * K when records are cleared -  GPSRH000
.           21/01/2017  B.G.Ackland    TSK 0835482 
.           Added Branch for Invalid HCP for FHIR request
.           30/03/2017  Ania P         TSK 0835486
.           Fixed output/update of Dr in Dr/Unit Maintenance
. V10.09.01 12/01/2017  Don Nguyen     TSK 0823376
.           Added PROFLD44 (GPPG0000), HCPSCH00, HCOMTY00, HCOMTZ00, HCOMAH00, 
.           HCOMAB00 and GHCPCM00.
.           Added 'menuflag' to GPGRW000 - HCP Update Enquiry View
.           Recompiled for changes to PMSHCPTM
. V10.08.03 21/09/2016  Peter Vela     TSK 0821604
.           Added Specialties to HCP Search Table GPSRH000
. V10.08.02 10/08/2016  Peter Vela     TSK 0307252
.           Added tag functionality for UPCASHCP
. V10.08.01 02/05/2016  Ania P         CAR 322540
.           Recompile for PMSHCPTD
. V10.07.02 22.10.2015  Ebon Clements  CAR 320819
.           Added active/inactive indicator to doctor letter maintenance
. V10.07.01 22/10/2015  Ania P        CAR 309421
.           Recompiled for PATDOCCD
. V10.06.03 14/08/2015  Peter Vela    CAR 316642
.           Added Assessor validation to GPSRH000
. V10.06.02 13/05/2015  Ania P        CAR 316690
.           Extended HCPTDESC to DIM32 
. V10.06.01 07/04/2015  Peter Vela    CAR 303889
.           Added HCP / Specialty functionality
.           Added Doctor / Unit Maintenance HCP level
. V10.05.11 26/02/2015  Ebon Clements CAR 313396
.           Move one to exit after invalid update key error - DOCCOD92
. V10.05.10 05/02/2015  Ebon Clements CAR 311530
.           Recompiled for PMSHCPTD and PMSHCPTM - Years of accreditation
. V10.05.09 04/02/2015  Ebon Clements CAR 311530
.           Clear all HCP file fields prior to cgi move in add HCP - GPMHCP10
. V10.05.08 20/11/2014  Peter Vela    CAR 308500
.           Added Table Sort for Doctors Leave
. V10.05.07 18/11/2014  Ebon Clements CAR 306904
.           Ignore PTCNACGP test when in HCP maintenance by surname - GPSRH250
. V10.05.06 24/10/2014  Ebon Clements CAR 306904
.           Ignore PTCNACGP test when in HCP maintenance by surname - GPSRH000
. V10.05.05 23/10/2014  Peter Vela    CAR 307445
.           Added branch 14 to PMSHKB00 for Active Exclude GP with related
.           provider test
. V10.05.04 22/10/2014  Ebon Clements CAR 306914
.           Fixed GOTO at DOCCOD92 invalid update key errror
. V10.05.03 29/09/2014  Ebon Clements CAR 305527
.           Clear Hospital Specific HCP PMHCHOSS prior to HCP add - GPMHCP15
. V10.05.02 25/07/2014  Ebon Clements CAR 295504
.           Recompiled for PMSHKIPR - Preferred name to keywords
. V10.05.01 18/07/2014  Don Nguyen    CAR 293595
.           Recompiled for PMSHCPFD
.----------------------------------------------------------------------
. V10.04.08 21/05/2014  Ebon Clements CAR 301150
.           Fixed doctors active status when add/update HCP codes - MVPTDO00
. V10.04.07 12/05/2014  Ebon Clements CAR 298104
.           Fixed auto generate of doctor record when auto generating HCP codes
. V10.04.06 02/05/2014  Ebon Clements CAR 295504
.           Added linkdoct cgi to ShowDetail06() and UpdateHCP02()
. V10.04.05 03/04/2014  Patrick Adair Car 297983
.           changed PMSHKB00 to skip hospital check for show all active hcp
. V10.04.04 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.03 27/03/2014  Ebon Clements     CAR 295375
.           Changed NEXTPR00 and PREVPR00 to use a 4 character startnum
. V10.04.02 21/03/2014  Peter Vela        CAR 287404
.           Recompiled for PMSHCGFD
. V10.04.01 26/02/2014  Ebon Clements     CAR 291879
.           Added CHNGMADE to flag changes made to fields on HCP template.
.           Called WIPL0000 for relevant routines.
.           05/02/2014  Ebon Clements     CAR 291879
.           Added NEHTA functionality
.----------------------------------------------------------------------
. V10.03.20 13/12/2013  Don Nguyen        CAR 295206
.           Added CHDOCU00 to check the Linked Doctor Code for a HCP update
. V10.03.19 19/11/2013 Peter Vela         CAR 293337
.           Fixed auto-generate of HCP codes
. V10.03.18 27/09/2013 Ania P             CAR 292026
.           Changed invalid "A/M" values in PTDOAUPD to 0/1
. V10.03.17 21/08/2013  Ebon Clements     CAR 288616
.           Added nodoctor menu cgi to restrict adding attending doctor
.           types in HCP maintenance
. V10.03.16 14/08/2013  B.G.Ackland       CAR 289383
.           New JSON Output HCP Search
.           Fix Keyword Search to look at second word correctly HCP and 
.           Practice Search
. V10.03.15 03/05/2013  Ebon Clements     CAR 261630
.           Removed port number from temp file name
. V10.03.14 02/05/2013  Peter Vela        CAR 284713
.           Added unlock for patdstaf @ DOCBUD26 
. V10.03.13 25/02/2013  Ania P            CAR 281021
.           Removed unnecessary modification of constants.
. V10.03.12 16/01/2013  Peter Vela        CAR 276525
.           Added All Inactive to PMSHKB00
. V10.03.11 06/12/2012  Patrick A       CAR 244064
.           Recompiled for PMSHCPTM - corrected PHMCP112 processing
. V10.03.10 29/11/2012  Patrick A       CAR 244064
.           Recompiled for IBAWEBCD
. V10.03.09 22/11/2012  Ebon Clements   CAR 274775
.           Added ignore hospital test to HCP search - PMSHKB00 - valdallh
.           22/11/2012  Ania P          CAR 274766
.           Added IBCNMHOS<>1 test to CHKINF10.
.           21/08/2012  Patrick Adair   CAR 244064
.           HCP to Doctor Table V2
. V10.03.08 25/05/2012  Saroeun Soeur   CAR 265236
.           created SRCDCJ00 to output JSON
. V10.03.07 24/05/2012  Peter Vela        CAR 265245
.           Added Contact Details functionality to PATDKA00
. V10.03.06 20/04/2012  Steve Armstrong  CAR 263368  
.           Added BRANCH on EXIT after call to WEBERR00 in ADDUNI00,
.           UPDUNI00 & DELUNI00.
. V10.03.05 11/04/2012  Steve Armstrong  CAR 263368  
.           Added BRANCH on EXIT after call to WEBHED00 in DOCCOD00
.           and DOCUNI00 routines.
. V10.03.04 22/02/2012  Peter McMullen   CAR 259587  
.           Remove reference to file patyear1                   
. V10.03.03 15/02/2012  Ebon Clements    CAR 255142  
.           Fixed attending & referring tests - PMSHKB70        
. V10.03.02 12/02/2012  Jill Parkinson   CAR 255142  
.           Added checks for PMHCHCST values of 11,12 and 13
. V10.03.01 09/12/2011  Davin             CAR 244602
.           Added M02 broadcast triggers 8,9,10 for add/upd/del of hcp linked
.           hospitals (hoslnk00)
.           Added M02 broadcast triggers 11,12,13 for add/upd/del of hcp linked
.           hospitals & units (pmstmd00)
. V10.02.05 08/08/2011  Davin             CAR 240723
.           Only display Units/Roles for HCP if using divisions (ptcndivn=1)
. V10.02.04 03/08/2011  Davin             CAR 240723
.           Added Doctor Arrangements validation routine (chkdra00)
. V10.02.03 28/07/2011  Davin             CAR 240723
.           Added Doctor Arrangements (option 19)
. V10.02.02 18/07/2011  Davin             CAR 240723
.           Added Doctor Unit/Teams (option 17) & Doctor Roles (option 18)
. V10.02.01 30/06/2011  Davin             CAR 240723
.           Added Teams (option 15) & Linked Hospitals (option 16)
. V10.01.03 10/02/2011  Ebon Clements     CAR 234598
.           Added AH method of contact to HCP and doctors files
. V10.01.02 28/01/2011  Mike Laming       CAR 234723
.           Recompiled for PMSHCGTM - add Java Script format for "Practice Name"
.           Moved routine JAVHCG00 to PMSHCGTM.PBL & JAVPNAME to PMSHCGTD.INC
. V10.01.01 10/01/2011  Steve Armstrong   CAR 220955
.           Added extra triggers for DGCLIM02 for adding, updating or
.           deleting linked practices for GP's.
. V10.00.03 07/10/2010  Jill Parkinson    CAR 207094
.           Added output of PRACPFAX in GPSRX100
.           Added output of PMHGPFAX in GGHRW000
. V10.00.02 07/09/2010  Mike Laming       CAR 179365
.           Removed "Referring Doc & GP" from HCP Search selection of "Active
.           Attending" at PMSHKB10 (also removed in PATWEB80 at VALHCP75)
. V10.00.01 19/03/2010  Steve Armstrong   CAR 135505
.           Added HL7TRGID & HL7INCLD setting for all broadcast messages
.-------------------------------------------------------------------------------
. V9.12.06  25/02/2010  Peter McMullen CAR 216685
.           Clear HCP Practice cgi vars in CLRPAR00
. V9.12.05  04/11/2009  Peter McMullen CAR 202694
.           Use new standard routine for formatting Dr names
.           (DOCNM000 not DOCNAM00)
. V9.12.04  23/10/2009  Ebon Clements  CAR 206490
.           Added line number test to comment icon display - DCOMTZ00
. V9.12.03  08/10/2009  Mike Laming    CAR 206490
.           Add "Dr.Comment" & "Ad-hoc Comment" code for Dr.Enquiry View templat
. V9.12.02  08/09/2009  Peter Vela     CAR 185999
.           Move spaces to MLHCHSRI before write to mlthcpaf
. V9.12.01  02/09/2009  Ebon Clements  CAR 174784
.           Only display a doctor or HCP in the search results once          
. V9.11.02  16/01/2009  Jill Habasque  CAR 185694
.           Recompiled for PMSHCPTM - added PMHCCPER
. V9.11.01  06/11/2008  Peter McMullen CAR 174725
.           convert internal javascript to W3C standards
. V9.10.02  26/06/2008  Ebon Clements  CAR 170942
.           Fixed read of doctor for budget display - DOCBUD40
. V9.10.01  29/05/2008  Jill Habasque  CAR 169478
.           Mods to use PractDescription to output Practice or Village
. V9.09.08  17/03/2008  Jill Habasque  CAR 163787
.           Fixed output of linked practices list
. V9.09.07  06/02/2008  Jill Habasque  CAR 160457
.           Added output of keywords
. V9.09.06  07/01/2008  Ebon Clements  CAR 146550
.           Recompiled for PMSHKIPR and PATDKIPR
. V9.09.05  11/12/2007  Ebon Clements  CAR 143977
.           Recompiled for PMSHCPFD & PATDO1FD - Added Accred. Expiry Date
. V9.09.04  18/10/2007  Peter McMullen CAR 152037
.           Reposition on HCP record after building Linked Practice list
. V9.09.03  08/10/2007  Peter McMullen CAR 149166
.           Added yes/no flag for HCP in linked practice
. V9.09.02  29/08/2007  Peter Vela    CAR 148637
.           Added initialisation of PMHCP106 Exclude from Exclude List
.           Added DOCTC079 (PTDOEXML) Exclude from Mailing List
. V9.09.01  19/06/2007  Ebon Clements CAR 143161
.           Added validate related provider type to the HCP search
. V9.08.07  07/06/2007  Mike Laming   CAR 125736
.           Correct Doctor Surgery/Home Address lines (cgi variables short) -
.           activate use of all 4 Doctor file Address lines 
. V9.08.06  05/06/2007  Mike Laming   CAR 141988
.           Correct Doctor to HCP variables at HCPUPD20 - HCP Type
. ........  05/06/2007  Mike Laming   CAR 142157
.           Re-compiled for PMSHCPTM - correct PMHCRGDF & PMHCRGDT      
. ........  05/06/2007  Mike Laming   CAR 142039
.           Re-compiled for PATDOCTM - correct PTCOCOMT to use Cat."CZ"
. V9.08.05  23/01/2007  Janet George  CAR 122595
.           Modified the Private Practise Doctor Search to skip
.           Multihospital functionality 
. V9.08.04  02/01/2007  Ebon Clements CAR 126779
.           Recompiled for PMSHCPFD - Provider type
. V9.08.03  01/12/2006  Ebon Clements CAR 126779
.           Recompiled for PMSHCPFD - Added provider type
. V9.08.02  16/10/2006  Ebon Clements CAR 114578
.           Fixed update of Doctors Address to HCP (suburb & state) HCPUPD00
. V9.08.01  28/09/2006  Jill Habasque CAR 120214
.           Added GETLV000 - tag to output "Leave exists"
. V9.07.01  31/07/2006  Ebon Clements CAR 112939
.           Added nextpage 5 WEBWAR00 for auto generate doctor code display
. V9.05.03  20/04/2006  Mike Laming   CAR 81335
.           Re-compile for BRHLCOMN - correct assignment to H7CIACTN           
. V9.05.02  14/03/2006  Ebon Clements CAR 78533
.           Added hospital specific functionality to doctor and HCP maintenance
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B06 27/02/2006  Mike Laming   CAR 81335
.           Added variable PMHCACTN (add/update PMSHCPFD) for DGCLIM02
. V9.05.B05 24/02/2006  Mike Laming   CAR 81335
.           Added PROC DGCLIM02 (send HL7 msg - Doctor Details)
. V9.05.B04 17/02/2006  Ebon Clements CAR 81335
.           Added auto generate next doctor/hcp functionality
. V9.05.B03 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.05.B02 09/01/2006  J.Tan                    CAR 90040
.           Added HCPSSTAT=12 - Responsible HCP for Mental Health
. V9.04.18  06/12/2005  Davin                    CAR 87261
.           Changed option 4 (gethcp00) to display "practice only" details
.           if necessary
. V9.04.17  17/10/2005  Davin          CAR 71153
.           Added timeout cgi vars to next/previous routines (nextpr00/prevpr00)
. V9.04.16  22/09/2005  Jill Habasque  CAR 77204
.           Added call to JAVHCP00 in PRARW000
. V9.04.15  08/09/2005  J.Tan                    CAR 66205
.           Recompiled for PMSHCGTM 
. V9.04.14  24/08/2005  Ebon Clements            CAR 70766
.           Recompiled for hcp file changes - Show free format local gp
. V9.04.13  05/08/2005  Davin                    CAR 69025
.           Changed option 4 (gethcp00) to display linked practice details
. V9.04.12  21/07/2005  Mike Laming     CAR 59305
.           Re-compile for PMSHCPTM - Add "A/M" values for PMHCUPDF
. V9.04.11  18/07/2005  Davin                    CAR 22680
.           Added check of ptcnacgp - only display active gp/practice combos
. V9.04.10  03/06/2005  Davin                    CAR 62598
.           Added calls to format hcg javascript (javhcg00)
. V9.04.09  16/05/2005  Peter Vela               CAR 60046
.           Added tags for HCP comments
. V9.04.08  25/05/2005  Davin                    CAR 22680
.           Mods for GP/Practice Search 
. V9.04.07  18/04/2005  Ebon Clements            CAR 60685
.           Added missing doctor file fields to INITDA00
. V9.04.06  01/02/2005  Peter Vela               CAR 57413
.           Added tag for KEYWORDS HCP Maintenance (Surname)
. V9.04.05  25/01/2005  Henry Son                CAR 46418
.           Add &nbsp so columns are displayed correctly.
. V9.04.04  11/01/2005 J.Tan         CAR 55717
.           Mods to display Attending and Referring HCP search HCPSSTAT=11
. V9.04.03  14/12/2004 Davin         CAR 55658
.           Added photo id maintenance (option 14)
. V9.04.02  22/11/2004 Ebon Clements CAR 55239
.           Added tag for case team member details yes/no
. V9.04.01  15/11/2004 Lina Vo       CAR 53950
.           Added Period description tag. Replace hard coding of Months
. V9.03.04  16/06/2004 Ebon Clements CAR 50674
.           Added hcp comments to hcp maintenance
. V9.03.03  16/04/2004 Ebon Clements CAR 18703
.           Added doctor start and end dates
. V9.03.02  26/03/2004 Peter Vela    CAR 13038
.           Recompiled for PATDOCCD - Doctor Name format Parameter
. V9.03.01  14/10/2003 Peter Vela    CAR 43894
.           Recompiled for PMSHCPTD
. V9.02.16  17/01/2003 Jill Habasque SRF 35088
.           Fixed output of budgets
. V9.02.15  28/06/2002 Ebon Clements 19105
.           Recompiled for sigpipe trap
. V9.02.14  11/06/2002 Ebon Clements 18216
.           Added mobile number to HCP search screen.
. V9.02.13  13/02/2002 Jill Habasque 
.           Fixed doctor title in search
. V9.02.12  10/02/2002 Ebon Clements 
.           Mods to GPSRW000 for HCP maintenance by surname                     
. V9.02.11  25.01.2002 Ebon Clements 
.           Added JAVHCP00 and JAVDOC00 for apostrophes in names, convert to %60
. V9.02.10  19.01.2002 Jill Habasque 
.           Added move of DRTYPE2-5 to HCP fields     
. V9.02.09  19.12.2001 Ebon Clements 
.           Added PMDUHEAD to doctor unit maintenance
. V9.02.08  03.12.2001 Ebon Clements 
.           Added tag for HCPSSTAT for hcp search
. V9.02.07  25.10.2001 Jill Habasque
.           Added maintenance for PATDUNFD - Doctor/Unit Maintenance
. V9.02.06  24.10.2001 B.G.Ackland
.           Added Record Locking to PATDSTIO
. V9.02.05  25/09/2001 Ebon Clements 
.           Fixed size of cgi variables DOCTC034 and DOCTC035
. V9.02.04  21/09/2001 Ebon Clements 
.           Added validation for new hcp types
. V9.02.03  08/09/2001 Ebon Clements 
.           Added HCP Type to maintenance screen
. V9.02.02  28/08/2001 Ebon Clements 
.           Added maintenace of doctors letters
. V9.02.01  24/08/2001 Jill Habasque 
.           Fixed the save of Doctors Address to HCP file (suburb & state)
. V9.00.02  10/08/2001 Ebon Clements 
.           Fixed cgi details for next and prev HCP search screens
. V9.00.01  07/08/2001 Ebon Clements 
.           Changed doctor maintenance patdo1fd to update pmshcpfd
. V9.00.B05 24.07.2001 Sandra Barcham
.           Fix use of HCPDET00 & HCGDET00
. V9.00.B04 13.07.2001 Sandra Barcham
.           User pmshcpaf,pmshcgaf & pmshclaf
.           instead of patgppaf,patgclaf & patgpcaf
. V9.00.B03 26/06/2001 Jill Habasque
.           Added Status to be displayed         
. V9.00.B02 26/06/2001 Jill Habasque
.           Added option for All                 
. V9.00.B01 19/06/2001 HPS
.           Modified for Non Active Doctor Search
. V5.10.B04 11/04/2001 Bronko Sosic  
.           Recompiled for changes to PATPA1FD     
. V5.10.B03 21/03/2001 Ebon Clements 
.           Fixed update of years of accreditation
. V5.10.B02 07/03/2001 J.Tan
.           Fixed spelling of Specialties
.------------------------------------------------------------
. V5.09.B03 01.03.2001 Ebon Clements
.          Added new variables to doctors audit             
. V5.09.B02 15.02.2001 Ebon Clements
.          Changes for patdo1af and patdstaf file layouts
. V5.08.04 30.10.2000 B.G.Ackland  
.          Fixed Below with Clear on KEY11
. V5.08.03 10.09.2000 Katie Nelson
.          Added match for SP70 on date PTGCDJND - srf 647286
. V5.08.02 27.09.2000 J.Tan
.          Added GP Practice return with counter (GPPRW200)
. V5.08.01 25.05.2000 B.G.Ackland
.          Fixed Javascript Link
. V5.07.11 25.03.2000 Bronko Sosic
.          Added startkey and startke1 for GOTO button
. V5.07.10 06.03.2000 B.G.Ackland 
.          Fixed Stats Year Parameter
. V5.07.09 02.03.2000 B.G.Ackland 
.          Fixed Stats Year Parameter being Cleared
. V5.07.08 21.02.2000 B.G.Ackland 
.          Added GP & Practice Search by Name Page
. V5.07.07 20.01.2000 B.G.Ackland 
.          Added GP Search by Name Page
. V5.07.06 12.01.2000 Bronko Sosic
.          Added REP " 0" after CYY
. V5.07.05 06.01.2000 Katie Nelson   
.          Y2K date correction in STATS000                 
. V5.07.04 20.12.1999 Katie Nelson   
.          Recompiled for IBAWEBDF/IBAWEBCD                   
. V5.07.03 29.11.1999 Pat Dirito     
.          Added validation of Senior Partner for GP Practice 
. V5.07.02 29.10.1999 Pat Dirito     
.          Added Option 9 Doctors Leave Mainatenance 
. V5.07.01 30.09.1999 K.C.Nelson     
.          Added GPC Details                         
. V5.07.00 30.06.1999 K.C.Nelson     
.          Port from 6.06 to 5.07                     
.------------------------------------------------------------
.                V6.04.02 20.01.1998 B.G.Ackland
.                         Recompile for Standard Includes
.
.                V6.04.03 23.03.1998 B.G.Ackland
.                         New Template Body Processing   
.
.                V6.06.00 16.03.1999 Pat Dirito
.                         Ported from r6.05
.                         Added Report no.3 Doctor Code Maintenance 
.                         20.04.1999 Pat Dirito
.                         Added parameter to template field for search
.                         results. (Allows for public and non public format)
.                         Added field set 2 for option 1 (Doctor Comments, 
.                         Doctor Statistics).
.
.                V6.06.02 26.04.1998 B.G.Ackland
.                         Allow Security Link (WBSEDOC) to Doctor Code
.                         If CGI Parameter is Blank (DOCTCODE)         
.                         Fixed so that Year can be specified as a CGI Parameter
.
.------------------------------------------------------------
.
          INC       IBAWEBDF    
          INC       WEBDATDF
.
          INC       APSMASFD/INC
          INC       GENSNDVR/INC    * Soundex key vars for GENSNDEX  *C-0299206
          INC       MLTHCPFD/INC
          INC       MLTHCPTD/INC
          INC       MLTSECFD/INC
          INC       PATAD1FD/INC
          INC       PATCONFD/INC
          INC       PATFN1FD/INC
          INC       PATHSPFD/INC       * Hospital File
          INC       PMSIDWFD/INC
          INC       PMSIDWVR/INC
          INC       PMSDUNFD/INC
          INC       PATDO1FD/INC
          INC       PATDRGFD/INC 
          INC       PATDSTFD/INC 
          INC       PATDKIFD/INC
          INC       PATHDOFD/INC 
          INC       PATIN1FD/INC 
          INC       PATPA1FD/INC
          INC       PATPERFD/INC
          INC       PATWR1FD/INC
          INC       PMSFPHFD/INC
          INC       PMSFPHTD/INC
          INC       PMSHCPFD/INC       * National HCP File 
          INC       PMSHCGFD/INC       * HCP Practice File
          INC       PMSHCLFD/INC       * Link HCP's to Practices 
          INC       PMSHKIFD/INC
          INC       PMSPKIFD/INC
          INC       PMSDIVFD/INC
          INC       PMSTMDFD/INC
          INC       PMSDRAFD/INC
          INC       PMSSPEFD/INC
          INC       PMSRLDFD/INC
          INC       OPRDLVFD/INC       * Doctors Leave
.
          INC       PMSHCGTD/INC
          INC       PMSHCLTD/INC
          INC       PMSHCPTD/INC
          INC       PMSTMDTD/INC
          INC       PMSDRATD/INC
          INC       PMSSPETD/INC
          INC       PMSRLDTD/INC
          INC       PATDLTFD/INC
          INC       PMSTCOFD/INC
          INC       ALLCTMFD/INC
          INC       PMSTEMFD/INC
          INC       PMSTEMTD/INC
          INC       TFILEVAR/INC
.          INC       PMSIPLFD/INC
.
. Doctor stats file print variables for a year
.
DSCDSH1   FORM      4         * DISCHARGES  OFFSET MONTH 1
DSCDSH2   FORM      4         * DISCHARGES  OFFSET MONTH 2
DSCDSH3   FORM      4         * DISCHARGES  OFFSET MONTH 3
DSCDSH4   FORM      4         * DISCHARGES  OFFSET MONTH 4
DSCDSH5   FORM      4         * DISCHARGES  OFFSET MONTH 5
DSCDSH6   FORM      4         * DISCHARGES  OFFSET MONTH 6
DSCDSH7   FORM      4         * DISCHARGES  OFFSET MONTH 7
DSCDSH8   FORM      4         * DISCHARGES  OFFSET MONTH 8
DSCDSH9   FORM      4         * DISCHARGES  OFFSET MONTH 9
DSCDSH10  FORM      4         * DISCHARGES  OFFSET MONTH 10
DSCDSH11  FORM      4         * DISCHARGES  OFFSET MONTH 11
DSCDSH12  FORM      4         * DISCHARGES  OFFSET MONTH 12
DSCBED1   FORM      4         * BED DAYS    OFFSET MONTH 1
DSCBED2   FORM      4         * BED DAYS    OFFSET MONTH 2
DSCBED3   FORM      4         * BED DAYS    OFFSET MONTH 3
DSCBED4   FORM      4         * BED DAYS    OFFSET MONTH 4
DSCBED5   FORM      4         * BED DAYS    OFFSET MONTH 5
DSCBED6   FORM      4         * BED DAYS    OFFSET MONTH 6
DSCBED7   FORM      4         * BED DAYS    OFFSET MONTH 7
DSCBED8   FORM      4         * BED DAYS    OFFSET MONTH 8
DSCBED9   FORM      4         * BED DAYS    OFFSET MONTH 9
DSCBED10  FORM      4         * BED DAYS    OFFSET MONTH 10
DSCBED11  FORM      4         * BED DAYS    OFFSET MONTH 11
DSCBED12  FORM      4         * BED DAYS    OFFSET MONTH 12
DSCOPR1   FORM      4         * OPERATIONS  OFFSET MONTH 1
DSCOPR2   FORM      4         * OPERATIONS  OFFSET MONTH 2
DSCOPR3   FORM      4         * OPERATIONS  OFFSET MONTH 3
DSCOPR4   FORM      4         * OPERATIONS  OFFSET MONTH 4
DSCOPR5   FORM      4         * OPERATIONS  OFFSET MONTH 5
DSCOPR6   FORM      4         * OPERATIONS  OFFSET MONTH 6
DSCOPR7   FORM      4         * OPERATIONS  OFFSET MONTH 7
DSCOPR8   FORM      4         * OPERATIONS  OFFSET MONTH 8
DSCOPR9   FORM      4         * OPERATIONS  OFFSET MONTH 9
DSCOPR10  FORM      4         * OPERATIONS  OFFSET MONTH 10
DSCOPR11  FORM      4         * OPERATIONS  OFFSET MONTH 11
DSCOPR12  FORM      4         * OPERATIONS  OFFSET MONTH 12
DSXOPR1   FORM      4         * OPERATIONS  OFFSET MONTH 1
DSXOPR2   FORM      4         * OPERATIONS  OFFSET MONTH 2
DSXOPR3   FORM      4         * OPERATIONS  OFFSET MONTH 3
DSXOPR4   FORM      4         * OPERATIONS  OFFSET MONTH 4
DSXOPR5   FORM      4         * OPERATIONS  OFFSET MONTH 5
DSXOPR6   FORM      4         * OPERATIONS  OFFSET MONTH 6
DSXOPR7   FORM      4         * OPERATIONS  OFFSET MONTH 7
DSXOPR8   FORM      4         * OPERATIONS  OFFSET MONTH 8
DSXOPR9   FORM      4         * OPERATIONS  OFFSET MONTH 9
DSXOPR10  FORM      4         * OPERATIONS  OFFSET MONTH 10
DSXOPR11  FORM      4         * OPERATIONS  OFFSET MONTH 11
DSXOPR12  FORM      4         * OPERATIONS  OFFSET MONTH 12
.
BSCDSH1   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 1
BSCDSH2   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 2
BSCDSH3   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 3
BSCDSH4   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 4
BSCDSH5   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 5
BSCDSH6   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 6
BSCDSH7   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 7
BSCDSH8   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 8
BSCDSH9   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 9
BSCDSH10  FORM      4         * DISCHARGES BUDGET OFFSET MONTH 10
BSCDSH11  FORM      4         * DISCHARGES BUDGET OFFSET MONTH 11
BSCDSH12  FORM      4         * DISCHARGES BUDGET OFFSET MONTH 12
BSCBED1   FORM      4         * BED DAYS BUDGET OFFSET MONTH 1
BSCBED2   FORM      4         * BED DAYS BUDGET OFFSET MONTH 2
BSCBED3   FORM      4         * BED DAYS BUDGET OFFSET MONTH 3
BSCBED4   FORM      4         * BED DAYS BUDGET OFFSET MONTH 4
BSCBED5   FORM      4         * BED DAYS BUDGET OFFSET MONTH 5
BSCBED6   FORM      4         * BED DAYS BUDGET OFFSET MONTH 6
BSCBED7   FORM      4         * BED DAYS BUDGET OFFSET MONTH 7
BSCBED8   FORM      4         * BED DAYS BUDGET OFFSET MONTH 8
BSCBED9   FORM      4         * BED DAYS BUDGET OFFSET MONTH 9
BSCBED10  FORM      4         * BED DAYS BUDGET OFFSET MONTH 10
BSCBED11  FORM      4         * BED DAYS BUDGET OFFSET MONTH 11
BSCBED12  FORM      4         * BED DAYS BUDGET OFFSET MONTH 12
BSCOPR1   FORM      4         * OPERATION BUDGET OFFSET MONTH 1
BSCOPR2   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 2
BSCOPR3   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 3
BSCOPR4   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 4
BSCOPR5   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 5
BSCOPR6   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 6
BSCOPR7   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 7
BSCOPR8   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 8
BSCOPR9   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 9
BSCOPR10  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 10
BSCOPR11  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 11
BSCOPR12  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 12
BSXOPR1   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 1
BSXOPR2   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 2
BSXOPR3   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 3
BSXOPR4   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 4
BSXOPR5   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 5
BSXOPR6   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 6
BSXOPR7   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 7
BSXOPR8   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 8
BSXOPR9   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 9
BSXOPR10  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 10
BSXOPR11  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 11
BSXOPR12  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 12
.
SVCDSH1   FORM      4         * ADMISSIONS OFFSET MONTH 1
SVCDSH2   FORM      4         * ADMISSIONS OFFSET MONTH 2
SVCDSH3   FORM      4         * ADMISSIONS OFFSET MONTH 3
SVCDSH4   FORM      4         * ADMISSIONS OFFSET MONTH 4
SVCDSH5   FORM      4         * ADMISSIONS OFFSET MONTH 5
SVCDSH6   FORM      4         * ADMISSIONS OFFSET MONTH 6
SVCDSH7   FORM      4         * ADMISSIONS OFFSET MONTH 7
SVCDSH8   FORM      4         * ADMISSIONS OFFSET MONTH 8
SVCDSH9   FORM      4         * ADMISSIONS OFFSET MONTH 9
SVCDSH10  FORM      4         * ADMISSIONS OFFSET MONTH 10
SVCDSH11  FORM      4         * ADMISSIONS OFFSET MONTH 11
SVCDSH12  FORM      4         * ADMISSIONS OFFSET MONTH 12
SVCBED1   FORM      4         * BED DAYS    OFFSET MONTH 1
SVCBED2   FORM      4         * BED DAYS    OFFSET MONTH 2
SVCBED3   FORM      4         * BED DAYS    OFFSET MONTH 3
SVCBED4   FORM      4         * BED DAYS    OFFSET MONTH 4
SVCBED5   FORM      4         * BED DAYS    OFFSET MONTH 5
SVCBED6   FORM      4         * BED DAYS    OFFSET MONTH 6
SVCBED7   FORM      4         * BED DAYS    OFFSET MONTH 7
SVCBED8   FORM      4         * BED DAYS    OFFSET MONTH 8
SVCBED9   FORM      4         * BED DAYS    OFFSET MONTH 9
SVCBED10  FORM      4         * BED DAYS    OFFSET MONTH 10
SVCBED11  FORM      4         * BED DAYS    OFFSET MONTH 11
SVCBED12  FORM      4         * BED DAYS    OFFSET MONTH 12
SVCOPR1   FORM      4         * OPERATIONS  OFFSET MONTH 1
SVCOPR2   FORM      4         * OPERATIONS  OFFSET MONTH 2
SVCOPR3   FORM      4         * OPERATIONS  OFFSET MONTH 3
SVCOPR4   FORM      4         * OPERATIONS  OFFSET MONTH 4
SVCOPR5   FORM      4         * OPERATIONS  OFFSET MONTH 5
SVCOPR6   FORM      4         * OPERATIONS  OFFSET MONTH 6
SVCOPR7   FORM      4         * OPERATIONS  OFFSET MONTH 7
SVCOPR8   FORM      4         * OPERATIONS  OFFSET MONTH 8
SVCOPR9   FORM      4         * OPERATIONS  OFFSET MONTH 9
SVCOPR10  FORM      4         * OPERATIONS  OFFSET MONTH 10
SVCOPR11  FORM      4         * OPERATIONS  OFFSET MONTH 11
SVCOPR12  FORM      4         * OPERATIONS  OFFSET MONTH 12
SVXOPR1   FORM      4         * OPERATIONS  OFFSET MONTH 1
SVXOPR2   FORM      4         * OPERATIONS  OFFSET MONTH 2
SVXOPR3   FORM      4         * OPERATIONS  OFFSET MONTH 3
SVXOPR4   FORM      4         * OPERATIONS  OFFSET MONTH 4
SVXOPR5   FORM      4         * OPERATIONS  OFFSET MONTH 5
SVXOPR6   FORM      4         * OPERATIONS  OFFSET MONTH 6
SVXOPR7   FORM      4         * OPERATIONS  OFFSET MONTH 7
SVXOPR8   FORM      4         * OPERATIONS  OFFSET MONTH 8
SVXOPR9   FORM      4         * OPERATIONS  OFFSET MONTH 9
SVXOPR10  FORM      4         * OPERATIONS  OFFSET MONTH 10
SVXOPR11  FORM      4         * OPERATIONS  OFFSET MONTH 11
SVXOPR12  FORM      4         * OPERATIONS  OFFSET MONTH 12
SVBUDADM  FORM      4         * BUDGET FOR ADMISSIONS
SVBUDBED  FORM      4         * BUDGET FOR BED DAYS  
SVBUDOPR  FORM      4         * BUDGET FOR OPERATIONS
SVBUDMBS  FORM      4         * BUDGET FOR MBS CODES
.
SBCDSH1   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 1
SBCDSH2   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 2
SBCDSH3   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 3
SBCDSH4   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 4
SBCDSH5   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 5
SBCDSH6   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 6
SBCDSH7   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 7
SBCDSH8   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 8
SBCDSH9   FORM      4         * DISCHARGES BUDGET OFFSET MONTH 9
SBCDSH10  FORM      4         * DISCHARGES BUDGET OFFSET MONTH 10
SBCDSH11  FORM      4         * DISCHARGES BUDGET OFFSET MONTH 11
SBCDSH12  FORM      4         * DISCHARGES BUDGET OFFSET MONTH 12
SBCBED1   FORM      4         * BED DAYS BUDGET OFFSET MONTH 1
SBCBED2   FORM      4         * BED DAYS BUDGET OFFSET MONTH 2
SBCBED3   FORM      4         * BED DAYS BUDGET OFFSET MONTH 3
SBCBED4   FORM      4         * BED DAYS BUDGET OFFSET MONTH 4
SBCBED5   FORM      4         * BED DAYS BUDGET OFFSET MONTH 5
SBCBED6   FORM      4         * BED DAYS BUDGET OFFSET MONTH 6
SBCBED7   FORM      4         * BED DAYS BUDGET OFFSET MONTH 7
SBCBED8   FORM      4         * BED DAYS BUDGET OFFSET MONTH 8
SBCBED9   FORM      4         * BED DAYS BUDGET OFFSET MONTH 9
SBCBED10  FORM      4         * BED DAYS BUDGET OFFSET MONTH 10
SBCBED11  FORM      4         * BED DAYS BUDGET OFFSET MONTH 11
SBCBED12  FORM      4         * BED DAYS BUDGET OFFSET MONTH 12
SBCOPR1   FORM      4         * OPERATION BUDGET OFFSET MONTH 1
SBCOPR2   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 2
SBCOPR3   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 3
SBCOPR4   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 4
SBCOPR5   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 5
SBCOPR6   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 6
SBCOPR7   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 7
SBCOPR8   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 8
SBCOPR9   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 9
SBCOPR10  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 10
SBCOPR11  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 11
SBCOPR12  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 12
SBXOPR1   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 1
SBXOPR2   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 2
SBXOPR3   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 3
SBXOPR4   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 4
SBXOPR5   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 5
SBXOPR6   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 6
SBXOPR7   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 7
SBXOPR8   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 8
SBXOPR9   FORM      4         * OPERATIONS BUDGET OFFSET MONTH 9
SBXOPR10  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 10
SBXOPR11  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 11
SBXOPR12  FORM      4         * OPERATIONS BUDGET OFFSET MONTH 12
.
. CGI Variables
.
COUNTER   FORM      3
NEXTPAGE  DIM       1          * Nextpage parameter CGI parameter
NODOCTOR  DIM       1          * 1 = No addition of attending doctors
UPDTTYPE  DIM       1          * Update Type
ACTVSTAT  FORM      1          * Active/Inactive search status
HCPSSTAT  FORM      2          * HCP Type
RETNFLAG  DIM       1          * Return Flag cgi 0=HCP,1=HCP-Surname,2=doctor
.
ACTIDESC  DIM       8   * Active or Inactive Description
ARRCNT    FORM      3        * Array count
ASSRINDC  FORM      1
DATE      DIM       11         * Formatted Public Holiday Date
DOCARRAY  DIM       6[200]     * Doctors displayed in search results
DOCAREND  FORM      3          * Number of doctors in DOCARRAY[]
DOCTCODE  DIM       6
DOCTOR    DIM       30         * Doctor formatted name
DOCTSTAT  FORM      1
DOCCODE   FORM      3 
DOCTYPE   DIM       1          * Template paramter; Attending,Reffering,Both 
DIM3      DIM       3
DIM6      DIM       6
DIM11     DIM       11
DIM30     DIM       30
DIM4      DIM       4
DIM4A     DIM       4
DIM4B     DIM       4
DIM4C     DIM       4
DISPTYPE  DIM       18         * PETYPE description
DISPDAT1  DIM       11
DISPDAT2  DIM       11
DISPDAT3  DIM       11
DISPDAT4  DIM       11
DISPPCNT  DIM       2
DISPPNAM  DIM       80
DISPPRAC  DIM       10
ENDNAME   DIM       70
ETSOGFLG  FORM      1          * ets Occupational Group flag (1=ets)
FILTACTV  DIM       1
FILTUNIT  DIM       3          
FORM10    FORM      10
.GENPCODE  DIM      10 
.GPPCCODE  DIM      12          * GP Practice Code and Count
GENPPRAC  DIM       10         * HCP Practice
GENPPCNT  DIM       2          * HCP Practice Count
FINYEAR   DIM       4 
FINMON    DIM       2
HCPARRAY  DIM       10[200]    * HCP displayed in search results
HCPAREND  FORM      3          * Number of HCPs in HCPARRAY[]
HCPCOMTY  DIM       3          * HCP Comment Type Cat TZ
HCPLEVEL  DIM       1
HCPSTATE  DIM       4          * State to Filter
...HCGSNAME  DIM       80
...HCGENAME  DIM       80
LHOSPCNT  FORM      3          * Count of hospital array fields
LHOSPARR  DIM       3[99]      * Array of hospital codes
LOOPCNTR  FORM      3          * Keep alive loop counter
LNK2PRT   FORM      1
LNKRLIND  FORM      1          * linked roles indicator
LNKUNIND  FORM      1          * linked units indicator
LNKTEIND  FORM      1          * linked teams indicator
MAINTFLG  FORM      1          * Maintenance screen flag
MULTHOSP  DIM       3
MULTIHCP  DIM       10
OPFLGFIL  FORM      1          * Open Flag for File 
PAGEFULL  FORM      1          * Page full indicator                *C-0299206
PERDCODE  DIM       2
PMHCACTN  DIM       1          * add/update PMSHCPFD flag for DGCLIM02
PHOTODIR  DIM       20         * unix directory to save photos in
PHOTOEXT  INIT      ".jpg"     * photo file extension
PHOTOFIL  DIM       20         * photo saved as u/r number
PHOTOPIC  DIM       20         * photo input filename
PHOTOOLD  INIT      ".old"     * move deleted photos to ".old"
PRACCODE  DIM       10         * Practice Code
PRACOUNT  DIM       2          * Practice Counter
PRACNAME  DIM       80
PRACADD1  DIM       60
PRACADD2  DIM       60
PRACADD3  DIM       60
PRACADD4  DIM       60
PRACPOST  DIM       8
PRACPEML  DIM       80
PRACPTEL  DIM       20
PRACPFAX  DIM       20
PRACPROV  DIM       10
PRCARRAY  DIM       12[200]  * Practices displayed in search results *T0858712
PRCAREND  FORM      3        * Number of practices in PRCARRAY[]     *T0858712
PRCKEY12  DIM       12       * Practice key for  PRCARRAY[]          *T0858712
PMDUN001  DIM       6          * Doctor Code
PMDUN002  DIM       3          * Unit
PMDUN003  DIM       1          * Head of unit
SAVETITL  DIM       10
SAVEGNAM  DIM       35
SAVESNAM  DIM       35
SAVKEY6   DIM       6
SAVKEY10  DIM       10
SAVKEY12  DIM       12
SAVKEY21  DIM       21      
SNDXDONE  FORM      1          * Soundex shown indicator            *C-0299206
SPLTYFLG  FORM      1
SVKEY21A  DIM       21
SVKEY21B  DIM       21
SAVKEY25  DIM       25      
SAVKEY27  DIM       27      
SAVTEAM   DIM       5
STRTNAME  DIM       70
STATTYPE  DIM       1          * Statistics type
STATYEAR  DIM       4          * Statistics year
STATDTYP  DIM       1          * Statistic Type For Budgets
STATPERD  DIM       2          * Statistics period
STARTKEY  DIM       10         * Starting Key Practice Code
STARTKE1  DIM       2          * Starting Key Practice Count
UPCASHCP  DIM       1          * Uppercase HCP menu option
COUNT     FORM      1          * Counter Statistics offset year 
CMDLINE   DIM       127        * Command line instruction
CURRDATE  DIM       8          * Current Date 
CURRYEAR  DIM       4          * Current Year   
CPTDATE   DIM       8          **
TIME      DIM       5          * Last Update Time
TEMCOUNT  FORM      1
TESTPARA  DIM       16         * Last Update date and time
LINKPUB   DIM       1          * Allows for public access  
OFFSETYR  DIM       1          * Offset from year 1
UPDATEKY  DIM       16         * Update key(date & time of last update)
STATUS    DIM       50
WTYPE     DIM       2          * Field Type parameter
HCPFORM   FORM      1          * Field to hold PTCNHCPI value
SPECIALT  DIM       20         * HCP Specialty
HCPROLE   DIM       20         * HCP Role
ACTIVINH  INIT      "Active in Hospital"
ACTIVOUT  INIT      "Active outside Hospital"
NOTACTIV  INIT      "Not Active"
CATTZ     INIT      "TZ"
CATw0     INIT      "w0"
ROLEDESC  INIT      "Roles"
TEAMDESC  INIT      "Teams"
UNITDESC  INIT      "Units"
ZERO8     INIT      "0000    "         * for patfundf
Z1        INIT      "~"                                             *C-0299206

.
SEC1      FORM      "00001"    * Needed for doctors AUDIT File
ACTION    DIM       1          * Needed for doctors AUDIT File
ADD       DIM       2          * Needed for doctors AUDIT File
AMM       DIM       2          * Needed for doctors AUDIT File
AYY       DIM       2          * Needed for doctors AUDIT File
ACC       DIM       2          * Needed for doctors AUDIT File
OPERCODE  DIM       4          * Needed for doctors AUDIT File
.
DOCTC001  DIM       9          * Title
DOCTC002  DIM       25         * Given Name
DOCTC003  DIM       20         * Surname
DOCTC004  DIM       8          * D.O.B 
DOCTC005  DIM       10         * Provider Number 
DOCTC006  DIM       10         * Proscriber Number
DOCTC007  DIM       25         * Receptionist
DOCTC008  DIM       35         * Surgery Address Line 1               *C-125736
DOCTC009  DIM       35         * Surgery Address Line 2  
DOCTC010  DIM       35         * Surgery Address Line 3
DOCTC011  DIM       4          * Surgery Address Post Code
DOCTC012  DIM       20         * Surgery Telephone 
DOCTC013  DIM       12         * Surgey Fax Number
DOCTC014  DIM       35         * Home Address Line 1                  *C-125736
DOCTC015  DIM       35         * Home Address Line 2
DOCTC016  DIM       35         * Home Address Line 3
DOCTC017  DIM       4          * Home Address Post Code
DOCTC018  DIM       20         * Home Telephone
DOCTC019  DIM       25         * Associated Doctor 1
DOCTC020  DIM       25         * Associated Doctor 2
DOCTC021  DIM       3          * Primary Type 
DOCTC022  DIM       3          * Additional Doctor Type 1
DOCTC023  DIM       3          * Additional Doctor Type 2
DOCTC024  DIM       3          * Additional Doctor Type 3
DOCTC025  DIM       3          * Additional Doctor Type 4
DOCTC026  DIM       8          * Date First Accredited
DOCTC027  DIM       8          * Date of Last Accreditation
DOCTC028  DIM       3          * Accreditation Type
DOCTC029  FORM      1          * Doctor Status 
DOCTC030  DIM       3          * Supervision Level
DOCTC031  FORM      3          * HDP Doctor Code(written to old HCS file)
DOCTC032  DIM       14         * HDP DOCTOR Name 
DOCTC033  DIM       3          * HDP Doctor Service(DT * doctor type) 
DOCTC034  DIM       20         * Pager Number
DOCTC035  DIM       20         * Pager Telephone Number
DOCTC036  DIM       12         * Mobile Number
DOCTC037  DIM       10         * Medical Registration Board (MRB) Number
DOCTC038  FORM      2          * Years of Accreditation 
.
DOCTC039  DIM       35         * Doctor Surgery Address Line 4  DSADD4
DOCTC040  DIM       35         * Doctor Home Address Line 4     DHADD4
DOCTC041  DIM       40         * Payee Name
DOCTC042  DIM       8          * Last Update Date
DOCTC043  DIM       8          * Last Update Time
DOCTC044  DIM       80         * Doctor Surgery EMAIL
DOCTC045  DIM       25         * Associated Doctor 3
DOCTC046  DIM       25         * Associated Doctor 4
DOCTC047  DIM       25         * Associated Doctor 5
DOCTC048  DIM       80         * Doctor Home EMAIL Address 
DOCTC049  DIM       12         * Doctors Home Fax Number
DOCTC050  DIM       5          * General Ledger Creditor Code
DOCTC051  DIM       6          * WA HDP Doctor Code
DOCTC052  DIM       10         *                          Not used            
DOCTC053  DIM       3          * User Defined Field 1 (CAT R5)
DOCTC054  DIM       3          * User Defined Field 2 (CAT R6)
DOCTC055  DIM       3          * User Defined Field 3 (CAT R7)
DOCTC056  DIM       3          * User Defined Field 4 (CAT R8)
DOCTC057  DIM       3          * User Defimed Field 5 (CAT R9)
DOCTC058  DIM       6          * Insurance Code 
DOCTC059  DIM       20         * Insurance Policy Number
DOCTC060  DIM       8          * Insurance Date From
DOCTC061  DIM       8          * Insurance Date To
DOCTC062  DIM       20         * MPG Certificate Number
DOCTC063  DIM       8          * Reg. Date From
DOCTC064  DIM       8          * Reg. Date To
DOCTC065  DIM       8          * Visa Date
DOCTC066  DIM       3          * Doctors Preferred Communication (CAT CZ)
DOCTC067  DIM       30         * Preferred Name
DOCTC068  DIM       11         * ABN Number
DOCTC069  DIM       8          * Date Made Inactive
DOCTC070  DIM       8          * Date Made Active
DOCTC071  DIM       8          * Date Made Active Outside
DOCTC072  DIM       10         * Provider Number 2
DOCTC073  DIM       10         * Provider Number 3
DOCTC074  DIM       10         * Provider Number 4
DOCTC075  DIM       10         * Provider Number 5
DOCTC076  DIM       8          * Start Date
DOCTC077  DIM       8          * End Date
DOCTC078  DIM       1          * Auto Update
DOCTC079  DIM       1          * Exclude from Mailing List 
DOCTC080  DIM       8          * Accred. Expiry Date 
DOCTC081  DIM       3          * AH Pref Cont Method 1(Cat CZ)
DOCTC082  DIM       3          * AH Pref Cont Method 2(Cat CZ)
DOCTC083  DIM       3          * AH Pref Cont Method 3(Cat CZ)
.
LINKYEAR  DIM       4          * Year of Leave to Display
OPDLV001  DIM       6          * Doctor Code
OPDLV002  DIM       8          * From Date
OPDLV003  DIM       8          * To Date
OPDLV004  DIM       3          * Reason For Doctor Leave (DH)  
.
DOCSA001  FORM      4          * Admission Budget Period 1
DOCSA002  FORM      4          * Admission Budget Period 2
DOCSA003  FORM      4          * Admission Budget Period 3
DOCSA004  FORM      4          * Admission Budget Period 4
DOCSA005  FORM      4          * Admission Budget Period 5
DOCSA006  FORM      4          * Admission Budget Period 6
DOCSA007  FORM      4          * Admission Budget Period 7
DOCSA008  FORM      4          * Admission Budget Period 8
DOCSA009  FORM      4          * Admission Budget Period 9
DOCSA010  FORM      4          * Admission Budget Period 10
DOCSA011  FORM      4          * Admission Budget Period 11
DOCSA012  FORM      4          * Admission Budget Period 12
.
DOCSB001  FORM      4          * Bed Days Budget Period 1
DOCSB002  FORM      4          * Bed Days Budget Period 2
DOCSB003  FORM      4          * Bed Days Budget Period 3
DOCSB004  FORM      4          * Bed Days Budget Period 4
DOCSB005  FORM      4          * Bed Days Budget Period 5
DOCSB006  FORM      4          * Bed Days Budget Period 6
DOCSB007  FORM      4          * Bed Days Budget Period 7
DOCSB008  FORM      4          * Bed Days Budget Period 8
DOCSB009  FORM      4          * Bed Days Budget Period 9
DOCSB010  FORM      4          * Bed Days Budget Period 10
DOCSB011  FORM      4          * Bed Days Budget Period 11
DOCSB012  FORM      4          * Bed Days Budget Period 12
.
DOCSO001  FORM      4          * Operations Budget Period 1
DOCSO002  FORM      4          * Operations Budget Period 2
DOCSO003  FORM      4          * Operations Budget Period 3
DOCSO004  FORM      4          * Operations Budget Period 4
DOCSO005  FORM      4          * Operations Budget Period 5
DOCSO006  FORM      4          * Operations Budget Period 6
DOCSO007  FORM      4          * Operations Budget Period 7
DOCSO008  FORM      4          * Operations Budget Period 8
DOCSO009  FORM      4          * Operations Budget Period 9
DOCSO010  FORM      4          * Operations Budget Period 10
DOCSO011  FORM      4          * Operations Budget Period 11
DOCSO012  FORM      4          * Operations Budget Period 12
.
DOCSM001  FORM      4          * MBS Codes Budget Period 1
DOCSM002  FORM      4          * MBS Codes Budget Period 2
DOCSM003  FORM      4          * MBS Codes Budget Period 3
DOCSM004  FORM      4          * MBS Codes Budget Period 4
DOCSM005  FORM      4          * MBS Codes Budget Period 5
DOCSM006  FORM      4          * MBS Codes Budget Period 6
DOCSM007  FORM      4          * MBS Codes Budget Period 7
DOCSM008  FORM      4          * MBS Codes Budget Period 8
DOCSM009  FORM      4          * MBS Codes Budget Period 9
DOCSM010  FORM      4          * MBS Codes Budget Period 10
DOCSM011  FORM      4          * MBS Codes Budget Period 11
DOCSM012  FORM      4          * MBS Codes Budget Period 12
.
DTLET001  DIM       3          * Letter Number
DTLET002  DIM       70         * Line of letter
DTLET003  DIM       2          * Letter bottom margin
DTLET004  DIM       2          * Letter top margin
DTLET005  DIM       2          * Physical paper length (# of lines)
DTLET006  DIM       2          * Letter left margin
DTLET007  DIM       2          * Active
.
DTLEEND   FORM      2
SPECCHAR  INIT      "%"
DTLECOMM  DIM       70[99]                Comments
LETTNUMB  FORM      3
HCPTDESC  DIM       32          * HCP Type Description
HEADDESC  DIM       3           * Head of Unit description
HOSPCODE  DIM       3
ISWAHLTH  DIM       1
JAVFNAME  DIM       70
JAVGNAME  DIM       35
JAVSNAME  DIM       35
..JAVPNAME  DIM       80        * now in PMSHCGTD.INC
LPRACFLG  FORM      1
MENUFLAG  DIM       1        * Menu Type (Maintenance/Enquiry)
VALPTYPE  DIM       3
VALDALLH  FORM      1
WARCOUNT  FORM      2
WEBWARNG  DIM       127[10]
.
CHNGMADE  FORM      1           * flag if some field values have changed
.
CMDMOVE   INIT      "mv "
COMM127   DIM       127
COMNFLAG  FORM      1
COMMTEND  FORM      3
COMFILAF  FILE      ASCII, FIXED=128
COMFILNM  DIM       8
.
QUALIFIC  INIT      "Qualification"
OTHRHOSP  INIT      "Other Hospital"
SPECINTR  INIT      "Special Intrests"
HOLIDAYS  INIT      "Holidays"
GENRCOMM  INIT      "General Comments"  
JSONOUTF  FORM      1
.
DIM8      DIM       8
HOURA     DIM       2
HOURTM    DIM       2
MINTIME   DIM       2
MINA      DIM       2
SECTIME   DIM       2
SECA      DIM       2
XDATTIME  DIM       14     * Date/Time (ccyymmddhhmmss)
ZERO6     INIT      "000000"
.
.---------------------------------------------------------------------
PRGID     INIT      "PATWEB99"
VERSION   INIT      "V12.00.01"
PRGNAM    INIT      "Doctor Enquiries Template Server"
.---------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID & Set Para
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200,MAIN2300,MAIN2400,MAIN2500:
                             MAIN2600,MAIN2700,MAIN2800,MAIN2900,MAIN3000:
                             MAIN3100
.
          MOVE      "INVALID OPTION",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      GETDOC00
          GOTO      MAIN1000
.
MAIN1200  CALL      SRHDOC00
          GOTO      MAIN1000
.

MAIN1300  CALL      DOCCOD00    * Doctor Code Maintenance    
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      GETHCP00
          GOTO      MAIN1000 
.
MAIN1500  CALL      GPMHCG00    * Practice Code Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      GPMHCP00    * GP Detail Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      GPPGCL00    * Linked GP's to Practices Maintenance 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      GPPGPL00    * Linked Practices to a GP Maintenance 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1900  IF        OPFLGFIL = 1
            MOVE      "Doctor Leave Table Not Available!",WEBTITLE
            CALL      WEBERR00
            MOVE      ZERO,REPORTNO
            GOTO      MAIN1000
          ENDIF
          CALL      OPRDLV00    * Doctor Leave Maintenance 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2000  CALL      DOCBUD00    * Doctors Budgets Update/Add
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2100  CALL      DOCLET00
          GOTO      MAIN1000
.
MAIN2200  CALL      DOCUNI00    * Doctor/Unit Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2300  CALL      HCPCOM00    * HCP Comment Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2400  CALL      PHOTID00           * Photo ID Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2500  CALL      PMSTEM00           * Teams Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2600  CALL      HOSLNK00           * Linked Hospitals Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2700  CALL      PMSTMD00           * Doctor Unit/Teams Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2800  CALL      PMSRLD00           * Doctor Roles Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2900  CALL      PMSDRA00           * Doctor Arrangements Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3000  CALL      PMSSPE00           * HCP Specialty Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3100  CALL      PMSFPH00           * Fund Payee Id Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  CALL      WEBWAR00      * Display web warnings and redirect 
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " if (self.name==#"PopUpFrame#") {":
    "  document.getElementById('PopUpScreen').style.display=#"none#"; ":
                             "  history.go(-2);}":
                             " else { ":
                             "  history.go(-2);":
                             "  self.close(); }":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.
.------------------------------------------------------------
. WEBWAR00 - Display Warnings
.------------------------------------------------------------
WEBWAR00  CALL      OPENHTML
          BRANCH    EXIT,WEBWAR95
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#" ":
                             "src=#"../js/Standard.js#"></script>":
                             "<script type=#"text/javascript#" ":
                             "src=#"../js/Custom.js#"></script>":
                             "<script type=#"text/javascript#"> "
.
          COMPARE   ZERO,WARCOUNT
          GOTO      WEBWAR20 IF EQUAL
.
          MOVE      ONE,COUNTER
WEBWAR10  WRITE     HTMLFILE;"    alert(#"",WEBWARNG[COUNTER],"#");",012
          ADD       ONE,COUNTER
          COMPARE   COUNTER,WARCOUNT
          GOTO      WEBWAR20 IF LESS
          GOTO      WEBWAR10
.
WEBWAR20  WRITE     HTMLFILE;" if (self.name.match(/PopUpFrame/)) {":
                             "  redirectParentFrame(#"",REDIRECT,"#"); }":
                             " else {":
                             "  location.href=#"",REDIRECT,"#"}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      WEBWAR99
.
WEBWAR95  DISPLAY   "*** Fifo Not Found ***"
.
WEBWAR99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      APSMASA1,"apsmasaf"
          OPEN      CONTROLF,"controlf" 
          OPEN      PATCODE1,"patcodes" 
          OPEN      PATCODE2,"patcodes" 
          OPEN      PATDKIA1,"patdkiaf"
          OPEN      PATDKIA2,"patdkiaf"
          OPEN      PATDSTA1,"patdstat"
          OPEN      PATDSTA2,"patdstat"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATPERS1,"patperss"
          OPEN      PATHDOC1,"pathdoct"
          OPEN      PATIN1A1,"patin1af" 
          OPEN      PATDO1A1,"patdo1af" 
          OPEN      PMSDUNA1,"pmsdunaf" 
          OPEN      PATAD1A1,"patad1af"
          OPEN      PATDRGA1,"patdrgaf"
          OPEN      PATWR1A1,"patwr1af" 
          OPEN      PATWR1A3,"patwr1af" 
          OPEN      PATHSPA1,"pathspaf"
.
          OPEN      PMSFPHA1,"pmsfphaf"
          OPEN      PMSHCPA1,"pmshcpaf" 
          OPEN      PMSHCPA2,"pmshcpaf" 
          OPEN      PMSHCPA4,"pmshcpaf"                                * C244064
          OPEN      PMSHCGA1,"pmshcgaf" 
          OPEN      PMSHCLA1,"pmshclaf"
          OPEN      PMSHCLA2,"pmshclaf"
          OPEN      PMSHKIA1,"pmshkiaf"
          OPEN      PMSHKIA2,"pmshkiaf"
          OPEN      PMSPKIA1,"pmspkiaf"
          OPEN      PMSPKIA2,"pmspkiaf"
          OPEN      PATDLTA1,"patdltaf"
          OPEN      PATDLTA2,"patdltaf"
          OPEN      PMSTCOA1,"pmstcoaf"
          OPEN      PMSTCOA2,"pmstcoaf"
          OPEN      ALLCTMA2,"allctmaf"
          OPEN      PMSTEMA1,"pmstemaf"
          OPEN      PMSTMDA1,"pmstmdaf"
          OPEN      PMSDRAA1,"pmsdraaf"
          OPEN      PMSDRAA2,"pmsdraaf"
          OPEN      PMSSPEA1,"pmsspeaf"
          OPEN      PMSRLDA1,"pmsrldaf"
          OPEN      PMSDIVA2,"pmsdivaf"
.          OPEN      PMSIPLA1,"pmsiplaf"     * Polling table for DHS Medicare
.
          CALL      IBACLOCK
          PACK      CPTDATE,CCC,CYY,CMM,CDD
          REP       " 0",CPTDATE
          CALL      GPERD
          IF        EXIT=1
            MOVE      "Current Date Not Found In Period File. ",WEBTITLE
            CALL      WEBERR00   * Output Error
          ENDIF
.
          MOVE      DRGYR,FINYEAR
          MOVE      DRGNUM,FINMON
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OPRDLVA1,"oprdlvaf"
          TRAPCLR   IO
          MOVE      OVRCD,OPFLGFIL
.
          READ      CONTROLF,NINTY1;*179,CWEBROOT
          READ      CONTROLF,HUND03;*183,PTCNACGP,*184,PTCNGHCP
          READ      CONTROLF,HUND10;*246,PTCNMHCP
          READ      CONTROLF,HUND16;*223,PTCNDIVN
.          READ      CONTROLF,HUND20;*158,PTCNUNET
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND19;*247,PTCNHCPI,*248,PTCSXOFF       *C-0299206
          READ      CONTROLF,HUND25;*93,PTCNNSSI
          READ      CONTROLF,HUND25;*238,PTCNNRTD
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
.
          MATCH     SP70,PTCNNSSI
          IF        !@EQUAL
            MATCH     "0000000000",PTCNNSSI
            IF        !@EQUAL
              OPEN      PMSIDWA1,"pmsidwaf"      * EDWARD ISP Audit
            ENDIF
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
            OPEN      MLTHCPA1,"mlthcpaf"
            OPEN      MLTHCPA2,"mlthcpaf"
          ENDIF
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,COMFILNM
.
          READ      CONTROLF,TEN;*204,CAUDD
          BRANCH    CAUDD,INIT9999
          OPEN      PATPA1A1,"patpa1af"
.
INIT9999  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,F2
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,REPORTNO
          MOVE      SP70,STARTKEY
          MOVE      SP70,STARTKE1
          MOVE      SP70,TEMPLATE
          MOVE      SP70,DOCTCODE
          MOVE      SP70,GENPCODE
          MOVE      SP70,GENPPRAC
          MOVE      SP70,GENPPCNT
          MOVE      SP70,KEYWORDS 
          MOVE      ZERO,ACTVSTAT 
          MOVE      ZERO,HCPSSTAT 
          MOVE      ZERO,NORECORD 
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,DOCTSTAT
          MOVE      SP70,UPDTTYPE          
          MOVE      SP70,PHOTOPIC          
. Doctor File
          MOVE      SP70,DOCTC001  
          MOVE      SP70,DOCTC002 
          MOVE      SP70,DOCTC003  
          MOVE      SP70,DOCTC004 
          MOVE      SP70,DOCTC005 
          MOVE      SP70,DOCTC006 
          MOVE      SP70,DOCTC007 
          MOVE      SP70,DOCTC008 
          MOVE      SP70,DOCTC009 
          MOVE      SP70,DOCTC010 
          MOVE      SP70,DOCTC011 
          MOVE      SP70,DOCTC012 
          MOVE      SP70,DOCTC013 
          MOVE      SP70,DOCTC014 
          MOVE      SP70,DOCTC015  
          MOVE      SP70,DOCTC016  
          MOVE      SP70,DOCTC017 
          MOVE      SP70,DOCTC018 
          MOVE      SP70,DOCTC019 
          MOVE      SP70,DOCTC020 
          MOVE      SP70,DOCTC021
          MOVE      SP70,DOCTC022
          MOVE      SP70,DOCTC023 
          MOVE      SP70,DOCTC024 
          MOVE      SP70,DOCTC025 
          MOVE      SP70,DOCTC026 
          MOVE      SP70,DOCTC027 
          MOVE      SP70,DOCTC028 
          MOVE      ZERO,DOCTC029
          MOVE      SP70,DOCTC030
          MOVE      ZERO,DOCTC031 
          MOVE      SP70,DOCTC032 
          MOVE      SP70,DOCTC033 
          MOVE      ZERO,DOCTC034 
          MOVE      SP70,DOCTC035 
          MOVE      SP70,DOCTC036 
          MOVE      SP70,DOCTC037 
          MOVE      ZERO,DOCTC038
          MOVE      SP70,DOCTC039 
          MOVE      SP70,DOCTC040 
          MOVE      SP70,DOCTC041 
          MOVE      SP70,DOCTC042 
          MOVE      SP70,DOCTC043 
          MOVE      SP70,DOCTC044 
          MOVE      SP70,DOCTC045 
          MOVE      SP70,DOCTC046 
          MOVE      SP70,DOCTC047 
          MOVE      SP70,DOCTC048 
          MOVE      SP70,DOCTC049 
          MOVE      SP70,DOCTC050 
          MOVE      SP70,DOCTC051 
...       MOVE      SP70,DOCTC052                       not used
          MOVE      SP70,DOCTC053 
          MOVE      SP70,DOCTC054 
          MOVE      SP70,DOCTC055 
          MOVE      SP70,DOCTC056 
          MOVE      SP70,DOCTC057 
          MOVE      SP70,DOCTC058 
          MOVE      SP70,DOCTC059 
          MOVE      SP70,DOCTC060 
          MOVE      SP70,DOCTC061 
          MOVE      SP70,DOCTC062 
          MOVE      SP70,DOCTC063 
          MOVE      SP70,DOCTC064 
          MOVE      SP70,DOCTC065 
          MOVE      SP70,DOCTC066 
          MOVE      SP70,DOCTC067 
          MOVE      SP70,DOCTC068 
          MOVE      SP70,DOCTC069 
          MOVE      SP70,DOCTC070 
          MOVE      SP70,DOCTC071 
          MOVE      SP70,DOCTC072 
          MOVE      SP70,DOCTC073 
          MOVE      SP70,DOCTC074 
          MOVE      SP70,DOCTC075 
          MOVE      SP70,DOCTC076
          MOVE      SP70,DOCTC077
          MOVE      SP70,DOCTC078
          MOVE      SP70,DOCTC079
          MOVE      SP70,DOCTC080
          MOVE      SP70,DOCTC081
          MOVE      SP70,DOCTC082
          MOVE      SP70,DOCTC083
.
          MOVE      SP70,PMDUN001
          MOVE      SP70,PMDUN002
          MOVE      SP70,PMDUN003
.
          MOVE      SP70,TESTPARA
          MOVE      SP70,UPDATEKY 
          MOVE      SP70,LINKPUB
          MOVE      SP70,STATYEAR 
          MOVE      SP70,STATDTYP 
          MOVE      SP70,DISPTYPE
          MOVE      SP70,WTYPE
.
          MOVE      SP70,PMHCP001 
          MOVE      SP70,PMHCP002 
          MOVE      SP70,PMHCP003 
          MOVE      SP70,PMHCP004 
          MOVE      SP70,PMHCP005 
          MOVE      SP70,PMHCP006 
          MOVE      SP70,PMHCP007 
          MOVE      SP70,PMHCP008 
          MOVE      SP70,PMHCP009 
          MOVE      SP70,PMHCP010 
          MOVE      SP70,PMHCP011 
          MOVE      SP70,PMHCP012 
          MOVE      SP70,PMHCP013 
          MOVE      SP70,PMHCP014 
          MOVE      SP70,PMHCP015 
          MOVE      SP70,PMHCP016 
          MOVE      SP70,PMHCP017 
          MOVE      SP70,PMHCP018 
          MOVE      SP70,PMHCP019 
          MOVE      SP70,PMHCP020 
          MOVE      SP70,PMHCP021 
          MOVE      SP70,PMHCP022 
          MOVE      SP70,PMHCP023 
          MOVE      SP70,PMHCP024 
          MOVE      SP70,PMHCP025 
          MOVE      SP70,PMHCP026 
          MOVE      SP70,PMHCP027 
          MOVE      SP70,PMHCP028 
          MOVE      SP70,PMHCP029 
          MOVE      SP70,PMHCP030 
          MOVE      SP70,PMHCP031 
          MOVE      SP70,PMHCP032 
          MOVE      SP70,PMHCP033 
          MOVE      SP70,PMHCP034 
          MOVE      SP70,PMHCP035 
          MOVE      SP70,PMHCP036 
          MOVE      SP70,PMHCP037 
          MOVE      SP70,PMHCP038 
          MOVE      SP70,PMHCP039 
          MOVE      SP70,PMHCP040 
          MOVE      SP70,PMHCP041 
          MOVE      SP70,PMHCP042 
          MOVE      SP70,PMHCP043 
          MOVE      SP70,PMHCP044 
          MOVE      SP70,PMHCP045 
          MOVE      SP70,PMHCP046 
          MOVE      SP70,PMHCP047 
          MOVE      SP70,PMHCP048 
          MOVE      SP70,PMHCP049 
          MOVE      SP70,PMHCP050 
          MOVE      SP70,PMHCP051 
          MOVE      SP70,PMHCP052 
          MOVE      SP70,PMHCP053 
          MOVE      SP70,PMHCP054 
          MOVE      SP70,PMHCP055 
          MOVE      SP70,PMHCP056 
          MOVE      SP70,PMHCP057 
          MOVE      SP70,PMHCP058 
          MOVE      SP70,PMHCP059 
          MOVE      SP70,PMHCP060 
          MOVE      SP70,PMHCP061 
          MOVE      SP70,PMHCP062 
          MOVE      SP70,PMHCP063 
          MOVE      SP70,PMHCP064 
          MOVE      SP70,PMHCP065 
          MOVE      SP70,PMHCP066 
          MOVE      SP70,PMHCP067 
          MOVE      SP70,PMHCP068 
          MOVE      SP70,PMHCP069 
          MOVE      SP70,PMHCP070 
          MOVE      SP70,PMHCP071 
          MOVE      SP70,PMHCP072 
          MOVE      SP70,PMHCP073 
          MOVE      SP70,PMHCP074 
          MOVE      SP70,PMHCP075 
          MOVE      SP70,PMHCP076 
          MOVE      SP70,PMHCP077 
          MOVE      SP70,PMHCP078 
          MOVE      SP70,PMHCP079 
          MOVE      SP70,PMHCP080 
          MOVE      SP70,PMHCP081 
          MOVE      SP70,PMHCP082 
          MOVE      SP70,PMHCP083 
          MOVE      SP70,PMHCP084 
          MOVE      SP70,PMHCP085 
          MOVE      SP70,PMHCP086 
          MOVE      SP70,PMHCP087 
          MOVE      SP70,PMHCP088 
          MOVE      SP70,PMHCP089 
          MOVE      SP70,PMHCP090 
          MOVE      SP70,PMHCP091 
          MOVE      SP70,PMHCP092 
          MOVE      SP70,PMHCP093 
          MOVE      SP70,PMHCP094 
          MOVE      SP70,PMHCP095 
          MOVE      SP70,PMHCP096 
          MOVE      SP70,PMHCP097 
          MOVE      Z70,PMHCP098 
          MOVE      Z70,PMHCP099 
          MOVE      Z70,PMHCP100 
          MOVE      SP70,PMHCP101 
          MOVE      SP70,PMHCP102 
          MOVE      SP70,PMHCP103 
          MOVE      ZERO,PMHCP104 
          MOVE      SP70,PMHCP106
.
          MOVE      SP70,PMHCL001 
          MOVE      SP70,PMHCL002 
          MOVE      SP70,PMHCL003 
          MOVE      SP70,PMHCL004 
          MOVE      SP70,PMHCL005 
          MOVE      SP70,PMHCL006 
          MOVE      SP70,PMHCL007 
          MOVE      SP70,PMHCL008 
          MOVE      SP70,PMHCL009 
          MOVE      SP70,PMHCL010 
          MOVE      SP70,PMHCL011 
          MOVE      SP70,PMHCL012 
          MOVE      Z70,PMHCL013 
          MOVE      Z70,PMHCL014 
          MOVE      Z70,PMHCL015 
          MOVE      SP70,PMHCL016 
          MOVE      SP70,PMHCL017 
          MOVE      SP70,PMHCL018 
.
          CALL      CPPHCG00 
.
          MOVE      SP70,LINKYEAR 
          MOVE      SP70,OPDLV001 
          MOVE      SP70,OPDLV002 
          MOVE      SP70,OPDLV003 
          MOVE      SP70,OPDLV004 
.
          MOVE      ZERO,DOCSA001
          MOVE      ZERO,DOCSA002
          MOVE      ZERO,DOCSA003 
          MOVE      ZERO,DOCSA004
          MOVE      ZERO,DOCSA005
          MOVE      ZERO,DOCSA006
          MOVE      ZERO,DOCSA007
          MOVE      ZERO,DOCSA008
          MOVE      ZERO,DOCSA009
          MOVE      ZERO,DOCSA010
          MOVE      ZERO,DOCSA011
          MOVE      ZERO,DOCSA012
          MOVE      ZERO,DOCSB001
          MOVE      ZERO,DOCSB002
          MOVE      ZERO,DOCSB003 
          MOVE      ZERO,DOCSB004
          MOVE      ZERO,DOCSB005
          MOVE      ZERO,DOCSB006
          MOVE      ZERO,DOCSB007
          MOVE      ZERO,DOCSB008
          MOVE      ZERO,DOCSB009
          MOVE      ZERO,DOCSB010
          MOVE      ZERO,DOCSB011
          MOVE      ZERO,DOCSB012
          MOVE      ZERO,DOCSO001
          MOVE      ZERO,DOCSO002
          MOVE      ZERO,DOCSO003 
          MOVE      ZERO,DOCSO004
          MOVE      ZERO,DOCSO005
          MOVE      ZERO,DOCSO006
          MOVE      ZERO,DOCSO007
          MOVE      ZERO,DOCSO008
          MOVE      ZERO,DOCSO009
          MOVE      ZERO,DOCSO010
          MOVE      ZERO,DOCSO011
          MOVE      ZERO,DOCSO012
          MOVE      ZERO,DOCSM001
          MOVE      ZERO,DOCSM002
          MOVE      ZERO,DOCSM003 
          MOVE      ZERO,DOCSM004
          MOVE      ZERO,DOCSM005
          MOVE      ZERO,DOCSM006
          MOVE      ZERO,DOCSM007
          MOVE      ZERO,DOCSM008
          MOVE      ZERO,DOCSM009
          MOVE      ZERO,DOCSM010
          MOVE      ZERO,DOCSM011
          MOVE      ZERO,DOCSM012
.
          MOVE      Z70,DTLET001
          MOVE      Z70,DTLET002
          MOVE      Z70,DTLET003
          MOVE      Z70,DTLET004
          MOVE      Z70,DTLET005
          MOVE      Z70,DTLET006
          MOVE      Z70,DTLET007
.
          MOVE      ZERO,DTLEEND
          MOVE      SP70,HCPCOMTY
          MOVE      SP70,HCPLEVEL
          MOVE      SP70,HCPSTATE
          MOVE      SP70,HOSPCODE
          MOVE      SP70,ISWAHLTH
          MOVE      SP70,MULTHOSP

          MOVE      SP70,VALPTYPE
          MOVE      ZERO,VALDALLH
          MOVE      ZERO,CHNGMADE
.
          MOVE      ONE,COMNFLAG
          MOVE      SP70,RETNFLAG
.
          MOVE      ONE,LHOSPCNT
          WHILE     LHOSPCNT <= 99
            MOVE      SP70,LHOSPARR[LHOSPCNT]
            ADD       ONE,LHOSPCNT
          DO
.
          MOVE      ZERO,LHOSPCNT
          MOVE      ZERO,WARCOUNT
          MOVE      SP70,NODOCTOR
          MOVE      SP70,FILTACTV
          MOVE      SP70,FILTUNIT
.
          CALL      CPMLHC00
          CALL      CPPMTE00
          CALL      CPPMTM00
          CALL      CPPMRL00
          CALL      CPPMDR00
          CALL      CPPMSE00
.
          MOVE      SP70,UPCASHCP
          MOVE      SP70,MENUFLAG
.
          CALL      CLRFPH00
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startke1=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKE1
            PACK      STARTKE1,STARTKE1,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "doctcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DOCTCODE
            PACK      DOCTCODE,DOCTCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hcpcomty=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HCPCOMTY
            PACK      HCPCOMTY,HCPCOMTY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hcpcomnt",QRYNAME
          IF        @EQUAL
            CALL      GETCOM00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hcplevel=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HCPLEVEL
            PACK      HCPLEVEL,HCPLEVEL,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hcpstate=",QRYNAME
          IF        @EQUAL
            PACK      HCPSTATE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "genpcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,GENPCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "genpprac",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,GENPPRAC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "genppcnt",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,GENPPCNT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "doctstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DOCTSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keywords=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYWORDS
            REP       "~'",KEYWORDS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "actvstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ACTVSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hcpsstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HCPSSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updateky=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATEKY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "statyear=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STATYEAR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "linkyear=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LINKYEAR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "doctc",QRYNAME
          IF        @EQUAL
            CALL      SDOCT000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "pmhcg",QRYNAME
          IF        @EQUAL
            CALL      SPPHCG00
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "pmhcp",QRYNAME
          IF        @EQUAL
            CALL      SPPHC000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "pmhcl",QRYNAME
          IF        @EQUAL
            CALL      SPPMHL00
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "opdlv",QRYNAME
          IF        @EQUAL
            CALL      STDLV000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "statdtyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STATDTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "docsa",QRYNAME
          IF        @EQUAL
            CALL      SDOCA000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "docsb",QRYNAME
          IF        @EQUAL
            CALL      SDOCB000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "docso",QRYNAME
          IF        @EQUAL
            CALL      SDOCO000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "docsm",QRYNAME
          IF        @EQUAL
            CALL      SDOCM000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "dtlet",QRYNAME
          IF        @EQUAL
            CALL      STLET000
          ENDIF
.
          MATCH     "dtlecomm=",QRYNAME
          IF        @EQUAL
            CALL      GLTEXT00
          ENDIF
.
          MATCH     "pmdun001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMDUN001
            PACK      PMDUN001,PMDUN001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmdun002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMDUN002
            PACK      PMDUN002,PMDUN002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmdun003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMDUN003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "retnflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,RETNFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "photopic=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PHOTOPIC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lhosparr=",QRYNAME
          IF        @EQUAL
            COMPARE   "99",LHOSPCNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,LHOSPCNT
            PACK      LHOSPARR[LHOSPCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HOSPCODE
            PACK      HOSPCODE,HOSPCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "iswahlth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ISWAHLTH
            PACK      ISWAHLTH,ISWAHLTH,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multhosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MULTHOSP
            PACK      MULTHOSP,MULTHOSP,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valptype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALPTYPE
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "valdallh=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDALLH
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "mlhcp",QRYNAME
          IF        @EQUAL
            CALL      SPMLC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmtem",QRYNAME
          IF        @EQUAL
            CALL      SPPMT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmtmd",QRYNAME
          IF        @EQUAL
            CALL      SPPMU000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmrld",QRYNAME
          IF        @EQUAL
            CALL      SPPMO000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmdra",QRYNAME
          IF        @EQUAL
            CALL      SPPMA000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nodoctor=",QRYNAME
          IF        @EQUAL
            PACK      NODOCTOR,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "chngmade=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CHNGMADE
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "pmspe",QRYNAME
          IF        @EQUAL
            CALL      SPPSE000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtactv=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTACTV
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "filtunit=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTUNIT
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "upcashcp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPCASHCP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "menuflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MENUFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmfph",QRYNAME
          IF        @EQUAL
            CALL      SPMFPH00
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 1 - Doctor Details
.-------------------------------------------------------------------------------
SDOCT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SDOCT001,SDOCT002,SDOCT003,SDOCT004,SDOCT005:
                       SDOCT006,SDOCT007,SDOCT008,SDOCT009,SDOCT010:
                       SDOCT011,SDOCT012,SDOCT013,SDOCT014,SDOCT015:
                       SDOCT016,SDOCT017,SDOCT018,SDOCT019,SDOCT020:
                       SDOCT021,SDOCT022,SDOCT023,SDOCT024,SDOCT025:
                       SDOCT026,SDOCT027,SDOCT028,SDOCT029,SDOCT030:
                       SDOCT031,SDOCT032,SDOCT033,SDOCT034,SDOCT035:
                       SDOCT036,SDOCT037,SDOCT038,SDOCT039,SDOCT040:
                       SDOCT041,SDOCT042,SDOCT043,SDOCT044,SDOCT045:
                       SDOCT046,SDOCT047,SDOCT048,SDOCT049,SDOCT050:
                       SDOCT051,SDOCT052,SDOCT053,SDOCT054,SDOCT055:
                       SDOCT056,SDOCT057,SDOCT058,SDOCT059,SDOCT060:
                       SDOCT061,SDOCT062,SDOCT063,SDOCT064,SDOCT065:
                       SDOCT066,SDOCT067,SDOCT068,SDOCT069,SDOCT070:
                       SDOCT071,SDOCT072,SDOCT073,SDOCT074,SDOCT075:
                       SDOCT076,SDOCT077,SDOCT078,SDOCT079,SDOCT080:
                       SDOCT081,SDOCT082,SDOCT083
.
          MOVE      ONE,EXIT
          GOTO      SDOCT999
.
SDOCT001  MOVE      QRYDATA,DOCTC001
          GOTO      SDOCT900
SDOCT002  MOVE      QRYDATA,DOCTC002
          GOTO      SDOCT900
SDOCT003  MOVE      QRYDATA,DOCTC003
          GOTO      SDOCT900
SDOCT004  MOVE      QRYDATA,KEY11     * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70        
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC004,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC004
          ENDIF 
          GOTO      SDOCT900
.
SDOCT005  MOVE      QRYDATA,DOCTC005
          GOTO      SDOCT900
SDOCT006  MOVE      QRYDATA,DOCTC006
          GOTO      SDOCT900
SDOCT007  MOVE      QRYDATA,DOCTC007
          GOTO      SDOCT900
SDOCT008  MOVE      QRYDATA,DOCTC008
          GOTO      SDOCT900
SDOCT009  MOVE      QRYDATA,DOCTC009
          GOTO      SDOCT900
SDOCT010  MOVE      QRYDATA,DOCTC010
          GOTO      SDOCT900
SDOCT011  MOVE      QRYDATA,DOCTC011
          GOTO      SDOCT900
SDOCT012  MOVE      QRYDATA,DOCTC012
          GOTO      SDOCT900
SDOCT013  MOVE      QRYDATA,DOCTC013
          GOTO      SDOCT900
SDOCT014  MOVE      QRYDATA,DOCTC014
          GOTO      SDOCT900
SDOCT015  MOVE      QRYDATA,DOCTC015
          GOTO      SDOCT900
SDOCT016  MOVE      QRYDATA,DOCTC016
          GOTO      SDOCT900
SDOCT017  MOVE      QRYDATA,DOCTC017
          GOTO      SDOCT900
SDOCT018  MOVE      QRYDATA,DOCTC018
          GOTO      SDOCT900
SDOCT019  MOVE      QRYDATA,DOCTC019
          GOTO      SDOCT900
SDOCT020  MOVE      QRYDATA,DOCTC020
          GOTO      SDOCT900
SDOCT021  MOVE      QRYDATA,DOCTC021
          GOTO      SDOCT900
SDOCT022  MOVE      QRYDATA,DOCTC022
          GOTO      SDOCT900
SDOCT023  MOVE      QRYDATA,DOCTC023
          GOTO      SDOCT900
SDOCT024  MOVE      QRYDATA,DOCTC024
          GOTO      SDOCT900
SDOCT025  MOVE      QRYDATA,DOCTC025
          GOTO      SDOCT900
SDOCT026  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00 
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC026,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC026
          ENDIF 
          GOTO      SDOCT900
.
SDOCT027  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00 
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC027,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC027
          ENDIF 
          GOTO      SDOCT900
.
SDOCT028  MOVE      QRYDATA,DOCTC028
          GOTO      SDOCT900
SDOCT029  MOVE      QRYDATA,DOCTC029
          GOTO      SDOCT900
SDOCT030  MOVE      QRYDATA,DOCTC030
          GOTO      SDOCT900
SDOCT031  MOVE      QRYDATA,DOCTC031
          GOTO      SDOCT900
SDOCT032  MOVE      QRYDATA,DOCTC032
          GOTO      SDOCT900
SDOCT033  MOVE      QRYDATA,DOCTC033
          GOTO      SDOCT900
SDOCT034  MOVE      QRYDATA,DOCTC034
          GOTO      SDOCT900
SDOCT035  MOVE      QRYDATA,DOCTC035
          GOTO      SDOCT900
SDOCT036  MOVE      QRYDATA,DOCTC036
          GOTO      SDOCT900
SDOCT037  MOVE      QRYDATA,DOCTC037
          GOTO      SDOCT900
SDOCT038  MOVE      QRYDATA,DOCTC038
          GOTO      SDOCT900
SDOCT039  MOVE      QRYDATA,DOCTC039
          GOTO      SDOCT900
SDOCT040  MOVE      QRYDATA,DOCTC040
          GOTO      SDOCT900
SDOCT041  MOVE      QRYDATA,DOCTC041
          GOTO      SDOCT900
SDOCT042  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC042,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC042
          ENDIF
          GOTO      SDOCT900
SDOCT043  MOVE      QRYDATA,DOCTC043
          GOTO      SDOCT900
SDOCT044  MOVE      QRYDATA,DOCTC044
          GOTO      SDOCT900
SDOCT045  MOVE      QRYDATA,DOCTC045
          GOTO      SDOCT900
SDOCT046  MOVE      QRYDATA,DOCTC046
          GOTO      SDOCT900
SDOCT047  MOVE      QRYDATA,DOCTC047 
          GOTO      SDOCT900
SDOCT048  MOVE      QRYDATA,DOCTC048
          GOTO      SDOCT900
SDOCT049  MOVE      QRYDATA,DOCTC049
          GOTO      SDOCT900
SDOCT050  MOVE      QRYDATA,DOCTC050
          GOTO      SDOCT900
SDOCT051  MOVE      QRYDATA,DOCTC051
          GOTO      SDOCT900
SDOCT052  MOVE      QRYDATA,DOCTC052            * not used
          GOTO      SDOCT900
SDOCT053  MOVE      QRYDATA,DOCTC053
          GOTO      SDOCT900
SDOCT054  MOVE      QRYDATA,DOCTC054
          GOTO      SDOCT900
SDOCT055  MOVE      QRYDATA,DOCTC055
          GOTO      SDOCT900
SDOCT056  MOVE      QRYDATA,DOCTC056
          GOTO      SDOCT900
SDOCT057  MOVE      QRYDATA,DOCTC057
          GOTO      SDOCT900
SDOCT058  MOVE      QRYDATA,DOCTC058
          GOTO      SDOCT900
SDOCT059  MOVE      QRYDATA,DOCTC059
          GOTO      SDOCT900
SDOCT060  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC060,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC060
          ENDIF
          GOTO      SDOCT900
SDOCT061  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC061,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC061
          ENDIF
          GOTO      SDOCT900
SDOCT062  MOVE      QRYDATA,DOCTC062
          GOTO      SDOCT900
SDOCT063  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC063,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC063
          ENDIF
          GOTO      SDOCT900
SDOCT064  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC064,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC064
          ENDIF
          GOTO      SDOCT900
SDOCT065  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC065,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC065
          ENDIF
          GOTO      SDOCT900
SDOCT066  MOVE      QRYDATA,DOCTC066
          GOTO      SDOCT900
SDOCT067  MOVE      QRYDATA,DOCTC067
          GOTO      SDOCT900
SDOCT068  MOVE      QRYDATA,DOCTC068
          GOTO      SDOCT900
SDOCT069  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC069,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC069
          ENDIF
          GOTO      SDOCT900
SDOCT070  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC070,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC070
          ENDIF
          GOTO      SDOCT900
SDOCT071  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC071,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC071
          ENDIF
          GOTO      SDOCT900
.
SDOCT072  MOVE      QRYDATA,DOCTC072
          GOTO      SDOCT900
SDOCT073  MOVE      QRYDATA,DOCTC073
          GOTO      SDOCT900
SDOCT074  MOVE      QRYDATA,DOCTC074
          GOTO      SDOCT900
SDOCT075  MOVE      QRYDATA,DOCTC075
          GOTO      SDOCT900
SDOCT076  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC076,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC076
          ENDIF
          GOTO      SDOCT900
.
SDOCT077  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC077,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC077
          ENDIF
          GOTO      SDOCT900
.
SDOCT078  MOVE      QRYDATA,DOCTC078
          GOTO      SDOCT900
.
SDOCT079  MOVE      QRYDATA,DOCTC079
          GOTO      SDOCT900
.
SDOCT080  MOVE      QRYDATA,KEY11      * Date format changed back to 0000,00,00
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      DOCTC080,CCENT,CYEAR,CMON,CDAY
            REP       " 0",DOCTC080
          ENDIF
          GOTO      SDOCT900
.
SDOCT081  MOVE      QRYDATA,DOCTC081
          GOTO      SDOCT900
.
SDOCT082  MOVE      QRYDATA,DOCTC082
          GOTO      SDOCT900
.
SDOCT083  MOVE      QRYDATA,DOCTC083
          GOTO      SDOCT900
.
SDOCT900  GOTO      SDOCT999
.
SDOCT999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for - Doctor Admission Statistic Details
.-------------------------------------------------------------------------------
SDOCA000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SDOCA001,SDOCA002,SDOCA003,SDOCA004,SDOCA005:
                       SDOCA006,SDOCA007,SDOCA008,SDOCA009,SDOCA010:
                       SDOCA011,SDOCA012
.
          MOVE      ONE,EXIT
          GOTO      SDOCA999
.
SDOCA001  MOVE      QRYDATA,DOCSA001
          GOTO      SDOCA999
.
SDOCA002  MOVE      QRYDATA,DOCSA002
          GOTO      SDOCA999
.
SDOCA003  MOVE      QRYDATA,DOCSA003
          GOTO      SDOCA999
.
SDOCA004  MOVE      QRYDATA,DOCSA004
          GOTO      SDOCA999
.
SDOCA005  MOVE      QRYDATA,DOCSA005
          GOTO      SDOCA999
.
SDOCA006  MOVE      QRYDATA,DOCSA006
          GOTO      SDOCA999
.
SDOCA007  MOVE      QRYDATA,DOCSA007
          GOTO      SDOCA999
.
SDOCA008  MOVE      QRYDATA,DOCSA008
          GOTO      SDOCA999
.
SDOCA009  MOVE      QRYDATA,DOCSA009
          GOTO      SDOCA999
.
SDOCA010  MOVE      QRYDATA,DOCSA010
          GOTO      SDOCA999
.
SDOCA011  MOVE      QRYDATA,DOCSA011
          GOTO      SDOCA999
.
SDOCA012  MOVE      QRYDATA,DOCSA012
          GOTO      SDOCA999
.
SDOCA999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for - Doctor Bed Day Statistic Details
.-------------------------------------------------------------------------------
SDOCB000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SDOCB001,SDOCB002,SDOCB003,SDOCB004,SDOCB005:
                       SDOCB006,SDOCB007,SDOCB008,SDOCB009,SDOCB010:
                       SDOCB011,SDOCB012
.
          MOVE      ONE,EXIT
          GOTO      SDOCB999
.
SDOCB001  MOVE      QRYDATA,DOCSB001
          GOTO      SDOCB999
.
SDOCB002  MOVE      QRYDATA,DOCSB002
          GOTO      SDOCB999
.
SDOCB003  MOVE      QRYDATA,DOCSB003
          GOTO      SDOCB999
.
SDOCB004  MOVE      QRYDATA,DOCSB004
          GOTO      SDOCB999
.
SDOCB005  MOVE      QRYDATA,DOCSB005
          GOTO      SDOCB999
.
SDOCB006  MOVE      QRYDATA,DOCSB006
          GOTO      SDOCB999
.
SDOCB007  MOVE      QRYDATA,DOCSB007
          GOTO      SDOCB999
.
SDOCB008  MOVE      QRYDATA,DOCSB008
          GOTO      SDOCB999
.
SDOCB009  MOVE      QRYDATA,DOCSB009
          GOTO      SDOCB999
.
SDOCB010  MOVE      QRYDATA,DOCSB010
          GOTO      SDOCB999
.
SDOCB011  MOVE      QRYDATA,DOCSB011
          GOTO      SDOCB999
.
SDOCB012  MOVE      QRYDATA,DOCSB012
          GOTO      SDOCB999
.
SDOCB999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for - Doctor Operation Statistic Details
.-------------------------------------------------------------------------------
SDOCO000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SDOCO001,SDOCO002,SDOCO003,SDOCO004,SDOCO005:
                       SDOCO006,SDOCO007,SDOCO008,SDOCO009,SDOCO010:
                       SDOCO011,SDOCO012
.
          MOVE      ONE,EXIT
          GOTO      SDOCO999
.
SDOCO001  MOVE      QRYDATA,DOCSO001
          GOTO      SDOCO999
.
SDOCO002  MOVE      QRYDATA,DOCSO002
          GOTO      SDOCO999
.
SDOCO003  MOVE      QRYDATA,DOCSO003
          GOTO      SDOCO999
.
SDOCO004  MOVE      QRYDATA,DOCSO004
          GOTO      SDOCO999
.
SDOCO005  MOVE      QRYDATA,DOCSO005
          GOTO      SDOCO999
.
SDOCO006  MOVE      QRYDATA,DOCSO006
          GOTO      SDOCO999
.
SDOCO007  MOVE      QRYDATA,DOCSO007
          GOTO      SDOCO999
.
SDOCO008  MOVE      QRYDATA,DOCSO008
          GOTO      SDOCO999
.
SDOCO009  MOVE      QRYDATA,DOCSO009
          GOTO      SDOCO999
.
SDOCO010  MOVE      QRYDATA,DOCSO010
          GOTO      SDOCO999
.
SDOCO011  MOVE      QRYDATA,DOCSO011
          GOTO      SDOCO999
.
SDOCO012  MOVE      QRYDATA,DOCSO012
          GOTO      SDOCO999
.
SDOCO999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for - Doctor MBS Code Statistic Details
.-------------------------------------------------------------------------------
SDOCM000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SDOCM001,SDOCM002,SDOCM003,SDOCM004,SDOCM005:
                       SDOCM006,SDOCM007,SDOCM008,SDOCM009,SDOCM010:
                       SDOCM011,SDOCM012
.
          MOVE      ONE,EXIT
          GOTO      SDOCM999
.
SDOCM001  MOVE      QRYDATA,DOCSM001
          GOTO      SDOCM999
.
SDOCM002  MOVE      QRYDATA,DOCSM002
          GOTO      SDOCM999
.
SDOCM003  MOVE      QRYDATA,DOCSM003
          GOTO      SDOCM999
.
SDOCM004  MOVE      QRYDATA,DOCSM004
          GOTO      SDOCM999
.
SDOCM005  MOVE      QRYDATA,DOCSM005
          GOTO      SDOCM999
.
SDOCM006  MOVE      QRYDATA,DOCSM006
          GOTO      SDOCM999
.
SDOCM007  MOVE      QRYDATA,DOCSM007
          GOTO      SDOCM999
.
SDOCM008  MOVE      QRYDATA,DOCSM008
          GOTO      SDOCM999
.
SDOCM009  MOVE      QRYDATA,DOCSM009
          GOTO      SDOCM999
.
SDOCM010  MOVE      QRYDATA,DOCSM010
          GOTO      SDOCM999
.
SDOCM011  MOVE      QRYDATA,DOCSM011
          GOTO      SDOCM999
.
SDOCM012  MOVE      QRYDATA,DOCSM012
          GOTO      SDOCM999
.
SDOCM999  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Option 9: Doctors Leave Maintenance
.-------------------------------------------------------------------------------
STDLV000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STDLV001,STDLV002,STDLV003,STDLV004
.
          MOVE      ONE,EXIT
          GOTO      STDLV999
.
STDLV001  MOVE      QRYDATA,OPDLV001
          SQUEEZE   OPDLV001
          PACK      OPDLV001,OPDLV001,SP70 
          GOTO      STDLV999
.
STDLV002  PACK      QRYDATA,QRYDATA,SP30
          UNPACK    QRYDATA,KEY8,KEY3 * Check for formatted or unformatted date
          MATCH     SP70,KEY3
          IF        @EQUAL
            MOVE      QRYDATA,OPDLV002 * Do not change date format = (CCYYMMDD)
          ELSE
            MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
            PACK      KEY11,KEY11,SP70
            MATCH     SP70,KEY11
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      OPDLV002,CCENT,CYEAR,CMON,CDAY
              REP       " 0",OPDLV002
            ENDIF
          ENDIF
          GOTO      STDLV999
.
STDLV003  MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          MATCH     SP70,KEY11
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      OPDLV003,CCENT,CYEAR,CMON,CDAY
            REP       " 0",OPDLV003
          ENDIF
          GOTO      STDLV999
.
STDLV004  MOVE      QRYDATA,OPDLV004
          GOTO      STDLV999
.
STDLV999  RETURN
.------------------------------------------------------------
. Display Doctor Details
.------------------------------------------------------------
GETDOC00  MOVE      DOCTCODE,KEY6
          CALL      RDDOCT1  
          IF        OVRCD=1
            MOVE      WBSEDOC,DOCTCODE
            MOVE      DOCTCODE,KEY6
            CALL      RDDOCT1  
            IF        OVRCD=1
              MOVE      "INVALID DOCTOR",WEBTITLE
              CALL      WEBERR00   * Output Error
              GOTO      GETDOC99
            ENDIF
          ENDIF
.
          PACK      KEY16,DCODE,SP70
          CALL      RSPMHCP4
          CALL      RKPMHCP4
          BRANCH    OVRCD,GETDOC70               * Doctor Code does not exist
.
          MATCH     DCODE,PMHCLDOC               * Valid HCP found 
          GOTO      GETDOC80 IF EQUAL      
.
GETDOC70  CALL      CLPMSHCP                     * Clear HCP file vars
.
GETDOC80  MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          CLEAR     WEBTITLE
          APPEND    DOCFNAME,WEBTITLE
          APPEND    " (Doctor Information)",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GETDOC99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
GETDOC99  RETURN
.------------------------------------------------------------
.Doctors Search Routine
.------------------------------------------------------------
SRHDOC00  MOVE      "Doctor Search Engine",WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SRHDOC99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
SRHDOC99  RETURN
.-------------------------------------------------------------
. Doctor Code Search
.-------------------------------------------------------------
DOCCOD00  CALL      INITDA00        * initialise file data
          MATCH     SP70,UPDTTYPE
          GOTO      DOCCOD40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      DOCCOD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      DOCCOD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      DOCCOD30 IF EQUAL
.
          GOTO      DOCCOD93
.
.         ************ ADD FORMACTION ***********
.
DOCCOD10  MATCH     "1",PTCNGHCP          * Auto Generate Next Doctor/HCP Code
          GOTO      DOCCOD15 IF EQUAL
.
          PACK      KEY6,DOCTCODE         * Check if record is in doctor file
          CALL      RDDOCT1
          COMPARE   ZERO,OVRCD
          GOTO      DOCCOD94 IF EQUAL 
.
          PACK      KEY10,DOCTCODE,SP70   * Check if record is in HCP file
          CALL      RDPMHCP1
          COMPARE   ZERO,OVRCD
          GOTO      DOCCOD94 IF EQUAL 
.
DOCCOD15  CALL      CHKINF00        * Checks mandatory fields reports errors 
          BRANCH    EXIT,DOCCOD99 
.
          CALL      HCSMOD00        * Check if HDP Doctor Code is mandatory 
          BRANCH    EXIT,DOCCOD90   * IF yes, write HDP details 
.
          MATCH     "1",PTCNGHCP    * Auto Generate Next Doctor/HCP Code
          IF        @EQUAL
            CALL      GENC0000      * Generate Next Doctor/HCP Code
            PACK      DOCTCODE,PTCNNHCP,SP70
          ENDIF
.
          CALL      DOCSAV00        * Copies cgi variables to file variables  
          MOVE      SP70,PTDOHOSS
          PACK      KEY6,DOCTCODE  
          CALL      WRDOCT1         * New data written  
          CALL      DSCR0000        * Create blank patdstat records
          PROC      PATDKIUP        * Updates keyword index
.
          CALL      HCPSAV00        * Move doctor file variables to HCP file
          MOVE      SP70,PMHCHOSS
          PACK      KEY10,DOCTCODE,SP70
          CALL      WRPMHCP1        * New data written to HCP file
          PROC      PMSHKIUP        * Updates keyword index
          MOVE      "A",PMHCACTN    * action flag for DGCLIM02
          MOVE      ONE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIM02        * send HL7 message "Doctor Details"
.
          MATCH     "5",NEXTPAGE
          IF        @EQUAL
            MOVE      DTITL,FMTTITLE
            MOVE      DGNAME,FMTGNAME
            MOVE      DSNAME,FMTSNAME
            CALL      DOCNM000      * Display alert with generated doctor code
            CLEAR     WEBTITLE
            APPEND    "(",WEBTITLE
            APPEND    DCODE,WEBTITLE
            APPEND    ") - ",WEBTITLE
            APPEND    DOCFNAME,WEBTITLE
            APPEND    " Successfully Added",WEBTITLE
            RESET     WEBTITLE
            ADD       ONE,WARCOUNT
            MOVE      WEBTITLE,WEBWARNG[WARCOUNT]
          ENDIF
.
          BRANCH    CAUDD,DOCCOD99  * 1 = Audits not required  
          MOVE      "A",ACTION      * ACTION variable in DOC AUDIT FILE
          CALL      ACTSAV00        * save variables before writing to AUD FILE
          CALL      WRDAUD          * write to doctor audit file 
.
          MOVE      ZERO,EXIT       
          GOTO      DOCCOD99 
.
.         ************ UPDATE FORMACTION **********
.
DOCCOD20  PACK      KEY6,DOCTCODE
          CALL      RDDOCT1
          BRANCH    OVRCD,DOCCOD91    * Doctor Code does not exist 
.
          CALL      UPDKEY00        * Checks UPDATEKY report error if already 
          BRANCH    EXIT,DOCCOD92   * updated
.
          CALL      CHKINF00        * Checks mandatory fields reports errors 
          BRANCH    EXIT,DOCCOD99 
.
          CALL      HCSMOD00        * Check if HDP Doctor Code is mandatory 
          BRANCH    EXIT,DOCCOD90   * IF yes, write HDP details 
.                    
          CALL      DOCSAV00        * Copies cgi variables to file variables  
          MOVE      DOCTCODE,KEY6   * pack key before update 
          CALL      UPDOCT1 
          PROC      PATDKIUP        * Updates keyword index
.          
          PACK      KEY10,DOCTCODE,SP70  * Check if record is in HCP file
          CALL      RDPMHCP1
          BRANCH    OVRCD,DOCCOD25
.
          CALL      HCPUPD00             * Move common doctor fields to HCP file
          CALL      UPPMHCP1             * update HCP file
          PROC      PMSHKIUP             * Updates keyword index
          MOVE      "U",PMHCACTN    * action flag for DGCLIM02
          MOVE      TWO,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIM02        * send HL7 message "Doctor Details"
.
DOCCOD25  BRANCH    CAUDD,DOCCOD99  * 1 = Audits not required  
          MOVE      "B",ACTION      * Before changes 
          CALL      WRDAUD          * write to doctor details 
          CALL      ACTSAV00        * save variables before writing to AUD FILE
          MOVE      "C",ACTION      * ACTION variable after changes 
          CALL      WRDAUD          * write to doctor audit file 
.
          MOVE      ZERO,EXIT     
          GOTO      DOCCOD99 
.
.         ************ DELETE FORMACTION **********
.
DOCCOD30  PACK      KEY6,DOCTCODE
          CALL      RDDOCT1
          BRANCH    OVRCD,DOCCOD91    * Doctor Code does not exist 
.
..          PACK      KEY3,DHCSCOD   * Delete HCS Code and Details  
..          CALL      DEHDOC1             
.
          CALL      DELPER00         * Deletes Doctor Personal Table and Doctor 
.                                    * Statistics Table 
.
          PACK      KEY6,DOCTCODE 
          CALL      DEDOCT1          * Delete doctor from maintenance table
          PROC      PATDKIUP         * Updates keyword index
.
. 
.          PACK      KEY10,DOCTCODE,SP70   * Check if record is in HCP file
.          CALL      RDPMHCP1              * Delete it if it is
.          BRANCH    OVRCD,DOCCOD35
.
.          PACK      KEY10,DOCTCODE,SP70
.          CALL      DEPMHCP1              * Delete HCP doctor record
.          PROC      PMSHKIUP              * Updates keyword index
.
DOCCOD35  BRANCH    CAUDD,DOCCOD99   * 1 = Audits not required 
          MOVE      "D",ACTION       * ACTION variable after delete 
          CALL      WRDAUD
.
          MOVE      ZERO,EXIT       
          GOTO      DOCCOD99 
.
.         ************ DISPLAY FORMACTION **********
.
DOCCOD40  RESET     DOCTCODE
          MATCH     SP70,DOCTCODE     * If no Doctor Code is set then must be 
          GOTO      DOCCOD41 IF EQUAL * a new Doctor Window 
.
.    * View,Update,Delete: check for a valid Doctor Code first 
.
          PACK      KEY6,DOCTCODE
          CALL      RDDOCT1
          BRANCH    OVRCD,DOCCOD91    * Doctor Code does not exist
.
          PACK      KEY3,DHCSCOD     * Read HCS Doctor File
          CALL      RDHDOC1            
          BRANCH    OVRCD,DOCCOD41
.
DOCCOD41  MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          CLEAR     WEBTITLE
          APPEND    DOCFNAME,WEBTITLE
          APPEND    " (Doctor Codes)",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,DOCCOD99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      DOCCOD99
.
DOCCOD90  CALL      WEBERR00   * Display error from HDP Doctor Check 
          MOVE      ONE,EXIT
          GOTO      DOCCOD99         
.
DOCCOD91  MOVE      "Invalid Doctor Code",WEBTITLE 
          CALL      WEBERR00   
          MOVE      ONE,EXIT
          GOTO      DOCCOD99         
.
DOCCOD92  CLEAR     WEBTITLE
          APPEND    "Invalid Update Key ",WEBTITLE
          APPEND    KEY6,WEBTITLE
          RESET     WEBTITLE
          CALL      WINALT00     * Display Alert & Close Window  (no refresh)
          MOVE      ONE,EXIT
          GOTO      DOCCOD99
.
DOCCOD93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DOCCOD99
.
DOCCOD94  MOVE      "Doctor / HCP code record exists ",WEBTITLE 
          CALL      WEBERR00   
          MOVE      ONE,EXIT
          GOTO      DOCCOD99         
.
DOCCOD99  RETURN
.------------------------------------------------------------
. Subroutine to initialise data
.------------------------------------------------------------
INITDA00  CALL      IBACLOCK      * todays date used for a new Doctor code
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CTIMEIS,TIME
.
          MOVE      SP30,DCODE
          MOVE      SP30,DTITL
          MOVE      SP30,DRTYPE
          MOVE      SP30,DGNAME
          MOVE      SP30,DSNAME
          MOVE      SP30,DRNAME
          MOVE      SP35,DSADD1                                       *C-125736
          MOVE      SP35,DSADD2
          MOVE      SP35,DSADD3
          MOVE      SP35,DSADD4
          MOVE      SP30,DSPOST
          MOVE      SP70,PTDOSEML
          MOVE      SP30,DTELES
          MOVE      SP30,DTELEP
          MOVE      ZERO,DPAGER
          MOVE      SP30,DASSOC1
          MOVE      SP30,DASSOC2
          MOVE      SP30,DASSOC3
          MOVE      SP30,DASSOC4
          MOVE      SP30,DASSOC5
          MOVE      SP30,DPROV
          MOVE      SP30,DTELEH
          MOVE      SP35,DHADD1                                       *C-125736
          MOVE      SP35,DHADD2
          MOVE      SP35,DHADD3
          MOVE      SP35,DHADD4
          MOVE      SP30,DHPOST
          MOVE      SP70,PTDOHEML
.
          MOVE      SP30,DAFIRST
          MOVE      SP30,DALAST
          MOVE      ZERO,DAYEARS
          MOVE      SP30,DACCRED
          MOVE      SP30,DRTYPE2
          MOVE      SP30,DRTYPE3
          MOVE      SP30,DRTYPE4
          MOVE      SP30,DRTYPE5
          MOVE      SP70,DFSPARE
          MOVE      SP30,DBIRTH
          MOVE      ZERO,DHCSCOD
          MOVE      SP30,DALEVEL
          MOVE      ZERO,DRSTAT
          MOVE      SP30,PTDOFAXN
          MOVE      SP70,PTDOHFAX
          MOVE      SP30,PTDOMOBL
          MOVE      SP5,PTDOGLCC 
          MOVE      SP70,PTDOWHDP
          MOVE      SP20,PTDOMREG 
          MOVE      SP10,PTDONHSN
.
          MOVE      SP70,DLUPDDTE 
          MOVE      SP70,DLUPDTME 
          MOVE      SP70,PTDOUDF1 
          MOVE      SP70,PTDOUDF2 
          MOVE      SP70,PTDOUDF3 
          MOVE      SP70,PTDOUDF4 
          MOVE      SP70,PTDOUDF5 
          MOVE      SP70,PTDOINSC 
          MOVE      SP70,PTDOINSN 
          MOVE      SP70,PTDOINSF 
          MOVE      SP70,PTDOINST 
          MOVE      SP70,PTDOREGN 
          MOVE      SP70,PTDOREGF 
          MOVE      SP70,PTDOREGT 
          MOVE      SP70,PTDOVISA 
          MOVE      SP70,PTDOCOMT 
          MOVE      SP70,PTDOPREF
          MOVE      SP70,PTDOABNN
          MOVE      SP70,PTDODINA
          MOVE      SP70,PTDODACT
          MOVE      SP70,PTDODACO
          MOVE      SP70,PTDOPRO2
          MOVE      SP70,PTDOPRO3
          MOVE      SP70,PTDOPRO4
          MOVE      SP70,PTDOPRO5
          MOVE      SP70,PTDOSDAT
          MOVE      SP70,PTDOEDAT
          MOVE      SP70,PTDOAUPD
          MOVE      SP70,PTDOEXML
          MOVE      SP70,DASPARE 
.
          MOVE      ZERO,HDCODE
          MOVE      SP30,HDNAME
          MOVE      SP30,HDSERV
          MOVE      SP30,DHDCODE
.
          MOVE      SP30,DLUPDDTE 
          MOVE      SP30,DLUPDTME
.
INITDA99  RETURN
.----------------------------------------------------------
. Checks mandatory fields: Title, Given Name, Surname, 
.                          Primary Type
.----------------------------------------------------------
CHKINF00  MATCH     "1",PTCNGHCP        * Auto Generate Doctor/HCP Codes
          GOTO      CHKINF10 IF EQUAL
.
          RESET     DOCTCODE          
          MATCH     SP70,DOCTCODE       * Checks Doctor Code
          GOTO      CHKINF93 IF EQUAL    
.
CHKINF10  RESET     DOCTC001           
          MATCH     SP70,DOCTC001       * Checks Title 
          GOTO      CHKINF94 IF EQUAL    
.
          RESET     DOCTC003
          MATCH     SP70,DOCTC003       * Checks Surname
          GOTO      CHKINF96 IF EQUAL
.
          RESET     DOCTC002
          MATCH     SP70,DOCTC002       * Checks Given name
          GOTO      CHKINF95 IF EQUAL
.    
          RESET     DOCTC021 
.  
          IF        IBCNMHOS<>1
            MATCH     SP70,DOCTC021       * Checks Primary Type
            GOTO      CHKINF97 IF EQUAL
          ENDIF
.
          GOTO      CHKINF99
.
CHKINF93  CLEAR     WEBTITLE
          MOVE      "Doctor Code cannot be blank!",WEBTITLE
          GOTO      CHKINF98
.
CHKINF94  CLEAR     WEBTITLE
          MOVE      "Doctor title is mandatory!",WEBTITLE
          GOTO      CHKINF98
.
CHKINF95  CLEAR     WEBTITLE
          MOVE      "Doctor Given name is mandatory!",WEBTITLE
          GOTO      CHKINF98
.
CHKINF96  CLEAR     WEBTITLE
          MOVE      "Doctor Surname is mandatory!",WEBTITLE
          GOTO      CHKINF98 
.
CHKINF97  CLEAR     WEBTITLE
          MOVE      "Primary Specialty is mandatory!",WEBTITLE
.
CHKINF98  RESET     WEBTITLE
          CALL      WEBERR00          * Display Alert & No refresh
          MOVE      ONE,EXIT          * Set to display error message 
.
CHKINF99  RETURN
.-----------------------------------------------------------
. Copies cgi-paramters to file variables before 
. a write or an update   
.-----------------------------------------------------------
DOCSAV00  MOVE      DOCTCODE,DCODE 
          MOVE      DOCTC001,DTITL
          MOVE      DOCTC021,DRTYPE
          MOVE      DOCTC002,DGNAME   
          MOVE      DOCTC003,DSNAME   
          MOVE      DOCTC007,DRNAME
          MOVE      DOCTC008,DSADD1
          MOVE      DOCTC009,DSADD2
          MOVE      DOCTC010,DSADD3
          MOVE      DOCTC039,DSADD4
          MOVE      DOCTC011,DSPOST
          MOVE      DOCTC012,DTELES
          MOVE      DOCTC035,DTELEP
          MOVE      DOCTC034,DPAGER
          MOVE      DOCTC005,DPROV
          MOVE      DOCTC018,DTELEH
          MOVE      DOCTC014,DHADD1
          MOVE      DOCTC015,DHADD2
          MOVE      DOCTC016,DHADD3
          MOVE      DOCTC040,DHADD4
          MOVE      DOCTC017,DHPOST
          MOVE      DOCTC019,DASSOC1
          MOVE      DOCTC020,DASSOC2
          MOVE      DOCTC026,DAFIRST
          MOVE      DOCTC027,DALAST
          MOVE      DOCTC028,DACCRED
          MOVE      DOCTC038,DAYEARS
          MOVE      DOCTC022,DRTYPE2
          MOVE      DOCTC023,DRTYPE3
          MOVE      DOCTC024,DRTYPE4
          MOVE      DOCTC025,DRTYPE5
          MOVE      DOCTC006,PTDONHSN         
          MOVE      DOCTC004,DBIRTH
          MOVE      DOCTC030,DALEVEL
          MOVE      DOCTC031,DHCSCOD
          MOVE      DOCTC029,DRSTAT

...       MOVE      DOCTC041,PTDOPAYN           * No longer used
          MOVE      DOCTC044,PTDOSEML
          MOVE      DOCTC045,DASSOC3
          MOVE      DOCTC046,DASSOC4
          MOVE      DOCTC047,DASSOC5
          MOVE      DOCTC048,PTDOHEML
          MOVE      DOCTC049,PTDOHFAX
          MOVE      DOCTC050,PTDOGLCC
          MOVE      DOCTC051,PTDOWHDP
          MOVE      DOCTC037,PTDOMREG
...       MOVE      DOCTC052,PTDOMREG           * not used
          MOVE      DOCTC053,PTDOUDF1
          MOVE      DOCTC054,PTDOUDF2
          MOVE      DOCTC055,PTDOUDF3
          MOVE      DOCTC056,PTDOUDF4
          MOVE      DOCTC057,PTDOUDF5
          MOVE      DOCTC058,PTDOINSC
          MOVE      DOCTC059,PTDOINSN
          MOVE      DOCTC060,PTDOINSF
          MOVE      DOCTC061,PTDOINST	
          MOVE      DOCTC062,PTDOREGN
          MOVE      DOCTC063,PTDOREGF
          MOVE      DOCTC064,PTDOREGT
          MOVE      DOCTC065,PTDOVISA
          MOVE      DOCTC066,PTDOCOMT
          MOVE      DOCTC067,PTDOPREF
          MOVE      DOCTC068,PTDOABNN
          MOVE      DOCTC069,PTDODINA
          MOVE      DOCTC070,PTDODACT
          MOVE      DOCTC071,PTDODACO
          MOVE      DOCTC072,PTDOPRO2
          MOVE      DOCTC073,PTDOPRO3
          MOVE      DOCTC074,PTDOPRO4
          MOVE      DOCTC075,PTDOPRO5
          MOVE      DOCTC076,PTDOSDAT
          MOVE      DOCTC077,PTDOEDAT
          MOVE      DOCTC078,PTDOAUPD
          MOVE      DOCTC079,PTDOEXML
          MOVE      DOCTC080,PTDODEAC
          MOVE      DOCTC081,PTDOAHC1
          MOVE      DOCTC082,PTDOAHC2
          MOVE      DOCTC083,PTDOAHC3
.
          MOVE      DOCTC036,PTDOMOBL
          MOVE      DOCTC013,PTDOFAXN
..
          MOVE      CURRDATE,DLUPDDTE
          MOVE      TIME,DLUPDTME
.
DOCSAV99  RETURN 
.-----------------------------------------------------------
. Copies cgi-paramters to file variables before 
. a write or an update   
.-----------------------------------------------------------
DOCSSV00  LOAD      PTDSBADM,FORM2,DOCSA001,DOCSA002,DOCSA003,DOCSA004:
                                   DOCSA005,DOCSA006,DOCSA007,DOCSA008:
                                   DOCSA009,DOCSA010,DOCSA011,DOCSA012
.
          LOAD      PTDSBBED,FORM2,DOCSB001,DOCSB002,DOCSB003,DOCSB004:
                                   DOCSB005,DOCSB006,DOCSB007,DOCSB008:
                                   DOCSB009,DOCSB010,DOCSB011,DOCSB012
.
          LOAD      PTDSBOPR,FORM2,DOCSO001,DOCSO002,DOCSO003,DOCSO004:
                                   DOCSO005,DOCSO006,DOCSO007,DOCSO008:
                                   DOCSO009,DOCSO010,DOCSO011,DOCSO012
.
          LOAD      PTDSBMBS,FORM2,DOCSM001,DOCSM002,DOCSM003,DOCSM004:
                                   DOCSM005,DOCSM006,DOCSM007,DOCSM008:
                                   DOCSM009,DOCSM010,DOCSM011,DOCSM012
.
DOCSSV99  RETURN
.------------------------------------------------------------
. Checks if HDP doctor code is mandatory
. If HDP Doctor Code is entered, it must also have HDP service
.------------------------------------------------------------ 
HCSMOD00  MOVE      ZERO,EXIT
          RESET     DOCTC033    
          COMPARE   ONE,PTHCSDOC             * H.C.S. Doctor mandatory ?
          GOTO      HCSMOD10 IF NOT EQUAL    * 0 = No, 1 = Yes  
.
          COMPARE   ZERO,DOCTC031
          GOTO      HCSMOD90 IF EQUAL
.
          MOVE      DOCTC031,DOCCODE
          COMPARE   TWO,DOCCODE
          GOTO      HCSMOD92  IF LESS
.
          COMPARE   "201",DOCCODE
          GOTO      HCSMOD94  IF NOT LESS
.
HCSMOD10  COMPARE   ZERO,DOCTC031
          GOTO      HCSMOD99 IF EQUAL
.
          MATCH     SP70,DOCTC033  * HDP Doctor Code must have a HDP Service 
          GOTO      HCSMOD96 IF EQUAL
.
          MOVE      DOCTC031,HDCODE  
          MOVE      DOCTC032,HDNAME
          MOVE      DOCTC033,HDSERV
.
          MATCH     "U",UPDTTYPE      * If not Update must be Add 
          GOTO      HCSMOD11 IF NOT EQUAL 
          COMPARE   ZERO,DHCSCOD           * Check if field is blank 
          GOTO      HCSMOD11 IF EQUAL      * Field blank cannot be an Update
.
          PACK      KEY3,DHCSCOD           * Update HCS details
          CALL      UPHDOC1
          GOTO      HCSMOD99               * Find out what happens here
.
HCSMOD11  PACK      KEY3,DOCTC031          * Check if code exist
          CALL      RDAHDOC1
          BRANCH    OVRCD,HCSMOD12
          GOTO      HCSMOD98               * 0= Not Found, 1= Found      
.
HCSMOD12  PACK      KEY3,DOCTC031
          CALL      WRHDOC1                * write new code and details
.
.         Update H.C.S. Audit file for Doctors Table
.
          COMPARE   ONE,CHCS               * 1 = Collecting H.C.S Data 
          GOTO      HCSMOD99 IF NOT EQUAL  * 2 = No 
.
......          MOVE      HDCODE,PTTDCODE
......          UNPACK    CDATE,XDAY,SLASH,XMON,SLASH,XYEAR
......          PACK      PTTDDATE,CCC,XYEAR,XMON,XDAY
......          MOVE      SP10,PTTDSPAR
.
.         Only the first change per day is posted
.
......          PACK      KEY11 WITH PTTDDATE,PTTDCODE
......          CALL      RDATDCA1
......          COMPARE   ZERO,OVRCD
......          GOTO      HCSMOD99 IF EQUAL
......          CALL      WRTDCA1
.
          MOVE      ZERO,EXIT
          GOTO      HCSMOD99
.
HCSMOD90  CLEAR     WEBTITLE
          MOVE      "HDP Doctor Code Mandatory",WEBTITLE
          MOVE      ONE,EXIT
          GOTO      HCSMOD99
.
HCSMOD92  CLEAR     WEBTITLE
          APPEND    "HDP Doctor Code must be greater ",WEBTITLE
          APPEND    "than 2 and less than 201 ",WEBTITLE 
          RESET     WEBTITLE
          MOVE      ONE,EXIT
          GOTO      HCSMOD99
.
HCSMOD94  CLEAR     WEBTITLE
          MOVE      "HDP Doctor Code must be > 2 and < 201 ",WEBTITLE
          MOVE      ONE,EXIT
          GOTO      HCSMOD99
.
HCSMOD96  CLEAR     WEBTITLE
          MOVE      "HDP Doctor Code must have a HDP Service ",WEBTITLE
          MOVE      ONE,EXIT
          GOTO      HCSMOD99         
.
HCSMOD98  CLEAR     WEBTITLE 
          MOVE      "HDP Doctor Code exists ",WEBTITLE
          MOVE      ONE,EXIT
.
HCSMOD99  RETURN
.-------------------------------------------------------------------
.Subroutine to save all variables before writing to PATAUD
.-------------------------------------------------------------------
ACTSAV00  MOVE      DCODE,SDCODE
          MOVE      DTITL,SDTITL
          MOVE      DGNAME,SDGNAME
          MOVE      DSNAME,SDSNAME
          MOVE      DRTYPE,SDRTYPE
          MOVE      DRNAME,SDRNAME
          MOVE      DSADD1,SDSADD1
          MOVE      DSADD2,SDSADD2
          MOVE      DSADD3,SDSADD3
          MOVE      DSADD4,SDSADD4
          MOVE      DSPOST,SDSPOST
          MOVE      DTELES,SDTELES
          MOVE      DTELEP,SDTELEP
          MOVE      DPAGER,SDPAGER
          MOVE      DASSOC1,SDASSOC1
          MOVE      DASSOC2,SDASSOC2
          MOVE      DASSOC3,SDASSOC3
          MOVE      DASSOC4,SDASSOC4
          MOVE      DASSOC5,SDASSOC5
          MOVE      DPROV,SDPROV
          MOVE      DTELEH,SDTELEH
          MOVE      DHADD1,SDHADD1
          MOVE      DHADD2,SDHADD2
          MOVE      DHADD3,SDHADD3
          MOVE      DHADD4,SDHADD4
          MOVE      DHPOST,SDHPOST
          MOVE      DAFIRST,SDAFIRST
          MOVE      DALAST,SDALAST
          MOVE      DAYEARS,SDAYEARS
          MOVE      DACCRED,SDACCRED
          MOVE      DRTYPE2,SDRTYPE2
          MOVE      DRTYPE3,SDRTYPE3
          MOVE      DRTYPE4,SDRTYPE4
          MOVE      DRTYPE5,SDRTYPE5
          MOVE      PTDONHSN,SDONHSN
          MOVE      DBIRTH,SDBIRTH
          MOVE      DHCSCOD,SDHCSCOD
          MOVE      DALEVEL,SDALEVEL
          MOVE      DRSTAT,SDRSTAT
          MOVE      PTDOFAXN,SDOFAXN
          MOVE      PTDOFAXN,SDOHFAX
          MOVE      PTDOMOBL,SDOMOBL
          MOVE      PTDOGLCC,SDOGLCC
          MOVE      PTDOWHDP,SDOWHDP
          MOVE      PTDOMREG,SDOMREG
.
          MOVE      DLUPDDTE,SUPDDTE
          MOVE      DLUPDTME,SUPDTME
          MOVE      PTDOUDF1,SDOUDF1
          MOVE      PTDOUDF2,SDOUDF2
          MOVE      PTDOUDF3,SDOUDF3
          MOVE      PTDOUDF4,SDOUDF4
          MOVE      PTDOUDF5,SDOUDF5
          MOVE      PTDOINSC,SDOINSC
          MOVE      PTDOINSN,SDOINSN
          MOVE      PTDOINSF,SDOINSF
          MOVE      PTDOINST,SDOINST
          MOVE      PTDOREGN,SDOREGN
          MOVE      PTDOREGF,SDOREGF
          MOVE      PTDOREGT,SDOREGT
          MOVE      PTDOVISA,SDOVISA
          MOVE      PTDOCOMT,SDOCOMT
          MOVE      PTDOPREF,SDOPREF
          MOVE      PTDOABNN,SDOABNN
          MOVE      PTDODINA,SDODINA
          MOVE      PTDODACT,SDODACT
          MOVE      PTDODACO,SDODACO
          MOVE      PTDOPRO2,SDOPRO2
          MOVE      PTDOPRO3,SDOPRO3
          MOVE      PTDOPRO4,SDOPRO4
          MOVE      PTDOPRO5,SDOPRO5
.
ACTSAV99  RETURN
.--------------------------------------------------------------
. Checks to see if Doctor is already being updated
.--------------------------------------------------------------
UPDKEY00  MOVE      ZERO,EXIT
          PACK      TESTPARA,DLUPDDTE,DLUPDTME  * checks if code already
          MATCH     UPDATEKY,TESTPARA           * updated
          GOTO      UPDKEY99 IF EQUAL
.
          MOVE      ONE,EXIT      * Doctor Code is currently being updated     
.
UPDKEY99  RETURN
.--------------------------------------------------------------
. Deletes doctor personal table and doctor statistics table
.--------------------------------------------------------------
DELPER00 PACK      CPTDATE,CCC,CYY,CMM,CDD  * Check for current date in  
         REP       " 0",CPTDATE             * Period file
         CALL      GPERD           * Call to subroutine in PATCOMN3.PBL    
         BRANCH    EXIT,DELPER99   * Date does not exist deletes not performed 
.
         MOVE      ANSA,DIM1                 * Delete Attending doctor stats
         CALL      DSDE0000
.
         MOVE      ANSR,DIM1                 * Delete Referring doctor stats
         CALL      DSDE0000
.
         MOVE      FINYEAR,PTDSYEAR          * Restore PTDSYEAR
.
DELPER20 PACK      KEY12,DCODE,SP6
         CALL      RDSPERS1
         CALL      RDKPERS1
         BRANCH    OVRCD,DELPER99
         MATCH     DCODE,PECODE
         GOTO      DELPER99 IF NOT EQUAL
         PACK      KEY12,PECODE,PETYPE,PEPAGE,PELINE
         CALL      DEPERS1
         GOTO      DELPER20 

DELPER99  RETURN
.------------------------------------------------------------
. HCP Practice Codes : Display,Add,Update,Delete
.------------------------------------------------------------
GPMHCG00  RESET     UPDTTYPE 
          MATCH     SP1,UPDTTYPE
          GOTO      GPMHCG40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      GPMHCG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      GPMHCG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      GPMHCG30 IF EQUAL
.
          GOTO      GPMHCG93
.
.         ************ ADD FORMACTION ***********
.
GPMHCG10  CALL      CHKHCG00      * Checks mandatory fields
          BRANCH    EXIT,GPMHCG99
          RESET     PMHCG001
          PACK      KEY12,PMHCG001,PMHCG002,SP70
          CALL      RDPMHCG1
          COMPARE   ZERO,OVRCD
          GOTO      GPMHCG92 IF EQUAL
.
          CALL      CLPMSHCG
          CALL      SISG0000                 * Save EDWARD ISP Audit vars
          CALL      MVPHCG00      * Moves input variables to file variables
.
          CALL      IBACLOCK
          PACK      PMHGCDTE,CCC,CYY,CMM,CDD
          REP       " 0",PMHGCDTE            * date record created
          MOVE      CTIMEIS,PMHGCTIM         * time record created
          MOVE      USERID,PMHGWEBC          * web user created
.
          PACK      PMHGLUPD,CCC,CYY,CMM,CDD
          REP       " 0",PMHGLUPD            * date record updated
          MOVE      CTIMEIS,PMHGLUPT         * time record updated
          MOVE      USERID,PMHGWEBU          * web user updated
.
          PACK      KEY12,PMHCG001,PMHCG002,SP70
          CALL      WRPMHCG1       * Writes away the data
.
          CALL      WISG0000      * Write EDWARD ISP Audit vars
.
          PROC      PMSPKIUP       * practice keyword
.
          MATCH     "1",ISWAHLTH
          IF        @EQUAL
            CALL      ADHCP000
          ENDIF   
.
          MOVE      ZERO,EXIT
          GOTO      GPMHCG99
.
.         ************ UPDATE FORMACTION **********
.
GPMHCG20  PACK      KEY12,PMHCG001,PMHCG002,SP70
          CALL      RDPMHCG1
          BRANCH    OVRCD,GPMHCG91
          CALL      CHKHCG00      * Checks mandatory fields
          BRANCH    EXIT,GPMHCG99
.
          PACK      KEY12,PMHCG001,PMHCG002,SP70
          CALL      RLPMHCG1      * Readlock
.
          CALL      SISG0000                 * Save EDWARD ISP Audit vars
.
          CALL      MVPHCG00      * Moves input variables to file variables
.
          CALL      IBACLOCK
          PACK      PMHGLUPD,CCC,CYY,CMM,CDD
          REP       " 0",PMHGLUPD            * date record updated
          MOVE      CTIMEIS,PMHGLUPT         * time record updated
          MOVE      USERID,PMHGWEBU          * web user updated
.
          CALL      UPPMHCG1      * Writes away the data
          CALL      UUPMHCG1      * Unlock
.
          CALL      WISG0000      * Write EDWARD ISP Audit vars
          PROC      PMSPKIUP      * practice keyword
.
          MATCH     "1",ISWAHLTH
          IF        @EQUAL
            CALL      UDHCP000
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      GPMHCG99
.
.         ************ DELETE FORMACTION **********
.
GPMHCG30  PACK      KEY12,PMHCG001,PMHCG002,SP70
          CALL      RDPMHCG1
          BRANCH    OVRCD,GPMHCG91
          CALL      DEPMHCG1
          PROC      PMSPKIUP      * practice keyword
.
          PACK      KEY20,PMHCG001,SP70
          CALL      RSPMHCL2
GPMHCG31  CALL      RKPMHCL2
          BRANCH    OVRCD,GPMHCG32 
.
          MATCH     PMHCG001,PMHLHCPR
          GOTO      GPMHCG32 IF NOT EQUAL
.
          PACK      KEY20,PMHLHCPC,PMHLHCPR,SP70           
          CALL      DEPMHCL1
          PROC      PMSHKIUP
          GOTO      GPMHCG31
.
GPMHCG32  MOVE      ZERO,EXIT
          GOTO      GPMHCG99
.
.         ************ DISPLAY FORMACTION **********
.
GPMHCG40  PACK      KEY12,PMHCG001,PMHCG002,SP70
          CALL      RDPMHCG1
          IF        OVRCD=1
            CALL      CLPMSHCG    * Clear all the file variables
          ENDIF
          MOVE      PMHGPRAC,PRACCODE
          MOVE      PMHGCNTR,PRACOUNT
.
          CLEAR     WEBTITLE
          MOVE      "HCP Practice Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GPMHCG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      GPMHCG99
.
GPMHCG91  MOVE      "HCP Practice Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPMHCG99
.
GPMHCG92  MOVE      "HCP Practice Code record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPMHCG99
.
GPMHCG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPMHCG99
.
GPMHCG99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKHCG00  RESET     PMHCG001
          MATCH     SP70,PMHCG001
          GOTO      CHKHCG90 IF EQUAL
.
          COMPARE   ZERO,PMHCG002
          GOTO      CHKHCG91 IF EQUAL
.
          RESET     PMHCG004
          MATCH     SP70,PMHCG004
          IF        @EQUAL
            GOTO      CHKHCG92
          ELSE
            PACK      KEY10,PMHCG004,SP70
            CALL      RDPMHCP1
            BRANCH    OVRCD,CHKHCG94
          ENDIF 
.
          RESET     PMHCG005
          MATCH     SP70,PMHCG005
          GOTO      CHKHCG93 IF EQUAL
.
.   Check if Linked HCP are all inactive before deactivating HCP practice
          MATCH     "U",UPDTTYPE
          IF        @EQUAL
            MATCH     "1",PMHCG027           *Inactive HCP Practice
            IF        @EQUAL
              PACK      KEY20,PMHCG001,SP70
              CALL      RSPMHCL2
CHKHCG10      CALL      RKPMHCL2
              BRANCH    OVRCD,CHKHCG98
.
              MATCH     PMHCG001,PMHLHCPR
              GOTO      CHKHCG98 IF NOT EQUAL
.
              MATCH     "0",PMHLSTAT
              IF        @EQUAL
                GOTO      CHKHCG95
              ENDIF
.
              GOTO      CHKHCG10
            ENDIF
          ENDIF
.
          GOTO      CHKHCG98
.
CHKHCG90  MOVE      "HCP Practice Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHCG99
.
CHKHCG91  MOVE      "Count is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHCG99
.
CHKHCG92  MOVE      "Senior Partner is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHCG99
.
CHKHCG93  MOVE      "Surgery Name is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHCG99
.
CHKHCG94  MOVE      "Senior Partner does not exist!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHCG99
.
CHKHCG95  CLEAR     WEBTITLE
          APPEND    "Some of Linked HCP are still active. ",WEBTITLE
          APPEND    "Please deactivate them first.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHCG99
.
CHKHCG98  MOVE      ZERO,EXIT
CHKHCG99  RETURN
.------------------------------------------------------------
. HCP Details Maintenance : Display,Add,Update,Delete
.------------------------------------------------------------
GPMHCP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      GPMHCP80 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      GPMHCP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      GPMHCP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      GPMHCP30 IF EQUAL
.
          MATCH     "H",UPDTTYPE    * Hospital Specific formaction
          GOTO      GPMHCP40 IF EQUAL
.
          GOTO      GPMHCP93
.
.         ************ ADD FORMACTION ***********
.
GPMHCP10  CALL      CHKHCP00      * Checks mandatory fields
          BRANCH    EXIT,GPMHCP99
.
          MATCH     PMHCP112,SP70         * Checks HCP-Doctor code       C244064
          IF        !@EQUAL
            CALL      CHKDOC00                                         * C244064
            BRANCH    EXIT,GPMHCP99                                    * C244064
          ENDIF           
.
          MATCH     "1",PTCNGHCP          * Auto Generate Next Doctor/HCP Code
          GOTO      GPMHCP15 IF EQUAL
.
          RESET     PMHCP001              * Check if in HCP File         C244064
          PACK      KEY10,PMHCP001,SP70
          CALL      RDPMHCP1
          COMPARE   ZERO,OVRCD
          GOTO      GPMHCP92 IF EQUAL
.
GPMHCP15  MATCH     "1",PTCNGHCP    * Auto Generate Next Doctor/HCP Code
          IF        @EQUAL
            CALL      GENC0000      * Generate Next Doctor/HCP Code
            PACK      PMHCP001,PTCNNHCP,SP70
            PACK      PMHCP112,PTCNNHCP,SP70
          ENDIF 
.
          CALL      CLPMSHCP       * Clear all HPC file vars
          CALL      MVPMHC00       * Moves input variables to HCP file variables
.
          MOVE      USERID,PMHCWEBC
          PACK      PMHCCDTE,CCC,CYY,CMM,CDD
          REP       " 0",PMHCCDTE
          CLOCK     TIME,PMHCCTIM
.
          MOVE      USERID,PMHCWEBU
          PACK      PMHCLUPD,CCC,CYY,CMM,CDD
          REP       " 0",PMHCLUPD
          CLOCK     TIME,PMHCLUPT
.
          MATCH     PMHCLDOC,SP70                                      * C244064
          GOTO      GPMHCP18 IF EQUAL                                  * C244064
.
          PACK      KEY6,PMHCLDOC,SP70                                 * C244064
          CALL      RDDOCT1                                            * C244064
          BRANCH    OVRCD,GPMHCP16            * Doctor does not exist    C244064 
.
          CALL      MVPTDO00                  * Move HCP to Doctor File  C244064
.
          CALL      UPDOCT1                                            * C244064
          PROC      PATDKIUP                  * Updates keyword index    C244064
          GOTO      GPMHCP18                                           * C244064 
.
GPMHCP16  CALL      MVPTDO00                  * Move HCP to Doctor File  C244064
.
          PACK      KEY6,PMHCLDOC,SP70                                 * C244064
          CALL      WRDOCT1                   * New data written         C244064
          CALL      DSCR0000                  * Create blank patdstat    C244064
          PROC      PATDKIUP                  * Update keyword index     C244064
.
GPMHCP18  PACK      KEY10,PMHCP001,SP70
          CALL      WRPMHCP1                  * Writes away the data
          PROC      PMSHKIUP                  * Updates keyword index
          MOVE      "A",PMHCACTN              * action flag for DGCLIM02
          MOVE      THREE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIM02                  * send HL7 message "Doctor Details"
.
.          MATCH     "1",PTCNUNET
.          IF        @EQUAL
.            MOVE      "02",KEY2                 * HPI-I Validation
.            PACK      KEY11,USERID,SP70         * User ID
.            PACK      KEY50,PMHCP001,SP70
.            CALL      WIPL0000                  * Write to polling table
.          ENDIF
.
          MATCH     "5",NEXTPAGE
          IF        @EQUAL
            CALL      HCPNAM00      * Display alert with generated doctor code
            CLEAR     WEBTITLE
            APPEND    "(",WEBTITLE
            APPEND    PMHCHCPC,WEBTITLE
            APPEND    ") - ",WEBTITLE
            APPEND    DOCFNAME,WEBTITLE
            APPEND    " Successfully Added",WEBTITLE
            RESET     WEBTITLE
            ADD       ONE,WARCOUNT
            MOVE      WEBTITLE,WEBWARNG[WARCOUNT]
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      GPMHCP99
.
.         ************ UPDATE FORMACTION **********
.
GPMHCP20  MATCH     PMHCP112,SP70         * Checks HCP-Doctor code       C244064
          IF        !@EQUAL
            CALL      CHDOCU00
            BRANCH    EXIT,GPMHCP99                                    * C244064
          ENDIF
.
          PACK      KEY10,PMHCP001,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,GPMHCP91     * HCP Code does not exist    
.
          CALL      CHKHCP00           * Checks mandatory fields
          BRANCH    EXIT,GPMHCP99
.
          CALL      SISH0000                * Save EDWARD ISP Audit vars
.
          PACK      KEY10,PMHCP001,SP70
          CALL      RLPMHCP1           * Readlock
          CALL      MVPMHC00           * Moves input to HCP file variables
.
          MOVE      USERID,PMHCWEBU
          PACK      PMHCLUPD,CCC,CYY,CMM,CDD
          REP       " 0",PMHCLUPD
          CLOCK     TIME,PMHCLUPT
.
          MATCH     PMHCLDOC,SP70                                      * C244064
          GOTO      GPMHCP26 IF EQUAL                                  * C244064
.
          PACK      KEY6,PMHCLDOC,SP70                                 * C244064
          CALL      RDDOCT1                                            * C244064
          BRANCH    OVRCD,GPMHCP24            * Doctor does not exist    C244064
.
          CALL      MVPTDO00        * Move HCP Variables to Doctor File  C244064
.
          PACK      KEY6,PMHCLDOC,SP70        * pack key before update   C244064
          CALL      UPDOCT1                                            * C244064
          PROC      PATDKIUP                  * Updates keyword index    C244064
          GOTO      GPMHCP26                                           * C244064

GPMHCP24  CALL      MVPTDO00        * Move HCP Variables to Doctor File  C244064
.
          PACK      KEY6,PMHCLDOC,SP70                                 * C244064
          CALL      WRDOCT1       * New data written                   * C244064
          CALL      DSCR0000      * Create blank patdstat records      * C244064
          PROC      PATDKIUP      * Update keyword index               * C244064
.
GPMHCP26  CALL      UPPMHCP1      * Writes away the data
          CALL      UUPMHCP1      * Unlock
.
          CALL      WISH0000        * Write EDWARD ISP Audit vars
.
          PROC      PMSHKIUP        * Updates keyword index
          MOVE      "U",PMHCACTN    * action flag for DGCLIM02
          MOVE      FOUR,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIM02        * send HL7 message "Doctor Details"
.
.          MATCH     "1",PTCNUNET
.          GOTO      GPMHCP29 IF NOT EQUAL
.
.          COMPARE   ONE,CHNGMADE
.          IF        @EQUAL
.            MOVE      "02",KEY2                 * HPI-I Validation
.            PACK      KEY11,USERID,SP70         * User ID
.            PACK      KEY50,PMHCHCPC,SP70
.            CALL      WIPL0000                  * Write to polling table
.          ENDIF
.
GPMHCP29  MOVE      ZERO,EXIT
          GOTO      GPMHCP99
.
.         ************ DELETE FORMACTION **********
.
GPMHCP30  PACK      KEY10,PMHCP001,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,GPMHCP91
          CALL      DEPMHCP1
          PROC      PMSHKIUP
.
          PACK      KEY20,PMHCP001,SP70
          CALL      RSPMHCL1
GPMHCP31  CALL      RKPMHCL1
          BRANCH    OVRCD,GPMHCP32
.
          MATCH     PMHCP001,PMHLHCPC
          GOTO      GPMHCP32 IF NOT EQUAL
.
          PACK      KEY20,PMHLHCPC,PMHLHCPR,SP70
          CALL      DEPMHCL1
          GOTO      GPMHCP31
.
GPMHCP32  MATCH     PMHCLDOC,SP70                                      * C244064
          GOTO      GPMHCP39 IF EQUAL                                  * C244064
.
          PACK      KEY6,PMHCLDOC,SP70                                 * C244064
          CALL      RDDOCT1                                            * C244064
          BRANCH    OVRCD,GPMHCP39                                     * C244064
.                                                                      * C244064 
          CALL      DEDOCT1                                            * C244064
.                                                                      * C244064 
GPMHCP39  MOVE      ZERO,EXIT                                          * C244064  
          GOTO      GPMHCP99
.
.         ************ HOSPITAL SPECIFIC FORMACTION **********
.
GPMHCP40  CALL      LHOS0000      * Update hospital specific details 
.
          MOVE      ZERO,EXIT
          GOTO      GPMHCP99
.
.         ************ DISPLAY FORMACTION **********
.
GPMHCP80  PACK      KEY10,PMHCP001,SP70
          CALL      RDPMHCP1
          IF        OVRCD=1
            CALL      CLPMSHCP    * Clear all the file variables
            IF        FHIRTYPE=1
              MATCH     SP70,KEY10
              GOTO      GPMHCP91 IF NOT EQUAL
            ENDIF
          ENDIF
          MOVE      PMHCHCPC,GENPCODE
.
          PACK      KEY3,DHCSCOD     * Read HCS Doctor File              C244064
          CALL      RDHDOC1                                            * C244064
          IF        OVRCD=1
            MOVE      ZERO,HDCODE                                      * C244064 
            MOVE      SP70,HDNAME                                      * C244064 
            MOVE      SP70,HDSERV                                      * C244064 
          ENDIF    
. 
          CLEAR     WEBTITLE
          MOVE      "HCP Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GPMHCP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      GPMHCP99
.
GPMHCP91  MOVE      "HCP Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPMHCP99
.
GPMHCP92  MOVE      "HCP Code record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPMHCP99
.
GPMHCP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPMHCP99
.
GPMHCP99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKHCP00  MATCH     "1",PTCNGHCP          * Auto Generate Next Doctor/HCP Code
          GOTO      CHKHCP98 IF EQUAL
.
          RESET     PMHCP001
          MATCH     SP70,PMHCP001
          GOTO      CHKHCP90 IF EQUAL
.
          GOTO      CHKHCP98
.
CHKHCP90  MOVE      "HCP Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHCP99
.
CHKHCP98  MOVE      ZERO,EXIT
CHKHCP99  RETURN
.
.-------------------------------------------------------------------------------
. * Check Doctor Code is only linked to one HCP code                  CAR 244064
.-------------------------------------------------------------------------------
CHKDOC00  PACK      KEY16,PMHCP112,SP70
          CALL      RSPMHCP4
          CALL      RKPMHCP4
          BRANCH    OVRCD,CHKDOC98                  * Doctor Code does not exist
.
          MATCH     PMHCP112,PMHCLDOC               * EOR
          GOTO      CHKDOC98 IF NOT EQUAL
.
          MATCH     "1",PTCNGHCP            * Auto Generate Next Doctor/HCP Code
          GOTO      CHKDOC90 IF EQUAL
.
          RESET     PMHCP001
          MATCH     PMHCHCPC,PMHCP001
          GOTO      CHKDOC90 IF NOT EQUAL
.
          GOTO      CHKDOC98
.
CHKDOC90  MOVE      "Doctor Code can only be linked to one HCP Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKDOC99
.
CHKDOC98  MOVE      ZERO,EXIT
.
CHKDOC99  RETURN
+
.-------------------------------------------------------------------------------
.         Check Linked Doctor Code for a HCP Update
.-------------------------------------------------------------------------------
CHDOCU00  PACK      KEY16,PMHCP112,SP70
          CALL      RSPMHCP4
          CALL      RKPMHCP4
          BRANCH    OVRCD,CHDOCU98          * Doctor Code does not exist; pass
.
          MATCH     PMHCP112,PMHCLDOC       * Linked Doctor Code already exists?
          GOTO      CHDOCU98 IF NOT EQUAL   * No; so OK
.
          RESET     PMHCP001
          MATCH     PMHCP001,PMHCHCPC       * Updating our own HCP code?
          GOTO      CHDOCU90 IF NOT EQUAL   * No; error
.
          GOTO      CHDOCU98                * OK to proceed
.
CHDOCU90  MOVE      "Doctor Code can only be linked to one HCP Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHDOCU99
.
CHDOCU98  MOVE      ZERO,EXIT
.
CHDOCU99  RETURN
+
.---------------------------------------------------------------------
. Linked GP Maintenance : Display,Add,Update,Delete
.------------------------------------------------------------
GPPGCL00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      GPPGCL40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      GPPGCL10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      GPPGCL20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      GPPGCL30 IF EQUAL
.
          GOTO      GPPGCL93
.
.         ************ ADD FORMACTION ***********
.
GPPGCL10  CALL      CLPMSHCL    * Clear all the file variables
          CALL      SISL0000    * Save EDWARD ISP Audit vars
.
          CALL      CHKGCL00      * Checks mandatory fields
          BRANCH    EXIT,GPPGCL99
          RESET     PMHCL001
          PACK      KEY20,PMHCL001,PMHCL002,SP70
          CALL      RDPMHCL1
          COMPARE   ZERO,OVRCD
          GOTO      GPPGCL92 IF EQUAL
          CALL      MVPMHL00      * Moves input variables to file variables
.
          MOVE      USERID,PMHLWEBC
          PACK      PMHLCDTE,CCC,CYY,CMM,CDD
          REP       " 0",PMHLCDTE
          CLOCK     TIME,PMHLCTIM
.
          PACK      KEY20,PMHCL001,PMHCL002,SP70
          CALL      WRPMHCL1      * Writes away the data
.
          CALL      WISL0000      * Write EDWARD ISP Audit vars
.
          PACK      KEY10,PMHCL001,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      TEN4,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      GPPGCL99
.
.         ************ UPDATE FORMACTION **********
.
GPPGCL20  PACK      KEY20,PMHCL001,PMHCL002,SP70
          CALL      RDPMHCL1
          BRANCH    OVRCD,GPPGCL91
          CALL      CHKGCL00      * Checks mandatory fields
          BRANCH    EXIT,GPPGCL99
.
          CALL      SISL0000                 * Save EDWARD ISP Audit vars
.
          CALL      MVPMHL00      * Moves input variables to file variables
.
          MOVE      USERID,PMHLWEBU
          PACK      PMHLLUPD,CCC,CYY,CMM,CDD
          REP       " 0",PMHLLUPD
          CLOCK     TIME,PMHLLUPT
.
          CALL      UPPMHCL1      * Writes away the data
.
          CALL      WISL0000      * Write EDWARD ISP Audit vars
.
          PACK      KEY10,PMHCL001,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      TEN5,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      GPPGCL99
.
.         ************ DELETE FORMACTION **********
.
GPPGCL30  PACK      KEY20,PMHCL001,PMHCL002,SP70
          CALL      RDPMHCL1
          BRANCH    OVRCD,GPPGCL91
          CALL      DEPMHCL1
.
          PACK      KEY10,PMHCL001,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      TEN6,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      GPPGCL99
.
.         ************ DISPLAY FORMACTION **********
.
GPPGCL40  PACK      KEY12,PMHCG001,PMHCG002,SP70   * Read a valid Practice Code
          CALL      RDPMHCG1
          BRANCH    OVRCD,GPPGCL94 
          MOVE      PMHGPRAC,PRACCODE
          MOVE      PMHGCNTR,PRACOUNT
.
          PACK      KEY20,PMHCL002,PMHCL001,SP70
          CALL      RDPMHCL2
          IF        OVRCD=1
            CALL      CLPMSHCL    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Linked HCP Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GPPGCL99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      GPPGCL99
.
GPPGCL91  MOVE      "Linked GP Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPPGCL99
.
GPPGCL92  MOVE      "Linked GP Code record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPPGCL99
.
GPPGCL93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPPGCL99
.
GPPGCL94  MOVE      "Invalid Practice.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPPGCL99
.
GPPGCL99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKGCL00  RESET     PMHCL001
          MATCH     SP70,PMHCL001
          GOTO      CHKGCL90 IF EQUAL
.
          RESET     PMHCL004
          MATCH     SP70,PMHCL004
          GOTO      CHKGCL91 IF EQUAL
.
          GOTO      CHKGCL98
.
CHKGCL90  MOVE      "Linked HCP Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKGCL99
.
CHKGCL91  MOVE      "Date Joined cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKGCL99
.
CHKGCL98  MOVE      ZERO,EXIT
CHKGCL99  RETURN
.---------------------------------------------------------------------
. Linked Practices to a GP Maintenance : Display,Add,Update,Delete
.---------------------------------------------------------------------
GPPGPL00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      GPPGPL40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      GPPGPL10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      GPPGPL20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      GPPGPL30 IF EQUAL
.
          GOTO      GPPGPL93
.
.         ************ ADD FORMACTION ***********
.
GPPGPL10  CALL      CLPMSHCL    * Clear all the file variables
          CALL      SISL0000    * Save EDWARD ISP Audit vars
.
          CALL      CHKGPL00      * Checks mandatory fields
          BRANCH    EXIT,GPPGPL99
          RESET     PMHCL001
          PACK      KEY20,PMHCL001,PMHCL002,SP70
          CALL      RDPMHCL1
          COMPARE   ZERO,OVRCD
          GOTO      GPPGPL92 IF EQUAL
          CALL      MVPMHL00      * Moves input variables to file variables
.
          MOVE      USERID,PMHLWEBC
          PACK      PMHLCDTE,CCC,CYY,CMM,CDD
          REP       " 0",PMHLCDTE
          CLOCK     TIME,PMHLCTIM
.
          PACK      KEY20,PMHCL001,PMHCL002,SP70
          CALL      WRPMHCL1      * Writes away the data
.
          CALL      WISL0000      * Write EDWARD ISP Audit vars
.
          PACK      KEY10,PMHCL001,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      FIVE,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      GPPGPL99
.
.         ************ UPDATE FORMACTION **********
.
GPPGPL20  PACK      KEY20,PMHCL001,PMHCL002,SP70
          CALL      RDPMHCL1
          BRANCH    OVRCD,GPPGPL91
          CALL      CHKGPL00      * Checks mandatory fields
          BRANCH    EXIT,GPPGPL99
.
          CALL      SISL0000                 * Save EDWARD ISP Audit vars
.
          CALL      MVPMHL00      * Moves input variables to file variables
.
          MOVE      USERID,PMHLWEBU
          PACK      PMHLLUPD,CCC,CYY,CMM,CDD
          REP       " 0",PMHLLUPD
          CLOCK     TIME,PMHLLUPT
.
          CALL      UPPMHCL1      * Writes away the data
.
          CALL      WISL0000      * Write EDWARD ISP Audit vars
.
          PACK      KEY10,PMHCL001,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      SIX,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      GPPGPL99
.
.         ************ DELETE FORMACTION **********
.
GPPGPL30  PACK      KEY20,PMHCL001,PMHCL002,SP70
          CALL      RDPMHCL1
          BRANCH    OVRCD,GPPGPL91
          CALL      DEPMHCL1
.
          PACK      KEY10,PMHCL001,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      SEVEN,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      GPPGPL99
.
.         ************ DISPLAY FORMACTION **********
.
GPPGPL40  PACK      KEY10,PMHCL001,SP70   * Read a valid GP Record
          CALL      RDPMHCP1
          BRANCH    OVRCD,GPPGPL94 
          MOVE      PMHCHCPC,GENPCODE
.
          PACK      KEY20,PMHCL001,PMHCL002,SP70
          CALL      RDPMHCL1
          IF        OVRCD=1
            CALL      CLPMSHCL    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Linked Practice Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GPPGPL99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      GPPGPL99
.
GPPGPL91  MOVE      "Linked Practice Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPPGPL99
.
GPPGPL92  MOVE      "Linked Practice Code record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPPGPL99
.
GPPGPL93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPPGPL99
.
GPPGPL94  MOVE      "Invalid GP.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GPPGPL99
.
GPPGPL99  RETURN
.
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKGPL00  RESET     PMHCL002
          MATCH     SP70,PMHCL002
          GOTO      CHKGPL90 IF EQUAL
.
          RESET     PMHCL004
          MATCH     SP70,PMHCL004
          GOTO      CHKGPL91 IF EQUAL
.
          GOTO      CHKGPL98
.
CHKGPL90  MOVE      "Linked Practice Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKGPL99
.
CHKGPL91  MOVE      "Date Joined cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKGPL99
.
CHKGPL98  MOVE      ZERO,EXIT
CHKGPL99  RETURN
.-------------------------------------------------------------------------
.        Doctor Leave Maintenance : Display,Add,Update,Delete
.  Leave maintenance is used in Theatre Maintenace and Doctor Code Maint-  
.-------------------------------------------------------------------------
OPRDLV00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRDLV40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRDLV10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRDLV20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRDLV30 IF EQUAL
.
          GOTO      OPRDLV93
.
.         ************ ADD FORMACTION ***********
.
OPRDLV10  CALL      CHKDLV00      * Checks mandatory fields
          BRANCH    EXIT,OPRDLV99
.
          RESET     OPDLV001
          PACK      KEY14,OPDLV001,OPDLV002,SP70
          CALL      RDOPDLV1
          COMPARE   ZERO,OVRCD
          GOTO      OPRDLV92 IF EQUAL
.
          CALL      SAVDLV00      * Moves input variables to file variables
          PACK      KEY14,OPDLV001,OPDLV002,SP70
          CALL      WROPDLV1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRDLV99
.
.         ************ UPDATE FORMACTION **********
.
OPRDLV20  PACK      KEY14,OPDLV001,OPDLV002,SP70
          CALL      RDOPDLV1
          BRANCH    OVRCD,OPRDLV91
          CALL      CHKDLV00      * Checks mandatory fields
          BRANCH    EXIT,OPRDLV99
.
          CALL      SAVDLV00      * Moves input variables to file variables
          PACK      KEY14,OPDLV001,OPDLV002,SP70
          CALL      UPOPDLV1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRDLV99
.
.         ************ DELETE FORMACTION **********
.
OPRDLV30  PACK      KEY14,OPDLV001,OPDLV002,SP70
          CALL      RDOPDLV1
          BRANCH    OVRCD,OPRDLV91
          CALL      DEOPDLV1
.
          MOVE      ZERO,EXIT
          GOTO      OPRDLV99
.
.         ************ DISPLAY FORMACTION **********
.
OPRDLV40  MATCH     SP70,OPDLV001
          IF        !@EQUAL
            PACK      KEY6,OPDLV001,SP70
            CALL      RDDOCT1
            BRANCH    OVRCD,OPRDLV94
            MOVE      DCODE,DOCTCODE
          ENDIF
.
          PACK      KEY14,OPDLV001,OPDLV002,SP70
          CALL      RDOPDLV1
          IF        OVRCD=1
            CALL      CLRDLV00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Doctors Leave Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRDLV99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRDLV99
.
OPRDLV90  MOVE      "To Date has to be after From Date",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRDLV99
.
OPRDLV91  MOVE      "Doctor Leave record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRDLV99
.
OPRDLV92  MOVE      "Doctor Leave record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRDLV99
.
OPRDLV93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRDLV99
.
OPRDLV94  MOVE      "Invalid Doctor Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRDLV99
.
OPRDLV99  RETURN
.-------------------------------------------------------------------------
.  Doctors Budget Maintenance : Display,Add,Update,Delete
.-------------------------------------------------------------------------
DOCBUD00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      DOCBUD40 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      DOCBUD20 IF EQUAL
.
          GOTO      DOCBUD93
.
.         ************ UPDATE FORMACTION **********
.
DOCBUD20  MOVE      ZERO,FORM2
DOCBUD25  ADD       ONE,FORM2
          MOVE      FORM2,KEY2
          REPLACE   " 0",KEY2
DOCBUD26  PACK      KEY13,STATYEAR,KEY2,STATDTYP,DOCTCODE 
          CALL      RLDSTA1
          BRANCH    OVRCD,DOCBUD30,DOCBUD35
          CALL      DOCSSV00
          CALL      UPDSTA1
          CALL      UUDSTA1
          GOTO      DOCBUD39
.
DOCBUD30  MOVE      DOCTCODE,PTDSCODE
          MOVE      STATYEAR,PTDSYEAR
          MOVE      STATDTYP,PTDSTYPE
          MOVE      KEY2,PTDSPERD
          REPLACE   " 0",PTDSPERD
          MOVE      ZERO,PTDSADMS
          MOVE      ZERO,PTDSBEDD
          MOVE      ZERO,PTDSOPRS
          MOVE      ZERO,PTDSMBSC
          CALL      DOCSSV00
          PACK      KEY13,PTDSYEAR,PTDSPERD,PTDSTYPE,PTDSCODE
          CALL      WRDSTA1
          GOTO      DOCBUD39
.
DOCBUD35  DISPLAY   *W2
          GOTO      DOCBUD26
.
DOCBUD39  COMPARE   TEN2,FORM2
          GOTO      DOCBUD25 IF LESS
.
          MOVE      ZERO,EXIT
          GOTO      DOCBUD99
.
.         ************ DISPLAY FORMACTION **********
.
DOCBUD40  MATCH     SP70,DOCTCODE
          IF        !@EQUAL
            PACK      KEY6,DOCTCODE,SP70
            CALL      RDDOCT1
            BRANCH    OVRCD,DOCBUD94
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Doctors Budget Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,DOCBUD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      DOCBUD99
.
DOCBUD93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DOCBUD99
.
DOCBUD94  MOVE      "Invalid Doctor Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DOCBUD99
.
DOCBUD99  RETURN
.
.------------------------------------------------------------
.  Clears File Variables
.------------------------------------------------------------
CLRDLV00  MOVE      SP70,OPDVDOCT    * Doctor Code
          MOVE      SP70,OPDVFDTE    * From Date
          MOVE      SP70,OPDVTDTE    * To Date
          MOVE      SP70,OPDVREAS    * Reason For Doctor Leave (Cat DH)
          MOVE      SP70,OPDVLAST    * Date Last Modified
          MOVE      SP70,OPDVSPAR    * Spare
.
CLRDLV99  RETURN
.------------------------------------------------------------
.  Saves CGI Parameters to file variables
.------------------------------------------------------------
SAVDLV00  MOVE      OPDLV001,OPDVDOCT    * Doctor Code
          MOVE      OPDLV002,OPDVFDTE    * From Date
          MOVE      OPDLV003,OPDVTDTE    * To Date
          MOVE      OPDLV004,OPDVREAS    * Reason For Doctor Leave (Cat DH)
          PACK      OPDVLAST,CCC,CYY,CMM,CDD  * Date Last Modified
          REP       " 0",OPDVLAST
          MOVE      SP70,OPDVSPAR    * Spare
.
SAVDLV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKDLV00  RESET     OPDLV001
          MATCH     SP70,OPDLV001
          GOTO      CHKDLV90 IF EQUAL
.
          RESET     OPDLV002
          MATCH     SP70,OPDLV002
          GOTO      CHKDLV91 IF EQUAL
.
          RESET     OPDLV003
          MATCH     SP70,OPDLV003
          GOTO      CHKDLV92 IF EQUAL
.
          GOTO      CHKDLV98
.
CHKDLV90  MOVE      "Doctor Code is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKDLV99
.
CHKDLV91  MOVE      "From Date is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKDLV99
.
CHKDLV92  MOVE      "To Date is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKDLV99
.
CHKDLV98  MOVE      ZERO,EXIT
CHKDLV99  RETURN
+
.------------------------------------------------------------------------------
. Photo ID Maintenance
.------------------------------------------------------------------------------
PHOTID00  MOVE      ZERO,EXIT
          MATCH     SP70,UPDTTYPE
          GOTO      PHOTID50 IF EQUAL
.
          MATCH     SP70,PHOTOPIC
          GOTO      PHOTID50 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update
          GOTO      PHOTID10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete
          GOTO      PHOTID20 IF EQUAL
.
          GOTO      PHOTID90
.
.         Add Photo ID
.         ------------
PHOTID10  SCAN      "filename",PHOTOPIC
          GOTO      PHOTID90 IF EQUAL
          SCAN      ".",PHOTOPIC
          GOTO      PHOTID90 IF NOT EQUAL
          RESET     PHOTOPIC
.
          MOVE      "images/doctors/",PHOTODIR
          STRIP     CWEBROOT
          STRIP     PMHCP001
          PACK      CMDLINE,CMDMOVE,PHOTOPIC,SP1,CWEBROOT,PHOTODIR,PHOTOFIL,PMHCP001,PHOTOEXT
          EXECUTE   CMDLINE,TASKID
          GOTO      PHOTID99
.
.         Delete Photo ID
.         ---------------
PHOTID20  MOVE      "images/doctors/",PHOTODIR
          STRIP     CWEBROOT
          STRIP     PMHCP001
          PACK      CMDLINE,CMDMOVE,CWEBROOT,PHOTODIR,PHOTOFIL,PMHCP001,PHOTOEXT,SP1,CWEBROOT,PHOTODIR,PMHCP001,PHOTOOLD
          EXECUTE   CMDLINE,TASKID
          GOTO      PHOTID99
.
PHOTID50  PACK      KEY10,PMHCP001,SP70   * Read HCP File
          CALL      RDPMHCP1
          BRANCH    OVRCD,PHOTID90
.
          CLEAR     WEBTITLE
          MOVE      "Photo ID Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PHOTID99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PHOTID99
.
PHOTID90  MOVE      "Unable to add photo.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PHOTID99
.
PHOTID99  RETURN
+
.--------------------------------------------------------------------------
. Process Fields from Template Body
.--------------------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110,PROFL120,PROFL130,PROFL140,PROFL150:
                             PROFL160,PROFL170,PROFL180,PROFL190,PROFL200:
                             PROFL210
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13
          GOTO      PROFLD99
.
PROFLD11  CALL      DOCF0000      * Add Doctor File Field
          GOTO      PROFLD99
.
PROFLD12  CALL      DOCA0000      * Doctor Comments/Statistics 
          GOTO      PROFLD99
.
PROFLD13  CALL      PMHC0000      * HCP Details
          GOTO      PROFLD99
.
PROFLD20  CALL      SDOC0000      * Doctor File Search
          GOTO      PROFLD99
.
.
.    Report No 3: Doctor Code details  
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31,PROFLD32 
          GOTO      PROFLD99
.          
PROFLD31  CALL      DOCF0000      * Doctor Search Details      
          GOTO      PROFLD99       
.
PROFLD32  CALL      HDPF0000      * HDP search details
          GOTO      PROFLD99
.
.    Report No 4: HCP Details
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41,PROFLD42,PROFLD43,PROFLD44
          GOTO      PROFLD99
.
PROFLD41  CALL      PMHC0000      * HCP Details
          GOTO      PROFLD99
.
PROFLD42  CALL      PHCG0000      * HCP Practice details
          GOTO      PROFLD99
.
PROFLD43  CALL      PMHL0000      * HCP Practice Link details
          GOTO      PROFLD99
.
PROFLD44  CALL      GPPG0000      * HCP Maintenance Display (Table)
          GOTO      PROFLD99
.
.    Report 5: GP Practice Maintenance
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51,PROFLD52
          GOTO      PROFLD99
.
PROFLD51  CALL      PHCG0000      * Add HCP Practice Fields
          GOTO      PROFLD99
.
PROFLD52  CALL      GPPF0000      * HCP Internal Details
          GOTO      PROFLD99
.
.    Report 6: GP Maintenance
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62,PROFLD63,PROFLD64
          GOTO      PROFLD99
.
PROFLD61  CALL      PMHC0000      * HCP Details
          GOTO      PROFLD99
.  
PROFLD62  CALL      GPPG0000      * HCP Maintenance Display (Table)  
          GOTO      PROFLD99
.
PROFLD63  CALL      HDPF0000      * HDP search details
          GOTO      PROFLD99
.
PROFLD64  CALL      GPPF0000      * HCP Internal Details
          GOTO      PROFLD99
.
.    Report 7: Linked GP's to Practices Maintenance
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71,PROFLD72,PROFLD73,PROFLD74
          GOTO      PROFLD99
.
PROFLD71  CALL      PHCG0000      * HCP Practice Details
          GOTO      PROFLD99
.
PROFLD72  CALL      GPPF0000      * Practice Internal
          GOTO      PROFLD99
.
PROFLD73  CALL      PMHL0000      * HCP Linked Practice Details
          GOTO      PROFLD99
.
PROFLD74  CALL      GPPL0000      * Linked Internal
          GOTO      PROFLD99
.
.    Report 8: Linked Practices to a GP Maintenance
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81,PROFLD82,PROFLD83 
          GOTO      PROFLD99
.
PROFLD81  CALL      PMHC0000      * HCP Details 
          GOTO      PROFLD99
.
PROFLD82  CALL      PMHL0000      * Linked Practices to a GP Maintenance
          GOTO      PROFLD99
.
PROFLD83  CALL      GPLP0000      * Linked Internal
          GOTO      PROFLD99
.
.    Report 9: Doctors Leave Maintenance
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91,PROFLD92           
          GOTO      PROFLD99
.          
PROFLD91  CALL      DOCF0000      * Doctor Search Details      
          GOTO      PROFLD99       
.
PROFLD92  CALL      OPDV0000      * Doctor Leave Details
          GOTO      PROFLD99
.
.    Report 10: Doctors Budget Maintenance
.
PROFL100  BRANCH    FLDSETNO,PROFL101,PROFL102
          GOTO      PROFLD99
.
PROFL101  CALL      DOCF0000      * Doctor Search Details     
          GOTO      PROFLD99      
.
PROFL102  CALL      DSTA0000      * Doctors Budget Details
          GOTO      PROFLD99
.
PROFL110  CALL      LETF0000      * Letter Details
          GOTO      PROFLD99
. 
PROFL120  BRANCH    FLDSETNO,PROFL121,PROFL122,PROFL123,PROFL124,PROFL125
          GOTO      PROFLD99
.
PROFL121  CALL      DOCU0000      * Doctory/Unit List
          GOTO      PROFLD99
.
PROFL122  
          GOTO      PROFLD99
.
PROFL123  CALL      PREVGR00
          GOTO      PROFLD99
.
PROFL124  CALL      NEXTGR00
          GOTO      PROFLD99
.
PROFL125  CALL      UPDFLD00
          GOTO      PROFLD99
.
.    Report 13: HCP Comment Maintenance
.
PROFL130  BRANCH    FLDSETNO,PROFL131,PROFL132
          GOTO      PROFLD99
.
PROFL131  CALL      PMHC0000      * HCP Details
          GOTO      PROFLD99
.
PROFL132  CALL      GPPC0000      * HCP Comment Maintenance
          GOTO      PROFLD99
.
.    Report 14: HCP Photo ID Maintenance
.
PROFL140  BRANCH    FLDSETNO,PROFL141
          GOTO      PROFLD99
.
PROFL141  CALL      PMHC0000      * HCP Details
          GOTO      PROFLD99
.
.    Report 15: Teams Maintenance
.
PROFL150  BRANCH    FLDSETNO,PROFL151,PROFL152
          GOTO      PROFLD99
.
PROFL151  CALL      PMTT0000      * Teams Details Tables
          GOTO      PROFLD99
.
PROFL152  CALL      PMTE0000      * Teams Details
          GOTO      PROFLD99
.
.    Report 16: Linked Hospitals Maintenance
.
PROFL160  BRANCH    FLDSETNO,PROFL161,PROFL162,PROFL163
          GOTO      PROFLD99
.
PROFL161  CALL      PMHC0000      * HCP Details
          GOTO      PROFLD99
.
PROFL162  CALL      HLNK0000      * Linked Hospitals Tags
          GOTO      PROFLD99
.
PROFL163  CALL      MLHC0000      * multi hcp Tags
          GOTO      PROFLD99
.
PROFL170  BRANCH    FLDSETNO,PROFL171,PROFL172,PROFL173
          GOTO      PROFLD99
.
PROFL171  CALL      PMTM0000      * Doctor/unit/team tags
          GOTO      PROFLD99
.
PROFL172  CALL      TABL0000      * General Table tags
          GOTO      PROFLD99
.
PROFL173  CALL      MLHC0000      * multi hcp Tags
          GOTO      PROFLD99
.
PROFL180  BRANCH    FLDSETNO,PROFL181,PROFL182,PROFL183
          GOTO      PROFLD99
.
PROFL181  CALL      PMRL0000      * Doctor/role tags
          GOTO      PROFLD99
.
PROFL182  CALL      TABL0000      * General Table tags
          GOTO      PROFLD99
.
PROFL183  CALL      MLHC0000      * multi hcp Tags
          GOTO      PROFLD99
.
PROFL190  BRANCH    FLDSETNO,PROFL191,PROFL192,PROFL193
          GOTO      PROFLD99
.
PROFL191  CALL      PMDR0000      * Doctor/arrangement tags
          GOTO      PROFLD99
.
PROFL192  CALL      TABL0000      * General Table tags
          GOTO      PROFLD99
.
PROFL193  CALL      PMHC0000      * HCP Details
          GOTO      PROFLD99
.
PROFL200  BRANCH    FLDSETNO,PROFL201,PROFL202,PROFL203
          GOTO      PROFLD99
.
PROFL201  CALL      PMSE0000      * HCP/Specialties tags
          GOTO      PROFLD99
.
PROFL202  CALL      TABL0000      * General Table tags
          GOTO      PROFLD99
.
PROFL203  CALL      PMHC0000      * HCP Details
          GOTO      PROFLD99
.
PROFL210  BRANCH    FLDSETNO,PROFL211,PROFL212
          GOTO      PROFLD99
.
PROFL211  CALL      PMFH0000      * Fund Payee Id tags
          GOTO      PROFLD99
.
PROFL212  CALL      PMHC0000      * HCP Details
          GOTO      PROFLD99
.
PROFLD99  RETURN
.------------------------------------------------------------
. Report 1: Doctor Statistics
.------------------------------------------------------------
DOCA0000  BRANCH    FLDITMNO,DOCA0100,DOCA0200,DOCA0300,DOCA0400,DOCA0500:
                             DOCA0600,DOCA0700,DOCA0800,DOCA0900,DOCA1000
          GOTO      DOCA9999
.
DOCA0100  CALL      COMENT00      * Display Doctor comments  
          GOTO      DOCA9999      
.
DOCA0200  CALL      STATS000      * Display Doctor Statistics 
          GOTO      DOCA9999
.
DOCA0300  CALL      PERDSC00      * Display Period Description
          GOTO      DOCA9999
.
DOCA0400  MOVE      "1",KEY1      * HCP Comments Type
          MOVE      "  1",KEY3                                         *I-60046
          CALL      DCOMDS00
          GOTO      DOCA9999
.
DOCA0500  MOVE      "0",KEY1      * HCP Comments Line 1
          MOVE      "  1",KEY3                                         *I-60046
          CALL      DCOMDS00
          GOTO      DOCA9999
.
DOCA0600  MOVE      "0",KEY1      * HCP Comments Line 2
          MOVE      "  2",KEY3                                         *I-60046
          CALL      DCOMDS00
          GOTO      DOCA9999
.
DOCA0700  MOVE      " ",KEY1      * HCP Comment Cat.TX Ind.2+ (N/Y)    *I-206490
          CALL      DCOMTY00
          GOTO      DOCA9999
.
DOCA0800  CALL      DCOMTZ00      * HCP List Comment Links with Cat.TX Ind.2=D
          GOTO      DOCA9999
.
DOCA0900  CALL      DCOMAH00      * HCP List Comment Links with Cat.TX Ind.2=A
          GOTO      DOCA9999
.
DOCA1000  CALL      DCOMAB00      * Setup Add Button for adding Ad-hoc Comments
          GOTO      DOCA9999
.
DOCA9999  RETURN
.-------------------------------------------------------------
. Report 5: GP Practice Maintenance
.-------------------------------------------------------------
GPPF0000  BRANCH    FLDITMNO,GPPF0100,GPPF0200,GPPF0300,GPPF0400,GPPF0500:
                             GPPF0600,GPPF0700,GPPF0800,GPPF0900,GPPF1000:
                             GPPF1100,GPPF1200,GPPF1300,GPPF1400,GPPF1500:
                             GPPF1600
          GOTO      GPPF9999
.
GPPF0100  MOVE      ZERO,LNK2PRT * Table of GP Practices 
          CALL      GPPTB000     
          GOTO      GPPF9999
.
GPPF0200  CALL      NEXTPR00     * Link to Next Set of Codes
          GOTO      GPPF9999
.
GPPF0300  CALL      PREVPR00     * Link to Prev Set of Codes
          GOTO      GPPF9999
.
GPPF0400  CALL      LNKSER00     * Link to another program
          GOTO      GPPF9999
.
GPPF0500  MOVE      ONE,LNK2PRT  * Table of GP Practices with Update Parent 
          CALL      GPPTB000     
          GOTO      GPPF9999
.
GPPF0600  MOVE      TWO,LNK2PRT  * Table of GP Practices with Update Parent/cnt 
          CALL      GPPTB000     
          GOTO      GPPF9999
.
GPPF0700  MOVE      ZERO,LNK2PRT * Update Parent
          CALL      GGSRH000     * Search Table of Practices by keyword
          GOTO      GPPF9999
.
GPPF0800  MOVE      ONE,LNK2PRT  * Link to Window
          CALL      GGSRH000     * Search Table of Practices by keyword
          GOTO      GPPF9999
.
GPPF0900  MOVE      TWO,LNK2PRT  * Link to Window
          CALL      GGSRH000     * Search Table of Practices by keyword
          GOTO      GPPF9999
.
GPPF1000  WRITE     HTMLFILE;KEYWORDS;
          GOTO      GPPF9999
.
GPPF1100  WRITE     HTMLFILE;HCPSSTAT;
          GOTO      GPPF9999
.
GPPF1200  MOVE      ZERO,LNK2PRT * Update Parent
          CALL      GGHCP000     * Display table of HCPs for practice
          GOTO      GPPF9999
.
GPPF1300  WRITE     HTMLFILE;HCPSTATE;
          GOTO      GPPF9999
.
GPPF1400  WRITE     HTMLFILE;PTCNHDPS;
          GOTO      GPPF9999
.
GPPF1500  WRITE     HTMLFILE;MENUFLAG;
          GOTO      GPPF9999
.
GPPF1600  PACK      KEY20,PMHCG001,SP70
          CALL      RSPMHCL2
          CALL      RKPMHCL2
          BRANCH    OVRCD,GPPF1610
.
          MATCH     PMHCG001,PMHLHCPR
          GOTO      GPPF1610 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Yes, there is a linked practice
          GOTO      GPPF9999
.
GPPF1610  WRITE     HTMLFILE;ZERO;          * No, there is no linked practice
          GOTO      GPPF9999
.
GPPF9999  RETURN
.-------------------------------------------------------------
. Report 6: GP Maintenance
.-------------------------------------------------------------
GPPG0000  BRANCH    FLDITMNO,GPPG0100,GPPG0200,GPPG0300,GPPG0400,GPPG0500:
                             GPPG0600,GPPG0700,GPPG0800,GPPG0900,GPPG1000:
                             GPPG1100,GPPG1200,GPPG1300,GPPG1400,GPPG1500:
                             GPPG1600,GPPG1700,GPPG1800,GPPG1900,GPPG2000:
                             GPPG2100,GPPG2200,GPPG2300,GPPG2400,GPPG2500:
                             GPPG2600,GPPG2700,GPPG2800,GPPG2900,GPPG3000:
                             GPPG3100,GPPG3200,GPPG3300,GPPG3400
          GOTO      GPPG9999
.
GPPG0100  
          GOTO      GPPG9999
.
GPPG0200  MOVE      ZERO,LNK2PRT  * Table of GP's by Code 
          MOVE      ONE,MAINTFLG
          CALL      GPGTB000     
          GOTO      GPPG9999
.
GPPG0300  MOVE      ZERO,LNK2PRT  * Table of GP's by name  
          MOVE      ONE,MAINTFLG
          CALL      GPNTB000    
          GOTO      GPPG9999
.
GPPG0400  MOVE      ONE,LNK2PRT   * Table of GP's by Code - UpdateParent
          CALL      GPGTB000     
          GOTO      GPPG9999
.
GPPG0500  MOVE      ONE,LNK2PRT   * Table of GP's by name - UpdateParent
          CALL      GPNTB000     
          GOTO      GPPG9999
.
GPPG0600  CALL      NEXTPR00      * Link to Next Set of Codes
          GOTO      GPPG9999
.
GPPG0700  CALL      PREVPR00      * Link to Prev Set of Codes
          GOTO      GPPG9999
.
GPPG0800  CALL      LNKPRO00      * Link to Another Program   
          GOTO      GPPG9999
.
GPPG0900  MOVE      ZERO,LNK2PRT
          MOVE      ZERO,MAINTFLG
          MOVE      ZERO,JSONOUTF
          MOVE      ZERO,ASSRINDC
          MOVE      ZERO,SPLTYFLG
          CALL      GPSRH000     * Search Table of GP's by name - UpdateParent
          GOTO      GPPG9999
.
GPPG1000  CALL      GPPSR000     * Search of GP&Practice by name - UpdateParent
          GOTO      GPPG9999
.
GPPG1100  WRITE     HTMLFILE;HCPSSTAT;
          GOTO      GPPG9999
.
GPPG1200  MATCH     "1",MENUFLAG
          IF        @EQUAL
            MOVE      ZERO,MAINTFLG
            CALL      HCPSCH00         * HCP Search Table output (Enquiry View)
          ELSE
            MOVE      ONE,LNK2PRT      * Link to Window
            MOVE      ZERO,MAINTFLG
            MOVE      ZERO,JSONOUTF
            MOVE      ZERO,ASSRINDC
            MOVE      ONE,SPLTYFLG
            CALL      GPSRH000   * Search Table of GP's by name - Link to Window
          ENDIF
          GOTO      GPPG9999
.
GPPG1300  MOVE      TWO,LNK2PRT  * Link to Window
          MOVE      ZERO,MAINTFLG
          MOVE      ZERO,JSONOUTF
          MOVE      ZERO,ASSRINDC
          MOVE      ZERO,SPLTYFLG
          CALL      GPSRH000     * Search Table of GP's by name - Link to Window
          GOTO      GPPG9999
.
GPPG1400  PACK      KEY16,PMHCP001,SP70
          CALL      RSPMTCO1
          CALL      RKPMTCO1                     * Does this HCP have comments
          BRANCH    OVRCD,GPPG1410
.
          MATCH     PMHCP001,PMTCCODE            * Same HCP
          GOTO      GPPG1410 IF NOT EQUAL
.       
          WRITE     HTMLFILE;ONE;
          GOTO      GPPG9999
.
GPPG1410  WRITE     HTMLFILE;ZERO;
          GOTO      GPPG9999
.
GPPG1500  WRITE     HTMLFILE;RETNFLAG;
          GOTO      GPPG9999
.
GPPG1600  PACK      KEY20,PMHCP001,SP70
          CALL      RSALCTM2
          CALL      RKALCTM2                     * Does this HCP have comments
          BRANCH    OVRCD,GPPG1610
.
          MATCH     PMHCP001,ALCTHCPC            * Same HCP
          GOTO      GPPG1610 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;
          GOTO      GPPG9999
.
GPPG1610  WRITE     HTMLFILE;ZERO;
          GOTO      GPPG9999
.
GPPG1700  WRITE     HTMLFILE;KEYWORDS;                                 *I-57413
          GOTO      GPPG9999
.
GPPG1800  CALL      HHCP0000                     * Hocpital Specific HCP Details
          GOTO      GPPG9999
.
GPPG1900  MOVE      TWO,LNK2PRT  * Link to Window
          MOVE      ONE,MAINTFLG
          MOVE      ZERO,JSONOUTF
          MOVE      ZERO,ASSRINDC
          MOVE      ZERO,SPLTYFLG
          CALL      GPSRH000     * Search Table of GP's by name - Link to Window
          GOTO      GPPG9999
.
GPPG2000  WRITE     HTMLFILE;VALPTYPE;
          GOTO      GPPG9999
.
GPPG2100  PACK      KEY20,PMHCP001,SP70
          CALL      RSPMHCL1                * look for a linked practice for this HCP
          CALL      RKPMHCL1
          BRANCH    OVRCD,GPPG2110
.
          MATCH     PMHCP001,PMHLHCPC            * Same HCP
          GOTO      GPPG2110 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Yes, there is a linked practice
          GOTO      GPPG9999
.
GPPG2110  WRITE     HTMLFILE;ZERO;          * No, there is no linked practice
          GOTO      GPPG9999
.
GPPG2200  PACK      KEY13,PMHCP001,SP70
          CALL      RSPMDRA1
          CALL      RKPMDRA1                * Does hcp have arrangements?
          BRANCH    OVRCD,GPPG2210
.
          MATCH     PMHCP001,PMDRDOCT       * Same hcp?
          GOTO      GPPG2210 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * arrangements exist
          GOTO      GPPG9999
.
GPPG2210  WRITE     HTMLFILE;ZERO;          * no arrangements exist
          GOTO      GPPG9999
.
GPPG2300  MOVE      ONE,LNK2PRT  * Link to Window
          MOVE      ZERO,MAINTFLG
          MOVE      ONE,JSONOUTF
          MOVE      ZERO,ASSRINDC
          MOVE      ZERO,SPLTYFLG
          CALL      GPSRH000     * Search Table of GP's by name - Link to Window
          GOTO      GPPG9999
.
GPPG2400  WRITE     HTMLFILE;PTCNGHCP;
          GOTO      GPPG9999
.
GPPG2500  PACK      KEY21,PMHCP001,SP70
          CALL      RSPMSPE1
          CALL      RKPMSPE1                * Does hcp have specialties?
          BRANCH    OVRCD,GPPG2510
.
          MATCH     PMHCP001,PMSEHCPC       * Same hcp?
          GOTO      GPPG2510 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * specialties exist
          GOTO      GPPG9999
.
GPPG2510  WRITE     HTMLFILE;ZERO;          * no specialties exist
          GOTO      GPPG9999
.
GPPG2600  MATCH     SP70,PMHCLDOC
          GOTO      GPPG2620 IF EQUAL
.
          PACK      KEY9,PMHCLDOC,SP70
          CALL      RSPMDUN1
          CALL      RKPMDUN1                * Does doc have units?
          BRANCH    OVRCD,GPPG2610
.
          MATCH     PMHCLDOC,PMDUDOCT       * Same doc?
          GOTO      GPPG2610 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * units exist
          GOTO      GPPG9999
.
GPPG2610  WRITE     HTMLFILE;ZERO;          * no units exist
          GOTO      GPPG9999
.
GPPG2620  WRITE     HTMLFILE;TWO;           * no linked doctor code
          GOTO      GPPG9999
.
GPPG2700  MOVE      ZERO,LNK2PRT
          MOVE      ZERO,MAINTFLG
          MOVE      ZERO,JSONOUTF
          MOVE      ONE,ASSRINDC
          MOVE      ZERO,SPLTYFLG
          CALL      GPSRH000     * Search Table of GP's by name - UpdateParent
          GOTO      GPPG9999
.
GPPG2800  WRITE     HTMLFILE;UPCASHCP; 
          GOTO      GPPG9999
.
GPPG2900  WRITE     HTMLFILE;MENUFLAG;      * 1=Enquiry View
          GOTO      GPPG9999
.
GPPG3000  MOVE      " ",KEY1      * HCP Comment Cat.TX Ind.2+ (N/Y)    *I-206490
          CALL      HCOMTY00
          GOTO      GPPG9999
.
GPPG3100  CALL      HCOMTZ00      * HCP List Comment Links with Cat.TX Ind.2=D
          GOTO      GPPG9999
.
GPPG3200  CALL      HCOMAH00      * HCP List Comment Links with Cat.TX Ind.2=A
          GOTO      GPPG9999
.
GPPG3300  CALL      HCOMAB00      * Setup Add Button for adding Ad-hoc Comments
          GOTO      GPPG9999
.
GPPG3400  MOVE      PMHCADR1,PRACNAME       * use hcp details
          MOVE      PMHCADR2,PRACADD1
          MOVE      SP70,PRACADD2
          MOVE      PMHCADR3,PRACADD3
          MOVE      PMHCADR4,PRACADD4
          MOVE      PMHCPOST,PRACPOST
          MOVE      PMHCSEML,PRACPEML
          MOVE      PMHCSTEL,PRACPTEL
          MOVE      PMHCFAXN,PRACPFAX
          MOVE      PMHCPRV1,PRACPROV
          PACK      DISPPRAC,SP70
          PACK      DISPPNAM,SP70,SP70
          PACK      DISPPCNT,SP70
          CALL      RESPRA00      * Output FHIR Resource for HCP
          GOTO      GPPG9999
.
GPPG9999  RETURN
.-------------------------------------------------------------
. Report 7: Linked GP's to Practices Maintenance
.-------------------------------------------------------------
GPPL0000  BRANCH    FLDITMNO,GPPL0100,GPPL0200,GPPL0300
          GOTO      GPPL9999
.
GPPL0100  CALL      GCLTB000      * Table of Linked GP's to Practices 
          GOTO      GPPL9999
.
GPPL0200  CALL      NEXTPR00      * Link to Next Set of Codes
          GOTO      GPPL9999
.
GPPL0300  CALL      PREVPR00      * Link to Prev Set of Codes
          GOTO      GPPL9999
.
GPPL9999  RETURN
.-------------------------------------------------------------
. Report 8: Linked Practices to a GP Maintenance
.-------------------------------------------------------------
GPLP0000  BRANCH    FLDITMNO,GPLP0100,GPLP0200,GPLP0300,GPLP0400,GPLP0500
          GOTO      GPLP9999
.
GPLP0100  CALL      GPLTB000      * Table of Linked Practices to a GP 
          GOTO      GPLP9999
.
GPLP0200  CALL      NEXTPR00      * Link to Next Set of Codes
          GOTO      GPLP9999
.
GPLP0300  CALL      PREVPR00      * Link to Prev Set of Codes
          GOTO      GPLP9999
.
GPLP0400  CALL      LNKPRO00      * Link to Another Program   
          GOTO      GPLP9999
.
GPLP0500  PACK      KEY12,PMHLHCPR,SP70  * Practice Surgery Name
          CALL      RSPMHCG1
          CALL      RKPMHCG1
          BRANCH    OVRCD,GPLP9999
          WRITE     HTMLFILE;PMHGPNAM;          
          GOTO      GPLP9999 
.
GPLP9999  RETURN
.-------------------------------------------------------------------------
. Report 9: Doctors Leave Maintenace
.-------------------------------------------------------------------------
OPDV0000  BRANCH    FLDITMNO,OPDV0100,OPDV0200,OPDV0300,OPDV0400,OPDV0500:
                             OPDV0600,OPDV0700,OPDV0800,OPDV0900,OPDV1000:
                             OPDV1100
          GOTO      OPDV9999
.
OPDV0100  MOVE      OPDVDOCT,DOCTCODE  * Doctor 
          CALL      DOCDET00           * Doctor Details
          GOTO      OPDV9999
.
OPDV0200  UNPACK    OPDVFDTE,CCENT,CYEAR,CMON,CDAY  * From Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;DATE;
          GOTO      OPDV9999
.
OPDV0300  UNPACK    OPDVTDTE,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;DATE;
          GOTO      OPDV9999
.
OPDV0400  MOVE      "DH",CATEGORY       * Reason For Doctor Leave
          MOVE      OPDVREAS,CODE
          CALL      CODITM00
          GOTO      OPDV9999
.
OPDV0500  WRITE     HTMLFILE;OPDVLAST;  * Date Last Modified 
          GOTO      OPDV9999
.
OPDV0600  CALL      DLVTB000   * Table of Doctors with Leave Dates 
          GOTO      OPDV9999
.
OPDV0700  CALL      SETYR000 * Sets current year Depending Next or Prev Page
          GOTO      OPDV9999
.
OPDV0800  CALL      PREVYR00   * Previous Year  
          GOTO      OPDV9999
.
OPDV0900  CALL      NEXTYR00   * Next Year 
          GOTO      OPDV9999
.
OPDV1000  CALL      DOCTB000   * Table of Leave Dates for a Doctor 
          GOTO      OPDV9999
.
OPDV1100  CALL      DLVTS000   * Sort Table of Doctors with Leave Dates
          GOTO      OPDV9999
.
OPDV9999  RETURN
.-------------------------------------------------------------------------
. Report 10: Doctors Budget Maint Admissions
.-------------------------------------------------------------------------
DSTA0000  BRANCH    FLDITMNO,DSTA0100,DSTA0200,DSTA0300,DSTA0400,DSTA0500:
                             DSTA0600,DSTA0700,DSTA0800
          GOTO      DSTA9999
. 
DSTA0100  UNPACK     DIM127,D1,STATPERD,DIM127
          PACK       KEY13,STATYEAR,STATPERD,STATDTYP,DOCTCODE
          CALL       RDDSTA1
          IF         OVRCD=1
            WRITE     HTMLFILE;ZERO;
          ELSE
            WRITE     HTMLFILE;PTDSBADM;
          ENDIF
          GOTO       DSTA9999
.
DSTA0200  UNPACK     DIM127,D1,STATPERD,DIM127
          PACK       KEY13,STATYEAR,STATPERD,STATDTYP,DOCTCODE
          CALL       RDDSTA1
          IF         OVRCD=1
            WRITE     HTMLFILE;ZERO;
          ELSE
            WRITE     HTMLFILE;PTDSBBED;
          ENDIF
          GOTO       DSTA9999
.
DSTA0300  UNPACK     DIM127,D1,STATPERD,DIM127
          PACK       KEY13,STATYEAR,STATPERD,STATDTYP,DOCTCODE
          CALL       RDDSTA1
          IF         OVRCD=1
            WRITE     HTMLFILE;ZERO;
          ELSE
            WRITE     HTMLFILE;PTDSBOPR;
          ENDIF
          GOTO       DSTA9999
.
DSTA0400  UNPACK     DIM127,D1,STATPERD,DIM127
          PACK       KEY13,STATYEAR,STATPERD,STATDTYP,DOCTCODE
          CALL       RDDSTA1
          IF         OVRCD=1
            WRITE     HTMLFILE;ZERO;
          ELSE
            WRITE     HTMLFILE;PTDSBMBS;
          ENDIF
          GOTO       DSTA9999
.
DSTA0500  UNPACK     XDATE,KEY4      * get this year
          MOVE       KEY4,F4  
          SUB        SEVEN,F4        * go back seven years
          MOVE       ZERO,F2
DSTA0510  COMPARE    F2,TEN 
          GOTO       DSTA9999 IF LESS 
.                                    * build selection list 
          WRITE      HTMLFILE;"<option value=#"",F4,"#"";
          MOVE       F4,KEY4  
          MATCH      KEY4,STATYEAR  
          IF         @EQUAL 
            WRITE      HTMLFILE;" selected";
          ENDIF
          WRITE      HTMLFILE;">",F4,"</option>"
. 
          ADD        ONE,F2 
          ADD        ONE,F4 
          GOTO       DSTA0510
.
DSTA0600  MATCH      STATDTYP,ANSA
          IF         @EQUAL
            WRITE      HTMLFILE;"<option value=#"","A","#" selected>":
                                 "Attending","</option>"
            WRITE      HTMLFILE;"<option value=#"","R","#">","Referring":
                               "</option>"
          ELSE
            WRITE      HTMLFILE;"<option value=#"","A","#">","Attending":
                               "</option>"
            WRITE      HTMLFILE;"<option value=#"","R","#" selected>":
                                "Referring","</option>"
          ENDIF
         
          GOTO       DSTA9999
.
DSTA0700  REPLACE    " +",DOCTCODE 
          REPLACE    " +",STATYEAR
        
          WRITE     HTMLFILE;"patweb99.pbl?reportno=",TEN:
                                 "&template=","001":
                                 "&doctcode=",DOCTCODE:
                                 "&statyear=",STATYEAR:
                                 "&statdtyp=",STATDTYP;
          REP       "+ ",DOCTCODE
          REP       "+ ",STATYEAR
          GOTO      DSTA9999
.
DSTA0800  CALL      PERDSC00
          GOTO      DSTA9999
.
.
DSTA9999 RETURN
.------------------------------------------------------------
. Doctor/Unit List
.------------------------------------------------------------
DOCU0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DUHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY9,STARTKEY,SP70
          CALL      RSPMDUN1
          IF        OVRCD=0
            CALL      RPPMDUN1
          ENDIF
DOCU0100  CALL      RKPMDUN1
          BRANCH    OVRCD,DOCU9000
.
          MATCH     "1",HCPLEVEL
          IF        @EQUAL
            MATCH     SP70,STARTKEY
            IF        !@EQUAL
              MOVE       STARTKEY,DIM6
              MATCH      DIM6,PMDUDOCT
              GOTO       DOCU0100 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTUNIT
          IF        !@EQUAL
            MATCH     FILTUNIT,PMDUUNIT
            GOTO      DOCU0100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DOCU0100
          ENDIF
.
          CALL      DUROW000      * Display Category Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DOCU0100 IF NOT EQUAL
          GOTO      DOCU9999
.
DOCU9000  CALL      NOMORE00      * Display No More Records Message
.
DOCU9999  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY
          REP       " +",FILTUNIT
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&hcplevel=",HCPLEVEL:
                                 "&pmhcp001=",PMHCP001:
                                 "&filtunit=",FILTUNIT;
.
          REP       "+ ",STARTKEY
          REP       "+ ",FILTUNIT
.
NEXTGR99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY
          REP       " +",FILTUNIT
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&hcplevel=",HCPLEVEL:
                                 "&pmhcp001=",PMHCP001:
                                 "&filtunit=",FILTUNIT;
.
          REP       "+ ",STARTKEY
          REP       "+ ",FILTUNIT
.
PREVGR99  RETURN
+
.------------------------------------------------------------
.               Routine for pmsdunaf fields
.------------------------------------------------------------
UPDFLD00  BRANCH    FLDITMNO,UPDFLD10,UPDFLD20,UPDFLD30,UPDFLD40:
                             UPDFLD50,UPDFLD60,UPDFLD70,UPDFLD80:
                             UPDFLD90,UPDFL100
          GOTO      UPDFLD99
.
UPDFLD10  WRITE     HTMLFILE;PMDUDOCT;
          GOTO      UPDFLD99
.
UPDFLD20  WRITE     HTMLFILE;PMDUUNIT;
          GOTO      UPDFLD99
.
UPDFLD30  PACK      KEY6,PMDUDOCT,SP70
          CALL      RDDOCT1
          IF        OVRCD<>1
            MOVE      DTITL,FMTTITLE
            MOVE      DGNAME,FMTGNAME
            MOVE      DSNAME,FMTSNAME
            CALL      DOCNM000
            WRITE     HTMLFILE;DOCFNAME;
          ENDIF
          GOTO      UPDFLD99
.
UPDFLD40  MOVE      "AC",CATEGORY
          MOVE      PMDUUNIT,CODE
          CALL      CODITM00
          GOTO      UPDFLD99
.
UPDFLD50  WRITE     HTMLFILE;PMDUHEAD;
          GOTO      UPDFLD99
.
UPDFLD60  WRITE     HTMLFILE;PMDUN001;
          GOTO      UPDFLD99
.
UPDFLD70  WRITE     HTMLFILE;RETNFLAG;
          GOTO      UPDFLD99
.
UPDFLD80  WRITE     HTMLFILE;PMHCP001;
          GOTO      UPDFLD99
.
UPDFLD90  PACK      KEY6,PMDUN001,SP70
          CALL      RDDOCT1
          BRANCH    OVRCD,DUROW999
.
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      UPDFLD99
.
UPDFL100  WRITE     HTMLFILE;FILTUNIT;
          GOTO      UPDFLD99
. 
UPDFLD99  RETURN
+
.------------------------------------------------------------
. Doctor/Unit Maintenance (TABLE HEADING)
.------------------------------------------------------------
DUHED000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=33%>Doctor":
                             "</td>":
                             "<td class=HeadingCell width=34%>Unit":
                             "</td>":
                             "<td class=HeadingCell width=10%>Head of Unit":
                             "</td>":
                             "</tr>"
.
DUHED999  RETURN
.------------------------------------------------------------
. Doctor Unit Maintenance (TABLE ROW)
.------------------------------------------------------------
DUROW000  PACK     KEY6,PMDUDOCT,SP70
          CALL     RDDOCT1
          BRANCH   OVRCD,DUROW999
.
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL     DOCNM000
.
          PACK     KEY5,ANSA,ANSC,PMDUUNIT
          CALL     RDCODE1
          IF       OVRCD<>0
            MOVE      "&nbsp;",TDESC
          ENDIF
.
          MATCH     "1",PMDUHEAD
          IF        @EQUAL
            MOVE      "Yes",HEADDESC
          ELSE
            MOVE      "No",HEADDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail02":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmdun001=",PMDUDOCT:
                             "&pmdun002=",PMDUUNIT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             DOCFNAME,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td align=center>",HEADDESC,"</td>":
                             "</tr>"
.
DUROW999 RETURN
.-----------------------------------------------------------
. Sets Year to current or to next or prev
.-----------------------------------------------------------
SETYR000  RESET     LINKYEAR
          MATCH     SP70,LINKYEAR
          GOTO      SETYR100 IF NOT EQUAL
.
          CALL      IBACLOCK
          PACK      LINKYEAR,CCC,CYY
          REP       " 0",LINKYEAR
          WRITE     HTMLFILE;LINKYEAR;
          GOTO      SETYR999
.
SETYR100  WRITE     HTMLFILE;LINKYEAR;  * Year set to Next or Previous Year
.
SETYR999  RETURN
.-----------------------------------------------------------
. Link to Next Year 
.-----------------------------------------------------------
NEXTYR00  UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          MOVE      LINKYEAR,F4
          ASSIGN    F4+ONE,F4
          MOVE      F4,KEY4
          REP       " +",DOCTCODE
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&opdlv001=",DOCTCODE:
                                 "&linkyear=",KEY4;
.
          REP       "+ ",DOCTCODE
.
NEXTYR99  RETURN
.-------------------------------------------------------------
. Link to Previous Year 
.-------------------------------------------------------------
PREVYR00  UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          MOVE      LINKYEAR,F4
          ASSIGN    F4-ONE,F4
          MOVE      F4,KEY4
          REP       " +",DOCTCODE
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&opdlv001=",DOCTCODE:
                                 "&linkyear=",KEY4;
.
          REP       "+ ",DOCTCODE
.
PREVYR99  RETURN
.-----------------------------------------------------------
. Link to Next Group of Codes 
.-----------------------------------------------------------
NEXTPR00  BRANCH    FHIRTYPE,NEXTPR10
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F4
          MOVE      F4,KEY4
          REP       " +",KEY4
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY      
          REP       " +",PRACCODE      
          REP       " +",PRACOUNT      
          REP       " +",GENPCODE      
          REP       " +",VALPTYPE      
          REP       "'~",KEYWORDS
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY4:
                                 "&norecord=",KEY2:
                                 "&pmhcl001=",GENPCODE:
                                 "&pmhcg001=",PRACCODE:
                                 "&pmhcg002=",PRACOUNT;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          WRITE     HTMLFILE;"&startkey=",STARTKEY:
                             "&actvstat=",ACTVSTAT:
                             "&hcpsstat=",HCPSSTAT:
                             "&valptype=",VALPTYPE:
                             "&keywords=",KEYWORDS:
                             "&hcpstate=",HCPSTATE;
.
          MATCH     SP70,TMOTFRST
          IF        !@EQUAL
            WRITE     HTMLFILE;"&tmotfrst=",TMOTFRST;
          ENDIF
          MATCH     SP70,TMOTNEXT
          IF        !@EQUAL
            WRITE     HTMLFILE;"&tmotnext=",TMOTNEXT;
          ENDIF
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",STARTKEY      
          REP       "+ ",PRACCODE      
          REP       "+ ",PRACOUNT      
          REP       "+ ",GENPCODE      
          REP       "+ ",VALPTYPE      
          REP       "~'",KEYWORDS
          GOTO      NEXTPR99 
.
NEXTPR10  IF        DISNUMB=NORECORD
            ASSIGN    STARTNUM+NORECORD,F6
            MOVE      F6,KEY6
            SQUEEZE   KEY6
            WRITE     HTMLFILE;*+,"nextpage=&startnum=",KEY6
          ENDIF
.
NEXTPR99  RETURN
.-----------------------------------------------------------
. Link to Prev Group Codes
.-----------------------------------------------------------
PREVPR00  BRANCH    FHIRTYPE,PREVPR10
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F4
          IF        F4<0
            MOVE      ZERO,F4
          ENDIF
          MOVE      F4,KEY4
          REP       " +",KEY4
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY      
          REP       " +",PRACCODE      
          REP       " +",PRACOUNT      
          REP       " +",GENPCODE      
          REP       " +",VALPTYPE      
          REP       "'~",KEYWORDS
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY4:
                                 "&norecord=",KEY2:
                                 "&pmhcl001=",GENPCODE:
                                 "&pmhcg001=",PRACCODE:
                                 "&pmhcg002=",PRACOUNT;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          WRITE     HTMLFILE;"&startkey=",STARTKEY:
                             "&actvstat=",ACTVSTAT:
                             "&hcpsstat=",HCPSSTAT:
                             "&valptype=",VALPTYPE:
                             "&keywords=",KEYWORDS:
                             "&hcpstate=",HCPSTATE;
.
          MATCH     SP70,TMOTFRST
          IF        !@EQUAL
            WRITE     HTMLFILE;"&tmotfrst=",TMOTFRST;
          ENDIF
          MATCH     SP70,TMOTNEXT
          IF        !@EQUAL
            WRITE     HTMLFILE;"&tmotnext=",TMOTNEXT;
          ENDIF
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",STARTKEY      
          REP       "+ ",PRACCODE      
          REP       "+ ",PRACOUNT       
          REP       "+ ",GENPCODE      
          REP       "+ ",VALPTYPE      
          REP       "~'",KEYWORDS
          GOTO      PREVPR99
.
PREVPR10  ASSIGN    STARTNUM-NORECORD,F6
          IF        F6>=0
            MOVE      F6,KEY6
            SQUEEZE   KEY6
            WRITE     HTMLFILE;*+,"prevpage=&startnum=",KEY6
          ENDIF
.
PREVPR99  RETURN
.-----------------------------------------------------------
. Link to for Redirect
.-----------------------------------------------------------
LNKSER00  UNPACK    DIM127,D1,KEY8,DIM127
          UNPACK    DIM127,D1,KEY2,DIM127
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          REP       " +",PRACCODE
          REP       " +",PRACOUNT
.
          WRITE     HTMLFILE;KEY8,".pbl?reportno=",KEY2:
                                   "&template=",FLDPARA:
                                   "&pmhcg001=",PRACCODE:
                                   "&pmhcg002=",PRACOUNT;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",PRACCODE
          REP       "+ ",PRACOUNT
.
LNKSER99  RETURN
.-----------------------------------------------------------
. Link to Another Program
.-----------------------------------------------------------
LNKPRO00  UNPACK    DIM127,D1,KEY8,DIM127
          UNPACK    DIM127,D1,KEY2,DIM127
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          REP       " +",STARTKEY
          REP       " +",GENPCODE
.
          WRITE     HTMLFILE;KEY8,".pbl?reportno=",KEY2:
                                   "&template=",FLDPARA:
                                   "&pmhcl001=",GENPCODE:
                                   "&pmhcp001=",GENPCODE:
                                   "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "+ ",GENPCODE
.
LNKPRO99  RETURN
.------------------------------------------------------------
. Table of Doctors Doctors with Leave D
.------------------------------------------------------------
DLVTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DLHED000      * Output Table Heading
.
          RESET     LINKYEAR
          MATCH     SP70,LINKYEAR
          IF        @EQUAL
            CALL      IBACLOCK
            PACK      LINKYEAR,CCC,CYY   * Set to current year
            REP       " 0",LINKYEAR
          ENDIF
.
          PACK      KEY14,SP70
          CALL      RSOPDLV1
DLVTB100  CALL      RKOPDLV1
          BRANCH    OVRCD,DLVTB900
.
          UNPACK    OPDVFDTE,KEY4,KEY5
          MATCH     LINKYEAR,KEY4
          GOTO      DLVTB100 IF NOT EQUAL
.
          CALL      DLROW000      * Display Doctors on leave row
          GOTO      DLVTB100
.
DLVTB900  CALL      NOMORE00      * Display No More Records Message
.
DLVTB999  RETURN
.------------------------------------------------------------
. Doctors on Leave (TABLE HEADING)
.------------------------------------------------------------
DLHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=25%>":
                               "<b>Doctor</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>From</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>To</b></td>":
                               "<td class=HeadingCell width=35%>":
                               "<b>Reason</b></td>":
                             "</tr>"
.
DLHED999  RETURN
.------------------------------------------------------------
. Doctors on Leave (TABLE ROW)
.------------------------------------------------------------
DLROW000  PACK      KEY6,OPDVDOCT,SP70
          CALL      RDDOCT1
          IF        OVRCD=1
            MOVE      OPDVDOCT,DOCTOR
          ENDIF
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          CLEAR     DOCTOR
          APPEND    DOCFNAME,DOCTOR 
.
          UNPACK    OPDVFDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    OPDVTDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      "DH",CATEGORY
          MOVE      OPDVREAS,CODE
          CALL      GETCOD00 
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail09":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&opdlv001=",OPDVDOCT:
                             "&opdlv002=",OPDVFDTE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             DOCTOR,"</td>":
                             "<td>",DATE,"</td><td>",KEY11,"</td>":
                             "<td>",TDESC,"</td>":
                             "</tr>"
.
DLROW999 RETURN
.------------------------------------------------------------
. Table of Leave Dates for a Doctor 
.------------------------------------------------------------
DOCTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DCHED000      * Output Table Heading
.
          RESET     LINKYEAR
          MATCH     SP70,LINKYEAR
          IF        @EQUAL
            CALL      IBACLOCK
            PACK      LINKYEAR,CCC,CYY   * Set to current year
            REP       " 0",LINKYEAR"
          ENDIF
.
          PACK      KEY14,OPDLV001,SP70
          CALL      RSOPDLV1
DOCTB100  CALL      RKOPDLV1
          BRANCH    OVRCD,DOCTB999
.
          MATCH     OPDLV001,OPDVDOCT
          GOTO      DOCTB999 IF NOT EQUAL    
.
          UNPACK    OPDVFDTE,KEY4,KEY5
          MATCH     LINKYEAR,KEY4
          GOTO      DOCTB100 IF NOT EQUAL
.
          CALL      DCROW000    
          GOTO      DOCTB100
.
DOCTB999  RETURN
.------------------------------------------------------------
. Doctor on Leave (TABLE HEADING)
.------------------------------------------------------------
DCHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "<b>From</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>To</b></td>":
                               "<td class=HeadingCell width=35%>":
                               "<b>Reason</b></td>":
                             "</tr>"
.
DCHED999  RETURN
.------------------------------------------------------------
. Doctor on Leave (TABLE ROW)
.------------------------------------------------------------
DCROW000  UNPACK    OPDVFDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    OPDVTDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      "DH",CATEGORY
          MOVE      OPDVREAS,CODE
          CALL      GETCOD00 
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLeave09":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&opdlv001=",OPDVDOCT:
                             "&opdlv002=",OPDVFDTE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             DATE,"</td><td>",KEY11,"</td>":
                             "<td>",TDESC,"</td>":
                             "</tr>"
.
DCROW999 RETURN
.------------------------------------------------------------
. Table of Linked GP's to Practices
.------------------------------------------------------------
GCLTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      GCLHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY20,PMHCG001,SP70
          CALL      RSPMHCL2
GCLTB100  CALL      RKPMHCL2
          BRANCH    OVRCD,GCLTB900
.
          MATCH     PMHCG001,PMHLHCPR
          GOTO      GCLTB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GCLTB100
          ENDIF
.
          CALL      GCLRW000      * Linked GP's Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      GCLTB100 IF NOT EQUAL
          GOTO      GCLTB999
.
GCLTB900  CALL      NOMORE00      * Display No More Records Message
.
GCLTB999  RETURN
.------------------------------------------------------------
. Linked GP's (TABLE HEADING)
.------------------------------------------------------------
GCLHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "<b>HCP Name</b></td>":
                               "<td class=HeadingCell width=35%>":
                               "<b>Date Joined Practice</b></td>":
                               "<td class=HeadingCell width=17%>":
                               "<b>Status</b></td>":
                             "</tr>"
.
GCLHD999  RETURN
.------------------------------------------------------------
. Linked GP's (TABLE ROW)
.------------------------------------------------------------
GCLRW000  PACK      KEY10,PMHLHCPC,SP70
          CALL      RDPMHCP1 
          IF        OVRCD = 1
            MOVE      PMHLHCPC,KEY35 
          ELSE
            CALL      HCPNAM00
            MOVE      DOCFNAME,KEY35
          ENDIF
.
          MOVE      "&nbsp;",KEY11          * for empty dates          *C-46418
          MATCH     SP70,PMHLJPDT
          IF        !@EQUAL
            UNPACK    PMHLJPDT,CCENT,CYEAR,CMON,CDAY  * Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MATCH     "0",PMHLSTAT
          IF        @EQUAL
            MOVE      "Active",KEY8
          ELSE
            MOVE      "Inactive",KEY8
          ENDIF 
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail07":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcg001=",PMHGPRAC:
                             "&pmhcg002=",PMHGCNTR;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          WRITE     HTMLFILE;"&pmhcl001=",PMHLHCPC:
                             "&pmhcl002=",PMHLHCPR,"#")'>":
                             "<img src='../images/MaintenanceIcon.gif' class=icon":
                             "></a>":
                             KEY35,"</td><td>",KEY11,"</td>":
                             "<td>",KEY8,"</td>":
                             "</tr>"
.
GCLRW999 RETURN
.------------------------------------------------------------
. Table of Linked Practices to a GP
.------------------------------------------------------------
GPLTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      GPLHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY20,PMHCL001,SP70
          CALL      RSPMHCL1
GPLTB100  CALL      RKPMHCL1
          BRANCH    OVRCD,GPLTB200
.
          MATCH     PMHCL001,PMHLHCPC
          GOTO      GPLTB200 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GPLTB100
          ENDIF
.
          CALL      GPLRW000      * Linked Practices to a GP Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      GPLTB100 IF NOT EQUAL
          GOTO      GPLTB900
.
GPLTB200  CALL      NOMORE00      * Display No More Records Message
.
GPLTB900  PACK      KEY10,PMHCL001,SP70 * re-position on HCP record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
          ENDIF
.
GPLTB999  RETURN
.------------------------------------------------------------
. Linked Practices to a GP (TABLE HEADING)
.------------------------------------------------------------
GPLHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=25%>":
                               "<b>Surgery</b></td>":
                               "<td class=HeadingCell width=30%>":
                               "<b>Address</b></td>":
                               "<td class=HeadingCell width=16%>":
                               "<b>Senior Partner</b></td>":
                               "<td class=HeadingCell width=9%>":
                               "<b>Status</b></td>":
                             "</tr>"
.
GPLHD999  RETURN
.------------------------------------------------------------
. Linked Practices to a GP (TABLE ROW)
.------------------------------------------------------------
GPLRW000  MOVE      SP70,KEY45
.
          PACK      KEY12,PMHLHCPR,SP70
          CALL      RSPMHCG1
          CALL      RKPMHCG1
          BRANCH    OVRCD,GPLRW999  
.
          MATCH     PMHLHCPR,PMHGPRAC
          GOTO      GPLRW999 IF NOT EQUAL
.
          STRIP     PMHGADD1
          APPEND    PMHGADD1,KEY45
          APPEND    SP1,KEY45
.
          STRIP     PMHGADD2
          APPEND    PMHGADD2,KEY45
          APPEND    SP1,KEY45
.
          STRIP     PMHGADD3
          APPEND    PMHGADD3,KEY45
          APPEND    SP1,KEY45
.
          STRIP     PMHGADD4
          APPEND    PMHGADD4,KEY45
          APPEND    SP1,KEY45
.
          STRIP     PMHGPOST           
          APPEND    PMHGPOST,KEY45
.
          RESET     KEY45
          MATCH     SP70,KEY45
          IF        @EQUAL
            MOVE      "&nbsp;",KEY45
          ENDIF           
.
          PACK      KEY10,PMHGSPCD,SP70
          CALL      RDPMHCP1 
          IF        OVRCD = 1
            MOVE      PMHGSPCD,KEY35 
          ELSE
            CALL      HCPNAM00
            MOVE      DOCFNAME,KEY35
          ENDIF
.
          MATCH     "0",PMHLSTAT
          IF        @EQUAL
            MOVE      "Active",KEY8
          ELSE
            MOVE      "Inactive",KEY8
          ENDIF 
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail08":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcl001=",PMHLHCPC:
                             "&pmhcl002=",PMHLHCPR,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMHGPNAM,"</td><td>",KEY45,"</td>":
                             "<td>",KEY35,"</td><td>",KEY8,"</td>":
                             "</tr>"
.
GPLRW999 RETURN
.------------------------------------------------------------
. Table of GP Practices
.------------------------------------------------------------
GPPTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      GPPHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      STARTKEY,KEY10
          PACK      KEY12,KEY10,STARTKE1,SP70
          CALL      RSPMHCG1
          IF        OVRCD=0
            CALL      RPPMHCG1
          ENDIF
GPPTB100  CALL      RKPMHCG1
          BRANCH    OVRCD,GPPTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GPPTB100
          ENDIF
.
          CALL      GPPRW000      * GP Practice Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      GPPTB100 IF NOT EQUAL
          GOTO      GPPTB999
.
GPPTB900  CALL      NOMORE00      * Display No More Records Message
.
GPPTB999  RETURN
.------------------------------------------------------------
. GP Practice  (TABLE HEADING)
.------------------------------------------------------------
GPPHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Practice</b></td>":
                               "<td class=HeadingCell width=18%>":
                               "<b>Count</b></td>":
                               "<td class=HeadingCell width=35%>":
                               "<b>Surgery Name</b></td>":
                             "</tr>"
.
GPPHD999  RETURN
.------------------------------------------------------------
. GP Practice (TABLE ROW)
.------------------------------------------------------------
GPPRW000  CALL      JAVHCG00             * format practice name for javascript
          BRANCH    LNK2PRT,GPPRW100,GPPRW200
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail05":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcg001=",PMHGPRAC:
                             "&pmhcg002=",PMHGCNTR;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.         
          WRITE     HTMLFILE;"#")'>":
                             "<img src='../images/MaintenanceIcon.gif'":
                             " class=Icon></a>":
                             PMHGPRAC,"</td>":
                             "<td>",PMHGCNTR,"</td>":
                             "<td>",PMHGPNAM,"</td>":
                             "</tr>"
.
          GOTO      GPPRW999
.
GPPRW100  WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td><a href=#"":
                             "javascript:updateParent05('",JAVPNAME:
                             "','",PMHGPRAC,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMHGPRAC,"</td><td>",PMHGCNTR,"</td>":
                             "<td>",PMHGPNAM,"</td>":
                             "</tr>"
          GOTO      GPPRW999
.
GPPRW200  WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td><a href=#"":
                             "javascript:updateParent0505('",JAVPNAME:
                             "','",PMHGPRAC,"','",PMHGCNTR,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMHGPRAC,"</td><td>",PMHGCNTR,"</td>":
                             "<td>",PMHGPNAM,"</td>":
                             "</tr>"
          GOTO      GPPRW999
.
GPPRW999 RETURN
+
.------------------------------------------------------------
. Search Table of Practices List by Keyword
.------------------------------------------------------------
GGSRH000  CALL      GGSHD000      * Output Table Heading
.
          IF        LNK2PRT=1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          IF        LNK2PRT=2
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,PAGEFULL         * Initialize pagefull ind  *C-0299206
          MOVE      ZERO,SNDXDONE         * Soundex shown = No       *C-0299206
          MOVE      ZERO,PRCAREND         * Num of prac in PRCARRAY[] *T0858712
          MOVE      ZERO,LOOPCNTR         * Keep alive loop counter
.
          CALL      GETWRD00
.
          STRIP     KEYWRD01
          PACK      KEY15,KEYWRD01,SP70
          MATCH     SP70,KEY15
          GOTO      GGSRH999 IF EQUAL
.
          PACK      KEY27,KEYWRD01,SP70   * Keyword for direct match *C-0299206
          GOTO      GGSRH050                                         *C-0299206
.
.         *C-0299206 - Generate Soundex key for keyword
.
GGSRH020  PACK      KEY15,KEYWRD01,SP70
          MATCH     SP70,KEY15
          GOTO      GGSRH999 IF EQUAL         * blank keyword search
.
          MOVE      KEYWRD01,SXKEYIN          * Keyword in to convert to Soundex
          CALL      GSNDX000                  * Generate Soundex key routine
          PACK      KEYWRD01,Z1,SXKEYOUT,SP70 * Add "~" to indicate Soundex key
          STRIP     KEYWRD01
          PACK      KEY27,KEYWRD01,SP70
.
GGSRH050  CALL      RSPMPKI2                                         *C-0299206
GGSRH100  CALL      RKPMPKI2
          BRANCH    OVRCD,GGSRH999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.------------------------------------------------------
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR > 100)
            WRITE     HTMLFILE;"<!-- ",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
          PACK      KEY12,PMPKHCGC,SP70
          CALL      RDPMHCG1                * read hcg table
          BRANCH    OVRCD,GGSRH100
.
          CALL      PMSPKB00
          BRANCH    EXIT,GGSRH100,GGSRH999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GGSRH100
          ENDIF
.
          MOVE      ZERO,LOOPCNTR           * Record outout reset counter
.
          CALL      GGSRW000                * Practice Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      GGSRH100
          ENDIF
.
          MOVE      ONE,PAGEFULL             * Display page is full *C-0299206
.
.         *C-0299206
.         If display page is not full and direct match has finished and show
.         Soundex in searches is turned on then loop back to generate the
.         soundex key for the keyword and read the table again to output the
.         results
.
.
GGSRH999  IF        PAGEFULL=0
            MATCH     "0",PTCSXOFF           * Show Soundex in searches?
            IF        @EQUAL
              IF        SNDXDONE=0
                MOVE      ONE,SNDXDONE       * Soundex done = yes
                GOTO      GGSRH020           * Yes, generate Soundex key
              ENDIF
            ENDIF
          CALL      NOMORE00     * Display No More Records Message
          ENDIF
.
          RETURN
.------------------------------------------------------------
. HCG's (TABLE HEADING)
.------------------------------------------------------------
GGSHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell>":
                 "<script type=#"text/javascript#">PractDescription()</script>":
                               " Name</td>":
                               "<td class=HeadingCell>":
                               "Address</td>":
                               "<td class=HeadingCell>":
                               "Contact</td>":
                             "</tr>"
.
GGSHD999  RETURN
.------------------------------------------------------------
. HCG's (TABLE ROW)
.------------------------------------------------------------
GGSRW000  CALL      JAVHCG00             * format practice name for javascript
.
          BRANCH    LNK2PRT,GGSRW200,GGSRW300
.>>>>
GGSRW100  WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td><a href=#"":
                             "javascript:updateParent('",JAVPNAME:
                             "','",PMHGPRAC:
                             "','",PMHGCNTR,"')#">":
                             PMHGPNAM:
                             "<br>(",PMHGPRAC,")</a></td>":
                             "<td>",PMHGADD1,"<br>":
                                    PMHGADD2,"<br>":
                                    PMHGADD3,"<br>":
                                    PMHGADD4,PMHGPOST,"</td>":
                             "<td>Phone:",PMHGPTEL,"<br>":
                                 "Fax:",PMHGPFAX,"</td>":
                             "</tr>"
          GOTO      GGSRW999
.
GGSRW200  WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td nowrap><a href=#"":
                             "javascript:ShowHCLDetails05('":
                              LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcg001=",PMHGPRAC:
                             "&pmhcg002=",PMHGCNTR:
                             "');#">":
                             PMHGPNAM:
                             "<br>(",PMHGPRAC,")</a></td>":
                             "<td>",PMHGADD1,"<br>":
                                    PMHGADD2,"<br>":
                                    PMHGADD3,"<br>":
                                    PMHGADD4,PMHGPOST,"</td>":
                             "<td>Phone:",PMHGPTEL,"<br>":
                                 "Fax:",PMHGPFAX,"</td>":
                             "</tr>"
          GOTO      GGSRW999
.
GGSRW300  WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td nowrap><a href=#"":
                             "javascript:UpdateHCG05('":
                              LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcg001=",PMHGPRAC:
                             "&pmhcg002=",PMHGCNTR:
                             "');#">":
                             PMHGPNAM:
                             "<br>(",PMHGPRAC,")</a>";
.
.          MATCH     "1",PTCNUNET
.          IF        @EQUAL
.            UNPACK    PMHGHPIO,DIM4,DIM4A,DIM4B,DIM4C           * HPI-O        
.            WRITE     HTMLFILE;"<br>",DIM4,SP1,DIM4A,SP1,DIM4B,SP1,DIM4C;
.          ENDIF
.
          WRITE     HTMLFILE;"</td><td>",PMHGADD1,"<br>":
                                    PMHGADD2,"<br>":
                                    PMHGADD3,"<br>":
                                    PMHGADD4,PMHGPOST,"</td>":
                             "<td>Phone:",PMHGPTEL,"<br>":
                                 "Fax:",PMHGPFAX,"</td>":
                             "</tr>"
          GOTO      GGSRW999
.
GGSRW999 RETURN
+
.------------------------------------------------------------
. Check HCG Record
.------------------------------------------------------------
PMSPKB00  MATCH     KEYWRD01,PMPKKKWD
          GOTO      PMSPKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY27,PMPKKKWD,PMPKHCGC
            CALL      PMSPKC00
            BRANCH    EXIT,PMSPKB91
            MOVE      SAVKEY27,KEY27
            CALL      RDPMPKI2
          ENDIF
.
. HCPSSTAT - Set to 0 - Show Active Practices Only
.                   1 - Show All Practices (Both Active & Inactive)
.
          MATCH     SP70,HCPSTATE          * return all states
          GOTO      PMSPKB80 IF EQUAL
.
          MATCH     HCPSTATE,PMHGSTAT       * match state
          GOTO      PMSPKB91 IF NOT EQUAL
.
PMSPKB80  COMPARE   "1",HCPSSTAT
          GOTO      PMSPKB90 IF EQUAL
.
          MATCH     "0",PMHGSTTS            * only return active practices
          GOTO      PMSPKB91 IF NOT EQUAL
.
PMSPKB90  CALL      CPRC0000            * Check if practice has       *T0858712
          BRANCH    EXIT,PMSPKB91       * been displayed before       *T0858712
.
          MOVE      ZERO,EXIT
          GOTO      PMSPKB99
.
PMSPKB91  MOVE      ONE,EXIT
          GOTO      PMSPKB99
.
PMSPKB92  MOVE      TWO,EXIT
.
PMSPKB99  RETURN
.------------------------------------------------------------
. Check for Matching Words (HCG keyword table)
.------------------------------------------------------------
PMSPKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY12,PMPKHCGC,SP70
.
PMSPKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      PMSPKC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                                KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY27,PMHGPRAC,PMHGCNTR,KEYWRDXX
          CALL      RDPMPKI1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      PMSPKC10 IF EQUAL
.
          CALL      RKPMPKI1              * Not Exact so Read Next Record
          BRANCH    OVRCD,PMSPKC90        * No Match So Exit No Match
          PACK      KEY12,PMPKHCGC,SP70
          MATCH     SAVKEY12,KEY12        * Match Key Fields
          GOTO      PMSPKC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     PMPKKKWD,KEYWRDXX     * Check Key Word
          GOTO      PMSPKC90 IF NOT EQUAL * No Match So Exit
          GOTO      PMSPKC10              * Check Next Search Word
.
PMSPKC90  MOVE      ONE,EXIT
.
PMSPKC99  RETURN
+
.------------------------------------------------------------
. *T0858712
. Check if this practice has already been output in the search
.------------------------------------------------------------
CPRC0000  MOVE       ZERO,F3
          MOVE       ZERO,EXIT
          PACK       PRCKEY12,PMHGPRAC,PMHGCNTR,SP70
.
CPRC1000  ADD        ONE,F3
          IF         F3>PRCAREND
            IF         F3>200
              GOTO       CPRC9999
            ENDIF
            MOVE       F3,PRCAREND
            MOVE       PRCKEY12,PRCARRAY[F3]
            GOTO       CPRC9999
          ENDIF
.
          MATCH      PRCKEY12,PRCARRAY[F3]
          GOTO       CPRC1000 IF NOT EQUAL
.
          MOVE       ONE,EXIT
.
CPRC9999  RETURN
.
.------------------------------------------------------------
. Table of HCPs for a Practice
.------------------------------------------------------------
GGHCP000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      PTCNHCPI,HCPFORM
.
          CALL      GGHCH000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY20,PMHCG001,SP70
          CALL      RSPMHCL2
GGHCP100  CALL      RKPMHCL2                * loop through link table
          BRANCH    OVRCD,GGHCP999
.
          MATCH     PMHCG001,PMHLHCPR
          GOTO      GGHCP999 IF NOT EQUAL
.
          IF        PTCNACGP=1
            MATCH     "0",PMHLSTAT
            IF        !@EQUAL
              GOTO      GGHCP100            * link not active for this hcp
            ENDIF
          ENDIF
.
          PACK      KEY10,PMHLHCPC
          CALL      RDPMHCP1                * get hcp details (name)
          BRANCH    OVRCD,GGHCP100
.
          IF        PTCNACGP=1
            MATCH     "0",PMHCSTTS
            IF        !@EQUAL
              GOTO      GGHCP100            * this hcp not active
            ENDIF
          ENDIF
.
          IF        HCPFORM=1 | HCPFORM=4 | HCPFORM=5
            CALL      GHCPTYPE                              * Get HCP Type
          ENDIF
.
          IF        HCPFORM=2 | HCPFORM=4 | HCPFORM=6
            CALL      GHCPSPEC                              * Get HCP Specialty
          ENDIF
.
          IF        HCPFORM=3 | HCPFORM=5 | HCPFORM=6
            CALL      GHCPROLE                              * Get HCP ROLE
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GGHCP100
          ENDIF
.
          CALL      GGHRW000      * HCP's Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      GGHCP100 IF NOT EQUAL
.
GGHCP999  RETURN
+
.------------------------------------------------------------
. Get HCP Type(pmshcpaf.pmhchcst) & display its description
.------------------------------------------------------------
GHCPTYPE  MOVE      "&nbsp;",HCPTDESC
          IF        PMHCHCST = 0
            MOVE      "Attending",HCPTDESC
          ENDIF
          IF        PMHCHCST = 1
            MOVE      "Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 2
            MOVE      "Attending & Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 3
            MOVE      "GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 4
            MOVE      "Attending and GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 5
            MOVE      "Referring and GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 6
            MOVE      "Attending Referring and GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 7
            MOVE      "Other",HCPTDESC
          ENDIF
          IF        PMHCHCST = 8
            MOVE      "Other Attending",HCPTDESC
          ENDIF
          IF        PMHCHCST = 9
            MOVE      "Other Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 10
            MOVE      "Other Attending & Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 11
            MOVE      "Attending, GP & Other",HCPTDESC
          ENDIF
          IF        PMHCHCST = 12
            MOVE      "Referring, GP & Other",HCPTDESC
          ENDIF
          IF        PMHCHCST = 13
            MOVE      "Attending, Referring, GP & Other",HCPTDESC
          ENDIF
          IF        PMHCHCST = 14
            MOVE      "Nurse",HCPTDESC
          ENDIF
          IF        PMHCHCST = 15
            MOVE      "Nurse & Other",HCPTDESC
          ENDIF
.
GHCPTY99  RETURN
+
.-----------------------------------------------------------------
. Get HCP Specialty(patdo1af.drtype) description from Category DT
.-----------------------------------------------------------------
GHCPSPEC  MOVE      SP70,SPECIALT
          MATCH     PMHCLDOC,SP70                                  
          GOTO      GHCPSP99 IF EQUAL                               
.
          PACK      KEY6,PMHCLDOC,SP70                               
          CALL      RDDOCT1                                           
          BRANCH    OVRCD,GHCPSP99          * Doctor does not exist            
.
          MOVE      "DT",CATEGORY
          MOVE      DRTYPE,CODE
          CALL      GETCOD00
          MOVE      TDESC,SPECIALT
          GOTO      GHCPSP99
.
GHCPSP99  RETURN
+
.--------------------------------------------------------------
. Get HCP Role(pmshcpaf.pmhcoslv) description from Category DL
.--------------------------------------------------------------
GHCPROLE  MOVE      SP70,HCPROLE
          MATCH     SP70,PMHCOSLV
          GOTO      GHCPRO99 IF EQUAL
.
          MOVE      "DL",CATEGORY
          MOVE      PMHCOSLV,CODE
          CALL      GETCOD00
          MOVE      TDESC,HCPROLE
          GOTO      GHCPRO99
.
GHCPRO99  RETURN
+
.------------------------------------------------------------
. HCP's for Practice (TABLE HEADING)
.------------------------------------------------------------
GGHCH000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=30%>":
                               "<b>HCP Name</b></td>";
.
          IF        HCPFORM=1 | HCPFORM=4 | HCPFORM=5
            WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                               "<b>HCP Type</b></td>";
          ENDIF
.
          IF        HCPFORM=2 | HCPFORM=4 | HCPFORM=6
            WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                               "<b>HCP Specialty</b></td>";
          ENDIF
.
          IF        HCPFORM=3 | HCPFORM=5 | HCPFORM=6
            WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                               "<b>HCP Role</b></td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "<b>Provider No</b></td>":
                             "<td class=HeadingCell width=10%>":
                             "<b>Status</b></td>":
                             "</tr>"
.
GGHCH999  RETURN
+
.------------------------------------------------------------
. HCP's for Practice (TABLE ROW)
.------------------------------------------------------------
GGHRW000  CALL      HCPNAM00
.
          CALL      JAVHCP00
          CALL      JAVHCG00             * format practice name for javascript
.
          MATCH     "0",PMHCSTTS
          IF        @EQUAL
            MOVE      "Active",KEY8
          ELSE
            MOVE      "Inactive",KEY8
          ENDIF
.
          WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td><a href=#"":
                             "javascript:updateParent('",DOCFNAME:
                             "','",PMHLHCPC:
                             "','",PMHLPRV1:
                             "','",JAVPNAME:
                             "','",PMHGPRAC:
                             "','",PMHGCNTR:
                             "','",PMHGPFAX,"')#">":
                             PMHCSNAM,",",PMHCTITL,SP1,PMHCGNAM:
                             "(",PMHLHCPC,")</a></td>";
.
          IF        HCPFORM=1 | HCPFORM=4 | HCPFORM=5
            WRITE     HTMLFILE;"<td>",HCPTDESC,"&nbsp;</td>";
          ENDIF
.
          IF        HCPFORM=2 | HCPFORM=4 | HCPFORM=6
            WRITE     HTMLFILE;"<td>",SPECIALT,"&nbsp;</td>";
          ENDIF
.
          IF        HCPFORM=3 | HCPFORM=5 | HCPFORM=6
            WRITE     HTMLFILE;"<td>",HCPROLE,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",PMHLPRV1,"&nbsp;</td>":
                             "<td>",KEY8,"</td>":
                             "</tr>"
.
GGHRW999 RETURN
+
.------------------------------------------------------------
. Table of GP's List by Code 
.------------------------------------------------------------
GPGTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      GPGHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY10,STARTKEY,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            CALL      RPPMHCP1
          ELSE
            CALL      RSPMHCP1
          ENDIF
GPGTB100  CALL      RKPMHCP1
          BRANCH    OVRCD,GPGTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GPGTB100
          ENDIF
.
          CALL      GPGRW000      * GP's Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      GPGTB100 IF NOT EQUAL
          GOTO      GPGTB999
.
GPGTB900  CALL      NOMORE00      * Display No More Records Message
.
GPGTB999  RETURN
.------------------------------------------------------------
. Table of GP's List by Name 
.------------------------------------------------------------
GPNTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      GPGHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY80,STARTKEY,SP70,SP70
          CALL      RDPMHCP2
          IF        OVRCD=0
            CALL      RPPMHCP2
          ELSE
            CALL      RSPMHCP2
          ENDIF  
GPNTB100  CALL      RKPMHCP2
          BRANCH    OVRCD,GPNTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GPNTB100
          ENDIF
.
          CALL      GPGRW000      * GP's Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      GPNTB100 IF NOT EQUAL
          GOTO      GPNTB999
.
GPNTB900  CALL      NOMORE00      * Display No More Records Message
.
GPNTB999  RETURN
.------------------------------------------------------------
. GP's (TABLE HEADING)
.------------------------------------------------------------
GPGHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Code</b></td>":
                               "<td class=HeadingCell width=35%>":
                               "<b>Name</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Type</b></td>":
                               "<td class=HeadingCell width=18%>":
                               "<b>Status</b></td>";
.
          IF        IBCNMHOS=1 & MAINTFLAG=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=12%>":
                               "Hospital Specific</td>";
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
GPGHD999  RETURN
.------------------------------------------------------------
. GP's (TABLE ROW)
.------------------------------------------------------------
GPGRW000  CALL      HCPNAM00 
.
          MATCH     "0",PMHCSTTS
          IF        @EQUAL
            MOVE      "Active",KEY8
          ELSE
            MOVE      "Inactive",KEY8
          ENDIF
.
          MOVE      "&nbsp;",HCPTDESC
          IF        PMHCHCST = 0
            MOVE      "Attending",HCPTDESC
          ENDIF
          IF        PMHCHCST = 1
            MOVE      "Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 2
            MOVE      "Attending & Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 3
            MOVE      "GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 4
            MOVE      "Attending and GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 5
            MOVE      "Referring and GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 6
            MOVE      "Attending Referring and GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 7
            MOVE      "Other",HCPTDESC
          ENDIF
          IF        PMHCHCST = 8
            MOVE      "Other Attending",HCPTDESC
          ENDIF
          IF        PMHCHCST = 9
            MOVE      "Other Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 10
            MOVE      "Other Attending & Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 11
            MOVE      "Attending, GP & Other",HCPTDESC
          ENDIF
          IF        PMHCHCST = 12
            MOVE      "Referring, GP & Other",HCPTDESC
          ENDIF
          IF        PMHCHCST = 13
            MOVE      "Attending, Referring, GP & Other",HCPTDESC
          ENDIF
          IF        PMHCHCST = 14
            MOVE      "Nurse",HCPTDESC
          ENDIF
          IF        PMHCHCST = 15
            MOVE      "Nurse & Other",HCPTDESC
          ENDIF
.
          BRANCH    LNK2PRT,GPGRW100
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail06":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMHCHCPC:
                             "&linkdoct=",PMHCLDOC:
                             "&menuflag=",MENUFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMHCHCPC,"</td><td>",DOCFNAME,"</td>":
                             "<td>",HCPTDESC,"</td>":
                             "<td>",KEY8,"</td>";
.
          IF        IBCNMHOS=1 & MAINTFLG=1
            MATCH     "1",PMHCHOSS
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>",DYES,"</td>";
            ELSE
              WRITE     HTMLFILE;"<td>",DNO,"</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
          GOTO      GPGRW999
.
GPGRW100  WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td><a href=#"":
                             "javascript:updateParent('",DOCFNAME:
                             "','",PMHCHCPC,"')#">":      
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMHCHCPC,"</td><td>",DOCFNAME,"</td>":
                             "<td>",HCPTDESC,"</td>":
                             "<td>",KEY8,"</td>";
.
          IF        IBCNMHOS=1
            MATCH     "1",PMHCHOSS
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>",DYES,"</td>";
            ELSE
              WRITE     HTMLFILE;"<td>",DNO,"</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
GPGRW999  RETURN
.-------------------------------------------------------------
. Prints out various comments that may have been recorded  
. for a doctor
.-------------------------------------------------------------
COMENT00  UNPACK    DIM127,D1,WTYPE,DIM127    * Get comment type 
.
          PACK      KEY12,DCODE,WTYPE,SP70    * Checks if there is a record 
          CALL      RDSPERS1
          CALL      RDKPERS1
          BRANCH    OVRCD,COMENT90              
.                                             * If doctor code not found   
          MATCH     DCODE,PECODE              * display alert
          GOTO      COMENT90 IF NOT EQUAL     
.
          CALL      COMTYP00                  * Gets description of WTYPE 
.
          CALL      CHEAD000                  * Display Coment-Type Html Heading
.  
          PACK      KEY12,DCODE,WTYPE,SP70    * Doctor Code found 
          CALL      RDSPERS1                  * Read relavent information
COMENT10  CALL      RDKPERS1
.
          MATCH     DCODE,PECODE
          GOTO      COMENT99 IF NOT EQUAL
.
          MATCH     PETYPE,WTYPE        * Read records until PETYPE changes 
          GOTO      COMENT99 IF NOT EQUAL      
.
          CALL      CTABL000                   * Write PETYPE description  
          GOTO      COMENT10                   * Check the next record 
.
COMENT90  WRITE     HTMLFILE;"<tr>":
                             "<td align=center><br><b> No Doctor Comments</td>":
                             "</tr>";      
.
COMENT99  RETURN
.-----------------------------------------------------------
. Sets Comment type
.----------------------------------------------------------- 
COMTYP00  MATCH     "Q",WTYPE
          IF        @EQUAL
            MOVE      QUALIFIC,DISPTYPE
          ENDIF
.
          MATCH     "O",WTYPE
          IF        @EQUAL
            MOVE      OTHRHOSP,DISPTYPE
          ENDIF
.
          MATCH     "I",WTYPE
          IF        @EQUAL
            MOVE      SPECINTR,DISPTYPE
          ENDIF
.
          MATCH     "H",WTYPE
          IF        @EQUAL
            MOVE      HOLIDAYS,DISPTYPE
          ENDIF       
.
          MATCH     "C",WTYPE
          IF        @EQUAL
            MOVE      GENRCOMM,DISPTYPE
          ENDIF
.
COMTYP99  RETURN 
.-----------------------------------------------------------
. Displays heading (Comment Type)
.-----------------------------------------------------------
CHEAD000  WRITE     HTMLFILE;"<tr><td width=23%><i>Comment Type</td>":
                             "<td><b>",DISPTYPE,"</td></tr>": 
                             "<tr><td><br><i>Comments</td></tr>";  
.
CHEAD999  RETURN
.------------------------------------------------------------
. Displays Doctor Personal details
.------------------------------------------------------------
CTABL000  WRITE     HTMLFILE;"<tr><td align=right>":
                             "<img src=../images/NoteItem.gif></td>": 
                             "<td><b>",PEDESC,"</td></tr>";      
.
CTABL999  RETURN  
.------------------------------------------------------------
. Outputs Doctor Satistics information
. html is output for Javascript graphs
.------------------------------------------------------------
STATS000  MOVE      ZERO,FORM1     * Counter 
          CALL      IBACLOCK
          PACK      CURRYEAR,CCC,CYY 
          REP       " 0",CURRYEAR
          UNPACK    DIM127,D1,DOCTYPE,DIM127      * Doctor Type 
          UNPACK    DIM127,D1,STATTYPE,DIM127     * Statistics Type
          UNPACK    DIM127,D1,OFFSETYR,DIM127     * Offset from year (1)

          MATCH     SP70,STATYEAR  * If STATYEAR is empty move CURRYEAR into it
          IF        @EQUAL
            MOVE      CURRYEAR,STATYEAR
          ENDIF
          MOVE      OFFSETYR,F1    * Current year displayed 
          MOVE      STATYEAR,F4
          SUB       F1,F4
          MOVE      F4,STATYEAR

          MATCH     "B",DOCTYPE    * If equal print both Doctor Types
          IF        @EQUAL 
            CALL      STATSQ00     * Do a sequential read on DOCTYPE (A,R)
          ELSE
            CALL      STATDR00     * Do a direct read with Doctor type set 
          ENDIF
 
          MOVE      OFFSETYR,F1    * Current year displayed 
          MOVE      STATYEAR,F4    * Reset Back Stats Year
          ADD       F1,F4
          MOVE      F4,STATYEAR
                               
STATS999  RETURN
+
.-----------------------------------------------------------
. Does direct read on PATDSTFD           called by: STATS000
.----------------------------------------------------------- 
STATDR00  CALL      CLRDST00                     * Clear stat variables
          CALL      SAVDST00                     * Clear save variables
. 
          PACK      KEY13,DOCTCODE,DOCTYPE,STATYEAR,SP30
          CALL      RDSDSTA2
STATDR10  CALL      RDKDSTA2
          BRANCH    OVRCD,STATDR50
.
          MATCH     PTDSCODE,DOCTCODE
          GOTO      STATDR50 IF NOT EQUAL
.
          MATCH     PTDSTYPE,DOCTYPE
          GOTO      STATDR50 IF NOT EQUAL
.
          MATCH     PTDSYEAR,STATYEAR
          GOTO      STATDR50 IF NOT EQUAL
.
          CALL      SVDS0000                     * Save stats to variables
.
          GOTO      STATDR10
 
STATDR50  CALL      STABLE00        * Display Javascript instruction 
. 
STATDR99  RETURN
.------------------------------------------------------------
. Does sequential read on PATDSTFD     called by: STATS000
.------------------------------------------------------------
STATSQ00  CALL      CLRDST00                     * Clear stat variables
          CALL      SAVDST00                     * Clear save variables
          MOVE      "A",DOCTYPE
          PACK      KEY13,DOCTCODE,DOCTYPE,STATYEAR,SP30
          CALL      RDSDSTA2
STATSQ10  CALL      RDKDSTA2
          BRANCH    OVRCD,STATSQ50
.
          MATCH     PTDSCODE,DOCTCODE
          GOTO      STATSQ50 IF NOT EQUAL
.
          MATCH     PTDSTYPE,DOCTYPE
          GOTO      STATSQ50 IF NOT EQUAL
.
          MATCH     PTDSYEAR,STATYEAR
          GOTO      STATSQ50 IF NOT EQUAL
.
          CALL      SVDS0000                     * Save stats to variables
.
          GOTO      STATSQ10
.
STATSQ50  CALL      SAVDST00                     * Save Attending doctor stats
          CALL      CLRDST00                     * Clear stat variables
.
          MOVE      "R",DOCTYPE
          PACK      KEY13,DOCTCODE,DOCTYPE,STATYEAR,SP30
          CALL      RDSDSTA2
STATSQ60  CALL      RDKDSTA2
          BRANCH    OVRCD,STATSQ80
.
          MATCH     PTDSCODE,DOCTCODE
          GOTO      STATSQ80 IF NOT EQUAL
.
          MATCH     PTDSTYPE,DOCTYPE
          GOTO      STATSQ80 IF NOT EQUAL
.
          MATCH     PTDSYEAR,STATYEAR
          GOTO      STATSQ80 IF NOT EQUAL
.
          CALL      SVDS0000                     * Save stats to variables
.
          GOTO      STATSQ60
.
STATSQ80  CALL      ADDDST00                     * Add Att and Ref doctor stats
.
          CALL      STABLE00                   * Outputs Javascript instruction 
.
STATSQ99  RETURN
.
CLRDST00  MOVE      ZERO,DSCDSH1    
          MOVE      ZERO,DSCDSH2    
          MOVE      ZERO,DSCDSH3    
          MOVE      ZERO,DSCDSH4    
          MOVE      ZERO,DSCDSH5    
          MOVE      ZERO,DSCDSH6    
          MOVE      ZERO,DSCDSH7    
          MOVE      ZERO,DSCDSH8    
          MOVE      ZERO,DSCDSH9    
          MOVE      ZERO,DSCDSH10   
          MOVE      ZERO,DSCDSH11   
          MOVE      ZERO,DSCDSH12   
          MOVE      ZERO,BSCDSH1    
          MOVE      ZERO,BSCDSH2    
          MOVE      ZERO,BSCDSH3    
          MOVE      ZERO,BSCDSH4    
          MOVE      ZERO,BSCDSH5    
          MOVE      ZERO,BSCDSH6    
          MOVE      ZERO,BSCDSH7    
          MOVE      ZERO,BSCDSH8    
          MOVE      ZERO,BSCDSH9    
          MOVE      ZERO,BSCDSH10   
          MOVE      ZERO,BSCDSH11   
          MOVE      ZERO,BSCDSH12   
.
          MOVE      ZERO,DSCBED1    
          MOVE      ZERO,DSCBED2    
          MOVE      ZERO,DSCBED3    
          MOVE      ZERO,DSCBED4    
          MOVE      ZERO,DSCBED5    
          MOVE      ZERO,DSCBED6    
          MOVE      ZERO,DSCBED7    
          MOVE      ZERO,DSCBED8    
          MOVE      ZERO,DSCBED9    
          MOVE      ZERO,DSCBED10   
          MOVE      ZERO,DSCBED11   
          MOVE      ZERO,DSCBED12   
          MOVE      ZERO,BSCBED1    
          MOVE      ZERO,BSCBED2    
          MOVE      ZERO,BSCBED3    
          MOVE      ZERO,BSCBED4    
          MOVE      ZERO,BSCBED5    
          MOVE      ZERO,BSCBED6    
          MOVE      ZERO,BSCBED7    
          MOVE      ZERO,BSCBED8    
          MOVE      ZERO,BSCBED9    
          MOVE      ZERO,BSCBED10   
          MOVE      ZERO,BSCBED11   
          MOVE      ZERO,BSCBED12   
.
          MOVE      ZERO,DSCOPR1    
          MOVE      ZERO,DSCOPR2    
          MOVE      ZERO,DSCOPR3    
          MOVE      ZERO,DSCOPR4    
          MOVE      ZERO,DSCOPR5    
          MOVE      ZERO,DSCOPR6    
          MOVE      ZERO,DSCOPR7    
          MOVE      ZERO,DSCOPR8    
          MOVE      ZERO,DSCOPR9    
          MOVE      ZERO,DSCOPR10   
          MOVE      ZERO,DSCOPR11   
          MOVE      ZERO,DSCOPR12   
          MOVE      ZERO,BSCOPR1    
          MOVE      ZERO,BSCOPR2    
          MOVE      ZERO,BSCOPR3    
          MOVE      ZERO,BSCOPR4    
          MOVE      ZERO,BSCOPR5    
          MOVE      ZERO,BSCOPR6    
          MOVE      ZERO,BSCOPR7    
          MOVE      ZERO,BSCOPR8    
          MOVE      ZERO,BSCOPR9    
          MOVE      ZERO,BSCOPR10   
          MOVE      ZERO,BSCOPR11   
          MOVE      ZERO,BSCOPR12   
.
          MOVE      ZERO,DSXOPR1    
          MOVE      ZERO,DSXOPR2    
          MOVE      ZERO,DSXOPR3    
          MOVE      ZERO,DSXOPR4    
          MOVE      ZERO,DSXOPR5    
          MOVE      ZERO,DSXOPR6    
          MOVE      ZERO,DSXOPR7    
          MOVE      ZERO,DSXOPR8    
          MOVE      ZERO,DSXOPR9 
          MOVE      ZERO,DSXOPR10 
          MOVE      ZERO,DSXOPR11  
          MOVE      ZERO,DSXOPR12   
          MOVE      ZERO,BSXOPR1    
          MOVE      ZERO,BSXOPR2    
          MOVE      ZERO,BSXOPR3    
          MOVE      ZERO,BSXOPR4    
          MOVE      ZERO,BSXOPR5    
          MOVE      ZERO,BSXOPR6    
          MOVE      ZERO,BSXOPR7    
          MOVE      ZERO,BSXOPR8    
          MOVE      ZERO,BSXOPR9 
          MOVE      ZERO,BSXOPR10 
          MOVE      ZERO,BSXOPR11  
          MOVE      ZERO,BSXOPR12   
CLRDST99  RETURN
.
SAVDST00  MOVE      DSCDSH1,SVCDSH1    
          MOVE      DSCDSH2,SVCDSH2    
          MOVE      DSCDSH3,SVCDSH3    
          MOVE      DSCDSH4,SVCDSH4    
          MOVE      DSCDSH5,SVCDSH5    
          MOVE      DSCDSH6,SVCDSH6    
          MOVE      DSCDSH7,SVCDSH7    
          MOVE      DSCDSH8,SVCDSH8    
          MOVE      DSCDSH9,SVCDSH9    
          MOVE      DSCDSH10,SVCDSH10   
          MOVE      DSCDSH11,SVCDSH11   
          MOVE      DSCDSH12,SVCDSH12   
          MOVE      BSCDSH1,SBCDSH1    
          MOVE      BSCDSH2,SBCDSH2    
          MOVE      BSCDSH3,SBCDSH3    
          MOVE      BSCDSH4,SBCDSH4    
          MOVE      BSCDSH5,SBCDSH5    
          MOVE      BSCDSH6,SBCDSH6    
          MOVE      BSCDSH7,SBCDSH7    
          MOVE      BSCDSH8,SBCDSH8    
          MOVE      BSCDSH9,SBCDSH9    
          MOVE      BSCDSH10,SBCDSH10   
          MOVE      BSCDSH11,SBCDSH11   
          MOVE      BSCDSH12,SBCDSH12   
.
          MOVE      DSCBED1,SVCBED1    
          MOVE      DSCBED2,SVCBED2    
          MOVE      DSCBED3,SVCBED3    
          MOVE      DSCBED4,SVCBED4    
          MOVE      DSCBED5,SVCBED5    
          MOVE      DSCBED6,SVCBED6    
          MOVE      DSCBED7,SVCBED7    
          MOVE      DSCBED8,SVCBED8    
          MOVE      DSCBED9,SVCBED9    
          MOVE      DSCBED10,SVCBED10   
          MOVE      DSCBED11,SVCBED11   
          MOVE      DSCBED12,SVCBED12   
          MOVE      BSCBED1,SBCBED1    
          MOVE      BSCBED2,SBCBED2    
          MOVE      BSCBED3,SBCBED3    
          MOVE      BSCBED4,SBCBED4    
          MOVE      BSCBED5,SBCBED5    
          MOVE      BSCBED6,SBCBED6    
          MOVE      BSCBED7,SBCBED7    
          MOVE      BSCBED8,SBCBED8    
          MOVE      BSCBED9,SBCBED9    
          MOVE      BSCBED10,SBCBED10   
          MOVE      BSCBED11,SBCBED11   
          MOVE      BSCBED12,SBCBED12   
.
          MOVE      DSCOPR1,SVCOPR1    
          MOVE      DSCOPR2,SVCOPR2    
          MOVE      DSCOPR3,SVCOPR3    
          MOVE      DSCOPR4,SVCOPR4    
          MOVE      DSCOPR5,SVCOPR5    
          MOVE      DSCOPR6,SVCOPR6    
          MOVE      DSCOPR7,SVCOPR7    
          MOVE      DSCOPR8,SVCOPR8    
          MOVE      DSCOPR9,SVCOPR9    
          MOVE      DSCOPR10,SVCOPR10   
          MOVE      DSCOPR11,SVCOPR11   
          MOVE      DSCOPR12,SVCOPR12   
          MOVE      BSCOPR1,SBCOPR1    
          MOVE      BSCOPR2,SBCOPR2    
          MOVE      BSCOPR3,SBCOPR3    
          MOVE      BSCOPR4,SBCOPR4    
          MOVE      BSCOPR5,SBCOPR5    
          MOVE      BSCOPR6,SBCOPR6    
          MOVE      BSCOPR7,SBCOPR7    
          MOVE      BSCOPR8,SBCOPR8    
          MOVE      BSCOPR9,SBCOPR9    
          MOVE      BSCOPR10,SBCOPR10   
          MOVE      BSCOPR11,SBCOPR11   
          MOVE      BSCOPR12,SBCOPR12   
.
          MOVE      DSXOPR1,SVXOPR1    
          MOVE      DSXOPR2,SVXOPR2    
          MOVE      DSXOPR3,SVXOPR3    
          MOVE      DSXOPR4,SVXOPR4    
          MOVE      DSXOPR5,SVXOPR5    
          MOVE      DSXOPR6,SVXOPR6    
          MOVE      DSXOPR7,SVXOPR7    
          MOVE      DSXOPR8,SVXOPR8    
          MOVE      DSXOPR9,SVXOPR9 
          MOVE      DSXOPR10,SVXOPR10 
          MOVE      DSXOPR11,SVXOPR11  
          MOVE      DSXOPR12,SVXOPR12   
          MOVE      BSXOPR1,SBXOPR1    
          MOVE      BSXOPR2,SBXOPR2    
          MOVE      BSXOPR3,SBXOPR3    
          MOVE      BSXOPR4,SBXOPR4    
          MOVE      BSXOPR5,SBXOPR5    
          MOVE      BSXOPR6,SBXOPR6    
          MOVE      BSXOPR7,SBXOPR7    
          MOVE      BSXOPR8,SBXOPR8    
          MOVE      BSXOPR9,SBXOPR9 
          MOVE      BSXOPR10,SBXOPR10 
          MOVE      BSXOPR11,SBXOPR11  
          MOVE      BSXOPR12,SBXOPR12   
.
SAVDST99  RETURN
.------------------------------------------------------------
ADDDST00  ADD       SVCDSH1,DSCDSH1    
          ADD       SVCDSH2,DSCDSH2    
          ADD       SVCDSH3,DSCDSH3    
          ADD       SVCDSH4,DSCDSH4    
          ADD       SVCDSH5,DSCDSH5    
          ADD       SVCDSH6,DSCDSH6    
          ADD       SVCDSH7,DSCDSH7    
          ADD       SVCDSH8,DSCDSH8    
          ADD       SVCDSH9,DSCDSH9    
          ADD       SVCDSH10,DSCDSH10   
          ADD       SVCDSH11,DSCDSH11   
          ADD       SVCDSH12,DSCDSH12   
          ADD       SBCDSH1,BSCDSH1    
          ADD       SBCDSH2,BSCDSH2    
          ADD       SBCDSH3,BSCDSH3    
          ADD       SBCDSH4,BSCDSH4    
          ADD       SBCDSH5,BSCDSH5    
          ADD       SBCDSH6,BSCDSH6    
          ADD       SBCDSH7,BSCDSH7    
          ADD       SBCDSH8,BSCDSH8    
          ADD       SBCDSH9,BSCDSH9    
          ADD       SBCDSH10,BSCDSH10   
          ADD       SBCDSH11,BSCDSH11   
          ADD       SBCDSH12,BSCDSH12   
.
          ADD       SVCBED1,DSCBED1    
          ADD       SVCBED2,DSCBED2    
          ADD       SVCBED3,DSCBED3    
          ADD       SVCBED4,DSCBED4    
          ADD       SVCBED5,DSCBED5    
          ADD       SVCBED6,DSCBED6    
          ADD       SVCBED7,DSCBED7    
          ADD       SVCBED8,DSCBED8    
          ADD       SVCBED9,DSCBED9    
          ADD       SVCBED10,DSCBED10   
          ADD       SVCBED11,DSCBED11   
          ADD       SVCBED12,DSCBED12   
          ADD       SBCBED1,BSCBED1    
          ADD       SBCBED2,BSCBED2    
          ADD       SBCBED3,BSCBED3    
          ADD       SBCBED4,BSCBED4    
          ADD       SBCBED5,BSCBED5    
          ADD       SBCBED6,BSCBED6    
          ADD       SBCBED7,BSCBED7    
          ADD       SBCBED8,BSCBED8    
          ADD       SBCBED9,BSCBED9    
          ADD       SBCBED10,BSCBED10   
          ADD       SBCBED11,BSCBED11   
          ADD       SBCBED12,BSCBED12   
.
          ADD       SVCOPR1,DSCOPR1    
          ADD       SVCOPR2,DSCOPR2    
          ADD       SVCOPR3,DSCOPR3    
          ADD       SVCOPR4,DSCOPR4    
          ADD       SVCOPR5,DSCOPR5    
          ADD       SVCOPR6,DSCOPR6    
          ADD       SVCOPR7,DSCOPR7    
          ADD       SVCOPR8,DSCOPR8    
          ADD       SVCOPR9,DSCOPR9    
          ADD       SVCOPR10,DSCOPR10   
          ADD       SVCOPR11,DSCOPR11   
          ADD       SVCOPR12,DSCOPR12   
          ADD       SBCOPR1,BSCOPR1    
          ADD       SBCOPR2,BSCOPR2    
          ADD       SBCOPR3,BSCOPR3    
          ADD       SBCOPR4,BSCOPR4    
          ADD       SBCOPR5,BSCOPR5    
          ADD       SBCOPR6,BSCOPR6    
          ADD       SBCOPR7,BSCOPR7    
          ADD       SBCOPR8,BSCOPR8    
          ADD       SBCOPR9,BSCOPR9    
          ADD       SBCOPR10,BSCOPR10   
          ADD       SBCOPR11,BSCOPR11   
          ADD       SBCOPR12,BSCOPR12   
.
          ADD       SVXOPR1,DSXOPR1    
          ADD       SVXOPR2,DSXOPR2    
          ADD       SVXOPR3,DSXOPR3    
          ADD       SVXOPR4,DSXOPR4    
          ADD       SVXOPR5,DSXOPR5    
          ADD       SVXOPR6,DSXOPR6    
          ADD       SVXOPR7,DSXOPR7    
          ADD       SVXOPR8,DSXOPR8    
          ADD       SVXOPR9,DSXOPR9 
          ADD       SVXOPR10,DSXOPR10 
          ADD       SVXOPR11,DSXOPR11  
          ADD       SVXOPR12,DSXOPR12   
          ADD       SBXOPR1,BSXOPR1    
          ADD       SBXOPR2,BSXOPR2    
          ADD       SBXOPR3,BSXOPR3    
          ADD       SBXOPR4,BSXOPR4    
          ADD       SBXOPR5,BSXOPR5    
          ADD       SBXOPR6,BSXOPR6    
          ADD       SBXOPR7,BSXOPR7    
          ADD       SBXOPR8,BSXOPR8    
          ADD       SBXOPR9,BSXOPR9 
          ADD       SBXOPR10,BSXOPR10 
          ADD       SBXOPR11,BSXOPR11  
          ADD       SBXOPR12,BSXOPR12   
.
.ADDDST99  RETURN
.------------------------------------------------------------
. Outputs Javascript instruction for each statistic type
.------------------------------------------------------------
STABLE00  MOVE      STATTYPE,F1
          BRANCH    F1,STABLE10,STABLE20,STABLE30,STABLE40:
                       STABLE50,STABLE60,STABLE70
          WRITE     HTMLFILE;" t.addRow(#"Admissions ",STATYEAR,"#",":
                            "#"",DSCDSH1,"#",#"",DSCDSH2,"#",#"",DSCDSH3,"#",":
                            "#"",DSCDSH4,"#",#"",DSCDSH5,"#",#"",DSCDSH6,"#",":
                            "#"",DSCDSH7,"#",#"",DSCDSH8,"#",#"",DSCDSH9,"#",":
                            "#"",DSCDSH10,"#",#"",DSCDSH11,"#",#"",DSCDSH12,"":
                            "#")"
          GOTO      STABLE99
.
STABLE10  WRITE     HTMLFILE;" t.addRow(#"Bed Days ",STATYEAR,"#",":
                            "#"",DSCBED1,"#",#"",DSCBED2,"#",#"",DSCBED3,"#",":
                            "#"",DSCBED4,"#",#"",DSCBED5,"#",#"",DSCBED6,"#",":
                            "#"",DSCBED7,"#",#"",DSCBED8,"#",#"",DSCBED9,"#",":
                            "#"",DSCBED10,"#",#"",DSCBED11,"#",#"",DSCBED12,"":
                            "#")"
          GOTO      STABLE99
.
STABLE20  WRITE     HTMLFILE;" t.addRow(#"Operations ",STATYEAR,"#",":
                            "#"",DSCOPR1,"#",#"",DSCOPR2,"#",#"",DSCOPR3,"#",":
                            "#"",DSCOPR4,"#",#"",DSCOPR5,"#",#"",DSCOPR6,"#",":
                            "#"",DSCOPR7,"#",#"",DSCOPR8,"#",#"",DSCOPR9,"#",":
                            "#"",DSCOPR10,"#",#"",DSCOPR11,"#",#"",DSCOPR12,"":
                            "#")"
          GOTO      STABLE99
.
STABLE30  WRITE     HTMLFILE;" t.addRow(#"MBS Ops ",STATYEAR,"#",":
                            "#"",DSXOPR1,"#",#"",DSXOPR2,"#",#"",DSXOPR3,"#",":
                            "#"",DSXOPR4,"#",#"",DSXOPR5,"#",#"",DSXOPR6,"#",":
                            "#"",DSXOPR7,"#",#"",DSXOPR8,"#",#"",DSXOPR9,"#",":
                            "#"",DSXOPR10,"#",#"",DSXOPR11,"#",#"",DSXOPR12,"":
                             "#")"
          GOTO      STABLE99
.
STABLE40  WRITE     HTMLFILE;" t.addRow(#"Admissions Budget ",STATYEAR,"#",":
                            "#"",BSCDSH1,"#",#"",BSCDSH2,"#",#"",BSCDSH3,"#",":
                            "#"",BSCDSH4,"#",#"",BSCDSH5,"#",#"",BSCDSH6,"#",":
                            "#"",BSCDSH7,"#",#"",BSCDSH8,"#",#"",BSCDSH9,"#",":
                            "#"",BSCDSH10,"#",#"",BSCDSH11,"#",#"",BSCDSH12,"":
                             "#")"
          GOTO      STABLE99
.
STABLE50  WRITE     HTMLFILE;" t.addRow(#"Bed Days Budget ",STATYEAR,"#",":
                            "#"",BSCBED1,"#",#"",BSCBED2,"#",#"",BSCBED3,"#",":
                            "#"",BSCBED4,"#",#"",BSCBED5,"#",#"",BSCBED6,"#",":
                            "#"",BSCBED7,"#",#"",BSCBED8,"#",#"",BSCBED9,"#",":
                            "#"",BSCBED10,"#",#"",BSCBED11,"#",#"",BSCBED12,"":
                             "#")"
          GOTO      STABLE99
.
STABLE60  WRITE     HTMLFILE;" t.addRow(#"Operations Budget ",STATYEAR,"#",":
                            "#"",BSCOPR1,"#",#"",BSCOPR2,"#",#"",BSCOPR3,"#",":
                            "#"",BSCOPR4,"#",#"",BSCOPR5,"#",#"",BSCOPR6,"#",":
                            "#"",BSCOPR7,"#",#"",BSCOPR8,"#",#"",BSCOPR9,"#",":
                            "#"",BSCOPR10,"#",#"",BSCOPR11,"#",#"",BSCOPR12,"":
                             "#")"
          GOTO      STABLE99
.
STABLE70  WRITE     HTMLFILE;" t.addRow(#"MBS Ops Budget ",STATYEAR,"#",":
                            "#"",BSXOPR1,"#",#"",BSXOPR2,"#",#"",BSXOPR3,"#",":
                            "#"",BSXOPR4,"#",#"",BSXOPR5,"#",#"",BSXOPR6,"#",":
                            "#"",BSXOPR7,"#",#"",BSXOPR8,"#",#"",BSXOPR9,"#",":
                            "#"",BSXOPR10,"#",#"",BSXOPR11,"#",#"",BSXOPR12,"":
                             "#")"
.
STABLE99  RETURN
+
.------------------------------------------------------------
. Outputs Period Description rather than hard code Months
.------------------------------------------------------------
PERDSC00  UNPACK    DIM127,D1,PERDCODE,DIM127      * Period Code
          MATCH     SP10,PERDCODE
          GOTO      PERDSC99 IF EQUAL
.
          MATCH     SP10,STATYEAR
          IF        @EQUAL
            CALL      IBACLOCK
            PACK      STATYEAR,CCC,CYY
            REP       " 0",STATYEAR
          ENDIF
.
          PACK      KEY6,STATYEAR,PERDCODE
          CALL      RDDRGA1
          COMPARE   ZERO,OVRCD
          GOTO      PERDSC90 IF EQUAL
.
          MOVE      SP10,DRGSDSC
          MOVE      ZERO,F2
          MOVE      PERDCODE,F2
          LOAD      DRGSDSC,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
PERDSC90  WRITE     HTMLFILE;DRGSDSC;
.
PERDSC99  RETURN
+
.------------------------------------------------------------
. Doctor Search
.------------------------------------------------------------
SDOC0000  BRANCH    FLDITMNO,SDOC0100,SDOC0200,SDOC0300,SDOC0400,SDOC0500:
                             SDOC0600,SDOC0700,SDOC0800,SDOC0900,SDOC1000:
                             SDOC1100
          GOTO      SDOC9999
.
SDOC0100  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          REP       "'~",KEYWORDS
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;"patweb99.pbl?reportno=2":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&doctstat=",DOCTSTAT:
                                 "&keywords=",KEYWORDS;
          REP       "~'",KEYWORDS
          GOTO      SDOC9999   
.
SDOC0200  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          REP       "'~",KEYWORDS
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;"patweb99.pbl?reportno=2":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&doctstat=",DOCTSTAT:
                                 "&keywords=",KEYWORDS; 
          REP       "~'",KEYWORDS
          GOTO      SDOC9999  
. 
SDOC0300  MOVE      ZERO,LNK2PRT    * Link to alternate Program
          MOVE      ZERO,MAINTFLG
          CALL      PATDKA00  
          GOTO      SDOC9999   
. 
SDOC0400  MOVE      ONE,LNK2PRT    * Link to Parent 
          MOVE      ZERO,MAINTFLG
          CALL      PATDKA00            
          GOTO      SDOC9999   
.
SDOC0500  WRITE     HTMLFILE;DOCTSTAT;
          GOTO      SDOC9999
. 
SDOC0600  MOVE      TWO,LNK2PRT    * Link to Window
          MOVE      ZERO,MAINTFLG
          CALL      PATDKA00      ,      
          GOTO      SDOC9999   
.
SDOC0700  MOVE      TWO,LNK2PRT    * Link to Window
          MOVE      ONE,MAINTFLG
          CALL      PATDKA00      ,      
          GOTO      SDOC9999   
.
.Added to skip multihospital search for PP Doctors  
.
SDOC0800  MOVE      ONE,LNK2PRT    * Link to Parent
          MOVE      ONE,MAINTFLG   
          CALL      PATDKA00
          GOTO      SDOC9999
.
SDOC0900  MOVE      ONE,LNK2PRT    * Link to Parent 
          MOVE      ZERO,MAINTFLG
          MOVE      MULTHOSP,WBSEHOSP
          CALL      PATDKA00            
          GOTO      SDOC9999   
.
SDOC1000  WRITE     HTMLFILE;KEYWORDS;
          GOTO      SDOC9999
.
SDOC1100  MOVE      ZERO,MAINTFLG
          CALL      SRCDCJ00       * json output
          GOTO      SDOC9999
.
SDOC9999  RETURN
.-------------------------------------------------------------
. HDP Doctor details 
.-------------------------------------------------------------
HDPF0000  BRANCH    FLDITMNO,HDPF0100,HDPF0200,HDPF0300,HDPF0400,HDPF0500:
                             HDPF0600,HDPF0700,HDPF0800,HDPF0900
          GOTO      HDPF9999      
.
HDPF0100  COMPARE   ZERO,HDCODE
          GOTO      HDPF9999 IF EQUAL
          WRITE     HTMLFILE;DHDCODE;
          GOTO      HDPF9999
.
HDPF0200  MATCH     SP70,HDNAME
          GOTO      HDPF9999 IF EQUAL  
          WRITE     HTMLFILE;HDNAME;
          GOTO      HDPF9999
.
HDPF0300  MOVE      "DT",CATEGORY
          MOVE      HDSERV,CODE
          CALL      CODITM00 
          GOTO      HDPF9999  
.
HDPF0400  PACK      KEY16,DOCTCODE,SP70
          CALL      RSPMTCO1
          CALL      RKPMTCO1                    * Does this doctor have comments
          BRANCH    OVRCD,HDPF0410
.
          MATCH     DOCTCODE,PMTCCODE           * Same doctor
          GOTO      HDPF0410 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;
          GOTO      HDPF9999
.
HDPF0410  WRITE     HTMLFILE;ZERO;
          GOTO      HDPF9999
.
HDPF0500  CALL      GETLV000      * Doctor leave flag 1=a record exists
          GOTO      DOCA9999
.
HDPF0600  WRITE     HTMLFILE;KEYWORDS;
          GOTO      HDPF9999
.
HDPF0700  PACK      KEY13,DOCTCODE,SP70
          CALL      RSPMDRA1
          CALL      RKPMDRA1                * Does hcp have arrangements?
          BRANCH    OVRCD,HDPF0710
.
          MATCH     DOCTCODE,PMDRDOCT       * Same hcp?
          GOTO      HDPF0710 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * arrangements exist
          GOTO      HDPF9999
.
HDPF0710  WRITE     HTMLFILE;ZERO;          * no arrangements exist
          GOTO      HDPF9999
.
HDPF0800  WRITE     HTMLFILE;NODOCTOR;      * No addition of attending doctor
          GOTO      HDPF9999
.
HDPF0900  MATCH     SP70,PMHCHCPC
          GOTO      HDPF9999 IF EQUAL
          GOTO      HDPF9999 IF EOS
.
          PACK      KEY16,PMHCHCPC,SP70
          CALL      RSPMFPH1
          CALL      RKPMFPH1
          BRANCH    OVRCD,HDPF9999
.
          MATCH     PMHCHCPC,PMFPHCPC
          GOTO      HDPF9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;
          GOTO      HDPF9999
.
HDPF9999  RETURN
.------------------------------------------------------------
. Doctor Search Results Table
.------------------------------------------------------------
PATDKA00  WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=5>":
                               "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                               "<td class=HeadingCell>Doctor</td>":
                               "<td class=HeadingCell>Specialties</td>":
                               "<td class=HeadingCell>Surgery Address</td>":
                               "<td class=HeadingCell>Phone No.</td>":
                               "<td class=HeadingCell>Status</td>":
                             "</tr>"
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
TEST0001    IF        LNK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
            UNPACK    DIM127,D1,LINKPUB,DIM127 
          ENDIF
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,DOCAREND         * Number of doctors in DOCARRAY[]   
          MOVE      PTCNHCPI,HCPFORM
          MOVE      ZERO,PAGEFULL         * Initialize pagefull ind  *C-0299206
          MOVE      ZERO,SNDXDONE         * Soundex shown = No       *C-0299206
.
          MOVE      ZERO,ETSOGFLG         * ets user flag
          MATCH     SP70,WBSEOCG
          IF        !@EQUAL
            PACK      KEY5,catw0,WBSEOCG,SP70
            CALL      RDCODE1
            IF        OVRCD<>1
              MATCH     "E",TCINDC1
              IF        @EQUAL
                MOVE      ONE,ETSOGFLG           * skip hospital check for ETS
              ENDIF
            ENDIF
          ENDIF
.
          STRIP     KEYWRD01
          PACK      KEY15,KEYWRD01,SP70
          MATCH     SP70,KEY15
          GOTO      PATDKA99 IF EQUAL
.
          PACK      KEY21,KEYWRD01,SP70   * Keyword for direct match *C-0299206
          GOTO      PATDKA05                                         *C-0299206
.
.         *C-0299206 - Generate Soundex key for keyword
.
PATDKA02  PACK      KEY15,KEYWRD01,SP70
          MATCH     SP70,KEY15
          GOTO      PATDKA99 IF EQUAL         * blank keyword search
.
          MOVE      KEYWRD01,SXKEYIN          * Keyword in to convert to Soundex
          CALL      GSNDX000                  * Generate Soundex key routine
          PACK      KEYWRD01,Z1,SXKEYOUT,SP70 * Add "~" to indicate Soundex key
          STRIP     KEYWRD01
          PACK      KEY21,KEYWRD01,SP70
.
PATDKA05  CALL      RSPTDK2                                          *C-0299206
PATDKA10  CALL      RKPTDK2
          BRANCH    OVRCD,PATDKA90
.
          MOVE      PTDKDOC,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,PATDKA10
.
          MOVE      ACTIVINH,STATUS
          MOVE      DRSTAT,F1
          LOAD      STATUS,F1,NOTACTIV,ACTIVOUT
          CALL      PATDKB00
          BRANCH    OVRCD,PATDKA10,PATDKA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PATDKA10
          ENDIF
.
          MOVE      "DT",CATEGORY
          MOVE      DRTYPE,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC01
.
          MOVE      DRTYPE2,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC02
.
          MOVE      DRTYPE3,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC03
.
          MOVE      DRTYPE4,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC04
.
          MOVE      DRTYPE5,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC05
.
          MOVE      DOCTSTAT,KEY1
          REP       " +",KEY1
.
          MOVE      DCODE,KEY6
          REP       " +",KEY6
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
.
          MOVE      SP70,DISPDAT1
          MATCH     SP70,PTDOSDAT
          IF        !@EQUAL
            UNPACK    PTDOSDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DISPDAT2
          MATCH     SP70,PTDOEDAT
          IF        !@EQUAL
            UNPACK    PTDOEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          PACK      KEY16,DCODE,SP70
          CALL      RSPMHCP4
          CALL      RKPMHCP4
          BRANCH    OVRCD,PATDKA16               * Doctor Code does not exist
.
          MATCH     DCODE,PMHCLDOC               * Valid HCP found
          GOTO      PATDKA18 IF EQUAL
.
PATDKA16  CALL      CLPMSHCP                     * Clear HCP file var
.
PATDKA18  BRANCH    LNK2PRT,PATDKA20,PATDKA30
.         
          WRITE     HTMLFILE;"<tr valign=#"top#">":
                              "<td nowrap><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&doctstat=",KEY1:     
                               "&doctcode=",KEY6,">":
                               DOCFNAME,"<br>(",DCODE,")":
                               "<br>",DPROV,"</a></td>":
                               "<td>",DESC01,"<br>",DESC02,"<br>",DESC03:
                               "<br>",DESC04,"<br>",DESC05,"</td>":
                               "<td>",DSADD1,"<br>",DSADD2,"<br>":
                                      DSADD3,"<br>",DSADD4," ",DSPOST,"</td>":
                               "<td>Surgery: ",DTELES,"<br>"; 
.                   
          MATCH     "1",LINKPUB 
          IF        !@EQUAL                      
            WRITE     HTMLFILE;"Pager  : ",DTELEP,"-",DPAGER,"<br>":
                               "Mobile : ",PTDOMOBL,"<br>";
          ENDIF 
.           
          WRITE     HTMLFILE;"Fax    : ",PTDOFAXN,"</td>":
                             "<td>",STATUS:
                             "<br>Start Date : ",DISPDAT1:
                             "<br>End Date   : ",DISPDAT2:
                             "<br>Preferred Name: ",PTDOPREF:
                             "</td>"
.
          WRITE     HTMLFILE;"</tr>" 
          GOTO      PATDKA80
.
PATDKA20  CALL      JAVDOC00
.
          WRITE     HTMLFILE;"<tr valign=#"top#">":
           "<td nowrap width=25%><table border=0 width=100%><tr><td><a href=#"":
                              "javascript:updateParent('",JAVFNAME:
                              "','",DCODE,"')#">":
                              DOCFNAME,"<br>(",DCODE,")":
                              "<br>",DPROV,"</a>";
.          MATCH     "1",PTCNUNET
.          IF        @EQUAL
.            UNPACK    PMHCNHTA,DIM4,DIM4A,DIM4B,DIM4C           * HPI-O
.            WRITE     HTMLFILE;"<br>",DIM4,SP1,DIM4A,SP1,DIM4B,SP1,DIM4C;
.          ENDIF
.
          IF        HCPFORM=1 | HCPFORM=4 | HCPFORM=5
            CALL      GHCPTYPE
            WRITE     HTMLFILE;"<br><b>Type: </b>",HCPTDESC;     * HCP Type
          ENDIF
.
          IF        HCPFORM=3 | HCPFORM=5 | HCPFORM=6
            CALL      GHCPROLE
            WRITE     HTMLFILE;"<br><b>Role: </b>",HCPROLE;      * HCP Role
          ENDIF
.
          WRITE     HTMLFILE;"</td>";
.
          CALL      GTHCCN00
.
          WRITE     HTMLFILE;"<td>",DESC01,"<br>",DESC02,"<br>",DESC03:
                              "<br>",DESC04,"<br>",DESC05,"</td>":
                              "<td>",DSADD1,"<br>",DSADD2,"<br>",DSADD3:
                             "<br>",DSADD4," ",DSPOST,"</td>":
                              "<td>Surgery: ",DTELES,"<br>";
.                   
          MATCH     "1",LINKPUB 
          IF        !@EQUAL                      
            WRITE     HTMLFILE;"Pager  : ",DTELEP,"-",DPAGER,"<br>":
                               "Mobile : ",PTDOMOBL,"<br>";
          ENDIF
.           
          WRITE     HTMLFILE;"Fax    : ",PTDOFAXN,"</td>":
                             "<td>",STATUS:
                             "<br>Start Date : ",DISPDAT1:
                             "<br>End Date   : ",DISPDAT2:
                             "<br>Preferred Name: ",PTDOPREF:
                             "</td>"
.
          WRITE     HTMLFILE;"</tr>" 
          GOTO      PATDKA80
.
PATDKA30  WRITE     HTMLFILE;"<tr valign=#"top#">":
           "<td nowrap width=25%><table border=0 width=100%><tr><td><a href=#"":
                             "javascript:showDoctor02('":
                              LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&doctstat=",KEY1:
                              "&doctcode=",KEY6:
                              "');#">":
                              DOCFNAME,"<br>(",DCODE,")":
                              "<br>",DPROV,"</a>";
.
.          MATCH     "1",PTCNUNET
.          IF        @EQUAL
.            UNPACK    PMHCNHTA,DIM4,DIM4A,DIM4B,DIM4C           * HPI-O
.            WRITE     HTMLFILE;"<br>",DIM4,SP1,DIM4A,SP1,DIM4B,SP1,DIM4C;
.          ENDIF
.
          IF        HCPFORM=1 | HCPFORM=4 | HCPFORM=5
            CALL      GHCPTYPE
            WRITE     HTMLFILE;"<br><b>Type: </b>",HCPTDESC;     * HCP Type
          ENDIF
.
          IF        HCPFORM=3 | HCPFORM=5 | HCPFORM=6
            CALL      GHCPROLE
            WRITE     HTMLFILE;"<br><b>Role: </b>",HCPROLE;      * HCP Role
          ENDIF
.
          WRITE     HTMLFILE;"</td>";
.
          CALL      GTHCCN00
.
          WRITE     HTMLFILE;"<td>",DESC01,"<br>",DESC02,"<br>",DESC03:
                             "<br>",DESC04,"<br>",DESC05,"</td>":
                             "<td>",DSADD1,"<br>",DSADD2,"<br>",DSADD3:
                             "<br>",DSADD4," ",DSPOST,"</td>":
                             "<td>Surgery: ",DTELES,"<br>";
.                   
          MATCH     "1",LINKPUB 
          IF        !@EQUAL                      
            WRITE     HTMLFILE;"Pager  : ",DTELEP,"-",DPAGER,"<br>":
                               "Mobile : ",PTDOMOBL,"<br>";
          ENDIF 
.           
          WRITE     HTMLFILE;"Fax    : ",PTDOFAXN,"</td>":
                             "<td>",STATUS:
                             "<br>Start Date : ",DISPDAT1:
                             "<br>End Date   : ",DISPDAT2:
                             "<br>Preferred Name: ",PTDOPREF;
.
          IF        IBCNMHOS=1 & MAINTFLG=1
            MATCH     "1",PTDOHOSS
            IF        @EQUAL
              WRITE     HTMLFILE;"<br>Hospital Specific : Yes";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</td></tr>"
.
PATDKA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PATDKA10 IF NOT EQUAL
.
          MOVE      ONE,PAGEFULL             * Display page is full *C-0299206
.
.         *C-0299206
.         If display page is not full and direct match has finished and show
.         Soundex in searches is turned on then loop back to generate the
.         soundex key for the keyword and read the table again to output the
.         results
.
PATDKA90  IF        PAGEFULL=0
            MATCH     "0",PTCSXOFF           * Show Soundex in searches?
            IF        @EQUAL
              IF        SNDXDONE=0
                MOVE      ONE,SNDXDONE       * Soundex done = yes
                GOTO      PATDKA02           * Yes, generate Soundex key
              ENDIF
            ENDIF
            CALL      NOMORE00
          ENDIF
.
PATDKA99  RETURN
.------------------------------------------------------------
. Check Record
.------------------------------------------------------------
PATDKB00  MATCH     KEYWRD01,PTDKKWD
          GOTO      PATDKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY21,PTDKKWD,PTDKDOC
            CALL      PATDKC00
            BRANCH    EXIT,PATDKB91
            MOVE      SAVKEY21,KEY21
            CALL      RDPTDK2
          ENDIF
.
. DOCTSTAT - Set to 0 - Show All Active Doctors
.                   1 - Show All Doctors
.                   2 - Show Active in Hospital Only
.                   3 - Show Active Outside Hospital Only
.                   4 - Show All Doctors (Active/Inactive/Attending/Referring)
.                   5 - Show All Active Doctors and Doctors Active   *C-0825792 
.                       Outside attached to HCP type Nurse/Nurse & Other 
.                       
.
          IF        IBCNMHOS=1 & MAINTFLG<>1 & ETSOGFLG<>1
            MATCH    "1",PTDOHOSS
            IF       @EQUAL
              PACK     KEY13,WBSEHOSP,DCODE,SP70
              CALL     RDMLHCP1
              BRANCH   OVRCD,PATDKB91
            ELSE
              MATCH    "1",PTCNMHCP         * Only show matching hospitals
              GOTO     PATDKB91 IF EQUAL
            ENDIF
          ENDIF
.
.---------Commented By HPS----------------
.
.          BRANCH    DOCTSTAT,PATDKB90
.          BRANCH    DRSTAT,PATDKB91,PATDKB10
.
.---------Added By HPS--------------------
.                               1        2        3        4        5
TEST0000  BRANCH    DOCTSTAT,PATDKB10,PATDKB10,PATDKB20,PATDKB90,PATDKB50

PATDKB10  COMPARE    DOCTSTAT,DRSTAT
          IF        @EQUAL
            GOTO      PATDKB90
          ELSE
            GOTO      PATDKB91  
          ENDIF
.
PATDKB20  COMPARE   ONE,DRSTAT
          GOTO      PATDKB91 IF EQUAL
          GOTO      PATDKB90 IF NOT EQUAL                       *C-0825792-START
.
.         DOCTSTAT = 5
PATDKB50  COMPARE   ZERO,DRSTAT              * Active?
          GOTO      PATDKB90 IF EQUAL        * Yes,check if needs to display
.
          COMPARE   TWO,DRSTAT               * Active outside?
          GOTO      PATDKB91 IF NOT EQUAL    * No,exit
.                                            * Yes, read pmshcpaf for dcode
          MOVE      ZERO,COUNTER               * Initialize counter
          PACK      KEY16,DCODE,SP70           * Position cursor to read from  
          CALL      RSPMHCP4                     * dcode on pmshcpaf table
PATDKB51  CALL      RKPMHCP4                   * Read next pmshcpaf record
          BRANCH    OVRCD,PATDKB91             * End of file, exit
.
          MATCH     DCODE,PMHCLDOC           * Same doctor code?
          GOTO      PATDKB52 IF EQUAL        * Yes, check nurse type
.
          COMPARE   ZERO,COUNTER             * No, is this the first record?
          GOTO      PATDKB91 IF NOT EQUAL      * No, exit
.                                              * Yes, first record then
          CALL      RPPMHCP4                     * Read previous record 
          MATCH     PMHCLDOC,DCODE               * Same doctor code? 
          GOTO      PATDKB52 IF EQUAL            * Yes, check nurse type
          GOTO      PATDKB91 IF NOT EQUAL        * No, exit
.
PATDKB52  IF        PMHCHCST = 14 | PMHCHCST = 15
            GOTO      PATDKB90           * Nurse type, check if needs to display
          ELSE
            ADD       ONE,COUNTER        * Not Nurse type, increment counter
            GOTO      PATDKB51           * Read next pmshcpaf record
          ENDIF     
.                                                               *C-0825792-END
PATDKB90  CALL      CDOC0000                * Checko if doctor has been 
          BRANCH    EXIT,PATDKB91           * displayed before
.
          MOVE      ZERO,OVRCD
          GOTO      PATDKB99
.
PATDKB91  MOVE      ONE,OVRCD
          GOTO      PATDKB99
.
PATDKB92  MOVE      TWO,OVRCD
.
PATDKB99  RETURN
.
.------------------------------------------------------------
. Check if this doctor has already been output in the search 
.------------------------------------------------------------
CDOC0000  MOVE       ZERO,F3
          MOVE       ZERO,EXIT
.
CDOC1000  ADD        ONE,F3
          IF         F3>DOCAREND
            IF         F3>200
              GOTO       CDOC9999
            ENDIF      
            MOVE       F3,DOCAREND
            MOVE       DCODE,DOCARRAY[F3]
            GOTO       CDOC9999
          ENDIF      
.
          MATCH      DCODE,DOCARRAY[F3]
          GOTO       CDOC1000 IF NOT EQUAL
.
          MOVE       ONE,EXIT
.
CDOC9999  RETURN
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
PATDKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY6,PTDKDOC,SP70
.
PATDKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      PATDKC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY21,PTDKDOC,KEYWRDXX
          CALL      RDPTDK1               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      PATDKC10 IF EQUAL
.
          CALL      RKPTDK1               * Not Exact so Read Next Record
          BRANCH    OVRCD,PATDKC90        * No Match So Exit No Match
          PACK      KEY6,PTDKDOC,SP70
          MATCH     SAVKEY6,KEY6          * Match Key Fields
          GOTO      PATDKC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     PTDKKWD,KEYWRDXX         * Check Key Word
          GOTO      PATDKC90 IF NOT EQUAL * No Match So Exit
          GOTO      PATDKC10              * Check Next Search Word
.
PATDKC90  MOVE      ONE,EXIT
.
PATDKC99  RETURN 
.------------------------------------------------------------
. Display HCP Details
.------------------------------------------------------------
GETHCP00  MOVE      GENPCODE,KEY10
          CALL      RDPMHCP1
          IF        OVRCD=1
            CALL      CLPMSHCP                   * clear if no hcp
            CLEAR     WEBTITLE
            APPEND    "Practice Information",WEBTITLE
            RESET     WEBTITLE
          ELSE
            CALL      HCPNAM00
            CLEAR     WEBTITLE
            APPEND    DOCFNAME,WEBTITLE
            APPEND    " (HCP Information)",WEBTITLE
            RESET     WEBTITLE
          ENDIF
.
          PACK      GENPPRAC,GENPPRAC,SP70
          MATCH     GENPPRAC,SP70
          IF        @EQUAL
            CALL      CLPMSHCL                   * clear as no link
            CALL      CLPMSHCG                   * clear as no practice
            GOTO      GETHCP50
          ENDIF
.
          PACK      KEY20,GENPCODE,GENPPRAC
          CALL      RDPMHCL1                     * check for linked practice
          IF        OVRCD=1
            CALL      CLPMSHCL                   * clear if no link
          ENDIF
.
          PACK      KEY12,GENPPRAC,GENPPCNT
          CALL      RDPMHCG1                     * get practice details
          IF        OVRCD=1
            CALL      CLPMSHCG                   * clear if no practice
          ENDIF
.
GETHCP50  CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GETHCP99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
GETHCP99  RETURN
.------------------------------------------------------------
. Search Table of GP's List by Name 
.------------------------------------------------------------
GPSRH000  BRANCH    FHIRTYPE,GPSRH010 
          IF        JSONOUTF=0
            CALL      GPSHD000      * Output Table Heading
          ELSE
            WRITE     HTMLFILE;"[ ";
          ENDIF
.
          IF        LNK2PRT=1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          IF        LNK2PRT=2
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
GPSRH010  IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,HCPAREND         * Number of HCPs in HCPARRAY[]
          MOVE      ZERO,PAGEFULL         * Initialize pagefull ind  *C-0299206
          MOVE      ZERO,SNDXDONE         * Soundex shown = No       *C-0299206
.
          CALL      GETWRD00
.
          STRIP     KEYWRD01
          PACK      KEY15,KEYWRD01,SP70
          MATCH     SP70,KEY15
          GOTO      GPSRH999 IF EQUAL
.
          PACK      KEY25,KEYWRD01,SP70   * Keyword for direct match *C-0299206
          GOTO      GPSRH050                                         *C-0299206 
.
.         *C-0299206 - Generate Soundex key for keyword
.
GPSRH020  PACK      KEY15,KEYWRD01,SP70
          MATCH     SP70,KEY15
          GOTO      GPSRH999 IF EQUAL         * blank keyword search
.
          MOVE      KEYWRD01,SXKEYIN          * Keyword in to convert to Soundex
          CALL      GSNDX000                  * Generate Soundex key routine
          PACK      KEYWRD01,Z1,SXKEYOUT,SP70 * Add "~" to indicate Soundex key
          STRIP     KEYWRD01
          PACK      KEY25,KEYWRD01,SP70     
.
GPSRH050  MOVE      ZERO,OVRCD         * The isclear in the keyword  *C-0299206
          TRAP      OVERCOND IF IO     * generation can cause a P * K
          CALL      RSPMHKI2
          TRAPCLR   IO
          BRANCH    OVRCD,GPSRH999
.
GPSRH100  MOVE      ZERO,OVRCD              * The isclear in the keyword
          TRAP      OVERCOND IF IO          * generation can cause a P * K
          CALL      RKPMHKI2
          TRAPCLR   IO
          BRANCH    OVRCD,GPSRH999
.
          PACK      KEY10,PMHKHCPC,SP70
          CALL      RDPMHCP1                * read hcp table
          BRANCH    OVRCD,GPSRH100
.
          IF        ASSRINDC=ONE
            MATCH     SP70,PMHCPRV5
            IF        @EQUAL
              GOTO      GPSRH100
            ENDIF
          ENDIF
.
          CALL      PMSHKB00
          BRANCH    EXIT,GPSRH100,GPSRH999
.
          MOVE      PMHCADR1,PRACNAME       * use hcp details
          MOVE      PMHCADR2,PRACADD1
          MOVE      SP70,PRACADD2
          MOVE      PMHCADR3,PRACADD3
          MOVE      PMHCADR4,PRACADD4
          MOVE      PMHCPOST,PRACPOST
          MOVE      PMHCSEML,PRACPEML
          MOVE      PMHCSTEL,PRACPTEL
          MOVE      PMHCFAXN,PRACPFAX
          MOVE      PMHCPRV1,PRACPROV
          PACK      DISPPRAC,SP70
          PACK      DISPPNAM,SP70,SP70
          PACK      DISPPCNT,SP70
.
          MOVE      ZERO,LPRACFLG           * linked practices flag
          PACK      KEY20,PMHCHCPC,SP70
          CALL      RSPMHCL1
GPSRH150  CALL      RKPMHCL1                * read link table to get practice(s)
          IF        OVRCD=1
            MOVE      ONE,LPRACFLG          * no linked practices exist for hcp
            GOTO      GPSRH300
          ENDIF
          MATCH     PMHCHCPC,PMHLHCPC
          IF        !@EQUAL
            MOVE      ONE,LPRACFLG          * no linked practices exist for hcp
            GOTO      GPSRH300
          ENDIF
.
          IF        PTCNACGP=1
            MATCH     "0",PMHLSTAT          * if condtion MAINTFLG<>1 removed 
            IF        !@EQUAL
              GOTO      GPSRH150            * link not active for this practice
            ENDIF
          ENDIF
.
          PACK      KEY20,PMHCHCPC,SP70
          CALL      RSPMHCL1
GPSRH200  CALL      RKPMHCL1                * read link table to get practice(s)
          IF        OVRCD=1
            GOTO      GPSRH100              * no more practices
          ENDIF
.
          MATCH     PMHCHCPC,PMHLHCPC
          IF        !@EQUAL
            GOTO      GPSRH100              * no more practices
          ENDIF
.
          IF        PTCNACGP=1
            MATCH     "0",PMHLSTAT          * if condtion MAINTFLG<>1 removed
            IF        !@EQUAL
              GOTO      GPSRH200            * link not active for this practice
            ENDIF
          ENDIF
.
          PACK      KEY12,PMHLHCPR,SP70
          CALL      RSPMHCG1
GPSRH250  CALL      RKPMHCG1                * get details for each practice
          BRANCH    OVRCD,GPSRH200
.
          MATCH     PMHLHCPR,PMHGPRAC
          GOTO      GPSRH200 IF NOT EQUAL   * linked practice code not on table
.
          IF        PTCNACGP=1 & MAINTFLG<>1
            MATCH     "0",PMHGSTTS
            IF        !@EQUAL
              GOTO      GPSRH250            * this practice not active
            ENDIF
          ENDIF
.
          MOVE      PMHGPNAM,PRACNAME       * use practice details
          MOVE      PMHGADD1,PRACADD1
          MOVE      PMHGADD2,PRACADD2
          MOVE      PMHGADD3,PRACADD3
          MOVE      PMHGADD4,PRACADD4
          MOVE      PMHGPOST,PRACPOST
          MOVE      PMHGPEML,PRACPEML
          MOVE      PMHGPTEL,PRACPTEL
          MOVE      PMHGPFAX,PRACPFAX
          MOVE      PMHLPRV1,PRACPROV
          MOVE      PMHGPRAC,DISPPRAC
          MOVE      PMHGPNAM,DISPPNAM
          MOVE      PMHGCNTR,DISPPCNT
.
GPSRH300  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            IF        LPRACFLG=1
              GOTO      GPSRH100            * no linked practices
            ELSE
              GOTO      GPSRH250            * linked practices
            ENDIF
          ENDIF
.
          CALL      GPSRW000                * GP's Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            IF        LPRACFLG=1
              GOTO      GPSRH100            * no linked practices
            ELSE
              GOTO      GPSRH250            * linked practices
            ENDIF
          ENDIF
.
          MOVE      ONE,PAGEFULL             * Display page is full *C-0299206
.
.         *C-0299206 
.         If display page is not full and direct match has finished and show 
.         Soundex in searches is turned on then loop back to generate the
.         soundex key for the keyword and read the table again to output the
.         results
.
GPSRH999  IF        PAGEFULL=0                                          
            MATCH     "0",PTCSXOFF           * Show Soundex in searches?
            IF        @EQUAL
              IF        SNDXDONE=0
                MOVE      ONE,SNDXDONE       * Soundex done = yes
                GOTO      GPSRH020           * Yes, generate Soundex key
              ENDIF
            ENDIF
          ENDIF
.
          IF        JSONOUTF=1
            WRITE     HTMLFILE;"] ";
          ENDIF
          RETURN
.------------------------------------------------------------
. HCP's (TABLE HEADING)
.------------------------------------------------------------
GPSHD000  IF         LNK2PRT = 1
            WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=5>":
                               "You Searched for ":
                                KEYWORDS,"</td>":
                               "</tr>"
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell>":
                               "HCP Name and Type</td>":
                               "<td class=HeadingCell>";
.
          IF        SPLTYFLG=ONE
            WRITE     HTMLFILE;"Specialties</td>":
                                 "<td class=HeadingCell>";
          ENDIF
.
          WRITE     HTMLFILE;"Address</td>":
                               "<td class=HeadingCell>":
                               "Contact</td>";
.
          IF        IBCNMHOS=1 & MAINTFLG=1
              WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                                 "Hospital Specific</td>";
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
GPSHD999  RETURN
.------------------------------------------------------------
. HCP's (TABLE ROW)
.------------------------------------------------------------
GPSRW000  CALL      HCPNAM00
.
          MOVE      PTCNHCPI,HCPFORM
.
          CALL      JAVHCP00
          MOVE      DISPPNAM,PMHGPNAM       * format for javascript
          CALL      JAVHCG00
.
          BRANCH    FHIRTYPE,GPSRW600
          BRANCH    JSONOUTF,GPSRW500
          BRANCH    LNK2PRT,GPSRW200,GPSRW300
.>>>>
GPSRW100  REP       "( ",PRACPFAX
          REP       ") ",PRACPFAX
          WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td><a href=#"":
                             "javascript:updateParent('",DOCFNAME:
                             "','",PMHCHCPC:
                             "','",PRACPROV:
                             "','",JAVPNAME:
                             "','",DISPPRAC:
                             "','",DISPPCNT:
                             "','",PRACPFAX,"')#">":
                             PMHCSNAM,",",PMHCTITL,SP1,PMHCGNAM:
                             "<br>(",PMHCHCPC,")<br>":
                                    PRACPROV,"</a>";
.
.          MATCH     "1",PTCNUNET
.          IF        @EQUAL
.            UNPACK    PMHCNHTA,DIM4,DIM4A,DIM4B,DIM4C           * HPI-O
.            WRITE     HTMLFILE;"<br>",DIM4,SP1,DIM4A,SP1,DIM4B,SP1,DIM4C;
.          ENDIF
.
          IF        HCPFORM=1 | HCPFORM=4 | HCPFORM=5
            CALL      GHCPTYPE 
            WRITE     HTMLFILE;"<br><b>Type: </b>",HCPTDESC;     * HCP Type
          ENDIF
.
          IF        HCPFORM=3 | HCPFORM=5 | HCPFORM=6
            CALL      GHCPROLE
            WRITE     HTMLFILE;"<br><b>Role: </b>",HCPROLE;      * HCP Role
          ENDIF
.
          IF        HCPFORM=2 | HCPFORM=4 | HCPFORM=6
            CALL      GHCPSPEC
            WRITE     HTMLFILE;"<br><b>Specialty: </b>",SPECIALT;*HCP Specialty
          ENDIF
.
         WRITE     HTMLFILE;"</td>":
                             "<td>",PRACNAME,"<br>":
                                    PRACADD1,"<br>":
                                    PRACADD2,"<br>":
                                    PRACADD3,"<br>":
                                    PRACADD4,PRACPOST,"</td>":
                             "<td>Phone:",PRACPTEL,"<br>":
                                 "Fax:",PRACPFAX,"<br>":
                                 "Mobile:",PMHCMOBN,"<br><br>":
                                 "Preferred Name:",PMHCPRFN,"</td>":
                             "</tr>"
          GOTO      GPSRW999
.
GPSRW200  WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td nowrap><a href=#"":
                             "javascript:showHCP02('":
                              LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&genpcode=",PMHCHCPC:
                             "');#">":
                             PMHCSNAM,",",PMHCTITL,SP1,PMHCGNAM:
                             "<br>(",PMHCHCPC,")<br>":
                                    PRACPROV,"</a>";
.
.          MATCH     "1",PTCNUNET
.          IF        @EQUAL
.            UNPACK    PMHCNHTA,DIM4,DIM4A,DIM4B,DIM4C           * HPI-O
.            WRITE     HTMLFILE;"<br>",DIM4,SP1,DIM4A,SP1,DIM4B,SP1,DIM4C;
.          ENDIF
.
          IF        HCPFORM=1 | HCPFORM=4 | HCPFORM=5
            CALL      GHCPTYPE
            WRITE     HTMLFILE;"<br><b>Type: </b>",HCPTDESC;     * HCP Type
          ENDIF
.
          IF        HCPFORM=3 | HCPFORM=5 | HCPFORM=6
            CALL      GHCPROLE
            WRITE     HTMLFILE;"<br><b>Role: </b>",HCPROLE;      * HCP Role
          ENDIF
.
          IF        HCPFORM=2 | HCPFORM=4 | HCPFORM=6
            CALL      GHCPSPEC
            WRITE     HTMLFILE;"<br><b>Specialty: </b>",SPECIALT;*HCP Specialty
          ENDIF
.
          WRITE     HTMLFILE;"</td>";
.
          IF        SPLTYFLG=ONE
            WRITE     HTMLFILE;"<td>";
.
            MATCH     SP70,PMHCSPC1
            IF        !@EQUAL
              MOVE      "DT",CATEGORY
              MOVE      PMHCSPC1,CODE
              CALL      GETCOD00
              WRITE     HTMLFILE;TDESC,"<br>";
            ENDIF
.
            MATCH     SP70,PMHCSPC2
            IF        !@EQUAL
              MOVE      "DT",CATEGORY
              MOVE      PMHCSPC2,CODE
              CALL      GETCOD00
              WRITE     HTMLFILE;TDESC,"<br>";
            ENDIF
.
            MATCH     SP70,PMHCSPC3
            IF        !@EQUAL
              MOVE      "DT",CATEGORY
              MOVE      PMHCSPC3,CODE
              CALL      GETCOD00
              WRITE     HTMLFILE;TDESC,"<br>";
            ENDIF
.
            MATCH     SP70,PMHCSPC4
            IF        !@EQUAL
              MOVE      "DT",CATEGORY
              MOVE      PMHCSPC4,CODE
              CALL      GETCOD00
              WRITE     HTMLFILE;TDESC,"<br>";
            ENDIF
.
            MATCH     SP70,PMHCSPC5
            IF        !@EQUAL
              MOVE      "DT",CATEGORY
              MOVE      PMHCSPC5,CODE
              CALL      GETCOD00
              WRITE     HTMLFILE;TDESC,"<br>";
            ENDIF
.
            WRITE     HTMLFILE;"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",PRACNAME,"<br>":
                                    PRACADD1,"<br>":
                                    PRACADD2,"<br>":
                                    PRACADD3,"<br>":
                                    PRACADD4,PRACPOST,"</td>":
                             "<td>Phone:",PRACPTEL,"<br>":
                                 "Fax:",PRACPFAX,"<br>":
                                 "Mobile:",PMHCMOBN,"<br><br>":
                                 "Preferred Name:",PMHCPRFN,"</td>";
.
          IF        IBCNMHOS=1 & MAINTFLG=1
            MATCH     "1",PMHCHOSS
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>",DYES,"</td>";
            ELSE
              WRITE     HTMLFILE;"<td>",DNO,"</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</tr>" 
          GOTO      GPSRW999
.
GPSRW300  WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td nowrap><a href=#"":
                             "javascript:UpdateHCP02('":
                              LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMHCHCPC:
                             "&linkdoct=",PMHCLDOC:
                             "');#">":
                             PMHCSNAM,",",PMHCTITL,SP1,PMHCGNAM:
                             "<br>(",PMHCHCPC,")<br>":
                                    PRACPROV,"</a>";
.
.          MATCH     "1",PTCNUNET
.          IF        @EQUAL
.            UNPACK    PMHCNHTA,DIM4,DIM4A,DIM4B,DIM4C           * HPI-O
.            WRITE     HTMLFILE;"<br>",DIM4,SP1,DIM4A,SP1,DIM4B,SP1,DIM4C;
.          ENDIF
.
          IF        HCPFORM=1 | HCPFORM=4 | HCPFORM=5
            CALL      GHCPTYPE 
            WRITE     HTMLFILE;"<br><b>Type: </b>",HCPTDESC;     * HCP Type
          ENDIF
.
          IF        HCPFORM=3 | HCPFORM=5 | HCPFORM=6
            CALL      GHCPROLE
            WRITE     HTMLFILE;"<br><b>Role: </b>",HCPROLE;      * HCP Role
          ENDIF
.
          IF        HCPFORM=2 | HCPFORM=4 | HCPFORM=6
            CALL      GHCPSPEC
            WRITE     HTMLFILE;"<br><b>Specialty: </b>",SPECIALT;*HCP Specialty
          ENDIF
.
          WRITE     HTMLFILE;"</td><td>",PRACNAME,"<br>":
                                    PRACADD1,"<br>":
                                    PRACADD2,"<br>":
                                    PRACADD3,"<br>":
                                    PRACADD4,PRACPOST,"</td>":
                             "<td>Phone:",PRACPTEL,"<br>":
                                 "Fax:",PRACPFAX,"<br>":
                                 "Mobile:",PMHCMOBN,"<br><br>":
                                 "Preferred Name:",PMHCPRFN,"</td>";
.
          IF        IBCNMHOS=1 & MAINTFLG=1
            MATCH     "1",PMHCHOSS
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>",DYES,"</td>";
            ELSE
              WRITE     HTMLFILE;"<td>",DNO,"</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
          GOTO      GPSRW999
.
. JSON Format Output
.--------------------------------------------------
GPSRW500 WRITE      HTMLFILE;"{#"doctcode#":#"",PMHCHCPC,"#",":
                             "#"doctorName#":#"",DOCFNAME,"#",":
                             "#"providerNumber#":#"",PRACPROV,"#",":
                             "#"address1#":#"",PRACADD1,"#",":
                             "#"address2#":#"",PRACADD2,"#",":
                             "#"address3#":#"",PRACADD3,"#",":
                             "#"address4#":#"",PRACADD4,"#",":
                             "#"telephone#":#"",PRACPTEL,"#",":
                             "#"mobile#":#"",PMHCMOBN,"#",":
                             "#"fax#":#"",PRACPFAX,"#",":
                             "#"post#":#"",PRACPOST,"#"},";
.
. FHIR Format Output
.--------------------------------------------------
GPSRW600  IF        DISNUMB>0
            WRITE     HTMLFILE;",";
          ENDIF
          WRITE     HTMLFILE;*+,"{ #"fullUrl#" : #"%BASEURL/Practitioner/HCP-",PMHCHCPC,"#", ":
                                " #"resource#" : ";
          CALL      RESPRA00
          WRITE     HTMLFILE;*+," } "
GPSRW999 RETURN
.
RESPRA00  MOVE      "DT",TCODE
          PACK      KEY5,TCODE,PMHCSPC1,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      SP70,TDESC
          ENDIF
          CALL      HCPNAM00      
          WRITE     HTMLFILE;*+," { #"resourceType#": #"Practitioner#",":
                    "   #"id#": #"HCP-",PMHCHCPC,"#",":
                    " #"extension#": [":
                    " { #"url#":#"%BASEURL/extension/webPASService#"":
                        " ,#"valueString#":#"",PRGID,SP1,PRGNAM,SP1,VERSION,"#"},":
                    " { #"url#":#"%BASEURL/extension/webPASTemplate#"":
                        " ,#"valueString#":#"%TEMPLATEHOME/",WBTPFIL," %TEMPLATEVERSION#"},":
                    " { #"url#":#"%BASEURL/extension/dxc-hc-speciality#"":
                        " ,#"valueString#":#"",TDESC,"#"}":
                    " ],":
                    " #"identifier#": [ ":
                    "  {#"type#": { #"text#" : #"HCP ID#" },":
                    "   #"value#": #"",PMHCHCPC,"#" },":
                    "  {#"type#": { #"text#" : #"Provider Number#" },":
                    "   #"value#": #"",PRACPROV,"#" }":
                    "    ] ,":
                    " #"name#": [ { ":
                    "  #"use#": #"usual#",":
                    "  #"text#": #"",DOCFNAME,"#" ,":
                    "  #"prefix#":[ #"",PMHCTITL,"#" ],":
                    "  #"given#": [ #"",PMHCGNAM,"#" ],":
                    "  #"family#": #"",PMHCSNAM,"#" } ],":
                    "  #"telecom#": [ ":
                    "   { #"system#": #"phone#", #"use#": #"work#", ":
                    "     #"value#": #"",PRACPTEL,"#" },":
                    "   { #"system#": #"email#", #"use#": #"work#", ":
                    "     #"value#": #"",PRACPEML,"#" },":
                    "   { #"system#": #"phone#", #"use#": #"mobile#", ":
                    "     #"value#": #"",PMHCMOBN,"#" },":
                    "   { #"system#": #"fax#",   #"use#": #"work#", ":
                    "     #"value#": #"",PRACPFAX,"#" } ],":
                    " #"address#": [ {":
                    "  #"use#": #"work#",":
                    "  #"line#": [#"",PRACNAME,"#"":
                    ",#"",PRACADD1,"#"";
          MATCH     SP70,PRACADD2
          IF        !@EQUAL
            STRIP     PRACADD2
            WRITE     HTMLFILE;*+,",#"",PRACADD2,"#"";
          ENDIF
          WRITE     HTMLFILE;*+,"],":
                      "       #"city#": #"",PRACADD3,"#",":
                      "       #"state#": #"",PRACADD4,"#",":
                      "       #"postalCode#": #"",PRACPOST,"#"":
                      "      }":
                      "    ]";
          WRITE     HTMLFILE;*+,"  }";
          RETURN
.------------------------------------------------------------
. Check Record
.------------------------------------------------------------
PMSHKB00  MATCH     KEYWRD01,PMHKKKWD
          GOTO      PMSHKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY25,PMHKKKWD,PMHKHCPC
            CALL      PMSHKC00
            BRANCH    EXIT,PMSHKB91
            MOVE      SAVKEY25,KEY25
            CALL      RDPMHKI2
          ENDIF
.
. HCPSSTAT - Set to 0 - Show All HCP (Active Only)
.                   1 - Show Active Attending HCP
.                   2 - Show Active Referring HCP
.                   3 - Show Active GP HCP 
.                   4 - Show Active Other HCP 
.                   5 - Show All HCP (Both Active & Inactive all types)
.                   6 - Show Active Exclude GP
.                   7 - Show Other
.                   8 - Show Other Attending  
.                   9 - Show Other Referring  
.                  10 - Show Other Attending and Referring
.                  11 - Show Active Attending, Referring and Att.&Ref.HCP
.                  12 - Show HCP for Mental Healths(Doc.Type catg DT,TCINDC1='L'
.                  13 - Show All HCP (Inactive Only)
.                  14 - Show Active Nurses
.                  15 - Show Attending & Nurse
.                  16 - Show Related Provider
.                  17 - Show All Attending HCP (Both Active & Inactive)
.                  18 - Show Inactive Attending
.                  19 - Show Inactive Referring
.                  20 - Show Inactive GP
.                  21 - Show Inactive Other
.                  22 - Show Inactive Nurses
.
          COMPARE   "0",HCPSSTAT
          GOTO      PMSHKB05 IF EQUAL
.
          IF        IBCNMHOS=1 & MAINTFLG<>1 & VALDALLH<>1
            MATCH    "1",PMHCHOSS
            IF       @EQUAL
              PACK     KEY13,WBSEHOSP,PMHCHCPC,SP70
              CALL     RDMLHCP1
              BRANCH   OVRCD,PMSHKB91
            ELSE
              MATCH    "1",PTCNMHCP         * Only show matching hospitals
              GOTO     PMSHKB91 IF EQUAL
            ENDIF
          ENDIF
.
          COMPARE   "5",HCPSSTAT
          GOTO      PMSHKB90 IF EQUAL
.
          COMPARE   "13",HCPSSTAT
          GOTO      PMSHKB82 IF EQUAL
.
PMSHKB04  COMPARE   "17",HCPSSTAT
          GOTO      PMSHKB83 IF EQUAL          * display active and inactive
.
          IF        (HCPSSTAT > 17) & (HCPSSTAT < 23)
            MATCH     "1",PMHCSTTS
            IF        @EQUAL
              GOTO      PMSHKB06               * inactive, so continue
            ELSE
              GOTO      PMSHKB91               * active, so finish
            ENDIF
          ENDIF
.
PMSHKB05  IF        ACTVSTAT=0
            MATCH     "0",PMHCSTTS
            GOTO      PMSHKB91 IF NOT EQUAL    * display active only
          ENDIF
.
          IF        ACTVSTAT=1
            MATCH     "1",PMHCSTTS
            GOTO      PMSHKB91 IF NOT EQUAL    * display inactive only
          ENDIF
.
PMSHKB06  BRANCH    HCPSSTAT,PMSHKB10,PMSHKB20,PMSHKB30,PMSHKB40,PMSHKB90:
                             PMSHKB60,PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB90:
                             PMSHKB70,PMSHKB80,PMSHKB81,PMSHKB14,PMSHKB15:
                             PMSHKB81,PMSHKB83,PMSHKB84,PMSHKB85,PMSHKB86:
                             PMSHKB87,PMSHKB88
.C-825792                    PMSHKB70,PMSHKB80,PMSHKB81,PMSHKB81

          GOTO      PMSHKB90
.
. Attending
.
....                         * removed - a "Referring" HCP type should not be in
....                         * "Active Attending"                     *D-179365
....                         HCP Type - 0, 2, 4, 5, 6, 8, 10
....KB10  BRANCH    PMHCHCST,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB90:
....                         PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB90
.
.                                                          * replace  *I-179365
.                            HCP Type - 0, 2, 4, 6, 8, 10,11,13
PMSHKB10  COMPARE   ZERO,PMHCHCST           * Display attending
          GOTO      PMSHKB90 IF EQUAL
.
          BRANCH    PMHCHCST,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91:
                             PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB90:
                             PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB91
          GOTO      PMSHKB90
.
. Active Nurses only
.                            HCP Type - 14, 15
PMSHKB14  BRANCH    PMHCHCST,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91:
                             PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91:
                             PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB90,PMSHKB90
          GOTO      PMSHKB91
.
. Attending & Nurses
.                            HCP Type - 0, 2, 4, 6, 8, 10,11,13,14,15
PMSHKB15  COMPARE   ZERO,PMHCHCST           * Display attending
          GOTO      PMSHKB90 IF EQUAL
. 
          BRANCH    PMHCHCST,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91:
                             PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB90:
                             PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB90,PMSHKB90
          GOTO      PMSHKB91
.
. Referring
.                            HCP Type - 1, 2, 5, 6, 9, 10,12,13
PMSHKB20  BRANCH    PMHCHCST,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB91,PMSHKB90:
                             PMSHKB90,PMSHKB91,PMSHKB91,PMSHKB90,PMSHKB90:
                             PMSHKB91,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB91
          GOTO      PMSHKB91
.
. GP
.                            HCP Type - 3, 4, 5, 6, 11,12,13
PMSHKB30  BRANCH    PMHCHCST,PMSHKB91,PMSHKB91,PMSHKB90,PMSHKB90,PMSHKB90:
                             PMSHKB90,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91:
                             PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB91
          GOTO      PMSHKB91
.
. Other
.                            HCP Type - 7, 8, 9, 10, 11,12,13,15
PMSHKB40  BRANCH    PMHCHCST,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91:
                             PMSHKB91,PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB90:
                             PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB90
          GOTO      PMSHKB91
.
. Active Exclude GP
.                            HCP Type - 0, 1, 2, 4, 5, 6, 7, 8, 9, 10, 11,12,13
PMSHKB60  COMPARE   ZERO,PMHCHCST           * Display attending
          GOTO      PMSHKB90 IF EQUAL
.
          BRANCH    PMHCHCST,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB90:
                             PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB90:
                             PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB91
          GOTO      PMSHKB91
.
. Active Attending and Ref Doctor
.                            HCP Type - 0,1,2,4,5,6,8,9,10,11,12,13
PMSHKB70  COMPARE   ZERO,PMHCHCST           * Display attending
          GOTO      PMSHKB90 IF EQUAL
.
          BRANCH    PMHCHCST,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB90:
                             PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB90,PMSHKB90:
                             PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB91
          GOTO      PMSHKB91
.
. Responsible HCP for Mental Health
.
PMSHKB80  MOVE      "DT",TCODE
          PACK      KEY5,TCODE,PMHCSPC1,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,PMSHKB91
          MATCH     "L",TCINDC1
          GOTO      PMSHKB91 IF NOT EQUAL
          GOTO      PMSHKB90
.
. Active Exclude GP with related provider test
.         
PMSHKB81  MATCH     VALPTYPE,PMHCPTYP
          GOTO      PMSHKB91 IF NOT EQUAL
.
          COMPARE   ZERO,PMHCHCST           * Display attending
          GOTO      PMSHKB90 IF EQUAL
.
          BRANCH    PMHCHCST,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB90:
                             PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB90:
                             PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB91
          GOTO      PMSHKB91
.
. Show All HCP (Inactive Only)
.
PMSHKB82  MATCH     "0",PMHCSTTS
          GOTO      PMSHKB91 IF EQUAL
.
          GOTO      PMSHKB90
.
. Show All Attending HCP (Both Active & Inactive)
.                            HCP Type - 0,2,4,6,8,10,11,13
PMSHKB83  BRANCH    PMHCHCST,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91:
                             PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB90:
                             PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB91
          GOTO      PMSHKB90
.
. Show Inactive Attending
.                            HCP Type - 0,2,4,6,8,10,11,13
PMSHKB84  BRANCH    PMHCHCST,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91:
                             PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB90:
                             PMSHKB90,PMSHKB91,PMSHKB90,PMSHKB91,PMSHKB91
          GOTO      PMSHKB90
.
. Show Inactive Referring
.                            HCP Type - 1,2,5,6,9,10,12,13
PMSHKB85  BRANCH    PMHCHCST,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB91,PMSHKB90:
                             PMSHKB90,PMSHKB91,PMSHKB91,PMSHKB90,PMSHKB90:
                             PMSHKB91,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB91
          GOTO      PMSHKB91
.
. Show Inactive GP
.                            HCP Type - 3,4,5,6,11,12,13
PMSHKB86  BRANCH    PMHCHCST,PMSHKB91,PMSHKB91,PMSHKB90,PMSHKB90,PMSHKB90:
                             PMSHKB90,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91:
                             PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB91
          GOTO      PMSHKB91
.
. Show Inactive Other
.                            HCP Type - 7,8,9,10,11,12,13,15
PMSHKB87  BRANCH    PMHCHCST,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91:
                             PMSHKB91,PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB90:
                             PMSHKB90,PMSHKB90,PMSHKB90,PMSHKB91,PMSHKB90
          GOTO      PMSHKB91
.
. Show Inactive Nurses
.                            HCP Type - 14,15
PMSHKB88  BRANCH    PMHCHCST,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91:
                             PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB91:
                             PMSHKB91,PMSHKB91,PMSHKB91,PMSHKB90,PMSHKB90
          GOTO      PMSHKB91
.
PMSHKB90  CALL      CHCP0000                * Check if hcp has been
          BRANCH    EXIT,PMSHKB91           * displayed before
.
          MOVE      ZERO,EXIT
          GOTO      PMSHKB99
.
PMSHKB91  MOVE      ONE,EXIT
          GOTO      PMSHKB99
.
PMSHKB92  MOVE      TWO,EXIT
.
PMSHKB99  RETURN
.
.------------------------------------------------------------
. Check if this HCP has already been output in the search
.------------------------------------------------------------
CHCP0000  MOVE       ZERO,F3
          MOVE       ZERO,EXIT
.
CHCP1000  ADD        ONE,F3
          IF         F3>HCPAREND
            IF         F3>200
              GOTO       CHCP9999
            ENDIF
            MOVE       F3,HCPAREND
            MOVE       PMHCHCPC,HCPARRAY[F3]
            GOTO       CHCP9999
          ENDIF
.
          MATCH      PMHCHCPC,HCPARRAY[F3]
          GOTO       CHCP1000 IF NOT EQUAL
.
          MOVE       ONE,EXIT
.
CHCP9999  RETURN
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
PMSHKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY10,PMHKHCPC,SP70
.
PMSHKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      PMSHKC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                                KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY25,PMHCHCPC,KEYWRDXX
          CALL      RDPMHKI1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      PMSHKC10 IF EQUAL
.
          CALL      RKPMHKI1              * Not Exact so Read Next Record
          BRANCH    OVRCD,PMSHKC90        * No Match So Exit No Match
          PACK      KEY10,PMHKHCPC,SP70
          MATCH     SAVKEY10,KEY10          * Match Key Fields
          GOTO      PMSHKC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     PMHKKKWD,KEYWRDXX         * Check Key Word
          GOTO      PMSHKC90 IF NOT EQUAL * No Match So Exit
          GOTO      PMSHKC10              * Check Next Search Word
.
PMSHKC90  MOVE      ONE,EXIT
.
PMSHKC99  RETURN 
.
.------------------------------------------------------------
. Search Table of GP's & Practices Search by Name 
.------------------------------------------------------------
GPPSR000  CALL      PRAHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,STARTKEY
          GOTO      GPPSR999 IF EQUAL
.
          PACK      KEY53,STARTKEY,SP70
          CALL      RSPMHCP2
          IF        OVRCD=0
            CALL      RPPMHCP2
          ENDIF  
GPPSR100  CALL      RKPMHCP2
          BRANCH    OVRCD,GPPSR999
.
          STRIP     STARTKEY
          REP       UPPLOW,PMHCSNAM
          MATCH     STARTKEY,PMHCSNAM
          GOTO      GPPSR100 IF NOT EQUAL
.
          MATCH     "1",PMHCSTTS
          GOTO      GPPSR100 IF EQUAL
.
          PACK      KEY20,PMHCHCPC,SP70
          CALL      RSPMHCL1
GPPSR110  CALL      RKPMHCL1
          IF        OVRCD=1
            CALL      CLPMSHCL
            CALL      CLPMSHCG
            CALL      PRARW000
            BRANCH    EXIT,GPPSR999
            GOTO      GPPSR100
          ENDIF
.
          MATCH     PMHCHCPC,PMHLHCPC
          IF        !@EQUAL
            CALL      CLPMSHCL
            CALL      CLPMSHCG
            CALL      PRARW000
            BRANCH    EXIT,GPPSR999
            GOTO      GPPSR100
          ENDIF
.
          MATCH     "1",PMHLSTAT
          GOTO      GPPSR110 IF EQUAL
.
          PACK      KEY12,PMHLHCPR,SP70
          CALL      RSPMHCG1
GPPSR120  CALL      RKPMHCG1
          IF        OVRCD=1
            CALL      CLPMSHCG
            CALL      PRARW000
            BRANCH    EXIT,GPPSR999
            GOTO      GPPSR110
          ENDIF
.
          MATCH     PMHLHCPR,PMHGPRAC
          IF        !@EQUAL
            CALL      CLPMSHCG
            CALL      PRARW000
            BRANCH    EXIT,GPPSR999
            GOTO      GPPSR110
          ENDIF
.
          MATCH     "1",PMHGSTTS
          GOTO      GPPSR120 IF EQUAL
.
          CALL      PRARW000      * HCP's Details Row
          BRANCH    EXIT,GPPSR999
.
          GOTO      GPPSR110
.
GPPSR999  RETURN
.------------------------------------------------------------
. HCP & Practice (TABLE HEADING)
.------------------------------------------------------------
PRAHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell>":
                               "HCP Name</td>":
                               "<td class=HeadingCell>":
                               "Practice</td>":
                               "<td class=HeadingCell>":
                               "Address</td>":
                               "<td class=HeadingCell>":
                               "Contact</td>":
                             "</tr>"
.
PRAHD999  RETURN
.------------------------------------------------------------
. HCP's (TABLE ROW)
.------------------------------------------------------------
PRARW000  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PRARW950
          ENDIF
.
          CALL      HCPNAM00
          CALL      JAVHCP00
.
          WRITE     HTMLFILE;"<tr valign=#"top#">":
                             "<td><a href=#"":
                             "javascript:updateParent('",DOCFNAME:
                             "','",PMHCHCPC:
                             "','",PMHGPRAC:
                             "','",PMHGPNAM:
                             "','",PMHGPNAM,"')#">":      
                             PMHCSNAM,",",PMHCTITL,SP1,PMHCGNAM:
                             "<br>(",PMHCHCPC,")</a></td>":
                             "<td>",PMHGPNAM,"<br>":
                                    PMHGADD1,"<br>":
                                    PMHGADD2,"<br>":
                                    PMHGADD3,"<br>":
                                    PMHGADD4,PMHGPOST,"</td>":
                             "<td>",PMHCADR1,"<br>":
                                    PMHCADR2,"<br>":
                                    PMHCADR3,"<br>":
                                    PMHCADR4,PMHCPOST,"</td>":
                             "<td>Phone:",PMHCSTEL,"<br>":
                                 "Fax:",PMHCFAXN,"</td>":
                             "</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PRARW950 IF NOT EQUAL
.
PRARW900  MOVE      ONE,EXIT
          GOTO      PRARW999
.
PRARW950  MOVE      ZERO,EXIT
          GOTO      PRARW999
.
PRARW999 RETURN
+
.******************************************************************************
.         DSDE0000                                          Called By DELPER00*
.         Delete all records from the patdstat file for a given doctor        *
.******************************************************************************
DSDE0000  PACK      KEY13,DCODE,DIM1,SP30
          CALL      RDSDSTA2
          CALL      RDKDSTA2
          BRANCH    OVRCD,DSDE9999
.
          MATCH     PTDSCODE,DCODE
          GOTO      DSDE9999 IF NOT EQUAL
.
          MATCH     DIM1,PTDSTYPE
          GOTO      DSDE9999 IF NOT EQUAL
.
          PACK      KEY13,PTDSCODE,PTDSTYPE,PTDSYEAR,PTDSPERD
          CALL      DEDSTA2
.
          GOTO      DSDE0000
.
DSDE9999  RETURN
+
.
.******************************************************************************
.         DSCR0000                                          Called By DOCTDEL *
.         Create blank records in patdstat file for each period this year     *
.******************************************************************************
DSCR0000  PACK      KEY6,FINYEAR,SP10
          CALL      RDSDRGA1
DSCR1000  CALL      RDKDRGA1
.
          BRANCH    OVRCD,DSCR9999
.
          MATCH     DRGYR,FINYEAR
          GOTO      DSCR9999 IF LESS
.
          MOVE      ZERO,PTDSBADM
          MOVE      ZERO,PTDSBBED
          MOVE      ZERO,PTDSBOPR
          MOVE      ZERO,PTDSBMBS
          MOVE      ZERO,PTDSADMS
          MOVE      ZERO,PTDSBEDD
          MOVE      ZERO,PTDSOPRS
          MOVE      ZERO,PTDSMBSC
          MOVE      FINYEAR,PTDSYEAR
          MOVE      DRGNUM,PTDSPERD
          MOVE      DCODE,PTDSCODE
.
          PACK      KEY13,PTDSYEAR,PTDSPERD,ANSR,PTDSCODE
          CALL      RADSTA1
          IF        OVRCD=1
            CALL      WRDSTA1
          ENDIF
          PACK      KEY13,PTDSYEAR,PTDSPERD,ANSA,PTDSCODE
          CALL      RADSTA1
          IF        OVRCD=1
            CALL      WRDSTA1
          ENDIF
.
          GOTO      DSCR1000
.
DSCR9999  RETURN
+
.
.******************************************************************************
.         SVDS0000                                                            *
.         Save doctor stats to vairables according to the grg period          *
.******************************************************************************
SVDS0000  MOVE      PTDSPERD,FORM2 
          STORE     PTDSADMS,FORM2,DSCDSH1,DSCDSH2,DSCDSH3,DSCDSH4:
                               DSCDSH5,DSCDSH6,DSCDSH7,DSCDSH8:
                               DSCDSH9,DSCDSH10,DSCDSH11,DSCDSH12
.
          STORE     PTDSBEDD,FORM2,DSCBED1,DSCBED2,DSCBED3,DSCBED4:
                               DSCBED5,DSCBED6,DSCBED7,DSCBED8:
                               DSCBED9,DSCBED10,DSCBED11,DSCBED12
.
          STORE     PTDSOPRS,FORM2,DSCOPR1,DSCOPR2,DSCOPR3,DSCOPR4:
                               DSCOPR5,DSCOPR6,DSCOPR7,DSCOPR8:
                               DSCOPR9,DSCOPR10,DSCOPR11,DSCOPR12
.
          STORE     PTDSMBSC,FORM2,DSXOPR1,DSXOPR2,DSXOPR3,DSXOPR4:
                               DSXOPR5,DSXOPR6,DSXOPR7,DSXOPR8:
                               DSXOPR9,DSXOPR10,DSXOPR11,DSXOPR12
.
. Budgets
.
          STORE     PTDSBADM,FORM2,BSCDSH1,BSCDSH2,BSCDSH3,BSCDSH4:
                               BSCDSH5,BSCDSH6,BSCDSH7,BSCDSH8:
                               BSCDSH9,BSCDSH10,BSCDSH11,BSCDSH12
.
          STORE     PTDSBBED,FORM2,BSCBED1,BSCBED2,BSCBED3,BSCBED4:
                               BSCBED5,BSCBED6,BSCBED7,BSCBED8:
                               BSCBED9,BSCBED10,BSCBED11,BSCBED12
.
          STORE     PTDSBOPR,FORM2,BSCOPR1,BSCOPR2,BSCOPR3,BSCOPR4:
                               BSCOPR5,BSCOPR6,BSCOPR7,BSCOPR8:
                               BSCOPR9,BSCOPR10,BSCOPR11,BSCOPR12
.
          STORE     PTDSBMBS,FORM2,BSXOPR1,BSXOPR2,BSXOPR3,BSXOPR4:
                               BSXOPR5,BSXOPR6,BSXOPR7,BSXOPR8:
                               BSXOPR9,BSXOPR10,BSXOPR11,BSXOPR12
.
SVDS9999  RETURN
.-----------------------------------------------------------
. Move common variables from the doctors file to the HCP file
. patdo1af -> pmshcpaf   
.-----------------------------------------------------------
HCPSAV00  CALL      CLPMSHCP
          PACK      PMHCHCPC,DCODE,SP70          * Doctor Code
          PACK      PMHCTITL,DTITL,SP70          * Doctor Title
          PACK      PMHCGNAM,DGNAME,SP70         * Given Name
          PACK      PMHCSNAM,DSNAME,SP70         * Surname
          MOVE      ANSU,PMHCGNDR                * Sex
          MOVE      DBIRTH,PMHCDTOB              * Date of birth
          MOVE      DRTYPE,PMHCSPC1              * Speciality
          MOVE      DRTYPE2,PMHCSPC2             * Speciality
          MOVE      DRTYPE3,PMHCSPC3             * Speciality
          MOVE      DRTYPE4,PMHCSPC4             * Speciality
          MOVE      DRTYPE5,PMHCSPC5             * Speciality
          PACK      PMHCRCPT,DRNAME,SP70         * Receptionist name
          PACK      PMHCADR1,DSADD1,SP70         * Address line 1
          PACK      PMHCADR2,DSADD2,SP70         * Address line 2     *C-125736
          PACK      PMHCADR3,DSADD3,SP70         * Address line 3     *C-125736
          PACK      PMHCADR4,DSADD4,SP70         * Address line 4     *C-125736
          PACK      PMHCADR5,SP70                * Address line 5
          PACK      PMHCADR6,SP70                * Address line 6
          MOVE      DSPOST,PMHCPOST              * Post code
          MOVE      PTDOSEML,PMHCSEML            * E-Mail
          MOVE      DTELES,PMHCSTEL              * Surgers Telephone 
          MOVE      DTELEP,PMHCPAGR              * Page Telephone
          MOVE      DPAGER,PMHCPAGN              * Pager Number
          MOVE      DASSOC1,PMHCAHP1             * Associated HCP 1
          MOVE      DASSOC2,PMHCAHP2             * Associated HCP 2
          MOVE      DASSOC3,PMHCAHP3             * Associated HCP 3
          MOVE      DASSOC4,PMHCAHP4             * Associated HCP 4
          MOVE      DASSOC5,PMHCAHP5             * Associated HCP 5
          MOVE      DPROV,PMHCPRV1               * Provider number 1
          MOVE      DTELEH,PMHCHTEL              * Home Telephone
          PACK      PMHCHAD1,DHADD1,SP70         * Address line 1
          PACK      PMHCHAD2,DHADD2,SP70         * Address line 2
          PACK      PMHCHAD3,DHADD3,SP70         * Address line 3
          PACK      PMHCHAD4,DHADD4,SP70         * Address line 4
          PACK      PMHCHAD5,SP70                * Address line 5
          PACK      PMHCHAD6,SP70                * Address line 6
          MOVE      DHPOST,PMHCHPCD              * Post code
          MOVE      PTDOHEML,PMHCHEML            * E-Mail
          MOVE      DAFIRST,PMHCDFAC             * Date first accred
          MOVE      DALAST,PMHCDLAC              * Date last accred
          MOVE      DAYEARS,PMHCYACC             * Accred years
          MOVE      DACCRED,PMHCATYP             * Accred type
          MOVE      DHCSCOD,PMHCHHCP             * H.C.S HCP Code
          MOVE      DALEVEL,PMHCOSLV             * Service level
.
          COMPARE   ZERO,DRSTAT                   * Status
          IF        @EQUAL
            MOVE      TWO,PMHCHCST              
            MOVE      ZERO,PMHCSTTS               * Active / Inactive
          ENDIF
.
          COMPARE   ONE,DRSTAT                   * Status
          IF        @EQUAL
            MOVE      TWO,PMHCHCST  
            MOVE      ONE,PMHCSTTS               * Active / Inactive
          ENDIF
.
          COMPARE   TWO,DRSTAT                   * Status
          IF        @EQUAL
            MOVE      ONE,PMHCHCST  
            MOVE      ZERO,PMHCSTTS               * Active / Inactive
          ENDIF
.
          MOVE      SP70,PMHCHCSD                * Status date 
          PACK      PMHCFAXN,PTDOFAXN,SP70       * Fax number
          PACK      PMHCHFXN,PTDOHFAX,SP70       * Home Fax
          PACK      PMHCMOBN,PTDOMOBL,SP70       * Mobile
          MOVE      PTDOGLCC,PMHCCRDC            * Creditor code
          PACK      PMHCWAHC,PTDOWHDP,SP70       * WA HDP HCP code
          MOVE      PTDOMREG,PMHCMRBN            * Med Reg Board No
          MOVE      PTDONHSN,PMHCNHSN            * N.H.S Pros Number
          MOVE      PTDOUDF1,PMHCUDF1            * User Def Field 1
          MOVE      PTDOUDF2,PMHCUDF2            * User Def Field 2
          MOVE      PTDOUDF3,PMHCUDF3            * User Def Field 3
          MOVE      PTDOUDF4,PMHCUDF4            * User Def Field 4
          MOVE      PTDOUDF5,PMHCUDF5            * User Def Field 5
          MOVE      ZERO,PMHCUYN1                * User Def Y/N 1
          MOVE      ZERO,PMHCUYN2                * User Def Y/N 2
          MOVE      ZERO,PMHCUYN3                * User Def Y/N 3
          MOVE      ZERO,PMHCUYN4                * User Def Y/N 4
          MOVE      ZERO,PMHCUYN5                * User Def Y/N 5
          MOVE      PTDOINSC,PMHCINSC            * Insurance code
          MOVE      PTDOINSN,PMHCIPLN            * Insurance number
          MOVE      PTDOINSF,PMHCIDTF            * Insurance date from
          MOVE      PTDOINST,PMHCIDTT            * Insurance date to  
          MOVE      PTDOREGN,PMHCMPGN            * MPG Cert No       
          MOVE      ZERO,PMHCAPCI                * APC
          MOVE      PTDOREGF,PMHCRGDF            * Reg Date From
          MOVE      PTDOREGT,PMHCRGDT            * Reg Date To        *C-142157
          MOVE      PTDOVISA,PMHCVISD            * Visa date
          MOVE      PTDOCOMT,PMHCPRFC            * Pref Comm
          MOVE      PTDOPREF,PMHCPRFN            * Pref Name
          MOVE      PTDOABNN,PMHCABNN            * ABN Number
          MOVE      ANSM,PMHCUPDF                * Upddate Flag
          MOVE      ZERO,PMHCPRMK                * Processor mark
          MOVE      CURRDATE,PMHCCDTE            * Date created
          MOVE      CTIMEIS,PMHCCTIM             * Time created
          MOVE      WBSEUID,PMHCWEBC             * Web user id creator
          MOVE      PTDOEXML,PMHCEXML            * Exclude from Mailing List
          MOVE      PTDODEAC,PMHCDEAC            * Accred. Expiry Date
          MOVE      PTDOAHC1,PMHCAHC1            * AH Contact Method 1
          MOVE      PTDOAHC2,PMHCAHC2            * AH Contact Method 2
          MOVE      PTDOAHC3,PMHCAHC3            * AH Contact Method 3
          PACK      PMHCLDOC,DCODE,SP70          * Linked Doctor Code (patdo1af)
          MOVE      PTDOSDAT,PMHCSDAT            * Start Date (ccyymmdd)
          MOVE      PTDOEDAT,PMHCEDAT            * End Date (ccyymmdd)
.
HCPSAV99  RETURN
.-----------------------------------------------------------
. Move common variables from the doctors file to the HCP file
. patdo1af -> pmshcpaf   
.-----------------------------------------------------------
HCPUPD00  PACK      PMHCHCPC,DCODE,SP70          * Doctor Code
          PACK      PMHCTITL,DTITL,SP70          * Doctor Title
          PACK      PMHCGNAM,DGNAME,SP70         * Given Name
          PACK      PMHCSNAM,DSNAME,SP70         * Surname
          MOVE      DBIRTH,PMHCDTOB              * Date of birth
          MOVE      DRTYPE,PMHCSPC1              * Speciality
          MOVE      DRTYPE2,PMHCSPC2             * Speciality
          MOVE      DRTYPE3,PMHCSPC3             * Speciality
          MOVE      DRTYPE4,PMHCSPC4             * Speciality
          MOVE      DRTYPE5,PMHCSPC5             * Speciality
          PACK      PMHCRCPT,DRNAME,SP70         * Receptionist name
          PACK      PMHCADR1,DSADD1,SP70         * Address line 1
          PACK      PMHCADR2,DSADD2,SP70         * Address line 2     *C-125736
          PACK      PMHCADR3,DSADD3,SP70         * Address line 3     *C-125736
          PACK      PMHCADR4,DSADD4,SP70         * Address line 4     *C-125736
          MOVE      DSPOST,PMHCPOST              * Post code
          MOVE      PTDOSEML,PMHCSEML            * E-Mail
          MOVE      DTELES,PMHCSTEL              * Surgers Telephone 
          MOVE      DTELEP,PMHCPAGR              * Page Telephone
          MOVE      DPAGER,PMHCPAGN              * Pager Number
          MOVE      DASSOC1,PMHCAHP1             * Associated HCP 1
          MOVE      DASSOC2,PMHCAHP2             * Associated HCP 2
          MOVE      DASSOC3,PMHCAHP3             * Associated HCP 3
          MOVE      DASSOC4,PMHCAHP4             * Associated HCP 4
          MOVE      DASSOC5,PMHCAHP5             * Associated HCP 5
          MOVE      DPROV,PMHCPRV1               * Provider number 1
          MOVE      DTELEH,PMHCHTEL              * Home Telephone
          PACK      PMHCHAD1,DHADD1,SP70         * Address line 1
          PACK      PMHCHAD2,DHADD2,SP70         * Address line 2
          PACK      PMHCHAD3,DHADD3,SP70         * Address line 3
          PACK      PMHCHAD4,DHADD4,SP70         * Address line 4
          MOVE      DHPOST,PMHCHPCD              * Post code
          MOVE      PTDOHEML,PMHCHEML            * E-Mail
          MOVE      DAFIRST,PMHCDFAC             * Date first accred
          MOVE      DALAST,PMHCDLAC              * Date last accred
          MOVE      DAYEARS,PMHCYACC             * Accred years
          MOVE      DACCRED,PMHCATYP             * Accred type
          MOVE      DHCSCOD,PMHCHHCP             * H.C.S HCP Code
          MOVE      DALEVEL,PMHCOSLV             * Service level
.
HCPUPD20  COMPARE   ZERO,DRSTAT                   * Status
          IF        @EQUAL
....        MOVE      TWO,PMHCHCST                                     D-141988 
            MOVE      ZERO,PMHCSTTS               * Active / Inactive
          ENDIF
.
          COMPARE   ONE,DRSTAT                   * Status
          IF        @EQUAL
....        MOVE      TWO,PMHCHCST                                     D-141988
            MOVE      ONE,PMHCSTTS               * Active / Inactive
          ENDIF
.
          COMPARE   TWO,DRSTAT                   * Status
          IF        @EQUAL
....        MOVE      ONE,PMHCHCST                                     D-141988
            MOVE      ZERO,PMHCSTTS               * Active / Inactive
          ENDIF
.
          PACK      PMHCFAXN,PTDOFAXN,SP70       * Fax number
          PACK      PMHCHFXN,PTDOHFAX,SP70       * Home Fax
          PACK      PMHCMOBN,PTDOMOBL,SP70       * Mobile
          MOVE      PTDOGLCC,PMHCCRDC            * Creditor code
          PACK      PMHCWAHC,PTDOWHDP,SP70       * WA HDP HCP code
          MOVE      PTDOMREG,PMHCMRBN            * Med Reg Board No
          MOVE      PTDONHSN,PMHCNHSN            * N.H.S Pros Number
          MOVE      PTDOUDF1,PMHCUDF1            * User Def Field 1
          MOVE      PTDOUDF2,PMHCUDF2            * User Def Field 2
          MOVE      PTDOUDF3,PMHCUDF3            * User Def Field 3
          MOVE      PTDOUDF4,PMHCUDF4            * User Def Field 4
          MOVE      PTDOUDF5,PMHCUDF5            * User Def Field 5
          MOVE      PTDOINSC,PMHCINSC            * Insurance code
          MOVE      PTDOINSN,PMHCIPLN            * Insurance number
          MOVE      PTDOINSF,PMHCIDTF            * Insurance date from
          MOVE      PTDOINST,PMHCIDTT            * Insurance date to  
          MOVE      PTDOREGN,PMHCMPGN            * MPG Cert No       
          MOVE      PTDOREGF,PMHCRGDF            * Reg Date From
          MOVE      PTDOREGT,PMHCRGDT            * Reg Date To        *C-142157
          MOVE      PTDOVISA,PMHCVISD            * Visa date
          MOVE      PTDOCOMT,PMHCPRFC            * Pref Comm
          MOVE      PTDOPREF,PMHCPRFN            * Pref Name
          MOVE      PTDOABNN,PMHCABNN            * ABN Number
          MOVE      PTDOEXML,PMHCEXML            * Exclude from Mailing List
          MOVE      PTDODEAC,PMHCDEAC            * Accred. Expiry Date
          MOVE      PTDOAHC1,PMHCAHC1            * AH Contact Method 1
          MOVE      PTDOAHC2,PMHCAHC2            * AH Contact Method 2
          MOVE      PTDOAHC3,PMHCAHC3            * AH Contact Method 3
          PACK      PMHCLDOC,DCODE,SP70          * Linked Doctor Code (patdo1af)
          MOVE      PTDOSDAT,PMHCSDAT            * Start Date (ccyymmdd)
          MOVE      PTDOEDAT,PMHCEDAT            * End Date (ccyymmdd)
.
          MOVE      CURRDATE,PMHCLUPD            * Last Update 
          MOVE      CTIMEIS,PMHCLUPT             * last Update Time
          MOVE      WBSEUID,PMHCWEBU             * Last Update User
.
HCPUPD99  RETURN
.------------------------------------------------------------
.------------------------------------------------------------
. Patient Letters Details
.------------------------------------------------------------
DOCLET00  CALL      CLDOCLET
          MATCH     SP70,UPDTTYPE      * Display
          GOTO      DOCLET50 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add New
          GOTO      DOCLET10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update
          GOTO      DOCLET20 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete
          GOTO      DOCLET30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      DOCLET99
.
DOCLET10  CALL      ADDLET00
          GOTO      DOCLET99
.
DOCLET20  CALL      UPDLET00
          GOTO      DOCLET99
.
DOCLET30  CALL      DELLET00
          GOTO      DOCLET99
.
DOCLET50  SQUEEZE   DTLET001
          MOVE      DTLET001,F3
          MOVE      F3,KEY3
          MOVE      ZERO,F3
          PACK      KEY6,KEY3,F3
          CALL      RDPTDLT1
          IF        OVRCD=1
            CALL      CLDOCLET
          ENDIF
          MOVE      "Doctors Letters",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,DOCLET99
          CALL      WEBBOD00
          CALL      WEBEND00
.
DOCLET99  RETURN
.------------------------------------------------------------
CLDOCLET  MOVE      ZERO,PTDLLTNO
          MOVE      ZERO,PTDLLINO
          MOVE      SP70,PTDLTEXT
          MOVE      ZERO,PTDLLVAR
.       
          MOVE      ZERO,PTDLPBOT
          MOVE      ZERO,PTDLPTOP
          MOVE      ZERO,PTDLPPAG
          MOVE      ZERO,PTDLPTAB
          MOVE      SP70,PTDLACTV
          MOVE      SP70,PTDLSPAR
          RETURN
.------------------------------------------------------------
. Add Letter
.------------------------------------------------------------
ADDLET00  CALL      CLDOCLET
          SQUEEZE   DTLET001
          MOVE      DTLET001,PTDLLTNO
          MOVE      ZERO,PTDLLINO
          PACK      KEY6,PTDLLTNO,PTDLLINO,SP70
          CALL      RDPTDLT1
          IF        OVRCD=1
            CALL      MVLET000
            CALL      WRPTDLT1
            CALL      LETDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Letter Already on File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Update Extract
.------------------------------------------------------------
UPDLET00  CALL      CLDOCLET
          SQUEEZE   DTLET001
          MOVE      DTLET001,PTDLLTNO
          MOVE      ZERO,PTDLLINO
          PACK      KEY6,PTDLLTNO,PTDLLINO,SP70
          CALL      RDPTDLT1
          IF        OVRCD=0
            CALL      MVLET000
            CALL      UPPTDLT1
            CALL      LETDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Delete Extract
.------------------------------------------------------------
DELLET00  SQUEEZE   DTLET001
          MOVE      DTLET001,PTDLLTNO
          MOVE      ZERO,PTDLLINO
          PACK      KEY6,PTDLLTNO,PTDLLINO,SP70
          CALL      RDPTDLT1
          IF        OVRCD=0
            CALL      DEPTDLT1
            CALL      LETDET00
            CALL      WINCLS00
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.
.------------------------------------------------------------
. Move in Letter Details
.------------------------------------------------------------
MVLET000  MATCH     Z70,DTLET001
          IF        !@EQUAL
            SQUEEZE    DTLET001
            MOVE       DTLET001,PTDLLTNO
          ENDIF
.
          MATCH     Z70,DTLET002
          IF        !@EQUAL
            MOVE       DTLET002,PTDLTEXT
          ENDIF
.
          MATCH     Z70,DTLET003
          IF        !@EQUAL
            SQUEEZE    DTLET003
            MOVE       DTLET003,PTDLPBOT
          ENDIF
.
          MATCH     Z70,DTLET004
          IF        !@EQUAL
            SQUEEZE    DTLET004
            MOVE       DTLET004,PTDLPTOP
          ENDIF
.
          MATCH     Z70,DTLET005
          IF        !@EQUAL
            SQUEEZE    DTLET005
            MOVE       DTLET005,PTDLPPAG
          ENDIF
.
          MATCH     Z70,DTLET006
          IF        !@EQUAL
            SQUEEZE    DTLET006
            MOVE       DTLET006,PTDLPTAB
          ENDIF
.
          MATCH     Z70,DTLET007
          IF        !@EQUAL
            MOVE       DTLET007,PTDLACTV
          ENDIF
.
          RETURN
.
LETDET00  SQUEEZE   DTLET001
          MOVE      DTLET001,PTDLLTNO
          MOVE      DTLET001,LETTNUMB
          MOVE      ZERO,PTDLLINO
          PACK      KEY6,PTDLLTNO,PTDLLINO,SP70
          CALL      RDPTDLT1
LETDET10  CALL      RKPTDLT1
          BRANCH    OVRCD,LETDET20
          COMPARE   PTDLLTNO,LETTNUMB
          GOTO      LETDET20 IF NOT EQUAL
          PACK      KEY6,PTDLLTNO,PTDLLINO,SP70
          CALL      DEPTDLT1
          CALL      RSPTDLT1
          GOTO      LETDET10
.
LETDET20  MATCH     "D",UPDTTYPE
          GOTO      LETDET99 IF EQUAL
          COMPARE   ZERO,DTLEEND
          GOTO      LETDET99 IF EQUAL
          CALL      CLDOCLET
          MOVE      ZERO,F2
LETDET30  ADD       ONE,F2
          MOVE      LETTNUMB,PTDLLTNO
          MOVE      F2,PTDLLINO
          PACK      KEY6,PTDLLTNO,PTDLLINO,SP70
          CALL      RDPTDLT1
          IF        OVRCD=0
            MOVE      ZERO,PTDLLVAR
            SCAN      SPECCHAR,DTLECOMM[F2]
            IF        @EQUAL
              MOVE      ONE,PTDLLVAR
            ENDIF
            RESET     DTLECOMM[F2]
            MOVE      DTLECOMM[F2],PTDLTEXT
            CALL      UPPTDLT1
          ELSE
            MOVE      ZERO,PTDLLVAR
            SCAN      SPECCHAR,DTLECOMM[F2]
            IF        @EQUAL
              MOVE      ONE,PTDLLVAR
            ENDIF
            RESET     DTLECOMM[F2]
            MOVE      DTLECOMM[F2],PTDLTEXT
            CALL      WRPTDLT1
          ENDIF
          COMPARE   F2,DTLEEND
          GOTO      LETDET30 IF NOT EQUAL
LETDET99  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters
.-------------------------------------------------------------------------------
STLET000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,DTLET001,DTLET002,DTLET003,DTLET004,DTLET005:
                               DTLET006,DTLET007
          RETURN
.------------------------------------------------------------
. Get Text
.------------------------------------------------------------
GLTEXT00  ADD       ONE,DTLEEND
          MOVE      QRYDATA,DTLECOMM[DTLEEND]
          RESET     DTLECOMM[DTLEEND]
.
GLTEXT10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      GLTEXT99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      GLTEXT80 IF NOT EQUAL
          ADD       ONE,DTLEEND                    * Increment Array Counter
          PACK      DTLECOMM[DTLEEND],QRYDATA,SP70 * Input Note to Array
          GOTO      GLTEXT10
.
GLTEXT80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
GLTEXT99  RETURN
.------------------------------------------------------------
. Letter Variables
.------------------------------------------------------------
LETF0000  BRANCH    FLDITMNO,LETF0100,LETF0200,LETF0300,LETF0400,LETF0500:
                             LETF0600,LETF0700,LETF0800,LETF0900,LETF1000:
                             LETF1100
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      LETF9999
.
LETF0100  COMPARE   ZERO,PTDLLTNO
          GOTO      LETF0110 IF EQUAL
          WRITE     HTMLFILE;PTDLLTNO;
          GOTO      LETF9999
.
LETF0110  MOVE      ZERO,F3
          PACK      KEY6,F3,Z70
          CALL      RSPTDLT2
          CALL      RPPTDLT2
          IF        OVRCD=1
            WRITE     HTMLFILE;"  1";
          ELSE
            ADD       ONE,PTDLLTNO
            WRITE     HTMLFILE;PTDLLTNO;
            CALL      CLDOCLET
          ENDIF
          GOTO      LETF9999
.
LETF0200  MATCH     SP70,PTDLTEXT
          GOTO      LETF9999 IF EQUAL
          WRITE     HTMLFILE;PTDLTEXT;
          GOTO      LETF9999
.
LETF0300  WRITE     HTMLFILE;PTDLPBOT;
          GOTO      LETF9999
.
LETF0400  WRITE     HTMLFILE;PTDLPTOP;
          GOTO      LETF9999
.
LETF0500  WRITE     HTMLFILE;PTDLPPAG;
          GOTO      LETF9999
.
LETF0600  WRITE     HTMLFILE;PTDLPTAB;
          GOTO      LETF9999
.
LETF0700 
          GOTO      LETF9999
.
LETF0800  CALL      LETTAB00
          GOTO      LETF9999
.
LETF0900  SQUEEZE   DTLET001
          MOVE      ZERO,LETTNUMB
          MOVE      DTLET001,LETTNUMB
          COMPARE   ZERO,LETTNUMB
          GOTO      LETF9999 IF EQUAL
          PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDPTDLT1
LETF0910  CALL      RKPTDLT1
          BRANCH    OVRCD,LETF0990
          COMPARE   LETTNUMB,PTDLLTNO
          GOTO      LETF0990 IF NOT EQUAL
.
          STRIP     PTDLTEXT
          MOVELPTR  PTDLTEXT,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      PTDLTEXT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,127
.
          GOTO      LETF0910
LETF0990  PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDPTDLT1
          GOTO      LETF9999
.
LETF1000  WRITE     HTMLFILE;PTDLACTV;
          GOTO      LETF9999
.
LETF1100  WRITE     HTMLFILE;FILTACTV;
          GOTO      LETF9999
.
LETF9999  RETURN
.------------------------------------------------------------
. Output Table of Letter Headers Details
.------------------------------------------------------------
LETTAB00  MOVE      ZERO,F3
          PACK      KEY6,F3,SP70
          CALL      RSPTDLT2
LETTAB10  CALL      RKPTDLT2
          BRANCH    OVRCD,LETTAB99
          COMPARE   ZERO,PTDLLINO
          GOTO      LETTAB99 IF NOT EQUAL
.
          MATCH     "0",FILTACTV            * Active Only
          IF        @EQUAL
            MATCH     "1",PTDLACTV
            GOTO      LETTAB10 IF EQUAL
          ENDIF
.
          MATCH     "1",FILTACTV            * Inactive Only
          IF        @EQUAL
            MATCH     "1",PTDLACTV
            GOTO      LETTAB10 IF NOT EQUAL
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateLetter('",HTMLLINK
          APPEND    PTDLLTNO,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          MATCH     "1",PTDLACTV
          IF        @EQUAL
            MOVE    "Inactive  ",ACTIDESC
          ELSE
            MOVE    "Active",ACTIDESC
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PTDLLTNO,"#",":
                             "#"",PTDLTEXT,"#",":
                             "#"",PTDLPBOT,"#",":
                             "#"",PTDLPTOP,"#",":
                             "#"",PTDLPPAG,"#",":
                             "#"",PTDLPTAB,"#",":
                             "#"",ACTIDESC,"#");"
.
          GOTO      LETTAB10
.
LETTAB99  RETURN
.------------------------------------------------------------
.------------------------------------------------------------
. Doctor/Unit Maintenance
.------------------------------------------------------------
DOCUNI00  CALL      CLDOCUNI
          MATCH     SP70,UPDTTYPE      * Display
          GOTO      DOCUNI50 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add New
          GOTO      DOCUNI10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update
          GOTO      DOCUNI20 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete
          GOTO      DOCUNI30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      DOCUNI99
.
DOCUNI10  CALL      ADDUNI00
          GOTO      DOCUNI99
.
DOCUNI20  CALL      UPDUNI00
          GOTO      DOCUNI99
.
DOCUNI30  CALL      DELUNI00
          GOTO      DOCUNI99
.
DOCUNI50  MATCH     SP70,PMDUN001
          IF        !@EQUAL
            MATCH     SP70,PMDUN002
            IF        !@EQUAL
               PACK     KEY9,PMDUN001,PMDUN002
               CALL     RDPMDUN1
            ENDIF
          ENDIF
.
          MATCH     "1",HCPLEVEL
          IF        @EQUAL
            MATCH     SP70,STARTKEY
            IF        !@EQUAL
              PACK      KEY6,STARTKEY,SP70
              CALL      RDDOCT1
              BRANCH    OVRCD,DOCUNI90
            ENDIF
          ENDIF
.
          MOVE      "Doctor/Unit Maintenance",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,DOCUNI99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      DOCUNI99
.
DOCUNI90  MOVE      "Invalid Doctor Code.",WEBTITLE
          CALL      WEBERR00   
          MOVE      ONE,EXIT
          GOTO      DOCUNI99
.
DOCUNI99  RETURN
.------------------------------------------------------------
. Add Doctor/Unit Combination
.------------------------------------------------------------
ADDUNI00  CALL      CLDOCUNI
          PACK      KEY9,PMDUN001,PMDUN002,SP70
          CALL      RDPMDUN1 
          IF        OVRCD<>1
            GOTO      ADDUNI90
          ENDIF
.
          MOVE      PMDUN001,PMDUDOCT
          MOVE      PMDUN002,PMDUUNIT
.
          MATCH     SP70,PMDUN003
          IF        !@EQUAL
            MOVE      PMDUN003,PMDUHEAD
          ELSE
            MOVE      "0",PMDUHEAD
          ENDIF
.
          CALL      WRPMDUN1
. **** Write EDWARD ISP Audit
          PACK      KEY16,PMDUDOCT,SP70
          CALL      RSPMHCP4
          CALL      RKPMHCP4
          BRANCH    OVRCD,ADDUNI99               * Doctor Code does not exist
.
          MATCH     PMDUDOCT,PMHCLDOC               * Valid HCP found
          GOTO      ADDUNI99 IF NOT EQUAL
.
          PACK      PMIWCODE,PMHCHCPC,SP70                  * HCP Code
          MOVE      "08 ",PMIWTYPE                          * Add Unit
          PACK      PMIWOLDV,SP70,SP70,SP70,SP70            * Old Value
          PACK      PMIWNEWV,PMDUUNIT,SP70,SP70,SP70,SP70   * New Value
          CALL      WRIDW000
.
          GOTO      ADDUNI99
.
ADDUNI90  MOVE      "Combination already exists. ",WEBTITLE
          CALL      WEBERR00   * Output Error
          MOVE      ONE,EXIT
.
ADDUNI99  RETURN
.
.------------------------------------------------------------
. Update Doctor/Unit Combination
.------------------------------------------------------------
UPDUNI00 PACK      KEY9,PMDUN001,PMDUN002,SP70
          CALL      RDPMDUN1
          IF        OVRCD<>0
            GOTO      UPDUNI90
          ENDIF
.
          MATCH     SP70,PMDUN003
          IF        !@EQUAL
            MOVE      PMDUN003,PMDUHEAD
          ELSE
            MOVE      "0",PMDUHEAD
          ENDIF
.
          CALL      UPPMDUN1
          GOTO      UPDUNI99
.
UPDUNI90  MOVE      "Invalid Doctor/Unit Combination. ",WEBTITLE
          CALL      WEBERR00   * Output Error
          MOVE      ONE,EXIT
.
UPDUNI99  RETURN
.------------------------------------------------------------
. Delete Doctor/Unit Combination
.------------------------------------------------------------
DELUNI00  CALL      CLDOCUNI
          PACK      KEY9,PMDUN001,PMDUN002,SP70
          CALL      RDPMDUN1
          IF        OVRCD<>0 
            GOTO      DELUNI90
          ENDIF
.
          MOVE      PMDUN001,PMDUDOCT
          MOVE      PMDUN002,PMDUUNIT
.
          CALL      DEPMDUN1
. **** Write EDWARD ISP Audit
          PACK      KEY16,PMDUDOCT,SP70
          CALL      RSPMHCP4
          CALL      RKPMHCP4
          BRANCH    OVRCD,DELUNI99               * Doctor Code does not exist
.
          MATCH     PMDUDOCT,PMHCLDOC               * Valid HCP found
          GOTO      DELUNI99 IF NOT EQUAL
.
          PACK      PMIWCODE,PMHCHCPC,SP70                  * HCP Code
          MOVE      "09 ",PMIWTYPE                          * Delete Unit
          PACK      PMIWOLDV,PMDUUNIT,SP70,SP70,SP70,SP70   * Old Value
          PACK      PMIWNEWV,SP70,SP70,SP70,SP70            * New Value
          CALL      WRIDW000
.
          GOTO      DELUNI99
.
DELUNI90  MOVE      "Combination does not exist. ",WEBTITLE
          CALL      WEBERR00   * Output Error
          MOVE      ONE,EXIT
.
DELUNI99  RETURN
.
.------------------------------------------------------------
. Clear Doctor/Unit Combination
.------------------------------------------------------------
CLDOCUNI  MOVE      SP70,PMDUDOCT
          MOVE      SP70,PMDUUNIT
          RETURN
.
.
.------------------------------------------------------------
. Format HCP Name (for Javascript)
.*** format the surname and given name by changing any ' to %60
.---------------------------------------------------------------
JAVHCP00  MOVE      PMHCTITL,SAVETITL
          MOVE      PMHCGNAM,SAVEGNAM
          MOVE      PMHCSNAM,SAVESNAM
          CLEAR     DISPNAME 
          MOVE      SP70,JAVFNAME
.
          MOVE      PMHCSNAM,JAVSNAME        * surname
          SCAN      "'",JAVSNAME             * find any apostrophies
          GOTO      JAVHCP10 IF NOT EQUAL
.
          MOVE      JAVSNAME,ENDNAME
          REP       "' ",ENDNAME             * remove the apostrophy
.
          LENSET    JAVSNAME
          RESET     JAVSNAME                 * get all characters before '
          MOVE      JAVSNAME,STRTNAME
.
          REP       "'%",STRTNAME
          STRIP     STRTNAME
          PACK      JAVSNAME,STRTNAME,SIXTY,ENDNAME,SP70 * formatted surname
.
JAVHCP10  MOVE      SP70,STRTNAME
          MOVE      SP70,ENDNAME
.
          MOVE      PMHCGNAM,JAVGNAME   * given name
          SCAN      "'",JAVGNAME        * find any apostrophies
          GOTO      JAVHCP20 IF NOT EQUAL
.
          MOVE      JAVGNAME,ENDNAME    * store all chars after apostrophy
          REP       "' ",ENDNAME        * remove the apostrophy
.
          LENSET    JAVGNAME
          RESET     JAVGNAME
          MOVE      JAVGNAME,STRTNAME   * store all chars before the '
.
          REP       "'%",STRTNAME
          STRIP     STRTNAME
          PACK      JAVGNAME,STRTNAME,SIXTY,ENDNAME,SP70  * formatted given name
.
JAVHCP20  MOVE      PMHCTITL,FMTTITLE
          MOVE      JAVGNAME,FMTGNAME
          MOVE      JAVSNAME,FMTSNAME
.
          CALL      DOCNM000
.
          MOVE      SAVETITL,PMHCTITL
          MOVE      SAVEGNAM,PMHCGNAM
          MOVE      SAVESNAM,PMHCSNAM
.
JAVHCP99  RETURN
.
.-------------------------------------------------------------------
. Format HCG Practice Name (for Javascript) by changing any ' to %60
.-------------------------------------------------------------------
...---------------------- moved to PMSHCGTM ------------------ CAR 234723
...JAVHCG00  PACK      JAVPNAME,SP70,SP70
....
...          MOVE      PMHGPNAM,JAVPNAME
...          SCAN      "'",JAVPNAME             * find any apostrophies
...          GOTO      JAVHCG99 IF NOT EQUAL
....
...          MOVE      JAVPNAME,HCGENAME
...          REP       "' ",HCGENAME            * remove the apostrophy
....
...          LENSET    JAVPNAME
...          RESET     JAVPNAME                 * get all characters before '
...          MOVE      JAVPNAME,HCGSNAME
....
...          REP       "'%",HCGSNAME
...          STRIP     HCGSNAME
...          PACK      JAVPNAME,HCGSNAME,SIXTY,HCGENAME,SP70 * formatted name
....
...JAVHCG99  RETURN
.
.------------------------------------------------------------
. Format Doctors Name (for Javascript)
.*** format the surname and given name by changing any ' to %60
.---------------------------------------------------------------
JAVDOC00  MOVE      DTITL,SAVETITL
          MOVE      DGNAME,SAVEGNAM
          MOVE      DSNAME,SAVESNAM
          CLEAR     DISPNAME
          MOVE      SP70,JAVFNAME
.
          MOVE      DSNAME,JAVSNAME        * surname
          SCAN      "'",JAVSNAME             * find any apostrophies
          GOTO      JAVDOC10 IF NOT EQUAL
.
          MOVE      JAVSNAME,ENDNAME
          BUMP      ENDNAME                   * skip the apostrophe
.
          LENSET    JAVSNAME
          RESET     JAVSNAME                 * get all characters before '
          MOVE      JAVSNAME,STRTNAME
.
          REP       "'%",STRTNAME
          STRIP     STRTNAME
          PACK      JAVSNAME,STRTNAME,SIXTY,ENDNAME,SP70 * formatted surname
.
JAVDOC10  MOVE      SP70,STRTNAME
          MOVE      SP70,ENDNAME
.
          MOVE      DGNAME,JAVGNAME   * given name
          SCAN      "'",JAVGNAME        * find any apostrophies
          GOTO      JAVDOC20 IF NOT EQUAL
.
          MOVE      JAVGNAME,ENDNAME    * store all chars after apostrophe
          BUMP      ENDNAME                   * skip the apostrophe
.
          LENSET    JAVGNAME
          RESET     JAVGNAME
          MOVE      JAVGNAME,STRTNAME   * store all chars before the '
.
          REP       "'%",STRTNAME
          STRIP     STRTNAME
          PACK      JAVGNAME,STRTNAME,SIXTY,ENDNAME,SP70  * formatted given name
.
JAVDOC20  MOVE      DTITL,FMTTITLE 
          MOVE      JAVGNAME,FMTGNAME
          MOVE      JAVSNAME,FMTSNAME
.
          CALL      DOCNM000            * Get java script format name
          MOVE      DOCFNAME,JAVFNAME
.
          MOVE      SAVETITL,FMTTITLE
          MOVE      SAVEGNAM,FMTGNAME
          MOVE      SAVESNAM,FMTSNAME
.
          CALL      DOCNM000            * Reset normal format name
.
JAVDOC99  RETURN
.
.------------------------------------------------------------
. HCP Comments Maintenance : Display,Add,Update,Delete
.------------------------------------------------------------
HCPCOM00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      HCPCOM40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      HCPCOM10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      HCPCOM20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      HCPCOM30 IF EQUAL
.
          GOTO      HCPCOM90
.
.         ************ ADD/UPDATE FORMACTION **********
.
HCPCOM10  CALL      CHKCOM00      * Checks mandatory fields
          BRANCH    EXIT,HCPCOM99
.
          CALL      CHKADD00      * Check comments add
          BRANCH    EXIT,HCPCOM99
.
          CALL      WRTCOM00                * Write HCP Comments
.
          MOVE      ZERO,EXIT
          GOTO      HCPCOM99
.
HCPCOM20  CALL      CHKCOM00      * Checks mandatory fields
          BRANCH    EXIT,HCPCOM99
.
          CALL      WRTCOM00                * Write HCP Comments
.
          MOVE      ZERO,EXIT
          GOTO      HCPCOM99
.
.         ************ DELETE FORMACTION **********
.
HCPCOM30  CALL      CHKCOM00      * Checks mandatory fields
          BRANCH    EXIT,HCPCOM99
.
          CALL      DELCOM00                * Delete HCP comments
.
          MOVE      ZERO,EXIT
          GOTO      HCPCOM99
.
.         ************ DISPLAY FORMACTION **********
.
HCPCOM40  PACK      KEY10,PMHCP001,SP70
          CALL      RDPMHCP1
          IF        OVRCD=1
            CALL      CLPMSHCP    * Clear all the file variables
          ENDIF
          MOVE      PMHCHCPC,GENPCODE
.
          CLEAR     WEBTITLE
          MOVE      "HCP Comment Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HCPCOM99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      HCPCOM99
.
HCPCOM90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HCPCOM99
.
HCPCOM99  CLOSE     COMFILAF,DELETE
          RETURN
.
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKCOM00  RESET     PMHCP001
          MATCH     SP70,PMHCP001
          GOTO      CHKCOM90 IF EQUAL
.
          MATCH     SP70,HCPCOMTY
          GOTO      CHKCOM91 IF EQUAL
.
          GOTO      CHKCOM98
.
CHKCOM90  MOVE      "HCP code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCOM99
.
CHKCOM91  MOVE      "HCP comment type cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCOM99
.
CHKCOM98  MOVE      ZERO,EXIT
CHKCOM99  RETURN
.
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKADD00  PACK      KEY16,PMHCP001,HCPCOMTY,SP70
          CALL      RSPMTCO1
          CALL      RKPMTCO1
          BRANCH    OVRCD,CHKADD98
.
          MATCH     PMHCP001,PMTCCODE
          GOTO      CHKADD98 IF NOT EQUAL
.
          MATCH     HCPCOMTY,PMTCTCOM
          GOTO      CHKADD98 IF NOT EQUAL
.
CHKADD90  MOVE      "HCP comment type exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKADD99
.
CHKADD98  MOVE      ZERO,EXIT
CHKADD99  RETURN
.
.*******************************************************************************
.                          Get Text Comments
.*******************************************************************************
GETCOM00  PREP      COMFILAF,COMFILNM
          MOVE      ZERO,COMNFLAG
          MOVE      ONE,F3
          WRITE     COMFILAF,SEQ;QRYDATA
.
GETCOM10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA
          GOTO      GETCOM90 IF OVER
          MATCH     SP70,QRYNAME
          GOTO      GETCOM80 IF NOT EQUAL
          ADD       ONE,F3
          WRITE     COMFILAF,SEQ;QRYDATA
          GOTO      GETCOM10
.
GETCOM80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
GETCOM90  MOVE      F3,COMMTEND
          OPEN      COMFILAF,COMFILNM
GETCOM99  RETURN
.
.*******************************************************************************
. Delete HCP Comments
.*******************************************************************************
DELCOM00  PACK      KEY16,PMHCP001,HCPCOMTY,SP70
          CALL      RSPMTCO1
DELCOM10  CALL      RKPMTCO1
          BRANCH    OVRCD,DELCOM99
.
          MATCH     PMHCP001,PMTCCODE            * Same HCP
          GOTO      DELCOM99 IF NOT EQUAL
.
          MATCH     HCPCOMTY,PMTCTCOM            * Same Comment Type
          GOTO      DELCOM99 IF NOT EQUAL
.
          PACK      KEY16,PMTCCODE,PMTCTCOM,PMTCLNUM,SP70
          CALL      DEPMTCO1
.
          CALL      RSPMTCO1
          GOTO      DELCOM10
.
DELCOM99  RETURN
.
.*******************************************************************************
. Update HCP Comments       
.*******************************************************************************
WRTCOM00  BRANCH    COMNFLAG,WRTCOM90
.         
          PACK      KEY16,PMHCP001,HCPCOMTY,SP70
          CALL      RSPMTCO1
WRTCOM10  CALL      RKPMTCO1
          BRANCH    OVRCD,WRTCOM20
.
          MATCH     PMHCP001,PMTCCODE            * Same HCP
          GOTO      WRTCOM20 IF NOT EQUAL
.
          MATCH     HCPCOMTY,PMTCTCOM            * Same Comment Type
          GOTO      WRTCOM20 IF NOT EQUAL
.
          PACK      KEY16,PMTCCODE,PMTCTCOM,PMTCLNUM,SP70
          CALL      DEPMTCO1
.
          CALL      RSPMTCO1
          GOTO      WRTCOM10
.
WRTCOM20  COMPARE   ZERO,COMMTEND
          GOTO      WRTCOM99 IF EQUAL
          MOVE      ZERO,F3
WRTCOM30  READ      COMFILAF,SEQ;COMM127
          GOTO      WRTCOM90 IF OVER
.
          ADD       ONE,F3
          MOVE      PMHCP001,PMTCCODE
          MOVE      HCPCOMTY,PMTCTCOM
          MOVE      F3,PMTCLNUM
          PACK      KEY16,PMTCCODE,PMTCTCOM,PMTCLNUM,SP70
          CALL      RDPMTCO1
          IF        OVRCD=1
            MOVE      COMM127,PMTCCOMM
            CALL      WRPMTCO1
          ENDIF
          COMPARE   F3,COMMTEND
          GOTO      WRTCOM30 IF NOT EQUAL
.
WRTCOM90  CLOSE     COMFILAF,DELETE
.
WRTCOM99  RETURN
.
.-------------------------------------------------------------
. Report 13: HCP Comments Maintenance
.-------------------------------------------------------------
GPPC0000  BRANCH    FLDITMNO,GPPC0100,GPPC0200,GPPC0300,GPPC0400,GPPC0500:
                             GPPC0600,GPPC0700
          GOTO      GPPC9999
.
GPPC0100  CALL      GPCTB000      * Table of HCP comments
          GOTO      GPPC9999
.
GPPC0200  CALL      NEXTCM00      * Link to Next Set of Codes
          GOTO      GPPC9999
.
GPPC0300  CALL      PREVCM00      * Link to Prev Set of Codes
          GOTO      GPPC9999
.
GPPC0400  CALL      LNKPRO00      * Link to Another Program
          GOTO      GPPC9999
.
GPPC0500  MOVE      "TZ",CATEGORY * HCP Comment Type
          MOVE      HCPCOMTY,CODE
          CALL      CODITM00 
          GOTO      GPPC9999
.
GPPC0600  PACK      KEY16,PMHCP001,HCPCOMTY,SP3
          CALL      RSPMTCO1
GPPC0610  CALL      RKPMTCO1
          BRANCH    OVRCD,GPPC9999
.
          MATCH     PMHCP001,PMTCCODE
          GOTO      GPPC9999 IF NOT EQUAL
.
          MATCH     HCPCOMTY,PMTCTCOM
          GOTO      GPPC9999 IF NOT EQUAL
.
          STRIP     PMTCCOMM
          MOVELPTR  PMTCCOMM,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      PMTCCOMM,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,127
          GOTO      GPPC0610
.
GPPC0700  WRITE     HTMLFILE;RETNFLAG;      * Return flag for comments screen
          GOTO      GPPC9999
.
GPPC9999  RETURN
.
.------------------------------------------------------------
. Table of HCP Comment
.------------------------------------------------------------
GPCTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY16,PMHCP001,SP70
          CALL      RSPMTCO2
GPCTB100  CALL      RKPMTCO2
          BRANCH    OVRCD,GPCTB900
.
          MATCH     PMHCP001,PMTCCODE
          GOTO      GPCTB900 IF NOT EQUAL
.
          MOVE      PMTCLNUM,F3
          COMPARE   ONE,F3
          GOTO      GPCTB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GPCTB100
          ENDIF
.
          CALL      GPCRW000      * GP's Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      GPCTB100 IF NOT EQUAL
          GOTO      GPCTB999
.
GPCTB900  CALL      NOMORE00      * Display No More Records Message
.
GPCTB999  RETURN
.
.------------------------------------------------------------
. HCP Comments (TABLE ROW)
.------------------------------------------------------------
GPCRW000  MOVE      "TZ",CATEGORY
          MOVE      PMTCTCOM,CODE
          CALL      GETCOD00
. 
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail13":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMTCCODE:
                             "&hcpcomty=",PMTCTCOM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMTCTCOM,"</td><td>",TDESC,"</td>":
                             "<td>&nbsp;",PMTCCOMM,"</td>":
                             "</tr>"
.
GPCRW999 RETURN
.
.-----------------------------------------------------------
. Link to Next Group of Codes
.-----------------------------------------------------------
NEXTCM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PMHCP001
          REP       " +",RETNFLAG
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmhcp001=",PMHCP001:
                                 "&retnflag=",RETNFLAG;
.
          REP       "+ ",PMHCP001
          REP       "+ ",RETNFLAG
.
NEXTCM99  RETURN
.-----------------------------------------------------------
. Link to Prev Group Codes
.-----------------------------------------------------------
PREVCM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PMHCP001
          REP       " +",RETNFLAG
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmhcp001=",PMHCP001:
                                 "&retnflag=",RETNFLAG;
.
          REP       "+ ",PMHCP001
          REP       "+ ",RETNFLAG
.
PREVCM99  RETURN
.
.------------------------------------------------------------
. Get Doctor Comments Type / Comments                                  *I-60046
. Parameters: KEY1 - Comments Type / Comments
.             KEY3 - Comments Line Number
.------------------------------------------------------------
DCOMDS00  PACK      KEY5,ANST,ANSZ,SP70
          CALL      RDSCODE1
DCOMDS10  CALL      RDKCODE1
          BRANCH    OVRCD,DCOMDS99
.
          MATCH     TCINDC2,ANSD
          GOTO      DCOMDS10 IF NOT EQUAL
.
          PACK      KEY16,DCODE,SP4,ACODE,KEY3
          CALL      RDPMTCO1
          BRANCH    OVRCD,DCOMDS99
.
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;TDESC;
          ELSE
            WRITE     HTMLFILE;PMTCCOMM;
          ENDIF
.
DCOMDS99  RETURN
.
.------------------------------------------------------------
. Establish if Doctor Comment Types exist (Cat.TZ)
.------------------------------------------------------------
DCOMTY00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,FORM1
          MATCH     SP1,KEY1                * get Cat.TZ Ind.2 value(group type)
          GOTO      DCOMTY90 IF EQUAL
.
          PACK      KEY10,DCODE,SP10
          PACK      KEY16,KEY10,SP20
          CALL      RSPMTCO2
DCOMTY10  CALL      RKPMTCO2
          BRANCH    OVRCD,DCOMTY90
.
          MATCH     KEY10,PMTCCODE
          GOTO      DCOMTY90 IF NOT EQUAL
          PACK      KEY5,CATTZ,PMTCTCOM,SP5 * get Cat.Code record to test Ind.2
          CALL      RDCODE1
          BRANCH    OVRCD,DCOMTY10
.
.                                           * Ind.2 = A - Ad-hoc comment
.                                           *         D - Pref.Contact details
          MATCH     TCINDC2,KEY1
          GOTO      DCOMTY10 IF NOT EQUAL
.
          MOVE      ONE,FORM1
.
DCOMTY90  WRITE     HTMLFILE;FORM1;
.
DCOMTY99  RETURN
.
.------------------------------------------------------------
. List Doctor Comments with Cat.TZ Ind.2 = "D"
.------------------------------------------------------------
DCOMTZ00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.         
          PACK      KEY10,DCODE,SP10
          PACK      KEY16,KEY10,SP20
          CALL      RSPMTCO2
DCOMTZ10  CALL      RKPMTCO2
          BRANCH    OVRCD,DCOMTZ99
.
          MATCH     KEY10,PMTCCODE
          GOTO      DCOMTZ99 IF NOT EQUAL
.
          MATCH     "  1",PMTCLNUM
          GOTO      DCOMTZ10 IF NOT EQUAL
.
          PACK      KEY5,CATTZ,PMTCTCOM,SP5 * get Cat.Code record to test Ind.2
          CALL      RDCODE1
          BRANCH    OVRCD,DCOMTZ10
.
.                                           * Ind.2 = D - Pref.Contact details
          MATCH     "D",TCINDC2
          GOTO      DCOMTZ10 IF NOT EQUAL
.
          REP       " +",PMTCCODE
          REP       " +",PMTCTCOM
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail13":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMTCCODE:
                             "&hcpcomty=",PMTCTCOM,"#")'>":
                             "<img src=../images/CommentIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             "&nbsp;",TDESC,"</td>"
.
          GOTO      DCOMTZ10
.
DCOMTZ99  RETURN
.
.------------------------------------------------------------
. List Doctor Ad-hoc Comment with Cat.TZ Ind.2 = "A"
.------------------------------------------------------------
DCOMAH00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          PACK      KEY10,DCODE,SP10
          PACK      KEY16,KEY10,SP20
          CALL      RSPMTCO2
DCOMAH10  CALL      RKPMTCO2
          BRANCH    OVRCD,DCOMAH99
.
          MATCH     KEY10,PMTCCODE
          GOTO      DCOMAH99 IF NOT EQUAL
          PACK      KEY5,CATTZ,PMTCTCOM,SP5 * get Cat.Code record to test Ind.2
          CALL      RDCODE1
          BRANCH    OVRCD,DCOMAH10
.
.                                           * Ind.2 = A - Ad-Hoc Comment (first)
          MATCH     "A",TCINDC2
          GOTO      DCOMAH10 IF NOT EQUAL
.
          REP       " +",PMTCCODE
          REP       " +",PMTCTCOM
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail13":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMTCCODE:
                             "&hcpcomty=",PMTCTCOM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             "&nbsp;",TDESC,"&nbsp; &nbsp; &nbsp;":
                             "&nbsp;",PMTCCOMM,"</td></tr>"
.
.
DCOMAH99  RETURN
.
.------------------------------------------------------------
. Set Doctor Comment Add button to "Ad-hoc Comment"
.------------------------------------------------------------
DCOMAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.         
          PACK      KEY10,DCODE,SP10
          REP       " +",KEY10
.
          PACK      KEY5,CATTZ,SP5          * Read Cat."TZ" to find first Ind.2
          CALL      RDSCODE1                * with code of "A"
DCOMAB10  CALL      RDKCODE1
          BRANCH    OVRCD,DCOMAB99
.                                           * Ind.2 = A - Ad-Hoc Comment (first)
          MATCH     CATTZ,TCODE
          GOTO      DCOMAB99 IF NOT EQUAL
.
          MATCH     "A",TCINDC2
          GOTO      DCOMAB10 IF NOT EQUAL
          REP       " +",ACODE
.
          WRITE     HTMLFILE;"ShowDetail13":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",KEY10:
                             "&hcpcomty=",ACODE,"#");"
.
DCOMAB99  RETURN
.
.------------------------------------------------------------
. Generate Next Doctor/HCP Code
.------------------------------------------------------------
GENC0000  COMMIT
          BEGIN     
          MOVE      "103",PRXCODE
          CALL      GETSLK00
.         
          READ      CONTROLF,HUND03;*185,PTCNNHCP,*195,PTCNSHCP
          MOVE      ZERO,FORM10
          SQUEEZE   PTCNNHCP
          MOVE      PTCNNHCP,FORM10
. 
          MATCH     "1",PTCNSHCP
          IF        @EQUAL
            IF        (FORM10%10) = 0
              ADD       ONE,FORM10
            ENDIF
          ENDIF
          ADD       ONE,FORM10
          MOVE      FORM10,PTCNNHCP
          WRITAB    CONTROLF,HUND03;*185,PTCNNHCP,*195,PTCNSHCP
.
          SUB       ONE,FORM10
          MOVE      FORM10,PTCNNHCP
          SQUEEZE   PTCNNHCP
.         
          CALL      RELSLK00
          COMMIT
          BEGIN     
.
          PACK      KEY6,PTCNNHCP,SP70    * Check if record is in doctor file
          CALL      RDDOCT1
          COMPARE   ZERO,OVRCD
          GOTO      GENC0000 IF EQUAL
.
          PACK      KEY10,PTCNNHCP,SP70   * Check if record is in HCP file
          CALL      RDPMHCP1
          COMPARE   ZERO,OVRCD
          GOTO      GENC0000 IF EQUAL
.
GENC9999  RETURN
.
.------------------------------------------------------------
. Table of Hospital Specific HCP Codes
.------------------------------------------------------------
HHCP0000  COMPARE   ONE,IBCNMHOS
          GOTO      HHCP9999 IF NOT EQUAL
.
          CALL      HHED0000      * Output Table Heading
.
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HHCP1000  CALL      RKPTHSP1
          BRANCH    OVRCD,HHCP9999
.
          WRITE     HTMLFILE;"<tr><td>",PTHSNAME,"</td>":
                             "<td align=center>":
                             "<input type=checkbox name=lhosparr";
.
          PACK      KEY13,PTHSHOSP,PMHCP001,SP70
          CALL      RDMLHCP1
          IF        OVRCD=0
            WRITE     HTMLFILE;" checked ";
          ENDIF
.
          WRITE     HTMLFILE;" value='",PTHSHOSP,"'>":
                             "</td></tr>"
.
          GOTO      HHCP1000
.
HHCP9999  RETURN
.
.------------------------------------------------------------
. Hospital Specific HCP Codes (TABLE HEADING)
.------------------------------------------------------------
HHED0000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=60%>Hospital</td>":
                             "<td class=HeadingCell align=center width=40%>":
                             "Link</td>":
                             "</tr>"
.
HHED9999  RETURN
.
.------------------------------------------------------------
. Update HCP Hospital Specific Details
.------------------------------------------------------------
LHOS0000  COMPARE   ONE,IBCNMHOS
          GOTO      LHOS9999 IF NOT EQUAL
.
          PACK      KEY13,PMHCP001,SP70
          CALL      RSMLHCP2
LHOS1000  CALL      RKMLHCP2                * Delete all linked codes
          BRANCH    OVRCD,LHOS3000
.
          MATCH     PMHCP001,MLHCHCPC
          GOTO      LHOS3000 IF NOT EQUAL
.
          PACK      KEY13,MLHCHCPC,MLHCHOSP,SP70
          CALL      DEMLHCP2
.
          GOTO      LHOS1000
.
LHOS3000  MOVE      ZERO,ARRCNT
.
LHOS3100  ADD       ONE,ARRCNT                   * Write hospital links
          IF        ARRCNT>LHOSPCNT
            GOTO      LHOS6000
          ENDIF
.
          MATCH     SP70,LHOSPARR[ARRCNT]
          GOTO      LHOS3100 IF EQUAL
.
          CALL      CLMLTHCP      * clear file variables
.
          PACK      MLHCHOSP,LHOSPARR[ARRCNT],SP70
          PACK      MLHCHCPC,PMHCP001,SP70
          MOVE      SP70,MLHCHSRI
          MOVE      SP70,MLHCSPAR
.
          PACK      KEY13,MLHCHOSP,MLHCHCPC,SP70
          CALL      RAMLHCP1
          IF        OVRCD=1
            CALL     WRMLHCP1
          ENDIF
.
          GOTO      LHOS3100
.
LHOS6000  PACK      KEY13,PMHCP001,SP70
          CALL      RSMLHCP2
LHOS6100  CALL      RKMLHCP2                * Delete all linked codes
          BRANCH    OVRCD,LHOS7000
.
          MATCH     PMHCP001,MLHCHCPC
          GOTO      LHOS7000 IF NOT EQUAL
.
          PACK      KEY10,PMHCP001,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      ONE,PMHCHOSS
            CALL      UPPMHCP1
          ENDIF
.
          PACK      KEY6,PMHCP001,SP70
          CALL      RDDOCT1
          IF        OVRCD=0
            MOVE      ONE,PTDOHOSS
            CALL      UPDOCT1
          ENDIF
          GOTO      LHOS8000
.
LHOS7000  PACK      KEY10,PMHCP001,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      ZERO,PMHCHOSS
            CALL      UPPMHCP1
          ENDIF
.
          PACK      KEY6,PMHCP001,SP70
          CALL      RDDOCT1
          IF        OVRCD=0
            MOVE      ZERO,PTDOHOSS
            CALL      UPDOCT1
          ENDIF
.
LHOS8000  MOVE      ZERO,EXIT
          GOTO      LHOS9999
.
LHOS9999  RETURN
.
+
.------------------------------------------------------------
. Output doctors leave flag 1=a record exists
.------------------------------------------------------------
GETLV000  PACK      KEY14,DOCTCODE,SP70
          CALL      RSOPDLV1
GETLV100  CALL      RKOPDLV1
          BRANCH    OVRCD,GETLV999
.         
          MATCH     DOCTCODE,OPDVDOCT
          GOTO      GETLV900 IF NOT EQUAL
.         
          WRITE     HTMLFILE;ONE;
          GOTO      GETLV999
.         
GETLV900  WRITE     HTMLFILE;ZERO;
          GOTO      GETLV999
.         
GETLV999  RETURN    
+
.------------------------------------------------------------
. Doctor Search Results JSON
.------------------------------------------------------------
SRCDCJ00  CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          IF        LNK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
            UNPACK    DIM127,D1,LINKPUB,DIM127
          ENDIF
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,DOCAREND         * Number of doctors in DOCARRAY[]
.
          WRITE      HTMLFILE;"[ ";
          STRIP     KEYWRD01
          PACK      KEY21,KEYWRD01,SP70
          CALL      RSPTDK2
SRCDCJ10  CALL      RKPTDK2
          BRANCH    OVRCD,SRCDCJ90
.
          MOVE      PTDKDOC,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,SRCDCJ10
.
          MOVE      ACTIVINH,STATUS
          MOVE      DRSTAT,F1
          LOAD      STATUS,F1,NOTACTIV,ACTIVOUT
          CALL      PATDKB00
          BRANCH    OVRCD,SRCDCJ10,SRCDCJ90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SRCDCJ10
          ENDIF
.
          MOVE      "DT",CATEGORY
          MOVE      DRTYPE,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC01
.
          MOVE      DRTYPE2,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC02
.
          MOVE      DRTYPE3,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC03
.
          MOVE      DRTYPE4,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC04
.
          MOVE      DRTYPE5,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC05
.
          MOVE      DOCTSTAT,KEY1
          REP       " +",KEY1
.
          MOVE      DCODE,KEY6
          REP       " +",KEY6
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
.
          MOVE      SP70,DISPDAT1
          MATCH     SP70,PTDOSDAT
          IF        !@EQUAL
            UNPACK    PTDOSDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DISPDAT2
          MATCH     SP70,PTDOEDAT
          IF        !@EQUAL
            UNPACK    PTDOEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE      HTMLFILE;"{#"doctcode#":#"",DCODE,"#",":
                                "#"doctorName#":#"",DOCFNAME,"#",":
                                "#"providerNumber#":#"",DPROV,"#",":
                                "#"doctorType1#":#"",DESC01,"#",":
                                "#"doctorType2#":#"",DESC02,"#",":
                                "#"doctorType3#":#"",DESC03,"#",":
                                "#"doctorType4#":#"",DESC04,"#",":
                                "#"doctorType5#":#"",DESC05,"#",":
                                "#"address1#":#"",DSADD1,"#",":
                                "#"address2#":#"",DSADD2,"#",":
                                "#"address3#":#"",DSADD3,"#",":
                                "#"address4#":#"",DSADD4,"#",":
                                "#"telephone#":#"",DTELES,"#",";
.
.
          MATCH     "1",LINKPUB
          IF        !@EQUAL
            WRITE     HTMLFILE;"#"pager#":#"",DTELEP,"-",DPAGER,"#",":
                                "#"mobile#":#"",PTDOMOBL,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"fax#":#"",PTDOFAXN,"#",":
                             "#"startDate#":#"",DISPDAT1,"#",":
                             "#"endDate#":#"",DISPDAT2,"#",":
                             "#"status#":#"",STATUS,"#",":
                             "#"post#":#"",DSPOST,"#"},";
          GOTO      SRCDCJ80
.
SRCDCJ80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SRCDCJ10 IF NOT EQUAL
SRCDCJ90  WRITE     HTMLFILE;"] ";
SRCDCJ99  RETURN
+         
.----------------------------------------------------------------
. Teams maintenance report 15
.----------------------------------------------------------------
PMSTEM00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      PMSTEM40 IF EQUAL       * Display
.
          MATCH     "A",UPDTTYPE            * Add team
          GOTO      PMSTEM10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update team
          GOTO      PMSTEM20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete team
          GOTO      PMSTEM30 IF EQUAL
.
          GOTO      PMSTEM93

.          ************ ADD FORMACTION ***********
.
PMSTEM10  PACK      KEY5,PMTEM001,SP70
          CALL      RDPMTEM1
          COMPARE   ZERO,OVRCD
          GOTO      PMSTEM91 IF EQUAL       * if record exisits error
.
          CALL      MVPMTE00                * get the cgi parameters
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CURRDATE,PMTMCDAT       * date record created
          MOVE      CTIMEIS,PMTMCTIM        * time record created
          MOVE      USERID,PMTMCUID         * web user created
          MOVE      SP70,PMTMUDAT
          MOVE      SP70,PMTMUTIM
          MOVE      SP70,PMTMUUID
          MOVE      SP70,PMTMSPAR
.
          PACK      KEY5,PMTMTEAM,SP70
          CALL      RAPMTEM1
          IF        OVRCD=1
            CALL      WRPMTEM1              * write a record
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PMSTEM99
.
.          ************ UPDATE FORMACTION **********
.
PMSTEM20  PACK      KEY5,PMTEM001,SP70
          CALL      RDPMTEM1
          BRANCH    OVRCD,PMSTEM90          * error if record not found
.
          CALL      MVPMTE00                * get the cgi parameters
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CURRDATE,PMTMUDAT       * date record updated
          MOVE      CTIMEIS,PMTMUTIM        * time record updated
          MOVE      USERID,PMTMUUID         * web user updated
.
          CALL      UPPMTEM1                * update the record
.
          MOVE      ZERO,EXIT
          GOTO      PMSTEM99
.
.          ************ DELETE FORMACTION **********
.
PMSTEM30  PACK      KEY5,PMTEM001,SP70
          CALL      RDPMTEM1
          BRANCH    OVRCD,PMSTEM90
.
          CALL      DEPMTEM1               * delete the record
.
          MOVE      ZERO,EXIT
          GOTO      PMSTEM99
.
.          ************ DISPLAY FORMACTION **********
.
PMSTEM40  PACK      KEY5,PMTEM001,SP70
          CALL      RDPMTEM1
          IF        OVRCD=1
            CALL      CLPMTE00                  * Clear team variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Teams Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSTEM99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PMSTEM99
.
.         *********** ERROR CONDITIONS ***************
.
PMSTEM90  MOVE      "Team code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSTEM99
.
PMSTEM91  MOVE      "Team code already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSTEM99
.
PMSTEM92  MOVE      "Please remove all team members before deletion.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSTEM99
.
PMSTEM93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSTEM99
.
PMSTEM99  RETURN
+
.----------------------------------------------------------------
. Teams Details tags
.----------------------------------------------------------------
PMTT0000  BRANCH    FLDITMNO,PMTT0010,PMTT0020,PMTT0030,PMTT0040:
                             PMTT0050
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMTT9999
.
PMTT0010  CALL      PMTAB000                * Team Table
          GOTO      PMTT9999
.
PMTT0020  CALL      NEXTPM00
          GOTO      PMTT9999
.
PMTT0030  CALL      PREVPM00
          GOTO      PMTT9999
.
PMTT0040  WRITE     HTMLFILE;PMTEM001;      * team code
          GOTO      PMTT9999
.
PMTT0050  CALL      PETAB000                * Team Member Table
          GOTO      PMTT9999
.
PMTT9999  RETURN
+
.------------------------------------------------------------
. Table of teams 
.------------------------------------------------------------
PMTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY5,STARTKEY,SP70      * startkey for Goto Button
          CALL      RSPMTEM1                * positional read
          CALL      RPPMTEM1
PMTAB100  CALL      RKPMTEM1                * read a record
          BRANCH    OVRCD,PMTAB900          * end of file
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PMTAB100
          ENDIF
.
          CALL      PMROW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PMTAB100 IF NOT EQUAL
          GOTO      PMTAB999
.
PMTAB900  CALL      NOMORE00                * Display No More Records Message
.
PMTAB999  RETURN
.-----------------------------------------------------------------
. Team (TABLE ROW)
.------------------------------------------------------------
PMROW000  MATCH     "1",PMTMACTV
          IF        @EQUAL
            MOVE      "No ",KEY3
          ELSE
            MOVE      "Yes",KEY3
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail15":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmtem001=",PMTMTEAM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMTMTEAM,"</td>":
                             "<td align=left>&nbsp",PMTMDESC,"</td>":
                             "<td align=left>&nbsp",KEY3,"</td>":
                             "</tr>"
.
PMROW999 RETURN
+
.-----------------------------------------------------------
. Link to Next Group option 15
.-----------------------------------------------------------
NEXTPM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PMTEM001
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmtem001=",PMTEM001:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",PMTEM001
.
NEXTPM99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 15
.-------------------------------------------------------------
PREVPM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PMTEM001
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                "?reportno=",F2:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&pmtem001=",PMTEM001:
                                "&startkey=",STARTKEY;
.
          REP       "+ ",PMTEM001
.
PREVPM99  RETURN
+
.----------------------------------------------------------------
. Table of team members : Report 16
.------------------------------------------------------------
PETAB000  
PETAB999  RETURN
+
.------------------------------------------------------------
. Linked Hospitals Maintenance : Display,Add,Update,Delete
.------------------------------------------------------------
HOSLNK00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      HOSLNK40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      HOSLNK10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      HOSLNK20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      HOSLNK30 IF EQUAL
.
          GOTO      HOSLNK93
.
.         ************ ADD FORMACTION **********
.
HOSLNK10  PACK      KEY13,MLHCP001,MLHCP002,SP70
          CALL      RDMLHCP1
          COMPARE   ZERO,OVRCD
          GOTO      HOSLNK92 IF EQUAL
.
          CALL      CLMLTHCP      * clear file variables
          CALL      MVMLHC00      * Moves input variables to file variables
.         
          PACK      KEY13,MLHCHOSP,MLHCHCPC,SP70
          CALL      RAMLHCP1
          IF        OVRCD=1
            CALL      WRMLHCP1    * Writes away the data
            PACK      KEY10,MLHCHCPC,SP70   * Read a valid HCP Record
            CALL      RDPMHCP1
            IF        OVRCD<>1
              MOVE      "U",PMHCACTN    * action flag for DGCLIM02
              MOVE      EIGHT,HL7TRGID
              MOVE      SP8,HL7INCLD
              PROC      DGCLIM02        * send HL7 message "Doctor Details"
            ENDIF
          ENDIF
.
          MOVE      MLHCP002,MULTIHCP
          CALL      ULHI0000      * update linked hospital flag for hcp/doctor
.
          MOVE      ZERO,EXIT
          GOTO      HOSLNK99
.
.         ************ UPDATE FORMACTION **********
.
HOSLNK20  PACK      KEY13,MLHCP001,MLHCP002,SP70
          CALL      RDMLHCP1
          BRANCH    OVRCD,HOSLNK91
.
          CALL      MVMLHC00      * Moves input variables to file variables
.
          CALL      UPMLHCP1      * Writes away the data
.
          PACK      KEY10,MLHCP002,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      NINE,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
          ENDIF
.
          MOVE      MLHCP002,MULTIHCP
          CALL      ULHI0000      * update linked hospital flag for hcp/doctor
.
          MOVE      ZERO,EXIT
          GOTO      HOSLNK99
.
.         ************ DELETE FORMACTION **********
.
HOSLNK30  PACK      KEY13,MLHCP001,MLHCP002,SP70
          CALL      RDMLHCP1
          BRANCH    OVRCD,HOSLNK91
.
          PACK      KEY13,MLHCHOSP,MLHCHCPC,SP70
          CALL      DEMLHCP1      * delete the record
          PACK      KEY10,MLHCHCPC,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      TEN,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
          ENDIF
.
          MOVE      MLHCP002,MULTIHCP
          CALL      ULHI0000      * update linked hospital flag for hcp/doctor
.
          MOVE      ZERO,EXIT
          GOTO      HOSLNK99
.
.         ************ DISPLAY FORMACTION **********
.
HOSLNK40  PACK      KEY10,PMHCP001,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          BRANCH    OVRCD,HOSLNK94
          MOVE      PMHCHCPC,GENPCODE
.
          PACK      KEY13,HOSPCODE,PMHCP001,SP70
          CALL      RDMLHCP1
          IF        OVRCD=1
            CALL      CLMLTHCP    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Linked Hospitals Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HOSLNK99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      HOSLNK99
.
HOSLNK91  MOVE      "Linked Hospital record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSLNK99
.
HOSLNK92  MOVE      "Linked Hospital record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSLNK99
.
HOSLNK93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSLNK99
.
HOSLNK94  MOVE      "Invalid HCP",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSLNK99
.
HOSLNK99  RETURN
+
.-------------------------------------------------------------
. Report 16: Linked Hospitals Tags
.-------------------------------------------------------------
HLNK0000  BRANCH    FLDITMNO,HLNK0100,HLNK0200,HLNK0300,HLNK0400,HLNK0500
          GOTO      HLNK9999
.
HLNK0100  CALL      LNKHS000      * Table of Linked Hospitals
          GOTO      HLNK9999
.
HLNK0200  CALL      NEXTCM00      * Link to Next Set of Codes
          GOTO      HLNK9999
.
HLNK0300  CALL      PREVCM00      * Link to Prev Set of Codes
          GOTO      HLNK9999
.
HLNK0400  CALL      LNKPRO00      * Link to Another Program
          GOTO      HLNK9999
.
HLNK0500  WRITE     HTMLFILE;RETNFLAG;      * Return flag for hospitals screen
          GOTO      HLNK9999
.
HLNK9999  RETURN
+
.------------------------------------------------------------
. Table of HCP Linked Hospitals
.------------------------------------------------------------
LNKHS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      LNKHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY13,PMHCP001,SP70
          CALL      RSMLHCP2
LNKHS100  CALL      RKMLHCP2
          BRANCH    OVRCD,LNKHS900
.
          MATCH     PMHCP001,MLHCHCPC
          GOTO      LNKHS900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LNKHS100
          ENDIF
.
          CALL      LHSRW000      * Linked Hospitals Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      LNKHS100 IF NOT EQUAL
          GOTO      LNKHS999
.
LNKHS900  CALL      NOMORE00      * Display No More Records Message
.
LNKHS999  RETURN
.
.------------------------------------------------------------
. HCP Linked Hospitals (TABLE HEADING)
.------------------------------------------------------------
LNKHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=5%>Hospital":
                             "</td>":
                             "<td class=HeadingCell width=20%>Description":
                             "</td>":
                             "<td class=HeadingCell width=10%>Provider Number":
                             "</td>":
                             "<td class=HeadingCell width=10%>Start Date":
                             "</td>":
                             "<td class=HeadingCell width=10%>End Date":
                             "</td>";
.
          MATCH     "1",PTCNDIVN
          GOTO      LNKHD500 IF NOT EQUAL        * not using divisions
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=20%>":
                             "Primary Specialty":
                             "</td>":
                             "<td class=HeadingCell width=5%>Units":
                             "</td>":
                             "<td class=HeadingCell width=5%>Roles":
                             "</td>";
          GOTO      LNKHD900
.
LNKHD500  WRITE     HTMLFILE;"<td class=HeadingCell width=30%>":
                             "Primary Specialty":
                             "</td>";
.
LNKHD900  WRITE     HTMLFILE;"</tr>"
LNKHD999  RETURN
.
.------------------------------------------------------------
. HCP Linked Hospitals (TABLE ROW)
.------------------------------------------------------------
LHSRW000  PACK      KEY3,MLHCHOSP,SP70
          CALL      RDPTHSP1
          IF        OVRCD=1
            MOVE      MLHCHOSP,PTHSNAME
          ENDIF
.
          MOVE      "DT",CATEGORY
          MOVE      PMHCSPC1,CODE
          CALL      GETCOD00
.
          MOVE      SP70,DISPDAT1
          MATCH     SP70,MLHCSDAT
          IF        !@EQUAL
            UNPACK    MLHCSDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DISPDAT2
          MATCH     SP70,MLHCEDAT
          IF        !@EQUAL
            UNPACK    MLHCEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          CALL      LNKUIC00                * Linked Units Indicator
          CALL      LNKRIC00                * Linked Roles Indicator
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail16":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",MLHCHCPC:
                             "&hospcode=",MLHCHOSP,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             MLHCHOSP,"</td>":
                             "<td>&nbsp;",PTHSNAME,"</td>":
                             "<td>&nbsp;",MLHCPROV,"</td>":
                             "<td>&nbsp;",DISPDAT1,"</td>":
                             "<td>&nbsp;",DISPDAT2,"</td>":
                             "<td>&nbsp;",TDESC,"</td>";
.
          MATCH     "1",PTCNDIVN
          GOTO      LHSRW900 IF NOT EQUAL        * not using divisions
.
          IF        LNKUNIND = 1
            WRITE     HTMLFILE;"<td><input type=button class=SmallRedButton":
                               " value=",UNITDESC;
          ELSE
            WRITE     HTMLFILE;"<td><input type=button class=SmallButton":
                               " value=",UNITDESC;
          ENDIF
          WRITE     HTMLFILE;" onClick='LinkedUnits16(#"",MLHCHOSP,"#")'></td>";
.
          IF        LNKRLIND = 1
            WRITE     HTMLFILE;"<td><input type=button class=SmallRedButton":
                               " value=",ROLEDESC;
          ELSE
            WRITE     HTMLFILE;"<td><input type=button class=SmallButton":
                               " value=",ROLEDESC;
          ENDIF
          WRITE     HTMLFILE;" onClick='LinkedRoles16(#"",MLHCHOSP,"#")'></td>";
.
LHSRW900 WRITE     HTMLFILE;"</tr>"
LHSRW999 RETURN
.
.------------------------------------------------------------
. Linked Roles Indicator for a HCP/Hospital combo
.------------------------------------------------------------
LNKRIC00  PACK      KEY16,MLHCHCPC,MLHCHOSP,SP70
          CALL      RSPMRLD1
          CALL      RKPMRLD1                * Does hcp/hosp have roles?
          BRANCH    OVRCD,LNKRIC10
.
          MATCH     MLHCHCPC,PMRDDOCT       * Same hcp?
          GOTO      LNKRIC10 IF NOT EQUAL
.
          MATCH     MLHCHOSP,PMRDHOSP       * Same hosp?
          GOTO      LNKRIC10 IF NOT EQUAL
.
          MOVE      ONE,LNKRLIND            * roles exist
          GOTO      LNKRIC99
.
LNKRIC10  MOVE      ZERO,LNKRLIND           * no roles exist
LNKRIC99  RETURN
+
.------------------------------------------------------------
. Linked Units Indicator for a HCP/Hospital combo
.------------------------------------------------------------
LNKUIC00  PACK      KEY21,MLHCHCPC,MLHCHOSP,SP70
          CALL      RSPMTMD1
          CALL      RKPMTMD1                * Does hcp/hosp have units?
          BRANCH    OVRCD,LNKUIC10
.
          MATCH     MLHCHCPC,PMTDDOCT       * Same hcp?
          GOTO      LNKUIC10 IF NOT EQUAL
.
          MATCH     MLHCHOSP,PMTDHOSP       * Same hosp?
          GOTO      LNKUIC10 IF NOT EQUAL
.
          MOVE      ONE,LNKUNIND            * units exist
          GOTO      LNKUIC99
.
LNKUIC10  MOVE      ZERO,LNKUNIND           * no units exist
LNKUIC99  RETURN
+
.------------------------------------------------------------
. Linked Teams Indicator for a HCP/Hospital/Unit combo
.------------------------------------------------------------
LNKTIC00  PACK      SAVKEY21,PMTDDOCT,PMTDHOSP,PMTDUNIT,PMTDTEAM,SP70
          MOVE      ZERO,TEMCOUNT           * team count
          PACK      KEY21,MLHCHCPC,MLHCHOSP,PMTMD003,SP70
          CALL      RSPMTMD1
LNKTIC10  CALL      RKPMTMD1                * Does hcp/hosp/unit have teams?
          BRANCH    OVRCD,LNKTIC50
.
          MATCH     MLHCHCPC,PMTDDOCT       * Same hcp?
          GOTO      LNKTIC50 IF NOT EQUAL
.
          MATCH     MLHCHOSP,PMTDHOSP       * Same hosp?
          GOTO      LNKTIC50 IF NOT EQUAL
.
          MATCH     PMTMD003,PMTDUNIT       * Same unit?
          GOTO      LNKTIC50 IF NOT EQUAL
.
          MOVE      PMTDTEAM,SAVTEAM        * for display in list
          ADD       ONE,TEMCOUNT            * team count
          COMPARE   ONE,TEMCOUNT
          GOTO      LNKTIC10 IF EQUAL       * check for more than 1 team
.
LNKTIC50  BRANCH    TEMCOUNT,LNKTIC90,LNKTIC92
.
          MOVE      ZERO,LNKTEIND           * no teams exist
          MOVE      SP70,SAVTEAM            * for display in list
          GOTO      LNKTIC95
.
LNKTIC90  MOVE      ONE,LNKTEIND            * one team exists
          GOTO      LNKTIC95
.
LNKTIC92  MOVE      TWO,LNKTEIND            * at least 2 teams exist
LNKTIC95  PACK      KEY21,SAVKEY21          * reposition in table
          CALL      RDPMTMD1
LNKTIC99  RETURN
+
.------------------------------------------------------------
. Update Linked Hospital Indicator for a HCP
.------------------------------------------------------------
ULHI0000  PACK      KEY13,MULTIHCP,SP70
          CALL      RSMLHCP2
          CALL      RKMLHCP2                * check for linked hospitals
          BRANCH    OVRCD,ULHI5000
.
          MATCH     MULTIHCP,MLHCHCPC
          GOTO      ULHI5000 IF NOT EQUAL
.
          PACK      KEY10,MULTIHCP,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      ONE,PMHCHOSS
            CALL      UPPMHCP1
          ENDIF
.
          PACK      KEY6,MULTIHCP,SP70
          CALL      RDDOCT1
          IF        OVRCD=0
            MOVE      ONE,PTDOHOSS
            CALL      UPDOCT1
          ENDIF
          GOTO      ULHI9999
.
ULHI5000  PACK      KEY10,MULTIHCP,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      ZERO,PMHCHOSS
            CALL      UPPMHCP1
          ENDIF
.
          PACK      KEY6,MULTIHCP,SP70
          CALL      RDDOCT1
          IF        OVRCD=0
            MOVE      ZERO,PTDOHOSS
            CALL      UPDOCT1
          ENDIF
.
ULHI9999  RETURN
+
.----------------------------------------------------------------
. Doctor Unit/Teams maintenance report 17
.----------------------------------------------------------------
PMSTMD00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      PMSTMD40 IF EQUAL       * Display
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSTMD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSTMD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PMSTMD30 IF EQUAL
.
          GOTO      PMSTMD98

.          ************ ADD FORMACTION ***********
.
PMSTMD10  PACK      KEY21,PMTMD001,PMTMD002,PMTMD003,PMTMD004,SP70
          CALL      RDPMTMD1
          COMPARE   ZERO,OVRCD
          GOTO      PMSTMD91 IF EQUAL       * if record exists error
.
          CALL      CLPMSTMD                * Clear file variables
          CALL      MVPMTM00                * get the cgi parameters
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CURRDATE,PMTDCDAT       * date record created
          MOVE      CTIMEIS,PMTDCTIM        * time record created
          MOVE      USERID,PMTDCUID         * web user created
.
          PACK      KEY21,PMTDDOCT,PMTDHOSP,PMTDUNIT,PMTDTEAM,SP70
          CALL      RAPMTMD1
          IF        OVRCD=1
            CALL      WRPMTMD1              * write a record
            PACK      KEY10,PMTDDOCT,SP70   * Read a valid HCP Record
            CALL      RDPMHCP1
            IF        OVRCD<>1
              MOVE      "U",PMHCACTN    * action flag for DGCLIM02
              MOVE      TEN1,HL7TRGID
              MOVE      SP8,HL7INCLD
              PROC      DGCLIM02        * send HL7 message "Doctor Details"
            ENDIF
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PMSTMD99
.
.          ************ UPDATE FORMACTION **********
.
PMSTMD20  PACK      KEY21,PMTMD001,PMTMD002,PMTMD003,PMTMD004,SP70
          CALL      RDPMTMD1
          BRANCH    OVRCD,PMSTMD90          * error if record not found
.
          CALL      MVPMTM00                * get the cgi parameters
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CURRDATE,PMTDUDAT       * date record updated
          MOVE      CTIMEIS,PMTDUTIM        * time record updated
          MOVE      USERID,PMTDUUID         * web user updated
.
          CALL      UPPMTMD1                * update the record
.
          PACK      KEY10,PMTMD001,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      TEN2,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PMSTMD99
.
.          ************ DELETE FORMACTION **********
.
PMSTMD30  PACK      KEY21,PMTMD001,PMTMD002,PMTMD003,PMTMD004,SP70
          CALL      RDPMTMD1
          BRANCH    OVRCD,PMSTMD90          * error if record not found
.
          PACK      KEY21,PMTDDOCT,PMTDHOSP,PMTDUNIT,PMTDTEAM,SP70
          CALL      DEPMTMD1               * delete the record
          PACK      KEY10,PMTDDOCT,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          IF        OVRCD<>1
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      TEN3,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PMSTMD99
.
.          ************ DISPLAY FORMACTION **********
.
PMSTMD40  PACK      KEY13,HOSPCODE,PMHCP001,SP70
          CALL      RDMLHCP1
          IF        OVRCD=1
            CALL      CLMLTHCP             * Clear file variables
          ENDIF
.
          PACK      KEY21,PMHCP001,HOSPCODE,PMTMD003,PMTMD004,SP70
          CALL      RDPMTMD1
          IF        OVRCD=1
            CALL      CLPMSTMD             * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "HCP Hospital/Unit/Teams Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSTMD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PMSTMD99
.
.         *********** ERROR CONDITIONS ***************
.
PMSTMD90  MOVE      "Code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSTMD99
.
PMSTMD91  MOVE      "Code already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSTMD99
.
PMSTMD98  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSTMD99
.
PMSTMD99  RETURN
+
.-------------------------------------------------------------
. General Table Tags
.-------------------------------------------------------------
TABL0000  BRANCH    FLDITMNO,TABL0100,TABL0200,TABL0300,TABL0400,TABL0500:
                             TABL0600,TABL0700,TABL0800,TABL0900,TABL1000:
                             TABL1100,TABL1200,TABL1300,TABL1400,TABL1500:
                             TABL1600,TABL1700,TABL1800,TABL1900,TABL2000:
                             TABL2100,TABL2200
          GOTO      TABL9999 
.         
TABL0100  CALL      HOSUNI00      * Seln list for Units attached to a hospital
          GOTO      TABL9999
.         
TABL0200  CALL      NEXTUN00      * Link to Next Set of Doctor Units
          GOTO      TABL9999      
.         
TABL0300  CALL      PREVUN00      * Link to Prev Set of Doctor Units
          GOTO      TABL9999
.
TABL0400  PACK      KEY21,PMHCP001,HOSPCODE,SP70
          CALL      RSPMTMD1
          CALL      RKPMTMD1                * Does hcp/hosp have units?
          BRANCH    OVRCD,TABL0410
.
          MATCH     PMHCP001,PMTDDOCT       * Same hcp?
          GOTO      TABL0410 IF NOT EQUAL
.
          MATCH     HOSPCODE,PMTDHOSP       * Same hosp?
          GOTO      TABL0410 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * units exist
          GOTO      TABL9999
.
TABL0410  WRITE     HTMLFILE;ZERO;          * no units exist
          GOTO      TABL9999
.
TABL0500  CALL      LNKUN000                * Table of doctor Linked Units
          GOTO      TABL9999
.
TABL0600  WRITE     HTMLFILE;RETNFLAG;      * Return flag for hospitals screen
          GOTO      TABL9999
.
TABL0700  PACK      KEY21,PMHCP001,HOSPCODE,PMTMD003,SP70
          CALL      RSPMTMD1
          CALL      RKPMTMD1                * Does hcp/hosp/unit have teams?
          BRANCH    OVRCD,TABL0710
.
          MATCH     PMHCP001,PMTDDOCT       * Same hcp?
          GOTO      TABL0710 IF NOT EQUAL
.
          MATCH     HOSPCODE,PMTDHOSP       * Same hosp?
          GOTO      TABL0710 IF NOT EQUAL
.
          MATCH     PMTMD003,PMTDUNIT       * Same unit?
          GOTO      TABL0710 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * teams exist
          GOTO      TABL9999
.
TABL0710  WRITE     HTMLFILE;ZERO;          * no teams exist
          GOTO      TABL9999
.
TABL0800  CALL      LNKTE000      * Table of Unit Linked Teams
          GOTO      TABL9999
.
TABL0900  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          PACK      KEY5,PMTDTEAM,SP70
          CALL      RDPMTEM1
          IF        OVRCD=1
            MOVE      SP70,PMTMTEAM
            MOVE      SP70,PMTMDESC
          ENDIF
          BRANCH    F1,TABL0910,TABL0920
          WRITE     HTMLFILE;PMTMDESC;      * team description
          GOTO      TABL9999
.
TABL0910  WRITE     HTMLFILE;PMTMTEAM;      * team code
          GOTO      TABL9999
.
TABL0920  PACK      KEY5,SP70               * team selection list
          CALL      RSPMTEM1
TABL0925  CALL      RKPMTEM1
          BRANCH    OVRCD,TABL9999
.
          MATCH     "1",PMTMACTV
          GOTO      TABL0925 IF EQUAL
.
          PACK      KEY7,QUOTE,PMTMTEAM,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY7,">",PMTMDESC,"</option>"
          GOTO      TABL0925
.
TABL1000  WRITE     HTMLFILE;PMTMD003;      * Unit
          GOTO      TABL9999
.
TABL1100  CALL      HOSTEM00      * Seln list for Teams attached to a hospital
          GOTO      TABL9999
.
TABL1200  CALL      LNKRL000                * Table of doctor Linked Roles
          GOTO      TABL9999
.
TABL1300  CALL      NEXTRL00      * Link to Next Set of Doctor Roles
          GOTO      TABL9999
.         
TABL1400  CALL      PREVRL00      * Link to Prev Set of Doctor Roles
          GOTO      TABL9999
.
TABL1500  PACK      KEY3,MLHCHOSP,SP70
          CALL      RDPTHSP1
          IF        OVRCD=1
            MOVE      MLHCHOSP,PTHSNAME
          ENDIF
          WRITE     HTMLFILE;PTHSNAME;      * Hospital name
          GOTO      TABL9999
.
TABL1600  PACK      KEY10,MLHCHCPC,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,TABL9999
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;      * hcp name
          GOTO      TABL9999
.
TABL1700  CALL      LNKAR000      * Table of doctor Linked Arrangements
          GOTO      TABL9999
.
TABL1800  CALL      NEXTDA00      * Link to Next Set of Doctor Arrangements
          GOTO      TABL9999
.
TABL1900  CALL      PREVDA00      * Link to Prev Set of Doctor Arrangements
          GOTO      TABL9999
.
TABL2000  CALL      HCPSP000      * Table of HCP Specialties
          GOTO      TABL9999
.
TABL2100  CALL      NEXTSP00      * Link to Next Set of HCP Specialties
          GOTO      TABL9999
.
TABL2200  CALL      PREVSP00      * Link to Prev Set of HCP Specialties
          GOTO      TABL9999
.
TABL9999  RETURN
+
.-----------------------------------------------------------
. Link to Next Group of Doctor Units
.-----------------------------------------------------------
NEXTUN00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMHCP001
          REP       " +",HOSPCODE
          REP       " +",PMTMD003
          REP       " +",PMTMD004
          REP       " +",RETNFLAG
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmhcp001=",PMHCP001:
                                 "&hospcode=",HOSPCODE:
                                 "&pmtmd003=",PMTMD003:
                                 "&pmtmd004=",PMTMD004:
                                 "&retnflag=",RETNFLAG;
          REP       "+ ",PMHCP001
          REP       "+ ",HOSPCODE
          REP       "+ ",PMTMD003
          REP       "+ ",PMTMD004
          REP       "+ ",RETNFLAG
.
NEXTUN99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of Doctor Units
.-------------------------------------------------------------
PREVUN00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMHCP001
          REP       " +",HOSPCODE
          REP       " +",PMTMD003
          REP       " +",PMTMD004
          REP       " +",RETNFLAG
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmhcp001=",PMHCP001:
                                 "&hospcode=",HOSPCODE:
                                 "&pmtmd003=",PMTMD003:
                                 "&pmtmd004=",PMTMD004:
                                 "&retnflag=",RETNFLAG;
          REP       "+ ",PMHCP001
          REP       "+ ",HOSPCODE
          REP       "+ ",PMTMD003
          REP       "+ ",PMTMD004
          REP       "+ ",RETNFLAG
.
PREVUN99  RETURN
+
.------------------------------------------------------------
. Table of Doctor Linked Units
.------------------------------------------------------------
LNKUN000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY21,PMHCP001,HOSPCODE,SP70
          CALL      RSPMTMD1
LNKUN100  CALL      RKPMTMD1
          BRANCH    OVRCD,LNKUN900
.
          MATCH     PMHCP001,PMTDDOCT       * same hcp?
          GOTO      LNKUN900 IF NOT EQUAL
.
          MATCH     HOSPCODE,PMTDHOSP       * same hosp?
          GOTO      LNKUN900 IF NOT EQUAL
.
          MATCH     SP70,PMTDTEAM           * only want unit headers
          IF        @EQUAL
            MOVE    PMTDUNIT,PMTMD003
            CALL    LNKTIC00                * Linked Teams Indicator
          ELSE
            GOTO      LNKUN100
          ENDIF
.
LNKUN500  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LNKUN100
          ENDIF
.
          CALL      LUNRW000      * Linked Units Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      LNKUN100 IF NOT EQUAL
          GOTO      LNKUN999
.
LNKUN900  CALL      NOMORE00      * Display No More Records Message
.
LNKUN999  RETURN
.
.------------------------------------------------------------
. Doctor Linked Units (TABLE ROW)
.------------------------------------------------------------
LUNRW000  MATCH     "1",PMTDACTV
          IF        @EQUAL
            MOVE      "No ",KEY3
          ELSE
            MOVE      "Yes",KEY3
          ENDIF
.
          MATCH     "1",PMTDHEAD
          IF        @EQUAL
            MOVE      "Yes",DIM3            * head of unit
          ELSE
            MOVE      "No ",DIM3
          ENDIF
.
          MOVE      "AC",CATEGORY           * unit category
          MOVE      PMTDUNIT,CODE
          CALL      GETCOD00
.
          PACK      KEY5,SAVTEAM,SP70
          CALL      RDPMTEM1                * get team desc
          IF        OVRCD=1
            MOVE      SP70,PMTMDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail17":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMTDDOCT:
                             "&hospcode=",PMTDHOSP:
                             "&pmtmd003=",PMTDUNIT:
                             "&pmtmd004=",PMTDTEAM:
                             "&retnflag=",RETNFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             TDESC,"</td>":
                             "<td>&nbsp;",PMTDPROV,"</td>":
                             "<td>&nbsp;",KEY3,"</td>":
                             "<td>&nbsp;",DIM3,"</td>":
                             "<td>&nbsp;",PMTMDESC,"</td>";
.
          IF        LNKTEIND = 2
            WRITE     HTMLFILE;"<td><input type=button class=SmallRedButton":
                               " value=",TEAMDESC;
          ELSE
            WRITE     HTMLFILE;"<td><input type=button class=SmallButton":
                               " value=",TEAMDESC;
          ENDIF
          WRITE     HTMLFILE;" onClick='LinkedTeams17(#"",PMTDUNIT,"#")'></td>";
.
          WRITE     HTMLFILE;"</tr>"
.
LUNRW999 RETURN
+
.------------------------------------------------------------
. Table of Unit Linked Teams
.------------------------------------------------------------
LNKTE000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY21,PMHCP001,HOSPCODE,PMTMD003,SP70
          CALL      RSPMTMD1
LNKTE100  CALL      RKPMTMD1
          BRANCH    OVRCD,LNKTE900
.
          MATCH     PMHCP001,PMTDDOCT
          GOTO      LNKTE900 IF NOT EQUAL
.
          MATCH     HOSPCODE,PMTDHOSP
          GOTO      LNKTE900 IF NOT EQUAL
.
          MATCH     PMTMD003,PMTDUNIT
          GOTO      LNKTE900 IF NOT EQUAL
.
LNKTE500  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LNKTE100
          ENDIF
.
          CALL      LTERW000      * Linked Teams Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      LNKTE100 IF NOT EQUAL
          GOTO      LNKTE999
.
LNKTE900  CALL      NOMORE00      * Display No More Records Message
.
LNKTE999  RETURN
.
.------------------------------------------------------------
. Unit Linked Teams (TABLE ROW)
.------------------------------------------------------------
LTERW000  MATCH     "1",PMTDACTV
          IF        @EQUAL
            MOVE      "No ",KEY3
          ELSE
            MOVE      "Yes",KEY3
          ENDIF
.
          PACK      KEY5,PMTDTEAM,SP70
          CALL      RDPMTEM1                * get team desc
          IF        OVRCD=1
            MOVE      SP70,PMTMDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail17":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMTDDOCT:
                             "&hospcode=",PMTDHOSP:
                             "&pmtmd003=",PMTDUNIT:
                             "&pmtmd004=",PMTDTEAM:
                             "&retnflag=",RETNFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMTDTEAM,"</td>":
                             "<td>&nbsp;",PMTMDESC,"</td>":
                             "<td>&nbsp;",KEY3,"</td>";
          WRITE     HTMLFILE;"</tr>"
.
LTERW999 RETURN
+
.------------------------------------------------------------
. Selection list for Units attached to a hospital (pmsdivaf)
.------------------------------------------------------------
HOSUNI00  PACK      KEY14,MLHCHOSP,SP70  * hosp/unit seln list
          CALL      RSPMDIV2
HOSUNI25  CALL      RKPMDIV2
          BRANCH    OVRCD,HOSUNI99
.
          MATCH     MLHCHOSP,PMDIHOSP
          GOTO      HOSUNI25 IF NOT EQUAL   * same hosp?
.
          MATCH     SP70,PMDIUNIT
          GOTO      HOSUNI25 IF EQUAL       * blank unit?
.
          MATCH     SP70,PMDITEAM
          GOTO      HOSUNI25 IF NOT EQUAL   * only display header records
.
          MATCH     "1",PMDIACTV
          GOTO      HOSUNI25 IF EQUAL       * inactive?
.
          PACK      KEY5,ANSA,ANSC,PMDIUNIT,SP70
          CALL      RDCODE1                 * read codes table for desc
          BRANCH    OVRCD,HOSUNI25
.
          PACK      KEY5,QUOTE,PMDIUNIT,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY5,">",TDESC,"</option>"
          GOTO      HOSUNI25
.
HOSUNI99  RETURN
+
.------------------------------------------------------------
. Selection list for Teams attached to a hospital (pmsdivaf)
.------------------------------------------------------------
HOSTEM00  PACK      KEY14,PMTDHOSP,PMTDUNIT,SP70  * hosp/unit/team seln list
          CALL      RSPMDIV2
HOSTEM25  CALL      RKPMDIV2
          BRANCH    OVRCD,HOSTEM99
.
          MATCH     PMTDHOSP,PMDIHOSP
          GOTO      HOSTEM25 IF NOT EQUAL   * same hosp?
.
          MATCH     PMTDUNIT,PMDIUNIT
          GOTO      HOSTEM25 IF NOT EQUAL   * same unit?
.
          MATCH     "1",PMDIACTV
          GOTO      HOSTEM25 IF EQUAL       * team link inactive?
.
          PACK      KEY5,PMDITEAM,SP70
          CALL      RDPMTEM1                * read team table for desc
          BRANCH    OVRCD,HOSTEM25
.
          MATCH     "1",PMTMACTV
          GOTO      HOSTEM25 IF EQUAL       * team inactive?
.
          PACK      KEY7,QUOTE,PMTMTEAM,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY7,">",PMTMDESC,"</option>"
          GOTO      HOSTEM25
.
HOSTEM99  RETURN
+
.----------------------------------------------------------------
. Doctor Roles maintenance report 18
.----------------------------------------------------------------
PMSRLD00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      PMSRLD40 IF EQUAL       * Display
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSRLD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSRLD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PMSRLD30 IF EQUAL
.
          GOTO      PMSRLD98

.          ************ ADD FORMACTION ***********
.
PMSRLD10  PACK      KEY16,PMRLD001,PMRLD002,PMRLD003,SP70
          CALL      RDPMRLD1
          COMPARE   ZERO,OVRCD
          GOTO      PMSRLD91 IF EQUAL       * if record exists error
.
          CALL      CLPMSRLD                * Clear file variables
          CALL      MVPMRL00                * get the cgi parameters
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CURRDATE,PMRDCDAT       * date record created
          MOVE      CTIMEIS,PMRDCTIM        * time record created
          MOVE      USERID,PMRDCUID         * web user created
.
          PACK      KEY16,PMRDDOCT,PMRDHOSP,PMRDROLE,SP70
          CALL      RAPMRLD1
          IF        OVRCD=1
            CALL      WRPMRLD1              * write a record
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PMSRLD99
.
.          ************ UPDATE FORMACTION **********
.
PMSRLD20  PACK      KEY16,PMRLD001,PMRLD002,PMRLD003,SP70
          CALL      RDPMRLD1
          BRANCH    OVRCD,PMSRLD90          * error if record not found
.
          CALL      MVPMRL00                * get the cgi parameters
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CURRDATE,PMRDUDAT       * date record updated
          MOVE      CTIMEIS,PMRDUTIM        * time record updated
          MOVE      USERID,PMRDUUID         * web user updated
.
          CALL      UPPMRLD1                * update the record
.
          MOVE      ZERO,EXIT
          GOTO      PMSRLD99
.
.          ************ DELETE FORMACTION **********
.
PMSRLD30  PACK      KEY16,PMRLD001,PMRLD002,PMRLD003,SP70
          CALL      RDPMRLD1
          BRANCH    OVRCD,PMSRLD90          * error if record not found
.
          PACK      KEY16,PMRDDOCT,PMRDHOSP,PMRDROLE,SP70
          CALL      DEPMRLD1               * delete the record
.
          MOVE      ZERO,EXIT
          GOTO      PMSRLD99
.
.          ************ DISPLAY FORMACTION **********
.
PMSRLD40  PACK      KEY13,HOSPCODE,PMHCP001,SP70
          CALL      RDMLHCP1
          IF        OVRCD=1
            CALL      CLMLTHCP             * Clear file variables
          ENDIF
.
          PACK      KEY16,PMHCP001,HOSPCODE,PMRLD003,SP70
          CALL      RDPMRLD1
          IF        OVRCD=1
            CALL      CLPMSRLD             * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "HCP Hospital/Roles Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSRLD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PMSRLD99
.
.         *********** ERROR CONDITIONS ***************
.
PMSRLD90  MOVE      "Code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSRLD99
.
PMSRLD91  MOVE      "Code already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSRLD99
.
PMSRLD98  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSRLD99
.
PMSRLD99  RETURN
+
.------------------------------------------------------------
. Table of Doctor Linked Roles
.------------------------------------------------------------
LNKRL000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY16,PMHCP001,HOSPCODE,SP70
          CALL      RSPMRLD1
LNKRL100  CALL      RKPMRLD1
          BRANCH    OVRCD,LNKRL900
.
          MATCH     PMHCP001,PMRDDOCT       * same hcp?
          GOTO      LNKRL900 IF NOT EQUAL
.
          MATCH     HOSPCODE,PMRDHOSP       * same hosp?
          GOTO      LNKRL900 IF NOT EQUAL
.
LNKRL500  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LNKRL100
          ENDIF
.
          CALL      LRLRW000      * Linked Roles Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      LNKRL100 IF NOT EQUAL
          GOTO      LNKRL999
.
LNKRL900  CALL      NOMORE00      * Display No More Records Message
.
LNKRL999  RETURN
.
.------------------------------------------------------------
. Doctor Linked Roles (TABLE ROW)
.------------------------------------------------------------
LRLRW000  MATCH     "1",PMRDACTV
          IF        @EQUAL
            MOVE      "No ",KEY3
          ELSE
            MOVE      "Yes",KEY3
          ENDIF
.
          MOVE      "rm",CATEGORY           * role category
          MOVE      PMRDROLE,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail18":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMRDDOCT:
                             "&hospcode=",PMRDHOSP:
                             "&pmrld003=",PMRDROLE:
                             "&retnflag=",RETNFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMRDROLE,"</td>":
                             "<td>&nbsp;",TDESC,"</td>":
                             "<td>&nbsp;",KEY3,"</td>";
          WRITE     HTMLFILE;"</tr>"
.
LRLRW999 RETURN
+
.-----------------------------------------------------------
. Link to Next Group of Doctor Roles
.-----------------------------------------------------------
NEXTRL00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMHCP001
          REP       " +",HOSPCODE
          REP       " +",PMRLD003
          REP       " +",RETNFLAG
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmhcp001=",PMHCP001:
                                 "&hospcode=",HOSPCODE:
                                 "&pmrld003=",PMRLD003:
                                 "&retnflag=",RETNFLAG;
          REP       "+ ",PMHCP001
          REP       "+ ",HOSPCODE
          REP       "+ ",PMRLD003
          REP       "+ ",RETNFLAG
.
NEXTRL99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of Doctor Roles
.-------------------------------------------------------------
PREVRL00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMHCP001
          REP       " +",HOSPCODE
          REP       " +",PMRLD003
          REP       " +",RETNFLAG
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmhcp001=",PMHCP001:
                                 "&hospcode=",HOSPCODE:
                                 "&pmrld003=",PMRLD003:
                                 "&retnflag=",RETNFLAG;
          REP       "+ ",PMHCP001
          REP       "+ ",HOSPCODE
          REP       "+ ",PMRLD003
          REP       "+ ",RETNFLAG
.
PREVRL99  RETURN
+
.----------------------------------------------------------------
. Doctor Arrangements maintenance report 19
.----------------------------------------------------------------
PMSDRA00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           
          GOTO      PMSDRA40 IF EQUAL       * Display 
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSDRA10 IF EQUAL
.         
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSDRA20 IF EQUAL       
.         
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PMSDRA30 IF EQUAL
.
          GOTO      PMSDRA98

.          ************ ADD FORMACTION ***********
.
PMSDRA10  CALL      CHKDRA00                * check arrangement date range
          BRANCH    EXIT,PMSDRA93,PMSDRA94
.
          PACK      KEY13,PMDRA001,PMDRA002,SP70
          CALL      RDPMDRA1
          COMPARE   ZERO,OVRCD
          GOTO      PMSDRA91 IF EQUAL       * if record exists error
.
          CALL      CLPMSDRA                * Clear file variables
          CALL      MVPMDA00                * get the cgi parameters
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CURRDATE,PMDRCDAT       * date record created
          MOVE      CTIMEIS,PMDRCTIM        * time record created
          MOVE      USERID,PMDRCUID         * web user created
.
          PACK      KEY13,PMDRDOCT,PMDRARRA,SP70
          CALL      RAPMDRA1
          IF        OVRCD=1
            CALL      WRPMDRA1              * write a record
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PMSDRA99
.
.          ************ UPDATE FORMACTION **********
.
PMSDRA20  CALL      CHKDRA00                * check arrangement date range
          BRANCH    EXIT,PMSDRA93,PMSDRA94
.
          PACK      KEY13,PMDRA001,PMDRA002,SP70
          CALL      RDPMDRA1
          BRANCH    OVRCD,PMSDRA90          * error if record not found
.
          CALL      MVPMDA00                * get the cgi parameters
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CURRDATE,PMDRUDAT       * date record updated
          MOVE      CTIMEIS,PMDRUTIM        * time record updated
          MOVE      USERID,PMDRUUID         * web user updated
.
          CALL      UPPMDRA1                * update the record
.
          MOVE      ZERO,EXIT
          GOTO      PMSDRA99
.
.          ************ DELETE FORMACTION **********
.
PMSDRA30  PACK      KEY13,PMDRA001,PMDRA002,SP70
          CALL      RDPMDRA1
          BRANCH    OVRCD,PMSDRA90          * error if record not found
.
          PACK      KEY13,PMDRDOCT,PMDRARRA,SP70
          CALL      DEPMDRA1               * delete the record
.
          MOVE      ZERO,EXIT
          GOTO      PMSDRA99
.
.          ************ DISPLAY FORMACTION **********
.
PMSDRA40  PACK      KEY10,PMHCP001,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          BRANCH    OVRCD,PMSDRA92
          MOVE      PMHCHCPC,GENPCODE
.
          PACK      KEY13,PMHCP001,PMDRA002,SP70
          CALL      RDPMDRA1
          IF        OVRCD=1
            CALL      CLPMSDRA             * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "HCP Arrangements Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSDRA99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PMSDRA99
.
.         *********** ERROR CONDITIONS ***************
.
PMSDRA90  MOVE      "Code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSDRA99
.
PMSDRA91  MOVE      "Code already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSDRA99
.
PMSDRA92  MOVE      "Invalid HCP.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSDRA99
.
PMSDRA93  MOVE      "Arrangement already exists for this date range.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSDRA99
.
PMSDRA94  MOVE      "Invalid date range.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSDRA99
.
PMSDRA98  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSDRA99
.
PMSDRA99  RETURN
+
.------------------------------------------------------------
. Table of Doctor Linked Arrangements
.------------------------------------------------------------
LNKAR000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY21,PMHCP001,SP70
          CALL      RSPMDRA2
LNKAR100  CALL      RKPMDRA2
          BRANCH    OVRCD,LNKAR900
.
          MATCH     PMHCP001,PMDRDOCT       * same hcp?
          GOTO      LNKAR900 IF NOT EQUAL
.
LNKAR500  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LNKAR100
          ENDIF
.
          CALL      LARRW000      * Linked Arrangements Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      LNKAR100 IF NOT EQUAL
          GOTO      LNKAR999
.
LNKAR900  CALL      NOMORE00      * Display No More Records Message
.
LNKAR999  RETURN
.
.------------------------------------------------------------
. Doctor Linked Arrangements (TABLE ROW)
.------------------------------------------------------------
LARRW000  MOVE      "da",CATEGORY           * arrangement category
          MOVE      PMDRARRA,CODE
          CALL      GETCOD00
.
          MOVE      SP70,DISPDAT1
          MATCH     SP70,PMDRAFDT
          IF        !@EQUAL
            UNPACK    PMDRAFDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DISPDAT2
          MATCH     SP70,PMDRATDT
          IF        !@EQUAL
            UNPACK    PMDRATDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DISPDAT3
          MATCH     SP70,PMDRUDAT
          IF        !@EQUAL
            UNPACK    PMDRUDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT3,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DISPDAT4
          MATCH     SP70,PMDRCDAT
          IF        !@EQUAL
            UNPACK    PMDRCDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT4,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          PACK      KEY10,PMDRUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMDRUUID,WBSENAM
          ENDIF
          MOVE      WBSENAM,DIM30
.
          PACK      KEY10,PMDRCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMDRCUID,WBSENAM
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail19":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMDRDOCT:
                             "&pmdra002=",PMDRARRA:
                             "&retnflag=",RETNFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMDRARRA,"</td>":
                             "<td>&nbsp;",TDESC,"</td>":
                             "<td>&nbsp;",DISPDAT1,"</td>":
                             "<td>&nbsp;",DISPDAT2,"</td>":
                             "<td>&nbsp;",DISPDAT3,"</td>":
                             "<td>&nbsp;",DIM30,"</td>":
                             "<td>&nbsp;",DISPDAT4,"</td>":
                             "<td>&nbsp;",WBSENAM,"</td>";
          WRITE     HTMLFILE;"</tr>"
.
LARRW999 RETURN
+
.-----------------------------------------------------------
. Link to Next Group of Doctor Arrangements
.-----------------------------------------------------------
NEXTDA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMHCP001
          REP       " +",PMDRA002
          REP       " +",RETNFLAG
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmhcp001=",PMHCP001:
                                 "&pmdra002=",PMDRA002:
                                 "&retnflag=",RETNFLAG;
          REP       "+ ",PMHCP001
          REP       "+ ",PMDRA002
          REP       "+ ",RETNFLAG
.
NEXTDA99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of Doctor Arrangements
.-------------------------------------------------------------
PREVDA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMHCP001
          REP       " +",PMDRA002
          REP       " +",RETNFLAG
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmhcp001=",PMHCP001:
                                 "&pmdra002=",PMDRA002:
                                 "&retnflag=",RETNFLAG;
          REP       "+ ",PMHCP001
          REP       "+ ",PMDRA002
          REP       "+ ",RETNFLAG
.
PREVDA99  RETURN
+
.-------------------------------------------------------------
. check arrangement date range
.-------------------------------------------------------------
CHKDRA00  MATCH     SP70,PMDRA004
          IF        !@EQUAL
            MATCH     PMDRA003,PMDRA004
            GOTO      CHKDRA96 IF LESS
          ENDIF
.
          MATCH     "U",UPDTTYPE
          GOTO      CHKDRA50 IF EQUAL
.
          PACK      KEY21,PMDRA001,PMDRA003,Z70
          CALL      RSPMDRA2
          CALL      RPPMDRA2
          BRANCH    OVRCD,CHKDRA50
.
          MATCH     PMDRA001,PMDRDOCT       * same hcp?
          GOTO      CHKDRA50 IF NOT EQUAL
.
          MATCH     SP70,PMDRATDT
          GOTO      CHKDRA95 IF EQUAL       * blank todate?
.
          MATCH     PMDRA003,PMDRATDT       * fromdate must be > existing todate
          GOTO      CHKDRA95 IF NOT LESS
.
CHKDRA50  MATCH     "U",UPDTTYPE
          IF        @EQUAL
            PACK      KEY21,PMDRA001,PMDRA003,PMDRA002,SP70
            CALL      RDPMDRA2              * position on current record
          ELSE
            PACK      KEY21,PMDRA001,PMDRA003,SP70
            CALL      RSPMDRA2
          ENDIF
          CALL      RKPMDRA2
          BRANCH    OVRCD,CHKDRA90
.
          MATCH     PMDRA001,PMDRDOCT       * same hcp?
          GOTO      CHKDRA90 IF NOT EQUAL
.
          MATCH     SP70,PMDRAFDT
          GOTO      CHKDRA95 IF EQUAL       * blank fromdate?
.
          MATCH     PMDRAFDT,PMDRA004      * to date must be < existing fromdate
          GOTO      CHKDRA95 IF NOT LESS
.
CHKDRA90  MOVE      ZERO,EXIT               * date ok to write
          GOTO      CHKDRA99
.
CHKDRA95  MOVE      ONE,EXIT                * date not ok to write
          GOTO      CHKDRA99
.
CHKDRA96  MOVE      TWO,EXIT                * invalid date range entered
CHKDRA99  RETURN
+
.------------------------------------------------------------
. GTHCCN00
.------------------------------------------------------------
GTHCCN00  WRITE     HTMLFILE;"<td>";
.
          PACK      KEY10,DCODE,SP10
          PACK      KEY16,KEY10,SP20
          CALL      RSPMTCO2
GTHCCN10  CALL      RKPMTCO2
          BRANCH    OVRCD,GTHCCN90
.
          MATCH     KEY10,PMTCCODE
          GOTO      GTHCCN90 IF NOT EQUAL
.
          MATCH     "  1",PMTCLNUM
          GOTO      GTHCCN10 IF NOT EQUAL
.
          PACK      KEY5,CATTZ,PMTCTCOM,SP5 * get Cat.Code record to test Ind.2
          CALL      RDCODE1
          BRANCH    OVRCD,GTHCCN10
.                                           * Ind.2 = D - Pref.Contact details
          MATCH     "D",TCINDC2
          GOTO      GTHCCN10 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<A HREF='javascript:ShowDetail13":
                    "(#"","patweb99","#.pbl":
                    "?reportno=13":
                    "&template=005":
                    "&pmhcp001=",PMTCCODE:
                    "&hcpcomty=",PMTCTCOM,"#")'>":
                    "<img src=../images/CommentIcon.gif hspace=4":
                    " border=0 align=absmiddle></a>":
                    "&nbsp;",TDESC,"<br>";
.
          GOTO      GTHCCN10
.
GTHCCN90  WRITE     HTMLFILE;"</td></tr></table>";
.
GTHCCN99  RETURN
.
.===============================================================================
. Copy common variables from the HCP file to the doctors file
. pmshcpaf -> patdo1af                                                CAR 244064
.===============================================================================
MVPTDO00  MOVE      PMHCLDOC,DCODE               * Doctor Code
          MOVE      PMHCTITL,DTITL               * Doctor Title
          MOVE      PMHCGNAM,DGNAME              * Given Name
          MOVE      PMHCSNAM,DSNAME              * Surname
          MOVE      PMHCSPC1,DRTYPE              * Speciality
          MOVE      PMHCRCPT,DRNAME              * Receptionist name
          MOVE      PMHCADR1,DSADD1              * Address line 1
          MOVE      PMHCADR2,DSADD2              * Address line 2
          MOVE      PMHCADR3,DSADD3              * Address line 3
          MOVE      PMHCADR4,DSADD4              * Address line 4
          MOVE      PMHCPOST,DSPOST              * Post code
          MOVE      PMHCSEML,PTDOSEML            * E-Mail
          MOVE      PMHCSTEL,DTELES              * Surgery Telephone
          MOVE      PMHCPAGR,DTELEP              * Page Telephone
          MOVE      PMHCPAGN,DPAGER              * Pager Number
          MOVE      PMHCAHP1,DASSOC1             * Associated HCP 1
          MOVE      PMHCAHP2,DASSOC2             * Associated HCP 2
          MOVE      PMHCAHP3,DASSOC3             * Associated HCP 3
          MOVE      PMHCAHP4,DASSOC4             * Associated HCP 4
          MOVE      PMHCAHP5,DASSOC5             * Associated HCP 5
          MOVE      PMHCPRV1,DPROV               * Provider number 1
          MOVE      PMHCHTEL,DTELEH              * Home Telephone
          MOVE      PMHCHAD1,DHADD1              * Address line 1
          MOVE      PMHCHAD2,DHADD2              * Address line 2
          MOVE      PMHCHAD3,DHADD3              * Address line 3
          MOVE      PMHCHAD4,DHADD4              * Address line 4
          MOVE      PMHCHPCD,DHPOST              * Post code
          MOVE      PMHCHEML,PTDOHEML            * E-Mail
          MOVE      PMHCDFAC,DAFIRST             * Date first accred
          MOVE      PMHCDLAC,DALAST              * Date last accred
          MOVE      PMHCYACC,DAYEARS             * Accred years
          MOVE      PMHCATYP,DACCRED             * Accred type
          MOVE      PMHCSPC2,DRTYPE2             * Speciality
          MOVE      PMHCSPC3,DRTYPE3             * Speciality
          MOVE      PMHCSPC4,DRTYPE4             * Speciality
          MOVE      PMHCSPC5,DRTYPE5             * Speciality
          MOVE      PMHCDTOB,DBIRTH              * Date of birth
          MOVE      PMHCHHCP,DHCSCOD             * H.C.S HCP Code
          MOVE      PMHCOSLV,DALEVEL             * Service level
.
.         If the HCP is inactive set the doctor to inactive
.
          MATCH     "1",PMHCSTTS                 * HCP Inactive
          IF        @EQUAL
            MOVE      ONE,DRSTAT                 * Doctor Inactive
            GOTO      MVPTDO20
          ENDIF
.
.         If the HCP type contains attending set the doctor status
.         to active in hospital.
.
          IF        PMHCHCST=0 | PMHCHCST=2 | PMHCHCST=4 | PMHCHCST=6
            MOVE      ZERO,DRSTAT                * Active inside hospital
            GOTO      MVPTDO20
          ENDIF
.
          IF        PMHCHCST=8 | PMHCHCST=10 | PMHCHCST=11 | PMHCHCST=13
            MOVE      ZERO,DRSTAT                * Active inside hospital
            GOTO      MVPTDO20
          ENDIF
.
.         HCP type doesn't contain attending so set the doctor
.         status to active outside hospital
.
          MOVE      TWO,DRSTAT                   * Active outside hosital
.
MVPTDO20  MOVE      PMHCFAXN,PTDOFAXN            * Fax number
          MOVE      PMHCHFXN,PTDOHFAX            * Home Fax
          MOVE      PMHCMOBN,PTDOMOBL            * Mobile
          MOVE      PMHCCRDC,PTDOGLCC            * Creditor code
          MOVE      PMHCWAHC,PTDOWHDP            * WA HDP HCP code
          MOVE      PMHCMRBN,PTDOMREG            * Med Reg Board No
          MOVE      PMHCNHSN,PTDONHSN            * N.H.S Pros Number
          MOVE      PMHCUDF1,PTDOUDF1            * User Def Field 1
          MOVE      PMHCUDF2,PTDOUDF2            * User Def Field 2
          MOVE      PMHCUDF3,PTDOUDF3            * User Def Field 3
          MOVE      PMHCUDF4,PTDOUDF4            * User Def Field 4
          MOVE      PMHCUDF5,PTDOUDF5            * User Def Field 5
          MOVE      PMHCINSC,PTDOINSC            * Insurance code
          MOVE      PMHCIPLN,PTDOINSN            * Insurance number
          MOVE      PMHCIDTF,PTDOINSF            * Insurance date from
          MOVE      PMHCIDTT,PTDOINST            * Insurance date to
          MOVE      PMHCMPGN,PTDOREGN            * MPG Cert No
          MOVE      PMHCRGDF,PTDOREGF            * Reg Date From
          MOVE      PMHCRGDT,PTDOREGT            * Reg Date To
          MOVE      PMHCVISD,PTDOVISA            * Visa date
          MOVE      PMHCPRFC,PTDOCOMT            * Pref Comm
          MOVE      PMHCPRFN,PTDOPREF            * Pref Name
          MOVE      PMHCABNN,PTDOABNN            * ABN Number
          MOVE      PMHCDLMI,PTDODINA            * Date Made Inactive
          MOVE      PMHCDLMA,PTDODACT            * Date Made Active
          MOVE      SP70,PTDODACO                * Date Made Active Outside
          MOVE      PMHCPRV2,PTDOPRO2            * Provider number 2
          MOVE      PMHCPRV3,PTDOPRO3            * Provider number 3
          MOVE      PMHCPRV4,PTDOPRO4            * Provider number 4
          MOVE      PMHCPRV5,PTDOPRO5            * Provider number 5
          MOVE      PMHCSDAT,PTDOSDAT            * Start Date (ccyymmdd)
          MOVE      PMHCEDAT,PTDOEDAT            * End Date (ccyymmdd)
          MOVE      PMHCUPDF,PTDOAUPD            * Auto Update Yes=1 0=No
          REP       "M0A1",PTDOAUPD
.
          MOVE      PMHCHOSS,PTDOHOSS            * Hospital Specific Doctor
          MOVE      PMHCEXML,PTDOEXML            * Exclude from Mailing List
          MOVE      PMHCDEAC,PTDODEAC            * Accred. Expiry Date
          MOVE      PMHCAHC1,PTDOAHC1            * AH Contact Method 1
          MOVE      PMHCAHC2,PTDOAHC2            * AH Contact Method 2
          MOVE      PMHCAHC3,PTDOAHC3            * AH Contact Method 3
.
          MATCH     "A",UPDTTYPE                 * Add formaction
          GOTO      MVPTDO50 IF EQUAL
.
          MOVE      PMHCCDTE,DLUPDDTE            * Date created
          MOVE      PMHCCTIM,DLUPDTME            * Time created
          GOTO      MVPTDO99
.
MVPTDO50  MOVE      PMHCLUPD,DLUPDDTE            * Date created
          MOVE      PMHCLUPT,DLUPDTME            * Time created
          GOTO      MVPTDO99
.
MVPTDO99  RETURN
.
.------------------------------------------------------------
. Sort Table of Doctors Doctors with Leave Dates
.------------------------------------------------------------
DLVTS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          RESET     LINKYEAR
          MATCH     SP70,LINKYEAR
          IF        @EQUAL
            CALL      IBACLOCK
            PACK      LINKYEAR,CCC,CYY   * Set to current year
            REP       " 0",LINKYEAR
          ENDIF
.
          PACK      KEY14,SP70
          CALL      RSOPDLV1
DLVTS100  CALL      RKOPDLV1
          BRANCH    OVRCD,DLVTS999
.
          UNPACK    OPDVFDTE,KEY4,KEY5
          MATCH     LINKYEAR,KEY4
          GOTO      DLVTS100 IF NOT EQUAL
.
          CALL      DSROW000      * Display Doctors on leave row
          GOTO      DLVTS100
.
DLVTS999  RETURN
.
.------------------------------------------------------------
. Doctors on Leave (SORT TABLE ROW)
.------------------------------------------------------------
DSROW000  PACK      KEY6,OPDVDOCT,SP70
          CALL      RDDOCT1
          IF        OVRCD=1
            MOVE      OPDVDOCT,DOCTOR
          ENDIF
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          CLEAR     DOCTOR
          APPEND    DOCFNAME,DOCTOR
.
          MOVE      "DH",CATEGORY
          MOVE      OPDVREAS,CODE
          CALL      GETCOD00
.
.         WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail09":
.                            "(#"",LINKPRG,"#.pbl":
.                            "?reportno=",LINKREP:
.                            "&template=",LINKTEM:
.                            "&opdlv001=",OPDVDOCT:
.                            "&opdlv002=",OPDVFDTE,"#")'>":
.                            "<img src=../images/MaintenanceIcon.gif hspace=4":
.                            " border=0 align=absmiddle></a>":
.                            DOCTOR,"</td>":
.                            "<td>",DATE,"</td><td>",KEY11,"</td>":
.                            "<td>",TDESC,"</td>":
.                            "</tr>"
.

          CLEAR     HTMLLINK
          APPEND    "javascript:ShowDetail09('",HTMLLINK
          APPEND    LINKPRG,HTMLLINK
          APPEND    "#.pbl",HTMLLINK
          APPEND    "?reportno=",HTMLLINK
          APPEND    LINKREP,HTMLLINK
          APPEND    "&template=",HTMLLINK
          APPEND    LINKTEM,HTMLLINK 
          APPEND    "&opdlv001=",HTMLLINK
          APPEND    OPDVDOCT,HTMLLINK
          APPEND    "&opdlv002=",HTMLLINK
          APPEND    OPDVFDTE,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",DOCTOR,"#",":
                             "#"",OPDVFDTE,"#",":
                             "#"",OPDVTDTE,"#",":
                             "#"",TDESC,"#");"
.
DSROW999 RETURN
.----------------------------------------------------------------
. HCP Specialty Maintenance Report 20
.----------------------------------------------------------------
PMSSPE00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      PMSSPE40 IF EQUAL       * Display
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSSPE10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSSPE20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PMSSPE30 IF EQUAL
.
          GOTO      PMSSPE98

.          ************ ADD FORMACTION ***********
.
PMSSPE10  CALL      CHKSPE00                * check arrangement date range
          BRANCH    EXIT,PMSSPE93,PMSSPE94
.
          PACK      KEY21,PMSPE001,PMSPE002,PMSPE003,SP70
          CALL      RDPMSPE1
          COMPARE   ZERO,OVRCD
          GOTO      PMSSPE91 IF EQUAL       * if record exists error
.
          CALL      CLPMSSPE                * Clear file variables
          CALL      MVPMSE00                * get the cgi parameters
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CURRDATE,PMSECDAT       * date record created
          MOVE      CTIMEIS,PMSECTIM        * time record created
          MOVE      USERID,PMSECUID         * web user created
.
          PACK      KEY21,PMSEHCPC,PMSESPEC,PMSESDAT,SP70
          CALL      RAPMSPE1
          IF        OVRCD=1
            CALL      WRPMSPE1              * write a record
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PMSSPE99
.
.          ************ UPDATE FORMACTION **********
.
PMSSPE20  CALL      CHKSPE00                * check arrangement date range
          BRANCH    EXIT,PMSSPE93,PMSSPE94
.
          PACK      KEY21,PMSPE001,PMSPE002,PMSPE003,SP70
          CALL      RDPMSPE1
          BRANCH    OVRCD,PMSSPE90          * error if record not found
.
          CALL      MVPMSE00                * get the cgi parameters
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CURRDATE,PMSEUDAT       * date record updated
          MOVE      CTIMEIS,PMSEUTIM        * time record updated
          MOVE      USERID,PMSEUUID         * web user updated
.
          CALL      UPPMSPE1                * update the record
.
          MOVE      ZERO,EXIT
          GOTO      PMSSPE99
.
.          ************ DELETE FORMACTION **********
.
PMSSPE30  PACK      KEY21,PMSPE001,PMSPE002,PMSPE003,SP70
          CALL      RDPMSPE1
          BRANCH    OVRCD,PMSSPE90          * error if record not found
.
          PACK      KEY21,PMSEHCPC,PMSESPEC,PMSESDAT,SP70
          CALL      DEPMSPE1               * delete the record
.
          MOVE      ZERO,EXIT
          GOTO      PMSSPE99
.
.          ************ DISPLAY FORMACTION **********
.
PMSSPE40  PACK      KEY10,PMHCP001,SP70   * Read a valid HCP Record
          CALL      RDPMHCP1
          BRANCH    OVRCD,PMSSPE92
          MOVE      PMHCHCPC,GENPCODE
.
          PACK      KEY21,PMHCP001,PMSPE002,PMSPE003,SP70
          CALL      RDPMSPE1
          IF        OVRCD=1
            CALL      CLPMSSPE             * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "HCP Specialty Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSSPE99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PMSSPE99
.
.         *********** ERROR CONDITIONS ***************
.
PMSSPE90  MOVE      "Code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSPE99
.
PMSSPE91  MOVE      "Code already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSPE99
.
PMSSPE92  MOVE      "Invalid HCP.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSPE99
.
PMSSPE93  MOVE      "HCP/Specialty already exists for this date range.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSPE99
.
PMSSPE94  MOVE      "Invalid date range.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSPE99
.
PMSSPE98  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSPE99
.
PMSSPE99  RETURN
+
.-------------------------------------------------------------
. Check HCP/Specialty Date Range
.-------------------------------------------------------------
CHKSPE00  MATCH     SP70,PMSPE004
          IF        !@EQUAL
            MATCH     PMSPE003,PMSPE004
            GOTO      CHKSPE96 IF LESS
          ENDIF
.
.          PACK      SVKEY21A,PMSPE001,PMSPE002,PMSPE003,SP70
.          PACK      SVKEY21B,SP70
.
.          PACK      KEY21,PMSPE001,SP70
.          CALL      RSPMSPE1
.CHKSPE10  CALL      RKPMSPE1
.          BRANCH    OVRCD,CHKSPE90
.
.          MATCH     PMSPE001,PMSEHCPC       * same hcp?
.          GOTO      CHKSPE90 IF NOT EQUAL
.
.          PACK      SVKEY21B,PMSEHCPC,PMSESPEC,PMSESDAT,SP70
.          MATCH     SVKEY21A,SVKEY21B
.          GOTO      CHKSPE10 IF EQUAL
.
.          MATCH     PMSESDAT,PMSPE003
.          IF        !@LESS
.            MATCH     SP70,PMSEEDAT
.            GOTO      CHKSPE95 IF EQUAL
.
.            MATCH     PMSPE003,PMSEEDAT
.            GOTO      CHKSPE95 IF NOT LESS 
.
.            GOTO      CHKSPE10
.          ENDIF
.
.          MATCH     SP70,PMSPE004
.          GOTO      CHKSPE95 IF EQUAL
.
.          MATCH     PMSESDAT,PMSPE004
.          GOTO      CHKSPE95 IF NOT LESS
.
.          GOTO      CHKSPE10
.
CHKSPE90  MOVE      ZERO,EXIT               * date ok to write
          GOTO      CHKSPE99
.
.CHKSPE95  MOVE      ONE,EXIT                * date not ok to write
.          GOTO      CHKSPE99
.
CHKSPE96  MOVE      TWO,EXIT                * invalid date range entered
CHKSPE99  RETURN
+
.------------------------------------------------------------
. Table of HCP Specialties
.------------------------------------------------------------
HCPSP000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY21,PMHCP001,SP70
          CALL      RSPMSPE1
HCPSP100  CALL      RKPMSPE1
          BRANCH    OVRCD,HCPSP999
.
          MATCH     PMHCP001,PMSEHCPC       * same hcp?
          GOTO      HCPSP999 IF NOT EQUAL
.
HCPSP500  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      HCPSP100
          ENDIF
.
          CALL      SPERW000      * Linked Arrangements Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      HCPSP100 IF NOT EQUAL
.
HCPSP999  RETURN
.------------------------------------------------------------
. HCP Specialties (TABLE ROW)
.------------------------------------------------------------
SPERW000  MOVE      "A ",CATEGORY           * arrangement category
          MOVE      PMSESPEC,CODE
          CALL      GETCOD00
.
          MOVE      SP70,DISPDAT1
          MATCH     SP70,PMSESDAT
          IF        !@EQUAL
            UNPACK    PMSESDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DISPDAT2
          MATCH     SP70,PMSEEDAT
          IF        !@EQUAL
            UNPACK    PMSEEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DISPDAT3
          MATCH     SP70,PMSEUDAT
          IF        !@EQUAL
            UNPACK    PMSEUDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT3,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DISPDAT4
          MATCH     SP70,PMSECDAT
          IF        !@EQUAL
            UNPACK    PMSECDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT4,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          PACK      KEY10,PMSEUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMSEUUID,WBSENAM
          ENDIF
          MOVE      WBSENAM,DIM30
.
          PACK      KEY10,PMSECUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMSECUID,WBSENAM
          ENDIF
.
          MOVE      PMSESPEC,DIM3
          MOVE      DISPDAT1,DIM11
          REP       " +",PMSEHCPC
          REP       " +",PMSESPEC
          REP       " +",PMSESDAT
          REP       " +",RETNFLAG
          REP       " +",DIM11
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail20":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMSEHCPC:
                             "&pmspe002=",PMSESPEC:
                             "&pmspe003=",DIM11:
                             "&retnflag=",RETNFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             DIM3,"</td>":
                             "<td>&nbsp;",TDESC,"</td>":
                             "<td>&nbsp;",DISPDAT1,"</td>":
                             "<td>&nbsp;",DISPDAT2,"</td>":
                             "<td>&nbsp;",DISPDAT3,"</td>":
                             "<td>&nbsp;",DIM30,"</td>":
                             "<td>&nbsp;",DISPDAT4,"</td>":
                             "<td>&nbsp;",WBSENAM,"</td>";
          WRITE     HTMLFILE;"</tr>"
.
          REP       "+ ",PMSEHCPC
          REP       "+ ",PMSESPEC
          REP       "+ ",PMSESDAT
          REP       "+ ",RETNFLAG
.
SPERW999 RETURN
+
.-----------------------------------------------------------
. Link to Next Group of HCP Specialties
.-----------------------------------------------------------
NEXTSP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMHCP001
          REP       " +",PMSPE002
          REP       " +",RETNFLAG
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmhcp001=",PMHCP001:
                                 "&retnflag=",RETNFLAG;
          REP       "+ ",PMHCP001
          REP       "+ ",PMSPE002
          REP       "+ ",RETNFLAG
.
NEXTSP99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group of HCP Specialties
.-------------------------------------------------------------
PREVSP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMHCP001
          REP       " +",PMSPE002
          REP       " +",RETNFLAG
.
          WRITE     HTMLFILE;"patweb99.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmhcp001=",PMHCP001:
                                 "&retnflag=",RETNFLAG;
          REP       "+ ",PMHCP001
          REP       "+ ",PMSPE002
          REP       "+ ",RETNFLAG
.
PREVSP99  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
+
.------------------------------------------------------------------------------
.         HCP Search Table (based on PATDKA00 output but for Enquiry View)
.------------------------------------------------------------------------------
HCPSCH00  WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=5>":
                               "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                               "<td class=HeadingCell>HCP Name</td>":
                               "<td class=HeadingCell>Specialties</td>":
                               "<td class=HeadingCell>Surgery Address</td>":
                               "<td class=HeadingCell>Contact Numbers</td>":
                               "<td class=HeadingCell>Status</td>":
                             "</tr>"
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          UNPACK    DIM127,D1,LINKPUB,DIM127
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,HCPAREND         * Number of HCPs in HCPARRAY[]
.
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
.
          STRIP     KEYWRD01
          PACK      KEY15,KEYWRD01,SP70
          MATCH     SP70,KEY15
          GOTO      HCPSCH99 IF EQUAL
.
          PACK      KEY25,KEYWRD01,SP70
          CALL      RSPMHKI2
HCPSCH10  CALL      RKPMHKI2
          BRANCH    OVRCD,HCPSCH99
.
          PACK      KEY10,PMHKHCPC,SP70
          CALL      RDPMHCP1                * read HCP table
          BRANCH    OVRCD,HCPSCH10
.
          CALL      PMSHKB00
          BRANCH    EXIT,HCPSCH10,HCPSCH99
.
          MOVE      ACTIVINH,STATUS
          MOVE      PMHCSTTS,F1
          LOAD      STATUS,F1,NOTACTIV,ACTIVOUT
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      HCPSCH10
          ENDIF
.
          MOVE      "DT",CATEGORY
          MOVE      PMHCSPC1,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC01
.
          MOVE      PMHCSPC2,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC02
.
          MOVE      PMHCSPC3,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC03
.
          MOVE      PMHCSPC4,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC04
.
          MOVE      PMHCSPC5,CODE
          CALL      GETCOD00
          MOVE      TDESC,DESC05
.
          MOVE      HCPSSTAT,KEY1
          REP       " +",KEY1
.
          MOVE      PMHCHCPC,KEY10
          REP       " +",KEY10
.
          MOVE      SP70,DISPDAT1
          MATCH     SP70,PMHCSDAT
          IF        !@EQUAL
            UNPACK    PMHCSDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DISPDAT2
          MATCH     SP70,PMHCEDAT
          IF        !@EQUAL
            UNPACK    PMHCEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      PTCNHCPI,HCPFORM
.
          WRITE     HTMLFILE;"<tr valign=#"top#">":
           "<td nowrap width=25%><table border=0 width=100%><tr><td><a href=#"":
                             "javascript:ShowDetail06('":
                              LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&pmhcp001=",KEY10:
                              "&linkdoct=",PMHCLDOC:
                              "&menuflag=",MENUFLAG:
                              "');#">":
                              PMHCSNAM,",",PMHCTITL,SP1,PMHCGNAM:
                              "<br>(",PMHCHCPC,")":
                              "<br>",PMHCPRV1,"</a>";
.
.          MATCH     "1",PTCNUNET
.          IF        @EQUAL
.            UNPACK    PMHCNHTA,DIM4,DIM4A,DIM4B,DIM4C           * HPI-O
.            WRITE     HTMLFILE;"<br>",DIM4,SP1,DIM4A,SP1,DIM4B,SP1,DIM4C;
.          ENDIF
.
          IF        HCPFORM=1 | HCPFORM=4 | HCPFORM=5
            CALL      GHCPTYPE
            WRITE     HTMLFILE;"<br><b>Type: </b>",HCPTDESC;     * HCP Type
          ENDIF
.
          IF        HCPFORM=3 | HCPFORM=5 | HCPFORM=6
            CALL      GHCPROLE
            WRITE     HTMLFILE;"<br><b>Role: </b>",HCPROLE;      * HCP Role
          ENDIF
.
          WRITE     HTMLFILE;"</td>";
.
          PACK      PMHCP001,PMHCHCPC
          CALL      GHCPCM00           * Get HCP comments
.
          WRITE     HTMLFILE;"<td>",DESC01,"<br>",DESC02,"<br>",DESC03:
                             "<br>",DESC04,"<br>",DESC05,"</td>":
                             "<td>",PMHCADR1,"<br>",PMHCADR2,"<br>",PMHCADR3:
                             "<br>",PMHCADR4,"<br>",PMHCSTAT," ",PMHCPOST,"</td>":
                             "<td>Surgery: ",PMHCSTEL,"<br>";
.
          MATCH     "1",LINKPUB
          IF        !@EQUAL
            WRITE     HTMLFILE;"Pager  : ",PMHCPAGR," - ",PMHCPAGN,"<br>":
                               "Mobile : ",PMHCMOBN,"<br>";
          ENDIF
.
          WRITE     HTMLFILE;"Fax    : ",PMHCFAXN,"</td>":
                             "<td>",STATUS:
                             "<br>Start Date : ",DISPDAT1:
                             "<br>End Date   : ",DISPDAT2:
                             "<br>Preferred Name: ",PMHCPRFN;
.
          IF        IBCNMHOS=1 & MAINTFLG=1
            MATCH     "1",PMHCHOSS
            IF        @EQUAL
              WRITE     HTMLFILE;"<br>Hospital Specific : Yes";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</td></tr>"
.
HCPSCH80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      HCPSCH10 IF NOT EQUAL
HCPSCH90
HCPSCH99  RETURN
+
.------------------------------------------------------------
. Establish if HCP Comment Types exist (Cat.TZ)
.------------------------------------------------------------
HCOMTY00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,FORM1
          MATCH     SP1,KEY1                * get Cat.TZ Ind.2 value(group type)
          GOTO      HCOMTY90 IF EQUAL
.
          PACK      KEY10,PMHCP001,SP10
          PACK      KEY16,KEY10,SP20
          CALL      RSPMTCO2
HCOMTY10  CALL      RKPMTCO2
          BRANCH    OVRCD,HCOMTY90
.
          MATCH     KEY10,PMTCCODE
          GOTO      HCOMTY90 IF NOT EQUAL
          PACK      KEY5,CATTZ,PMTCTCOM,SP5 * get Cat.Code record to test Ind.2
          CALL      RDCODE1
          BRANCH    OVRCD,HCOMTY10
.
.                                           * Ind.2 = A - Ad-hoc comment
.                                           *         D - Pref.Contact details
          MATCH     TCINDC2,KEY1
          GOTO      HCOMTY10 IF NOT EQUAL
.
          MOVE      ONE,FORM1
.
HCOMTY90  WRITE     HTMLFILE;FORM1;
.
HCOMTY99  RETURN
+
.------------------------------------------------------------
. List HCP Comments with Cat.TZ Ind.2 = "D"
.------------------------------------------------------------
HCOMTZ00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.         
          PACK      KEY10,PMHCP001,SP10
          PACK      KEY16,KEY10,SP20
          CALL      RSPMTCO2
HCOMTZ10  CALL      RKPMTCO2
          BRANCH    OVRCD,HCOMTZ99
.
          MATCH     KEY10,PMTCCODE
          GOTO      HCOMTZ99 IF NOT EQUAL
.
          MATCH     "  1",PMTCLNUM
          GOTO      HCOMTZ10 IF NOT EQUAL
.
          PACK      KEY5,CATTZ,PMTCTCOM,SP5 * get Cat.Code record to test Ind.2
          CALL      RDCODE1
          BRANCH    OVRCD,HCOMTZ10
.
.                                           * Ind.2 = D - Pref.Contact details
          MATCH     "D",TCINDC2
          GOTO      HCOMTZ10 IF NOT EQUAL
.
          REP       " +",PMTCCODE
          REP       " +",PMTCTCOM
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail13":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMTCCODE:
                             "&hcpcomty=",PMTCTCOM,"#")'>":
                             "<img src=../images/CommentIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             "&nbsp;",TDESC,"</td>"
.
          GOTO      HCOMTZ10
.
HCOMTZ99  RETURN
+
.------------------------------------------------------------
. List HCP Ad-hoc Comment with Cat.TZ Ind.2 = "A"
.------------------------------------------------------------
HCOMAH00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          PACK      KEY10,PMHCP001,SP10
          PACK      KEY16,KEY10,SP20
          CALL      RSPMTCO2
HCOMAH10  CALL      RKPMTCO2
          BRANCH    OVRCD,HCOMAH99
.
          MATCH     KEY10,PMTCCODE
          GOTO      HCOMAH99 IF NOT EQUAL
          PACK      KEY5,CATTZ,PMTCTCOM,SP5 * get Cat.Code record to test Ind.2
          CALL      RDCODE1
          BRANCH    OVRCD,HCOMAH10
.
.                                           * Ind.2 = A - Ad-Hoc Comment (first)
          MATCH     "A",TCINDC2
          GOTO      HCOMAH10 IF NOT EQUAL
.
          REP       " +",PMTCCODE
          REP       " +",PMTCTCOM
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail13":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",PMTCCODE:
                             "&hcpcomty=",PMTCTCOM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             "&nbsp;",TDESC,"&nbsp; &nbsp; &nbsp;":
                             "&nbsp;",PMTCCOMM,"</td></tr>"
.
.
HCOMAH99  RETURN
+
.------------------------------------------------------------
. Set HCP Comment Add button to "Ad-hoc Comment"
.------------------------------------------------------------
HCOMAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.         
          PACK      KEY10,PMHCP001,SP10
          REP       " +",KEY10
.
          PACK      KEY5,CATTZ,SP5          * Read Cat."TZ" to find first Ind.2
          CALL      RDSCODE1                * with code of "A"
HCOMAB10  CALL      RDKCODE1
          BRANCH    OVRCD,HCOMAB99
.                                           * Ind.2 = A - Ad-Hoc Comment (first)
          MATCH     CATTZ,TCODE
          GOTO      HCOMAB99 IF NOT EQUAL
.
          MATCH     "A",TCINDC2
          GOTO      HCOMAB10 IF NOT EQUAL
          REP       " +",ACODE
.
          WRITE     HTMLFILE;"ShowDetail13":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhcp001=",KEY10:
                             "&hcpcomty=",ACODE,"#");"
.
HCOMAB99  RETURN
+
.------------------------------------------------------------
. Get HCP Comments list button
.------------------------------------------------------------
GHCPCM00  WRITE     HTMLFILE;"<td>";
.
          PACK      KEY10,PMHCP001,SP10
          PACK      KEY16,KEY10,SP20
          CALL      RSPMTCO2
GHCPCM10  CALL      RKPMTCO2
          BRANCH    OVRCD,GHCPCM90
.
          MATCH     KEY10,PMTCCODE
          GOTO      GHCPCM90 IF NOT EQUAL
.
          MATCH     "  1",PMTCLNUM
          GOTO      GHCPCM10 IF NOT EQUAL
.
          PACK      KEY5,CATTZ,PMTCTCOM,SP5 * get Cat.Code record to test Ind.2
          CALL      RDCODE1
          BRANCH    OVRCD,GHCPCM10
.                                           * Ind.2 = D - Pref.Contact details
          MATCH     "D",TCINDC2
          GOTO      GHCPCM10 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<A HREF='javascript:ShowDetail13":
                    "(#"","patweb99","#.pbl":
                    "?reportno=13":
                    "&template=005":
                    "&pmhcp001=",PMTCCODE:
                    "&hcpcomty=",PMTCTCOM,"#")'>":
                    "<img src=../images/CommentIcon.gif hspace=4":
                    " border=0 align=absmiddle></a>":
                    "&nbsp;",TDESC,"<br>";
.
          GOTO      GHCPCM10
.
GHCPCM90  WRITE     HTMLFILE;"</td></tr></table>";
.
GHCPCM99  RETURN
+
.----------------------------------------------------------------
. Fund Payee Id Maintenance Report 21
.----------------------------------------------------------------
PMSFPH00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      PMSFPH40 IF EQUAL       * Display
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSFPH10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSFPH20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PMSFPH30 IF EQUAL
.
          GOTO      PMSFPH98

.          ************ ADD FORMACTION ***********
.
PMSFPH10  PACK      KEY16,PMFPH001,PMFPH002,SP70
          CALL      RDPMFPH1
          COMPARE   ZERO,OVRCD
          GOTO      PMSFPH91 IF EQUAL       * if record exists error
.
          CALL      CLPMSFPH                * Clear file variables
          CALL      MVPMSFPH                * get the cgi parameters
.
          PACK      KEY16,PMFPHCPC,PMFPHFND,SP70
          CALL      RAPMFPH1
          IF        OVRCD=1
            CALL      WRPMFPH1              * write a record
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PMSFPH99
.
.          ************ UPDATE FORMACTION **********
.
PMSFPH20  PACK      KEY16,PMFPH001,PMFPH002,SP70
          CALL      RDPMFPH1
          BRANCH    OVRCD,PMSFPH90          * error if record not found
.
          CALL      MVPMSFPH                * get the cgi parameters
.
          CALL      UPPMFPH1                * update the record
.
          MOVE      ZERO,EXIT
          GOTO      PMSFPH99
.
.          ************ DELETE FORMACTION **********
.
PMSFPH30  PACK      KEY16,PMFPH001,PMFPH002,SP70
          CALL      RDPMFPH1
          BRANCH    OVRCD,PMSFPH90          * error if record not found
.
          PACK      KEY16,PMFPHCPC,PMFPHFND,SP70
          CALL      DEPMFPH1                * delete the record
.
          MOVE      ZERO,EXIT
          GOTO      PMSFPH99
.
.          ************ DISPLAY FORMACTION **********
.
PMSFPH40  PACK      KEY10,PMFPH001,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,PMSFPH92     * HCP Code does not exist
.
          PACK      KEY16,PMFPH001,PMFPH002,SP70
          CALL      RDPMFPH1
          IF        OVRCD=1
            CALL      CLPMSFPH             * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Fund Payee Id Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSFPH99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PMSFPH99
.
.         *********** ERROR CONDITIONS ***************
.
PMSFPH90  MOVE      "Code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSFPH99
.
PMSFPH91  MOVE      "Code already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSFPH99
.
PMSFPH92  MOVE      "HCP Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSFPH99
.
PMSFPH98  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSFPH99
.
PMSFPH99  RETURN
.
.----------------------------------------------------------------------------
. For WA health Only. Insert HCP Practice
. This will insert a row into pmshcpaf and pmshclaf tables. it also creates
. keyword pmshkiaf rows.
.----------------------------------------------------------------------------
ADHCP000  CALL      IBACLOCK
          CALL      CLPMSHCP
          PACK      PMHCHCPC,ANSP,PMHGPRAC,SP70
          MOVE      "0",D1
.
          MOVE      PMHCHCPC,KEY10
          CALL      RDPMHCP1
          IF        OVRCD = 0
            GOTO      ADHCP400
          ENDIF
.
          MOVE      "Dr",PMHCTITL
          MOVE      "Practitioner",PMHCSNAM
          MOVE      "Attending",PMHCGNAM
          MOVE      12,PMHCHCST
          MOVE      "0",PMHCSTTS
          MOVE      PMHGFMDT,PMHCSDAT
          MOVE      USERID,PMHCWEBC
          PACK      PMHCCDTE,CCC,CYY,CMM,CDD
          REP       " 0",PMHCCDTE
          CLOCK     TIME,PMHCCTIM
          CALL      WRPMHCP1
.
          PROC      PMSHKIUP         * Updates keyword index
.
. Create HL7 message trigger for Add HCP
.
          MOVE      "A",PMHCACTN    * action flag for DGCLIM02
          MOVE      TEN7,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIM02        * send HL7 message "Doctor Details"
          MOVE      "1",D1
.
ADHCP400  CALL      CLPMSHCL
          MOVE      PMHCHCPC,PMHLHCPC
          MOVE      PMHGPRAC,PMHLHCPR
.
          PACK      KEY20,PMHLHCPC,PMHLHCPR,SP70
          CALL      RDPMHCL1
          IF        OVRCD = 0
            GOTO      ADHCP999
          ENDIF
. 
          MOVE      PMHGFMDT,PMHLJPDT
          MOVE      "0",PMHLSTAT
          MOVE      USERID,PMHLWEBC
          PACK      PMHLCDTE,CCC,CYY,CMM,CDD
          REP       " 0",PMHLCDTE
          CLOCK     TIME,PMHLCTIM
          CALL      WRPMHCL1
.
. Create HL7 message trigger for ADD HCP/practicde link
.
          MATCH     "1",D1
          GOTO      ADHCP999 IF EQUAL       * add message already triggered
.
          MOVE      "U",PMHCACTN    * action flag for DGCLIM02
          MOVE      TEN8,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIM02        * send HL7 message "Doctor Details"
.
ADHCP999  RETURN
.
.----------------------------------------------------------------------------
. For WA health Only. Update HCP Practice
. It checks if the link record exists in pmshclaf, if it does not exist,
. call ADHCP000 to insert record into pmshcpaf and pmshclaf tables. it also
. creates keyword pmshkiaf rows.
. It checks for "111111" link record, if exists, update the status to
. inactive
.----------------------------------------------------------------------------
UDHCP000  CALL      CLPMSHCL
          PACK      PMHLHCPC,ANSP,PMHGPRAC,SP70
          MOVE      PMHGPRAC,PMHLHCPR
.
          PACK      KEY20,PMHLHCPC,PMHGPRAC,SP70
          CALL      RDPMHCL1
          IF        OVRCD = 0
            PACK      KEY10,ANSP,PMHGPRAC,SP70
            CALL      RDPMHCP1
            BRANCH    OVRCD,UDHCP999
.
            MOVE      "U",PMHCACTN    * action flag for DGCLIM02
            MOVE      TEN9,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLIM02        * send HL7 message "Doctor Details"
            GOTO      UDHCP999
          ENDIF
.
          CALL      ADHCP000
.
. Check "111111" link record
.
UDHCP500  MOVE      "111111",PMHLHCPC
          PACK      PMHLHCPC,PMHLHCPC,SP70
          PACK      KEY20,PMHLHCPC,PMHGPRAC,SP70
          CALL      RDPMHCL1
          IF        OVRCD = 1
            GOTO      UDHCP999
          ENDIF
.
          CALL      IBACLOCK
          MOVE      "1",PMHLSTAT
          MOVE      USERID,PMHLWEBU
          PACK      PMHLLUPD,CCC,CYY,CMM,CDD
          REP       " 0",PMHLLUPD
          CLOCK     TIME,PMHLLUPT
.
          CALL      UPPMHCL1 
.
UDHCP999  RETURN
+
.------------------------------------------------------------
          INC       PATCOMN3
.
          INC       APSMASIO/INC
          INC       MLTHCPIO/INC
          INC       MLTSECIO/INC
          INC       PMSDUNIO/INC
          INC       PATDRGIO/INC
          INC       PATAD1IO/INC    * Audit IO 
          INC       PATDSTIO/INC
          INC       PATDO1IO/INC
          INC       PATFN1IO/INC
          INC       PATHDOIO/INC
          INC       PATDKIIO/INC
          INC       PATIN1IO/INC
          INC       PATPA1IO/INC
          INC       PATPERIO/INC
          INC       PATWR1IO/INC
          INC       PMSFPHIO/INC
          INC       PMSHCGIO/INC 
          INC       PMSHCLIO/INC
          INC       PMSHCPIO/INC
          INC       PMSHKIIO/INC
          INC       PMSPKIIO/INC
          INC       OPRDLVIO/INC       * Doctors Leave
          INC       PATDLTIO/INC
          INC       ALLCTMIO/INC
          INC       PMSTCOIO/INC
          INC       PATHSPIO/INC
          INC       PMSTEMIO/INC
          INC       PMSTMDIO/INC
          INC       PMSDRAIO/INC
          INC       PMSIDWIO/INC
          INC       PMSSPEIO/INC
          INC       PMSRLDIO/INC
          INC       PMSDIVIO/INC
.          INC       PMSIPLIO/INC
.
          INC       CLPMSFPH
          INC       CLPMSHCG
          INC       CLPMSHCL
          INC       CLPMSHCP
          INC       CLMLTHCP
          INC       CLPMSTMD
          INC       CLPMSDRA
          INC       CLPMSSPE
          INC       CLPMSRLD
.
          INC       DGCLIM02
          INC       GENSNDEX          * Generate Soundex key routine *C-0299206
.
          INC       MLTHCPTM
          INC       PATDKIPR 
          INC       PATDOCCD
          INC       PATDOCTM
          INC       PMSFPHTM
          INC       PMSHCGTM 
          INC       PMSHCLTM 
          INC       PMSHCPTM 
          INC       PMSHKIPR
          INC       PMSIDWWR
          INC       PMSPKIPR
          INC       PMSTEMTM
          INC       PMSTMDTM
          INC       PMSDRATM
          INC       PMSSPETM
          INC       PMSRLDTM
          INC       NAMSTRCD
          INC       DAYOFWEK
          INC       IBAWEBCD    
          INC       TFILENAM
          INC       WEBDATCD
.          INC       PMSIPLCD

.******************************************************************************
.* LABELBOK - This is a proc to display the variables painted for             *
.*            Booking Labels.                                                 *
.*                                                                            *
.* PARAMETERS  : KEY18 = BOOKING NO, UNIQUE ID                                *
.*               USINGELT - Using Eltron printer                              *
.*                   0 = No                                                   *
.*                   1 = Yes                                                  *
.*                                                                            *
.* RETURNS     : EXIT 0 = Labels Printed / Zero Labels Selected               *
.*                    1 = Not Screen Painted                                  *
.*               NOLABEL = Number of labels to print                          *
.* Mods        :                                                              *
.******************************************************************************
.* V11.03.01 07/03/2023  Ebon Clements    TSK 0909393                         *
.*           Added hospital to oprsesaf(1-6) and oprdetfa(1&5) indexes        *
.* V11.02.01 14/04/2022  Thanh T          TSK 0903453                         *
.*           Changed INIT0000 to read pmspx2af so data to be avaliable for    *
.*           printing                                                         *
.******************************************************************************
.*               12/07/2007  Peter Vela CAR 142913                            *
.*               Added call to GCCSJG00                                       *
.*               28/09/2000  Dean Cramer                                      *
.*               Recomplied for DXPATMAS                                      *
.*               Changed for SLA code in PATMX1FD                             *
.*               27/04/98   Nick                                              *
.*                          Added LABSIZE & LABCOS for screen paint. labels   *
.*               14/10/1997  Steve Armstrong                                  *
.*               Mods for Wrist Band Labels                                   *
.*               19/05/1997  Steve Armstrong      WHL                         *
.*               Mods for Eltron printer                                      *
.*                                                                            *
.******************************************************************************
          DEFPROC   LABELBOK
.
..          INC       BOKRC1FD/INC
          INC       IBAPASFD/INC
          INC       NHIETHFD/INC


.          INC       NHIMASFD/INC
.          INC       PATDO1FD/INC
.          INC       PATFN1FD/INC
.          INC       PATGO1FD/INC
.          INC       PMSHCGFD/INC
.          INC       PMSHCPFD/INC
.          INC       PATMA1FD/INC
.          INC       PATRE1FD/INC
.          INC       PATVKCFD/INC
.          INC       SCRPSTFD/INC
.          INC       SCRSBGFD/INC
.          INC       SCRSLTFD/INC
.          INC       SCRMASFD/INC

.
FORM3     FORM      3
FORM5     FORM      5
DIM2      DIM       2
DIM6      DIM       6
DIM80     DIM       80
.
DIM3      DIM       3
FIELDNO   FORM      5
NMPNUMB   DIM       20
NOTSCPT   FORM      1          * not screen painted flag
PAGELIMT  FORM      "55"
ODESC     DIM       40
.
ADDNO     FORM      8
DADDNO    DIM       8
BOKUNIQ   DIM       10
.
BJDAY     FORM      2
CJDAY     FORM      2
.
SP30      INIT      "                               "
.
SP100     INIT      "                                                    ":
                    "                                                "
.
ZERO4     INIT      "04"
.
CYRSFDTE  DIM       8
CYRSTDTE  DIM       8
CYRSYEAR  FORM      3
.
CATAI     INIT      "AI"
IND1AI    FORM      1
CATAP     INIT      "AP"
CATAR     INIT      "AR"
.
CODEA     INIT      "A "
CODEA1    INIT      "A1"
CODEA2    INIT      "A2"
CODEA3    INIT      "A3"
CODEA4    INIT      "A4"
CODEA5    INIT      "A5"
CODEAC    INIT      "AC"
CODEBT    INIT      "BT"
CODECL    INIT      "CL"
CODEC     INIT      "C "
CODECC    INIT      "CC"
CODEDA    INIT      "DA"
CODEEA    INIT      "EA"
CODEEP    INIT      "EP"
CODEES    INIT      "ES"
CODEEW    INIT      "EW"
CODEDC    INIT      "DC"
CODEH1    INIT      "H1"
CODEH2    INIT      "H2"
CODEH3    INIT      "H3"
CODELT    INIT      "LT"
CODEM     INIT      "M "
CODEP     INIT      "P "
CODEP1    INIT      "P1"
CODEP2    INIT      "P2"
CODEP3    INIT      "P3"
CODEP4    INIT      "P4"
CODEP5    INIT      "P5"
CODEP6    INIT      "P6"
CODER     INIT      "R "
CODERS    INIT      "RS"
CODES     INIT      "S "
CODET     INIT      "T "
CODETY    INIT      "TY"
CODEU1    INIT      "U1"
CODEU2    INIT      "U2"
CODEU3    INIT      "U3"
CODEU4    INIT      "U4"
CODEU5    INIT      "U5"
CODEU6    INIT      "U6"
CODEU7    INIT      "U7"
CODEUNK   INIT      "UNK"
CODEV6    INIT      "V6"
CODEV7    INIT      "V7"
CODEV8    INIT      "V8"
CODEXM    INIT      "XM"
.
.---------------------------------------------------------------------------
.
MAIN0000  CALL      INIT0000                * open files etc
.
          MOVE      ONE,LABSIZE
          MOVE      ONE,LABCOS 
.
          CALL      LABELCOM                * process screen painted labels
.
MAIN9999  GOTO      LABBOK99
+
.******************************************************************************
.*        INIT0000 - Open some files.                                         *
.******************************************************************************
INIT0000  UNPACK    LABELTYP,PRGID,SCRID
.
          MATCH     SP70,CASEKEYS
          IF        !@EQUAL
            PACK      KEY26,CASEKEYS
            CALL      RDOPDEA1
            BRANCH    OVRCD,INIT9900
.
            MOVE      OPDAUNIQ,BOKUNIQ
            PACK      KEY8,OPDAADMN,SP10
            CALL      RDBKREC1
            BRANCH    OVRCD,INIT9910
          ELSE
            PACK      KEY8,ADMISSNO,SP10
            CALL      RDBKREC1
            BRANCH    OVRCD,INIT9910
          ENDIF
.         
INIT1000  MATCH     SP8,OPDADATE            * see if no theatre date
          IF        @EQUAL 
            MOVE      BKREEDAT,OPDADATE       * set to expected due date
          ENDIF
.
          PACK      KEY8,BKREURNO
          CALL      RDMAST1
.
          OPEN      PMSPX2A1,"pmspx2af"
          PACK      KEY8,BKREURNO,SP70
          CALL      RDPMPX21
          IF        OVRCD = 1
            CALL     CLPMSPX2
          ENDIF
.
          CALL      GCCSJG00
.
.         set the PMI GP details
.
          MOVE      SP30,PMHCSNAM
          PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1
.
          MOVE      SP70,PMHGADD1
          PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70  * GP Practice code
          CALL      RDPMHCG1
.
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
.
          IF        PTCNNHII = 1
            MOVE      SP10,NHMARES
            MOVE      SP10,NHMAETH
            MOVE      SP30,NMPNUMB 
            MOVE      BKREURNO,KEY8
            CALL      RDNHMAS2
          ELSE
            MOVE      SP20,NMPNUMB
            PACK      KEY10,CHOSINDX,BKREURNO,SP10 
            CALL      RDPTNID1
            MOVE      PTNINMPI,NMPNUMB
          ENDIF 
.
          UNPACK    SP100,PKNAME
          UNPACK    SP100,PKADD1,PKADD2 
          UNPACK    SP100,PKADD4,PKSUBR,PKPOST,PKTELEP 
          UNPACK    SP100,PKTELEB,PKRELP
          PACK      KEY8,ADMISSNO,SP10
          CALL      RDPTRES1
.
.         See if using Eltron printer
.
          READ      CONTROLF,SIXTY8;*235,OPCNBELT
          MOVE      OPCNBELT,USINGELT       * save parameter
          MOVE      ZERO,EXIT
          GOTO      INIT9999
.
INIT9900  MOVE      "Invalid Case Key",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INIT9999
.
INIT9910  MOVE      "Invalid Admission Key",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
INIT9999  RETURN
.
+
.*****************************************************************
.*        DISPVARS  Display Items            Called By :         *
.*****************************************************************
DISPVARS  MOVE      SCPSITM,FIELDNO
          MOVE      SCPSLEN,LLCNT
.
          COMPARE   "500",FIELDNO
          GOTO      DVARS100 IF LESS
.
          SUB       "500",FIELDNO
          MOVE      FIELDNO,SCPSITM
          CALL      DXOPRDEA
          GOTO      DVARS999
.
DVARS100  CALL      DXPATMAS
.
DVARS999  RETURN
.
          INC       AGECHK
..          INC       BOKRC1IO/INC
          INC       CALCYRS
          INC       DSPFIELD
.
          INC       WXOPRDEA
..          INC       WEBOPRLB
.
          INC       DXPATCOD
          INC       DXPATDOC
          INC       DXPATMAS
          INC       IBAOVRIO/INC
          INC       IBAPASIO/INC
          INC       NHIETHIO/INC
          INC       WEBLBCOM
.
..          INC       DISPITEM
..          INC       DSPBGRND
.          INC       IBALABPT
.          INC       NHIMASIO/INC
.          INC       PMSHCGIO/INC
.          INC       PMSHCPIO/INC
.          INC       PATCODIO/INC
.          INC       PATDO1IO/INC
.          INC       PATFN1IO/INC
.          INC       PATGO1IO/INC
.          INC       PATMA1IO/INC
.          INC       PATRE1IO/INC
.          INC       PATVKCIO/INC
.          INC       SCRPSTIO/INC
.          INC       SCRSBGIO/INC
.          INC       SCRSLTIO/INC
.          INC       SCRMASIO/INC
.          INC       LABELCOM    
          INC       PMIGTNID
.
LABBOK99  ENDPROC
.............................................................................

.---------------------------------------------------------------------------
.   System    :   Patient System (New Standards)     
.   Include   :   PMSSINKY
.   Routine   :   HPMSI100 Sameday Inv. Brkdown
.   Return    :           
.   Mods      :
.     V9.02.01   31/10/2001  Tonii 
.                Mods as to not display details if acode is empty
.-------------------------------------------------------------------------------
HPMSI100  MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "10",HTOP
            MOVE      "22",HBOT
            MOVE      "10",HLEF
            MOVE      "70",HRIG
          ENDIF
.
HPMSI104  CALL      GSCRN000
          BRANCH    EXIT,HPMSI199
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
.
HPMSI108  MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,PMSIBKCD
          MOVE      CODEFH,TCODE
          MOVE      Z3,ACODE
          PACK      KEY5,TCODE,ACODE
          PACK      SAVKEY80,TCODE,ACODE
          SETLPTR   SAVKEY80,12
          CALL      RDSCODE1
          CALL      RSPMSIN1
.
HPMSI110  CALL      RDKCODE1
          BRANCH    OVRCD,HPMSI115
.
          MATCH     SP3,ACODE
          GOTO      HPMSI110 IF EQUAL
.
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPMSI115 IF EQUAL                                       
.
          MATCH     TCODE,CODEFI
          GOTO      HPMSI115 IF NOT EQUAL
          BRANCH    CSEARCH,HPMSI112
          CALL      HPMSI160
          BRANCH    OVRCD,HPMSI110
.
HPMSI112  ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY5,XITEMNO,ST1,ST2,ST3,ST4,ST5:                          
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT,SP2,ACODE:
                    SP6,TDESC
          COMPARE   MAXITEM,XITEMNO
          GOTO      HPMSI110 IF NOT EQUAL
.
HPMSI115  UNPACK    SAVKEY80,PMSICODE,PMSIFUND,PMSITBLT,PMSICSCD,PMSIBKCD       
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HPMSI120  CALL      HSCRI000
          BRANCH    EXIT,HPMSI130,HPMSI135,HPMSI140,HPMSI145,HPMSI104:
                              HPMSI191,HPMSI150
          GOTO      HPMSI192
.
HPMSI130  CALL      RDKCODE1
          BRANCH    OVRCD,HPMSI185
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPMSI185 IF EQUAL                                       
          CALL      RDPCODE1
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPMSI110
.
HPMSI135  MOVE      ST1,KEY5 
          CALL      RDCODE1 
          CALL      RDPCODE1
          BRANCH    OVRCD,HPMSI185
          PACK      KEY5,TCODE,ACODE
          MATCH     CODEFI,TCODE
          GOTO      HPMSI185 IF NOT EQUAL
.
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPMSI185 IF EQUAL                                       
          MATCH     SP70,PMSIBKCD                                               
          GOTO      HPMSI185 IF EQUAL                                           
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
.
HPMSI136  CALL      RDPCODE1
          BRANCH    OVRCD,HPMSI137
          PACK      KEY5,TCODE,ACODE
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HPMSI136 IF NOT EQUAL
.
HPMSI137  MOVE      ZERO,XITEMNO
          GOTO      HPMSI110
.
HPMSI140  MOVE      ST1,KEY24
          CALL      RDCODE1 
          CALL      RDPCODE1
          BRANCH    OVRCD,HPMSI185
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPMSI185 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPMSI108
.
HPMSI145  CALL      RDKCODE1
          BRANCH    OVRCD,HPMSI185
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5                                               
          GOTO      HPMSI185 IF NOT EQUAL                                       
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY24,SAVKEY80,Z70                                          
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSPMSIN1
.
HPMSI146  CALL      RDPCODE1
          BRANCH    OVRCD,HPMSI147
          PACK      KEY5,TCODE,ACODE
          MATCH     SAVKEY80,KEY5
          GOTO      HPMSI147 IF NOT EQUAL                                       
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HPMSI146 IF NOT EQUAL
.
HPMSI147  MOVE      ZERO,XITEMNO
          GOTO      HPMSI110
.
HPMSI150  COMPARE   ZERO,CSEARCH
          GOTO      HPMSI155 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPMSI108
.
HPMSI155  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HPMSI108
.
HPMSI160  MOVE      ZERO,OVRCD
HPMSI161
HPMSI162
HPMSI163
HPMSI164
HPMSI165
HPMSI166
HPMSI167
HPMSI168
HPMSI169
HPMSI170  GOTO      HPMSI175
.
HPMSI172  MOVE      ONE,OVRCD
.
HPMSI175  RETURN
.
HPMSI185  LOAD      KEY5,XITEMNO,ST1,ST2,ST3,ST4,ST5:                          
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY5,TCODE,ACODE
          CALL      RDCODE1 
.
HPMSI190  UNPACK    SAVKEY80,TCODE,ACODE
          BEEP
          GOTO      HPMSI120
.
HPMSI191  MOVE      ZERO,PMSIAMNT
          MOVE      SP70,KEY24
          MOVE      SP70,PMSIBKCD
          GOTO      HPMSI196
.
HPMSI192  MOVE      SP70,KEY24
          MOVE      SP70,PMSIBKCD
          LOAD      KEY5,CCITEM,ST1,ST2,ST3,ST4,ST5:                           
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY5,TCODE,ACODE
.
HPMSI196  PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
.
HPMSI199  RETURN
.
.---------------------------------------------------------------------------
.   System    :   Patient System (New Standards)     
.   Include   :   PMSSINKY
.   Routine   :   KPMSI100 Keyin Sameday Inv. Brkdown
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KPMSI100 TOPIC     "PMSIBKCD"
          MOVE      UNDLN70,PMSIBKCD
          KEYIN     *PCCOL:CVERT,*DV,PMSIBKCD:                                  
                    *PCCOL:CVERT,*V2LON,PMSIBKCD:                               
                    *PCCOL:CVERT,*DV,PMSIBKCD
.
          ENDSET    PMSIBKCD
          APPEND    SP70,PMSIBKCD
          RESET     PMSIBKCD
.
          PACK      KEY5,CODEFI,PMSIBKCD
.
          MATCH     SP70,PMSIBKCD
          GOTO      KPMSI190 IF EQUAL
.
          CMATCH    EXITCHAR,PMSIBKCD
          GOTO      KPMSI195 IF EQUAL
.
          CMATCH    QUEST,PMSIBKCD
          GOTO      KPMSI110 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HPMSI100
          MOVE      SCCITEM,CCITEM
.
          ENDSET    TDESC
          APPEND    SP70,TDESC
          RESET     TDESC
.
          MATCH     SP70,TDESC
          GOTO      KPMSI100 IF EQUAL
.
KPMSI110  UNPACK    KEY5,DIM2,PMSIBKCD
          MATCH     CODEFI,DIM2
          GOTO      KPMSI185 IF NOT EQUAL
.
          CALL      RDCODE1
          BRANCH    OVRCD,KPMSI180
          BRANCH    CKEYTYP,KPMSI175
.
KPMSI170  MOVE      ZERO,EXIT
          GOTO      KPMSI199
KPMSI175
          MOVE      "Sameday Inv. Brkdown Already Exist - ",DISPMSG                                  
          CALL      MESSAGE1
          GOTO      KPMSI100
KPMSI180
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KPMSI199,KPMSI199
          MOVE      "Sameday Inv. Brkdown Does Not Exist - ",DISPMSG                                 
          CALL      MESSAGE1
          GOTO      KPMSI100
KPMSI185
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KPTSB199,KPTSB199
          MOVE      "Code must be from category 'FI' - ",DISPMSG

          CALL      MESSAGE1
          GOTO      KPMSI100
KPMSI190
          MOVE      ONE,EXIT
          GOTO      KPMSI199
KPMSI195
          MOVE      TWO,EXIT
KPMSI199 TOPIC    PRGID
          RETURN

. *****************************************************************************
. * Routine Name  : CALCDLOS                                                  *
. *                                                                           *
. * Function      : Calculate the Length of Stay and store it in the discharge*
. *                 file.                                                     *
. *                                                                           *
. * Parameters    : PATDSCFD record                                           *
. *                                                                           *
. * Modifications :                                                           *
. *       V12.00.01 14/05/2025  Davin          TSK 0955096                    *
. *                 Changed for Alphanumeric Visit Numbers                    *
. *                 03/11/98 J.Tan  SRF 644620                                *
. *                 Mods NBRDAYS to be FORM4                                  *
. *                 06/10/1998  Glenn Berry      5.07 changes                 *
. *****************************************************************************
          DEFPROC   CALCDLOS
.
          INC       PATMI1FD/INC
          INC       PATTRNFD/INC
          INC       PATCODFD/INC
.
CALDAYS   FORM      4
WDATE1    DIM       8
WDATE2    DIM       8
JYEAR     FORM      2
FROMDATE  DIM       8
TODATE    DIM       8
NBRDAYS   FORM      4
Z30       INIT      "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"
.
.*****************************************************************************
.* Mainline
.*****************************************************************************
ML0000    OPEN      PATTRAN2,"pattranf"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATCODE1,"patcodes"
.
. ------- Calculate Discharge Ward & Length of Stay ------------------------
.
          PACK       KEY8,DADMNO
          CALL       RDMISS1
          BRANCH     OVRCD,ML9999  
.
. ------- Calculate the length of stay ----------------------------
.
          MOVE       ADATE,FROMDATE
          MOVE       DDATE,TODATE
          CALL       RTIODAYS
          MOVE       NBRDAYS,PTDSDLOS
.
. ------- get the discharge ward ---------------------------------------
.
          PACK       KEY30,DADMNO,Z30
          CALL       RDSTRAN2
          CALL       RDPTRAN2
          BRANCH     OVRCD,ML9999  
.
          MATCH      DADMNO,TADMN
          GOTO       ML9999 IF NOT EQUAL
.
          MOVE       TWARD,PTDSDWRD
.
ML9999    GOTO      ENDDLOS
.
.
.
          INC       PATMI1IO/INC
          INC       PATTRNIO/INC
          INC       PATCODIO/INC
          INC       RTIODAYS
          INC       IBAOVRIO/INC
.
ENDDLOS   ENDPROC

. *----------------------------------------------------------------------
. * Include Name  :   NZPMCHTM.PBL
. *
. * Function      :   Common CGI functions for NZ Private Misc Charges File
. *
. * Modifications :
. *
.------------------------------------------------------------------------
. * V11.05.01 20/01/2025  Alina Bhari       TSK 0947787
. *           Displayed all NZ miscellaneous charges in desc/Asc order based
. *           on Effective Date (viewtype=1/0)- NZMCND00,NZMCDD00,NZMCNA00,
. *           NZMCDA00,NZMCDR00,VIEWTYPE,SHOWTYPE,NXTNZM00,PRVNZM00,
. *           NZMCHT00,NZMC3700,NZMC3800
. *           Displayed the latest record for each miscellaneous item
. *           -NZMCND05,NZMCDD05
. *           Displayed only current miscellaneous records
. *           -NZMCD10,NZMCND10
. * V11.04.01 26/06/2024  Thanh T       TSK 0947684
. *           Changed NZMCHT00 and NZMCXT00 to display the number of rows
. *           depending on system parameter
.------------------------------------------------------------------------
. * V11.00.01 15/05/2020 J.Tan          TSK 0890767
. *           Added NZPM0000 - Misc.desc for Pack item
. * V10.04.02 17/04/2014 J.Tan          CAR 300260
. *           Mods checking previous record after finding Inactive Item
. * V10.04.01 22/04/2014 J.Tan          CAR 300260
. *           Mods checking Active/Inactive Misc.Charge
. * V10.03.03 11/10/2013 Don Nguyen     CAR 287376
. *           Replaced " with ' for all instances of NZMCDESC
. * V10.03.02 24/09/2013 Don Nguyen     CAR 287376
. *           Modified NZMC0700 - convert double quotes in desc to single quotes
. * V10.03.01 09/03/2012 J.Tan          CAR 259879
. *           Added Active/Inactive and Effective to date to NZ Misc.Charge
. * V9.11.02  05/01/2009 J.Tan          CAR 186453
. *           Mods the desc. of exploding item desc.to use Item hospital code
. * V9.11.01  30/12/2008 J.Tan          CAR 185945
. *           Fixed report no for next/previous link of Misc.items
. * V9.08.03  12/01/2007 Jill Habasque  CAR 129178
. *           Added multiply of quantity in CALTOT00
. * V9.08.02  21/11/2006 Ebon Clements  CAR 120007
. *           Added copy to cgi vars
. * V9.08.01  17/11/2006 Ebon Clements  CAR 120007
. *           Added exploding item file functions
. * V9.08.00  09/11/2006 Ebon Clements  CAR 120007
. *           Created Include
. *----------------------------------------------------------------------
.------------------------------------------------------------------------
.   Clear CGI Parameters for NZPMCHFD
.------------------------------------------------------------------------
CPNZMC00  MOVE      SP70,NZMCH001
          MOVE      SP70,NZMCH002
          MOVE      SP70,NZMCH003
          MOVE      SP70,NZMCH004
          MOVE      SP70,NZMCH005
          MOVE      SP70,NZMCH006
          MOVE      SP70,NZMCH007
          MOVE      SP70,NZMCH008
          MOVE      SP70,NZMCH009
          MOVE      SP70,NZMCH010
          MOVE      SP70,NZMCH011
          MOVE      SP70,NZMCH012
          MOVE      SP70,NZMCH013
          MOVE      SP70,NZMCH014
          MOVE      SP70,NZMCH015
          MOVE      SP70,NZMCH016
          MOVE      SP70,NZMCH017
          MOVE      SP70,NZMCH018
          MOVE      SP70,NZMCH019
.
          MOVE      SP70,CPMCH001
          MOVE      SP70,CPMCH002
          MOVE      SP70,CPMCH003
          MOVE      SP70,CPMCH004
          MOVE      SP70,CPMCH005
          MOVE      SP70,CPMCH006
.
CPNZMC99  RETURN
.------------------------------------------------------------------------
.   Clear CGI Parameters for NZPMXCFD
.------------------------------------------------------------------------
CPNZMX00  MOVE      SP70,NZMXC001
          MOVE      SP70,NZMXC002
          MOVE      SP70,NZMXC003
.
CPNZMX99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for NZPMCHFD
.------------------------------------------------------------
SPNZMC00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPNZMC01,SPNZMC02,SPNZMC03,SPNZMC04,SPNZMC05:
                       SPNZMC06,SPNZMC07,SPNZMC08,SPNZMC09,SPNZMC10:
                       SPNZMC11,SPNZMC12,SPNZMC13,SPNZMC14,SPNZMC15:
                       SPNZMC16,SPNZMC17,SPNZMC18,SPNZMC19
.
          MOVE      ONE,EXIT
          GOTO      SPNZMC99
.
SPNZMC01  PACK      NZMCH001,QRYDATA,SP70
          GOTO      SPNZMC99
.
SPNZMC02  PACK      NZMCH002,QRYDATA,SP70
          GOTO      SPNZMC99
.
SPNZMC03  PACK      NZMCH003,QRYDATA,SP70
          GOTO      SPNZMC99
.
SPNZMC04  PACK      NZMCH004,QRYDATA,SP70
          GOTO      SPNZMC99
.
SPNZMC05  PACK      NZMCH005,QRYDATA,SP70
          GOTO      SPNZMC99
.
SPNZMC06  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      NZMCH006,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPNZMC99
.
SPNZMC07  MOVE      QRYDATA,NZMCH007
          GOTO      SPNZMC99
.
SPNZMC08  MOVE      QRYDATA,NZMCH008
          GOTO      SPNZMC99
.
SPNZMC09  MOVE      QRYDATA,NZMCH009
          GOTO      SPNZMC99
.
SPNZMC10  MOVE      QRYDATA,NZMCH010
          GOTO      SPNZMC99
.
SPNZMC11  MOVE      QRYDATA,NZMCH011
          GOTO      SPNZMC99
.
SPNZMC12  MOVE      QRYDATA,NZMCH012
          GOTO      SPNZMC99
.
SPNZMC13  MOVE      QRYDATA,NZMCH013
          GOTO      SPNZMC99
.
SPNZMC14  MOVE      QRYDATA,NZMCH014
          GOTO      SPNZMC99
.
SPNZMC15  MOVE      QRYDATA,NZMCH015
          GOTO      SPNZMC99
.
SPNZMC16  MOVE      QRYDATA,NZMCH016
          GOTO      SPNZMC99
.
SPNZMC17  MOVE      QRYDATA,NZMCH017
          GOTO      SPNZMC99
.
SPNZMC18  MOVE      QRYDATA,NZMCH018
          GOTO      SPNZMC99
.
SPNZMC19  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      NZMCH019,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPNZMC99
.
SPNZMC99  RETURN
.
.
.------------------------------------------------------------
.   Set Parameters for copy to NZPMCHFD
.------------------------------------------------------------
CCNZMC00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,CCNZMC01,CCNZMC02,CCNZMC03,CCNZMC04,CCNZMC05:
                       CCNZMC06
.
          MOVE      ONE,EXIT
          GOTO      CCNZMC99
.
CCNZMC01  PACK      CPMCH001,QRYDATA,SP70
          GOTO      CCNZMC99
.
CCNZMC02  PACK      CPMCH002,QRYDATA,SP70
          GOTO      CCNZMC99
.
CCNZMC03  PACK      CPMCH003,QRYDATA,SP70
          GOTO      CCNZMC99
.
CCNZMC04  PACK      CPMCH004,QRYDATA,SP70
          GOTO      CCNZMC99
.
CCNZMC05  PACK      CPMCH005,QRYDATA,SP70
          GOTO      CCNZMC99
.
CCNZMC06  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      CPMCH006,CCENT,CYEAR,CMON,CDAY
          GOTO      CCNZMC99
.
CCNZMC99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for NZPMXCFD
.------------------------------------------------------------
SPNZMX00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPNZMX01,SPNZMX02,SPNZMX03
.
          MOVE      ONE,EXIT
          GOTO      SPNZMX99
.
SPNZMX01  MOVE      QRYDATA,NZMXC001
          SQUEEZE   NZMXC001
          GOTO      SPNZMX99
.
SPNZMX02  PACK      NZMXC002,QRYDATA,SP70
          GOTO      SPNZMX99
.
SPNZMX03  PACK      NZMXC003,QRYDATA,SP70
          GOTO      SPNZMX99
.
SPNZMX99  RETURN
.
.--------------------------------------------------------------------------
. NZ Private Miscellaneous Charges Maintenance Output
.--------------------------------------------------------------------------
NZMC0000  BRANCH    FLDITMNO,NZMC0100,NZMC0200,NZMC0300,NZMC0400,NZMC0500:
                             NZMC0600,NZMC0700,NZMC0800,NZMC0900,NZMC1000:
                             NZMC1100,NZMC1200,NZMC1300,NZMC1400,NZMC1500:
                             NZMC1600,NZMC1700,NZMC1800,NZMC1900,NZMC2000:
                             NZMC2100,NZMC2200,NZMC2300,NZMC2400,NZMC2500:
                             NZMC2600,NZMC2700,NZMC2800,NZMC2900,NZMC3000:
                             NZMC3100,NZMC3200,NZMC3300,NZMC3400,NZMC3500:
                             NZMC3600,NZMC3700,NZMC3800
          GOTO      NZMC9999
.
NZMC0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          COMPARE   ONE,IBCNMHOS
          GOTO      NZMC9999 IF NOT EQUAL
.
          BRANCH    F1,NZMC0110,NZMC0120
.
          PACK      KEY3,NZMCHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,NZMC9999
.
          WRITE     HTMLFILE;PTHSNAME;           * hospital name
          GOTO      NZMC9999
.
NZMC0110  WRITE     HTMLFILE;NZMCHOSP;           * hospital code
          GOTO      NZMC9999
.
NZMC0120  MOVE      NZMCHOSP,DIM3
          CALL      NZMH0000                     * hospital selectin list
          GOTO      NZMC9999
.
NZMC0200  MOVE      "CL",CATEGORY                * Claim Code
          MOVE      NZMCCLMC,CODE
          CALL      CODITM00
          GOTO      NZMC9999
.
NZMC0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZMC0310
.
          WRITE     HTMLFILE;NZMCCNTR;           * Health Fund
          GOTO      NZMC9999
.
NZMC0310  MATCH     SP70,NZMCCNTR
          GOTO      NZMC9999 IF EQUAL
.
          PACK      KEY14,NZMCCNTR,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,NZMC9999
          WRITE     HTMLFILE;HFNAME;             * Health Fund Name
          GOTO      NZMC9999
.
NZMC0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZMC0410
.
          WRITE     HTMLFILE;NZMCFTAB;           * Health Fund Table
          GOTO      NZMC9999
.
NZMC0410  MATCH     SP70,NZMCFTAB
          GOTO      NZMC9999 IF EQUAL
.
          PACK      KEY14,NZMCCNTR,NZMCFTAB,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,NZMC9999
          WRITE     HTMLFILE;HFNAME;             * Health Fund Name
          GOTO      NZMC9999
.
NZMC0500  MATCH     SP70,NZMCMCHG                * Charge Code
          GOTO      NZMC9999 IF EQUAL
.
          WRITE     HTMLFILE;NZMCMCHG;
          GOTO      NZMC9999
.
NZMC0600  MATCH     SP70,NZMCEFDT                * Effective date
          GOTO      NZMC9999 IF EQUAL
.
          UNPACK    NZMCEFDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZMC9999
.
NZMC0700  MATCH     SP70,NZMCDESC                * Charge Description
          GOTO      NZMC9999 IF EQUAL
.
          REP       "#"'",NZMCDESC               * Double quote to single quote
          WRITE     HTMLFILE;NZMCDESC;
          GOTO      NZMC9999
.
NZMC0800  WRITE     HTMLFILE;NZMCCHGT;           * Charge Type
          GOTO      NZMC9999
.
NZMC0900  MOVE      "FI",CATEGORY                * Misc Charge Group
          MOVE      NZMCCGRP,CODE
          CALL      CODITM00
          GOTO      NZMC9999
.
NZMC1000  WRITE     HTMLFILE;NZMCPATP;           * Patient Portion
          GOTO      NZMC9999
.
NZMC1100  WRITE     HTMLFILE;NZMCREBP;           * Rebate Portion
          GOTO      NZMC9999
.
NZMC1200  WRITE     HTMLFILE;NZMCINDC;           * changing desc
          GOTO      NZMC9999
.
NZMC1300  WRITE     HTMLFILE;NZMCGSTA;           * GST applicable
          GOTO      NZMC9999
.
NZMC1400  CALL      NZMGST00                     * GST payable code
          GOTO      NZMC9999
.
NZMC1500  MATCH     SP70,NZMCEDIE;               * EDI Equivalent
          GOTO      NZMC9999 IF EQUAL
.
          WRITE     HTMLFILE;NZMCEDIE;
          GOTO      NZMC9999
.
NZMC1600  MATCH     SP70,NZMCKPRI;               * Keyin Price
          GOTO      NZMC9999 IF EQUAL
.
          WRITE     HTMLFILE;NZMCKPRI;
          GOTO      NZMC9999
.
NZMC1700  WRITE     HTMLFILE;NZMCSHWD;           * show details on invoice
          GOTO      NZMC9999
.
NZMC1800  MATCH     NZMCCDAT,SP70
          GOTO      NZMC9999 IF EQUAL
.         
          UNPACK    NZMCCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZMC9999
.
NZMC1900  WRITE     HTMLFILE;NZMCCTIM;
          GOTO      NZMC9999
.
NZMC2000  MATCH     SP70,NZMCCUID
          GOTO      NZPF9999 IF EQUAL
.         
          PACK      KEY10,NZMCCUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      NZMCCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      NZMC9999
.
NZMC2100  MATCH     NZMCUDAT,SP70
          GOTO      NZMC9999 IF EQUAL
.
          UNPACK    NZMCUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZMC9999
.
NZMC2200  WRITE     HTMLFILE;NZMCUTIM;
          GOTO      NZMC9999
.
NZMC2300  MATCH     SP70,NZMCUUID
          GOTO      NZPF9999 IF EQUAL
.
          PACK      KEY10,NZMCUUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      NZMCUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      NZMC9999
.
NZMC2400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          COMPARE   ONE,IBCNMHOS
          GOTO      NZMC9999 IF NOT EQUAL
.
          BRANCH    F1,NZMC2410,NZMC2420
.         
          PACK      KEY3,NZMCH001,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,NZMC9999
.
          WRITE     HTMLFILE;PTHSNAME;           * hospital name
          GOTO      NZMC9999
.
NZMC2410  WRITE     HTMLFILE;NZMCH001;           * hospital code
          GOTO      NZMC9999
.
NZMC2420  MOVE      NZMCH001,DIM3
          CALL      NZMH0000                     * hospital selectin list
          GOTO      NZMC9999
.
NZMC2500  MOVE      "CL",CATEGORY                * Claim Code
          MOVE      NZMCH002,CODE
          CALL      CODITM00
          GOTO      NZMC9999
.
NZMC2600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZMC2610
.
          WRITE     HTMLFILE;NZMCH003;           * Health Fund
          GOTO      NZMC9999
.
NZMC2610  MATCH     SP70,NZMCH003
          GOTO      NZMC9999 IF EQUAL
.
          PACK      KEY14,NZMCH003,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,NZMC9999
          WRITE     HTMLFILE;HFNAME;             * Health Fund Name
          GOTO      NZMC9999
.
NZMC2700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZMC2710
.
          WRITE     HTMLFILE;NZMCH004;           * Health Fund Table
          GOTO      NZMC9999
.
NZMC2710  PACK      KEY14,NZMCH003,NZMCH004,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,NZMC9999
          WRITE     HTMLFILE;HFNAME;             * Health Fund Name
          GOTO      NZMC9999
.
NZMC2800  MATCH     SP70,NZMCH005                * Charge Code
          GOTO      NZMC9999 IF EQUAL
.
          WRITE     HTMLFILE;NZMCH005;
          GOTO      NZMC9999
.
NZMC2900  WRITE     HTMLFILE;FILEFLAG;           * New file / old file
          GOTO      NZMC9999
.
NZMC3000  CALL      NZMCHT00                     * List NZ priv misc. charges
          GOTO      NZMC9999
.
NZMC3100  CALL      NXTNZM00                     * next priv misc. charges
          GOTO      NZMC9999
.
NZMC3200  CALL      PRVNZM00                     * prev NZ priv misc. charges
          GOTO      NZMC9999
.
NZMC3300  CALL      NZMCXT00                     * List exploding items
.
          MATCH     "N",FILEFLAG            * Re read correct misc charge record
          IF         @EQUAL
            PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                            NZMCH006,SP70
            CALL      RDNZMC11
            IF        OVRCD=1
              CALL      CLNZMC00
            ENDIF
          ELSE
            PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                            NZMCH006,SP70
            CALL      RDNZMCH1
            IF        OVRCD=1
              CALL      CLNZMC00
            ENDIF
          ENDIF
          GOTO      NZMC9999
.
NZMC3400  CALL      CALTOT00                     * Get calculated price
          WRITE     HTMLFILE;TOTALAMT;
.
          MATCH     "N",FILEFLAG            * Re read correct misc charge record
          IF         @EQUAL
            PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                            NZMCH006,SP70
            CALL      RDNZMC11
            IF        OVRCD=1
              CALL      CLNZMC00
            ENDIF
          ELSE
            PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                            NZMCH006,SP70     
            CALL      RDNZMCH1
            IF        OVRCD=1
              CALL      CLNZMC00
            ENDIF
          ENDIF
          GOTO      NZMC9999
.
NZMC3500  WRITE     HTMLFILE;NZMCACFL;           * Active
          GOTO      NZMC9999
.
NZMC3600  MATCH     SP70,NZMCEEDT                * Effective date
          GOTO      NZMC9999 IF EQUAL
.
          UNPACK    NZMCEEDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZMC9999
.
NZMC3700  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      NZMC9999
.
NZMC3800  WRITE     HTMLFILE;SHOWTYPE;
          GOTO      NZMC9999
.
NZMC9999  RETURN
.
.--------------------------------------------------------------------------
. NZ Private Exploding Miscellaneous Charges Maintenance Output
.--------------------------------------------------------------------------
NZMX0000  BRANCH    FLDITMNO,NZMX0100,NZMX0200,NZMX0300
          GOTO      NZMX9999
.
NZMX0100  WRITE     HTMLFILE;NZMXQNTY;      * Quantity
          GOTO      NZMX9999
.
NZMX0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZMC0210
.
          WRITE     HTMLFILE;NZMXITMN;      * Item Code
          GOTO      NZMX9999
.
NZMC0210  MOVE      NZMXITMN,KEY9
          MOVE      NZMXCLMC,D3
          MOVE      NZMXHOSP,DIM3           * Hospital code
          CALL      NZMD0000 
          REP       "#"'",NZMCDESC          * Double quote to single quote
          WRITE     HTMLFILE;NZMCDESC;      * Item Desc
          GOTO      NZMX9999
.
NZMX0300  WRITE     HTMLFILE;NZMXUNIQ;      * Unique Number
          GOTO      NZMX9999
.
NZMX9999  RETURN
.
.------------------------------------------------------------
.  Update NZPMCHFD file
.------------------------------------------------------------
MVNZMC00  MOVE      NZMCH001,NZMCHOSP
          MOVE      NZMCH002,NZMCCLMC
          MOVE      NZMCH003,NZMCCNTR
          MOVE      NZMCH004,NZMCFTAB
          MOVE      NZMCH005,NZMCMCHG
          MOVE      NZMCH006,NZMCEFDT
          MOVE      NZMCH007,NZMCDESC
          MOVE      NZMCH008,NZMCCHGT
          MOVE      NZMCH009,NZMCCGRP
          MOVE      NZMCH010,NZMCPATP
          MOVE      NZMCH011,NZMCREBP
          MOVE      NZMCH012,NZMCINDC
          MOVE      NZMCH013,NZMCGSTA
          MOVE      NZMCH014,NZMCGSTC
          MOVE      NZMCH015,NZMCEDIE
          MOVE      NZMCH016,NZMCKPRI
          MOVE      NZMCH017,NZMCSHWD
          MOVE      NZMCH018,NZMCACFL
          MOVE      NZMCH019,NZMCEEDT
.
MVNZMC99  RETURN
.
.------------------------------------------------------------
.  Update NZPMXCFD file
.------------------------------------------------------------
MVNZMX00  MOVE      NZMCH001,NZMXHOSP
          MOVE      NZMCH002,NZMXCLMC
          MOVE      NZMCH003,NZMXCNTR
          MOVE      NZMCH004,NZMXFTAB
          MOVE      NZMCH005,NZMXMCHG
          MOVE      NZMCH006,NZMXEFDT
.
          MOVE      ZERO,F3
          SQUEEZE   NZMXC001
          MOVE      NZMXC001,F3
          MOVE      F3,NZMXQNTY
          MOVE      NZMXC002,NZMXITMN
.
MVNZMX99  RETURN

.
.------------------------------------------------------------
. GST Code Selection List
.------------------------------------------------------------
NZMGST00  PACK      KEY6,SP70
          CALL      RSIBGS1
NZMGST10  CALL      RKIBGS1
          BRANCH    OVRCD,NZMGST99
.
          COMPARE   "1",IBGSACTV
          GOTO      NZMGST10 IF EQUAL
.
          MATCH     NZMCGSTC,IBGSCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",IBGSCODE,"#" selected>":
                               IBGSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",IBGSCODE,"#">":
                               IBGSDESC,"</option>"
          ENDIF
.
          GOTO      NZMGST10
.
NZMGST99  RETURN
.
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
NZMH0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
NZMH0100  CALL      RKPTHSP1
          BRANCH    OVRCD,NZMH9999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     DIM3,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      NZMH0100
.
NZMH9999  RETURN
.
.-------------------------------------------------------------------------
. Link to Next Miscellaneous Charges
.-------------------------------------------------------------------------
NXTNZM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZMCH006
          IF        !@EQUAL
            UNPACK    NZMCH006,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nzmch001=",NZMCH001:
                                 "&nzmch002=",NZMCH002:
                                 "&nzmch003=",NZMCH003:
                                 "&nzmch004=",NZMCH004:
                                 "&nzmch005=",NZMCH005:
                                 "&nzmch006=",KEY11:
                                 "&fileflag=",FILEFLAG:
                                 "&viewtype=",VIEWTYPE:
                                 "&showtype=",SHOWTYPE;
.
NXTNZM99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Miscellaneous Charges
.-------------------------------------------------------------
PRVNZM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZMCH006
          IF        !@EQUAL
            UNPACK    NZMCH006,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nzmch001=",NZMCH001:
                                 "&nzmch002=",NZMCH002:
                                 "&nzmch003=",NZMCH003:
                                 "&nzmch004=",NZMCH004:
                                 "&nzmch005=",NZMCH005:
                                 "&nzmch006=",KEY11:
                                 "&fileflag=",FILEFLAG:
                                 "&viewtype=",VIEWTYPE:
                                 "&showtype=",SHOWTYPE;
.
PRVNZM99  RETURN
.
.------------------------------------------------------------
. Table of NZ Private Miscellaneous Charges Details
.------------------------------------------------------------
NZMCHT00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      NZMCHH00                     * Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD  
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      SP70,DISKEY29
.         Get the first record
          MATCH     "N",FILEFLAG
          GOTO      NZMCHT10 IF EQUAL
.
          PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * Current
                          SP70                                       * File
          CALL      RDNZMCH1                               
          COMPARE   ZERO,OVRCD
          GOTO      NZMCHT20 IF EQUAL
.
.         First Loop for the first record(f1)
          PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * Current
                          NZMCH005,NZMCH006,SP70                     * File
          CALL      RSNZMCH1
NZMCHT05  CALL      RKNZMCH1
          BRANCH    OVRCD,NZMCHT90
          GOTO      NZMCHT20
.
.         First Loop for the first record(f1) - new file
NZMCHT10  PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * New File
                          SP70 
          CALL      RDNZMC11
          COMPARE   ZERO,OVRCD
          GOTO      NZMCHT20 IF EQUAL
.
          PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * New File
                          NZMCH005,NZMCH006,SP70
          CALL      RSNZMC11
NZMCHT15  CALL      RKNZMC11                                         * New File
          BRANCH    OVRCD,NZMCHT90
.
NZMCHT20  MATCH     NZMCH001,NZMCHOSP            * hospital
          GOTO      NZMCHT90 IF NOT EQUAL
.
          MATCH     NZMCH002,NZMCCLMC            * claim code
          GOTO      NZMCHT90 IF NOT EQUAL
.
          MATCH     SP70,NZMCH003
          IF        !@EQUAL
            MATCH     NZMCH003,NZMCCNTR          * health fund
            GOTO      NZMCHT90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZMCH004
          IF        !@EQUAL
            MATCH     NZMCH004,NZMCFTAB          * table
            GOTO      NZMCHT90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZMCH005
          IF        !@EQUAL
            MATCH     NZMCH005,NZMCMCHG          * misc. charge code
            GOTO      NZMCHT90 IF NOT EQUAL
          ENDIF
.
          PACK      SAVKEY29,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            MATCH     SAVKEY29,DISKEY29
            GOTO      NZMCHT15 IF EQUAL   * Read for next unique record
          ELSE
            MATCH     SAVKEY29,DISKEY29
            GOTO      NZMCHT05 IF EQUAL   * Read for next unique record
          ENDIF
.
.         Get all child record of f1 with different effective date
.
          PACK      DISKEY29,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     "1",VIEWTYPE
          IF        @EQUAL
            MATCH     "N",FILEFLAG
            IF        @EQUAL
              CALL      NZMCND00
            ELSE
              CALL      NZMCDD00
            ENDIF
            BRANCH    EXIT,NZMCHT99
          ELSE
            MATCH     "N",FILEFLAG
            IF        @EQUAL
              CALL      NZMCNA00
            ELSE
              CALL      NZMCDA00 
            ENDIF 
            BRANCH    EXIT,NZMCHT99
          ENDIF
.
          PACK      KEY37,SAVKEY29,SP70   *repositioning KEY37
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RDNZMC11
            GOTO      NZMCHT15
          ELSE
            CALL      RDNZMCH1
            GOTO      NZMCHT05
          ENDIF
.
NZMCHT90  CALL      NOMORE00     * Display No More Records Message
.
NZMCHT99  RETURN
.
.------------------------------------------------------------
. Miscellaneous Charges File reading record ASC
. SAVEKEY29=Key value for record to print no effective date
.------------------------------------------------------------
NZMCDA00  PACK      KEY37,SAVKEY29,SP70
          CALL      RDNZMCH1
          COMPARE   ZERO,OVRCD
          GOTO      NZMCDA10 IF EQUAL
.
          CALL      RSNZMCH1
NZMCDA05  CALL      RKNZMCH1
          BRANCH    OVRCD,NZMCDA90
.
NZMCDA10  PACK      KEY29,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     SAVKEY29,KEY29
          GOTO      NZMCDA90 IF NOT EQUAL   *Not the correct loop
.
          CALL      NZMCDR00
          BRANCH    EXIT,NZMCDA95
.
          GOTO      NZMCDA05
.
NZMCDA90  MOVE      ZERO,EXIT               * Not Full page
          GOTO      NZMCDA99
.
NZMCDA95  MOVE      ONE,EXIT                * Full Page Found
          GOTO      NZMCDA99
.
NZMCDA99  RETURN
.
.------------------------------------------------------------
. Miscellaneous Charges File reading record ASC - new file
. SAVEKEY29=Key value for record to print no effective date
.------------------------------------------------------------
NZMCNA00  PACK      KEY37,SAVKEY29,SP70
          CALL      RDNZMC11
          COMPARE   ZERO,OVRCD
          GOTO      NZMCNA10 IF EQUAL
.
          CALL      RSNZMC11
NZMCNA05  CALL      RKNZMC11
          BRANCH    OVRCD,NZMCNA90
.
NZMCNA10  PACK      KEY29,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     SAVKEY29,KEY29
          GOTO      NZMCNA90 IF NOT EQUAL   *Not the correct loop
.
          CALL      NZMCDR00
          BRANCH    EXIT,NZMCNA95
.
          GOTO      NZMCNA05
.
NZMCNA90  MOVE      ZERO,EXIT               * Not Full page
          GOTO      NZMCNA99
.
NZMCNA95  MOVE      ONE,EXIT                * Full Page Found
          GOTO      NZMCNA99
.
NZMCNA99  RETURN
.
.------------------------------------------------------------
. Miscellaneous Charges File reading record DSC
. SAVEKEY21=Key value for record to print no effective date
.------------------------------------------------------------
NZMCDD00  PACK      KEY37,SAVKEY29,Z70
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD         * Current Date
          REP       " 0",CURRDATE
.
          CALL      RSNZMCH1
NZMCDD05  CALL      RPNZMCH1
          BRANCH    OVRCD,NZMCDD90
.
          PACK      KEY29,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,Z70
          MATCH     SAVKEY29,KEY29
          GOTO      NZMCDD90 IF NOT EQUAL   *Not the correct loop
.
.         Get only current miscellaneous charge
          MATCH     "2",SHOWTYPE
          IF        @EQUAL
.
            MATCH     SP70,NZMCEEDT
            GOTO      NZMCDD10 IF EQUAL
.
            MATCH     NZMCEEDT,CURRDATE  *if > or equal to current date
            GOTO      NZMCDD05 IF NOT LESS
          ENDIF
.
NZMCDD10  CALL      NZMCDR00
          BRANCH    EXIT,NZMCDD95
.
.         Get the each most recent record for each Misc Charge
          MATCH     "1",SHOWTYPE
          IF        @EQUAL
            GOTO      NZMCDD90
          ENDIF
.
          GOTO      NZMCDD05
.
NZMCDD90  MOVE      ZERO,EXIT               * Not Full page
          GOTO      NZMCDD99
.
NZMCDD95  MOVE      ONE,EXIT                * Full Page Found
          GOTO      NZMCDD99
.
NZMCDD99  RETURN
.
.------------------------------------------------------------
. Miscellaneous Charges File reading record DSC - New file
. SAVEKEY21=Key value for record to print no effective date
.------------------------------------------------------------
NZMCND00  PACK      KEY37,SAVKEY29,Z70
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD         * Current Date
          REP       " 0",CURRDATE
.
          CALL      RSNZMC11
NZMCND05  CALL      RPNZMC11
          BRANCH    OVRCD,NZMCND90
.
          PACK      KEY29,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,Z70
          MATCH     SAVKEY29,KEY29
          GOTO      NZMCND90 IF NOT EQUAL   *Not the correct loop
.
.         Get only current miscellaneous charge
          MATCH     "2",SHOWTYPE
          IF        @EQUAL
.
            MATCH     SP70,NZMCEEDT
            GOTO      NZMCND10 IF EQUAL
.
            MATCH     NZMCEEDT,CURRDATE  *if > or equal to current date
            GOTO      NZMCND05 IF NOT LESS
          ENDIF
.
NZMCND10  CALL      NZMCDR00
          BRANCH    EXIT,NZMCND95
.
.         Get the each most recent record for each Misc Charge
          MATCH     "1",SHOWTYPE
          IF        @EQUAL
            GOTO      NZMCND90
          ENDIF
.
          GOTO      NZMCND05
.
NZMCND90  MOVE      ZERO,EXIT               * Not Full page
          GOTO      NZMCND99
.
NZMCND95  MOVE      ONE,EXIT                * Full Page Found
          GOTO      NZMCND99
.
NZMCND99  RETURN
.
.------------------------------------------------------------
. Miscellaneous Charges File Paging and display Table (TABLE ROW)
.------------------------------------------------------------
NZMCDR00  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      NZMCDR90
          ENDIF
.
          CALL      NZMCHR00                * write data line
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      NZMCDR90
          ENDIF
.
          GOTO      NZMCDR95
.
NZMCDR90  MOVE      ZERO,EXIT               * Not Full page
          GOTO      NZMCDR99
.
NZMCDR95  MOVE      ONE,EXIT                * Full Page Found
          GOTO      NZMCDR99
.
NZMCDR99  RETURN
.
.------------------------------------------------------------
. NZ Private Miscellaneous Charges File Table (TABLE ROW)
.------------------------------------------------------------
NZMCHR00  MOVE      SP20,DIM20
          MOVE      SP70,TDESC
          MATCH     SP10,MMSCGRP
          GOTO      NZMCHR05 IF EQUAL
.
          PACK      KEY5,ANSF,ANSI,NZMCCGRP
          CALL      RDCODE1
          BRANCH    OVRCD,NZMCHR05
          MOVE      TDESC,DIM20
.
NZMCHR05  MOVE      SP20,DIM11
          LOAD      DIM11,NZMCCHGT,EXPFEE,THTRFEE,MISCFEE
.
          MOVE      SP20,DIM12
.
          MATCH     SP20,NZMCEFDT
          GOTO      NZMCHR50 IF EQUAL
.
          UNPACK    NZMCEFDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
NZMCHR50  MOVE      SP70,PTHSNAME
          MATCH     SP70,NZMCHOSP
          IF        !@EQUAL
            PACK      KEY3,NZMCHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD=1
              MOVE      NZMCHOSP,PTHSNAME        * hospital
            ENDIF
          ENDIF
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZMCEFDT
          IF        !@EQUAL  
            UNPACK    NZMCEFDT,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF              
          REP       " +",KEY11
.
          REP       " +",NZMCHOSP
          REP       " +",NZMCCLMC
          REP       " +",NZMCCNTR
          REP       " +",NZMCFTAB
          REP       " +",NZMCMCHG
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&nzmch001=",NZMCHOSP:
                             "&nzmch002=",NZMCCLMC:
                             "&nzmch003=",NZMCCNTR:
                             "&nzmch004=",NZMCFTAB:
                             "&nzmch005=",NZMCMCHG:
                             "&nzmch006=",KEY11:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle>";
.
.
          REP       "+ ",NZMCHOSP
          REP       "+ ",NZMCCLMC
          REP       "+ ",NZMCCNTR
          REP       "+ ",NZMCFTAB
          REP       "+ ",NZMCMCHG
          MOVE      SP70,KEY11
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"</a>",PTHSNAME,"</td>":
                               "<td>&nbsp;",NZMCMCHG,"</td>";
          ELSE
            WRITE     HTMLFILE;"</a>",NZMCMCHG,"</td>";
          ENDIF
.
          REP       "#"'",NZMCDESC
          WRITE     HTMLFILE;"<td>&nbsp;",NZMCDESC,"</td>":
                             "<td>&nbsp;",NZMCCNTR,"</td>":
                             "<td>&nbsp;",NZMCFTAB,"</td>":
                             "<td>&nbsp;",DIM12,"</td>":
                             "<td>&nbsp;",DIM11,"</td>":
                             "<td>&nbsp;",DIM20,"</td>":
                             "<td>&nbsp;",NZMCPATP,"</td>";
.
          MOVE      "Yes",KEY3
          MATCH     "1",NZMCACFL
          IF        @EQUAL
            MOVE      "No ",KEY3          * Inactive
          ENDIF
.
          MOVE      SP20,DIM12
          MATCH     SP20,NZMCEEDT
          GOTO      NZMCHR60 IF EQUAL
.
          UNPACK    NZMCEEDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
NZMCHR60  WRITE     HTMLFILE;"<td>&nbsp;",KEY3,"</td>":
                             "<td>&nbsp;",DIM12,"</td>":
                             "</tr>"
.
NZMCHR99 RETURN
.
.------------------------------------------------------------
. NZ Private Misc. Charges Table Heading
.------------------------------------------------------------
NZMCHH00  WRITE     HTMLFILE;"<tr>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell>Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>Misc. Charge Code</td>":
                             "<td class=HeadingCell>Description</td>":
                             "<td class=HeadingCell>Contract</td>":
                             "<td class=HeadingCell>Table</td>":
                             "<td class=HeadingCell>Effective Date</td>":
                             "<td class=HeadingCell>Charge Type</td>":
                             "<td class=HeadingCell>Misc. Charge Group</td>":
                             "<td class=HeadingCell>Price</td>":
                             "<td class=HeadingCell>Active</td>":
                             "<td class=HeadingCell>Eff.To Date</td>":
                             "</tr>";
.
NZMCHH99  RETURN
.
.------------------------------------------------------------
. Table of NZ Private Exploding Miscellaneous Charges Details
.------------------------------------------------------------
NZMCXT00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      NZMCXH00                     * Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     "N",FILEFLAG
          GOTO      NZMCXT10 IF EQUAL
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * Current
                          NZMCH005,NZMCH006,SP70                     * File
          CALL      RDNZMXC1
          COMPARE   ZERO,OVRCD
          GOTO      NZMCXT20 IF EQUAL
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * Current
                          NZMCH005,NZMCH006,SP70                     * File
          CALL      RSNZMXC1
NZMCXT05  CALL      RKNZMXC1
          BRANCH    OVRCD,NZMCXT90
          GOTO      NZMCXT20
.
NZMCXT10  PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * New File
                          NZMCH005,NZMCH006,SP70
          CALL      RDNZMX11
          COMPARE   ZERO,OVRCD
          GOTO      NZMCXT20 IF EQUAL
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * New File
                          NZMCH005,NZMCH006,SP70
          CALL      RSNZMX11
NZMCXT15  CALL      RKNZMX11                                         * New File
          BRANCH    OVRCD,NZMCXT90
.
NZMCXT20  MATCH     NZMCH001,NZMXHOSP            * hospital
          GOTO      NZMCXT90 IF NOT EQUAL
.
          MATCH     NZMCH002,NZMXCLMC            * claim code
          GOTO      NZMCXT90 IF NOT EQUAL
.
          MATCH     NZMCH003,NZMXCNTR            * health fund
          GOTO      NZMCXT90 IF NOT EQUAL
.
          MATCH     NZMCH004,NZMXFTAB            * table
          GOTO      NZMCXT90 IF NOT EQUAL
.
          MATCH     NZMCH005,NZMXMCHG            * misc charge
          GOTO      NZMCXT90 IF NOT EQUAL
.
          MATCH     NZMCH006,NZMXEFDT            * effective date
          GOTO      NZMCXT90 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            MATCH     "N",FILEFLAG
            GOTO      NZMCXT15 IF EQUAL
            GOTO      NZMCXT05
          ENDIF
.
          CALL      NZMCXR00                     * Table row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            MATCH     "N",FILEFLAG
            GOTO      NZMCXT15 IF EQUAL
            GOTO      NZMCXT05
          ENDIF
.
          GOTO      NZMCXT99
.
NZMCXT90  CALL      NOMORE00     * Display No More Records Message 
.
NZMCXT99  RETURN
.
.------------------------------------------------------------
. NZ Private Exploding Miscellaneous Charges File Table (TABLE ROW)
.------------------------------------------------------------
NZMCXR00  MOVE      SP70,KEY11
          PACK      KEY8,CCC,CYY,CMM,CDD      * set to current date
          MATCH     SP70,NZMXEFDT
          IF        !@EQUAL
            UNPACK    NZMXEFDT,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
            MOVE      NZMXEFDT,KEY8
          ENDIF
          REP       " +",KEY11
          REP       " 0",KEY8
.
          MOVE      NZMXITMN,KEY9
          MOVE      NZMXCLMC,D3
          MOVE      NZMXHOSP,DIM3           * Hospital code
          CALL      NZMD0000                * Get misc item desc
.
          REP       " +",NZMXHOSP
          REP       " +",NZMXCLMC
          REP       " +",NZMXCNTR
          REP       " +",NZMXFTAB
          REP       " +",NZMXMCHG
          REP       " +",NZMXUNIQ
.
          REP       "#"'",NZMCDESC
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&nzmch001=",NZMXHOSP:
                             "&nzmch002=",NZMXCLMC:
                             "&nzmch003=",NZMXCNTR:
                             "&nzmch004=",NZMXFTAB:
                             "&nzmch005=",NZMXMCHG:
                             "&nzmch006=",KEY11:
                             "&nzmxc003=",NZMXUNIQ:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle>":
                             "</a>",NZMXITMN,"&nbsp;</td>":
                             "<td>&nbsp;",NZMCDESC,"&nbsp;</td>":
                             "<td>&nbsp;",NZMXQNTY,"&nbsp;</td>":
                             "<td>&nbsp;",NZMCPATP,"&nbsp;</td>":
                             "</tr>"
.
.
          REP       "+ ",NZMXHOSP
          REP       "+ ",NZMXCLMC
          REP       "+ ",NZMXCNTR
          REP       "+ ",NZMXFTAB
          REP       "+ ",NZMXMCHG
          MOVE      SP70,KEY11
          REP       "+ ",NZMXUNIQ
.
NZMCXR99 RETURN
.
.------------------------------------------------------------
. NZ Private Exploding Misc. Charges Table Heading
.------------------------------------------------------------
NZMCXH00  WRITE     HTMLFILE;"<tr><td class=HeadingCell width=20%>":
                             "Misc. Item Code</td>":
                             "<td class=HeadingCell>Description</td>":
                             "<td class=HeadingCell>Quantity</td>":
                             "<td class=HeadingCell>Default Price</td>":
                             "</tr>";
.
NZMCXH99  RETURN
.
.------------------------------------------------------------
. Get NZ Private Misc. Charge description
.------------------------------------------------------------
NZMD0000  MOVE      ZERO,EXIT
          MOVE      ZERO,F1
          PACK      KEY8,CCC,CYY,CMM,CDD      * set to current date
          PACK      NZMXEFDT,NZMXEFDT,SP70
          MATCH     SP70,NZMXEFDT
          IF        !@EQUAL
            MOVE      NZMXEFDT,KEY8
          ENDIF
          REP       " 0",KEY8
.
          CALL      NZPM0000          * Use Hosp.Code/Contract of Pack item
          BRANCH    EXIT,NZMD8000
          MOVE      ZERO,F1
.
          IF        IBCNMHOS=1
            MATCH     SP10,WBSEHOSP
            IF        @EQUAL
              PACK      KEY3,WBSEHOSP
              CALL      RSPTHSP1
              CALL      RKPTHSP1
              BRANCH    OVRCD,NZMD9000
            ELSE
              PACK      KEY3,WBSEHOSP
              CALL      RDPTHSP1
              BRANCH    OVRCD,NZMD9000
            ENDIF
            PACK      KEY29,DIM3,PTHSDCLM,SP6,SP8,KEY9,SP70
            PACK      KEY37,DIM3,PTHSDCLM,SP6,SP8,KEY9,KEY8,SP70
          ELSE
            PACK      KEY29,SP3,PTCNDCLM,SP6,SP8,KEY9,SP70
            PACK      KEY37,SP3,PTCNDCLM,SP6,SP8,KEY9,KEY8,SP70
          ENDIF
.
NZMD2000  MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RDNZMC11
          ELSE
            CALL      RDNZMCH1
          ENDIF
          IF        OVRCD=0
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      NZMD8000 IF NOT EQUAL       * No
          ENDIF
.
.         check for previous record
.
NZMD2200  MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RPNZMC11
          ELSE
            CALL      RPNZMCH1
          ENDIF
          BRANCH    OVRCD,NZMD9000
          PACK      KEY29A,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     KEY29,KEY29A
          GOTO      NZMD4000 IF NOT EQUAL
.
          MATCH     "1",NZMCACFL                * Inactive?
          GOTO      NZMD2200 IF EQUAL           * Yes
.
          MATCH     NZMCEFDT,KEY8           * effective date => serv. date ?
          GOTO      NZMD4000 IF LESS        * yes
.
          MATCH     SP70,NZMCEEDT
          IF        !@EQUAL
            MATCH     KEY8,NZMCEEDT
            GOTO      NZMD4000 IF LESS
          ENDIF
          GOTO      NZMD8000
.
NZMD4000  BRANCH    F1,NZMD9000
          MOVE      ONE,F1
.
.         Try with blank hospital for multi hospital
.
          COMPARE   ONE,IBCNMHOS
          GOTO      NZMD9000 IF NOT EQUAL   * not multi hospital
.
          PACK      KEY29,SP3,PTHSDCLM,SP6,SP8,KEY9,SP70
          PACK      KEY37,SP3,PTHSDCLM,SP6,SP8,KEY9,KEY8,SP70
.
          GOTO      NZMD2000
.
NZMD8000  MOVE      ZERO,EXIT
          GOTO      NZMD9999
.
NZMD9000  CALL      CLNZMC00
          MOVE      ONE,EXIT
.
NZMD9999  RETURN
.
.------------------------------------------------------------
.         Get Misc.desc using the Hospital code of Pack item
.------------------------------------------------------------
NZPM0000  PACK      KEY29,DIM3,D3,SP6,SP8,KEY9,SP70
          PACK      KEY37,DIM3,D3,SP6,SP8,KEY9,KEY8,SP70
.
NZPM2000  MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RDNZMC11
          ELSE
            CALL      RDNZMCH1
          ENDIF
          IF        OVRCD=0
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      NZPM8000 IF NOT EQUAL       * No
          ENDIF
.
.         check for previous record
.
NZPM2200  MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RPNZMC11
          ELSE
            CALL      RPNZMCH1
          ENDIF
          BRANCH    OVRCD,NZPM9000
          PACK      KEY29A,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     KEY29,KEY29A
          GOTO      NZPM4000 IF NOT EQUAL
.
          MATCH     "1",NZMCACFL                * Inactive?
          GOTO      NZPM2200 IF EQUAL           * Yes
.
          MATCH     NZMCEFDT,KEY8           * effective date => serv. date ?
          GOTO      NZPM4000 IF LESS        * yes
.
          MATCH     SP70,NZMCEEDT
          IF        !@EQUAL
            MATCH     KEY8,NZMCEEDT
            GOTO      NZPM4000 IF LESS
          ENDIF
          GOTO      NZPM8000
.
NZPM4000  BRANCH    F1,NZPM9000
          MOVE      ONE,F1
.
.         Try with blank hospital for multi hospital
.
          COMPARE   ONE,IBCNMHOS
          GOTO      NZPM9000 IF NOT EQUAL   * not multi hospital
.
          PACK      KEY29,SP3,D3,SP6,SP8,KEY9,SP70
          PACK      KEY37,SP3,D3,SP6,SP8,KEY9,KEY8,SP70
          GOTO      NZPM2000
.
NZPM8000  MOVE      ONE,EXIT
          GOTO      NZPM9999
.
NZPM9000  MOVE      ZERO,EXIT
          GOTO      NZPM9999
.
NZPM9999  RETURN
+
.------------------------------------------------------------
. Exploding item calculated price. (Sum of default prices)
.------------------------------------------------------------
CALTOT00  MOVE      ZERO,TOTALAMT
.
          MATCH     "N",FILEFLAG
          GOTO      CALTOT10 IF EQUAL
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * Current
                          NZMCH005,NZMCH006,SP70                     * File
          CALL      RDNZMXC1
          COMPARE   ZERO,OVRCD
          GOTO      CALTOT20 IF EQUAL
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * Current
                          NZMCH005,NZMCH006,SP70                     * File
          CALL      RSNZMXC1
CALTOT05  CALL      RKNZMXC1
          BRANCH    OVRCD,CALTOT99
          GOTO      CALTOT20
.
CALTOT10  PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * New File
                          NZMCH005,NZMCH006,SP70
          CALL      RDNZMX11
          COMPARE   ZERO,OVRCD
          GOTO      CALTOT20 IF EQUAL
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004:       * New File
                          NZMCH005,NZMCH006,SP70
          CALL      RSNZMX11
CALTOT15  CALL      RKNZMX11                                         * New File
          BRANCH    OVRCD,CALTOT99
.
CALTOT20  MATCH     NZMCH001,NZMXHOSP            * hospital
          GOTO      CALTOT99 IF NOT EQUAL
.
          MATCH     NZMCH002,NZMXCLMC            * claim code
          GOTO      CALTOT99 IF NOT EQUAL
.
          MATCH     NZMCH003,NZMXCNTR            * health fund
          GOTO      CALTOT99 IF NOT EQUAL
.
          MATCH     NZMCH004,NZMXFTAB            * table
          GOTO      CALTOT99 IF NOT EQUAL
.
          MATCH     NZMCH005,NZMXMCHG            * misc charge
          GOTO      CALTOT99 IF NOT EQUAL
.
          MATCH     NZMCH006,NZMXEFDT            * effective date
          GOTO      CALTOT99 IF NOT EQUAL
.
          MOVE      NZMXHOSP,DIM3                * Hospital code
          MOVE      NZMXCLMC,D3
          MOVE      NZMXITMN,KEY9
          CALL      NZMD0000
.
          MOVE      ZERO,F3
          SQUEEZE   NZMXQNTY
          MOVE      NZMXQNTY,F3
          MULT      F3,NZMCPATP
          ADD       NZMCPATP,TOTALAMT           * Total calculated price
.
          MATCH     "N",FILEFLAG
          GOTO      CALTOT15 IF EQUAL
          GOTO      CALTOT05
.
CALTOT99  RETURN

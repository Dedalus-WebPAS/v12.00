.
.         INC       OUTBOAIO.INC
.
.         FILE  I/O REQUESTS FOR OUTPATIENTS SESSION BOOKING
.
.OVRCD  FORM            1             0=NOT OVER
.                                     1= OVER
.
.         NOTE:-
.                  RDAAAX  IS THE READ CALL ON FILE THEAAAX
.                  RDKAAAX  IS THE READKS CALL
.                  WRAAAX  IS THE WRITE CALL
.                  UPAAAX  IS THE UPDATE CALL
.                  DEAAAX  IS THE DELETE CALL
.
.KEY28    DIM       28
.KEY34    DIM       34
.KEY35    DIM       35
.KEY36    DIM       36
.
.       FIRST SESSIONS   I/O
.
RDABOKA1 MOVE      ZERO,OVRCD
         RESET     KEY28
         READ      OUTBOKA1,KEY28;ANS
         GOTO      OVERCOND IF OVER
         RETURN
.
RDSBOKA1 RESET     KEY28
         READ      OUTBOKA1,KEY28;;
         RETURN  
.
RDBOKA1  MOVE      ZERO,OVRCD
         RESET     KEY28
         READ      OUTBOKA1,KEY28;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                                  OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                                  DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                                  OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                                  DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
RLOTBOA1 MOVE      ZERO,OVRCD
         RESET     KEY28
         READL     OUTBOKA1,KEY28;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                                  OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                                  DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                                  OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                                  DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         GOTO      OVERLOCK IF LOCKED
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
UUOTBOA1 UNLOCK    OUTBOKA1
         RETURN  
.
RDKBOKA1 MOVE      ZERO,OVRCD
         READKS    OUTBOKA1;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
.
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
RDPBOKA1 MOVE      ZERO,OVRCD
         READKP    OUTBOKA1;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
.
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
WRBOKA1  MOVE      OBASLOT,DOBASLOT
         MOVE      OBASTAT,DOBASTAT
         MOVE      OBAOUTNO,DOBAOUTN
         MOVE      OTBARESV,DOTBARES
         MOVE      SP2,OBALOCK
         RESET     KEY28
         WRITE     OUTBOKA1,KEY28;KEY28:
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
.
         RETURN  
.
UPBOKA1  MOVE      OBASLOT,DOBASLOT
         MOVE      OBASTAT,DOBASTAT
         MOVE      OBAOUTNO,DOBAOUTN
         MOVE      OTBARESV,DOTBARES
         MOVE      SP2,OBALOCK
         UPDATE    OUTBOKA1;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
.
         RETURN
.
DEBOKA1  MOVE      ZERO,OVRCD
         RESET     KEY28
         DELETE    OUTBOKA1,KEY28
.
         RETURN
.
.       SECOND SESSIONS   I/O
.
RDSBOKA2 RESET     KEY35
         READ      OUTBOKA2,KEY35;;
         RETURN  
.
RDBOKA2  MOVE      ZERO,OVRCD
         RESET     KEY35
         READ      OUTBOKA2,KEY35;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                                  OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                                  DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                                  OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                                  DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.  
RDKBOKA2 MOVE      ZERO,OVRCD
         READKS    OUTBOKA2;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.  
RDPBOKA2 MOVE      ZERO,OVRCD
         READKP    OUTBOKA2;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
.       THIRD SESSIONS  FILE I/O
.
RDSBOKA3 RESET     KEY36
         READ      OUTBOKA3,KEY36;;
         RETURN
.
RDBOKA3  MOVE      ZERO,OVRCD
         RESET     KEY36
         READ      OUTBOKA3,KEY36;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                                  OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                                  DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                                  OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                                  DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
RDKBOKA3 MOVE      ZERO,OVRCD
         READKS    OUTBOKA3;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
RDPBOKA3 MOVE      ZERO,OVRCD
         READKP    OUTBOKA3;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
.
.       FOURTH SESSIONS  FILE I/O
.
RDSBOKA4 RESET     KEY35
         READ      OUTBOKA4,KEY35;;
         RETURN
.
RDBOKA4  MOVE      ZERO,OVRCD
         RESET     KEY35
         READ      OUTBOKA4,KEY35;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                                  OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                                  DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                                  OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                                  DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
RDKBOKA4 MOVE      ZERO,OVRCD
         READKS    OUTBOKA4;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
RDPBOKA4 MOVE      ZERO,OVRCD
         READKP    OUTBOKA4;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
.       FIFTH SESSIONS  FILE I/O
.
RDSBOKA5 RESET     KEY35
         READ      OUTBOKA5,KEY35;;
         RETURN
.
RDBOKA5  MOVE      ZERO,OVRCD
         RESET     KEY35
         READ      OUTBOKA5,KEY35;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                                  OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                                  DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                                  OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                                  DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
RDKBOKA5 MOVE      ZERO,OVRCD
         READKS    OUTBOKA5;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
RDPBOKA5 MOVE      ZERO,OVRCD
         READKP    OUTBOKA5;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
.
.      LOCK AND READ THE RECORD
.
RDLBOKA1 MOVE      PORT,CPORT
         RESET     KEY28
         READL     OUTBOKA1,KEY28;*69,OBALOCK
         GOTO      OVERLOCK IF LOCKED
         GOTO      OVERCOND IF OVER
.
.       **** WE HAVE PREVIOUSLY LOCKED THE PORT
.
         MATCH     SP2,OBALOCK
         GOTO      RL5BOKA1 IF EQUAL
.
         MATCH     CPORT,OBALOCK
         GOTO      RL5BOKA1 IF EQUAL
.
         UNLOCK    OUTBOKA1
         GOTO      OVERLOCK
.
.       **** RECORD IS LOCKED BY SOMEONE ELSE
.
RL5BOKA1 UPDATE    OUTBOKA1;*69,CPORT
         UNLOCK    OUTBOKA1
         GOTO      RDBOKA1
.
.      UNLOCK THE RECORD
.
ULBOKA1  RESET     KEY28
         READ      OUTBOKA1,KEY28;*69,OBALOCK
         RETURN    IF OVER
         UPDATE    OUTBOKA1;*69,SP2
         RETURN  
.
. audit io routines
.
ASOTBOA  RESET     KEY19
         READ      OUTAUDBA,KEY19;;
         RETURN  
.
AKOTBOA  MOVE      ZERO,OVRCD
         READKS    OUTAUDBA;OTBAAUDD,OTBAAUDT,OTBAAUDP,OTBAAUDR,OTBAAUDS:
                            OTBAAUDO,OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
.
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN  
.
AWOTBOA  MOVE      OBASLOT,DOBASLOT
         MOVE      OBASTAT,DOBASTAT
         MOVE      OBAOUTNO,DOBAOUTN
         MOVE      OTBARESV,DOTBARES
         MOVE      SP2,OBALOCK
         RESET     KEY19
         WRITE     OUTAUDBA,KEY19;KEY19,OTBAAUDS,OTBAAUDO:
                            OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         RETURN
.
ADOTBOA  MOVE      ZERO,OVRCD
         RESET     KEY19
         DELETE    OUTAUDBA,KEY19
.
         RETURN
.
AUOTBOA  MOVE      OBASLOT,DOBASLOT
         MOVE      OBASTAT,DOBASTAT
         MOVE      OBAOUTNO,DOBAOUTN
         MOVE      OTBARESV,DOTBARES
         MOVE      SP2,OBALOCK
         UPDATE    OUTAUDBA;OTBAAUDD,OTBAAUDT,OTBAAUDP,OTBAAUDR,OTBAAUDS:
                            OTBAAUDO,OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT: 
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         RETURN
.
.
.       SIXTH SESSIONS  FILE I/O
.
RDSBOKA6 RESET     KEY36
         READ      OUTBOKA6,KEY36;;
         RETURN
.
RDBOKA6  MOVE      ZERO,OVRCD
         RESET     KEY36
         READ      OUTBOKA6,KEY36;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT:
                                  OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                                  DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                                  OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                                  DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN
.
RDKBOKA6 MOVE      ZERO,OVRCD
         READKS    OUTBOKA6;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT:
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN
.
RDPBOKA6 MOVE      ZERO,OVRCD
         READKP    OUTBOKA6;OBASITE,OBACLIN,OBADATE,OBASTRT,DOBASLOT:
                            OBATIME,OBACTYP,OBAURNO,OBAVISIT,DOBAOUTN:
                            DOBASTAT,OBADAY,OBAEXSL,OBAFINST,OBALOCK:
                            OBAPXRAY,OBABKDTE,OBAPULL,OBASESST,OBADISCH:
                            DOTBARES,OBASPARA
         GOTO      OVERCOND IF OVER
         MOVE      DOBASLOT,OBASLOT
         MOVE      DOBASTAT,OBASTAT
         MOVE      DOBAOUTN,OBAOUTNO
         MOVE      ZERO,OTBARESV
         MOVE      DOTBARES,OTBARESV
         RETURN
.

.----------------------------------------------------------------------
. Program       : MEHDLVTM
.
. Function      : Output Mental Health Discharge to Leave Variables           
.
. Modifications :
.----------------------------------------------------------------------
.   V9.02.00  01/11/2002 Jill Habasque - Created
.             26/02/2008 J.Tan   CAR 156964
.                        Added Name of person escorting the patient
.----------------------------------------------------------------------
.
.
.------------------------------------------------------------
. Discharge to Leave Details 
.------------------------------------------------------------
MHDL0000  BRANCH    FLDITMNO,MHDL0100,MHDL0200,MHDL0300,MHDL0400,MHDL0500:
                             MHDL0600,MHDL0700,MHDL0800,MHDL0900,MHDL1000:
                             MHDL1100,MHDL1200,MHDL1300,MHDL1400,MHDL1500:
                             MHDL1600,MHDL1700,MHDL1800,MHDL1900,MHDL2000:
                             MHDL2100,MHDL2200,MHDL2300,MHDL2400,MHDL2500:
                             MHDL2600
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MHDL9999
.
MHDL0100  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          WRITE     HTMLFILE;LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO;
          GOTO      MHDL9999
.
MHDL0200  WRITE     HTMLFILE;MHDLADMN;
          GOTO      MHDL9999
.
MHDL0300  MATCH     SP70,MHDLADD1
          GOTO      MHDL9999 IF EQUAL
          WRITE     HTMLFILE;MHDLADD1;
          GOTO      MHDL9999
.
MHDL0400  MATCH     SP70,MHDLADD2
          GOTO      MHDL9999 IF EQUAL
          WRITE     HTMLFILE;MHDLADD2;
          GOTO      MHDL9999
.
MHDL0500  MATCH     SP70,MHDLSUBR
          GOTO      MHDL9999 IF EQUAL
          WRITE     HTMLFILE;MHDLSUBR; 
          GOTO      MHDL9999
.
MHDL0600  MATCH     SP70,MHDLADD4
          GOTO      MHDL9999 IF EQUAL
          WRITE     HTMLFILE;MHDLADD4; 
          GOTO      MHDL9999
.
MHDL0700  MATCH     SP70,MHDLPOST
          GOTO      MHDL9999 IF EQUAL
          WRITE     HTMLFILE;MHDLPOST; 
          GOTO      MHDL9999
.
MHDL0800  WRITE     HTMLFILE;MHDLSPR1; 
          GOTO      MHDL9999
.
MHDL0900  MOVE      "AY",CATEGORY
          PACK      CODE,MHDLACTY,SP70
          CALL      CODITM00
          GOTO      MHDL9999
.
MHDL1000  MOVE      "RE",CATEGORY
          PACK      CODE,MHDLREFT,SP70
          CALL      CODITM00
          GOTO      MHDL9999
.
MHDL1100  MOVE      "SW",CATEGORY
          PACK      CODE,MHDLSTAY,SP70
          CALL      CODITM00
          GOTO      MHDL9999
.
MHDL1200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MHDL1210
          WRITE     HTMLFILE;MHDLLDOM;
          GOTO      MHDL9999
.
MHDL1210  COMPARE   ONE,MHDLLDOM
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          COMPARE   TWO,MHDLLDOM
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MHDL9999
.
MHDL1300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MHDL1310
          WRITE     HTMLFILE;MHDLLGP;
          GOTO      MHDL9999
.
MHDL1310  COMPARE   ONE,MHDLLGP
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          COMPARE   TWO,MHDLLGP
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MHDL9999
.
MHDL1400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MHDL1410
          WRITE     HTMLFILE;MHDLTRST;
          GOTO      MHDL9999
.
MHDL1410  COMPARE   ONE,MHDLTRST
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          COMPARE   TWO,MHDLTRST
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MHDL9999
.
MHDL1500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MHDL1510
          WRITE     HTMLFILE;MHDLDOHN;
          GOTO      MHDL9999
.
MHDL1510  COMPARE   ONE,MHDLDOHN
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          COMPARE   TWO,MHDLDOHN
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MHDL9999
.
MHDL1600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MHDL1610
          WRITE     HTMLFILE;MHDLOUTP;
          GOTO      MHDL9999
.
MHDL1610  COMPARE   ONE,MHDLOUTP
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          COMPARE   TWO,MHDLOUTP
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MHDL9999
.
MHDL1700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MHDL1710
          WRITE     HTMLFILE;MHDLCSRG;
          GOTO      MHDL9999
.
MHDL1710  COMPARE   ONE,MHDLCSRG
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          COMPARE   TWO,MHDLCSRG
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MHDL9999
.
MHDL1800  MATCH     MHDLCSDT,SP70
          GOTO      MHDL9999 IF EQUAL
          UNPACK    MHDLCSDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      MHDL9999
.
MHDL1900  MOVE      "FU",CATEGORY
          PACK      CODE,MHDLCFUT,SP70
          CALL      CODITM00
          GOTO      MHDL9999
.
MHDL2000  MATCH     MHDLCFUD,SP70
          GOTO      MHDL9999 IF EQUAL
          UNPACK    MHDLCFUD,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      MHDL9999
.
MHDL2100  MOVE      "W5",CATEGORY
          PACK      CODE,MHDLUSR1,SP70
          CALL      CODITM00
          GOTO      MHDL9999
.
MHDL2200  MOVE      "W6",CATEGORY
          PACK      CODE,MHDLUSR2,SP70
          CALL      CODITM00
          GOTO      MHDL9999
.
MHDL2300  MOVE      "W7",CATEGORY
          PACK      CODE,MHDLUSR3,SP70
          CALL      CODITM00
          GOTO      MHDL9999
.
MHDL2400  MOVE      "W8",CATEGORY
          PACK      CODE,MHDLUSR4,SP70
          CALL      CODITM00
          GOTO      MHDL9999
.
MHDL2500  MOVE      "W9",CATEGORY
          PACK      CODE,MHDLUSR5,SP70
          CALL      CODITM00
          GOTO      MHDL9999
.
MHDL2600  MATCH     SP70,MHDLXCOR
          GOTO      MHDL9999 IF EQUAL
          WRITE     HTMLFILE;MHDLXCOR;
          GOTO      MHDL9999
.
MHDL9999  RETURN
+
.------------------------------------------------------------
. Clear cgi variables
.------------------------------------------------------------
CLRMDL00  MOVE      Z70,MEHDL001
          MOVE      Z70,MEHDL002
          MOVE      Z70,MEHDL003
          MOVE      Z70,MEHDL004
          MOVE      Z70,MEHDL005
          MOVE      Z70,MEHDL006
          MOVE      Z70,MEHDL007
          MOVE      Z70,MEHDL008
          MOVE      Z70,MEHDL009
          MOVE      Z70,MEHDL010
          MOVE      ZERO,MEHDL011
          MOVE      ZERO,MEHDL012
          MOVE      ZERO,MEHDL013
          MOVE      ZERO,MEHDL014
          MOVE      ZERO,MEHDL015
          MOVE      ZERO,MEHDL016
          MOVE      Z70,MEHDL017
          MOVE      Z70,MEHDL018
          MOVE      Z70,MEHDL019
          MOVE      Z70,MEHDL020
          MOVE      Z70,MEHDL021
          MOVE      Z70,MEHDL022
          MOVE      Z70,MEHDL023
          MOVE      Z70,MEHDL024
          MOVE      Z70,MEHDL025
.
CLRMDL99  RETURN
+
.------------------------------------------------------------
.   Set Parameters for mental health  discharge to leave table
.------------------------------------------------------------
SETMDL00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          BRANCH    F3,SETMDL01,SETMDL02,SETMDL03,SETMDL04,SETMDL05:
                       SETMDL06,SETMDL07,SETMDL08,SETMDL09,SETMDL10:
                       SETMDL11,SETMDL12,SETMDL13,SETMDL14,SETMDL15:
                       SETMDL16,SETMDL17,SETMDL18,SETMDL19,SETMDL20:
                       SETMDL21,SETMDL22,SETMDL23,SETMDL24,SETMDL25
.
          MOVE      ONE,EXIT
          GOTO      SETMDL99
.
SETMDL01  SQUEEZE   QRYDATA
          MOVE      QRYDATA,MEHDL001
          PACK      MEHDL001,MEHDL001,SP70
          GOTO      SETMDI99
.
SETMDL02  PACK      MEHDL002,QRYDATA,SP70
          GOTO      SETMDL99
.
SETMDL03  PACK      MEHDL003,QRYDATA,SP70
          GOTO      SETMDL99
.
SETMDL04  PACK      MEHDL004,QRYDATA,SP70
          GOTO      SETMDL99
.
SETMDL05  PACK      MEHDL005,QRYDATA,SP70
          GOTO      SETMDL99
.
SETMDL06  PACK      MEHDL006,QRYDATA,SP70
          GOTO      SETMDL99
.
SETMDL07  MOVE      QRYDATA,MEHDL007
          GOTO      SETMDL99
.
SETMDL08  MOVE      QRYDATA,MEHDL008
          GOTO      SETMDL99
.
SETMDL09  MOVE      QRYDATA,MEHDL009
          GOTO      SETMDL99
.
SETMDL10  MOVE      QRYDATA,MEHDL010
          GOTO      SETMDL99
.
SETMDL11  MOVE      QRYDATA,MEHDL011
          GOTO      SETMDL99
.
SETMDL12  MOVE      QRYDATA,MEHDL012
          GOTO      SETMDL99
.
SETMDL13  MOVE      QRYDATA,MEHDL013
          GOTO      SETMDL99
.
SETMDL14  MOVE      QRYDATA,MEHDL014
          GOTO      SETMDL99
.
SETMDL15  MOVE      QRYDATA,MEHDL015
          GOTO      SETMDL99
.
SETMDL16  MOVE      QRYDATA,MEHDL016
          GOTO      SETMDL99
.
SETMDL17  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MEHDL017,CCENT,CYEAR,CMON,CDAY
          GOTO      SETMDL99
.
SETMDL18  MOVE      QRYDATA,MEHDL018
          GOTO      SETMDL99
.
SETMDL19  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MEHDL019,CCENT,CYEAR,CMON,CDAY
          GOTO      SETMDL99
.
SETMDL20  MOVE      QRYDATA,MEHDL020
          GOTO      SETMDL99
.
SETMDL21  MOVE      QRYDATA,MEHDL021
          GOTO      SETMDL99
.
SETMDL22  MOVE      QRYDATA,MEHDL022
          GOTO      SETMDL99
.
SETMDL23  MOVE      QRYDATA,MEHDL023
          GOTO      SETMDL99
.
SETMDL24  MOVE      QRYDATA,MEHDL024
          GOTO      SETMDL99
.
SETMDL25  PACK      MEHDL025,QRYDATA,SP70
          GOTO      SETMDL99
SETMDL99  RETURN
.------------------------------------------------------------
.   Move cgi's into file variables               
.------------------------------------------------------------
.
MVDLV000  MATCH     Z70,MEHDL002
          IF        !@EQUAL
            MOVE      MEHDL002,MHDLADD1
          ENDIF
.
          MATCH     Z70,MEHDL003
          IF        !@EQUAL
            MOVE      MEHDL003,MHDLADD2
          ENDIF
.
          MATCH     Z70,MEHDL004
          IF        !@EQUAL
            MOVE      MEHDL004,MHDLSUBR
          ENDIF
.
          MATCH     Z70,MEHDL005
          IF        !@EQUAL
            MOVE      MEHDL005,MHDLADD4
          ENDIF
.
          MATCH     Z70,MEHDL006
          IF        !@EQUAL
            MOVE      MEHDL006,MHDLPOST
          ENDIF
.
          MATCH     Z70,MEHDL007
          IF        !@EQUAL
            MOVE      MEHDL007,MHDLSPR1
          ENDIF
.
          MATCH     Z70,MEHDL008
          IF        !@EQUAL
            MOVE      MEHDL008,MHDLACTY
          ENDIF
.
          MATCH     Z70,MEHDL009
          IF        !@EQUAL
            MOVE      MEHDL009,MHDLREFT
          ENDIF
.
          MATCH     Z70,MEHDL010
          IF        !@EQUAL
            MOVE      MEHDL010,MHDLSTAY
          ENDIF
.
          COMPARE   ZERO,MEHDL011
          IF        !@EQUAL
            MOVE      MEHDL011,MHDLLDOM
          ENDIF
.
          COMPARE   ZERO,MEHDL012
          IF        !@EQUAL
            MOVE      MEHDL012,MHDLLGP
          ENDIF
.
          COMPARE   ZERO,MEHDL013
          IF        !@EQUAL
            MOVE      MEHDL013,MHDLTRST
          ENDIF
.
          COMPARE   ZERO,MEHDL014
          IF        !@EQUAL
            MOVE      MEHDL014,MHDLDOHN
          ENDIF
.
          COMPARE   ZERO,MEHDL015
          IF        !@EQUAL
            MOVE      MEHDL015,MHDLOUTP
          ENDIF
.
          COMPARE   ZERO,MEHDL016
          IF        !@EQUAL
            MOVE      MEHDL016,MHDLCSRG
          ENDIF
.
          MATCH     Z70,MEHDL017
          IF        !@EQUAL
            MOVE      MEHDL017,MHDLCSDT
          ENDIF
.
          MATCH     Z70,MEHDL018
          IF        !@EQUAL
            MOVE      MEHDL018,MHDLCFUT
          ENDIF
.
          MATCH     Z70,MEHDL019
          IF        !@EQUAL
            MOVE      MEHDL019,MHDLCFUD
          ENDIF
.
          MATCH     Z70,MEHDL020 
          IF        !@EQUAL
            MOVE      MEHDL020,MHDLUSR1
          ENDIF
.
          MATCH     Z70,MEHDL021
          IF        !@EQUAL
            MOVE      MEHDL021,MHDLUSR2
          ENDIF
.
          MATCH     Z70,MEHDL022
          IF        !@EQUAL
            MOVE      MEHDL022,MHDLUSR3
          ENDIF
.
          MATCH     Z70,MEHDL023
          IF        !@EQUAL
            MOVE      MEHDL023,MHDLUSR4
          ENDIF
.
          MATCH     Z70,MEHDL024
          IF        !@EQUAL
            MOVE      MEHDL024,MHDLUSR5
          ENDIF
.
          MATCH     Z70,MEHDL025
          IF        !@EQUAL
            MOVE      MEHDL025,MHDLXCOR
          ENDIF
.
MVDLV999  RETURN                  

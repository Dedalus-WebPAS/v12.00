. *----------------------------------------------------------------------
. * Include Name  :   MLTOLNTM.PBL
. *
. * Function      :   Overdue Leave Notifications CGI Variables Functions
. *
. * V11.02.01 07/06/2021  Ebon Clements     TSK 0900650
. *                       Added All description to ward tag - MLOL0020
. * V11.01.01 27/05/2021  Ebon Clements     TSK 0900650
. *                       Changed MLOLN004 to a DIM 4
. * V11.01.00 13/05/2021  Ebon Clements     TSK 0900650
. *                       Created Include
. *----------------------------------------------------------------------
.------------------------------------------------------------------------
. Clear CGI variables for overdue leave notifications
.------------------------------------------------------------------------
CLMLOL00  MOVE      Z70,MLOLN001
          MOVE      Z70,MLOLN002
          MOVE      Z70,MLOLN003
          MOVE      Z70,MLOLN004
          MOVE      Z70,MLOLN005
          MOVE      Z70,MLOLN006
          MOVE      Z70,MLOLN007
          MOVE      Z70,MLOLN008
          MOVE      Z70,MLOLN009
          MOVE      Z70,MLOLN010
          MOVE      Z70,MLOLN011
          MOVE      Z70,MLOLN012
          MOVE      Z70,MLOLN013
          MOVE      Z70,MLOLN014
          MOVE      Z70,MLOLN015
          MOVE      Z70,MLOLN016
          MOVE      Z70,MLOLN017
.
CLMLOL99  RETURN
.------------------------------------------------------------------------
. Tags for overdue leave notifications
. ------------------------------------------------------------------------
MLOL0000  BRANCH    FLDITMNO,MLOL0010,MLOL0020,MLOL0030,MLOL0040,MLOL0050:
                             MLOL0060,MLOL0070,MLOL0080,MLOL0090,MLOL0100:
                             MLOL0110,MLOL0120,MLOL0130,MLOL0140,MLOL0150:
                             MLOL0160,MLOL0170,MLOL0180,MLOL0190,MLOL0200:
                             MLOL0210,MLOL0220,MLOL0230

          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MLOL9999
.
MLOL0010  UNPACK    DIM127,D1,KEY1,DIM127        * Hospital
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLOL0015
.
          PACK      KEY3,MLOLHOSP,SP70
          CALL      RDPTHSP1
          IF        OVRCD=1
            MOVE      MLOLHOSP,PTHSNAME
          ENDIF
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      MLOL9999

MLOL0015  WRITE     HTMLFILE;MLOLHOSP;         
          GOTO      MLOL9999
.
MLOL0020  UNPACK    DIM127,D1,KEY1,DIM127        * Ward
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLOL0025
.
          MATCH     SP70,MLOLWARD                * All Wards
          IF        @EQUAL
            WRITE     HTMLFILE;"All";
            GOTO      MLOL9999
          ENDIF
.
          PACK      KEY6,MLOLWARD,SP70
          CALL      RDWARD1
          IF        OVRCD=1
            MOVE      MLOLWARD,WBDESC
          ENDIF
          WRITE     HTMLFILE;WBDESC;
          GOTO      MLOL9999

MLOL0025  WRITE     HTMLFILE;MLOLWARD;
          GOTO      MLOL9999
.
MLOL0030  MOVE      "TL",CATEGORY                * Type of Leave (Cat TL)
          MOVE      MLOLLTYP,CODE
          CALL      CODITM00
          GOTO      MLOL9999
.
MLOL0040  WRITE     HTMLFILE;MLOLOMIN;           * Overdue Minutes
          GOTO      MLOL9999
.
MLOL0050  UNPACK    DIM127,D1,KEY1,DIM127        * Greater than Overdue Minutes
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLOL0055
.
          MATCH     "1",MLOLGOVM
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MLOL9999
.
MLOL0055  WRITE     HTMLFILE;MLOLGOVM;           
          GOTO      MLOL9999
.
MLOL0060  UNPACK    DIM127,D1,KEY1,DIM127        * SMS to Send
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLOL0065
.
          PACK      KEY6,MLOLSMSM,SP2,ZERO,SP70
          CALL      RDPTLET1
          IF        OVRCD=1
            MOVE      KEY6,PTLETEXT
          ENDIF
          WRITE     HTMLFILE;PTLETEXT;
          GOTO      MLOL9999
.
MLOL0065  WRITE     HTMLFILE;MLOLSMSM;
          GOTO      MLOL9999
.
MLOL0070  WRITE     HTMLFILE;MLOLREMN;           * Reminder Number
          GOTO      MLOL9999
.
MLOL0080  UNPACK    DIM127,D1,KEY1,DIM127        * Send to Patient and Carer   
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLOL0085
.
          MATCH     "1",MLOLSNPC
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MLOL9999
.
MLOL0085  WRITE     HTMLFILE;MLOLSNPC; 
          GOTO      MLOL9999
.
MLOL0090  UNPACK    DIM127,D1,KEY1,DIM127        * Send to Ward Staff
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLOL0095
.
          MATCH     "1",MLOLSTWS
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MLOL9999
.
MLOL0095  WRITE     HTMLFILE;MLOLSTWS;
          GOTO      MLOL9999
.
MLOL0100  WRITE     HTMLFILE;MLOLWSMN;           * Ward Staff Mobile Number
          GOTO      MLOL9999
.
MLOL0110  UNPACK    DIM127,D1,KEY1,DIM127        * Send to Supervisor
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLOL0115
.
          MATCH     "1",MLOLSNDS
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MLOL9999
.
MLOL0115  WRITE     HTMLFILE;MLOLSNDS; 
          GOTO      MLOL9999
.
MLOL0120  WRITE     HTMLFILE;MLOLSPMN;           * Supervisor Mobile Number
          GOTO      MLOL9999
.
MLOL0130  UNPACK    DIM127,D1,KEY1,DIM127        * Send to Manager
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLOL0135
.
          MATCH     "1",MLOLSNDM
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MLOL9999
.
MLOL0135  WRITE     HTMLFILE;MLOLSNDM;
          GOTO      MLOL9999
.
MLOL0140  WRITE     HTMLFILE;MLOLMAMN;           * Manager Mobile Number 
          GOTO      MLOL9999
.
MLOL0150  UNPACK    DIM127,D1,KEY1,DIM127        * Send to Other
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLOL0155
.
          MATCH     "1",MLOLSNDO
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
.
MLOL0155  WRITE     HTMLFILE;MLOLSNDO;
          GOTO      MLOL9999
.
MLOL0160  WRITE     HTMLFILE;MLOLOTMN;           * Other Mobile Number
          GOTO      MLOL9999
.
MLOL0170  UNPACK    DIM127,D1,KEY1,DIM127        * Record Inactive
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLOL0175
.
          MATCH     "1",MLOLIACT
          IF        @EQUAL
            WRITE     HTMLFILE;"Inactive";
          ELSE
            WRITE     HTMLFILE;"Active";
          ENDIF
.
MLOL0175  WRITE     HTMLFILE;MLOLIACT;
          GOTO      MLOL9999
.
MLOL0180  MATCH     MLOLCDAT,SP70                * Date Created
          GOTO      MLOL9999 IF EQUAL
.
          UNPACK    MLOLCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR; 
          GOTO      MLOL9999
.
MLOL0190  WRITE     HTMLFILE;MLOLCTIM;           * Time Created
          GOTO      MLOL9999
.
MLOL0200  MATCH     SP70,MLOLCUID                * Created By
          GOTO      MLOL9999 IF EQUAL
.
          PACK      KEY10,MLOLCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      MLOLCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      MLOL9999
.
MLOL0210  MATCH     MLOLUDAT,SP70                * Date Updated
          GOTO      MLOL9999 IF EQUAL
.
          UNPACK    MLOLUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;

          GOTO      MLOL9999
.
MLOL0220  WRITE     HTMLFILE;MLOLUTIM;           * Time Updated
          GOTO      MLOL9999
.
MLOL0230  MATCH     SP70,MLOLUUID                * Updated By
          GOTO      MLOL9999 IF EQUAL
.
          PACK      KEY10,MLOLUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      MLOLUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      MLOL9999
.
MLOL9999  RETURN
.
.------------------------------------------------------------------------
. Set CGI variables for overdue leave notifications
. ------------------------------------------------------------------------
SPOLN000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPOLN001,SPOLN002,SPOLN003,SPOLN004,SPOLN005:
                       SPOLN006,SPOLN007,SPOLN008,SPOLN009,SPOLN010:
                       SPOLN011,SPOLN012,SPOLN013,SPOLN014,SPOLN015:
                       SPOLN016,SPOLN017
.
          MOVE      ONE,EXIT
          GOTO      SPOLN999
.
SPOLN001  PACK      MLOLN001,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN002  PACK      MLOLN002,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN003  PACK      MLOLN003,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN004  SQUEEZE   QRYDATA
          MOVE      ZERO,F4
          MOVE      QRYDATA,F4
          MOVE      F4,MLOLN004
          GOTO      SPOLN999
.
SPOLN005  SQUEEZE   QRYDATA
          MOVE      QRYDATA,MLOLN005
          PACK      MLOLN005,MLOLN005,SP70
          GOTO      SPOLN999
.
SPOLN006  SQUEEZE   QRYDATA
          MOVE      ZERO,F3
          MOVE      QRYDATA,F3
          MOVE      F3,MLOLN006
          GOTO      SPOLN999
.
SPOLN007  PACK      MLOLN007,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN008  PACK      MLOLN008,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN009  PACK      MLOLN009,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN010  PACK      MLOLN010,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN011  PACK      MLOLN011,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN012  PACK      MLOLN012,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN013  PACK      MLOLN013,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN014  PACK      MLOLN014,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN015  PACK      MLOLN015,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN016  PACK      MLOLN016,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN017  PACK      MLOLN017,QRYDATA,SP70
          GOTO      SPOLN999
.
SPOLN999  RETURN
.
.------------------------------------------------------------------------
. Update file variables for overdue leave notifications
. ------------------------------------------------------------------------
MVMLOL00  MATCH     MLOLN001,Z70
          IF        !@EQUAL
            MOVE      MLOLN001,MLOLHOSP
          ENDIF
.
          MATCH     MLOLN002,Z70
          IF        !@EQUAL
            MOVE      MLOLN002,MLOLWARD
          ENDIF
.
          MATCH     MLOLN003,Z70
          IF        !@EQUAL
            MOVE      MLOLN003,MLOLLTYP
          ENDIF
.
          MATCH     MLOLN004,Z70
          IF        !@EQUAL
            MOVE      MLOLN004,MLOLOMIN
          ENDIF
.
          MATCH     MLOLN005,Z70
          IF        !@EQUAL
            MOVE      MLOLN005,MLOLGOVM
          ENDIF
.
          MATCH     MLOLN006,Z70
          IF        !@EQUAL
            MOVE      MLOLN006,MLOLSMSM
          ENDIF
.
          MATCH     MLOLN007,Z70
          IF        !@EQUAL
            MOVE      MLOLN007,MLOLREMN
          ENDIF
.
          MATCH     MLOLN008,Z70
          IF        !@EQUAL
            MOVE      MLOLN008,MLOLSNPC
          ENDIF
.
          MATCH     MLOLN009,Z70
          IF        !@EQUAL
            MOVE      MLOLN009,MLOLSTWS
          ENDIF
.
          MATCH     MLOLN010,Z70
          IF        !@EQUAL
            MOVE      MLOLN010,MLOLWSMN
          ENDIF
.
          MATCH     MLOLN011,Z70
          IF        !@EQUAL
            MOVE      MLOLN011,MLOLSNDS
          ENDIF
.
          MATCH     MLOLN012,Z70
          IF        !@EQUAL
            MOVE      MLOLN012,MLOLSPMN
          ENDIF
.
          MATCH     MLOLN013,Z70
          IF        !@EQUAL
            MOVE      MLOLN013,MLOLSNDM
          ENDIF
.
          MATCH     MLOLN014,Z70
          IF        !@EQUAL
            MOVE      MLOLN014,MLOLMAMN
          ENDIF
.
          MATCH     MLOLN015,Z70
          IF        !@EQUAL
            MOVE      MLOLN015,MLOLSNDO
          ENDIF
.
          MATCH     MLOLN016,Z70
          IF        !@EQUAL
            MOVE      MLOLN016,MLOLOTMN
          ENDIF
.
          MATCH     MLOLN017,Z70
          IF        !@EQUAL
            MOVE      MLOLN017,MLOLIACT
          ENDIF
.
MVMLOL99  RETURN

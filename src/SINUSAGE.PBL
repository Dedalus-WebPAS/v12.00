.------------------------------------------------------------
. V9.04.01 11.04.2005 Peter Vela CAR 59696
.          Changed commodity group from DIM 5 to DIM 6
. VF.09.00 09.11.2000 Charles Handaya
.          Modified for sincchaf change
.------------------------------------------------------------
. VF.00.00 05.11.1998 Sandra Barcham
.          Year 2000 compliance
.------------------------------------------------------------
.
.  Include  file - SINUSAGE.PBL Update Usage Files
.  NOTE : Any changes should also be made to FIXUSAGE.PBL for FIXSIN.PBL
.
.
.  Usage File Update
.  -----------------
.  SINCCBFD & IO   Cost Centre Usage
.  SINCCEFD & IO   Cost Centre Usage by Commodity
.  SINCCFFD & IO   Cost Centre Usage by Product Group
.  SINCCGFD & IO   Cost Centre Usage by Catalog
.  SINCCHFD & IO   Supplied Stock to Cost Centres
.  SINCGBFD & IO   Commodity Usage
.  SINCIHFD & IO   Catalog Usage 
.  SINCIIFD & IO   Catalog Expiry Dates
.  SINPERFD & IO   Period Setup
.  SINSIIFD & IO   Catalog Expiry Dates
.  SINSUAFD & IO   Product Group Masterfile
.  SINSUBFD & IO   Product Group Usage
.---------------------------------------------------
.  Required Input
.  --------------
.  Record Read from the SINCIA file (Catalog)
.  Record Read from the SINCIE file (Catalog/Warehouse)
.  Record Read from the SINCST file (Cost Centre)
.  Record Read from the SINSUA file (Product Group)
.  Current Period in SIPEYEAR and SIPEPER
.  Amount   of Usage Adjustment SIUSCST
.  Quantity of Usage Adjustment SIUSQTY
.
.  Files Required to be Open
.  ------------------------- 
.  SINCCBA1
.  SINCCEA1
.  SINCCFA1
.  SINCCGA1
.  SINCCHA1
.  SINCGBA1
.  SINCIHA1
.  SINCIIA1
.  SINSUAA1
.  SINSUBA1
.
.  Field Used Update
.  -----------------
.  SINTMPDF/INC - Temporary Variables
.  SIIASUB  - Product Group
.  SISACOMM - Commodity Group
.  SIIACAT  - Catalog
.  SIIEWAR  - Warehouse
.  SICACODE - Cost Centre
.  SIPEYEAR - Year
.  SIPEPER  - Period
.
.---------------------------------------------------
SINUSAGE   PACK     KEY5,SIIASUB,SP70
           CALL     RDSISA1
           IF       OVRCD=1
             MOVE     SP70,SISACOMM
           ENDIF
           PACK     KEY6,SIPEYEAR,SIPEPER,SP70
           REP      " 0",KEY6
.
. Cost Centre
.----------------
SINUSA10   PACK     KEY11,SICACODE,KEY6,SP70
           UNPACK   KEY11,SICBCST,SICBDAT
           CALL     RLSICB1
           BRANCH   OVRCD,SINUSA15,SINUSA10
           ADD      SIUSCST,SICBAMT
           CALL     UPSICB1
           CALL     UUSICB1
           GOTO     SINUSA20
.
SINUSA15   MOVE     SIUSCST,SICBAMT
           MOVE     ZERO,SICBBUD
           CALL     WRSICB1
.
. Cost Centre by Commodity
.----------------------------
SINUSA20   PACK     KEY17,SICACODE,KEY6,SISACOMM,SP70                  *C-59696
           UNPACK   KEY17,SICECST,SICEDAT,SICECOM                      *C-59696
           CALL     RLSICE1
           BRANCH   OVRCD,SINUSA25,SINUSA20
           ADD      SIUSCST,SICEAMT
           CALL     UPSICE1
           CALL     UUSICE1
           GOTO     SINUSA30
.
SINUSA25   MOVE     SIUSCST,SICEAMT
           MOVE     ZERO,SICEBUD
           CALL     WRSICE1
.
. Cost Centre by Product Group
.-------------------------------
SINUSA30   PACK     KEY16,SICACODE,KEY6,SIIASUB,SP70
           UNPACK   KEY16,SICFCST,SICFDAT,SICFSUB
           CALL     RLSICF1
           BRANCH   OVRCD,SINUSA35,SINUSA30
           ADD      SIUSCST,SICFAMT
           CALL     UPSICF1
           CALL     UUSICF1
           GOTO     SINUSA40
.
SINUSA35   MOVE     SIUSCST,SICFAMT
           MOVE     ZERO,SICFBUD
           CALL     WRSICF1
.
. Commodity
.---------------------------
SINUSA40   PACK     KEY12,SISACOMM,KEY6,SP70                           *C-59696
           UNPACK   KEY12,SIGBCOM,SIGBDAT                              *C-59696
           CALL     RLSIGB1
           BRANCH   OVRCD,SINUSA45,SINUSA40
           ADD      SIUSCST,SIGBUAM
           CALL     UPSIGB1
           CALL     UUSIGB1
           GOTO     SINUSA50
.
SINUSA45   MOVE     SIUSCST,SIGBUAM
           MOVE     ZERO,SIGBUBD
           MOVE     ZERO,SIGBPAM
           MOVE     ZERO,SIGBPBD
           MOVE     ZERO,SIGBRAM
           MOVE     ZERO,SIGBRBD
           MOVE     SP70,SIGBSPA
           CALL     WRSIGB1
.
. Product Group
.---------------------------
SINUSA50   PACK     KEY11,SIIASUB,KEY6,SP70
           UNPACK   KEY11,SISBSUB,SISBDAT
           CALL     RLSISB1
           BRANCH   OVRCD,SINUSA55,SINUSA50
           ADD      SIUSCST,SISBUAM
           CALL     UPSISB1
           CALL     UUSISB1
           GOTO     SINUSA60
.
SINUSA55   MOVE     SIUSCST,SISBUAM
           MOVE     ZERO,SISBUBD
           MOVE     ZERO,SISBPAM
           MOVE     ZERO,SISBPBD
           MOVE     ZERO,SISBRAM
           MOVE     ZERO,SISBRBD
           MOVE     SP70,SISBSPA
           CALL     WRSISB1
.
. Catalog/Warehouse Usage
.---------------------------
SINUSA60   PACK     KEY18,SIIACAT,SIIEWAR,KEY6,SP70
           UNPACK   KEY18,SIIHCAT,SIIHWAR,SIIHDAT
           CALL     RLSIIH1
           BRANCH   OVRCD,SINUSA65,SINUSA60
           ADD      SIUSCST,SIIHUAM
           ADD      SIUSQTY,SIIHUQT
           CALL     UPSIIH1
           CALL     UUSIIH1
           GOTO     SINUSA70
.
SINUSA65   MOVE     SIUSCST,SIIHUAM
           MOVE     SIUSQTY,SIIHUQT
           MOVE     ZERO,SIIHPQT
           MOVE     ZERO,SIIHPAM
           MOVE     ZERO,SIIHRQT
           MOVE     ZERO,SIIHRAM
           MOVE     SP70,SIIHSPA
           CALL     WRSIIH1
.
. Cost Centre Catalog Usage
.---------------------------
SINUSA70   PACK     KEY28,SICACODE,SIIACAT,SIIEWAR,KEY6,SIIASUB,SP70
           UNPACK   KEY28,SICHCST,SICHCAT,SICHWAR,SICHDAT,SICHSUB
           CALL     RLSICH1
           BRANCH   OVRCD,SINUSA75,SINUSA80
           ADD      SIUSCST,SICHUAM
           ADD      SIUSQTY,SICHUQT
           CALL     UPSICH1
           CALL     UUSICH1
           GOTO     SINUSA80
.
SINUSA75   MOVE     SIUSCST,SICHUAM
           MOVE     SIUSQTY,SICHUQT
           MOVE     SP70,SICHSPA
           CALL     WRSICH1
.
. Catalog Expiry Dates
.----------------------
SINUSA80   BRANCH   SIIANON,SINUSA99         * No Warehouse for non-stock
.
           PACK     KEY27,SIIEWAR,SIIACAT,SP70
           PACK     KEY12,SIIEWAR,SIIACAT,SP70
           MOVE     SIUSQTY,ATOTAL01
.
           WHILE    ATOTAL01 > 0
             CALL     RSSIII1
             CALL     RKSIII1
             BRANCH   OVRCD,SINUSA90
             PACK     KEY27,SIIIWAR,SIIICAT,SIIIPUR,SIIIDAT,SP70
             MATCH    KEY27,KEY12
             GOTO     SINUSA90 IF NOT EQUAL
.
             ADD      ATOTAL01,SIIIQI
             ASSIGN   SIIIQI-SIIIQR,ATOTAL01
             IF       ATOTAL01 < 0
               CALL     UPSIII1
             ELSE
               CALL     DESIII1
             ENDIF
           DO
.
SINUSA90
.
SINUSA99  RETURN

.------------------------------------------------------------------------------ 
. Program       : PATWEB78
.
. Function      : Patient Admission Maintenance 
.
. Modifications1: 
.------------------------------------------------------------------------------
. V12.00.05 17/09/2025 Bella Turco       TSK 0966761
.           Changed Reason for Change to display long desc Cat RV in CASV7000
. V12.00.04 23/06/2025 PJ Le Febour      TSK 0962168
.           CASV7000 added MOVE SP70,TDESC - initialize description         
. V12.00.03 16/06/2025 J.Tan             TSK 0961932
.           Recompiled for WEBDINVS - Moved back SAVEND to FORM3
. V12.00.02 19/05/2025  J.Tan          TSK 0955096
.           Added alpanumeric visit number generation
. V12.00.01 12/05/2025 J.Tan           TSK 0960349
.           Recompiled for PMSFESTM - Fixed GST amount for HEA Fees Estimate
. V11.05.08 01/05/2025  Peter Vela    TSK 0960164
.           Recompiled for CLWEBOMF - Fixed Spare variable
. V11.05.07 10/04/2025  J.Tan         TSK 0953687
.           Recompiled for PMSFESTM - SJOG IFC GST for Uninsured
. V11.05.06 04/03/2025  Bella Turco   TSK 0946534
.           New report no 16 for Casemix Verification Audit CVAU0000         
. V11.05.05 19/02/2025  J.Tan         TSK 0953687
.           Recompiled for PMSFESTM - SJOG IFC GST total for Patient/Fund Rebate
. V11.05.04 19/12/2024 J.Tan           TSK 0955163
.           Recompiled for FEESESTM - DVA concession card (dvacolor)
. V11.05.03 03/12/2024  J.Tan         TSK 0953918
.           Recompiled for PMSFESTM - fixed HEA Total Exp.LOS
. V11.05.02 25/11/2024  J.Tan         TSK 0953687
.           Recompiled for PMSFESTM - HEA IFC GST total for Patient/Fund Rebate 
. V11.05.01 22/11/2024  J.Tan         TSK 0953918
.           Fixed HEA IFC Misc.Item
. V11.04.29 20/11/2024  J.Tan         TSK 0953918
.           Recompiled for PMSELITM -  added tag for HEA IFC Misc.Item amount
. V11.04.28 28/10/2024 Alina Bhari     TSK 0948172
.           Recompiled for FEESESTM
. V11.04.27 23/10/2024  J.Tan          TSK 0942917
.           Recompiled for FEESESTM - SJOG IFC Adm.type for Using Basic cover
. V11.04.26 15/10/2024  J.Tan          TSK 0951331
.           Added Misc.item to HEA IFC Eligibility Check
. V11.04.25 03/10/2024  J.Tan          TSK 0942917
.           Mod to set item type for SJOG IFC (SITY0000)
. V11.04.24 02/10/2024  J.Tan          TSK 0942917
.           Mod UPDATEST for SJOG IFC
. V11.04.23 25/09/2024  J.Tan          TSK 0942917
.           Recompiled for FEESEST - Fixed SJOG IFC keyin amount Misc.item
. V11.04.22 19/09/2024  Nikitha B      TSK 0947406
.           Added ACUTTYPE = 3 to check for GEM episodes  at CKFADT00 and 
.           CKFDDT00 to allow entering Func Asses Date within 7 days.
. V11.04.21 18/09/2024  J.Tan          TSK 0942917
.           Fixed printing SJOG IFC with MBS from Booking
. V11.04.20 13/09/2024  J.Tan          TSK 0951465
.           Mod onload processing GFEH0000 for Eligibility Check template only
. V11.04.19 04/09/2024 Sunny           TSK 0951084
.           Commented PTCRC005 in CRSCON40
.           02/09/2024  Ebon Clements  TSK 0950081
.           Replaced RKWBELF2 with RPWBELF2 to read the latest record of 
.           webelfaf at GEWF1000
. V11.04.18 29/08/2024  Nikitha B      TSK 0950081
.           Replaced RKPMELF2 with RPPMELF2 to read the latest record of 
.           pmselfaf at GELF1000
. V11.04.17 21/08/2024  J.Tan          TSK 0942917
.           Recompiled for PMSFESTM - fixed SJOG IFC
. V11.04.16 30/07/2024  J.Tan          TSK 0942917
.           Recompiled for PMSFESTM - changes for SJOG Fees Estimate(PrivateBed)
. V11.04.15 28/06/2024  J.Tan          TSK 0924648
.           Recompiled for FEESESTM - changes for SJOG IFC Eligibility check
. V11.04.14 13/05/2024 J.Tan           TSK 0946690
.           Mod to squeeze field for  PLanned Length of Stay (PTELF012)
. V11.04.13 21/03/2024 Ebon Clements   TSK 0911338
.           Added VIC FIM date edits to allow 7 days prior and after discharge
.           CKFADT00 CKFDDT00
. V11.04.12 15/03/2024  PJ Le Febour   TSK 0929044e
.           update WBOCCUID WBOCCDTE WBOCCTIM before call WRWBOEC1
.           EOEW0000 backout changes upd of weboecaf WBOCCUID WBOCUTIM
. V11.04.11 13/03/2024  J.Tan          TSK 0919335
.           Mod for HF history 
. V11.04.10 01/03/2024  Alina Bhari    TSK 0929004 
.           Correctly displayed the table sort date in OEC List for Free Format
.           -FFTS0000                                                          
. V11.04.09 01/03/2024  Alina Bhari    TSK 0929004 
.           Added impairment code description -TRDE3400,PMSIMPIO,PMSIMPFD
.           Calculated valid match on the AN-SNAP Auto Classification based
.           on impairment code                                             
.           -SETPAR00,PMSSNCFD,PMSSNCIO,VALDSDAT,VALDICDE,AACC0000           
. V11.04.08 20/01/2024  PJ Le Febour   TSK 0929044d 
.           SEWOEC00 - update WBOCCUID with USERID  
.           update WBOCUUID WBOCUDTE WBOCUTIM before call WRWBOEC1
. V11.04.07 19/01/2024  PJ Le Febour   TSK 0929044c 
.           OECWR100 - retrieve display UserId Created or Updated OEC
.           EOEW0400 - retrieve display UserID Created or Updated EMR OEC
. V11.04.06 29/01/2024  Jacob Jackson  TSK 0919335
.           Add new local variable and recompile for GETTFEES
. V11.04.05 09/01/2024 PJ Le Febour TSK 0929044a
.           OECWR000 added write WBOCCUID WBOCUUID
.           FFLNWS00 added write WBOCCUID WBOCUUID
. V11.04.04 22/12/2023 Alina Bhari  TSK 0919562
.           Added OEC search by date.                                  
.           Added ability to table sort for all the table field        
.           Added Claim Type in OEC free formate list                  
.           PROFLD93,PROFLD94,OECD0000,FFTS0000,FFLNWS00,TBSRTFLG,LOOPCNTR
. V11.04.03 21/12/2023 J.Tan    TSK 0931613
.           Mod UPDTRE00 to update AN SNAP/Version (PTRDE025/PTRDE026)
. V11.04.02 22/11/2023 J.Tan    TSK 0939335
.           Recompiled for FEESESTM - mod validating misc.item to check for date
. V11.04.01 21/11/2023 J.Tan    TSK 0940129
.           Recompiled for FEESESTM - SJOG suggested class. from hightest mbs
. V11.03.13 15/11/2023  Don Nguyen     TSK 0917199
.           Added tag processing for eAdmission number (EXTR3100)
. V11.03.12 10/08/2023  Bella Turco    TSK 0936160
.           Changed MATCH AFNDMM,PTMIS015 to PMVXFNDM & changed PTMIS015 from 
.           DIM 10 to 19 to fix Membership No saving issue (UCOD3000)
. V11.03.11 09/08/2023  J.Tan          TSK 0935667
.           Recompiled for FEESESTM - added trap prior write to pmsfesaf
. V11.03.10 25/07/2023 Thanh T        TSK 0930508
.           Added VXTF0000 section 
. V11.03.09 04/07/2023  J.Tan          TSK 0934653
.           Recompiled for PMSFESTM - Usebasic flag for SJOG IFC
. V11.03.08 26/06/2023  J.Tan          TSK 0934216
.           Recompiled for PMSFESTM - Health fund table issue
. V11.03.07 15/05/2023 J.Tan    TSK 0926482
.           Recompiled for FEESESTM - HEA Use basic cover
. V11.03.06 08/03/2023 J.Tan    TSK 0926482
.           Recompiled for FEESESTM - HEA Use basic cover
.           08/03/2023 J.Tan    TSK 0929361
.           Recompiled for FEESESTM - checking ovrcd=1 prior writing to pmsfedaf
. V11.03.05 03/02/2023 J.Tan    TSK 0926482
.           Recompiled for PMSFESTM - Use basic for HEA Fees Estimate
. V11.03.04 12/12/2022 J.Tan    TSK 0926482
.           Recompiled PMSFESTM - Fixed HEA Fees Estimate (Default Cover rate)
. V11.03.03 09.12.2022 DA Sarkies     TSK 0927204
.           Moved DB update to within in check
. V11.03.02 06/12/2022 J.Tan    TSK 0926482
.           Recompiled PMSFESTM - Fixed HEA Fees Estimate (Default Cover rate)
. V11.03.01 21/11/2022 J.Tan    TSK 0900069
.           Recompiled PMSFESTM for HEA Fees Estimate
. V11.02.31 07/11/2022 J.Tan    TSK 0925716
.           Recompiled for PMSFESTM - SJOG Fees Estimate
. V11.02.30 30.11.2022 DA Sarkies     TSK 0925888
.           Changed the size of the DFrames to 550
. V11.02.29 31.10.2022 DA Sarkies     TSK 0925888
.           Reduced the size of the DFrames that are opened in OEC request and
.           response lists
. V11.02.28 28.10.2022 DA Sarkies     TSK 0925888
.           Reduced the size of the DFrames that are opened in OEC request and
.           response lists
. V11.02.27 26/10/2022 Jacob Jackson  TSK 0921113
.           Show delete button for claims that have a '3040' error for the
.           OEC list
. V11.02.26 04/10/2022 J.Tan    TSK 0900069
.           Recompiled for PMSFEDTM
. V11.02.25 16/09/2022 Jill Parkinson TSK 0924737
.           Recompiled for PMSFESTM - removed use of ward for sjog to determine
.           bed type.  Will always use private for estimates
. V11.02.24 14/09/2022 Jill Parkinson TSK 0924680
.           Added clear of PMFDCMN1, PMFDCMN2,PMFDCMN3 and PMFDCMN4
.           Added call to CLRAEL00 at ELGB1300PMFDCMN3 and PMFDCMN4
. V11.02.23 07/09/2022 J.Tan    TSK 0924383
.           Recompiled for FEESESTM - mod to read Admission file
. V11.02.22 05/09/2022 J.Tan    TSK 0924085
.           Recompiled for FEESESTM - SJOG GST Fees Estimate
. V11.02.21 11/08/2022 Bella Turco     TSK 0906597
.           Added PTRDE025 & PTRDE026 CGIs into TRDE0000 Rehab Table/Details 
.           26/08/2022 J.Tan           TSK 0900069
.           Recompiled for FEESESTM - HEA new Fees Estimate layout 
. V11.02.20 04/08/2022 Jacob Jackson  TSK 0921773
.           Add condition checking formactn & repcount to ensure health fund 
.           data that is prefilled on eligibilty check is not erased
. V11.02.19 20/07/2022 Peter Vela   0918312ii
.           Added Emergency OECW display to LOEC0000
. V11.02.18 15/07/2022 Peter Vela   0884414
.           Added Master OECW Request List - UORT0000
. V11.02.17 07/07/2022 J.Tan    TSK 0921542
.           Recompiled for FEESESTM
. V11.02.16 05/07/2022 J.Tan    TSK 0921542 & 0921364
.           Recompiled for FEESESTM Fixed I*D on pmsfesaf and deleting Tempfile
. V11.02.15 27/06/2022  J.Tan           TSK 0919349
.           Mod for SJOG Out of Pocket
.           01/07/2022  J.Tan               0921502
.           Recompiled for PMSFESTM - Accomm.rounding for Patient Cost columns
. V11.02.14 16/06/2022  Peter Vela          0918312
.           Added display for WBOCSTAT 5,6 in FFLINW0000
. V11.02.13 15/06/2022  Peter Vela          0918312
.           Added WBEHPSCD to EOEW0000
. V11.02.12 27/05/2022  Peter Vela     Task 0920340
.           Added call to CLWEBELF, CLPMSELF to FOEC1000, FOEC1500
.           Fixed output at FOEW1700
. V11.02.11 23/05/2022  Peter Vela     Task 0920076
.           Added Transaction Id and Response Desc to FFTB0000 patweb7809002
.           OEC FRee Format List
.           Added direct reads to WEBOEC in FOEC8000
.           Added tags for WBOCERRC,WBOCERRD to FOEW0000
. V11.02.10 13/05/2022  Peter Vela     Task 0919877
.           Added JSON and Response Description columns to  Emergency OEC List
.           EOEC0000 patweb7806013.html
. V11.02.09 04/05/2022  Peter Vela     Task 0918312
.           Added OLDOECIN for old free format oec display FFTB0000
. V11.02.08 27/04/2022  Ebon Clements  Task 0906597
.           Added clear of AN-SNAP version and classification - CLRTRE00
. V11.02.07 04/04/2022  J.Tan          Task 0910723
.           Recompiled for FEESESTM and Fixed SJOG Theatre fees from Booking
. V11.02.06 28/03/2022  Peter Vela     Task 0918312
.           Added OLDOECIN functionality in FOEC0000
. V11.02.05 24/03/2022  Peter Vela     Task 0918312
.           Added OLDOECIN for old oec display (Response List and
.           Eligibility Check)
. V11.02.04 02/03/2022  Peter Vela     Task 0914306
.           Added WebServices OECW-ECM
. V11.02.03 11/02/2022  J.Tan          Task 0910723
.           Recompiled for PMSFESTM - SJOG IFC
. V11.02.02 10/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTMA1FD (PATMASTM) changes
. V11.02.01 01/02/2022  J.Tan          Task 0915997
.           Recompiled for PMSFESTM - HEC standard IFC
. V11.01.09 23/11/2021  J.Tan          Task 0912367
.           Recompiled for PMSFESTM - include Consumable amount to Out of pocket
. V11.01.08 14/10/2021  J.Tan          Task 0910723
.           Added UPDATEST to SJOG IFC Eligibility - updating Items
. V11.01.07 06/10/2021  J.Tan          TSK 0910723
.           Recompiled for FEESESTM - SJOG IFC
. V11.01.06 05/10/2021  J.Tan          TSK 0910723
.           Recompiled for FEESESTM for SJOG Fees Estimate
. V11.01.05 07/09/2021  J.Tan          TSK 0910723
.           Recompiled for FEESESTM for SJOG Fees Estimate
. V11.01.04 19/08/2021  J.Tan           TSK 0910460
.           Recompiled for FEESESTM - Standard fees estimate
. V11.01.03 01/07/2021  J.Tan          Task 0885959
.           Recompiled for FEESESTM - Fees Estimate Standard format
. V11.01.02 04/06/2021  J.Tan          TSK 0896226
.           Recompiled for PMSFESTM (SJOG IFC/Fees Estimate)
. V11.01.01 02/03/2021  Jill Parkinson Task 0892480
.           Recompiled for PMSFESTM - sameday/overnight display in column 5
. V11.00.17 11/02/2021  Jill Parkinson Task 0892480
.           Recompiled for PMSFESTM         
. V11.00.16 09/12/2020  Thanh T        TSK 0872840
.           Recompiled as PMSPX2TM changes
. V11.00.15 17/11/2020  Jill Parkinsont Task 0892480
.           Recompiled for PMSFESTM - output column 4 for sameday accom
. V11.00.14 06/10/2020  Peter Vela       TSK 0895969
.           Added Webservice OECW tag displays to CELG0000
. V11.00.13 23/09/2020  Peter Vela       TSK 0895969
.           Recompiled for WEBSEDFD
. V11.00.12 22/09/2020  Peter Vela       TSK 0895969
.           Recompiled for WEBERCFD
. V11.00.11 03/09/2020  Peter Vela     Task 0895969
.           Added WebServices OECW
. V11.00.10 01/09/2020  Jill Parkinson Task 0892480
.           Recompiled for PMSFESTM HEA maximum calculation
. V11.00.09 27/08/2020  Peter Vela     TSK 0884414
.           Changed disOEC() arguments in DMBS0000
.           Check for 1 or more extra mbs codes in CMBS0000
. V11.00.08 14/08/2020  Sunny          TSK 0893688
.           1) Fixed error message display at UCOD7500 
.           2) Added flag to change claim type based on value of parameter 
.              'Accumulation for Fees Invoiced'
. V11.00.07 10/08/2020  Peter Vela     TSK 0884414
.           Added IOEC0000 to EXTR0000
.           Fixed html display in DMBS0000
.           Addded OEC display functionality in DMBS0000
. V11.00.06 27/07/2020  J.Tan          TSK 0885061
.           Recompiled for PMSFESTM - to display Theatre fee desc.
. V11.00.05 25/05/2020  J.Tan          TSK 0891011
.           Fixed tag for PTELQLPS 
. V11.00.04 13/05/2020  Peter Vela     Task 0891019
.           Check Presenting Illness MBS before Presenting Illness Code
.           in LOCROW00
. V11.00.03 25/03/2020  Tracey Nguyen  TSK 0887397
.           Added Triage Score on Admission for Patient Attribute type '021'
.           - PTATTFLG, TRADR000, TRADU000, PROFLD15, CLRATR00
. V11.00.02 10/03/2020  J.Tan          TSK 0838262
.           Added Effective from and to date to MBS Item file
. V11.00.01 24/02/2020  Peter Vela     Task 0888684
.           Added Error code and Description to EOER0000
. V10.15.05 23/01/2020  Jill Parkinson Task 0886986
.           Added checks for PTCNIFCL=3 Cabrini layout
. V10.15.04 22/01/2020  J.Tan          TSK 0826834
.           Recompiled for FEESESTM - SJOG Fees Estimate
. V10.15.03 02/12/2019  J.Tan          TSK 0826834
.           Mod for SJOG IFC/Fees Estimate
. V10.15.02 15/11/2019  J.Tan          TSK 0826834
.           Mod for SJOG IFC/Fees Estimate
. V10.15.01 17/10/2019  J.Tan          TSK 0826834
.           Added Extra MBS to Eligibility check
. V10.14.08 10/10/2019  Peter Vela     TSK 0882888
.           Added emergency oed indicator to FOEC8000
. V10.14.07 03/09/2019  Peter Vela     TSK 0875296
.           Added Emergency OEC functionality
. V10.14.06 03/09/2019  Davin          TSK 0880816
.           Removed code that specifically excluded preadmissions from QLD
.           Mental Health Details screen display (PTQMH050)
. V10.14.05 17/07/2019  Ebon Clements  TSK 0877986
.           Added EDWARD health fund add/update trigger - EDWH0000
. V10.14.04 17/07/2019  Ebon Clements  TSK 0877986
.           Added 20 zero test to PTCNNSSI using EDWARD
. V10.14.03 09/05/2019  Tracey Nguyen    TSK 0866874
.           Modified FFTB0000 to stop processing if no surname and given name
.           have been entered
. V10.14.02 02/04/2019  Tracey Nguyen  TSK 0871443
.           Added reportno=14 for Palliative Care Breathlessness Assessment
. V10.14.01 27/03/2019  Peter Vela     TSK 0857392
.           Added PTICCHSC to PATICU - Charlson score
. V10.13.01 05/12/2018  Don Nguyen     TSK 0838558
.           Recompiled for changes to PMSFEDTM - Added temp file (FEDCOMAF)
.           creation/deletion code.
.           22/10/2018  Ebon Clements  Task 0865146
.           Added EDWARD visit alteration writes - WEDI0000
. V10.12.08 10/07/2018  Ebon Clements    TSK 0859180
.           Recompiled for PMSFESTM - Fees estimate consumables
. V10.12.07 29/06/2018  Richa Phogat     TSK 0830199
.           Added PMVXFNDM under UCOD3000
. V10.12.06 09/05/2018  J.Tan            TSK 0839842
.           Added Print IFC from Eligibility list
. V10.12.05 11/04/2018  Richa Phogat     TSK 0855372
.           Added new condition under ACCM0000 and RFUR0000
.           11/04/2018  Peter Vela       TSK 0855491
.           Fixed mbs count in CMBS0000
. V10.12.04 13/02/2018  J.Tan            TSK 0848146
.           Mod changing Claim code after Invoiced to check CACCFEE
. V10.12.03 07/02/2018  Richa Phogat     TSK 0844301
.           Added code under DMBS0000 to display all MBS value online
. V10.12.02 30/01/2018  Nicole Torrisi TSK 0851566
.           Changed CRSCON40 not to save PTCRDATE
. V10.12.01 10/01/2018  Thanh T.       Task 0849566
.           Fixed the patient subacute onsite date not saving when modifying
.           Error
. V10.11.08 08/12/2017  J.Tan          Task 0844301
.           Mod to display MBS Code and desc.of the Presenting Illness
. V10.11.07 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.06 17/10/2017 Peter Vela     TSK 0844186
.           Added CLRTRE00 at PATREB20
. V10.11.05 03/10/2017  Jill Parkinson TSK 0841368
.           Added update of ptrde009 in UPQRD000
. V10.11.04 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
. V10.11.03 21/07/2017  J.Tan          TSK 0825674
.           Added new indexes on patifcaf table
. V10.11.02 20/07/2017  Ania P         TSK 0842159
.           Added nz check in CRCD1200
. V10.11.01 14/07/2017  Thanh T.       TSK 0821710
.           Audit Amission/outpatient visit comments. PATMISTM changed.
.------------------------------------------------------------------------------
. V10.10.11 06/07/2017  Tracey Nguyen  TSK 0840725
.           Changed RKPTVIS4(read next) to RPPTVIS4 (read previous) in VLST0000 
.           to list Discharged date in descending order
. V10.10.10 27/06/2017  Richa Phogat   TSK 0840793
.           Added option to 'Preferred Death Place' ptrde024/PMVXUDF9
. V10.10.09 15/06/2017  J.Tan          TSK 0820199
.           Added option to update PMI HF details
. V10.10.08 19/05/2017  Ebon Clements  TSK 0814741
.           Added open of ICD10 diagnosis file
. V10.10.07 17/05/2017  Ebon Clements  TSK 0814741
.           Added don't group records by consultant option - ALLCCL00          
.           Fixed record actioned test in check for duplicates - CHKCMB00
. V10.10.06 13/04/2017  Ania P         TSH 0814741
.           Rewrite of CHKCMB
. V10.10.05 31/03/2017  Ania P         TSK 0814741
.           Add rule to CHKCMB to check for completed Action
. V10.10.04 30/03/2017  Ania P         TSK 0814741
.           Rewrite of CHKCMB
. V10.10.03 17/03/2017  Thanh T.          TSK 0832066
.           Changed DVA PREPAT/PMPXDVAC fields to use the new
.           concession card PMCDCNUM/PMCDDVAC fields
. V10.10.02 24/03/2017  Tracey Nguyen     TSK 0833454
.           Added reportno 13 for pain assessment maintenance  
. V10.10.01 06/03/2017  Don Nguyen     TSK 0808741
.           Modified CSTR0000 to only test time values if same date
.------------------------------------------------------------------------------
. V10.09.11 21/02/2017  Peter Vela     TSK 0831131
.           Added save variables for eligibility check defaults from OEC
. V10.09.10 09/02/2017  Peter Vela     TSK 0827830
.           Added overnight/sameday excess validation in ELGB1250
. V10.09.09 02/02/2017  Jill Parkinson TSK 0832624
.           Added alerts and emergency diagnosis for Cross Consult list
. V10.09.08 02/02/2017  Jill Parkinson TSK 0832624
.           Fixed reads from patdo1af to pmshcpaf for Cross Consult list
. V10.09.07 01/02/2017  Jill Parkinson TSK 0832624
.           Moved routines inside CRCD0000 to be routines outside
. V10.09.06 17/01/2017  J.Tan         TSK 0808741
.           Validating ventilation End date and time
.           19/01/2017  Ania P        CAR 814741
.           Updated CRCD1200 rules
. V10.09.05 11/01/2017  Ania P        CAR 0814741
.           Fixed minor issues
. V10.09.04 05/01/2017  J.Tan          TSK 0830638
.           Recompiled for FEESESTM - Fees Estimate for Multiple bed types
. V10.09.03 03/01/2017  Steve Armstrong  TSK 0814741
.           Fixed clearing of variables in CLCC0000.
. V10.09.02 28/12/2016  Ania P        TSK 0814741
.           Fixed multiple issues
. V10.09.01 30/11/2016  Ania P        TSK 0814741
.           Added output of new fields
.------------------------------------------------------------------------------
. V10.08.13 10/11/2016  Ebon Clements TSK 0826425
.           Populate MV minutes PTICMECM in ICU file if QLD - UICU0000
. V10.08.12 09/11/2016  J.Tan         TSK 0308496
.           Added option to Copy Mental Health details
. V10.08.11 19/10/2016  Peter Vela    TSK 0827811
.           Recompiled for CLPMSOEC
. V10.08.10 13/10/2016  J.Tan         TSK 0817909
.           Mods to store Total Exp LOS calculated to Total OOPS field
. V10.08.09 28/09/2016  J.Tan         TSK 0826492
.           Recompiled for PMSFESTM - Fixed Fees estimate Link
. V10.08.08 29/08/2016  J.Tan          TSK 0823330
.           Recompiled for PMSFESTM - Fixed Fees Est.linked with Elig.Check
. V10.08.07 18/08/2016  J.Tan          TSK 0823330
.           Recompiled for PMSFESTM - Fixed Fees Estimate free format name
. V10.08.06 28/07/2016  J.Tan          TSK 0823330
.           Fixed Fees Estimate for using HEA and SJOG IFC format
. V10.08.05 23/06/2016  Peter Vela     TSK 0819748
.           Fixed tag display for zero amounts in PMHECPAM, PMHEEXAM and PMHEXBA
. V10.08.04 03/05/2016  J.Tan          CAR 0313842
.           Recompiled for FEESESTM - fixed Fees Estimate
. V10.08.03 06/04/2016  J.Tan          CAR 313842 SJOG IFC
.           Added PTELECLS - Expected Casemix LOS
. V10.08.02 31/03/2016  Davin          CAR 313842 SJOG IFC
.           Ouptut PTELCMXC (if it exists) instead of PTMIPCMX (CSMF0000)
. V10.08.01 16/03/2016  J.Tan          CAR 313842
.           Recompiled for FEESESTM - SJOG IFC
. V10.07.06 23/02/2016  J.Tan          CAR 0814431
.           Recompiled for FEESESTM - HEA IFC Sugg.class for Daycase
. V10.07.05 11/02/2016  J.Tan          CAR 0323465
.           Recompiled for FEESESTM - HEA IFC EPM Based contracts
. V10.07.04 27/01/2016  J.Tan          TSK 0313842
.           Recompiled for FEESESTM - SJGHC Eligibility Check
. V10.07.03 05/01/2016  J.Tan          TSK 0313842
.           Mods for SJGHC Eligibility Check
.           14/01/2016  Peter Vela     TSK 0809191
.           Fixed category KN read in FOET1300
. V10.07.02 16/12/2015  Peter Vela     TSK 0808202
.           Fixed read of PMSEEHFD in FOEC8170
. V10.07.01 26/11/2015  Peter Vela     CAR 304557
.           Added Link OEC functionality
. V10.06.06 20/08/2015  J.Tan          CAR 316980
.           Recompiled for FEESESTM - HEA IFC daycase Adm.type suggested class.
. V10.06.05 11/08/2015  J.Tan          CAR 316980
.           Recompiled for FEESESTM - HEA IFC Theatre fees
. V10.06.04 09/10/2015  J.Tan          CAR 316980
.           Recompiled for FEESESTM - Healthscope IFC changes
. V10.06.03 25/06/2015  Ania P         CAR 318532
.           Changed PTELG024 to DIM 80
. V10.06.02 17/04/2015  Davin          CAR 314005 HEA IFC Spec V3
.           Don't display MBS item @ reason for admission (CSMF0000)
.           Added Preferred Accommodation Cat.BP tag (EXTR1900)
. V10.06.01 08/04/2015 Davin          CAR 314703
.           Added six pmspx2 reads following rdmast1 (e.g. CRSCON60)
. V10.05.10 13/02/2015 J.Tan      CAR 310816
.           Recompiled for FEESESTM
. V10.05.09 11/02/2015 J.Tan      CAR 310816
.           Recompiled for FEESESTM
. V10.05.08 06/02/2015 Davin          CAR 310816
.           Recompiled for PMSFESTM (changed 'sameday' to 'Same Day')
. V10.05.07 11/12/2014 Jill Parkinson CAR 305950
.           Mods to update PTQRPCSA for palliative patients in UPDQRD30
. V10.05.06 15/12/2014 Peter Vela     CAR 310009
.           Added CLPMSELF to FOEC8150
. V10.05.05 14/11/2014 J.Tan     CAR 306584
.           Added Contract Role/Type for Changing Claim code after Invoiced
. V10.05.04 24/10/2014 J.Tan     CAR 253233
.           Recompiled PMSFESTM - fixed printing Theatre/Procedure charges
. V10.05.03 01/08/2014 J.Tan     CAR 253233
.           Recompiled PMSFESTM - HEA IFC for bed type with TCFORM6=1 only
. V10.05.02 18/06/2014 Jill Parkinson CAR 302673
.           Before defaulting the ecf details in to the excess, check if the
.           value of 'Check Complete' has been entered. If it has been entered,
.           the screen has been visited before and do NOT default ecf into the
.           patelgaf values.
. V10.05.01 01/08/2014 J.Tan     CAR 253233
.           Added ICU/CCU/SCN Co-payment to patelgaf file
.           06/08/2014 Davin     CAR 253233
.           Added tags celg7500/7600/7700/7800 and extr1800 (conc0000)
.           Added option 11 - IFC Other Consumables maintenance
. V10.04.13 10/07/2014 J.Tan     CAR 303426
.           Fixed checking for valid adm/booking for Eligibility check
. V10.04.12 27/06/2014 J.Tan     CAR 302823
.           Fixed I*D on patelgaf file (ELGB5400)
. V10.04.11 24/06/2014 Jill ParkinsoN CAR 302673
.           Removed use of ELGFLAG              
. V10.04.10 23/05/2014 Peter Vela     CAR 292257
.           Fixed RDBKREC1 branch in ELGB0000
.           Fixed PMSEEHFD read in FOEC800Fixed PMSEEHFD read in FOEC80000 
. V10.04.09 30/04/2014 Peter Vela     CAR 292257
.           Fixed display of Free Format OEC in FFTB0000
. V10.04.08 09/04/2014 Jill Parkinson CAR 295670
.           Added ELGFLAG -this will only overwrite patelgaf value if rec does
.           not exist on patelgaf
. V10.04.07 07/04/2014  Peter Vela      CAR 286258
.           Recompiled for PATMASTM
. V10.04.06 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.05 25/03/2014 Peter McMullen CAR 299038
.           Release lock on CONTROLF sector 118 in GELN000
. V10.04.04 14/03/2014  Jill Parkinson CAR 294183
.           Added new care types MC and removed R1,R2 for Victoria in CKCC0000 
. V10.04.03 24/01/2014  Don Nguyen    CAR 272483
.           Modified CHRS0000 to work with a large number of days; use FORM7P2.
.           Recompiled for changes to PATVENFD - increased size of PTVEHOUR
. V10.04.02 13/01/2014  J.Tan         CAR 285118
.           Added EXTR1400 - Hospital code for FeesEstimate logo
. V10.04.01 20/12/2013  Ania P        CAR 294308
.           Recompiled for PATRDEFD
.------------------------------------------------------------------------------
. V10.03.25 04/12/2013 Ebon Clements  CAR 290482
.           Added display of created date and time in column one - FFTB0000
. V10.03.24 15/11/2013 Peter Vela     CAR 294014
.           Added replace of spaces to +'s in ShowPhaseDetails function call
.           LODT0000
. V10.03.23 15/11/2013 Peter Vela     CAR 294014
.           Fixed onclick function call to ShowPhaseDetails() in LODT0000
. V10.03.22 21/10/2013 J.Tan          CAR 292486
.           Fixed problem with NULL PTELHFPN
. V10.03.21 11/09/2013 Peter Vela     CAR 278880
.           Added open for PATITMFD
. V10.03.20 16/08/2013 Davin          CAR 289111
.           Recompiled for PMSFEDTM - Changed pmsfd026 to be numeric
. V10.03.19 25/07/2013  Ebon Clements    CAR 260600
.           Added phase of care on adm to phase of care change list - POCTAB00
. V10.03.18 30/05/2013  Jill Parkinson   CAR 282743
.           Added July 2013 values into CKCC0000 for QLD
. V10.03.17 02/05/2013  Don Nguyen       CAR 284693
.           Recompiled for changes to IBAWEBCD (TITLESEL & RELATSEL)
. V10.03.16 27/02/2013  Ania P           CAR 281021
.           RECOMPILED for FMSBNKKY
. V10.03.15 18/10/2012  Don Nguyen       CAR 273899
.           Fixed CRSCON75 to factor in record counter (PTCRC003) value.
.           Added CRCD1800 to output comments for 'New Consultation' 
.           of an existing Cross Consultation (with blank Referred Consultant).
.           Updated CRSCON50 to deal with blank Referred Consultant for delete.
. V10.03.14 16/10/2012  Don Nguyen       CAR 273899
.           Modified ALLCCL00 to allow the display of multiple records of the
.           same Speciality.
.           Modified GETNXT00 to cater for Speciality.
. V10.03.13 11/10/2012  Don Nguyen       CAR 273899
.           Modified ALLCCL00 to enable the display of multiple records with
.           the same Referred Consultant (as individual list rows).
.           Modified CONDTL00 to cater for duplicate combinations.
.           Modified TOTHRS00 to cater for Speciality.
. V10.03.12 11/09/2012  Don Nguyen       CAR 270231
.           Added Speciality check in CHKCMB00 to allow multiple Speciality
.           combinations for the same Referred Consultant.
.           Fixed ADDCDT00 to also save Speciality code.
. V10.03.11 31/08/2012  Ebon Clements    CAR 270231
.           Added Speciality to cross consultation list - ALLCCL00
. V10.03.10 28/08/2012  Don Nguyen       CAR 270231
.           Added 'Speciality' category code select output to CRCD0000.
.           Added cgi variable PTCRC008 (Speciality Code).
.           Also changed doctor code validation in CRCD0000 to HCP file read
. V10.03.09 26/07/2012 Patrick Adair     CAR 269889
.            Added PTRDPOCA and PTRDPOCD in CLRTRE00 to clear fields
. V10.03.08 01/06/2012  Davin            CAR 260600 VAED-2012
.           Only post ptrde021/ptrde022/ptrde023 if not equal to Z70
. V10.03.07 21/05/2012  Peter Vela       CAR 265532
.           Fixed submit for PTELF009 Date of Birth Free Format OEC
.           22/05/2012  Davin            CAR 260600 VAED-2012
.           Added option 10 - Phase of Care maintenance
. V10.03.06 03/05/2012  Davin            CAR 260600 VAED-2012
.           Added impairment code to rehab details (ptrde021,ptrdimpr)
.           Added phase of care fields to rehab details (ptrde022,ptrde023)
. V10.03.05 04/04/2012  Davin            CAR 260600 VAED-2012
.           Added subacute care type R (ckcc0000)
. V10.03.04 21/03/2012  J.Tan            CAR 222603
.           Mods to update Eligibility Comments only
. V10.03.03 13/02/2012  Saroeun Soeur   CAR 260039
.           recompiled for IBAWEBCD
. V10.03.02 16/01/2012  Sandra Barcham  CAR 256563
.           Recompiled for PATMASTM
. V10.03.01 13/12/2011  Saroeun Soeur   CAR 257266
.           Added CALL UPPTQMH1 to PTQMH010
. V10.02.05 14/10/2011  Mike Laming     CAR 251645
.           Removed CLPATHSP routine to use new Incl routine CLPATHSP.PBL
. V10.02.04 11/10/2011  Mark Coupland    CAR 252429
.           Recompiled for PMSPX2TM and PATMASTM
. V10.02.03 13/09/2011 Jill Parkinson  CAR 248652
.           Recompiled for PMSPX2TM - Added read of pmsvx1af in GETCURIP
. V10.02.02 07/07/2011  Mike Laming   CAR 240724
.           Added PTHSHHOS to PATHSPFD for Medical Records Defaults
. V10.02.01 04/04/2011  Peter Vela    CAR 232054
.           Added &nbsp; to FFLINE00 Expected Admission Date
. V10.01.03 10/03/2011  Peter Vela    CAR 239463
.           Added Free Format OEC
. V10.01.02 11/02/2011  Peter Vela    CAR 236731
.           Changed Health Fund Policy Name Eligibility Check default to OEC 
.           Table Name
. V10.01.01 03/12/2010  Mike Laming   CAR 233046
.           Mods to "patmchgf" - use "Table Type" (PTMCHFTT) replacing "H/F
.           Table" (MHFTAB) - Change Key sizes - added PATMCHRD routine
. V10.00.06 19/10/2010  Peter Vela      CAR 231918
.           Fixed OEC Eligibility defaults at ELGB0000
. V10.00.05 15/10/2010  Davin           CAR 225374
.           Added tag for fees estimate text (celg7000) and new table (pmsfetaf)
. V10.00.04 22/09/2010 J.Tan            CAR 218066
.           Added Query selection to Eligibility Pre-existing ailment
. V10.00.03 08/09/2010  J.Tan          CAR 226687
.           Mods to save Checkbox copayments required fields from Eligibility
. V10.00.02 05/07/2010  J.Tan          CAR 200537
.           Mods to default 'Check Complete' from Eligibility screen to Blank
. V10.00.01 30/04/2010  J.Tan     CAR 220887
.           Mods checking for Active/Inactive of Misc.charge
. V9.12.08  19/02/2010  Steve Armstrong   CAR 216549
.           Mods to read CHTELEB at *129 instead of *127
. V9.12.07  07/12/2009  Saroeun Soeur  CAR 209737
.           Recompiled for PATMASTM - post ward / bed
. V9.12.06  28/10/2009  Jill Parkinson CAR 208794
.           Added report option 8 - patqmhaf maintenance
. V9.12.05  23/10/2009  J.Tan          CAR 205381
.           Added Total Out of Pocket
. V9.12.04  24/09/2009  Peter Vela     CAR 206759
.           Fixed tag display for zero amounts in PMHECPAM, PMHEEXAM and PMHEXBA
. V9.12.03  08/09/2009  J.Tan          CAR 205303
.           Added end date to Casemix funding file
. V9.12.02  18/05/2009  Peter Vela     CAR 183976
.           Changed OEC Response DFrame Size to 900
. V9.12.01  13/05/2009  Davin          CAR 188359,188087
.           If Estimate Exists flag is set to 'No' on Eligibility Check screen,
.           remove any link records from pmsaelaf (ELGB2300)
. V9.11.06  16/04/2009  Peter Vela     CAR 184976
.           Added display of PMSEEDFD
. V9.11.05  16/04/2009  Peter Vela     CAR 183976
.           Fixed Copayment Amount, Excess Amount and Excess Bonus Amount 
.           Display 
. V9.11.04  16/02/2009  Jill Habasque  CAR 172981
.           Added outputs for hospital details
. V9.11.03  02/02/2009  Peter Vela     CAR 183976
.           Added Eclipse OEC functionality
. V9.11.02  15/01/2009  Ebon Clements  CAR 175204
.           Added clear of IBPDNUM to saving default printer - UPDEFP00
. V9.11.01  06/11/2008  Peter McMullen CAR 174725
.           convert internal javascript to W3C standards
. V9.10.02  13/08/2008  Davin         CAR 175768
.           Recompiled for PMSFESTM - fixed gst tag
. V9.10.01  15/07/2008  Ebon Clements CAR 160213
.           Added misc charge amount and description to eligibility
. V9.09.05  06/12/2007  Davin         CAR 151898
.           Mods for eligibility & fees estimation (added pmsfed & pmsfes)
. V9.09.04  05/12/2007  Jill Habasque CAR 150413
.           Added output of ICUFLAG
. V9.09.03  03/12/2007  Peter Vela    CAR 151897
.           Recompiled for PMSFEDFD,PMSFEDTM,PMSFEDTD
. V9.09.02  16/11/2007  Davin         CAR 151898
.           Eligibility changes - added new fields and form print functionality
. V9.09.01  19/10/2007  Jill Habasque CAR 150319
.           Added service code and changes for patcrcaf to use hcp's
. V9.08.08  04/06/2007  Ebon Clements CAR 139414
.           2007 ACT health department mods for rehab details
. V9.08.07  18/04/2007  Jill Habasque CAR 137885
.           Mods to allow caretype=5 for sub acute records
. V9.08.06  28/02/2007  Davin S       CAR 123763
.           Added option 7 - QLD sub acute details maintenance (uses patqrdaf)
. V9.08.05  31/01/2007  Peter Vela     CAR 127930
.           Recompiled for MRTMASFD
. V9.08.04  15/01/2007  Peter Vela    CAR 128097
.           Added display functionality for PMSAELFD.PMAEQUOT
. V9.08.03  15/12/2006  Peter Vela    CAR 128097
.           Added submit and display functionality for PTELPPUT, PTELPSUT
.           PTELPTUT, PTELECMN
. V9.08.02  03/11/2006  Peter Vela    CAR 121134
.           Added initialisation of PTRDFADT and PTRDFDDT in CLRTRE00
. V9.08.01  24/10/2006  Jill Habasque CAR 121986
.           Removed write to PATECMAF (for PRS2)
. V9.07.01  28/06/2006  Davin S       CAR 104165
.           Changed to allow QLD sub acute care types 
.           Allow use of adm type for care class (based on ptcnqldb)
. V9.06.03  15/06/2006  Davin S       CAR 104165
.           Added ADL Date for QLD HDP (saves to ptrdcom1 from qld template)
. V9.06.02  15/06/2006  Jill Habasque CAR 105246
.           Aded functional assessment dates
. V9.06.01  01/05/2006  Ebon Clements CAR 103546
.           Fixed pack of key in ADDCDT00
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B02 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.09  30/11/2005  J.Tan              CAR 58666
.           Mods for Eligibility
. V9.04.08  21/11/05 J.Tan    CAR 58666 
.           Added option for Eligibility maintenance for theatre booking
.           Mods redirect for Admission eligibility
. V9.04.07  04/11/05 J.Tan    CAR 58666 
.           Added option for Eligibility maintenance
. V9.04.06  02/11/05 J.Tan    CAR 58663 
.           Added option for Ventilation maintenance
. V9.04.05  12/10/05 J.Tan    CAR 61907 
.           Added option to update Claim/Health fund/Adm.type after invoiced
. V9.04.04  30/08/2005  Jill Habasque CAR 73269
.           Changed to use index 4 of patcrcaf
. V9.04.03  11/07/2004  Jill Habasque CAR 66534
.           Added output of zero values for admission & discharge barthel scores
. V9.04.02  01/03/2005  Peter Vela    CAR 57547
.           Recompiled for PATVADFD and PATVADIO
. V9.04.01  19/10/2004  Ebon Clements CAT 54412                    
.           Changed to allow cross consultations on emergency visits
. V9.03.06  18/06/2004  Mike Laming  CAR 49016  2004 PRS/2 changes
.           Change CARETYPE to 2 chars. and change Cat.CC edits
. V9.03.05  07/06/2004 Peter Vela CAR 49016
.           2004 Statutory Changes - recompiled for PMSPX2TM
. V9.03.04  17/03/2004 Peter Vela      CAR 13038
.           Changed call DOCNAM00 to DOCNM000 (parameter driven doctor name
.           format) for sort lists.
. V9.03.03  04/02/2004 Davin           CAR 22654
.           Added write to patpeiaf when updating sub acute details
. V9.03.02  07/10/2003 Sylvek Litewka  CAR 43603
.           Added report number 2 - Cross Consulting Details Maintenance
.           Added report number 3 - Remote scripting
. V9.03.01  02/06/2003 Jill Habasque SRF 38102
.           Added care type J
.------------------------------------------------------------------------------
. V9.02.06  11/03/2003 J.Tan
.           Recompiled for PATMISTM - admitting point
. V9.02.05  07/02/2003  Tonii CAR 35992
.           Recompiled for PATMISTM
. V9.02.04  09/10/2002  Peter Vela 
.           Recompiled for PATMISTM - Admitting Point
. V9.02.03  23/07/2002  J.Tan
.           Recompiled for PATMISTM - added patasfaf file
. V9.02.02  01/07/2002  Jill Habasque SRF 18716
.           Added E and F for care type                 
. V9.02.01  14/05/2002  J.Tan
.           Recompiled for PATMISTM - added casemix code
. V9.02.00  18/02/2002 Pat Dirito
.           Created Program                
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF    
.
          INC       TFILEVAR/INC
          INC       OPRDEAFD/INC
          INC       OPRMBSFD/INC
          INC       APSMASFD/INC
          INC       EMRVISFD/INC
          INC       EMRVCDFD/INC
          INC       EMRICDFD/INC
          INC       IBAGSTFD/INC
          INC       IBALPCFD/INC
          INC       PATALRFD/INC
          INC       HICEMSFD/INC
          INC       PATATRFD/INC          * Patient Atrributes
          INC       PATATRTD/INC          * CGI vars for Patient Attributes
          INC       PATCONFD/INC
          INC       PATCHCFD/INC
          INC       PATCRCFD/INC
          INC       PMSCIDFD/INC
          INC       PATDADFD/INC
          INC       PATDO1FD/INC
          INC       PATDGWFD/INC
          INC       PATDSCFD/INC
          INC       PATMA1FD/INC
          INC       PATMI1FD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       PATPR1FD/INC
          INC       PATQMHTD/INC
          INC       PATQMHFD/INC
          INC       PATASFFD/INC
          INC       PATFN1FD/INC
          INC       PATMCHFD/INC
          INC       PATITMFD/INC
          INC       PATWR1FD/INC
          INC       PATPEIFD/INC
          INC       PATVISFD/INC
          INC       PATVADFD/INC
          INC       PATQRDFD/INC
          INC       PATRDEFD/INC
          INC       PATRE1FD/INC
          INC       PATECMFD/INC            * Patient epsiode morbidity change
          INC       PATCALAG/INC
          INC       VISMDTFD/INC
          INC       VISMTXFD/INC
          INC       PMSMTIFD/INC
          INC       PMSEDWFD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       PATCMOFD/INC            * Patient morbidity changes file
          INC       PATCMCFD/INC
          INC       PATCMXFD/INC
          INC       PMSADWFD/INC
          INC       PATHSPFD/INC
          INC       PMSAELFD/INC
          INC       PMSCCDFD/INC
          INC       PMSVX1FD/INC
          INC       PMSVX1TD/INC
          INC       PMSCAUFD/INC
          INC       PMSEEDFD/INC
          INC       PMSEEHFD/INC
          INC       PMSERCFD/INC
          INC       PMSEXTFD/INC
          INC       PMSOECFD/INC
          INC       PMSOECTD/INC
          INC       PMSOESFD/INC
          INC       PMSOESTD/INC
          INC       PMSSESFD/INC
          INC       PMSSEDFD/INC
          INC       PMSFEDFD/INC
          INC       PMSFEDTD/INC
          INC       PMSFESFD/INC
          INC       PMSFIDFD/INC
          INC       PMSFESTD/INC
          INC       PMSFETFD/INC
          INC       PMSFOCFD/INC
          INC       PMSFOCTD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCPTD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCGTD/INC
          INC       PMSVSCFD/INC
          INC       PATIN1FD/INC
          INC       PATICUFD/INC
          INC       PATTRNFD/INC
          INC       PATVENFD/INC
          INC       PATELGFD/INC
          INC       PMSELIFD/INC
          INC       PMSELFFD/INC
          INC       PMSPX2FD/INC
          INC       PMSPX2TD/INC
          INC       PMSSNPFD/INC
          INC       PMSSNPTD/INC
          INC       OUTSITFD/INC
          INC       MRTMASFD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       BOKRC1FD/INC
          INC       BOKRX1FD/INC
.
          INC       PATIFCFD/INC
          INC       PATLSDFD/INC
          INC       PATASDFD/INC
          INC       PATHLFFD/INC
          INC       PATLDFFD/INC
          INC       PATHDFFD/INC
          INC       PATAFEFD/INC
          INC       PATBFEFD/INC
          INC       PATTFEFD/INC
          INC       PATCTFFD/INC
          INC       PMSFENFD/INC
          INC       PATSGCFD/INC
          INC       PATFX1FD/INC
          INC       PATCFAFD/INC
          INC       IBAGEDFD/INC
          INC       EMRLOCFD/INC
          INC       PATMISTD/INC
          INC       PMSEHBFD/INC
          INC       PMSIMPFD/INC
          INC       PATDDHFD/INC
          INC       PMSELITD/INC
.
          INC       PMSSNCFD/INC
.
          INC       WEBOECFD/INC
          INC       WEBOECTD/INC
          INC       WEBOESFD/INC
          INC       WEBOESTD/INC
          INC       WEBELFFD/INC
          INC       WEBEEHFD/INC
          INC       WEBEEDFD/INC
          INC       WEBERCFD/INC
          INC       WEBSESFD/INC
          INC       WEBSEDFD/INC
.
          INC       WEBOEMFD/INC
          INC       WEBOEMTD/INC
          INC       WEBOMSFD/INC
          INC       WEBOMSTD/INC
          INC       WEBOMFFD/INC
          INC       WEBOMGFD/INC
          INC       WEBOMHFD/INC
          INC       WEBOMIFD/INC
.
.----------------------------------------------------------------------
.
.  CGI Parameters
.
DONTGRBC  FORM      1      * Don't group records by consultant
FORMACTN  DIM       5               
FOLDERSF  DIM       3
NEXTPAGE  DIM       1      * Nextpage parameter CGI parameter
STARTKEY  DIM       25     * Starting Key
UPDTTYPE  DIM       1      * Update Type
ACUTTYPE  FORM      1      * Sub Acute Update Type
CHNGCTYP  FORM      1
UPDATEST  FORM      1
USEBASIC  DIM       1      * Use Basic Cover rate
URVIFLAG  FORM      1
.
.  Rehab CGI Vars
.
ALRTIMGE  DIM       250       * Link to the patient alerts page
ALRTIMG1  DIM       250       * Link to the patient alerts page (Medical Alerts)
ALRTIMG2  DIM       250       * Link to the patient alerts page (Micro Alerts)
ALRTIMG3  DIM       250       * Link to the patient alerts page (Risk Alerts)
ALRTIMG4  DIM       250       * Link to the patient alerts page (Chronic Alerts)
ALRTDISA  DIM       250       * Link to the patient alerts page (Disability)
ALRTIMGT  DIM       1250      * Link to the patient alerts page
CODEDESC  DIM       40
COMPDIAG  DIM       200
CURRDATE  DIM       8
EMROECIN  DIM       1
EPMFLAG   FORM      1
EPISODNO  DIM       2      * Episode No
EPISODCT  DIM       2      * Episode No Counter
EPFRDATE  DIM       8      * Episode start date (CCYYMMDD)
EPTODATE  DIM       8      * Episode end date (CCYYMMDD)
EPCARETP  DIM       2      * Episode Care Type
PTRDE001  FORM      3      * Barthel Index Score on Admission
PTRDE002  FORM      3      * Barthel Index Score on Discharge
PTRDE003  DIM       3      * Clinical Sub Program (category CU)
PTRDE004  DIM       8      * Onset Date (ccyymmdd)
PTRDE005  DIM       1      * Admission/Readmission to Rehab.
PTRDE006  DIM       1      * User Flag
PTRDE007  DIM       1      * Palliative Care State on Admission
PTRDE008  DIM       1      * Palliative Care State on Discharge
PTRDE009  DIM       2      * RUG ADL on Admission
PTRDE010  DIM       2      * RUG ADL on Discharge
PTRDE011  DIM       2      * Source of Referal for Pall Care
PTRDE012  FORM      3      * F.I.M. Score on Admission
PTRDE013  FORM      3      * F.I.M. Score on Discharge
PTRDE014  DIM       5      * Diagnostic Group
PTRDE015  DIM       70     * Comments line 1
PTRDE016  DIM       70     * Comments line 2
PTRDE017  DIM       8      * Functional Assessment Date on admission
PTRDE018  DIM       8      * Functional Assessment Date on discharge
PTRDE019  DIM       8      * ADL Date (QLD)
PTRDE020  DIM       8      * Multidisciplinary Care Dat (ACT)
PTRDE021  DIM       7      * Impairment Code (pmsimpaf)
PTRDE022  DIM       3      * Phase Of Care on Admission (cat pu)
PTRDE023  DIM       3      * Phase Of Care on Discharge (cat pu)
PTRDE024  DIM       3      * Preferred Death Place (cat lj)
PTRDE025  DIM       2      * AN-SNAP Version (pmssnpaf)
PTRDE026  DIM       3      * AN-SNAP Classification (pmssnpaf)
.
.  Cross Consulting CGI Vars
.
PTCRC001  DIM       10     * Referring Consultant
PTCRC002  DIM       10     * Referred Consultant
PTCRC003  FORM      3      * Count
PTCRC004  DIM       40     * Comments
PTCRC005  DIM       8      * Date Seen
PTCRC006  FORM      3.2    * Time Taken (Hours)
PTCRC007  DIM       9      * Service Code
PTCRC008  DIM       3      * Speciality Code (Cat 'DT')
PTCRC009  DIM       8      * Consult Time
PTCRC010  DIM       3      * Action Code
PTCRC011  DIM       3      * Referred to Consultant Unit
PTCRC012  DIM       100    * Comments
.
PTASF001  DIM       1
PTASF002  DIM       1
PTASF003  DIM       5
.
ORIGDOCT  DIM       10     * Original Referring Consultant
ORIGREFD  DIM       10     * Original Referred Consultant
OPCNCODE  FORM      1      * Using MBS or ICD9-CM Codes
.
SHOWSPEC  FORM      1      * Flag to show Speciality
SPECIALT  DIM       3      * Speciality Code (Cat 'DT')
ACACTION  DIM       3      * Action (Code Ac)
OPTNFLTR  DIM       1      * Current or Discharged Patients' Filter
REFTOCON  DIM       10     * Referred to consultant
.
.  Ventilation cgi variables
.
PTVEN001  DIM       3      * Ventilation type
PTVEN002  DIM       8      * Start Date
PTVEN003  DIM       8      * Start Time
PTVEN004  DIM       8      * End Date
PTVEN005  DIM       8      * End Time
PTVEN006  FORM      3.2    * Hours
PTVEN007  DIM       3      * ICU Status - Catg IU
PTVEN008  DIM       3      * Initiation Site - Catg II
.
.  Eligibility cgi variables
.
PTELG001  DIM       1      * Financial Y/N (1-Yes)
PTELG002  FORM      12.2   * Co-payment required Private room
PTELG003  FORM      12.2   * Excess for this Admission
PTELG004  DIM       1      * Exclusions exist Y/N (1-Yes)
PTELG005  DIM       100    * Exclusion Comments                 
PTELG006  DIM       1      * Check Complete Y/N (1-Yes)         
PTELG007  DIM       1      * Covered for this Procedure Y/N
PTELG008  DIM       1      * Quote Exists Y/N (1-Yes)
PTELG009  DIM       1      * Quote Accepted Y/N (1-Yes)
PTELG010  FORM      12.2   * Co-payment required for Shared room
PTELG011  FORM      12.2   * Co-payment required for Theatre
PTELG012  DIM       3      * Check done via 
PTELG013  DIM       8      * Request Date
PTELG014  DIM       1      * Subject to Pre-Existing Ailment
PTELG015  DIM       20     * Health Fund Reference number
PTELG016  DIM       25     * Person at Health fund provided info.
PTELG017  DIM       2      * Month fund cover changed
PTELG018  DIM       4      * Year fund cover changed
PTELG019  FORM      5.2    * Private Day Co-payment Up To
PTELG020  FORM      5.2    * Shared Day Co-payment Up To
PTELG021  FORM      5.2    * Theatre Day Co-payment Up To
PTELG022  DIM       200    * Eligibility Comments
PTELG023  DIM       25     * Hospital Staff Member
PTELG024  DIM       80     * Health Fund Policy Name
PTELG025  FORM      12.2   * Co-payment required - Same day
PTELG026  FORM      5.2    * Same day Co-payment up to
PTELG027  FORM      12.2   * Co-payment required - Hospital
PTELG028  FORM      5.2    * Hospital Co-payment up to
PTELG029  DIM       1      * Accident Form? Y/N (1=Yes)
PTELG030  DIM       1      * Qualifying Period Served? (1=Yes)
PTELG031  DIM       70     * Miscellaneous Description           
PTELG032  FORM      12.2   * Miscellaneous $ value
PTELG033  DIM       1      * Emergency Admission (1=Yes)
PTELG034  FORM      12.2   * Total Out of Pockets (OOPs)
PTELG035  DIM       1      * Calculate Private Co-payment
PTELG036  DIM       1      * Calculate Shared Co-payment
PTELG037  DIM       1      * Calculate Same Day Co-payment
PTELG038  DIM       1      * Calculate Hospital Co-payment
PTELG039  DIM       1      * Calculate Theatre Co-payment
PTELG040  FORM      12.2   * Fund Excess for Same day
PTELG041  FORM      12.2   * Co-payment CCU,ICU,SCN,HDU
PTELG042  DIM       1      * Calculate CCU,ICU,SCN,HDU
PTELG043  FORM      5.2    * CCU,ICU,SCN,HDU Co-payment Up To
PTELG044  DIM       9      * Casemix Code
PTELG045  DIM       3      * Expected Casmix LOS
.
.  Free Format OEC cgi variables
.
PTELF001  DIM       8      * U/R Number
PTELF002  DIM       1      * Patient OEC Consent
PTELF003  DIM       4      * Title
PTELF004  DIM       40     * Patient First Name
PTELF005  DIM       40     * Patient Second Name
PTELF006  DIM       40     * Health Fund Given Name
PTELF007  DIM       40     * Health Fund Surname
PTELF008  DIM       1      * Gender
PTELF009  DIM       8      * Date of Birth
PTELF010  DIM       8      * Expected Admission Date
PTELF011  DIM       3      * Intended Stay
PTELF012  DIM       3      * Planned LOS
PTELF013  DIM       3      * Discharge Intention
PTELF014  DIM       1      * PEA Indicator
PTELF015  DIM       1      * Emergency Admission
PTELF016  DIM       3      * Presenting Illness Code
PTELF017  DIM       9      * Presenting Illness MBS
PTELF018  DIM       3      * Claim Type
PTELF019  DIM       6      * Health Fund
PTELF020  DIM       8      * Health Fund Table
PTELF021  DIM       19     * Health Fund Membership Number
PTELF022  DIM       50     * Diagnosis
PTELF023  DIM       9      * Service Code 1
PTELF024  DIM       9      * Service Code 2
PTELF025  DIM       9      * Service Code 3
PTELF026  DIM       9      * Service Code 4
PTELF027  DIM       9      * Service Code 5
.
PTELF028  DIM       3      * Service Code Quantity 1
PTELF029  DIM       3      * Service Code Quantity 2
PTELF030  DIM       3      * Service Code Quantity 3
PTELF031  DIM       3      * Service Code Quantity 4
PTELF032  DIM       3      * Service Code Quantity 5
.
PTELF033  DIM       10     * Repatriation Number
PTELF034  DIM       1      * Gender
.
PTELF035  DIM       8      * Visit Number
PTELF036  DIM       3      * Counter
PTELF037  DIM       1      * Flag
.
TSRVDATE  DIM       8
TBSRTFLG  FORM      "0"                     * Flag for Table sorting
LOOPCNTR  FORM      8
.
.  IFC Other/Consumables/Prosthetic variables
.
PTIFC001  DIM       3      * Claim Type (Cat CL)
PTIFC002  DIM       6      * Health Fund
PTIFC003  DIM       3      * Health Fund Table Type (Cat HT)
PTIFC004  DIM       1      * Record type (1=Casemix code,2=MBS Code,3=Adm.Type)
PTIFC005  DIM       9      * Casemix Code, MBS Code or Adm.Type
PTIFC006  DIM       3      * Charge Type (Cat ce)
PTIFC007  FORM      12.2   * Rebate Amount
PTIFC008  FORM      12.2   * Patient Amount
.
ADMNDATE  DIM       11
ADMNTYPE  DIM       3      * Adm.Type
ADMNTYPD  DIM       3      * Adm.Type Display
CASEMIXC  DIM       9      * Casemix Code
CASEMIXD  DIM       9      * Casemix Code Display
MBSITEMC  DIM       9      * MBS Code
MBSITEMD  DIM       9      * MBS Code Display
.
.  Palliative Care Pain Assessment CGI variables
.
CLINDATE  DIM       8      * Palliative Care Clinic Date
CLINTIME  DIM       8      * Palliative Care Clinic Time
PAINQ001  DIM       1      * Pain assessment question 1
PAINQ002  DIM       1      * Pain assessment question 2
PAINQ003  DIM       2      * Pain assessment question 3
PAINQ004  DIM       1      * Pain assessment question 4
PAINQ005  DIM       1      * Pain assessment question 5
PAINQ006  DIM       1      * Pain assessment question 6
PAINQ007  DIM       1      * Pain assessment question 7
PAINQ008  DIM       1      * Pain assessment question 8
PAINQ009  DIM       1      * Pain assessment question 9
PAINQ010  DIM       1      * Pain assessment question 10
.
.  Palliative Care Breathlessness Assessment CGI variables
.
BRTHQ001  DIM       1      * Breathlessness assessment question 1
BRTHQ002  DIM       1      * Breathlessness assessment question 2
BRTHQ02B  DIM       1      * Breathlessness assessment question 2B
BRTHQ003  DIM       1      * Breathlessness assessment question 3
BRTHQ004  DIM       1      * Breathlessness assessment question 4
BRTHQ005  DIM       1      * Breathlessness assessment question 5
BRTHQ006  DIM       1      * Breathlessness assessment question 6
BRTHQ007  DIM       1      * Breathlessness assessment question 7
BRTHQ008  DIM       1      * Breathlessness assessment question 8
BRTHQ08B  DIM       1      * Breathlessness assessment question 8B
BRTHQ009  DIM       1      * Breathlessness assessment question 9
BRTHQ010  DIM       1      * Breathlessness assessment question 10
.
.  Variable Declarations
.
BFECOUNT  FORM      2
BASICFLG  FORM      1
BASICHF   FORM      12.2
BDFEETOT  FORM      10.2
EPSSDATE  DIM       8      * Episode start date (CCYYMMDD)
EPSEDATE  DIM       8      * Episode end date (CCYYMMDD)
EPSNUMB   FORM      2      * Episode number
EPSCTYPE  DIM       2      * Episode care type                         *C-49016
EPSWDATE  DIM       8      * Episode work date (ccyymmdd)
EPISKEYS  DIM       18
FESTFLAG  FORM      1
CMDLINE   DIM       80
CMXFLAG   FORM      1
CARETYPE  DIM       2      * Current care type                         *C-49016
CARECLSS  DIM       3      * Current care class
CHECKDAT  DATE      8
CMXFLG    FORM      1
CONTRCID  DIM       6
CEFFDATE  DIM       8
CNTRCEFR  FORM      1
COUNTER   FORM      3
COUNT     FORM      3
CASMXKEY  DIM       18
COMWTKEY  DIM       18
DCFLAG    FORM      1
DISPDATE  DIM       12
DISPCDAT  DIM       12
DISPDACT  DIM       12
DISPDIAC  DIM       12
DISPUDAT  DIM       11
DIM1A     DIM       1
DIM5      DIM       5
DIM7      DIM       7
DIM8      DIM       8
DIM9      DIM       9
DIM10     DIM       10
DIM18A    DIM       18
DIM11     DIM       11
DIM12     DIM       12
DIM13     DIM       13
DIM18     DIM       18
DIM20     DIM       20
DIM24     DIM       24
DIM27     DIM       27
DIM27A    DIM       27
DIM3      DIM       3
DIM3A     DIM       3
DIM3B     DIM       3
DIM3C     DIM       3
DIM3D     DIM       3
DIM30     DIM       30
DIM40     DIM       40
DIM50     DIM       50
DIM70     DIM       70
DIM70A    DIM       70
DIM23     DIM       23
DIM127A   DIM       127
DISDIAG   DIM       40
DISDIA2   DIM       40
DISDIAGF  DIM       100
DISDIAG2  DIM       120
DSPOECST  DIM       20
DSWOECST  DIM       70
DSWOEMST  DIM       70
EPMPATAM  FORM      12.2
EPMREBAM  FORM      12.2
ECLPHFRN  FORM      1
ECLPHFPN  FORM      1
ECLPFINA  FORM      1
ECLPCPRP  FORM      1
ECLPEFTA  FORM      1
ECLPSTPA  FORM      1
ECLPEXEX  FORM      1
ELIGTYPE  DIM       3
ELGRESIN  DIM       1
ELGNUMBR  DIM       8
ERRFLAG   FORM      1
FNAMEC    DIM       8
FNAMED    DIM       8
FEDCOMAF  FILE      ASCII, FIXED=256
FEDCOMFL  FORM      1
FEDCOMPR  INIT      "FEDFIL"
FEDCOMNM  DIM       8
FESTINDC  FORM      2
LASTFEDP  FORM      3   * Last Item
FORM1A    FORM      1
FORM2B    FORM      2
FORM3A    FORM      3
FORM3B    FORM      3
FORM1B    FORM      1
FORM1C    FORM      1
FORM10    FORM      10
FORM82    FORM      8.2
FORM2A    FORM      2
FORM3     FORM      3
FORM4B    FORM      4
FORM5A    FORM      5
FORM5B    FORM      5
FORM5C    FORM      5
FORM5P2   FORM      5.2
FORM5     FORM      5
FORM7P2   FORM      7.2
FORM8     FORM      8
FORM12P2  FORM      12.2
FORM12    FORM      12
F12P2     FORM      12.2
F82       FORM      8.2
FREETXT1  DIM       40
FREETXT2  DIM       40
FREETXT3  DIM       40
FREETXT4  DIM       40
FREETXT5  DIM       40
FREETXT6  DIM       40
FREETXT7  DIM       40
FUNDGAP   FORM      5.2
FNDBTYPE  DIM       15
GELFINDC  FORM      1
GELF0MBS  DIM       9
GELFSTAT  DIM       20
GELFCFEC  DIM       4
GELFCFET  DIM       80
BOOKFLAG  FORM      1
FMBSCODE  DIM       9[100]
OMBSCODE  DIM       9[100]
GETNEXT   FORM      1      * Get next episode flag
HDPEQUIV  DIM       2
HTMLLNK2  DIM       127
HTMLLNK3  DIM       127
ICUBED    FORM      1
ITMCNTR   FORM      2
ICUFLAG   FORM      1
ITHOSTOT  FORM      12.2
ITGSTTOT  FORM      12.2
ACGSTTOT  FORM      12.2
ITREBTOT  FORM      12.2
.
ITPATGST  FORM      12.2
ITFNDGST  FORM      12.2
ACPATGST  FORM      12.2
ACFNDGST  FORM      12.2
.
IFCFLAG   FORM      1
PRVBTYP   DIM       3
ICUBTYP   DIM       3
SCNBTYP   DIM       3
SHRBTYP   DIM       3
FEESTYPE  FORM      1
.
KEY21A    DIM       21
KEY26A    DIM       26
LOCNCODE  DIM       4
LOECCNTR  FORM      3
OECNUMBR  DIM       8
PHARMACY  FORM      12.2
PHARMREB  FORM      12.2
PROSTHET  FORM      12.2
PROSTREB  FORM      12.2
CONSUMAB  FORM      12.2
CONSMREB  FORM      12.2
DISCOUNT  FORM      12.2
REASADMN  DIM       30
.
SURGAPAM  FORM      6.2
ASSGAPAM  FORM      6.2
ANAGAPAM  FORM      6.2
ICUINTEN  FORM      6.2
PHYSINIT  FORM      6.2
PHYSSUBS  FORM      6.2
RADIOLGY  FORM      6.2
PATHOLGY  FORM      6.2
COSMETIC  FORM      6.2
.
PSAGECON  DIM       3
PSAGETYP  DIM       3
PREVTYPE  DIM       2      * Previous care type                        *C-49016
DOCTCODE  DIM       6
DOCGNAME  DIM       25
DOCSNAME  DIM       20              
DOCTITLE  DIM       9              
MEHRFLAG  DIM       1
MBSDESC   DIM       70
MBSCONTR  DIM       6
MBSCOUNT  FORM      2  
MVMEDREC  DIM       1
NOATTRIB  FORM      1       
PTATTFLG  FORM      1            * Patient Attribute read flag
RETURNCD  DIM       3
REDECFBT  DIM       1
REPUNIQ   INIT      "yzxywxvwuvtustrsqrpqopnomnlmkljkijhighfgefdecdbcab"
RESUBOEC  DIM       1
SAVEND    FORM      3
SBEDTYPE  DIM       3
SAVDATE   DIM       8
SAVBEND   FORM      3
SAVBTYP   DIM       3
SAVATYPE  DIM       3
SAVNODAY  FORM      5
SAVMBSCD  DIM       9
SKEY18    DIM       18
SBTYPEPA  FORM      12.2
SBTYPEHF  FORM      12.2
PRIFEEPA  FORM      12.2
PRIFEEHF  FORM      12.2
.
SAVKEY11  DIM       11
SAVKEY18  DIM       18
SAVKEY34  DIM       34
SAVKEY30  DIM       30
SAVKEY15  DIM       15
SAVKEY24  DIM       24
SAVKEY27  DIM       27
SKEY19    DIM       19
SEMVICO1  DIM       127
SEMVICO2  DIM       127
OECWINDC  FORM      1
PMELIFLG  FORM      1
OLDOECIN  DIM       1
KEY3A     DIM       3
KEY3B     DIM       3
KEY3C     DIM       3
KEY3D     DIM       3
KEY3E     DIM       3
ATYPE029  INIT      "029"
PERFBY    DIM       30
CVERICNT  FORM      5
.
SAVEINDC  DIM       1
SAVEHFRN  DIM       20
SAVEHFPN  DIM       80
SAVEFINC  DIM       1
SAVEPPRI  FORM      12.2
SAVEXCSS  FORM      12.2
SAVEXCSD  FORM      12.2
SAVESPEA  DIM       1
SAVEXCLS  DIM       1
SAVEPRIM  DIM       9
.
STATNCOD  DIM       6       * Stationary Code Coded Field
LABELTYP  DIM       10
SCHDCOPY  FORM      3       * No of Copies
SCHDPRNT  DIM       3       * Printer
STATNARR  DIM       6[95]   * Stationary Code
SUBSYSKY  DIM       50
SETDFPRG  DIM       8
SETDFRPT  DIM       2
SRCHSNAM  DIM       20
SRCHGNAM  DIM       25
.
QUOTENUM  FORM      12
QUOTEEST  FORM      12
PHASDATE  DIM       8
STARTDAT  DIM       8
TOTEXLOS  FORM      12.2
TOTOPOCK  FORM      12.2
THEANUMB  FORM      2
THCFLG    FORM      2
TEMPETCP  FORM      12.2
TEMPETCH  FORM      12.2
TEMPEMCP  FORM      12.2
TEMPEMCH  FORM      12.2
TOTMECH   FORM      5.2
TOTCPAP   FORM      5.2
VIEWFLAG  FORM      1
VERSFRM2  FORM      2
HEASINSR  FORM      "0"
SELFINSR  FORM      1
WARDNAME  DIM       25
ACCMDESC  DIM       25
EMPYSTAT  DIM       25
PENSSTAT  DIM       25
PROBSTAT  DIM       26
REFTCARE  DIM       25
MHSINDIC  DIM       25
PREVTREM  DIM       25
.
OVRGAP    FORM      10.2                    * Overnight fund total
THTOTAL   FORM      5.2
THFUND    FORM      5.2
THTHOSPT  FORM      10.2                    * Theatre fee hospital total
THCFLAG   FORM      1
UPDHFUND  DIM       1
HFHIFUND  FORM      2
.
RECNUMBR  FORM      3        * Record number for Cross Consulting Details file
FRSTCONS  FORM      1        * First Cross Consulting Record flag 
.                              1 = First Record, 0 = Not a first record
VALDSDAT  DIM       8        * AN-SNAP Code Effective Date From
VALDICDE  DIM       7        * AN-SNAP Classification Code
.
PTMIS010  DIM       3        * Admission Type (Cat. A ) (atype)
PTMIS013  DIM       6        * Admission health fund (afundh)
PTMIS014  DIM       8        * Admission health fund table (afndtb)
PTMIS015  DIM       19       * Admission health fund table (afndmm)
PTMIS027  DIM       3        * Claim Code (Cat CL) (aclaim)
PTMIS045  DIM       2        * period with fund
PTCOMENT  DIM       40
FCONDATE  DIM       8        * First Consultation Date   
REPCOUNT  DIM       3
OMSCOUNT  DIM       3
OMHCOUNT  DIM       2
OMICOUNT  DIM       4
DSCHDATE  DIM       8       
REMOTENO  FORM      1
DOCTNAME  DIM       50
REFDNAME  DIM       50
SCHDPARR  DIM       6[95]   * Array of selected Printer
SCHDPCNT  FORM      2
SCHDCARR  FORM      3[95]   * Number of Copies
SCHDCCNT  FORM      2
SAVEDOCT  DIM       10       * Save Referring Consultant
SAVEREFD  DIM       10       * Save Referred Consultant
SAVESPEC  DIM       20       * Save Speciality
SAVECMNT  DIM       40       * Save Comment
SAVEAMNT  FORM      3.2      * Save (Accumulated) Time Taken (Hrs)
SAVECNTR  FORM      3        * Save record count
SAVETIME  DIM       8
SAVEDATE  DIM       8
SAVEACTN  DIM       3
SAVECOMM  DIM       100
UIDCREUD  DIM       30       * Print UserID CRE or UPD Date            .0929044
UIDTIMET  DIM       10       * Print UserID CRE or UPD TimeStamp       .0929044
ARRINDEX  FORM      3        
MBSINDEX  FORM      3
CWKEY15   DIM       15
CWKEY34   DIM       34
CRSCDATE  DIM       8[100]   * Array of Cross Consultation Dates
CRSCHRS   FORM      3.2[100] * Array of Cross Consuttation Hours (Time Taken)
CRSCSER   DIM       9[100]   * Array of Cross Consuttation Service Codes
CARECATG  DIM       2                       * category to use for care type
CATCT     INIT      "ct"
CTAc      INIT      "Ac"
CATel     INIT      "el"
CATD1     INIT      "D1"
CATD2     INIT      "D2"
CATD3     INIT      "D3"
CATD4     INIT      "D4"
CATD5     INIT      "D5"
CATDX     INIT      "DX"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATAC     INIT      "AC"
Ac        INIT      "Ac"
CODEA     INIT      "A "
CATCC     INIT      "CC"
CATce     INIT      "ce"
CATil     INIT      "il"
CATpu     INIT      "pu"
PYAA      INIT      "PYAA"
PYZZ      INIT      "PYZZ"
SP14      INIT      "              "

ZERO8     INIT      "0000    "
.
XMBS      FORM      5
.
MCFILE    IFILE     SQL, FIXED=14, KEY="u1-9"
XCHARGE   DIM       9        9        1
XMCCNT    FORM      5        4        10
.EOF                                  14
.
TTFILE    IFILE     SQL, FIXED=150, KEY="u1-18"
DXAMT     DIM      11      11      1
DXMBS     DIM       5       5     12
DUNIQ     DIM       2       2     17
XTHEA     DIM       9       9     19
XBAND     DIM       3       3     28
.TFPAT1   FORM   12.2       8     31
.TFPAT2   FORM   12.2       8     39
.TFPAT3   FORM   12.2       8     47
.TFPAT4   FORM   12.2       8     55
.TFPAT5   FORM   12.2       8     63
.TFPAT6   FORM   12.2       8     71
.TFHF1    FORM   12.2       8     79
.TFHF2    FORM   12.2       8     87
.TFHF3    FORM   12.2       8     95
.TFHF4    FORM   12.2       8    103
.TFHF5    FORM   12.2       8    111
.TFHF6    FORM   12.2       8    119
XQUAN     FORM    3         3    127
XGSTA     DIM     1         1    130
XGSTC     DIM     6         6    131
XBTYP     DIM     3         3    137
XKGST     DIM     1         1    140
XAMNT     FORM    12.2      8    141
XKAMT     DIM     1         1    149
.
.EOR                             150
.
.---------------------------------------------------------------------------
PRGID     INIT      "PATWEB78"
VERSION   INIT      "V12.00.05"
PRGNAM    INIT      "Patient Admission Maintenance"
.---------------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
...       CALL      IBACLOCK
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD,SP10
          REP       " 0",CURRDATE
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200,MAIN2300,MAIN2400,MAIN2500:
                             MAIN2600
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "INVALID OPTION",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      PATREB00   * Patient Rehab Details Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      CPEI0000                * check if patpeiaf record required
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      CRSCON00                * Cross Consulting Details Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      REMOTE00                * Remote Scripting
          GOTO      MAIN1000
.
MAIN1400  CALL      UCOD0000                * Update Code after Invoiced
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      VENT0000                * Ventilation details maint.
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      ELGB0000                * Eligibility check maint.
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      PATREQ00                * QLD Patient Rehab Details Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      CPEI0000                * check if patpeiaf record required
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      PTQMH000                * QLD MH maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1900  CALL      FOEC0000                * Free Format OEC
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2000  CALL      PMSFOC00                * Phase of Care Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2100  CALL      PATIFC00                * IFC Other Consumables maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2200  CALL      SHCC0000                * View Cross Consultations
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2300  CALL      ATTRIB00                * Attribute for Palliative Pain
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2400  CALL      APCBA000                * Attribute for Palliative Care
          BRANCH    EXIT,MAIN1000           * Breathlessness Assessment
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2500  CALL      OEMW0000                * WebServices OECW-ECM Display 
          BRANCH    EXIT,MAIN1000           * Dunctionality
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2600  CALL      CVAU0000                * Casemix Verification Audit  
          BRANCH    EXIT,MAIN1000           * Dunctionality
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50:
                       NXTPAG60
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  CALL      PREDIR00      * Redirect parent
          GOTO      NXTPAG99
.
NXTPAG60  CALL      WIN2CL00      * Close 2 DFrames and refresh parent
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
+
.------------------------------------------------------------------------------
. PREDIR00 - Redirect Parent URL
.------------------------------------------------------------------------------
.
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                             " alert(#"",WEBTITLE,"#");":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Refresh Parent and Close Two Windows (DFrames)
.------------------------------------------------------------
WIN2CL00  CALL      OPENHTML
          BRANCH    EXIT,WIN2CL99
          WRITE     HTMLFILE;"<script type=#"text/javascript#" ":
                             "src=#"../js/Standard.js#"></script>":
                             "<script type=#"text/javascript#" ":
                             "src=#"../js/Custom.js#"></script>":
                             "<script type=#"text/javascript#"> ":
                             "if (self.name.match(/PopUpFrame/)) {":
                             "  reload2ParentFrame();}":
                             "</script>"
          CALL      CLOSHTML     * End of Document
WIN2CL99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  CALL      INTMAS00     * Open routine for PATMASTM
          OPEN      OPRDETA2,"oprdetaf"
          OPEN      OPRMBSA1,"oprmbsaf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA4,"patvisaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PATICDD1,"paticddf"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMI1A3,"patmi1af"  
          OPEN      PATDSCH1,"patdschf"
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      EMRVCDA1,"emrvcdaf"
          OPEN      EMRICDA1,"emricdaf"
          OPEN      IBALPCA1,"ibalpcaf"
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBAPDFA1,"ibapdfaf"
          OPEN      HICEMSA1,"hicemsaf"
.
          OPEN      PATQMHA1,"patqmhaf"
          OPEN      PATWR1A1,"patwr1af" 
          OPEN      PATVENA1,"patvenaf"
          OPEN      PATELGA1,"patelgaf"
          OPEN      PATRDEA1,"patrdeaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATCHCO1,"patchcof"
          OPEN      PATCRCA1,"patcrcaf"
          OPEN      PATCRCA2,"patcrcaf"
          OPEN      PATCRCA4,"patcrcaf"
          OPEN      PATCRCA5,"patcrcaf"
          OPEN      PATCMOR1,"patcmorf"
          OPEN      PATCMCA1,"patcmcaf"
          OPEN      PATCMXA1,"patcmxaf"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATECMA1,"patecmaf"
          OPEN      PATPEIO1,"patpeiaf"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PMSCAUA1,"pmscauaf"
          OPEN      PMSEDWA2,"pmsedwaf"
          OPEN      PMSEXTA1,"pmsextaf"
          OPEN      PMSSNPA1,"pmssnpaf"
          OPEN      PATICUA1,"paticuaf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATQMHA1,"patqmhaf"
          OPEN      PMSAELA1,"pmsaelaf"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PMSADWA1,"pmsadwaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSEEDA1,"pmseedaf"
          OPEN      PMSEEHA1,"pmseehaf"
          OPEN      PMSELFA1,"pmselfaf"
          OPEN      PMSELFA2,"pmselfaf"
          OPEN      PMSELFA3,"pmselfaf"
          OPEN      PMSELFA4,"pmselfaf"
          OPEN      PMSERCA1,"pmsercaf"
          OPEN      PMSOECA1,"pmsoecaf"
          OPEN      PMSOESA1,"pmsoesaf"
          OPEN      PMSSESA1,"pmssesaf"
          OPEN      PMSSEDA1,"pmssedaf"
          OPEN      PMSFEDA1,"pmsfedaf"
          OPEN      PMSFEDA2,"pmsfedaf"
          OPEN      PMSFESA1,"pmsfesaf"
          OPEN      PMSFESA2,"pmsfesaf"
          OPEN      PMSFIDA1,"pmsfidaf"
          OPEN      PMSFETA1,"pmsfetaf"
          OPEN      PMSFOCA1,"pmsfocaf"
          OPEN      PMSVSCA1,"pmsvscaf"
.
          OPEN      PATIFCA1,"patifcaf"
          OPEN      PATIFCA2,"patifcaf"
          OPEN      PATIFCA3,"patifcaf"
          OPEN      PATIFCA4,"patifcaf"
          OPEN      PMSMTIA2,"pmsmtiaf"
.
          OPEN      PATASFA1,"patasfaf"
          OPEN      EMRLOCA1,"emrlocaf"
          OPEN      VISMDTA1,"vismdtaf"
          OPEN      VISMTXA1,"vismtxaf"
.
          OPEN      PMSIMPA1,"pmsimpaf" 
.
          OPEN      PMSSNCA2,"pmssncaf"
.
          OPEN      BOKRC1A1,"bokrc1af"
          READ      CONTROLF,TWO;*4,CNAME
          READ      CONTROLF,TEN;*192,CACCFEE
          READ      CONTROLF,TEN3;*1,CHADD1,*31,CHADD2,*61,CHPOST
          READ      CONTROLF,TEN3;*129,CHTELEB
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,FORTY;*112,OPCNCODE
          READ      CONTROLF,SEVENTY9;*80,PTCNQLDB
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,HUND05;*130,PTCNAUAT:    * auto update adm.type
                                    *190,PTSGCOPT,*235,PTCNQCCT
          READ      CONTROLF,HUND20;*160,PTCNIFCL,*244,PTCNCWCL
          READ      CONTROLF,HUND24;*157,PTCNPMHF
          READ      CONTROLF,HUND25;*93,PTCNNSSI
          READ      CONTROLF,HUND29;*61,PTCNWSIN,*71,PTCNOECW,*72,PTCNOECE
          READ      CONTROLF,HUND30;*15,PTCNEITM,*16,PTCNEMCH

.
          IF        (PTCNHDPS=4 & PTCNQLDB=6)
            MOVE      CODEA,CARECATG        * use atype for care class changes
          ELSE
            MOVE      CATCC,CARECATG
          ENDIF
.
          IF        PTCNHDPS=4 | PTCNHDPS=9
            OPEN      PATQRDA1,"patqrdaf"
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          OPEN      PATLSDA1,"patlsdaf"
          OPEN      PATASDA1,"patasdaf"
          OPEN      PATHLFA1,"pathlfaf"
          OPEN      PATLDFA1,"patldfaf"
          OPEN      PATHDFA1,"pathdfaf"
          OPEN      PATAFEA1,"patafeaf"
          OPEN      PATBFEE1,"patbfeef"
          OPEN      PATTFEE1,"pattfeef"
.
          MOVE      ZERO,NOATTRIB
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATATRA1,"patatraf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,NOATTRIB
          ENDIF
.
          OPEN      PATATRA3,"patatraf"
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEC
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMED
.
          CALL      OPICO1
          CALL      OPICD1              * Open ICD10 V1-4 Dis file
          CALL      OPICD2
.
          MOVE      ONE,PMELIFLG
          MOVE      ZERO,OVRCD               * assume file exists
          TRAP      OVERCOND IF IO           * trap for error openning file
          OPEN      PMSELIA1,"pmseliaf"      * open items from Eligibility check
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ZERO,PMELIFLG
          ENDIF
.
          MOVE      ONE,OECWINDC
          MATCH     "1",PTCNOECW
          IF         @EQUAL
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOECA1,"weboecaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOESA1,"weboesaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBELFA1,"webelfaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBELFA2,"webelfaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBELFA3,"webelfaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBELFA4,"webelfaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBELFA8,"webelfaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBEEHA1,"webeehaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBEEDA1,"webeedaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBERCA1,"webercaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBSESA1,"websesaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBSEDA1,"websedaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOEMA1,"weboemaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOMSA1,"webomsaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOMFA1,"webomfaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOMFA2,"webomfaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOMFA3,"webomfaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOMFA4,"webomfaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOMGA1,"webomgaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOMHA1,"webomhaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBOMIA1,"webomiaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,OECWINDC
            ENDIF
.
          ENDIF
.
INIT9999  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      ZERO,STARTNUM
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,ACUTTYPE 
          MOVE      ZERO,CHNGCTYP
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,FORMACTN
          MOVE      SP70,STARTKEY
          MOVE      SP70,EPISODNO
          MOVE      SP70,EPISODCT
          MOVE      SP70,EPFRDATE
          MOVE      SP70,EPISKEYS
          MOVE      SP70,EPTODATE
          MOVE      SP70,EPCARETP
          MOVE      SP70,MVMEDREC
          MOVE      SP70,UPDHFUND
.
          MOVE      ZERO,PTRDE001  
          MOVE      ZERO,PTRDE002
          MOVE      SP70,PTRDE003
          MOVE      SP70,PTRDE004
          MOVE      SP70,PTRDE005
          MOVE      SP70,PTRDE006
          MOVE      SP70,PTRDE007
          MOVE      SP70,PTRDE008
          MOVE      SP70,PTRDE009
          MOVE      SP70,PTRDE010
          MOVE      SP70,PTRDE011
          MOVE      ZERO,PTRDE012
          MOVE      ZERO,PTRDE013
          MOVE      SP70,PTRDE014
          MOVE      SP70,PTRDE015
          MOVE      SP70,PTRDE016
          MOVE      SP70,PTRDE017
          MOVE      SP70,PTRDE018
          MOVE      SP70,PTRDE019
          MOVE      SP70,PTRDE020
          MOVE      Z70,PTRDE021
          MOVE      Z70,PTRDE022
          MOVE      Z70,PTRDE023
          MOVE      Z70,PTRDE024
          MOVE      Z70,PTRDE025
          MOVE      Z70,PTRDE026
.
          MOVE      ZERO,REMOTENO
          MOVE      SP70,REPCOUNT
          MOVE      SP70,OMSCOUNT
          MOVE      SP70,OMHCOUNT
          MOVE      SP70,OMICOUNT
          MOVE      SP70,PTCRC001
          MOVE      SP70,PTCRC002
          MOVE      ZERO,PTCRC003
          MOVE      SP70,PTCRC004
          MOVE      SP70,PTCRC005
          MOVE      ZERO,PTCRC006
          MOVE      SP70,PTCRC007
          MOVE      SP70,PTCRC008
          MOVE      SP70,PTCRC009
          MOVE      SP70,PTCRC010
          MOVE      SP70,PTCRC011
          MOVE      SP70,PTCRC012
          MOVE      ZERO,RECNUMBR
          MOVE      SP70,SAVESPEC
          MOVE      ZERO,SAVECNTR
          MOVE      SP70,ACACTION
          MOVE      SP70,OPTNFLTR
          MOVE      SP70,SPECIALT
          MOVE      SP70,REFTOCON
.
          MOVE      SP70,PTVEN001
          MOVE      SP70,PTVEN002
          MOVE      SP70,PTVEN003
          MOVE      SP70,PTVEN004
          MOVE      SP70,PTVEN005
          MOVE      ZERO,PTVEN006
          MOVE      SP70,PTVEN007
          MOVE      SP70,PTVEN008
          MOVE      SP70,STARTDAT
          MOVE      SP70,PHASDATE
.
          MOVE      SP70,PTELG001
          MOVE      ZERO,PTELG002
          MOVE      ZERO,PTELG003
          MOVE      SP70,PTELG004
          MOVE      SP70,PTELG005
          MOVE      SP70,PTELG006
          MOVE      SP70,PTELG007
          MOVE      SP70,PTELG008
          MOVE      SP70,PTELG009
          MOVE      ZERO,PTELG010
          MOVE      ZERO,PTELG011
          MOVE      SP70,PTELG012
          MOVE      SP70,PTELG013
          MOVE      SP70,PTELG014
          MOVE      SP70,PTELG015
          MOVE      SP70,PTELG016
          MOVE      SP70,PTELG017
          MOVE      SP70,PTELG018
          MOVE      ZERO,PTELG019
          MOVE      ZERO,PTELG020
          MOVE      ZERO,PTELG021
          PACK      PTELG022,SP70,SP70,SP70
          MOVE      SP70,PTELG023
          MOVE      SP70,PTELG024
          MOVE      ZERO,PTELG025
          MOVE      ZERO,PTELG026
          MOVE      ZERO,PTELG027
          MOVE      ZERO,PTELG028
          MOVE      SP70,PTELG029
          MOVE      SP70,PTELG030
          MOVE      SP70,PTELG031
          MOVE      ZERO,PTELG032
          MOVE      SP70,PTELG033
          MOVE      ZERO,PTELG034
          MOVE      Z70,PTELG035
          MOVE      Z70,PTELG036
          MOVE      Z70,PTELG037
          MOVE      Z70,PTELG038
          MOVE      Z70,PTELG039
          MOVE      ZERO,PTELG040
          MOVE      ZERO,PTELG041
          MOVE      Z70,PTELG042
          MOVE      ZERO,PTELG043
          MOVE      SP70,PTELG044
          MOVE      SP70,PTELG045
.
          MOVE      SP70,PTELF001
          MOVE      SP70,PTELF002
          MOVE      SP70,PTELF003
          MOVE      SP70,PTELF004
          MOVE      SP70,PTELF005
          MOVE      SP70,PTELF006
          MOVE      SP70,PTELF007
          MOVE      SP70,PTELF008
          MOVE      SP70,PTELF009
          MOVE      SP70,PTELF010
          MOVE      SP70,PTELF011
          MOVE      SP70,PTELF012
          MOVE      SP70,PTELF013
          MOVE      SP70,PTELF014
          MOVE      SP70,PTELF015
          MOVE      SP70,PTELF016
          MOVE      SP70,PTELF017
          MOVE      SP70,PTELF018
          MOVE      SP70,PTELF019
          MOVE      SP70,PTELF020
          MOVE      SP70,PTELF021
          MOVE      SP70,PTELF022
          MOVE      SP70,PTELF023
          MOVE      SP70,PTELF024
          MOVE      SP70,PTELF025
          MOVE      SP70,PTELF026
          MOVE      SP70,PTELF027
.
          MOVE      SP70,PTELF028
          MOVE      SP70,PTELF029
          MOVE      SP70,PTELF030
          MOVE      SP70,PTELF031
          MOVE      SP70,PTELF032
.
          MOVE      SP70,PTELF033
          MOVE      SP70,PTELF034
          MOVE      SP70,PTELF035
          MOVE      SP70,PTELF036
          MOVE      SP70,PTELF037
.
          MOVE      ZERO,TBSRTFLG
          MOVE      ZERO,LOOPCNTR
.
          MOVE      SP70,PTMIS010
          MOVE      SP70,PTMIS013
          MOVE      SP70,PTMIS014
          MOVE      SP70,PTMIS015
          MOVE      SP70,PTMIS027
          MOVE      SP70,PTMIS045
.
          MOVE      ONE,ARRINDEX            * Initialize Arrays
          WHILE     ARRINDEX <= 100
            MOVE      SP70,CRSCDATE[ARRINDEX]
            MOVE      ZERO,CRSCHRS[ARRINDEX]
            MOVE      SP70,CRSCSER[ARRINDEX]
            MOVE      SP70,FMBSCODE[ARRINDEX]
            MOVE      SP70,OMBSCODE[ARRINDEX]
            ADD       ONE,ARRINDEX
          DO
.
          MOVE      SP70,SCHDPRNT
          MOVE      ZERO,SCHDCOPY
          MOVE      SP70,STATNCOD
.
          CALL      CPPTQM00
.
          MOVE      ZERO,NORECORD
          MOVE      SP70,SRCHSNAM
          MOVE      SP70,SRCHGNAM
          MOVE      ZERO,RECNUMB
          MOVE      SP70,ELGNUMBR
          MOVE      SP70,OECNUMBR
.
          CALL      CPFOCM00
.
          MOVE      SP70,PTIFC001
          MOVE      SP70,PTIFC002
          MOVE      SP70,PTIFC003
          MOVE      SP70,PTIFC004
          MOVE      SP70,PTIFC005
          MOVE      SP70,PTIFC006
          MOVE      ZERO,PTIFC007
          MOVE      ZERO,PTIFC008
.
          MOVE      SP70,ADMNTYPE
          MOVE      SP70,CASEMIXC
          MOVE      SP70,MBSITEMC
          MOVE      SP70,USEBASIC
.
          MOVE      ZERO,SHOWSPEC
          MOVE      ZERO,TOTEXLOS
          MOVE      ZERO,TOTOPOCK
.
          MOVE      Z70,PTASF001
          MOVE      Z70,PTASF002
          MOVE      Z70,PTASF003
          MOVE      SP70,MEHRFLAG
.
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,VIEWTYPE
          MOVE      SP70,VYEARMTH
.
          MOVE      SP70,CLINDATE
          MOVE      SP70,CLINTIME
          MOVE      SP70,PAINQ001
          MOVE      SP70,PAINQ002
          MOVE      SP70,PAINQ003
          MOVE      SP70,PAINQ004
          MOVE      SP70,PAINQ005
          MOVE      SP70,PAINQ006
          MOVE      SP70,PAINQ007
          MOVE      SP70,PAINQ008
          MOVE      SP70,PAINQ009
          MOVE      SP70,PAINQ010
          MOVE      SP70,BRTHQ001
          MOVE      SP70,BRTHQ002
          MOVE      SP70,BRTHQ02B
          MOVE      SP70,BRTHQ003
          MOVE      SP70,BRTHQ004
          MOVE      SP70,BRTHQ005
          MOVE      SP70,BRTHQ006
          MOVE      SP70,BRTHQ007
          MOVE      SP70,BRTHQ008
          MOVE      SP70,BRTHQ08B
          MOVE      SP70,BRTHQ009
          MOVE      SP70,BRTHQ010
          MOVE      SP70,RESUBOEC
          MOVE      SP70,EMROECIN
          MOVE      ZERO,THEANUMB
          MOVE      ZERO,MBSINDEX
          MOVE      ZERO,SAVEINDC
.
          MOVE      ZERO,SBTYPEPA
          MOVE      ZERO,SBTYPEHF
          MOVE      ZERO,PRIFEEPA
          MOVE      ZERO,PRIFEEHF
.
          CALL      CLRATR00
          CALL      CPMFD000           * pmsfedaf file
          CALL      CLRELI00
.
          MOVE      ZERO,PHARMACY
          MOVE      ZERO,PROSTHET
          MOVE      ZERO,CONSUMAB
          MOVE      ZERO,SURGAPAM
          MOVE      ZERO,ASSGAPAM
          MOVE      ZERO,ANAGAPAM
          MOVE      ZERO,ICUINTEN
          MOVE      ZERO,PHYSINIT
          MOVE      ZERO,PHYSSUBS
          MOVE      ZERO,RADIOLGY
          MOVE      ZERO,PATHOLGY
          MOVE      ZERO,COSMETIC
          MOVE      ZERO,UPDATEST
.
          MOVE      SP70,OLDOECIN
.
         MOVE      SP70,VALDSDAT
         MOVE      SP70,VALDICDE
         MOVE      ZERO,FESTFLAG
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "acuttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ACUTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "chngctyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CHNGCTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mvmedrec=",QRYNAME
          IF        @EQUAL
            MOVE       QRYDATA,MVMEDREC
            GOTO       SETPAR99
          ENDIF
.
          MATCH     "updhfund=",QRYNAME
          IF        @EQUAL
            MOVE       QRYDATA,UPDHFUND
            GOTO       SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "episodno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EPISODNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "episodct=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EPISODCT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "epfrdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EPFRDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "episkeys=",QRYNAME
          IF        @EQUAL
            PACK      EPISKEYS,QRYDATA,SP70
            RJUSTIFY  EPISKEYS
            UNPACK    EPISKEYS,PMFOC002,EPFRDATE,EPTODATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "eptodate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EPTODATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "epcaretp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EPCARETP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "formactn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FORMACTN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptrde",QRYNAME
          IF        @EQUAL
            CALL      STRDE000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "remoteno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REMOTENO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "repcount=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPCOUNT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "omscount=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OMSCOUNT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "omhcount=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OMHCOUNT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "omicount=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OMICOUNT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc001=",QRYNAME
          IF        @EQUAL
            PACK      PTCRC001,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc002=",QRYNAME
          IF        @EQUAL
            PACK      PTCRC002,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTCRC003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTCRC004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc005=",QRYNAME
          IF        @EQUAL
            RESET     QRYDATA
            MATCH     SP70,QRYDATA
            GOTO      SETPAR99 IF EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      PTCRC005,CCENT,CYEAR,CMON,CDAY
            REP       " 0",PTCRC005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc006=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTCRC006
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc007=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTCRC007
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc008=",QRYNAME
          IF        @EQUAL
            PACK      PTCRC008,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc009=",QRYNAME
          IF        @EQUAL
            PACK      PTCRC009,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc010=",QRYNAME
          IF        @EQUAL
            PACK      PTCRC010,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
         MATCH     "ptcrc011=",QRYNAME
          IF        @EQUAL
            PACK      PTCRC011,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcrc012=",QRYNAME
          IF        @EQUAL
            PACK      PTCRC012,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptmis010=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTMIS010
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptmis013=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTMIS013
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptmis014=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTMIS014
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptmis015=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTMIS015
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptmis027=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTMIS027
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptmis045=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTMIS045
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "origdoct=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ORIGDOCT
            PACK      ORIGDOCT,ORIGDOCT,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "origrefd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ORIGREFD
            PACK      ORIGREFD,ORIGREFD,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdate",QRYNAME
          IF        @EQUAL
            CALL      STCCD000              * Set Cross Consulting Date
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cthrs",QRYNAME
          IF        @EQUAL                  
            CALL      STCCH000              * Set Cross COnsulting Hours
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ctser",QRYNAME
          IF        @EQUAL                  
            CALL      STCCS000              * Set Cross Service Code
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptven",QRYNAME
          IF        @EQUAL                  
            CALL      STVEN000              * Set Ventilation fields
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptelg",QRYNAME
          IF        @EQUAL                  
            CALL      STELG000              * Set Eligibity fields
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptqmh",QRYNAME
          IF        @EQUAL
            CALL      SPQMH000              * Set QLD MH Details
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startdat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTDAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdprnt=",QRYNAME
          IF        @EQUAL
            PACK      SCHDPRNT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "schdcopy=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDCOPY
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "statncod=",QRYNAME
          IF        @EQUAL
            PACK      STATNCOD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "ptelf",QRYNAME
          IF        @EQUAL
            CALL      STELF000              * Set free format oec fields
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchsnam=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHSNAM
            PACK      SRCHSNAM,SRCHSNAM,SP70
            REP       "~'",SRCHSNAM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchgnam=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHGNAM
            PACK      SRCHGNAM,SRCHGNAM,SP70
            REP       "~'",SRCHGNAM                                    *I-44200
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "elgnumbr=",QRYNAME
          IF        @EQUAL
            PACK      ELGNUMBR,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "oecnumbr=",QRYNAME
          IF        @EQUAL
            PACK      OECNUMBR,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmfoc",QRYNAME
          IF        @EQUAL
            CALL      SPFOCM00              * Set Phase of Care Parameters
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "phasdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PHASDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showspec=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWSPEC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "specialt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SPECIALT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "acaction=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ACACTION
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "optnfltr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OPTNFLTR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "reftocon=",QRYNAME
          IF        @EQUAL
            PACK      REFTOCON,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "savespec=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAVESPEC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "savecntr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAVECNTR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admntype=",QRYNAME
          IF        @EQUAL
            PACK      ADMNTYPE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "casemixc=",QRYNAME
          IF        @EQUAL
            PACK      CASEMIXC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mbsitemc=",QRYNAME
          IF        @EQUAL
            PACK      MBSITEMC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptifc",QRYNAME
          IF        @EQUAL
            CALL      SPIFCO00              * Set IFC Other/Consumables param
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptasf",QRYNAME
          IF        @EQUAL
            CALL      SPASF000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "usebasic=",QRYNAME
          IF        @EQUAL
            PACK      USEBASIC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "totexlos=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,TOTEXLOS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "totopock=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,TOTOPOCK
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mehrflag=",QRYNAME
          IF        @EQUAL
            PACK      MEHRFLAG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            PACK      FRSTDATE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            PACK      LASTDATE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            PACK      VIEWTYPE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptatr",QRYNAME
          IF        @EQUAL
            CALL      SPTATR00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "clindate=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00                *Set CMON from MTHNAM3
            PACK      CLINDATE,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clintime=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLINTIME
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "painq001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PAINQ001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "painq002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PAINQ002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "painq003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PAINQ003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "painq004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PAINQ004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "painq005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PAINQ005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "painq006=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PAINQ006
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "painq007=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PAINQ007
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "painq008=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PAINQ008
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "painq009=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PAINQ009
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "painq010=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PAINQ010
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq02b=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ02B
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq006=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ006
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq007=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ007
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq008=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ008
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq08b=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ08B
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq009=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ009
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthq010=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHQ010
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "resuboec=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,RESUBOEC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "emroecin=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EMROECIN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mischg",QRYNAME
          IF        @EQUAL
            CALL      SMCHG000      * parameters for misc.item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "misqua",QRYNAME
          IF        @EQUAL
            CALL      SMQUA000      * parameters for misc.item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keyamt",QRYNAME
          IF        @EQUAL
            CALL      SKAMT000      * parameters for misc.item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "misamt",QRYNAME
          IF        @EQUAL
            CALL      SMAMT000      * parameters for misc.item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gstapm",QRYNAME
          IF        @EQUAL
            CALL      SGAPM000      * parameters for misc.item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gstcom",QRYNAME
          IF        @EQUAL
            CALL      SMGST000      * parameters for misc.item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gstmky",QRYNAME
          IF        @EQUAL
            CALL      SGAMK000      * parameters for misc.item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gstmap",QRYNAME
          IF        @EQUAL
            UNPACK    QRYNAME,KEY6,KEY2
            MOVE      KEY2,F2
            PACK      GSTMAP[F2],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gstmcd",QRYNAME
          IF        @EQUAL
            UNPACK    QRYNAME,KEY6,KEY2
            MOVE      KEY2,F2
            PACK      GSTMCD[F2],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
         MATCH     "thefee",QRYNAME
          IF        @EQUAL
            CALL      STFEE000      * parameters for theatre.item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "thequa",QRYNAME
          IF        @EQUAL
            CALL      STQUA000      * parameters for theatre item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gstapl",QRYNAME
          IF        @EQUAL
            CALL      SGAPL000      * parameters for theatre item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gstcod",QRYNAME
          IF        @EQUAL
            CALL      SGCOD000      * parameters for theatre item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gsttky",QRYNAME
          IF        @EQUAL
            CALL      SGATK000      * parameters for misc.item
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gsttap",QRYNAME
          IF        @EQUAL
            UNPACK    QRYNAME,KEY6,KEY2
            MOVE      KEY2,F2
            PACK      GSTTAP[F2],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gsttcd",QRYNAME
          IF        @EQUAL
            UNPACK    QRYNAME,KEY6,KEY2
            MOVE      KEY2,F2
            PACK      GSTTCD[F2],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updatest=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATEST
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "oldoecin=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OLDOECIN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdsdat=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * Set CMON from MTHNAM3
            PACK      VALDSDAT,CCENT,CYEAR,CMON,CDAY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdicde=",QRYNAME
          IF        @EQUAL
            PACK      VALDICDE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
.
SETPAR99  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 1 - Patient Rehab Details
.-------------------------------------------------------------------------------
STRDE000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STRDE001,STRDE002,STRDE003,STRDE004,STRDE005,STRDE006:
                       STRDE007,STRDE008,STRDE009,STRDE010,STRDE011,STRDE012:
                       STRDE013,STRDE014,STRDE015,STRDE016,STRDE017,STRDE018:
                       STRDE019,STRDE020,STRDE021,STRDE022,STRDE023,STRDE024:
                       STRDE025,STRDE026
.
          GOTO      STRDE999
.
STRDE001  MOVE      QRYDATA,PTRDE001
          GOTO      STRDE999
.
STRDE002  MOVE      QRYDATA,PTRDE002
          GOTO      STRDE999
.
STRDE003  MOVE      QRYDATA,PTRDE003
          GOTO      STRDE999
.
STRDE004  RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      SETPAR99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PTRDE004,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PTRDE004
          GOTO      STRDE999
.
STRDE005  MOVE      QRYDATA,PTRDE005
          GOTO      STRDE999
.
STRDE006  MOVE      QRYDATA,PTRDE006
          GOTO      STRDE999
.
STRDE007  MOVE      QRYDATA,PTRDE007
          GOTO      STRDE999
.
STRDE008  MOVE      QRYDATA,PTRDE008
          GOTO      STRDE999
.
STRDE009  MOVE      QRYDATA,PTRDE009
          GOTO      STRDE999
.
STRDE010  MOVE      QRYDATA,PTRDE010
          GOTO      STRDE999
.
STRDE011  MOVE      QRYDATA,PTRDE011
          GOTO      STRDE999
.
STRDE012  MOVE      QRYDATA,PTRDE012
          GOTO      STRDE999
.
STRDE013  MOVE      QRYDATA,PTRDE013
          GOTO      STRDE999
.
STRDE014  MOVE      QRYDATA,PTRDE014
          GOTO      STRDE999
.
STRDE015  MOVE      QRYDATA,PTRDE015
          GOTO      STRDE999
.
STRDE016  MOVE      QRYDATA,PTRDE016
          GOTO      STRDE999
.
STRDE017  RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      SETPAR99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PTRDE017,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PTRDE017
          GOTO      STRDE999
.
STRDE018  RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      SETPAR99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PTRDE018,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PTRDE018
          GOTO      STRDE999
.
STRDE019  RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      SETPAR99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PTRDE019,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PTRDE019
          GOTO      STRDE999
.
STRDE020  RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      SETPAR99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PTRDE020,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PTRDE020
          GOTO      STRDE999
.
STRDE021  PACK      PTRDE021,QRYDATA,SP70
          GOTO      STRDE999
.
STRDE022  PACK      PTRDE022,QRYDATA,SP70
          GOTO      STRDE999
.
STRDE023  PACK      PTRDE023,QRYDATA,SP70
          GOTO      STRDE999
.
STRDE024  PACK      PTRDE024,QRYDATA,SP70
          GOTO      STRDE999
.
STRDE025  MOVE      QRYDATA,PTRDE025
          GOTO      STRDE999
.
STRDE026  MOVE      QRYDATA,PTRDE026
          GOTO      STRDE999
.
STRDE999  RETURN
.
.------------------------------------------------------------------------------
.        Set Parameters for Ventilation
.------------------------------------------------------------------------------
STVEN000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STVEN001,STVEN002,STVEN003,STVEN004,STVEN005,STVEN006:
                       STVEN007,STVEN008
          GOTO      STVEN999
.
STVEN001  MOVE      QRYDATA,PTVEN001
          GOTO      STVEN999
.
STVEN002  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PTVEN002,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PTVEN002
          GOTO      STVEN999
.
STVEN003  MOVE      QRYDATA,PTVEN003
          GOTO      STVEN999
.
STVEN004  PACK      QRYDATA,QRYDATA,SP70
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PTVEN004,CCENT,CYEAR,CMON,CDAY
          MATCH     SP70,PTVEN004
          IF        !@EQUAL
            REP       " 0",PTVEN004
          ENDIF
          GOTO      STVEN999
.
STVEN005  PACK      QRYDATA,QRYDATA,SP70
          MOVE      QRYDATA,PTVEN005
          GOTO      STVEN999
.
STVEN006  MOVE      QRYDATA,PTVEN006
          GOTO      STVEN999
.
STVEN007  MOVE      QRYDATA,PTVEN007
          GOTO      STVEN999
.
STVEN008  MOVE      QRYDATA,PTVEN008
          GOTO      STVEN999
.
STVEN999  RETURN
+
.------------------------------------------------------------------------------
.        Set Parameters for Eligibility fields
.------------------------------------------------------------------------------
STELG000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STELG001,STELG002,STELG003,STELG004,STELG005,STELG006:
                       STELG007,STELG008,STELG009,STELG010,STELG011,STELG012:
                       STELG013,STELG014,STELG015,STELG016,STELG017,STELG018:
                       STELG019,STELG020,STELG021,STELG022,STELG023,STELG024:
                       STELG025,STELG026,STELG027,STELG028,STELG029,STELG030:
                       STELG031,STELG032,STELG033,STELG034,STELG035,STELG036:
                       STELG037,STELG038,STELG039,STELG040,STELG041,STELG042:
                       STELG043,STELG044,STELG045
          GOTO      STELG999
.
STELG001  MOVE      QRYDATA,PTELG001
          GOTO      STELG999
.
STELG002  MOVE      QRYDATA,PTELG002
          GOTO      STELG999
.
STELG003  MOVE      QRYDATA,PTELG003
          GOTO      STELG999
.
STELG004  MOVE      QRYDATA,PTELG004
          GOTO      STELG999
.
STELG005  MOVE      QRYDATA,PTELG005
          GOTO      STELG999
.
STELG006  MOVE      QRYDATA,PTELG006
          GOTO      STELG999
.
STELG007  MOVE      QRYDATA,PTELG007
          GOTO      STELG999
.
STELG008  MOVE      QRYDATA,PTELG008
          GOTO      STELG999
.
STELG009  MOVE      QRYDATA,PTELG009
          GOTO      STELG999
.
STELG010  MOVE      QRYDATA,PTELG010
          GOTO      STELG999
.
STELG011  MOVE      QRYDATA,PTELG011
          GOTO      STELG999
.
STELG012  MOVE      QRYDATA,PTELG012
          GOTO      STELG999
.
STELG013  MATCH     SP70,QRYDATA
          GOTO      STELG999 IF EQUAL
          GOTO      STELG999 IF EOS
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTELG013,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PTELG013
          GOTO      STELG999
.
STELG014  MOVE      QRYDATA,PTELG014
          GOTO      STELG999
.
STELG015  MOVE      QRYDATA,PTELG015
          GOTO      STELG999
.
STELG016  MOVE      QRYDATA,PTELG016
          GOTO      STELG999
.
STELG017  MOVE      QRYDATA,PTELG017
          GOTO      STELG999
.
STELG018  MOVE      QRYDATA,PTELG018
          GOTO      STELG999
.
STELG019  MOVE      QRYDATA,PTELG019
          GOTO      STELG999
.
STELG020  MOVE      QRYDATA,PTELG020
          GOTO      STELG999
.
STELG021  MOVE      QRYDATA,PTELG021
          GOTO      STELG999
.
STELG022  MOVE      QRYDATA,PTELG022
          GOTO      STELG999
.
STELG023  MOVE      QRYDATA,PTELG023
          GOTO      STELG999
.
STELG024  MOVE      QRYDATA,PTELG024
          GOTO      STELG999
.
STELG025  MOVE      QRYDATA,PTELG025
          GOTO      STELG999
.
STELG026  MOVE      QRYDATA,PTELG026
          GOTO      STELG999
.
STELG027  MOVE      QRYDATA,PTELG027
          GOTO      STELG999
.
STELG028  MOVE      QRYDATA,PTELG028
          GOTO      STELG999
.
STELG029  MOVE      QRYDATA,PTELG029
          GOTO      STELG999
.
STELG030  MOVE      QRYDATA,PTELG030
          GOTO      STELG999
.
STELG031  MOVE      QRYDATA,PTELG031
          GOTO      STELG999
.
STELG032  MOVE      QRYDATA,PTELG032
          GOTO      STELG999
.
STELG033  MOVE      QRYDATA,PTELG033
          GOTO      STELG999
.
STELG034  MOVE      QRYDATA,PTELG034
          GOTO      STELG999
.
STELG035  MOVE      QRYDATA,PTELG035
          GOTO      STELG999
.
STELG036  MOVE      QRYDATA,PTELG036
          GOTO      STELG999
.
STELG037  MOVE      QRYDATA,PTELG037
          GOTO      STELG999
.
STELG038  MOVE      QRYDATA,PTELG038
          GOTO      STELG999
.
STELG039  MOVE      QRYDATA,PTELG039
          GOTO      STELG999
.
STELG040  MOVE      QRYDATA,PTELG040
          GOTO      STELG999
.
STELG041  MOVE      QRYDATA,PTELG041
          GOTO      STELG999
.
STELG042  MOVE      QRYDATA,PTELG042
          GOTO      STELG999
.
STELG043  MOVE      QRYDATA,PTELG043
          GOTO      STELG999
.
STELG044  MOVE      QRYDATA,PTELG044
          GOTO      STELG999
.
STELG045  MOVE      QRYDATA,PTELG045
          GOTO      STELG999
.
STELG999  RETURN
+
.------------------------------------------------------------------------------
.        Set Parameters for Cross Consulting - Dates
.------------------------------------------------------------------------------
STCCD000  RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      STCCD999 IF EQUAL
.
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          ASSIGN    F3-100,F3
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      CRSCDATE[F3],CCENT,CYEAR,CMON,CDAY
          REP       " 0",CRSCDATE[F3]
.
STCCD999  RETURN
.
.------------------------------------------------------------------------------
.        Set Parameters for Cross Consulting - Hours
.------------------------------------------------------------------------------
STCCH000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          ASSIGN    F3-100,F3
          MOVE      QRYDATA,CRSCHRS[F3]
.
STCCH999  RETURN
.
.------------------------------------------------------------------------------
.        Set Parameters for Cross Consulting - Service Code
.------------------------------------------------------------------------------
STCCS000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          ASSIGN    F3-100,F3
          MOVE      QRYDATA,CRSCSER[F3]
.
STCCS999  RETURN
.
.------------------------------------------------------------
.   Patient Rehab: Display,Add,Update,Delete
.------------------------------------------------------------
PATREB00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PATREB50 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Add/Update formaction
          GOTO      PATREB10 IF EQUAL
.
          GOTO      PATREB90
.
.         ************ ADD/UPDATE FORMACTION **********
.
PATREB10  PACK      KEY8,ADMISSNO,SP70   * Read Admission File
          CALL      RDMISS1
          BRANCH    OVRCD,PATREB92 
.
          PACK      KEY8,ADMISSNO,SP70   * Read Discharge File
          CALL      RDDSCH1
          IF        OVRCD=1
            CALL      CLPATDSC
          ENDIF
          IF        PTCNHDPS=4
            GOTO      PATREB15
          ENDIF
          IF        ACUTTYPE=1
            CALL      CKONST00        * Validate Onset Date
            BRANCH    EXIT,PATREB99
          ENDIF
          IF        (ACUTTYPE=1 | ACUTTYPE=3)
            CALL      CKADLD00        * Validate ADL Date
            BRANCH    EXIT,PATREB99
          ENDIF
          CALL      CKFADT00        * Validate assessment Date on adm
          BRANCH    EXIT,PATREB99
          CALL      CKFDDT00        * Validate assessment Date on disch
          BRANCH    EXIT,PATREB99
.
PATREB15  PACK      KEY10,ADMISSNO,EPISODNO,SP70
          CALL      RDPTRDE1        * Read the rehab details file
          BRANCH    OVRCD,PATREB20     
.
          CALL      UPDTRE00        * Update the rehab details file
.
          MATCH     Z70,PTRDE024
          IF        !@EQUAL
            PACK      KEY8,ADMISSNO,SP70
            CALL      RDPMVX11
            IF        OVRCD=0
              MOVE      PTRDE024,PMVXUDF9
              CALL      UPPMVX11    * Update Patient system Visit Extension file
            ENDIF
          ENDIF
.
          MATCH     SP70,PTATR010       * Is Triage Score of adm available?
          IF        !@EQUAL
            CALL      TRADU000          * Yes, Update patient attributes
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PATREB99
.
PATREB20  CALL      CLRTRE00
          CALL      SAVTRE00        * Sav Vars before write 
.
          PACK      KEY10,PTRDADMN,PTRDEPNO,SP70
          CALL      RAPTRDE1
          IF        OVRCD=1
            CALL      WRPTRDE1      * Write to the Rehab Details File
          ENDIF
.
          MATCH     Z70,PTRDE024
          IF        !@EQUAL
            PACK      KEY8,ADMISSNO,SP70
            CALL      RDPMVX11
            IF        OVRCD=0
              MOVE      PTRDE024,PMVXUDF9
              CALL      UPPMVX11    * Update Patient system Visit Extension file
            ENDIF
          ENDIF
.
          MATCH     SP70,PTATR010       * Is Triage Score of adm available?
          IF        !@EQUAL
            CALL      TRADU000          * Yes, Update patient attributes
          ENDIF

          MOVE      ZERO,EXIT
          GOTO      PATREB99
.
.         ************ DISPLAY FORMACTION **********
.
PATREB50  PACK      KEY8,URNUMBER,SP70   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,PATREB91
.
          CALL      RDPMPX21
.
          PACK      KEY8,ADMISSNO,SP70   * Read Admission File
          CALL      RDMISS1
          BRANCH    OVRCD,PATREB92

          IF        ASTAT=1 | ASTAT=5
            GOTO      PATREB93              * Ignore pre-admitted or cancelled
          ENDIF                             * patients
.
          PACK      KEY8,ADMISSNO,SP70   * Read Discharge File
          CALL      RDDSCH1
          IF        OVRCD=1
            CALL      CLPATDSC
          ENDIF
          MATCH     SP70,EPISODNO   * Not Doing Update of Rehab Episode  
          GOTO      PATREB51 IF EQUAL
.
          PACK      KEY10,ADMISSNO,EPISODNO,SP70
          CALL      RDPTRDE1
          IF        OVRCD=1
            CALL      CLRTRE00
          ENDIF
.
          CALL      TRADR000          * Get patient attributes
.
PATREB51  CLEAR     WEBTITLE
          MOVE      "Sub Acute Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PATREB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PATREB99
.
PATREB90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATREB99
.
PATREB91  MOVE      "Can't find patient Master Details. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATREB99
.
PATREB92  MOVE      "Can't find patient Admission Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATREB99
.
PATREB93  CLEAR     WEBTITLE
          MOVE      "Note patient visit is pre-admitted please ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "select another visit!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATREB99
.
PATREB99  RETURN
.
.===========================================================================
. Read Patient Attributes for Triage Score by Admission
.===========================================================================
TRADR000  MOVE      ZERO,PTATTFLG
          PACK      KEY35,URNUMBER,ADMISSNO,ATYPE021,SP70
          CALL      RSPTATR3
          CALL      RKPTATR3
          BRANCH    OVRCD,TRADR100
.
          MATCH     URNUMBER,PTARURNO
          GOTO      TRADR100 IF NOT EQUAL
.
          MATCH     ADMISSNO,PTARVISN
          GOTO      TRADR100 IF NOT EQUAL
.
          MATCH     ATYPE021,PTARTYPE          * Is attribute type="021"?
          GOTO      TRADR100 IF NOT EQUAL      * No, clear fields
          GOTO      TRADR999 IF EQUAL
.
TRADR100  CALL      CLPATATR
          MOVE      ONE,PTATTFLG
.
TRADR999  RETURN
.
.===========================================================================
. Write or Update Patient Attributes for Triage Score by Admission
.===========================================================================
TRADU000  CALL      TRADR000                  * Read Patient Attributes
          BRANCH    PTATTFLG,TRADU500         * Not found, write new record
.
          RJUSTIFY  PTATR010
          MATCH     PTATR010,PTARCOD1         * Same triage score?
          GOTO      TRADU999 IF EQUAL         * Exit
.
          MOVE      PTATR010,PTARCOD1         * Triage Score on Adm
.
.         Set current date and time as Update date and time
.
          CALL      IBACLOCK
          PACK      PTARUDTE,CCC,CYY,CMM,CDD
          REP       " 0",PTARUDTE
          CLOCK     TIME,PTARUTME
          MOVE      USERID,PTARUUSR
.
          CALL      UPPTATR3
          GOTO      TRADU999
.
.
.-------- Write to patatraf.ptarcod1 - Triage Score by Admission
TRADU500  MOVE      URNUMBER,PTARURNO
          MOVE      ADMISSNO,PTARVISN
          MOVE      ATYPE021,PTARTYPE
          RJUSTIFY  PTATR010
          MOVE      PTATR010,PTARCOD1
.
.         Set current date and time as Attribute/Create date and time
.
          CALL      IBACLOCK
          PACK      PTARCDTE,CCC,CYY,CMM,CDD
          REP       " 0",PTARCDTE
          MOVE      PTARCDTE,PTARDATE
.
          CLOCK     TIME,PTARCTME
          MOVE      PTARCTME,PTARTIME
.
          MOVE      USERID,PTARCUSR
.
          PACK      KEY35,URNUMBER,ADMISSNO,ATYPE021,PTARDATE,PTARTIME,SP70
          CALL      WRPTATR3

TRADU999  RETURN  

.------------------------------------------------------------
.   QLD Patient Rehab: Display,Add,Update,Delete
.------------------------------------------------------------
PATREQ00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PATREQ50 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Add/Update formaction
          GOTO      PATREQ10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PATREQ30 IF EQUAL
.
          GOTO      PATREQ90
.
.         ************ ADD/UPDATE FORMACTION **********
.
PATREQ10  PACK      KEY8,ADMISSNO,SP70   * Read Admission File
          CALL      RDMISS1
          BRANCH    OVRCD,PATREQ92
.
          PACK      KEY8,ADMISSNO,SP70   * Read Discharge File
          CALL      RDDSCH1
          IF        OVRCD=1
            CALL      CLPATDSC
          ENDIF
          IF        ACUTTYPE=1
            CALL      CKONST00        * Validate Onset Date
            BRANCH    EXIT,PATREQ99
          ENDIF
          IF        (ACUTTYPE=1 | ACUTTYPE=3)
            CALL      CKADLD00        * Validate ADL Date
            BRANCH    EXIT,PATREQ99
          ENDIF
          CALL      CKFADT00        * Validate assessment Date on adm
          BRANCH    EXIT,PATREQ99
          CALL      CKFDDT00        * Validate assessment Date on disch
          BRANCH    EXIT,PATREQ99
.
          PACK      KEY12,ADMISSNO,EPISODNO,EPISODCT,SP70
          CALL      RDPTQRD1        * Read the rehab details file
          BRANCH    OVRCD,PATREQ20
.
          CALL      UPDQRD00        * Update the rehab details file
.
          MOVE      ZERO,EXIT
          GOTO      PATREQ99
.
PATREQ20  CALL      SAVQRD00        * Sav Vars before write
.
          PACK      KEY12,PTQRADMN,PTQREPNO,PTQRCNTR,SP70
          CALL      RAPTQRD1
          IF        OVRCD=1
            CALL      WRPTQRD1      * Write to the Rehab Details File
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PATREQ99
.
PATREQ30  PACK      KEY12,ADMISSNO,EPISODNO,EPISODCT,SP70
          CALL      RDPTQRD1        * Read the rehab details file
          IF        OVRCD<>1
            CALL      DEPTQRD1        * Delete the rehab details file record
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PATREQ99
.
.         ************ DISPLAY FORMACTION **********
.
PATREQ50  PACK      KEY8,URNUMBER,SP70   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,PATREQ91
          CALL      RDPMPX21
.
          PACK      KEY8,ADMISSNO,SP70   * Read Admission File
          CALL      RDMISS1
          BRANCH    OVRCD,PATREQ92

          IF        ASTAT=1 | ASTAT=5
            GOTO      PATREQ93              * Ignore pre-admitted or cancelled
          ENDIF                             * patients
.
          PACK      KEY8,ADMISSNO,SP70   * Read Discharge File
          CALL      RDDSCH1
          IF        OVRCD=1
            CALL      CLPATDSC
          ENDIF
          MATCH     SP70,EPISODCT   * Not Doing Update of Rehab Episode
          GOTO      PATREQ51 IF EQUAL
.
          PACK      KEY12,ADMISSNO,EPISODNO,EPISODCT,SP70
          CALL      RDPTQRD1
          IF        OVRCD=1
            CALL      CLRQRD00
          ENDIF
.
PATREQ51  CLEAR     WEBTITLE
          MOVE      "Sub Acute Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PATREQ99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PATREQ99
.
PATREQ90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATREQ99
.
PATREQ91  MOVE      "Can't find patient Master Details. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATREQ99
.
PATREQ92  MOVE      "Can't find patient Admission Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATREQ99
.
PATREQ93  CLEAR     WEBTITLE
          MOVE      "Note patient visit is pre-admitted please ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "select another visit!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATREQ99
.
PATREQ99  RETURN
.
.------------------------------------------------------------------------------
.                   Cross Consulting Details Maintenance
.------------------------------------------------------------------------------
CRSCON00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      CRSCON60 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add New Cross Cons & Cons Details
          GOTO      CRSCON10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update Cross Consultation Details
          GOTO      CRSCON20 IF EQUAL
.
          MATCH     "S",UPDTTYPE       * Change Consultants - Single Detail Rec
          GOTO      CRSCON30 IF EQUAL
.
          MATCH     "C",UPDTTYPE       * Change Consultants - All Details Recs
          GOTO      CRSCON40 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete Cross Consultation Details
          GOTO      CRSCON50 IF EQUAL
.
          MATCH     "E",UPDTTYPE       * Add Consultants - Single Record Only
          GOTO      CRSCON55 IF EQUAL
.
          GOTO      CRSCON90
.
.------------------------------------------------------------------------------
.         Add New Cross Consultation and New Consultation Details
.------------------------------------------------------------------------------
CRSCON10  MOVE      ONE,ARRINDEX
          WHILE     ARRINDEX <= 100
            MATCH     SP70,CRSCDATE[ARRINDEX]
            IF        !@EQUAL
              CALL      ADDCDT00       * Add Consultation Details
            ENDIF
            ADD       ONE,ARRINDEX
          DO
.
          MOVE      ZERO,EXIT
          GOTO      CRSCON99
.
.------------------------------------------------------------------------------
.         Update Consultation Details - Date and Time Taken
.------------------------------------------------------------------------------
CRSCON20  PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,PTCRC003,SP70
          CALL      RDPTCRC1
          BRANCH    OVRCD,CRSCON93
.
          MOVE      PTCRC005,PTCRDATE       * Set Date Seen
          MOVE      PTCRC006,PTCRAMNT       * Set Time Taken (Hours)
          MOVE      PTCRC007,PTCRMISC       * Service Code
          MOVE      PTCRC008,PTCRSPEC       * Speciality Code
          MOVE      PTCRC004,PTCRCMNT       * Comments
          MOVE      PTCRC009,PTCRTIME
          MOVE      PTCRC010,PTCRACTN
          MOVE      PTCRC011,PTCRUNIT
          MOVE      PTCRC012,PTCRCOMM
.
          CALL      UPPTCRC1                * Update Record
.
          MOVE      ZERO,EXIT
          GOTO      CRSCON99
.
.------------------------------------------------------------------------------
.         Change Consultants - for Single Consultation Details row
.------------------------------------------------------------------------------
CRSCON30  MOVE      ONE,RECNUMBR
          MOVE      RECNUMBR,KEY3
          PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,KEY3,SP70
          CALL      RDPTCRC1                * Read with new Cons details
          IF        OVRCD=0
            GOTO      CRSCON94              * Record Already exists, error
          ENDIF
.
          MOVE      PTCRC003,KEY3
          PACK      KEY31,ADMISSNO,ORIGDOCT,ORIGREFD,KEY3,SP70
          CALL      RDPTCRC1                * Read record to be updated
          BRANCH    OVRCD,CRSCON93
.
          MOVE      PTCRC001,PTCRDOCT       * Set new Referring Consultant
          MOVE      PTCRC002,PTCRREFD       * Set Referred Consultant
          MOVE      ONE,PTCRCNTR            * Set record counter
          MOVE      PTCRC004,PTCRCMNT       * Set comments
          MOVE      PTCRC005,PTCRDATE       * Set Date Seen
          MOVE      PTCRC006,PTCRAMNT       * Set Time Taken (Hours)
          MOVE      PTCRC007,PTCRMISC       * Service Code
          MOVE      PTCRC008,PTCRSPEC       * Speciality Code
          MOVE      PTCRC009,PTCRTIME
          MOVE      PTCRC010,PTCRACTN
          MOVE      PTCRC011,PTCRUNIT
          MOVE      PTCRC012,PTCRCOMM
.
          CALL      UPPTCRC1                * Update Record
.
          MOVE      ORIGDOCT,PTCRC001
          MOVE      ORIGREFD,PTCRC002
          MOVE      PTCRC003,KEY3
          CALL      UPDCNT00                * Update counter for remaining recs
.
          MOVE      SIX,NEXTPAGE            * Redirect to Cross-Cons List
.
          MOVE      ZERO,EXIT
          GOTO      CRSCON99
.
.------------------------------------------------------------------------------
.         Change Consultants - for All Cross Consultation Detail rows
.------------------------------------------------------------------------------
CRSCON40  MOVE      ONE,RECNUMBR
          MOVE      RECNUMBR,KEY3
.
          COMPARE   ZERO,SAVECNTR
          IF        !@EQUAL
            MOVE      SAVECNTR,KEY3
          ENDIF
.
          PACK      KEY31,ADMISSNO,ORIGDOCT,ORIGREFD,KEY3,SP70
          CALL      RDPTCRC1                * Read first record for cross cons
          BRANCH    OVRCD,CRSCON93
.
.         Update Comments field first
.
          MOVE      PTCRC004,PTCRCMNT       * Set Comments Field
          MOVE      PTCRC008,PTCRSPEC       * Speciality Code
          MOVE      PTCRC010,PTCRACTN       * Action Code
.         MOVE      PTCRC005,PTCRDATE       * Date
          MOVE      PTCRC009,PTCRTIME
          MOVE      PTCRC012,PTCRCOMM     
.
          CALL      UPPTCRC1                * Update Record
.
          MATCH     ORIGDOCT,PTCRC001       * Same Referring Consultant?
          IF        @EQUAL
            MATCH     ORIGREFD,PTCRC002     * Yes, same Referred Consultant?
            GOTO      CRSCON45 IF EQUAL     * Yes, finshed processing, exit.
          ENDIF
.
.         Changes in Referring/Referred Consultants. Update all records for   
.         this Cross Consultation. First ensure that new combination does not 
.         exist.
.
          PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,SP70
          CALL      RSPTCRC1
          CALL      RKPTCRC1                * Check if combination exists
          BRANCH    OVRCD,CRSCON43          * Record not found, update
.
          MATCH     ADMISSNO,DPTCRBIL       * Same Admission No.?
          GOTO      CRSCON43 IF NOT EQUAL   * No, record not found, update
.
          MATCH     PTCRC001,PTCRDOCT       * Same Referring Consultant?
          GOTO      CRSCON43 IF NOT EQUAL   * No, record not found, update
.
          MATCH     PTCRC002,PTCRREFD       * Same Referred Consultant?
          GOTO      CRSCON43 IF NOT EQUAL   * No, record not found, update
.
          GOTO      CRSCON94                * Combination exists, error
.
CRSCON43  CALL      UPDALL00                * Update All Cross Cons records
.
CRSCON45  MOVE      ZERO,EXIT
          GOTO      CRSCON99
.
.------------------------------------------------------------------------------
.         Delete Consultation Details row
.------------------------------------------------------------------------------
CRSCON50  MOVE      PTCRC003,KEY3      * Move record counter to DIM field
          PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,KEY3,SP70
          CALL      RDPTCRC1
          BRANCH    OVRCD,CRSCON93
.
          IF        PTCRCNTR=ONE
            MOVE      PTCRCMNT,SAVECMNT  * Deleting first record, save comments
          ENDIF
.
          MATCH     SP70,PTCRC002        * Blank Referred Consultant?
          IF        @EQUAL
            PACK      PTCRC008,SP70      * so we bail in GETNXT00 after delete
          ENDIF
.          
          CALL      DEPTCRC1             * Delete specified record
          CALL      UPDCNT00             * Update counter for remaining records
          CALL      GETNXT00             * Get next location to display
.
          MOVE      ZERO,EXIT
          GOTO      CRSCON99
.
.------------------------------------------------------------------------------
.                   Add Simple Cross Consultation
.------------------------------------------------------------------------------
CRSCON55  MOVE      PTCRC001,PTCRDOCT
          MOVE      PTCRC002,PTCRREFD
          MOVE      PTCRC003,PTCRCNTR
          MOVE      PTCRC004,PTCRCMNT       * Comments
          MOVE      PTCRC005,PTCRDATE       * Set Date Seen
          MOVE      PTCRC006,PTCRAMNT       * Set Time Taken (Hours)
          MOVE      PTCRC007,PTCRMISC       * Service Code
          MOVE      PTCRC008,PTCRSPEC       * Speciality Code
          MOVE      PTCRC009,PTCRTIME
          MOVE      PTCRC010,PTCRACTN
          MOVE      PTCRC011,PTCRUNIT
          MOVE      PTCRC012,PTCRCOMM
          MOVE      ADMISSNO,PTCRBILL
.
CRSCON56  PACK      KEY31,PTCRBILL,PTCRDOCT,PTCRREFD,PTCRCNTR,SP70
          CALL      RAPTCRC1
          IF        OVRCD=1
            CALL      WRPTCRC1               * Update Record
            MOVE      ZERO,EXIT
            GOTO      CRSCON99
          ELSE
            IF          F3<1000
              MOVE        PTCRCNTR,F3
              ADD         ONE,F3
              MOVE        F3,PTCRCNTR
              GOTO        CRSCON56
            ENDIF
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CRSCON99
.
.------------------------------------------------------------------------------
.                   Display Consultation Details 
.------------------------------------------------------------------------------
CRSCON60  PACK      KEY8,URNUMBER,SP70   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,CRSCON91
          CALL      RDPMPX21
.
          CALL      CLEMRVIS             * Clear emergency visit file vars
          CALL      CLPATMIS             * Clear admission file vars

          PACK      KEY8,ADMISSNO,SP70   * Read Visit File
          CALL      RDVISA1
          BRANCH    OVRCD,CRSCON92
.
          BRANCH    PVITYPE,CRSCON65,CRSCON92,CRSCON70
          GOTO      CRSCON92
.
CRSCON65  PACK      KEY8,ADMISSNO,SP70   * Read Emergency Visit File
          CALL      RDEMVIS1
          BRANCH    OVRCD,CRSCON92
.
          GOTO      CRSCON75
.
CRSCON70  PACK      KEY8,ADMISSNO,SP70   * Read Admission File
          CALL      RDMISS1
          BRANCH    OVRCD,CRSCON92
.
CRSCON75  MATCH     SP70,PTCRC001
          GOTO      CRSCON80 IF EQUAL
.         MATCH     SP70,PTCRC002
.         GOTO      CRSCON80 IF EQUAL
.
.         ** Note: CAR 270231 - Referred HCP (PTCRC002) can now be blank
.
.
.         Read first record for given cross consultation combination.
.         The cross consultation comments are stored only on the first record.
.
          MOVE      ONE,RECNUMBR
          MOVE      RECNUMBR,KEY3
          PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,KEY3,SP70
          CALL      RDPTCRC1
          BRANCH    OVRCD,CRSCON93
.
          MOVE      PTCRCMNT,PTCOMENT       * Save comment Field fo display
          MOVE      PTCRDATE,SAVEDATE
.
.         Read specific cross consultation record (with record counter value)
.
          COMPARE   PTCRC003,ZERO
          GOTO      CRSCON80 IF EQUAL
.
          MOVE      PTCRC003,RECNUMBR
          MOVE      RECNUMBR,KEY3
          PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,KEY3,SP70
          CALL      RDPTCRC1
          BRANCH    OVRCD,CRSCON93
.
          MOVE      PTCRCMNT,PTCOMENT       * Save comment Field fo display
          MOVE      PTCRDATE,SAVEDATE
.
CRSCON80  CLEAR     WEBTITLE
          MOVE      "Cross Consulting Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CRSCON99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      CRSCON99
.
CRSCON90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CRSCON99
.
CRSCON91  MOVE      "Can't find patient Master Details. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CRSCON99
.
CRSCON92  MOVE      "Can't find patient Admission Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CRSCON99
.
CRSCON93  MOVE      "Can't find patient Cross Consulting Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CRSCON99
.
CRSCON94  MOVE      "Combination Already Exists - Update not performed",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CRSCON99
.
CRSCON99  RETURN
.
.------------------------------------------------------------------------------
.                   View Cross Consulting List
.------------------------------------------------------------------------------
SHCC0000  CALL      CURPER00   * Determine Current Period
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
          MOVE      "Cross Consultations",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SHCC9999
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
.
SHCC9999  RETURN
.------------------------------------------------------------------------------
.         Cross Consultation Filteres
.------------------------------------------------------------------------------
CCFL0000  BRANCH    FLDITMNO,CCFL0010,CCFL0020,CCFL0030,CCFL0040
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      CCFL9999   
.
CCFL0010  CALL      HCPCOD00
          GOTO      CCFL9999
.
CCFL0020  WRITE     HTMLFILE;SPECIALT;
          GOTO      CCFL9999
.
CCFL0030  WRITE     HTMLFILE;ACACTION;
          GOTO      CCFL9999
.
CCFL0040  WRITE     HTMLFILE;OPTNFLTR;
          GOTO      CCFL9999
.
CCFL9999  RETURN
.------------------------------------------------------------
. Output Code or Name of HCP for List Filter Display
.    Tag Parameter .0 = Code
.                  .1 = Formatted Name
.------------------------------------------------------------
HCPCOD00  UNPACK    DIM127,KEY1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          BRANCH    F1,HCPCOD10
          WRITE     HTMLFILE;REFTOCON;
          GOTO      HCPCOD99
.
HCPCOD10  PACK      KEY10,REFTOCON,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,HCPCOD99
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
.
HCPCOD99  RETURN
.------------------------------------------------------------------------------
.                   Clear Cross Consulting Variables
.------------------------------------------------------------------------------
CLCC0000  MOVE      SP70,PTCRBILL
          MOVE      SP70,PTCRDOCT
          MOVE      SP70,PTCRREFD
          MOVE      SP70,PTCRCNTR
          MOVE      SP70,PTCRCMNT
          MOVE      SP70,PTCRDATE
          MOVE      ZERO,PTCRAMNT
          MOVE      SP70,PTCRMISC
          MOVE      SP70,PTCRSPEC
          MOVE      SP70,PTCRTIME
          MOVE      SP70,PTCRACTN
          MOVE      SP70,PTCRUNIT
          PACK      PTCRCOMM,SP70,SP70
          PACK      PTCRSPAR,SP70,SP70
CLCC9999  RETURN
.------------------------------------------------------------------------------
.         Cross Consultation Calendar Options/Filters
.------------------------------------------------------------------------------
CCAL0000  BRANCH    FLDITMNO,CCAL0010,CCAL0020,CCAL0030,CCAL0040,CCAL0050:
                             CCAL0060
          GOTO      CCAL9999
.
CCAL0010  CALL      PRCC0000
          GOTO      CCAL9999
.
CCAL0020  CALL      NECC0000
          GOTO      CCAL9999
.
CCAL0030  CALL      SELV0000
          GOTO      CCAL9999
.
CCAL0040  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      CCAL9999
.
CCAL0050  WRITE     HTMLFILE;FRSTDATE;
          GOTO      CCAL9999
.
CCAL0060  WRITE     HTMLFILE;LASTDATE;
          GOTO      CCAL9999
.
CCAL9999  RETURN
.------------------------------------------------------------------------------
.         OEC list search and filter by date
.------------------------------------------------------------------------------
OECD0000  BRANCH    FLDITMNO,OECD0010,OECD0020,OECD0030,OECD0040
          GOTO      OECD9999
.
OECD0010  CALL      PRCC0000
          GOTO      OECD9999
.
OECD0020  CALL      NECC0000
          GOTO      OECD9999
.
OECD0030  CALL      SELV0000
          GOTO      OECD9999
.
OECD0040  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      OECD9999
.
OECD9999  RETURN
.------------------------------------------------------------------------------
.         Cross consulting list
.------------------------------------------------------------------------------
VWCC0000  PACK      KEY39,FRSTDATE,SP70
.
VWCC0100  CALL      RSPTCRC5
VWCC0101  CALL      RKPTCRC5
          BRANCH    OVRCD,VWCC9999
.
          MATCH     PTCRDATE,LASTDATE
          GOTO      VWCC9999 IF LESS
.
          MATCH     SP3,SPECIALT
          IF        !@EQUAL
            MATCH     SPECIALT,PTCRSPEC
            GOTO      VWCC0101 IF NOT EQUAL
          ENDIF
.
          MATCH     SP3,ACACTION
          IF        !@EQUAL
            MATCH     ACACTION,PTCRACTN
            GOTO      VWCC0101 IF NOT EQUAL
          ENDIF
.
          PACK      KEY8,DPTCRBIL,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            GOTO      VWCC0101
          ENDIF
          MATCH     SP70,OPTNFLTR
          IF        @EQUAL
            PACK      OPTNFLTR,ONE,SP70    * default to 1 for current inpatients
          ENDIF
.
          MATCH     OPTNFLTR,DEMVISTA
          GOTO      VWCC0101 IF NOT EQUAL
.
          MATCH     SP70,REFTOCON
          IF        !@EQUAL
            MATCH     REFTOCON,PTCRREFD
            GOTO      VWCC0101 IF NOT EQUAL
          ENDIF
.
          PACK      KEY8,PTCRBILL
          CALL      RDEMVIS1
          BRANCH    OVRCD,VWCC0101               * No EMR Visit Details
.
VWCC0200  PACK      KEY8,EMVIURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,VWCC0101
.
          PACK      KEY8,EMVIURNO,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,VWCC0101
.
          CALL      IBACLOCK
          IF        PCEASE=1
            MOVE      PDECDTE,AGEDATE            * Date of Death
          ELSE
            PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
          ENDIF
          REP       " 0",AGEDATE
.
          CALL      CALCAGE
          CALL      PATLN000               * Formate Patients Name
          CALL      PATFLD00
          MOVE      KEY3,FOLDERSF          * Save folder suffix
.
          CALL      GETALR000              * Get alert icons
.
          MOVE      SP70,DIM70
          MOVE      PTCRDOCT,KEY10
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE 
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000         
            MOVE      DOCFNAME,DIM70
          ENDIF
.
          MOVE      SP70,DIM70A
          MOVE      PTCRREFD,KEY10
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE 
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000         
            MOVE      DOCFNAME,DIM70A
          ENDIF
.
          MATCH     SP70,PTCRSPEC
          IF        !@EQUAL
            PACK      KEY5,ANSA,ANSC,PTCRSPEC
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      SP70,KEY20
            ELSE
              MOVE      TDESC,KEY20
            ENDIF
          ELSE
            MOVE      SP70,KEY20
          ENDIF
.
          MATCH     SP70,EMVIUC20
          IF        !@EQUAL
            PACK      KEY5,CATel,EMVIUC20
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      SP70,SEMVICO1
            ELSE
              MOVE      TDESC,SEMVICO1
            ENDIF
          ELSE
            MOVE      SP70,SEMVICO1
          ENDIF
.
          CALL      GETDI000           * Get complaint/diagnosis
.
VWCC0300  PACK      KEY3,EMVILOCN,SP70
          CALL      RDEMLOC1
          IF        OVRCD=1
            MOVE      SP70,EMLODESC
          ENDIF
.
          MATCH     SP3,PTCRACTN
          IF        !@EQUAL
            PACK      KEY5,CTAc,PTCRACTN
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      SP70,TDESC
            ENDIF
          ELSE
            MOVE        SP70,TDESC
          ENDIF
.
          UNPACK    PTCRDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPCDATE
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          PACK      KEY5,PTCRTIME
.
          CLEAR     HTMLLINK
          APPEND    "javascript:SelectPatient('",HTMLLINK
          APPEND    EMVIURNO,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EMVIADMN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",DIM11,SP1,KEY5,"#",":
                             "#"",FORMATNM,ALRTIMGT,"#",":
                             "#"",COMPDIAG,"#",":
                             "#"",EMLODESC,"#",":
                             "#"",DIM70,"#",":
                             "#"",DIM70A,"#",":
                             "#"",KEY20,"#",":
                             "#"",TDESC,"#",":
                             "#"",FOLDERSF,"#")"
.
          GOTO      VWCC0101
.
VWCC9999  RETURN
.------------------------------------------------------------------------------
. Remote Scripting for Bed Transfers/Admission and AN-SNAP Auto Classification
.------------------------------------------------------------------------------
REMOTE00  CALL      XMLHED00
          BRANCH    EXIT,REMOTE99
.
          BRANCH    REMOTENO,REMOTE10,REMOTE20,REMOTE30
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                    " INVALID UPDATE TYPE ":
                    "</RETURN_VALUE>"
          GOTO      REMOTE90
.
REMOTE10  CALL      CHKDTE00           * Check Cross Consultation Details - Date
          GOTO      REMOTE90
.
REMOTE20  CALL      CHKCMB00           * Check Cross Consultation Combination
          GOTO      REMOTE90
.
REMOTE30  CALL      AACC0000           * Check for AN-SNAP Auto Classification
          GOTO      REMOTE90
.
REMOTE90  CALL      XMLEND00
.
REMOTE99  RETURN
.
.-----------------------------------------------------------
.  Update Codes after Invoiced
.-----------------------------------------------------------
UCOD0000  MOVE      URNUMBER,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,UCOD7100
          CALL      RDPMPX21
.
          MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,UCOD7200
.
          CALL      RDPMVX11
          BRANCH    OVRCD,UCOD7210
.
          CALL      GASF0000                * Get admis SFA file stuff
.
          COMPARE   ZERO,AINVPRT        * Check for no of invoices printed
          GOTO      UCOD7300 IF EQUAL
.
.         Can not change claim code if Accum.Fees parameter set to 'Claim code'
.
          MATCH     SP70,UPDTTYPE
          IF        @EQUAL
            IF        CHNGCTYP=1 
              COMPARE   FIVE,CACCFEE
              GOTO      UCOD7500 IF EQUAL
            ENDIF
          ENDIF  
.
          CALL      CLCAU000            * Clear Code Change fields
.
          MATCH     "1",UPDTTYPE
          GOTO      UCOD1000 IF EQUAL   * Change claim code
          MATCH     "2",UPDTTYPE
          GOTO      UCOD2000 IF EQUAL   * Change admission type
          MATCH     "3",UPDTTYPE
          GOTO      UCOD3000 IF EQUAL   * Change health fund
          GOTO      UCOD8000
.
.         Changing Claim code
.
UCOD1000  MATCH     ACLAIM,PTMIS027
          GOTO      UCOD1200 IF NOT EQUAL
.
          COMPARE   FOUR,PTCNHDPS
          GOTO      UCOD7400 IF NOT EQUAL   * Not Queensland
.
          MATCH     PTASF001,Z70
          IF        !@EQUAL
            MATCH     PTASF001,PTAFCTYP
            GOTO      UCOD1200 IF NOT EQUAL
          ENDIF
.
          MATCH     PTASF002,Z70
          IF        !@EQUAL
            MATCH     PTASF002,PTAFCROL
            GOTO      UCOD1200 IF NOT EQUAL
          ENDIF
.
          MATCH     PTASF003,Z70
          IF        !@EQUAL
            MATCH     PTASF003,PTAFCSID
            GOTO      UCOD1200 IF NOT EQUAL
          ENDIF
          GOTO      UCOD7400
.
UCOD1200  MOVE      ACLAIM,PMCAOCLM     * Save Old claim code
          MOVE      PTMIS027,ACLAIM
          CALL      UPMISS1
.
          CALL      UASF0000            * Update Special funding arrangement
.
          MOVE      PTMIS027,PMCANCLM   * New claim code
          PACK      KEY14,PTMIS027,SP70
          CALL      UAUD0000            * Update Change audit file
.
          CALL      WEDI0000            * Write EDWARD IP visit update
.
          CALL      WARN0000
          MOVE      ONE,EXIT
          GOTO      UCOD9999
.
.         Changing Admission Type
.
UCOD2000  MATCH     ATYPE,PTMIS010
          GOTO      UCOD7400 IF EQUAL   * not changed
.
          MOVE      ATYPE,PMCAOATY      * Save Old admission type
          MOVE      PTMIS010,ATYPE
          CALL      UPMISS1
.
          MOVE      PTMIS010,PMCANATY   * New admission type
          PACK      KEY14,PTMIS010,SP70
          CALL      UAUD0000            * Update Change audit file
          CALL      WARN0000
          MOVE      ONE,EXIT
          GOTO      UCOD9999
.
.         Changing Health fund
.
UCOD3000  MATCH     AFUNDH,PTMIS013
          GOTO      UCOD3200 IF NOT EQUAL
          MATCH     AFNDTB,PTMIS014
          GOTO      UCOD3200 IF NOT EQUAL   * changed
          PACK      PTMIS015,PTMIS015,SP70
          MATCH     PMVXFNDM,PTMIS015
          GOTO      UCOD7400 IF EQUAL       * not changed
.
UCOD3200  MOVE      AFUNDH,PMCAOHFN     * Save Old health fund
          MOVE      AFNDTB,PMCAOHFT     * Save Old health fund table
          MOVE      PTMIS013,PMCANHFN   * New health fund
          MOVE      PTMIS014,PMCANHFT   * New health fund table
          PACK      KEY14,PTMIS013,PTMIS014,SP70
          CALL      UAUD0000           * Update Change audit file
.
          MOVE      PTMIS013,AFUNDH
          MOVE      PTMIS014,AFNDTB
          MOVE      PTMIS015,AFNDMM
          MOVE      PTMIS015,PMVXFNDM
          CALL      UPMISS1
          CALL      UPPMVX11
.
          MATCH     "1",PTCNPMHF           * Option to Update PMI HF ?
          GOTO      UCOD3300 IF NOT EQUAL  * default to Update PMI HF
.
          MATCH     "1",UPDHFUND
          GOTO      UCOD3400 IF EQUAL      * Not to Update PMI HF
.
UCOD3300  CALL      EDWH0000               * EDWARD Health Fund trigger 
          MOVE      PTMIS013,PFUNDH
          MOVE      PTMIS014,PFNDTB
          MOVE      PTMIS015,PFNDMM
          CALL      UPMAST1
.
UCOD3400  CALL      WARN0000
          MOVE      ONE,EXIT
          GOTO      UCOD9999
.
UCOD7100  MOVE      "Missing Master record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCOD9999
.
UCOD7200  MOVE      "Missing Admission record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCOD9999
.
UCOD7210  MOVE      "Missing Visit extension file record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCOD9999
.
UCOD7300  MOVE      "Invoice has not been Printed yet.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCOD9999
.
UCOD7400  MOVE      "Update Not Required - Code Not Changed!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCOD9999
.
UCOD7500  CLEAR     WEBTITLE
          APPEND    "Claim Type cannot be changed ",WEBTITLE
          APPEND    "as Fees Invoiced is ",WEBTITLE
          APPEND    "accumulated by Claim Type.",WEBTITLE
          APPEND    SP70,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCOD9999
.
UCOD8000  CLEAR     WEBTITLE
          MOVE      "Changing Code after Invoice",WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,UCOD9999
.
          CALL      WEBBOD00   * Output Templated Body of HTML
          CALL      WEBEND00   * Output End of Web Page
          MOVE      ONE,EXIT
UCOD9999  RETURN
+
.------------------------------------------------------------
. GASF0000 - From IBAHOS03
. Get admission SFA file stuff
.------------------------------------------------------------
GASF0000  PACK      KEY25,AADMNO,ANSA,SP30
          CALL      RDPTASF1                * Read an admin SFA file record
          BRANCH    OVRCD,GASF1000
.
          MATCH     AADMNO,PTAFADMN
          GOTO      GASF1000 IF NOT EQUAL   * Different admin no
.
          MATCH     ANSA,PTAFTYPE
          GOTO      GASF9000 IF EQUAL       * An admin SFA type
.
GASF1000  MOVE      ZEROVISN,PTAFADMN
          UNPACK    SP30,PTAFTYPE,PTAFDATE,PTAFTIME,PTAFCODE,PTAFCTYP
          UNPACK    SP30,PTAFCROL,PTAFCSID,PTAFSPAR
.
GASF9000  MOVE      ZERO,EXIT
.
GASF9999  RETURN
+
.-----------------------------------------------------------
.         Update Special funding arrangement
.-----------------------------------------------------------
UASF0000  COMPARE   FOUR,PTCNHDPS
          GOTO      UASF9999 IF NOT EQUAL   * NOT Queensland
.
          MATCH     PTASF001,Z70
          IF        !@EQUAL
            MOVE      PTASF001,PTAFCTYP
          ENDIF
.
          MATCH     PTASF002,Z70
          IF        !@EQUAL
            MOVE      PTASF002,PTAFCROL
          ENDIF
.
          MATCH     PTASF003,Z70
          IF        !@EQUAL
            MOVE      PTASF003,PTAFCSID
          ENDIF
.
          MATCH     "S ",PTCNQCCT           * Using Cat S for contract details?
          GOTO      UASF0060 IF EQUAL       * yes
.
          PACK      KEY5,ANSC,ANSL,ACLAIM
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      "0",ANS
            MOVE      ZERO,FORM1
            UNPACK    TCINDC9,ANS
            REP       "P1",ANS
            MOVE      ANS,FORM1
            BRANCH    FORM1,UASF0100      * valid contract
            GOTO      UASF1000            * remove the reord
          ENDIF
.
          GOTO      UASF0100
.
UASF0060  PACK      KEY5,ANSS,SP1,ASRCE
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      "0",ANS
            MOVE      ZERO,FORM1
            UNPACK    TCINDC8,ANS
            REP       "P1",ANS
            MOVE      ANS,FORM1
            BRANCH    FORM1,UASF0100      * valid contract
            GOTO      UASF1000            * remove the reord
          ENDIF
.
UASF0100  MATCH     SP1,PTAFCTYP
          GOTO      UASF0200 IF NOT EQUAL   * Blank contract type, delete record
.
          MATCH     SP1,PTAFCROL
          GOTO      UASF0200 IF NOT EQUAL   * Blank contract type, delete record
.
          COMPARE   FOUR,PTCNHDPS
          GOTO      UASF0200 IF EQUAL       * Queensland
.
          MATCH     SP5,PTAFCSID
          GOTO      UASF1000 IF EQUAL
.
UASF0200  MOVE      AADMNO,PTAFADMN
          MOVE      "A",PTAFTYPE
          MOVE      SP8,PTAFDATE
          MOVE      SP8,PTAFTIME
          MOVE      SP70,PTAFSPAR
          PACK      KEY25,PTAFADMN,PTAFTYPE,PTAFDATE,PTAFTIME
          CALL      RAPTASF1                * Read an admin SFA file record
          IF        OVRCD=1
            CALL      WRPTASF1              * Write an admin SFA file record
          ELSE
            CALL      UPPTASF1              * Update an admin SFA file record
          ENDIF
          GOTO      UASF9999
.
UASF1000  PACK      KEY25,AADMNO,ANSA,SP70
          CALL      RDPTASF1                * Read an admin SFA file record
          IF        OVRCD=0
            PACK      KEY25,AADMNO,ANSA,PTAFDATE,PTAFTIME
            CALL      DEPTASF1              * Delete an admin SFA file record
          ENDIF
.
UASF9999  RETURN
+
.-----------------------------------------------------------
.         Ventilation details
.-----------------------------------------------------------
VENT0000  RESET     UPDTTYPE
          CALL      CLVENT00
          MATCH     SP70,UPDTTYPE
          GOTO      VENT1000 IF EQUAL
          MATCH     "A",UPDTTYPE
          GOTO      VENT2000 IF EQUAL    * Add
          MATCH     "U",UPDTTYPE
          GOTO      VENT3000 IF EQUAL    * Change
          MATCH     "D",UPDTTYPE
          GOTO      VENT4000 IF EQUAL    * Delete
          GOTO      VENT8000
.
VENT1000  MOVE      URNUMBER,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,VENT7100
          CALL      RDPMPX21
.
          MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,VENT7200
.
          PACK      KEY27,ADMISSNO,PTVEN001,STARTDAT,PTVEN003,SP70
          CALL      RDPTVEN1
          IF        OVRCD=1
            CALL      CLVENT00
          ENDIF
          GOTO      VENT8000
.
.         Add record
.
VENT2000  PACK      KEY27,ADMISSNO,PTVEN001,PTVEN002,PTVEN003
          CALL      RDPTVEN1
          COMPARE   ZERO,OVRCD
          GOTO      VENT7300 IF EQUAL
.
          CALL      VDTM0000          * Validate Start/End Date and Time
          BRANCH    EXIT,VENT9999
.
          MOVE      ADMISSNO,PTVEVISN
          MOVE      PTVEN001,PTVEVTYP
          MOVE      PTVEN002,PTVESDAT
          MOVE      PTVEN003,PTVESTIM
          MOVE      PTVEN004,PTVEEDAT
          MOVE      PTVEN005,PTVEETIM
          CALL      CHRS0000          * Calculate the hrs
          MOVE      PTVEN007,PTVEICUS
          MOVE      PTVEN008,PTVEISIT
          PACK      PTVESPAR,SP70
          CALL      WRPTVEN1
          CALL      UICU0000          * Update Patient ICU file
          MOVE      ZERO,EXIT
          GOTO      VENT9999
.
.         Change 
.
VENT3000  PACK      KEY27,ADMISSNO,PTVEN001,STARTDAT,PTVEN003
          CALL      RDPTVEN1
          BRANCH    OVRCD,VENT7400
.
          MOVE      PTVESDAT,PTVEN002
          CALL      VDTM0000          * Validate Start/End Date and Time
          BRANCH    EXIT,VENT9999
.
          MOVE      PTVEN004,PTVEEDAT
          MOVE      PTVEN005,PTVEETIM
          CALL      CHRS0000          * Calculate the hrs
          MOVE      PTVEN007,PTVEICUS
          MOVE      PTVEN008,PTVEISIT
          CALL      UPPTVEN1
          CALL      UICU0000          * Update Patient ICU file
          MOVE      ZERO,EXIT
          GOTO      VENT9999
.
.         Delete
.
VENT4000  PACK      KEY27,ADMISSNO,PTVEN001,STARTDAT,PTVEN003
          CALL      DEPTVEN1
          CALL      UICU0000          * Update Patient ICU file
          MOVE      ZERO,EXIT
          GOTO      VENT9999
.
VENT7100  MOVE      "Missing Master record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VENT9999
.
VENT7200  MOVE      "Missing Admission record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VENT9999
.
VENT7300  MOVE  "Record already exists for this Ventilation Date/Time.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VENT9999
.
VENT7400  MOVE      "Record doesn't exit.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VENT9999
.
VENT8000  CLEAR     WEBTITLE
          MOVE      "Ventilation Details",WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,VENT9999
.
          CALL      WEBBOD00   * Output Templated Body of HTML
          CALL      WEBEND00   * Output End of Web Page
          MOVE      ONE,EXIT
.
VENT9999  RETURN
+
.-----------------------------------------------------------
.         Eligibility check
.-----------------------------------------------------------
ELGB0000  RESET     UPDTTYPE
          CALL      CLRELG00           * Clear fields
          CALL      CLPFED00
.
          MOVE      URNUMBER,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,ELGB7100
.
          CALL      RDPMPX21
.
          MATCH     "1",PTCNIFCL
          GOTO      ELGB0100 IF EQUAL        * HEA IFC
          MATCH     "2",PTCNIFCL
          GOTO      ELGB0200 IF NOT EQUAL
.
ELGB0100  COMPARE   ONE,PMELIFLG
          GOTO      ELGB8000 IF NOT EQUAL
.
ELGB0200  MATCH     SP70,UPDTTYPE
          GOTO      ELGB1000 IF EQUAL
          MATCH     "U",UPDTTYPE
          GOTO      ELGB2000 IF EQUAL    * Change
          MATCH     "C",UPDTTYPE
          GOTO      ELGB5400 IF EQUAL    * Update Comment
          MATCH     "P",UPDTTYPE
          GOTO      ELGB5500 IF EQUAL    * Update Out of Pocket
          GOTO      ELGB8000
.
.         Validate the admission
.
ELGB1000  CALL      CLPATMIS             * Clear admission file vars
          MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          COMPARE   ZERO,OVRCD
          GOTO      ELGB1200 IF EQUAL    * valid admission
.
          CALL      RDBKREC1
          IF        OVRCD=1
            MATCH     "009",TEMPLATE
            GOTO      ELGB1200 IF EQUAL  * OEC Master Response List
            MATCH     "013",TEMPLATE
            GOTO      ELGB1200 IF EQUAL  * Emergency OEC List
            GOTO      ELGB7200           * invalid theatre booking
          ENDIF
          MOVE      BKRECLMT,ACLAIM
          MOVE      BKREEDAT,ADATE
          MOVE      ZERO,ASTAY
.
ELGB1200  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMVX11
          IF        OVRCD<>1
            MATCH     SP70,PMVXMHOS
            IF        !@EQUAL
              PACK      KEY3,PMVXMHOS,SP70
              CALL      RDPTHSP1
              IF        OVRCD=1
                CALL      CLPATHSP
              ENDIF
            ENDIF
          ENDIF
.
          PACK      KEY11,AADMNO,ACLAIM,SP70
          CALL      RDPMEXT1                 * extra compensable details
          IF        OVRCD<>0
            CALL      CLPMSEXT
          ENDIF
.  
          MATCH     SP70,AFNDCG              * fund cover change
          IF        @EQUAL
            MOVE      PFNDCG,AFNDCG          * default from master record
          ENDIF
.
          MATCH     SP70,AFNDYY              * period with fund
          IF        @EQUAL
            MOVE      PFNDYY,AFNDYY          * default from master record
          ENDIF
.
          MOVE      ZERO,ECLPHFRN
          MOVE      ZERO,ECLPHFPN
          MOVE      ZERO,ECLPFINA
          MOVE      ZERO,ECLPCPRP
          MOVE      ZERO,ECLPEFTA
          MOVE      ZERO,ECLPSTPA
          MOVE      ZERO,ECLPEXEX
.
          MOVE      ADMISSNO,KEY8
          CALL      RDPTELG1
          IF        OVRCD=1
            CALL      CLRELG00           * Clear fields
          ENDIF
.
.*********************************************
.
          MATCH     "1",OLDOECIN
          GOTO      ELGB1240 IF EQUAL
.
          MATCH     "1",PTCNWSIN
          GOTO      ELGB1240 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      ELGB1240 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      ELGB1240 IF NOT EQUAL
.
          MATCH     "007",TEMPLATE
          IF        @EQUAL
              CALL      CLWBEH00
              GOTO      ELGB1300
          ENDIF
.
          CALL      CLWEBOEC
          CALL      CLWEBELF
.
ELGB1220  MOVE      ZERO,SAVEINDC
          MOVE      SP70,SAVEPRIM
.
          MATCH     "OECLS",FORMACTN
          IF        @EQUAL
.
            MATCH     SP70,REPCOUNT
            GOTO      ELGB1225 IF EQUAL
            GOTO      ELGB1225 IF EOS
.
            MOVE      ADMISSNO,KEY20
            LJUSTIFY  KEY20
            PACK      KEY23,KEY20,REPCOUNT,SP70
            CALL      RDWBEEH1
            IF        OVRCD=1
              CALL      CLWBEH00
            ENDIF
.
            PACK      KEY11,ADMISSNO,REPCOUNT,SP70
            CALL      RDWBOEC1
            IF        OVRCD=0
              MATCH     SP70,WBOCELEG
              IF        !@EQUAL
                PACK      KEY8,WBOCELEG,SP70
                CALL      RDWBELF1
                IF        OVRCD=1
                  CALL      CLWEBELF
                ELSE
                  MOVE      WBEFPRIM,SAVEPRIM
                ENDIF
              ENDIF
            ENDIF
.
          ELSE
.
ELGB1225    MOVE      ZERO,REDECFBT
            MOVE      ADMISSNO,KEY20
            LJUSTIFY  KEY20
            PACK      KEY23,KEY20,Z70
            CALL      RSWBEEH1
            CALL      RPWBEEH1
.           BRANCH    OVRCD,ELGB1300
            IF        OVRCD=1
              CALL      CLWBEH00
              GOTO      ELGB1300
            ELSE
.
              MATCH     KEY20,WBEHARID
              IF        @EQUAL
                PACK      KEY11,ADMISSNO,WBEHRPTC,SP70
                CALL      RDWBOEC1
                IF        OVRCD=0
                  MATCH     SP70,WBOCELEG
                  IF        !@EQUAL
                    PACK      KEY8,WBOCELEG,SP70
                    CALL      RDWBELF1
                    IF        OVRCD=1
                      CALL      CLWEBELF
                    ELSE
                      MOVE      WBEFPRIM,SAVEPRIM
                    ENDIF
                  ENDIF
                ENDIF
              ENDIF
.
            ENDIF
.
          ENDIF
.
          MATCH     KEY20,WBEHARID
.         GOTO      ELGB1300 IF NOT EQUAL
          IF        !@EQUAL
            CALL      CLWBEH00
            GOTO      ELGB1300
          ENDIF
.
          MOVE      ONE,REDECFBT
.
          MATCH     SP70,PTELHFRN
          IF        @EQUAL | @EOS
            MATCH     SP70,WBEHFRID
            IF        !@EQUAL & !@EOS
              MOVE      WBEHFRID,PTELHFRN
              MOVE      ONE,ECLPHFRN
            ENDIF
          ENDIF
.
          PACK      PTELHFPN,PTELHFPN,SP70
          MATCH     SP70,PTELHFPN
          IF        @EQUAL | @EOS
            PACK      WBEHTNAM,WBEHTNAM,SP70
            MATCH     SP70,WBEHTNAM
             IF        !@EQUAL & !@EOS
              MOVE      WBEHTNAM,PTELHFPN
              MOVE      ONE,ECLPHFPN
            ENDIF
          ENDIF
.
          MATCH     SP70,PTELFINC
          IF        @EQUAL | @EOS
            MATCH     SP70,WBEHFSTA
            IF        !@EQUAL & !@EOS
              MATCH     "Y",WBEHFSTA
              IF        @EQUAL
                MOVE      ONE,PTELFINC
              ELSE
                MOVE      ZERO,PTELFINC
              ENDIF
              MOVE      ONE,ECLPFINA
            ENDIF
          ENDIF
.
          COMPARE   ZERO,PTELPPRI
          IF        @EQUAL
            MATCH     SP70,WBEHCPAM
            IF        !@EQUAL & !@EOS
              MOVE      SP70,DIM9
              MOVE      WBEHCPAM,DIM9
              RJUSTIFY  DIM9
              UNPACK    DIM9,DIM7,DIM2
              PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
              MATCH     SP70,PTELCMPL
              IF        @EQUAL
                MOVE      DIM10,PTELPPRI   * only overwrite if no patelgaf rec
                MOVE      ONE,ECLPCPRP
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,WBEFISTY
          IF        @EQUAL | @EOS
           COMPARE   ZERO,PTELXCSS
           IF        @EQUAL
              MATCH     SP70,WBEHEXAM
              IF        !@EQUAL & !@EOS
                MOVE      SP70,DIM9
                MOVE      WBEHEXAM,DIM9
                RJUSTIFY  DIM9
                UNPACK    DIM9,DIM7,DIM2
                PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
                MATCH     SP70,PTELCMPL
                IF        @EQUAL
                  MOVE      DIM10,PTELXCSS   * only overwrite if no patelgaf rec
                  MOVE      ONE,ECLPEFTA
                ENDIF
              ENDIF
            ENDIF
          ELSE
.
            MOVE      "VI",CATEGORY
            MOVE      WBEFISTY,CODE
            CALL      GETCOD00
.
            MATCH     SP70,TCINDC1
            IF        @EQUAL | @EOS
              COMPARE   ZERO,PTELXCSS
              IF        @EQUAL
                MATCH     SP70,WBEHEXAM
                IF        !@EQUAL & !@EOS
                  MOVE      SP70,DIM9
                  MOVE      WBEHEXAM,DIM9
                  RJUSTIFY  DIM9
                  UNPACK    DIM9,DIM7,DIM2
                  PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
                  MATCH     SP70,PTELCMPL
                  IF        @EQUAL
                    MOVE      DIM10,PTELXCSS * only overwrite if no patelgaf rec
                    MOVE      ONE,ECLPEFTA
                  ENDIF
                ENDIF
              ENDIF
            ELSE
.
              MATCH      "1",TCINDC1
              IF         @EQUAL
                COMPARE   ZERO,PTELXCSS
                IF        @EQUAL
                  MATCH     SP70,WBEHEXAM
                  IF        !@EQUAL & !@EOS
                    MOVE      SP70,DIM9
                    MOVE      WBEHEXAM,DIM9
                    RJUSTIFY  DIM9
                    UNPACK    DIM9,DIM7,DIM2
                    PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
                    MATCH     SP70,PTELCMPL
                    IF        @EQUAL
                      MOVE      DIM10,PTELXCSS
                      MOVE      ONE,ECLPEFTA
                    ENDIF
                  ENDIF
                ENDIF
                GOTO       ELGB1235
              ENDIF
.
              MATCH      "2",TCINDC1
              IF         @EQUAL
                COMPARE   ZERO,PTELXCSD
                IF        @EQUAL
                  MATCH     SP70,WBEHEXAM
                  IF        !@EQUAL & !@EOS
                    MOVE      SP70,DIM9
                    MOVE      WBEHEXAM,DIM9
                    RJUSTIFY  DIM9
                    UNPACK    DIM9,DIM7,DIM2
                    PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
                    MATCH     SP70,PTELCMPL
                    IF        @EQUAL
                      MOVE      DIM10,PTELXCSD
                      MOVE      ONE,ECLPEFTA
                    ENDIF
                  ENDIF
                ENDIF
                GOTO       ELGB1235
              ENDIF
.
              COMPARE   ZERO,PTELXCSS
              IF        @EQUAL
                MATCH     SP70,WBEHEXAM
                IF        !@EQUAL & !@EOS
                  MOVE      SP70,DIM9
                  MOVE      WBEHEXAM,DIM9
                  RJUSTIFY  DIM9
                  UNPACK    DIM9,DIM7,DIM2
                  PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
                  MATCH     SP70,PTELCMPL
                  IF        @EQUAL
                    MOVE      DIM10,PTELXCSS * only overwrite if no patelgaf rec
                    MOVE      ONE,ECLPEFTA
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
ELGB1235  MATCH     SP70,PTELSPEA
          IF        @EQUAL | @EOS
            MATCH     SP70,WBEHPEAI
            IF        !@EQUAL & !@EOS
              MATCH     "Y",WBEHPEAI
              IF        @EQUAL
                MOVE      ONE,PTELSPEA
              ELSE
                MOVE      ZERO,PTELSPEA
              ENDIF
              MOVE      ONE,ECLPSTPA
            ENDIF
          ENDIF
.
          MATCH     SP70,PTELXCLS
          IF        @EQUAL | @EOS
            MATCH     SP70,WBEHEXDI
            IF        !@EQUAL & !@EOS
              MOVE      WBEHEXDI,PTELXCLS
              MOVE      ONE,ECLPEXEX
            ENDIF
          ENDIF
.
          MOVE      ONE,SAVEINDC
          MOVE      PTELHFRN,SAVEHFRN
          MOVE      PTELHFPN,SAVEHFPN
          MOVE      PTELFINC,SAVEFINC
          MOVE      PTELPPRI,SAVEPPRI
          MOVE      PTELXCSS,SAVEXCSS
          MOVE      PTELXCSD,SAVEXCSD
          MOVE      PTELSPEA,SAVESPEA
          MOVE      PTELXCLS,SAVEXCLS
.
          GOTO      ELGB1300             
.
.*********************************************
.
ELGB1240  MATCH     "1",OLDOECIN
          GOTO      ELGB1245 IF EQUAL
.
          MATCH     "1",PTCNOECE
          GOTO      ELGB1300 IF EQUAL
.
ELGB1245  MATCH     "007",TEMPLATE
          IF        @EQUAL
              CALL      CLPMEH00
              GOTO      ELGB1300
          ENDIF
.
          CALL      CLPMSOEC
          CALL      CLPMSELF
.
ELGB1250  MOVE      ZERO,SAVEINDC
          MOVE      SP70,SAVEPRIM
.
          MATCH     "OECLS",FORMACTN
          IF        @EQUAL
.
            MOVE      ADMISSNO,KEY20
            LJUSTIFY  KEY20
            PACK      KEY23,KEY20,REPCOUNT,SP70
            CALL      RDPMEEH1 
            IF        OVRCD=1
              CALL      CLPMEH00
            ENDIF
.
            PACK      KEY11,ADMISSNO,REPCOUNT,SP70
            CALL      RDPMOEC1
            IF        OVRCD=0
              MATCH     SP70,PMOEELEG
              IF        !@EQUAL
                PACK      KEY8,PMOEELEG,SP70
                CALL      RDPMELF1
                IF        OVRCD=1
                  CALL      CLPMSELF
                ELSE
                  MOVE      PMEFPRIM,SAVEPRIM
                ENDIF
              ENDIF
            ENDIF
.
          ELSE
.
            MOVE      ZERO,REDECFBT
            MOVE      ADMISSNO,KEY20
            LJUSTIFY  KEY20
            PACK      KEY23,KEY20,Z70
            CALL      RSPMEEH1
            CALL      RPPMEEH1
.           BRANCH    OVRCD,ELGB1300
            IF        OVRCD=1
              CALL      CLPMEH00
              GOTO      ELGB1300
            ELSE
.
              MATCH     KEY20,PMHEARID
              IF        @EQUAL
                PACK      KEY11,ADMISSNO,PMHERPTC,SP70
                CALL      RDPMOEC1
                IF        OVRCD=0
                  MATCH     SP70,PMOEELEG
                  IF        !@EQUAL
                    PACK      KEY8,PMOEELEG,SP70
                    CALL      RDPMELF1
                    IF        OVRCD=1
                      CALL      CLPMSELF
                    ELSE
                      MOVE      PMEFPRIM,SAVEPRIM
                    ENDIF
                  ENDIF
                ENDIF
              ENDIF 
.
            ENDIF
.
          ENDIF
.
          MATCH     KEY20,PMHEARID
.         GOTO      ELGB1300 IF NOT EQUAL
          IF        !@EQUAL 
            CALL      CLPMEH00
            GOTO      ELGB1300
          ENDIF
.
          MOVE      ONE,REDECFBT
.
          MATCH     SP70,PTELHFRN
          IF        @EQUAL | @EOS
            MATCH     SP70,PMHEFRID
            IF        !@EQUAL & !@EOS
              MOVE      PMHEFRID,PTELHFRN
              MOVE      ONE,ECLPHFRN
            ENDIF
          ENDIF
.
          PACK      PTELHFPN,PTELHFPN,SP70
          MATCH     SP70,PTELHFPN
          IF        @EQUAL | @EOS
            PACK      PMHETNAM,PMHETNAM,SP70
            MATCH     SP70,PMHETNAM
             IF        !@EQUAL & !@EOS
              MOVE      PMHETNAM,PTELHFPN
              MOVE      ONE,ECLPHFPN
            ENDIF
          ENDIF
.
          MATCH     SP70,PTELFINC
          IF        @EQUAL | @EOS
            MATCH     SP70,PMHEFSTA
            IF        !@EQUAL & !@EOS
              MATCH     "Y",PMHEFSTA
              IF        @EQUAL
                MOVE      ONE,PTELFINC
              ELSE
                MOVE      ZERO,PTELFINC
              ENDIF
              MOVE      ONE,ECLPFINA
            ENDIF
          ENDIF
.
          COMPARE   ZERO,PTELPPRI
          IF        @EQUAL
            MATCH     SP70,PMHECPAM
            IF        !@EQUAL & !@EOS
              MOVE      SP70,DIM9
              MOVE      PMHECPAM,DIM9
              RJUSTIFY  DIM9
              UNPACK    DIM9,DIM7,DIM2
              PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
              MATCH     SP70,PTELCMPL
              IF        @EQUAL
                MOVE      DIM10,PTELPPRI   * only overwrite if no patelgaf rec
                MOVE      ONE,ECLPCPRP
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,PMEFISTY
          IF        @EQUAL | @EOS
           COMPARE   ZERO,PTELXCSS
           IF        @EQUAL
              MATCH     SP70,PMHEEXAM
              IF        !@EQUAL & !@EOS
                MOVE      SP70,DIM9
                MOVE      PMHEEXAM,DIM9
                RJUSTIFY  DIM9
                UNPACK    DIM9,DIM7,DIM2
                PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
                MATCH     SP70,PTELCMPL
                IF        @EQUAL
                  MOVE      DIM10,PTELXCSS   * only overwrite if no patelgaf rec
                  MOVE      ONE,ECLPEFTA
                ENDIF
              ENDIF
            ENDIF
          ELSE
.
            MOVE      "VI",CATEGORY
            MOVE      PMEFISTY,CODE
            CALL      GETCOD00
.
            MATCH     SP70,TCINDC1
            IF        @EQUAL | @EOS
              COMPARE   ZERO,PTELXCSS
              IF        @EQUAL
                MATCH     SP70,PMHEEXAM
                IF        !@EQUAL & !@EOS
                  MOVE      SP70,DIM9
                  MOVE      PMHEEXAM,DIM9
                  RJUSTIFY  DIM9
                  UNPACK    DIM9,DIM7,DIM2
                  PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
                  MATCH     SP70,PTELCMPL
                  IF        @EQUAL
                    MOVE      DIM10,PTELXCSS * only overwrite if no patelgaf rec
                    MOVE      ONE,ECLPEFTA
                  ENDIF
                ENDIF
              ENDIF
            ELSE
.
              MATCH      "1",TCINDC1
              IF         @EQUAL
                COMPARE   ZERO,PTELXCSS
                IF        @EQUAL
                  MATCH     SP70,PMHEEXAM
                  IF        !@EQUAL & !@EOS
                    MOVE      SP70,DIM9
                    MOVE      PMHEEXAM,DIM9
                    RJUSTIFY  DIM9
                    UNPACK    DIM9,DIM7,DIM2
                    PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
                    MATCH     SP70,PTELCMPL
                    IF        @EQUAL
                      MOVE      DIM10,PTELXCSS
                      MOVE      ONE,ECLPEFTA
                    ENDIF
                  ENDIF
                ENDIF
                GOTO       ELGB1275
              ENDIF
.
              MATCH      "2",TCINDC1
              IF         @EQUAL
                COMPARE   ZERO,PTELXCSD
                IF        @EQUAL
                  MATCH     SP70,PMHEEXAM
                  IF        !@EQUAL & !@EOS
                    MOVE      SP70,DIM9
                    MOVE      PMHEEXAM,DIM9
                    RJUSTIFY  DIM9
                    UNPACK    DIM9,DIM7,DIM2
                    PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
                    MATCH     SP70,PTELCMPL
                    IF        @EQUAL
                      MOVE      DIM10,PTELXCSD
                      MOVE      ONE,ECLPEFTA
                    ENDIF
                  ENDIF
                ENDIF
                GOTO       ELGB1275
              ENDIF
.
              COMPARE   ZERO,PTELXCSS
              IF        @EQUAL
                MATCH     SP70,PMHEEXAM
                IF        !@EQUAL & !@EOS
                  MOVE      SP70,DIM9
                  MOVE      PMHEEXAM,DIM9
                  RJUSTIFY  DIM9
                  UNPACK    DIM9,DIM7,DIM2
                  PACK      DIM10,DIM7,DOT,DIM2
.   ** only default to ecf amount if the check complete is blank
                  MATCH     SP70,PTELCMPL
                  IF        @EQUAL
                    MOVE      DIM10,PTELXCSS * only overwrite if no patelgaf rec
                    MOVE      ONE,ECLPEFTA
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
ELGB1275  MATCH     SP70,PTELSPEA
          IF        @EQUAL | @EOS
            MATCH     SP70,PMHEPEAI
            IF        !@EQUAL & !@EOS
              MATCH     "Y",PMHEPEAI
              IF        @EQUAL
                MOVE      ONE,PTELSPEA
              ELSE
                MOVE      ZERO,PTELSPEA
              ENDIF
              MOVE      ONE,ECLPSTPA
            ENDIF    
          ENDIF
.
          MATCH     SP70,PTELXCLS
          IF        @EQUAL | @EOS
            MATCH     SP70,PMHEEXDI
            IF        !@EQUAL & !@EOS
              MOVE      PMHEEXDI,PTELXCLS
              MOVE      ONE,ECLPEXEX
            ENDIF
          ENDIF
.
          MOVE      ONE,SAVEINDC
          MOVE      PTELHFRN,SAVEHFRN
          MOVE      PTELHFPN,SAVEHFPN
          MOVE      PTELFINC,SAVEFINC
          MOVE      PTELPPRI,SAVEPPRI
          MOVE      PTELXCSS,SAVEXCSS
          MOVE      PTELXCSD,SAVEXCSD
          MOVE      PTELSPEA,SAVESPEA
          MOVE      PTELXCLS,SAVEXCLS
.
.**********************************************************
.
ELGB1300  PACK      KEY20,ADMISSNO,SP70
          CALL      RSPMAEL1
          CALL      RKPMAEL1
          IF        OVRCD=1
            CALL      CLRAEL00
            GOTO      ELGB1800
          ENDIF
.
          MATCH     ADMISSNO,PMAEVISN
          IF        !@EQUAL
            CALL      CLRAEL00
            GOTO      ELGB1800
          ENDIF
.
          PACK      KEY12,PMAEQUOT,SP70
          CALL      RDPMFED1            * read Fees Estimation Details
          IF        OVRCD<>1
            CALL      CKCM0000
            GOTO      ELGB1900
          ENDIF     
.
ELGB1800  CALL      CLRAEL00
          CALL      CLPFED00
          CALL      CLPFES00
.
ELGB1900  MOVE      ZERO,F3
          SQUEEZE   TEMPLATE
          MOVE      TEMPLATE,F3
          MOVE      F3,TEMPLATE
          REPLACE   " 0",TEMPLATE
          MATCH     "001",TEMPLATE
          IF        @EQUAL
            MATCH     "1",PTCNIFCL      * HEA IFC
            IF        @EQUAL
              CALL      GTMS0000        * Get Misc.item
            ENDIF
.
            MATCH     "2",PTCNIFCL      * SJOG IFC
            IF        @EQUAL
              IF        UPDATEST=0
                CALL      CBOOK0000     * remove theatre fees from booking
              ENDIF
              MOVE      ONE,IFCFLAG
              CALL      DSMBS000        * get the Theatre fees from Booking
              MOVE      ZERO,IFCFLAG
              CALL      GTIT0000        * MBS and Misc.item from pmseliaf file
            ENDIF
.
            MOVE      ZERO,F1
            MOVE      PTCNIFCL,F1
            IF        F1=1 | F1=2 | F1=3
              CALL      GFEH0000                   * Generate HEA/SJOG/CAB IFC
            ENDIF
          ENDIF
.
          MATCH     "1",SAVEINDC
          IF        @EQUAL
            MOVE      SAVEHFRN,PTELHFRN
            MOVE      SAVEHFPN,PTELHFPN
            MOVE      SAVEFINC,PTELFINC
            MOVE      SAVEPPRI,PTELPPRI
            MOVE      SAVEXCSS,PTELXCSS
            MOVE      SAVEXCSD,PTELXCSD
            MOVE      SAVESPEA,PTELSPEA
            MOVE      SAVEXCLS,PTELXCLS
          ENDIF
.
          GOTO      ELGB8000
.
ELGB2000  CALL      STEL0000                     * Setup fields
.
          MATCH     "1",PTELQEXS
          GOTO      ELGB2500 IF EQUAL            * check if estimate flag=yes?
.
ELGB2300  PACK      KEY20,ADMISSNO,SP70
          CALL      RSPMAEL1                     * If no, then unlink any
          CALL      RKPMAEL1                     * existing estimates
          IF        OVRCD=1
            CALL      CLRAEL00
            GOTO      ELGB2500
          ENDIF
.
          MATCH    ADMISSNO,PMAEVISN
          IF       @EQUAL
            PACK      KEY20,PMAEVISN,PMAEQUOT
            CALL      DEPMAEL1
            GOTO      ELGB2300
          ELSE
            CALL      CLRAEL00
          ENDIF
.
ELGB2500  MOVE      ZERO,MBSINDEX
          MOVE      ADMISSNO,PTELVISN
          MOVE      PTELVISN,KEY8
          CALL      RAPTELG1
          BRANCH    OVRCD,ELGB4000
          CALL      UPPTELG1        * update
.
          MATCH     "2",PTCNIFCL
          IF        @EQUAL
            MOVE      ONE,IFCFLAG
            CALL      DSMBS000           * get the Theatre fees from Booking
            MOVE      ZERO,IFCFLAG
          ENDIF
          GOTO      ELGB5000
.
ELGB4000  CALL      WRPTELG1        * write
.
ELGB5000  MOVE      ZERO,F1
          MOVE      PTCNIFCL,F1
          IF        F1=1
            IF        UPDATEST=0
              MOVE      ONE,F2
              CALL      MVFL0000         * move GST cgi variables
            ENDIF
            CALL      GFEH0000           * Generate HEA IFC
            CALL      WMEL0000           * re write items to pmseliaf after sort
            GOTO      ELGB5200
          ENDIF
.
          IF        F1=2
            IF        UPDATEST=0
              MOVE      "50",F2
              CALL      MVFL0000         * move GST cgi variables
            ENDIF
            CALL      SITY0000
            CALL      GFEH0000           * Generate SJOG IFC
            CALL      WREL0000           * re write items to pmseliaf after sort
            GOTO      ELGB5200
          ENDIF
.
          IF        F1=3
            CALL      GFEH0000           * Generate CAB IFC
            GOTO      ELGB5200
          ENDIF
.
ELGB5200  MATCH     SP70,STATNCOD
          IF        !@EQUAL
            MATCH     SP70,SCHDPRNT
            IF        !@EQUAL
              CALL      ADDPRN00              * print form
              MOVE      "PATWEB78",SETDFPRG
              MOVE      "06",SETDFRPT
              CALL      UPDEFP00              * Update Default Printer
            ENDIF
          ENDIF
.
          MOVE      ZERO,FORM2
          MATCH     SP70,PTMIS045
          IF        !@EQUAL
            UNPACK    PTMIS045,KEY2
            SQUEEZE   KEY2
            MOVE      KEY2,FORM2
          ENDIF
.
          UNPACK    SP70,KEY4,KEY2
          MATCH     SP70,PTELG017                * check month covered MM
          IF        !@EQUAL
            UNPACK    PTELG017,KEY2
          ENDIF
.
          MATCH     SP70,PTELG018                * check year covered CCYY
          IF        !@EQUAL
            UNPACK    PTELG018,KEY4
          ENDIF
.
          MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          IF        OVRCD=0
            PACK      AFNDCG,KEY4,KEY2         * CCYYMM
            REP       " 0",AFNDCG
            MOVE      FORM2,AFNDYY
            CALL      UPMISS1
          ENDIF
.
          MOVE      URNUMBER,KEY8
          CALL      RDMAST1
          IF        OVRCD=0
            CALL      RDPMPX21
            PACK      PFNDCG,KEY4,KEY2         * CCYYMM
            REP       " 0",PFNDCG
            MOVE      FORM2,PFNDYY
            CALL      UPMAST1
          ENDIF
          GOTO      ELGB6000
.
ELGB5400  MOVE      ADMISSNO,PTELVISN
          MOVE      PTELVISN,KEY8
          CALL      RDPTELG1
          IF        OVRCD=0
            MOVE      PTELG022,PTELECMN
            CALL      UPPTELG1
          ELSE
            CALL      CLRELG00           * Clear fields
            MOVE      ADMISSNO,PTELVISN
            MOVE      PTELG022,PTELECMN
            CALL      WRPTELG1
          ENDIF
          GOTO      ELGB6000
.
ELGB5500  MOVE      ZERO,PTELTOOP
          MOVE      ADMISSNO,KEY8
          CALL      RDPTELG1
          IF        OVRCD=0
            MOVE      TOTOPOCK,PTELTOOP
            CALL      UPPTELG1        * update
          ENDIF
          GOTO      ELGB6000
.
ELGB6000  MOVE      ZERO,EXIT
          GOTO      ELGB9999
.
ELGB7100  MOVE      "Missing Master record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ELGB9999
.
ELGB7200  MOVE      "Missing Admission/Booking record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ELGB9999
.
ELGB8000  CLEAR     WEBTITLE
          MOVE      "Eligibility Check",WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ELGB9999
.
          CALL      WEBBOD00   * Output Templated Body of HTML
          CALL      WEBEND00   * Output End of Web Page
          MOVE      ONE,EXIT
.
ELGB9999  RETURN
+
.--------------------------------------------------------------------------
.         Load GST variables for Fees Estimate
.--------------------------------------------------------------------------
MVFL0000  MOVE      ZERO,F3
          WHILE     F3 <= F2
            ADD       ONE,F3
            MOVE      GSTTAP[F3],GSTAPL[F3]
            MOVE      GSTTCD[F3],GSTCOD[F3]
            MOVE      GSTMAP[F3],GSTAPM[F3]   * Misc.GST Payable 1=Yes, 2=No
            MOVE      GSTMCD[F3],GSTCOM[F3]   * Misc.GST Code
          DO
MVFL9999  RETURN
+
.--------------------------------------------------------------------------
.         Set Item type to zero for MBS items from booking
.--------------------------------------------------------------------------
SITY0000  MOVE      ONE,F3
          WHILE     F3 <= 60
            MOVE      SP70,ITMTYP[F3]   * record type
            ADD       ONE,F3
          DO
.
          MOVE      ZERO,COUNTER
SITY1000  ADD       ONE,COUNTER
          COMPARE   "60",COUNTER
          GOTO      SITY9999 IF EQUAL
.
          COMPARE   ONE,PMELIFLG
          GOTO      SITY9999 IF NOT EQUAL
.
          PACK      KEY9,THEFEE[COUNTER],SP70      * Theatre fee
          MATCH     SP70,KEY9
          GOTO      SITY1000 IF EQUAL
.
          MOVE      "1",KEY1
          PACK      KEY12,ADMISSNO,KEY1,SP70
          CALL      RSPMELI1
SITY2000  CALL      RKPMELI1
          BRANCH    OVRCD,SITY1000
.
          MATCH     ADMISSNO,PMEIVISN
          GOTO      SITY1000 IF NOT EQUAL
.
          MATCH     KEY1,PMEIRTYP         * check record type
          GOTO      SITY1000 IF NOT EQUAL
.
          MATCH     KEY9,PMEIITMN
          GOTO      SITY2000 IF NOT EQUAL
.
          MATCH     "X",PMEIKEYI          * flag for Item from Booking
          GOTO      SITY2000 IF NOT EQUAL
.
          MOVE      "0",ITMTYP[COUNTER]   * booking
          PACK      KEY12,PMEIVISN,PMEIRTYP,PMEICNTR,SP70
          CALL      DEPMELI1
.
          GOTO      SITY1000
.
SITY9999  RETURN
+
.--------------------------------------------------------------------------
.         Get Misc.item from pmseliaf file for HEA IFC
.--------------------------------------------------------------------------
GTMS0000  MOVE      ONE,F2
          MOVE      SP70,MISCHG[F2]   * MBS or Misc.Code
          MOVE      ZERO,MISQUA[F2]   * No of Items
          MOVE      SP70,GSTMKY[F2]   * Keyin GST 1=Yes,
          MOVE      SP70,GSTAPM[F2]   * GST Payable 1=Yes, 2=No(disp.field)
          MOVE      SP70,GSTCOM[F2]   * GST Code (display field)
          MOVE      SP70,KEYAMT[F2]   * Keyin amount
          MOVE      SP70,MISAMT[F2]   * Misc.item amount (keyin)
.
.         The following GST fields are populated from frontend.
.         GST fields can be disabled and abled depends on the item setup
.
.         If GST applicable is set to 'Either', then the GST fields can be
.         entered/keyin, if it's set to Yes or No then the fields are
.         disabled
.
          MOVE      SP70,GSTTAP[F2]   * Theatre fee GST Payable 1=Yes, 2=No
          MOVE      SP70,GSTTCD[F2]   * Theatre fee GST Code
          MOVE      SP70,GSTMAP[F2]   * Misc.GST Payable 1=Yes, 2=No
          MOVE      SP70,GSTMCD[F2]   * Misc.GST Code
.
          COMPARE   ONE,PMELIFLG
          GOTO      GTMS9999 IF NOT EQUAL
.
          MOVE      ZERO,F2
          MOVE      ZERO,ITMCNTR
          MOVE      "2",KEY1              * Miscellaneous item Code
          PACK      KEY12,ADMISSNO,KEY1,SP70
          CALL      RSPMELI1
          CALL      RKPMELI1
          BRANCH    OVRCD,GTMS9999
.
          MATCH     ADMISSNO,PMEIVISN
          GOTO      GTMS9999 IF NOT EQUAL
.
          MATCH     KEY1,PMEIRTYP
          GOTO      GTMS9999 IF NOT EQUAL
.
          ADD       ONE,F2
          ADD       ONE,ITMCNTR
          MOVE      PMEIRTYP,ITMTYP[ITMCNTR]
          MOVE      PMEIITMN,MISCHG[F2]   * Misc.Code
          MOVE      PMEISERV,MISQUA[F2]   * No of Items
.
          MOVE      PMEIGSTE,GSTMKY[F2]   * Keyin GST
          MOVE      PMEIGSTA,GSTAPM[F2]   * GST Payable (used in FEESESTM)
          MOVE      PMEIGSTC,GSTCOM[F2]   * GST Code
.
          MOVE      PMEIKEYI,KEYAMT[F2]   * Keyin Amount
          MOVE      PMEIAMNT,MISAMT[F2]   * Amount keyed in
.
          MOVE      PMEIGSTA,GSTMAP[F2]   * Misc.GST Payable
          MOVE      PMEIGSTC,GSTMCD[F2]   * Misc.GST Code
.
GTMS9999  RETURN
+
.--------------------------------------------------------------------------
.         Get MBS and Misc.item from pmseliaf file for SJOG IFC
.--------------------------------------------------------------------------
GTIT0000  COMPARE   ONE,PMELIFLG
          GOTO      GTIT9999 IF NOT EQUAL
.
          MOVE      ONE,F3
          WHILE     F3 <= 60
            MOVE      SP70,ITMTYP[F3]   * record type
            MOVE      SP70,THEFEE[F3]   * Theatre Fee Code
            MOVE      ZERO,THEQUA[F3]   * No of Items
            MOVE      SP70,GSTTKY[F3]   * Keyin GST 1=Yes,
            MOVE      SP70,GSTAPL[F3]   * GST Payable 1=Yes, 2=No(display field)
            MOVE      SP70,GSTCOD[F3]   * GST Code (display field)
.
            MOVE      SP70,MISCHG[F3]   * MBS or Misc.Code
            MOVE      ZERO,MISQUA[F3]   * No of Items
            MOVE      SP70,GSTMKY[F3]   * Keyin GST 1=Yes,
            MOVE      SP70,GSTAPM[F3]   * GST Payable 1=Yes, 2=No(display field)
            MOVE      SP70,GSTCOM[F3]   * GST Code (display field)
.
            MOVE      SP70,KEYAMT[F3]   * Keyin amount
            MOVE      SP70,MISAMT[F3]   * Misc.item amount (keyin)
.
.           The following GST fields are populated from frontend.
.           GST fields can be disabled and abled depends on the item setup 
.
.           If GST applicable is set to 'Either', then the GST fields can be
.           entered/keyin, if it's set to Yes or No then the fields are
.           disabled
.
            MOVE      SP70,GSTTAP[F3]   * Theatre fee GST Payable 1=Yes, 2=No
            MOVE      SP70,GSTTCD[F3]   * Theatre fee GST Code
            MOVE      SP70,GSTMAP[F3]   * Misc.GST Payable 1=Yes, 2=No
            MOVE      SP70,GSTMCD[F3]   * Misc.GST Code
            ADD       ONE,F3
          DO
.
          MOVE      ZERO,F2
          MOVE      ZERO,F3
          MOVE      ZERO,ITMCNTR
          MOVE      ZERO,COUNTER
.
          BRANCH    UPDATEST,GTIT3000        * skip load MBS Items from booking
.
.         Check if any MBS items entered from booking
.
          COMPARE   ZERO,MBSINDEX
          GOTO      GTIT3000 IF EQUAL        * no MBS item from booking
.
          MOVE      SP70,KEY9
GTIT1000  ADD       ONE,F3
          COMPARE   F3,MBSINDEX
          GOTO      GTIT3000 IF LESS
.
          MOVE      FMBSCODE[F3],KEY9
          MATCH     SP70,KEY9
          GOTO      GTIT1000 IF EQUAL
.
          PACK      KEY17,KEY9,SP70
          CALL      PATITMRD                * Read the item file
          BRANCH    OVRCD,GTIT1000
.
          MOVE      "0",PMEIRTYP      * from booking
          MOVE      KEY9,PMEIITMN     * Theatre Fee Code
          MOVE      ONE,PMEISERV      * No of Items
.
          MOVE      SP70,PMEIGSTE
          IF        PTITGSTA=2
            MOVE      "1",PMEIGSTE        * Keyin GST
          ENDIF
          MOVE      PTITGSTA,PMEIGSTA     * GST Payable(used in FEESESTM)
          MOVE      PTITGSTC,PMEIGSTC     * GST Code
.
          ADD       ONE,F2
          ADD       ONE,ITMCNTR
          MOVE      PMEIRTYP,ITMTYP[F2]
          MOVE      PMEIITMN,THEFEE[F2]   * Theatre Fee Code
          MOVE      PMEISERV,THEQUA[F2]   * No of Items
.
          MOVE      PMEIGSTE,GSTTKY[F2]   * Keyin GST
          MOVE      PMEIGSTA,GSTAPL[F2]   * GST Payable(used in FEESESTM)
          MOVE      PMEIGSTC,GSTCOD[F2]   * GST Code
.
          MOVE      PMEIGSTA,GSTTAP[F2]   * GST Payable 1=Yes, 2=No
          MOVE      PMEIGSTC,GSTTCD[F2]   * GST Code
.
.         Re load MBS items from Booking to pmseliaf file
.
GTIT1200  ADD       ONE,COUNTER
          MOVE      COUNTER,PMEICNTR
          MOVE      "1",PMEIRTYP          * MBS item
          PACK      KEY12,ADMISSNO,PMEIRTYP,PMEICNTR,SP70
          CALL      RAPMELI1
          COMPARE   ZERO,OVRCD
          GOTO      GTIT1200 IF EQUAL
.
          UNPACK    KEY12,PMEIVISN,PMEIRTYP,PMEICNTR
          MOVE      "X",PMEIKEYI          * flag for Item from Booking
          CALL      WRPMELI1
.
          COMPARE   MBSINDEX,F3
          GOTO      GTIT1000 IF LESS
.
.         Process Theatre MBS items
.
GTIT3000  MOVE      "1",KEY1                 * Theatre Fee
          PACK      KEY12,ADMISSNO,KEY1,SP70
          CALL      RSPMELI1
GTIT4000  CALL      RKPMELI1
          BRANCH    OVRCD,GTIT6000
          MATCH     ADMISSNO,PMEIVISN
          GOTO      GTIT6000 IF NOT EQUAL
.
          MATCH     KEY1,PMEIRTYP         * check record type
          GOTO      GTIT6000 IF NOT EQUAL
.
          IF        UPDATEST=0
            MATCH     "X",PMEIKEYI
            GOTO      GTIT4000 IF EQUAL   * don't include MBS items from Booking
          ENDIF
.
          ADD       ONE,F2
          ADD       ONE,ITMCNTR
          MOVE      PMEIRTYP,ITMTYP[F2]
          MOVE      PMEIITMN,THEFEE[F2]   * Theatre Fee Code
          MOVE      PMEISERV,THEQUA[F2]   * No of Items
.
          MOVE      PMEIGSTE,GSTTKY[F2]   * Keyin GST
          MOVE      PMEIGSTA,GSTAPL[F2]   * GST Payable(used in FEESESTM)
          MOVE      PMEIGSTC,GSTCOD[F2]   * GST Code
.
          MOVE      PMEIGSTA,GSTTAP[F2]   * GST Payable 1=Yes, 2=No
          MOVE      PMEIGSTC,GSTTCD[F2]   * GST Code
.
          GOTO      GTIT4000
.
.         process Misc.items
.
GTIT6000  MOVE      ZERO,F2
          MOVE      "2",KEY1              * Miscellaneous item Code
          PACK      KEY12,ADMISSNO,KEY1,SP70
          CALL      RSPMELI1
GTIT7000  CALL      RKPMELI1
          BRANCH    OVRCD,GTIT9999
.
          MATCH     ADMISSNO,PMEIVISN
          GOTO      GTIT9999 IF NOT EQUAL
.
          MATCH     KEY1,PMEIRTYP
          GOTO      GTIT9999 IF NOT EQUAL
.
          ADD       ONE,F2
          ADD       ONE,ITMCNTR
          MOVE      PMEIRTYP,ITMTYP[ITMCNTR]
          MOVE      PMEIITMN,MISCHG[F2]   * Misc.Code
          MOVE      PMEISERV,MISQUA[F2]   * No of Items
.
          MOVE      PMEIGSTE,GSTMKY[F2]   * Keyin GST
          MOVE      PMEIGSTA,GSTAPM[F2]   * GST Payable (used in FEESESTM)
          MOVE      PMEIGSTC,GSTCOM[F2]   * GST Code
.
          MOVE      PMEIKEYI,KEYAMT[F2]   * Keyin Amount
          MOVE      PMEIAMNT,MISAMT[F2]   * Amount keyed in
.
          MOVE      PMEIGSTA,GSTMAP[F2]   * Misc.GST Payable
          MOVE      PMEIGSTC,GSTMCD[F2]   * Misc.GST Code
.
          GOTO      GTIT7000
.
GTIT9999  RETURN
+
.--------------------------------------------------------------------------
.         write Misc.item to pmseliaf file for HEA IFC
.         HEA IFC Eligibility check only has one Miscellaneous charge item
.--------------------------------------------------------------------------
WMEL0000  COMPARE   ONE,PMELIFLG
          GOTO      WMEL9999 IF NOT EQUAL
.
          CALL      DELI0000               * Delete existing records
.
          MOVE      ONE,COUNTER
          MOVE      MISCHG[COUNTER],KEY9      * Misc.item
          MATCH     Z70,KEY9
          GOTO      WMEL2000 IF EQUAL
          MATCH     SP70,KEY9
          GOTO      WMEL2000 IF EQUAL
.
          CALL      CLPMSELI                   * Clear fields
.
          MOVE      "2",PMEIRTYP               * record type
          MOVE      KEY9,PMEIITMN              * Theatre fee code
          MOVE      ADMISSNO,PMEIVISN
.
          MOVE      MISQUA[COUNTER],PMEISERV    * no of service
          MOVE      GSTMKY[COUNTER],PMEIGSTE    * Keyin GST
.
          MOVE      KEYAMT[COUNTER],PMEIKEYI
          MATCH     "1",PMEIKEYI
          IF        @EQUAL
            MOVE      MISAMT[COUNTER],PMEIAMNT    * keyin amount
          ELSE
            MOVE      KEY9,MCHARGE
            CALL      GMCHRG00
            MOVE      MPATPOR,PMEIAMNT
            ADD       MHFPOR,PMEIAMNT
          ENDIF
.
          MATCH     Z70,GSTMAP[COUNTER]
          IF        !@EQUAL
            PACK      PMEIGSTA,GSTMAP[COUNTER]   * Misc.Charge GST Payable
            MATCH     "1",PMEIGSTA
            IF        @EQUAL
              PACK      PMEIGSTC,GSTMCD[COUNTER]   * Misc.Charge GST Code
            ENDIF
          ENDIF
.
          MOVE      COUNTER,PMEICNTR
          PACK      KEY12,ADMISSNO,KEY1,PMEICNTR,SP70
          CALL      RAPMELI1
          IF        OVRCD=0
            CALL      UPPMELI1
          ELSE
            CALL      WRPMELI1
          ENDIF
          GOTO      WMEL9999
.
.         Misc.item has been removed from Elgibility Check, delete from pmsmtiaf
.
WMEL2000  MOVE      "3",KEY1                 * Misc.item
          PACK      KEY15,ADMISSNO,KEY1,SP70
          CALL      RSPMMTI2
WMEL4000  CALL      RKPMMTI2
          BRANCH    OVRCD,WMEL9999
.
          MATCH     ADMISSNO,PMMIVISN
          GOTO      WMEL9999 IF NOT EQUAL
          MATCH     KEY1,PMMIRTYP
          GOTO      WMEL9999 IF NOT EQUAL    * Not a Misc.item
.
          MATCH     "4",PMMIITYP
          GOTO      WMEL4000 IF NOT EQUAL    * Not from Eligibility Check
.
          PACK      KEY15,PMMIVISN,PMMIRTYP,PMMITRAN
          CALL      DEPMMTI2
.
WMEL9999  RETURN
+
.--------------------------------------------------------------------------
.         write MBS and Misc.item to pmseliaf file
.--------------------------------------------------------------------------
WREL0000  COMPARE   ONE,PMELIFLG
          GOTO      WREL9999 IF NOT EQUAL
.
          CALL      DELI0000               * Delete existing records
.
          MOVE      "1",KEY1               * Theatre Fee code
          MOVE      ZERO,COUNTER
WREL1000  ADD       ONE,COUNTER
          COMPARE   "60",COUNTER
          GOTO      WREL6000 IF EQUAL
.
          MATCH     "2",KEY1
          IF        @EQUAL
            MOVE      MISCHG[COUNTER],KEY9      * Misc.item
          ELSE
            MOVE      THEFEE[COUNTER],KEY9      * Theatre fee
          ENDIF
.
          MATCH     Z70,KEY9
          GOTO      WREL1000 IF EQUAL
          MATCH     SP70,KEY9
          GOTO      WREL1000 IF EQUAL
.
          CALL      CLPMSELI                   * Clear fields
.
          MOVE      KEY1,PMEIRTYP              * record type
          MOVE      KEY9,PMEIITMN              * Theatre fee code
          MOVE      ADMISSNO,PMEIVISN
.
          MATCH     "2",KEY1                      * Misc.item 
          IF        @EQUAL
            MOVE      MISQUA[COUNTER],PMEISERV    * no of service
            MOVE      GSTMKY[COUNTER],PMEIGSTE    * Keyin GST
.
            MOVE      KEYAMT[COUNTER],PMEIKEYI
            MATCH     "1",PMEIKEYI
            IF        @EQUAL
              MOVE      MISAMT[COUNTER],PMEIAMNT    * keyin amount
            ENDIF
.
            MATCH     Z70,GSTMAP[COUNTER]
            IF        !@EQUAL
              PACK      PMEIGSTA,GSTMAP[COUNTER]   * Misc.Charge GST Payable
              MATCH     "1",PMEIGSTA
              IF        @EQUAL
                PACK      PMEIGSTC,GSTMCD[COUNTER]   * Misc.Charge GST Code
              ENDIF
            ENDIF
          ELSE
            MOVE      THEQUA[COUNTER],PMEISERV    * quantity
            MATCH     Z70,GSTTKY[COUNTER]
            IF        !@EQUAL
              MOVE      GSTTKY[COUNTER],PMEIGSTE    * Keyin GST
            ENDIF
.
.         set PMEIKEYI to "X" form MBS Items entered from Booking to pmseliaf
.
            MATCH     "0",ITMTYP[COUNTER]
            IF        @EQUAL
              MOVE      "X",PMEIKEYI
            ENDIF
.
            MATCH     Z70,GSTTAP[COUNTER]
            IF        !@EQUAL
              PACK      PMEIGSTA,GSTTAP[COUNTER]   * Theatre fee GST Payable
              MATCH     "0",PMEIGSTA
              IF        !@EQUAL
                PACK      PMEIGSTC,GSTTCD[COUNTER]   * Theatre fee GST Code
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      COUNTER,PMEICNTR
          PACK      KEY12,ADMISSNO,KEY1,PMEICNTR,SP70
          CALL      RAPMELI1
          IF        OVRCD=0
            CALL      UPPMELI1
          ELSE
            CALL      WRPMELI1
          ENDIF
          GOTO      WREL1000
.
WREL6000  MATCH     "2",KEY1
          GOTO      WREL9999 IF EQUAL
.
          MOVE      "2",KEY1                    * Misc.Item code
          MOVE      ZERO,COUNTER
          GOTO      WREL1000
.
WREL9999  RETURN
+
.-----------------------------------------------------------
.         Delete existing records from pmseliaf
.-----------------------------------------------------------
DELI0000  PACK      KEY12,ADMISSNO,SP70
          CALL      RSPMELI1
          CALL      RKPMELI1
          BRANCH    OVRCD,DELI9999
.
          MATCH     ADMISSNO,PMEIVISN
          GOTO      DELI9999 IF NOT EQUAL     * different visit number
.
          PACK      KEY12,ADMISSNO,PMEIRTYP,PMEICNTR,SP70
          CALL      DEPMELI1
          GOTO      DELI0000
.
DELI9999  RETURN
+
.-----------------------------------------------------------
.         Set up eligibility fields
.-----------------------------------------------------------
STEL0000  MOVE      PTELG002,PTELPPRI
          MOVE      PTELG003,PTELXCSS
          MOVE      PTELG010,PTELPSHA
          MOVE      PTELG011,PTELPTHE
          MOVE      PTELG019,PTELPPUT
          MOVE      PTELG020,PTELPSUT
          MOVE      PTELG021,PTELPTUT
          MOVE      PTELG025,PTELPSDY
          MOVE      PTELG026,PTELPSDU
          MOVE      PTELG027,PTELPHSP
          MOVE      PTELG028,PTELPHSU
          MOVE      PTELG032,PTELMAMT
          MOVE      PTELG034,PTELTOOP
.
.         HEA Eligibility Check IFC Layout has the Total Exp Los stored
.         in 'Out pocket field'
.
          MATCH     "1",PTCNIFCL
          IF        @EQUAL
            IF        TOTEXLOS<>0
              MOVE      TOTEXLOS,PTELTOOP     * Total Exp Los
            ENDIF
            GOTO      STEL2000
          ENDIF
.
.         For  Insured claim types store the Total Exp LOS to Total OOPS field
.         Uninsured patients will have 'Out of Pocket' field on screen
.
          MATCH     "2",PTCNIFCL
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MATCH     "3",TCINDC5
              IF        !@EQUAL
                IF        TOTEXLOS<>0
                  MOVE      TOTEXLOS,PTELTOOP     * Total Exp Los
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
STEL2000  MATCH     SP70,PTELG001
          IF        !@EQUAL
            MOVE      PTELG001,PTELFINC
          ENDIF
.
          MATCH     SP70,PTELG004
          IF        !@EQUAL
            MOVE      PTELG004,PTELXCLS
          ENDIF
          MATCH     SP70,PTELG005
          IF        !@EQUAL
            MOVE      PTELG005,PTELXCMN
          ENDIF
          MATCH     SP70,PTELG006
          IF        !@EQUAL
            MOVE      PTELG006,PTELCMPL
          ENDIF
          MATCH     SP70,PTELG007
          IF        !@EQUAL
            MOVE      PTELG007,PTELCOVR
          ENDIF
          MATCH     SP70,PTELG008
          IF        !@EQUAL
            MOVE      PTELG008,PTELQEXS
          ENDIF
          MATCH     SP70,PTELG009
          IF        !@EQUAL
            MOVE      PTELG009,PTELQACC
          ENDIF
.
          MATCH     SP70,PTELG012
          IF        !@EQUAL
            MOVE      PTELG012,PTELCDON
          ENDIF
          MATCH     SP70,PTELG013
          IF        !@EQUAL
            MOVE      PTELG013,PTELRDAT
          ENDIF
          MATCH     SP70,PTELG014
          IF        !@EQUAL
            MOVE      PTELG014,PTELSPEA
          ENDIF
          MATCH     SP70,PTELG015
          IF        !@EQUAL
            MOVE      PTELG015,PTELHFRN
          ENDIF
          MATCH     SP70,PTELG016
          IF        !@EQUAL
            MOVE      PTELG016,PTELPTHF
          ENDIF
.
          MATCH     SP70,PTELG022
          IF        !@EQUAL
            MOVE      PTELG022,PTELECMN
          ENDIF
.
          PACK      PTELHSTM,PTELHSTM,SP70
          MATCH     SP70,PTELG023
          IF        !@EQUAL
            MOVE      PTELG023,PTELHSTM
          ENDIF
.
          PACK      PTELHFPN,PTELHFPN,SP70
          MATCH     SP70,PTELG024
          IF        !@EQUAL
            MOVE      PTELG024,PTELHFPN
          ENDIF
.
          MATCH     SP70,PTELG029
          IF        !@EQUAL
            MOVE      PTELG029,PTELAFRM
          ENDIF
.
          MATCH     SP70,PTELG030
          IF        !@EQUAL
            MOVE      PTELG030,PTELQLPS
          ENDIF
.
          MATCH     SP70,PTELG031
          IF        !@EQUAL
            MOVE      PTELG031,PTELMDES
          ENDIF
.
          MATCH     SP70,PTELG033
          IF        !@EQUAL
            MOVE      PTELG033,PTELEADM
          ENDIF
.
          MATCH     Z70,PTELG035
          IF        !@EQUAL
            MOVE      PTELG035,PTELCPCP
          ENDIF
.
          MATCH     Z70,PTELG036
          IF        !@EQUAL
            MOVE      PTELG036,PTELCSCP
          ENDIF
.
          MATCH     Z70,PTELG037
          IF        !@EQUAL
            MOVE      PTELG037,PTELCDCP
          ENDIF
.
          MATCH     Z70,PTELG038
          IF        !@EQUAL
            MOVE      PTELG038,PTELCHCP
          ENDIF
.
          MATCH     Z70,PTELG039
          IF        !@EQUAL
            MOVE      PTELG039,PTELCTCP
          ENDIF
.
          MOVE      PTELG040,PTELXCSD
          MOVE      PTELG041,PTELPCCU
          MATCH     Z70,PTELG042
          IF        !@EQUAL
            MOVE      PTELG042,PTELCCCU
          ENDIF
          MOVE      PTELG043,PTELPCUT
.
          MATCH     SP70,PTELG044
          IF        !@EQUAL
            MOVE      PTELG044,PTELCMXC      * Casemix code
          ENDIF
.
          MATCH     SP70,PTELG045
          IF        !@EQUAL
            UNPACK    PTELG045,KEY3
            SQUEEZE   KEY3
            MOVE      ZERO,FORM3
            MOVE      KEY3,FORM3
            MOVE      FORM3,PTELECLS           * Expected Casemix LOS
          ENDIF
.
STEL9999  RETURN
+
.-----------------------------------------------------------
.         Clear eligibility fields
.-----------------------------------------------------------
CLRELG00  CALL      CLPATELG
.
CLRELG99  RETURN
+
.**********************************************************************
.         Update Default Printer File for User
.**********************************************************************
UPDEFP00  PACK      KEY20,SETDFPRG,SETDFRPT,WBSEUID,SP70
          UNPACK    KEY20,IBPDPID,IBPDREP,IBPDUID
          MOVE      SCHDPRNT,IBPDPRT
          MOVE      SCHDCOPY,IBPDCOP        * no of copies
          MOVE      STATNCOD,IBPDDOC        * save stat code to document code
          MOVE      SP70,IBPDNUM
          MOVE      SP70,IBPDSPA
          CALL      RAIBPD1
          IF        OVRCD=0
            CALL      UPIBPD1
          ELSE
            CALL      WRIBPD1
          ENDIF
UPDEFP99  RETURN
+
.-----------------------------------------------------------
.         Validate Start/End Date and Time
.-----------------------------------------------------------
VDTM0000  PACK      SAVKEY27,ADMISSNO,PTVEN001,PTVEN002,PTVEN003
          PACK      SAVKEY11,ADMISSNO,PTVEN001,SP70
.
          CALL      RDPTVEN1
          BRANCH    OVRCD,VDTM2000
.
.         Changing existing record, check next record
.
          CALL      RKPTVEN1
          BRANCH    OVRCD,VDTM9000
.
          PACK      KEY11,PTVEVISN,PTVEVTYP,SP70
          MATCH     KEY11,SAVKEY11
          GOTO      VDTM9000 IF NOT EQUAL * No subsequence record exists
.
.         End Date/time must be less than Start Date/Time of next record
.
          CALL      CEND0000              * Check End date/time
          GOTO      VDTM9000
.
.         Adding a new ventilation record
.
VDTM2000  CALL      RPPTVEN1              * read previous record
          BRANCH    OVRCD,VDTM4000
.
          PACK      KEY11,PTVEVISN,PTVEVTYP,SP70
          MATCH     KEY11,SAVKEY11
          GOTO      VDTM4000 IF NOT EQUAL
.
.         Start Date/Time must be greater than End Date/Time of previous record
.
          CALL      CSTR0000              * Check start date/time
          BRANCH    EXIT,VDTM9000
.
.         Check next record
.
VDTM4000  PACK      KEY27,ADMISSNO,PTVEN001,PTVEN002,PTVEN003
          CALL      RDPTVEN1              * reposition
          CALL      RKPTVEN1              * read next record
          BRANCH    OVRCD,VDTM9000
.
          PACK      KEY11,PTVEVISN,PTVEVTYP,SP70
          MATCH     KEY11,SAVKEY11
          GOTO      VDTM9000 IF NOT EQUAL
.
.         End Date/time must be less than Start Date/Time of next record
.
          CALL      CEND0000              * Check End date/time
.
VDTM9000  MOVE      SAVKEY27,KEY27
          CALL      RDPTVEN1
.
VDTM9999  RETURN
+
.------------------------------------------------------------------------
.         Check if End Date/time less than Start Date/Time of next record
.------------------------------------------------------------------------
CEND0000  MOVE      ZERO,EXIT
          MATCH     SP70,PTVEN004
          GOTO      CEND8000 IF EQUAL     * blank End date
          MATCH     SP70,PTVEN005
          GOTO      CEND8000 IF EQUAL     * blank End time
.
          MATCH     PTVESDAT,PTVEN004     * check End date
          GOTO      CEND9999 IF LESS
.
          MATCH     PTVESTIM,PTVEN005     * check End time
          GOTO      CEND9999 IF LESS
.
CEND8000  CLEAR     WEBTITLE
          APPEND    "End Date/Time must be less than Start Date/Time ",WEBTITLE
          APPEND    "of Subsequence Vent.record.",WEBTITLE
          APPEND    SP70,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CEND9999
.
CEND9999  RETURN
+
.-------------------------------------------------------------------------------
.         Check if Start Date/Time greater than End Date/Time of previous record
.-------------------------------------------------------------------------------
CSTR0000  MOVE      ZERO,EXIT
          MATCH     SP70,PTVEEDAT            * End date
          GOTO      CSTR8000 IF EQUAL
          MATCH     SP70,PTVEETIM            * End time
          GOTO      CSTR8000 IF EQUAL
.
.         Check Start Date/Time against End Date/time of Previous record
.
          MATCH     PTVEEDAT,PTVEN002
          GOTO      CSTR8200 IF LESS   * start date < end date of prev.record
          GOTO      CSTR9999 IF NOT EQUAL
.
          MATCH     PTVEETIM,PTVEN003
          GOTO      CSTR8200 IF LESS   * start time < end time of prev.record
.
          GOTO      CSTR9999
.
CSTR8000  MOVE      "End Date/Time of Previous Ventilation is blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VENT9999
.
CSTR8200  CLEAR     WEBTITLE
          APPEND    "Start Date/Time must be greater than ",WEBTITLE
          APPEND    "End Date/Time of Prev.Vent.record",WEBTITLE
          APPEND    SP70,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VENT9999
.
CSTR9999  RETURN
+
.-----------------------------------------------------------
.         Calculate the hours
.-----------------------------------------------------------
CHRS0000  MOVE      ZERO,FORM5P2
          MATCH     SP70,PTVEEDAT
          GOTO      CHRS9000 IF EQUAL       * Blank End date
          MATCH     SP70,PTVEETIM
          GOTO      CHRS9000 IF EQUAL       * Blank End time
.
          UNPACK    PTVEETIM,CHOUR,ANS,CMIN * unpack the end time
          MOVE      CHOUR,FORM2             * set up hours as a form
          MOVE      FORM2,FORM5             * get in work variable
          MULT      "60",FORM5              * get the minutes of full hours
          MOVE      CMIN,FORM2              * set up minutes as a form
          ADD       FORM2,FORM5             * get the total min of end time
.
          UNPACK    PTVESTIM,CHOUR,ANS,CMIN * unpack the start time
          MOVE      CHOUR,FORM2             * set up hours as a form
          MOVE      FORM2,FORM5A            * get in work variable
          MULT      "60",FORM5A             * get the minutes of full hours
          MOVE      CMIN,FORM2              * set up minutes as a form
          ADD       FORM2,FORM5A            * get the total min of start time
.
          MOVE      FORM5,FORM5C
          SUB       FORM5A,FORM5C           * duration = min.end - min.start
.
          MOVE      ZERO,FORM5
          DAYSEP    PTVESDAT,PTVEEDAT,FORM5
          COMPARE   ZERO,FORM5
          GOTO      CHRS2000 IF EQUAL
.
.         The session has gone over midnight...
.
          MOVE      "1440",FORM7P2            * 1440 minutes in 24 hours
          MULT      FORM5,FORM7P2
          ADD       FORM5C,FORM7P2
          DIV       "60",FORM7P2
          MOVE      FORM7P2,FORM5P2
          GOTO      CHRS9000
.
CHRS2000  MOVE      FORM5C,FORM5P2
          DIV       "60",FORM5P2            * convert to hrs
.
CHRS9000  MOVE      FORM5P2,PTVEHOUR
CHRS9999  RETURN
+
.-----------------------------------------------------------
.         Update patient ICU file
.-----------------------------------------------------------
UICU0000  MOVE      ZERO,TOTMECH
          MOVE      ZERO,TOTCPAP
.
          PACK      KEY27,ADMISSNO,SP70
          CALL      RSPTVEN1
UICU1000  CALL      RKPTVEN1
          BRANCH    OVRCD,UICU4000
.
          MATCH     ADMISSNO,PTVEVISN      * Same visit number?
          GOTO      UICU4000 IF NOT EQUAL
.
          PACK      KEY5,ANSV,ANSE,PTVEVTYP
          CALL      RDCODE1
          BRANCH    OVRCD,UICU1000
.
          CMATCH    "1",TCINDC1            * CPAP
          IF        @EQUAL
            ADD       PTVEHOUR,TOTCPAP
          ENDIF
.
          CMATCH    "2",TCINDC1            * Mechanical Ventilation?
          IF        @EQUAL
            ADD       PTVEHOUR,TOTMECH
          ENDIF
.
          GOTO      UICU1000
.
UICU4000  MOVE      ADMISSNO,KEY8
          CALL      RDPTICU1
          BRANCH    OVRCD,UICU6000         * write a new record
.
          IF        PTCNHDPS=4
            UNPACK    TOTMECH,D5,D1,D2     * If QLD calculate Hrs and Mins
            MOVE      ZERO,F2
            MOVE      ZERO,F5           
            MOVE      D5,F5                                  
            MOVE      F5,PTICUMEC          * MV Hours
            MOVE      D2,F2
            ASSIGN    (60*(F2/100)),F2
            MOVE      F2,PTICMECM          * MV Minutes
          ELSE
            MOVE      TOTMECH,PTICUMEC     * MV Hours
          ENDIF
.
          MOVE      TOTCPAP,PTICCPAP
          CALL      UPPTICU1
          GOTO      UICU9999
.
UICU6000  MOVE      ADMISSNO,PTICUADM
          MOVE      ZERO,PTICUINT          * Hrs in Intensive care
.
          IF        PTCNHDPS=4
            UNPACK    TOTMECH,D5,D1,D2     * If QLD calculate Hrs and Mins
            MOVE      ZERO,F2
            MOVE      ZERO,F5
            MOVE      D5,F5
            MOVE      F5,PTICUMEC          * MV Hours
            MOVE      D2,F2
            ASSIGN    (60*(F2/100)),F2
            MOVE      F2,PTICMECM          * MV Minutes
          ELSE
            MOVE      TOTMECH,PTICUMEC     * MV Hours
            MOVE      ZERO,PTICMECM        * MV Minutes
          ENDIF
.
          MOVE      ZERO,PTICUCCU          * Hrs in Critical Care
          MOVE      SP70,PTICAMBN          * Ambulance client number
          MOVE      TOTCPAP,PTICCPAP       * Hrs on CPAP
          MOVE      ZERO,PTICHNCU          * Hrs in NCU
          MOVE      ZERO,PTICINTM          * Minutes of ICU
          MOVE      SP70,PTICUSPR
          MOVE      SP70,PTICCHSC
          CALL      WRPTICU1
UICU9999  RETURN
+
.-----------------------------------------------------------
.         Clear fields for Ventilation 
.-----------------------------------------------------------
CLVENT00  UNPACK    SP70,PTVEVTYP,PTVESDAT,PTVESTIM,PTVEEDAT,PTVEETIM
          UNPACK    SP70,PTVEICUS,PTVEISIT
          MOVE      ZERO,PTVEHOUR
CLVENT99  RETURN
+
.-----------------------------------------------------------
.         Warning message for Billing 
.-----------------------------------------------------------
WARN0000  CALL      OPENHTML
          BRANCH    EXIT,WARN9000
.
          MOVE      "Warning: Billing will Not be adjusted.",WEBTITLE
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");",012
.
          REP       " +",ADMISSNO
          REP       " +",URNUMBER
          CLEAR     REDIRECT
          APPEND    "patweb98.pbl?reportno=01&template=035&admissno=",REDIRECT
          APPEND    ADMISSNO,REDIRECT
          APPEND    "&urnumber=",REDIRECT
          APPEND    URNUMBER,REDIRECT
          RESET     REDIRECT
          REP       "+ ",ADMISSNO
          REP       "+ ",URNUMBER
.
          WRITE     HTMLFILE;" if (self.name.match(/PopUpFrame/)) {":
                             "  parent.PopUpScreen.style.display=#"none#"; ":
                             "  parent.location.href=#"",REDIRECT,"#"}":
                             " else {":
                             "  location.href=#"",REDIRECT,"#"}":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      WARN9999
.
WARN9000  DISPLAY   "*** Fifo Not Found ***"
WARN9999  RETURN
+
.-----------------------------------------------------------
.         Clear Change audit fields
.-----------------------------------------------------------
CLCAU000  UNPACK    SP70,PMCAVISN,PMCADATE,PMCATIME
          UNPACK    SP70,PMCAOCLM,PMCANCLM,PMCAOATY,PMCANATY
          UNPACK    SP70,PMCAOHFN,PMCANHFN,PMCAOHFT,PMCANHFT
          UNPACK    SP70,PMCAWBID,PMCASPAR
CLCAU999  RETURN
.
.-----------------------------------------------------------
.         Update Change Audit file
.-----------------------------------------------------------
UAUD0000  MOVE      ADMISSNO,PMCAVISN        * Admission number
          MOVE      CURRDATE,PMCADATE
          CLOCK     TIME,PMCATIME
.
          PACK      KEY24,PMCAVISN,PMCADATE,PMCATIME
          CALL      RAPMCAU1
          IF        OVRCD=1
            MOVE      USERID,PMCAWBID
            CALL      WRPMCAU1               * write a new record
            GOTO      UAUD9999
          ENDIF
.
.         If record already exit, just update the new code
.
          CALL      RDPMCAU1
          BRANCH    OVRCD,UAUD9999
.
          MATCH     "1",UPDTTYPE
          IF        @EQUAL
            UNPACK    KEY14,PMCANCLM         * New claim code
          ENDIF
.
          MATCH     "2",UPDTTYPE
          IF        @EQUAL
            UNPACK    KEY14,PMCANATY         * New admission type
          ENDIF
.
          MATCH     "3",UPDTTYPE
          IF        @EQUAL
            UNPACK    KEY14,PMCANHFN,PMCANHFT   * New Health Fund and Fund Table
          ENDIF
          MOVE      USERID,PMCAWBID
          CALL      UPPMCAU1
UAUD9999  RETURN
.
.------------------------------------------------------------------------------
.                Check Cross Consultation Details - Date
. This procedure checks whether a consultation entry exists on patcrcaf
. for given date, admission number and referring/reffered consultants 
. combination.  
. RETURN VALUES: 1 = Error, record already exists
.                0 = OK, record does not exist
.------------------------------------------------------------------------------
CHKDTE00  PACK      KEY39,PTCRC001,PTCRC002,PTCRC005,ADMISSNO,SP70
          CALL      RSPTCRC2
          CALL      RKPTCRC2
          BRANCH    OVRCD,CHKDTE90          * Record not found, return OK
.
          MATCH     ADMISSNO,DPTCRBIL       * Same Admission No.?
          GOTO      CHKDTE90 IF NOT EQUAL   * No, record not found, return OK
.
          MATCH     PTCRC001,PTCRDOCT       * Same Referring Consultant?
          GOTO      CHKDTE90 IF NOT EQUAL   * No, record not found, return OK
.
          MATCH     PTCRC002,PTCRREFD       * Same Referred Consultant?
          GOTO      CHKDTE90 IF NOT EQUAL   * No, record not found, return OK
.
          MATCH     PTCRC005,PTCRDATE       * Same Date?
          GOTO      CHKDTE90 IF NOT EQUAL   * No, record not found, return OK
.
.         Given record already exists, return code 1 = ERROR
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                    ONE:
                    "</RETURN_VALUE>";
.
          GOTO      CHKDTE99
.
CHKDTE90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                    ZERO:
                    "</RETURN_VALUE>";
.
CHKDTE99  RETURN
.
.------------------------------------------------------------------------------
.                Check Cross Consultation Combination
. This procedure ensures that the following two combinations never duplicate
. 1. Referring Consultant & Referred to Consultant: PTCRDOCT & PTCRREFD
. 2. Referring Consultant & Specialty: PTCRDOCT & PTCRSPEC
.
. RETURN VALUES: 1 = Error, combination already exists
.                0 = OK, combination does not exist
.------------------------------------------------------------------------------
.------------------------------------------------------------------------------
.                Check Cross Consultation Combination
. This procedure ensures that the following two combinations never duplicate
. 1. Referring Consultant & Referred to Consultant: PTCRDOCT & PTCRREFD
. 2. Referring Consultant & Specialty: PTCRDOCT & PTCRSPEC
.
. RETURN VALUES: 1 = Error, combination already exists
.                0 = OK, combination does not exist
.------------------------------------------------------------------------------
.
CHKCMB00  PACK      KEY31,ADMISSNO,PTCRC001,SP70
          CALL      RSPTCRC1
CHKCMB10  CALL      RKPTCRC1
          BRANCH    OVRCD,CHKCMB90          * Record not found, return OK
.
          MATCH     ADMISSNO,DPTCRBIL       * Same Admission No.?
          GOTO      CHKCMB90 IF NOT EQUAL   * No, record not found, return OK
.
          MATCH     PTCRC001,PTCRDOCT       * Same Referring Consultant?
          GOTO      CHKCMB90 IF NOT EQUAL   * No, record not found, return OK
.
          MATCH     SP70,PTCRC002
          GOTO      CHKCMB50 IF EQUAL
.
          MATCH     PTCRC002,PTCRREFD       * Same Referred Consultant?
          GOTO      CHKCMB10 IF NOT EQUAL   * No, record not found, return OK
.
          PACK      KEY5,Ac,PTCRACTN,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CHKCMB10
.
          MATCH     "R",TCINDC1             * Previous consult completed?
          GOTO      CHKCMB91 IF EQUAL       * NO: Error - duplicate not allowed
          GOTO      CHKCMB10 IF NOT EQUAL
.
CHKCMB50  MATCH     SPECIALT,PTCRSPEC       * Same Speciality?
          GOTO      CHKCMB10 IF NOT EQUAL   * No, get next record
.
          PACK      KEY5,Ac,PTCRACTN,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CHKCMB10
.
          MATCH     "R",TCINDC1             * Previous consult completed?
          GOTO      CHKCMB91 IF EQUAL       * NO: Error - duplicate not allowed
          GOTO      CHKCMB10 IF NOT EQUAL   * YES: Duplicate ok
.
CHKCMB90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":           * OK
                    ZERO:
                    "</RETURN_VALUE>";
.
CHKCMB91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":           * ERROR
                    ONE:
                    "</RETURN_VALUE>";
.
CHKCMB99  RETURN
.
.*******************************************************************************
. Check if AN-SNAP Auto Classification Calculator               
.*******************************************************************************
AACC0000  PACK      KEY20,VALDICDE,VALDSDAT,Z70
          CALL      RSPMSNC2
AACC1000  CALL      RPPMSNC2
          BRANCH    OVRCD,AACC9100
.
          MATCH     VALDICDE,PMSCICDE
          GOTO      AACC9100 IF NOT EQUAL
.
          MATCH     PMSCDEFF,VALDSDAT
          GOTO      AACC1000 IF LESS
.
          MATCH     SP70,PMSCDEFT
          IF        !@EQUAL
            MATCH     VALDSDAT,PMSCDEFT
            GOTO      AACC1000 IF LESS
          ENDIF
.
          GOTO      AACC9000 
.
AACC9000  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             PMSCCLCD,"|",PMSCVERS:
                             "</RETURN_VALUE>"

          GOTO      AACC9999
.
AACC9100  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "</RETURN_VALUE>";
          GOTO      AACC9999
.
AACC9999  RETURN
.------------------------------------------------------------------------------
.           Add Consultation Details for Existing Combination
.------------------------------------------------------------------------------
ADDCDT00  PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,Z70
          CALL      RSPTCRC1
          CALL      RPPTCRC1
          BRANCH    OVRCD,ADDCDT10
.
          MATCH     ADMISSNO,DPTCRBIL       * Same Admission no.?
          GOTO      ADDCDT10 IF NOT EQUAL   * No, first record for combination
.
          MATCH     PTCRC001,PTCRDOCT       * Same Referring Consultant?
          GOTO      ADDCDT10 IF NOT EQUAL   * No, first record for combination
.
          MATCH     PTCRC002,PTCRREFD       * Same Referred Consultant?
          GOTO      ADDCDT10 IF NOT EQUAL   * No, first record for combination
.
.         Combination already exists...
.
          ADD       ONE,PTCRCNTR            * Incremeant record counter
          MOVE      SP70,PTCRCMNT           * Clear comments
          GOTO      ADDCDT20                * Go to write record
.
.         Combination does not exist, insert first row for new combination.
.
ADDCDT10  MOVE      ADMISSNO,PTCRBILL       * Set Admission No
          MOVE      PTCRC001,PTCRDOCT       * Set Referring Consultant
          MOVE      PTCRC002,PTCRREFD       * Set Referred Cosnultant
          MOVE      ONE,PTCRCNTR            * Set record counter to 1
          MOVE      PTCRC004,PTCRCMNT       * Populate comments field
.
ADDCDT20  MOVE      CRSCDATE[ARRINDEX],PTCRDATE  * Populate Date Seen
          MOVE      CRSCHRS[ARRINDEX],PTCRAMNT   * Populate Time Taken (Hours)
          MOVE      CRSCSER[ARRINDEX],PTCRMISC   * Service Code
          MOVE      PTCRCNTR,KEY3
          MOVE      PTCRC008,PTCRSPEC            * Set Speciality Code
          MOVE      PTCRC009,PTCRTIME
          MOVE      PTCRC010,PTCRACTN
          MOVE      PTCRC011,PTCRUNIT
          MOVE      PTCRC012,PTCRCOMM
.
          PACK      KEY31,PTCRBILL,PTCRDOCT,PTCRREFD,KEY3,SP70
          CALL      RDPTCRC1
          IF        OVRCD=1
            CALL      WRPTCRC1
          ENDIF
.
ADDCDT99  RETURN
.
.------------------------------------------------------------------------------
.    Cross Consulting - Update record counter for remaining records
.------------------------------------------------------------------------------
UPDCNT00  PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,KEY3,SP70
          CALL      RSPTCRC1
          CALL      RKPTCRC1
          BRANCH    OVRCD,UPDCNT99
.
          MATCH     ADMISSNO,DPTCRBIL       * Same Admission no.?
          GOTO      UPDCNT99 IF NOT EQUAL   * No, finished processing, exit
.
          MATCH     PTCRC001,PTCRDOCT       * Same Referring Consultant?
          GOTO      UPDCNT99 IF NOT EQUAL   * No, finished processing, exit
.
          MATCH     PTCRC002,PTCRREFD       * Same Referred Consultant?
          GOTO      UPDCNT99 IF NOT EQUAL   * No, finished processing, exit
.
          SUBTRACT  ONE,PTCRCNTR            * Decremeant record counter
          MOVE      PTCRCNTR,KEY3           * Set conter for next record read
.
.         Populate comments field if the first record was deleted
.
          IF        PTCRCNTR=ONE
            MOVE     SAVECMNT,PTCRCMNT      * Set comments field
          ENDIF
.
          CALL      UPPTCRC1                * Update record
          GOTO      UPDCNT00                * Get next record 
.
UPDCNT99  RETURN
.------------------------------------------------------------------------------
.          Get next location to display (Cross Consulting)
.
. If the cross consultation record being modified or deleted is the last
. consultation details record for the given cross consulting combination
. (Referring/Referred consultatnts) then the next screen to be displayed is
. the Cross Consulting List. If there are further detail records for this 
. combination then display Consultation Details List.
.------------------------------------------------------------------------------
GETNXT00  PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,SP70
          CALL      RSPTCRC1
GETNXT10  CALL      RKPTCRC1
          BRANCH    OVRCD,GETNXT90
.
          MATCH     ADMISSNO,DPTCRBIL       * Same Admission no.?
          GOTO      GETNXT90 IF NOT EQUAL   * No, exit
.
          MATCH     PTCRC001,PTCRDOCT       * Same Referring Consultant?
          GOTO      GETNXT90 IF NOT EQUAL   * No, exit
.
          MATCH     PTCRC002,PTCRREFD       * Same Referred Consultant?
          GOTO      GETNXT90 IF NOT EQUAL   * No, exit
.
          MATCH     SP70,PTCRC002           * Blank Referred Consultant?
          GOTO      GETNXT90 IF NOT EQUAL   * No, exit
.
          MATCH     SP70,PTCRC008           * Speciality specified?
          GOTO      GETNXT90 IF EQUAL       * No, exit
.
          MATCH     PTCRC008,PTCRSPEC       * Same Speciality?
          GOTO      GETNXT10 IF NOT EQUAL   * No, read next until we find one
.
.         Found record for given Cross Consultation combination. 
.         Exit, the Consultation Details List will be displayed.
.
          GOTO      GETNXT99
.
.         No more records for given combination. Set next page to SIX - this
.         will cause the Cross Consultation List to be displayed.
.
GETNXT90  MOVE      SIX,NEXTPAGE
.
GETNXT99  RETURN
.
.------------------------------------------------------------------------------
.        Update All Cross Consultation Records with new Consultants
.------------------------------------------------------------------------------
UPDALL00  PACK      KEY31,ADMISSNO,ORIGDOCT,ORIGREFD,SP70
          CALL      RSPTCRC1
          CALL      RKPTCRC1
          BRANCH    OVRCD,UPDALL99          * Finished processing, exit
.
          MATCH     ADMISSNO,DPTCRBIL       * Same Admission no.?
          GOTO      UPDALL99 IF NOT EQUAL   * No, finished processing, exit
.
          MATCH     ORIGDOCT,PTCRDOCT       * Same Referring Consultant?
          GOTO      UPDALL99 IF NOT EQUAL   * No, finished processing, exit
.
          MATCH     ORIGREFD,PTCRREFD       * Same Referred Consultant?
          GOTO      UPDALL99 IF NOT EQUAL   * No, finished processing, exit
.
          MOVE      PTCRC001,PTCRDOCT       * Set new Referring Consultant
          MOVE      PTCRC002,PTCRREFD       * Set new Referred Consultant
.
          CALL      UPPTCRC1                * Update Record
          GOTO      UPDALL00                * Get next record
.
UPDALL99  RETURN
.---------------------------------------------------------------------------
.  Clears File Data             
.---------------------------------------------------------------------------
CLRTRE00  MOVE      SP70,DPTRDADM  * Admission Number
          MOVE      SP70,DPTRDEPN  * Episode Number
          MOVE      ZERO,PTRDBISA  * Barthel Index Score on Admission
          MOVE      ZERO,PTRDBISD  * Barthel Index Score on Discharge
          MOVE      SP70,PTRDCLSP  * Clinical Sub Program (category CU)
          MOVE      SP70,PTRDODTE  * Onset Date (ccyymmdd)
          MOVE      SP70,PTRDARTR  * Admission/Readmission to Rehab.
          MOVE      SP70,PTRDUSRF  * User Flag
          MOVE      SP70,PTRDPCSA  * Palliative Care State on Admission
          MOVE      SP70,PTRDPCSD  * Palliative Care State on Discharge
          MOVE      SP70,PTRDRGAA  * RUG ADL on Admission
          MOVE      SP70,PTRDRGAD  * RUG ADL on Discharge
          MOVE      SP70,PTRDSRPC  * Source of Referal for Pall Care
          MOVE      ZERO,PTRDFIMA  * F.I.M. Score on Admission
          MOVE      ZERO,PTRDFIMD  * F.I.M. Score on Discharge
          MOVE      SP70,PTRDDIAG  * Diagnostic Group
          MOVE      SP70,PTRDCOM1  * Comments line 1
          MOVE      SP70,PTRDCOM2  * Comments line 2
          MOVE      SP70,PTRDFADT  * Functional Assess Date Adm
          MOVE      SP70,PTRDFDDT  * Functional Assess Date Dsch
          MOVE      SP70,PTRDIMPR  * Impairment Code (pmsimpaf)
          MOVE      SP70,PTRDPOCA  * Phase Of Care on Admission (cat pu)
          MOVE      SP70,PTRDPOCD  * Phase Of Care on Discharge (cat pu)
          MOVE      SP70,PTRDVERS  * AN-SNAP Version (pmssnpaf)
          MOVE      SP70,PTRDSNAP  * AN-SNAP Classification (pmssnpaf)
          MOVE      SP70,PTRDSPAR  * Spare Variable
          MOVE      SP70,PMVXUDF9  * Death Place
.
CLRTRE99  RETURN
.---------------------------------------------------------------------------
.  Clears QLD File Data
.---------------------------------------------------------------------------
CLRQRD00  MOVE      SP70,DPTQRADM  * Admission Number
          MOVE      SP70,DPTQREPN  * Episode Number
          MOVE      SP70,DPTQRCNT  * Episode counter
          MOVE      ZERO,PTQRBISA  * Barthel Index Score on Admission
          MOVE      ZERO,PTQRBISD  * Barthel Index Score on Discharge
          MOVE      SP70,PTQRCLSP  * Clinical Sub Program (category CU)
          MOVE      SP70,PTQRODTE  * Onset Date (ccyymmdd)
          MOVE      SP70,PTQRARTR  * Admission/Readmission to Rehab.
          MOVE      SP70,PTQRUSRF  * User Flag
          MOVE      SP70,PTQRPCSA  * Palliative Care State on Admission
          MOVE      SP70,PTQRPCSD  * Palliative Care State on Discharge
          MOVE      SP70,PTQRRGAA  * RUG ADL on Admission
          MOVE      SP70,PTQRRGAD  * RUG ADL on Discharge
          MOVE      SP70,PTQRSRPC  * Source of Referal for Pall Care
          MOVE      ZERO,PTQRFIMA  * F.I.M. Score on Admission
          MOVE      ZERO,PTQRFIMD  * F.I.M. Score on Discharge
          MOVE      SP70,PTQRDIAG  * Diagnostic Group
          MOVE      SP70,PTQRCOM1  * Comments line 1
          MOVE      SP70,PTQRCOM2  * Comments line 2
          MOVE      SP70,PTQRFADT  * Functional Assess Date Adm
          MOVE      SP70,PTQRFDDT  * Functional Assess Date Dsch
          MOVE      SP70,PTQRMCDT  * Multidisciplinary Care Date
          MOVE      SP70,PTQRSPAR  * Spare Variable
.
CLRQRD99  RETURN
.
.---------------------------------------------------------------------------
.  Clears File Data             
.---------------------------------------------------------------------------
SAVTRE00  MOVE      ADMISSNO,PTRDADMN  * Admission Number
          MOVE      EPISODNO,PTRDEPNO  * Episode Number
          MOVE      PTRDE001,PTRDBISA  * Barthel Index Score on Admission
          MOVE      PTRDE002,PTRDBISD  * Barthel Index Score on Discharge
          MOVE      PTRDE003,PTRDCLSP  * Clinical Sub Program (category CU)
          MOVE      PTRDE004,PTRDODTE  * Onset Date (ccyymmdd)
          MOVE      PTRDE005,PTRDARTR  * Admission/Readmission to Rehab.
          MOVE      PTRDE006,PTRDUSRF  * User Flag
          MOVE      PTRDE007,PTRDPCSA  * Palliative Care State on Admission
          MOVE      PTRDE008,PTRDPCSD  * Palliative Care State on Discharge
          MOVE      PTRDE017,PTRDFADT  * Functional Assessment date on adm
          MOVE      PTRDE018,PTRDFDDT  * Functional Assessment date on disch
.
          MOVE      PTRDE009,PTRDRGAA  * RUG ADL on Admission
          MATCH     SP70,PTRDRGAA
          IF        !@EQUAL
            REP       " 0",PTRDRGAA    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE010,PTRDRGAD  * RUG ADL on Discharge
          MATCH     SP70,PTRDRGAD
          IF        !@EQUAL
            REP       " 0",PTRDRGAD    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE011,PTRDSRPC  * Source of Referal for Pall Care
          MATCH     SP70,PTRDSRPC
          IF        !@EQUAL
            REP       " 0",PTRDSRPC    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE012,PTRDFIMA  * F.I.M. Score on Admission
          MOVE      PTRDE013,PTRDFIMD  * F.I.M. Score on Discharge
          MOVE      PTRDE014,PTRDDIAG  * Diagnostic Group
          MOVE      PTRDE015,PTRDCOM1  * Comments line 1
          MATCH     SP70,PTRDE019
          IF        !@EQUAL
            MOVE      PTRDE019,PTRDCOM1  * ADL Date
          ENDIF
          MOVE      PTRDE016,PTRDCOM2  * Comments line 2
          MATCH     Z70,PTRDE021
          IF        !@EQUAL
            MOVE      PTRDE021,PTRDIMPR  * Impairment Code (pmsimpaf)
          ENDIF
          MATCH     Z70,PTRDE022
          IF        !@EQUAL
            MOVE      PTRDE022,PTRDPOCA  * Phase Of Care on Admission (cat pu)
          ENDIF
          MATCH     Z70,PTRDE023
          IF        !@EQUAL
            MOVE      PTRDE023,PTRDPOCD  * Phase Of Care on Discharge (cat pu)
          ENDIF
          MATCH     Z70,PTRDE024
          IF        !@EQUAL
            MOVE      PTRDE024,PMVXUDF9  * Preferred Death place (cat lj)
          ENDIF
          MATCH     Z70,PTRDE025
          IF        !@EQUAL
            MOVE      PTRDE025,PTRDVERS  * AN-SNAP Version
          ENDIF
          MATCH     Z70,PTRDE026
          IF        !@EQUAL
            MOVE      PTRDE026,PTRDSNAP  * AN-SNAP Classification
          ENDIF
          MOVE      SP70,PTRDSPAR      * Spare Variable
.
SAVTRE99  RETURN
.---------------------------------------------------------------------------
.  Save QLD File Data
.---------------------------------------------------------------------------
SAVQRD00  MOVE      ADMISSNO,PTQRADMN  * Admission Number
          MOVE      EPISODNO,PTQREPNO  * Episode Number
          MOVE      EPISODCT,PTQRCNTR  * Episode counter
          MOVE      PTRDE001,PTQRBISA  * Barthel Index Score on Admission
          MOVE      PTRDE002,PTQRBISD  * Barthel Index Score on Discharge
          MOVE      PTRDE003,PTQRCLSP  * Clinical Sub Program (category CU)
          MOVE      PTRDE004,PTQRODTE  * Onset Date (ccyymmdd) 
          MOVE      PTRDE005,PTQRARTR  * Admission/Readmission to Rehab.
          MOVE      PTRDE006,PTQRUSRF  * User Flag
          MOVE      PTRDE007,PTQRPCSA  * Palliative Care State on Admission
          MOVE      PTRDE008,PTQRPCSD  * Palliative Care State on Discharge
          MOVE      PTRDE017,PTQRFADT  * Functional Assessment date on adm
          MOVE      PTRDE018,PTQRFDDT  * Functional Assessment date on disch
          MOVE      PTRDE020,PTQRMCDT  * Multidisciplinary Care Date
.         
          MOVE      PTRDE009,PTQRRGAA  * RUG ADL on Admission
          MATCH     SP70,PTQRRGAA
          IF        !@EQUAL
            REP       " 0",PTQRRGAA    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE010,PTQRRGAD  * RUG ADL on Discharge
          MATCH     SP70,PTQRRGAD
          IF        !@EQUAL
            REP       " 0",PTQRRGAD    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE011,PTQRSRPC  * Source of Referal for Pall Care
          MATCH     SP70,PTQRSRPC
          IF        !@EQUAL
            REP       " 0",PTQRSRPC    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE012,PTQRFIMA  * F.I.M. Score on Admission
          MOVE      PTRDE013,PTQRFIMD  * F.I.M. Score on Discharge
          MOVE      PTRDE014,PTQRDIAG  * Diagnostic Group
          MOVE      PTRDE015,PTQRCOM1  * Comments line 1
          MATCH     SP70,PTRDE019
          IF        !@EQUAL
            MOVE      PTRDE019,PTQRCOM1  * ADL Date
          ENDIF
          MOVE      PTRDE016,PTQRCOM2  * Comments line 2
          MOVE      SP70,PTQRSPAR      * Spare Variable
.
SAVQRD99  RETURN
.-------------------------------------------------------------------------
.  Validate Onset Date - Note routine only updates fields that are on the
.  equivalent templates
.  ACUTTYPE: 1 = Rehab Episode Update
.            2 = Palliatvie Episode Update
.            3 = Geriatric Episode Update
.-------------------------------------------------------------------------
UPDTRE00  PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          BRANCH    ACUTTYPE,UPDTRE10,UPDTRE20,UPDTRE30
          GOTO      UPDTRE99
.
UPDTRE10  MOVE      PTRDE001,PTRDBISA  * Barthel Index Score on Admission 
          MOVE      PTRDE002,PTRDBISD  * Barthel Index Score on Discharge
          MOVE      PTRDE003,PTRDCLSP  * Clinical Sub Program (category CU)
          MOVE      PTRDE004,PTRDODTE  * Onset Date (ccyymmdd)
          MOVE      PTRDE005,PTRDARTR  * Admission/Readmission to Rehab.
          MOVE      PTRDE006,PTRDUSRF  * User Flag
          MOVE      PTRDE012,PTRDFIMA  * F.I.M. Score on Admission
          MOVE      PTRDE013,PTRDFIMD  * F.I.M. Score on Discharge
          MOVE      PTRDE014,PTRDDIAG  * Diagnostic Group
          MOVE      PTRDE015,PTRDCOM1  * Comments line 1
          MATCH     SP70,PTRDE019
          IF        !@EQUAL
            MOVE      PTRDE019,PTRDCOM1  * ADL Date
          ENDIF
          MOVE      PTRDE016,PTRDCOM2  * Comments line 2
          MOVE      PTRDE017,PTRDFADT  * Functional assessment date on adm
          MOVE      PTRDE018,PTRDFDDT  * Functional assessment date on disch
          MATCH     Z70,PTRDE021
          IF        !@EQUAL
            MOVE      PTRDE021,PTRDIMPR  * Impairment Code (pmsimpaf)
          ENDIF
          MATCH     Z70,PTRDE022
          IF        !@EQUAL
            MOVE      PTRDE022,PTRDPOCA  * Phase Of Care on Admission (cat pu)
          ENDIF
          MATCH     Z70,PTRDE023
          IF        !@EQUAL
            MOVE      PTRDE023,PTRDPOCD  * Phase Of Care on Discharge (cat pu)
          ENDIF
.  
          GOTO      UPDTRE40
.
UPDTRE20  MOVE      PTRDE007,PTRDPCSA  * Palliative Care State on Admission
          MOVE      PTRDE008,PTRDPCSD  * Palliative Care State on Discharge
          MOVE      PTRDE004,PTRDODTE  * Onset Date (ccyymmdd)
.
          MOVE      PTRDE009,PTRDRGAA  * RUG ADL on Admission
          MATCH     SP70,PTRDRGAA
          IF        !@EQUAL
            REP       " 0",PTRDRGAA    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE010,PTRDRGAD  * RUG ADL on Discharge
          MATCH     SP70,PTRDRGAD
          IF        !@EQUAL
            REP       " 0",PTRDRGAD    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE011,PTRDSRPC  * Source of Referal for Pall Care
          MATCH     SP70,PTRDSRPC
          IF        !@EQUAL
            REP       " 0",PTRDSRPC    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE014,PTRDDIAG  * Diagnostic Group
          MOVE      PTRDE015,PTRDCOM1  * Comments line 1
          MOVE      PTRDE016,PTRDCOM2  * Comments line 2
          MOVE      PTRDE017,PTRDFADT  * Functional assessment date on adm
          MOVE      PTRDE018,PTRDFDDT  * Functional assessment date on disch
          MATCH     Z70,PTRDE021
          IF        !@EQUAL
            MOVE      PTRDE021,PTRDIMPR  * Impairment Code (pmsimpaf)
          ENDIF
          MATCH     Z70,PTRDE022
          IF        !@EQUAL
            MOVE      PTRDE022,PTRDPOCA  * Phase Of Care on Admission (cat pu)
          ENDIF
          MATCH     Z70,PTRDE023
          IF        !@EQUAL
            MOVE      PTRDE023,PTRDPOCD  * Phase Of Care on Discharge (cat pu)
          ENDIF
          MATCH     Z70,PTRDE024
          IF        !@EQUAL
            MOVE      PTRDE024,PMVXUDF9  * Preferred Death Place (cat lj)
          ENDIF
.
          GOTO      UPDTRE40
.
UPDTRE30  MOVE      PTRDE001,PTRDBISA  * Barthel Index Score on Admission 
          MOVE      PTRDE002,PTRDBISD  * Barthel Index Score on Discharge
          MOVE      PTRDE006,PTRDUSRF  * User Flag
          MOVE      PTRDE012,PTRDFIMA  * F.I.M. Score on Admission
          MOVE      PTRDE013,PTRDFIMD  * F.I.M. Score on Discharge
          MOVE      PTRDE014,PTRDDIAG  * Diagnostic Group
          MOVE      PTRDE015,PTRDCOM1  * Comments line 1
          MATCH     SP70,PTRDE019
          IF        !@EQUAL
            MOVE      PTRDE019,PTRDCOM1  * ADL Date
          ENDIF
          MOVE      PTRDE016,PTRDCOM2  * Comments line 2
          MOVE      PTRDE017,PTRDFADT  * Functional assessment date on adm
          MOVE      PTRDE018,PTRDFDDT  * Functional assessment date on disch
          MATCH     Z70,PTRDE021
          IF        !@EQUAL
            MOVE      PTRDE021,PTRDIMPR  * Impairment Code (pmsimpaf)
          ENDIF
          MATCH     Z70,PTRDE022
          IF        !@EQUAL
            MOVE      PTRDE022,PTRDPOCA  * Phase Of Care on Admission (cat pu)
          ENDIF
          MATCH     Z70,PTRDE023
          IF        !@EQUAL
            MOVE      PTRDE023,PTRDPOCD  * Phase Of Care on Discharge (cat pu)
          ENDIF
.  
UPDTRE40  MATCH     Z70,PTRDE025
          IF        !@EQUAL
            MOVE      PTRDE025,PTRDVERS  * AN SNAP Version
          ENDIF
          MATCH     Z70,PTRDE026
          IF        !@EQUAL
            MOVE      PTRDE026,PTRDSNAP  * AN SNAP Classification
          ENDIF
.
          PACK      KEY10,PTRDADMN,PTRDEPNO,SP70
          CALL      RAPTRDE1
          IF        OVRCD=0
            CALL      UPPTRDE1           * Write to the Rehab Details File
          ENDIF

          IF        ACUTTYPE=2
            MATCH     Z70,PTRDE024
            IF        !@EQUAL
              PACK      KEY8,ADMISSNO,SP70
              CALL      RDPMVX11
              IF        OVRCD=0
                MOVE      PTRDE024,PMVXUDF9
                CALL      UPPMVX11  * Update Patient system Visit Extension file
              ENDIF
            ENDIF
          ENDIF
.
          COMPARE   TWO,PTRDEPNO
          GOTO      UPDTRE50 IF NOT LESS    * Episode no >= 2
.
          MATCH     "20000701",CURRDATE
          GOTO      UPDTRE50 IF NOT LESS    * Current date >= 1/7/2000
.
          MOVE      PTRDADMN,CMADMNO
          MOVE      CURRDATE,CMCDATE
          PACK      KEY16,CMADMNO,CMCDATE
          CALL      RDCMOR1               * Read a morbidity changes file rec
          IF        OVRCD=1
            MOVE      "C",CMNEWFLG        * Change record
            PACK      KEY16,CMADMNO,CMCDATE
            CALL      WRCMOR1             * Write a morbidity changes file rec
          ENDIF
          GOTO      UPDTRE99
.
UPDTRE50  
...MOVE      PTRDADMN,PTEMADMN
...       MOVE      PTRDEPNO,PTEMEPNO
...       MOVE      CURRDATE,PTEMCDTE
...       PACK      KEY18,PTEMADMN,PTEMEPNO,PTEMCDTE
...       CALL      RDPTECM1              * Read an episode morb chan file rec
...       IF        OVRCD=1
...         MOVE      "C",PTEMNEWF        * 1st record flag change
...         PACK      KEY18,PTEMADMN,PTEMEPNO,PTEMCDTE
...         CALL      WRPTECM1            * Write an episode morb chan file rec
...       ENDIF
.
UPDTRE99  RETURN
.-------------------------------------------------------------------------
.  Update the QLD rehab details file
.  ACUTTYPE: 1 = Rehab Episode Update
.            2 = Palliatvie Episode Update
.            3 = Geriatric Episode Update
.-------------------------------------------------------------------------
UPDQRD00  PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          BRANCH    ACUTTYPE,UPDQRD10,UPDQRD20,UPDQRD30
          GOTO      UPDQRD99
.
UPDQRD10  MOVE      PTRDE001,PTQRBISA  * Barthel Index Score on Admission
          MOVE      PTRDE002,PTQRBISD  * Barthel Index Score on Discharge
          MOVE      PTRDE003,PTQRCLSP  * Clinical Sub Program (category CU)
          MOVE      PTRDE004,PTQRODTE  * Onset Date (ccyymmdd)
          MOVE      PTRDE005,PTQRARTR  * Admission/Readmission to Rehab.
          MOVE      PTRDE006,PTQRUSRF  * User Flag
          MOVE      PTRDE009,PTQRRGAA  * RUG ADL on Admission
          MOVE      PTRDE012,PTQRFIMA  * F.I.M. Score on Admission
          MOVE      PTRDE013,PTQRFIMD  * F.I.M. Score on Discharge
          MOVE      PTRDE014,PTQRDIAG  * Diagnostic Group
          MOVE      PTRDE015,PTQRCOM1  * Comments line 1
          MATCH     SP70,PTRDE019
          IF        !@EQUAL
            MOVE      PTRDE019,PTQRCOM1  * ADL Date
          ENDIF
          MOVE      PTRDE016,PTQRCOM2  * Comments line 2
          MOVE      PTRDE017,PTQRFADT  * Functional assessment date on adm
          MOVE      PTRDE018,PTQRFDDT  * Functional assessment date on disch
          MOVE      PTRDE020,PTQRMCDT  * Multidisciplinary Care Date
.
          GOTO      UPDQRD40
.
UPDQRD20  MOVE      PTRDE007,PTQRPCSA  * Palliative Care State on Admission
          MOVE      PTRDE008,PTQRPCSD  * Palliative Care State on Discharge
.
          MOVE      PTRDE009,PTQRRGAA  * RUG ADL on Admission
          MATCH     SP70,PTQRRGAA
          IF        !@EQUAL
            REP       " 0",PTQRRGAA    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE010,PTQRRGAD  * RUG ADL on Discharge
          MATCH     SP70,PTQRRGAD
          IF        !@EQUAL
            REP       " 0",PTQRRGAD    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE011,PTQRSRPC  * Source of Referal for Pall Care
          MATCH     SP70,PTQRSRPC
          IF        !@EQUAL
            REP       " 0",PTQRSRPC    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE014,PTQRDIAG  * Diagnostic Group
          MOVE      PTRDE015,PTQRCOM1  * Comments line 1
          MOVE      PTRDE016,PTQRCOM2  * Comments line 2
          MOVE      PTRDE017,PTQRFADT  * Functional assessment date on adm
          MOVE      PTRDE018,PTQRFDDT  * Functional assessment date on disch
          MOVE      PTRDE020,PTQRMCDT  * Multidisciplinary Care Date
.
          GOTO      UPDQRD40
.
UPDQRD30  MOVE      PTRDE001,PTQRBISA  * Barthel Index Score on Admission
          MOVE      PTRDE002,PTQRBISD  * Barthel Index Score on Discharge
          MOVE      PTRDE003,PTQRCLSP  * Clinical Sub Program (category CU)
          MOVE      PTRDE006,PTQRUSRF  * User Flag
          MATCH     SP70,PTRDE007
          IF        !@EQUAL
            MOVE      PTRDE007,PTQRPCSA  * Phase Type
          ENDIF
          MOVE      PTRDE009,PTQRRGAA  * RUG ADL on Admission
          MATCH     SP70,PTQRRGAA
          IF        !@EQUAL
            REP       " 0",PTQRRGAA    * zero filled if not blank
          ENDIF
.
          MOVE      PTRDE012,PTQRFIMA  * F.I.M. Score on Admission
          MOVE      PTRDE013,PTQRFIMD  * F.I.M. Score on Discharge
          MOVE      PTRDE014,PTQRDIAG  * Diagnostic Group
          MOVE      PTRDE015,PTQRCOM1  * Comments line 1
          MATCH     SP70,PTRDE019
          IF        !@EQUAL
            MOVE      PTRDE019,PTQRCOM1  * ADL Date
          ENDIF
          MOVE      PTRDE016,PTQRCOM2  * Comments line 2
          MOVE      PTRDE017,PTQRFADT  * Functional assessment date on adm
          MOVE      PTRDE018,PTQRFDDT  * Functional assessment date on disch
          MOVE      PTRDE020,PTQRMCDT  * Multidisciplinary Care Date
.
UPDQRD40  PACK      KEY12,PTQRADMN,PTQREPNO,PTQRCNTR,SP70
          CALL      RAPTQRD1
          IF        OVRCD=0
            CALL      UPPTQRD1      * Write to the Rehab Details File
          ENDIF

          COMPARE   TWO,PTQREPNO
          GOTO      UPDQRD50 IF NOT LESS    * Episode no >= 2
.
          MATCH     "20000701",CURRDATE
          GOTO      UPDQRD50 IF NOT LESS    * Current date >= 1/7/2000
.
          MOVE      PTQRADMN,CMADMNO
          MOVE      CURRDATE,CMCDATE
          PACK      KEY16,CMADMNO,CMCDATE
          CALL      RDCMOR1               * Read a morbidity changes file rec
          IF        OVRCD=1
            MOVE      "C",CMNEWFLG        * Change record
            PACK      KEY16,CMADMNO,CMCDATE
            CALL      WRCMOR1             * Write a morbidity changes file rec
          ENDIF
          GOTO      UPDQRD99
.
UPDQRD50  MOVE      PTQRADMN,PTEMADMN
          MOVE      PTQREPNO,PTEMEPNO
          MOVE      CURRDATE,PTEMCDTE
          PACK      KEY18,PTEMADMN,PTEMEPNO,PTEMCDTE
          CALL      RDPTECM1              * Read an episode morb chan file rec
          IF        OVRCD=1
            MOVE      "C",PTEMNEWF        * 1st record flag change
            PACK      KEY18,PTEMADMN,PTEMEPNO,PTEMCDTE
            CALL      WRPTECM1            * Write an episode morb chan file rec
          ENDIF
.
UPDQRD99  RETURN
.-------------------------------------------------------------------------
.  Validate Onset Date
.-------------------------------------------------------------------------
CKONST00  RESET     PTRDE004
          MATCH     SP70,PTRDE004
          GOTO      CKONST98 IF EQUAL                  
.
          MATCH     PTRDE004,ADATE    
          IF        @LESS
            GOTO      CKONST90       * Onset Date > Admission Date
          ENDIF
.
          PACK      KEY8,ADMISSNO,SP70  * Read for Discharge Data
          CALL      RDDSCH1
          BRANCH    OVRCD,CKONST98      
.
          MATCH     SP70,DDATE          * Only do check if Dischare Date found!
          IF        !@EQUAL
            MATCH     PTRDE004,DDATE
            IF        @LESS
              GOTO      CKONST91     * Onset Date > Discharge Date
            ENDIF
          ENDIF
.
          GOTO      CKONST98
.
CKONST90  CLEAR     WEBTITLE
          MOVE      "Onset Date cannot be greater than Admission Date.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKONST99
.
CKONST91  CLEAR     WEBTITLE
          MOVE      "Onset Date cannot be greater than Discharge Date.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKONST99
.
CKONST98  MOVE      ZERO,EXIT
CKONST99  RETURN
+
.-------------------------------------------------------------------------
.  Validate ADL Date if QLD
.-------------------------------------------------------------------------
CKADLD00  COMPARE   FOUR,PTCNHDPS           * QLD
          GOTO      CKADLD10 IF EQUAL
.
          COMPARE   NINE,PTCNHDPS           * ACT
          GOTO      CKADLD10 IF EQUAL
.
          GOTO      CKADLD98
          
CKADLD10  RESET     PTRDE019
          MATCH     SP70,PTRDE019
          GOTO      CKADLD98 IF EQUAL
.
          MATCH     ADATE,PTRDE019
          GOTO      CKADLD90 IF LESS    * ADL Date < Admission Date
.
          PACK      KEY8,ADMISSNO,SP70  * Read for Discharge Data
          CALL      RDDSCH1
          BRANCH    OVRCD,CKADLD98
.
          MATCH     SP70,DDATE          * Only do check if Dischare Date found!
          IF        !@EQUAL
            MATCH     PTRDE019,DDATE
            IF        @LESS
              GOTO      CKADLD91     * ADL Date > Discharge Date
            ENDIF
          ENDIF
.
          GOTO      CKADLD98
.
CKADLD90  CLEAR     WEBTITLE
          MOVE      "ADL Date cannot be less than Admission Date.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKADLD99
.
CKADLD91  CLEAR     WEBTITLE
          MOVE      "ADL Date cannot be greater than Discharge Date.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKADLD99
.
CKADLD98  MOVE      ZERO,EXIT
CKADLD99  RETURN
+
.-------------------------------------------------------------------------
.  Validate Functional assessment date on adm
.-------------------------------------------------------------------------
CKFADT00  RESET     PTRDE017
          MATCH     SP70,PTRDE017
          GOTO      CKFADT98 IF EQUAL
.
.  VIC FIM admission assessment date must be 7 or less days prior to admission
.
          IF        (ACUTTYPE = 1 | ACUTTYPE = 3) & PTCNHDPS = 3 & REPORTNO = 1
            PACK      CHECKDAT,ADATE,SP70
            REP       " 0",CHECKDAT
            SUB       SEVEN,CHECKDAT
.
            MATCH     CHECKDAT,PTRDE017     * More than 7 days prior to adm
            GOTO      CKFADT93 IF LESS
.
            GOTO      CKFADT10
          ENDIF
.
          MATCH     ADATE,PTRDE017
          IF        @LESS
            GOTO      CKFADT90       * Assess date < Admission Date
          ENDIF
.
CKFADT10  PACK      KEY8,ADMISSNO,SP70  * Read for Discharge Data
          CALL      RDDSCH1
          BRANCH    OVRCD,CKFADT98
.
          MATCH     SP70,DDATE          * Only do check if Dischare Date found!
          IF        !@EQUAL
            MATCH     PTRDE017,DDATE
            IF        @LESS
              GOTO      CKFADT91     * Assessment Date > Discharge Date
            ENDIF
          ENDIF
.
          PACK      CHECKDAT,ADATE,SP70
          REP       " 0",CHECKDAT
          ADD       SEVEN,CHECKDAT
          MATCH     PTRDE017,CHECKDAT
          GOTO      CKFADT92 IF LESS
.
          GOTO      CKFADT98
.
CKFADT90  CLEAR     WEBTITLE
          MOVE    "Assessment Date cannot be less than Admission Date.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKFADT99
.
CKFADT91  CLEAR     WEBTITLE
          MOVE "Assessment Date cannot be greater than Discharge Date.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKFADT99
.
CKFADT92  CLEAR     WEBTITLE
          MOVE "Assessment Date must be within 7 days of admission.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKFADT99
.
CKFADT93  CLEAR     WEBTITLE
          APPEND    "Assessment Date more than 7 days before ",WEBTITLE
          APPEND    "the admission date.",WEBTITLE
          RESET     WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKFADT99
.
CKFADT98  MOVE      ZERO,EXIT
CKFADT99  RETURN
.-------------------------------------------------------------------------
.  Validate Functional assessment date on discharge
.-------------------------------------------------------------------------
CKFDDT00  RESET     PTRDE018
          MATCH     SP70,PTRDE018
          GOTO      CKFDDT98 IF EQUAL
.
          MATCH     ADATE,PTRDE018
          IF        @LESS
            GOTO      CKFDDT90       * Assess date < Admission Date
          ENDIF
.
          PACK      KEY8,ADMISSNO,SP70  * Read for Discharge Data
          CALL      RDDSCH1
          BRANCH    OVRCD,CKFDDT98
.
.  VIC FIM discharge assessment date must be 7 or less days after discharge
.
          IF        (ACUTTYPE = 1 | ACUTTYPE = 3) & PTCNHDPS = 3 & REPORTNO = 1
            PACK      CHECKDAT,DDATE,SP70
            REP       " 0",CHECKDAT
            ADD       SEVEN,CHECKDAT
.
            MATCH     PTRDE018,CHECKDAT     * More than 7 days after discharge
            GOTO      CKFDDT93 IF LESS
.
            GOTO      CKFDDT50
          ENDIF
.
          MATCH     SP70,DDATE          * Only do check if Dischare Date found!
          IF        !@EQUAL
            MATCH     PTRDE018,DDATE
            IF        @LESS
              GOTO      CKFDDT91     * Assessment Date > Discharge Date
            ENDIF
          ENDIF
.
CKFDDT50  PACK      CHECKDAT,DDATE,SP70
          REP       " 0",CHECKDAT
          SUB       THREE,CHECKDAT
          MATCH     PTRDE018,CHECKDAT
          GOTO      CKFDDT92 IF NOT LESS
.
          GOTO      CKFDDT98
.
CKFDDT90  CLEAR     WEBTITLE
          MOVE    "Assessment Date cannot be less than Admission Date.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKFDDT99
.
CKFDDT91  CLEAR     WEBTITLE
          MOVE "Assessment Date cannot be greater than Discharge Date.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKFDDT99
.
CKFDDT92  CLEAR     WEBTITLE
          MOVE "Assessment Date must be within 3 days of discharge.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKFDDT99
.
CKFDDT93  CLEAR     WEBTITLE
          MOVE "Assessment Date more than 7 days after discharge date.",WEBTITLE
          CALL      POPERR00
          MOVE      ONE,EXIT
          GOTO      CKFDDT99
.
CKFDDT98  MOVE      ZERO,EXIT
CKFDDT99  RETURN
.-------------------------------------------------------------------------
. Called from WEBBOD00
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD99,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110,PROFL120,PROFL130,PROFL140,PROFL150:
                             PROFL160
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13,PROFLD14,PROFLD15
          GOTO      PROFLD99
.
PROFLD11  CALL      MASF0000    * Master File Info
          GOTO      PROFLD99
.
PROFLD12  CALL      MISF0000    * Admission File Info
          GOTO      PROFLD99
.
PROFLD13  CALL      TRDE0000    * Rehab Table/Details
          GOTO      PROFLD99
.
PROFLD14  CALL      DSCF0000    * Discharge File Info
          GOTO      PROFLD99
.
PROFLD15  CALL      PTAR0000    * Patient Attributes
          GOTO      PROFLD99
.
.         Cross Consulting Details Maintenance
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22,PROFLD23
          GOTO      PROFLD99
.
PROFLD21  CALL      MASF0000    * Master File Info
          GOTO      PROFLD99
.
PROFLD22  CALL      MISF0000    * Admission File Info
          GOTO      PROFLD99
.
PROFLD23  CALL      CRCD0000    * Cross Consulting Details Display
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41,PROFLD42,PROFLD43
          GOTO      PROFLD99
.
PROFLD41  CALL      MASF0000    * Master File Info
          GOTO      PROFLD99
.
PROFLD42  CALL      MISF0000    * Admission File Info
          GOTO      PROFLD99
.
PROFLD43  CALL      VXTF0000                * Visit Extension
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51,PROFLD52,PROFLD53
          GOTO      PROFLD99
.
PROFLD51  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD52  CALL      MISF0000
          GOTO      PROFLD99
.
PROFLD53  CALL      PVEN0000    * Ventilation details
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62,PROFLD63,PROFLD64,PROFLD65:
                             PROFLD66,PROFLD67,PROFLD68
          GOTO      PROFLD99
.
PROFLD61  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD62  CALL      MISF0000
          GOTO      PROFLD99
.
PROFLD63  CALL      CELG0000     * Eligibility check fields
          GOTO      PROFLD99
.
PROFLD64  CALL      PMFD0000
          GOTO      PROFLD99
.
PROFLD65  CALL      PMFS0000
          GOTO      PROFLD99
.
PROFLD66  CALL      EXTR0000               * Extra tags
          GOTO      PROFLD99
.
PROFLD67  CALL      PMIX0000
          GOTO      PROFLD99
.
PROFLD68  CALL      FOET0000
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71,PROFLD72,PROFLD73,PROFLD74
          GOTO      PROFLD99
.
PROFLD71  CALL      MASF0000    * Master File Info
          GOTO      PROFLD99
.
PROFLD72  CALL      MISF0000    * Admission File Info
          GOTO      PROFLD99
.
PROFLD73  CALL      TQRD0000    * QLD Rehab Table/Details
          GOTO      PROFLD99
.
PROFLD74  CALL      DSCF0000    * Discharge File Info
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81,PROFLD82,PROFLD83,PROFLD84
          GOTO      PROFLD99
.
PROFLD81  CALL      MASF0000    * Master File Info
          GOTO      PROFLD99
.
PROFLD82  CALL      MISF0000    * Admission File Info
          GOTO      PROFLD99
.
PROFLD83  CALL      QMHD0000    * QLD MH Details
          GOTO      PROFLD99
.
PROFLD84  CALL      MHVS0000    * MH Visits
          GOTO      PROFLD99
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91,PROFLD92,PROFLD93,PROFLD94
          GOTO      PROFLD99
.
PROFLD91  CALL      FOET0000    * Free Format OEC Tags
          GOTO      PROFLD99
.
PROFLD92  CALL      EXTR0000
          GOTO      PROFLD99
.
.OEC Listing by Date Range
.-------------------------------
PROFLD93  CALL      OECD0000
          GOTO      PROFLD99
.
.OEC Listing with tablesort
PROFLD94  MOVE      ONE,TBSRTFLG       * Flag set for tablesorting
          CALL      FOET0000
          GOTO      PROFLD99
.
PROFL100  BRANCH    FLDSETNO,PROFL101,PROFL102,PROFL103,PROFL104,PROFL105:
                             PROFL106
          GOTO      PROFLD99
.
PROFL101  CALL      MASF0000    * Master File Info
          GOTO      PROFLD99
.
PROFL102  CALL      MISF0000    * Admission File Info
          GOTO      PROFLD99
.
PROFL103  CALL      PMFOC000    * Phase of Care Change
          GOTO      PROFLD99
.
PROFL104  CALL      EXTR0000    * Extra tags
          GOTO      PROFLD99
.
PROFL105  CALL      DSCF0000    * Discharge File Info
          GOTO      PROFLD99
.
PROFL106  CALL      TRDE0000    * Rehab Table/Details
          GOTO      PROFLD99
.
PROFL110  BRANCH    FLDSETNO,PROFL111
          GOTO      PROFLD99
.
PROFL111  CALL      PTIFC000    * IFC Other/Consumables
          GOTO      PROFLD99
.
PROFL120  BRANCH    FLDSETNO,PROFL121,PROFL122,PROFL123
          GOTO      PROFLD99
.
PROFL121  CALL      VWCC0000    * View Cross Consulting
          GOTO      PROFLD99
.
PROFL122  CALL      CCFL0000    * Cross Consultation Filters
          GOTO      PROFLD99
.
PROFL123  CALL      CCAL0000    * Calendar Selection Options
          GOTO      PROFLD99
.
PROFL130  BRANCH    FLDSETNO,PROFL131,PROFL132,PROFL133
          GOTO      PROFLD99
.
PROFL131  CALL      MASF0000   * Patient Master File Info
          GOTO      PROFLD99
.
PROFL132  CALL      PTAR0000   * Patient Attributes 
          GOTO      PROFLD99
.
PROFL133  CALL      PAIN0000   * AIMS Pain assessment tags
          GOTO      PROFLD99
.
PROFL140  BRANCH    FLDSETNO,PROFL141,PROFL142,PROFL143
          GOTO      PROFLD99
.
PROFL141  CALL      MASF0000   * Patient Master File Info
          GOTO      PROFLD99
.
PROFL142  CALL      PTAR0000   * Patient Attributes
          GOTO      PROFLD99
.
PROFL143  CALL      BREA0000   * AIMS Breathlessness Assessment tags
          GOTO      PROFLD99
.
PROFL150  BRANCH    FLDSETNO,PROFL151,PROFL152,PROFL153,PROFL154,PROFL155
          GOTO      PROFLD99
.
PROFL151  CALL      MASF0000
          GOTO      PROFLD99
.
PROFL152  CALL      MISF0000
          GOTO      PROFLD99
.
PROFL153  CALL      CELG0000     * Eligibility check fields
          GOTO      PROFLD99
.
PROFL154  CALL      OEMT0000     * OECW-ECM Request Tags
          GOTO      PROFLD99
.
PROFL155  CALL      OERT0000     * OECW-ECM Response Tags
          GOTO      PROFLD99
.
PROFL160  BRANCH    FLDSETNO,PROFL161,PROFL162,PROFL163
          GOTO      PROFLD99
.
PROFL161  CALL      MASF0000
          GOTO      PROFLD99
.
PROFL162  CALL      MISF0000
          GOTO      PROFLD99
.
PROFL163  CALL      CVER0000     * Casemix Code Verification             
          GOTO      PROFLD99
.
PROFLD99  RETURN
.----------------------------------------------------------------------------
. Report No. 1 : Rehab Details Display 
.----------------------------------------------------------------------------
TRDE0000  BRANCH    FLDITMNO,TRDE0100,TRDE0200,TRDE0300,TRDE0400,TRDE0500:
                             TRDE0600,TRDE0700,TRDE0800,TRDE0900,TRDE1000: 
                             TRDE1100,TRDE1200,TRDE1300,TRDE1400,TRDE1500:
                             TRDE1600,TRDE1700,TRDE1800,TRDE1900,TRDE2000:
                             TRDE2100,TRDE2200,TRDE2300,TRDE2400,TRDE2500:
                             TRDE2600,TRDE2700,TRDE2800,TRDE2900,TRDE3000:
                             TRDE3100,TRDE3200,TRDE3300,TRDE3400
          GOTO      TRDE9999
.
TRDE0100  MATCH     "A ",CARECATG
          IF        @EQUAL
            CALL      LRAT0000              * Table of Rehab Episodes (Cat.A)
          ELSE
            CALL      LODB0000              * Table of Rehab Episodes (Cat.CC)
          ENDIF
          GOTO      TRDE9999
.
TRDE0200  MATCH     ZEROVISN,PTRDADMN       * Admission No              
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDADMN;
          GOTO      TRDE9999
.
TRDE0300  COMPARE   ZERO,PTRDEPNO         * Episode No              
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDEPNO;
          GOTO      TRDE9999
.
TRDE0400  WRITE     HTMLFILE;PTRDBISA;    * Barthal Index Score on Admission
          GOTO      TRDE9999

TRDE0500  WRITE     HTMLFILE;PTRDBISD;    * Barthal Index Score on Discharge 
          GOTO      TRDE9999
.
TRDE0600  MOVE      "CU",CATEGORY
          MOVE      PTRDCLSP,CODE
          CALL      CODITM00
          GOTO      TRDE9999
.
TRDE0700  MATCH     SP70,PTRDODTE         * Onset Date 
          GOTO      TRDE9999 IF EQUAL
          UNPACK    PTRDODTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TRDE9999
.
TRDE0800  MATCH     SP70,PTRDARTR         * Admission/Readmission to Rehab
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDARTR;
          GOTO      TRDE9999
.
TRDE0900  MATCH     SP70,PTRDUSRF         * User Flag                     
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDUSRF;
          GOTO      TRDE9999
.
TRDE1000  MATCH     SP70,PTRDPCSA         * Palliative Care State on Admission
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDPCSA;
          GOTO      TRDE9999
.
TRDE1100  MATCH     SP70,PTRDPCSD         * Palliative Care State on Discharge
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDPCSD;
          GOTO      TRDE9999
.
TRDE1200  MATCH     SP70,PTRDRGAA         * RUG ADL on Admission 
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDRGAA;
          GOTO      TRDE9999
.
TRDE1300  MATCH     SP70,PTRDRGAD         * RUG ADL on Discharge           
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDRGAD;
          GOTO      TRDE9999
.
TRDE1400  MATCH     SP70,PTRDSRPC         * Source of Referral for Pall Care
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDSRPC;
          GOTO      TRDE9999
.
TRDE1500  COMPARE   ZERO,PTRDFIMA         * F.I.M Source on Admission 
          GOTO      TRDE9999 IF EQUAL     
          WRITE     HTMLFILE;PTRDFIMA;
          GOTO      TRDE9999
.
TRDE1600  COMPARE   ZERO,PTRDFIMD         * F.I.M Source on Discharge 
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDFIMD; 
          GOTO      TRDE9999
.
TRDE1700  MATCH     SP70,PTRDDIAG         * Diagnostic Group 
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDDIAG;
          GOTO      TRDE9999
.
TRDE1800  MATCH     SP70,PTRDCOM1         * Comments Line 1
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDCOM1;
          GOTO      TRDE9999
.
TRDE1900  MATCH     SP70,PTRDCOM2         * Comments Line 2
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDCOM2;
          GOTO      TRDE9999
.
TRDE2000  MATCH     SP70,EPISODNO         * Episode Number
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;EPISODNO;
          GOTO      TRDE9999
.
TRDE2100  MATCH     SP70,EPFRDATE         * Episode Start Date
          GOTO      TRDE9999 IF EQUAL
          UNPACK    EPFRDATE,CCENT,CYEAR,CMON,CDAY    
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TRDE9999
.
TRDE2200  MATCH     SP70,EPTODATE         * Episode End Date
          GOTO      TRDE9999 IF EQUAL
          UNPACK    EPTODATE,CCENT,CYEAR,CMON,CDAY    
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TRDE9999
.
TRDE2300  MATCH     SP70,EPCARETP         * Episode Care Type
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;EPCARETP;
          GOTO      TRDE9999
.
TRDE2400  MATCH     SP70,PTRDFADT         * Assessment date on admission
          GOTO      TRDE9999 IF EQUAL
          UNPACK    PTRDFADT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TRDE9999
.
TRDE2500  MATCH     SP70,PTRDFDDT         * Assessment date on discharge
          GOTO      TRDE9999 IF EQUAL
          UNPACK    PTRDFDDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TRDE9999
.
TRDE2600  MATCH     SP70,PTRDCOM1         * ADL Date (uses comments 1 field)
          GOTO      TRDE9999 IF EQUAL
          UNPACK    PTRDCOM1,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TRDE9999
.
TRDE2700  MATCH     SP70,PTRDIMPR         * Impairment Code (pmsimpaf)
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDIMPR;
          GOTO      TRDE9999
.
TRDE2800  MOVE      "pu",CATEGORY
          MOVE      PTRDPOCA,CODE
          CALL      CODITM00
          GOTO      TRDE9999
.
TRDE2900  MOVE      "pu",CATEGORY
          MOVE      PTRDPOCD,CODE
          CALL      CODITM00
          GOTO      TRDE9999
.
TRDE3000  MOVE      "lj",CATEGORY            * UDF 9 Death Place
          MOVE      PMVXUDF9,CODE
          CALL      CODITM00
          GOTO      TRDE9999
.
TRDE3100  MATCH     SP70,PTRDVERS         * AN SNAP Version            
          GOTO      TRDE9999 IF EQUAL 
          WRITE     HTMLFILE;PTRDVERS;            
          GOTO      TRDE9999 
.
TRDE3200  PACK      KEY5,PTRDSNAP,PTRDVERS,SP70
          CALL      RDPMSNP1
          BRANCH    OVRCD,TRDE9999
.
          WRITE     HTMLFILE;PMSNDESC;            * AN SNAP Description
          GOTO      TRDE9999
.
TRDE3300  MATCH     SP70,PTRDSNAP
          GOTO      TRDE9999 IF EQUAL
          WRITE     HTMLFILE;PTRDSNAP;            * AN SNAP Classification
          GOTO      TRDE9999
.
TRDE3400  MATCH     SP70,PTRDIMPR
          GOTO      TRDE9999 IF EQUAL
.
          PACK      KEY7,PTRDIMPR,SP70
          CALL      RDPMIMP1
          BRANCH    OVRCD,TRDE9999
.
          WRITE     HTMLFILE;PMIMDESC;           * Impairment Code Description
          GOTO      TRDE9999
.
TRDE9999  RETURN
.
.----------------------------------------------------------------------------
. Report No. 2 : Cross Consulting Details Display
.----------------------------------------------------------------------------
CRCD0000  BRANCH    FLDITMNO,CRCD0100,CRCD0200,CRCD0300,CRCD0400,CRCD0500:
                             CRCD0600,CRCD0700,CRCD0800,CRCD0900,CRCD1000:
                             CRCD1100,CRCD1200,CRCD1300,CRCD1400,CRCD1500:
                             CRCD1600,CRCD1700,CRCD1800,CRCD1900,CRCD2000:
                             CRCD2100,CRCD2200,CRCD2300,CRCD2400,CRCD2500:
                             CRCD2600,CRCD2700,CRCD2800
          GOTO      CRCD9999
.
CRCD0100  MOVE      ZERO,DONTGRBC           * Group records by consultant
          CALL      ALLCCL00                * All Cross Consultations List
          GOTO      CRCD9999
.
CRCD0200  MOVE      PTCRC001,GENPCODE       * Referring Consultant
          CALL      HCPDET00                
          GOTO      CRCD9999
.
CRCD0300  MOVE      PTCRC002,GENPCODE       * Referred to Consultant
          CALL      HCPDET00
          GOTO      CRCD9999
.
CRCD0400  WRITE     HTMLFILE;PTCOMENT;      * Comments
          GOTO      CRCD9999
.
CRCD0500  CALL      TOTHRS00                * Get Total Hours
          WRITE     HTMLFILE;SAVEAMNT;
          GOTO      CRCD9999
.
CRCD0600  CALL      CONDTL00                * Cross Consultation Detail List 
          GOTO      CRCD9999
.
CRCD0700  CALL      DSCDTE00                * Get Discharge Date
          GOTO      CRCD9999
.
CRCD0800  UNPACK    PTCRDATE,CCENT,CYEAR,CMON,CDAY         * Date Seen
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CRCD9999
.
CRCD0900  WRITE     HTMLFILE;PTCRAMNT;      * Hours (Time Taken)
          GOTO      CRCD9999
.
CRCD1000  WRITE     HTMLFILE;PTCRCNTR;      * Count - record number
          GOTO      CRCD9999
.
CRCD1100  MATCH     SP70,PVIDATE
          GOTO      CRCD9999 IF EQUAL
.
          UNPACK    PVIDATE,CCENT,CYEAR,CMON,CDAY         * Visit date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CRCD9999
.
CRCD1200  PACK      KEY8,ADMISSNO,SP70           * Read Visit File
          CALL      RDVISA1
          BRANCH    OVRCD,CRCD9999
.
          MOVE      SP70,DOCTCODE
.
          IF        PVITYPE=1
            MATCH     SP70,EMVIDOCT
            IF        !@EQUAL
              MOVE      EMVIDOCT,DOCTCODE        * Emergency Doctor
            ELSE
              MOVE      EMVIUR04,DOCTCODE        * Attending doctor
            ENDIF
          ENDIF
.
          COMPARE   ONE,PTCNHDPS
          IF        @EQUAL
            IF        PVITYPE=3
              MOVE      ADOCTA,DOCTCODE            * Attending doctor
              GOTO      CRCD1250
            ENDIF
          ENDIF
.
CRCD1250  CALL      DOCDET00
          GOTO      CRCD9999
.
CRCD1300  WRITE     HTMLFILE;PTCRMISC;
          GOTO      CRCD9999
.
CRCD1400  WRITE     HTMLFILE;SHOWSPEC;
          GOTO      CRCD9999
.
CRCD1500  MOVE      "AC",CATEGORY                * Doctor Speciality
          MOVE      PTCRC008,CODE
          CALL      CODITM00
          GOTO      CRCD9999
.
CRCD1600  WRITE     HTMLFILE;PTCRSPEC;           * Speciality Code (Cat 'AC')
          GOTO      CRCD9999
.
CRCD1700  WRITE     HTMLFILE;DPTCRCNT;           * Record count
          GOTO      CRCD9999
.
CRCD1800  MATCH     SP70,PTCRC002           * Blank Referred Consultant?
          IF        @EQUAL
            WRITE     HTMLFILE;SP70;        * Blank the comments
          ELSE
            WRITE     HTMLFILE;PTCOMENT;    * Display comments for record read
          ENDIF
          GOTO      CRCD9999
.
CRCD1900  WRITE     HTMLFILE;PTCRTIME;
          GOTO      CRCD9999
.
CRCD2000  WRITE     HTMLFILE;PTCRACTN;
          GOTO      CRCD9999
.
CRCD2100  WRITE     HTMLFILE;PTCRUNIT;
          GOTO      CRCD9999
.
CRCD2101  PACK      KEY5,CATAC,PTCRUNIT,SP70
          CALL      RDCODE1 
          BRANCH    OVRCD,CRCD9999
.
          WRITE     HTMLFILE;TDESC;
          GOTO      CRCD9999
.
CRCD2200  WRITE     HTMLFILE;PTCRCOMM;
          GOTO      CRCD9999
.
CRCD2300  WRITE     HTMLFILE;PTCRREFD;
          GOTO      CRCD9999
.
CRCD2400  SQUEEZE   EMVIDATE
          SQUEEZE   EMVITIME
          WRITE     HTMLFILE;*+,EMVIDATE,*+,EMVITIME;
          GOTO      CRCD9999
.
CRCD2500  PACK      KEY8,ADMISSNO
          CALL      RDPTVIS1
          BRANCH    OVRCD,CRCD9999
.          
          MATCH     " 1",PTVITYPE
          IF      @EQUAL
            MATCH     SP70,EMVIDOCT
            IF        !@EQUAL
              MOVE      EMVIDOCT,DOCTCODE
            ELSE
              MOVE      EMVIUR04,DOCTCODE
            ENDIF
          ENDIF
.
          CALL      DOCDET00
          GOTO      CRCD9999
.
CRCD2600  MATCH     SP70,PTCRUNIT
          GOTO      CRCD9999 IF EQUAL
.
          PACK      KEY5,CATAC,PTCRUNIT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CRCD9999
.
          WRITE     HTMLFILE;TDESC;
          GOTO      CRCD9999
.
CRCD2700  WRITE     HTMLFILE;PTCRDOCT;
          GOTO      CRCD9999
.
CRCD2800  MOVE      ONE,DONTGRBC            * Don't group records by consultant
          CALL      ALLCCL00                * All Cross Consultations List
          GOTO      CRCD9999
.
CRCD9999  RETURN
.
.-------------------------------------------------------------------
.* Misc. Charge code for Mech. Vent Parameter
.-------------------------------------------------------------------
MISC0000  MATCH     SP70,PTCRMISC
          GOTO      MISC9999 IF EQUAL
.
          READ      CONTROLF,TWENTY;*193,PTCNDCLM
.
          IF        IBCNMHOS=1
            MOVE      SP10,KEY3
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            BRANCH    OVRCD,MISC0900
            PACK      KEY29,PTHSDCLM,SP6,SP3,PTCRMISC,CURRDATE,SP10
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,PTCRMISC,CURRDATE,SP10
          ENDIF
MISC0500  CALL      PATMCHRD                * read Misc.Charges file 
          COMPARE   ZERO,EXIT
          GOTO      MISC1000 IF EQUAL
.
MISC0600  IF         IBCNMHOS=1
            CALL      RKPTHSP1
            BRANCH    OVRCD,MISC0900
            PACK      KEY29,PTHSDCLM,SP6,SP3,PTCRMISC,CURRDATE,SP10
            GOTO      MISC0500
          ENDIF
.
MISC0900  MOVE      "INVALID CODE",MDESC
.
MISC1000  MOVE      MDESC,IDESC
.
MISC9999  RETURN
+
.------------------------------------------------------------------------------
.                       Ventilation details
.------------------------------------------------------------------------------
PVEN0000  BRANCH    FLDITMNO,PVEN0100,PVEN0200,PVEN0300,PVEN0400,PVEN0500:
                             PVEN0600,PVEN0700,PVEN0800,PVEN0900,PVEN1000:
                             PVEN1100,PVEN1200
          GOTO      PVEN9999
.
PVEN0100  MOVE      "VE",CATEGORY  
          MOVE      PTVEVTYP,CODE
          CALL      CODITM00
          GOTO      PVEN9999
.
PVEN0200  MATCH     SP70,PTVESDAT
          GOTO      PVEN9999 IF EQUAL
.
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PVEN0220
.
          UNPACK    PTVESDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;
          GOTO      PVEN9999
.
PVEN0220  WRITE     HTMLFILE;PTVESDAT;
          GOTO      PVEN9999
.
PVEN0300  WRITE     HTMLFILE;PTVESTIM;
          GOTO      PVEN9999
.
PVEN0400  MATCH     SP70,PTVEEDAT
          GOTO      PVEN9999 IF EQUAL
          UNPACK    PTVEEDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;
          GOTO      PVEN9999
.
PVEN0500  WRITE     HTMLFILE;PTVEETIM;
          GOTO      PVEN9999
.
PVEN0600  WRITE     HTMLFILE;PTVEHOUR;
          GOTO      PVEN9999
.
PVEN0700  MOVE      "IU",CATEGORY  
          MOVE      PTVEICUS,CODE
          CALL      CODITM00
          GOTO      PVEN9999
.
PVEN0800  MOVE      "II",CATEGORY  
          MOVE      PTVEISIT,CODE
          CALL      CODITM00
          GOTO      PVEN9999
.
PVEN0900  CALL      VTAB0000           * Ventilation table
          GOTO      PVEN9999
.
PVEN1000  CALL      MECH0000           * Get total hours of Mechanical Vent.
          GOTO      PVEN9999
.
PVEN1100  CALL      CPAP0000           * Get total hours of CPAP
          GOTO      PVEN9999
.
PVEN1200  CALL      ICUBED00   * Output indicator if ICU/CCU/NCU Bed Found
          GOTO      PVEN9999
.
PVEN9999  RETURN
.
.**********************************************************************
.   Read Tranfer file and get ICU/CCU/NCU
.   Writes var ICUBED if Specific Bed type is found.
.   0- ICU Bed Type, 1- NCU Bed Type, 2- CCU Bed Type
.**********************************************************************
ICUBED00  UNPACK    DIM127,DIM1,KEY1,DIM127 
          MOVE      ZERO,VIEWFLAG
          MOVE      KEY1,VIEWFLAG
.
          MOVE      ZERO,ICUBED
.
          PACK      KEY30,ADMISSNO,SP70
          CALL      RDSTRAN2
ICUBED10  CALL      RDKTRAN2
          BRANCH    OVRCD,ICUBED90
.
          MATCH     DTADMN,ADMISSNO        * Admission No?
          GOTO      ICUBED90 IF NOT EQUAL
.
          PACK      KEY5,ANSB,ANST,TRBTYP
          CALL      RDCODE1
          BRANCH    OVRCD,ICUBED10
.
          MOVE      ZERO,ICUFLAG
          MOVE      TCINDC3,ICUFLAG
.
.   Check for ICU,CCU,NCU Bed type?
.
          BRANCH    VIEWFLAG,ICUBED20,ICUBED30
.
          IF        ICUFLAG=FIVE
            MOVE      ONE,ICUBED
            GOTO      ICUBED90   * ICU Bed Type Found!
          ENDIF
          GOTO      ICUBED10
.
ICUBED20  IF        ICUFLAG=SEVEN
            MOVE      ONE,ICUBED
            GOTO      ICUBED90   * NCU Bed Type Found!
          ENDIF
          GOTO      ICUBED10
.
ICUBED30  IF        ICUFLAG=FOUR
            MOVE      ONE,ICUBED
            GOTO      ICUBED90   * CCU Bed Type Found!
          ENDIF
          GOTO      ICUBED10
.
ICUBED90  WRITE     HTMLFILE;ICUBED;
ICUBED99  RETURN
.
.------------------------------------------------------------------------------
.         MH visits
.------------------------------------------------------------------------------
MHVS0000  BRANCH    FLDITMNO,MHVS0100,MHVS0200
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MHVS9999
.
MHVS0100  CALL      VLST0000         * Visit list link to
          GOTO      MHVS9999
.
MHVS0200  WRITE     HTMLFILE;MEHRFLAG;
          GOTO      MHVS9999
.
MHVS9999  RETURN
+
.------------------------------------------------------------------------------
.         Visit list link to Previous Details
.------------------------------------------------------------------------------
VLST0000  MOVE      " 3",PTVITYPE
          PACK      KEY26,URNUMBER,PTVITYPE,Z70
          CALL      RSPTVIS4
VLST1000  CALL      RPPTVIS4
          BRANCH    OVRCD,VLST9999
.
          MATCH     PVIURNO,URNUMBER
          GOTO      VLST9999 IF NOT EQUAL
.
          MATCH     " 3",PTVITYPE
          GOTO      VLST9999 IF NOT EQUAL
.
          MATCH     ADMISSNO,DPVIBILL
          GOTO      VLST1000 IF EQUAL     * Skip the current visit
.
          PACK      KEY8,PVIBILL,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,VLST1000
          CALL      RDPMVX11
          BRANCH    OVRCD,VLST1000
.
          CALL      RDPTQMH1
          BRANCH    OVRCD,VLST1000        * not a QLD Mental Health
.
          MOVE      SP70,WARDNAME
          MATCH     SP70,AWARD
          GOTO      VLST3000 IF EQUAL
.
          PACK      KEY6,AWARD,SP70
          CALL      RDWARD1
          IF        OVRCD=0
            CLEAR     WARDNAME
            APPEND    WBDESC,WARDNAME
            MATCH     SP3,ABED
            IF        !@EQUAL
              APPEND    SLASH,WARDNAME
              APPEND    ABED,WARDNAME
            ENDIF
            RESET     WARDNAME
            STRIP     WARDNAME
          ENDIF
.
VLST3000  MOVE      SP70,DIM20
          IF        ASTAT=3
            CALL      RDDSCH1
            BRANCH    OVRCD,VLST1000
            UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM20,SP1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,TDESC
          MATCH     SP70,PMVXIDUS
          IF        !@EQUAL
            MOVE      "VI",KEY2
            PACK      KEY5,KEY2,PMVXIDUS     * Intended Stay
            CALL      RDCODE1
          ENDIF
.
          CALL      ACCM0000            * Type of Accommodation
          CALL      EMPS0000            * Employment status
          CALL      PEST0000            * Pension status
          CALL      PRST0000            * Problem status
          CALL      RFUR0000            * Referral to further care
          CALL      MHLS0000            * MH Legal status
          CALL      NADM0000            * Specialise Non-Adm treatment
.
          UNPACK    PVIDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPCDATE
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      ADMNDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr><td>":
                             "<img src=../images/AppointmentIcon.gif ":
                             " class=ListIcon onclick='updateParent(#"":
                             PTQMTOUA,"#",#"",PTQMEMPS,"#",#"":
                             PTQMPSNS,"#",#"",PTQMPRMS,"#",#"":
                             PTQMRTFC,"#",#"",PTQMMLSI,"#",#"":
                             PTQMPSNT,"#");'> ";
.
          WRITE     HTMLFILE;ADMNDATE,SP1,ATIME,"</td><td>":
                             DIM20,"</td><td>":
                             "&nbsp",WARDNAME,"</td><td>":
                             "&nbsp",TDESC,"</td><td>":
                             "&nbsp",ACCMDESC,"</td><td>":
                             "&nbsp",EMPYSTAT,"</td><td>":
                             "&nbsp",PENSSTAT,"</td><td>":
                             "&nbsp",PROBSTAT,"</td><td>":
                             "&nbsp",REFTCARE,"</td><td>":
                             "&nbsp",MHSINDIC,"</td><td>":
                             "&nbsp",PREVTREM,"</td></tr>"
.
          GOTO      VLST1000
.
VLST9999  RETURN
+
.------------------------------------------------------------------------------
.         Type of accommodation
.------------------------------------------------------------------------------
ACCM0000  MOVE      SP70,ACCMDESC
          MATCH     "1",PTQMTOUA
          IF        @EQUAL
            MOVE      "House/Flat",ACCMDESC
          ENDIF
          MATCH     "2",PTQMTOUA
          IF        @EQUAL
            MOVE      "Independant Unit",ACCMDESC
          ENDIF
          MATCH     "3",PTQMTOUA
          IF        @EQUAL
            MOVE      "Hostel/Hostel Accomm.",ACCMDESC
          ENDIF
          MATCH     "4",PTQMTOUA
          IF        @EQUAL
            MOVE      "Psychiaric Hosp.",ACCMDESC
          ENDIF
          MATCH     "5",PTQMTOUA
          IF        @EQUAL
            MOVE      "Acute Hospital",ACCMDESC
          ENDIF
          MATCH     "6",PTQMTOUA
          IF        @EQUAL
            MOVE      "Residential MH Care Facil",ACCMDESC
          ENDIF
          MATCH     "7",PTQMTOUA
          IF        @EQUAL
            MOVE      "Other Accom.",ACCMDESC
          ENDIF
          MATCH     "8",PTQMTOUA
          IF        @EQUAL
            MOVE      "No Usual Res.",ACCMDESC
          ENDIF
.
ACCM9999  RETURN
+
.------------------------------------------------------------------------------
.         Employment status
.------------------------------------------------------------------------------
EMPS0000  MOVE      SP70,EMPYSTAT
          MATCH     "1",PTQMEMPS
          IF        @EQUAL
            MOVE      "Child Not At School",EMPYSTAT
          ENDIF
          MATCH     "2",PTQMEMPS
          IF        @EQUAL
            MOVE      "Student",EMPYSTAT
          ENDIF
          MATCH     "3",PTQMEMPS
          IF        @EQUAL
            MOVE      "Employed",EMPYSTAT
          ENDIF
          MATCH     "4",PTQMEMPS
          IF        @EQUAL
            MOVE      "Unemployed",EMPYSTAT
          ENDIF
          MATCH     "5",PTQMEMPS
          IF        @EQUAL
            MOVE      "Home Duties",EMPYSTAT
          ENDIF
          MATCH     "6",PTQMEMPS
          IF        @EQUAL
            MOVE      "Pesnsioner",EMPYSTAT
          ENDIF
          MATCH     "8",PTQMEMPS
          IF        @EQUAL
            MOVE      "Other",EMPYSTAT
          ENDIF
.
EMPS9999  RETURN
+
.------------------------------------------------------------------------------
.         Pension status
.------------------------------------------------------------------------------
PEST0000  MATCH     "1",PTQMPSNS
          IF        @EQUAL
            MOVE      "Age",PENSSTAT
          ENDIF
          MATCH     "2",PTQMPSNS
          IF        @EQUAL
            MOVE      "Repatriation",PENSSTAT
          ENDIF
          MATCH     "3",PTQMPSNS
          IF        @EQUAL
            MOVE      "Invalid",PENSSTAT
          ENDIF
          MATCH     "4",PTQMPSNS
          IF        @EQUAL
            MOVE      "Unemployment Benefit",PENSSTAT
          ENDIF
          MATCH     "5",PTQMPSNS
          IF        @EQUAL
            MOVE      "Sickness Benefit",PENSSTAT
          ENDIF
          MATCH     "7",PTQMPSNS
          IF        @EQUAL
            MOVE      "Other",PENSSTAT
          ENDIF
          MATCH     "8",PTQMPSNS
          IF        @EQUAL
            MOVE      "No Pension/Benefit",PENSSTAT
          ENDIF
PEST9999  RETURN
+
.------------------------------------------------------------------------------
.         Problem status
.------------------------------------------------------------------------------
PRST0000  MATCH     "1",PTQMPRMS
          IF        @EQUAL
            MOVE      "No Prev.Adm-Psyc.Treatment",PROBSTAT
          ENDIF
          MATCH     "2",PTQMPRMS
          IF        @EQUAL
            MOVE      "Prev.Adm-Psyc.Treatment",PROBSTAT
          ENDIF
PRST9999  RETURN
+
.------------------------------------------------------------------------------
.         Referral to further care
.------------------------------------------------------------------------------
RFUR0000  MATCH     "01",PTQMRTFC
          IF        @EQUAL
            MOVE      "Not Referred",REFTCARE
          ENDIF
          MATCH     "02",PTQMRTFC
          IF        @EQUAL
            MOVE      "Private Psyciatrist",REFTCARE
          ENDIF
          MATCH     "03",PTQMRTFC
          IF        @EQUAL
            MOVE      "Other Private Medical Prc",REFTCARE
          ENDIF
          MATCH     "04",PTQMRTFC
          IF        @EQUAL
            MOVE      "MH/Alc-Drug Facility-Adm",REFTCARE
          ENDIF
          MATCH     "05",PTQMRTFC
          IF        @EQUAL
            MOVE      "MH/Drug Facility-Non Adm.",REFTCARE
          ENDIF
          MATCH     "06",PTQMRTFC
          IF        @EQUAL
            MOVE      "Acute Hosp-Adm.",REFTCARE
          ENDIF
          MATCH     "07",PTQMRTFC
          IF        @EQUAL
            MOVE      "Acute Hosp-Non Adm",REFTCARE
          ENDIF
          MATCH     "08",PTQMRTFC
          IF        @EQUAL
            MOVE      "Community Health Program",REFTCARE
          ENDIF
          MATCH     "09",PTQMRTFC
          IF        @EQUAL
            MOVE      "General Practitioner",REFTCARE
          ENDIF
          MATCH     "10",PTQMRTFC
          IF        @EQUAL
            MOVE      "Residential MH Care Facl",REFTCARE
          ENDIF
          MATCH     "29",PTQMRTFC
          IF        @EQUAL
            MOVE      "Other",REFTCARE
          ENDIF
          MATCH     "98",PTQMRTFC
          IF        @EQUAL
            MOVE      "Not Applicable",REFTCARE
          ENDIF
RFUR9999  RETURN
+
.------------------------------------------------------------------------------
.         MH Legal status
.------------------------------------------------------------------------------
MHLS0000  MATCH     "1",PTQMMLSI
          IF        @EQUAL
            MOVE      "Invol.Patient for Any Eps",MHSINDIC
          ENDIF
          MATCH     "2",PTQMMLSI
          IF        @EQUAL
            MOVE      "Vol.Patient for all Eps.",MHSINDIC
          ENDIF
MHLS9999  RETURN
+
.------------------------------------------------------------------------------
.         Specialise Non-Adm treatment
.------------------------------------------------------------------------------
NADM0000  MATCH     "1",PTQMPSNT
          IF        @EQUAL
            MOVE      "No Prev Non-Adm Serv.Cont",PREVTREM
          ENDIF
          MATCH     "2",PTQMPSNT
          IF        @EQUAL
            MOVE      "Prev.Non-Adm Serv.Contact",PREVTREM
          ENDIF
NADM9999  RETURN
+
.------------------------------------------------------------------------------
.                       Ventilation table
.------------------------------------------------------------------------------
VTAB0000  WRITE     HTMLFILE;"<tr>":
                    "<td class=HeadingCell>Ventilation Type</td>":
                    "<td class=HeadingCell align=center>Start Date</td>":
                    "<td class=HeadingCell align=center>Start Time</td>":
                    "<td class=HeadingCell align=center>End Date</td>":
                    "<td class=HeadingCell align=center>End Time</td>":
                    "<td class=HeadingCell align=center>Hours</td>":
                    "<td class=HeadingCell>ICU Status</td>":
                    "<td class=HeadingCell>Initiation Site</td></tr>"
.
          MOVE      ZERO,FORM5
          PACK      KEY27,ADMISSNO,SP70
          CALL      RSPTVEN1
VTAB1000  CALL      RKPTVEN1
          BRANCH    OVRCD,VTAB9000
          MATCH     ADMISSNO,PTVEVISN
          GOTO      VTAB9000 IF NOT EQUAL
          ADD       ONE,FORM5
.
          MOVE      SP70,TDESC
          MOVE      "VE",CATEGORY
          MOVE      PTVEVTYP,CODE         * ventilation type
          CALL      GETCOD00
.
          UNPACK    PTVESDAT,CCENT,CYEAR,CMON,CDAY    * start date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:UpdVent(#"":
                             PTVEVISN,"#",#"":
                             PTVEVTYP,"#",#"",PTVESDAT,"#",#"",PTVESTIM,"#")'>":
                             "<img src=../images/EditIcon.gif ":
                             "class=ListIcon></a>":
                             TDESC,"</td>":
                             "<td align=center>",KEY12,"</td>":
                             "<td align=center>",PTVESTIM,"</td>";
.
          MOVE      SP70,KEY12
          MOVE      "&nbsp;",KEY12
          MATCH     SP70,PTVEEDAT
          IF        !@EQUAL
            UNPACK    PTVEEDAT,CCENT,CYEAR,CMON,CDAY    * end date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,TDESC
          MOVE      "IU",CATEGORY
          MOVE      PTVEICUS,CODE              * ICU Status
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<td align=center>",KEY12,"</td>":
                             "<td align=center>",PTVEETIM,"</td>":
                             "<td align=center>",PTVEHOUR,"</td>":
                             "<td>&nbsp;",TDESC,"</td>";
.
          MOVE      SP70,TDESC
          MOVE      "II",CATEGORY
          MOVE      PTVEISIT,CODE              * Initiation Site
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<td>&nbsp;",TDESC,"</td></tr>";
          GOTO      VTAB1000
.
VTAB9000  IF        FORM5=0
            WRITE     HTMLFILE;"<tr><td align=center colspan=8>":
                               "<b>No Ventilation Details Found</td></tr>"
          ENDIF
.
VTAB9999  RETURN
+
.------------------------------------------------------------------------------
.            Get total hours of Mechanical Ventilation
.------------------------------------------------------------------------------
MECH0000  MOVE      ZERO,TOTMECH
          PACK      KEY27,ADMISSNO,SP70
          CALL      RSPTVEN1
MECH1000  CALL      RKPTVEN1
          BRANCH    OVRCD,MECH9000
.
          MATCH     ADMISSNO,PTVEVISN      * Same visit number?
          GOTO      MECH9000 IF NOT EQUAL
.
          PACK      KEY5,ANSV,ANSE,PTVEVTYP
          CALL      RDCODE1
          BRANCH    OVRCD,MECH1000
          CMATCH    "2",TCINDC1            * Mechanical Ventilation?
          GOTO      MECH1000 IF NOT EQUAL
          ADD       PTVEHOUR,TOTMECH
          GOTO      MECH1000
.
MECH9000  WRITE     HTMLFILE;TOTMECH;
MECH9999  RETURN
+
.------------------------------------------------------------------------------
.            Get total hours of CPAP
.------------------------------------------------------------------------------
CPAP0000  MOVE      ZERO,TOTCPAP
          PACK      KEY27,ADMISSNO,SP70
          CALL      RSPTVEN1
CPAP1000  CALL      RKPTVEN1
          BRANCH    OVRCD,CPAP9000
.
          MATCH     ADMISSNO,PTVEVISN      * Same visit number?
          GOTO      CPAP9000 IF NOT EQUAL
.
          PACK      KEY5,ANSV,ANSE,PTVEVTYP
          CALL      RDCODE1
          BRANCH    OVRCD,CPAP1000
          CMATCH    "1",TCINDC1            * CPAP?
          GOTO      CPAP1000 IF NOT EQUAL
          ADD       PTVEHOUR,TOTCPAP
          GOTO      CPAP1000
.
CPAP9000  WRITE     HTMLFILE;TOTCPAP;
CPAP9999  RETURN
+
.------------------------------------------------------------------------------
.                      Eligibility details
.------------------------------------------------------------------------------
CELG0000  MATCH     "1",OLDOECIN
          GOTO      CELG0010 IF EQUAL
.
          MATCH     "1",PTCNWSIN
          GOTO      CELG0010 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      CELG0010 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      CELG0010 IF NOT EQUAL
.
          CALL      WELG0000
.
          GOTO      CELG9999
.
CELG0010  BRANCH    FLDITMNO,CELG0100,CELG0200,CELG0300,CELG0400,CELG0500:
                             CELG0600,CELG0700,CELG0800,CELG0900,CELG1000:
                             CELG1100,CELG1200,CELG1300,CELG1400,CELG1500:
                             CELG1600,CELG1700,CELG1800,CELG1900,CELG2000:
                             CELG2100,CELG2200,CELG2300,CELG2400,CELG2500:
                             CELG2600,CELG2700,CELG2800,CELG2900,CELG3000:
                             CELG3100,CELG3200,CELG3300,CELG3400,CELG3500:
                             CELG3600,CELG3700,CELG3800,CELG3900,CELG4000:
                             CELG4100,CELG4200,CELG4300,CELG4400,CELG4500:
                             CELG4600,CELG4700,CELG4800,CELG4900,CELG5000:
                             CELG5100,CELG5200,CELG5300,CELG5400,CELG5500:
                             CELG5600,CELG5700,CELG5800,CELG5900,CELG6000:
                             CELG6100,CELG6200,CELG6300,CELG6400,CELG6500:
                             CELG6600,CELG6700,CELG6800,CELG6900,CELG7000:
                             CELG7100,CELG7200,CELG7300,CELG7400,CELG7500:
                             CELG7600,CELG7700,CELG7800,CELG7900,CELG8000:
                             CELG8100,CELG8200,CELG8300,CELG8400,CELG8500:
                             CELG8600,CELG8700,CELG8800,CELG8900,CELG9000:
                             CELG9100,CELG9200,CELG9300,CELG9400
          GOTO      CELG9999
.
CELG0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CELG0110,CELG0120
.
          MOVE      PTELFINC,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      CELG9999
.
CELG0110  MOVE      SP3,YESNO
          MATCH     "1",PTELFINC
          IF        @EQUAL
            MOVE      YES,YESNO
          ENDIF
          MATCH     "0",PTELFINC
          IF        @EQUAL
            MOVE      NO,YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      CELG9999
.
CELG0120  WRITE     HTMLFILE;PTELFINC;
          GOTO      CELG9999
.
CELG0200  WRITE     HTMLFILE;PTELPPRI;
          GOTO      CELG9999
.
CELG0300  WRITE     HTMLFILE;PTELXCSS;
          GOTO      CELG9999
.
CELG0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CELG0410,CELG0420
.
          MOVE      PTELXCLS,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      CELG9999
.
CELG0410  MOVE      SP3,YESNO
          MATCH     "1",PTELXCLS
          IF        @EQUAL
            MOVE      YES,YESNO
          ENDIF
          MATCH     "0",PTELXCLS
          IF        @EQUAL
            MOVE      NO,YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      CELG9999
.         
CELG0420  WRITE     HTMLFILE;PTELXCLS;
          GOTO      CELG9999
.
CELG0500  WRITE     HTMLFILE;PTELXCMN     * Comments
          GOTO      CELG9999
.
CELG0600  MOVE      PTELCMPL,KEY1
          CALL      BNOYES00              * Blank/Yes/No Option
          GOTO      CELG9999
.
CELG0700  MOVE      PTELCOVR,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      CELG9999
.
CELG0800  MOVE      PTELQEXS,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      CELG9999
.
CELG0900  MOVE      PTELQACC,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      CELG9999
.
CELG1000  WRITE     HTMLFILE;PTELPSHA;    * Co-payment for shared room
          GOTO      CELG9999
.
CELG1100  WRITE     HTMLFILE;*+,PTELPTHE; * Co-payment for theatre
          GOTO      CELG9999
.
CELG1200  MOVE      "EG",CATEGORY
          MOVE      PTELCDON,CODE         * check done via
          CALL      CODITM00
          GOTO      CELG9999
.
CELG1300  MATCH     PTELRDAT,SP70
          GOTO      CELG9999 IF EQUAL
          UNPACK    PTELRDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CELG9999
.
CELG1400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CELG1410,CELG1420
.
          MOVE      PTELSPEA,KEY1
          CALL      SPEA0000              * PEA option
          GOTO      CELG9999
.
CELG1410  MOVE      SP70,KEY5
          MATCH     "1",PTELSPEA      
          IF        @EQUAL   
            MOVE      YES,KEY5
          ENDIF     
          MATCH     "0",PTELSPEA             
          IF        @EQUAL
            MOVE      NO,KEY5 
          ENDIF
          MATCH     "2",PTELSPEA
          IF        @EQUAL
            MOVE      "Query",KEY5 
          ENDIF
          WRITE     HTMLFILE;KEY5;
          GOTO      CELG9999
.
CELG1420  WRITE     HTMLFILE;PTELSPEA;
          GOTO      CELG9999
.
CELG1500  WRITE     HTMLFILE;PTELHFRN;
          GOTO      CELG9999
.
CELG1600  WRITE     HTMLFILE;PTELPTHF;
          GOTO      CELG9999
.
CELG1700  UNPACK    AFNDCG,CCENT,CYEAR,CMON
          MOVE      ZERO,F2
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CELG1710
.
          MOVE      SP70,KEY4
          PACK      KEY4,CCENT,CYEAR
          WRITE     HTMLFILE;CCENT,CYEAR;
          GOTO      CELG9999
.
CELG1710  WRITE     HTMLFILE;F2;
          GOTO      CELG9999
.
CELG1800  WRITE     HTMLFILE;MVMEDREC;
          GOTO      CELG9999
.
CELG1900  WRITE     HTMLFILE;RETURNCD;    * return code indicator
          GOTO      CELG9999
.
CELG2000  WRITE     HTMLFILE;PTELPPUT;
          GOTO      CELG9999
.
CELG2100  WRITE     HTMLFILE;PTELPSUT;
          GOTO      CELG9999
.
CELG2200  WRITE     HTMLFILE;PTELPTUT;
          GOTO      CELG9999
.
CELG2300  WRITE     HTMLFILE;PTELECMN;
          GOTO      CELG9999
.
CELG2400  MATCH     SP70,PMAEQUOT
          GOTO      CELG9999 IF EQUAL
          GOTO      CELG9999 IF EOS
.
          WRITE     HTMLFILE;" Estimate ",PMAEQUOT; 
          GOTO      CELG9999
.
CELG2500  WRITE     HTMLFILE;PTELHSTM;
          GOTO      CELG9999
.
CELG2600  WRITE     HTMLFILE;PTELHFPN;
          GOTO      CELG9999
.
CELG2700  WRITE     HTMLFILE;PTELPSDY;
          GOTO      CELG9999
.
CELG2800  WRITE     HTMLFILE;PTELPSDU;
          GOTO      CELG9999
.
CELG2900  WRITE     HTMLFILE;PTELPHSP;
          GOTO      CELG9999
.
CELG3000  WRITE     HTMLFILE;PTELPHSU;
          GOTO      CELG9999
.
CELG3100  MOVE      PTELAFRM,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      CELG9999
.
CELG3200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CELG3210,CELG3220
.
          MOVE      PTELQLPS,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      CELG9999
.         
CELG3210  MOVE      SP3,YESNO
          MATCH     "1",PTELQLPS
          IF        @EQUAL
            MOVE      YES,YESNO
          ENDIF     
          MATCH     "0",PTELQLPS          
          IF        @EQUAL
            MOVE      NO,YESNO
          ENDIF     
          WRITE     HTMLFILE;YESNO;       
          GOTO      CELG9999
.
CELG3220  WRITE     HTMLFILE;PTELQLPS;
          GOTO      CELG9999
.
CELG3300  WRITE     HTMLFILE;PTELMDES;
          GOTO      CELG9999
.
CELG3400  WRITE     HTMLFILE;PTELMAMT;
          GOTO      CELG9999
.
CELG3500  MATCH     SP70,PMAEQUOT
          GOTO      CELG9999 IF EQUAL
          GOTO      CELG9999 IF EOS
.
          WRITE     HTMLFILE;PMAEQUOT; 
          GOTO      CELG9999
.
CELG3600  WRITE     HTMLFILE;ECLPHFRN;
          GOTO      CELG9999
.
CELG3700  WRITE     HTMLFILE;ECLPHFPN;
          GOTO      CELG9999
.
CELG3800  WRITE     HTMLFILE;ECLPFINA;
          GOTO      CELG9999
.
CELG3900  WRITE     HTMLFILE;ECLPCPRP;
          GOTO      CELG9999
.
CELG4000  WRITE     HTMLFILE;ECLPEFTA;
          GOTO      CELG9999
.
CELG4100  WRITE     HTMLFILE;ECLPSTPA;
          GOTO      CELG9999
.
CELG4200  WRITE     HTMLFILE;ECLPEXEX;
          GOTO      CELG9999
.
CELG4300  MATCH     SP70,PMHECPAM
          GOTO      CELG9999 IF EQUAL
          GOTO      CELG9999 IF EOS
.
          MATCH     "0        ",PMHECPAM
          IF        @EQUAL
            WRITE     HTMLFILE;PMHECPAM
            GOTO      CELG9999
          ENDIF
.         
          MOVE      SP70,DIM9
          MOVE      PMHECPAM,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      CELG9999
.
CELG4400  WRITE     HTMLFILE;PMHECPDR;
          GOTO      CELG9999
.
CELG4500  MATCH     SP70,PMHEEXAM
          GOTO      CELG9999 IF EQUAL
          GOTO      CELG9999 IF EOS
.
          MATCH     "0        ",PMHEEXAM
          IF        @EQUAL
            WRITE     HTMLFILE;PMHEEXAM
            GOTO      CELG9999
          ENDIF
.
          MOVE      SP70,DIM9
          MOVE      PMHEEXAM,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2
          GOTO      CELG9999
.
CELG4600  MATCH     SP70,PMHEEXBA
          GOTO      CELG9999 IF EQUAL
          GOTO      CELG9999 IF EOS
.
          MATCH     "0        ",PMHEEXBA
          IF        @EQUAL
            WRITE     HTMLFILE;PMHEEXBA
            GOTO      CELG9999
          ENDIF
.
          MOVE      SP70,DIM9
          MOVE      PMHEEXBA,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2
          GOTO      CELG9999
.
CELG4700  WRITE     HTMLFILE;PMHEFRID;
          GOTO      CELG9999
.
CELG4800  WRITE     HTMLFILE;PMHETNAM;
          GOTO      CELG9999
.
CELG4900  WRITE     HTMLFILE;PMHETBSC;
          GOTO      CELG9999
.
CELG5000  MOVE      "001",ELIGTYPE
          CALL      ECDSC000
          GOTO      CELG9999
.
CELG5100  MOVE      "002",ELIGTYPE
          CALL      ECDSC000
          GOTO      CELG9999
.
CELG5200  MOVE      "003",ELIGTYPE
          CALL      ECDSC000
          GOTO      CELG9999
.
CELG5300  MOVE      "004",ELIGTYPE
          CALL      ECDSC000
          GOTO      CELG9999
.
CELG5400  MOVE      "005",ELIGTYPE
          CALL      ECDSC000
          GOTO      CELG9999
.
CELG5500  MATCH     "Y",PMHEFSTA
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      CELG9999
.
CELG5600  MATCH     "Y",PMHEPEAI
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      CELG9999
.
CELG5700  WRITE     HTMLFILE;REDECFBT;
          GOTO      CELG9999
.
CELG5800  CALL      SRVASS00
          GOTO      CELG9999
.
CELG5900  CALL      OECT0000
          GOTO      CELG9999
.
CELG6000  CALL      OECTR000
          GOTO      CELG9999
.
CELG6100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CELG6110,CELG6120
.         
          MOVE      PTELEADM,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      CELG9999 
.         
CELG6110  MOVE      SP3,YESNO
          MATCH     "1",PTELEADM
          IF        @EQUAL
            MOVE      YES,YESNO
          ENDIF     
          MATCH     "0",PTELEADM
          IF        @EQUAL
            MOVE      NO,YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      CELG9999
.
CELG6120  WRITE     HTMLFILE;PTELEADM;
          GOTO      CELG9999
.
CELG6200  CALL      PMSEED00
          GOTO      CELG9999
.
CELG6300  WRITE     HTMLFILE;PTELTOOP;
          GOTO      CELG9999
.
CELG6400  MOVE      ZERO,F1
          PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MATCH     "3",TCINDC5
            IF        @EQUAL
              MOVE      ONE,F1              * Self Insured patient
            ENDIF
          ENDIF
          WRITE     HTMLFILE;F1;
          GOTO      CELG9999
.
CELG6500  WRITE     HTMLFILE;PTELCPCP;
          GOTO      CELG9999
.
CELG6600  WRITE     HTMLFILE;PTELCSCP;
          GOTO      CELG9999
.
CELG6700  WRITE     HTMLFILE;PTELCDCP;
          GOTO      CELG9999
.
CELG6800  WRITE     HTMLFILE;PTELCHCP;
          GOTO      CELG9999
.
CELG6900  WRITE     HTMLFILE;PTELCTCP;
          GOTO      CELG9999
.
CELG7000  MOVE      ONE,FESTINDC
CELG7005  PACK      KEY5,ANSF,ANSE,SP70
          CALL      RDSCODE1
CELG7010  CALL      RDKCODE1
          BRANCH    OVRCD,CELG9999
.
          MATCH     "FE",TCODE              * get codes from cat FE
          GOTO      CELG9999 IF NOT EQUAL
.
          MOVE      TCINDC1,F2
          COMPARE   FESTINDC,F2             * check indc1 for print order
          GOTO      CELG7010 IF NOT EQUAL
.
          MATCH     "I",TCINDC2             * only want 'IFC' codes (indc2)
          IF        !@EQUAL
            MATCH     " ",TCINDC2           * blank is ok
            GOTO      CELG7010 IF NOT EQUAL
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td class=HeadingRow>",TDESC,"</td></tr>"
.
          WRITE     HTMLFILE;"<tr><td>";
          PACK      KEY6,ACODE,SP70
          CALL      RSPMFET1
CELG7020  CALL      RKPMFET1
          BRANCH    OVRCD,CELG7030
.
          MATCH     ACODE,PMFETYPE
          GOTO      CELG7030 IF NOT EQUAL
.
          STRIP     PMFETEXT
          MOVELPTR  PMFETEXT,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      PMFETEXT,VAR
          WRITE     HTMLFILE;VAR            * display text detail
          SFORMAT   VAR,127
          GOTO      CELG7020
.
CELG7030  WRITE     HTMLFILE;"</td></tr>"
          ADD       ONE,FESTINDC
          GOTO      CELG7005
.
CELG7100  WRITE     HTMLFILE;PTELXCSD;      * Fund Excess for same day
          GOTO      CELG9999
.
CELG7200  WRITE     HTMLFILE;PTELPCCU;      * Co-payment CCU,ICU,SCN,HDU
          GOTO      CELG9999
.
CELG7300  WRITE     HTMLFILE;PTELCCCU;      * Calculate CCU,ICU,SCN,HDU
          GOTO      CELG9999
.
CELG7400  WRITE     HTMLFILE;PTELPCUT;      * CCU,ICU,SCN,HDU Co-payment Up To
          GOTO      CELG9999
.
CELG7500  WRITE     HTMLFILE;PMEXPMKN;      * PMKeys Number
          GOTO      CELG9999
.
CELG7600  WRITE     HTMLFILE;PMEXDANO;      * Defence Approval Number (DAN)
          GOTO      CELG9999
.
CELG7700  MATCH     PMEXDAT1,SP70           * Referral Date
          GOTO      CELG9999 IF EQUAL
          UNPACK    PMEXDAT1,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CELG9999
.
CELG7800  WRITE     HTMLFILE;PMEXABIC;      * Accepted by Insurance Company?
          GOTO      CELG9999
.
CELG7900  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CELG7910
          WRITE     HTMLFILE;PTELCMXC;
          GOTO      CELG9999
.
CELG7910  OPEN      PATCMCA1,"patcmcaf"
          PACK      KEY9,PTELCMXC,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,CELG9999
          WRITE     HTMLFILE;PTCADES1;
          GOTO      CELG9999
.
CELG8000  WRITE     HTMLFILE;USEBASIC;
          GOTO      CELG9999
.
CELG8100  WRITE     HTMLFILE;PTELECLS;
          GOTO      CELG9999
.
CELG8200  CALL      IFCDOC00             * get Document type for IFC 
          GOTO      CELG9999
.
CELG8300  WRITE     HTMLFILE;PTELCMPL;
          GOTO      CELG9999
.      
CELG8400  CALL      DSMBS000             * Display MBS from linked OEC
          GOTO      CELG9999
.
CELG8500  CALL      SELGST00                * Selection of GST
          GOTO      CELG9999
.
CELG8600  
          GOTO      CELG9999
.
CELG8700  WRITE     HTMLFILE;OLDOECIN;
          GOTO      CELG9999
.
CELG8800  CALL      GSTAPL00                * GST Applicable ?
          GOTO      CELG9999
.
CELG8900  CALL      QUANT000                * No of items/Quantity
          GOTO      CELG9999
.
CELG9000  CALL      ITMCOD00               * Theatre/Misc.code
          GOTO      CELG9999
.
CELG9100  CALL      MANKEY00               * Keyin GST ?
          GOTO      CELG9999
.
CELG9200  WRITE     HTMLFILE;PTCNEMCH;     * Misc.Charge Desc on Elig.Check 
          GOTO      CELG9999
.
CELG9300  WRITE     HTMLFILE;PTCNEITM;     * Using Misc.Charge on Elig.Check
          GOTO      CELG9999
.
CELG9400  CALL      ELIA0000               * HEA Eligibility Check items
          GOTO      CELG9999
.
CELG9999  RETURN
+
.------------------------------------------------------------
.  No of items/Quantity
.------------------------------------------------------------
QUANT000  MOVE      ZERO,F2
          MOVE      ONE,FORM2                 * default to one
          UNPACK    SP70,KEY1,KEY2
          UNPACK    DIM127,DIM1,KEY1,DIM127
          UNPACK    DIM127,DIM1,KEY2,DIM127
          MOVE      KEY2,F2
.
          MATCH     "1",KEY1
          IF        @EQUAL
            MATCH     SP70,MISCHG[F2]         * Misc.Charge
          ELSE
            MATCH     SP70,THEFEE[F2]         * Theatre fee
          ENDIF
          GOTO      QUANT900 IF EQUAL
.
          MATCH     "1",KEY1
          IF        @EQUAL
            MOVE      MISQUA[F2],FORM2        * Misc.Charge quantity
          ELSE
            MOVE      THEQUA[F2],FORM2        * Theatre fee quantity
          ENDIF
.
QUANT900  WRITE     HTMLFILE;FORM2;
QUANT999  RETURN
+
.------------------------------------------------------------
. GST Code Selection
.------------------------------------------------------------
SELGST00  MOVE      ZERO,F2
          UNPACK    SP70,KEY1,KEY2
          UNPACK    DIM127,DIM1,KEY1,DIM127
          UNPACK    DIM127,DIM1,KEY2,DIM127
          UNPACK    DIM127,DIM1,D1,DIM127
          PACK      D1,D1,SP70
          MOVE      KEY2,F2
.
          MOVE      SP70,KEY6
          MATCH     "x",D1
          GOTO      SELGST05 IF NOT EQUAL
.
          MATCH     "1",KEY1
          IF        @EQUAL
            MOVE      GSTCOM[F2],KEY6         * Misc.Charge GST Code
          ELSE
            MOVE      GSTCOD[F2],KEY6         * Theatre fee GST Code
          ENDIF
          WRITE     HTMLFILE;KEY6;
          GOTO      SELGST99
.
SELGST05  PACK      KEY6,SP70
          OPEN      IBAGSTA1,"ibagstaf"
          CALL      RSIBGS1
SELGST10  CALL      RKIBGS1
          BRANCH    OVRCD,SELGST99
.
          PACK      KEY8,QUOTE,IBGSCODE,QUOTE
.
          MATCH     "1",KEY1
          IF        @EQUAL
            MATCH     SP70,MISCHG[F2]         * Misc.Charge
          ELSE
            MATCH     SP70,THEFEE[F2]         * Theatre fee
          ENDIF
          GOTO      SELGST60 IF EQUAL
.
          MATCH     "1",KEY1
          IF        @EQUAL
            MOVE      GSTCOM[F2],KEY6         * Misc.Charge GST Code
          ELSE
            MOVE      GSTCOD[F2],KEY6         * Theatre fee GST Code
          ENDIF
          MATCH     KEY6,IBGSCODE   * Misc OR Theatre fee GST Code
          GOTO      SELGST60 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                               IBGSDESC,"</option>"
          GOTO      SELGST10
.
SELGST60  WRITE     HTMLFILE;"<option value=",KEY8,">":
                               IBGSDESC,"</option>"
          GOTO      SELGST10
SELGST99  RETURN
+
.------------------------------------------------------------
.  Theatre Fee/Misc.charge code
.------------------------------------------------------------
ITMCOD00  MOVE      ZERO,F2
          UNPACK    SP70,KEY1,KEY2,D1
          UNPACK    DIM127,DIM1,KEY1,DIM127
          UNPACK    DIM127,DIM1,KEY2,DIM127
          UNPACK    DIM127,DIM1,D1,DIM127
          MOVE      KEY2,F2
.
          MOVE      SP70,KEY9
          MATCH     "1",KEY1
          IF        @EQUAL
            MOVE      MISCHG[F2],KEY9         * Misc.Charge
          ELSE
            MOVE      THEFEE[F2],KEY9         * Theatre fee
          ENDIF
          MATCH     "1",D1
          IF        @EQUAL
            PACK      KEY17,KEY9,SP70
            CALL      PATITMRD
            IF        OVRCD=0
              WRITE     HTMLFILE;IDESC;       * item description
            ENDIF
          ELSE
            WRITE     HTMLFILE;KEY9;          * item code
          ENDIF
.
ITMCOD99  RETURN
+
.------------------------------------------------------------
. manually Keyin KEY1, 1 = Keyin GST for Misc,
.                      2 = Keyin GST for Theatre
.                      0=  Keyin Misc.Amount
.------------------------------------------------------------
MANKEY00  MOVE      ZERO,F2
          UNPACK    SP70,KEY1,KEY2
          UNPACK    DIM127,DIM1,KEY1,DIM127
          UNPACK    DIM127,DIM1,KEY2,DIM127
          MOVE      KEY2,F2
.
          MATCH     "1",PTCNIFCL
          GOTO      MANKEY20 IF EQUAL       * HEA Misc.charge
.
.         SJOG Misc. and Theatre fee
.
          MOVE      SP70,D1
          MATCH     "1",KEY1
          IF        @EQUAL
            MOVE      GSTMKY[F2],D1         * Misc.Charge
          ELSE
            MATCH     "2",KEY1
            IF        @EQUAL
              MOVE      GSTTKY[F2],D1         * Theatre fee
            ELSE
              MOVE      KEYAMT[F2],D1         * Keyin Misc.amount
            ENDIF
          ENDIF
          GOTO      MANKEY90
.
MANKEY20  MOVE      GSTMKY[F2],D1             * Misc.Charge
          GOTO      MANKEY90
.
MANKEY90  WRITE     HTMLFILE;D1;
.
MANKEY99  RETURN
+
.------------------------------------------------------------
. GST Applicable Selection
.  KEY1 = 1 for Misc  0 for theatre
.------------------------------------------------------------
GSTAPL00  MOVE      ZERO,F2
          UNPACK    SP70,KEY1,KEY2,D1
          PACK      DIM127,DIM127,SP70,SP70
          UNPACK    DIM127,DIM1,KEY1,DIM127
          UNPACK    DIM127,DIM1,KEY2,DIM127
          UNPACK    DIM127,DIM1,D1,DIM127
          PACK      D1,D1,SP70
          MOVE      KEY2,F2
.
          MATCH     "x",D1
          GOTO      GSTAPL05 IF NOT EQUAL
.
          MOVE      SP70,DIM1
          MATCH     "1",KEY1
          IF        @EQUAL
            MOVE      GSTAPM[F2],DIM1         * Misc.Charge GST applicable
          ELSE
            MOVE      GSTAPL[F2],DIM1         * Theatre fee GST applicable
          ENDIF
.
          WRITE     HTMLFILE;DIM1;
          GOTO      GSTAPL99

.
GSTAPL05  MATCH     "1",KEY1
          IF        @EQUAL
            MATCH     SP70,MISCHG[F2]         * Misc.Charge
          ELSE
            MATCH     SP70,THEFEE[F2]         * Theatre fee
          ENDIF
          GOTO      GSTAPL10 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=1>Yes</option>":
                             "<option value=0>No</option>"
          GOTO      GSTAPL99
.
GSTAPL10  MATCH     "1",KEY1
          IF        @EQUAL
            MOVE      GSTAPM[F2],KEY1         * Misc.Charge GST applicable
          ELSE
            MOVE      GSTAPL[F2],KEY1         * Theatre fee GST applicable
          ENDIF
.
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=1 selected>Yes</option>":
                               "<option value=0>No</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=1>Yes</option>":
                               "<option value=0 selected>No</option>"
          ENDIF
.
GSTAPL99  RETURN
+
.----------------------------------------------------------------------------
. Document type for IFC
.----------------------------------------------------------------------------
IFCDOC00  MOVE      "wi",KEY2
          PACK      KEY5,KEY2,SP70
          CALL      RDSCODE1
IFCDOC10  CALL      RDKCODE1
          BRANCH    OVRCD,IFCDOC99
.
          MATCH     KEY2,TCODE
          GOTO      IFCDOC99 IF NOT EQUAL
.
          MATCH     "F",TCINDC1
          GOTO      IFCDOC10 IF NOT EQUAL    * not for IFC
.
          WRITE     HTMLFILE;ACODE;

IFCDOC99  RETURN
+
.----------------------------------------------------------------------------
.         Display MBS from booking or linked preadmission or  Fees estimate
.----------------------------------------------------------------------------
DSMBS000  MOVE      ZERO,MBSINDEX
.
          MOVE      ADMISSNO,PTELVISN
.
          MATCH     "1",PTCNWSIN
          GOTO      DSMBS009 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      DSMBS009 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      DSMBS009 IF NOT EQUAL
.
          PACK      KEY11,PTELVISN,SP70       * Check Linked OEC
          CALL      RSWBOEC1                  * use the highest report counter
DSMBS005  CALL      RKWBOEC1
          BRANCH    OVRCD,DSMBS009
          MATCH     PTELVISN,WBOCVISN
          GOTO      DSMBS009 IF NOT EQUAL     * different visit number
.
          PACK      KEY8,WBOCELEG,SP70
          CALL      RDWBELF1
          BRANCH    OVRCD,DSMBS005
.
          MATCH     SP70,WBEFPRIM
          GOTO      DSMBS005 IF EQUAL
.
          MOVE      WBEFPRIM,KEY9
          PACK      KEY17,KEY9,SP70
          CALL      ITMD0000       * Display MBS items
          GOTO      DSMBS005
.
DSMBS009  MATCH     "1",PTCNOECE
          GOTO      DSMBS100 IF EQUAL
.
          PACK      KEY11,PTELVISN,SP70       * Check Linked OEC
          CALL      RSPMOEC1                  * use the highest report counter
DSMBS010  CALL      RKPMOEC1
          BRANCH    OVRCD,DSMBS100
          MATCH     PTELVISN,PMOEVISN
          GOTO      DSMBS100 IF NOT EQUAL     * different visit number
.
          PACK      KEY8,PMOEELEG,SP70
          CALL      RDPMELF1
          BRANCH    OVRCD,DSMBS010
.
          MATCH     SP70,PMEFPRIM
          GOTO      DSMBS010 IF EQUAL
.
          MOVE      PMEFPRIM,KEY9
          PACK      KEY17,KEY9,SP70
          CALL      ITMD0000       * Display MBS items
          GOTO      DSMBS010
.
DSMBS100  COMPARE   ZERO,MBSINDEX
          GOTO      DSMBS999 IF NOT EQUAL
.
.         Check booking MBS
.
          PACK      KEY31,ADMISSNO,SP70
          CALL      RSOPDEA2
          CALL      RKOPDEA2
          BRANCH    OVRCD,DSMBS200
.
          MATCH     ADMISSNO,OPDAADMN
          GOTO      DSMBS200 IF NOT EQUAL
.
          MATCH     "3",DOPDASTA
          GOTO      DSMBS200 IF EQUAL          * Cancelled
.
          MATCH     SP70,OPDAPROV
          IF        !@EQUAL & !@EOS
            MOVE      OPDAPROV,KEY9
            PACK      KEY17,KEY9,OPDADATE,SP70
            CALL      ITMD0000       * Display MBS items
          ENDIF
.
          MATCH     SP70,OPDAPRV2
          IF        !@EQUAL & !@EOS
            MOVE      OPDAPRV2,KEY9
            PACK      KEY17,KEY9,OPDADATE,SP70
            CALL      ITMD0000       * Display MBS items
          ENDIF
.
          MATCH     SP70,OPDAPRV3
          IF        !@EQUAL & !@EOS
            MOVE      OPDAPRV3,KEY9
            PACK      KEY17,KEY9,OPDADATE,SP70
            CALL      ITMD0000       * Display MBS items
          ENDIF
          GOTO      DSMBS999
.
.         Check linked Fees Estimate
.
DSMBS200  CALL      CLRAEL00               * Clear Fees Estimate/quote no
.
          PACK      KEY20,ADMISSNO,SP70
          CALL      RSPMAEL1
          CALL      RKPMAEL1
          IF        OVRCD=1
            CALL      CLRAEL00               * Clear Fees Estimate/quote no
            GOTO      DSMBS999
          ENDIF
.
          MATCH     ADMISSNO,PMAEVISN      * Same visit number ?
          IF        !@EQUAL
            CALL      CLRAEL00               * Clear Fees Estimate/quote no
            GOTO      DSMBS999
          ENDIF
.
          MOVE      PMAEQUOT,PMFDQUOT
          PACK      KEY12,PMAEQUOT
          CALL      RDPMFED1
          BRANCH    OVRCD,DSMBS999
.
          MOVE      "5",KEY1                * for Theatre fees
          PACK      KEY18,PMFDQUOT,KEY1,SP70
          CALL      RSPMFES2
DSMBS220  CALL      RKPMFES2
          BRANCH    OVRCD,DSMBS999
.
          MATCH     PMFSQUOT,PMFDQUOT
          GOTO      DSMBS999 IF NOT EQUAL
.
          MATCH     SP70,PMFSTHIT
          GOTO      DSMBS220 IF EQUAL
.
          MOVE      PMFSTHIT,KEY9
          PACK      KEY17,KEY9,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,DSMBS220
.
          PACK      KEY17,KEY9,SP70
          CALL      ITMD0000       * Display MBS items
          GOTO      DSMBS220
.
DSMBS999  RETURN
+
.-----------------------------------------------------------------------------
.         Delete MBS item records entered from Booking
.-----------------------------------------------------------------------------
CBOOK000  MOVE      ZERO,EXIT
          COMPARE   ONE,PMELIFLG
          GOTO      CBOOK999 IF NOT EQUAL
.
          MOVE      "5",KEY1                * for Theatre fees
          PACK      KEY12,SP4,ADMISSNO,SP70
          REP       " 9",KEY12
          PACK      KEY18,KEY12,KEY1,SP70
CBOOK100  CALL      RSPMFES2
CBOOK200  CALL      RKPMFES2
          BRANCH    OVRCD,CBOOK400
.
          MATCH     PMFSQUOT,KEY12
          GOTO      CBOOK400 IF NOT EQUAL
          MATCH     "5",PMFSRECT
          GOTO      CBOOK400 IF NOT EQUAL    * Not a theatre record
.
          MATCH     SP70,PMFSTHIT
          GOTO      CBOOK200 IF EQUAL
          MATCH     "XXX",PMFSBTYP
          GOTO      CBOOK200 IF NOT EQUAL    * Not from Booking
.
          PACK      KEY17,PMFSQUOT,PMFSUNIQ,SP70
          CALL      DEPMFES1
          GOTO      CBOOK100
.
CBOOK400  MOVE      "1",KEY1                 * Theatre Fee
          PACK      KEY12,ADMISSNO,KEY1,SP70
CBOOK500  CALL      RSPMELI1
CBOOK600  CALL      RKPMELI1
          BRANCH    OVRCD,CBOOK999
.
          MATCH     ADMISSNO,PMEIVISN
          GOTO      CBOOK999 IF NOT EQUAL     * different visit number
.
          MATCH     KEY1,PMEIRTYP         * check record type
          GOTO      CBOOK999 IF NOT EQUAL
.
          MATCH     "X",PMEIKEYI
          GOTO      CBOOK600 IF NOT EQUAL
.
          PACK      KEY12,ADMISSNO,PMEIRTYP,PMEICNTR,SP70
          CALL      DEPMELI1
.
          GOTO      CBOOK500
.
CBOOK999  RETURN
+
.------------------------------------------------------------
. Display MBS operation description
.------------------------------------------------------------
ITMD0000  CALL      CDES0000
.
.         MATCH     SP70,UPDTTYPE
.         IF        @EQUAL
            ADD       ONE,MBSINDEX
            MOVE      KEY9,FMBSCODE[MBSINDEX]
.         ENDIF
.
          BRANCH    IFCFLAG,ITMD9999
          WRITE     HTMLFILE;"<tr><td width=6%><b>Theatre Fee</b></td>":
                             "<td class=DataField width=10%>":
                             "<input type=text size=9 maxlength=10 ":
                             "class='Readonly readonly'":
                             " value='",KEY9,"' </td>":
                             "<td class=DataField width=45%>":
                             "<input type=text size=50 maxlength=70 ":
                             "class='Readonly readonly'":
                             " value='",IDESC,"' </td></tr>";
ITMD9999  RETURN
+
.----------------------------------------------------------------------------
. Report No. 7 : QLD Rehab Details Display
.----------------------------------------------------------------------------
TQRD0000  BRANCH    FLDITMNO,TQRD0100,TQRD0200,TQRD0300,TQRD0400,TQRD0500:
                             TQRD0600,TQRD0700,TQRD0800,TQRD0900,TQRD1000:
                             TQRD1100,TQRD1200,TQRD1300,TQRD1400,TQRD1500:
                             TQRD1600,TQRD1700,TQRD1800,TQRD1900,TQRD2000:
                             TQRD2100,TQRD2200,TQRD2300,TQRD2400,TQRD2500:
                             TQRD2600,TQRD2700,TQRD2800,TQRD2900,TQRD3000:
                             TQRD3100
          GOTO      TQRD9999
.
TQRD0100  MATCH     "A ",CARECATG
          IF        @EQUAL
            CALL      LRAT0000              * Table of Rehab Episodes (Cat.A)
          ELSE
            CALL      LODB0000              * Table of Rehab Episodes (Cat.CC)
          ENDIF
          GOTO      TQRD9999
.
TQRD0200  MATCH     ZEROVISN,PTQRADMN       * Admission No
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRADMN;
          GOTO      TQRD9999
.
TQRD0300  COMPARE   ZERO,PTQREPNO         * Episode No
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQREPNO;
          GOTO      TQRD9999
.
TQRD0400  WRITE     HTMLFILE;PTQRBISA;    * Barthal Index Score on Admission
          GOTO      TQRD9999

TQRD0500  WRITE     HTMLFILE;PTQRBISD;    * Barthal Index Score on Discharge
          GOTO      TQRD9999
.
TQRD0600  MOVE      "CU",CATEGORY
          MOVE      PTQRCLSP,CODE
          CALL      CODITM00
          GOTO      TQRD9999
.
TQRD0700  MATCH     SP70,PTQRODTE         * Onset Date
          GOTO      TQRD9999 IF EQUAL
          UNPACK    PTQRODTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TQRD9999
.
TQRD0800  MATCH     SP70,PTQRARTR         * Admission/Readmission to Rehab
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRARTR;
          GOTO      TQRD9999
.
TQRD0900  MATCH     SP70,PTQRUSRF         * User Flag
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRUSRF;
          GOTO      TQRD9999
.
TQRD1000  MATCH     SP70,PTQRPCSA         * Palliative Care State on Admission
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRPCSA;
          GOTO      TQRD9999
.
TQRD1100  MATCH     SP70,PTQRPCSD         * Palliative Care State on Discharge
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRPCSD;
          GOTO      TQRD9999
.
TQRD1200  MATCH     SP70,PTQRRGAA         * RUG ADL on Admission
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRRGAA;
          GOTO      TQRD9999
.
TQRD1300  MATCH     SP70,PTQRRGAD         * RUG ADL on Discharge
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRRGAD;
          GOTO      TQRD9999
.
TQRD1400  MATCH     SP70,PTQRSRPC         * Source of Referral for Pall Care
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRSRPC;
          GOTO      TQRD9999
.
TQRD1500  COMPARE   ZERO,PTQRFIMA         * F.I.M Source on Admission
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRFIMA;
          GOTO      TQRD9999
.
TQRD1600  COMPARE   ZERO,PTQRFIMD         * F.I.M Source on Discharge
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRFIMD;
          GOTO      TQRD9999
.
TQRD1700  MATCH     SP70,PTQRDIAG         * Diagnostic Group
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRDIAG;
          GOTO      TQRD9999
.
TQRD1800  MATCH     SP70,PTQRCOM1         * Comments Line 1
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRCOM1;
          GOTO      TQRD9999
.
TQRD1900  MATCH     SP70,PTQRCOM2         * Comments Line 2
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRCOM2;
          GOTO      TQRD9999
.
TQRD2000  MATCH     SP70,EPISODNO         * Episode Number
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;EPISODNO;
          GOTO      TQRD9999
.
TQRD2100  MATCH     SP70,EPFRDATE         * Episode Start Date
          GOTO      TQRD9999 IF EQUAL
          UNPACK    EPFRDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TQRD9999
.
TQRD2200  MATCH     SP70,EPTODATE         * Episode End Date
          GOTO      TQRD9999 IF EQUAL
          UNPACK    EPTODATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TQRD9999
.
TQRD2300  MATCH     SP70,EPCARETP         * Episode Care Type
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;EPCARETP;
          GOTO      TQRD9999
.
TQRD2400  MATCH     SP70,PTQRFADT         * Assessment date on admission
          GOTO      TQRD9999 IF EQUAL
          UNPACK    PTQRFADT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TQRD9999
.
TQRD2500  MATCH     SP70,PTQRFDDT         * Assessment date on discharge
          GOTO      TQRD9999 IF EQUAL
          UNPACK    PTQRFDDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TQRD9999
.
TQRD2600  MATCH     SP70,PTQRCOM1         * ADL Date (uses comments 1 field)
          GOTO      TQRD9999 IF EQUAL
          UNPACK    PTQRCOM1,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TQRD9999
.
TQRD2700  MATCH     SP70,EPISODCT         * Episode counter
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;EPISODCT;
          GOTO      TQRD9999
.
TQRD2800  CALL      LODQ0000              * Table of QLD Rehab Episodes
          GOTO      TQRD9999
.
TQRD2900  COMPARE   ZERO,PTQRCNTR         * Episode Counter
          GOTO      TQRD9999 IF EQUAL
          WRITE     HTMLFILE;PTQRCNTR;
          GOTO      TQRD9999
.
TQRD3000  PACK      KEY12,ADMISSNO,EPISODNO,Z70
          CALL      RSPTQRD1
          CALL      RPPTQRD1
          BRANCH    OVRCD,TQRD3090
.
          MATCH     ADMISSNO,DPTQRADM
          GOTO      TQRD3090 IF NOT EQUAL
.
          MATCH     EPISODNO,DPTQREPN
          GOTO      TQRD3090 IF NOT EQUAL
.
          WRITE     HTMLFILE;DPTQRCNT;           * last record for episode
          GOTO      TQRD9999
.
TQRD3090  CALL      CLRQRD00
          GOTO      TQRD9999
.
TQRD3100  MATCH     SP70,PTQRMCDT         * Multidisciplinary Care Date 
          GOTO      TQRD9999 IF EQUAL
.
          UNPACK    PTQRMCDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      TQRD9999
.
TQRD9999  RETURN
+
.------------------------------------------------------------------------------
.         Yes/No option
.------------------------------------------------------------------------------
DNOYES00  MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ZERO,">":
                               "No</option>":
                               "<option value=",ONE," selected>":
                               "Yes</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ZERO," selected>":
                               "No</option>":
                               "<option value=",ONE,">":
                               "Yes</option>"
          ENDIF
DNOYES99  RETURN
.
.------------------------------------------------------------------------------
.         Blank/Yes/No option
.------------------------------------------------------------------------------
BNOYES00  MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ZERO,">":
                               "No</option>":
                               "<option value=",ONE," selected>":
                               "Yes</option>"
          ELSE
            MATCH     "0",KEY1
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",ZERO," selected>":
                                 "No</option>":
                                 "<option value=",ONE,">":
                                 "Yes</option>"
            ELSE
              WRITE     HTMLFILE;"<option></option>":
                                 "<option value=",ZERO,">":
                                 "No</option>":
                                 "<option value=",ONE,">":
                                 "Yes</option>"
            ENDIF
          ENDIF
BNOYES99  RETURN
+
.------------------------------------------------------------------------------
.         Saves field values from Cross Consultation record into save variables
.------------------------------------------------------------------------------
SAVCCD00  MOVE      PTCRSPEC,SAVESPEC   * Save speciality
          MOVE      PTCRDOCT,SAVEDOCT   * Save Referring Consultant
          MOVE      PTCRREFD,SAVEREFD   * Save Referred Consultant
          MOVE      PTCRCMNT,SAVECMNT   * Save comment
          MOVE      PTCRAMNT,SAVEAMNT   * Save Time Taken (Hrs)
          MOVE      PTCRCNTR,SAVECNTR   * Save record counter
          MOVE      PTCRTIME,SAVETIME   * Save Time
          MOVE      PTCRACTN,SAVEACTN   * Save Action
          MOVE      PTCRDATE,SAVEDATE   * Save Date
          MOVE      PTCRCOMM,SAVECOMM   * Save comment
.
SAVCCD99  RETURN
+
.------------------------------------------------------------------------------
.                       All Cross Consultations List
.------------------------------------------------------------------------------
ALLCCL00  MOVE      ONE,FRSTCONS            * Set first consultation record flag
          MOVE      SP70,SAVEDOCT           * Initialize Save variables
          MOVE      SP70,SAVEREFD
          MOVE      SP70,SAVESPEC
          MOVE      SP70,SAVECMNT
          MOVE      ZERO,SAVEAMNT
          MOVE      SP70,SAVETIME
          MOVE      SP70,SAVEDATE
          MOVE      SP70,SAVEACTN
          MOVE      SP70,SAVECOMM
.
          PACK      KEY31,ADMISSNO,SP70
          CALL      RSPTCRC1
ALLCCL10  CALL      RKPTCRC1
          BRANCH    OVRCD,ALLCCL90          * Display saved data (if any), exit.
.
          MATCH     ADMISSNO,DPTCRBIL       * Same visit number?
          GOTO      ALLCCL90 IF NOT EQUAL   * No, display saved data and exit
.
          IF        DONTGRBC=1            
            CALL      SAVCCD00              * Don't group records by consultant
            CALL      DSPACC00
            GOTO      ALLCCL10
          ENDIF
.
.         Display multiple records with the same Referring Consultant 
.         and blank Referred Consultant (CAR 270231)
.
          MATCH     SP70,PTCRREFD           * Blank Referred Consultant?
          IF        @EQUAL
            CALL      SAVCCD00
            CALL      DSPACC00
            GOTO      ALLCCL10
          ENDIF
.
          IF        PTCRCNTR=1            
            COMPARE   ONE,FRSTCONS          * Is it first cross const record?
            IF        !@EQUAL        
              CALL      DSPACC00            * No, display saved record
            ELSE
              MOVE      ZERO,FRSTCONS       * Yes, don't display but reset flag
            ENDIF
.
            CALL      SAVCCD00
          ELSE
            ADD       PTCRAMNT,SAVEAMNT     * Accumulate Time Taken (Hrs)
          ENDIF
.
          GOTO      ALLCCL10                * Get next record
.
ALLCCL90  COMPARE   ONE,FRSTCONS
          GOTO      ALLCCL99 IF EQUAL       * Nothing to display, exit
.
          CALL      DSPACC00                * Display saved record
          GOTO      ALLCCL99                * Exit. 
.
ALLCCL99  RETURN
.
.------------------------------------------------------------------------------
.                Get Total Hours for a given Cross Consulting
.------------------------------------------------------------------------------
TOTHRS00  MOVE      ZERO,SAVEAMNT           * Initialize total hours
          PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,SP70
          CALL      RSPTCRC1
TOTHRS10  CALL      RKPTCRC1
          BRANCH    OVRCD,TOTHRS90
.
          MATCH     ADMISSNO,DPTCRBIL       * Same Admission No.?
          GOTO      TOTHRS90 IF NOT EQUAL   * No, go to exit.
.
          MATCH     PTCRC001,PTCRDOCT       * Same Referring Consultant?
          GOTO      TOTHRS90 IF NOT EQUAL   * No, go to exit.
.
          MATCH     PTCRC002,PTCRREFD       * Same Referred Consultant?
          GOTO      TOTHRS90 IF NOT EQUAL   * No, go to exit.
.
          MATCH     PTCRC002,SP70           * Blank Referred Consultant?
          GOTO      TOTHRS20 IF NOT EQUAL   * No, skip check and add hours
.
          MATCH     PTCRC008,PTCRSPEC       * Same Speciality?
          GOTO      TOTHRS10 IF NOT EQUAL   * No, get next record
.
TOTHRS20  ADD       PTCRAMNT,SAVEAMNT       * Accumulate Total Hours
          GOTO      TOTHRS10                * Get next record 
.
TOTHRS90  IF        PTCRC003=ZERO
            MOVE      ONE,RECNUMBR
          ELSE
            MOVE      PTCRC003,RECNUMBR
          ENDIF
          MOVE      ONE,RECNUMBR
          MOVE      RECNUMBR,KEY3
          PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,KEY3,SP70
          CALL      RDPTCRC1                * Re-read the original record.
.
TOTHRS99  RETURN
.
.------------------------------------------------------------------------------
.                    Cross Consultation Details List
.------------------------------------------------------------------------------
CONDTL00  MOVE      "99999999",FCONDATE
          PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,SP70
          CALL      RSPTCRC1
CONDTL10  CALL      RKPTCRC1                * Find smallest DATE for this Cons
          BRANCH    OVRCD,CONDTL20
.
          MATCH     ADMISSNO,DPTCRBIL       * Same Admission No.?
          GOTO      CONDTL20 IF NOT EQUAL   * No, go to exit.
.
          MATCH     PTCRC001,PTCRDOCT       * Same Referring Consultant?
          GOTO      CONDTL20 IF NOT EQUAL   * No, go to exit.
.
          MATCH     PTCRC002,PTCRREFD       * Same Referred Consultant?
          GOTO      CONDTL20 IF NOT EQUAL   * No, go to exit.
.
          MATCH     FCONDATE,PTCRDATE       * Is Date found less than FCONDATE?
          IF        @LESS
            MOVE      PTCRDATE,FCONDATE     * Yes, make it a new FCONDATE
          ENDIF
.
          GOTO      CONDTL10                * Get next record
.
.         Display All Consultation Details in chronological order
.       
CONDTL20  PACK      KEY39,PTCRC001,PTCRC002,ADMISSNO,FCONDATE,SP70
          CALL      RSPTCRC4
CONDTL30  CALL      RKPTCRC4
          BRANCH    OVRCD,CONDTL90
.
          MATCH     ADMISSNO,DPTCRBIL       * Same Admission No.?
          GOTO      CONDTL90 IF NOT EQUAL   * No, go to exit.
.
          MATCH     PTCRC001,PTCRDOCT       * Same Referring Consultant?
          GOTO      CONDTL90 IF NOT EQUAL   * No, go to exit.
.
          MATCH     PTCRC002,PTCRREFD       * Same Referred Consultant?
          GOTO      CONDTL90 IF NOT EQUAL   * No, go to exit.
.
.         MATCH     PTCRC002,SP70           * Blank Referred Consultant?
.         GOTO      CONDTL90 IF NOT EQUAL   * No, go to exit.
.
          MATCH     PTCRC002,SP70           * Blank Referred Consultant?
          GOTO      CONDTL40 IF NOT EQUAL   * No, skip check and dispaly all
.
          MATCH     PTCRC008,PTCRSPEC       * Same Speciality?
          GOTO      CONDTL30 IF NOT EQUAL   * No, get next record
.
          IF        PTCRC003 = 0
            COMPARE   PTCRC003,PTCRCNTR     * Same record count?
            GOTO      CONDTL30 IF NOT EQUAL * No, get next
.
            MATCH     PTCRC002,SP70         * Referred Consultant?
            GOTO      CONDTL30 IF NOT EQUAL * Yes, get next record
.
            MATCH     PTCRC008,PTCRSPEC     * Same Speciality?
            GOTO      CONDTL30 IF NOT EQUAL * No, get next record
          ENDIF
.
CONDTL40  CALL      DSPCCD00                * Display Cross Cons Details row
          GOTO      CONDTL30                * Get next record
.
CONDTL90  IF        PTCRC003=ZERO
            MOVE      ONE,RECNUMBR
          ELSE
            MOVE      PTCRC003,RECNUMBR
          ENDIF
          MOVE      RECNUMBR,KEY3
          PACK      KEY31,ADMISSNO,PTCRC001,PTCRC002,KEY3,SP70
          CALL      RDPTCRC1                * Re-read the original record.
.
CONDTL99  RETURN
.
.------------------------------------------------------------------------------
.               Display All Cross Consultation Table Row
.------------------------------------------------------------------------------
DSPACC00  CLEAR     HTMLLINK
          APPEND    "javascript:CrossConsDetails('",HTMLLINK
          APPEND    SAVEDOCT,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    SAVEREFD,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    SAVESPEC,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    SAVECNTR,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    SHOWSPEC,HTMLLINK
          APPEND    "');",HTMLLINK
          RESET     HTMLLINK
.
          MOVE      SAVEDOCT,KEY10         * Get Referring Consultant's name
          CALL      RDPMHCP1
          IF        OVRCD=0
.           CALL      DOCNAM00             * Format name
            MOVE      PMHCTITL,FMTTITLE            * I CAR 13038
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000                  * end I CAR 13038
          ELSE
            CLEAR     DOCFNAME
            APPEND    "Invalid Doctor - ",DOCFNAME
            APPEND    SAVEDOCT,DOCFNAME
            RESET     DOCFNAME
          ENDIF
          MOVE      DOCFNAME,DOCTNAME
.
          MOVE      SP70,REFDNAME
          MATCH     SP70,SAVEREFD
          IF        !@EQUAL
            MOVE      SAVEREFD,KEY10         * Get Referred Consultant's name
            CALL      RDPMHCP1
            IF        OVRCD=0
.             CALL      DOCNAM00             * Format name
              MOVE      PMHCTITL,FMTTITLE            * I CAR 13038
              MOVE      PMHCGNAM,FMTGNAME
              MOVE      PMHCSNAM,FMTSNAME
              CALL      DOCNM000                  * end I CAR 13038
            ELSE
              CLEAR     DOCFNAME
              APPEND    "Invalid Doctor - ",DOCFNAME
              APPEND    SAVEREFD,DOCFNAME
              RESET     DOCFNAME
            ENDIF
            MOVE      DOCFNAME,REFDNAME
          ENDIF
.
          MATCH     SP3,SAVEACTN
          IF        !@EQUAL
            PACK      KEY5,CTAc,SAVEACTN
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      SP70,DIM20
            ELSE
              MOVE      TDESC,DIM20
            ENDIF
          ELSE
              MOVE      SP70,DIM20
          ENDIF
.
          MOVE      SP70,IDESC
          CALL      MISC0000
.
          MOVE      SP70,TDESC
          MATCH     SP70,SAVESPEC
          IF        !@EQUAL
            PACK      KEY5,ANSA,ANSC,SAVESPEC,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      SAVESPEC,TDESC
            ENDIF
          ENDIF
.
          UNPACK    SAVEDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPCDATE
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY20,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,SAVETIME
 
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":      * 0
                             "#"",DOCTNAME,"#",":               
                             "#"",REFDNAME,"#",":               
                             "#"",SAVECMNT,"#",":
                             "#"",SAVEAMNT,"#",":
                             "#"",IDESC,"&nbsp;#",":            * 5
                             "#"",TDESC,"#",":
                             "#"",KEY20,"#",":
                             "#"",DIM20,"#",":
                             "#"",SAVECOMM,"#",":
                             "#"",SAVEDATE,SAVETIME,"#")"
.
DSPACC99  RETURN
.
.------------------------------------------------------------------------------
.           Display Cross Consultation Details Table Row
.------------------------------------------------------------------------------
DSPCCD00  CLEAR     HTMLLINK
          APPEND    "javascript:UpdateConsultation('",HTMLLINK
          APPEND    PTCRDOCT,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PTCRREFD,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PTCRCNTR,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    SHOWSPEC,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PTCRSPEC,HTMLLINK
          APPEND    "');",HTMLLINK
          RESET     HTMLLINK
.
          UNPACK    PTCRDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          MOVE      SP70,IDESC
          CALL      MISC0000
.
          WRITE     HTMLFILE;"<tr><td align=center>":
                             "<img src=#"../images/MaintenanceIcon.gif#"":
                             " onclick=#"",HTMLLINK,"#"></td>":
                             "<td align=center>",CDAY,SP1,MTHNAM3,SP1,CCENT:
                             CYEAR,"</td>":
                             "<td align=right>",PTCRAMNT,"</td>":
                             "<td>",IDESC,"&nbsp;</td></tr>";
.
DSPCCD99  RETURN
.
.------------------------------------------------------------------------------
.                        Get Discharge Date 
.------------------------------------------------------------------------------
DSCDTE00  MOVE      SP70,DSCHDATE                * Initialize Discharge Date
.
          PACK      KEY8,ADMISSNO,SP70           * Read Visit File
          CALL      RDVISA1
          BRANCH    OVRCD,DSCDTE50
.
          BRANCH    PVITYPE,DSCDTE30,DSCDTE50,DSCDTE40
          GOTO      DSCDTE50
.
DSCDTE30  PACK      KEY8,ADMISSNO,SP70           * Read Emergency Visit
          CALL      RDEMVIS1
          BRANCH    OVRCD,DSCDTE50
.
          MOVE      EMVIDDAT,DSCHDATE
          GOTO      DSCDTE50
.
DSCDTE40  PACK      KEY8,ADMISSNO,SP70           * Read Discharge Record
          CALL      RDDSCH1
          BRANCH    OVRCD,DSCDTE50
.
          MOVE      DDATE,DSCHDATE               * Populate Discharge Date
.
DSCDTE50  MATCH     SP70,DSCHDATE
          IF        @EQUAL
            PACK      DSCHDATE,CURRDATE,SP10     * No Discharge Date 
.                                                * Use current date as max date
          ENDIF
.
          UNPACK    DSCHDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
.          
DSCDTE99  RETURN
.
.------------------------------------------------------------
. Table of Rehab Details (Maintenance) 
. Note routine uses admission variables read from Main - PATRDE50
.------------------------------------------------------------
LODB0000  PACK      LASTDATE,CURRDATE,SP10

          MOVE      ZERO,EPSNUMB            * Reset no of episodes counter
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDDSCH1                 * Read the discharge file
          IF        OVRCD<>1
            PACK      LASTDATE,DDATE
          ENDIF
.
          PACK      EPSSDATE,ADATE      * Episode start date
          PACK      EPSWDATE,ADATE      * Episode work date
.
          PACK      KEY24,ADMISSNO,SP70
          CALL      RDSCHCO1                * Position on & read the code
LODB1000  CALL      RDKCHCO1                * changes file
          BRANCH    OVRCD,LODB3000
.
          MATCH     ADMISSNO,DCHADMN
          GOTO      LODB3000 IF NOT EQUAL   * Different admission number, exit
.
          MATCH     "CC",CHCATG
          GOTO      LODB3000 IF NOT EQUAL   * Different care class, exit
.
          MOVE      CHCODE,CARECLSS         * Episode care class
          MOVE      CHDATE,EPSEDATE         * Episode end date
.
          MATCH     EPSEDATE,EPSWDATE
          GOTO      LODB1000 IF EQUAL       * Ignore changes on the same day  
.
          CALL      CNEX0000                * Check for change in care type
          MOVE      EPSEDATE,EPSWDATE       * New episode work date
          BRANCH    GETNEXT,LODB1000        * No change in care type, get next
.
          ADD       ONE,EPSNUMB             * Increment file episode counter
          CALL      CKCC0000                * Check for a valid sub acute code
          BRANCH    EXIT,LODB2000           * Not sub acute care type
.
          MOVE      CARETYPE,EPSCTYPE       * Care type
.
          CALL      LODT0000                * Output Table Row
.
LODB2000  MOVE      EPSEDATE,EPSSDATE       * New episode start date
          GOTO      LODB1000
.
. ----- Reached last episode -----
.
LODB3000  MOVE      ACARE,CARECLSS          * Load current care type
          IF        EPSNUMB=0
            PACK      EPSSDATE,ADATE    * New episode start date
            PACK      EPSWDATE,ADATE    * New episode work date
          ENDIF
          MOVE      LASTDATE,EPSEDATE       * Episode end date
.
          CALL      GCTY0000                * Get the care type
          CALL      CKCC0000                * Check for a valid sub acute code
          BRANCH    EXIT,LODB9999
.
          ADD       ONE,EPSNUMB             * Increment file episode counter
          MOVE      CARETYPE,EPSCTYPE       * Care type
.
          CALL      LODT0000                * Output Table Row
.
LODB9999  RETURN
+
.------------------------------------------------------------
. Table of Rehab Details (Maintenance) - based on admission type (Cat.A)
. Note routine uses admission variables read from Main - PATRDE50
.------------------------------------------------------------
LRAT0000  PACK      LASTDATE,CURRDATE,SP10  

          MOVE      ZERO,EPSNUMB            * Reset no of episodes counter
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDDSCH1                 * Read the discharge file
          IF        OVRCD<>1
            PACK      LASTDATE,DDATE
          ENDIF
.
          PACK      KEY30,ADMISSNO,SP70
          CALL      RDSTRAN2
LRAT1000  CALL      RDKTRAN2
          BRANCH    OVRCD,LRAT3000
.
          MATCH     ADMISSNO,DTADMN
          GOTO      LRAT3000 IF NOT EQUAL   * Different admission number, exit
.
          MATCH     ADATE,TDATE
          IF        @EQUAL
            MOVE      TDATE,EPSSDATE        * initial Episode start date
            MOVE      TATYPE,CARECLSS       * initial Episode care class
            GOTO      LRAT1000              * ignore adm record
          ELSE
            MOVE      TDATE,EPSEDATE        * Episode end date
          ENDIF
.
          MATCH     CARECLSS,TATYPE
          GOTO      LRAT1000 IF EQUAL       * no care class change
.
.>>>>     MATCH     EPSEDATE,EPSWDATE
.>>>>     GOTO      LRAT1000 IF EQUAL       * Ignore changes on the same day
.
          CALL      GCTY0000                * Get the care type
          ADD       ONE,EPSNUMB             * Increment file episode counter
          CALL      CKCC0000                * Check for a valid sub acute code
          BRANCH    EXIT,LRAT2000           * Not sub acute care type
.
          MOVE      CARETYPE,EPSCTYPE       * Care type
          CALL      LODT0000                * Output Table Row
.
LRAT2000  MOVE      EPSEDATE,EPSSDATE       * New episode start date
          MOVE      TATYPE,CARECLSS         * save Episode care class
          GOTO      LRAT1000
.
LRAT3000  MOVE      LASTDATE,EPSEDATE       * last episode date
          CALL      GCTY0000                * Get the care type
          ADD       ONE,EPSNUMB             * Increment file episode counter
          CALL      CKCC0000                * Check for a valid sub acute code
          BRANCH    EXIT,LRAT9999           * Not sub acute care type
.
          MOVE      CARETYPE,EPSCTYPE       * Care type
          CALL      LODT0000                * Output Table Row
.
LRAT9999  RETURN
+
.******************************************************************************
.  Table output in in sort table format.
.******************************************************************************
LODT0000  COMPARE   FOUR,PTCNHDPS
          GOTO      LODT1000 IF NOT EQUAL   * Not in QLD
.
          CLEAR     HTMLLINK
          APPEND    "javascript:ListRehabDetQLD('",HTMLLINK
          APPEND    EPSNUMB,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EPSSDATE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EPSEDATE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EPSCTYPE,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:QLDRdeLink('",HTMLLNK2
          APPEND    EPSNUMB,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    EPSSDATE,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    EPSEDATE,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    EPSCTYPE,HTMLLNK2
          APPEND    "')",HTMLLNK2

          GOTO      LODT5000
.
LODT1000  COMPARE   NINE,PTCNHDPS
          GOTO      LODT2000 IF NOT EQUAL   * Not in ACT
.
          CLEAR     HTMLLINK
          APPEND    "javascript:ListRehabDetACT('",HTMLLINK
          APPEND    EPSNUMB,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EPSSDATE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EPSEDATE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EPSCTYPE,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          GOTO      LODT5000
.
LODT2000  CLEAR     HTMLLINK
          APPEND    "javascript:RehabDetails('",HTMLLINK
          APPEND    EPSNUMB,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EPSSDATE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EPSEDATE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    EPSCTYPE,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
LODT5000  COMPARE   THREE,PTCNHDPS
          GOTO      LODT7000 IF NOT EQUAL
.
          MATCH     "8",EPSCTYPE     * show phase of care if vic & palliative
          IF        @EQUAL
            MOVE      EPSNUMB,DIM2
            REP       " +",DIM2
            WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                               "#"",EPSNUMB,"#",":
                               "#"",EPSSDATE,"#",":
                               "#"",EPSEDATE,"#",":
                               "#"",EPSCTYPE:
                               "<input type=button value='Phase Of Care'":
                               " class='button' onClick=ShowPhaseDetails('":
                               DIM2:
                               EPSSDATE:
                               EPSEDATE:
                               "');":
                               ">","#")"
          ELSE
LODT7000    WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                               "#"",EPSNUMB,"#",":
                               "#"",EPSSDATE,"#",":
                               "#"",EPSEDATE,"#",":
                               "#"",EPSCTYPE,"#",":
                               "#"",HTMLLNK2,"#")" 
          ENDIF
.
LODT9999  RETURN
+
.------------------------------------------------------------
. Table of QLD Rehab Details
.------------------------------------------------------------
LODQ0000  PACK      KEY12,ADMISSNO,EPISODNO,SP70
          CALL      RSPTQRD1                * Position on & read the rehab file
LODQ1000  CALL      RKPTQRD1
          BRANCH    OVRCD,LODQ9999
.
          MATCH     ADMISSNO,DPTQRADM
          GOTO      LODQ9999 IF NOT EQUAL   * Different admission number, exit
.
          MATCH     EPISODNO,DPTQREPN
          GOTO      LODQ9999 IF NOT EQUAL   * Different episode, exit
.
          CALL      LQDT0000                * Output Table Row
          GOTO      LODQ1000
.
LODQ9999  RETURN
+
.******************************************************************************
.  QLD Rehab Details Table output in in sort table format.
.******************************************************************************
LQDT0000  IF        PTCNHDPS=9
            CLEAR     HTMLLINK
            APPEND    "javascript:RehabDetACT('",HTMLLINK
            APPEND    DPTQREPN,HTMLLINK
            APPEND    "','",HTMLLINK
            APPEND    DPTQRCNT,HTMLLINK
            APPEND    "','",HTMLLINK
            APPEND    EPFRDATE,HTMLLINK
            APPEND    "','",HTMLLINK
            APPEND    EPTODATE,HTMLLINK
            APPEND    "','",HTMLLINK
            APPEND    EPCARETP,HTMLLINK
            APPEND    "')",HTMLLINK
            RESET     HTMLLINK
          ELSE
            CLEAR     HTMLLINK
            APPEND    "javascript:RehabDetQLD('",HTMLLINK
            APPEND    DPTQREPN,HTMLLINK
            APPEND    "','",HTMLLINK
            APPEND    DPTQRCNT,HTMLLINK
            APPEND    "','",HTMLLINK
            APPEND    EPFRDATE,HTMLLINK
            APPEND    "','",HTMLLINK
            APPEND    EPTODATE,HTMLLINK
            APPEND    "','",HTMLLINK
            APPEND    EPCARETP,HTMLLINK
            APPEND    "')",HTMLLINK
            RESET     HTMLLINK
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",DPTQRCNT,"#",":
                             "#"",PTQRBISA,"#",":
                             "#"",PTQRBISD,"#",":
                             "#"",PTQRFIMA,"#",":
                             "#"",PTQRFIMD,"#",":
                             "#"",PTQRDIAG,"#",":
                             "#"",PTQRCLSP,"#",":
                             "#"",PTQRCOM1,"#")"
.
LQDT9999  RETURN
+
.******************************************************************************
.*                                  CNEX0000              Called by: LODB0000 *
.*                  Check Next Care Class For Care Type Change                *
.******************************************************************************
CNEX0000  PACK      SAVKEY24,CHADMN,CHDATE,CHTIME,SP70
.
          MOVE      CHCODE,CARECLSS         * Episode care class
          MOVE      CHDATE,EPSEDATE         * Episode end date
          CALL      GCTY0000                * Get the care type
.
          MOVE      CARETYPE,PREVTYPE
          PACK      KEY24,CHADMN,CHDATE,Z70
          CALL      RDSCHCO1                * Position on & read the care class
          CALL      RDKCHCO1                * file
          BRANCH    OVRCD,CNEX1000
.
          MATCH     ADMISSNO,DCHADMN
          GOTO      CNEX1000 IF NOT EQUAL   * Different admission, exit
.
          MATCH     "CC",CHCATG                   
          GOTO      CNEX1000 IF NOT EQUAL   * Different care class, exit
.
          MOVE      CHCODE,CARECLSS         * Episode care class
          MOVE      CHDATE,EPSEDATE         * Episode end date
          CALL      GCTY0000                * Get the care type
          GOTO      CNEX2000
.
CNEX1000  MOVE      ACARE,CARECLSS          * Load current care class
          MOVE      LASTDATE,EPSEDATE       * Episode end date
          CALL      GCTY0000                * Get the care type
.
CNEX2000  MOVE      ZERO,GETNEXT            * Care type change, display episode
          MATCH     PREVTYPE,CARETYPE
          GOTO      CNEX3000 IF NOT EQUAL   * Care type changed
.
          MOVE      ONE,GETNEXT             * No care type change, get next
.
CNEX3000  MOVE      SAVKEY24,KEY24
          CALL      RDCHCO1                 * Reposition on the care class file
.
          MOVE      CHCODE,CARECLSS         * Episode care class
          MOVE      CHDATE,EPSEDATE         * Episode end date
          CALL      GCTY0000                * Get the care type
.
CNEX9999  RETURN
+
.******************************************************************************
.*                                  GCTY0000              Called by: LODB0000 *
.*                            Get Episode Care Type                & CNEX0000 *
.******************************************************************************
GCTY0000  MOVE      SP4,THCSCOD 
          PACK      KEY5,CARECATG,CARECLSS,SP70
          CALL      RDCODE1                 * Read the codes file
          BRANCH    OVRCD,GCTY9999
.
          UNPACK    THCSCOD,CARETYPE,KEY2                              *C-49016
.
GCTY9999  RETURN
+
.******************************************************************************
.*                                 CKCC0000               Called by: SLEP0000 *
.*                     Check For A Valid Sub Acute Code                       *
.******************************************************************************
CKCC0000  MOVE      ONE,EXIT                * Default not sub acute
.
          COMPARE   FOUR,PTCNHDPS           * use parameter for QLD
          GOTO      CKCC5000 IF NOT EQUAL
.
.    **** post 01/07/2013 ****
.
          MATCH     "20",CARETYPE       * Rehab
          GOTO      CKCC9500 IF EQUAL
.
          MATCH     "30",CARETYPE       * Palliative
          GOTO      CKCC9500 IF EQUAL
.
          MATCH     "09",CARETYPE       * Geriatric Evaluation and Management
          GOTO      CKCC9500 IF EQUAL
.
          MATCH     "10",CARETYPE       * Psychogeriatric
          GOTO      CKCC9500 IF EQUAL
.
          MATCH     "11",CARETYPE       * Maintenance
          GOTO      CKCC9500 IF EQUAL
.
.    **** before 01/07/2013 ****
          MATCH     "21",CARETYPE
          IF        !@EQUAL
            MATCH     "09",CARETYPE
            GOTO      CKCC9999 IF NOT EQUAL * only '09' or '21' are valid QLD
          ENDIF
          GOTO      CKCC9500                * valid sub acute care type for QLD
.
CKCC5000  COMPARE   NINE,PTCNHDPS           * use parameter for ACT
          GOTO      CKCC7000 IF NOT EQUAL
.
          MATCH     "21",CARETYPE
          GOTO      CKCC9500 IF EQUAL       * valid sub acute care type for ACT
.
          MATCH     "22",CARETYPE
          GOTO      CKCC9500 IF EQUAL       * valid sub acute care type for ACT
.
          MATCH     "23",CARETYPE
          GOTO      CKCC9500 IF EQUAL       * valid sub acute care type for ACT
.
          MATCH     "40",CARETYPE
          GOTO      CKCC9500 IF EQUAL       * valid sub acute care type for ACT
.
          GOTO      CKCC9999  
.
CKCC7000  ************ Victorian *****
          UNPACK    CARETYPE,KEY1,DIM1
          REP       "E-F-J-K-P-R-",KEY1     * interim care types
.
          MATCH     "20140701",EPSSDATE
          IF        !@LESS
            REP       "P-M-",KEY1     * interim care types
          ENDIF
.
          MATCH     "-",KEY1
          GOTO      CKCC9500 IF EQUAL
.
          TYPE      KEY1
          GOTO      CKCC9999 IF NOT EQUAL   * Not numeric, get next record
.
          MOVE      KEY1,FORM1
          LOAD      EXIT,FORM1,ONE,ZERO,ONE,ONE,ONE,ZERO,ZERO,ZERO,ZERO
.                              1   2    3   4   5   6    7    8    9
          GOTO      CKCC9999
.
CKCC9500  MOVE      ZERO,EXIT
.
CKCC9999  RETURN
+
.******************************************************************************
.*                                 CPEI0000                                   *
.*                        Check if patpeiaf record required                   *
.******************************************************************************
CPEI0000  READ      CONTROLF,EIGHTY;*250,PTCNHDPS
.
          COMPARE   THREE,ASTAT
          GOTO      CPEI9999 IF NOT EQUAL   * not discharged
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDDSCH1                 * need disch.date
          BRANCH    OVRCD,CPEI9999
.
          MOVE      "13",HDPEQUIV
          CALL      WPEI0000                * Write patpeiaf record
CPEI9999  RETURN
+
.******************************************************************************
.*                                 WPEI0000                                   *
.*                        Write A Record To patpeiaf                          *
.******************************************************************************
WPEI0000  READ      CONTROLF,EIGHTY8;*116,CHCSDTE,*124,CHCSST,*132,CHCSED
.
          COMPARE   THREE,PTCNHDPS
          GOTO      WPEI9999 IF NOT EQUAL   * Not in Victoria
.
          COMPARE   THREE,ASTAT
          GOTO      WPEI9000 IF NOT EQUAL   * Not discharged
.
          MATCH     CHCSDTE,DDATE
          GOTO      WPEI9000 IF LESS        * Discharge date < start HDP date
.
          MATCH     CHCSST,ADATE
          GOTO      WPEI9000 IF NOT LESS    * Adm date >= PRS2 extract start dte
.
          PACK      KEY16,SP8,AADMNO
          CALL      RDPTPEI1                * Read a PRS2 inc/exc file record
          COMPARE   ONE,OVRCD
          GOTO      WPEI9000 IF NOT EQUAL   * Record exists, dont write
.
          PACK      KEY16,CHCSST,AADMNO
          CALL      RDPTPEI1                * Read a PRS2 inc/exc file record
          COMPARE   ONE,OVRCD
          GOTO      WPEI9000 IF NOT EQUAL   * Record exists, dont write
.
          MOVE      SP8,PTPESTDT
          MOVE      AADMNO,PTPEADMN
          MOVE      TWO,PTPESTAT
          CALL      IBACLOCK                * Get the current date
          PACK      PTPEDATE,CURRDATE,SP10
          MOVE      USERID,PTPEOPER
.
          MOVE      SP3,PTPERESN
          PACK      KEY5,ANSR,ANSN,SP3
          CALL      RDSCODE1                * Position on & read a codes file
WPEI1000  CALL      RDKCODE1                  record
          BRANCH    OVRCD,WPEI2000
.
          MATCH     "RN",TCODE
          GOTO      WPEI2000 IF NOT EQUAL   * Different category
.
          MATCH     HDPEQUIV,THCSCOD
          GOTO      WPEI1000 IF NOT EQUAL   * Different HDP equivalent
.
          MOVE      ACODE,PTPERESN
.
WPEI2000  MOVE      PASSCODE,PTPEOPER
          PACK      KEY16,PTPESTDT,PTPEADMN,SP70
          CALL      WRPTPEI1                * Write a PRS2 inc/exc file record
.
WPEI9000  MOVE      ZERO,EXIT
WPEI9999  RETURN
+
.------------------------------------------------------------
.   Clear PMDFED
.------------------------------------------------------------
CLPFED00  MOVE      SP70,PMFDQUOT
          MOVE      SP70,PMFDURNO
          MOVE      ZERO,PMFDNONS
          MOVE      SP70,PMFDADAT
          MOVE      SP70,PMFDHFUN
          MOVE      SP70,PMFDHFTB
          MOVE      SP70,PMFDCMCD
          MOVE      SP70,PMFDCLTY
          MOVE      SP70,PMFDBDTY
          MOVE      SP70,PMFDATYP
          MOVE      ZERO,PMFDAGST
          MOVE      SP70,PMFDBDT2
          MOVE      SP70,PMFDBDT3
          MOVE      SP70,PMFDBDT4
          MOVE      SP70,PMFDBDT5
          MOVE      ZERO,PMFDNDS2
          MOVE      ZERO,PMFDNDS3
          MOVE      ZERO,PMFDNDS4
          MOVE      ZERO,PMFDNDS5
          MOVE      ZERO,PMFDXCSS
          MOVE      SP70,PMFDCMN1
          MOVE      SP70,PMFDCMN2
          MOVE      SP70,PMFDCMN3
          MOVE      SP70,PMFDCMN4
          MOVE      SP70,PMFDCMN5
          MOVE      SP70,PMFDEXPD
          MOVE      SP70,PMFDCDAT
          MOVE      SP70,PMFDCTIM
          MOVE      SP70,PMFDCUID
          MOVE      SP70,PMFDSPAR
CLPFED99  RETURN
+
.------------------------------------------------------------
.   Clear PMDFES
.------------------------------------------------------------
CLPFES00  MOVE      SP70,PMFSQUOT
          MOVE      SP70,DPMFSUNI
          MOVE      SP70,PMFSURNO
          MOVE      ZERO,PMFSRTYP
          MOVE      ZERO,PMFSLUMH
          MOVE      ZERO,PMFSLUMF
          MOVE      ZERO,PMFSDAFR
          MOVE      ZERO,PMFSDAYT
          MOVE      ZERO,PMFSDAYH
          MOVE      ZERO,PMFSDAHF
          MOVE      SP70,PMFSTHIT
          MOVE      ZERO,PMFSTHEH
          MOVE      ZERO,PMFSTHEF
          MOVE      ZERO,PMFSQUAN
          MOVE      SP70,PMFSGSTP
          MOVE      SP70,PMFSGSTC
          MOVE      SP70,PMFSSPAR
CLPFES99  RETURN
+
.******************************************************************************
.*                                  CKCM0000                                  *
.*                          Check If Casemix Patient                          *
.******************************************************************************
CKCM0000  MATCH     SP9,PMFDCMCD
          GOTO      CKCM9000 IF EQUAL       * Non casemix patient
.
          MOVE      ZERO,F1
          PACK      KEY18,PMFDCLTY,PMFDHFUN,PMFDCMCD,SP70
          MOVE      PMFDADAT,CEFFDATE
          CALL      VALCMXFN                * Validate Casemix funding
          BRANCH    EXIT,CKCM9000
.
          MOVE      ONE,CMXFLG              * Casemix
          GOTO      CKCM9999
.
CKCM9000  MOVE      ZERO,CMXFLG             * Casemix flag - not using casemix
CKCM9999  RETURN
+
.------------------------------------------------------------
.   Extra tags     
.------------------------------------------------------------
EXTR0000  BRANCH    FLDITMNO,EXTR0100,EXTR0200,EXTR0300,EXTR0400,EXTR0500:
                             EXTR0600,EXTR0700,EXTR0800,EXTR0900,EXTR1000:
                             EXTR1100,EXTR1200,EXTR1300,EXTR1400,EXTR1500:
                             EXTR1600,EXTR1700,EXTR1800,EXTR1900,EXTR2000:
                             EXTR2100,EXTR2200,EXTR2300,EXTR2400,EXTR2500:
                             EXTR2600,EXTR2700,EXTR2800,EXTR2900,EXTR3000:
                             EXTR3100,EXTR3200
          GOTO      EXTR9999 
.         
EXTR0100  WRITE     HTMLFILE;CMXFLG;
          GOTO      EXTR9999
.
EXTR0200  WRITE     HTMLFILE;PTHSHOSP;
          GOTO      EXTR9999
.
EXTR0300  IF        IBCNMHOS=1
            WRITE     HTMLFILE;PTHSNAME;
          ELSE
            WRITE     HTMLFILE;CNAME;
          ENDIF
          GOTO      EXTR9999
.
EXTR0400  IF        IBCNMHOS=1
            WRITE     HTMLFILE;PTHSADD1;
          ELSE
            WRITE     HTMLFILE;CHADD1;
          ENDIF
          GOTO      EXTR9999
.
EXTR0500  IF        IBCNMHOS=1
            WRITE     HTMLFILE;PTHSADD2;
          ELSE
            WRITE     HTMLFILE;CHADD2;
          ENDIF
          GOTO      EXTR9999
.
EXTR0600  WRITE     HTMLFILE;PTHSADD3;
          GOTO      EXTR9999
.
EXTR0700  WRITE     HTMLFILE;PTHSADD4;
          GOTO      EXTR9999
.
EXTR0800  IF        IBCNMHOS=1
            WRITE     HTMLFILE;PTHSPCOD;
          ELSE
            WRITE     HTMLFILE;CHPOST;
          ENDIF
          GOTO      EXTR9999
.
EXTR0900  IF        IBCNMHOS=1
            WRITE     HTMLFILE;PTHSTELE;
          ELSE
            WRITE     HTMLFILE;CHTELEB;
          ENDIF
          GOTO      EXTR9999
.
EXTR1000  WRITE     HTMLFILE;PTHSFAXN;
          GOTO      EXTR9999
.
EXTR1100  CALL      POCTAB00                * phase of care details list
          GOTO      EXTR9999
.
EXTR1200  MATCH     SP70,PMFOC002         * Episode Number
          GOTO      EXTR9999 IF EQUAL
          WRITE     HTMLFILE;PMFOC002;
          GOTO      EXTR9999
.
EXTR1300  MATCH     SP70,EPISKEYS         * Episode key
          GOTO      EXTR9999 IF EQUAL
          WRITE     HTMLFILE;EPISKEYS;
          GOTO      EXTR9999
.
EXTR1400  COMPARE   ONE,IBCNMHOS
          IF        @EQUAL
            SQUEEZE   WBSEHOSP
            WRITE     HTMLFILE;*+,WBSEHOSP;
            RESET     WBSEHOSP
          ELSE
            PACK      KEY3,SP70
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            IF        OVRCD<>1
              SQUEEZE   PTHSHOSP
              WRITE     HTMLFILE;*+,PTHSHOSP;
              RESET     PTHSHOSP
            ENDIF
          ENDIF
.
          GOTO      EXTR9999
.
EXTR1500  CALL      UOET0000
          GOTO      EXTR9999
.
EXTR1600  WRITE     HTMLFILE;PMHECTID;
          GOTO      EXTR9999
.
EXTR1700  CALL      CSMF0000           * Check Casemix and Casemix code fields
          WRITE     HTMLFILE;KEY9;
          GOTO      EXTR9999
.
EXTR1800  CALL      CONC0000           * check for concession card details
          GOTO      EXTR9999
.
EXTR1900  MOVE      "BP",CATEGORY         * Preferred Accommodation
          PACK      CODE,PMVXPACC,SP70
          CALL      CODITM00
          GOTO      EXTR9999
.
EXTR2000  CALL      LOEC0000
          GOTO      EXTR9999
.
EXTR2100  CALL      NEX10000
          GOTO      EXTR9999
.
EXTR2200  CALL      PRE10000
          GOTO      EXTR9999
.
EXTR2300  CALL      EOEC0000
          GOTO      EXTR9999
.
EXTR2400  CALL      IOEC0000
          GOTO      EXTR9999
.
EXTR2500  WRITE     HTMLFILE;UPDATEST;
          GOTO      EXTR9999
.
EXTR2600  MOVE      ONE,FORM1            * Pharmacy
          CALL      GPIT0000
          GOTO      EXTR9999
.
EXTR2700  MOVE      TWO,FORM1            * Prosthetic
          CALL      GPIT0000
          GOTO      EXTR9999
.
EXTR2800  MOVE      THREE,FORM1          * Consumables
          CALL      GPIT0000
          GOTO      EXTR9999
.
EXTR2900  WRITE     HTMLFILE;OLDOECIN;
          GOTO      EXTR9999
.
EXTR3000  CALL      UORT0000
          GOTO      EXTR9999
.
EXTR3100  READ      CONTROLF,HUND19;*182,PTCNEPIS
          MATCH     "1",PTCNEPIS    * using EpiSoft interface
          GOTO      EXTR9999 IF NOT EQUAL
.
          MATCH     SP70,ADMISSNO
          GOTO      EXTR9999 IF EQUAL
.
          OPEN      PMSEHBA5,"pmsehbaf"
.
          PACK      KEY28,ADMISSNO,SP70
          CALL      RSPMEHB5
EXTR3110  CALL      RKPMEHB5
          BRANCH    OVRCD,EXTR3190
.
          MATCH     ADMISSNO,PMHBVISN
          GOTO      EXTR3190 IF NOT EQUAL
.
          MATCH     "2",PMHBSTAT            * Processed
          GOTO      EXTR3110 IF NOT EQUAL
.
          WRITE     HTMLFILE;PMHBUNIQ;
          GOTO      EXTR3190
.
EXTR3190  CLOSE     PMSEHBA5
          GOTO      EXTR9999
.
EXTR3200  CALL      MSECLOCK
          WRITE     HTMLFILE;KEY12;
          GOTO      EXTR9999
.
EXTR9999  RETURN
+
.------------------------------------------------------------
MSECLOCK  CLOCK     FULLTIME,KEY12     * TurboGrouper file time  hhmmssuu
          SQUEEZE   KEY12
          RETURN
.------------------------------------------------------------
.         Get Prosthetic and Pharmacy from Fees Estimate SJOG
.------------------------------------------------------------
GPIT0000  MOVE      ZERO,PMFSTHEH
          MOVE      SP70,PMFSTHIT
.
          MATCH     "2",PTCNIFCL
          GOTO      GPIT9999 IF NOT EQUAL
.
          MOVE      ZERO,F1
          UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
.
          PACK      KEY20,ADMISSNO,SP70
          CALL      RSPMAEL1
          CALL      RKPMAEL1
          IF        OVRCD=1
            CALL      CLRAEL00
            GOTO      GPIT9000
          ENDIF
.
          MATCH     ADMISSNO,PMAEVISN
          IF        !@EQUAL 
            CALL      CLRAEL00
            GOTO      GPIT9000
          ENDIF
.
          MATCH     SP70,PMAEQUOT
          GOTO      GPIT9000 IF EQUAL     * No Fees Estimate
.
          MOVE      "8",KEY1
          PACK      KEY18,PMAEQUOT,KEY1,SP70
          CALL      RSPMFES2
GPIT1000  CALL      RKPMFES2
          BRANCH    OVRCD,GPIT9000
.
          MATCH     PMAEQUOT,PMFSQUOT       * Check quote number
          GOTO      GPIT9000 IF NOT EQUAL
          MATCH     KEY1,PMFSRECT           * Check record type
          GOTO      GPIT9000 IF NOT EQUAL
.
          IF        FORM1=1
            MATCH     "Pharmacy",PMFSTHIT
            GOTO      GPIT2000 IF EQUAL
          ELSE
            IF        FORM1=3
              MATCH     "Consumab",PMFSTHIT
              GOTO      GPIT2000 IF EQUAL
            ELSE
              MATCH     "Prosthet",PMFSTHIT
              GOTO      GPIT2000 IF EQUAL
            ENDIF
          ENDIF
          GOTO      GPIT1000
.
GPIT2000  BRANCH    F1,GPIT6000        * Item amount
.
          IF        FORM1=2
            WRITE     HTMLFILE;"Prosthetic";
          ELSE
            IF        FORM1=3
              WRITE     HTMLFILE;"Consumables";
            ELSE
              WRITE     HTMLFILE;PMFSTHIT;
            ENDIF
          ENDIF
          GOTO      GPIT9999
.
GPIT6000  WRITE     HTMLFILE;PMFSTHEH;
          GOTO      GPIT9999
.
GPIT9000  WRITE     HTMLFILE;SP70;
GPIT9999  RETURN
+
.------------------------------------------------------------
.         Check Casemix fields
.------------------------------------------------------------
CSMF0000  MOVE      SP70,KEY9
.
          MATCH     "2",PTCNIFCL
          IF        @EQUAL
            PACK      KEY9,PTELCMXC,SP70
            MATCH     SP70,KEY9
            GOTO      CSMF9999 IF NOT EQUAL
          ENDIF
.
          MATCH     "Y",PTMICMXP       * Casepayement?
          IF        @EQUAL
            MATCH     SP70,PTMIPCMX    * Provisional Casemix code
            IF        !@EQUAL
              MOVE      PTMIPCMX,KEY9 * use Casemix code
              GOTO      CSMF9999
            ENDIF
          ENDIF
.
          MATCH     "2",PTCNIFCL
          IF        @EQUAL
            CALL      GITM0000             * items from Booking or Keyin Item
          ENDIF
.
.davvy    MATCH     SP70,AMBS
.davvy    IF        !@EQUAL
.davvy      MOVE      AMBS,KEY9     * use MBS item
.davvy    ELSE
            PACK      KEY9,ATYPE,SP70 * Use Admission type      * CAR 314005
.davvy    ENDIF
.
CSMF9999  RETURN
+
.------------------------------------------------------------
.   Get suggested Class. of Item from Booking or Keyin items
.------------------------------------------------------------
GITM0000  MOVE      SP70,KEY9
          COMPARE   ZERO,ASTAY
          GOTO      GITM9000 IF EQUAL       * Daycase - No Suggested Class.
.
          IF        MBSINDEX<>0
            PACK      KEY9,OMBSCODE[1],SP70  * use theatre fee from booking
          ENDIF
.
.         MATCH     SP70,KEY9
.         IF        @EQUAL
.           PACK      KEY9,THEFEE[1],SP70  * First keyin Theatre fee
.         ENDIF
.
          MATCH     SP70,KEY9
          IF        @EQUAL
            CALL      DATY0000                * Get default Adm.type
            COMPARE   ZERO,EXIT
            GOTO      GITM9999 IF EQUAL
.
            PACK      KEY9,AMBS,SP70          * use Adm.MBS
            MATCH     SP70,KEY9
            GOTO      GITM9999 IF EQUAL
          ENDIF
.
          PACK      KEY17,KEY9,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,GITM9000
.
          MATCH     SP70,ICLSS
          GOTO      GITM7000 IF EQUAL      * no suggested classification
.
          MOVE      ICLSS,ATYPE            * Overnight Suggested Class.
          GOTO      GITM9999

GITM7000  COMPARE   ONE,PTSGCOPT            * Using suggested class.?
          GOTO      GITM9000 IF NOT EQUAL
.
          OPEN      PATSGCA1,"patsgcaf"
          PACK      KEY18,PMFDCLTY,PMFDHFUN,KEY9,SP20
          CALL      RDPTSGC1                * Get suggested adm. type
          COMPARE   ZERO,OVRCD
          GOTO      GITM7200 IF EQUAL
.
          MATCH     SP70,PMFDHFUN
          GOTO      GITM9000 IF EQUAL
.
          MOVE      SP70,PTSGCLMN           * blank claim
          PACK      KEY18,PTSGCLMN,PMFDHFUN,KEY9,SP20
          CALL      RDPTSGC1                * Get suggested adm. type
          COMPARE   ZERO,OVRCD
          GOTO      GITM7200 IF EQUAL
.
          MOVE      SP70,PTSGFUND           * blank health fund
          PACK      KEY18,PMFDCLTY,PTSGFUND,KEY9,SP20
          CALL      RDPTSGC1                * Get suggested adm. 
          BRANCH    OVRCD,GITM9000
.
GITM7200  MATCH     SP70,PTSGCLSS
          IF        !@EQUAL
            MOVE      PTSGCLSS,ATYPE
            GOTO      GITM9999
          ENDIF
.
GITM9000  CALL      DATY0000                * Get default Adm.type
.
          COMPARE   ZERO,ASTAY
          GOTO      GITM9999 IF EQUAL       * Daycase - no suggested class.
.
.         NO defualt found, check Pre-adm. MBS
.
          IF        EXIT=1
            PACK      KEY9,AMBS,SP70          * use Adm.MBS
            MATCH     SP70,KEY9
            IF        !@EQUAL
              PACK      KEY17,KEY9,SP70
              CALL      PATITMRD
              IF        OVRCD=0
                MOVE      ICLSS,ATYPE         * Suggested Class.
              ENDIF
            ENDIF
          ENDIF
           
GITM9999  RETURN
+
.------------------------------------------------------------
.   Eclipse Eligibility Descriptions
.------------------------------------------------------------
ECDSC000  PACK      KEY29,PMHEARID,PMHERPTC,ELIGTYPE,SP70
          CALL      RDPMERC1
ECDSC100  CALL      RKPMERC1
          BRANCH    OVRCD,ECDSC999
.
          MATCH     PMHEARID,PMRCARID
          GOTO      ECDSC999 IF NOT EQUAL
.
          MATCH     PMHERPTC,PMRCRPTC
          GOTO      ECDSC999 IF NOT EQUAL
.
          MATCH     ELIGTYPE,PMRCTYPE
          GOTO      ECDSC999 IF NOT EQUAL
.
          WRITE     HTMLFILE;PMRCDATA,SP1;
.
          GOTO      ECDSC100
.
ECDSC999  RETURN
.------------------------------------------------------------
.   Service assessment tags (pmssesaf pmssedaf)
.------------------------------------------------------------
SRVASS00  UNPACK    DIM127,D1,KEY3,DIM127
          UNPACK    DIM127,D1,KEY3A,DIM127
          UNPACK    DIM127,D1,KEY3B,DIM127
          UNPACK    DIM127,D1,KEY3C,DIM127
.
          PACK      KEY37,PMHEARID,PMHERPTC,SP70
          CALL      RSPMSES1
SRVASS05  CALL      RKPMSES1
          BRANCH    OVRCD,SRVASS99
.
          MATCH     PMHEARID,PMESARID
          GOTO      SRVASS99 IF NOT EQUAL
.
          MATCH     PMHERPTC,PMESRPTC
          GOTO      SRVASS99 IF NOT EQUAL
.
          MATCH     KEY3,PMESSRVC
          GOTO      SRVASS05 IF NOT EQUAL
.
          SQUEEZE   KEY3A
          MOVE      KEY3A,FORM3
.
          BRANCH    FORM3,SRVASS10,SRVASS20,SRVASS30,SRVASS40,SRVASS50:
                          SRVASS60
.
          GOTO      SRVASS99
.
SRVASS10  MATCH     SP70,PMESSDTE
          GOTO      SRVASS99 IF EQUAL
          UNPACK    PMESSDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      SRVASS99
.
SRVASS20  WRITE     HTMLFILE;PMESSCOD;
          GOTO      SRVASS99
.
SRVASS30  PACK      KEY44,PMESARID,PMESRPTC,PMESSCOD,PMESSRVC,SP70
          CALL      RSPMSED1
SRVASS31  CALL      RKPMSED1
          BRANCH    OVRCD,SRVASS99
.
          MATCH     PMESARID,PMSEARID
          GOTO      SRVASS99 IF NOT EQUAL
.
          MATCH     PMESRPTC,PMSERPTC
          GOTO      SRVASS99 IF NOT EQUAL
.
          MATCH     PMESSCOD,PMSESCOD
          GOTO      SRVASS99 IF NOT EQUAL
.
          MATCH     PMESSRVC,PMSESRVC
          GOTO      SRVASS99 IF NOT EQUAL
.
          MATCH     KEY3B,PMSESEXC
          GOTO      SRVASS31 IF NOT EQUAL
.
          WRITE     HTMLFILE;PMSESFET;
          GOTO      SRVASS99
.
SRVASS40  RJUSTIFY  PMESFBAM
          UNPACK    PMESFBAM,DIM7,DIM2
          WRITE     HTMLFILE;DIM7,DOT,DIM2;
          GOTO      SRVASS99
.
SRVASS50  WRITE     HTMLFILE;PMESSFAC;
          GOTO      SRVASS99
.
SRVASS60  MOVE      PMESARID,KEY8
          RJUSTIFY  KEY8
          PACK      KEY14,KEY8,PMESRPTC,KEY3C,SP70
          CALL      RDPMOES1
          BRANCH    OVRCD,SRVASS99
.
          WRITE     HTMLFILE;PMOSQUAN;
.
          GOTO      SRVASS99
.
SRVASS99  RETURN
.------------------------------------------------------------
.   Clear pmseehaf                               
.------------------------------------------------------------
CLPMEH00  PACK      PMHEARID,SP70
          PACK      PMHERPTC,SP70
          PACK      PMHECTID,SP70
          PACK      PMHEBENL,SP70
          PACK      PMHECFAC,SP70
          PACK      PMHECPAM,SP70
          PACK      PMHECPDR,SP70
          PACK      PMHECPDI,SP70
          PACK      PMHECPFN,SP70
          PACK      PMHECPMN,SP70
          PACK      PMHECPRN,SP70
          PACK      PMHEEXAM,SP70
          PACK      PMHEEADI,SP70
          PACK      PMHEEXBA,SP70
          PACK      PMHEEXDI,SP70
          PACK      PMHEFSTA,SP70
          PACK      PMHEFRID,SP70
          PACK      PMHEFSCD,SP70
          PACK      PMHEMSCD,SP70
          PACK      PMHEPEAI,SP70
          PACK      PMHEPSCD,SP70
          PACK      PMHETNAM,SP70
          PACK      PMHETBDI,SP70
          PACK      PMHETBSC,SP70
          PACK      PMHEVCID,SP70
          PACK      PMHEUDTE,SP70
          PACK      PMHEUTIM,SP70
          PACK      PMHESPAR,SP70
.
CLPMEH99  RETURN
.
.------------------------------------------------------------
.   OEC Response Table                            
.------------------------------------------------------------
OECT0000  MATCH     "1",OLDOECIN
          GOTO      OECT0500 IF EQUAL
.
          MATCH     "1",PTCNOECE
          GOTO      OECT5000 IF EQUAL
.
OECT0500  MOVE      ADMISSNO,KEY20
          LJUSTIFY  KEY20
          PACK      KEY20,KEY20,SP70
          PACK      KEY23,KEY20,SP70
          CALL      RSPMEEH1
OECT1000  CALL      RKPMEEH1
          BRANCH    OVRCD,OECT5000
.
          MATCH     KEY20,PMHEARID
          GOTO      OECT5000 IF NOT EQUAL
.
          CALL      OECR0000
.
          GOTO      OECT1000
.
OECT5000  MATCH     "1",OLDOECIN
          GOTO      OECT9999 IF EQUAL
.
          MATCH     "1",PTCNWSIN
          GOTO      OECT9999 IF NOT EQUAL
.
          MATCH     "1",PTCNOECE
          GOTO      OECT9999 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      OECT9999 IF NOT EQUAL
.
          MOVE      ADMISSNO,KEY20
          LJUSTIFY  KEY20
          PACK      KEY20,KEY20,SP70
          PACK      KEY23,KEY20,SP70
          CALL      RSWBEEH1
OECT6000  CALL      RKWBEEH1
          BRANCH    OVRCD,OECT9999
.
          MATCH     KEY20,WBEHARID
          GOTO      OECT9999 IF NOT EQUAL
.
          CALL      OEWR0000
.
          GOTO      OECT6000
.
OECT9999  RETURN
.
.------------------------------------------------------------
.   OEC Response Table Row
.------------------------------------------------------------
OECR0000  MOVE      "No ",KEY3A
          MATCH     "1",PMHEBENL
          IF        @EQUAL
            MOVE      "Yes",KEY3A 
          ENDIF
.
          MOVE      "No ",KEY3B
          MATCH     "1",PMHECPDI
          IF        @EQUAL
            MOVE      "Yes",KEY3B
          ENDIF
.
          MOVE      "No ",KEY3C
          MATCH     "1",PMHEEADI
          IF        @EQUAL
            MOVE      "Yes",KEY3C
          ENDIF
.
          MOVE      "No ",KEY3D
          MATCH     "1",PMHEEXDI
          IF        @EQUAL
            MOVE      "Yes",KEY3D
          ENDIF
.
          MOVE      "No ",KEY3E
          MATCH     "1",PMHETBDI
          IF        @EQUAL
            MOVE      "Yes",KEY3E
          ENDIF    
.
          MOVE      SP70,KEY10
          MATCH     "A",PMHECFAC
          IF        @EQUAL
            MOVE      "ACCEPTED  ",KEY10
          ENDIF
          MATCH     "R",PMHECFAC
          IF        @EQUAL
            MOVE      "REJECTED  ",KEY10
          ENDIF
          MATCH     "W",PMHECFAC
          IF        @EQUAL
            MOVE      "WARNING   ",KEY10
          ENDIF
          MATCH     "C",PMHECFAC
          IF        @EQUAL
            MOVE      "COMPLETED ",KEY10
          ENDIF
          MATCH     "I",PMHECFAC
          IF        @EQUAL
            MOVE      "INTERIM   ",KEY10
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:AssignPatientLinks('",HTMLLINK
          APPEND    URNUMBER,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ADMISSNO,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PMHERPTC,HTMLLINK
          APPEND    "');",HTMLLINK
          APPEND    "PatientLinkTo('patweb78.pbl',6,3,1,900,900);",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:AssignPatientLinks('",HTMLLNK2
          APPEND    URNUMBER,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    ADMISSNO,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    PMHERPTC,HTMLLNK2
          APPEND    "');",HTMLLNK2
          APPEND    "PatientLinkTo('patweb78.pbl',6,4,1,900,425);",HTMLLNK2
          RESET     HTMLLNK2
.
          WRITE     HTMLFILE;"t.addRow(#"",PMHECTID,"#",":
                             "#"",KEY3A,"#",":
                             "#"",KEY10,"#",":
                             "#"",KEY3B,"#",":
                             "#"",KEY3C,"#",":
                             "#"",KEY3D,"#",":
                             "#"",PMHEPSCD,"#",":
                             "#"",KEY3E,"#",":
                             "#"",HTMLLINK,"#",":
                             "#"",HTMLLNK2,"#",":
                             "#"",PMHEUDTE,PMHEUTIM,"#")"
.
OECR9999  RETURN
.
.------------------------------------------------------------
.   OEC Request Table
.------------------------------------------------------------
OECTR000  MATCH     "1",PTCNOECE
          GOTO      OECTR500 IF EQUAL
.
          PACK      KEY11,ADMISSNO,SP70
          CALL      RSPMOEC1
OECTR100  CALL      RKPMOEC1
          BRANCH    OVRCD,OECTR500
.
          MATCH     ADMISSNO,PMOEVISN
          GOTO      OECTR500 IF NOT EQUAL
.
          PACK      KEY23,PMOEARID,PMOECNTR,SP70
          CALL      RDPMEEH1
          IF        OVRCD=1
            CALL      CLPMSEEH
          ENDIF 
.
          MOVE      SP70,DIM50
          MATCH     SP70,PMOEELEG
          IF        !@EQUAL
            PACK      KEY8,PMOEELEG,SP70
            CALL      RDPMELF1
            IF        OVRCD=0
              CALL      ILLN0000         * Presenting illness
            ENDIF
          ENDIF
.
          CALL      OECRR000
.
          GOTO      OECTR100
.
OECTR500  MATCH     "1",PTCNWSIN
          GOTO      OECTR999 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      OECTR999 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      OECTR999 IF NOT EQUAL
.
          PACK      KEY11,ADMISSNO,SP70
          CALL      RSWBOEC1
OECTR600  CALL      RKWBOEC1
          BRANCH    OVRCD,OECTR999
.
          MATCH     ADMISSNO,WBOCVISN
          GOTO      OECTR999 IF NOT EQUAL
.
          PACK      KEY23,WBOCARID,WBOCCNTR,SP70
          CALL      RDWBEEH1
          IF        OVRCD=1
            CALL      CLWEBEEH
          ENDIF
.
          MOVE      SP70,DIM50
          MATCH     SP70,WBOCELEG
          IF        !@EQUAL
            PACK      KEY8,WBOCELEG,SP70
            CALL      RDWBELF1
            IF        OVRCD=0
              CALL      ILLW0000         * Presenting illness
            ENDIF
          ENDIF
.
          CALL      OECWR000
.
          GOTO      OECTR600
.
OECTR999  RETURN
.
.------------------------------------------------------------
.   Presenting Illness Code/MBS
.------------------------------------------------------------
ILLN0000  MATCH     SP70,PMEFPRIM
          GOTO      ILLN2000 IF EQUAL
.
          CLEAR     DIM50
          APPEND    PMEFPRIM,DIM50
.
          PACK      KEY9,PMEFPRIM,SP70
          PACK      KEY17,KEY9,SP70
          CALL      PATITMRD
          IF        OVRCD=0
            APPEND    "/",DIM50
            APPEND    IDESC,DIM50
          ENDIF
          APPEND    SP70,DIM50
          RESET     DIM50
          GOTO      ILLN9999
.
ILLN2000  PACK      DIM50,PMEFPRIC,SP70
          MATCH     SP70,PMEFPRIC
          IF        !@EQUAL
            PACK      KEY5,CATil,PMEFPRIC,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              PACK      DIM50,TDESC,SP70
            ENDIF
          ENDIF
.
ILLN9999  RETURN
+
.------------------------------------------------------------
.   OEC Request Table Row
.------------------------------------------------------------
OECRR000  MOVE      SP70,KEY10
          MATCH     "A",PMHECFAC
          IF        @EQUAL
            MOVE      "ACCEPTED  ",KEY10
          ENDIF
          MATCH     "R",PMHECFAC
          IF        @EQUAL
            MOVE      "REJECTED  ",KEY10
          ENDIF
          MATCH     "W",PMHECFAC
          IF        @EQUAL
            MOVE      "WARNING   ",KEY10
          ENDIF
          MATCH     "C",PMHECFAC
          IF        @EQUAL
            MOVE      "COMPLETED ",KEY10
          ENDIF
          MATCH     "I",PMHECFAC
          IF        @EQUAL
            MOVE      "INTERIM   ",KEY10
          ENDIF
.
          MOVE      SP70,KEY20
          MATCH     " 0",PMOESTAT
          IF        @EQUAL
            MOVE      "WAITING",KEY20
          ENDIF
.
          MATCH     " 1",PMOESTAT
          IF        @EQUAL
            MOVE      "EXTRACTED",KEY20
          ENDIF
.
          MATCH     " 2",PMOESTAT
          IF        @EQUAL
            MOVE      "RECEIVED",KEY20
          ENDIF
.
          MATCH     " 3",PMOESTAT
          IF        @EQUAL
            MOVE      "SA&nbsp;ERROR",KEY20
          ENDIF
.
          MATCH     " 4",PMOESTAT
          IF        @EQUAL
            MOVE      "DATA&nbsp;ERROR",KEY20
          ENDIF
.
          MATCH     " 6",PMOESTAT
          IF        @EQUAL
            MOVE      "COMP&nbsp;REPORTED",KEY20
          ENDIF
.
          MATCH     " 5",PMOESTAT
          IF        @EQUAL
            MOVE      "REJ&nbsp;REPORTED",KEY20
          ENDIF
.
          MATCH     " 7",PMOESTAT
          IF        @EQUAL
            MOVE      "HF&nbsp;UNAVAILABLE",KEY20
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:AssignPatientLinks('",HTMLLINK
          APPEND    URNUMBER,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ADMISSNO,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PMOECNTR,HTMLLINK
          APPEND    "');",HTMLLINK
          APPEND    "PatientLinkTo('patweb78.pbl',6,3,1,900,550);",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:AssignPatientLinks('",HTMLLNK2
          APPEND    URNUMBER,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    ADMISSNO,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    PMOECNTR,HTMLLNK2
          APPEND    "');",HTMLLNK2
          APPEND    "PatientLinkTo('patweb78.pbl',6,4,1,900,425);",HTMLLNK2
          RESET     HTMLLNK2
.
          WRITE     HTMLFILE;"t.addRow(#"",PMOETRID,"#",":
                             "#"",PMOECDTE,PMOECTIM,"#",":
                             "#"",KEY10,"#",":
                             "#"",PMOEERRC,"&nbsp;&nbsp;&nbsp;",PMOEERRD,"#",":
                             "#"",PMOEERRD,"#",":
                             "#"",PMHEPSCD,"#",":
                             "#"",HTMLLINK,"#",":
                             "#"",HTMLLNK2,"#",":
                             "#"",PMHEUDTE,PMHEUTIM,"#",":
                             "#"",KEY20,"#",":
                             "#"",DIM50,"#")"
.
OECRR999  RETURN
.
.------------------------------------------------------------
.   Eclipse Claim Detail Codes and Descriptions
.------------------------------------------------------------
PMSEED00  PACK      KEY30,PMHEARID,PMHERPTC,SP70
          CALL      RSPMEED1
PMSEED10  CALL      RKPMEED1
          BRANCH    OVRCD,PMSEED99
.
          MATCH     PMHEARID,PMDEARID
          GOTO      PMSEED99 IF NOT EQUAL
.
          MATCH     PMHERPTC,PMDERPTC
          GOTO      PMSEED99 IF NOT EQUAL
.
          WRITE     HTMLFILE;PMDECFEC," - ",PMDECFET;
.
          GOTO      PMSEED10
.
PMSEED99  RETURN
+
.------------------------------------------------------------
.   QLD MH Details : Display,Add,Update,Delete
.------------------------------------------------------------
PTQMH000  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PTQMH050 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Add/Update formaction
          GOTO      PTQMH010 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PTQMH030 IF EQUAL
.
          GOTO      PTQMH990
.
.         ************ ADD/UPDATE FORMACTION **********
.
PTQMH010  PACK      KEY8,ADMISSNO,SP70   * Read Admission File
          CALL      RDMISS1
          BRANCH    OVRCD,PTQMH992
.
          PACK      KEY8,ADMISSNO,SP70   * Read Discharge File
          CALL      RDDSCH1
          IF        OVRCD=1
            CALL      CLPATDSC
          ENDIF
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTQMH1
          IF        OVRCD=1
            CALL      CLRPTQMH
          ENDIF
.
          PACK      KEY6,ADOCTA,SP6
          CALL      RDDOCT1                 * Read the doctors file
          BRANCH    OVRCD,PTQMH993
          MATCH     SP3,DRTYPE
          GOTO      PTQMH993 IF EQUAL
.
          PACK      KEY5,ANSD,ANST,DRTYPE,SP70
          CALL      RDCODE1             * Read the codes file
          BRANCH    OVRCD,PTQMH993
.
          MATCH     PYAA,THCSCOD
          GOTO      PTQMH993 IF LESS        * < PYAA
.
          MATCH     THCSCOD,PYZZ
          GOTO      PTQMH993 IF LESS        * PYZZ <
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTQMH1        * Read the rehab details file
          BRANCH    OVRCD,PTQMH020
.
          CALL      MVPTQM00        * Update the qld MH details file
          CALL      UPPTQMH1
.
          MOVE      ZERO,EXIT
          GOTO      PTQMH999
.
PTQMH020  CALL      MVPTQM00        * Sav Vars before write
          PACK      KEY7,PTQMTOUA,PTQMEMPS,PTQMPSNS,PTQMPRMS:
                         PTQMRTFC,PTQMMLSI,PTQMPSNT,SP70
          MATCH     SP70,KEY7
          IF        !@EQUAL
            PACK      KEY8,ADMISSNO,SP70
            CALL      RAPTQMH1
            IF        OVRCD=1
              CALL      WRPTQMH1      * Write to the qld MH Details File
            ENDIF
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PTQMH999
.
PTQMH030  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTQMH1        * Read the qld mh details file
          IF        OVRCD<>1
            CALL      DEPTQMH1        * Delete the qld mh details file record
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PTQMH999
.
.         ************ DISPLAY FORMACTION **********
.
PTQMH050  PACK      KEY8,URNUMBER,SP70   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,PTQMH991
          CALL      RDPMPX21
.
          PACK      KEY8,ADMISSNO,SP70   * Read Admission File
          CALL      RDMISS1
          BRANCH    OVRCD,PTQMH992

.0880816  IF        ASTAT=1 | ASTAT=5
.0880816    GOTO      PTQMH993              * Ignore pre-admitted or cancelled
.0880816  ENDIF                             * patients
.
          IF        ASTAT=5
            GOTO      PTQMH993              * Ignore cancelled patients
          ENDIF
.
          PACK      KEY6,ADOCTA,SP6
          CALL      RDDOCT1                 * Read the doctors file
          BRANCH    OVRCD,PTQMH993
          MATCH     SP3,DRTYPE
          GOTO      PTQMH993 IF EQUAL
.
          PACK      KEY5,ANSD,ANST,DRTYPE,SP70
          CALL      RDCODE1             * Read the codes file
          BRANCH    OVRCD,PTQMH993
.
          MATCH     PYAA,THCSCOD
          GOTO      PTQMH993 IF LESS        * < PYAA
.
          MATCH     THCSCOD,PYZZ
          GOTO      PTQMH993 IF LESS        * PYZZ <
.
          PACK      KEY8,ADMISSNO,SP70   * Read Discharge File
          CALL      RDDSCH1
          IF        OVRCD=1
            CALL      CLPATDSC
          ENDIF
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTQMH1
          IF        OVRCD=1
            CALL      CLRPTQMH
          ENDIF
.
          MATCH     "003",TEMPLATE
          GOTO      PTQMH051 IF NOT EQUAL
.
          CALL      PATNAM00
          CLEAR     WEBTITLE
          APPEND    "Visit List Link to Prev.Detail - ",WEBTITLE
          APPEND    PATFNAME,WEBTITLE
          APPEND    SP70,WEBTITLE
          RESET     WEBTITLE
          GOTO      PTQMH058
.
PTQMH051  CLEAR     WEBTITLE
          MOVE      "QLD MH Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
PTQMH058  CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PTQMH999
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PTQMH999
.
PTQMH990  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PTQMH999
.
PTQMH991  MOVE      "Can't find patient Master Details. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PTQMH999
.
PTQMH992  MOVE      "Can't find patient Admission Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PTQMH999
.
PTQMH993  CLEAR     WEBTITLE
          MOVE      "Invalid Doctor Type for Mental Health Details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PTQMH999
.
PTQMH999  RETURN
+
.------------------------------------------------------------------------
.         PEA - Yes/No/Query option
.------------------------------------------------------------------------
SPEA0000  MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ZERO,">":
                               "No</option>":
                               "<option value=",ONE," selected>":
                               "Yes</option>":
                               "<option value=",TWO,">":
                               "Query</option>"
          ELSE
            MATCH     "2",KEY1
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",ZERO,">":
                                 "No</option>":
                                 "<option value=",ONE,">":
                                 "Yes</option>":
                                 "<option value=",TWO," selected>":
                                 "Query</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",ZERO," selected>":
                                 "No</option>":
                                 "<option value=",ONE,">":
                                 "Yes</option>":
                                 "<option value=",TWO,">":
                                 "Query</option>"
            ENDIF
          ENDIF
SPEA9999  RETURN
.
.------------------------------------------------------------------------------
.        Set Parameters for Free Format OEC fields
.------------------------------------------------------------------------------
STELF000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STELF001,STELF002,STELF003,STELF004,STELF005,STELF006:
                       STELF007,STELF008,STELF009,STELF010,STELF011,STELF012:
                       STELF013,STELF014,STELF015,STELF016,STELF017,STELF018:
                       STELF019,STELF020,STELF021,STELF022,STELF023,STELF024:
                       STELF025,STELF026,STELF027,STELF028,STELF029,STELF030:
                       STELF031,STELF032,STELF033,STELF034,STELF035,STELF036:
                       STELF037
          GOTO      STELF999
.
STELF001  MOVE      QRYDATA,PTELF001
          GOTO      STELF999
.
STELF002  MOVE      QRYDATA,PTELF002
          GOTO      STELF999
.
STELF003  MOVE      QRYDATA,PTELF003
          GOTO      STELF999
.
STELF004  MOVE      QRYDATA,PTELF004
          GOTO      STELF999
.
STELF005  MOVE      QRYDATA,PTELF005
          GOTO      STELF999
.
STELF006  MOVE      QRYDATA,PTELF006
          GOTO      STELF999
.
STELF007  MOVE      QRYDATA,PTELF007
          GOTO      STELF999
.
STELF008  MOVE      QRYDATA,PTELF008
          GOTO      STELF999
.
STELF009  RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      STELF999 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PTELF009,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PTELF009
          GOTO      STELF999
.
STELF010  RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      STELF999 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PTELF010,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PTELF010
          GOTO      STELF999
.
STELF011  MOVE      QRYDATA,PTELF011
          GOTO      STELF999
.
STELF012  MOVE      QRYDATA,PTELF012
          PACK      PTELF012,PTELF012,SP70
          SQUEEZE   PTELF012
          MOVE      ZERO,FORM3
          MOVE      PTELF012,FORM3
          MOVE      FORM3,PTELF012
          GOTO      STELF999
.
STELF013  MOVE      QRYDATA,PTELF013
          GOTO      STELF999
.
STELF014  MOVE      QRYDATA,PTELF014
          GOTO      STELF999
.
STELF015  MOVE      QRYDATA,PTELF015
          GOTO      STELF999
.
STELF016  MOVE      QRYDATA,PTELF016
          GOTO      STELF999
.
STELF017  MOVE      QRYDATA,PTELF017
          GOTO      STELF999
.
STELF018  MOVE      QRYDATA,PTELF018
          GOTO      STELF999
.
STELF019  MOVE      QRYDATA,PTELF019
          GOTO      STELF999
.
STELF020  MOVE      QRYDATA,PTELF020
          GOTO      STELF999
.
STELF021  MOVE      QRYDATA,PTELF021
          GOTO      STELF999
.
STELF022  MOVE      QRYDATA,PTELF022
          GOTO      STELF999
.
STELF023  MOVE      QRYDATA,PTELF023
          GOTO      STELF999
.
STELF024  MOVE      QRYDATA,PTELF024
          GOTO      STELF999
.
STELF025  MOVE      QRYDATA,PTELF025
          GOTO      STELF999
.
STELF026  MOVE      QRYDATA,PTELF026
          GOTO      STELF999
.
STELF027  MOVE      QRYDATA,PTELF027
          GOTO      STELF999
.
STELF028  MOVE      QRYDATA,PTELF028
          PACK      PTELF028,PTELF028,SP70
          RJUSTIFY  PTELF028
          GOTO      STELF999
.
STELF029  MOVE      QRYDATA,PTELF029
          PACK      PTELF029,PTELF029,SP70
          RJUSTIFY  PTELF029
          GOTO      STELF999
.
STELF030  MOVE      QRYDATA,PTELF030
          PACK      PTELF030,PTELF030,SP70
          RJUSTIFY  PTELF030
          GOTO      STELF999
.
STELF031  MOVE      QRYDATA,PTELF031
          PACK      PTELF031,PTELF031,SP70
          RJUSTIFY  PTELF031
          GOTO      STELF999
.
STELF032  MOVE      QRYDATA,PTELF032
          PACK      PTELF032,PTELF032,SP70
          RJUSTIFY  PTELF032
          GOTO      STELF999
.
STELF033  MOVE      QRYDATA,PTELF033
          GOTO      STELF999
.
STELF034  MOVE      QRYDATA,PTELF034
          GOTO      STELF999
.
STELF035  MOVE      QRYDATA,PTELF035
          GOTO      STELF999
.
STELF036  MOVE      QRYDATA,PTELF036
          GOTO      STELF999
.
STELF037  MOVE      QRYDATA,PTELF037
          GOTO      STELF999
.
STELF999  RETURN
.
.-----------------------------------------------------------
.         Set up free format OEC fields
.-----------------------------------------------------------
STEF0000  MATCH     SP70,PTELF001
          IF        !@EQUAL
            MOVE      PTELF001,PMEFURNO
          ENDIF
.
          MATCH     SP70,PTELF002
          IF        !@EQUAL
            MOVE      PTELF002,PMEFOECC
          ENDIF
.
          MATCH     SP70,PTELF003
          IF        !@EQUAL
            MOVE      PTELF003,PMEFTITL
          ENDIF
.
          MATCH     SP70,PTELF004
          IF        !@EQUAL
            MOVE      PTELF004,PMEFFNAM
          ENDIF
.
          MATCH     SP70,PTELF005
          IF        !@EQUAL
            MOVE      PTELF005,PMEFSNAM
          ENDIF
.
          MATCH     SP70,PTELF006
          IF        !@EQUAL
            MOVE      PTELF006,PMEFHFGN
          ENDIF
.
          MATCH     SP70,PTELF007
          IF        !@EQUAL
            MOVE      PTELF007,PMEFHFSN
          ENDIF
.
          MATCH     SP70,PTELF008
          IF        !@EQUAL
            MOVE      PTELF008,PMEFGEND
          ENDIF
.
          MATCH     SP70,PTELF009
          IF        !@EQUAL
            MOVE      PTELF009,PMEFBDAT
          ENDIF
.
          MATCH     SP70,PTELF010
          IF        !@EQUAL
            MOVE      PTELF010,PMEFEADT
          ENDIF
.
          MATCH     SP70,PTELF011
          IF        !@EQUAL
            MOVE      PTELF011,PMEFISTY
          ENDIF
.
          MATCH     SP70,PTELF012
          IF        !@EQUAL
            MOVE      PTELF012,PMEFPLOS
          ENDIF
.
          MATCH     SP70,PTELF013
          IF        !@EQUAL
            MOVE      PTELF013,PMEFDINT
          ENDIF
.
          MATCH     SP70,PTELF014
          IF        !@EQUAL
            MOVE      PTELF014,PMEFPEAI
          ENDIF
.
          MATCH     SP70,PTELF015
          IF        !@EQUAL
            MOVE      PTELF015,PMEFEMAD
          ENDIF
.
          MATCH     SP70,PTELF016
          IF        !@EQUAL
            MOVE      PTELF016,PMEFPRIC
          ENDIF
.
          MATCH     SP70,PTELF017
          IF        !@EQUAL
            MOVE      PTELF017,PMEFPRIM
          ENDIF
.
          MATCH     SP70,PTELF018
          IF        !@EQUAL
            MOVE      PTELF018,PMEFCLTY
          ENDIF
.
          MATCH     SP70,PTELF019
          IF        !@EQUAL
            MOVE      PTELF019,PMEFHFND
          ENDIF
.
          MATCH     SP70,PTELF020
          IF        !@EQUAL
            MOVE      PTELF020,PMEFHFNT
          ENDIF
.
          MATCH     SP70,PTELF021
          IF        !@EQUAL
            MOVE      PTELF021,PMEFHFMN
          ENDIF
.
          MATCH     SP70,PTELF022
          IF        !@EQUAL
            MOVE      PTELF022,PMEFDIAG
          ENDIF
.
          MATCH     SP70,PTELF023
          IF        !@EQUAL
            MOVE      PTELF023,PMEFSRV1
          ENDIF
.
          MATCH     SP70,PTELF024
          IF        !@EQUAL
            MOVE      PTELF024,PMEFSRV2
          ENDIF
.
          MATCH     SP70,PTELF025
          IF        !@EQUAL
            MOVE      PTELF025,PMEFSRV3
          ENDIF
.
          MATCH     SP70,PTELF026
          IF        !@EQUAL
            MOVE      PTELF026,PMEFSRV4
          ENDIF
.
          MATCH     SP70,PTELF027
          IF        !@EQUAL
            MOVE      PTELF027,PMEFSRV5
          ENDIF
.
          MOVE      WBSEUID,PMEFCUID
          CALL      IBACLOCK
          PACK      PMEFCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMEFCDAT
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,PMEFCTIM
.
          MATCH     SP70,PTELF033
          IF        !@EQUAL
            MOVE      PTELF033,PMEFDVAN
          ENDIF
.
          MATCH     SP70,PTELF034
          IF        !@EQUAL
            MOVE      PTELF034,PMEFGEND
          ENDIF
.
          MATCH     SP70,PTELF035
          IF        !@EQUAL
            MOVE      PTELF035,PMEFVISN
          ENDIF
.
          MATCH     SP70,PTELF036
          IF        !@EQUAL
            MOVE      PTELF036,PMEFCNTR
          ENDIF
.
          MATCH     SP70,PTELF037
          IF        !@EQUAL
            MOVE      PTELF037,PMEFFLAG
          ENDIF
.
STEF9999  RETURN
.
.-----------------------------------------------------------
.         Clear free format OEC fields
.-----------------------------------------------------------
CLRELF00  MOVE      SP70,PMEFELGN
          MOVE      SP70,PMEFURNO
          MOVE      SP70,PMEFOECC
          MOVE      SP70,PMEFTITL
          MOVE      SP70,PMEFFNAM
          MOVE      SP70,PMEFSNAM
          MOVE      SP70,PMEFHFGN
          MOVE      SP70,PMEFHFSN
          MOVE      SP70,PMEFGEND
          MOVE      SP70,PMEFBDAT
          MOVE      SP70,PMEFEADT
          MOVE      SP70,PMEFISTY
          MOVE      SP70,PMEFPLOS
          MOVE      SP70,PMEFDINT
          MOVE      SP70,PMEFPEAI
          MOVE      SP70,PMEFEMAD
          MOVE      SP70,PMEFPRIC
          MOVE      SP70,PMEFPRIM
          MOVE      SP70,PMEFCLTY
          MOVE      SP70,PMEFHFND
          MOVE      SP70,PMEFHFNT
          MOVE      SP70,PMEFHFMN
          MOVE      SP70,PMEFDIAG
          MOVE      SP70,PMEFSRV1
          MOVE      SP70,PMEFSRV2
          MOVE      SP70,PMEFSRV3
          MOVE      SP70,PMEFSRV4
          MOVE      SP70,PMEFSRV5
          MOVE      SP70,PMEFCUID
          MOVE      SP70,PMEFCDAT
          MOVE      SP70,PMEFCTIM
          MOVE      SP70,PMEFDVAN
          PACK      PMEFSPAR,SP70,SP70
          MOVE      ZERO,QUOTENUM
          MOVE      SP70,UPDATEST
.
CLRELF99  RETURN
.
.-----------------------------------------------------------
.         Free Format OEC
.-----------------------------------------------------------
FOEC0000  RESET     UPDTTYPE
          CALL      CLRELF00           * Clear fields
.
          MATCH     SP70,UPDTTYPE
          GOTO      FOEC8000 IF EQUAL
.
          MATCH     "A",UPDTTYPE
          GOTO      FOEC1000 IF EQUAL
.
          MATCH     "L",UPDTTYPE
          GOTO      FOEC2000 IF EQUAL
.
          MATCH     "D",UPDTTYPE
          GOTO      FOEC3000 IF EQUAL
.
          MATCH     "U",UPDTTYPE
          GOTO      FOEC4000 IF EQUAL
.
          MATCH     "T",UPDTTYPE
          GOTO      FOEC5000 IF EQUAL
.
          GOTO      FOEC9000
.
FOEC1000  MATCH     "1",PTCNWSIN 
          GOTO      FOEC1500 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      FOEC1500 IF NOT EQUAL          
.
          COMPARE   ONE,OECWINDC
          GOTO      FOEC1500 IF NOT EQUAL          
.
          CALL      CLWEBELF
.
          CALL      GELW0000           * Generate Eligibility Number
          BRANCH    EXIT,FOEC9100
.
          CALL      STEW0000           * Move work vars to table vars
.
          MATCH     "1",RESUBOEC
          IF        !@EQUAL
            MOVE      SP70,WBEFVISN
            MOVE      SP70,WBEFCNTR
            MOVE      SP70,WBEFFLAG
          ENDIF
.
          PACK      KEY8,WBEFELGN,SP70
          CALL      RAWBELF1
          IF        OVRCD=0
            GOTO      FOEC9999
          ENDIF
.
          CALL      WRWBELF1
.
          CALL      CLWEBOEC
          CALL      SEWOEC00
.
          PACK      KEY11,WBEFELGN,SP1,SP1,ONE,SP70
          CALL      RAWBOEC1
          IF        OVRCD=0
            GOTO      FOEC9999
          ENDIF

          CALL      IBACLOCK
          PACK      WBOCCDTE,CCC,CYY,CMM,CDD
          REP       " 0",WBOCCDTE
          MOVE      CTIMEIS,WBOCCTIM
          MOVE      USERID,WBOCCUID

          CALL      WRWBOEC1
.
          CALL      SEWOES00
.
          MOVE      ZERO,EXIT
.
FOEC1500  MATCH     "1",PTCNOECE
          GOTO      FOEC9999 IF EQUAL
.
          CALL      CLPMSELF
.
          CALL      GELN0000           * Generate Eligibility Number
          BRANCH    EXIT,FOEC9100
.
          CALL      STEF0000           * Move work vars to table vars
.
          MATCH     "1",RESUBOEC
          IF        !@EQUAL
            MOVE      SP70,PMEFVISN
            MOVE      SP70,PMEFCNTR
            MOVE      SP70,PMEFFLAG
          ENDIF
.
          PACK      KEY8,PMEFELGN,SP70
          CALL      RAPMELF1
          IF        OVRCD=0
            GOTO      FOEC9999
          ENDIF
.
          CALL      WRPMELF1
.
          CALL      CLPMSOEC
          CALL      SETOEC00
.
          PACK      KEY11,PMEFELGN,SP1,SP1,ONE,SP70
          CALL      RAPMOEC1
          IF        OVRCD=0
            GOTO      FOEC9999
          ENDIF
.
          CALL      WRPMOEC1
.
          CALL      SETOES00
.
          MOVE      ZERO,EXIT
          GOTO      FOEC9999
.
FOEC2000  CALL      SETLNK00
.
          ENDSET    HTMLLINK
          APPEND    "&startnum=",HTMLLINK
          MOVE      SP70,KEY3
          MOVE      ZERO,F3
          ASSIGN    STARTNUM+ZERO,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          APPEND    KEY3,HTMLLINK
.
          ENDSET    HTMLLINK
          APPEND    "&norecord=",HTMLLINK
          MOVE      SP70,KEY3
          MOVE      ZERO,F3
          ASSIGN    NORECORD+ZERO,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          APPEND    KEY3,HTMLLINK
.
          RESET     HTMLLINK
          ENDSET    REDIRECT
          APPEND    HTMLLINK,REDIRECT
          RESET     REDIRECT
.
          MOVE      ZERO,EXIT
          GOTO      FOEC9999
.
FOEC3000  MATCH     "1",OLDOECIN
          GOTO      FOEC3500 IF EQUAL
.
          MATCH     "1",PTCNWSIN
          GOTO      FOEC3500 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      FOEC3500 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      FOEC3500 IF NOT EQUAL
.
          PACK      KEY8,ELGNUMBR,SP70
          CALL      RAWBELF1
          IF        OVRCD=1
            MOVE      ZERO,EXIT
            GOTO      FOEC9999
          ENDIF
.
          CALL      DEWBELF1 
.
FOEC3500  MATCH     "1",OLDOECIN
          GOTO      FOEC3550 IF EQUAL
.
          MATCH     "1",PTCNOECE
          GOTO      FOEC3600 IF EQUAL
.
FOEC3550  PACK      KEY8,ELGNUMBR,SP70
          CALL      RAPMELF1
          IF        OVRCD=1
            MOVE      ZERO,EXIT
            GOTO      FOEC9999
          ENDIF
.
          CALL      DEPMELF1 
.
FOEC3600  CALL      SETLNK00
.
          ENDSET    HTMLLINK
          APPEND    "&startnum=",HTMLLINK
          MOVE      SP70,KEY3
          MOVE      ZERO,F3
          ASSIGN    STARTNUM+ZERO,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          APPEND    KEY3,HTMLLINK
.
          ENDSET    HTMLLINK
          APPEND    "&norecord=",HTMLLINK
          MOVE      SP70,KEY3
          MOVE      ZERO,F3
          ASSIGN    NORECORD+ZERO,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          APPEND    KEY3,HTMLLINK
.
          RESET     HTMLLINK
          ENDSET    REDIRECT
          APPEND    HTMLLINK,REDIRECT
          RESET     REDIRECT
.
          MOVE      ZERO,EXIT
          GOTO      FOEC9999
.
FOEC4000  MATCH     SP70,PTELF001
          GOTO      FOEC9300 IF EQUAL
          GOTO      FOEC9300 IF EOS
.
          MATCH     SP70,ELGNUMBR
          GOTO      FOEC9400 IF EQUAL
          GOTO      FOEC9400 IF EOS
.
          PACK      KEY8,PTELF001,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,FOEC9300
          CALL      RDPMPX21
.
          COMPARE   ZERO,PSTAT
          GOTO      FOEC9300 IF NOT EQUAL
.
          MATCH     "1",PTCNWSIN
          GOTO      FOEC4500 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      FOEC4500 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      FOEC4500 IF NOT EQUAL
.
          PACK      KEY8,ELGNUMBR,SP70
          CALL      RDWBELF1
          BRANCH    OVRCD,FOEC4500
.
          MOVE      PTELF001,WBEFURNO
.
          CALL      UPWBELF1
.
FOEC4500  MATCH     "1",PTCNOECE
          GOTO      FOEC4600 IF EQUAL
.
          PACK      KEY8,ELGNUMBR,SP70
          CALL      RDPMELF1
          BRANCH    OVRCD,FOEC9200
.
          MOVE      PTELF001,PMEFURNO
.
          CALL      UPPMELF1
.
FOEC4600  MOVE      ZERO,EXIT
          GOTO      FOEC9999
.
FOEC5000  MATCH     "1",PTCNWSIN
          GOTO      FOEC5040 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      FOEC5040 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      FOEC5040 IF NOT EQUAL
.
          PACK      KEY8,ELGNUMBR,SP70
          CALL      RAWBELF1
          IF        OVRCD=1
            MOVE      ZERO,EXIT
            GOTO      FOEC9999
          ENDIF
.
          CALL      DEWBELF1
.
          PACK      KEY16,URNUMBER,SP70
          CALL      RSWBELF2
FOEC5020  CALL      RKWBELF2
          BRANCH    OVRCD,FOEC5030
.
          MATCH     URNUMBER,WBEFURNO
          GOTO      FOEC5030 IF NOT EQUAL
.
          MATCH     ADMISSNO,WBEFVISN
          GOTO      FOEC5040 IF EQUAL
.
          GOTO      FOEC5020
.
FOEC5030  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMVX11
          IF        OVRCD=0
            MOVE      SP70,PMVXPOEC
            CALL      UPPMVX11
          ENDIF
.
FOEC5040  MATCH     "1",PTCNOECE
          GOTO      FOEC5200 IF EQUAL
.
          PACK      KEY8,ELGNUMBR,SP70
          CALL      RAPMELF1
          IF        OVRCD=1
            MOVE      ZERO,EXIT
            GOTO      FOEC9999
          ENDIF
.
          CALL      DEPMELF1
.
          PACK      KEY16,URNUMBER,SP70
          CALL      RSPMELF2
FOEC5050  CALL      RKPMELF2
          BRANCH    OVRCD,FOEC5100
.
          MATCH     URNUMBER,PMEFURNO
          GOTO      FOEC5100 IF NOT EQUAL
.
          MATCH     ADMISSNO,PMEFVISN
          GOTO      FOEC5200 IF EQUAL
.
          GOTO      FOEC5050
.          
FOEC5100  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMVX11
          IF        OVRCD=0
            MOVE      SP70,PMVXPOEC
            CALL      UPPMVX11
          ENDIF
.
FOEC5200  MOVE      ZERO,EXIT
          GOTO      FOEC9999
.
FOEC8000  MATCH     "1",OLDOECIN
          GOTO      FOEC8100 IF EQUAL
.
          MATCH     "1",PTCNWSIN
          GOTO      FOEC8100 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      FOEC8100 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      FOEC8100 IF NOT EQUAL
.
          MATCH     SP70,ELGNUMBR
          GOTO      FOEC8050 IF EQUAL
          GOTO      FOEC8050 IF EOS
.
          PACK      KEY8,ELGNUMBR,SP70
          CALL      RDWBELF1
          BRANCH    OVRCD,FOEC8100
.
          PACK      KEY11,WBEFELGN,SP1,SP1,ONE,SP20
          CALL      RDWBOEC1
          IF        OVRCD=ONE
            CALL      CLWEBOEC
          ENDIF
.
          GOTO      FOEC8070
.
FOEC8050  MATCH     SP70,OECNUMBR
.         GOTO      FOEC8200 IF EQUAL
.         GOTO      FOEC8200 IF EOS
.
          IF        @EQUAL | @EOS
            CALL      CLWEBELF
            GOTO      FOEC8200
          ENDIF
.
          PACK      KEY8,OECNUMBR,SP70
          CALL      RDWBELF1
          BRANCH    OVRCD,FOEC9500
.
          PACK      KEY11,WBEFELGN,SP1,SP1,ONE,SP20
          CALL      RDWBOEC1
          IF        OVRCD=ONE
            CALL      CLWEBOEC
          ENDIF
.
FOEC8070  MATCH     SP70,WBEFVISN
          IF        @EQUAL
            PACK      KEY23,OECNUMBR,SP70
            CALL      RSWBEEH1
            CALL      RKWBEEH1
            IF        OVRCD=1
              CALL      CLWEBEEH
            ENDIF
.
            MATCH     SP70,WBEFVISN
            IF        @EQUAL
              PACK      DIM20,OECNUMBR,SP70
            ELSE
              PACK      DIM20,WBEFVISN,SP70
            ENDIF
.
            LJUSTIFY  DIM20
            MATCH     DIM20,WBEHARID
            IF        !@EQUAL
              CALL      CLWEBEEH
            ENDIF
          ELSE
            MATCH     "1",EMROECIN
            IF        @EQUAL
              PACK      KEY23,OECNUMBR,SP70
              CALL      RSWBEEH1
              CALL      RKWBEEH1
              IF        OVRCD=1
                CALL      CLWEBEEH
              ENDIF
.
              PACK      DIM20,OECNUMBR,SP70
.
              LJUSTIFY  DIM20
              MATCH     DIM20,WBEHARID
              IF        !@EQUAL
                CALL      CLWEBEEH
              ENDIF
            ELSE
.
              PACK      KEY8,WBEFVISN,SP70   
              CALL      RDEMVIS1
              IF        OVRCD=0
.
                PACK      KEY23,OECNUMBR,SP70
                CALL      RSWBEEH1
                CALL      RKWBEEH1
                IF        OVRCD=1
                  CALL      CLWEBEEH
                ENDIF
.
                PACK      DIM20,OECNUMBR,SP70
.
                LJUSTIFY  DIM20
                MATCH     DIM20,WBEHARID
                IF        !@EQUAL
                  CALL      CLWEBEEH
                ENDIF
.
              ELSE
.
                MOVE      WBEFVISN,DIM20
                LJUSTIFY  DIM20
                PACK      KEY23,DIM20,WBEFCNTR,SP70
                CALL      RDWBEEH1
                IF        OVRCD=1
                  CALL      CLWEBEEH
                ENDIF
.
              ENDIF
.
            ENDIF
          ENDIF
.
FOEC8100  MATCH     "1",OLDOECIN
          GOTO      FOEC8125 IF EQUAL
.
          MATCH     "1",PTCNOECE
          GOTO      FOEC8200 IF EQUAL
.
FOEC8125  MATCH     SP70,ELGNUMBR
          GOTO      FOEC8150 IF EQUAL
          GOTO      FOEC8150 IF EOS
.
          PACK      KEY8,ELGNUMBR,SP70
          CALL      RDPMELF1
          BRANCH    OVRCD,FOEC9200
.
          GOTO      FOEC8170
.
FOEC8150  MATCH     SP70,OECNUMBR
.         GOTO      FOEC8200 IF EQUAL
.         GOTO      FOEC8200 IF EOS
.
          IF        @EQUAL | @EOS
            CALL      CLPMSELF
            GOTO      FOEC8200
          ENDIF
.
          PACK      KEY8,OECNUMBR,SP70
          CALL      RDPMELF1
          BRANCH    OVRCD,FOEC9200
.
FOEC8170  MATCH     SP70,PMEFVISN
          IF        @EQUAL
            PACK      KEY23,OECNUMBR,SP70
            CALL      RSPMEEH1
            CALL      RKPMEEH1
            IF        OVRCD=1
              CALL      CLPMSEEH
            ENDIF
.
            MATCH     SP70,PMEFVISN
            IF        @EQUAL
              PACK      DIM20,OECNUMBR,SP70
            ELSE
              PACK      DIM20,PMEFVISN,SP70
            ENDIF
.
            LJUSTIFY  DIM20
            MATCH     DIM20,PMHEARID
            IF        !@EQUAL
              CALL      CLPMSEEH
            ENDIF
          ELSE
            MATCH     "1",EMROECIN
            IF        @EQUAL
              PACK      KEY23,OECNUMBR,SP70
              CALL      RSPMEEH1
              CALL      RKPMEEH1
              IF        OVRCD=1
                CALL      CLPMSEEH
              ENDIF
.
              PACK      DIM20,OECNUMBR,SP70
.
              LJUSTIFY  DIM20
              MATCH     DIM20,PMHEARID
              IF        !@EQUAL
                CALL      CLPMSEEH
              ENDIF
            ELSE
              MOVE      PMEFVISN,DIM20
              LJUSTIFY  DIM20
              PACK      KEY23,DIM20,PMEFCNTR,SP70
              CALL      RDPMEEH1
              IF        OVRCD=1
                CALL      CLPMSEEH
              ENDIF
            ENDIF
          ENDIF
.
FOEC8200  CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
          MOVE      "Free Format OEC",WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,FOEC9999
.
          CALL      WEBBOD00   * Output Templated Body of HTML
          CALL      WEBEND00   * Output End of Web Page
          MOVE      ONE,EXIT
          GOTO      FOEC9999
.
FOEC9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FOEC9999
.
FOEC9100  MOVE      "CONTACT iSoft - passcode allocation full.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FOEC9999
.
FOEC9200  MOVE      "Free Format OEC details not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FOEC9999
.
FOEC9300  MOVE      "Invalid UR Number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FOEC9999
.
FOEC9400  MOVE      "Invalid Eligibility Number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FOEC9999
.
FOEC9500  MOVE      "Free Format OECW details not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FOEC9999
.
FOEC9999  RETURN
.
.-----------------------------------------------------------
.        Generate Free Format OEC Eligibility Number
.-----------------------------------------------------------
GELN0000  MOVE      "118",PRXCODE
          CALL      GETSLK00
          READ      CONTROLF,HUND18;*117,PTCNELGN
.
GELN0100  MOVE      PTCNELGN,PMEFELGN
          UNPACK    PTCNELGN,ANS,KEY7
          MATCH     "a",ANS
          GOTO      GELN1150 IF LESS
          MOVE      ZERO,F7
          MOVE      KEY7,F7
.
GELN1100  COMPARE   "9999999",F7               * at the end of the group
          GOTO      GELN1110 IF NOT EQUAL
.
          MATCH     "z",ANS
          GOTO      GELN9000 IF EQUAL
.
          REP       REPUNIQ,ANS
          MOVE      ZERO,F7
.
GELN1110  ADD       ONE,F7
          MOVE      F7,D7
          REP       " 0",D7
.
          PACK      KEY8,ANS,D7,SP70
          CALL      RDPMELF1
          IF        OVRCD=ONE
            PACK      KEY11,ANS,D7,SP1,SP1,ONE,SP70
            CALL      RDPMOEC1
            IF        OVRCD=ONE
              PACK      KEY14,ANS,D7,SP1,SP1,ONE,SP70
              CALL      RSPMOES1
              CALL      RKPMOES1
              BRANCH    OVRCD,GELN9500
.
              PACK      KEY8,ANS,D7,SP70
              MATCH     KEY8,PMOSVISN
              GOTO      GELN9500 IF NOT EQUAL
            ENDIF
          ENDIF
.
          GOTO      GELN1100 
.
. no records
.
GELN1150  MOVE      ONE,F7
          MOVE      "a",ANS
.
          MOVE      F7,D7
          REP       " 0",D7
.
          PACK      KEY8,ANS,D7,SP70
          GOTO      GELN9500
.
GELN9000  MOVE      ONE,EXIT                  * Passcode allocation full
          GOTO      GELN9999
.
GELN9500  MOVE      KEY8,PTCNELGN
          WRITAB    CONTROLF,HUND18;*117,PTCNELGN
.
          MATCH     "00000000",PMEFELGN
          GOTO      GELN0100 IF EQUAL
.
GELN9999  CALL      RELSLK00
          RETURN
.
.*******************************************************************************
.        Set pmsoec variables
.*******************************************************************************
SETOEC00  MOVE      PMEFELGN,PMOEVISN
          MOVE      "  1",PMOECNTR
          MOVE      " 0",PMOESTAT
          MOVE      PMEFURNO,PMOEURNO
          MOVE      PMEFELGN,PMOEARID
          PACK      PMOEARID,PMOEARID,SP70
          LJUSTIFY  PMOEARID
          MOVE      SP70,PMOETRID
          CALL      IBACLOCK
          PACK      PMOERQDT,CCC,CYY,CMM,CDD
          REP       " 0",PMOERQDT
          MOVE      SP70,PMOEETYP
          MOVE      SP70,PMOEERRC
          PACK      PMOEERRD,SP70,SP70
          PACK      PMOECDTE,CCC,CYY,CMM,CDD
          REP       " 0",PMOECDTE
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,PMOECTIM
          MOVE      SP70,PMOEUDTE
          MOVE      SP70,PMOEUTIM
          MOVE      SP70,PMOEHOSP
.
          IF        IBCNMHOS=1
            MOVE      WBSEHOSP,PMOEHOSP
          ENDIF
.
          MOVE      SP70,PMOEELEG
.
          MOVE      SP70,PMOESPAR
.
SETOEC99  RETURN
.
.*******************************************************************************
.        Set pmsoes variables
.*******************************************************************************
SETOES00  MATCH     SP70,PMEFSRV1
          IF        !@EQUAL & !@EOS
            CALL      CLPMSOES
            MOVE      PMEFELGN,PMOSVISN
            MOVE      "  1",PMOSCNTR
            MOVE      "  1",PMOSSCNT
            MOVE      "6",PMOSRTYP
            MOVE      PMEFSRV1,PMOSITEM
.
            MOVE      "  1",PMOSQUAN
            MATCH     SP70,PTELF028
            IF        !@EQUAL
              MOVE      PTELF028,PMOSQUAN
            ENDIF
.
            MOVE      PMEFEADT,PMOSPDTE
            PACK      PMOSCDTE,CCC,CYY,CMM,CDD 
            REP       " 0",PMOSCDTE
            CLOCK     TIME,CTIMEIS
            MOVE      CTIMEIS,PMOSCTIM
            MOVE      SP70,PMOSSPAR
.
            PACK      KEY14,PMOSVISN,PMOSCNTR,PMOSSCNT,SP70
            CALL      RAPMOES1
            IF        OVRCD=1
              CALL      WRPMOES1
            ENDIF
          ENDIF
.
          MATCH     SP70,PMEFSRV2
          IF        !@EQUAL & !@EOS
            CALL      CLPMSOES
            MOVE      PMEFELGN,PMOSVISN
            MOVE      "  1",PMOSCNTR
            MOVE      "  2",PMOSSCNT
            MOVE      "6",PMOSRTYP
            MOVE      PMEFSRV2,PMOSITEM
.
            MOVE      "  1",PMOSQUAN
            MATCH     SP70,PTELF029
            IF        !@EQUAL
              MOVE      PTELF029,PMOSQUAN
            ENDIF
.
            MOVE      PMEFEADT,PMOSPDTE
            PACK      PMOSCDTE,CCC,CYY,CMM,CDD
            REP       " 0",PMOSCDTE
            CLOCK     TIME,CTIMEIS
            MOVE      CTIMEIS,PMOSCTIM
            MOVE      SP70,PMOSSPAR
.
            PACK      KEY14,PMOSVISN,PMOSCNTR,PMOSSCNT,SP70
            CALL      RAPMOES1
            IF        OVRCD=1
              CALL      WRPMOES1
            ENDIF
          ENDIF
.
          MATCH     SP70,PMEFSRV3
          IF        !@EQUAL & !@EOS
            CALL      CLPMSOES
            MOVE      PMEFELGN,PMOSVISN
            MOVE      "  1",PMOSCNTR
            MOVE      "  3",PMOSSCNT
            MOVE      "6",PMOSRTYP
            MOVE      PMEFSRV3,PMOSITEM
.
            MOVE      "  1",PMOSQUAN
            MATCH     SP70,PTELF030
            IF        !@EQUAL
              MOVE      PTELF030,PMOSQUAN
            ENDIF
.
            MOVE      PMEFEADT,PMOSPDTE
            PACK      PMOSCDTE,CCC,CYY,CMM,CDD
            REP       " 0",PMOSCDTE
            CLOCK     TIME,CTIMEIS
            MOVE      CTIMEIS,PMOSCTIM
            MOVE      SP70,PMOSSPAR
.
            PACK      KEY14,PMOSVISN,PMOSCNTR,PMOSSCNT,SP70
            CALL      RAPMOES1
            IF        OVRCD=1
              CALL      WRPMOES1
            ENDIF
          ENDIF
.
          MATCH     SP70,PMEFSRV4
          IF        !@EQUAL & !@EOS
            CALL      CLPMSOES
            MOVE      PMEFELGN,PMOSVISN
            MOVE      "  1",PMOSCNTR
            MOVE      "  4",PMOSSCNT
            MOVE      "6",PMOSRTYP
            MOVE      PMEFSRV4,PMOSITEM
.
            MOVE      "  1",PMOSQUAN
            MATCH     SP70,PTELF031
            IF        !@EQUAL
              MOVE      PTELF031,PMOSQUAN
            ENDIF
.
            MOVE      PMEFEADT,PMOSPDTE
            PACK      PMOSCDTE,CCC,CYY,CMM,CDD
            REP       " 0",PMOSCDTE
            CLOCK     TIME,CTIMEIS
            MOVE      CTIMEIS,PMOSCTIM
            MOVE      SP70,PMOSSPAR
.
            PACK      KEY14,PMOSVISN,PMOSCNTR,PMOSSCNT,SP70
            CALL      RAPMOES1
            IF        OVRCD=1
              CALL      WRPMOES1
            ENDIF
          ENDIF
.
          MATCH     SP70,PMEFSRV5
          IF        !@EQUAL & !@EOS
            CALL      CLPMSOES
            MOVE      PMEFELGN,PMOSVISN
            MOVE      "  1",PMOSCNTR
            MOVE      "  5",PMOSSCNT
            MOVE      "6",PMOSRTYP
            MOVE      PMEFSRV5,PMOSITEM
.
            MOVE      "  1",PMOSQUAN
            MATCH     SP70,PTELF032
            IF        !@EQUAL
              MOVE      PTELF032,PMOSQUAN
            ENDIF
.
            MOVE      PMEFEADT,PMOSPDTE
            PACK      PMOSCDTE,CCC,CYY,CMM,CDD
            REP       " 0",PMOSCDTE
            CLOCK     TIME,CTIMEIS
            MOVE      CTIMEIS,PMOSCTIM
            MOVE      SP70,PMOSSPAR
.
            PACK      KEY14,PMOSVISN,PMOSCNTR,PMOSSCNT,SP70
            CALL      RAPMOES1
            IF        OVRCD=1
              CALL      WRPMOES1
            ENDIF
          ENDIF
.
SETOES99  RETURN
.*******************************************************************************
.        Set link for OEC Free Format List
.*******************************************************************************
SETLNK00  CLEAR     HTMLLINK
.
          MATCH     SP70,SRCHSNAM
          IF        !@EQUAL
            APPEND    "&srchsnam=",HTMLLINK
            REP       "'~",SRCHSNAM
            STRIP     SRCHSNAM
            APPEND    SRCHSNAM,HTMLLINK
            REP       "~'",SRCHSNAM
          ENDIF
          MATCH     SP70,SRCHGNAM
          IF        !@EQUAL
            APPEND    "&srchgnam=",HTMLLINK
            REP       "'~",SRCHGNAM                                    *I-44200
            STRIP     SRCHGNAM
            APPEND    SRCHGNAM,HTMLLINK
            REP       "~'",SRCHGNAM                                    *I-44200
          ENDIF
.
          RESET     HTMLLINK
          RETURN
.
.----------------------------------------------------------------------------
. Report No. 9 : Free Format OEC Tags
.----------------------------------------------------------------------------
FOET0000  MATCH     "1",OLDOECIN
          GOTO      FOET0010 IF EQUAL
.
          MATCH     "1",PTCNWSIN
          GOTO      FOET0010 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      FOET0010 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      FOET0010 IF NOT EQUAL
.
          CALL      FOEW0000
.
          GOTO      FOET9999 
.
FOET0010  BRANCH    FLDITMNO,FOET0100,FOET0200,FOET0300,FOET0400,FOET0500:
                             FOET0600,FOET0700,FOET0800,FOET0900,FOET1000:
                             FOET1100,FOET1200,FOET1300,FOET1400,FOET1500:
                             FOET1600,FOET1700,FOET1800,FOET1900,FOET2000:
                             FOET2100,FOET2200,FOET2300,FOET2400,FOET2500:
                             FOET2600,FOET2700,FOET2800,FOET2900,FOET3000:
                             FOET3100,FOET3200,FOET3300,FOET3400,FOET3500:
                             FOET3600,FOET3700,FOET3800,FOET3900,FOET4000:
                             FOET4100,FOET4200,FOET4300,FOET4400,FOET4500:
                             FOET4600,FOET4700,FOET4800,FOET4900,FOET5000:
                             FOET5100,FOET5200,FOET5300,FOET5400,FOET5500:
                             FOET5600,FOET5700,FOET5800,FOET5900,FOET6000:
                             FOET6100,FOET6200,FOET6300,FOET6400,FOET6500:
                             FOET6600
.
          GOTO      FOET9999
.
FOET0100  MATCH     SP70,SRCHSNAM
          GOTO      FOET9999 IF EQUAL
          STRIP     SRCHSNAM
          MOVELPTR  SRCHSNAM,LENGTH
          COMPARE   ZERO,LENGTH
          GOTO      FOET9999 IF EQUAL
          SFORMAT   VAR,LENGTH
          MOVE      SRCHSNAM,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      FOET9999
.
FOET0200  MATCH     SP70,SRCHGNAM
          GOTO      FOET9999 IF EQUAL
          STRIP     SRCHGNAM
          MOVELPTR  SRCHGNAM,LENGTH
          COMPARE   ZERO,LENGTH
          GOTO      FOET9999 IF EQUAL
          SFORMAT   VAR,LENGTH
          MOVE      SRCHGNAM,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      FOET9999
.
FOET0300  CALL      LAST0000
          GOTO      FOET9999
.
FOET0400  CALL      STRT0000
          GOTO      FOET9999
.
FOET0500  CALL      NEXT0000
          GOTO      FOET9999
.
FOET0600  CALL      FFTB0000
          GOTO      FOET9999
.
FOET0700  WRITE     HTMLFILE;PMEFELGN;
          GOTO      FOET9999
.
FOET0800  WRITE     HTMLFILE;PMEFURNO;
          GOTO      FOET9999
.
FOET0900  CALL      FFPTNM00
          WRITE     HTMLFILE;PATFNAME;
          GOTO      FOET9999
.
FOET1000  MOVE      SP70,DIM11
          MATCH     SP70,PMEFEADT
          IF        !@EQUAL
            UNPACK    PMEFEADT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;DIM11;
          GOTO      FOET9999
.
FOET1100  MOVE      "VI",CATEGORY
          MOVE      PMEFISTY,CODE
          CALL      CODITM00
          GOTO      FOET9999
.
FOET1200  WRITE     HTMLFILE;PMEFPLOS;
          GOTO      FOET9999
.
FOET1300  MOVE      "KN",CATEGORY
          MOVE      PMEFDINT,CODE
          CALL      CODITM00
          GOTO      FOET9999
.
FOET1400  MATCH     "0",PMEFPEAI
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            MATCH     "1",PMEFPEAI
            IF        @EQUAL
              WRITE     HTMLFILE;"Yes";
            ELSE
              WRITE     HTMLFILE;"Query";
            ENDIF
          ENDIF
          GOTO      FOET9999
.
FOET1500  MATCH     "0",PMEFEMAD
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      FOET9999
.
FOET1600  MOVE      "il",CATEGORY
          MOVE      PMEFPRIC,CODE
          CALL      CODITM00
          GOTO      FOET9999
.
FOET1700  WRITE     HTMLFILE;PMEFPRIM;
          GOTO      FOET9999
.
FOET1800  MOVE      "CL",CATEGORY
          MOVE      PMEFCLTY,CODE
          CALL      CODITM00
          GOTO      FOET9999
.
FOET1900  PACK      KEY14,PMEFHFND,ZERO8
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
          ELSE
            WRITE     HTMLFILE;PMEFHFND;
          ENDIF
          GOTO      FOET9999
.
FOET2000  WRITE     HTMLFILE;PMEFHFNT;
          GOTO      FOET9999
.
FOET2100  WRITE     HTMLFILE;PMEFHFMN;
          GOTO      FOET9999
.
FOET2200  WRITE     HTMLFILE;PMEFDIAG;
          GOTO      FOET9999
.
FOET2300  MOVE      "  1",DIM3
          MOVE      ONE,FORM1
          CALL      FFSERV00
          GOTO      FOET9999
.
FOET2400  MOVE      "  1",DIM3
          MOVE      TWO,FORM1
          CALL      FFSERV00
          GOTO      FOET9999
.
FOET2500  MOVE      "  2",DIM3
          MOVE      ONE,FORM1
          CALL      FFSERV00
          GOTO      FOET9999
.
FOET2600  MOVE      "  2",DIM3
          MOVE      TWO,FORM1
          CALL      FFSERV00
          GOTO      FOET9999
.
FOET2700  MOVE      "  3",DIM3
          MOVE      ONE,FORM1
          CALL      FFSERV00
          GOTO      FOET9999
.
FOET2800  MOVE      "  3",DIM3
          MOVE      TWO,FORM1
          CALL      FFSERV00
          GOTO      FOET9999
.
FOET2900  MOVE      "  4",DIM3
          MOVE      ONE,FORM1
          CALL      FFSERV00
          GOTO      FOET9999
.
FOET3000  MOVE      "  4",DIM3
          MOVE      TWO,FORM1
          CALL      FFSERV00
          GOTO      FOET9999
.
FOET3100  MOVE      "  5",DIM3
          MOVE      ONE,FORM1
          CALL      FFSERV00
          GOTO      FOET9999
.
FOET3200  MOVE      "  5",DIM3
          MOVE      TWO,FORM1
          CALL      FFSERV00
          GOTO      FOET9999
.
FOET3300  MATCH     "Y",PMHEFSTA
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      FOET9999
.
FOET3400  WRITE     HTMLFILE;PMHETBSC;
          GOTO      FOET9999
.
FOET3500  MATCH     "Y",PMHEPEAI
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      FOET9999
.
FOET3600  WRITE     HTMLFILE;PMHEFRID;
          GOTO      FOET9999
.
FOET3700  WRITE     HTMLFILE;PMHETNAM;
          GOTO      FOET9999
.
FOET3800  MOVE      "005",ELIGTYPE
          CALL      ECDSC000
          GOTO      FOET9999
.
FOET3900  MOVE      "001",ELIGTYPE
          CALL      ECDSC000
          GOTO      FOET9999
.
FOET4000  MATCH     SP70,PMHECPAM
          GOTO      FOET9999 IF EQUAL
          GOTO      FOET9999 IF EOS
.
          MATCH     "0        ",PMHECPAM
          GOTO      FOET9999 IF EQUAL
.
          MOVE      SP70,DIM9
          MOVE      PMHECPAM,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      FOET9999
.
FOET4100  WRITE     HTMLFILE;PMHECPDR;
          GOTO      FOET9999
.
FOET4200  MOVE      "002",ELIGTYPE
          CALL      ECDSC000
          GOTO      FOET9999
.
FOET4300  MATCH     SP70,PMHEEXAM
          GOTO      FOET9999 IF EQUAL
          GOTO      FOET9999 IF EOS
.
          MATCH     "0        ",PMHEEXAM
          GOTO      FOET9999 IF EQUAL
.
          MOVE      SP70,DIM9
          MOVE      PMHEEXAM,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2
          GOTO      FOET9999
.
FOET4400  MATCH     SP70,PMHEEXBA
          GOTO      FOET9999 IF EQUAL
          GOTO      FOET9999 IF EOS
.
          MATCH     "0        ",PMHEEXBA
          GOTO      FOET9999 IF EQUAL
.
          MOVE      SP70,DIM9
          MOVE      PMHEEXBA,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2
          GOTO      FOET9999
.
FOET4500  MOVE      "003",ELIGTYPE
          CALL      ECDSC000
          GOTO      FOET9999
.
FOET4600  MOVE      "004",ELIGTYPE
          CALL      ECDSC000
          GOTO      FOET9999
.
FOET4700  CALL      PMSEED00
          GOTO      FOET9999
.
FOET4800  CALL      SRVASS00
          GOTO      FOET9999
.
FOET4900  WRITE     HTMLFILE;PMEFDVAN;
          GOTO      FOET9999
.
FOET5000  MOVE      "Male",DIM13
.
          MATCH     "F",PMEFGEND
          IF        @EQUAL
            MOVE      "Female",DIM13
          ENDIF
.
          MATCH     "R",PMEFGEND
          IF        @EQUAL
            MOVE      "Intersex",DIM13
          ENDIF
.
          MATCH     "U",PMEFGEND
          IF        @EQUAL
            MOVE      "Unknown",DIM13
          ENDIF
.
          MATCH     "I",PMEFGEND
          IF        @EQUAL
            MOVE      "Indeterminate",DIM13
          ENDIF
.
          WRITE     HTMLFILE;DIM13;
.
          GOTO      FOET9999
.
FOET5100  WRITE     HTMLFILE;PMEFTITL;
          GOTO      FOET9999
.
FOET5200  WRITE     HTMLFILE;PMEFSNAM;
          GOTO      FOET9999
.
FOET5300  WRITE     HTMLFILE;PMEFFNAM;
          GOTO      FOET9999
.
FOET5400  MOVE      SP70,DIM11
          MATCH     SP70,PMEFBDAT
          IF        !@EQUAL
            UNPACK    PMEFBDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;DIM11;
          GOTO      FOET9999
.
FOET5500  MOVE      SP70,DIM50
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     SP70,PMEFPRIM
          GOTO      FOET5510 IF EQUAL
.
          PACK      KEY9,PMEFPRIM,SP70
          PACK      KEY17,KEY9,SP70
          CALL      PATITMRD
          IF        F1=1
            CLEAR     DIM50
            APPEND    PMEFPRIM,DIM50
            IF        OVRCD=0
              APPEND    "/",DIM50
              APPEND    IDESC,DIM50
            ENDIF
            APPEND    SP70,DIM50
            RESET     DIM50
          ELSE
            PACK      DIM50,PMEFPRIM,SP70
            IF        OVRCD=0
              PACK      DIM50,IDESC,SP70
            ENDIF
          ENDIF
          GOTO        FOET5520
.
FOET5510  PACK      DIM50,PMEFPRIC,SP70
          MATCH     SP70,PMEFPRIC
          IF        !@EQUAL
            PACK      KEY5,CATil,PMEFPRIC,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              PACK      DIM50,TDESC,SP70
            ENDIF
          ENDIF
.
FOET5520  WRITE     HTMLFILE;DIM50;
          GOTO      FOET9999
.
FOET5600  WRITE     HTMLFILE;PMEFFLAG;
          GOTO      FOET9999
.
FOET5700  MATCH     "2",PTCNIFCL
          GOTO      FOET5710 IF NOT EQUAL     * Not SJOG
.
          PACK      KEY9,PTELCMXC,SP70
          MATCH     SP70,KEY9                 * Provisional Casemix code
          GOTO      FOET5710 IF EQUAL
.
          WRITE     HTMLFILE;PTELECLS;        * Expected Casmix LOS
          GOTO      FOET9999
.
FOET5710  WRITE     HTMLFILE;ASTAY;
          GOTO      FOET9999
.
FOET5800  CALL      CMBS0000                  * Check for multiple MBS
          WRITE     HTMLFILE;F1;
          GOTO      FOET9999
.
FOET5900  CALL      DMBS0000                  * Display extra MBS items
          GOTO      FOET9999
.
FOET6000  WRITE     HTMLFILE;PMEFGEND;
          GOTO      FOET9999
.
FOET6100  WRITE     HTMLFILE;PMEFPEAI;
          GOTO      FOET9999
.
FOET6200  WRITE     HTMLFILE;PMEFEMAD;
          GOTO      FOET9999
.
FOET6300  WRITE     HTMLFILE;PMEFHFND;
          GOTO      FOET9999
.
FOET6400  WRITE     HTMLFILE;PMEFVISN;
          GOTO      FOET9999
.
FOET6500  WRITE     HTMLFILE;PMEFCNTR;
          GOTO      FOET9999
.
FOET6600  WRITE     HTMLFILE;PMEFFLAG;
          GOTO      FOET9999
.
FOET9999  RETURN
.
.******************************************************************************
.*                Display Extra MBS Items                                     *
.******************************************************************************
DMBS0000  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          WRITE     HTMLFILE;"<tr><td class=DataLabel><b>":
                             "Item/Description</b></td></tr>";
.
          UNPACK    SP70,SAVMBSCD,DIM40,SAVDATE
          MOVE      ZERO,COUNTER
          PACK      KEY31,ADMISSNO,SP70
          CALL      RSOPDEA2
DMBS1000  CALL      RKOPDEA2
          BRANCH    OVRCD,DMBS6000
.
          MATCH     ADMISSNO,OPDAADMN
          GOTO      DMBS6000 IF NOT EQUAL
.
          MATCH     "3",DOPDASTA
          GOTO      DMBS1000 IF EQUAL          * Cancelled
.
          MOVE      SP70,GELFSTAT
          MOVE      SP70,GELFCFEC
          MOVE      SP70,GELFCFET
.
          MATCH     SP70,OPDAPROV
          IF        !@EQUAL & !@EOS
            MOVE      OPDAPROV,KEY9
            PACK      KEY17,KEY9,OPDADATE,SP70
            CALL      CDES0000
.
            MOVE      OPDAPROV,GELF0MBS
            CALL      GELF0000
.
            MATCH     SAVEPRIM,OPDAPROV
            GOTO      DMBS1100 IF EQUAL
.
            IF        GELFINDC=ONE
              WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPROV,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>":
.                        "&nbsp;<a href='javascript:disOEC(#"",PMEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",PMEFURNO,"#",#"",PMEFVISN,"#",#"",PMEFCNTR,"#")'>":
                         "<img src=../images/MaintenanceIcon.gif ":
                         "class=ListIcon></a>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";

            ELSE
DMBS1100      WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPROV,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
            ENDIF
.
          ENDIF
.
          MATCH     SP70,OPDAPRV2
          IF        !@EQUAL & !@EOS
            MOVE      OPDAPRV2,KEY9
            PACK      KEY17,KEY9,OPDADATE,SP70
            CALL      CDES0000
.
            MOVE      OPDAPRV2,GELF0MBS
            CALL      GELF0000
.
            MATCH     SAVEPRIM,OPDAPRV2
            GOTO      DMBS1200 IF EQUAL
.
            IF        GELFINDC=ONE
              WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPRV2,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>":
.                        "&nbsp;<a href='javascript:disOEC(#"",PMEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",PMEFURNO,"#",#"",PMEFVISN,"#",#"",PMEFCNTR,"#")'>":
                         "<img src=../images/MaintenanceIcon.gif ":
                         "class=ListIcon></a>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";

            ELSE
DMBS1200      WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPRV2,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
            ENDIF
.
          ENDIF
.
.
          MATCH     SP70,OPDAPRV3
          IF        !@EQUAL & !@EOS
            MOVE      OPDAPRV3,KEY9
            PACK      KEY17,KEY9,OPDADATE,SP70
            CALL      CDES0000
.
            MOVE      OPDAPRV3,GELF0MBS
            CALL      GELF0000
.
            MATCH     SAVEPRIM,OPDAPRV3
            GOTO      DMBS1300 IF EQUAL
.
            IF        GELFINDC=ONE
              WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPRV3,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>":
.                        "&nbsp;<a href='javascript:disOEC(#"",PMEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",PMEFURNO,"#",#"",PMEFVISN,"#",#"",PMEFCNTR,"#")'>":
                         "<img src=../images/MaintenanceIcon.gif ":
                         "class=ListIcon></a>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";

            ELSE
DMBS1300      WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPRV3,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
            ENDIF
          ENDIF
.
          PACK      KEY13,OPDAUNIQ,SP70
          CALL      RSOPMBS1
DMBS2000  CALL      RKOPMBS1
          BRANCH    OVRCD,DMBS1000
.
          MATCH     OPDAUNIQ,OPMBUNIQ
          GOTO      DMBS1000 IF NOT EQUAL
.
          COMPARE   ZERO,F1
          GOTO      DMBS8000 IF EQUAL       * Display one MBS code per line
.
.         Display MBS Codes in two columns
.
          COMPARE   ZERO,COUNTER
          GOTO      DMBS3000 IF NOT EQUAL
.
          MOVE      OPMBMBSI,SAVMBSCD       * Save MBS Codes
          MOVE      OPDADATE,SAVDATE
          MOVE      ONE,COUNTER
          GOTO      DMBS2000
.
DMBS3000  MOVE      SAVMBSCD,KEY9
          PACK      KEY17,KEY9,OPDADATE,SP70
          CALL      CDES0000                * Get MBS/ICD Operation Code desc.
          MOVE      IDESC,DIM40
.
          MOVE      OPMBMBSI,KEY9
          PACK      KEY17,KEY9,OPDADATE,SP70
          CALL      CDES0000                * Get MBS/ICD Operation Code desc.
.
          MOVE      SAVMBSCD,GELF0MBS
          CALL      GELF0000
.
          MATCH     SAVEPRIM,SAVMBSCD
          GOTO      DMBS3100 IF EQUAL
.
          IF        GELFINDC=ONE
            WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",SAVMBSCD,"'></td>":
                               "<td class=DataField width=45%>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",DIM40,"'>":
.                      "&nbsp;<a href='javascript:disOEC(#"",PMEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",PMEFURNO,"#",#"",PMEFVISN,"#",#"",PMEFCNTR,"#")'>":
                       "<img src=../images/MaintenanceIcon.gif ":
                       "class=ListIcon></a>&nbsp;":
                       GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                       "</td></tr>";

          ELSE
DMBS3100    WRITE     HTMLFILE;"<tr><td class=DataField>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",SAVMBSCD,"'></td>":
                               "<td class=DataField>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",DIM40,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
          ENDIF
.
          MOVE      OPMBMBSI,GELF0MBS
          CALL      GELF0000
.
          MATCH     SAVEPRIM,OPMBMBSI
          GOTO      DMBS3200 IF EQUAL
.
          IF        GELFINDC=ONE
            WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",OPMBMBSI,"'></td>":
                               "<td class=DataField width=45%>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>":
.                      "&nbsp;<a href='javascript:disOEC(#"",PMEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",PMEFURNO,"#",#"",PMEFVISN,"#",#"",PMEFCNTR,"#")'>":
                       "<img src=../images/MaintenanceIcon.gif ":
                       "class=ListIcon></a>&nbsp;":
                       GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                       "</td></tr>";

          ELSE
DMBS3200    WRITE     HTMLFILE;"<tr><td class=DataField>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",OPMBMBSI,"'></td>":
                               "<td class=DataField>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
          ENDIF
.
          UNPACK    SP70,SAVMBSCD,DIM40,SAVDATE
          MOVE      ZERO,COUNTER
.
          GOTO      DMBS2000
.
DMBS6000  COMPARE   ZERO,F1
          GOTO      DMBS9999 IF EQUAL
.
          MATCH     SP70,SAVMBSCD
          GOTO      DMBS9999 IF EQUAL
.
          MOVE      SAVMBSCD,KEY9
          PACK      KEY17,KEY9,SAVDATE,SP70
          CALL      CDES0000                * Get MBS/ICD Operation Code desc.
.
          MOVE      SAVMBSCD,GELF0MBS
          CALL      GELF0000
.
          MATCH     SAVEPRIM,SAVMBSCD
          GOTO      DMBS6100 IF EQUAL
.
          IF        GELFINDC=ONE
            WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",SAVMBSCD,"'></td>":
                               "<td class=DataField width=45%>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>":
.                      "&nbsp;<a href='javascript:disOEC(#"",PMEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",PMEFURNO,"#",#"",PMEFVISN,"#",#"",PMEFCNTR,"#")'>":
                       "<img src=../images/MaintenanceIcon.gif ":
                       "class=ListIcon></a>&nbsp;":
                       GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                       "</td></tr>";

          ELSE
DMBS6100    WRITE     HTMLFILE;"<tr><td class=DataField>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",SAVMBSCD,"'></td>":
                               "<td class=DataField>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
          ENDIF
.
          GOTO      DMBS9999
.
DMBS8000  MOVE      OPMBMBSI,KEY9
          PACK      KEY17,KEY9,OPDADATE,SP70
          CALL      CDES0000                * Get MBS/ICD Operation Code desc.
.
          MOVE      OPMBMBSI,GELF0MBS
          CALL      GELF0000
.
          MATCH     SAVEPRIM,OPMBMBSI
          GOTO      DMBS8100 IF EQUAL
.
          IF        GELFINDC=ONE
            WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",OPMBMBSI,"'></td>":
                               "<td class=DataField width=45%>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>":
.                      "&nbsp;<a href='javascript:disOEC(#"",PMEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",PMEFURNO,"#",#"",PMEFVISN,"#",#"",PMEFCNTR,"#")'>":
                       "<img src=../images/MaintenanceIcon.gif ":
                       "class=ListIcon></a>&nbsp;":
                       GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                       "</td></tr>";

          ELSE
DMBS8100    WRITE     HTMLFILE;"<tr><td class=DataField>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",OPMBMBSI,"'></td>":
                               "<td class=DataField>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
          ENDIF
.
          GOTO      DMBS2000
.
DMBS9999  RETURN
+
.------------------------------------------------------------
. Get MBS/ICD operation description
.------------------------------------------------------------
CDES0000  IF        OPCNCODE=1
            CALL      PATITMRD              * Read MBS code file
            IF        OVRCD=1
              MOVE      SP70,IDESC
            ENDIF
          ELSE
            CALL      RDPTICO1                * Read ICD operation file
            IF        OVRCD=1
              MOVE      SP70,ODESC
            ENDIF
            MOVE      ODESC,IDESC           * Set up description
          ENDIF
CDES9999  RETURN
+
.------------------------------------------------------------
. Checking for multiple MBS codes for this admission
.------------------------------------------------------------
CMBS0000  MOVE      ZERO,F1
          MOVE      ZERO,FORM1
.
          PACK      KEY31,ADMISSNO,SP70
          CALL      RSOPDEA2
CMBS1000  CALL      RKOPDEA2
          BRANCH    OVRCD,CMBS9999
.
          MATCH     ADMISSNO,OPDAADMN
          GOTO      CMBS9999 IF NOT EQUAL
.
          COMPARE   THREE,OPDASTAT
          GOTO      CMBS1000 IF EQUAL       * cancelled
.
          MATCH     SP70,OPDAPROV
          IF        !@EQUAL & !@EOS
            ADD       ONE,FORM1
          ENDIF
.
          MATCH     SP70,OPDAPRV2
          IF        !@EQUAL & !@EOS
            ADD       ONE,FORM1
          ENDIF
.
          MATCH     SP70,OPDAPRV3
          IF        !@EQUAL & !@EOS
            ADD       ONE,FORM1
          ENDIF
.
          COMPARE   FORM1,ONE
          IF        @LESS | @EQUAL
            MOVE      ONE,F1
          ENDIF
.
          PACK      KEY13,OPDAUNIQ,SP70
          CALL      RSOPMBS1
CMBS2000  CALL      RKOPMBS1
          BRANCH    OVRCD,CMBS1000
.
          MATCH     OPDAUNIQ,OPMBUNIQ
          GOTO      CMBS1000 IF NOT EQUAL
.
.         ADD       ONE,FORM1
.         BRANCH    FORM1,CMBS2000
.
          MOVE      ONE,F1                  * multiple MBS Codes
CMBS9999  RETURN
+
.------------------------------------------------------------
. Next Day, Week, Month
.------------------------------------------------------------
NECC0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          REP       " +",ACACTION
          REP       " +",OPTNFLTR
          REP       " +",SPECIALT
          REP       " +",REFTOCON
          WRITE     HTMLFILE;"patweb78.pbl":
                                 "?reportno=",KEY2:
                                 "&template=",KEY3:
                                 "&frstdate=",NXTFDATE:
                                 "&lastdate=",NXTLDATE:
                                 "&viewtype=",VIEWTYPE:
                                 "&acaction=",ACACTION:
                                 "&optnfltr=",OPTNFLTR:
                                 "&specialt=",SPECIALT:
                                 "&reftocon=",REFTOCON;
.
          REP       "+ ",ACACTION
          REP       "+ ",OPTNFLTR
          REP       "+ ",SPECIALT
          REP       "+ ",REFTOCON
NECC9999  RETURN
.------------------------------------------------------------
. Previous Day, Week, Month
.------------------------------------------------------------
PRCC0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          REP       " +",ACACTION
          REP       " +",OPTNFLTR
          REP       " +",SPECIALT
          REP       " +",REFTOCON
          WRITE     HTMLFILE;"patweb78.pbl":
                                 "?reportno=",KEY2:
                                 "&template=",KEY3:
                                 "&frstdate=",PREFDATE:
                                 "&lastdate=",PRELDATE:
                                 "&viewtype=",VIEWTYPE:
                                 "&acaction=",ACACTION:
                                 "&optnfltr=",OPTNFLTR:
                                 "&specialt=",SPECIALT:
                                 "&reftocon=",REFTOCON;
.
          REP       "+ ",ACACTION
          REP       "+ ",OPTNFLTR
          REP       "+ ",SPECIALT
          REP       "+ ",REFTOCON
PRCC9999  RETURN
.------------------------------------------------------------
. Link to Next Group
.------------------------------------------------------------
NEXT0000  CALL      SETLNK00  * Set up Link
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          REP       " +",OLDOECIN
.
          WRITE     HTMLFILE;"patweb78.pbl?reportno=9":
                                 "&template=002":
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&oldoecin=",OLDOECIN:
                                 HTMLLINK;
.
          REP       "+ ",OLDOECIN
          RETURN
.
.------------------------------------------------------------
. Link to Start Group
.------------------------------------------------------------
STRT0000  CALL      SETLNK00  * Set up Link
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          REP       " +",OLDOECIN
.
          WRITE     HTMLFILE;"patweb78.pbl?reportno=9":
                                 "&template=002":
                                 "&startnum=++0":
                                 "&norecord=",KEY2:
                                 "&oldoecin=",OLDOECIN:
                                 HTMLLINK;
.
          REP       "+ ",OLDOECIN
          RETURN
.
.------------------------------------------------------------
. Link to Last Group
.------------------------------------------------------------
LAST0000  CALL      SETLNK00  * Set up Link
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          REP       " +",OLDOECIN
.
          WRITE     HTMLFILE;"patweb78.pbl?reportno=9":
                                 "&template=002":
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&oldoecin=",OLDOECIN:
                                 HTMLLINK;
.
          REP       "+ ",OLDOECIN
          RETURN
.
.------------------------------------------------------------
. Free Format List Table     
.------------------------------------------------------------
FFTB0000  MOVE      ZERO,DISNUMB
.
          MATCH     SP70,SRCHSNAM
          IF        @EQUAL
            MATCH     SP70,SRCHGNAM
            GOTO      FFTB9999 IF EQUAL
          ENDIF
.
          PACK      SRCHGNAM,SRCHGNAM,SP70
          PACK      SRCHSNAM,SRCHSNAM,SP70
.
          CALL      FFHEAD00
.
          MATCH     "1",OLDOECIN
          GOTO      FFTB0005 IF EQUAL
.UPTOHERE
          MATCH     "1",PTCNOECE
          GOTO      FFTB5000 IF EQUAL
.
FFTB0005  MATCH     SP70,SRCHSNAM
          IF        @EQUAL
            PACK      KEY88,SRCHGNAM,SP70
            CALL      RSPMELF4
          ELSE 
            PACK      KEY88,SRCHSNAM,SP20,SRCHGNAM,SP70
            CALL      RSPMELF3
          ENDIF
.
FFTB0010  MATCH     SP70,SRCHSNAM
          IF        @EQUAL
            CALL      RKPMELF4
          ELSE
            CALL      RKPMELF3
          ENDIF
          BRANCH    OVRCD,FFTB5000
.
          MATCH     SP70,SRCHSNAM
          IF        !@EQUAL
            CMATCH    PMEFSNAM,SRCHSNAM
            GOTO      FFTB5000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHGNAM
          IF        !@EQUAL
            CMATCH    PMEFFNAM,SRCHGNAM
            GOTO      FFTB5000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMEFVISN
          GOTO      FFTB0010 IF NOT EQUAL
.
          MOVE      SP70,ELGRESIN 
          PACK      DIM20,PMEFELGN,SP70
          LJUSTIFY  DIM20
.
          PACK      KEY23,DIM20,SP70
          CALL      RSPMEEH1
          CALL      RKPMEEH1
          IF        OVRCD=0
            MATCH     DIM20,PMHEARID
            IF        @EQUAL
              MOVE      ONE,ELGRESIN
            ENDIF
          ENDIF
.
          PACK      KEY11,PMEFELGN,SP1,SP1,ONE,SP20
          CALL      RDPMOEC1
          IF        OVRCD=ONE
            MOVE      SP70,PMOESTAT
            MOVE      SP70,PMOEERRC
            MOVE      SP70,PMOEERRD
          ENDIF
.
          IF        STARTNUM>RECNUMB
            ADD       ONE,RECNUMB
            GOTO      FFTB0010
          ENDIF
.
          IF        DISNUMB>=NORECORD
            GOTO      FFTB5000
          ENDIF

          CALL      FFLINE00
.
          ADD       ONE,DISNUMB
          ADD       ONE,RECNUMB
.
          GOTO      FFTB0010
.
FFTB5000  MATCH     "1",OLDOECIN
          GOTO      FFTB9990 IF EQUAL
.
          MATCH     "1",PTCNWSIN
          GOTO      FFTB9990 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      FFTB9990 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      FFTB9990 IF NOT EQUAL
.
FFTB6005  MATCH     SP70,SRCHSNAM
          IF        @EQUAL
            PACK      KEY88,SRCHGNAM,SP70
            CALL      RSWBELF4
          ELSE
            PACK      KEY88,SRCHSNAM,SP20,SRCHGNAM,SP70
            CALL      RSWBELF3
          ENDIF
.
FFTB6010  MATCH     SP70,SRCHSNAM
          IF        @EQUAL
            CALL      RKWBELF4
          ELSE
            CALL      RKWBELF3
          ENDIF
          BRANCH    OVRCD,FFTB9990
.
          MATCH     SP70,SRCHSNAM
          IF        !@EQUAL
            CMATCH    WBEFSNAM,SRCHSNAM
            GOTO      FFTB9990 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHGNAM
          IF        !@EQUAL
            CMATCH    WBEFFNAM,SRCHGNAM
            GOTO      FFTB9990 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,WBEFVISN
          GOTO      FFTB6010 IF NOT EQUAL
.
          MOVE      SP70,ELGRESIN
          PACK      DIM20,WBEFELGN,SP70
          LJUSTIFY  DIM20
.
          PACK      KEY23,DIM20,SP70
          CALL      RSWBEEH1
          CALL      RKWBEEH1
          IF        OVRCD=0
            MATCH     DIM20,WBEHARID
            IF        @EQUAL
              MOVE      ONE,ELGRESIN
            ENDIF
          ELSE
            CALL        CLWEBEEH
          ENDIF
.
          PACK      KEY11,WBEFELGN,SP1,SP1,ONE,SP20
          CALL      RDWBOEC1
          IF        OVRCD=ONE
            MOVE      SP70,WBOCSTAT
            MOVE      SP70,WBOCERRC
            MOVE      SP70,WBOCERRD
            MOVE      SP70,WBOCVISN
          ENDIF
.
          IF        STARTNUM>RECNUMB
            ADD       ONE,RECNUMB
            GOTO      FFTB6010
          ENDIF
.
          IF        DISNUMB>=NORECORD
            GOTO      FFTB9990
          ENDIF

          CALL      FFLINW00
.
          ADD       ONE,DISNUMB
          ADD       ONE,RECNUMB
.
          GOTO      FFTB6010
.
FFTB9990  WRITE     HTMLFILE;"</table>";
FFTB9999  RETURN
+
.------------------------------------------------------------
. Free Format List Table Sort
.------------------------------------------------------------
FFTS0000  MOVE      ZERO,LOOPCNTR
          PACK      CURRDATE,CCC,CYY,CMM,CDD     * current date
          REP       " 0",CURRDATE
.
          PACK      SRCHGNAM,SRCHGNAM,SP70
          PACK      SRCHSNAM,SRCHSNAM,SP70
.
          MATCH     "1",OLDOECIN
          GOTO      FFTS0005 IF EQUAL
.
          MATCH     "1",PTCNOECE
          GOTO      FFTS5000 IF EQUAL          
.checking are done in PMSELFFD (Free Format Eligibility– pmselfaf
FFTS0005  GOTO      FFTS6005 
FFTS5000  MATCH     "1",OLDOECIN
          GOTO      FFTS9999 IF EQUAL
.
          MATCH     "1",PTCNWSIN
          GOTO      FFTS9999 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      FFTS9999 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      FFTS9999 IF NOT EQUAL
.
FFTS6005  PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBELF8
FFTS6006  CALL      RKWBELF8
          BRANCH    OVRCD,FFTS9999
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR > 50)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     WBEFCDAT,LASTDATE          * Date record created
          GOTO      FFTS9999 IF LESS
.
          MATCH     SP70,SRCHSNAM              
          IF        !@EQUAL
            CMATCH    WBEFSNAM,SRCHSNAM
            IF        @EQUAL
              GOTO      FFTS6010 
            ELSE
              GOTO      FFTS6006 
            ENDIF
          ENDIF
.
          MATCH     SP70,SRCHGNAM
          IF        !@EQUAL
            CMATCH    WBEFFNAM,SRCHGNAM
            IF        @EQUAL
              GOTO      FFTS6010
            ELSE
              GOTO      FFTS6006
            ENDIF
          ENDIF
.
FFTS6010  MATCH     SP70,WBEFVISN
          GOTO      FFTS6006 IF NOT EQUAL
.
          MOVE      SP70,ELGRESIN
          PACK      DIM20,WBEFELGN,SP70
          LJUSTIFY  DIM20
.
          PACK      KEY23,DIM20,SP70
          CALL      RSWBEEH1
          CALL      RKWBEEH1
          IF        OVRCD=0
            MATCH     DIM20,WBEHARID
            IF        @EQUAL
              MOVE      ONE,ELGRESIN
            ENDIF
          ELSE
            CALL        CLWEBEEH
          ENDIF
.
          PACK      KEY11,WBEFELGN,SP1,SP1,ONE,SP20
          CALL      RDWBOEC1
          IF        OVRCD=ONE
            MOVE      SP70,WBOCSTAT
            MOVE      SP70,WBOCERRC
            MOVE      SP70,WBOCERRD
            MOVE      SP70,WBOCVISN
          ENDIF
.
          CALL      FFLNWS00
          MOVE      ZERO,LOOPCNTR
.
          GOTO      FFTS6006
.

FFTS9999  RETURN
+
.------------------------------------------------------------
. Free Format Detail Line OECW For Table Sorting
.------------------------------------------------------------
FFLNWS00  MOVE      SP70,DIM11
          MATCH     SP70,WBEFCDAT
          IF        !@EQUAL
.
            MATCH     SP70,WBOCVISN
            IF        @EQUAL | @EOS
              WRITE     HTMLFILE;*+,"t.addRow(#"",HTMLLINK,"#",":
                                    "#"","","#",";                      *1
              WRITE     HTMLFILE;"#"",WBEFCDAT,WBEFCTIM,"#",";";        *2
            ELSE
.
              REP       " +",WBOCVISN
              REP       " +",WBOCCNTR
              REP       " +",WBOCURNO
.
              CLEAR     HTMLLNK3
              APPEND    "javascript:displayOEC('",HTMLLNK3
              APPEND    WBOCVISN,HTMLLNK3
              APPEND    WBOCCNTR,HTMLLNK3
              APPEND    "','",HTMLLNK3
              APPEND    WBOCURNO,HTMLLNK3
              APPEND    "','",HTMLLNK3
              APPEND    WBOCVISN,HTMLLNK3
              APPEND    "')",HTMLLNK3
.                               
              WRITE     HTMLFILE;*+,"t.addRow(#"",HTMLLNK3,"#",":
                             "#"","","#",";                             *1
              RESET     HTMLLNK3
              WRITE     HTMLFILE;"#"",WBEFCDAT,WBEFCTIM,"#",";";        *2
.
              REP       "+ ",WBOCVISN
              REP       "+ ",WBOCCNTR
              REP       "+ ",WBOCURNO
.
            ENDIF
.
          ELSE
            WRITE     HTMLFILE;"#"","","#",";";                         *2
          ENDIF
.
          WRITE      HTMLFILE;"#"<a href=javascript:disElg('",WBEFELGN,"');>":
                             "<img src=../images/InvoiceIcon.gif ":
                             "class=ListIcon></a>";
          WRITE      HTMLFILE;WBEFELGN,"#",";                           *3
.
          CALL       FFPTNW00
          WRITE     HTMLFILE;"#"",PATFNAME,"#",";";                     *4
.
          WRITE     HTMLFILE;"#"",WBEFEADT,"#",";";                     *5
.        Claim Type
          MATCH     SP70,WBEFCLTY
          IF        @EQUAL
            WRITE     HTMLFILE;"#"","","#",";";                     *6
          ELSE
            RESET     KEY5
            MOVE      "CL",KEY5
            PACK      KEY5,KEY5,WBEFCLTY,SP70
            CALL      RDCODE1
            WRITE     HTMLFILE;"#"",TDESC,"#",";";                     *6
          ENDIF 
.
          WRITE     HTMLFILE;"#"",WBEFHFND,"#",";";                     *7
          WRITE     HTMLFILE;"#"",WBEFHFNT,"#",";";                     *8
.
          MATCH      "1",ELGRESIN
          IF         @EQUAL
            WRITE     HTMLFILE;"#"<input type=button value=Response ":
                               "onclick=disOEC('",WBEFELGN,"');":
                               " class=orangebutton>",WBEHPSCD,"#",";   *9
.
            MATCH      "3040",WBOCERRC
            IF         @EQUAL
              WRITE     HTMLFILE;"#"<input type=button value=Delete ":
                               "onclick=deleteFreeFormatOEC('",WBEFELGN,"');":
                               " class=button>#",";                     *9
            ELSE
               WRITE     HTMLFILE;"#"","","#",";";                      *9
            ENDIF
          ELSE
.
            MATCH      " 0",WBOCSTAT
            IF         @EQUAL
              WRITE     HTMLFILE;"#"","Waiting","#",";                  *9
            ENDIF
.
            MATCH      " 1",WBOCSTAT
            IF         @EQUAL
              WRITE     HTMLFILE;"#"","Extracted","#",";";              *9
            ENDIF
.
            MATCH      " 2",WBOCSTAT
            IF         @EQUAL
              WRITE     HTMLFILE;"#"","Received","#",";";               *9
            ENDIF
.
            MATCH      " 3",WBOCSTAT
            IF         @EQUAL
              WRITE     HTMLFILE;"#"","SA Error: ","#",";";             *9
            ENDIF
.
            MATCH      " 4",WBOCSTAT
            IF         @EQUAL
              WRITE     HTMLFILE;"#"","Data Error: ","#",";";           *9
            ENDIF
.
            MATCH      " 5",WBOCSTAT
            IF         @EQUAL
              WRITE     HTMLFILE;"#"","Rejected Reported: ","#",";";    *9
            ENDIF
.
            MATCH      " 6",WBOCSTAT
            IF         @EQUAL
              WRITE     HTMLFILE;"#"","Complete Reported: ","#",";";    *9
            ENDIF
.
            MATCH      " 7",WBOCSTAT
            IF         @EQUAL
              WRITE     HTMLFILE;"#"","Health Fund Unavailable","#",";"; *9
            ENDIF
.
            WRITE     HTMLFILE;"#"<input type=button value=Delete ":
                               "onclick=deleteFreeFormatOEC('",WBEFELGN,"');":
                               " class=button>#",";                     *10
.
          ENDIF
          WRITE     HTMLFILE;"#"",WBOCTRID,"#",";";                     *11
          WRITE     HTMLFILE;"#"",WBOCERRC,WBOCERRD,"#",";";            *12
          WRITE     HTMLFILE;"#"",WBOCCUID,WBOCUUID,"#");";             *13
.
FFLNWS99  RETURN
+
.------------------------------------------------------------
. Free Format Header
.------------------------------------------------------------
FFHEAD00  WRITE      HTMLFILE;"<table width=100% border=1 cellspacing=0 ":
                            "cellpadding=1 style=#"table-layout: fixed;#">"
.
          WRITE      HTMLFILE;"<tr>":
              "<td class=HeadingCell width=70>":
              "Request&nbsp;Date&nbsp;&&nbsp;Time</td>":
              "<td class=HeadingCell width=100>User ID Created/Updated</td>":
              "<td class=HeadingCell width=70>Eligibility&nbsp;Number</td>":
              "<td class=HeadingCell width=140>Patient&nbsp;Name</td>":
              "<td class=HeadingCell width=70>Admission&nbsp;Date</td>":
              "<td class=HeadingCell width=60>Health&nbsp;Fund</td>":
              "<td class=HeadingCell width=40>Health&nbsp;Fund&nbsp;Table</td>":
              "<td class=HeadingCell width=110>Status</td>":
              "<td class=HeadingCell width=60>Delete</td>":
              "<td class=HeadingCell width=100>Transaction Id</td>":
              "<td class=HeadingCell width=100>Error Description</td>":
              "</tr>" 
FFHEAD99  RETURN
+
.------------------------------------------------------------
. Free Format Detail Line
.------------------------------------------------------------
FFLINE00  MOVE      SP70,DIM11
          MATCH     SP70,PMEFCDAT
          IF        !@EQUAL
            UNPACK    PMEFCDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
            WRITE     HTMLFILE;"<tr><td>",DIM11:
                               "&nbsp;at&nbsp",PMEFCTIM,"</td>";
          ELSE
            WRITE     HTMLFILE;"<tr><td>&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",WBOCCUID,SP1,WBOCCDTE,SP1,WBOCUUID,"</td>";
.
          WRITE      HTMLFILE;"<td><A HREF='javascript:disElg(#"":
                              PMEFELGN,"#")'>":
                             "<img src=../images/InvoiceIcon.gif ":
                             "class=ListIcon></a>";
          WRITE      HTMLFILE;PMEFELGN,"</td>";
.
          CALL       FFPTNM00
          WRITE      HTMLFILE;"<td width=140>",PATFNAME,"&nbsp;</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,PMEFEADT
          IF        !@EQUAL
            UNPACK    PMEFEADT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE      HTMLFILE;"<td>",DIM11,"&nbsp;</td>":
                              "<td>",PMEFHFND,"</td>":
                              "<td>",PMEFHFNT,"</td>";
.
          MATCH      "1",ELGRESIN
          IF         @EQUAL
            WRITE      HTMLFILE;"<td>":
                                "<input type=button value='Response'":
                                "onclick='disOEC(#"",PMEFELGN,"#");'": 
                                "class='orangebutton'></td>";
            MATCH      "3040",PMOEERRC
            IF         @EQUAL
              WRITE      HTMLFILE;"<td><input type=button value='Delete' ":
                             "onclick='deleteFreeFormatOEC(#"",PMEFELGN,"#")' ":
                             "class='button'></td>";
            ELSE  
              WRITE      HTMLFILE;"<td>&nbsp;</td>";
            ENDIF
.
          ELSE
.
            MATCH      " 0",PMOESTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Waiting":
                  "</td>";
            ENDIF
.
            MATCH      " 1",PMOESTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Extracted":
                  "</td>";
            ENDIF
.
            MATCH      " 2",PMOESTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Received":
                  "</td>";
            ENDIF
.
            MATCH      " 3",PMOESTAT 
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>SA Error: ":
                  PMOEERRC," ",PMOEERRD:
                  "</td>";
            ENDIF
.
            MATCH      " 4",PMOESTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Data Error: ":
                  PMOEERRC," ",PMOEERRD:
                  "</td>";
            ENDIF
.
            MATCH      " 7",PMOESTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Health Fund Unavailable":
                  "</td>";
            ENDIF
.
.             WRITE      HTMLFILE;"<td>":
.                 "<input type=button value='Response' ":
.                 "onclick='alert(#"No Response Available#");' class='button'>":
.                 "</td>":
.                 "</tr>";
.           ENDIF
.
            WRITE     HTMLFILE;"<td>":
                             "<input type=button value='Delete' ":
                             "onclick='deleteFreeFormatOEC(#"",PMEFELGN,"#")' ":
                             "class='button'>":
                             "</td>";

.
          ENDIF
.
          WRITE     HTMLFILE;"<td>&nbsp;</td>";
          WRITE     HTMLFILE;"<td>&nbsp;</td></tr>"
.
FFLINE99  RETURN
.
.------------------------------------------------------------
. Format Patient Name <b>SURNAME</b>Title Given Names
.------------------------------------------------------------
FFPTNM00  CLEAR     DISPNAME
          REP       "#" ",PMEFSNAM
          REP       "#" ",PMEFFNAM
          MOVE      SP70,PATFNAME
          REP       UPPLOW,PMEFSNAM
          APPEND    "<b>",DISPNAME
          APPEND    PMEFSNAM,DISPNAME
          APPEND    "</b>",DISPNAME
          PACK      NAME35,PMEFTITL,SP70
          CALL      NAMSTR00
          PACK      NAME35,PMEFFNAM,SP70
          CALL      NAMSTR00
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,PATFNAME
          STRIP     PATFNAME
          RETURN
.------------------------------------------------------------
. Get Service for Free Format OEC
.------------------------------------------------------------
FFSERV00  PACK      KEY14,PMEFELGN,SP1,SP1,ONE,DIM3,SP70
          CALL      RDPMOES1
          IF        OVRCD=1
            PACK      KEY14,PMEFVISN,SP1,SP1,ONE,DIM3,SP70
            CALL      RDPMOES1
            BRANCH    OVRCD,FFSERV99
          ENDIF
.
          BRANCH    FORM1,FFSERV10,FFSERV20
          GOTO      FFSERV99
.
FFSERV10  WRITE     HTMLFILE;PMOSITEM;
          GOTO      FFSERV99
.
FFSERV20  WRITE     HTMLFILE;PMOSQUAN;
          GOTO      FFSERV99
.
FFSERV99  RETURN
+
.*******************************************************************************
. Phase of Care Details Maintenance
.*******************************************************************************
PMSFOC00  MATCH     SP70,UPDTTYPE
          GOTO      PMSFOC70 IF EQUAL
.         
          MATCH     "A",UPDTTYPE            * Add Phase Change
          GOTO      PMSFOC10 IF EQUAL       
.         
          MATCH     "U",UPDTTYPE            * Update Phase Change
          GOTO      PMSFOC20 IF EQUAL       
.         
          MATCH     "D",UPDTTYPE            * Delete Phase Change
          GOTO      PMSFOC30 IF EQUAL
.
          GOTO      PMSFOC90
.
.         *** Add Phase Change ***
.
PMSFOC10  PACK      KEY18,PMFOC001,PMFOC002,PMFOC003,SP70
          CALL      RDPMFOC1
          COMPARE   ZERO,OVRCD
          GOTO      PMSFOC91 IF EQUAL
.
          CALL      CLPMFO00                     * Clear File Variables
          CALL      MVPMFO00                     * Move cgi to file variables

          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,PMFOCDAT                * System date
          CLOCK     TIME,PMFOCTIM                * System time
          MOVE      USERID,PMFOCUID              * web user id
          CALL      WRPMFOC1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      PMSFOC99
.
.         *** Update Phase Change ***
.
PMSFOC20  PACK      KEY18,PMFOC001,PMFOC002,PMFOC003,SP70
          CALL      RDPMFOC1
          COMPARE   ONE,OVRCD
          GOTO      PMSFOC92 IF EQUAL
.         
          CALL      MVPMFO00                     * Move cgi to file variables

          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,PMFOUDAT                * System date
          CLOCK     TIME,PMFOUTIM                * System time
          MOVE      USERID,PMFOUUID              * web user id
          CALL      UPPMFOC1                     * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      PMSFOC99
.
.         *** Delete Phase Change ***
.
PMSFOC30  PACK      KEY18,PMFOC001,PMFOC002,PMFOC003,SP70
          CALL      RDPMFOC1
          COMPARE   ONE,OVRCD
          GOTO      PMSFOC92 IF EQUAL
.
          CALL      DEPMFOC1                     * Delete the data
.
          MOVE      ZERO,EXIT
          GOTO      PMSFOC99
.
.         *** List Phase Change Details ***
.
PMSFOC70  PACK      KEY8,URNUMBER,SP70   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,PMSFOC93
.
          CALL      RDPMPX21
.
          PACK      KEY8,ADMISSNO,SP70   * Read Admission File
          CALL      RDMISS1
          BRANCH    OVRCD,PMSFOC94
.
          PACK      KEY8,ADMISSNO,SP70   * Read Discharge File
          CALL      RDDSCH1
          IF        OVRCD=1
            CALL      CLPATDSC
          ENDIF
.
          PACK      KEY18,ADMISSNO,PMFOC002,PHASDATE,SP70
          CALL      RDPMFOC1
          IF        OVRCD = 1
            CALL      CLPMFO00              * Clear File Variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Phase Change Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSFOC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PMSFOC99
.
PMSFOC90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSFOC99
.
PMSFOC91  MOVE      "Record already exists on file.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSFOC99
.
PMSFOC92  MOVE      "Record does not exist on file.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSFOC99
.
PMSFOC93  MOVE      "Can't find patient Master Details. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSFOC99
.
PMSFOC94  MOVE      "Can't find patient Admission Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATREB99
.
PMSFOC99  RETURN
+
.*******************************************************************************
. Phase of Care Change Details Table
.*******************************************************************************
POCTAB00  PACK      KEY10,ADMISSNO,PMFOC002,SP70
          CALL      RDPTRDE1    
          BRANCH    OVRCD,POCTAB05
.
          CALL      POCRRW00                     * Initial phase table row
.
POCTAB05  PACK      KEY18,ADMISSNO,PMFOC002,SP70
          CALL      RSPMFOC1
POCTAB10  CALL      RKPMFOC1
          BRANCH    OVRCD,POCTAB99
.
          MATCH     ADMISSNO,PMFOVISN
          GOTO      POCTAB99 IF NOT EQUAL
.
          MATCH     PMFOC002,PMFOEPNO
          GOTO      POCTAB99 IF NOT EQUAL
.
          CALL      POCROW00                     * Change phase table row
          GOTO      POCTAB10
.
POCTAB99  RETURN
+
.*******************************************************************************
. Phase of Care Change Details Table Row
.*******************************************************************************
POCROW00  CLEAR     HTMLLINK
          APPEND    "javascript:UpdatePhase('",HTMLLINK
          APPEND    PMFOEPNO,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PMFOPCDT,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          PACK      KEY5,CATpu,PMFOPHOC,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,SP70
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":      * 0
                             "#"",PMFOPCDT,"#",":               * 1
                             "#"",TDESC,"#",":                  * 2
                             "#"",PMFOCUID,"#")"                * 3
.
POCROW99  RETURN
+
.*******************************************************************************
. Initial Phase of Care Details Table Row
.*******************************************************************************
POCRRW00  CLEAR     HTMLLINK
          APPEND    "javascript:alert('",HTMLLINK
          APPEND    "Episode : ",HTMLLINK
          APPEND    PMFOC002,HTMLLINK
          APPEND    " Phase of care on admission can not be updated ",HTMLLINK
          APPEND    "here.')",HTMLLINK
          RESET     HTMLLINK

.
          PACK      KEY5,CATpu,PTRDPOCA,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,SP70
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":        * 0
                             "#"",EPFRDATE,"#",":                 * 1
                             "#"",TDESC,"#",":                    * 2
                             "#"Phase of Care on Admission#")"  * 3
.
POCRRW99  RETURN
+
.------------------------------------------------------------
.   UR Only OEC Response Table
.------------------------------------------------------------
UOET0000  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      ZERO,URVIFLAG
          MOVE      KEY1,URVIFLAG
.
          MATCH     "1",PTCNOECE
          GOTO      UOET5000 IF EQUAL
.
          PACK      KEY16,URNUMBER,SP70
          CALL      RSPMELF2
UOET1000  CALL      RKPMELF2
          BRANCH    OVRCD,UOET5000
.
          MATCH     URNUMBER,PMEFURNO
          GOTO      UOET5000 IF NOT EQUAL
.
          IF        URVIFLAG<>ONE
            MATCH     SP70,PMEFVISN
            GOTO      UOET1000 IF NOT EQUAL
.
            PACK      KEY11,PMEFELGN,SP1,SP1,ONE,SP70
.
          ELSE
            MATCH     SP70,PMEFVISN
            IF        @EQUAL
              PACK      KEY11,PMEFELGN,SP1,SP1,ONE,SP70
            ELSE
              PACK      KEY11,PMEFVISN,SP1,SP1,ONE,SP70
            ENDIF
          ENDIF
.
          CALL      RDPMOEC1
          IF        OVRCD=0
            MOVE      PMOEVISN,DIM20
            LJUSTIFY  DIM20
            PACK      DIM20,DIM20,SP70
            PACK      KEY23,DIM20,PMOECNTR,SP70
            CALL      RDPMEEH1
            IF        OVRCD=1
              GOTO      UOET1000
            ENDIF
          ELSE
            GOTO      UOET1000      
          ENDIF
.
          CALL      UOER0000
.
          GOTO      UOET1000
.
UOET5000  MATCH     "1",PTCNWSIN
          GOTO      UOET9999 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      UOET9999 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      UOET9999 IF NOT EQUAL
.
          PACK      KEY16,URNUMBER,SP70
          CALL      RSWBELF2
UOET6000  CALL      RKWBELF2
          BRANCH    OVRCD,UOET9999
.
          MATCH     URNUMBER,WBEFURNO
          GOTO      UOET9999 IF NOT EQUAL
.
          IF        URVIFLAG<>ONE
            MATCH     SP70,WBEFVISN
            GOTO      UOET6000 IF NOT EQUAL
.
            PACK      KEY11,WBEFELGN,SP1,SP1,ONE,SP70
.
          ELSE
            MATCH     SP70,WBEFVISN
            IF        @EQUAL
              PACK      KEY11,WBEFELGN,SP1,SP1,ONE,SP70
            ELSE
              PACK      KEY11,WBEFVISN,WBEFCNTR,SP70
            ENDIF
          ENDIF
.
          CALL      RDWBOEC1
          IF        OVRCD=0
            MOVE      WBOCVISN,DIM20
            LJUSTIFY  DIM20
            PACK      DIM20,DIM20,SP70
            PACK      KEY23,DIM20,WBOCCNTR,SP70
            CALL      RDWBEEH1
            IF        OVRCD=1
              GOTO      UOET6000
            ENDIF
          ELSE
            GOTO      UOET6000
          ENDIF
.
          CALL      UOEW0000
.
          GOTO      UOET6000
.
UOET9999  RETURN
+
.------------------------------------------------------------
.   UR Only OEC Response Table Row
.------------------------------------------------------------
UOER0000  CLEAR     HTMLLINK
          APPEND    "javascript:disElg('",HTMLLINK
          APPEND    PMEFELGN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:disOEC('",HTMLLNK2
          APPEND    PMEFELGN,HTMLLNK2
          APPEND    "')",HTMLLNK2
          RESET     HTMLLNK2
.
          MOVE      SP70,DIM11
          MATCH     SP70,PMEFEADT
          IF        !@EQUAL
            UNPACK    PMEFEADT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DIM40
          MATCH     SP70,PMEFPRIM
          IF        !@EQUAL
            PACK      DIM40,PMEFPRIM,SP70
            PACK      KEY9,PMEFPRIM,SP70
            PACK      KEY17,KEY9,SP70
            CALL      PATITMRD
            IF        OVRCD=0
              PACK      DIM40,IDESC,SP70
            ENDIF
          ELSE
            PACK      DIM40,PMEFPRIC,SP70          
            MATCH     SP70,PMEFPRIC
            IF         !@EQUAL
              PACK      KEY5,CATil,PMEFPRIC,SP70
              CALL      RDCODE1
              IF        OVRCD=0
                PACK      DIM40,TDESC,SP70
              ENDIF 
            ENDIF
          ENDIF
.
          MOVE      "No ",DIM3
          MATCH     "1",PMHEBENL
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ENDIF
.
          MOVE      SP70,DIM10
          MATCH     ANSA,PMHECFAC
          IF        @EQUAL
            MOVE      "ACCEPTED",DIM10
          ENDIF
          MATCH     ANSR,PMHECFAC
          IF        @EQUAL
            MOVE      "REJECTED",DIM10
          ENDIF
          MATCH     ANSW,PMHECFAC
          IF        @EQUAL
            MOVE      "WARNING",DIM10
          ENDIF
          MATCH     ANSC,PMHECFAC
          IF        @EQUAL
            MOVE      "COMPLETED",DIM10
          ENDIF
          MATCH     ANSI,PMHECFAC
          IF        @EQUAL
            MOVE      "INTERIM",DIM10
          ENDIF
          PACK      DIM10,DIM10,SP70
.
          MOVE      "No ",DIM3A
          MATCH     "Y",PMHECPDI
          IF        @EQUAL
            MOVE      "Yes",DIM3A
          ENDIF
.
          MOVE      "No ",DIM3B
          MATCH     "Y",PMHEEADI
          IF        @EQUAL
            MOVE      "Yes",DIM3B
          ENDIF
.
          MOVE      "No ",DIM3C
          MATCH     "Y",PMHEEXDI
          IF        @EQUAL
            MOVE      "Yes",DIM3C
          ENDIF
.
          MOVE      "No ",DIM3D
          MATCH     "Y",PMHETBDI
          IF        @EQUAL
            MOVE      "Yes",DIM3D
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                    "#"",HTMLLNK2,"#",":
                                    "#"",PMHEUDTE,PMHEUTIM,"#",":
                                    "#"",PMHECTID,"#",":
                                    "#"",DIM11,"&nbsp;&nbsp;&nbsp;",DIM40,"#",":
                                    "#"",DIM3,"#",":
                                    "#"",DIM10,"#",":
                                    "#"",DIM3A,"#",":
                                    "#"",DIM3B,"#",":
                                    "#"",DIM3C,"#",":
                                    "#"",PMHEPSCD,"#",":
                                    "#"",DIM3D,"#",":
                                    "#"",PMOEVISN,"#")"
.
UOER9999  RETURN
.
.*****************************************************************************
.*                              CONC0000                                     *
.*     See if the patient has concession card of DVA type on file            *
.* Requires: PURNO - U/R number                                              *
.* Returns:  DIM20 - Concession Card Number                                  *
.*           TDESC - Concession Card Color Description                       *
.*****************************************************************************
.
CONC0000  PACK      KEY19,PURNO,Z70
          CALL      RSPMCCD1                     * position on U/R
CONC0500  CALL      RPPMCCD1                     * read previous record
          BRANCH    OVRCD,CONC2000               * eof - nothing found
.
          MATCH     PURNO,PMCDURNO               * same U/R still ?
          GOTO      CONC2000 IF NOT EQUAL        * no - nothing found
.
.         Check if the card type is DVA or Pension (Cat ct, Indicator 1
.
          PACK      KEY5,CATCT,PMCDCTYP
          CALL      RDCODE1                      * code on file ?
          BRANCH    OVRCD,CONC0500               * no - ignore record
.
          MATCH     SP1,TCINDC1                  * blank indicator 1 ?
          GOTO      CONC0500 IF EQUAL            * yes - ignore record
.
          TYPE      TCINDC1                      * numeric indicator 1
          GOTO      CONC0500 IF NOT EQUAL        * no - ignore record
.
          MATCH     "3",TCINDC1                  * DVA card type ?
          GOTO      CONC0500 IF NOT EQUAL        * no - ignore record
.
.         A DVA concession card has been found, so check
.         if there is an expiry date
.
          MATCH     SP8,PMCDEXDT                 * expiry date blank ?
          GOTO      CONC1000 IF EQUAL            * yes - assume valid
.
.         There is an expiry date for the card, so check that the
.         card is current
.
          CALL      IBACLOCK
          PACK      DIM8,CCC,CYY,CMM,CDD
          REP       " 0",DIM8
.
          MATCH     DIM8,PMCDEXDT                * card valid for date ?
          GOTO      CONC2000 IF LESS             * no - nothing found
.
.         Concession card is current
.
CONC1000  MATCH     SP20,PMCDCNUM                * card number blank ?
          GOTO      CONC2000 IF EQUAL
.
          MOVE      PMCDCNUM,DIM20               * load concession card number
          MOVE      PMCDDVAC,D3                  * card color
          GOTO      CONC3000
.
CONC2000  MOVE      SP20,DIM20                 * use pmi card number
          MOVE      SP20,D3                    * use pmi card color
.
CONC3000  SQUEEZE   DIM20
          PACK      DIM20,DIM20,SP70
.
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CONC5000
.
          WRITE     HTMLFILE;DIM20;              * .0 = dva card number
          GOTO      CONC9999
.
CONC5000  MATCH     SP70,D3
          IF        @EQUAL
            PACK      TDESC,SP70
          ELSE
            PACK      KEY5,CATDX,D3,SP70
            CALL      RDCODE1
          ENDIF
.
          WRITE     HTMLFILE;TDESC;              * .1 = dva card color
.
CONC9999  RETURN
+
.*******************************************************************************
. IFC Other/Consumables/Prosthetic maintenance
.*******************************************************************************
PATIFC00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      PATIFC70 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add IFC Other
          GOTO      PATIFC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update IFC Other
          GOTO      PATIFC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete IFC Other
          GOTO      PATIFC30 IF EQUAL
.
          GOTO      PATIFC90
.
.         *** Add IFC Other ***
.
PATIFC10  PACK      KEY25,PTIFC001,PTIFC002,PTIFC003:
                          PTIFC004,PTIFC005,PTIFC006,SP70
          CALL      RDPTIFC1
          COMPARE   ZERO,OVRCD
          GOTO      PATIFC91 IF EQUAL
.
          CALL      CLPTIF00                     * Clear File Variables
          CALL      MVPTIF00                     * Move cgi to file variables

          PACK      PTFCSPRE,SP70
          CALL      WRPTIFC1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      PATIFC99
.
.         *** Update IFC Other ***
.
PATIFC20  PACK      KEY25,PTIFC001,PTIFC002,PTIFC003:
                          PTIFC004,PTIFC005,PTIFC006,SP70
          CALL      RDPTIFC1
          COMPARE   ONE,OVRCD
          GOTO      PATIFC92 IF EQUAL
.
          CALL      MVPTIF00                     * Move cgi to file variables

          CALL      UPPTIFC1                     * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      PATIFC99
.
.         *** Delete IFC Other ***
.
PATIFC30  PACK      KEY25,PTIFC001,PTIFC002,PTIFC003:
                          PTIFC004,PTIFC005,PTIFC006,SP70
          CALL      RDPTIFC1
          COMPARE   ONE,OVRCD
          GOTO      PATIFC92 IF EQUAL
.
          CALL      DEPTIFC1                     * Delete the data
.
          MOVE      ZERO,EXIT
          GOTO      PATIFC99
.
.         *** List IFC Other Details ***
.
PATIFC70  PACK      KEY25,PTIFC001,PTIFC002,PTIFC003:
                          PTIFC004,PTIFC005,PTIFC006,SP70
          CALL      RDPTIFC1
          IF        OVRCD = 1
            CALL      CLPTIF00              * Clear File Variables
          ELSE
            MATCH     "3",PTIFC004
            IF        @EQUAL
              MOVE      PTIFC005,ADMNTYPE   * adm.type record
            ENDIF
            MATCH     "2",PTIFC004
            IF        @EQUAL
              MOVE      PTIFC005,MBSITEMC   * mbs item type record
            ENDIF
            MATCH     "1",PTIFC004
            IF        @EQUAL
              MOVE      PTIFC005,CASEMIXC   * casemix type record
            ENDIF
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "IFC Other Consumables Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PATIFC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PATIFC99
.
PATIFC90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATIFC99
.
PATIFC91  MOVE      "Record already exists on file.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATIFC99
.
PATIFC92  MOVE      "Record does not exist on file.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATIFC99
.
PATIFC99  RETURN
+
.-------------------------------------------------------------------------------
. Set IFC Other/Consumables Parameters
.-------------------------------------------------------------------------------
SPIFCO00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPIFCO01,SPIFCO02,SPIFCO03,SPIFCO04,SPIFCO05:
                       SPIFCO06,SPIFCO07,SPIFCO08
          GOTO      SPIFCO99
.
SPIFCO01  PACK      PTIFC001,QRYDATA,SP70
          GOTO      SPIFCO99
.
SPIFCO02  PACK      PTIFC002,QRYDATA,SP70
          GOTO      SPIFCO99
.
SPIFCO03  PACK      PTIFC003,QRYDATA,SP70
          GOTO      SPIFCO99
.
SPIFCO04  PACK      PTIFC004,QRYDATA,SP70
          GOTO      SPIFCO99
.
SPIFCO05  PACK      PTIFC005,QRYDATA,SP70
          GOTO      SPIFCO99
.
SPIFCO06  PACK      PTIFC006,QRYDATA,SP70
          GOTO      SPIFCO99
.
SPIFCO07  MOVE      QRYDATA,PTIFC007
          GOTO      SPIFCO99
.
SPIFCO08  MOVE      QRYDATA,PTIFC008
          GOTO      SPIFCO99
.
SPIFCO99  RETURN
+
.----------------------------------------------------------------
.   Set Parameters for Admission special funding/contract Details
.----------------------------------------------------------------
SPASF000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPASF010,SPASF020,SPASF030
.
SPASF010  MOVE      QRYDATA,PTASF001
          GOTO      SPASF999
.
SPASF020  MOVE      QRYDATA,PTASF002
          GOTO      SPASF999
.
SPASF030  MOVE      QRYDATA,PTASF003
.
SPASF999  RETURN
+
.-------------------------------------------------------------------------------
. Clear IFC Other/Consumables variables
.-------------------------------------------------------------------------------
CLPTIF00  MOVE      SP70,PTFCCLTY
          MOVE      SP70,PTFCFUND
          MOVE      SP70,PTFCHTAB
          MOVE      SP70,PTFCRTYP
          MOVE      SP70,PTFCCMAT
          MOVE      SP70,PTFCCTYP
          MOVE      ZERO,PTFCRAMT
          MOVE      ZERO,PTFCPAMT
.
CLPTIF99  RETURN
+
.-------------------------------------------------------------------------------
. Move IFC Other/Consumables cgi variables to file variables
.-------------------------------------------------------------------------------
MVPTIF00  MATCH     Z70,PTIFC001
          IF        !@EQUAL
            MOVE      PTIFC001,PTFCCLTY
          ENDIF
.
          MATCH     Z70,PTIFC002
          IF        !@EQUAL
            MOVE      PTIFC002,PTFCFUND
          ENDIF
.
          MATCH     Z70,PTIFC003
          IF        !@EQUAL
            MOVE      PTIFC003,PTFCHTAB
          ENDIF
.
          MATCH     Z70,PTIFC004
          IF        !@EQUAL
            MOVE      PTIFC004,PTFCRTYP
          ENDIF
.
          MATCH     Z70,PTIFC005
          IF        !@EQUAL
            MOVE      PTIFC005,PTFCCMAT
          ENDIF
.
          MATCH     Z70,PTIFC006
          IF        !@EQUAL
            MOVE      PTIFC006,PTFCCTYP
          ENDIF
.
          MOVE      PTIFC007,PTFCRAMT
.
          MOVE      PTIFC008,PTFCPAMT
.
MVPTIF99  RETURN
+
.-------------------------------------------------------------------------------
. Output IFC Other/Consumables tags
.-------------------------------------------------------------------------------
PTIFC000  BRANCH    FLDITMNO,PTIFC010,PTIFC020,PTIFC030,PTIFC040,PTIFC050:
                             PTIFC060,PTIFC070,PTIFC080,PTIFC090,PTIFC100:
                             PTIFC110,PTIFC120,PTIFC130,PTIFC140,PTIFC150:
                             PTIFC160,PTIFC170,PTIFC180
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PTIFC999
.
PTIFC010  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      PTFCCLTY,CODE
          CALL      CODITM00
          GOTO      PTIFC999
.
PTIFC020  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTIFC021
          WRITE     HTMLFILE;PTFCFUND;       * Health Fund
          GOTO      PTIFC999
.
PTIFC021  MATCH     SP70,PTFCFUND
          GOTO      PTIFC999 IF EQUAL
.
          PACK      KEY14,PTFCFUND,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,PTIFC999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      PTIFC999
.
PTIFC030  MOVE      "HT",CATEGORY           * Table Type
          MOVE      PTFCHTAB,CODE
          CALL      CODITM00
          GOTO      PTIFC999
.
PTIFC040  WRITE     HTMLFILE;PTFCRTYP;      * record type (1=cmix/2=MBS/3=atype)
          GOTO      PTIFC999
.
PTIFC050  WRITE     HTMLFILE;PTFCCMAT;      * cmix code/mbs/atype
          GOTO      PTIFC999
.
PTIFC060  MOVE      "ce",CATEGORY           * Charge Type
          MOVE      PTFCCTYP,CODE
          CALL      CODITM00
          GOTO      PTIFC999
.
PTIFC070  WRITE     HTMLFILE;PTFCRAMT;      * rebate amount
          GOTO      PTIFC999
.
PTIFC080  WRITE     HTMLFILE;PTFCPAMT;      * patient amount
          GOTO      PTIFC999
.
PTIFC090  MOVE      "CL",CATEGORY           * Claim Code
          MOVE      PTIFC001,CODE
          CALL      CODITM00
          GOTO      PTIFC999
.
PTIFC100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTIFC101
          WRITE     HTMLFILE;PTIFC002;      * Health Fund
          GOTO      PTIFC999
.
PTIFC101  MATCH     SP70,PTIFC002
          GOTO      PTIFC999 IF EQUAL
.
          PACK      KEY14,PTIFC002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,PTIFC999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      PTIFC999
.
PTIFC110  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTIFC111
          WRITE     HTMLFILE;CASEMIXC;      * Casemix Code
          GOTO      PTIFC999
.
PTIFC111  MATCH     SP70,CASEMIXC
          GOTO      PTIFC999 IF EQUAL
.
          PACK      KEY9,CASEMIXC,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,PTIFC999
          WRITE     HTMLFILE;PTCADES1;      * Casemix Code Desc
          GOTO      PTIFC999
.
PTIFC120  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PTIFC121
          PACK      KEY9,MBSITEMC,SP70
          PACK      KEY17,KEY9,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,PTIFC999
          MATCH     "I",PTITACTV
          IF        @EQUAL
            MOVE    "Invalid - item is inactive. ",IDESC
          ENDIF
          WRITE     HTMLFILE;IDESC;         * MBS Desc
          GOTO      PTIFC999
.
PTIFC121  WRITE     HTMLFILE;MBSITEMC;      * MBS Code
          GOTO      PTIFC999
.
PTIFC130  MOVE      "A ",CATEGORY           * Admission Type
          MOVE      ADMNTYPE,CODE
          CALL      CODITM00
          GOTO      PTIFC999
.
PTIFC140  CALL      IFCOTB00                * IFC Other/Consumables Table
          GOTO      PTIFC999
.
PTIFC150  MOVE      "ce",CATEGORY           * Charge Type
          MOVE      PTIFC006,CODE
          CALL      CODITM00
          GOTO      PTIFC999
.
PTIFC160  MOVE      "HT",CATEGORY           * Table Type
          MOVE      PTIFC003,CODE
          CALL      CODITM00
          GOTO      PTIFC999
.
PTIFC170  CALL      NEXTIF00
          GOTO      PTIFC999
.
PTIFC180  CALL      PREVIF00
          GOTO      PTIFC999
.
PTIFC999  RETURN
+
.------------------------------------------------------------
. Table of IFC Other/Consumables Details
.------------------------------------------------------------
IFCOTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      ZERO,F1
          MOVE      ONE,FORM1A            * default to first index
          PACK      KEY25,PTIFC001,PTIFC002,PTIFC003:
                          PTIFC004,PTIFC005,PTIFC006,SP70
          CALL      RSPTIFC1
.
          MATCH     SP70,PTIFC001
          IF        @EQUAL
            MATCH     SP70,PTIFC002
            IF        !@EQUAL
              MOVE      TWO,FORM1A            * second index
              PACK      KEY25,PTIFC002,PTIFC003,PTIFC001:
                              PTIFC004,PTIFC005,PTIFC006,SP70
              CALL      RSPTIFC2
            ENDIF
          ENDIF
.
          MATCH     SP70,ADMNTYPE
          IF        !@EQUAL
            MOVE      THREE,FORM1A           * third index
            PACK      PTIFC005,ADMNTYPE,SP70
            MOVE      THREE,PTIFC004
            GOTO      IFCOTB05
          ELSE
            MATCH     SP70,MBSITEMC
            IF        !@EQUAL
              MOVE      THREE,FORM1A           * third index
              PACK      PTIFC005,MBSITEMC,SP70
              MOVE      TWO,PTIFC004
              GOTO      IFCOTB05
            ELSE
              MATCH     SP70,CASEMIXC
              IF        !@EQUAL
                MOVE      THREE,FORM1A           * third index
                PACK      PTIFC005,CASEMIXC,SP70
                MOVE      ONE,PTIFC004
                GOTO      IFCOTB05
              ENDIF
            ENDIF
          ENDIF
          GOTO      IFCOTB10
.
IFCOTB05  MATCH     SP70,PTIFC001
          IF        @EQUAL
            MATCH     SP70,PTIFC002
            IF        !@EQUAL
              MOVE      FOUR,FORM1A          * fourth index
              PACK      KEY25,PTIFC004,PTIFC005,PTIFC002:
                              PTIFC003,PTIFC001,PTIFC006,SP70
              CALL      RSPTIFC4
              GOTO      IFCOTB10
            ENDIF
          ENDIF
.
          PACK      KEY25,PTIFC004,PTIFC005,PTIFC001:
                          PTIFC002,PTIFC003,PTIFC006,SP70
          CALL      RSPTIFC3
.
IFCOTB10  BRANCH    FORM1A,IFCOTB11,IFCOTB12,IFCOTB13,IFCOTB14
.
IFCOTB11  CALL      RKPTIFC1
          GOTO      IFCOTB20
.
IFCOTB12  CALL      RKPTIFC2
          GOTO      IFCOTB20
.
IFCOTB13  CALL      RKPTIFC3
          GOTO      IFCOTB20
.
IFCOTB14  CALL      RKPTIFC4
.
IFCOTB20  BRANCH    OVRCD,IFCOTB99
.
          IF        FORM1A=1
            MATCH     SP70,PTIFC001                * check claim code
            IF        !@EQUAL
              MATCH     PTIFC001,PTFCCLTY
              GOTO      IFCOTB99 IF NOT EQUAL
              MATCH     SP70,PTIFC002              * check health fund
              IF        !@EQUAL
                MATCH     PTIFC002,PTFCFUND
                GOTO      IFCOTB99 IF NOT EQUAL
                GOTO      IFCOTB50
              ENDIF
            ENDIF
            GOTO      IFCOTB40
          ENDIF
.
          IF        FORM1A=2
            MATCH     PTIFC002,PTFCFUND            * check health fund
            GOTO      IFCOTB99 IF NOT EQUAL
.
            MATCH     SP70,PTIFC001                * check claim code
            IF        !@EQUAL
              MATCH     PTIFC001,PTFCCLTY
              GOTO      IFCOTB10 IF NOT EQUAL
            ENDIF
            GOTO      IFCOTB50
          ENDIF
.
.         it must be using index 3 or 4 (by record type)
.
          MATCH     SP70,PTIFC004                  * check record type
          GOTO      IFCOTB30 IF EQUAL
.
          MATCH     PTIFC004,PTFCRTYP
          GOTO      IFCOTB99 IF NOT EQUAL
.
          MATCH     PTIFC005,PTFCCMAT
          GOTO      IFCOTB99 IF NOT EQUAL
.
          IF        FORM1A=3
            MATCH     SP70,PTIFC001                * check claim code
            IF        !@EQUAL
              MATCH     PTIFC001,PTFCCLTY
              GOTO      IFCOTB99 IF NOT EQUAL
            ENDIF
            MATCH     SP70,PTIFC002                * check health fund
            IF        !@EQUAL
              MATCH     PTIFC002,PTFCFUND
              GOTO      IFCOTB10 IF NOT EQUAL
            ENDIF
            GOTO      IFCOTB70
          ENDIF
.
          IF        FORM1A=4
            MATCH     SP70,PTIFC002                * check health fund
            IF        !@EQUAL
              MATCH     PTIFC002,PTFCFUND
              GOTO      IFCOTB99 IF NOT EQUAL
            ENDIF
            MATCH     SP70,PTIFC001                * check claim code
            IF        !@EQUAL
              MATCH     PTIFC001,PTFCCLTY
              GOTO      IFCOTB10 IF NOT EQUAL
            ENDIF
            GOTO      IFCOTB70
          ENDIF
.
IFCOTB30  MATCH     SP70,PTIFC001                  * check claim code
          IF        !@EQUAL
            MATCH     PTIFC001,PTFCCLTY
            GOTO      IFCOTB10 IF NOT EQUAL
          ENDIF
.
IFCOTB40  MATCH     SP70,PTIFC002                  * check health fund
          IF        !@EQUAL
            MATCH     PTIFC002,PTFCFUND
            GOTO      IFCOTB10 IF NOT EQUAL
          ENDIF
.
IFCOTB50  MATCH     SP70,PTIFC004                 * check record type
          IF        !@EQUAL
            MATCH     PTIFC004,PTFCRTYP
            GOTO      IFCOTB10 IF NOT EQUAL
            MATCH     PTIFC005,PTFCCMAT
            GOTO      IFCOTB10 IF NOT EQUAL
          ENDIF
.
IFCOTB70  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      IFCOTB80
          ENDIF
.
          CALL      IFCORW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      IFCOTB80
          ENDIF
          GOTO      IFCOTB99
.
IFCOTB80  GOTO      IFCOTB10
.
IFCOTB99  RETURN
+
.------------------------------------------------------------
. IFC Other/Consumables Table (TABLE ROW)
.------------------------------------------------------------
IFCORW00  UNPACK    SP70,CASEMIXD,MBSITEMD,ADMNTYPD
          MOVE      PTFCRTYP,F1             * record type
          STORE     PTFCCMAT,F1,CASEMIXD,MBSITEMD,ADMNTYPD
.
          MOVE      SP70,DIM20
          IF        F1=3
            PACK      KEY5,CODEA,ADMNTYPD,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,DIM20         * Cat.A Description
            ENDIF
          ENDIF
.
          PACK      KEY5,CATce,PTFCCTYP,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      SP70,TDESC            * Charge Type Code Description
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptifc001=",PTFCCLTY:
                             "&ptifc002=",PTFCFUND:
                             "&ptifc003=",PTFCHTAB:
                             "&ptifc004=",PTFCRTYP:
                             "&ptifc005=",PTFCCMAT:
                             "&ptifc006=",PTFCCTYP,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle>":
                             "</a>&nbsp;",PTFCCLTY,"</td>":
                             "<td>&nbsp;",PTFCFUND,"</td>":
                             "<td>&nbsp;",PTFCHTAB,"</td>":
                             "<td>&nbsp;",CASEMIXD,"</td>":
                             "<td>&nbsp;",MBSITEMD,"</td>":
                             "<td>&nbsp;",DIM20,"</td>":
                             "<td>&nbsp;",TDESC,"</td>":
                             "<td>&nbsp;",PTFCPAMT,"</td>":
                             "<td>&nbsp;",PTFCRAMT,"</td>":
                             "</tr>"
.
IFCORW99  RETURN
+
.-------------------------------------------------------------------------
. Link to Next IFC Other/Consumables
.-------------------------------------------------------------------------
NEXTIF00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PTIFC001
          REP       " +",PTIFC002
          REP       " +",PTIFC003
          REP       " +",PTIFC004
          REP       " +",PTIFC005
          REP       " +",PTIFC006
          REP       " +",ADMNTYPE
          REP       " +",MBSITEMC
          REP       " +",CASEMIXC
.
          WRITE     HTMLFILE;"patweb78.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&ptifc001=",PTIFC001:
                                 "&ptifc002=",PTIFC002:
                                 "&ptifc003=",PTIFC003:
                                 "&ptifc004=",PTIFC004:
                                 "&ptifc005=",PTIFC005:
                                 "&ptifc006=",PTIFC006:
                                 "&admntype=",ADMNTYPE:
                                 "&mbsitemc=",MBSITEMC:
                                 "&casemixc=",CASEMIXC;
.
          REP       "+ ",PTIFC001
          REP       "+ ",PTIFC002
          REP       "+ ",PTIFC003
          REP       "+ ",PTIFC004
          REP       "+ ",PTIFC005
          REP       "+ ",PTIFC006
          REP       "+ ",ADMNTYPE
          REP       "+ ",MBSITEMC
          REP       "+ ",CASEMIXC
.
NEXTIF99  RETURN
+
.-------------------------------------------------------------
. Link to Prev IFC Other/Consumables
.-------------------------------------------------------------
PREVIF00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PTIFC001
          REP       " +",PTIFC002
          REP       " +",PTIFC003
          REP       " +",PTIFC004
          REP       " +",PTIFC005
          REP       " +",PTIFC006
          REP       " +",ADMNTYPE
          REP       " +",MBSITEMC
          REP       " +",CASEMIXC
.
          WRITE     HTMLFILE;"patweb78.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&ptifc001=",PTIFC001:
                                 "&ptifc002=",PTIFC002:
                                 "&ptifc003=",PTIFC003:
                                 "&ptifc004=",PTIFC004:
                                 "&ptifc005=",PTIFC005:
                                 "&ptifc006=",PTIFC006:
                                 "&admntype=",ADMNTYPE:
                                 "&mbsitemc=",MBSITEMC:
                                 "&casemixc=",CASEMIXC;
.
          REP       "+ ",PTIFC001
          REP       "+ ",PTIFC002
          REP       "+ ",PTIFC003
          REP       "+ ",PTIFC004
          REP       "+ ",PTIFC005
          REP       "+ ",PTIFC006
          REP       "+ ",ADMNTYPE
          REP       "+ ",MBSITEMC
          REP       "+ ",CASEMIXC
.
PREVIF99  RETURN
+
.------------------------------------------------------------
.   Link OEC Table
.------------------------------------------------------------
LOEC0000  CALL      LOCHED00
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     "1",OLDOECIN
          GOTO      LOEC0500 IF EQUAL
.
          MATCH     "1",PTCNOECE
          GOTO      LOEC5000 IF EQUAL
.
LOEC0500  PACK      KEY16,URNUMBER,SP70
          CALL      RSPMELF2
LOEC1000  CALL      RKPMELF2
          BRANCH    OVRCD,LOEC5000
.
          MATCH     URNUMBER,PMEFURNO
          GOTO      LOEC5000 IF NOT EQUAL
.
          MATCH     SP70,PMEFVISN
          GOTO      LOEC2000 IF EQUAL
.
          MATCH     ADMISSNO,PMEFVISN
          GOTO      LOEC2000 IF EQUAL
.
          GOTO      LOEC1000
.
LOEC2000  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LOEC1000
          ENDIF
.
          CALL      LOCROW00
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      LOEC1000 IF NOT EQUAL
.
          GOTO      LOEC9999
.
LOEC5000  MATCH     "1",OLDOECIN
          GOTO      LOEC9999 IF EQUAL
.
          MATCH     "1",PTCNWSIN
          GOTO      LOEC9999 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      LOEC9999 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      LOEC9999 IF NOT EQUAL
.
          PACK      KEY16,URNUMBER,SP70
          CALL      RSWBELF2
LOEC6000  CALL      RKWBELF2
          BRANCH    OVRCD,LOEC9999
.
          MATCH     URNUMBER,WBEFURNO
          GOTO      LOEC9999 IF NOT EQUAL
.
          MATCH     SP70,WBEFVISN
          GOTO      LOEC7000 IF EQUAL
.
          MATCH     ADMISSNO,WBEFVISN
          GOTO      LOEC7000 IF EQUAL
.
          PACK      KEY8,WBEFVISN,SP70   * Display emr visits on OECW link scr
          CALL      RDEMVIS1
          IF        OVRCD=0
            GOTO      LOEC7000
          ENDIF
.
          GOTO      LOEC6000
.
LOEC7000  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LOEC6000
          ENDIF
.
          CALL      LOCRWW00
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      LOEC6000 IF NOT EQUAL
.
LOEC9999  RETURN
+
.------------------------------------------------------------
.   Link OEC Table Header
.------------------------------------------------------------
LOCHED00  WRITE     HTMLFILE;"<tr>":
                  "<td class=HeadingCell>Link</td>":
                  "<td class=HeadingCell>Date & Time</td>":
                  "<td class=HeadingCell>Presenting Illness / MBS</td>":
                  "<td class=HeadingCell>Visit Details</td>":
                  "<td class=HeadingCell>Benefit Limit</td>":
                  "<td class=HeadingCell>Claim Fund <br> Acceptance Code</td>":
                  "<td class=HeadingCell>Co-Pay <br> Description</td>":
                  "<td class=HeadingCell>Excess <br> Amount</td>":
                  "<td class=HeadingCell>Exclusion <br> Description</td>":
                  "<td class=HeadingCell>Visit No. / <br> Eligibility No.</td>":
                  "<td class=HeadingCell>Process Status Code</td>";
          WRITE     HTMLFILE;"</tr>"
.
LOCHED99  RETURN
+
.------------------------------------------------------------
.   Link OEC Table Row
.------------------------------------------------------------
LOCROW00  WRITE     HTMLFILE;"<tr>";
.
          MATCH     SP70,PMEFVISN
          IF        !@EQUAL
            MOVE      PMEFVISN,DIM20
            LJUSTIFY  DIM20
            PACK      DIM20,DIM20,SP70
            PACK      KEY23,DIM20,PMEFCNTR,SP70
            CALL      RDPMEEH1
            IF        OVRCD=1
              CALL      CLPMSEEH
            ENDIF
          ELSE
            MOVE      PMEFELGN,DIM20
            LJUSTIFY  DIM20
            PACK      DIM20,DIM20,SP70
            PACK      KEY23,DIM20,SP1,SP1,ONE,SP70
            CALL      RDPMEEH1
            IF        OVRCD=1
              CALL      CLPMSEEH
            ENDIF
          ENDIF
.
          REP       " +",PMEFELGN
          MATCH     ADMISSNO,PMEFVISN
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><input type=checkbox checked ":
                      "onclick=linkOEC(this); value=",PMEFELGN,"></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox ":
                      "onclick=linkOEC(this); value=",PMEFELGN,"></td>";
          ENDIF
          REP       "+ ",PMEFELGN
.
          UNPACK    PMEFCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<td nowrap>";
          WRITE     HTMLFILE;"<a href='javascript:disOEC(#"",PMEFELGN,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif ":
                             "class=ListIcon></a>";
          WRITE     HTMLFILE;DISPDATE," at ",PMEFCTIM,"</td>";
.
.          MATCH     SP70,PMEFPRIC
.          IF        !@EQUAL
.            PACK      KEY5,CATil,PMEFPRIC,SP70
.            CALL      RDCODE1
.            IF        OVRCD=0
.              WRITE     HTMLFILE;"<td>",TDESC,"</td>";
.            ELSE
.              WRITE     HTMLFILE;"<td>",PMEFPRIC,"</td>";
.            ENDIF
.          ELSE
.            MATCH     SP70,PMEFPRIM
.            IF        !@EQUAL
.              PACK      KEY9,PMEFPRIM,SP70
.              PACK      KEY17,KEY9,SP70
.              CALL      PATITMRD
.              IF        OVRCD=0
.                WRITE     HTMLFILE;"<td>",IDESC,"</td>";
.              ELSE
.                WRITE     HTMLFILE;"<td>",PMEFPRIM,"</td>";
.              ENDIF
.            ELSE
.              WRITE     HTMLFILE;"<td>&nbsp;</td>";
.            ENDIF
.          ENDIF
.
           MATCH     SP70,PMEFPRIM
           IF        !@EQUAL
             PACK      KEY9,PMEFPRIM,SP70
             PACK      KEY17,KEY9,SP70
             CALL      PATITMRD
             IF        OVRCD=0
               WRITE     HTMLFILE;"<td>",IDESC,"</td>";
             ELSE
               WRITE     HTMLFILE;"<td>",PMEFPRIM,"</td>";
             ENDIF
           ELSE
            MATCH     SP70,PMEFPRIC
            IF        !@EQUAL
              PACK      KEY5,CATil,PMEFPRIC,SP70
              CALL      RDCODE1
              IF        OVRCD=0
                WRITE     HTMLFILE;"<td>",TDESC,"</td>";
              ELSE
                WRITE     HTMLFILE;"<td>",PMEFPRIC,"</td>";
              ENDIF
            ELSE
               WRITE     HTMLFILE;"<td>&nbsp;</td>";
            ENDIF
           ENDIF
.
          MATCH     SP70,PMEFEADT
          IF        !@EQUAL
            UNPACK    PMEFEADT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
            WRITE     HTMLFILE;"<td nowrap>",DISPDATE,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp;</td>";
          ENDIF
.
          MOVE      "No ",DIM3
          MATCH     "1",PMHEBENL
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM3,"</td>";
.
          MOVE      "&nbsp;",DIM10
          MATCH     ANSA,PMHECFAC
          IF        @EQUAL
            MOVE      "ACCEPTED",DIM10
          ENDIF
          MATCH     ANSR,PMHECFAC
          IF        @EQUAL
            MOVE      "REJECTED",DIM10
          ENDIF
          MATCH     ANSW,PMHECFAC
          IF        @EQUAL
            MOVE      "WARNING",DIM10
          ENDIF
          MATCH     ANSC,PMHECFAC
          IF        @EQUAL
            MOVE      "COMPLETED",DIM10
          ENDIF
          MATCH     ANSI,PMHECFAC
          IF        @EQUAL
            MOVE      "INTERIM",DIM10
          ENDIF
          PACK      DIM10,DIM10,SP70
          WRITE     HTMLFILE;"<td>",DIM10,"</td>";
.
          MOVE      "No ",DIM3A
          MATCH     "Y",PMHECPDI
          IF        @EQUAL
            MOVE      "Yes",DIM3A
          ENDIF
          MOVE      "No ",DIM3B
          MATCH     "Y",PMHEEADI
          IF        @EQUAL
            MOVE      "Yes",DIM3B
          ENDIF
          MOVE      "No ",DIM3C
          MATCH     "Y",PMHEEXDI
          IF        @EQUAL
            MOVE      "Yes",DIM3C
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM3A,"</td>";
          WRITE     HTMLFILE;"<td>",DIM3B,"</td>";
          WRITE     HTMLFILE;"<td>",DIM3C,"</td>";
.
          WRITE     HTMLFILE;"<td>",PMEFELGN,"&nbsp;",PMEFVISN,"</td>";
.
          WRITE     HTMLFILE;"<td>",PMHEPSCD,"&nbsp;</td>";
.
          WRITE     HTMLFILE;"</tr>"
.
LOCROW99  RETURN
+
.------------------------------------------------------------
. Link to Next
.------------------------------------------------------------
NEX10000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          WRITE     HTMLFILE;"patweb78.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&urnumber=",URNUMBER:
                                 "&admissno=",ADMISSNO:
                                 "&oldoecin=",OLDOECIN;
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
NEX19999  RETURN
.
.-------------------------------------------------------------------------------
. Link to previous
.-------------------------------------------------------------------------------
PRE10000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          WRITE     HTMLFILE;"patweb78.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&urnumber=",URNUMBER:
                                 "&admissno=",ADMISSNO:
                                 "&oldoecin=",OLDOECIN;
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
PREV9999  RETURN
+
.-------------------------------------------------------------------------------
. Cross consulting list to show patient alert icons
.-------------------------------------------------------------------------------
.
GETALR00  PACK      ALRTIMG1,SP70,SP70,SP70,SP70
          PACK      ALRTIMG2,SP70,SP70,SP70,SP70
          PACK      ALRTIMG3,SP70,SP70,SP70,SP70
          PACK      ALRTIMG4,SP70,SP70,SP70,SP70
          PACK      ALRTIMGE,SP70,SP70,SP70,SP70
          PACK      ALRTDISA,SP70,SP70,SP70,SP70
          PACK      ALRTIMGT,SP70,SP70,SP70,SP70:
                             SP70,SP70,SP70,SP70:
                             SP70,SP70,SP70,SP70:
                             SP70,SP70,SP70,SP70:
                             SP70,SP70,SP70,SP70:
                             SP70,SP70,SP70,SP70:
                             SP70
.
          MATCH     "       0",EMVIURNO
          GOTO      GETALR99 IF EQUAL
.
          MOVE      ZERO,EXIT
          PROC      DISPALRT
          IF        EXIT=0 | EXIT=2
.
            REPLACE   " +",EMVIURNO
            REPLACE   " +",DEMVIADM
.
            MATCH     "1",PMPXSIN7
            IF        @EQUAL
              CLEAR     ALRTIMG1
              APPEND    "<img border=0 hspace=2 align=absmiddle",ALRTIMG1
              APPEND    " alt='Medical Alerts'",ALRTIMG1
              APPEND    " onclick=",ALRTIMG1
              APPEND    "document.HiddenFields.alrturno.value='",ALRTIMG1
              APPEND    EMVIURNO,ALRTIMG1
              APPEND    "';", ALRTIMG1
              APPEND    "document.HiddenFields.alrtadmn.value='",ALRTIMG1
              APPEND    DEMVIADM,ALRTIMG1
              APPEND    "';", ALRTIMG1
              APPEND    "PatientAlerts();",ALRTIMG1
              APPEND    " src='../images/AlertIconM.gif'>",ALRTIMG1
              RESET     ALRTIMG1
            ENDIF
.
            MATCH     "1",PMPXSIN8
            IF        @EQUAL
              CLEAR     ALRTIMG2
              APPEND    "<img border=0 hspace=2 align=absmiddle",ALRTIMG2
              APPEND    " alt='Micro Alerts'",ALRTIMG2
              APPEND    " onclick=",ALRTIMG2
              APPEND    "document.HiddenFields.alrturno.value='",ALRTIMG2
              APPEND    EMVIURNO,ALRTIMG2
              APPEND    "';", ALRTIMG2
              APPEND    "document.HiddenFields.alrtadmn.value='",ALRTIMG2
              APPEND    DEMVIADM,ALRTIMG2
              APPEND    "';", ALRTIMG2
              APPEND    "PatientAlerts();",ALRTIMG2
              APPEND    " src='../images/AlertIconB.gif'>",ALRTIMG2
              RESET     ALRTIMG2
            ENDIF
.
            MATCH     "1",PMPXSIN9
            IF        @EQUAL
              CLEAR     ALRTIMG3
              APPEND    "<img border=0 hspace=2 align=absmiddle",ALRTIMG3
              APPEND    " alt='Risk Alerts'",ALRTIMG3
              APPEND    " onclick=",ALRTIMG3
              APPEND    "document.HiddenFields.alrturno.value='",ALRTIMG3
              APPEND    EMVIURNO,ALRTIMG3
              APPEND    "';", ALRTIMG3
              APPEND    "document.HiddenFields.alrtadmn.value='",ALRTIMG3
              APPEND    DEMVIADM,ALRTIMG3
              APPEND    "';", ALRTIMG3
              APPEND    "PatientAlerts();",ALRTIMG3
              APPEND    " src='../images/AlertIconR.gif'>",ALRTIMG3
              RESET     ALRTIMG3
            ENDIF
.
            MATCH     "1",PMPXSN11
            IF        @EQUAL
              CLEAR     ALRTIMG4
              APPEND    "<img border=0 hspace=2 align=absmiddle",ALRTIMG4
              APPEND    " alt='Chronic Alerts'",ALRTIMG4
              APPEND    " onclick=",ALRTIMG4
              APPEND    "document.HiddenFields.alrturno.value='",ALRTIMG4
              APPEND    EMVIURNO,ALRTIMG4
              APPEND    "';", ALRTIMG4
              APPEND    "document.HiddenFields.alrtadmn.value='",ALRTIMG4
              APPEND    DEMVIADM,ALRTIMG4
              APPEND    "';", ALRTIMG4
              APPEND    "PatientAlerts();",ALRTIMG4
              APPEND    " src='../images/AlertIconC.gif'>",ALRTIMG4
              RESET     ALRTIMG4
            ENDIF
.
            MATCH     "1",PTMXSIN1
            IF        @EQUAL
              CLEAR     ALRTIMGE
              APPEND    "<img border=0 hspace=2 align=absmiddle",ALRTIMGE
              APPEND    " alt='Alerts'",ALRTIMGE
              APPEND    " onclick=",ALRTIMGE
              APPEND    "document.HiddenFields.alrturno.value='",ALRTIMGE
              APPEND    EMVIURNO,ALRTIMGE
              APPEND    "';", ALRTIMGE
              APPEND    "document.HiddenFields.alrtadmn.value='",ALRTIMGE
              APPEND    DEMVIADM,ALRTIMGE
              APPEND    "';", ALRTIMGE
              APPEND    "PatientAlerts();",ALRTIMGE
              APPEND    " src='../images/AlertIcon.gif'>",ALRTIMGE
              RESET     ALRTIMGE
              GOTO      GETALR25
            ENDIF
.
            MATCH     "2",PTMXSIN1
            IF        @EQUAL
              CLEAR     ALRTIMGE
              APPEND    "<img border=0 hspace=2 align=absmiddle",ALRTIMGE
              APPEND    " alt='Alerts'",ALRTIMGE
              APPEND    " onclick=",ALRTIMGE
              APPEND    "document.HiddenFields.alrturno.value='",ALRTIMGE
              APPEND    EMVIURNO,ALRTIMGE
              APPEND    "';", ALRTIMGE
              APPEND    "document.HiddenFields.alrtadmn.value='",ALRTIMGE
              APPEND    DEMVIADM,ALRTIMGE
              APPEND    "';", ALRTIMGE
              APPEND    "PatientAlerts();",ALRTIMGE
              APPEND    " src='../images/AlertIconBlack.gif'>",ALRTIMGE
              RESET     ALRTIMGE
              GOTO      GETALR25
            ENDIF
.
            MATCH     "3",PTMXSIN1
            IF        @EQUAL
              CLEAR     ALRTIMGE
              APPEND    "<img border=0 hspace=2 align=absmiddle",ALRTIMGE
              APPEND    " alt='Alerts'",ALRTIMGE
              APPEND    " onclick=",ALRTIMGE
              APPEND    "document.HiddenFields.alrturno.value='",ALRTIMGE
              APPEND    EMVIURNO,ALRTIMGE
              APPEND    "';", ALRTIMGE
              APPEND    "document.HiddenFields.alrtadmn.value='",ALRTIMGE
              APPEND    DEMVIADM,ALRTIMGE
              APPEND    "';", ALRTIMGE
              APPEND    "PatientAlerts();",ALRTIMGE
              APPEND    " src='../images/AlertIconDelete.gif'>",ALRTIMGE
              RESET     ALRTIMGE
              GOTO      GETALR25
            ENDIF
.
            MATCH     "0",PTMXSIN1
            GOTO      GETALR25 IF EQUAL
.
            MATCH     SP70,PTMXSIN1
            IF        !@EQUAL
              CLEAR     ALRTIMGE
              APPEND    "<img border=0 hspace=2 align=absmiddle",ALRTIMGE
              APPEND    " alt='Alerts'",ALRTIMGE
              APPEND    " onclick=",ALRTIMGE
              APPEND    "document.HiddenFields.alrturno.value='",ALRTIMGE
              APPEND    EMVIURNO,ALRTIMGE
              APPEND    "';", ALRTIMGE
              APPEND    "document.HiddenFields.alrtadmn.value='",ALRTIMGE
              APPEND    DEMVIADM,ALRTIMGE
              APPEND    "';", ALRTIMGE
              APPEND    "PatientAlerts();",ALRTIMGE
              APPEND    " src='../images/AlertIcon",ALRTIMGE
              APPEND    PTMXSIN1,ALRTIMGE
              APPEND    ".gif'>",ALRTIMGE
              RESET     ALRTIMGE
            ENDIF
          ENDIF
.
GETALR25  IF        EXIT=1 | EXIT=2
                CLEAR     ALRTDISA
                APPEND    "<img border=0 hspace=4 align=absmiddle",ALRTDISA
                APPEND    " alt='Disability Alerts'",ALRTDISA
                APPEND    " onclick=",ALRTDISA
                APPEND    "document.HiddenFields.alrturno.value='",ALRTDISA
                APPEND    EMVIURNO,ALRTDISA
                APPEND    "';", ALRTDISA
                APPEND    "document.HiddenFields.alrtadmn.value='",ALRTDISA
                APPEND    DEMVIADM,ALRTDISA
                APPEND    "';", ALRTDISA
                APPEND    "PatientAlerts();",ALRTDISA
                APPEND    " src='../images/AlertIconDIS.gif'>",ALRTDISA
                RESET     ALRTDISA
              ENDIF
.
              STRIP     ALRTIMG1
              STRIP     ALRTIMG2
              STRIP     ALRTIMG3
              STRIP     ALRTIMG4
              STRIP     ALRTIMGE
              STRIP     ALRTDISA
              PACK      ALRTIMGT,ALRTIMG1,ALRTIMG2,ALRTIMG3,ALRTIMG4,ALRTIMGE,ALRTDISA
.
GETALR99  REPLACE   "+ ",EMVIURNO
          REPLACE   "+ ",DEMVIADM
          RETURN
+
.-------------------------------------------------------------------------------
. Cross consulting list - get emergency complaint/diagnosis
.-------------------------------------------------------------------------------
.
GETDI000  PACK      DISDIAG,SP70
          PACK      DISDIAGF,SP70
          PACK      COMPDIAG,SP70
.
          PACK      KEY14,EMVIADMN,SP70
          CALL      RSEMVCD1
GETDI211  CALL      RKEMVCD1
          BRANCH    OVRCD,GETDI215
.
          MATCH     DEMVIADM,EMVCVIST
          GOTO      GETDI215 IF NOT EQUAL
.
          COMPARE   EMVCCSYS,ONE
          GOTO      GETDI212 IF EQUAL
.
          COMPARE   EMVCCSYS,FIVE
          GOTO      GETDI211 IF NOT EQUAL
.
GETDI212  MATCH     "000",EMVCSEQU
          GOTO      GETDI211 IF NOT EQUAL
.
          CALL      LOKCOD00
          MOVE      CODEDESC,DISDIAG
.
          MATCH     SP70,EMVCFTXT
          IF        @EQUAL
            MOVE      DISDIAG,DISDIAGF        * Free format diagnosis
          ELSE
            MOVE      EMVCFTXT,DISDIAGF       * Free format diagnosis
          ENDIF
.
GETDI215  PACK      DISDIAG,DISDIAG,SP70
          PACK      DISDIAGF,DISDIAGF,SP70
.
          PACK      COMPDIAG,DISDIAGF,SP70,SP70
          MATCH     SP70,COMPDIAG
          GOTO      GETDI230 IF NOT EQUAL
.
          CLEAR     COMPDIAG
          APPEND    SEMVICO1,COMPDIAG
          APPEND    SP1,COMPDIAG
          APPEND    SEMVICO2,COMPDIAG
.
GETDI230  RESET     COMPDIAG
          STRIP     COMPDIAG
          REP       "#"'\/",COMPDIAG
.
GETDI999  RETURN
+
.------------------------------------------------------------
.  Lookup Code to get description
.------------------------------------------------------------
LOKCOD00  PACK      CODEDESC,SP70
          BRANCH    EMVCCSYS,LOKCOD10,LOKCOD99,LOKCOD99,LOKCOD99,LOKCOD50
.
.   User Defined
.
          GOTO      LOKCOD99
.
LOKCOD10  PACK      KEY9,EMVCMNCD,SP70
          CALL      RDICD1
          IF        OVRCD=1
            MOVE      "Invalid Diagnosis Code ",CODEDESC
            GOTO      LOKCOD99
          ENDIF
.
          MOVE      DDESC,CODEDESC
          GOTO      LOKCOD99
.
LOKCOD50  PACK      KEY9,EMVCMNCD,SP70
          CALL      RDEMICD1
          IF        OVRCD=1
            MOVE      "Invalid Emergency Diagnosis Code",CODEDESC
            GOTO      LOKCOD99
          ENDIF
.
          MOVE      EMICDESC,CODEDESC
          GOTO      LOKCOD99
.
LOKCOD99  RETURN
.
.------------------------------------------------------------
. Patient Attributes for Palliative Pain Assessment
.------------------------------------------------------------
ATTRIB00  COMPARE   ONE,NOATTRIB
          GOTO      ATTRIB91 IF EQUAL
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE             * Display formaction
          GOTO      ATTRIB50 IF EQUAL         
.
          MATCH     "A",UPDTTYPE              * Add formaction
          GOTO      ATTRIB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE              * Update formaction
          GOTO      ATTRIB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE              * Delete formaction
          GOTO      ATTRIB30 IF EQUAL
.
          GOTO      ATTRIB90
.
.         ************ ADD FORMACTION ***********
.
.         Insert to patatraf for attribute type = 14 
.         (Capture Clinic date/time & Q1 to Q5)
.
ATTRIB10  MOVE      "014",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          COMPARE   ZERO,OVRCD
          GOTO      ATTRIB94 IF EQUAL
.
          CALL      CLPATATR
.
          CALL      MVPATATR
.
.         Date seen by Palliative Care Clinicians
.         Mapped to: Attribute type = 14 patatraf.ptartxt1
          PACK      PTARTXT1,CLINDATE,SP70,SP70
.
.         Time seen by Palliative Care Clinicians
.         Mapped to: Attribute type = 14 patatraf.ptartxt2
          PACK      PTARTXT2,CLINTIME,SP70,SP70
.
.         Pain Q1 - Did the patient have pain?
.         Mapped to: Attribute type = 14 patatraf.ptarcod1
          PACK      PTARCOD1,PAINQ001,SP70
.
.         Pain Q2 - Was a validated pain scale used?
.         Mapped to: Attribute type = 14 patatraf.ptarcod2
          PACK      PTARCOD2,PAINQ002,SP70
.
.         Pain Q3 - Pain Score
.         Mapped to: Attribute type = 14 patatraf.ptarval1
          PACK      PTARVAL1,PAINQ003,SP70
.
.         Pain Q4 - Pain assessment completed at first contact/visit?
.         Mapped to: Attribute type = 14 patatraf.ptarcod3
          PACK      PTARCOD3,PAINQ004,SP70
.
.         Pain Q5 - Regular pain assessement conducted?
.         Mapped to: Attribute type = 14 patatraf.ptarcod4
          PACK      PTARCOD4,PAINQ005,SP70
.
.         Set current date and time as Create date and time
.
          CALL      IBACLOCK
          PACK      PTARCDTE,CCC,CYY,CMM,CDD
          REP       " 0",PTARCDTE
          CLOCK     TIME,PTARCTME
          MOVE      USERID,PTARCUSR
          MOVE      PTARCDTE,SAVEDATE
          MOVE      PTARCTME,SAVETIME
.
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      WRPTATR1
.
.         Insert to pataraf for attribute type = 15 
.         (Capture Q6 to Q9)
.
ATTRIB11  MOVE      "015",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          COMPARE   ZERO,OVRCD
          GOTO      ATTRIB94 IF EQUAL
.
          CALL      CLPATATR
.
          CALL      MVPATATR
.
.         Pain Q6 - Patient on opiods?
.         Mapped to: Attribute type = 15 patatraf.ptarcod1
          PACK      PTARCOD1,PAINQ006,SP70
.
.         Pain Q7 - Bowel regimen provided within 24 hours?
.         Mapped to: Attribute type = 15 patatraf.ptarcod2 
          PACK      PTARCOD2,PAINQ007,SP70
.
.         Pain Q8 - Patient on long acting opiod?
.         Mapped to: Attribute type = 15 patatraf.ptarcod3
          PACK      PTARCOD3,PAINQ008,SP70
.
.         Pain Q9 -  Short acting opiod prescribed for breakthrough pain?
.         Mapped to: Attribute type = 15 patatraf.ptarcod4
          PACK      PTARCOD4,PAINQ009,SP70
.
.         Use saved Create date and time
          MOVE      SAVEDATE,PTARCDTE
          MOVE      SAVETIME,PTARCTME 
          MOVE      USERID,PTARCUSR
.
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,FIVE,PTATR002,SP70
          CALL      WRPTATR1
.
.         Insert to pataraf for attribute type = 16
.         (Capture Q10)
.
ATTRIB12  MOVE      "016",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          COMPARE   ZERO,OVRCD
          GOTO      ATTRIB94 IF EQUAL
.
          CALL      CLPATATR
.
          CALL      MVPATATR
.
.         Pain Q10 - Pain medication prescribed at regular intervals?
.         Mapped to: Attribute type = 16 patatraf.ptarcod1
          PACK      PTARCOD1,PAINQ010,SP70
.
.         Use saved Create date and time
          MOVE      SAVEDATE,PTARCDTE
          MOVE      SAVETIME,PTARCTME
          MOVE      USERID,PTARCUSR
.
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      WRPTATR1

          MOVE      ZERO,EXIT
          GOTO      ATTRIB99
.
.         ************ UPDATE FORMACTION **********
.
.         Update to patatraf attribute type = 14
.         (Capture clinic date/time and Q1 to Q5)
.
ATTRIB20  MOVE      "014",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,ATTRIB95
.
.         Date seen by Palliative Care Clinicians
.         Mapped to: Attribute type = 14 patatraf.ptartxt1
          PACK      PTARTXT1,CLINDATE,SP70
.
.         Time seen by Palliative Care Clinicians
.         Mapped to: Attribute type = 14 patatraf.ptartxt2
          PACK      PTARTXT2,CLINTIME,SP70
.
.         Pain Q1 - Did the patient have pain?
.         Mapped to: Attribute type = 14 patatraf.ptarcod1
          PACK      PTARCOD1,PAINQ001,SP70
.
.         Pain Q2 - Was a validated pain scale used?
.         Mapped to: Attribute type = 14 patatraf.ptarcod2
          PACK      PTARCOD2,PAINQ002,SP70
.
.         Pain Q3 - Pain Score
.         Mapped to: Attribute type = 14 patatraf.ptarval1
          PACK      PTARVAL1,PAINQ003,SP70
.
.         Pain Q4 - Pain assessment completed at first contact/visit?
.         Mapped to: Attribute type = 14 patatraf.ptarcod3
          PACK      PTARCOD3,PAINQ004,SP70
.
.         Pain Q5 - Regular pain assessement conducted?
.         Mapped to: Attribute type = 14 patatraf.ptarcod4
          PACK      PTARCOD4,PAINQ005,SP70
.
.         Set current date and time as Update date and time
.
          CALL      IBACLOCK
          PACK      PTARUDTE,CCC,CYY,CMM,CDD
          REP       " 0",PTARUDTE
          CLOCK     TIME,PTARUTME
          MOVE      USERID,PTARUUSR
          MOVE      PTARUDTE,SAVEDATE
          MOVE      PTARUTME,SAVETIME
.
          CALL      UPPTATR1
.
.         Update patatraf for attribute type = 15
.         (Capture Q6 to Q9)
.
ATTRIB21  MOVE      "015",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,ATTRIB95
.
.         Pain Q6 - Patient on opiods?
.         Mapped to: Attribute type = 15 patatraf.ptarcod1
          PACK      PTARCOD1,PAINQ006,SP70
.
.         Pain Q7 - Bowel regimen provided within 24 hours?
.         Mapped to: Attribute type = 15 patatraf.ptarcod2
          PACK      PTARCOD2,PAINQ007,SP70
.
.         Pain Q8 - Patient on long acting opiod?
.         Mapped to: Attribute type = 15 patatraf.ptarcod3
          PACK      PTARCOD3,PAINQ008,SP70
.
.         Pain Q9 -  Short acting opiod prescribed for breakthrough pain?
.         Mapped to: Attribute type = 15 patatraf.ptarcod4
          PACK      PTARCOD4,PAINQ009,SP70

.
.         Use saved Update date and time
.
          MOVE      SAVEDATE,PTARUDTE
          MOVE      SAVETIME,PTARUTME
          MOVE      USERID,PTARUUSR
.
          CALL      UPPTATR1
.
.         Update patatraf for attribute type = 16
.         (Capture Q10)
.
ATTRIB22  MOVE      "016",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,ATTRIB95
.
.         Pain Q10 - Pain medication prescribed at regular intervals?
.         Mapped to: Attribute type = 16 patatraf.ptarcod1
          PACK      PTARCOD1,PAINQ010,SP70
.
.         Use saved Update date and time
.
          MOVE      SAVEDATE,PTARUDTE
          MOVE      SAVETIME,PTARUTME
          MOVE      USERID,PTARUUSR
.
          CALL      UPPTATR1
.
          MOVE      ZERO,EXIT
          GOTO      ATTRIB99
.
.
.         ************ DELETE FORMACTION **********
.
.         Delete patatraf for attribute type = 14
.
ATTRIB30  MOVE      "014",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,ATTRIB95
.
          CALL      DEPTATR1
.
.         Delete patatraf for attribute type = 15
.
ATTRIB31  MOVE      "015",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,ATTRIB95
.
          CALL      DEPTATR1
.
.         Delete patatraf for attribute type = 16
.
ATTRIB32  MOVE      "016",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,ATTRIB95
.
          CALL      DEPTATR1
.
          MOVE      ZERO,EXIT
          GOTO      ATTRIB99
.        
.
.        ************ Display FORMACTION **********
.
ATTRIB50  MATCH     SP70,URNUMBER
          GOTO      ATTRIB92 IF EQUAL
          GOTO      ATTRIB92 IF EOS
.
          PACK      KEY8,URNUMBER,SP70     * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,ATTRIB92
.
          PACK      KEY8,URNUMBER,SP70     * Read Master File Ext 2
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF

.
.         Read patatraf for attribute type = 14
          MOVE      "014",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          IF        OVRCD=1
            CALL      CLPATATR
          ENDIF

.Use individual calls to GETCDV00 for atcodval return for attribute type 15/16
.Use individual calls to GETVAV00 for atvalval return for attribute type 15/16          
          CLEAR     WEBTITLE
          MOVE      "Patient Attributes Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ATTRIB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ATTRIB99
.
ATTRIB90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ATTRIB99
.
ATTRIB91  MOVE      "Patient Attributes System Not Available.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ATTRIB99
.
ATTRIB92  MOVE      "Invalid U/R.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ATTRIB99

.
ATTRIB94  MOVE      "Patient Attributes Records Exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ATTRIB99
.
ATTRIB95  MOVE      "Invalid Patient Attributes Record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ATTRIB99
.
ATTRIB99  RETURN
+
.------------------------------------------------------------
. Output Patient Attribute Field extension
.------------------------------------------------------------
PAIN0000  BRANCH   FLDITMNO,PAIN0010,PAIN0020,PAIN0030,PAIN0040,PAIN0050:
                            PAIN0060,PAIN0070,PAIN0080,PAIN0090,PAIN0100:
                            PAIN0110,PAIN0120
                   
.U/R should be available in PTATR001
.Admission should be avaiable in PTATR002
.Date of Attribute should be available in PTATR003
.Time of Attribute should be available in PTATR004
.
PAIN0010  MOVE      "14",ATTYPIND
          MOVE      "1",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      PAIN9999
.
PAIN0020  MOVE      "14",ATTYPIND
          MOVE      "2",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      PAIN9999
.
PAIN0030  MOVE      "14",ATTYPIND
          MOVE      "3",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      PAIN9999
.
PAIN0040  MOVE      "14",ATTYPIND
          MOVE      "4",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      PAIN9999
.
PAIN0050  MOVE      "15",ATTYPIND           
          MOVE      "1",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      PAIN9999
.
PAIN0060  MOVE      "15",ATTYPIND
          MOVE      "2",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      PAIN9999
.
PAIN0070  MOVE      "15",ATTYPIND
          MOVE      "3",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      PAIN9999
.
PAIN0080  MOVE      "15",ATTYPIND
          MOVE      "4",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      PAIN9999
.
PAIN0090  MOVE      "16",ATTYPIND
          MOVE      "1",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      PAIN9999
.
PAIN0100  MOVE      "14",ATTYPIND
          MOVE      "1",ATTXTIND
          CALL      GETTXV00
          LJUSTIFY  ATTXTVAL
.
          MATCH     SP70,ATTXTVAL
          GOTO      PAIN9999 IF EQUAL 
.
          UNPACK    ATTXTVAL,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PAIN9999
.
PAIN0110  MOVE      "14",ATTYPIND
          MOVE      "2",ATTXTIND
          CALL      GETTXV00
          LJUSTIFY  ATTXTVAL
.
          MATCH     SP70,ATTXTVAL
          GOTO      PAIN9999 IF EQUAL
.
          UNPACK    ATTXTVAL,DIM8
          WRITE     HTMLFILE;DIM8;
          GOTO      PAIN9999
.
PAIN0120  MOVE      "14",ATTYPIND
          MOVE      "1",ATVALIND
          CALL      GETVAV00
          LJUSTIFY  ATVALVAL
          MOVE      ATVALVAL,DIM2
          WRITE     HTMLFILE;DIM2;
          GOTO      PAIN9999
.
PAIN9999  RETURN
.
.-----------------------------------------------------------
. Write EDWARD IP visit alteration record
.------------------------------------------------------------
WEDI0000  MATCH     SP70,PTCNNSSI        * no edward source system
          GOTO      WEDI9999 IF EQUAL
.
          MATCH     "00000000000000000000",PTCNNSSI  * no edward source system
          GOTO      WEDI9999 IF EQUAL
.
          MOVE      ADMISSNO,PMAWVISN
          MOVE      TEN1,PMAWTYPE
          PACK      PMAWOLDV,SP70,SP70,SP70,SP70
          PACK      PMAWNEWV,SP70,SP70,SP70,SP70
.
          CALL      IBACLOCK
          PACK      PMAWCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMAWCDAT
          MOVE      "00:00:00",PMAWCTIM
          PACK      PMAWCUID,USERID
          PACK      PMAWSPAR,SP70,SP70
.
          PACK      KEY27,PMAWCDAT,PMAWCTIM,PMAWVISN,PMAWTYPE,SP70
          CALL      RAPMADW1
          IF        OVRCD=1
            CALL      WRPMADW1
          ELSE
            CALL      UPPMADW1
          ENDIF
.
WEDI9999  RETURN
+
.------------------------------------------------------------------
. Patient Attributes for Palliative Care Breathlessness Assessment
.------------------------------------------------------------------
APCBA000  COMPARE   ONE,NOATTRIB
          GOTO      APCBA910 IF EQUAL
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE             * Display formaction
          GOTO      APCBA500 IF EQUAL         
.
          MATCH     "A",UPDTTYPE              * Add formaction
          GOTO      APCBA100 IF EQUAL
.
          MATCH     "U",UPDTTYPE              * Update formaction
          GOTO      APCBA200 IF EQUAL
.
          MATCH     "D",UPDTTYPE              * Delete formaction
          GOTO      APCBA300 IF EQUAL
.
          GOTO      APCBA900
.
.         ************ ADD FORMACTION ***********
.
.         Insert to patatraf for attribute type = 17 
.         (Capture Clinic date/time & Q1 to Q8b)
.
APCBA100  MOVE      "017",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          COMPARE   ZERO,OVRCD
          GOTO      APCBA940 IF EQUAL
.
          CALL      CLPATATR
.
          CALL      MVPATATR
.
.         Date seen by Palliative Care Clinician
.         Mapped to: Attribute type = 17 patatraf.ptartxt1
          PACK      PTARTXT1,CLINDATE,SP70,SP70
.
.         Time seen by Palliative Care Clinician
.         Mapped to: Attribute type = 17 patatraf.ptartxt2
          PACK      PTARTXT2,CLINTIME,SP70,SP70
.
.         Q1 - Did patient report breathlessness?
.         Mapped to: Attribute type = 17 patatraf.ptarval1
          PACK      PTARVAL1,BRTHQ001,SP70
.
.         Q2 - Breathlessness assessed in 24 hours??
.         Mapped to: Attribute type = 17 patatraf.ptarval2
          PACK      PTARVAL2,BRTHQ002,SP70
.
.         Q2b - Did patient die within 24 hours?
.         Mapped to: Attribute type = 17 patatraf.ptarval3
          PACK      PTARVAL3,BRTHQ02B,SP70
.
.         Q3 - Breathlessness monitored??
.         Mapped to: Attribute type = 17 patatraf.ptarval4
          PACK      PTARVAL4,BRTHQ003,SP70
.
.         Q4 - Validated scale used??
.         Mapped to: Attribute type = 17 patatraf.ptarcod1
          PACK      PTARCOD1,BRTHQ004,SP70
.
.         Q5 - Did patient have moderate/serve breathlessness?
.         Mapped to: Attribute type = 17 patatraf.ptarcod2
          PACK      PTARCOD2,BRTHQ005,SP70
.
.         Q6 - Medication prescribed regularly?
.         Mapped to: Attribute type = 17 patatraf.ptarcod3
          PACK      PTARCOD3,BRTHQ006,SP70
.
.         Q7 - Was Patient on opiods?
.         Mapped to: Attribute type = 17 patatraf.ptarcod4
          PACK      PTARCOD4,BRTHQ007,SP70
.
.         Q8 - Was bowel regimen provided?
.         Mapped to: Attribute type = 17 patatraf.ptartxt3
          PACK      PTARTXT3,BRTHQ008,SP70
.
.         Q8b- Were laxatives not required?
.         Mapped to: Attribute type = 17 patatraf.ptartxt4
          PACK      PTARTXT4,BRTHQ08B,SP70
.
.         Set current date and time as Create date and time
.
          CALL      IBACLOCK
          PACK      PTARCDTE,CCC,CYY,CMM,CDD
          REP       " 0",PTARCDTE
          CLOCK     TIME,PTARCTME
          MOVE      USERID,PTARCUSR
          MOVE      PTARCDTE,SAVEDATE
          MOVE      PTARCTME,SAVETIME
.
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      WRPTATR1
.
.         Insert to pataraf for attribute type = 18 
.         (Capture Q9 to Q10)
.
APCBA110  MOVE      "018",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          COMPARE   ZERO,OVRCD
          GOTO      APCBA940 IF EQUAL
.
          CALL      CLPATATR
.
          CALL      MVPATATR
.
.         Q9 - Patient on long acting opioid?
.         Mapped to: Attribute type = 18 patatraf.ptarval1
          PACK      PTARVAL1,BRTHQ009,SP70
.
.         Q10 - Was short acting opioid prescribed?
.         Mapped to: Attribute type = 18 patatraf.ptarval2 
          PACK      PTARVAL2,BRTHQ010,SP70
.
.         Use saved Create date and time
          MOVE      SAVEDATE,PTARCDTE
          MOVE      SAVETIME,PTARCTME 
          MOVE      USERID,PTARCUSR
.
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,FIVE,PTATR002,SP70
          CALL      WRPTATR1
.
          MOVE      ZERO,EXIT
          GOTO      APCBA999
.
.         ************ UPDATE FORMACTION **********
.
.         Update to patatraf attribute type = 17
.         (Capture clinic date/time and Q1 to Q8b)
.
APCBA200  MOVE      "017",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,APCBA950
.
.
.         Date seen by Palliative Care Clinicians
.         Mapped to: Attribute type = 17 patatraf.ptartxt1
          PACK      PTARTXT1,CLINDATE,SP70,SP70
.
.         Time seen by Palliative Care Clinicians
.         Mapped to: Attribute type = 17 patatraf.ptartxt2
          PACK      PTARTXT2,CLINTIME,SP70,SP70
.
.         Q1 - Did patient report breathlessness?
.         Mapped to: Attribute type = 17 patatraf.ptarval1
          PACK      PTARVAL1,BRTHQ001,SP70
.
.         Q2 - Breathlessness assessed in 24 hours??
.         Mapped to: Attribute type = 17 patatraf.ptarval2
          PACK      PTARVAL2,BRTHQ002,SP70
.
.         Q2b - Did patient die within 24 hours?
.         Mapped to: Attribute type = 17 patatraf.ptarval3
          PACK      PTARVAL3,BRTHQ02B,SP70
.
.         Q3 - Breathlessness monitored??
.         Mapped to: Attribute type = 17 patatraf.ptarval4
          PACK      PTARVAL4,BRTHQ003,SP70
.
.         Q4 - Validated scale used??
.         Mapped to: Attribute type = 17 patatraf.ptarcod1
          PACK      PTARCOD1,BRTHQ004,SP70
.
.         Q5 - Did patient have moderate/serve breathlessness?
.         Mapped to: Attribute type = 17 patatraf.ptarcod2
          PACK      PTARCOD2,BRTHQ005,SP70
.
.         Q6 - Medication prescribed regularly?
.         Mapped to: Attribute type = 17 patatraf.ptarcod3
          PACK      PTARCOD3,BRTHQ006,SP70
.
.         Q7 - Was Patient on opiods?
.         Mapped to: Attribute type = 17 patatraf.ptarcod4
          PACK      PTARCOD4,BRTHQ007,SP70
.
.         Q8 - Was bowel regimen provided?
.         Mapped to: Attribute type = 17 patatraf.ptartxt3
          PACK      PTARTXT3,BRTHQ008,SP70
.
.         Q8b- Were laxatives not required?
.         Mapped to: Attribute type = 17 patatraf.ptartxt4
          PACK      PTARTXT4,BRTHQ08B,SP70
.
.         Set current date and time as Update date and time
.
          CALL      IBACLOCK
          PACK      PTARUDTE,CCC,CYY,CMM,CDD
          REP       " 0",PTARUDTE
          CLOCK     TIME,PTARUTME
          MOVE      USERID,PTARUUSR
          MOVE      PTARUDTE,SAVEDATE
          MOVE      PTARUTME,SAVETIME
.
          CALL      UPPTATR1
.
.         Update patatraf for attribute type = 18
.         (Capture Q9 to Q10)
.
APCBA210  MOVE      "018",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,APCBA950
.
.         Q9 - Patient on long acting opioid?
.         Mapped to: Attribute type = 18 patatraf.ptarval1
          PACK      PTARVAL1,BRTHQ009,SP70
.
.         Q10 - Was short acting opioid prescribed?
.         Mapped to: Attribute type = 18 patatraf.ptarval2
          PACK      PTARVAL2,BRTHQ010,SP70
.
.         Use saved Update date and time
.
          MOVE      SAVEDATE,PTARUDTE
          MOVE      SAVETIME,PTARUTME
          MOVE      USERID,PTARUUSR
.
          CALL      UPPTATR1
.
          MOVE      ZERO,EXIT
          GOTO      APCBA999
.
.
.         ************ DELETE FORMACTION **********
.
.         Delete patatraf for attribute type = 17
.
APCBA300  MOVE      "017",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,APCBA950
.
          CALL      DEPTATR1
.
.         Delete patatraf for attribute type = 18
.
APCBA310  MOVE      "018",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,APCBA950
.
          CALL      DEPTATR1
.
          MOVE      ZERO,EXIT
          GOTO      APCBA999
.        
.
.        ************ Display FORMACTION **********
.
APCBA500  MATCH     SP70,URNUMBER
          GOTO      APCBA920 IF EQUAL
          GOTO      APCBA920 IF EOS
.
          PACK      KEY8,URNUMBER,SP70     * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,APCBA920
.
          PACK      KEY8,URNUMBER,SP70     * Read Master File Ext 2
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF

.
.         Read patatraf for attribute type = 17
          MOVE      "017",PTATR005
          PACK      KEY35,PTATR001,PTATR003,PTATR004,PTATR005,PTATR002,SP70
          CALL      RDPTATR1
          IF        OVRCD=1
            CALL      CLPATATR
          ENDIF

.Use individual calls to GETVAV00 for atvalval return for attribute type 17/18
.Use individual calls to GETCDV00 for atvalcod return for attribute type 17/18
.Use individual calls to GETTXV00 for atvaltxt return for attribute type 17/18
.
          CLEAR     WEBTITLE
          MOVE      "Patient Attributes Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,APCBA999
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      APCBA999
.
APCBA900  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      APCBA999
.
APCBA910  MOVE      "Patient Attributes System Not Available.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      APCBA999
.
APCBA920  MOVE      "Invalid U/R.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      APCBA999
.
APCBA940  MOVE      "Patient Attributes Records Exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      APCBA999
.
APCBA950  MOVE      "Invalid Patient Attributes Record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      APCBA999
.
APCBA999  RETURN
+
.------------------------------------------------------------
. Output Patient Attribute Field extension
.------------------------------------------------------------
BREA0000  BRANCH   FLDITMNO,BREA0010,BREA0020,BREA0030,BREA0040,BREA0050:
                            BREA0060,BREA0070,BREA0080,BREA0090,BREA0100:
                            BREA0110,BREA0120,BREA0130,BREA0140
                   
.U/R should be available in PTATR001
.Admission should be avaiable in PTATR002
.Date of Attribute should be available in PTATR003
.Time of Attribute should be available in PTATR004
.
BREA0010  MOVE      "17",ATTYPIND
          MOVE      "1",ATVALIND
          CALL      GETVAV00
          LJUSTIFY  ATVALVAL
          MOVE      ATVALVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0020  MOVE      "17",ATTYPIND
          MOVE      "2",ATVALIND
          CALL      GETVAV00
          LJUSTIFY  ATVALVAL
          MOVE      ATVALVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0030  MOVE      "17",ATTYPIND
          MOVE      "3",ATVALIND
          CALL      GETVAV00
          LJUSTIFY  ATVALVAL
          MOVE      ATVALVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0040  MOVE      "17",ATTYPIND
          MOVE      "4",ATVALIND
          CALL      GETVAV00
          LJUSTIFY  ATVALVAL
          MOVE      ATVALVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0050  MOVE      "17",ATTYPIND
          MOVE      "1",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0060  MOVE      "17",ATTYPIND
          MOVE      "2",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0070  MOVE      "17",ATTYPIND
          MOVE      "3",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0080  MOVE      "17",ATTYPIND
          MOVE      "4",ATCODIND
          CALL      GETCDV00
          LJUSTIFY  ATCODVAL
          MOVE      ATCODVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0090  MOVE      "17",ATTYPIND
          MOVE      "1",ATTXTIND
          CALL      GETTXV00
          LJUSTIFY  ATTXTVAL
.
          MATCH     SP70,ATTXTVAL
          GOTO      BREA9999 IF EQUAL 
.
          UNPACK    ATTXTVAL,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BREA9999
.
BREA0100  MOVE      "17",ATTYPIND
          MOVE      "2",ATTXTIND
          CALL      GETTXV00
          LJUSTIFY  ATTXTVAL
.
          MATCH     SP70,ATTXTVAL
          GOTO      BREA9999 IF EQUAL
.
          UNPACK    ATTXTVAL,DIM8
          WRITE     HTMLFILE;DIM8;
          GOTO      BREA9999
.
BREA0110  MOVE      "17",ATTYPIND
          MOVE      "3",ATTXTIND
          CALL      GETTXV00
          LJUSTIFY  ATTXTVAL
.
          MATCH     SP70,ATTXTVAL
          GOTO      BREA9999 IF EQUAL
.
          UNPACK    ATTXTVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0120  MOVE      "17",ATTYPIND
          MOVE      "4",ATTXTIND
          CALL      GETTXV00
          LJUSTIFY  ATTXTVAL
.
          MATCH     SP70,ATTXTVAL
          GOTO      BREA9999 IF EQUAL
.
          UNPACK    ATTXTVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0130  MOVE      "18",ATTYPIND
          MOVE      "1",ATVALIND
          CALL      GETVAV00
          LJUSTIFY  ATVALVAL
          MOVE      ATVALVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA0140  MOVE      "18",ATTYPIND
          MOVE      "2",ATVALIND
          CALL      GETVAV00
          LJUSTIFY  ATVALVAL
          MOVE      ATVALVAL,DIM1
          WRITE     HTMLFILE;DIM1;
          GOTO      BREA9999
.
BREA9999  RETURN
+
.******************************************************************************
.*                                EDWH0000                                    *
.******************************************************************************
EDWH0000  READ      CONTROLF,HUND25;*93,PTCNNSSI
          MATCH     SP70,PTCNNSSI           * no edward source system
          GOTO      EDWH9999 IF EQUAL
.
          MATCH     "00000000000000000000",PTCNNSSI  * no edward source system
          GOTO      EDWH9999 IF EQUAL
.
          PACK      PTMIS013,PTMIS013,SP70  * Pad with spaces if EOS
          PACK      PFUNDH,PFUNDH,SP70      * Pad with spaces if EOS
.
          MATCH     PFUNDH,PTMIS013         * Different Health Fund
          GOTO      EDWH9999 IF EQUAL
.
          MATCH     SP70,PFUNDH
          IF        @EQUAL
            MOVE      "25",PMEWTYPE       * Health Fund Added
          ELSE
            MOVE      "26",PMEWTYPE       * Health Fund Changed
          ENDIF
.
          PACK      PMEWOLDV,PFUNDH,SP70
          PACK      PMEWNEWV,PTMIS013,SP70
          CALL      WREDW000
.
EDWH9999  RETURN
+
.******************************************************************************
.*                                 WREDW000                                   *
.* If any of the EDWWARD variables have changed, write/update pmsedwaf        *
.******************************************************************************
WREDW000  MOVE      PURNO,PMEWURNO
          CALL      IBACLOCK
          PACK      PMEWCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMEWCDAT
          CLOCK     TIME,PMEWCTIM
          PACK      PMEWCUID,USERID
          PACK      PMEWTYPE,PMEWTYPE,SP70
          PACK      PMEWSPAR,SP70,SP70
.
          PACK      KEY27,PMEWURNO,PMEWTYPE,PMEWCDAT,PMEWCTIM,SP70
          CALL      RAPMEDW2
          IF        OVRCD=1
            CALL      WRPMEDW2
          ELSE
            CALL      UPPMEDW2
          ENDIF
.
WREDW999  RETURN
.
.------------------------------------------------------------
.   Emergency OEC List
.------------------------------------------------------------
EOEC0000  MATCH     "1",PTCNOECE
          GOTO      EOEC5000 IF EQUAL
.
          PACK      KEY16,URNUMBER,SP70
          CALL      RSPMELF2
EOEC1000  CALL      RKPMELF2
          BRANCH    OVRCD,EOEC5000
.
          MATCH     URNUMBER,PMEFURNO
          GOTO      EOEC5000 IF NOT EQUAL
.
          PACK      KEY11,PMEFELGN,SP1,SP1,ONE,SP70
          CALL      RDPMOEC1
          BRANCH    OVRCD,EOEC1000
.
          CALL      EOER0000
.
          GOTO      EOEC1000
.
EOEC5000  MATCH     "1",PTCNWSIN
          GOTO      EOEC9999 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      EOEC9999 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      EOEC9999 IF NOT EQUAL
.
          PACK      KEY16,URNUMBER,SP70
          CALL      RSWBELF2
EOEC6000  CALL      RKWBELF2
          BRANCH    OVRCD,EOEC9999
.
          MATCH     URNUMBER,WBEFURNO
          GOTO      EOEC9999 IF NOT EQUAL
.
          PACK      KEY11,WBEFELGN,SP1,SP1,ONE,SP70
          CALL      RDWBOEC1
          BRANCH    OVRCD,EOEC6000
.
          CALL      EOEW0000
.
          GOTO      EOEC6000
.
EOEC9999  RETURN
+
.------------------------------------------------------------
.   UR Only OEC Response Table Row
.------------------------------------------------------------
EOER0000  CLEAR     HTMLLINK
          APPEND    "javascript:disElg('",HTMLLINK
          APPEND    PMEFELGN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:disOEC('",HTMLLNK2
          APPEND    PMEFELGN,HTMLLNK2
          APPEND    "')",HTMLLNK2
          RESET     HTMLLNK2
.
          MOVE      SP70,DIM70
.
          MATCH     " 0",PMOESTAT
          IF        @EQUAL
            MOVE      "Waiting",DIM70
          ENDIF          
          MATCH     " 1",PMOESTAT
          IF        @EQUAL
            MOVE      "Extracted",DIM70
          ENDIF
          MATCH     " 2",PMOESTAT
          IF        @EQUAL
            MOVE      "Received",DIM70
          ENDIF
          MATCH     " 3",PMOESTAT
          IF        @EQUAL
            MOVE      "SA Error: ",DIM12
            PACK      DIM12,DIM12
            PACK      DIM70,DIM12,SP1,PMOEERRC,SP1,PMOEERRD,SP70
          ENDIF
          MATCH     " 4",PMOESTAT
          IF        @EQUAL
            MOVE      "Data Error: ",DIM12
            PACK      DIM12,DIM12
            PACK      DIM70,DIM12,SP1,PMOEERRC,SP1,PMOEERRD,SP70
          ENDIF
          MATCH     " 5",PMOESTAT
          IF        @EQUAL
            MOVE      "Rejected Reported",DIM70
          ENDIF
          MATCH     " 6",PMOESTAT
          IF        @EQUAL
            MOVE      "Complete Reported",DIM70
          ENDIF
          MATCH     " 7",PMOESTAT
          IF        @EQUAL
            MOVE      "Health Fund Unavailable",DIM70
          ENDIF
          PACK      DIM70,DIM70,SP70
.
          MOVE      SP70,ELGRESIN
          PACK      DIM20,PMEFELGN,SP70
          LJUSTIFY  DIM20
.
          PACK      KEY23,DIM20,SP70
          CALL      RSPMEEH1
          CALL      RKPMEEH1
          IF        OVRCD=0
            MATCH     DIM20,PMHEARID
            IF        @EQUAL
              MOVE      ONE,ELGRESIN
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                    "#"",HTMLLNK2,"#",":
                                    "#"",PMEFCDAT,PMEFCTIM,"#",":
                                    "#"",PMEFELGN,"#",":
                                    "#"",PMEFVISN,"#",":
                                    "#"",PMEFEADT,"#",":
                                    "#"",PMEFHFND,"#",":
                                    "#"",PMEFHFNT,"#",";
.
          MATCH      "1",ELGRESIN
          IF         @EQUAL
            WRITE      HTMLFILE;"#"<input type=button value='Response'":
                     "onclick=disOEC('",PMEFELGN,"'); class='orangebutton'>#",";
          ELSE
            WRITE     HTMLFILE;"#"",DIM70,"#",";
          ENDIF
.
          MATCH     "1",ELGRESIN
          IF         @EQUAL
            WRITE     HTMLFILE;"#"#",";
          ELSE
            WRITE     HTMLFILE;"#"<input type=button value='Delete' ":
                             "onclick=deleteFreeFormatOEC('",PMEFELGN,"') ":
                             "class='button'>#","; 
          ENDIF
.
          WRITE     HTMLFILE;"#"<input type=button value='Re-submit' ":
                             "onclick=resubOEC('",PMEFELGN,"') ":
                             "class='button'>#")"
.
EOER9999  RETURN
+
.------------------------------------------------------------
.   Tag for number of links
.------------------------------------------------------------
IOEC0000  MOVE      ZERO,LOECCNTR
.
          MATCH     "1",OLDOECIN
          GOTO      IOEC0500 IF EQUAL
.
          MATCH     "1",PTCNOECE
          GOTO      IOEC5000 IF EQUAL
.
IOEC0500  PACK      KEY16,URNUMBER,SP70
          CALL      RSPMELF2
IOEC1000  CALL      RKPMELF2
          BRANCH    OVRCD,IOEC4000
.
          MATCH     URNUMBER,PMEFURNO
          GOTO      IOEC4000 IF NOT EQUAL
.
          MATCH     ADMISSNO,PMEFVISN
          GOTO      IOEC1000 IF NOT EQUAL
.
          ADD       ONE,LOECCNTR
.
          GOTO      IOEC1000
.
IOEC4000  WRITE     HTMLFILE;LOECCNTR;
.
          GOTO      IOEC9999
.
IOEC5000  MATCH     "1",PTCNWSIN
          GOTO      IOEC9999 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      IOEC9999 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      IOEC9999 IF NOT EQUAL
.
          PACK      KEY16,URNUMBER,SP70
          CALL      RSWBELF2
IOEC6000  CALL      RKWBELF2
          BRANCH    OVRCD,IOEC9000
.
          MATCH     URNUMBER,WBEFURNO
          GOTO      IOEC9000 IF NOT EQUAL
.
          MATCH     ADMISSNO,WBEFVISN
          GOTO      IOEC6000 IF NOT EQUAL
.
          ADD       ONE,LOECCNTR
.
          GOTO      IOEC6000
.
IOEC9000  WRITE     HTMLFILE;LOECCNTR;
.
          GOTO      IOEC9999
.
IOEC9999  RETURN
+
.------------------------------------------------------------------------
.   Get last occurence of MBS item from pmselfaf for an admission number
.------------------------------------------------------------------------
GELF0000  MOVE      ZERO,GELFINDC
          MOVE      SP70,GELFSTAT
          MOVE      SP70,GELFCFEC
          MOVE      SP70,GELFCFET
.
          PACK      KEY16,OPDAURNO,Z70
          CALL      RSPMELF2
GELF1000  CALL      RPPMELF2
          BRANCH    OVRCD,GELF9999
.
          MATCH     OPDAURNO,PMEFURNO
          GOTO      GELF9999 IF NOT EQUAL
.
          MATCH     OPDAADMN,PMEFVISN
          GOTO      GELF1000 IF NOT EQUAL
.
          MATCH     GELF0MBS,PMEFPRIM
          GOTO      GELF1000 IF NOT EQUAL
.
          MOVE      PMEFVISN,KEY20
          LJUSTIFY  KEY20
          PACK      KEY23,KEY20,PMEFCNTR,SP70
          CALL      RDPMEEH1
          BRANCH    OVRCD,GELF9000
.
          MATCH     "A",PMHECFAC
          IF        @EQUAL
            MOVE      "ACCEPTED",GELFSTAT
          ENDIF
.
          MATCH     "R",PMHECFAC
          IF        @EQUAL
            MOVE      "REJECTED",GELFSTAT
          ENDIF
.
          MATCH     "W",PMHECFAC
          IF        @EQUAL
            MOVE      "WARNING",GELFSTAT
          ENDIF
.
          MATCH     "C",PMHECFAC
          IF        @EQUAL
            MOVE      "COMPLETED",GELFSTAT
          ENDIF
.
          PACK      KEY30,KEY20,PMEFCNTR,SP70
          CALL      RSPMEED1
          CALL      RKPMEED1
          BRANCH    OVRCD,GELF9000
.
          MATCH     KEY20,PMDEARID
          GOTO      GELF9000 IF NOT EQUAL
.
          MATCH     PMEFCNTR,PMDERPTC
          GOTO      GELF9000 IF NOT EQUAL
.
          MOVE      PMDECFEC,GELFCFEC
          MOVE      PMDECFET,GELFCFET
.
GELF9000  MOVE      ONE,GELFINDC
.
GELF9999  RETURN
+
.------------------------------------------------------------
.   Clear webeehaf
.------------------------------------------------------------
CLWBEH00  PACK      WBEHARID,SP70
          PACK      WBEHRPTC,SP70
          PACK      WBEHCTID,SP70
          PACK      WBEHBENL,SP70
          PACK      WBEHCFAC,SP70
          PACK      WBEHCPAM,SP70
          PACK      WBEHCPDR,SP70
          PACK      WBEHCPDI,SP70
          PACK      WBEHCPFN,SP70
          PACK      WBEHCPMN,SP70
          PACK      WBEHCPRN,SP70
          PACK      WBEHEXAM,SP70
          PACK      WBEHEADI,SP70
          PACK      WBEHEXBA,SP70
          PACK      WBEHEXDI,SP70
          PACK      WBEHFSTA,SP70
          PACK      WBEHFRID,SP70
          PACK      WBEHFSCD,SP70
          PACK      WBEHMSCD,SP70
          PACK      WBEHPEAI,SP70
          PACK      WBEHPSCD,SP70
          PACK      WBEHTNAM,SP70
          PACK      WBEHTBDI,SP70
          PACK      WBEHTBSC,SP70
          PACK      WBEHVCID,SP70
          PACK      WBEHCDTE,SP70
          PACK      WBEHCTIM,SP70
          PACK      WBEHCUID,SP70
          PACK      WBEHUDTE,SP70
          PACK      WBEHUTIM,SP70
          PACK      WBEHUUID,SP70
          PACK      WBEHSPAR,SP70
.
CLWBEH99  RETURN
+
.*******************************************************************************
.        Set weboes variables
.*******************************************************************************
SEWOES00  MATCH     SP70,WBEFSRV1
          IF        !@EQUAL & !@EOS
            CALL      CLWEBOES
            MOVE      WBEFELGN,WBOSVISN
            MOVE      "  1",WBOSCNTR
            MOVE      "  1",WBOSSCNT
            MOVE      "6",WBOSRTYP
            MOVE      WBEFSRV1,WBOSITEM
.
            MOVE      "  1",WBOSQUAN
            MATCH     SP70,PTELF028
            IF        !@EQUAL
              MOVE      PTELF028,WBOSQUAN
            ENDIF
.
            MOVE      WBEFEADT,WBOSPDTE
            PACK      WBOSCDTE,CCC,CYY,CMM,CDD
            REP       " 0",WBOSCDTE
            CLOCK     TIME,CTIMEIS
            MOVE      CTIMEIS,WBOSCTIM
            MOVE      SP70,WBOSSPAR
.
            PACK      KEY14,WBOSVISN,WBOSCNTR,WBOSSCNT,SP70
            CALL      RAWBOES1
            IF        OVRCD=1
              CALL      WRWBOES1
            ENDIF
          ENDIF
.
          MATCH     SP70,WBEFSRV2
          IF        !@EQUAL & !@EOS
            CALL      CLWEBOES
            MOVE      WBEFELGN,WBOSVISN
            MOVE      "  1",WBOSCNTR
            MOVE      "  2",WBOSSCNT
            MOVE      "6",WBOSRTYP
            MOVE      WBEFSRV2,WBOSITEM
.
            MOVE      "  1",WBOSQUAN
            MATCH     SP70,PTELF029
            IF        !@EQUAL
              MOVE      PTELF029,WBOSQUAN
            ENDIF
.
            MOVE      WBEFEADT,WBOSPDTE
            PACK      WBOSCDTE,CCC,CYY,CMM,CDD
            REP       " 0",WBOSCDTE
            CLOCK     TIME,CTIMEIS
            MOVE      CTIMEIS,WBOSCTIM
            MOVE      SP70,WBOSSPAR
.
            PACK      KEY14,WBOSVISN,WBOSCNTR,WBOSSCNT,SP70
            CALL      RAWBOES1
            IF        OVRCD=1
              CALL      WRWBOES1
            ENDIF
          ENDIF
.
          MATCH     SP70,WBEFSRV3
          IF        !@EQUAL & !@EOS
            CALL      CLWEBOES
            MOVE      WBEFELGN,WBOSVISN
            MOVE      "  1",WBOSCNTR
            MOVE      "  3",WBOSSCNT
            MOVE      "6",WBOSRTYP
            MOVE      WBEFSRV3,WBOSITEM
.
            MOVE      "  1",WBOSQUAN
            MATCH     SP70,PTELF030
            IF        !@EQUAL
              MOVE      PTELF030,WBOSQUAN
            ENDIF
.
            MOVE      WBEFEADT,WBOSPDTE
            PACK      WBOSCDTE,CCC,CYY,CMM,CDD
            REP       " 0",WBOSCDTE
            CLOCK     TIME,CTIMEIS
            MOVE      CTIMEIS,WBOSCTIM
            MOVE      SP70,WBOSSPAR
.
            PACK      KEY14,WBOSVISN,WBOSCNTR,WBOSSCNT,SP70
            CALL      RAWBOES1
            IF        OVRCD=1
              CALL      WRWBOES1
            ENDIF
          ENDIF
.
          MATCH     SP70,WBEFSRV4
          IF        !@EQUAL & !@EOS
            CALL      CLWEBOES
            MOVE      WBEFELGN,WBOSVISN
            MOVE      "  1",WBOSCNTR
            MOVE      "  4",WBOSSCNT
            MOVE      "6",WBOSRTYP
            MOVE      WBEFSRV4,WBOSITEM
.
            MOVE      "  1",WBOSQUAN
            MATCH     SP70,PTELF031
            IF        !@EQUAL
              MOVE      PTELF031,WBOSQUAN
            ENDIF
.
            MOVE      WBEFEADT,WBOSPDTE
            PACK      WBOSCDTE,CCC,CYY,CMM,CDD
            REP       " 0",WBOSCDTE
            CLOCK     TIME,CTIMEIS
            MOVE      CTIMEIS,WBOSCTIM
            MOVE      SP70,WBOSSPAR
.
            PACK      KEY14,WBOSVISN,WBOSCNTR,WBOSSCNT,SP70
            CALL      RAWBOES1
            IF        OVRCD=1
              CALL      WRWBOES1
            ENDIF
          ENDIF
.
          MATCH     SP70,WBEFSRV5
          IF        !@EQUAL & !@EOS
            CALL      CLWEBOES
            MOVE      WBEFELGN,WBOSVISN
            MOVE      "  1",WBOSCNTR
            MOVE      "  5",WBOSSCNT
            MOVE      "6",WBOSRTYP
            MOVE      WBEFSRV5,WBOSITEM
.
            MOVE      "  1",WBOSQUAN
            MATCH     SP70,PTELF032
            IF        !@EQUAL
              MOVE      PTELF032,WBOSQUAN
            ENDIF
.
            MOVE      WBEFEADT,WBOSPDTE
            PACK      WBOSCDTE,CCC,CYY,CMM,CDD
            REP       " 0",WBOSCDTE
            CLOCK     TIME,CTIMEIS
            MOVE      CTIMEIS,WBOSCTIM
            MOVE      SP70,WBOSSPAR
.
            PACK      KEY14,WBOSVISN,WBOSCNTR,WBOSSCNT,SP70
            CALL      RAWBOES1
            IF        OVRCD=1
              CALL      WRWBOES1
            ENDIF
          ENDIF
.
SEWOES99  RETURN
+
.*******************************************************************************
.        Set weboec variables
.*******************************************************************************
SEWOEC00  MOVE      WBEFELGN,WBOCVISN
          MOVE      "  1",WBOCCNTR
          MOVE      " 0",WBOCSTAT
          MOVE      WBEFURNO,WBOCURNO
          MOVE      WBEFELGN,WBOCARID
          PACK      WBOCARID,WBOCARID,SP70
          LJUSTIFY  WBOCARID
          MOVE      SP70,WBOCTRID
          CALL      IBACLOCK
          PACK      WBOCRQDT,CCC,CYY,CMM,CDD
          REP       " 0",WBOCRQDT
          MOVE      SP70,WBOCETYP
          MOVE      SP70,WBOCERRC
          PACK      WBOCERRD,SP70,SP70
          PACK      WBOCCDTE,CCC,CYY,CMM,CDD
          REP       " 0",WBOCCDTE
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,WBOCCTIM
          MOVE      SP70,WBOCUDTE
          MOVE      SP70,WBOCUTIM
          MOVE      SP70,WBOCHOSP
.
          IF        IBCNMHOS=1
            MOVE      WBSEHOSP,WBOCHOSP
          ENDIF
.
          MOVE      SP70,WBOCELEG
.
          MOVE      USERID,WBOCCUID              * web user id
          MOVE      SP70,WBOCUUID
.
          MOVE      SP70,WBOCSPAR
.
SEWOEC99  RETURN
+
.-----------------------------------------------------------
.         Set up free format OECW fields
.-----------------------------------------------------------
STEW0000  MATCH     SP70,PTELF001
          IF        !@EQUAL
            MOVE      PTELF001,WBEFURNO
          ENDIF
.
          MATCH     SP70,PTELF002
          IF        !@EQUAL
            MOVE      PTELF002,WBEFOECC
          ENDIF
.
          MATCH     SP70,PTELF003
          IF        !@EQUAL
            MOVE      PTELF003,WBEFTITL
          ENDIF
.
          MATCH     SP70,PTELF004
          IF        !@EQUAL
            MOVE      PTELF004,WBEFFNAM
          ENDIF
.
          MATCH     SP70,PTELF005
          IF        !@EQUAL
            MOVE      PTELF005,WBEFSNAM
          ENDIF
.
          MATCH     SP70,PTELF006
          IF        !@EQUAL
            MOVE      PTELF006,WBEFHFGN
          ENDIF
.
          MATCH     SP70,PTELF007
          IF        !@EQUAL
            MOVE      PTELF007,WBEFHFSN
          ENDIF
.
          MATCH     SP70,PTELF008
          IF        !@EQUAL
            MOVE      PTELF008,WBEFGEND
          ENDIF
.
          MATCH     SP70,PTELF009
          IF        !@EQUAL
            MOVE      PTELF009,WBEFBDAT
          ENDIF
.
          MATCH     SP70,PTELF010
          IF        !@EQUAL
            MOVE      PTELF010,WBEFEADT
          ENDIF
.
          MATCH     SP70,PTELF011
          IF        !@EQUAL
            MOVE      PTELF011,WBEFISTY
          ENDIF
.
          MATCH     SP70,PTELF012
          IF        !@EQUAL
            MOVE      PTELF012,WBEFPLOS
          ENDIF
.
          MATCH     SP70,PTELF013
          IF        !@EQUAL
            MOVE      PTELF013,WBEFDINT
          ENDIF
.
          MATCH     SP70,PTELF014
          IF        !@EQUAL
            MOVE      PTELF014,WBEFPEAI
          ENDIF
.
          MATCH     SP70,PTELF015
          IF        !@EQUAL
            MOVE      PTELF015,WBEFEMAD
          ENDIF
.
          MATCH     SP70,PTELF016
          IF        !@EQUAL
            MOVE      PTELF016,WBEFPRIC
          ENDIF
.
          MATCH     SP70,PTELF017
          IF        !@EQUAL
            MOVE      PTELF017,WBEFPRIM
          ENDIF
.
          MATCH     SP70,PTELF018
          IF        !@EQUAL
            MOVE      PTELF018,WBEFCLTY
          ENDIF
.
          MATCH     SP70,PTELF019
          IF        !@EQUAL
            MOVE      PTELF019,WBEFHFND
          ENDIF
.
          MATCH     SP70,PTELF020
          IF        !@EQUAL
            MOVE      PTELF020,WBEFHFNT
          ENDIF
.
          MATCH     SP70,PTELF021
          IF        !@EQUAL
            MOVE      PTELF021,WBEFHFMN
          ENDIF
.
          MATCH     SP70,PTELF022
          IF        !@EQUAL
            MOVE      PTELF022,WBEFDIAG
          ENDIF
.
          MATCH     SP70,PTELF023
          IF        !@EQUAL
            MOVE      PTELF023,WBEFSRV1
          ENDIF
.
          MATCH     SP70,PTELF024
          IF        !@EQUAL
            MOVE      PTELF024,WBEFSRV2
          ENDIF
.
          MATCH     SP70,PTELF025
          IF        !@EQUAL
            MOVE      PTELF025,WBEFSRV3
          ENDIF
.
          MATCH     SP70,PTELF026
          IF        !@EQUAL
            MOVE      PTELF026,WBEFSRV4
          ENDIF
.
          MATCH     SP70,PTELF027
          IF        !@EQUAL
            MOVE      PTELF027,WBEFSRV5
          ENDIF
.
          MOVE      WBSEUID,WBEFCUID
          CALL      IBACLOCK
          PACK      WBEFCDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBEFCDAT
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,WBEFCTIM
.
          MATCH     SP70,PTELF033
          IF        !@EQUAL
            MOVE      PTELF033,WBEFDVAN
          ENDIF
.
          MATCH     SP70,PTELF034
          IF        !@EQUAL
            MOVE      PTELF034,WBEFGEND
          ENDIF
.
          MATCH     SP70,PTELF035
          IF        !@EQUAL
            MOVE      PTELF035,WBEFVISN
          ENDIF
.
          MATCH     SP70,PTELF036
          IF        !@EQUAL
            MOVE      PTELF036,WBEFCNTR
          ENDIF
.
          MATCH     SP70,PTELF037
          IF        !@EQUAL
            MOVE      PTELF037,WBEFFLAG
          ENDIF
.
STEW9999  RETURN
+
.-----------------------------------------------------------
.        Generate Free Format OECW Eligibility Number
.-----------------------------------------------------------
GELW0000  MOVE      "118",PRXCODE
          CALL      GETSLK00
          READ      CONTROLF,HUND18;*117,PTCNELGN
.
GELW0100  MOVE      PTCNELGN,WBEFELGN
          UNPACK    PTCNELGN,ANS,KEY7
          MATCH     "a",ANS
          GOTO      GELW1150 IF LESS
          MOVE      ZERO,F7
          MOVE      KEY7,F7
.
GELW1100  COMPARE   "9999999",F7               * at the end of the group
          GOTO      GELW1110 IF NOT EQUAL
.
          MATCH     "z",ANS
          GOTO      GELW9000 IF EQUAL
.
          REP       REPUNIQ,ANS
          MOVE      ZERO,F7
.
GELW1110  ADD       ONE,F7
          MOVE      F7,D7
          REP       " 0",D7
.
          PACK      KEY8,ANS,D7,SP70
          CALL      RDWBELF1
          IF        OVRCD=ONE
            PACK      KEY11,ANS,D7,SP1,SP1,ONE,SP70
            CALL      RDWBOEC1
            IF        OVRCD=ONE
              PACK      KEY14,ANS,D7,SP1,SP1,ONE,SP70
              CALL      RSWBOES1
              CALL      RKWBOES1
              BRANCH    OVRCD,GELW9500
.
              PACK      KEY8,ANS,D7,SP70
              MATCH     KEY8,WBOSVISN
              GOTO      GELW9500 IF NOT EQUAL
            ENDIF
          ENDIF
.
          GOTO      GELW1100
.
. no records
.
GELW1150  MOVE      ONE,F7
          MOVE      "a",ANS
.
          MOVE      F7,D7
          REP       " 0",D7
.
          PACK      KEY8,ANS,D7,SP70
          GOTO      GELW9500
.
GELW9000  MOVE      ONE,EXIT                  * Passcode allocation full
          GOTO      GELW9999
.
GELW9500  MOVE      KEY8,PTCNELGN
          WRITAB    CONTROLF,HUND18;*117,PTCNELGN
.
          MATCH     "00000000",WBEFELGN
          GOTO      GELW0100 IF EQUAL
.
GELW9999  CALL      RELSLK00
          RETURN
+
.------------------------------------------------------------
.   OECW Request Table Row
.------------------------------------------------------------
OECWR000  MOVE      SP70,KEY10
          MATCH     "A",WBEHCFAC
          IF        @EQUAL
            MOVE      "ACCEPTED  ",KEY10
          ENDIF
          MATCH     "R",WBEHCFAC
          IF        @EQUAL
            MOVE      "REJECTED  ",KEY10
          ENDIF
          MATCH     "W",WBEHCFAC
          IF        @EQUAL
            MOVE      "WARNING   ",KEY10
          ENDIF
          MATCH     "C",WBEHCFAC
          IF        @EQUAL
            MOVE      "COMPLETED ",KEY10
          ENDIF
          MATCH     "I",WBEHCFAC
          IF        @EQUAL
            MOVE      "INTERIM   ",KEY10
          ENDIF
.
          MOVE      SP70,KEY20
          MATCH     " 0",WBOCSTAT
          IF        @EQUAL
            MOVE      "WAITING",KEY20
          ENDIF
.
          MATCH     " 1",WBOCSTAT
          IF        @EQUAL
            MOVE      "EXTRACTED",KEY20
          ENDIF
.
          MATCH     " 2",WBOCSTAT
          IF        @EQUAL
            MOVE      "RECEIVED",KEY20
          ENDIF
.
          MATCH     " 3",WBOCSTAT
          IF        @EQUAL
            MOVE      "SA&nbsp;ERROR",KEY20
          ENDIF
.
          MATCH     " 4",WBOCSTAT
          IF        @EQUAL
            MOVE      "DATA&nbsp;ERROR",KEY20
          ENDIF
.
          MATCH     " 6",WBOCSTAT
          IF        @EQUAL
            MOVE      "COMP&nbsp;REPORTED",KEY20
          ENDIF
.
          MATCH     " 5",WBOCSTAT
          IF        @EQUAL
            MOVE      "REJ&nbsp;REPORTED",KEY20
          ENDIF
.
          MATCH     " 7",WBOCSTAT
          IF        @EQUAL
            MOVE      "HF&nbsp;UNAVAILABLE",KEY20
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:AssignPatientLinks('",HTMLLINK
          APPEND    URNUMBER,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ADMISSNO,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    WBOCCNTR,HTMLLINK
          APPEND    "');",HTMLLINK
          APPEND    "PatientLinkTo('patweb78.pbl',6,3,1,900,550);",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:AssignPatientLinks('",HTMLLNK2
          APPEND    URNUMBER,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    ADMISSNO,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    WBOCCNTR,HTMLLNK2
          APPEND    "');",HTMLLNK2
          APPEND    "PatientLinkTo('patweb78.pbl',6,4,1,900,425);",HTMLLNK2
          RESET     HTMLLNK2
.
          REP       " +",WBOCVISN
          REP       " +",WBOCCNTR
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          CLEAR     HTMLLNK3
          APPEND    "displayOEC('",HTMLLNK3
          APPEND    WBOCVISN,HTMLLNK3
          APPEND    WBOCCNTR,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    URNUMBER,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    ADMISSNO,HTMLLNK3
          APPEND    "');",HTMLLNK3
          RESET     HTMLLNK3
.
          REP       "+ ",WBOCVISN
          REP       "+ ",WBOCCNTR
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
          MOVE      SP70,DIM11   
          MATCH     SP70,WBOCCDTE
          IF        !@EQUAL
            UNPACK    WBOCCDTE,CCENT,CYEAR,CMON,CDAY
            GOTO      OECWR100
          ELSE
            MATCH     SP70,WBOCUDTE
            IF        !@EQUAL
              UNPACK    WBOCUDTE,CCENT,CYEAR,CMON,CDAY
              GOTO      OECWR100
            ELSE
              GOTO      OECWR200
            ENDIF
          ENDIF

OECWR100  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET
          MATCH     SP70,WBOCUUID
          IF        !@EQUAL 
            PACK      UIDCREUD,WBOCUUID,SP2,DIM11
            PACK      UIDTIMET,WBOCUTIM
            GOTO      OECWR200
          ELSE
            MATCH     SP70,WBOCCUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBOCCUID,SP2,DIM11
              PACK      UIDTIMET,WBOCCTIM
              GOTO      OECWR200
            ELSE
              GOTO      OECWR200
            ENDIF
          ENDIF

.
OECWR200  WRITE     HTMLFILE;"t.addRow(#"";
.
          WRITE     HTMLFILE;"<img src=../images/DocumentIcon.gif ":
                             "class=ListIcon onclick=",HTMLLNK3,">";
          WRITE     HTMLFILE;WBOCTRID;
.
          WRITE     HTMLFILE;"#",":
                             "#"",WBOCCDTE,WBOCCTIM,"#",":
                             "#"",KEY10,"#",":
                             "#"",WBOCERRC,"&nbsp;&nbsp;&nbsp;",WBOCERRD,"#",":
                             "#"",WBOCERRD,"#",":
                             "#"",WBEHPSCD,"#",":
                             "#"",HTMLLINK,"#",":
                             "#"",HTMLLNK2,"#",":
                             "#"",WBEHCDTE,WBEHCTIM,"#",":
                             "#"",KEY20,"#",":
                             "#"",DIM50,"#",":
                             "#"",HTMLLNK3,"#",": 
                             "#"",UIDCREUD,UIDTIMET,"#")"
.
OECWR999  RETURN
+
.------------------------------------------------------------
.   Presenting Illness Code/MBS
.------------------------------------------------------------
ILLW0000  MATCH     SP70,WBEFPRIM
          GOTO      ILLW2000 IF EQUAL
.
          CLEAR     DIM50
          APPEND    WBEFPRIM,DIM50
.
          PACK      KEY9,WBEFPRIM,SP70
          PACK      KEY17,KEY9,SP70
          CALL      PATITMRD
          IF        OVRCD=0
            APPEND    "/",DIM50
            APPEND    IDESC,DIM50
          ENDIF
          APPEND    SP70,DIM50
          RESET     DIM50
          GOTO      ILLW9999
.
ILLW2000  PACK      DIM50,WBEFPRIC,SP70
          MATCH     SP70,WBEFPRIC
          IF        !@EQUAL
            PACK      KEY5,CATil,WBEFPRIC,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              PACK      DIM50,TDESC,SP70
            ENDIF
          ENDIF
.
ILLW9999  RETURN
+
.------------------------------------------------------------
. Free Format Detail Line OECW
.------------------------------------------------------------
FFLINW00  MOVE      SP70,DIM11
          MATCH     SP70,WBEFCDAT
          IF        !@EQUAL
            UNPACK    WBEFCDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
            MATCH     SP70,WBOCVISN
            IF        @EQUAL | @EOS
              WRITE     HTMLFILE;"<tr><td>",DIM11:
                                 "&nbsp;at&nbsp",WBEFCTIM,"</td>";
            ELSE
.
              REP       " +",WBOCVISN
              REP       " +",WBOCCNTR
              REP       " +",WBOCURNO
.
              CLEAR     HTMLLNK3
              APPEND    "#"displayOEC('",HTMLLNK3
              APPEND    WBOCVISN,HTMLLNK3
              APPEND    WBOCCNTR,HTMLLNK3
              APPEND    "','",HTMLLNK3
              APPEND    WBOCURNO,HTMLLNK3
              APPEND    "','",HTMLLNK3
              APPEND    WBOCVISN,HTMLLNK3
              APPEND    "');#"",HTMLLNK3
              RESET     HTMLLNK3
.
              WRITE     HTMLFILE;"<tr><td>";
              WRITE     HTMLFILE;"<img src=../images/DocumentIcon.gif ":
                                 "class=ListIcon onclick=";
.
              WRITE     HTMLFILE;"#"displayOEC('",WBOCVISN,WBOCCNTR,"','":
                                 WBOCURNO,"','",WBOCVISN,"');#"";
.
              WRITE     HTMLFILE;">";
              WRITE     HTMLFILE;DIM11:
                                 "&nbsp;at&nbsp",WBEFCTIM,"</td>";
.
              REP       "+ ",WBOCVISN
              REP       "+ ",WBOCCNTR
              REP       "+ ",WBOCURNO
.
            ENDIF
.
          ELSE
            WRITE     HTMLFILE;"<tr><td>&nbsp;</td>";
            WRITE     HTMLFILE;"<td>&nbsp;</td>";
          ENDIF
.
          MOVE      SP70,DIM11   
          MATCH     SP70,WBOCCDTE
          IF        !@EQUAL
            UNPACK    WBOCCDTE,CCENT,CYEAR,CMON,CDAY
            GOTO      FFLINW50
          ELSE
            MATCH     SP70,WBOCUDTE
            IF        !@EQUAL
              UNPACK    WBOCUDTE,CCENT,CYEAR,CMON,CDAY
              GOTO      FFLINW50
            ELSE
              GOTO      FFLINW70
            ENDIF
          ENDIF

FFLINW50  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
. 
FFLINW70  MATCH     SP70,WBOCUUID
          IF        !@EQUAL 
            WRITE     HTMLFILE;"<td>",WBOCUUID,SP2,DIM11:
                                 "&nbsp;at&nbsp",WBOCUTIM,"</td>";
          ELSE
            MATCH     SP70,WBOCCUID
            IF        !@EQUAL
              WRITE     HTMLFILE;"<td>",WBOCCUID,SP2,DIM11:
                                 "&nbsp;at&nbsp",WBOCCTIM,"</td>";
            ELSE
              WRITE     HTMLFILE;"<td>&nbsp;</td>";
            ENDIF
          ENDIF
.  
          WRITE      HTMLFILE;"<td><A HREF='javascript:disElg(#"":
                              WBEFELGN,"#")'>":
                             "<img src=../images/InvoiceIcon.gif ":
                             "class=ListIcon></a>";
          WRITE      HTMLFILE;WBEFELGN,"</td>";
.
          CALL       FFPTNW00
          WRITE      HTMLFILE;"<td width=140>",PATFNAME,"&nbsp;</td>";.
          MOVE      SP70,DIM11
          MATCH     SP70,WBEFEADT
          IF        !@EQUAL
            UNPACK    WBEFEADT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE      HTMLFILE;"<td>",DIM11,"&nbsp;</td>":
                              "<td>",WBEFHFND,"</td>":
                              "<td>",WBEFHFNT,"</td>";
.
          MATCH      "1",ELGRESIN
          IF         @EQUAL
            WRITE     HTMLFILE;"<td>":
                               "<input type=button value='Response'":
                               "onclick='disOEC(#"",WBEFELGN,"#");' ":
                               "class='orangebutton'>&nbsp;",WBEHPSCD,"</td>";
            MATCH      "3040",WBOCERRC
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>":
                             "<input type=button value='Delete' ":
                             "onclick='deleteFreeFormatOEC(#"",WBEFELGN,"#")' ":
                             "class='button'>":
                             "</td>";
            ELSE 
              WRITE      HTMLFILE;"</td><td>&nbsp;</td>";
            ENDIF
          ELSE
.
            MATCH      " 0",WBOCSTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Waiting":
                  "</td>";
            ENDIF
.
            MATCH      " 1",WBOCSTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Extracted":
                  "</td>";
            ENDIF
.
            MATCH      " 2",WBOCSTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Received":
                  "</td>";
            ENDIF
.
            MATCH      " 3",WBOCSTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>SA Error: ":
                  "</td>";
            ENDIF
.
            MATCH      " 4",WBOCSTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Data Error: ":
                  "</td>";
            ENDIF
.
            MATCH      " 5",WBOCSTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Rejected Reported: ":
                  "</td>";
            ENDIF
.
            MATCH      " 6",WBOCSTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Complete Reported: ":
                  "</td>";
            ENDIF
.
            MATCH      " 7",WBOCSTAT
            IF         @EQUAL
              WRITE      HTMLFILE;"<td>Health Fund Unavailable":
                  "</td>";
            ENDIF
.
.             WRITE      HTMLFILE;"<td>":
.                 "<input type=button value='Response' ":
.                 "onclick='alert(#"No Response Available#");' class='button'>":
.                 "</td>":
.                 "</tr>";
.           ENDIF
.
            WRITE     HTMLFILE;"<td>":
                             "<input type=button value='Delete' ":
                             "onclick='deleteFreeFormatOEC(#"",WBEFELGN,"#")' ":
                             "class='button'>":
                             "</td>";
.
          ENDIF
.
          WRITE     HTMLFILE;"<td>",WBOCTRID,"</td>";
          WRITE     HTMLFILE;"<td>",WBOCERRC,"&nbsp;",WBOCERRD,"</td>"
.
FFLINW99  RETURN
+
.------------------------------------------------------------
. Format Patient Name <b>SURNAME</b>Title Given Names
.------------------------------------------------------------
FFPTNW00  CLEAR     DISPNAME
          REP       "#" ",WBEFSNAM
          REP       "#" ",WBEFFNAM
          MOVE      SP70,PATFNAME
          REP       UPPLOW,WBEFSNAM
          APPEND    "<b>",DISPNAME
          APPEND    WBEFSNAM,DISPNAME
          APPEND    "</b>",DISPNAME
          PACK      NAME35,WBEFTITL,SP70
          CALL      NAMSTR00
          PACK      NAME35,WBEFFNAM,SP70
          CALL      NAMSTR00
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,PATFNAME
          STRIP     PATFNAME
          RETURN
+
.------------------------------------------------------------
.   UR Only OECW Response Table Row
.------------------------------------------------------------
UOEW0000  CLEAR     HTMLLINK
          APPEND    "javascript:disElg('",HTMLLINK
          APPEND    WBEFELGN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:disOEC('",HTMLLNK2
          APPEND    WBEFELGN,HTMLLNK2
          APPEND    "')",HTMLLNK2
          RESET     HTMLLNK2
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBEFEADT
          IF        !@EQUAL
            UNPACK    WBEFEADT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DIM40
          MATCH     SP70,WBEFPRIM
          IF        !@EQUAL
            PACK      DIM40,WBEFPRIM,SP70
            PACK      KEY9,WBEFPRIM,SP70
            PACK      KEY17,KEY9,SP70
            CALL      PATITMRD
            IF        OVRCD=0
              PACK      DIM40,IDESC,SP70
            ENDIF
          ELSE
            PACK      DIM40,WBEFPRIC,SP70
            MATCH     SP70,WBEFPRIC
            IF         !@EQUAL
              PACK      KEY5,CATil,WBEFPRIC,SP70
              CALL      RDCODE1
              IF        OVRCD=0
                PACK      DIM40,TDESC,SP70
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      "No ",DIM3
          MATCH     "1",WBEHBENL
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ENDIF
.
          MOVE      SP70,DIM10
          MATCH     ANSA,WBEHCFAC
          IF        @EQUAL
            MOVE      "ACCEPTED",DIM10
          ENDIF
          MATCH     ANSR,WBEHCFAC
          IF        @EQUAL
            MOVE      "REJECTED",DIM10
          ENDIF
          MATCH     ANSW,WBEHCFAC
          IF        @EQUAL
            MOVE      "WARNING",DIM10
          ENDIF
          MATCH     ANSC,WBEHCFAC
          IF        @EQUAL
            MOVE      "COMPLETED",DIM10
          ENDIF
          MATCH     ANSI,WBEHCFAC
          IF        @EQUAL
            MOVE      "INTERIM",DIM10
          ENDIF
          PACK      DIM10,DIM10,SP70
.
          MOVE      "No ",DIM3A
          MATCH     "Y",WBEHCPDI
          IF        @EQUAL
            MOVE      "Yes",DIM3A
          ENDIF
.
          MOVE      "No ",DIM3B
          MATCH     "Y",WBEHEADI
          IF        @EQUAL
            MOVE      "Yes",DIM3B
          ENDIF
.
          MOVE      "No ",DIM3C
          MATCH     "Y",WBEHEXDI
          IF        @EQUAL
            MOVE      "Yes",DIM3C
          ENDIF
.
          MOVE      "No ",DIM3D
          MATCH     "Y",WBEHTBDI
          IF        @EQUAL
            MOVE      "Yes",DIM3D
          ENDIF
.
          REP       " +",WBOCVISN
          REP       " +",WBOCCNTR
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          CLEAR     HTMLLNK3
          APPEND    "displayOEC('",HTMLLNK3
          APPEND    WBOCVISN,HTMLLNK3
          APPEND    WBOCCNTR,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    URNUMBER,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    ADMISSNO,HTMLLNK3
          APPEND    "');",HTMLLNK3
          RESET     HTMLLNK3
.
          REP       "+ ",WBOCVISN
          REP       "+ ",WBOCCNTR
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                    "#"",HTMLLNK2,"#",":
                                    "#"",WBEHCDTE,WBEHCTIM,"#",":
                                    "#"",WBEHCTID,"#",":
                                    "#"",DIM11,"&nbsp;&nbsp;&nbsp;",DIM40,"#",":
                                    "#"",DIM3,"#",":
                                    "#"",DIM10,"#",":
                                    "#"",DIM3A,"#",":
                                    "#"",DIM3B,"#",":
                                    "#"",DIM3C,"#",":
                                    "#"";
.
          WRITE     HTMLFILE;"<img src=../images/DocumentIcon.gif ":
                             "class=ListIcon onclick=",HTMLLNK3,">";
.
          WRITE     HTMLFILE;WBEHPSCD,"#",":
                                    "#"",DIM3D,"#",":
                                    "#"",WBOCVISN,"#")"
.
UOEW9999  RETURN
+
.------------------------------------------------------------
.   UR Only OECW Response Table Row
.------------------------------------------------------------
EOEW0000  CLEAR     HTMLLINK
          APPEND    "javascript:disElg('",HTMLLINK
          APPEND    WBEFELGN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:disOEC('",HTMLLNK2
          APPEND    WBEFELGN,HTMLLNK2
          APPEND    "')",HTMLLNK2
          RESET     HTMLLNK2
.
          MOVE      SP70,DIM70
.
          MATCH     " 0",WBOCSTAT
          IF        @EQUAL
            MOVE      "Waiting",DIM70
          ENDIF
          MATCH     " 1",WBOCSTAT
          IF        @EQUAL
            MOVE      "Extracted",DIM70
          ENDIF
          MATCH     " 2",WBOCSTAT
          IF        @EQUAL
            MOVE      "Received",DIM70
          ENDIF
          MATCH     " 3",WBOCSTAT
          IF        @EQUAL
            MOVE      "SA Error: ",DIM12
            PACK      DIM12,DIM12
            PACK      DIM70,DIM12,SP1,WBOCERRC,SP1,WBOCERRD,SP70
          ENDIF
          MATCH     " 4",WBOCSTAT
          IF        @EQUAL
            MOVE      "Data Error: ",DIM12
            PACK      DIM12,DIM12
            PACK      DIM70,DIM12,SP1,WBOCERRC,SP1,WBOCERRD,SP70
          ENDIF
          MATCH     " 5",WBOCSTAT
          IF        @EQUAL
            MOVE      "Rejected Reported",DIM70
          ENDIF
          MATCH     " 6",WBOCSTAT
          IF        @EQUAL
            MOVE      "Complete Reported",DIM70
          ENDIF
          MATCH     " 7",WBOCSTAT
          IF        @EQUAL
            MOVE      "Health Fund Unavailable",DIM70
          ENDIF
          PACK      DIM70,DIM70,SP70
.
          MOVE      SP70,ELGRESIN
          PACK      DIM20,WBEFELGN,SP70
          LJUSTIFY  DIM20
.
          PACK      KEY23,DIM20,SP70
          CALL      RSWBEEH1
          CALL      RKWBEEH1
          IF        OVRCD=0
            MATCH     DIM20,WBEHARID
            IF        @EQUAL
              MOVE      ONE,ELGRESIN
            ENDIF
          ELSE
            CALL    CLWEBEEH
          ENDIF
.
          REP       " +",WBOCVISN
          REP       " +",WBOCCNTR
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          CLEAR     HTMLLNK3
          APPEND    "displayOEC('",HTMLLNK3
          APPEND    WBOCVISN,HTMLLNK3
          APPEND    WBOCCNTR,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    URNUMBER,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    ADMISSNO,HTMLLNK3
          APPEND    "');",HTMLLNK3
          RESET     HTMLLNK3
.
          REP       "+ ",WBOCVISN
          REP       "+ ",WBOCCNTR
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                    "#"",HTMLLNK2,"#",":
                                    "#"",WBEFCDAT,WBEFCTIM,"#",":
                                    "#"",WBEFELGN,"#",":
                                    "#"",WBEFVISN,"#",":
                                    "#"",WBEFEADT,"#",":
                                    "#"",WBEFHFND,"#",":
                                    "#"",WBEFHFNT,"#",";
.
          MATCH      "1",ELGRESIN
          IF         @EQUAL
            WRITE      HTMLFILE;"#"<input type=button value='Response'":
                     "onclick=disOEC('",WBEFELGN,"'); class='orangebutton'>":
                     "&nbsp;",WBEHPSCD,"#",";
          ELSE
            WRITE     HTMLFILE;"#"",DIM70,"#",";
          ENDIF
.
          MATCH     "1",ELGRESIN
          IF         @EQUAL
            WRITE     HTMLFILE;"#"#",";
          ELSE
            WRITE     HTMLFILE;"#"<input type=button value='Delete' ":
                             "onclick=deleteFreeFormatOEC('",WBEFELGN,"') ":
                             "class='button'>#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"<input type=button value='Re-submit' ":
                             "onclick=resubOEC('",WBEFELGN,"') ":
                             "class='button'>#",";
.
          WRITE     HTMLFILE;"#"<img src=../images/DocumentIcon.gif ":
                             "class=ListIcon onclick=",HTMLLNK3,">";
          WRITE     HTMLFILE;WBOCTRID,"#",";
.
          WRITE     HTMLFILE;"#"",WBOCERRD;

          WRITE     HTMLFILE;"#")"
.UPTOHERE

.
EOEW9999  RETURN
+
.----------------------------------------------------------------------------
. Report No. 9 : Free Format OECW Tags
.----------------------------------------------------------------------------
FOEW0000  BRANCH    FLDITMNO,FOEW0100,FOEW0200,FOEW0300,FOEW0400,FOEW0500:
                             FOEW0600,FOEW0700,FOEW0800,FOEW0900,FOEW1000:
                             FOEW1100,FOEW1200,FOEW1300,FOEW1400,FOEW1500:
                             FOEW1600,FOEW1700,FOEW1800,FOEW1900,FOEW2000:
                             FOEW2100,FOEW2200,FOEW2300,FOEW2400,FOEW2500:
                             FOEW2600,FOEW2700,FOEW2800,FOEW2900,FOEW3000:
                             FOEW3100,FOEW3200,FOEW3300,FOEW3400,FOEW3500:
                             FOEW3600,FOEW3700,FOEW3800,FOEW3900,FOEW4000:
                             FOEW4100,FOEW4200,FOEW4300,FOEW4400,FOEW4500:
                             FOEW4600,FOEW4700,FOEW4800,FOEW4900,FOEW5000:
                             FOEW5100,FOEW5200,FOEW5300,FOEW5400,FOEW5500:
                             FOEW5600,FOEW5700,FOEW5800,FOEW5900,FOEW6000:
                             FOEW6100,FOEW6200,FOEW6300,FOEW6400,FOEW6500:
                             FOEW6600,FOEW6700
.
          GOTO      FOEW9999
.
FOEW0100  MATCH     SP70,SRCHSNAM
          GOTO      FOEW9999 IF EQUAL
          STRIP     SRCHSNAM
          MOVELPTR  SRCHSNAM,LENGTH
          COMPARE   ZERO,LENGTH
          GOTO      FOEW9999 IF EQUAL
          SFORMAT   VAR,LENGTH
          MOVE      SRCHSNAM,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      FOEW9999
.
FOEW0200  MATCH     SP70,SRCHGNAM
          GOTO      FOEW9999 IF EQUAL
          STRIP     SRCHGNAM
          MOVELPTR  SRCHGNAM,LENGTH
          COMPARE   ZERO,LENGTH
          GOTO      FOEW9999 IF EQUAL
          SFORMAT   VAR,LENGTH
          MOVE      SRCHGNAM,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      FOEW9999
.
FOEW0300  CALL      LAST0000
          GOTO      FOEW9999
.
FOEW0400  CALL      STRT0000
          GOTO      FOEW9999
.
FOEW0500  CALL      NEXT0000
          GOTO      FOEW9999
.
FOEW0600  IF        TBSRTFLG =1
            CALL      FFTS0000
          ELSE 
            CALL      FFTB0000
          ENDIF
          GOTO      FOEW9999
.
FOEW0700  WRITE     HTMLFILE;WBEFELGN;
          GOTO      FOEW9999
.
FOEW0800  WRITE     HTMLFILE;WBEFURNO;
          GOTO      FOEW9999
.
FOEW0900  CALL      FFPTNW00
          WRITE     HTMLFILE;PATFNAME;
          GOTO      FOEW9999
.
FOEW1000  MOVE      SP70,DIM11
          MATCH     SP70,WBEFEADT
          IF        !@EQUAL
            UNPACK    WBEFEADT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;DIM11;
          GOTO      FOEW9999
.
FOEW1100  MOVE      "VI",CATEGORY
          MOVE      WBEFISTY,CODE
          CALL      CODITM00
          GOTO      FOEW9999
.
FOEW1200  WRITE     HTMLFILE;WBEFPLOS;
          GOTO      FOEW9999
.
FOEW1300  MOVE      "KN",CATEGORY
          MOVE      WBEFDINT,CODE
          CALL      CODITM00
          GOTO      FOEW9999
.
FOEW1400  MATCH     "0",WBEFPEAI
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            MATCH     "1",WBEFPEAI
            IF        @EQUAL
              WRITE     HTMLFILE;"Yes";
            ELSE
              WRITE     HTMLFILE;"Query";
            ENDIF
          ENDIF
          GOTO      FOEW9999
.
FOEW1500  MATCH     "0",WBEFEMAD
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      FOEW9999
.
FOEW1600  MOVE      "il",CATEGORY
          MOVE      WBEFPRIC,CODE
          CALL      CODITM00
          GOTO      FOEW9999
.
FOEW1700  WRITE     HTMLFILE;WBEFPRIM;
          GOTO      FOEW9999
.
FOEW1800  MOVE      "CL",CATEGORY
          MOVE      WBEFCLTY,CODE
          CALL      CODITM00
          GOTO      FOEW9999
.
FOEW1900  PACK      KEY14,WBEFHFND,ZERO8
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
          ELSE
            WRITE     HTMLFILE;WBEFHFND;
          ENDIF
          GOTO      FOEW9999
.
FOEW2000  WRITE     HTMLFILE;WBEFHFNT;
          GOTO      FOEW9999
.
FOEW2100  WRITE     HTMLFILE;WBEFHFMN;
          GOTO      FOEW9999
.
FOEW2200  WRITE     HTMLFILE;WBEFDIAG;
          GOTO      FOEW9999
.
FOEW2300  MOVE      "  1",DIM3
          MOVE      ONE,FORM1
          CALL      FFSERW00
          GOTO      FOEW9999
.
FOEW2400  MOVE      "  1",DIM3
          MOVE      TWO,FORM1
          CALL      FFSERW00
          GOTO      FOEW9999
.
FOEW2500  MOVE      "  2",DIM3
          MOVE      ONE,FORM1
          CALL      FFSERW00
          GOTO      FOEW9999
.
FOEW2600  MOVE      "  2",DIM3
          MOVE      TWO,FORM1
          CALL      FFSERW00
          GOTO      FOEW9999
.
FOEW2700  MOVE      "  3",DIM3
          MOVE      ONE,FORM1
          CALL      FFSERW00
          GOTO      FOEW9999
.
FOEW2800  MOVE      "  3",DIM3
          MOVE      TWO,FORM1
          CALL      FFSERW00
          GOTO      FOEW9999
.
FOEW2900  MOVE      "  4",DIM3
          MOVE      ONE,FORM1
          CALL      FFSERW00
          GOTO      FOEW9999
.
FOEW3000  MOVE      "  4",DIM3
          MOVE      TWO,FORM1
          CALL      FFSERW00
          GOTO      FOEW9999
.
FOEW3100  MOVE      "  5",DIM3
          MOVE      ONE,FORM1
          CALL      FFSERW00
          GOTO      FOEW9999
.
FOEW3200  MOVE      "  5",DIM3
          MOVE      TWO,FORM1
          CALL      FFSERW00
          GOTO      FOEW9999
.
FOEW3300  MATCH     "Y",WBEHFSTA
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      FOEW9999
.
FOEW3400  WRITE     HTMLFILE;WBEHTBSC;
          GOTO      FOEW9999
.
FOEW3500  MATCH     "Y",WBEHPEAI
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      FOEW9999
.
FOEW3600  WRITE     HTMLFILE;WBEHFRID;
          GOTO      FOEW9999
.
FOEW3700  WRITE     HTMLFILE;WBEHTNAM;
          GOTO      FOEW9999
.
FOEW3800  MOVE      "005",ELIGTYPE
          CALL      ECDSW000
          GOTO      FOEW9999
.
FOEW3900  MOVE      "001",ELIGTYPE
          CALL      ECDSW000
          GOTO      FOEW9999
.
FOEW4000  MATCH     SP70,WBEHCPAM
          GOTO      FOEW9999 IF EQUAL
          GOTO      FOEW9999 IF EOS
.
          MATCH     "0        ",WBEHCPAM
          GOTO      FOEW9999 IF EQUAL
.
          MOVE      SP70,DIM9
          MOVE      WBEHCPAM,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      FOEW9999
.
FOEW4100  WRITE     HTMLFILE;WBEHCPDR;
          GOTO      FOEW9999
.
FOEW4200  MOVE      "002",ELIGTYPE
          CALL      ECDSW000
          GOTO      FOEW9999
.
FOEW4300  MATCH     SP70,WBEHEXAM
          GOTO      FOEW9999 IF EQUAL
          GOTO      FOEW9999 IF EOS
.
          MATCH     "0        ",WBEHEXAM
          GOTO      FOEW9999 IF EQUAL
.
          MOVE      SP70,DIM9
          MOVE      WBEHEXAM,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2
          GOTO      FOEW9999
.
FOEW4400  MATCH     SP70,WBEHEXBA
          GOTO      FOEW9999 IF EQUAL
          GOTO      FOEW9999 IF EOS
.
          MATCH     "0        ",WBEHEXBA
          GOTO      FOEW9999 IF EQUAL
.
          MOVE      SP70,DIM9
          MOVE      WBEHEXBA,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2
          GOTO      FOEW9999
.
FOEW4500  MOVE      "003",ELIGTYPE
          CALL      ECDSW000
          GOTO      FOEW9999
.
FOEW4600  MOVE      "004",ELIGTYPE
          CALL      ECDSW000
          GOTO      FOEW9999
.
FOEW4700  CALL      WEBEED00
          GOTO      FOEW9999
.
FOEW4800  CALL      SRVASW00
          GOTO      FOEW9999
.
FOEW4900  WRITE     HTMLFILE;WBEFDVAN;
          GOTO      FOEW9999
.
FOEW5000  MOVE      "Male",DIM13
.
          MATCH     "F",WBEFGEND
          IF        @EQUAL
            MOVE      "Female",DIM13
          ENDIF
.
          MATCH     "R",WBEFGEND
          IF        @EQUAL
            MOVE      "Intersex",DIM13
          ENDIF
.
          MATCH     "U",WBEFGEND
          IF        @EQUAL
            MOVE      "Unknown",DIM13
          ENDIF
.
          MATCH     "I",WBEFGEND
          IF        @EQUAL
            MOVE      "Indeterminate",DIM13
          ENDIF
.
          WRITE     HTMLFILE;DIM13;
.
          GOTO      FOEW9999
.
FOEW5100  WRITE     HTMLFILE;WBEFTITL;
          GOTO      FOEW9999
.
FOEW5200  WRITE     HTMLFILE;WBEFSNAM;
          GOTO      FOEW9999
.
FOEW5300  WRITE     HTMLFILE;WBEFFNAM;
          GOTO      FOEW9999
.
FOEW5400  MOVE      SP70,DIM11
          MATCH     SP70,WBEFBDAT
          IF        !@EQUAL
            UNPACK    WBEFBDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;DIM11;
          GOTO      FOEW9999
.
FOEW5500  MOVE      SP70,DIM50
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     SP70,WBEFPRIM
          GOTO      FOEW5510 IF EQUAL
.
          PACK      KEY9,WBEFPRIM,SP70
          PACK      KEY17,KEY9,SP70
          CALL      PATITMRD
          IF        F1=1
            CLEAR     DIM50
            APPEND    WBEFPRIM,DIM50
            IF        OVRCD=0
              APPEND    "/",DIM50
              APPEND    IDESC,DIM50
            ENDIF
            APPEND    SP70,DIM50
            RESET     DIM50
          ELSE
            PACK      DIM50,WBEFPRIM,SP70
            IF        OVRCD=0
              PACK      DIM50,IDESC,SP70
            ENDIF
          ENDIF
          GOTO        FOEW5520
.
FOEW5510  PACK      DIM50,WBEFPRIC,SP70
          MATCH     SP70,WBEFPRIC
          IF        !@EQUAL
            PACK      KEY5,CATil,WBEFPRIC,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              PACK      DIM50,TDESC,SP70
            ENDIF
          ENDIF
.
FOEW5520  WRITE     HTMLFILE;DIM50;
          GOTO      FOEW9999
.
FOEW5600  WRITE     HTMLFILE;WBEFFLAG;
          GOTO      FOEW9999
.
FOEW5700  MATCH     "2",PTCNIFCL
          GOTO      FOEW5710 IF NOT EQUAL     * Not SJOG
.
          PACK      KEY9,PTELCMXC,SP70
          MATCH     SP70,KEY9                 * Provisional Casemix code
          GOTO      FOEW5710 IF EQUAL
.
          WRITE     HTMLFILE;PTELECLS;        * Expected Casmix LOS
          GOTO      FOEW9999
.
FOEW5710  WRITE     HTMLFILE;ASTAY;
          GOTO      FOEW9999
.
FOEW5800  CALL      CMBS0000                  * Check for multiple MBS
          WRITE     HTMLFILE;F1;
          GOTO      FOEW9999
.
FOEW5900  CALL      DMBW0000                  * Display extra MBS items
          GOTO      FOEW9999
.
FOEW6000  WRITE     HTMLFILE;WBEFGEND;
          GOTO      FOEW9999
.
FOEW6100  WRITE     HTMLFILE;WBEFPEAI;
          GOTO      FOEW9999
.
FOEW6200  WRITE     HTMLFILE;WBEFEMAD;
          GOTO      FOEW9999
.
FOEW6300  WRITE     HTMLFILE;WBEFHFND;
          GOTO      FOEW9999
.
FOEW6400  WRITE     HTMLFILE;WBEFVISN;
          GOTO      FOEW9999
.
FOEW6500  WRITE     HTMLFILE;WBEFCNTR;
          GOTO      FOEW9999
.
FOEW6600  WRITE     HTMLFILE;WBEFFLAG;
          GOTO      FOEW9999
.
FOEW6700  WRITE     HTMLFILE;WBOCERRC," - ",WBOCERRD;
          GOTO      FOEW9999
.
FOEW9999  RETURN
+
.------------------------------------------------------------
. Get Service for Free Format OECW
.------------------------------------------------------------
FFSERW00  PACK      KEY14,WBEFELGN,SP1,SP1,ONE,DIM3,SP70
          CALL      RDWBOES1
          IF        OVRCD=1
            PACK      KEY14,WBEFVISN,SP1,SP1,ONE,DIM3,SP70
            CALL      RDWBOES1
            BRANCH    OVRCD,FFSERW99
          ENDIF
.
          BRANCH    FORM1,FFSERW10,FFSERW20
          GOTO      FFSERW99
.
FFSERW10  WRITE     HTMLFILE;WBOSITEM;
          GOTO      FFSERW99
.
FFSERW20  WRITE     HTMLFILE;WBOSQUAN;
          GOTO      FFSERW99
.
FFSERW99  RETURN
+
.------------------------------------------------------------
.   Eclipse Eligibility Descriptions
.------------------------------------------------------------
ECDSW000  PACK      KEY29,WBEHARID,WBEHRPTC,ELIGTYPE,SP70
          CALL      RDWBERC1
ECDSW100  CALL      RKWBERC1
          BRANCH    OVRCD,ECDSW999
.
          MATCH     WBEHARID,WBECARID
          GOTO      ECDSW999 IF NOT EQUAL
.
          MATCH     WBEHRPTC,WBECRPTC
          GOTO      ECDSW999 IF NOT EQUAL
.
          MATCH     ELIGTYPE,WBECTYPE
          GOTO      ECDSW999 IF NOT EQUAL
.
          WRITE     HTMLFILE;WBECDATA,SP1;
.
          GOTO      ECDSW100
.
ECDSW999  RETURN
+
.------------------------------------------------------------
.   Eclipse Claim Detail Codes and Descriptions
.------------------------------------------------------------
WEBEED00  PACK      KEY30,WBEHARID,WBEHRPTC,SP70
          CALL      RSWBEED1
WEBEED10  CALL      RKWBEED1
          BRANCH    OVRCD,WEBEED99
.
          MATCH     WBEHARID,WBEDARID
          GOTO      WEBEED99 IF NOT EQUAL
.
          MATCH     WBEHRPTC,WBEDRPTC
          GOTO      WEBEED99 IF NOT EQUAL
.
          WRITE     HTMLFILE;WBEDCFEC," - ",WBEDCFET;
.
          GOTO      WEBEED10
.
WEBEED99  RETURN
+
.------------------------------------------------------------
.   Service assessment tags (websesaf websedaf)
.------------------------------------------------------------
SRVASW00  UNPACK    DIM127,D1,KEY3,DIM127
          UNPACK    DIM127,D1,KEY3A,DIM127
          UNPACK    DIM127,D1,KEY3B,DIM127
          UNPACK    DIM127,D1,KEY3C,DIM127
.
          PACK      KEY37,WBEHARID,WBEHRPTC,SP70
          CALL      RSWBSES1
SRVASW05  CALL      RKWBSES1
          BRANCH    OVRCD,SRVASW99
.
          MATCH     WBEHARID,WBSSARID
          GOTO      SRVASW99 IF NOT EQUAL
.
          MATCH     WBEHRPTC,WBSSRPTC
          GOTO      SRVASW99 IF NOT EQUAL
.
          MATCH     KEY3,WBSSSRVC
          GOTO      SRVASW05 IF NOT EQUAL
.
          SQUEEZE   KEY3A
          MOVE      KEY3A,FORM3
.
          BRANCH    FORM3,SRVASW10,SRVASW20,SRVASW30,SRVASW40,SRVASW50:
                          SRVASW60
.
          GOTO      SRVASW99
.
SRVASW10  MATCH     SP70,WBSSSDTE
          GOTO      SRVASW99 IF EQUAL
          UNPACK    WBSSSDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      SRVASW99
.
SRVASW20  WRITE     HTMLFILE;WBSSSCOD;
          GOTO      SRVASW99
.
SRVASW30  PACK      KEY44,WBSSARID,WBSSRPTC,WBSSSCOD,WBSSSRVC,SP70
          CALL      RSWBSED1
SRVASW31  CALL      RKWBSED1
          BRANCH    OVRCD,SRVASW99
.
          MATCH     WBSSARID,WBSDARID
          GOTO      SRVASW99 IF NOT EQUAL
.
          MATCH     WBSSRPTC,WBSDRPTC
          GOTO      SRVASW99 IF NOT EQUAL
.
          MATCH     WBSSSCOD,WBSDSCOD
          GOTO      SRVASW99 IF NOT EQUAL
.
          MATCH     WBSSSRVC,WBSDSRVC
          GOTO      SRVASW99 IF NOT EQUAL
.
          MATCH     KEY3B,WBSDSEXC
          GOTO      SRVASW31 IF NOT EQUAL
.
          WRITE     HTMLFILE;WBSDSFET;
          GOTO      SRVASW99
.
SRVASW40  RJUSTIFY  WBSSFBAM
          UNPACK    WBSSFBAM,DIM7,DIM2
          WRITE     HTMLFILE;DIM7,DOT,DIM2;
          GOTO      SRVASW99
.
SRVASW50  WRITE     HTMLFILE;WBSSSFAC;
          GOTO      SRVASW99
.
SRVASW60  MOVE      WBSSARID,KEY8
          RJUSTIFY  KEY8
          PACK      KEY14,KEY8,WBSSRPTC,KEY3C,SP70
          CALL      RDWBOES1
          BRANCH    OVRCD,SRVASW99
.
          WRITE     HTMLFILE;WBOSQUAN;
.
          GOTO      SRVASW99
.
SRVASW99  RETURN
+
.******************************************************************************
.*                Display Extra MBS Items                                     *
.******************************************************************************
DMBW0000  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          WRITE     HTMLFILE;"<tr><td class=DataLabel><b>":
                             "Item/Description</b></td></tr>";
.
          UNPACK    SP70,SAVMBSCD,DIM40,SAVDATE
          MOVE      ZERO,COUNTER
          PACK      KEY31,ADMISSNO,SP70
          CALL      RSOPDEA2
DMBW1000  CALL      RKOPDEA2
          BRANCH    OVRCD,DMBW6000
.
          MATCH     ADMISSNO,OPDAADMN
          GOTO      DMBW6000 IF NOT EQUAL
.
          MATCH     "3",DOPDASTA
          GOTO      DMBW1000 IF EQUAL          * Cancelled
.
          MOVE      SP70,GELFSTAT
          MOVE      SP70,GELFCFEC
          MOVE      SP70,GELFCFET
.
          MATCH     SP70,OPDAPROV
          IF        !@EQUAL & !@EOS
            MOVE      OPDAPROV,KEY9
            PACK      KEY17,KEY9,OPDADATE,SP70
            CALL      CDES0000
.
            MOVE      OPDAPROV,GELF0MBS
            CALL      GEWF0000
.
            MATCH     SAVEPRIM,OPDAPROV
            GOTO      DMBW1100 IF EQUAL
.
            IF        GELFINDC=ONE
              WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPROV,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>":
.                        "&nbsp;<a href='javascript:disOEC(#"",WBEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",WBEFURNO,"#",#"",WBEFVISN,"#",#"",WBEFCNTR,"#")'>":
                         "<img src=../images/MaintenanceIcon.gif ":
                         "class=ListIcon></a>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";

            ELSE
DMBW1100      WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPROV,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
            ENDIF
.
          ENDIF
.
          MATCH     SP70,OPDAPRV2
          IF        !@EQUAL & !@EOS
            MOVE      OPDAPRV2,KEY9
            PACK      KEY17,KEY9,OPDADATE,SP70
            CALL      CDES0000
.
            MOVE      OPDAPRV2,GELF0MBS
            CALL      GEWF0000
.
            MATCH     SAVEPRIM,OPDAPRV2
            GOTO      DMBW1200 IF EQUAL
.
            IF        GELFINDC=ONE
              WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPRV2,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>":
.                        "&nbsp;<a href='javascript:disOEC(#"",WBEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",WBEFURNO,"#",#"",WBEFVISN,"#",#"",WBEFCNTR,"#")'>":
                         "<img src=../images/MaintenanceIcon.gif ":
                         "class=ListIcon></a>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";

            ELSE
DMBW1200      WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPRV2,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
            ENDIF
.
          ENDIF
.
.
          MATCH     SP70,OPDAPRV3
          IF        !@EQUAL & !@EOS
            MOVE      OPDAPRV3,KEY9
            PACK      KEY17,KEY9,OPDADATE,SP70
            CALL      CDES0000
.
            MOVE      OPDAPRV3,GELF0MBS
            CALL      GEWF0000
.
            MATCH     SAVEPRIM,OPDAPRV3
            GOTO      DMBW1300 IF EQUAL
.
            IF        GELFINDC=ONE
              WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPRV3,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>":
.                        "&nbsp;<a href='javascript:disOEC(#"",WBEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",WBEFURNO,"#",#"",WBEFVISN,"#",#"",WBEFCNTR,"#")'>":
                         "<img src=../images/MaintenanceIcon.gif ":
                         "class=ListIcon></a>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";

            ELSE
DMBW1300      WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                                 "<input type=text size=9 maxlength=12 ":
                                 "class='Readonly readonly'":
                                 " value='",OPDAPRV3,"'></td>":
                                 "<td class=DataField width=45%>":
                                 "<input type=text size=50 maxlength=70 ":
                                 "class='Readonly readonly'":
                                 " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
            ENDIF
          ENDIF
.
          PACK      KEY13,OPDAUNIQ,SP70
          CALL      RSOPMBS1
DMBW2000  CALL      RKOPMBS1
          BRANCH    OVRCD,DMBW1000
.
          MATCH     OPDAUNIQ,OPMBUNIQ
          GOTO      DMBW1000 IF NOT EQUAL
.
          COMPARE   ZERO,F1
          GOTO      DMBW8000 IF EQUAL       * Display one MBS code per line
.
.         Display MBS Codes in two columns
.
          COMPARE   ZERO,COUNTER
          GOTO      DMBW3000 IF NOT EQUAL
.
          MOVE      OPMBMBSI,SAVMBSCD       * Save MBS Codes
          MOVE      OPDADATE,SAVDATE
          MOVE      ONE,COUNTER
          GOTO      DMBW2000
.
DMBW3000  MOVE      SAVMBSCD,KEY9
          PACK      KEY17,KEY9,OPDADATE,SP70
          CALL      CDES0000                * Get MBS/ICD Operation Code desc.
          MOVE      IDESC,DIM40
.
          MOVE      OPMBMBSI,KEY9
          PACK      KEY17,KEY9,OPDADATE,SP70
          CALL      CDES0000                * Get MBS/ICD Operation Code desc.
.
          MOVE      SAVMBSCD,GELF0MBS
          CALL      GEWF0000
.
          MATCH     SAVEPRIM,SAVMBSCD
          GOTO      DMBW3100 IF EQUAL
.
          IF        GELFINDC=ONE
            WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",SAVMBSCD,"'></td>":
                               "<td class=DataField width=45%>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",DIM40,"'>":
.                      "&nbsp;<a href='javascript:disOEC(#"",WBEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",WBEFURNO,"#",#"",WBEFVISN,"#",#"",WBEFCNTR,"#")'>":
                       "<img src=../images/MaintenanceIcon.gif ":
                       "class=ListIcon></a>&nbsp;":
                       GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                       "</td></tr>";

          ELSE
DMBW3100    WRITE     HTMLFILE;"<tr><td class=DataField>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",SAVMBSCD,"'></td>":
                               "<td class=DataField>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",DIM40,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
          ENDIF
.
          MOVE      OPMBMBSI,GELF0MBS
          CALL      GEWF0000
.
          MATCH     SAVEPRIM,OPMBMBSI
          GOTO      DMBW3200 IF EQUAL
.
          IF        GELFINDC=ONE
            WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",OPMBMBSI,"'></td>":
                               "<td class=DataField width=45%>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>":
.                      "&nbsp;<a href='javascript:disOEC(#"",WBEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",WBEFURNO,"#",#"",WBEFVISN,"#",#"",WBEFCNTR,"#")'>":
                       "<img src=../images/MaintenanceIcon.gif ":
                       "class=ListIcon></a>&nbsp;":
                       GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                       "</td></tr>";

          ELSE
DMBW3200    WRITE     HTMLFILE;"<tr><td class=DataField>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",OPMBMBSI,"'></td>":
                               "<td class=DataField>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
          ENDIF
.
          UNPACK    SP70,SAVMBSCD,DIM40,SAVDATE
          MOVE      ZERO,COUNTER
.
          GOTO      DMBW2000
.
DMBW6000  COMPARE   ZERO,F1
          GOTO      DMBW9999 IF EQUAL
.
          MATCH     SP70,SAVMBSCD
          GOTO      DMBW9999 IF EQUAL
.
          MOVE      SAVMBSCD,KEY9
          PACK      KEY17,KEY9,SAVDATE,SP70
          CALL      CDES0000                * Get MBS/ICD Operation Code desc.
.
          MOVE      SAVMBSCD,GELF0MBS
          CALL      GEWF0000
.
          MATCH     SAVEPRIM,SAVMBSCD
          GOTO      DMBW6100 IF EQUAL
.
          IF        GELFINDC=ONE
            WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",SAVMBSCD,"'></td>":
                               "<td class=DataField width=45%>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>":
.                      "&nbsp;<a href='javascript:disOEC(#"",WBEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",WBEFURNO,"#",#"",WBEFVISN,"#",#"",WBEFCNTR,"#")'>":
                       "<img src=../images/MaintenanceIcon.gif ":
                       "class=ListIcon></a>&nbsp;":
                       GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                       "</td></tr>";

          ELSE
DMBW6100    WRITE     HTMLFILE;"<tr><td class=DataField>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",SAVMBSCD,"'></td>":
                               "<td class=DataField>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
          ENDIF
.
          GOTO      DMBW9999
.
DMBW8000  MOVE      OPMBMBSI,KEY9
          PACK      KEY17,KEY9,OPDADATE,SP70
          CALL      CDES0000                * Get MBS/ICD Operation Code desc.
.
          MOVE      OPMBMBSI,GELF0MBS
          CALL      GEWF0000
.
          MATCH     SAVEPRIM,OPMBMBSI
          GOTO      DMBW8100 IF EQUAL
.
          IF        GELFINDC=ONE
            WRITE     HTMLFILE;"<tr><td class=DataField width=12%>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",OPMBMBSI,"'></td>":
                               "<td class=DataField width=45%>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>":
.                      "&nbsp;<a href='javascript:disOEC(#"",WBEFELGN,"#")'>":
       "&nbsp;<a href='javascript:disOEC(#"",WBEFURNO,"#",#"",WBEFVISN,"#",#"",WBEFCNTR,"#")'>":
                       "<img src=../images/MaintenanceIcon.gif ":
                       "class=ListIcon></a>&nbsp;":
                       GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                       "</td></tr>";

          ELSE
DMBW8100    WRITE     HTMLFILE;"<tr><td class=DataField>":
                               "<input type=text size=9 maxlength=12 ":
                               "class='Readonly readonly'":
                               " value='",OPMBMBSI,"'></td>":
                               "<td class=DataField>":
                               "<input type=text size=50 maxlength=70 ":
                               "class='Readonly readonly'":
                               " value='",IDESC,"'>&nbsp;":
                         "<img src=../images/BlankIcon.gif ":
                         "class=ListIcon>&nbsp;":
                         GELFSTAT,"&nbsp;",GELFCFEC,"&nbsp;",GELFCFET:
                         "</td></tr>";
          ENDIF
.
          GOTO      DMBW2000
.
DMBW9999  RETURN
+
.------------------------------------------------------------------------
.   Get last occurence of MBS item from webelfaf for an admission number
.------------------------------------------------------------------------
GEWF0000  MOVE      ZERO,GELFINDC
          MOVE      SP70,GELFSTAT
          MOVE      SP70,GELFCFEC
          MOVE      SP70,GELFCFET
.
          PACK      KEY16,OPDAURNO,Z70
          CALL      RSWBELF2
GEWF1000  CALL      RPWBELF2
          BRANCH    OVRCD,GEWF9999
.
          MATCH     OPDAURNO,WBEFURNO
          GOTO      GEWF9999 IF NOT EQUAL
.
          MATCH     OPDAADMN,WBEFVISN
          GOTO      GEWF1000 IF NOT EQUAL
.
          MATCH     GELF0MBS,WBEFPRIM
          GOTO      GEWF1000 IF NOT EQUAL
.
          MOVE      WBEFVISN,KEY20
          LJUSTIFY  KEY20
          PACK      KEY23,KEY20,WBEFCNTR,SP70
          CALL      RDWBEEH1
          BRANCH    OVRCD,GEWF9000
.
          MATCH     "A",WBEHCFAC
          IF        @EQUAL
            MOVE      "ACCEPTED",GELFSTAT
          ENDIF
.
          MATCH     "R",WBEHCFAC
          IF        @EQUAL
            MOVE      "REJECTED",GELFSTAT
          ENDIF
.
          MATCH     "W",WBEHCFAC
          IF        @EQUAL
            MOVE      "WARNING",GELFSTAT
          ENDIF
.
          MATCH     "C",WBEHCFAC
          IF        @EQUAL
            MOVE      "COMPLETED",GELFSTAT
          ENDIF
.
          PACK      KEY30,KEY20,WBEFCNTR,SP70
          CALL      RSWBEED1
          CALL      RKWBEED1
          BRANCH    OVRCD,GEWF9000
.
          MATCH     KEY20,WBEDARID
          GOTO      GEWF9000 IF NOT EQUAL
.
          MATCH     WBEFCNTR,WBEDRPTC
          GOTO      GEWF9000 IF NOT EQUAL
.
          MOVE      WBEDCFEC,GELFCFEC
          MOVE      WBEDCFET,GELFCFET
.
GEWF9000  MOVE      ONE,GELFINDC
.
GEWF9999  RETURN
+
.------------------------------------------------------------
.   Link OECW Table Row
.------------------------------------------------------------
LOCRWW00  WRITE     HTMLFILE;"<tr>";
.
          MATCH     SP70,WBEFVISN
          IF        !@EQUAL
.
            PACK      KEY8,WBEFVISN,SP70   * Check for Emergency OECW
            CALL      RDEMVIS1
            IF        OVRCD=0
              GOTO      LOCRWW10
            ENDIF
.
            MOVE      WBEFVISN,DIM20
            LJUSTIFY  DIM20
            PACK      DIM20,DIM20,SP70
            PACK      KEY23,DIM20,WBEFCNTR,SP70
            CALL      RDWBEEH1
            IF        OVRCD=1
              CALL      CLWEBEEH
            ENDIF
          ELSE
LOCRWW10    MOVE      WBEFELGN,DIM20
            LJUSTIFY  DIM20
            PACK      DIM20,DIM20,SP70
            PACK      KEY23,DIM20,SP1,SP1,ONE,SP70
            CALL      RDWBEEH1
            IF        OVRCD=1
              CALL      CLWEBEEH
            ENDIF
          ENDIF
.
          REP       " +",WBEFELGN
          MATCH     ADMISSNO,WBEFVISN
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><input type=checkbox checked ":
                      "onclick=linkOEC(this); value=",WBEFELGN,"></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox ":
                      "onclick=linkOEC(this); value=",WBEFELGN,"></td>";
          ENDIF
          REP       "+ ",WBEFELGN
.
          UNPACK    WBEFCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<td nowrap>";
          WRITE     HTMLFILE;"<a href='javascript:disOEC(#"",WBEFELGN,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif ":
                             "class=ListIcon></a>";
          WRITE     HTMLFILE;DISPDATE," at ",WBEFCTIM,"</td>";
.
.          MATCH     SP70,WBEFPRIC
.          IF        !@EQUAL
.            PACK      KEY5,CATil,WBEFPRIC,SP70
.            CALL      RDCODE1
.            IF        OVRCD=0
.              WRITE     HTMLFILE;"<td>",TDESC,"</td>";
.            ELSE
.              WRITE     HTMLFILE;"<td>",WBEFPRIC,"</td>";
.            ENDIF
.          ELSE
.            MATCH     SP70,WBEFPRIM
.            IF        !@EQUAL
.              PACK      KEY9,WBEFPRIM,SP70
.              PACK      KEY17,KEY9,SP70
.              CALL      PATITMRD
.              IF        OVRCD=0
.                WRITE     HTMLFILE;"<td>",IDESC,"</td>";
.              ELSE
.                WRITE     HTMLFILE;"<td>",WBEFPRIM,"</td>";
.              ENDIF
.            ELSE
.              WRITE     HTMLFILE;"<td>&nbsp;</td>";
.            ENDIF
.          ENDIF
.
           MATCH     SP70,WBEFPRIM
           IF        !@EQUAL
             PACK      KEY9,WBEFPRIM,SP70
             PACK      KEY17,KEY9,SP70
             CALL      PATITMRD
             IF        OVRCD=0
               WRITE     HTMLFILE;"<td>",IDESC,"</td>";
             ELSE
               WRITE     HTMLFILE;"<td>",WBEFPRIM,"</td>";
             ENDIF
           ELSE
            MATCH     SP70,WBEFPRIC
            IF        !@EQUAL
              PACK      KEY5,CATil,WBEFPRIC,SP70
              CALL      RDCODE1
              IF        OVRCD=0
                WRITE     HTMLFILE;"<td>",TDESC,"</td>";
              ELSE
                WRITE     HTMLFILE;"<td>",WBEFPRIC,"</td>";
              ENDIF
            ELSE
               WRITE     HTMLFILE;"<td>&nbsp;</td>";
            ENDIF
           ENDIF
.
          MATCH     SP70,WBEFEADT
          IF        !@EQUAL
            UNPACK    WBEFEADT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
            WRITE     HTMLFILE;"<td nowrap>",DISPDATE,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp;</td>";
          ENDIF
.
          MOVE      "No ",DIM3
          MATCH     "1",WBEHBENL
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM3,"</td>";
.
          MOVE      "&nbsp;",DIM10
          MATCH     ANSA,WBEHCFAC
          IF        @EQUAL
            MOVE      "ACCEPTED",DIM10
          ENDIF
          MATCH     ANSR,WBEHCFAC
          IF        @EQUAL
            MOVE      "REJECTED",DIM10
          ENDIF
          MATCH     ANSW,WBEHCFAC
          IF        @EQUAL
            MOVE      "WARNING",DIM10
          ENDIF
          MATCH     ANSC,WBEHCFAC
          IF        @EQUAL
            MOVE      "COMPLETED",DIM10
          ENDIF
          MATCH     ANSI,WBEHCFAC
          IF        @EQUAL
            MOVE      "INTERIM",DIM10
          ENDIF
          PACK      DIM10,DIM10,SP70
          WRITE     HTMLFILE;"<td>",DIM10,"</td>";
.
          MOVE      "No ",DIM3A
          MATCH     "Y",WBEHCPDI
          IF        @EQUAL
            MOVE      "Yes",DIM3A
          ENDIF
          MOVE      "No ",DIM3B
          MATCH     "Y",WBEHEADI
          IF        @EQUAL
            MOVE      "Yes",DIM3B
          ENDIF
          MOVE      "No ",DIM3C
          MATCH     "Y",WBEHEXDI
          IF        @EQUAL
            MOVE      "Yes",DIM3C
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM3A,"</td>";
          WRITE     HTMLFILE;"<td>",DIM3B,"</td>";
          WRITE     HTMLFILE;"<td>",DIM3C,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBEFELGN,"&nbsp;",WBEFVISN,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBEHPSCD,"&nbsp;</td>";
.
          WRITE     HTMLFILE;"</tr>"
.
LOCRWW99  RETURN
+
.------------------------------------------------------------
.   OECW Response Table Row
.------------------------------------------------------------
OEWR0000  MOVE      "No ",KEY3A
          MATCH     "1",WBEHBENL
          IF        @EQUAL
            MOVE      "Yes",KEY3A
          ENDIF
.
          MOVE      "No ",KEY3B
          MATCH     "1",WBEHCPDI
          IF        @EQUAL
            MOVE      "Yes",KEY3B
          ENDIF
.
          MOVE      "No ",KEY3C
          MATCH     "1",WBEHEADI
          IF        @EQUAL
            MOVE      "Yes",KEY3C
          ENDIF
.
          MOVE      "No ",KEY3D
          MATCH     "1",WBEHEXDI
          IF        @EQUAL
            MOVE      "Yes",KEY3D
          ENDIF
.
          MOVE      "No ",KEY3E
          MATCH     "1",WBEHTBDI
          IF        @EQUAL
            MOVE      "Yes",KEY3E
          ENDIF
.
          MOVE      SP70,KEY10
          MATCH     "A",WBEHCFAC
          IF        @EQUAL
            MOVE      "ACCEPTED  ",KEY10
          ENDIF
          MATCH     "R",WBEHCFAC
          IF        @EQUAL
            MOVE      "REJECTED  ",KEY10
          ENDIF
          MATCH     "W",WBEHCFAC
          IF        @EQUAL
            MOVE      "WARNING   ",KEY10
          ENDIF
          MATCH     "C",WBEHCFAC
          IF        @EQUAL
            MOVE      "COMPLETED ",KEY10
          ENDIF
          MATCH     "I",WBEHCFAC
          IF        @EQUAL
            MOVE      "INTERIM   ",KEY10
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:AssignPatientLinks('",HTMLLINK
          APPEND    URNUMBER,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ADMISSNO,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    WBEHRPTC,HTMLLINK
          APPEND    "');",HTMLLINK
          APPEND    "PatientLinkTo('patweb78.pbl',6,3,1,900,600);",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:AssignPatientLinks('",HTMLLNK2
          APPEND    URNUMBER,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    ADMISSNO,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    WBEHRPTC,HTMLLNK2
          APPEND    "');",HTMLLNK2
          APPEND    "PatientLinkTo('patweb78.pbl',6,4,1,900,425);",HTMLLNK2
          RESET     HTMLLNK2
.
          MOVE      WBEHARID,DIM8
          RJUSTIFY  DIM8
          REP       " +",DIM8
          REP       " +",WBEHRPTC
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          CLEAR     HTMLLNK3
          APPEND    "displayOEC('",HTMLLNK3
          APPEND    DIM8,HTMLLNK3
          APPEND    WBEHRPTC,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    URNUMBER,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    ADMISSNO,HTMLLNK3
          APPEND    "');",HTMLLNK3
          RESET     HTMLLNK3
.
          REP       "+ ",DIM8
          REP       "+ ",WBEHRPTC
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
          WRITE     HTMLFILE;"t.addRow(#"",WBEHCTID,"#",":
                             "#"",KEY3A,"#",":
                             "#"",KEY10,"#",":
                             "#"",KEY3B,"#",":
                             "#"",KEY3C,"#",":
                             "#"",KEY3D,"#",":
                             "#"";
.
          WRITE     HTMLFILE;"<img src=../images/DocumentIcon.gif ":
                             "class=ListIcon onclick=",HTMLLNK3,">";
.
          WRITE     HTMLFILE;WBEHPSCD,"#",":
                             "#"",KEY3E,"#",":
                             "#"",HTMLLINK,"#",":
                             "#"",HTMLLNK2,"#",":
                             "#"",WBEHCDTE,WBEHCTIM,"#")"
.
OEWR9999  RETURN
+
.------------------------------------------------------------------------------
.                      Eligibility details (WebServices)
.------------------------------------------------------------------------------
WELG0000  BRANCH    FLDITMNO,WELG0100,WELG0200,WELG0300,WELG0400,WELG0500:
                             WELG0600,WELG0700,WELG0800,WELG0900,WELG1000:
                             WELG1100,WELG1200,WELG1300,WELG1400,WELG1500:
                             WELG1600,WELG1700,WELG1800,WELG1900,WELG2000:
                             WELG2100,WELG2200,WELG2300,WELG2400,WELG2500:
                             WELG2600,WELG2700,WELG2800,WELG2900,WELG3000:
                             WELG3100,WELG3200,WELG3300,WELG3400,WELG3500:
                             WELG3600,WELG3700,WELG3800,WELG3900,WELG4000:
                             WELG4100,WELG4200,WELG4300,WELG4400,WELG4500:
                             WELG4600,WELG4700,WELG4800,WELG4900,WELG5000:
                             WELG5100,WELG5200,WELG5300,WELG5400,WELG5500:
                             WELG5600,WELG5700,WELG5800,WELG5900,WELG6000:
                             WELG6100,WELG6200,WELG6300,WELG6400,WELG6500:
                             WELG6600,WELG6700,WELG6800,WELG6900,WELG7000:
                             WELG7100,WELG7200,WELG7300,WELG7400,WELG7500:
                             WELG7600,WELG7700,WELG7800,WELG7900,WELG8000:
                             WELG8100,WELG8200,WELG8300,WELG8400,WELG8500:
                             WELG8600,WELG8700,WELG8800,WELG8900,WELG9000:
                             WELG9100,WELG9200,WELG9300,WELG9400
          GOTO      WELG9999
.
WELG0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WELG0110,WELG0120
.
          MOVE      PTELFINC,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      WELG9999
.
WELG0110  MOVE      SP3,YESNO
          MATCH     "1",PTELFINC
          IF        @EQUAL
            MOVE      YES,YESNO
          ENDIF
          MATCH     "0",PTELFINC
          IF        @EQUAL
            MOVE      NO,YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      WELG9999
.
WELG0120  WRITE     HTMLFILE;PTELFINC;
          GOTO      WELG9999
.
WELG0200  WRITE     HTMLFILE;PTELPPRI;
          GOTO      WELG9999
.
WELG0300  WRITE     HTMLFILE;PTELXCSS;
          GOTO      WELG9999
.
WELG0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WELG0410,WELG0420
.
          MOVE      PTELXCLS,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      WELG9999
.
WELG0410  MOVE      SP3,YESNO
          MATCH     "1",PTELXCLS
          IF        @EQUAL
            MOVE      YES,YESNO
          ENDIF
          MATCH     "0",PTELXCLS
          IF        @EQUAL
            MOVE      NO,YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      WELG9999
.
WELG0420  WRITE     HTMLFILE;PTELXCLS;
          GOTO      WELG9999
.
WELG0500  WRITE     HTMLFILE;PTELXCMN     * Comments
          GOTO      WELG9999
.
WELG0600  MOVE      PTELCMPL,KEY1
          CALL      BNOYES00              * Blank/Yes/No Option
          GOTO      WELG9999
.
WELG0700  MOVE      PTELCOVR,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      WELG9999
.
WELG0800  MOVE      PTELQEXS,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      WELG9999
.
WELG0900  MOVE      PTELQACC,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      WELG9999
.
WELG1000  WRITE     HTMLFILE;PTELPSHA;    * Co-payment for shared room
          GOTO      WELG9999
.
WELG1100  WRITE     HTMLFILE;*+,PTELPTHE; * Co-payment for theatre
          GOTO      WELG9999
.
WELG1200  MOVE      "EG",CATEGORY
          MOVE      PTELCDON,CODE         * check done via
          CALL      CODITM00
          GOTO      WELG9999
.
WELG1300  MATCH     PTELRDAT,SP70
          GOTO      WELG9999 IF EQUAL
          UNPACK    PTELRDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      WELG9999
.
WELG1400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WELG1410,WELG1420
.
          MOVE      PTELSPEA,KEY1
          CALL      SPEA0000              * PEA option
          GOTO      WELG9999
.
WELG1410  MOVE      SP70,KEY5
          MATCH     "1",PTELSPEA
          IF        @EQUAL
            MOVE      YES,KEY5
          ENDIF
          MATCH     "0",PTELSPEA
          IF        @EQUAL
            MOVE      NO,KEY5
          ENDIF
          MATCH     "2",PTELSPEA
          IF        @EQUAL
            MOVE      "Query",KEY5
          ENDIF
          WRITE     HTMLFILE;KEY5;
          GOTO      WELG9999
.
WELG1420  WRITE     HTMLFILE;PTELSPEA;
          GOTO      WELG9999
.
WELG1500  WRITE     HTMLFILE;PTELHFRN;
          GOTO      WELG9999
.
WELG1600  WRITE     HTMLFILE;PTELPTHF;
          GOTO      WELG9999
.
WELG1700  UNPACK    AFNDCG,CCENT,CYEAR,CMON
          MOVE      ZERO,F2
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WELG1710
.
          MOVE      SP70,KEY4
          PACK      KEY4,CCENT,CYEAR
          WRITE     HTMLFILE;CCENT,CYEAR;
          GOTO      WELG9999
.
WELG1710  WRITE     HTMLFILE;F2;
          GOTO      WELG9999
.
WELG1800  WRITE     HTMLFILE;MVMEDREC;
          GOTO      WELG9999
.
WELG1900  WRITE     HTMLFILE;RETURNCD;    * return code indicator
          GOTO      WELG9999
.
WELG2000  WRITE     HTMLFILE;PTELPPUT;
          GOTO      WELG9999
.
WELG2100  WRITE     HTMLFILE;PTELPSUT;
          GOTO      WELG9999
.
WELG2200  WRITE     HTMLFILE;PTELPTUT;
          GOTO      WELG9999
.
WELG2300  WRITE     HTMLFILE;PTELECMN;
          GOTO      WELG9999
.
WELG2400  MATCH     SP70,PMAEQUOT
          GOTO      WELG9999 IF EQUAL
          GOTO      WELG9999 IF EOS
.
          WRITE     HTMLFILE;" Estimate ",PMAEQUOT;
          GOTO      WELG9999
.
WELG2500  WRITE     HTMLFILE;PTELHSTM;
          GOTO      WELG9999
.
WELG2600  WRITE     HTMLFILE;PTELHFPN;
          GOTO      WELG9999
.
WELG2700  WRITE     HTMLFILE;PTELPSDY;
          GOTO      WELG9999
.
WELG2800  WRITE     HTMLFILE;PTELPSDU;
          GOTO      WELG9999
.
WELG2900  WRITE     HTMLFILE;PTELPHSP;
          GOTO      WELG9999
.
WELG3000  WRITE     HTMLFILE;PTELPHSU;
          GOTO      WELG9999
.
WELG3100  MOVE      PTELAFRM,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      WELG9999
.
WELG3200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WELG3210,WELG3220
.
          MOVE      PTELQLPS,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      WELG9999
.
WELG3210  MOVE      SP3,YESNO
          MATCH     "1",PTELQLPS
          IF        @EQUAL
            MOVE      YES,YESNO
          ENDIF
          MATCH     "0",PTELQLPS
          IF        @EQUAL
            MOVE      NO,YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      WELG9999
.
WELG3220  WRITE     HTMLFILE;PTELQLPS;
          GOTO      WELG9999
.
WELG3300  WRITE     HTMLFILE;PTELMDES;
          GOTO      WELG9999
.
WELG3400  WRITE     HTMLFILE;PTELMAMT;
          GOTO      WELG9999
.
WELG3500  MATCH     SP70,PMAEQUOT
          GOTO      WELG9999 IF EQUAL
          GOTO      WELG9999 IF EOS
.
          WRITE     HTMLFILE;PMAEQUOT;
          GOTO      WELG9999
.
WELG3600  WRITE     HTMLFILE;ECLPHFRN;
          GOTO      WELG9999
.
WELG3700  WRITE     HTMLFILE;ECLPHFPN;
          GOTO      WELG9999
.
WELG3800  WRITE     HTMLFILE;ECLPFINA;
          GOTO      WELG9999
.
WELG3900  WRITE     HTMLFILE;ECLPCPRP;
          GOTO      WELG9999
.
WELG4000  WRITE     HTMLFILE;ECLPEFTA;
          GOTO      WELG9999
.
WELG4100  WRITE     HTMLFILE;ECLPSTPA;
          GOTO      WELG9999
.
WELG4200  WRITE     HTMLFILE;ECLPEXEX;
          GOTO      WELG9999
.
WELG4300  MATCH     SP70,WBEHCPAM
          GOTO      WELG9999 IF EQUAL
          GOTO      WELG9999 IF EOS
.
          MATCH     "0        ",WBEHCPAM
          IF        @EQUAL
            WRITE     HTMLFILE;WBEHCPAM
            GOTO      WELG9999
          ENDIF
.
          MOVE      SP70,DIM9
          MOVE      WBEHCPAM,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      WELG9999
.
WELG4400  WRITE     HTMLFILE;WBEHCPDR;
          GOTO      WELG9999
.
WELG4500  MATCH     SP70,WBEHEXAM
          GOTO      WELG9999 IF EQUAL
          GOTO      WELG9999 IF EOS
.
          MATCH     "0        ",WBEHEXAM
          IF        @EQUAL
            WRITE     HTMLFILE;WBEHEXAM
            GOTO      WELG9999
          ENDIF
.
          MOVE      SP70,DIM9
          MOVE      WBEHEXAM,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2
          GOTO      WELG9999
.
WELG4600  MATCH     SP70,WBEHEXBA
          GOTO      WELG9999 IF EQUAL
          GOTO      WELG9999 IF EOS
.
          MATCH     "0        ",WBEHEXBA
          IF        @EQUAL
            WRITE     HTMLFILE;WBEHEXBA
            GOTO      WELG9999
          ENDIF
.
          MOVE      SP70,DIM9
          MOVE      WBEHEXBA,DIM9
          RJUSTIFY  DIM9
          UNPACK    DIM9,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2
          GOTO      WELG9999
.
WELG4700  WRITE     HTMLFILE;WBEHFRID;
          GOTO      WELG9999
.
WELG4800  WRITE     HTMLFILE;WBEHTNAM;
          GOTO      WELG9999
.
WELG4900  WRITE     HTMLFILE;WBEHTBSC;
          GOTO      WELG9999
.
WELG5000  MOVE      "001",ELIGTYPE
          CALL      ECDSW000
          GOTO      WELG9999
.
WELG5100  MOVE      "002",ELIGTYPE
          CALL      ECDSW000
          GOTO      WELG9999
.
WELG5200  MOVE      "003",ELIGTYPE
          CALL      ECDSW000
          GOTO      WELG9999
.
WELG5300  MOVE      "004",ELIGTYPE
          CALL      ECDSW000
          GOTO      WELG9999
.
WELG5400  MOVE      "005",ELIGTYPE
          CALL      ECDSW000
          GOTO      WELG9999
.
WELG5500  MATCH     "Y",WBEHFSTA
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      WELG9999
.
WELG5600  MATCH     "Y",WBEHPEAI
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      WELG9999
.
WELG5700  WRITE     HTMLFILE;REDECFBT;
          GOTO      WELG9999
.
WELG5800  CALL      SRVASW00
          GOTO      WELG9999
.
WELG5900  CALL      OECT0000
          GOTO      WELG9999
.
WELG6000  CALL      OECTR000
          GOTO      WELG9999
.
WELG6100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WELG6110,WELG6120
.
          MOVE      PTELEADM,KEY1
          CALL      DNOYES00              * Yes/No option
          GOTO      WELG9999
.
WELG6110  MOVE      SP3,YESNO
          MATCH     "1",PTELEADM
          IF        @EQUAL
            MOVE      YES,YESNO
          ENDIF
          MATCH     "0",PTELEADM
          IF        @EQUAL
            MOVE      NO,YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      WELG9999
.
WELG6120  WRITE     HTMLFILE;PTELEADM;
          GOTO      WELG9999
.
WELG6200  CALL      WEBEED00
          GOTO      WELG9999
.
WELG6300  WRITE     HTMLFILE;PTELTOOP;
          GOTO      WELG9999
.
WELG6400  MOVE      ZERO,F1
          PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MATCH     "3",TCINDC5
            IF        @EQUAL
              MOVE      ONE,F1              * Self Insured patient
            ENDIF
          ENDIF
          WRITE     HTMLFILE;F1;
          GOTO      WELG9999
.
WELG6500  WRITE     HTMLFILE;PTELCPCP;
          GOTO      WELG9999
.
WELG6600  WRITE     HTMLFILE;PTELCSCP;
          GOTO      WELG9999
.
WELG6700  WRITE     HTMLFILE;PTELCDCP;
          GOTO      WELG9999
.
WELG6800  WRITE     HTMLFILE;PTELCHCP;
          GOTO      WELG9999
.
WELG6900  WRITE     HTMLFILE;PTELCTCP;
          GOTO      WELG9999
.
WELG7000  MOVE      ONE,FESTINDC
WELG7005  PACK      KEY5,ANSF,ANSE,SP70
          CALL      RDSCODE1
WELG7010  CALL      RDKCODE1
          BRANCH    OVRCD,WELG9999
.
          MATCH     "FE",TCODE              * get codes from cat FE
          GOTO      WELG9999 IF NOT EQUAL
.
          MOVE      TCINDC1,F2
          COMPARE   FESTINDC,F2             * check indc1 for print order
          GOTO      WELG7010 IF NOT EQUAL
.
          MATCH     "I",TCINDC2             * only want 'IFC' codes (indc2)
          IF        !@EQUAL
            MATCH     " ",TCINDC2           * blank is ok
            GOTO      WELG7010 IF NOT EQUAL
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td class=HeadingRow>",TDESC,"</td></tr>"
.
          WRITE     HTMLFILE;"<tr><td>";
          PACK      KEY6,ACODE,SP70
          CALL      RSPMFET1
WELG7020  CALL      RKPMFET1
          BRANCH    OVRCD,WELG7030
.
          MATCH     ACODE,PMFETYPE
          GOTO      WELG7030 IF NOT EQUAL
.
          STRIP     PMFETEXT
          MOVELPTR  PMFETEXT,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      PMFETEXT,VAR
          WRITE     HTMLFILE;VAR            * display text detail
          SFORMAT   VAR,127
          GOTO      WELG7020
.
WELG7030  WRITE     HTMLFILE;"</td></tr>"
          ADD       ONE,FESTINDC
          GOTO      WELG7005
.
WELG7100  WRITE     HTMLFILE;PTELXCSD;      * Fund Excess for same day
          GOTO      WELG9999
.
WELG7200  WRITE     HTMLFILE;PTELPCCU;      * Co-payment CCU,ICU,SCN,HDU
          GOTO      WELG9999
.
WELG7300  WRITE     HTMLFILE;PTELCCCU;      * Calculate CCU,ICU,SCN,HDU
          GOTO      WELG9999
.
WELG7400  WRITE     HTMLFILE;PTELPCUT;      * CCU,ICU,SCN,HDU Co-payment Up To
          GOTO      WELG9999
.
WELG7500  WRITE     HTMLFILE;PMEXPMKN;      * PMKeys Number
          GOTO      WELG9999
.
WELG7600  WRITE     HTMLFILE;PMEXDANO;      * Defence Approval Number (DAN)
          GOTO      WELG9999
.
WELG7700  MATCH     PMEXDAT1,SP70           * Referral Date
          GOTO      WELG9999 IF EQUAL
          UNPACK    PMEXDAT1,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      WELG9999
.
WELG7800  WRITE     HTMLFILE;PMEXABIC;      * Accepted by Insurance Company?
          GOTO      WELG9999
.
WELG7900  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,WELG7910
          WRITE     HTMLFILE;PTELCMXC;
          GOTO      WELG9999
.
WELG7910  OPEN      PATCMCA1,"patcmcaf"
          PACK      KEY9,PTELCMXC,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,WELG9999
          WRITE     HTMLFILE;PTCADES1;
          GOTO      WELG9999
.
WELG8000  WRITE     HTMLFILE;USEBASIC;
          GOTO      WELG9999
.
WELG8100  WRITE     HTMLFILE;PTELECLS;
          GOTO      WELG9999
.
WELG8200  CALL      IFCDOC00             * get Document type for IFC
          GOTO      WELG9999
.
WELG8300  WRITE     HTMLFILE;PTELCMPL;
          GOTO      WELG9999
.
WELG8400  CALL      DSMBS000             * Display MBS from linked OEC
          GOTO      WELG9999
.
WELG8500  CALL      SELGST00                * Selection of GST
          GOTO      WELG9999
.
WELG8600  CALL      OEMTR000
          GOTO      WELG9999
.
WELG8700  WRITE     HTMLFILE;OLDOECIN;
          GOTO      WELG9999
.
WELG8800  CALL      GSTAPL00                * GST Applicable ?
          GOTO      WELG9999
.
WELG8900  CALL      QUANT000                * No of items/Quantity
          GOTO      WELG9999
.
WELG9000  CALL      ITMCOD00               * Theatre/Misc.code
          GOTO      WELG9999
.
WELG9100  CALL      MANKEY00               * Keyin GST/Misc amount ?
          GOTO      WELG9999
.
WELG9200  WRITE     HTMLFILE;PTCNEMCH;     * Misc.Charge Desc on Elig.Check 
          GOTO      WELG9999
.
WELG9300  WRITE     HTMLFILE;PTCNEITM;     * Using Misc.Charge on Elig.Check
          GOTO      WELG9999
.
WELG9400  CALL      ELIA0000               * HEA Eligibility Check items
          GOTO      WELG9999
.
WELG9999  RETURN
+
.------------------------------------------------------------
.   OECW ECM Request Table
.------------------------------------------------------------
OEMTR000  MATCH     "1",PTCNWSIN
          GOTO      OEMTR999 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      OEMTR999 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      OEMTR999 IF NOT EQUAL
.
          PACK      KEY11,ADMISSNO,SP70
          CALL      RSWBOEM1
OEMTR600  CALL      RKWBOEM1
          BRANCH    OVRCD,OEMTR999
.
          MATCH     ADMISSNO,WBOEVISN
          GOTO      OEMTR999 IF NOT EQUAL
.
          PACK      KEY23,WBOEARID,WBOECNTR,SP70
          CALL      RDWBOMG1
          IF        OVRCD=1
            CALL      CLWEBOMG
          ENDIF
.
          CALL      OEMWR000
.
          GOTO      OEMTR600
.
OEMTR999  RETURN
+
.------------------------------------------------------------
.   OECW - ECM Request Table Row
.------------------------------------------------------------
OEMWR000  MOVE      SP70,KEY20
          MATCH     " 0",WBOESTAT
          IF        @EQUAL
            MOVE      "WAITING",KEY20
          ENDIF
.
          MATCH     " 1",WBOESTAT
          IF        @EQUAL
            MOVE      "EXTRACTED",KEY20
          ENDIF
.
          MATCH     " 2",WBOESTAT
          IF        @EQUAL
            MOVE      "RECEIVED",KEY20
          ENDIF
.
          MATCH     " 3",WBOESTAT
          IF        @EQUAL
            MOVE      "webPAS&nbsp;ERROR",KEY20
          ENDIF
.
          MATCH     " 4",WBOESTAT
          IF        @EQUAL
            MOVE      "WebServices&nbsp;ERROR",KEY20
          ENDIF
.
          MATCH     " 6",WBOESTAT
          IF        @EQUAL
            MOVE      "COMP&nbsp;REPORTED",KEY20
          ENDIF
.
          MATCH     " 5",WBOESTAT
          IF        @EQUAL
            MOVE      "REJ&nbsp;REPORTED",KEY20
          ENDIF
.
.         MATCH     " 7",WBOESTAT
.         IF        @EQUAL
.           MOVE      "HF&nbsp;UNAVAILABLE",KEY20
.         ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:AssignPatientLinks('",HTMLLINK
          APPEND    URNUMBER,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ADMISSNO,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    WBOECNTR,HTMLLINK
          APPEND    "');",HTMLLINK
          APPEND    "PatientLinkTo('patweb78.pbl',15,2,1,900,900);",HTMLLINK
          RESET     HTMLLINK
.
.         CLEAR     HTMLLNK2
.         APPEND    "javascript:AssignPatientLinks('",HTMLLNK2
.         APPEND    URNUMBER,HTMLLNK2
.         APPEND    "','",HTMLLNK2
.         APPEND    ADMISSNO,HTMLLNK2
.         APPEND    "','",HTMLLNK2
.         APPEND    WBOECNTR,HTMLLNK2
.         APPEND    "');",HTMLLNK2
.         APPEND    "PatientLinkTo('patweb78.pbl',15,3,1,900,425);",HTMLLNK2
.         RESET     HTMLLNK2
.
          REP       " +",WBOEVISN
          REP       " +",WBOECNTR
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          CLEAR     HTMLLNK3
          APPEND    "displayOEC('",HTMLLNK3
          APPEND    WBOEVISN,HTMLLNK3
          APPEND    WBOECNTR,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    URNUMBER,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    ADMISSNO,HTMLLNK3
          APPEND    "');",HTMLLNK3
          RESET     HTMLLNK3
.
          REP       "+ ",WBOEVISN
          REP       "+ ",WBOECNTR
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
          WRITE     HTMLFILE;"t.addRow(#"";
.
          WRITE     HTMLFILE;"<img src=../images/DocumentIcon.gif ":
                             "class=ListIcon onclick=",HTMLLNK3,">";
          WRITE     HTMLFILE;WBOETRID;
.
          WRITE     HTMLFILE;"#",":
                             "#"",WBOECDTE,WBOECTIM,"#",":
                             "#"#",":
                             "#"",WBOEERRC,"&nbsp;&nbsp;&nbsp;",WBOEERRD,"#",":
                             "#"",WBOEERRD,"#",":
                             "#"",WBOGSTAT,"#",":
                             "#"",HTMLLINK,"#",":
                             "#"",HTMLLNK2,"#",":
                             "#"",WBOGCDTE,WBOGCTIM,"#",":
                             "#"",KEY20,"#",":
                             "#"#",":
                             "#"",HTMLLNK3,"#")"
.
OEMWR999  RETURN
+
.-----------------------------------------------------------
.         Casemix Verification Audit                
.-----------------------------------------------------------
CVAU0000  MOVE      URNUMBER,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,CVAU7100
.
          CALL      RDPMPX21 
.
          CLEAR     WEBTITLE
          MOVE      "Casemix Code Verification Audit",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CVAU9999
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      CVAU9999
.
CVAU7100  MOVE      "Missing Master record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CVAU9999
.
CVAU9999  RETURN
+
.-----------------------------------------------------------
.         WebServices OECW-ECM Display Functionality
.-----------------------------------------------------------
OEMW0000  MATCH     "1",PTCNWSIN
          GOTO      OEMW7300 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      OEMW7400 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      OEMW7500 IF NOT EQUAL
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      OEMW1000 IF EQUAL
.
          GOTO      OEMW8000
.
OEMW1000  MOVE      URNUMBER,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,OEMW7100
.
          CALL      RDPMPX21
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMVX11
          IF        OVRCD<>1
            MATCH     SP70,PMVXMHOS
            IF        !@EQUAL
              PACK      KEY3,PMVXMHOS,SP70
              CALL      RDPTHSP1
              IF        OVRCD=1
                CALL      CLPATHSP
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CLPATMIS         
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,OEMW7200
.
          CALL      CLWEBOEM
          CALL      CLWEBOMS
          CALL      CLWEBOMF
          CALL      CLWEBOMG
          CALL      CLWEBOMH
          CALL      CLWEBOMI
.
          MATCH     SP70,REPCOUNT
          IF        !@EQUAL
.
            PACK      KEY11,ADMISSNO,REPCOUNT,SP70
            CALL      RDWBOEM1
            IF        OVRCD=0
.
              MATCH     SP70,WBOEELEG
              IF        !@EQUAL
                PACK      KEY8,WBOEELEG,SP70
                CALL      RDWBOMF1 
                IF        OVRCD=1
                  CALL      CLWEBOMF
                ENDIF
              ENDIF
.
              MATCH     SP70,OMSCOUNT
              IF        !@EQUAL
.
                PACK      KEY14,ADMISSNO,REPCOUNT,OMSCOUNT,SP70
                CALL      RDWBOMS1
                IF        OVRCD=1
                  CALL      CLWEBOMS
                ENDIF
.
              ENDIF
.
              MOVE      ADMISSNO,KEY20
              LJUSTIFY  KEY20
              PACK      KEY23,KEY20,REPCOUNT,SP70
              CALL      RDWBOMG1
              IF        OVRCD=1
                CALL      CLWEBOMG
              ENDIF
.
              MATCH     SP70,OMHCOUNT
              IF        !@EQUAL
.
                MOVE      ADMISSNO,KEY20
                LJUSTIFY  KEY20
                PACK      KEY25,KEY20,REPCOUNT,OMHCOUNT,SP70 
                CALL      RDWBOMH1
                IF        OVRCD=1
                  CALL      CLWEBOMH
                ENDIF
.
              ENDIF
.
              MATCH     SP70,OMICOUNT
              IF        !@EQUAL
.
                MOVE      ADMISSNO,KEY20
                LJUSTIFY  KEY20
                PACK      KEY29,KEY20,REPCOUNT,OMHCOUNT,OMICOUNT,SP70
                CALL      RDWBOMI1
                IF        OVRCD=1
                  CALL      CLWEBOMI
                ENDIF

.
              ENDIF
.
            ENDIF
.
          ENDIF
.
          GOTO      OEMW8000
.
.
.
OEMW7100  MOVE      "Missing Master record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OEMW9999
.
OEMW7200  MOVE      "Missing Admission record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OEMW9999
.
OEMW7300  MOVE      "WebServices Not Switched On.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OEMW9999
.
OEMW7400  MOVE      "WebServices OECW Not Switched On.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OEMW9999
.
OEMW7500  MOVE      "WebServices OECW tables Not Found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OEMW9999
.
OEMW8000  CLEAR     WEBTITLE
          MOVE      "WebServices OECW-ECM",WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OEMW9999
.
          CALL      WEBBOD00   * Output Templated Body of HTML
          CALL      WEBEND00   * Output End of Web Page
          MOVE      ONE,EXIT
.
OEMW9999  RETURN
+
.----------------------------------------------------------------------------
. Report No. 15 : WebServices OECW-ECM Request Tags
.----------------------------------------------------------------------------
OEMT0000  BRANCH    FLDITMNO,OEMT0100,OEMT0200,OEMT0300,OEMT0400,OEMT0500:
                             OEMT0600,OEMT0700,OEMT0800,OEMT0900,OEMT1000:
                             OEMT1100,OEMT1200,OEMT1300,OEMT1400,OEMT1500:
                             OEMT1600,OEMT1700,OEMT1800,OEMT1900,OEMT2000:
                             OEMT2100,OEMT2200,OEMT2300,OEMT2400,OEMT2500:
                             OEMT2600,OEMT2700,OEMT2800,OEMT2900,OEMT3000:
                             OEMT3100,OEMT3200,OEMT3300,OEMT3400,OEMT3500:
                             OEMT3600,OEMT3700,OEMT3800,OEMT3900,OEMT4000:
                             OEMT4100,OEMT4200,OEMT4300,OEMT4400,OEMT4500:
                             OEMT4600,OEMT4700,OEMT4800,OEMT4900,OEMT5000:
                             OEMT5100,OEMT5200,OEMT5300,OEMT5400,OEMT5500:
                             OEMT5600,OEMT5700,OEMT5800,OEMT5900,OEMT6000:
                             OEMT6100,OEMT6200,OEMT6300,OEMT6400,OEMT6500:
                             OEMT6600,OEMT6700,OEMT6800,OEMT6900,OEMT7000:
                             OEMT7100,OEMT7200,OEMT7300,OEMT7400,OEMT7500:
                             OEMT7600,OEMT7700,OEMT7800,OEMT7900,OEMT8000:
                             OEMT8100,OEMT8200,OEMT8300,OEMT8400,OEMT8500:
                             OEMT8600
.
          GOTO      OEMT9999
.
OEMT0100  WRITE     HTMLFILE;WBOEVISN;
          GOTO      OEMT9999
.
OEMT0200  WRITE     HTMLFILE;WBOECNTR;
          GOTO      OEMT9999
.
OEMT0300  MOVE      SP70,KEY20
          MATCH     " 0",WBOESTAT
          IF        @EQUAL
            MOVE      "WAITING",KEY20
          ENDIF
.
          MATCH     " 1",WBOESTAT
          IF        @EQUAL
            MOVE      "EXTRACTED",KEY20
          ENDIF
.
          MATCH     " 2",WBOESTAT
          IF        @EQUAL
            MOVE      "RECEIVED",KEY20
          ENDIF
.
          MATCH     " 3",WBOESTAT
          IF        @EQUAL
            MOVE      "webPAS&nbsp;ERROR",KEY20
          ENDIF
.
          MATCH     " 4",WBOESTAT
          IF        @EQUAL
            MOVE      "WebServices&nbsp;ERROR",KEY20
          ENDIF
.
          MATCH     " 6",WBOESTAT
          IF        @EQUAL
            MOVE      "COMP&nbsp;REPORTED",KEY20
          ENDIF
.
          MATCH     " 5",WBOESTAT
          IF        @EQUAL
            MOVE      "REJ&nbsp;REPORTED",KEY20
          ENDIF
.
          WRITE     HTMLFILE;KEY20;
          GOTO      OEMT9999
.
OEMT0400  WRITE     HTMLFILE;WBOEURNO;
          GOTO      OEMT9999
.
OEMT0500  WRITE     HTMLFILE;WBOEARID;
          GOTO      OEMT9999
.
OEMT0600  WRITE     HTMLFILE;WBOETRID;
          GOTO      OEMT9999
.
OEMT0700  MATCH     SP70,WBOERQDT         
          GOTO      OEMT9999 IF EQUAL
          UNPACK    WBOERQDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OEMT9999
.
OEMT0800  WRITE     HTMLFILE;WBOEETYP;
          GOTO      OEMT9999
.
OEMT0900  WRITE     HTMLFILE;WBOEERRC;
          GOTO      OEMT9999
.
OEMT1000  WRITE     HTMLFILE;WBOEERRD;
          GOTO      OEMT9999
.
OEMT1100  MATCH     SP70,WBOECDTE
          GOTO      OEMT9999 IF EQUAL
          UNPACK    WBOECDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OEMT9999
.
OEMT1200  WRITE     HTMLFILE;WBOECTIM;
          GOTO      OEMT9999
.
OEMT1300  MATCH     SP70,WBOEUDTE
          GOTO      OEMT9999 IF EQUAL
          UNPACK    WBOEUDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OEMT9999
.
OEMT1400  WRITE     HTMLFILE;WBOEUTIM;
          GOTO      OEMT9999
.
OEMT1500  WRITE     HTMLFILE;WBOEHOSP;
          GOTO      OEMT9999
.
OEMT1600  WRITE     HTMLFILE;WBOEELEG;
          GOTO      OEMT9999
.
OEMT1700  WRITE     HTMLFILE;WBOEMSID;
          GOTO      OEMT9999
.
OEMT1800  WRITE     HTMLFILE;WBOFELGN;
          GOTO      OEMT9999
.
OEMT1900  WRITE     HTMLFILE;WBOFURNO;
          GOTO      OEMT9999
.
OEMT2000  WRITE     HTMLFILE;WBOFOECC;
          GOTO      OEMT9999
.
OEMT2100  WRITE     HTMLFILE;WBOFTITL;
          GOTO      OEMT9999
.
OEMT2200  WRITE     HTMLFILE;WBOFFNAM;
          GOTO      OEMT9999
.
OEMT2300  WRITE     HTMLFILE;WBOFSNAM;
          GOTO      OEMT9999
.
OEMT2400  WRITE     HTMLFILE;WBOFSNAM;
          GOTO      OEMT9999
.
OEMT2500  WRITE     HTMLFILE;WBOFHFGN;
          GOTO      OEMT9999
.
OEMT2600  WRITE     HTMLFILE;WBOFHFSN;
          GOTO      OEMT9999
.
OEMT2700  WRITE     HTMLFILE;WBOFGEND;
          GOTO      OEMT9999
.
OEMT2800  MOVE      SP70,DISPSEX
.
          MATCH     "M",WBOFGEND
          IF        @EQUAL
            MOVE      "Male",DISPSEX
          ENDIF
          MATCH     "F",WBOFGEND
          IF        @EQUAL
            MOVE      "Female",DISPSEX
          ENDIF
          MATCH     "I",WBOFGEND
          IF        @EQUAL
            MOVE      "Indeterminate",DISPSEX
          ENDIF
          MATCH     "U",WBOFGEND
          IF        @EQUAL
            MOVE      "Unknown",DISPSEX
          ENDIF
.
          WRITE     HTMLFILE;DISPSEX;
          GOTO      OEMT9999
.
OEMT2900  MATCH     SP70,WBOFBDAT
          GOTO      OEMT9999 IF EQUAL
          UNPACK    WBOFBDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OEMT9999
.
OEMT3000  MATCH     SP70,WBOFEADT
          GOTO      OEMT9999 IF EQUAL
          UNPACK    WBOFEADT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OEMT9999
.
OEMT3100  MOVE      "VI",CATEGORY
          MOVE      WBOFISTY,CODE
          CALL      CODITM00
          GOTO      OEMT9999
.
OEMT3200  WRITE     HTMLFILE;WBOFPLOS;
          GOTO      OEMT9999
.
OEMT3300  MOVE      "KN",CATEGORY
          MOVE      WBOFDINT,CODE
          CALL      CODITM00
          GOTO      OEMT9999
.
OEMT3400  MATCH     "0",WBOFPEAI
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            MATCH     "1",WBOFPEAI
            IF        @EQUAL
              WRITE     HTMLFILE;"Yes";
            ELSE
              WRITE     HTMLFILE;"Query";
            ENDIF
          ENDIF
          GOTO      OEMT9999
.
OEMT3500  MATCH     "0",WBOFEMAD
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      OEMT9999
.
OEMT3600  MOVE      "il",CATEGORY
          MOVE      WBOFPRIC,CODE
          CALL      CODITM00
          GOTO      OEMT9999
.
OEMT3700  WRITE     HTMLFILE;WBOFPRIM;
          GOTO      OEMT9999
.
OEMT3800  MOVE      "CL",CATEGORY
          MOVE      WBOFCLTY,CODE
          CALL      CODITM00
          GOTO      OEMT9999
.
OEMT3900  PACK      KEY14,WBOFHFND,ZERO8
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
          ELSE
            WRITE     HTMLFILE;WBOFHFND;
          ENDIF
          GOTO      OEMT9999
.
OEMT4000  WRITE     HTMLFILE;WBOFHFNT;
          GOTO      OEMT9999
.
OEMT4100  WRITE     HTMLFILE;WBOFHFMN;
          GOTO      OEMT9999
.
OEMT4200  WRITE     HTMLFILE;WBOFDIAG;
          GOTO      OEMT9999
.
OEMT4300  WRITE     HTMLFILE;WBOFSRV1;
          GOTO      OEMT9999
.
OEMT4400  WRITE     HTMLFILE;WBOFSRV2;
          GOTO      OEMT9999
.
OEMT4500  WRITE     HTMLFILE;WBOFSRV3;
          GOTO      OEMT9999
.
OEMT4600  WRITE     HTMLFILE;WBOFSRV4;
          GOTO      OEMT9999
.
OEMT4700  WRITE     HTMLFILE;WBOFSRV5;
          GOTO      OEMT9999
.
OEMT4800  WRITE     HTMLFILE;WBOFCUID;
          GOTO      OEMT9999
.
OEMT4900  MATCH     SP70,WBOFCDAT
          GOTO      OEMT9999 IF EQUAL
          UNPACK    WBOFCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OEMT9999
.
OEMT5000  WRITE     HTMLFILE;WBOFCTIM;
          GOTO      OEMT9999
.
OEMT5100  WRITE     HTMLFILE;WBOFDVAN;
          GOTO      OEMT9999
.
OEMT5200  WRITE     HTMLFILE;WBOFVISN;
          GOTO      OEMT9999
.
OEMT5300  WRITE     HTMLFILE;WBOFCNTR;
          GOTO      OEMT9999
.
OEMT5400  WRITE     HTMLFILE;WBOFFLAG;
          GOTO      OEMT9999
.
OEMT5500  WRITE     HTMLFILE;WBOFTRID;
          GOTO      OEMT9999
.
OEMT5600  WRITE     HTMLFILE;WBOFMSID;
          GOTO      OEMT9999
.
OEMT5700  MOVE      "st",CATEGORY
          MOVE      WBOFSTCD,CODE
          CALL      CODITM00
          GOTO      OEMT9999
.
OEMT5800  WRITE     HTMLFILE;WBOFMEDI;
          GOTO      OEMT9999
.
OEMT5900  WRITE     HTMLFILE;WBOFMEDR;
          GOTO      OEMT9999
.
OEMT6000  WRITE     HTMLFILE;WBOFPRPR;
          GOTO      OEMT9999
.
OEMT6100  WRITE     HTMLFILE;WBOFSVPR;
          GOTO      OEMT9999
.
OEMT6200  WRITE     HTMLFILE;WBOFITM1;
          GOTO      OEMT9999
.
OEMT6300  WRITE     HTMLFILE;WBOFITM2;
          GOTO      OEMT9999
.
OEMT6400  WRITE     HTMLFILE;WBOFITM3;
          GOTO      OEMT9999
.
OEMT6500  WRITE     HTMLFILE;WBOFITM4;
          GOTO      OEMT9999
.
OEMT6600  WRITE     HTMLFILE;WBOFITM5;
          GOTO      OEMT9999
.
OEMT6700  WRITE     HTMLFILE;WBOMVISN;
          GOTO      OEMT9999
.
OEMT6800  WRITE     HTMLFILE;WBOMCNTR;
          GOTO      OEMT9999
.
OEMT6900  WRITE     HTMLFILE;WBOMSCNT;
          GOTO      OEMT9999
.
OEMT7000  WRITE     HTMLFILE;WBOMRTYP;
          GOTO      OEMT9999
.
OEMT7100  WRITE     HTMLFILE;WBOMITEM;
          GOTO      OEMT9999
.
OEMT7200  WRITE     HTMLFILE;WBOMQUAN;
          GOTO      OEMT9999
.
OEMT7300  MATCH     SP70,WBOMPDTE
          GOTO      OEMT9999 IF EQUAL
          UNPACK    WBOMPDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OEMT9999
.
OEMT7400  MATCH     SP70,WBOMCDTE
          GOTO      OEMT9999 IF EQUAL
          UNPACK    WBOMCDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OEMT9999
.
OEMT7500  WRITE     HTMLFILE;WBOMCTIM;
          GOTO      OEMT9999
.
OEMT7600  WRITE     HTMLFILE;WBOMTRID;
          GOTO      OEMT9999
.
OEMT7700  WRITE     HTMLFILE;WBOMMSID;
          GOTO      OEMT9999
.
OEMT7800  WRITE     HTMLFILE;WBOMELEG;
          GOTO      OEMT9999
.
OEMT7900  MATCH     "1",WBOMACOI
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      OEMT9999
.
OEMT8000  MATCH     "1",WBOMDSOI
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      OEMT9999
.
OEMT8100  WRITE     HTMLFILE;WBOMFQNT;
          GOTO      OEMT9999
.
OEMT8200  WRITE     HTMLFILE;WBOMITMN;
          GOTO      OEMT9999
.
OEMT8300  WRITE     HTMLFILE;WBOMNOPT;
          GOTO      OEMT9999
.
OEMT8400  MATCH     "1",WBOMRSOI
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      OEMT9999
.
OEMT8500  MATCH     "1",WBOMTDOI
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      OEMT9999
.
OEMT8600  CALL      OMSTAB00
          GOTO      OEMT9999
.
OEMT9999  RETURN
+
.------------------------------------------------------------
. Table of WebServices OECW-ECM webomsaf
.------------------------------------------------------------
OMSTAB00  CALL      OMSTHD00
.
          PACK      KEY14,ADMISSNO,REPCOUNT,SP70
          CALL      RSWBOMS1
OMSTAB10  CALL      RKWBOMS1
          BRANCH    OVRCD,OMSTAB99
.
          MATCH     ADMISSNO,WBOMVISN
          GOTO      OMSTAB99 IF NOT EQUAL 
.
          MATCH     REPCOUNT,WBOMCNTR
          GOTO      OMSTAB99 IF NOT EQUAL
.
          CALL      OMSTRW00 
.
          GOTO      OMSTAB10          
.
OMSTAB99  RETURN
+
.------------------------------------------------------------
. Header WebServices OECW-ECM webomsaf
.------------------------------------------------------------
OMSTHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>":
                             "MBS Item Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Aftercare Override</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Duplicate Service Override</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Field Quantity</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Restriction Override</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Time Dependent Override</td>":
                             "</tr>"
.
OMSTHD99  RETURN
+
.------------------------------------------------------------
. Row WebServices OECW-ECM webomsaf
.------------------------------------------------------------
OMSTRW00  WRITE     HTMLFILE;"<tr><td>",WBOMITMN,"</td>";
.
          MOVE      "No ",DIM3
          MATCH     "1",WBOMACOI
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM3,"</td>";
.
          MOVE      "No ",DIM3
          MATCH     "1",WBOMDSOI
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM3,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBOMFQNT,"</td>";
.
          MOVE      "No ",DIM3
          MATCH     "1",WBOMRSOI
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM3,"</td>";
.
          MOVE      "No ",DIM3
          MATCH     "1",WBOMTDOI
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM3,"</td></tr>";
.
.
OMSTRW99  RETURN
+
.----------------------------------------------------------------------------
. Report No. 15 : WebServices OECW-ECM Response Tags
.----------------------------------------------------------------------------
OERT0000  BRANCH    FLDITMNO,OERT0100,OERT0200,OERT0300,OERT0400,OERT0500:
                             OERT0600,OERT0700,OERT0800,OERT0900,OERT1000:
                             OERT1100,OERT1200,OERT1300,OERT1400,OERT1500:
                             OERT1600
.
          GOTO      OERT9999
.
OERT0100  WRITE     HTMLFILE;WBOGSTAT;
          GOTO      OERT9999
.
OERT0200  WRITE     HTMLFILE;WBOGMECD;
          GOTO      OERT9999
.
OERT0300  WRITE     HTMLFILE;WBOGMETX;
          GOTO      OERT9999
.
OERT0400  WRITE     HTMLFILE;WBOGMEMN;
          GOTO      OERT9999
.
OERT0500  WRITE     HTMLFILE;WBOGMEMR;
          GOTO      OERT9999
.
OERT0600  WRITE     HTMLFILE;WBOGMEGN;
          GOTO      OERT9999
.
OERT0700  WRITE     HTMLFILE;WBOGFLID;
          GOTO      OERT9999
.
OERT0800  MATCH     SP70,WBOGLDDT
          GOTO      OEMT9999 IF EQUAL
          UNPACK    WBOGLDDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OERT9999
.
OERT0900  MATCH     SP70,WBOGCDTE
          GOTO      OERT9999 IF EQUAL
          UNPACK    WBOGCDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OERT9999
.
OERT1000  WRITE     HTMLFILE;WBOGCTIM;
          GOTO      OERT9999
.
OERT1100  WRITE     HTMLFILE;WBOGCUID;
          GOTO      OERT9999
.
OERT1200  MATCH     SP70,WBOGUDTE
          GOTO      OERT9999 IF EQUAL
          UNPACK    WBOGUDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OERT9999
.
OERT1300  WRITE     HTMLFILE;WBOGUTIM;
          GOTO      OERT9999
.
OERT1400  WRITE     HTMLFILE;WBOGUUID;
          GOTO      OERT9999
.
OERT1500  WRITE     HTMLFILE;WBOGMSID;
          GOTO      OERT9999
.
OERT1600  CALL      OMITAB00
           GOTO     OERT9999
.
OERT9999  RETURN
+
.----------------------------------------------------------------------------
. Report No. 16 : Casemix Code Verification            
.----------------------------------------------------------------------------
CVER0000  BRANCH    FLDITMNO,CVER0100
          GOTO      CVER9999
.
CVER0100  CALL      CASV0000     * Casemix Verification Audit List
          GOTO      CVER9999
.
CVER9999  RETURN
+
.----------------------------------------------------------------------------
. Casemix Code Verification Audit List
.----------------------------------------------------------------------------
CASV0000  MOVE      ZERO,CVERICNT
          PACK      KEY35,URNUMBER,ADMISSNO,ATYPE029,SP70
          CALL      RSPTATR3
CASV0100  CALL      RKPTATR3
          BRANCH    OVRCD,CASV9000
.
          MATCH     URNUMBER,PTARURNO
          GOTO      CASV9000 IF NOT EQUAL
.
          MATCH     ADMISSNO,PTARVISN
          GOTO      CASV9000 IF NOT EQUAL
.
          MATCH     ATYPE029,PTARTYPE          * Is attribute type="029"?
          GOTO      CASV9000 IF NOT EQUAL
.
          ADD       ONE,CVERICNT
.
.         Date & Time
.
          UNPACK    PTARDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM30,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
.         Audit Type  
.
          COMPARE   ONE,CVERICNT
          IF        @EQUAL
            MOVE      "Casemix Verification Added - ",DIM50
          ELSE
            MOVE      "Casemix Verification Updated - ",DIM50
          ENDIF
.
.         Casemix Verification
.
          MATCH     SP70,PTARVAL1
          IF        @EQUAL
            MOVE      SP70,DIM3
          ELSE
            MATCH     "1",PTARVAL1
            IF        @EQUAL
              MOVE      "Yes",DIM3
            ENDIF
            MATCH     "0",PTARVAL1
            IF        @EQUAL
              MOVE      "No ",DIM3
            ENDIF
          ENDIF
.
.         Reason for Change
.
          MOVE      SP70,PTCDLDES    
          MATCH     PTARCOD1,SP70
          GOTO      CASV7000 IF EQUAL
          PACK      KEY5,ANSR,ANSV,PTARCOD1,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CASV7000
.
.         User            
.
CASV7000  MOVE      SP70,PERFBY
          PACK      KEY10,PTARCUSR,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      SP70,WBSENAM
          ELSE
            MOVE      WBSENAM,PERFBY
          ENDIF
.
CASV8000  WRITE     HTMLFILE;"<tr>":
                    "<td>",DIM30," at ",PTARTIME,"</td>":
                    "<td>",DIM50,PTARTXT1,"</td>":
                    "<td>",PTCDLDES,"</td>":
                    "<td>",PERFBY,"</td>":
                    "<td>",DIM3,"</td>":
                    "</tr>"
          GOTO      CASV0100
.
CASV9000  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records to display</td>"
.
CASV9999  RETURN
+
.------------------------------------------------------------
. Table of WebServices OECW-ECM webomiaf
.------------------------------------------------------------
OMITAB00  CALL      OMITHD00
.
          MOVE      ADMISSNO,KEY20
          LJUSTIFY  KEY20
          PACK      KEY20,KEY20,SP70
.
          PACK      KEY29,KEY20,REPCOUNT,SP1,ONE,SP70
          CALL      RSWBOMI1
OMITAB10  CALL      RKWBOMI1
          BRANCH    OVRCD,OMITAB99
.
          MATCH     KEY20,WBOIARID
          GOTO      OMITAB99 IF NOT EQUAL
.
          MATCH     REPCOUNT,WBOIRPTC
          GOTO      OMITAB99 IF NOT EQUAL
.
          MATCH     " 1",WBOIMECT
          GOTO      OMITAB99 IF NOT EQUAL
.
          CALL      OMITRW00
.
          GOTO      OMITAB10
.
OMITAB99  RETURN
+
.------------------------------------------------------------
. Header WebServices OECW-ECM webomiaf
.------------------------------------------------------------
OMITHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>":
                             "Service Id</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Benefit</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Charge Amount</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Date Of Service</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Explanation Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Item Number</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Schedule Fee</td>":
                             "</tr>"
.
OMITHD99  RETURN
+
.------------------------------------------------------------
. Row WebServices OECW-ECM webomsaf
.------------------------------------------------------------
OMITRW00  WRITE     HTMLFILE;"<tr><td>",WBOISVID,"</td>";
.
          MOVE      SP70,DIM10
          MATCH     SP70,WBOISVBE
          IF        !@EQUAL
            MOVE      ".",DIM1
            RJUSTIFY  WBOISVBE
            UNPACK    WBOISVBE,DIM7,DIM2
            PACK      DIM10,DIM7,DIM1,DIM2,SP70
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM10,"</td>";
.
          MOVE      SP70,DIM10
          MATCH     SP70,WBOISVCH
          IF        !@EQUAL
            MOVE      ".",DIM1
            RJUSTIFY  WBOISVCH
            UNPACK    WBOISVCH,DIM7,DIM2
            PACK      DIM10,DIM7,DIM1,DIM2,SP70
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM10,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBOISVDS
          IF        !@EQUAL
            UNPACK    WBOISVDS,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM11,"</td>"; 
.
          WRITE     HTMLFILE;"<td>",WBOISVEC,"</td>";
.
          MOVE      SP70,HCEMDESC
.
          MATCH     SP70,WBOISVEC
          IF        !@EQUAL
            PACK      KEY3,WBOISVEC,SP70
            CALL      RDHCEMS1
            IF        OVRCD=ONE
              MOVE      "No Description in hicemsaf",HCEMDESC
              PACK      HCEMDESC,HCEMDESC,SP70
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<td>",HCEMDESC,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBOISVIT,"</td>";
.
          MOVE      SP70,DIM10
          MATCH     SP70,WBOISVSC
          IF        !@EQUAL
            MOVE      ".",DIM1
            RJUSTIFY  WBOISVSC
            UNPACK    WBOISVSC,DIM7,DIM2
            PACK      DIM10,DIM7,DIM1,DIM2,SP70
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM10,"</td>";
.
OMITRW99  RETURN
+
.------------------------------------------------------------
.   UR Only / Master OECW Request Table
.------------------------------------------------------------
UORT0000  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      ZERO,URVIFLAG
          MOVE      KEY1,URVIFLAG
.
UORT5000  MATCH     "1",PTCNWSIN
          GOTO      UORT9999 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      UORT9999 IF NOT EQUAL
.
          COMPARE   ONE,OECWINDC
          GOTO      UORT9999 IF NOT EQUAL
.
          PACK      KEY16,URNUMBER,SP70
          CALL      RSWBELF2
UORT6000  CALL      RKWBELF2
          BRANCH    OVRCD,UORT9999
.
          MATCH     URNUMBER,WBEFURNO
          GOTO      UORT9999 IF NOT EQUAL
.
          IF        URVIFLAG<>ONE
            MATCH     SP70,WBEFVISN
            GOTO      UORT6000 IF NOT EQUAL
.
            PACK      KEY11,WBEFELGN,SP1,SP1,ONE,SP70
.
          ELSE
            MATCH     SP70,WBEFVISN
            IF        @EQUAL
              PACK      KEY11,WBEFELGN,SP1,SP1,ONE,SP70
            ELSE
              PACK      KEY11,WBEFVISN,WBEFCNTR,SP70
            ENDIF
          ENDIF
.
          CALL      RDWBOEC1
          BRANCH    OVRCD,UORT6000
.         IF        OVRCD=0
.           MOVE      WBOCVISN,DIM20
.           LJUSTIFY  DIM20
.           PACK      DIM20,DIM20,SP70
.           PACK      KEY23,DIM20,WBOCCNTR,SP70
.           CALL      RDWBEEH1
.           IF        OVRCD=1
.             GOTO      UORT6000
.           ENDIF
.         ELSE
.           GOTO      UORT6000
.         ENDIF
.
          MOVE      WBOCVISN,DIM20
          LJUSTIFY  DIM20
          PACK      DIM20,DIM20,SP70
          PACK      KEY23,DIM20,WBOCCNTR,SP70
          CALL      RDWBEEH1
          IF        OVRCD=1
            CALL      CLWEBEEH
          ENDIF
.
          CALL      UORW0000
.
          GOTO      UORT6000
.
.
UORT9999  RETURN
+
.------------------------------------------------------------
.   UR Only / Master OECW Response Table Row
.------------------------------------------------------------
UORW0000  CLEAR     HTMLLINK
          APPEND    "javascript:disElg('",HTMLLINK
          APPEND    WBEFELGN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:disOEC('",HTMLLNK2
          APPEND    WBEFELGN,HTMLLNK2
          APPEND    "')",HTMLLNK2
          RESET     HTMLLNK2
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBEFEADT
          IF        !@EQUAL
            UNPACK    WBEFEADT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DIM40
          MATCH     SP70,WBEFPRIM
          IF        !@EQUAL
            PACK      DIM40,WBEFPRIM,SP70
            PACK      KEY9,WBEFPRIM,SP70
            PACK      KEY17,KEY9,SP70
            CALL      PATITMRD
            IF        OVRCD=0
              PACK      DIM40,IDESC,SP70
            ENDIF
          ELSE
            PACK      DIM40,WBEFPRIC,SP70
            MATCH     SP70,WBEFPRIC
            IF         !@EQUAL
              PACK      KEY5,CATil,WBEFPRIC,SP70
              CALL      RDCODE1
              IF        OVRCD=0
                PACK      DIM40,TDESC,SP70
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      "No ",DIM3
          MATCH     "1",WBEHBENL
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ENDIF
.
          MOVE      SP70,DIM10
          MATCH     ANSA,WBEHCFAC
          IF        @EQUAL
            MOVE      "ACCEPTED",DIM10
          ENDIF
          MATCH     ANSR,WBEHCFAC
          IF        @EQUAL
            MOVE      "REJECTED",DIM10
          ENDIF
          MATCH     ANSW,WBEHCFAC
          IF        @EQUAL
            MOVE      "WARNING",DIM10
          ENDIF
          MATCH     ANSC,WBEHCFAC
          IF        @EQUAL
            MOVE      "COMPLETED",DIM10
          ENDIF
          MATCH     ANSI,WBEHCFAC
          IF        @EQUAL
            MOVE      "INTERIM",DIM10
          ENDIF
          PACK      DIM10,DIM10,SP70
.
          MOVE      "No ",DIM3A
          MATCH     "Y",WBEHCPDI
          IF        @EQUAL
            MOVE      "Yes",DIM3A
          ENDIF
.
          MOVE      "No ",DIM3B
          MATCH     "Y",WBEHEADI
          IF        @EQUAL
            MOVE      "Yes",DIM3B
          ENDIF
.
          MOVE      "No ",DIM3C
          MATCH     "Y",WBEHEXDI
          IF        @EQUAL
            MOVE      "Yes",DIM3C
          ENDIF
.
          MOVE      "No ",DIM3D
          MATCH     "Y",WBEHTBDI
          IF        @EQUAL
            MOVE      "Yes",DIM3D
          ENDIF
.
          MOVE      SP70,KEY20
          MATCH     " 0",WBOCSTAT
          IF        @EQUAL
            MOVE      "WAITING",KEY20
          ENDIF
.
          MATCH     " 1",WBOCSTAT
          IF        @EQUAL
            MOVE      "EXTRACTED",KEY20
          ENDIF
.
          MATCH     " 2",WBOCSTAT
          IF        @EQUAL
            MOVE      "RECEIVED",KEY20
          ENDIF
.
          MATCH     " 3",WBOCSTAT
          IF        @EQUAL
            MOVE      "SA&nbsp;ERROR",KEY20
          ENDIF
.
          MATCH     " 4",WBOCSTAT
          IF        @EQUAL
            MOVE      "DATA&nbsp;ERROR",KEY20
          ENDIF
.
          MATCH     " 6",WBOCSTAT
          IF        @EQUAL
            MOVE      "COMP&nbsp;REPORTED",KEY20
          ENDIF
.
          MATCH     " 5",WBOCSTAT
          IF        @EQUAL
            MOVE      "REJ&nbsp;REPORTED",KEY20
          ENDIF
.
          MATCH     " 7",WBOCSTAT
          IF        @EQUAL
            MOVE      "HF&nbsp;UNAVAILABLE",KEY20
          ENDIF
.
          REP       " +",WBOCVISN
          REP       " +",WBOCCNTR
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          CLEAR     HTMLLNK3
          APPEND    "displayOEC('",HTMLLNK3
          APPEND    WBOCVISN,HTMLLNK3
          APPEND    WBOCCNTR,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    URNUMBER,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    ADMISSNO,HTMLLNK3
          APPEND    "');",HTMLLNK3
          RESET     HTMLLNK3
.
          REP       "+ ",WBOCVISN
          REP       "+ ",WBOCCNTR
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                    "#"",HTMLLNK2,"#",":
                                    "#"",WBOCCDTE,WBOCCTIM,"#",":
                                    "#"",WBOCTRID,"#",":
                                    "#"",DIM11,"&nbsp;&nbsp;&nbsp;",DIM40,"#",":
                                    "#"",DIM3,"#",":
                                    "#"",DIM10,"#",":
                                    "#"",DIM3A,"#",":
                                    "#"",DIM3B,"#",":
                                    "#"",DIM3C,"#",":
                                    "#"";
.
          WRITE     HTMLFILE;"<img src=../images/DocumentIcon.gif ":
                             "class=ListIcon onclick=",HTMLLNK3,">";
.
          WRITE     HTMLFILE;WBEHPSCD,"#",":
                                    "#"",DIM3D,"#",":
                                    "#"",WBOCVISN,"#",":
                                    "#"",KEY20,"#",":
                                    "#"",WBEHCDTE,WBEHCTIM,"#",":
                                    "#"",DIM40,"#",":
                               "#"",WBOCERRC,"&nbsp;&nbsp;&nbsp;",WBOCERRD,"#")"
.
UORW9999  RETURN
+
.------------------------------------------------------------
          INC       IBAWEBCD    
          INC       FEESESTM
          INC       GETTFEES
          INC       GETCNEFF
          INC       CLPATELG
          INC       PATNAMCD
.
          INC       OPRDEAIO/INC
          INC       OPRMBSIO/INC
          INC       APSMASIO/INC
          INC       EMRVISIO/INC
          INC       EMRVCDIO/INC
          INC       EMRICDIO/INC
          INC       IBAGSTIO/INC
          INC       IBALPCIO/INC
          INC       HICEMSIO/INC
          INC       PATALRIO/INC
          INC       PATATRIO/INC            * Patient Attributes
          INC       PATMCHIO/INC      * Misc.charge 
          INC       PATECMIO/INC            * Patient epsiode morbidity change
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       VISMDTIO/INC
          INC       VISMTXIO/INC
          INC       PATCHCIO/INC
          INC       PATCMOIO/INC            * Patient morbidity changes file
          INC       PATCMCIO/INC
          INC       PATCMXIO/INC
          INC       PATCRCIO/INC
          INC       PMSCIDIO/INC
          INC       PATDADIO/INC
          INC       PATDO1IO/INC
          INC       PATDGWIO/INC
          INC       PATDSCIO/INC
          INC       PATMA1IO/INC    
          INC       PATICDIO/INC    
          INC       PATICOIO/INC
          INC       PATMI1IO/INC    
          INC       PATQMHIO/INC
          INC       PATPR1IO/INC
          INC       PATASFIO/INC
          INC       PATFN1IO/INC
          INC       PATWR1IO/INC
.         INC       PATMCHIO/INC
          INC       PATITMIO/INC
          INC       PATPEIIO/INC
          INC       PATTRNIO/INC
          INC       PATVISIO/INC
          INC       PATVADIO/INC
          INC       PATQRDIO/INC
          INC       PATRDEIO/INC
          INC       PATRE1IO/INC
          INC       PMSADWIO/INC
          INC       PMSELFIO/INC
          INC       PMSEEDIO/INC
          INC       PMSEEHIO/INC
          INC       PMSERCIO/INC
          INC       PMSEXTIO/INC
          INC       PMSFOCIO/INC
          INC       PMSOECIO/INC
          INC       PMSOESIO/INC
          INC       PMSSESIO/INC
          INC       PMSSEDIO/INC
          INC       PMSPX2IO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCGIO/INC
          INC       PMSVSCIO/INC
          INC       PMSVX1IO/INC
          INC       PMSAELIO/INC
          INC       PMSCAUIO/INC
          INC       PMSCCDIO/INC
          INC       PMSFEDIO/INC
          INC       PMSFESIO/INC
          INC       PMSFIDIO/INC
          INC       PMSSNPIO/INC
          INC       PMSFETIO/INC
          INC       PATIN1IO/INC
          INC       PATICUIO/INC
          INC       PATVENIO/INC
          INC       PATELGIO/INC
          INC       PMSELIIO/INC
          INC       OUTSITIO/INC
          INC       MRTMASIO/INC
          INC       PATHSPIO/INC
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       BOKRC1IO/INC
          INC       BOKRX1IO/INC
.
          INC       PATIFCIO/INC
          INC       PATLSDIO/INC
          INC       PATASDIO/INC
          INC       PATHLFIO/INC
          INC       PATLDFIO/INC
          INC       PATHDFIO/INC
          INC       PATAFEIO/INC
          INC       PATBFEIO/INC
          INC       PATTFEIO/INC
          INC       PATCTFIO/INC
          INC       PMSMTIIO/INC
          INC       PMSEDWIO/INC
          INC       PMSFENIO/INC
          INC       PATSGCIO/INC
          INC       PATFX1IO/INC
          INC       PATCFAIO/INC
          INC       IBAGEDIO/INC
          INC       EMRLOCIO/INC
          INC       PMSEHBIO/INC
          INC       PMSIMPIO/INC
          INC       PATDDHIO/INC
.
          INC       PMSSNCIO/INC
.
          INC       WEBOECIO/INC
          INC       WEBOESIO/INC
          INC       WEBELFIO/INC
          INC       WEBEEHIO/INC
          INC       WEBEEDIO/INC
          INC       WEBERCIO/INC
          INC       WEBSESIO/INC
          INC       WEBSEDIO/INC
.
          INC       WEBOEMIO/INC
          INC       WEBOMSIO/INC
          INC       WEBOMFIO/INC
          INC       WEBOMGIO/INC
          INC       WEBOMHIO/INC
          INC       WEBOMIIO/INC
.
          INC       TFILENAM
          INC       CALCAGE   
          INC       CLPATATR               * Clear Patient Attributes
          INC       CLPATDSC   
          INC       CLNHIMAS
          INC       CLPMSEXT
          INC       CLPMSOEC
          INC       CLPMSELF
          INC       CLPMSOES
          INC       CLPMSPX2
          INC       CLWEBOEC
          INC       CLWEBOES
          INC       CLWEBELF
          INC       CLWEBEEH
          INC       CLWEBEED
          INC       CLWEBERC
          INC       CLWEBSES
          INC       CLWEBSED
.
          INC       NAMSTRCD    
          INC       WEBDATCD    
          INC       DAYOFWEK    
          INC       IBALPCCD
          INC       PATATRTM               * Patient Attributes
          INC       PATDOCTM
          INC       PATDOCCD
          INC       PMSHCPTM
          INC       PMSHCGTM
          INC       PATMASTM
          INC       PATMSXTM
          INC       PATMISTM
          INC       PMSVX1TM 
          INC       PATQMHTM
          INC       PATDSCTM
          INC       PATMCHRD                * Miscellaneous Charges read routine
          INC       PATDDHRD
          INC       PMSFEDTM
          INC       PMSFESTM
          INC       PMSFOCTM
          INC       PMSOECTM
          INC       PMSOESTM
          INC       PMSPX2TM
          INC       PMSSNPTM
          INC       CLEMRVIS
          INC       CLPATMIS
          INC       CLPMSVX1
          INC       CLPMSEEH
          INC       CLPATHSP
          INC       VALCONTR
          INC       VALCMXFN
.
          INC       WEBOECTM
          INC       WEBOESTM
.
          INC       WEBOEMTM
          INC       WEBOMSTM
          INC       PMSELITM
.
          INC       CLPMSELI
          INC       CLWEBOEM
          INC       CLWEBOMS
          INC       CLWEBOMF
          INC       CLWEBOMG
          INC       CLWEBOMH
          INC       CLWEBOMI

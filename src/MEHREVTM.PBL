.----------------------------------------------------------------------
. Program       : MEHREVTM
.
. Function      : Output Mental Health Review History Variables           
.
. Modifications :
.                 V9.02.00  J.TAN   Created
.----------------------------------------------------------------------
.
.------------------------------------------------------------
. Visit Details 
.------------------------------------------------------------
MHRV0000  BRANCH    FLDITMNO,MHRV0100,MHRV0200,MHRV0300,MHRV0400,MHRV0500:
                             MHRV0600,MHRV0700,MHRV0800,MHRV0900
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MHRV9999
.
MHRV0100  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          WRITE     HTMLFILE;LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO;
          GOTO      MHRV9999
.
MHRV0200  WRITE     HTMLFILE;MHRVADMN;
          GOTO      MHRV9999
.
MHRV0300  MATCH     MHRVDATE,SP70
          GOTO      MHRV9999 IF EQUAL
          UNPACK    MHRVDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MHRV9999
.
MHRV0400  WRITE     HTMLFILE;MHRVTIME;
          GOTO      MHRV9999
.
MHRV0500  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Religious visit
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MHRV0510,MHRV0520
          WRITE     HTMLFILE;MHRVDECI;
          GOTO      MHRV9999
.
MHRV0510  IF        MHRVDECI=1
            WRITE     HTMLFILE;"Yes";
          ELSE
            IF        MHRVDECI=0
              WRITE     HTMLFILE;"No";
            ELSE
              WRITE     HTMLFILE;"  ";
            ENDIF
          ENDIF
          GOTO      MHRV9999
.
MHRV0520  IF        MHRVDECI=1
            WRITE    HTMLFILE;"<option value=",ANSY," selected>":
                              "Yes</option>":
                              "<option value=",ANSN,">":
                              "No</option>";
          ELSE
            IF       MHRVDECI=0
              WRITE    HTMLFILE;"<option value=",ANSN," selected>":
                                "No</option>":
                                "<option value=",ANSY,">":
                                "Yes</option>";
            ELSE
              WRITE    HTMLFILE;"<option value=",ANSN,">":
                                "No</option>":
                                "<option value=",ANSY,">":
                                "Yes</option>";
            ENDIF
          ENDIF
          GOTO      MHRV9999
.
MHRV0600  MATCH     MHRVLDAT,SP70
          GOTO      MHRV9999 IF EQUAL
          UNPACK    MHRVLDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MHRV9999
.
MHRV0700  WRITE     HTMLFILE;MHRVLTIM;
          GOTO      MHRV9999
.
MHRV0800  MOVE      "DE",CATEGORY
          PACK      CODE,MHRVREAS,SP70
          CALL      CODITM00
          GOTO      MHRV9999
.
MHRV0900  MATCH     MHRVNDAT,SP70
          GOTO      MHRV9999 IF EQUAL
          UNPACK    MHRVNDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MHRV9999
.
MHRV9999  RETURN
+
.------------------------------------------------------------
. Clear cgi variables
.------------------------------------------------------------
CLRREV00  MOVE      Z70,MEHRV001
          MOVE      Z70,MEHRV002
          MOVE      Z70,MEHRV003
          MOVE      Z70,MEHRV004
          MOVE      Z70,MEHRV005
          MOVE      Z70,MEHRV006
          MOVE      Z70,MEHRV007
          MOVE      Z70,MEHRV008
CLRREV99  RETURN
+
.------------------------------------------------------------------------
.   Set Parameters for mental health  Legal status Review history  table
.------------------------------------------------------------------------
SETMHR00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          BRANCH    F3,SETMHR01,SETMHR02,SETMHR03,SETMHR04,SETMHR05:
                       SETMHR06,SETMHR07,SETMHR08
.
          MOVE      ONE,EXIT
          GOTO      SETMHR99
.
SETMHR01  MOVE      QRYDATA,MEHRV001
          GOTO      SETMHF99
.
SETMHR02  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MEHRV002,CCENT,CYEAR,CMON,CDAY
          GOTO      SETMHR99
.
SETMHR03  MOVE      QRYDATA,MEHRV003
          GOTO      SETMHF99
.
SETMHR04  MOVE      QRYDATA,MEHRV004
          GOTO      SETMHF99
.
SETMHR05  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MEHRV005,CCENT,CYEAR,CMON,CDAY
          GOTO      SETMHR99
.
SETMHR06  MOVE      QRYDATA,MEHRV006
          GOTO      SETMHF99
.
SETMHR07  MOVE      QRYDATA,MEHRV007
          GOTO      SETMHF99
.
SETMHR08  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MEHRV008,CCENT,CYEAR,CMON,CDAY
          GOTO      SETMHF99
.
SETMHR99  RETURN
+
.------------------------------------------------------------
.   Move cgi's into file variables               
.------------------------------------------------------------
.
MVMHR000  MATCH     Z70,MEHRV001
          IF        !@EQUAL
            MOVE      MEHRV001,MHRVADMN
          ENDIF
.
          MATCH     Z70,MEHRV002
          IF        !@EQUAL
            MOVE      MEHRV002,MHRVDATE
          ENDIF
.
          MATCH     Z70,MEHRV003
          IF        !@EQUAL
            MOVE      MEHRV003,MHRVTIME
          ENDIF
.
          COMPARE   ZERO,MEHRV004
          IF        !@EQUAL
            MOVE      MEHRV004,MHRVDECI
          ENDIF
.
          MATCH     Z70,MEHRV005
          IF        !@EQUAL
            MOVE      MEHRV005,MHRVLDAT
          ENDIF
.
          MATCH     Z70,MEHRV006
          IF        !@EQUAL
            MOVE      MEHRV006,MHRVLTIM
          ENDIF
.
          MATCH     Z70,MEHRV007
          IF        !@EQUAL
            MOVE      MEHRV007,MHRVREAS
          ENDIF
.
          MATCH     Z70,MEHRV008
          IF        !@EQUAL
            MOVE      MEHRV008,MHRVNDAT
          ENDIF
.
MVMHR999  RETURN
.

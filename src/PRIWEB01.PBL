.-------------------------------------------------------------------------------
. Program       : PRIWEB01 
.
. Function      : Medical Practice Maintenance
.
. Modifications : 
.-------------------------------------------------------------------------------
. V11.04.02 18/10/2024  Thanh T       TSK 0952969
.           Changed CHRF0000 to use index 4 of prihreff intsead of index 3 for
.           faster performance. Added STRTPR00 section for Start button.
.           Added PDCTS000 for Table of Medical Practice Doctor search.
. V11.04.01 25/06/2024  Thanh T       TSK 0947684
.           Added PMSHCGTD
.-------------------------------------------------------------------------------
.      V11.03.02  08/11/2023  J.Tan         TSK 0927514
.                 Mod for Service Doctor lookup on Invoice Pending list
.      V11.03.01  19/09/2023  Nikitha N     TSK 0937687
.                 Added FILTACTV filter for Doctors in a Medical Practice
.      V11.02.01  30/08/2022  Bella Turco   TSK 0921957
.                 Added NOMORE00 - Display "No more records" at end of list
.                 Added PTCNNRTD - Displays number of rows set by parameter 
.                 value
.      V10.14.02  30/08/2019  Ebon Clements    TSK 0879288
.                 Inactivate all pridoctf records when inactivating a doctor
.                 if claim code has been deleted -  DOCS8000
.      V10.14.01  08/02/2019  Thanht T.        TSK 0856558
.                 Changed DISACC00 and DGLRW000 to cater for the functionality
.                 of searching a particular item, group code or journal code
.-------------------------------------------------------------------------------
.      V10.13.01  31/07/2018  J.Tan            TSK 0848506
.                 Changed PP Doctor from DIM6 to DIM10
.      V10.12.01  18.07.2018  Ebon Clements  TSK 0856516
.                 Fixed GL interface next and prev by adding 
.                 NOTSHOWN flag as records are filterd in DGLRW000
.      V10.06.01  01.04.2016  Peter Vela   CAR 298921
.                 Replace single quotes in PDCRW000
.      V10.04.01  31.03.2014  B.G.Ackland  CAR 299363
.                 Replace META Tag Redirect with Javascript in Common RDIREC00
.                 Routine
.-------------------------------------------------------------------------------
.      V10.03.04  13/06/2012  Ebon Clements   CAR 246555
.                 Added register to practice maintenance
.      V10.03.03  12/06/2012  J.Tan           CAR 266557
.                 Fixed Debtor Account for Free Format G/L Interface
.      V10.03.02  28/05/2012  J.Tan           CAR 229506
.                 Mods Delete/Inactive MP to check for Ref.with holding item 
.      V10.03.01  29/03/2012  J.Tan           CAR 262743
.                 Mods for Free Format G/L Interface
.      V10.00.01  12/04/2010  J.Tan           CAR 216863
.                 Mods to display 'Fees Invoiced Reset date' from pripracf file
.      V9.12.01   20/10/2009  Ebon Clements   CAR 185899
.                 Added keyword debtor search - DEBAK000
.      V9.11.01   06/11/2008  Peter McMullen  CAR 174725
.                 convert internal javascript to W3C standards
.      V9.08.01   15/05/2007  J.Tan         CAR 140282
.                 Added PTCNUFMS=2 for Using Other FMS
.      V9.05.01   09/03/2006  Ebon Clements CAR 78533
.                 Mods for PATCODTM - Hospital specific category codes
.      V9.05.B01  30/01/2006  Ebon Clements CAR 93186
.                 Mods for REDIRECT length change. Recompiled for IBAWEBDF
.      V9.04.05   29/03/2005 Ebon Clements  CAR 56706
.                 Move SP70 to PRDOSPAR not ZERO
.      V9.04.04   23/03/2005 Ebon Clements  CAR 56706
.                 Removed batch range maintenance from pripracf. Added MCI and
.                 payee to pripracf. Added servive provider number to pridoctf
.      V9.04.03   31/01/2005 Ebon Clements  CAR 56705
.                 Added list all batch ranges
.      V9.04.02   25/11/2004 Ebon Clements  CAR 55406 & 55524
.                 Added medical practice batch range maintenance - report 8
.      V9.04.01   01/12/2004 Ebon Clements  CAR 55524
.                 Removed multiple opens of FMSCSA1
.      V9.03.14   23/06/2004 Lina Vo        CAR 49814
.                 Added private practice general ledger interface maintenance.  
.      V9.03.13   18/05/2004 Sylvek Litewka CAR 49511
.                 Modified procedure DISCOM00 to add 'min' and 'max' attributes
.                 when outputing a numeric HTML field '% of Schedule Fee'.
.                 These attributes are used in javascript validation.
.      V9.03.12   26/04/2004 Sylvek Litewka CAR 49241
.                 Fixed read of Medical Practice file in procedure PDCRW000.
.                 27/04/2004 Lina Vo                  
.                 Fixed display of Doctor name in Medical Practice.
.      V9.03.11   21/04/2004 Ebon Clements  CAR 49165
.                 Removed SQUEEZE from PRIPR002 cgi fo fix description save
.                 Added PRITD000 table of medical practices by description  
.      V9.03.10   20/04/2004 Lina Vo    CAR 49090
.                 Mods to only display first name only for Acc Rec.       
.      V9.03.09   26/03/2004 Peter Vela CAR 13038
.                 Recompiled for PATDOCCD - Doctor Name format Parameter
.      V9.03.08   02/03/2004  Lina Vo  CAR 47921  
.                 Removed use of PRIDBTFD & IO.               
.                 Removed PP Debtor Search.                   
.      V9.03.07   12/02/2004  J.Tan    CAR 44109  
.                 Mods for doctors in medical practice search
.      V9.03.06   20/01/2004  Pat Dirito         CAR 44871
.                 Added Option 5 & 6 - Private Practice Security Access 
.      V9.03.05   14/01/2004  Pat Dirito         CAR 44073
.                 Fixed option 3 - Private Practice G/L Interface 
.      V9.03.04   24/12/2003  Lina Vo            CAR 44073
.                 Added option 4 - Debtors Search
.      V9.03.03   28/11/2003  J.Tan              CAR 44120
.                 Fixed Medical Practice List
.      V9.03.02   06/11/2003  Lina Vo            CAR 36497
.                 Moved Account Search to FMSWEB05.
.      V9.03.01   22/10/2003  Pat Diirto         CAR 43983
.                 Added option 3 to ACTAB000 
.-------------------------------------------------------------------------------
.                 V9.02.04 04/02/03 J.Tan
.                          Fixed exit flag after displaying warning
.                 V9.02.03 27/01/2002  J.Tan
.                          Added warning percentage can not be greater than 100
.                 V9.02.02 10/01/2002  J.Tan
.                          Added income percentage maintenance
.                 V9.02.01 02/10/2001  J.Tan
.                          Mods to use PMSHCPFD instead of PATDO1FD
.                 V5.08.01 03/07/2000  Jill Habasque
.                          Recompiled for PRIAUDDO
.                 V5.07.02 23.03.2000 Bronko Sosic
.                          Added Startkey for GOTO button
.                 V5.07.01 16.03.2000 Pat Dirito
.                          Added instances of ShowDetail                        
.                 V5.07.00 28.09.1999 Pat Dirito
.                          Created Program                                      
.                    
.-------------------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
.
          INC       APSMASFD/INC
          INC       DEBDBTFD/INC    * Debtors File
          INC       DEBDKIFD/INC
          INC       IBABASFD/INC    
          
          INC       PATDO1FD/INC
          INC       PATIN1FD/INC
          INC       PATMA1FD/INC
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
          INC       PATCONFD/INC    
          INC       PRIFMSFD/INC    * Fin. Man. Interface for Private Practice
          INC       PRIHREFD/INC    * referral details
          INC       PRIHDBFD/INC    * holding header file
          INC       PRIPRAFD/INC    * Medical Practice - Private Practice   
          INC       PRIHTRFD/INC    * Medical Practice - Holding table
          INC       PRIPCEFD/INC    * G/L Interface 
          INC       PRIDOCFD/INC    * Doctors File - Private Practice  
          INC       PRICONFD/INC    * Control File
...          INC       PRIDBTFD/INC    * Debtors File
          INC       PMSHCPFD/INC    * Doctors File
          INC       PRIITMFD/INC    * Item file
          INC       PRIALSFD/INC    * Medical Practice All User Access
          INC       PRISECFD/INC    * Medical Practice Security User Access
          INC       RCPREGFD/INC
.
          INC       FMSDISFD/INC
          INC       FMSRESFD/INC
          INC       FMSLMAFD/INC
          INC       FMSAMAFD/INC
          INC       FMSCSAFD/INC
          INC       FMSCHQFD/INC
          INC       FMSCAFFD/INC
          INC       HICBCNFD/INC
.
.---------------------------------------------------------------------------
.  CGI Variables
.
NEXTPAGE  DIM       1       * Nextpage parameter CGI parameter
UPDTTYPE  DIM       1       * Update Type
STARTKEY  DIM       17      * Starting Key
PRDOCKEY  DIM       12[999] * Loadde with CL Code, GI Code & Schedule Fee       
.
MEDIPRAC  DIM       6       * Medical Practice Code
.
HICBC001  DIM       8       * Medical Practice Code
HICBC002  DIM       10      * Payee Provider Number
HICBC003  DIM       10      * Service Provider Number
HICBC004  DIM       5       * Batch Number (1 Alpha 4 Numeric)
HICBC005  DIM       3       * Batch Counter
HICBC006  DIM       1       * Batch Number Status
.
PRUSERID  DIM       10      * User ID 
PRIMPRAC  DIM       6       * Medical Practice
.
PRIPR001  DIM       6       * Medical Practice Code
PRIPR002  DIM       30      * M.P. Description
PRIPR003  DIM       10      * M.P. Primary Doctor
PRIPR004  DIM       25      * M.P. Adress Line 1     
PRIPR005  DIM       25      * M.P. Adress Line 2     
PRIPR006  DIM       25      * M.P. Adress Line 3     
PRIPR007  DIM       4       * M.P. Postcode           
PRIPR008  DIM       12      * M.P. Telephone          
PRIPR009  FORM      1       * M.P. Status 1=Inactive 0=Active            
PRIPR010  FORM      1       * M.P. Service Time on Invoice 0=No 1=Yes
PRIPR011  DIM       3       * Spare variable
PRIPR012  DIM       8       * MCI
PRIPR013  DIM       10      * Payee Provider Number
PRIPR014  DIM       3       * Register
.
SELMPRAC  DIM       6       * Selected Medical Practice
PRIDC001  DIM       6       * Medical Practice Code
PRIDC002  DIM       10      * Associated Doctor Code
PRIDC003  DIM       3       * Claim Code (Category CL)
PRIDC004  DIM       3       * Patient Indicator (Category GI)
PRIDC005  FORM      3.2     * Associated Doctor % Commission
PRIDC006  DIM       1       * Associated Doctor Status 1=Inactive 0=Active
PRIDC007  DIM       11      * ABN Number
PRIDC008  FORM      1       * GST Registered (0=No, 1=Yes)
PRIDC009  DIM       10      * Service Provider Number      
.
PRIPC001  DIM       1       * Financial type
PRIPC002  DIM       10      * Doctor Code
PRIPC003  DIM       2       * Item flag
PRIPC004  DIM       9       * MBS Item number
PRIPC005  DIM       3       * MBS Subitem number
PRIPC006  DIM       3       * Allocation type
PRIPC007  FORM      3.2     * Percentage 
PRIPC008  DIM       5       * Dissection
PRIPC009  DIM       4       * Responsibility
PRIPC010  DIM       2       * Ledger
PRIPC011  DIM      12       * Credit Account
PRIPC012  DIM      12       * Debit Account
.
.   Private Practice General ledger Interface
.
PRGLI001  FORM      1         * Report Sub Section
.                               1=Items
.                               3=Journals
PRGLI002  DIM       17        * Report Sub Section Code
............................... Fees Invoiced
PRGLI003  DIM       5         * Dissection
PRGLI004  DIM       4         * Responsibility
PRGLI005  DIM       2         * Ledger
PRGLI006  DIM       12        * Credit Account/Income Account
PRGLI007  DIM       12        * Debit Account/Debtors Control Account
PRGLI008  DIM       12        * GST Control Account
PRGLI009  DIM       3         * BAS Code
............................... Fees to be Invoiced
PRGLI010  DIM       5         * Dissection
PRGLI011  DIM       4         * Responsibility
PRGLI012  DIM       2         * Ledger
PRGLI013  DIM       12        * Credit Account
PRGLI014  DIM       12        * Debit Account
.
GROUPCOD  DIM       3         * Group Code (Cat FI)
ITEMNUMB  DIM       9         * Item Code
ISUBNUMB  DIM       3         * Item Sub Code
ITEMFLAG  FORM      2         * Item Flag
JOURNALC  DIM       2         * Journal Code (Cat J )
SUBSECTN  DIM       1         * Submenu options
NEWRECRD  DIM       1         * Add new record flag
SETCODD   DIM       30        * Set code description (Cat PG)
.
SRCHSNAM  DIM       20
SRCHGNAM  DIM       25
SRCHTYPE  DIM       1
.
LNK2PRT   FORM      1   * Table Type : Update Parent
.
. Variable Declarations  
.
SP14      INIT      "              "
CODEJ     INIT      "J "
CODEPG    INIT      "PG"
AMA       INIT      "AMA"
MBS       INIT      "MBS"
INVALIDS  INIT      "Invalid ("
INVALIDE  INIT      ")"
NBSP      INIT      "&nbsp;"
NINE8     INIT      "99999999"
PRIPCITM  INIT      "ITEMS"
PRIPCJOR  INIT      "JOURNAL"
OBRACKET  INIT      "("
CBRACKET  INIT      ")"
.
ACTIDESC  DIM       8   * Active or Inactive Description
ARRAYEND  FORM      3       * Last item in array
CATCL     INIT      "CL"    * Claim Code Category
CATGI     INIT      "GI"    * Patient Indicator Category
CLAMDESC  DIM       30      * Claim Code Description
CODECL    DIM       3       * Claim Code
CODEGI    DIM       3       * Patient Indicator Code
DOCTOR    DIM       40      * Formatted Doctor
SAVEDOCT  DIM       10      * Doctor Code
SAVKEY8   DIM       8
SAVKEY23  DIM       23
DOCTREC   DIM       8       * 
ENDNAME   DIM       70
FADDRESS  DIM       50
FREEFORM  DIM       1
.
NEXTFILE  FORM      8
NOTSHOWN  FORM      1       * Record not showm in list
STRTFILE  FORM      8
ENDBFILE  FORM      8
.
FORM3     FORM      3
FORM32    FORM      3.2
INDIDESC  DIM       30      * Patient Indicator
JAVFNAME  DIM       70
JAVGNAME  DIM       25
JAVSNAME  DIM       20
LEDDESC1  DIM       35
LEDDESC2  DIM       35
RCOUNT    FORM      3       * Counter for Claim Codes
SP127     DIM       127
SKEY5     DIM       5
SKEY50    DIM       50
SKEY28    DIM       28
SETFONT   DIM       23      * HTML font color
STARTFLG  FORM      1
STRTNAME  DIM       70
ENDFONT   DIM       11      * HTML end font
SCHDFEE   FORM      3.2     * % Schedule Fee Charged 
NEWFEE    FORM      3.2[999]
XPFEE     FORM      3.2
PRPCFLAG  DIM       2       * Item Flag
PRPCITMN  DIM       9       * Item Code
PRPCSUBN  DIM       3       * Sub Item
FILTACTV  DIM       1       * Active/Inactive status filter
.---------------------------------------------------------------------------
PRGID     INIT      "PRIWEB01"
VERSION   INIT      "V12.00.00"
PRGNAM    INIT      "Medical Practice Maintenance"
.---------------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      PRIPRA00        * Medical Practice Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
. 
MAIN1200  CALL      PRIDOC00        * Medical Practice Doctor Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      PRIPCE00        * Income percentage
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      SRHDEB00        * Debtors Search
          GOTO      MAIN1000
.
MAIN1500  CALL      PRIALS00        * Private Practice All Security Access
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      PRISEC00        * Private Practice User Security Access
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      PRIGLI00        * Private Practice G/L Interface Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      PRIBAT00        * Batch Numbers
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages 
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  CALL      WINPAR00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script language=#"JavaScript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);": 
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.
.*******************************************************************************
.                Close Window or Frame and Goto New Location
.*******************************************************************************
WINPAR00  CALL      OPENHTML
          BRANCH    EXIT,WINPAR99
          WRITE     HTMLFILE;"<script type=#"text/javascript#" ":
                             "src=#"../js/Standard.js#"></script>":
                             "<script type=#"text/javascript#" ":
                             "src=#"../js/Custom.js#"></script>":
                             "<script type=#"text/javascript#"> ":
                             " if (self.name==#"PopUpFrame#") {":
                             "  redirectParentFrame(#"",REDIRECT,"#"); }":
                             " else { ":
                             "  opener.location.href=#"",REDIRECT,"#";":
                             "  self.close(); }":
                             "</script>"
          CALL      CLOSHTML
WINPAR99  RETURN
.*******************************************************************************
.      Display Error and doe as per WINCLS00
.*******************************************************************************
ERRDSP00  CALL      OPENHTML
          BRANCH    EXIT,WINCLS99
          WRITE     HTMLFILE;"<script type=#"text/javascript#" ":
                             "src=#"../js/Standard.js#"></script>":
                             "<script type=#"text/javascript#" ":
                             "src=#"../js/Custom.js#"></script>":
                             "<script type=#"text/javascript#"> ":
                             " if (self.name.match(/PopUpFrame/)) {":
                             "    alert(#"",WEBTITLE,"#");":
                             "  reloadParentFrame();}":
                             " else { ":
                             "  opener.history.go(0);":
                             "  self.close(); }":
                             "</script>"
.
          CALL      CLOSHTML     * End of Document
.
ERRDSP99  RETURN
.-------------------------------------------------------------------------------
. Open Files and Initialize Variables
.-------------------------------------------------------------------------------
INIT0000  OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
.
          OPEN      IBABASA1,"ibabasaf"
          OPEN      PRIAUDPR,"priaudpr"
          OPEN      PRIFMSA1,"prifmsaf"
          OPEN      PRIPRAC1,"pripracf"
          OPEN      PRIPRAC2,"pripracf"
          OPEN      PRIDOCT1,"pridoctf"
          OPEN      PRIDOCT2,"pridoctf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PRIPCEA1,"pripceaf"
          OPEN      PRIITEM1,"priitemf"
          OPEN      PRIITEM2,"priitemf"
...          OPEN      PRIDEBT1,"pridebtf"
...          OPEN      PRIDEBT2,"pridebtf"
          OPEN      PRIALSA1,"prialsaf"
          OPEN      PRISECA1,"prisecaf"
          OPEN      PRISECA2,"prisecaf"
          OPEN      RCPREGA4,"rcpregaf"
.
          OPEN      PRIHREF1,"prihreff"
          OPEN      PRIHREF2,"prihreff"          * Holding Referral file
          OPEN      PRIHDBT1,"prihdbtf"          * Holding Header file
          OPEN      PRIHDBT2,"prihdbtf"
.
          OPEN      DEBDBTA1,"debdbtaf"
          OPEN      DEBDBTA2,"debdbtaf"
.
          OPEN      DEBDKIA1,"debdkiaf"
          OPEN      DEBDKIA2,"debdkiaf"
.
          OPEN      FMSAMAA1,"fmsamaaf"
          OPEN      FMSAMAA2,"fmsamaaf"
          OPEN      FMSAMAA3,"fmsamaaf"
          OPEN      FMSAMAA4,"fmsamaaf"
          OPEN      FMSDISA1,"fmsdisaf"
          OPEN      FMSRESA1,"fmsresaf"
          OPEN      FMSLMAA1,"fmslmaaf"
          OPEN      FMSCSAA1,"fmscsaaf"
          OPEN      FMSCHQA1,"fmschqaf"
          OPEN      FMSCAFA1,"fmscafaf"
.
          OPEN      HICBCNA1,"hicbcnaf"
.
          OPEN      CONTROLF,"controlf"      * Control File
          READ      CONTROLF,ZERO;*85,IBCNUGST,*107,IBCNUBAS
          READ      CONTROLF,THIRTY3;*53,PRCNAUDC,*55,PRCNAUDE
          READ      CONTROLF,THIRTY4;*166,PRCNGLIN,PRCNGLPA
          READ      CONTROLF,FIFTY9;*60,PTCNUFMS
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          BRANCH    PRCNAUDC,INIT9999
          OPEN      PRIAUDDO,"priauddo"
.
INIT9999  RETURN
.-------------------------------------------------------------------------------
. Clear Parameters
.-------------------------------------------------------------------------------
CLRPAR00  
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,NORECORD
          MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,ADMISSNO
          MOVE      SP70,URNUMBER 
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,STARTKEY
          MOVE      SP70,PRUSERID
          MOVE      SP70,PRIMPRAC
          MOVE      SP70,FREEFORM
.
          MOVE      SP70,MEDIPRAC 
.
          MOVE      Z70,HICBC001 
          MOVE      Z70,HICBC002 
          MOVE      Z70,HICBC003 
          MOVE      Z70,HICBC004 
          MOVE      Z70,HICBC005 
          MOVE      Z70,HICBC006 
.
          MOVE      Z70,PRIPR001 
          MOVE      Z70,PRIPR002 
          MOVE      Z70,PRIPR003 
          MOVE      Z70,PRIPR004 
          MOVE      Z70,PRIPR005 
          MOVE      Z70,PRIPR006 
          MOVE      Z70,PRIPR007 
          MOVE      Z70,PRIPR008 
          MOVE      ZERO,PRIPR009 
          MOVE      ZERO,PRIPR010 
          MOVE      Z70,PRIPR011 
          MOVE      Z70,PRIPR012 
          MOVE      Z70,PRIPR013 
          MOVE      Z70,PRIPR014 
.
          MOVE      Z70,PRIDC001  
          MOVE      Z70,PRIDC002  
          MOVE      Z70,PRIDC003  
          MOVE      Z70,PRIDC004 
          MOVE      ZERO,PRIDC005 
          MOVE      Z70,PRIDC006 
          MOVE      Z70,PRIDC007
          MOVE      ZERO,PRIDC008 
          MOVE      Z70,PRIDC009 
.
          MOVE      ONE,PRIPC001  
          MOVE      SP70,PRIPC002  
          MOVE      SP70,PRIPC003  
          MOVE      SP70,PRIPC004  
          MOVE      SP70,PRIPC005  
          MOVE      SP70,PRIPC006  
          MOVE      ZERO,PRIPC007  
          MOVE      SP70,PRIPC008  
          MOVE      SP70,PRIPC009  
          MOVE      SP70,PRIPC010  
          MOVE      SP70,PRIPC011  
          MOVE      SP70,PRIPC012  
.
          PACK      SP127,SP70,SP70
          MOVE      SP127,KEYWORDS
.
          MOVE      SP70,SRCHSNAM
          MOVE      SP70,SRCHGNAM
          MOVE      SP70,SRCHTYPE
.
          MOVE      ZERO,PRGLI001           * Report Section
          MOVE      SP70,PRGLI002           * Report Sub Section Code
.         ..................................  Fees Invoiced
          MOVE      SP70,PRGLI003           * Dissection
          MOVE      SP70,PRGLI004           * Responsibility
          MOVE      SP70,PRGLI005           * Ledger
          MOVE      SP70,PRGLI006           * Credit Account/Income Account
          MOVE      SP70,PRGLI007           * Debit Account/Debtors Control Acc
          MOVE      SP70,PRGLI008           * GST Control Account
          MOVE      SP70,PRGLI009           * BAS Code
.         ..................................  Fees to be Invoiced
          MOVE      SP70,PRGLI010           * Dissection
          MOVE      SP70,PRGLI011           * Responsibility
          MOVE      SP70,PRGLI012           * Ledger
          MOVE      SP70,PRGLI013           * Credit Account
          MOVE      SP70,PRGLI014           * Debit Account
.
          MOVE      SP70,GROUPCOD
          MOVE      ZERO,ITEMFLAG
          MOVE      SP70,ITEMNUMB
          MOVE      SP70,ISUBNUMB
          MOVE      SP70,JOURNALC
          MOVE      SP70,SUBSECTN
          MOVE      SP70,NEWRECRD
          MOVE      SP70,FILTACTV          * Filter for Doctors in Medical Prac
.
CLRPAR99  RETURN
.-------------------------------------------------------------------------------
. Set Parameters
.-------------------------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.   
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF  
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
. 
          MATCH     "keywords=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYWORDS
            REP       "~'",KEYWORDS
            GOTO      SETPAR99
          ENDIF
. 
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "primprac=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIMPRAC
            PACK      PRIMPRAC,PRIMPRAC,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pruserid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRUSERID
            PACK      PRUSERID,PRUSERID,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pripr",QRYNAME
          IF        @EQUAL
            CALL      STPRA000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "pridc",QRYNAME
          IF        @EQUAL
            CALL      STDOC000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "pripc",QRYNAME
          IF        @EQUAL
            CALL      STPCE000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "docrc",QRYNAME
          IF        @EQUAL
            UNPACK    QRYNAME,KEY5,KEY3
            MOVE      KEY3,F3
            PACK      PRDOCKEY[F3],QRYDATA,SP70
            MOVE      F3,ARRAYEND
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "percm",QRYNAME
          IF        @EQUAL
            UNPACK    QRYNAME,KEY5,KEY3
            MOVE      KEY3,F3
            UNPACK    PRDOCKEY[F3],KEY6
            PACK      PRDOCKEY[F3],KEY6,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchsnam=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHSNAM
....        PACK      SRCHSNAM,SRCHSNAM,SP70
            REP       "~'",SRCHSNAM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchgnam=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHGNAM
....        PACK      SRCHGNAM,SRCHGNAM,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prgli",QRYNAME
          IF        @EQUAL
            CALL      SGLIN000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "groupcod=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,GROUPCOD
            PACK      GROUPCOD,GROUPCOD,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "itemflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ITEMFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "itemnumb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ITEMNUMB
            PACK      ITEMNUMB,ITEMNUMB,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "isubnumb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ISUBNUMB
            PACK      ISUBNUMB,ISUBNUMB,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "journalc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,JOURNALC
            PACK      JOURNALC,JOURNALC,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "subsectn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SUBSECTN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "newrecrd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEWRECRD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hicbc",QRYNAME
          IF        @EQUAL
            CALL      STHBC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mediprac=",QRYNAME
          IF        @EQUAL
            PACK      MEDIPRAC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "freeform=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FREEFORM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtactv=",QRYNAME
          IF        @EQUAL
            PACK      FILTACTV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "selmprac=",QRYNAME
          IF        @EQUAL
            PACK      SELMPRAC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 1 - Medical Practice
.-------------------------------------------------------------------------------
STPRA000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STPRA001,STPRA002,STPRA003,STPRA004,STPRA005,STPRA006:
                       STPRA007,STPRA008,STPRA009,STPRA010,STPRA011,STPRA012:
                       STPRA013,STPRA014
.
          GOTO      STPRA999
.
STPRA001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PRIPR001
          PACK      PRIPR001,PRIPR001,SP70
          GOTO      STPRA999
.
STPRA002  MOVE      QRYDATA,PRIPR002
          GOTO      STPRA999
.
STPRA003  MOVE      QRYDATA,PRIPR003
          GOTO      STPRA999
.
STPRA004  MOVE      QRYDATA,PRIPR004
          GOTO      STPRA999
.
STPRA005  MOVE      QRYDATA,PRIPR005
          GOTO      STPRA999
.
STPRA006  MOVE      QRYDATA,PRIPR006
          GOTO      STPRA999
.
STPRA007  MOVE      QRYDATA,PRIPR007
          GOTO      STPRA999
.
STPRA008  MOVE      QRYDATA,PRIPR008
          GOTO      STPRA999
.
STPRA009  MOVE      QRYDATA,PRIPR009
          GOTO      STPRA999
.
STPRA010  MOVE      QRYDATA,PRIPR010
          GOTO      STPRA999
.
STPRA011  MOVE      QRYDATA,PRIPR011
          GOTO      STPRA999
.
STPRA012  MOVE      QRYDATA,PRIPR012
          GOTO      STPRA999
.
STPRA013  MOVE      QRYDATA,PRIPR013
          GOTO      STPRA999
.
STPRA014  MOVE      QRYDATA,PRIPR014
          GOTO      STPRA999
.
STPRA999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 2 - Medical Practice Doctors  
.-------------------------------------------------------------------------------
STDOC000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STDOC001,STDOC002,STDOC003,STDOC004,STDOC005:
                       STDOC006,STDOC007,STDOC008,STDOC009
.
          GOTO      STDOC999
.
STDOC001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PRIDC001
          PACK      PRIDC001,PRIDC001,SP70
          GOTO      STDOC999
.
STDOC002  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PRIDC002
          PACK      PRIDC002,PRIDC002,SP70
          GOTO      STDOC999
.
STDOC003  MOVE      QRYDATA,PRIDC003
          GOTO      STDOC999
.
STDOC004  MOVE      QRYDATA,PRIDC004
          GOTO      STDOC999
.
STDOC005  MOVE      QRYDATA,PRIDC005
          GOTO      STDOC999
.
STDOC006  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PRIDC006
          GOTO      STDOC999
.
STDOC007  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PRIDC007
          GOTO      STDOC999
.
STDOC008  MOVE      QRYDATA,PRIDC008
          GOTO      STDOC999
.
STDOC009  MOVE      QRYDATA,PRIDC009
          GOTO      STDOC999
.
STDOC999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 3 - PP General ledger interface
.-------------------------------------------------------------------------------
STPCE000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STPCE001,STPCE002,STPCE003,STPCE004,STPCE005,STPCE006:
                       STPCE007,STPCE008,STPCE009,STPCE010,STPCE011,STPCE012
.
          GOTO      STPCE999
.
STPCE001  MOVE      QRYDATA,PRIPC001
          PACK      PRIPC001,PRIPC001,SP70
          GOTO      STPCE999
.
STPCE002  MOVE      QRYDATA,PRIPC002
          PACK      PRIPC002,PRIPC002,SP70
          GOTO      STPCE999
.
STPCE003  MOVE      QRYDATA,PRIPC003
          PACK      PRIPC003,PRIPC003,SP70
          GOTO      STPCE999
.
STPCE004  MOVE      QRYDATA,PRIPC004
          PACK      PRIPC004,PRIPC004,SP70
          GOTO      STPCE999
.
STPCE005  MOVE      QRYDATA,PRIPC005
          PACK      PRIPC005,PRIPC005,SP70
          GOTO      STPCE999
.
STPCE006  MOVE      QRYDATA,PRIPC006
          PACK      PRIPC006,PRIPC006,SP70
          GOTO      STPCE999
.
STPCE007  MOVE      QRYDATA,PRIPC007
          GOTO      STPCE999
.
STPCE008  MOVE      QRYDATA,PRIPC008
..          PACK      PRIPC008,PRIPC008,SP70
          GOTO      STPCE999
.
STPCE009  MOVE      QRYDATA,PRIPC009
..          PACK      PRIPC009,PRIPC009,SP70
          GOTO      STPCE999
.
STPCE010  MOVE      QRYDATA,PRIPC010
..          PACK      PRIPC010,PRIPC010,SP70
          GOTO      STPCE999
.
STPCE011  MOVE      QRYDATA,PRIPC011
..          PACK      PRIPC011,PRIPC011,SP70
          GOTO      STPCE999
.
STPCE012  MOVE      QRYDATA,PRIPC012
..          PACK      PRIPC012,PRIPC012,SP70
          GOTO      STPCE999
.
STPCE999  RETURN
+
.------------------------------------------------------------
. Set Parameters for General Ledger Interface
.------------------------------------------------------------
.
SGLIN000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SGLIN010,SGLIN020,SGLIN030,SGLIN040,SGLIN050:
                       SGLIN060,SGLIN070,SGLIN080,SGLIN090,SGLIN100:
                       SGLIN110,SGLIN120,SGLIN130,SGLIN140
.
          GOTO      SGLIN999
.
SGLIN010  MOVE      QRYDATA,PRGLI001
          GOTO      SGLIN999
.
SGLIN020  PACK      PRGLI002,QRYDATA,SP70
          GOTO      SGLIN999
.
SGLIN030  MOVE      QRYDATA,PRGLI003
          GOTO      SGLIN999
.
SGLIN040  MOVE      QRYDATA,PRGLI004
          GOTO      SGLIN999
.
SGLIN050  MOVE      QRYDATA,PRGLI005
          GOTO      SGLIN999
.
SGLIN060  MOVE      QRYDATA,PRGLI006
          GOTO      SGLIN999
.
SGLIN070  MOVE      QRYDATA,PRGLI007
          GOTO      SGLIN999
.
SGLIN080  MOVE      QRYDATA,PRGLI008
          GOTO      SGLIN999
.
SGLIN090  MOVE      QRYDATA,PRGLI009
          GOTO      SGLIN999
.
SGLIN100  MOVE      QRYDATA,PRGLI010
          GOTO      SGLIN999
.
SGLIN110  MOVE      QRYDATA,PRGLI011
          GOTO      SGLIN999
.
SGLIN120  MOVE      QRYDATA,PRGLI012
          GOTO      SGLIN999
.
SGLIN130  MOVE      QRYDATA,PRGLI013
          GOTO      SGLIN999
.
SGLIN140  MOVE      QRYDATA,PRGLI014
          GOTO      SGLIN999
.
SGLIN999  RETURN
.------------------------------------------------------------
. Medical Practice: Display,Add,Update,Delete
.------------------------------------------------------------
PRIPRA00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PRIPRA40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRIPRA10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PRIPRA20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRIPRA30 IF EQUAL
.
          GOTO      PRIPRA93
.
.         ************ ADD FORMACTION ***********
.
PRIPRA10  CALL      CHKPRA00      * Checks mandatory fields
          BRANCH    EXIT,PRIPRA99
          RESET     PRIPR001
          PACK      KEY6,PRIPR001,SP70
          CALL      RDPRPR1
          COMPARE   ZERO,OVRCD
          GOTO      PRIPRA92 IF EQUAL
          CALL      PRASAV00      * Moves input variables to file variables
          MOVE      SP70,PRPRRDAT * Reset date for Fees Invoice
          PACK      KEY6,PRIPR001,SP70
          CALL      WRPRPR1       * Writes away the data
.
          MOVE      "A",KEY1      * Set Add Parameter for PRAAUD00    
          CALL      PRAAUD00      * Write Audit File if Needed    
.
          MOVE      ZERO,EXIT
          GOTO      PRIPRA99
.
.         ************ UPDATE FORMACTION **********
.
PRIPRA20  PACK      KEY6,PRIPR001,SP70   
          CALL      RDPRPR1
          BRANCH    OVRCD,PRIPRA91
          CALL      CHKPRA00      * Checks mandatory fields
          BRANCH    EXIT,PRIPRA99
.
.         If Medical Practice is changed from Active to Inactive, check
.         if there is still referral with holding items
.         1=Inactive 0=Active
.
          MOVE      PRPRSTAT,F1      * Save status
.
          COMPARE   TWO,PRIPR009
          IF        !@EQUAL
            IF        F1=0
              CALL      CHRF0000     * Check if any holding items
              BRANCH    F1,PRIPRA94
            ENDIF
          ENDIF
.
          MOVE      "B",KEY1      * Set Before Changes Parameter for PRAAUD00 
          CALL      PRAAUD00      * Write Audit File if Needed  
.
          PACK      KEY6,PRIPR001,SP70  
          CALL      PRASAV00      * Moves input variables to file variables
          CALL      UPPRPR1       * Writes away the data
.
          MOVE      "C",KEY1      * Set After Changes Parameter for PRAAUD00    
          CALL      PRAAUD00      * Write Audit File if Needed  
.
          MOVE      ZERO,EXIT
          GOTO      PRIPRA99
.
.         ************ DELETE FORMACTION **********
.
PRIPRA30  PACK      KEY6,PRIPR001,SP70   
          CALL      RDPRPR1
          BRANCH    OVRCD,PRIPRA91
.
          CALL      CHRF0000     * Check if any holding items
          BRANCH    F1,PRIPRA95
.
          CALL      DEPRPR1
.
          PACK      KEY22,PRIPR001,SP70  * Delete Practice Doctors...
          CALL      RSPRDO1 
PRIPRA31  CALL      RKPRDO1
          BRANCH    OVRCD,PRIPRA32
.
          MATCH     PRIPR001,PRDOPRAC 
          GOTO      PRIPRA32 IF NOT EQUAL
.
          PACK      KEY22,PRDOPRAC,PRDODOCT,PRDOCLAM,PRDOPIND,SP70
          CALL      DEPRDO1
          GOTO      PRIPRA31
.
PRIPRA32  MOVE      "D",KEY1      * Set Delete Parameter for PRAAUD00    
          CALL      PRAAUD00      * Write Audit File if Needed   
.
          MOVE      ZERO,EXIT
          GOTO      PRIPRA99
.
.         ************ DISPLAY FORMACTION **********
.
PRIPRA40  PACK      KEY6,PRIPR001,SP70
          CALL      RDPRPR1
          IF        OVRCD=1
            CALL      CLRPRA00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Medical Practice Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRIPRA99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRIPRA99
.
PRIPRA91  MOVE      "Medical Pracice Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIPRA99
.
PRIPRA92  MOVE      "Medical Practice Code record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIPRA99
.
PRIPRA93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIPRA99
.
PRIPRA94  CLEAR     WEBTITLE
          APPEND    "Medical Practice can NOT be Inactive,",WEBTITLE
          APPEND    "still has Items to be invoiced.",WEBTITLE
          APPEND    SP70,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIPRA99
.
PRIPRA95  CLEAR     WEBTITLE
          APPEND    "Medical Practice can NOT be Deleted, still",WEBTITLE
          APPEND    " has Items to be invoiced.",WEBTITLE
          APPEND    SP70,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIPRA99
.
PRIPRA99  RETURN
.
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRPRA00  MOVE      SP70,PRPRCODE  * Medical Practice Code
          MOVE      SP70,PRPRDESC  * M.P. Description
          MOVE      SP70,PRPRPDOC  * M.P. Primary Doctor
          MOVE      SP70,PRPRADD1  * M.P. Address Line 1
          MOVE      SP70,PRPRADD2  * M.P. Address Line 2
          MOVE      SP70,PRPRADD3  * M.P. Address Line 3
          MOVE      SP70,PRPRPOST  * M.P. Postcode
          MOVE      SP70,PRPRTELP  * M.P. Telephone
          MOVE      ZERO,PRPRSTAT  * M.P. Status 1=Inactive 0=Active
          MOVE      ZERO,PRPRTIME  * Service time on invoice 0=No 1=Yes
          MOVE      SP70,PRPRRANG  * Spare variable                
          MOVE      SP70,PRPRPMCI  * MCI               
          MOVE      SP70,PRPRPYEE  * Payee Privider Number
          MOVE      SP70,PRPRREGI  * Register
          MOVE      SP70,PRPRSPAR  * Spare Variable
          MOVE      SP70,SELMPRAC
.
CLRPRA99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
PRASAV00  MOVE      PRIPR001,PRPRCODE  * Medical Practice Code
          MOVE      PRIPR002,PRPRDESC  * M.P. Description
          MOVE      PRIPR003,PRPRPDOC  * M.P. Primary Doctor
          MOVE      PRIPR004,PRPRADD1  * M.P. Address Line 1
          MOVE      PRIPR005,PRPRADD2  * M.P. Address Line 2
          MOVE      PRIPR006,PRPRADD3  * M.P. Address Line 3
          MOVE      PRIPR007,PRPRPOST  * M.P. Postcode
          MOVE      PRIPR008,PRPRTELP  * M.P. Telephone
.
          COMPARE   TWO,PRIPR009
          IF        @EQUAL
            MOVE      ZERO,PRPRSTAT  * M.P. Status 1=Inactive 0=Active
          ELSE 
            MOVE      ONE,PRPRSTAT
          ENDIF
.
          COMPARE    ZERO,PRIPR010
          IF         @EQUAL
            MOVE       ZERO,PRPRTIME
          ELSE
            MOVE      PRIPR010,PRPRTIME  * Service time on invoice 0=No 1=Yes
          ENDIF
.          
          MATCH     Z70,PRIPR011
          IF        !@EQUAL
            MOVE      PRIPR011,PRPRRANG  * Spare Variable
          ENDIF
.
          MATCH     Z70,PRIPR012
          IF        !@EQUAL
            MOVE      PRIPR012,PRPRPMCI  * MCI
          ENDIF
.
          MATCH     Z70,PRIPR013
          IF        !@EQUAL
            MOVE      PRIPR013,PRPRPYEE  * Payee provider number
          ENDIF
.
          MATCH     Z70,PRIPR014
          IF        !@EQUAL
            MOVE      PRIPR014,PRPRREGI  * Register
          ENDIF
.
          MOVE      SP70,PRPRSPAR      * Spare Variable
.
PRASAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKPRA00  RESET     PRIPR001
          MATCH     SP70,PRIPR001
          GOTO      CHKPRA90 IF EQUAL
.
          RESET     PRIPR002
          MATCH     SP70,PRIPR002
          GOTO      CHKPRA91 IF EQUAL
.
          GOTO      CHKPRA98
.
CHKPRA90  MOVE      "Medical Practice Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKPRA99
.
CHKPRA91  MOVE      "Medical Practice Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKPRA99
.
CHKPRA98  MOVE      ZERO,EXIT
CHKPRA99  RETURN
.---------------------------------------------------------------------
. Writes Medical Practice Audit
.    Parameters :   KEY1 - Set Record Type
.---------------------------------------------------------------------
PRAAUD00  BRANCH    PRCNAUDE,PRAAUD99  * Check if audit needs to be written
.
          CALL      IBACLOCK
          PACK      PRPRAUDD,CCC,CYY,CMM,CDD     * Date
          REP       " 0",PRPRAUDD
          MOVE      CTIMEIS,PRPRAUDT
.
          MOVE      PORT,PRPRAUDP                * Port
          MOVE      KEY1,PRPRAUDR                * Record Type
          MOVE      ONE,PRPRAUDS                 * Not Printed
          MOVE      PASSCODE,PRPRAUDO            * Operator
.
          PACK      KEY19,PRPRAUDD,PRPRAUDT,PRPRAUDP,PRPRAUDR
          CALL      AWPRPR                       * Write Audit File
.
PRAAUD99  RETURN
.---------------------------------------------------------------------
. Medical Practice Doctors : Display,Add,Update,Delete
.---------------------------------------------------------------------
PRIDOC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PRIDOC50 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRIDOC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PRIDOC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRIDOC30 IF EQUAL
.
          MATCH     "P",UPDTTYPE    * Process formaction
          GOTO      PRIDOC40 IF EQUAL
.
          GOTO      PRIDOC93
.
.         ************ ADD FORMACTION ***********
.
PRIDOC10  CALL      CHKDOC00      * Checks mandatory fields
          BRANCH    EXIT,PRIDOC99
.
          CALL      CHKPRI00      * Can that the primary doctor has been added
          BRANCH    EXIT,PRIDOC99
.
          PACK      KEY22,PRIDC001,PRIDC002,SP70 * Check If Doctor exists
          CALL      RSPRDO1
          CALL      RKPRDO1
          IF        OVRCD = 0
            MATCH     PRIDC001,PRDOPRAC
            GOTO      PRIDOC12 IF NOT EQUAL
.
            MATCH     PRIDC002,PRDODOCT
            GOTO      PRIDOC92 IF EQUAL
          ENDIF
.
PRIDOC12  CALL      DOCS0000      * Moves input variables to file variables
          MOVE      "A",KEY1      * Set Add Parameter for PRDAUD00
          CALL      PRDAUD00      * Write Audit File if Needed
          MOVE      ZERO,EXIT
          GOTO      PRIDOC99
.
.         ************ UPDATE FORMACTION **********
.
PRIDOC20  PACK      KEY22,PRIDC001,PRIDC002,SP70
          CALL      RSPRDO1
          CALL      RKPRDO1
          IF        OVRCD = 0
            MATCH     PRIDC001,PRDOPRAC
            GOTO      PRIDOC91 IF NOT EQUAL
.
            MATCH     PRIDC002,PRDODOCT
            GOTO      PRIDOC91 IF NOT EQUAL
          ELSE       
            GOTO      PRIDOC91
          ENDIF
.
PRIDOC22  CALL      CHKDOC00      * Checks mandatory fields
          BRANCH    EXIT,PRIDOC99
          MOVE      "B",KEY1      * Set Before Changes Parameter for PRDAUD00
          CALL      PRDAUD00      * Write Audit File if Needed
          CALL      DOCS0000      * Moves input variables to file variables
          MOVE      "C",KEY1      * Set After Changes Parameter for PRDAUD00
          CALL      PRDAUD00      * Write Audit File if Needed
          MOVE      ZERO,EXIT
          GOTO      PRIDOC99
.
.         ************ DELETE FORMACTION **********
.
PRIDOC30  CALL      DELPRI00      * Can not delete the primary doctor
          BRANCH    EXIT,PRIDOC99
.
          PACK      KEY22,PRIDC001,PRIDC002,SP70
          CALL      RSPRDO1
          CALL      RKPRDO1
          IF        OVRCD = 0
            MATCH     PRIDC001,PRDOPRAC
            GOTO      PRIDOC91 IF NOT EQUAL
.
            MATCH     PRIDC002,PRDODOCT
            GOTO      PRIDOC91 IF NOT EQUAL
          ELSE       
            GOTO      PRIDOC91
          ENDIF
.
          PACK      KEY22,PRIDC001,PRIDC002,SP70  * Delete Practice Doctor...
          CALL      RSPRDO1 
PRIDOC31  CALL      RKPRDO1
          BRANCH    OVRCD,PRIDOC32
.
          MATCH     PRIDC001,PRDOPRAC 
          GOTO      PRIDOC32 IF NOT EQUAL
.
          MATCH     PRIDC002,PRDODOCT
          GOTO      PRIDOC31 IF NOT EQUAL  
.
          PACK      KEY22,PRDOPRAC,PRDODOCT,PRDOCLAM,PRDOPIND,SP70
          CALL      DEPRDO1
          GOTO      PRIDOC31
.
PRIDOC32  MOVE      "D",KEY1      * Set Delete Parameter for PRDAUD00
          CALL      PRDAUD00      * Write Audit File if Needed
          MOVE      ZERO,EXIT
          GOTO      PRIDOC99
.
.         ************ PROCESS CODES FORMACTION **********
.
PRIDOC40  CALL      SAVSCH00      * Updates % Schedule Fee's
          MOVE      "C",KEY1      * Set After Changes Parameter for PRDAUD00
          CALL      PRDAUD00      * Write Audit File if Needed
          MOVE      ZERO,EXIT
          GOTO      PRIDOC99
.
.         ************ DISPLAY FORMACTION **********
.
PRIDOC50  MATCH     Z70,PRIDC001  
          GOTO      PRIDOC90 IF EQUAL
          MATCH     SP70,PRIDC001
          GOTO      PRIDOC90 IF EQUAL
.
          PACK      KEY6,PRIDC001,SP70  * Read Medical Practice Record
          CALL      RDPRPR1  
          BRANCH    OVRCD,PRIDOC91
.
          PACK      KEY22,PRIDC001,PRIDC002,SP70
          CALL      RSPRDO1
          CALL      RKPRDO1
          IF        OVRCD = 0
            MATCH     PRIDC001,PRDOPRAC
            CALL      CLRDOC00 IF NOT EQUAL
.
            MATCH     PRIDC002,PRDODOCT
            CALL      CLRDOC00 IF NOT EQUAL
.
            MATCH     Z70,PRIDC002
            IF        !@EQUAL
              MATCH     Z70,PRIDC001
              IF        !@EQUAL
                CALL      SETFEE00
              ENDIF
            ENDIF
          ELSE  
            CALL      CLRDOC00    * Clear all the file variables
          ENDIF
          GOTO      PRIDOC90
.
PRIDOC90  CLEAR     WEBTITLE
          MOVE      "Medical Practice Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRIDOC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRIDOC99
.
.
PRIDOC91  MOVE      "Doctor record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIDOC99
.
PRIDOC92  MOVE      "Doctor record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIDOC99
.
PRIDOC93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIDOC99
.
PRIDOC94  MOVE      "Invalid Medical Practice Doc.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIDOC99
.
PRIDOC95  MOVE      "Medical Practice already exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIDOC99
.
PRIDOC99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRDOC00  MOVE      SP70,PRDOPRAC  * Medical Practice Code
          MOVE      SP70,PRDODOCT  * Associated Doctor Code
          MOVE      SP70,PRDOCLAM  * Claim Code (Category CL)
          MOVE      SP70,PRDOPIND  * Patient Indicator (Category GI)
          MOVE      ZERO,PRDOCOMM  * Associated Doctor % Commission
          MOVE      ZERO,PRDOFEEP  * % of Schedule Fee Charged
          MOVE      ZERO,PRDOSTAT  * Assoc Doctor Status 1=Inactive 0=Active
          MOVE      SP70,PRDOPROV  * Service Provider
          MOVE      SP70,PRDOSPAR  * Spare Variable
.
CLRDOC99  RETURN
.----------------------------------------------------------------
. SAVSCH00  - Updates the % Schedule Fee wether changed or not 
.----------------------------------------------------------------
SAVSCH00  MOVE      ONE,F3
          WHILE     F3<=ARRAYEND 
            MATCH     SP70,PRDOCKEY[F3] 
            IF        !@EQUAL
              UNPACK    PRDOCKEY[F3],CODECL,CODEGI,KEY6 
              PACK      KEY22,PRIDC001,PRIDC002,CODECL,CODEGI,SP70 
              CALL      RDPRDO1
              IF        OVRCD = 1
                SQUEEZE   KEY6
                MOVE      KEY6,PRDOFEEP 
                MOVE      "000",PRDOCOMM
                MOVE      "0",PRDOSTAT        * default to active
                MOVE      SP10,PRDOCRCD
                MOVE      SP10,PRDOABNN
                MOVE      "0",PRDOGSTR
                PACK      KEY22,PRIDC001,PRIDC002,CODECL,CODEGI,SP70 
                CALL      WRPRDO1
              ELSE
                SQUEEZE   KEY6
                MATCH     Z70,KEY6
                IF        !@EQUAL
                  MOVE      KEY6,PRDOFEEP 
                ENDIF
                MATCH     Z70,PRIDC006
                IF        !@EQUAL
                  MOVE      PRIDC006,PRDOSTAT
                ENDIF
                MATCH     Z70,PRIDC007
                IF        !@EQUAL
                  MOVE      PRIDC007,PRDOABNN
                ENDIF
                COMPARE   ZERO,PRIDC008
                IF        @EQUAL
                  MOVE      ZERO,PRDOGSTR
                ELSE
                  MOVE      ONE,PRDOGSTR
                ENDIF
                MATCH     Z70,PRIDC009
                IF        !@EQUAL
                  MOVE      PRIDC009,PRDOPROV
                ENDIF
                PACK      KEY22,PRIDC001,PRIDC002,CODECL,CODEGI,SP70 
                CALL      UPPRDO1  
              ENDIF
            ENDIF
            ADD         ONE,F3
          DO
.
SAVSCH99  RETURN
.----------------------------------------------------------------
. SETPRI00  - Sets the Primary Doctor in Medical Practice File
.----------------------------------------------------------------
SETPRI00  PACK      KEY6,PRIDC001,SP70  * Read Medical Practice Record
          CALL      RDPRPR1
          BRANCH    OVRCD,SETPRI90 
.
          MATCH     SP70,PRPRPDOC        
          GOTO      SETPRI91 IF NOT EQUAL 
.
          MOVE      PRIDC002,PRPRPDOC   * Assign new Primary Doctor
          PACK      KEY6,PRIDC001,SP70
          CALL      UPPRPR1       * Update Record 
          MOVE      "C",KEY1      * Set After Changes Parameter for PRAAUD00
          CALL      PRAAUD00      * Write Audit File if Needed
          GOTO      SETPRI98 
.
SETPRI90  MOVE      "Invalid Medical Practice.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SETPRI99
.
SETPRI91  MOVE      "Primary Doctor already set.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SETPRI99
.
SETPRI98  MOVE      ZERO,EXIT
SETPRI99  RETURN
.----------------------------------------------------------------
. DELPRI00  - Check if this is the primary doctor. If it is you   
.             can not delete the doctor
.----------------------------------------------------------------
DELPRI00  PACK      KEY6,PRIDC001,SP70  * Read Medical Practice Record
          CALL      RDPRPR1
          BRANCH    OVRCD,DELPRI90 
.
          MATCH     PRIDC002,PRPRPDOC        
          GOTO      DELPRI91 IF EQUAL 
.
          GOTO      DELPRI98 
.
DELPRI90  MOVE      "Invalid Medical Practice.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DELPRI99
.
DELPRI91  MOVE      "You can not delete the primary doctor.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DELPRI99
.
DELPRI98  MOVE      ZERO,EXIT
DELPRI99  RETURN
.
.----------------------------------------------------------------
. CHKPRI00  - Check that the primary doctor has been added. If it has not
.             the doctor being added must be the primary doctor
.----------------------------------------------------------------
CHKPRI00  PACK      KEY6,PRIDC001,SP70  * Read Medical Practice Record
          CALL      RDPRPR1
          BRANCH    OVRCD,CHKPRI90
.
          PACK      KEY22,PRIDC001,PRPRPDOC,SP70 * Check for primary doctor
          CALL      RSPRDO1
          CALL      RKPRDO1
          IF        OVRCD = 0
            MATCH     PRIDC001,PRDOPRAC
            GOTO      CHKPRI20 IF NOT EQUAL
.
            MATCH     PRPRPDOC,PRDODOCT
            GOTO      CHKPRI98 IF EQUAL
          ENDIF
.
CHKPRI20  MATCH     PRIDC002,PRPRPDOC
          GOTO      CHKPRI91 IF NOT EQUAL
.
          GOTO      CHKPRI98
.
CHKPRI90  MOVE      "Invalid Medical Practice.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKPRI99
.
CHKPRI91  MOVE      "You must add the primary doctor first.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKPRI99
.
CHKPRI98  MOVE      ZERO,EXIT
CHKPRI99  RETURN
.--------------------------------------------------------------------
.                        DOCS0000
. Save routine - For each Claim Code (Category CL) on file, get out 
.                each patient Indicator Code (Category GI) on file 
.                and wrtie the record to the file (pridoctf). 
.--------------------------------------------------------------------
DOCS0000  MOVE      ZERO,RCOUNT
          PACK      KEY5,CATCL,SP70              * Get "CL" category record
          CALL      RDCODE1
.
.         Read the next code on file for the category "CL"
.
DOCS1000  CALL      RDKCODE1                     * read next record
          BRANCH    OVRCD,DOCS8000               * end of file - finished
.
          MATCH     TCODE,CATCL                  * same category ?
          GOTO      DOCS8000 IF NOT EQUAL        * no - finished
.
          MOVE      ACODE,CODECL                 * save claim code
.
.         Get out each patient indicator code on file
. 
          PACK      KEY5,CATGI,SP70              * get "GI" category record
          CALL      RDCODE1
.
.         Read the next code on file for the category "GI"
.
DOCS5000  CALL      RDKCODE1                     * read next record
          BRANCH    OVRCD,DOCS7000               * end of file
.
          MATCH     TCODE,CATGI                  * same category ?
          GOTO      DOCS7000 IF NOT EQUAL        * no
.
          MOVE      ACODE,CODEGI                 * save code
.
.         Calls Save Variables routine & writes away a record 
.
          PACK      KEY22,PRIDC001,PRIDC002,CODECL,CODEGI,SP70
          CALL      RDPRDO1
          IF        OVRCD = 1 
            CALL      DOCSAV00      * Save Variables 
            MOVE      "100",PRDOFEEP * Default value % of Schedule Fee Charged
            CALL      WRPRDO1       * Writes away the data
          ELSE
            CALL      DOCSAV00      * Save Variables 
            CALL      UPPRDO1
          ENDIF
          GOTO      DOCS5000        * get next patient indicator code
.                                                
.         No more patient indicator codes on file, so get the next
.         claim code on file
.
DOCS7000  PACK      KEY5,CATCL,CODECL,SP70   * Read previous claim code again
          CALL      RDCODE1                       
          GOTO      DOCS1000
.
. If the doctor is inactive check that all the pridoctf records have been
. made inactive.
. If a claim code has been deleted from patcodes the doctor record
. will not be made inactive so inactivate them.
.
DOCS8000  MATCH     Z70,PRIDC006            * No active status received
          GOTO      DOCS9999 IF EQUAL
.
          MATCH     "1",PRIDC006            * Inactive doctor
          GOTO      DOCS9999 IF NOT EQUAL
.
          PACK      KEY22,PRIDC001,PRIDC002,SP70
          CALL      RSPRDO1
DOCS8500  CALL      RKPRDO1                 * Loop all doctor records
          BRANCH    OVRCD,DOCS9999
.
          MATCH     PRIDC001,PRDOPRAC       * Same Practice
          GOTO      DOCS9999 IF NOT EQUAL
.
          MATCH     PRIDC002,PRDODOCT       * Same Doctor
          GOTO      DOCS9999 IF NOT EQUAL
.
          COMPARE   ONE,PRDOSTAT            * Skip already inactive
          GOTO      DOCS8500 IF EQUAL
.
          MOVE      ONE,PRDOSTAT            * Inactivate record
          CALL      UPPRDO1
          GOTO      DOCS8500
.
DOCS9999  RETURN
.------------------------------------------------------------
. * Move CGI Parameters into file variables 
.        INPUT VARIABLES: CODECL & CODEGI 
.------------------------------------------------------------
DOCSAV00  MOVE      PRIDC001,PRDOPRAC  * Medical Practice Code                 
          MOVE      PRIDC002,PRDODOCT  * Associated Doctor Code
          MOVE      CODECL,PRDOCLAM    * Claim Code (Category CL)
          MOVE      CODEGI,PRDOPIND    * Patient Indicator (Category GI)
          MOVE      PRIDC005,PRDOCOMM  * Associated Doctor % Commission
          MOVE      SP10,PRDOCRCD
          MOVE      PRIDC006,PRDOSTAT
          MOVE      PRIDC007,PRDOABNN
          MOVE      PRIDC008,PRDOGSTR
.
          MATCH     Z70,PRIDC009
          IF        !@EQUAL
            MOVE      PRIDC009,PRDOPROV
          ENDIF
.
          MOVE      SP70,PRDOSPAR      * Spare Variable
.
DOCSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKDOC00  RESET     PRIDC002
          MATCH     SP70,PRIDC002
          GOTO      CHKDOC90 IF EQUAL
.
          GOTO      CHKDOC98
.
CHKDOC90  MOVE      "Associated Doctor Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKDOC99
.
CHKDOC98  MOVE      ZERO,EXIT
CHKDOC99  RETURN
.-------------------------------------------------------------------------------
. Writes Medical Practice Doctor Audit
.    Parameters :   KEY1 - Set Record Type
.-------------------------------------------------------------------------------
PRDAUD00  BRANCH    PRCNAUDC,PRDAUD99  * Check if Audit needs to be written 
.
          CALL      IBACLOCK
          PACK      PRDOAUDD,CCC,CYY,CMM,CDD     * Date
          REP       " 0",PRDOAUDD
          MOVE      CTIMEIS,PRDOAUDT
.
          MOVE      PORT,PRDOAUDP                * Port
          MOVE      KEY1,PRDOAUDR                * Record Type 
          MOVE      ONE,PRDOAUDS                 * Not Printed
          MOVE      PASSCODE,PRDOAUDO            * Operator
.
          PACK      KEY19,PRDOAUDD,PRDOAUDT,PRDOAUDP,PRDOAUDR
          CALL      AWPRDO                       * Write Audit File
.
PRDAUD99  RETURN
.---------------------------------------------------------------------
. Income percentage : Display,Add,Update,Delete
.---------------------------------------------------------------------
PRIPCE00  PACK      KEY17,PRIPC003,PRIPC004,PRIPC005,SP70
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PRIPCE40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRIPCE10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PRIPCE20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRIPCE30 IF EQUAL
.
          GOTO      PRIPCE93
.
.         ************ ADD FORMACTION ***********
.
PRIPCE10  PACK      KEY31,PRIPC001,PRIPC002,KEY17,PRIPC006,SP70
          CALL      RDPRPCE1
          COMPARE   ZERO,OVRCD
          GOTO      PRIPCE92 IF EQUAL  * already exist
.
          CALL      PCES0000      * Moves input variables to file variables
          MATCH     "1",FREEFORM
          IF        !@EQUAL
            CALL      GACC0000    * Get debit account
          ENDIF
.
          CALL      WRPRPCE1      * Write a new record
.
          CALL      CPER0000      * Check the total percentage
          GOTO      PRIPCE99
.
.         ************ UPDATE FORMACTION **********
.
PRIPCE20  PACK      KEY31,PRIPC001,PRIPC002,KEY17,PRIPC006,SP70
          CALL      RDPRPCE1
          BRANCH    OVRCD,PRIPCE91
.
          CALL      PCES0000      * Moves input variables to file variables
          MATCH     "1",FREEFORM
          IF        !@EQUAL
            CALL      GACC0000    * Get debit account
          ENDIF
.
          CALL      UPPRPCE1      * Update a new record
.
          CALL      CPER0000      * Check the total percentage
          GOTO      PRIPCE99
.
.         ************ DELETE FORMACTION **********
.
PRIPCE30  PACK      KEY31,PRIPC001,PRIPC002,KEY17,PRIPC006,SP70
          CALL      RDPRPCE1
          BRANCH    OVRCD,PRIPCE91
.
          CALL      DEPRPCE1
          GOTO      PRIPCE99
.
.         ************ DISPLAY FORMACTION **********
.
PRIPCE40  PACK      KEY31,PRIPC001,PRIPC002,KEY17,PRIPC006,SP70
          CALL      RDPRPCE1
          IF        OVRCD=1
            CALL      CLRPCE00
          ENDIF
.
..          MOVE      PRIPC002,PRPCDOCT
.
          UNPACK    PRPCFCOD,PRPCFLAG,PRPCITMN,PRPCSUBN
.
          CLEAR     WEBTITLE
          MOVE      "General Ledger Interface Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRIPCE99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRIPCE99
.
PRIPCE91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIPCE99
.
PRIPCE92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIPCE99
.
PRIPCE93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIPCE99
.
PRIPCE94  MOVE      "Percentage must not be greater than 100% ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIPCE99
.
PRIPCE99  RETURN
.------------------------------------------------------------
. * move input variables to the fields
.------------------------------------------------------------
PCES0000  MOVE      PRIPC001,PRPCFTYP    * Financial Type
          MOVE      PRIPC002,PRPCDOCT    * Doctor Code
          MOVE      KEY17,PRPCFCOD       * Financial Code
          MOVE      PRIPC006,PRPCPORT    * Type of Portion
          MOVE      PRIPC007,PRPCPCEN    * Percentage
          MOVE      PRIPC008,PRPCDSEC    * Dissection
          MOVE      PRIPC009,PRPCRESP    * Responsibilty
          MOVE      PRIPC010,PRPCLEDG    * Ledger
          MOVE      PRIPC011,PRPCCRAC    * Income/Credit Account
          MOVE      PRIPC012,PRPCDBAC    * Debit Account
.
PCES9999  RETURN
.-----------------------------------------------------------
. Get debit account
.-----------------------------------------------------------
GACC0000  MOVE      PRPCLEDG,KEY2
          CALL      RDFMLA1
          BRANCH    OVRCD,GACC9999
.
          MOVE      FMLADEB,PRPCDBAC          * Debit account/Debtor account
.
          PACK      KEY14,PRPCLEDG,PRPCCRAC   * ledger,income
          CALL      RDFMCS1
          BRANCH    OVRCD,GACC9999
.
          MATCH     SP70,FMCSDEB
          IF        !@EQUAL
            MOVE      FMCSDEB,PRPCDBAC        * Debit account/Debtor account
          ENDIF
.
GACC9999  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRPCE00  MOVE      SP70,PRPCFTYP  * Financial type
          MOVE      SP70,PRPCDOCT  * Doctor code
          MOVE      SP70,PRPCFCOD  * Item flag
          MOVE      SP70,PRPCPORT  * Allocation type
          MOVE      ZERO,PRPCPCEN  * Percentage
          MOVE      SP70,PRPCDSEC  * Dissection
          MOVE      SP70,PRPCRESP  * Responsibility
          MOVE      SP70,PRPCLEDG  * Ledger
          MOVE      SP70,PRPCCRAC  * Credit account
          MOVE      SP70,PRPCDBAC  * Debit account
          MOVE      SP70,PRPCSPAR  * Spare
.
CLRPCE99  RETURN
.-------------------------------------------------------------------------------
. Check total Percentage for Financial Type, Doctor & Financial Code Combo
.-------------------------------------------------------------------------------
CPER0000  MOVE      ZERO,EXIT
          MOVE      ZERO,FORM32
          PACK      SKEY28,PRPCFTYP,PRPCDOCT,PRPCFCOD,SP70
.
          PACK      KEY31,PRPCFTYP,PRPCDOCT,PRPCFCOD,SP70
          CALL      RSPRPCE1
CPER1000  CALL      RKPRPCE1
          BRANCH    OVRCD,CPER8000
.
          PACK      KEY28,PRPCFTYP,PRPCDOCT,PRPCFCOD,SP70
.
          MATCH     SKEY28,KEY28
          GOTO      CPER8000 IF NOT EQUAL
.
          ADD       PRPCPCEN,FORM32
          GOTO      CPER1000
.
CPER8000  COMPARE   "100.00",FORM32
          GOTO      CPER9999 IF EQUAL
.
          MOVE      "Warning: Total percentage of Items is not 100% ",WEBTITLE
          CALL      ERRDSP00
          MOVE      ONE,EXIT
.
CPER9999  RETURN
+
.------------------------------------------------------------
. Output Debtor Enquiry Page
.------------------------------------------------------------
SRHDEB00  MOVE      "Debtor Search",WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SRHDEB99
.
          CALL      WEBBOD00   * Output Templated Body of HTML
.
          CALL      WEBEND00   * Output End of Web Page
.
SRHDEB99  RETURN
.--------------------------------------------------------------------
. Medical Practice All Security Access: Display,Add,Update,Delete
.--------------------------------------------------------------------
PRIALS00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PRIALS40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRIALS10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRIALS30 IF EQUAL
.
          GOTO      PRIALS93
.
.         ************ ADD FORMACTION ***********
.
PRIALS10  PACK      KEY10,PRUSERID,SP70
          CALL      RDPRALS1
          COMPARE   ZERO,OVRCD
          GOTO      PRIALS92 IF EQUAL
.
          CALL      SAVALS00      * Moves input variables to file variables
          CALL      WRPRALS1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PRIALS99
.
.         ************ DELETE FORMACTION **********
.
PRIALS30  PACK      KEY10,PRUSERID,SP70   
          CALL      RDPRALS1
          BRANCH    OVRCD,PRIALS91
.
          CALL      DEPRALS1
.
          MOVE      ZERO,EXIT
          GOTO      PRIALS99
.
.         ************ DISPLAY FORMACTION **********
.
PRIALS40  PACK      KEY10,PRUSERID,SP70
          CALL      RDPRALS1
          IF        OVRCD=1
            CALL      CLRALS00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "All Practice Security Access",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRIALS99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PRIALS99
.
PRIALS91  MOVE      "All Security Access record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIALS99
.
PRIALS92  MOVE      "All Security Access record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIALS99
.
PRIALS93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIALS99
.
PRIALS99  RETURN
.-------------------------------------------------------------------------------
. Clear file vars                     
.-------------------------------------------------------------------------------
CLRALS00  MOVE      SP70,PRALUSID  * User ID
          MOVE      SP70,PRALSPAR  * Spare
.
CLRALS99  RETURN
.-------------------------------------------------------------------------------
. Save file vars                     
.-------------------------------------------------------------------------------
SAVALS00  MOVE      PRUSERID,PRALUSID  * User ID
          MOVE      SP70,PRALSPAR      * Spare
.
SAVALS99  RETURN
.--------------------------------------------------------------------
. Medical Practice User Security Access: Display,Add,Update,Delete
.--------------------------------------------------------------------
PRISEC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PRISEC40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRISEC10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRISEC20 IF EQUAL
.
          MATCH     "S",UPDTTYPE    * Single User Access
          GOTO      PRISEC30 IF EQUAL
.
          GOTO      PRISEC96
.
.         ************ ADD FORMACTION ***********
.
PRISEC10  PACK      KEY6,PRIMPRAC,SP70   * Read Practice File
          CALL      RDPRPR1
          BRANCH    OVRCD,PRISEC93
.
          PACK      KEY10,PRUSERID,SP70   
          CALL      RDPRALS1
          COMPARE   ZERO,OVRCD
          GOTO      PRISEC94 IF EQUAL
.
          PACK      KEY16,PRIMPRAC,PRUSERID,SP70
          CALL      RDPRSEC1
          COMPARE   ZERO,OVRCD
          GOTO      PRISEC92 IF EQUAL
.
          CALL      SAVSEC00      * Moves input variables to file variables
          CALL      WRPRSEC1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PRISEC99
.
.         ************ DELETE FORMACTION **********
.
PRISEC20  PACK      KEY6,PRIMPRAC,SP70   * Read Practice File
          CALL      RDPRPR1
          BRANCH    OVRCD,PRISEC93
.
          PACK      KEY16,PRIMPRAC,PRUSERID,SP70   
          CALL      RDPRSEC1
          BRANCH    OVRCD,PRISEC91
.
          CALL      DEPRSEC1
.
          MOVE      ZERO,EXIT
          GOTO      PRISEC99
.
.         ************ DISPLAY FORMACTION **********
.
PRISEC30  PACK      KEY10,PRUSERID,SP70   * Read Practice File
          CALL      RDWBSE1
          BRANCH    OVRCD,PRISEC95
.
          GOTO      PRISEC50
.
PRISEC40  PACK      KEY6,PRIMPRAC,SP70   * Read Practice File
          CALL      RDPRPR1
          BRANCH    OVRCD,PRISEC93
.
PRISEC50  PACK      KEY16,PRIMPRAC,PRUSERID,SP70
          CALL      RDPRSEC1
          IF        OVRCD=1
            CALL      CLRSEC00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "User Practice Access",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRISEC99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PRISEC99
.
PRISEC91  MOVE      "User Security Access record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRISEC99
.
PRISEC92  MOVE      "User Security Access record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRISEC99
.
PRISEC93  MOVE      "Private Practice record does not exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRISEC99
.
PRISEC94  MOVE      "This User has All Practice Access!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRISEC99
.
PRISEC95  MOVE      "This User Security Code!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRISEC99
.
PRISEC96  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRISEC99
.
PRISEC99  RETURN
.-------------------------------------------------------------------------------
. Clear file vars                     
.-------------------------------------------------------------------------------
CLRSEC00  MOVE      SP70,PRSEPRAC  * Medical Practice
          MOVE      SP70,PRSEUSID  * User ID
          MOVE      SP70,PRSESPAR  * Spare
.
CLRSEC99  RETURN
.-------------------------------------------------------------------------------
. Save file vars                     
.-------------------------------------------------------------------------------
SAVSEC00  MOVE      PRIMPRAC,PRSEPRAC  * Medical Practice
          MOVE      PRUSERID,PRSEUSID  * User ID
          MOVE      SP70,PRSESPAR  * Spare
.
SAVSEC99  RETURN
+
.------------------------------------------------------------------------------
. Private Practice General Ledger Interfase Maintenance
.------------------------------------------------------------------------------
.
PRIGLI00  COMPARE   ONE,PRCNGLIN
          GOTO      PRIGLI94 IF NOT EQUAL
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      PRIGLI80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PRIGLI10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      PRIGLI20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PRIGLI30 IF EQUAL
.
          GOTO      PRIGLI91
.
.         ********* ADD FORMACTION *********
.
PRIGLI10  CALL      GLKEY000                * Determine GL Key
          BRANCH    EXIT,PRIGLI99
          PACK      KEY18,PRGLI001,PRGLI002,SP70
          CALL      RDPRFM1
          COMPARE   OVRCD,ZERO
          GOTO      PRIGLI93 IF EQUAL
.
          CALL      SAVGLI00
          CALL      WRPRFM1
          GOTO      PRIGLI98
.
.         ********* UPDATE FORMACTION *********
.
PRIGLI20  PACK      KEY18,PRGLI001,PRGLI002,SP70
          CALL      RDPRFM1
          BRANCH    OVRCD,PRIGLI92
.
          CALL      SAVGLI00
          CALL      UPPRFM1
          GOTO      PRIGLI98
.
.         ********* DELETE FORMACTION *********
.
PRIGLI30  PACK      KEY18,PRGLI001,PRGLI002,SP70
          CALL      RDPRFM1
          BRANCH    OVRCD,PRIGLI92
.
          CALL      DEPRFM1
          GOTO      PRIGLI98
.
.
.         ********* DISPLAY FORMACTION *********
.
PRIGLI80  MATCH     "1",NEWRECRD               * add new record
          GOTO      PRIGLI81 IF EQUAL
.
          PACK      KEY18,PRGLI001,PRGLI002,SP70
          CALL      RDPRFM1
          BRANCH    OVRCD,PRIGLI81
          GOTO      PRIGLI82
.
PRIGLI81  CALL      CLRGLI00                 * clear variables
          MOVE      "1",NEWRECRD
.
PRIGLI82  CLEAR     WEBTITLE
          MOVE      "Private Practice G/L Interface Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,PRIGLI99
          CALL      WEBBOD00                * Process Web Body
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PRIGLI99
.
.         ********* DISPLAY ERROR MESSAGES *********
.
PRIGLI91  MOVE      "Invalid formaction",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIGLI99
.
PRIGLI92  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIGLI99
.
PRIGLI93  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIGLI99
.
PRIGLI94  MOVE      "Private Practice G/L Interface is Turned Off.",WEBTITLE
          CALL      WEBERR00
          MOVE      "../lookups/blank.html",REDIRECT
          GOTO      PRIGLI99
.
PRIGLI98  MOVE      ZERO,EXIT
PRIGLI99  RETURN
+
.------------------------------------------------------------------------------
. Determine GL key
.------------------------------------------------------------------------------
.
GLKEY000  MOVE      ZERO,EXIT
          COMPARE   ONE,PRGLI001              * Item
          GOTO      GLKEY100 IF EQUAL
          COMPARE   THREE,PRGLI001            * Journal
          GOTO      GLKEY300 IF EQUAL
          GOTO      GLKEY999
.
.         Misc Items
.
GLKEY100  CMATCH    "1",SUBSECTN              * Default
          GOTO      GLKEY110 IF EQUAL
          CMATCH    "2",SUBSECTN              * Group Codes
          GOTO      GLKEY120 IF EQUAL
          CMATCH    "3",SUBSECTN              * Item Codes
          GOTO      GLKEY130 IF EQUAL
          GOTO      GLKEY999
.
GLKEY110  PACK      PRGLI002,SP70
          GOTO      GLKEY999
.
GLKEY120  PACK      PRGLI002,GROUPCOD,SP70              * Group 
          GOTO      GLKEY999
.
GLKEY130  CALL      CHKITM00                            * read item file
          BRANCH    EXIT,GLKEY900
          PACK      PRGLI002,PRITSETC,ITEMFLAG,ITEMNUMB,ISUBNUMB,SP70 * Item 
          GOTO      GLKEY999
.
.         Journals
.
GLKEY300  CMATCH    "1",SUBSECTN              * Default
          GOTO      GLKEY310 IF EQUAL
          CMATCH    "2",SUBSECTN              * Journal Codes
          GOTO      GLKEY320 IF EQUAL
          GOTO      GLKEY999
.
GLKEY310  PACK      PRGLI002,SP70
          GOTO      GLKEY999
.
GLKEY320  PACK      PRGLI002,JOURNALC,SP70
          GOTO      GLKEY999
.
GLKEY900  MOVE      "Item not on file.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GLKEY999
.
GLKEY999  RETURN
+
.****************************************************************************
.*                               CHKITM00                                   *
.*                     see if valid item entered                            *
.*   RETURNS:      EXIT    0 = valid item                                   *
.*                         1 = not valid item                               *
.****************************************************************************
.
CHKITM00  PACK      KEY22,ITEMFLAG,ITEMNUMB,ISUBNUMB,NINE8
          CALL      RDPRIT1                      * record on file ?
          COMPARE   ZERO,OVRCD
          GOTO      CHKITM90 IF EQUAL            * yes - ok
.
          CALL      RPPRIT1                      * read previous record
          BRANCH    OVRCD,CHKITM10               * end of file
.
          COMPARE   ITEMFLAG,PRITFLAG            * same item type ?
          GOTO      CHKITM10 IF NOT EQUAL        * no
.
          MATCH     ITEMNUMB,PRITITMN            * same item number ?
          GOTO      CHKITM10 IF NOT EQUAL        * no
.
          MATCH     ISUBNUMB,PRITSUBN             * same subitem number ?
          GOTO      CHKITM10 IF NOT EQUAL        * no
.
          GOTO      CHKITM90                     * yes
.
CHKITM10  MOVE      ONE,EXIT
          GOTO      CHKITM99
.
CHKITM90  MOVE      ZERO,EXIT
          GOTO      CHKITM99
.
CHKITM99  RETURN
+
.------------------------------------------------------------------------------
. Clear all variables for General Ledger Interface
.------------------------------------------------------------------------------
.
CLRGLI00  MOVE      ZERO,PRFMSUB
          MOVE      SP70,PRFMCOD
          MOVE      SP70,PRFMIDI
          MOVE      SP70,PRFMIRE
          MOVE      SP70,PRFMILD
          MOVE      SP70,PRFMICA
          MOVE      SP70,PRFMIDA
          MOVE      SP70,PRFMIGS
          MOVE      SP70,PRFMBASC
          MOVE      SP70,PRFMTDI
          MOVE      SP70,PRFMTRE
          MOVE      SP70,PRFMTLD
          MOVE      SP70,PRFMTCA
          MOVE      SP70,PRFMTDA
.
CLRGLI99  RETURN
+
.------------------------------------------------------------------------------
. Save variables for General Ledger Interface
.------------------------------------------------------------------------------
.
SAVGLI00  MOVE      PRGLI001,PRFMSUB
          MOVE      PRGLI002,PRFMCOD
          MOVE      PRGLI003,PRFMIDI
          MOVE      PRGLI004,PRFMIRE
          MOVE      PRGLI005,PRFMILD
          MOVE      PRGLI006,PRFMICA
          MOVE      PRGLI007,PRFMIDA
.
          COMPARE   THREE,PRGLI001
          GOTO      SAVGLI99 IF EQUAL
.
          MOVE      PRGLI008,PRFMIGS
          MOVE      PRGLI009,PRFMBASC
          MOVE      PRGLI010,PRFMTDI
          MOVE      PRGLI011,PRFMTRE
          MOVE      PRGLI012,PRFMTLD
          MOVE      PRGLI013,PRFMTCA
          MOVE      PRGLI014,PRFMTDA
.
SAVGLI99  RETURN
+
.-------------------------------------------------------------------------------
. Process Fields called from WEBBOD00 
.-------------------------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80
          GOTO      PROFLD99
.
.      Medical Practice
.
PROFLD10  CALL      PRIA0000       * Medical Practice
          GOTO      PROFLD99
.
.      Medical Practice Doctors     
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22
.
PROFLD21  CALL      PRIA0000       * Medical Practice
          GOTO      PROFLD99
.
PROFLD22  CALL      PRID0000       * Medical Practice Doctors
          GOTO      PROFLD99
.
.       G/L Interface
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31
.
PROFLD31  CALL      PRPC0000       * income percentage
          GOTO      PROFLD99
.
.       Debtor Search
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41
.
PROFLD41  CALL      DEBS0000    
          GOTO      PROFLD99
.
PROFLD50  CALL      PRAL0000       * Private Practice All Security Access 
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62
          GOTO      PROFLD99
.
PROFLD61  CALL      PRIA0000       * Medical Practice
          GOTO      PROFLD99
.
PROFLD62  CALL      PRSC0000       * Private Practice User Security Access
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71
          GOTO      PROFLD99
.
PROFLD71  CALL      GLIN0000                * General Ledger Interface
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81,PROFLD82
.
PROFLD81  CALL      PRIA0000       * Medical Practice
          GOTO      PROFLD99
.
PROFLD82  CALL      HCBC0000       * Batch status table
          GOTO      PROFLD99
.
PROFLD99  RETURN
.-----------------------------------------------------------
. Option 1 - Medical Practice
.-----------------------------------------------------------
PRIA0000  BRANCH    FLDITMNO,PRIA0100,PRIA0200,PRIA0300,PRIA0400,PRIA0500:
                             PRIA0600,PRIA0700,PRIA0800,PRIA0900,PRIA1000:
                             PRIA1100,PRIA1200,PRIA1300,PRIA1400,PRIA1500:
                             PRIA1600,PRIA1700,PRIA1800,PRIA1900,PRIA2000:
                             PRIA2100
          GOTO      PRIA9999
.
PRIA0100  WRITE     HTMLFILE;PRPRCODE;  * Medical Practice Code
          GOTO      PRIA9999
.
PRIA0200  WRITE     HTMLFILE;PRPRDESC;  * Description
          GOTO      PRIA9999
.
PRIA0300  PACK      GENPCODE,PRPRPDOC,SP70  * Primary Doctor
          CALL      HCPDET00            * Get Doctor Details 
          GOTO      PRIA9999
.
PRIA0400  MATCH     SP70,PRPRADD1
          GOTO      PRIA9999 IF EQUAL
          WRITE     HTMLFILE;PRPRADD1;  * Address Line 1  
          GOTO      PRIA9999
.
PRIA0500  MATCH     SP70,PRPRADD2
          GOTO      PRIA9999 IF EQUAL
          WRITE     HTMLFILE;PRPRADD2;  * Address Line 2  
          GOTO      PRIA9999
.
PRIA0600  MATCH     SP70,PRPRADD3
          GOTO      PRIA9999 IF EQUAL
          WRITE     HTMLFILE;PRPRADD3;  * Address Line 3  
          GOTO      PRIA9999
.
PRIA0700  MATCH     SP70,PRPRPOST
          GOTO      PRIA9999 IF EQUAL
          WRITE     HTMLFILE;PRPRPOST;  * Postcode               
          GOTO      PRIA9999
.
PRIA0800  MATCH     SP70,PRPRTELP
          GOTO      PRIA9999 IF EQUAL
          WRITE     HTMLFILE;PRPRTELP;  * Telephone                 
          GOTO      PRIA9999
.
PRIA0900  COMPARE   ZERO,PRPRSTAT
          IF        @EQUAL 
            WRITE     HTMLFILE;PRPRSTAT;  * Status               
          ELSE
            WRITE     HTMLFILE;"1";
          ENDIF
          GOTO      PRIA9999
.
PRIA1000  COMPARE   ZERO,PRPRTIME
          IF        @EQUAL
            WRITE     HTMLFILE;"0";
          ELSE
            WRITE     HTMLFILE;PRPRTIME;  * Service Time on Invoice
          ENDIF
          GOTO      PRIA9999
.
PRIA1100  MOVE      ZERO,LNK2PRT * Table of Medical Practices
          CALL      PRITB000     
          GOTO      PRIA9999
.
PRIA1200  CALL      NEXTPR00     * Link to Next Set of Medical Details
          GOTO      PRIA9999
.
PRIA1300  CALL      PREVPR00     * Link to Prev Set of Medical Details
          GOTO      PRIA9999
.
PRIA1400  MATCH     SP70,PRPRPDOC
          IF        !@EQUAL
            WRITE     HTMLFILE;"1";
          ELSE
            WRITE     HTMLFILE;"0";
          ENDIF
          GOTO      PRIA9999
.
PRIA1500  MOVE      ONE,LNK2PRT  * Table of Medical Practices with 
          CALL      PRITB000     * UpdateParent()
          GOTO      PRIA9999
.
PRIA1600  MOVE      ZERO,LNK2PRT * Table of Medical Practices by desc
          CALL      PRITD000     
          GOTO      PRIA9999
.
PRIA1700  WRITE     HTMLFILE;PRPRRANG; * Spare Variable
          GOTO      PRIA9999
.
PRIA1800  WRITE     HTMLFILE;PRPRPMCI; * MCI
          GOTO      PRIA9999
.
PRIA1900  WRITE     HTMLFILE;PRPRPYEE; * Payee Provider Number
          GOTO      PRIA9999
.
PRIA2000  CALL      CHRF0000
          WRITE     HTMLFILE;F1;       * Med.practice with hoding items
          GOTO      PRIA9999
.
PRIA2100  CALL      REGLST00           * Register
          GOTO      PRIA9999
.
PRIA9999  RETURN
+
.--------------------------------------------------------------------
.         Check if there is any referral with holding items
.--------------------------------------------------------------------
CHRF0000  OPEN      PRIHREF4,"prihreff"          * Holding Referral file
          OPEN      PRIHTRA1,"prihtraf"          * Holding transaction file
          MOVE      ZERO,F1
          MOVE      "1",DIM1
          PACK      KEY28,DIM1,PRIPR001,SP70
          CALL      RSPRHR4
CHRF1000  CALL      RKPRHR4
          BRANCH    OVRCD,CHRF9999
.
          MATCH     DIM1,DPRHRPIN      * Same Invoice to be Print?
          GOTO      CHRF9999 IF NOT EQUAL
.
          MATCH     PRIPR001,PRHRPRAC  * Same Medical Practice?
          GOTO      CHRF9999 IF NOT EQUAL
.
          PACK      KEY62,PRHRUNIQ,PRHRPRAC,PRHRDOCT,PRHRPIND,SP30,SP30
          CALL      RSPRHT1                 * position on the transactions
          CALL      RKPRHT1                   holding file
          BRANCH    OVRCD,CHRF1000
.
          COMPARE   PRHTUNIQ,PRHRUNIQ       * see if we have the same unique
          GOTO      CHRF1000 IF NOT EQUAL     identifier
.
          MATCH     PRHTPRAC,PRHRPRAC       * same practice ?
          GOTO      CHRF1000 IF NOT EQUAL
.
          MATCH     PRHTDOCT,PRHRDOCT       * same service doctor ?
          GOTO      CHRF1000 IF NOT EQUAL
.
          MATCH     PRHTPIND,PRHRPIND       * same patient indicator?
          GOTO      CHRF1000 IF NOT EQUAL
.
          MOVE      ONE,F1
.
CHRF9999  RETURN
.-----------------------------------------------------------
. Option 2 - Medical Practice Doctors  
.-----------------------------------------------------------
PRID0000  BRANCH    FLDITMNO,PRID0100,PRID0200,PRID0300,PRID0400,PRID0500:
                             PRID0600,PRID0700,PRID0800,PRID0900,PRID1000:
                             PRID1100,PRID1200,PRID1300,PRID1400,PRID1500:
                             PRID1600,PRID1700,PRID1800,PRID1900,PRID2000:
                             PRID2100,PRID2200,PRID2300,PRID2400,PRID2500:
                             PRID2600,PRID2700
          GOTO      PRID9999
.
PRID0100  WRITE     HTMLFILE;PRDOPRAC;  * Medical Practice Code
          GOTO      PRID9999
.
PRID0200  PACK      GENPCODE,PRDODOCT,SP70 * Associated Doctor
          CALL      HCPDET00            * Get Doctor Details 
          GOTO      PRID9999
.
PRID0300  MOVE      "CL",CATEGORY       * Claim Code 
          MOVE      PRDOCLAM,CODE
          CALL      CODITM00
          GOTO      PRID9999
.
PRID0400  MOVE      "GI",CATEGORY       * Patient Indicator 
          MOVE      PRDOPIND,CODE 
          CALL      CODITM00
          GOTO      PRID9999
.
PRID0500  COMPARE   ZERO,PRDOCOMM
          GOTO      PRID9999 IF EQUAL
          WRITE     HTMLFILE;PRDOCOMM;  * Associated Doctor % Commission 
          GOTO      PRID9999
.
PRID0600  COMPARE   ZERO,PRDOFEEP
          GOTO      PRID9999 IF EQUAL
          WRITE     HTMLFILE;PRDOFEEP;  * % of Schedule Fee Charged       
          GOTO      PRID9999
.
PRID0700  COMPARE   ONE,PRDOSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"1";  * Assoc Doctor Status 1=Inact 0=Act
          ELSE
            WRITE     HTMLFILE;"0";
          ENDIF
          GOTO      PRID9999
.
PRID0800  MOVE      ZERO,LNK2PRT 
          CALL      PDCTB000     * Table of Medical Practice Doctors
          GOTO      PRID9999
.
PRID0900  CALL      NEXTPR00     * Link to Next Set of Medical Details
          GOTO      PRID9999
.
PRID1000  CALL      PREVPR00     * Link to Prev Set of Medical Details
          GOTO      PRID9999
.
PRID1100  CALL      SCHFEE00     * Display Table of Schedule Fee's 
          GOTO      PRID9999
.
PRID1200  COMPARE   ZERO,PRDOSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Active";  * Assoc Doctor Status 1=Inact 0=Act
          ELSE
            WRITE     HTMLFILE;"Inactive";
          ENDIF
          GOTO      PRID9999
.
PRID1300  CALL      LNKSER00     * Link for Redirect 
          GOTO      PRID9999
.
PRID1400  WRITE     HTMLFILE;PRIDC001;
          GOTO      PRID9999
.
PRID1500  WRITE     HTMLFILE;PRIDC002;
          GOTO      PRID9999
.
PRID1600  PACK      KEY10,PRIDC002,SP70
          CALL      RDPMHCP1
          IF        OVRCD = 0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            MOVE      DOCFNAME,DOCTOR
          ELSE
            MOVE      PRPRPDOC,DOCTOR
          ENDIF
          WRITE     HTMLFILE;DOCTOR;
          GOTO      PRID9999
.
PRID1700  CALL      NEXTPR00     * Link to Next Set of Sch.Fee Details
          GOTO      PRID9999
.
PRID1800  CALL      PREVPR00     * Link to Prev Set of Sch.Fee Details
          GOTO      PRID9999
.
PRID1900  WRITE     HTMLFILE;PRDOABNN;  * ABN Number
          GOTO      PRID9999
.
PRID2000  COMPARE   ONE,PRDOGSTR
          IF        @EQUAL
            WRITE     HTMLFILE;"1";  * GST Register
          ELSE
            WRITE     HTMLFILE;"0";
          ENDIF
          GOTO      PRID9999
.
PRID2100  COMPARE   ONE,PRDOGSTR
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";  * GST Register
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      PRID9999
.
PRID2200  MOVE      ONE,LNK2PRT   * Table Type : Update Parent
          CALL      PDCTS000      * Table of Medical Practice Doctors
          GOTO      PRID9999      * Active only
.
PRID2300  WRITE     HTMLFILE;PRDOPROV; * Provider Number
          GOTO      PRID9999
.
PRID2400  WRITE     HTMLFILE;FILTACTV; * Filter for Doctors in Medical Practice 
          GOTO      PRID9999
.
PRID2500  MOVE      TWO,LNK2PRT   * Table Type : Update Parent
          CALL      PDCTB000      * Table of Medical Practice Doctors/User Id
          GOTO      PRID9999      * Active only
.
PRID2600  WRITE     HTMLFILE;SELMPRAC;
          GOTO      PRID9999
.
PRID2700  CALL      STRTPR00     * Link to start Set of Medical Details
          GOTO      PRID9999
.
PRID9999  RETURN
.-------------------------------------------------------------------------------
. Option 5 - Private Practice All Security Access
.-------------------------------------------------------------------------------
PRAL0000  BRANCH    FLDITMNO,PRAL0100,PRAL0200,PRAL0300,PRAL0400
          GOTO      PRAL9999
.
PRAL0100  WRITE     HTMLFILE;PRALUSID;   * User ID  
          GOTO      PRAL9999
.
PRAL0200  CALL      ALSTB000     * Table of Practice Users (All Access)
          GOTO      PRAL9999
.
PRAL0300  CALL      NXTGRP00     * Link to Next Set of Codes
          GOTO      PRAL9999
.
PRAL0400  CALL      PRVGRP00     * Link to Prev Set of Codes
          GOTO      PRAL9999
.
PRAL9999  RETURN
.-------------------------------------------------------------------------------
. Option 6 - Private Practice User Security Access
.-------------------------------------------------------------------------------
PRSC0000  BRANCH    FLDITMNO,PRSC0100,PRSC0200,PRSC0300,PRSC0400,PRSC0500:
                             PRSC0600,PRSC0700,PRSC0800,PRSC0900,PRSC1000
          GOTO      PRSC9999
.
PRSC0100  WRITE     HTMLFILE;PRSEPRAC;   * Medical Practice
          GOTO      PRSC9999
.
PRSC0200  WRITE     HTMLFILE;PRSEUSID;   * User ID  
          GOTO      PRSC9999
.
PRSC0300  CALL      SECTB000     * Table of Practice Users  
          GOTO      PRSC9999
.
PRSC0400  CALL      NXTSEC00     * Link to Next Set of Codes
          GOTO      PRSC9999
.
PRSC0500  CALL      PRVSEC00     * Link to Prev Set of Codes
          GOTO      PRSC9999
.
PRSC0600  CALL      USRTB000     * Table of User Practices    
          GOTO      PRSC9999
.
PRSC0700  WRITE     HTMLFILE;WBSEUID;   * User ID  
          GOTO      PRSC9999
.
PRSC0800  WRITE     HTMLFILE;WBSENAM;   * User Name
          GOTO      PRSC9999
.
PRSC0900  CALL      NXTUSR00     * Link to Next Set of Codes
          GOTO      PRSC9999
.
PRSC1000  CALL      PRVUSR00     * Link to Prev Set of Codes
          GOTO      PRSC9999
.
PRSC9999  RETURN
.-----------------------------------------------------------
. Link to Next List Page 
.-----------------------------------------------------------
NXTGRP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
NXTGRP99  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PRVGRP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
PRVGRP99  RETURN
.-----------------------------------------------------------
. Link to Next List Page 
.-----------------------------------------------------------
NXTSEC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRIMPRAC
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&primprac=",PRIMPRAC;
.
          REP       "+ ",PRIMPRAC
.
NXTSEC99  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PRVSEC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRIMPRAC
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&primprac=",PRIMPRAC;
.
          REP       "+ ",PRIMPRAC
.
PRVSEC99  RETURN
.-----------------------------------------------------------
. Link to Next List Page 
.-----------------------------------------------------------
NXTUSR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRUSERID
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&updttype=S":
                                 "&pruserid=",PRUSERID;
.
          REP       "+ ",PRUSERID
.
NXTUSR99  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PRVUSR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRUSERID
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&updttype=S":
                                 "&pruserid=",PRUSERID;
.
          REP       "+ ",PRUSERID
.
PRVUSR99  RETURN
.------------------------------------------------------------
. Table of Private Practice All Security Users
.------------------------------------------------------------
ALSTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      ALSHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "16",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY10,SP70
          CALL      RSPRALS1
ALSTB100  CALL      RKPRALS1
          BRANCH    OVRCD,ALSTB999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ALSTB100
          ENDIF
.
          CALL      ALSRW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ALSTB100 IF NOT EQUAL
.
ALSTB999  RETURN
.------------------------------------------------------------
. Private Practice All Security Users (TABLE HEADING)
.------------------------------------------------------------
ALSHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "User ID</td>":
                               "<td class=HeadingCell width=25%>":
                               "Description</td>":
                             "</tr>"
.
ALSHD999  RETURN
.------------------------------------------------------------
. Private Practice All Security Users (TABLE ROW)
.------------------------------------------------------------
ALSRW000  PACK      KEY10,PRALUSID,SP70
          CALL      RDWBSE1
          IF        OVRCD = 1
            MOVE      "&nbsp;",WBSENAM
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"javascript:DeleteRecord":
                             "('",PRALUSID,"');#">":
                             "<img src=../images/DeleteIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PRALUSID,"</td>":
                             "<td>",WBSENAM,"</td>":
                             "</tr>"
.
ALSRW999 RETURN
.------------------------------------------------------------
. Table of Private Practice Security Users
.------------------------------------------------------------
SECTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      SECHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "16",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY16,PRIMPRAC,SP70
          CALL      RSPRSEC1
SECTB100  CALL      RKPRSEC1
          BRANCH    OVRCD,SECTB999
.
          MATCH     PRIMPRAC,PRSEPRAC     * Medical Practice
          GOTO      SECTB999 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SECTB100
          ENDIF
.
          CALL      SECRW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SECTB100 IF NOT EQUAL
.
SECTB999  RETURN
.------------------------------------------------------------
. Private Practice Security Users (TABLE HEADING)
.------------------------------------------------------------
SECHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "User ID</td>":
                               "<td class=HeadingCell width=25%>":
                               "Description</td>":
                             "</tr>"
.
SECHD999  RETURN
.------------------------------------------------------------
. Private Practice Security Users (TABLE ROW)
.------------------------------------------------------------
SECRW000  PACK      KEY10,PRSEUSID,SP70
          CALL      RDWBSE1
          IF        OVRCD = 1
            MOVE      "&nbsp;",WBSENAM
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"javascript:DeleteRecord":
                             "('",PRSEUSID,"');#">":
                             "<img src=../images/DeleteIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PRSEUSID,"</td>":
                             "<td>",WBSENAM,"</td>":
                             "</tr>"
.
SECRW999 RETURN
.------------------------------------------------------------
. Table of User Practices
.------------------------------------------------------------
USRTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      USRHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "16",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY16,PRUSERID,SP70
          CALL      RSPRSEC2
USRTB100  CALL      RKPRSEC2
          BRANCH    OVRCD,USRTB999
.
          MATCH     PRUSERID,PRSEUSID     * User ID          
          GOTO      USRTB999 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      USRTB100
          ENDIF
.
          CALL      USRRW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      USRTB100 IF NOT EQUAL
.
USRTB999  RETURN
.------------------------------------------------------------
. User Practices (TABLE HEADING)
.------------------------------------------------------------
USRHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Practice</td>":
                               "<td class=HeadingCell width=25%>":
                               "Description</td>":
                             "</tr>"
.
USRHD999  RETURN
.------------------------------------------------------------
. User Practice (TABLE ROW)
.------------------------------------------------------------
USRRW000  PACK      KEY6,PRSEPRAC,SP70
          CALL      RDPRPR1
          IF        OVRCD=1
            MOVE      "&nbsp;",PRPRDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"javascript:DeleteRecord":
                             "('",PRSEPRAC,"');#">":
                             "<img src=../images/DeleteIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PRSEPRAC,"</td>":
                             "<td>",PRPRDESC,"</td>":
                             "</tr>"
.
USRRW999 RETURN
.-----------------------------------------------------------
. Link to for Redirect 
.-----------------------------------------------------------
LNKSER00  UNPACK    DIM127,D1,KEY8,DIM127
          UNPACK    DIM127,D1,KEY2,DIM127
          UNPACK    DIM127,D1,FLDPARA,DIM127
          REP       " +",PRDOPRAC
          REP       " +",PRDODOCT
.
          WRITE     HTMLFILE;KEY8,".pbl?reportno=",KEY2:
                                 "&template=",FLDPARA:
                                 "&pridc001=",PRDOPRAC:
                                 "&pridc002=",PRDODOCT;
.
          REP       "+ ",PRDOPRAC
          REP       "+ ",PRDODOCT
.
LNKSER99  RETURN
+
.--------------------------------------------------------------------
.               SETFEE00
.         Save the schedule fees
.--------------------------------------------------------------------
SETFEE00  MOVE      ZERO,RCOUNT
          MOVE      ONE,F3       * Clear Episode of Care Comments Array
          WHILE     F3<=998
            PACK      PRDOCKEY[F3],SP70,SP70
            ADD       ONE,F3
          DO
.
          MOVE      ONE,F3       * Clear Schedule fees Array
          WHILE     F3<=998
            MOVE      ZERO,NEWFEE[F3]
            ADD       ONE,F3
          DO
.
          PACK      KEY5,CATCL,SP70              * Get "CL" category record
          CALL      RDCODE1
.
.         Read the next code on file for the category "CL"
.
SETFEE10  CALL      RDKCODE1                     * read next record
          BRANCH    OVRCD,SETFEE99               * end of file - finished
.
          MATCH     TCODE,CATCL                  * same category ?
          GOTO      SETFEE99 IF NOT EQUAL        * no - finished
.
          MOVE      ACODE,CODECL                 * save claim code
.
.         Get out each patient indicator code on file
. 
          PACK      KEY5,CATGI,SP70              * get "GI" category record
          CALL      RDCODE1
.
.         Read the next code on file for the category "GI"
.
SETFEE50  CALL      RDKCODE1                     * read next record
          BRANCH    OVRCD,SETFEE70               * end of file
.
          MATCH     TCODE,CATGI                  * same category ?
          GOTO      SETFEE70 IF NOT EQUAL        * no
.
          MOVE      ACODE,CODEGI                 * save code
.
.         Calls Display Row routine & writes record to html... 
.
          PACK      KEY22,PRIDC001,PRIDC002,CODECL,CODEGI,SP70 
          CALL      RDPRDO1
          IF        OVRCD = 1
            MOVE      "100.00",SCHDFEE     * Default Value
          ELSE
            MOVE       PRDOFEEP,SCHDFEE
          ENDIF 
          ADD       ONE,RCOUNT        * Set up CGI parameters
          MOVE      SCHDFEE,NEWFEE[RCOUNT]
.
          GOTO      SETFEE50
.
.         No more patient indicator codes on file, so get the next
.         claim code on file
.
SETFEE70  PACK      KEY5,CATCL,CODECL,SP70   * Read previous claim code again
          CALL      RDCODE1                       
          GOTO      SETFEE10
.
SETFEE99  RETURN
+
.--------------------------------------------------------------------
.                            SCHFEE00
. Display Routine - For each Claim Code (Category CL) on file, get out 
.                   each patient Indicator Code (Category GI) on file 
.                   and write a to HTML Display
.--------------------------------------------------------------------
SCHFEE00  IF        NORECORD=0
            MOVE      "8",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      ZERO,RCOUNT
          MOVE      ZERO,F3
          PACK      KEY5,CATCL,SP70              * Get "CL" category record
          CALL      RDCODE1
.
.         Read the next code on file for the category "CL"
.
SCHFEE10  CALL      RDKCODE1                     * read next record
          BRANCH    OVRCD,SCHFEE99               * end of file - finished
.
          MATCH     TCODE,CATCL                  * same category ?
          GOTO      SCHFEE99 IF NOT EQUAL        * no - finished
.
          MOVE      ACODE,CODECL                 * save claim code
.
.         Get out each patient indicator code on file
. 
          PACK      KEY5,CATGI,SP70              * get "GI" category record
          CALL      RDCODE1
.
.         Read the next code on file for the category "GI"
.
SCHFEE50  CALL      RDKCODE1                     * read next record
          BRANCH    OVRCD,SCHFEE70               * end of file
.
          MATCH     TCODE,CATGI                  * same category ?
          GOTO      SCHFEE70 IF NOT EQUAL        * no
.
          MOVE      ACODE,CODEGI                 * save code
.
          ADD       ONE,F3
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SCHFEE50
          ENDIF
.
.         Calls Display Row routine & writes record to html... 
.
          PACK      SKEY5,TCODE,ACODE
          CALL      DISCOM00        * Displays Table of Schedule Fee Rows
          MOVE      SKEY5,KEY5
          CALL      RDCODE1         * Reposition
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SCHFEE50 IF NOT EQUAL    * get next patient indicator code
          GOTO      SCHFEE99
.                                                
.         No more patient indicator codes on file, so get the next
.         claim code on file
.
SCHFEE70  PACK      KEY5,CATCL,CODECL,SP70   * Read previous claim code again
          CALL      RDCODE1                       
          GOTO      SCHFEE10
.
SCHFEE99  RETURN
.-----------------------------------------------------------
.                        DISCOM00
. Displays Claim Code & Patient Indicator Row
.-----------------------------------------------------------
DISCOM00  MOVE      "CL",CATEGORY     * Get Claim Code descirption
          MOVE      CODECL,CODE
          CALL      GETCOD00 
          MOVE      TDESC,KEY30
.
          MOVE      "GI",CATEGORY     * Get Patient Indicator Description
          MOVE      CODEGI,CODE
          CALL      GETCOD00 
.
          ADD       ONE,RCOUNT        * Set up CGI parameters
          MOVE      F3,KEY3
          REP       " 0",KEY3 
          MOVE      "percm",KEY5 
          PACK      KEY8,KEY5,KEY3 
.
          MOVE      "docrc",KEY5
          PACK      DOCTREC,KEY5,KEY3
          MOVE      ZERO,FORM3
          MOVE      KEY3,FORM3
. 
          PACK      KEY6,CODECL,CODEGI 
.
          WRITE     HTMLFILE;"<tr><td>",KEY30,"</td>":
                             "<td>",TDESC,"</td><td><input type=hidden name=":
                             DOCTREC," value=#"",KEY6,"#"><input ":
                          "type=text name=",KEY8," value=#"",NEWFEE[F3],"#"":
                          " size=5 maxlength=6 class=Number min=0 max=999.99":
                          " title=#"% of Schedule Fee Charged#">":
                             "</td></tr>"
.
DISCOM99  RETURN
.-----------------------------------------------------------
. Link to Next Group Lab Codes           
.-----------------------------------------------------------
NEXTPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",PRPRCODE
          REP       " +",PRDODOCT
          REP       " +",FILTACTV
          REP       " +",SELMPRAC
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pridc001=",PRPRCODE:
                                 "&pridc002=",PRDODOCT:
                                 "&selmprac=",SELMPRAC:
                                 "&filtactv=",FILTACTV;
.
          REP       "+ ",PRPRCODE
          REP       "+ ",PRDODOCT
          REP       "+ ",FILTACTV
          REP       "+ ",SELMPRAC
.
NEXTPR99  RETURN
.-----------------------------------------------------------
. Link to Prev Group Lab Codes           
.-----------------------------------------------------------
PREVPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",PRPRCODE
          REP       " +",PRDODOCT
          REP       " +",FILTACTV
          REP       " +",SELMPRAC
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pridc001=",PRPRCODE:
                                 "&pridc002=",PRDODOCT:
                                 "&selmprac=",SELMPRAC:
                                 "&filtactv=",FILTACTV;
.
          REP       "+ ",PRPRCODE
          REP       "+ ",PRDODOCT
          REP       "+ ",FILTACTV
          REP       "+ ",SELMPRAC
.
PREVPR99  RETURN
.
.-----------------------------------------------------------
. Link to start Group Lab Codes
.-----------------------------------------------------------
STRTPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",PRPRCODE
          REP       " +",PRDODOCT
          REP       " +",FILTACTV
          REP       " +",SELMPRAC
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pridc001=",PRPRCODE:
                                 "&pridc002=",PRDODOCT:
                                 "&selmprac=",SELMPRAC:
                                 "&filtactv=",FILTACTV;
.
          REP       "+ ",PRPRCODE
          REP       "+ ",PRDODOCT
          REP       "+ ",FILTACTV
          REP       "+ ",SELMPRAC
.
STRTPR99  RETURN
.
.------------------------------------------------------------
. Table of Medical Practices  
.------------------------------------------------------------
PRITB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PRHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP70
          CALL      RSPRPR1
          IF        OVRCD=0
            CALL      RPPRPR1
          ENDIF
PRITB100  CALL      RKPRPR1
          BRANCH    OVRCD,PRITB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PRITB100
          ENDIF
.
          CALL      PRARW000      * Display Medical Practice Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PRITB100 IF NOT EQUAL
          GOTO      PRITB999
.
PRITB900  CALL      NOMORE00      * Display No More Records Message
.
PRITB999  RETURN
.------------------------------------------------------------
. Medical Practice Table Details (TABLE HEADING)
.------------------------------------------------------------
PRHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "Practice Code</td>":
                               "<td class=HeadingCell width=30%>":
                               "Description</td>":
                               "<td class=HeadingCell width=30%>":
                               "Primary Doctor</td>":
                               "<td class=HeadingCell width=20%>":
                               "Fees Invoiced Reset Date</td>":
                             "</tr>"
.
PRHED999  RETURN
.------------------------------------------------------------
. Medical Practice Table (TABLE ROW)
.------------------------------------------------------------
PRARW000  PACK      KEY10,PRPRPDOC,SP70
          CALL      RDPMHCP1
          IF        OVRCD = 0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            MOVE      DOCFNAME,DOCTOR
          ELSE
            MOVE      PRPRPDOC,DOCTOR
          ENDIF
.
          MATCH     SP70,DOCTOR
          IF        @EQUAL
            MOVE      "&nbsp;   ",DOCTOR
          ENDIF
.
          MOVE      "&nbsp;      ",KEY12
          MATCH     SP70,PRPRRDAT
          IF        !@EQUAL
            UNPACK    PRPRRDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          BRANCH    LNK2PRT,PRARW010    
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pripr001=",PRPRCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PRPRCODE,"</td>":
                             "<td>",PRPRDESC,"</td><td>",DOCTOR,"</td>":
                             "<td>",KEY12,"</td>":
                             "</tr>"
.
          GOTO      PRARW999
.
PRARW010  MOVE      PRPRDESC,KEY30 
          REP       "' ",KEY30  * Get Rid of them as when present stuff up link
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><img src=../images/MaintenanceIcon.gif ":
                             " class=ListIcon onclick=#"UpdateParent('":
                             PRPRCODE,"','",KEY30,"');#">":
                             PRPRCODE,"</td>":
                             "<td>",PRPRDESC,"</td>":
                             "<td>",DOCTOR,"</td>":
                             "<td>",KEY12,"</td>":
                             "</tr>"
.
PRARW999 RETURN
.
.------------------------------------------------------------
. Table of Medical Practices by description
.------------------------------------------------------------
PRITD000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PRHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY36,STARTKEY,SP70
          CALL      RSPRPR2
          IF        OVRCD=0
            CALL      RPPRPR2
          ENDIF
PRITD100  CALL      RKPRPR2
          BRANCH    OVRCD,PRITD900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PRITD100
          ENDIF
.
          CALL      PRARW000      * Display Medical Practice Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PRITD100 IF NOT EQUAL
          GOTO      PRITD999
.
PRITD900  CALL      NOMORE00      * Display No More Records Message
.
PRITD999  RETURN
.------------------------------------------------------------
. Table of Medical Practice Doctors  
.------------------------------------------------------------
PDCTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DCHED000      * Output Table Heading
.
PDCTB020  IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      SP70,SAVEDOCT
.
          MOVE      ZERO,STARTFLG
          IF        LNK2PRT=2
            MATCH     SP70,SELMPRAC
            IF        @EQUAL
              MOVE      ONE,STARTFLG
              PACK      KEY22,SP70
              CALL      RSPRDO2
              GOTO      PDCTB100
            ENDIF
          ENDIF
.
          PACK      KEY22,PRIDC001,SP70
          CALL      RSPRDO1
PDCTB100  IF        STARTFLG=1
            CALL      RKPRDO2
          ELSE
            CALL      RKPRDO1
          ENDIF
          BRANCH    OVRCD,PDCTB900
.
          COMPARE   TWO,LNK2PRT
          GOTO      PDCTB110 IF NOT EQUAL
.
          MATCH     SP70,SELMPRAC
          GOTO      PDCTB120 IF EQUAL
.
          MATCH     SELMPRAC,PRDOPRAC
          GOTO      PDCTB900 IF NOT EQUAL
          GOTO      PDCTB120
.
PDCTB110  MATCH     PRIDC001,PRDOPRAC     * Medical Practice 
          GOTO      PDCTB900 IF NOT EQUAL
.
          IF        LNK2PRT=1
            BRANCH    PRDOSTAT,PDCTB100    * Inactive
          ENDIF
.
PDCTB120  IF        LNK2PRT=2
            MATCH     SP70,PRDODOCT
            GOTO      PDCTB100 IF EQUAL
          ENDIF
.
          MATCH     SP70,SAVEDOCT
          IF        @EQUAL 
            MOVE      PRDODOCT,SAVEDOCT   
          ELSE
            MATCH     SAVEDOCT,PRDODOCT     * Only want One Doctor Record!
            IF        @EQUAL             
              GOTO      PDCTB100
            ELSE
              MOVE      PRDODOCT,SAVEDOCT   
            ENDIF
          ENDIF
.
          COMPARE   TWO,LNK2PRT
          GOTO      PDCTB200 IF EQUAL     * Service HCP with User ID access
.
          MATCH     SP70,FILTACTV
          IF        !@EQUAL
            MATCH     "0",FILTACTV            * check if active is selected
            IF        @EQUAL
              COMPARE   "1",PRDOSTAT
              GOTO      PDCTB100 IF EQUAL     * ignore if inactive record
            ENDIF
.
            MATCH     "1",FILTACTV            * check if inactive is selected
            IF        @EQUAL
              COMPARE   "1",PRDOSTAT
              GOTO      PDCTB100 IF NOT EQUAL * ignore if active record
            ENDIF
          ENDIF
          GOTO      PDCTB800
.
.         Service doctor serarch for Invoice Pending List - check 
.         User Id Medical record access
.
PDCTB200  MOVE      WBSEUID,KEY10           * All medical practice access
          CALL      RDPRALS1
          COMPARE   ZERO,OVRCD
          GOTO      PDCTB800 IF EQUAL
.
          PACK      KEY16,KEY10,PRDOPRAC,SP70
          CALL      RDPRSEC2
          BRANCH    OVRCD,PDCTB100
.
PDCTB800  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PDCTB100
          ENDIF
.
          CALL      PDCRW000      * Display Doctors Table Details Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PDCTB100 IF NOT EQUAL
          GOTO      PDCTB999
.
PDCTB900  CALL      NOMORE00      * Display No More Records Message
.
PDCTB999  RETURN
.
.------------------------------------------------------------
. Table of Medical Practice Doctors - Search
.------------------------------------------------------------
PDCTS000  CALL      DCHED000      * Output Table Heading
.
PDCTS020  IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      SP70,SAVEDOCT
.
          PACK      KEY22,PRIDC001,SP70
          CALL      RSPRDO1
PDCTS100  CALL      RKPRDO1
          BRANCH    OVRCD,PDCTS900
.
PDCTS110  MATCH     PRIDC001,PRDOPRAC     * Medical Practice
          GOTO      PDCTS900 IF NOT EQUAL
.
PDCTS120  MATCH     SP70,SAVEDOCT
          IF        @EQUAL
            MOVE      PRDODOCT,SAVEDOCT
          ELSE
            MATCH     SAVEDOCT,PRDODOCT     * Only want One Doctor Record!
            IF        @EQUAL
              PACK      KEY22,PRIDC001,PRDODOCT,Z70
              CALL      RDPRDO1
              GOTO      PDCTS100
            ELSE
              MOVE      PRDODOCT,SAVEDOCT
            ENDIF
          ENDIF
.
.         BRANCH    PRDOSTAT,PDCTS100    * Inactive
PDCTS200  IF        PRDOSTAT = 1
            PACK      KEY22,PRIDC001,PRDODOCT,Z70
            CALL      RDPRDO1
            GOTO      PDCTS100
          ENDIF
.
PDCTS800  PACK      KEY22,PRIDC001,PRDODOCT,Z70
          CALL      RDPRDO1
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PDCTS100
          ENDIF
.
          CALL      PDCRW000      * Display Doctors Table Details Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PDCTS100 IF NOT EQUAL
          GOTO      PDCTS999
.
PDCTS900  CALL      NOMORE00      * Display No More Records Message
.
PDCTS999  RETURN
.
.------------------------------------------------------------
. Medical Practice Doctors Table Details (TABLE HEADING)
.------------------------------------------------------------
DCHED000  BRANCH    LNK2PRT,DCHED100:      * Update Parent
                            DCHED200       * from invoice pending list
.
          WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "Associated Doctor</td>":
                               "<td class=HeadingCell width=40%>":
                               "Doctor % Commission</td>":
                               "<td class=HeadingCell width=40%>":
                               "Doctor Status (Active)</td>":
                             "</tr>"
          GOTO      DCHED999
.
DCHED100  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "Doctor Code</td>":
                               "<td class=HeadingCell width=20%>":
                               "Name</td>":
                               "<td class=HeadingCell width=40%>":
                               "Doctor % Commission</td>":
                             "</tr>"
          GOTO      DCHED999
.
DCHED200  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "Doctor Code</td>":
                               "<td class=HeadingCell width=20%>":
                               "Name</td>":
                             "</tr>"
          GOTO      DCHED999
.
DCHED999  RETURN
.------------------------------------------------------------
. Medical Practice Doctors Table (TABLE ROW)
.------------------------------------------------------------
PDCRW000  PACK      KEY10,PRDODOCT,SP70   * Associated Doctor
          CALL      RDPMHCP1
          IF        OVRCD = 0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            MOVE      DOCFNAME,DOCTOR
          ELSE
            MOVE      PRDODOCT,DOCTOR
          ENDIF
.
          MOVE      SP70,SETFONT
          MOVE      SP70,ENDFONT
          PACK      KEY6,PRDOPRAC,SP70
          CALL      RDPRPR1 
          MATCH     PRDODOCT,PRPRPDOC 
          IF        @EQUAL
            MOVE      "<font color=#FF3118>",SETFONT
            MOVE      "</font>",ENDFONT
          ENDIF
.
          COMPARE   ZERO,PRDOCOMM
          IF        @EQUAL
            MOVE      "&nbsp;",KEY5
          ELSE
            MOVE      PRDOCOMM,KEY5
          ENDIF 
.
          COMPARE   ZERO,PRDOSTAT
          IF        @EQUAL
            MOVE      "Yes",KEY3
          ELSE
            MOVE      "No ",KEY3 
          ENDIF
.
          REP       "'`",DOCTOR
.
          BRANCH    LNK2PRT,PDCRW100:      * Update Parent
                            PDCRW200       * Service doct.search for Inv.Pending
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail02":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pridc001=",PRDOPRAC:
                             "&pridc002=",PRDODOCT:
                             "&pridc003=",PRDOCLAM:
                             "&pridc004=",PRDOPIND:
                             "#",#"",PRDOSTAT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             SETFONT,DOCTOR,ENDFONT,"</td>":
                             "<td>",KEY5,"</td><td>",KEY3,"</td>":
                             "</tr>"
         GOTO       PDCRW9999
.
PDCRW100  WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><img src=../images/MaintenanceIcon.gif ":
                             " class=ListIcon onclick=#"UpdateParent('":
                             PRDOPRAC,"','",PRDODOCT,"','",DOCTOR,"');#">":
                             PRDODOCT,"</td>":
                             "<td>",SETFONT,DOCTOR,ENDFONT,"</td>":
                             "<td>",KEY5,"</td>":
                             "</tr>"
         GOTO       PDCRW9999
.
PDCRW200 WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><img src=../images/MaintenanceIcon.gif ":
                             " class=ListIcon onclick=#"UpdateParent('":
                             PRDOPRAC,"','",PRDODOCT,"','",DOCTOR,"');#">":
                             PRDODOCT,"</td>":
                             "<td>",SETFONT,DOCTOR,ENDFONT,"</td>":
                             "</tr>"
         GOTO       PDCRW9999
.
PDCRW999 RETURN
.-----------------------------------------------------------
. Option 3 - G/L Ledger interface income percentage
.-----------------------------------------------------------
PRPC0000  BRANCH    FLDITMNO,PRPC0100,PRPC0200,PRPC0300,PRPC0400,PRPC0500:
                             PRPC0600,PRPC0700,PRPC0800,PRPC0900,PRPC1000:
                             PRPC1100,PRPC1200,PRPC1300,PRPC1400,PRPC1500:
                             PRPC1600,PRPC1700,PRPC1800,PRPC1900,PRPC2000
          GOTO      PRPC9999
.
PRPC0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PRPC0110
.
          MATCH     "1",PRIPC001
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",PRIPC001," selected>":
                               PRIPCITM,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ONE,">":
                               PRIPCITM,"</option>"
          ENDIF
.
          MATCH     "2",PRIPC001
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",PRIPC001," selected>":
                               PRIPCJOR,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",TWO,">":
                               PRIPCJOR,"</option>"
          ENDIF
          GOTO      PRPC9999
.
PRPC0110  WRITE     HTMLFILE;PRPCFTYP;  * Financial Type
          GOTO      PRPC9999
.
PRPC0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PRPC0210
.
          WRITE     HTMLFILE;PRPCDOCT;  * Doctor code
          GOTO      PRPC9999
.
PRPC0210  PACK      KEY10,PRPCDOCT,SP70
          CALL      RDPMHCP1
          IF        OVRCD = 0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            WRITE     HTMLFILE;DOCFNAME;
          ENDIF
          GOTO      PRPC9999
.
PRPC0300  WRITE     HTMLFILE;PRPCFLAG;  * Item Flag
          GOTO      PRPC9999
.
PRPC0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PRPC0410,PRPC0420
.
          WRITE     HTMLFILE;PRPCITMN;   * Item Code
          GOTO      PRPC9999
.
PRPC0410  WRITE     HTMLFILE;PRPCSUBN;   * Sub Item Code
          GOTO      PRPC9999
.
PRPC0420  PACK      KEY22,PRPCFLAG,PRPCITMN,PRPCSUBN,Z70
          CALL      RSPRIT1
          CALL      RPPRIT1
          BRANCH    OVRCD,PRPC9999
.
          PACK      KEY14,PRITFLAG,PRITITMN,PRITSUBN,SP20
.
          MATCH     KEY14,KEY22
          GOTO      PRPC9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;PRITDESC;  * Item Description
          GOTO      PRPC9999
.
PRPC0500  CALL      DCTSRC00            * Doctor CGI Vars 
          GOTO      PROFLD99
.
PRPC0600  MOVE      "PP",CATEGORY
          MOVE      PRPCPORT,CODE       * Allocation type
          CALL      CODITM00
          GOTO      PRPC9999
.
PRPC0700  WRITE     HTMLFILE;PRPCPCEN;  * Percentage
          GOTO      PRPC9999
.
PRPC0800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          IF        F1=0
            WRITE     HTMLFILE;PRPCDSEC;  * Dissection
          ELSE
            PACK      KEY5,PRPCDSEC
            CALL      RDFMDS1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMDSDESC;  * Dissection
            ENDIF
          ENDIF
          GOTO      PRPC9999
.
.         Responsibility
.
PRPC0900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PRPC0980
.
          PACK      KEY4,SP70
          CALL      RSFMRS1
PRPC0910  CALL      RKFMRS1
          BRANCH    OVRCD,PRPC9999
.
          MATCH     PRPCRESP,FMRSCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMRSCODE," selected>":
                               FMRSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMRSCODE,">":
                               FMRSDESC,"</option>"
          ENDIF
          GOTO      PRPC0910
.
PRPC0980  WRITE     HTMLFILE;PRPCRESP;
          GOTO      PRPC9999
.
.         Ledger
.
PRPC1000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PRPC1020
.
          PACK      KEY2,SP70
          CALL      RSFMLA1
PRPC1010  CALL      RKFMLA1
          BRANCH    OVRCD,PRPC9999
.
          MATCH     PRPCLEDG,FMLALEDG
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMLALEDG," selected>":
                               FMLADESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMLALEDG,">":
                               FMLADESC,"</option>"
          ENDIF
          GOTO      PRPC1010
.
PRPC1020  WRITE     HTMLFILE;PRPCLEDG;
          GOTO      PRPC9999
.
PRPC1100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          IF        F1=0
            WRITE     HTMLFILE;PRPCCRAC;  * Credit account
          ELSE
            PACK      KEY14,PRPCLEDG,PRPCCRAC
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Credit account
            ENDIF
          ENDIF
          GOTO      PRPC9999
.
PRPC1200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          IF        F1=0
            WRITE     HTMLFILE;PRPCDBAC;  * Debtor account
          ELSE
            PACK      KEY14,PRPCLEDG,PRPCDBAC
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Debtor account
            ENDIF
          ENDIF
          GOTO      PRPC9999
.
PRPC1300  CALL      DITMB000      * Display the MBS items for a doctor
          GOTO      PRPC9999
.
PRPC1400  CALL      NEXTPC00      * Link to Next Group
          GOTO      PRPC9999
.
PRPC1500  CALL      PREVPC00      * Link to Last Group
          GOTO      PRPC9999
.
PRPC1600  CALL      DISS0000       * dissection
          GOTO      PROFLD99
.
PRPC1700  CALL      LEDG0000       * ledger
          GOTO      PROFLD99
.
PRPC1800  MOVE      "J",CATEGORY
          MOVE      PRPCFLAG,CODE
          CALL      CODITM00
          GOTO      PRPC9999
.
PRPC1900  MATCH     SP70,PRIPC003
          GOTO      PRPC9999 IF EQUAL 
          WRITE     HTMLFILE;PRIPC003;  * Item Flag
          GOTO      PRPC9999
.
PRPC2000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PRPC2010,PRPC2020
.
          MATCH     SP70,PRIPC004
          GOTO      PRPC9999 IF EQUAL
          WRITE     HTMLFILE;PRIPC004;   * Item Code
          GOTO      PRPC9999
.
PRPC2010  MATCH     SP70,PRIPC005
          GOTO      PRPC9999 IF EQUAL
          WRITE     HTMLFILE;PRIPC005;   * Sub Item Code
          GOTO      PRPC9999
.
PRPC2020  PACK      KEY22,PRIPC003,PRIPC004,PRIPC005,Z70
          CALL      RSPRIT1
          CALL      RPPRIT1
          BRANCH    OVRCD,PRPC9999
.
          PACK      KEY14,PRITFLAG,PRITITMN,PRITSUBN,SP20
.
          MATCH     KEY14,KEY22
          GOTO      PRPC9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;PRITDESC;  * Item Description
          GOTO      PRPC9999
.
PRPC9999  RETURN
.------------------------------------------------------------
.  * Doctor CGI Vars
.------------------------------------------------------------
DCTSRC00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,DCTSRC10
.
          WRITE     HTMLFILE;PRIPC002;  * Doctor code
          GOTO      DCTSRC99
.
DCTSRC10  PACK      KEY10,PRIPC002,SP70
          CALL      RDPMHCP1
          IF        OVRCD = 0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            WRITE     HTMLFILE;DOCFNAME;
          ENDIF
.
DCTSRC99  RETURN
.------------------------------------------------------------
. Table of G/L interface
.------------------------------------------------------------
DITMB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DGHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,PRIPC002   * Any search criteria entered?
          IF        @EQUAL
            MATCH     SP70,PRIPC004
            GOTO      DITMB999 IF EQUAL
          ENDIF
.
          PACK      KEY31,PRIPC001,PRIPC002,PRIPC003,SP70
          CALL      RSPRPCE1
DITMB100  CALL      RKPRPCE1
          BRANCH    OVRCD,DITMB900
.
          UNPACK    PRPCFCOD,PRPCFLAG,PRPCITMN,PRPCSUBN
.
          MATCH     SP70,PRIPC001
          IF        !@EQUAL
            MATCH     PRIPC001,PRPCFTYP     * Financial type   
            GOTO      DITMB100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PRIPC002
          IF        !@EQUAL
            MATCH     PRIPC002,PRPCDOCT     * Doctor code
            GOTO      DITMB100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PRIPC003
          IF        !@EQUAL
            MATCH     PRIPC003,PRPCFLAG     * flag 
            GOTO      DITMB100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PRIPC004
          IF        !@EQUAL
            MATCH     PRIPC004,PRPCITMN     * item code
            GOTO      DITMB100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PRIPC005
          IF        !@EQUAL
            MATCH     PRIPC005,PRPCSUBN     * Sub item code
            GOTO      DITMB100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DITMB100
          ENDIF
.
          CALL      PGLTB000      * Display G/L Interface Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DITMB100 IF NOT EQUAL
          GOTO      DITMB999
.
DITMB900  CALL      NOMORE00      * Display No More Records Message
.
DITMB999  RETURN
.------------------------------------------------------------
. Medical Practice Doctors Table Details (TABLE HEADING)
.------------------------------------------------------------
DGHED000  MATCH     "2",PRIPC001
          IF        !@EQUAL
            WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Doctor</td>":
                               "<td class=HeadingCell width=5%>":
                               "Item Flag</td>":
                               "<td class=HeadingCell width=10%>":
                               "Item Number</td>":
                               "<td class=HeadingCell width=20%>":
                               "Allocation Type</td>":
                               "<td class=HeadingCell width=10%>":
                               "Percentage</td>":
                               "<td class=HeadingCell width=10%>":
                               "Dissection</td>":
                               "<td class=HeadingCell width=10%>":
                               "Responsibility</td>":
                               "<td class=HeadingCell width=10%>":
                               "Ledger</td>":
                               "<td class=HeadingCell width=30%>":
                               "Credit Account</td>":
                               "<td class=HeadingCell width=30%>":
                               "Debit Account</td>":
                             "</tr>"
          ELSE
            WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "Journal Code</td>":
                               "<td class=HeadingCell width=20%>":
                               "Allocation Type</td>":
                               "<td class=HeadingCell width=20%>":
                               "Percentage</td>":
                               "<td class=HeadingCell width=20%>":
                               "Dissection</td>":
                               "<td class=HeadingCell width=20%>":
                               "Responsibility</td>":
                               "<td class=HeadingCell width=20%>":
                               "Ledger</td>":
                               "<td class=HeadingCell width=20%>":
                               "Credit Account</td>":
                               "<td class=HeadingCell width=20%>":
                               "Debit Account</td>":
                             "</tr>"
          ENDIF
.
DGHED999  RETURN
.------------------------------------------------------------
. G/L interface Table (TABLE ROW)
.------------------------------------------------------------
PGLTB000  UNPACK    PRPCFCOD,PRPCFLAG,PRPCITMN,PRPCSUBN
          MOVE      MBS,KEY3
          MATCH     " 1",PRPCFLAG
          IF        @EQUAL
            MOVE      AMA,KEY3
          ENDIF
.
          MOVE      SP20,TDESC
          MATCH     "2",PRPCFTYP
          IF        @EQUAL
            PACK      KEY5,ANSJ,SP1,PRPCFLAG,SP70
            CALL      RDCODE1
            MOVE      TDESC,KEY20
          ENDIF
.
          PACK      KEY5,ANSP,ANSP,PRPCPORT
          CALL      RDCODE1
.
          PACK      KEY10,PRPCDOCT,SP70
          CALL      RDPMHCP1
          IF        OVRCD = 0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            MOVE      DOCFNAME,DOCTOR
          ELSE
            MOVE      PRPCDOCT,DOCTOR
          ENDIF
.
          MATCH     "2",PRIPC001
          IF        !@EQUAL
           WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail03":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pripc001=",PRPCFTYP:
                             "&pripc002=",PRPCDOCT:
                             "&pripc003=",PRPCFLAG:
                             "&pripc004=",PRPCITMN:
                             "&pripc005=",PRPCSUBN:
                             "&pripc006=",PRPCPORT:
                             "&pripc007=",PRPCPCEN,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             DOCTOR,"</td>";
.
           MATCH    SP9,PRPCITMN 
           IF       !@EQUAL
             WRITE    HTMLFILE;"<td>",KEY3,"</td>":
                               "<td>",PRPCITMN;
.
             MATCH    SP2,PRPCSUBN
             IF       !@EQUAL
               WRITE    HTMLFILE;"/",PRPCSUBN,"</td>";
             ELSE
               WRITE    HTMLFILE;PRPCSUBN,"</td>";
             ENDIF
           ELSE
             WRITE    HTMLFILE;"<td>","&nbsp;</td>":
                               "<td>","&nbsp;</td>";
           ENDIF
.
           WRITE     HTMLFILE;"<td>",TDESC,"</td>":
                             "<td>",PRPCPCEN,"&nbsp;</td>":
                             "<td>",PRPCDSEC,"&nbsp;</td>":
                             "<td>",PRPCRESP,"&nbsp;</td>":
                             "<td>",PRPCLEDG,"&nbsp;</td>":
                             "<td>",PRPCCRAC,"&nbsp;</td>":
                             "<td>",PRPCDBAC,"&nbsp;</td>":
                             "</tr>"
          ELSE
           WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail03":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pripc001=",PRPCFTYP:
                             "&pripc002=",PRPCDOCT:
                             "&pripc003=",PRPCFLAG:
                             "&pripc006=",PRPCPORT:
                             "&pripc007=",PRPCPCEN,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY20,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",PRPCPCEN,"&nbsp;</td>":
                             "<td>",PRPCDSEC,"&nbsp;</td>":
                             "<td>",PRPCRESP,"&nbsp;</td>":
                             "<td>",PRPCLEDG,"&nbsp;</td>":
                             "<td>",PRPCCRAC,"&nbsp;</td>":
                             "<td>",PRPCDBAC,"&nbsp;</td>":
                             "</tr>"
          ENDIF
.
PGLTB999 RETURN
.-----------------------------------------------------------
. Link to Next Codes           
.-----------------------------------------------------------
NEXTPC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pripc001=",PRIPC001:
                                 "&pripc002=",PRIPC002:
                                 "&pripc003=",PRIPC003:
                                 "&pripc004=",PRIPC004:
                                 "&pripc005=",PRIPC005;
.
NEXTPC99  RETURN
.-----------------------------------------------------------
. Link to Prev Codes           
.-----------------------------------------------------------
PREVPC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pripc001=",PRIPC001:
                                 "&pripc002=",PRIPC002:
                                 "&pripc003=",PRIPC003:
                                 "&pripc004=",PRIPC004:
                                 "&pripc005=",PRIPC005;
.
PREVPC99  RETURN
.-------------------------------------------------
. Dissections               
.-------------------------------------------------
DISS0000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,DISS2000
.
          PACK      KEY5,SP10
          CALL      RSFMDS1
DISS1000  CALL      RKFMDS1
          BRANCH    OVRCD,DISS9999
          MATCH     FMDSCODE,PRPCDSEC
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",FMDSCODE,"#" selected> ":
                               FMDSCODE,": ",FMDSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",FMDSCODE,"#"> ":
                               FMDSCODE,": ",FMDSDESC,"</option>"
          ENDIF
          GOTO      DISS1000
.
DISS2000  WRITE     HTMLFILE;PRPCDSEC;
          GOTO      DISS9999
.
DISS9999  RETURN
.-------------------------------------------------
. Ledger
.-------------------------------------------------
LEDG0000  PACK      KEY2,SP10
          CALL      RSFMLA1
LEDG1000  CALL      RKFMLA1
          BRANCH    OVRCD,LEDG9999
          MATCH     FMLALEDG,PRPCLEDG
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",FMLALEDG,"#" selected> ":
                               FMLALEDG,": ",FMLADESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",FMLALEDG,"#"> ":
                               FMLALEDG,": ",FMLADESC,"</option>"
          ENDIF
          GOTO      LEDG1000
.
LEDG9999  RETURN
.
.-------------------------------------------------
. Format Doctors Given Name 
.-------------------------------------------------
DOCGIV00  CMATCH    SP1,NAME35               * Remove Leading Blanks
          IF        @EQUAL
            BUMP      NAME35
            GOTO      DOCGIV00 IF NOT EOS
            GOTO      DOCGIV99               * entire name if blank
          ENDIF
          PACK      KEY35,NAME35,SP30        * reset form pointer
          MOVE      KEY35,NAME35
.
          SCAN      SP1,NAME35             * Locate the blank
          GOTO      DOCGIV20 IF NOT EQUAL
          BUMP      NAME35,-1              * go back 1 to end of name
          MOVEFPTR  NAME35,CCITEM          * another handly form field
          RESET     NAME35                 * reset the form pointer
          SETLPTR   NAME35,CCITEM          * set logical length to end of name
.
.         Save this name
.
          UNPACK    NAME35,KEY1,KEY50
          REP       DOWNCASE,KEY50
          APPEND    KEY1,DISPNAME
          STRIP     KEY50
          APPEND    KEY50,DISPNAME
          APPEND    SP1,DISPNAME
.
.         Check for any more names
.
          SETLPTR   NAME35,35              * reset logical length
          ADD       ONE,CCITEM             * position of 1st blank
          RESET     NAME35,CCITEM          * reset to this point
          PACK      KEY35,NAME35,SP70      * reset form pointer
          MOVE      KEY35,NAME35

DOCGIV10  CMATCH    SP1,NAME35               * Remove Leading Blanks
          IF        @EQUAL
            BUMP      NAME35
            GOTO      DOCGIV10 IF NOT EOS
            GOTO      DOCGIV99               * entire name if blank
          ENDIF
          PACK      KEY35,NAME35,SP30        * reset form pointer
          MOVE      KEY35,NAME35
.
          SCAN      SP1,NAME35             * Locate the blank
          GOTO      DOCGIV20 IF NOT EQUAL
          BUMP      NAME35,-1              * go back 1 to end of name
          MOVEFPTR  NAME35,CCITEM          * another handly form field
          RESET     NAME35                 * reset the form pointer
          SETLPTR   NAME35,CCITEM          * set logical length to end of name
.
.         Save this Initial
.
          UNPACK    NAME35,KEY1,KEY50
          APPEND    KEY1,DISPNAME
          APPEND    SP1,DISPNAME
.
          GOTO      DOCGIV99
.
.         Rest of the string is one name
.
DOCGIV20  UNPACK    NAME35,KEY1,KEY50
          REP       DOWNCASE,KEY50
          APPEND    KEY1,DISPNAME
          STRIP     KEY50
          APPEND    KEY50,DISPNAME
          APPEND    SP1,DISPNAME
.
DOCGIV99  RETURN
.------------------------------------------------------------
. Patient Search
.------------------------------------------------------------
DEBS0000  BRANCH    FLDITMNO,DEBS0100,DEBS0200,DEBS0300,DEBS0400,DEBS0500:
                             DEBS0600,DEBS0700,DEBS0800
          GOTO      DEBS9999
.
DEBS0100  CALL      NEXT0000
          GOTO      DEBS9999
.
DEBS0200  CALL      LAST0000
          GOTO      DEBS9999
.
DEBS0300  MATCH     SP70,SRCHSNAM
          GOTO      DEBS9999 IF EQUAL
          STRIP     SRCHSNAM
          MOVELPTR  SRCHSNAM,LENGTH
          COMPARE   ZERO,LENGTH
          GOTO      DEBS9999 IF EQUAL
          SFORMAT   VAR,LENGTH
          MOVE      SRCHSNAM,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      DEBS9999
.
DEBS0400  MATCH     SP70,SRCHGNAM
          GOTO      DEBS9999 IF EQUAL
          STRIP     SRCHGNAM
          MOVELPTR  SRCHGNAM,LENGTH
          COMPARE   ZERO,LENGTH
          GOTO      DEBS9999 IF EQUAL
          SFORMAT   VAR,LENGTH
          MOVE      SRCHGNAM,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      DEBS9999
.
DEBS0500  MATCH     SP70,SRCHTYPE
          GOTO      DEBS9999 IF EQUAL
          WRITE     HTMLFILE;SRCHTYPE;
          GOTO      DEBS9999
.
. Private Practice Debtor Search
.
DEBS0600  MOVE      SRCHTYPE,F1
...          PERFORM   F1,DEBPP000,DUMMY000
          GOTO      DEBS9999
.
. Account Receivable Debtor Search
.
DEBS0700  MOVE      SRCHTYPE,F1
          PERFORM   F1,DEBAR000,DUMMY000,DEBAK000
          GOTO      DEBS9999
.
DEBS0800  MATCH     SP70,KEYWORDS
          GOTO      DEBS9999 IF EQUAL
.
          STRIP     KEYWORDS
          MOVELPTR  KEYWORDS,LENGTH
.
          COMPARE   ZERO,LENGTH
          GOTO      DEBS9999 IF EQUAL
.
          SFORMAT   VAR,LENGTH
          MOVE      KEYWORDS,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      DEBS9999
.
DEBS9999  RETURN
+
.------------------------------------------------------------
. Private Practice Debtor Search                 
.------------------------------------------------------------
..DEBPP000  PACK      PRDBSNAM,SRCHSNAM,SP70
..          PACK      PRDBGNAM,SRCHGNAM,SP70
.
..          CALL      DEBHD000
.
..          IF        NORECORD=0
..            MOVE      "10",NORECORD       * Set Default No Records to Display
..          ENDIF
..          MOVE      ZERO,RECNUMB
..          MOVE      ZERO,DISNUMB
.
..
..          PACK      KEY53,PRDBSNAM,PRDBGNAM,SP70
..          CALL      RSPRDB2                      * position in file using
.                                                * surname/given name
..DEBPP100  CALL      RKPRDB2                      * read next record
..          BRANCH    OVRCD,DEBPP910
.
..          MATCH     PRDBSNAM,SRCHSNAM            * same surname ?
..          GOTO      DEBPP910 IF NOT EQUAL        * no
.
..          MATCH     SP14,SRCHGNAM                * given name entered ?
..          GOTO      DEBPP200 IF EOS              * no
..          GOTO      DEBPP200 IF EQUAL            * no
.
..          MATCH     PRDBGNAM,SRCHGNAM            * surname matches ?
..          GOTO      DEBPP100 IF NOT EQUAL        * no - get next record
.
..DEBPP200  ADD       ONE,RECNUMB
..          IF        STARTNUM>=RECNUMB
..            GOTO      DEBPP100
..          ENDIF
.
..          CALL      DEBRW000      
..          ADD       ONE,DISNUMB
..          COMPARE   NORECORD,DISNUMB
..          GOTO      DEBPP100 IF NOT EQUAL
.
..DEBPP900  WRITE     HTMLFILE;"</table>"
..          WRITE     HTMLFILE;"</div>"
..          GOTO      DEBPP999
.
..DEBPP910  WRITE     HTMLFILE;"</table>"
..          WRITE     HTMLFILE;"<p align=center><b>End of Search</b>"
..          WRITE     HTMLFILE;"</div>"
.
..DEBPP999  RETURN
+
.------------------------------------------------------------
. Debtor Search Heading                  
.------------------------------------------------------------
DEBHD000 WRITE      HTMLFILE;"<div id=HeadingDivision >"
         WRITE      HTMLFILE;"<table width=100% border=1 cellspacing=0 ":
                             "cellpadding=1 style=#"table-layout: fixed;#">"
.
         WRITE      HTMLFILE;"<tr><td class=HeadingCell>":
                             "Patient</td>":
                             "<td class=HeadingCell>Debtor Number</td></tr>"
         WRITE      HTMLFILE;"</table>"
         WRITE      HTMLFILE;"</div>"

         WRITE      HTMLFILE;"<div id=BodyDivision style=#"height:250;#">"
         WRITE      HTMLFILE;"<table width=100% border=1 cellspacing=0 ":
                             "cellpadding=1 style=#"table-layout: fixed;#">"
.
DEBHD999  RETURN
+
.------------------------------------------------------------
. Debtor Search Table Row               
.------------------------------------------------------------
..DEBRW000  MOVE      PRDBSNAM,PSNAME
..          MOVE      PRDBGNAM,PGNAME
..          MOVE      PRDBTITL,PTITL
.
..          WRITE     HTMLFILE;"<tr valign=top><td>":
..                              "<table><tr valign=top><td>";
.
..TABROW20  REP       "+ ",PRDBDEBT
..          CALL      JAVNAM00
..          WRITE     HTMLFILE;"<a href='javascript:updateParent(#"",JAVFNAME:
..                              "#",#"",PRDBDEBT,"#");'>"
.
..          PACK      DISPNAME,SP70
..          CLEAR     DISPNAME
..          MOVE      PRDBADD1,NAME35
..          CALL      NAMSTR00
..          MATCH     SP70,PRDBADD2
..          IF        !@EQUAL
..            MOVE      PRDBADD2,NAME35
..            CALL      NAMSTR00
..          ENDIF
..          MATCH     SP70,PRDBADD3
..          IF        !@EQUAL
..            MOVE      PRDBADD3,NAME35
..            CALL      NAMSTR00
..          ENDIF
..          MATCH     SP70,PRDBPOST
..          IF        !@EQUAL
..            MOVE      PRDBPOST,NAME35
..            CALL      NAMSTR00
..          ENDIF
..          RESET     DISPNAME
.
..          MOVE      DISPNAME,FADDRESS
.
..          WRITE     HTMLFILE;"<img src=../images/PatientFolder010.gif":
..                             " class=Icon></a>":
..                             "</td><td>";
.
..          CLEAR     DISPNAME
..          APPEND    "<b>",DISPNAME
..          APPEND    PRDBSNAM,DISPNAME
..          APPEND    "</b>",DISPNAME
..          MOVE      PRDBGNAM,NAME35
..          CALL      NAMSTR00
..          APPEND    SP70,DISPNAME
..          RESET     DISPNAME
..          WRITE     HTMLFILE;DISPNAME;
.
..          WRITE     HTMLFILE;"<br>",FADDRESS,"</td>";
..          WRITE     HTMLFILE;"</td></tr></table>";
..          WRITE     HTMLFILE;"<td><b>",PRDBDEBT,"</b></td>";
..          WRITE     HTMLFILE;"</tr>";
..
..DEBRW999  RETURN
+
.------------------------------------------------------------
. Format Patient Name (for Javascript)  <b>SURNAME</b>Title Given Names
.*** format the surname and given name by changing any ' to %60
.------------------------------------------------------------
JAVNAM00  CLEAR     DISPNAME
          MOVE      SP70,JAVFNAME
.
          MOVE      PSNAME,JAVSNAME          * surname
          SCAN      "'",JAVSNAME             * find any apostrophies
          GOTO      JAVNAM10 IF NOT EQUAL
.
          MOVE      JAVSNAME,ENDNAME
          REP       "' ",ENDNAME             * remove the apostrophy
.
          LENSET    JAVSNAME
          RESET     JAVSNAME                 * get all characters before '
          MOVE      JAVSNAME,STRTNAME
.
          REP       "'%",STRTNAME
          STRIP     STRTNAME
          PACK      JAVSNAME,STRTNAME,SIXTY,ENDNAME,SP70 * formatted surname
.
JAVNAM10  MOVE      SP70,STRTNAME
          MOVE      SP70,ENDNAME
.
          MOVE      PGNAME,JAVGNAME     * given name
          SCAN      "'",JAVGNAME        * find any apostrophies
          GOTO      JAVNAM20 IF NOT EQUAL
.
          MOVE      JAVGNAME,ENDNAME    * store all chars after apostrophy
          REP       "' ",ENDNAME        * remove the apostrophy
.
          LENSET    JAVGNAME
          RESET     JAVGNAME
          MOVE      JAVGNAME,STRTNAME   * store all chars before the '
.
          REP       "'%",STRTNAME
          STRIP     STRTNAME
          PACK      JAVGNAME,STRTNAME,SIXTY,ENDNAME,SP70  * formatted given name
.
JAVNAM20  REP       "#" ",JAVSNAME        * format the name for display
          REP       "#" ",JAVGNAME
          MOVE      SP70,JAVFNAME
          REP       UPPLOW,JAVSNAME
          PACK      NAME35,PTITL,SP70
          CALL      NAMSTR00
          PACK      NAME35,JAVGNAME,SP70
          CALL      NAMSTR00
          PACK      NAME35,JAVGNAME,SP70
          REP       UPPLOW,JAVSNAME
          APPEND    JAVSNAME,DISPNAME
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,JAVFNAME
          STRIP     JAVFNAME
.
JAVNAM99  RETURN
.------------------------------------------------------------
. Format Patient Name in Title Text
.------------------------------------------------------------
PATNAA00  CLEAR     DISPNAME
          MOVE      SP70,PATFNAME
          PACK      NAME35,PTITL,SP70
          CALL      NAMSTR00
          PACK      NAME35,PGNAME,SP70
          CALL      NAMSTR00
          PACK      NAME35,PSNAME,SP70
          REP       UPPLOW,PSNAME
          APPEND    PSNAME,DISPNAME
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,PATFNAME
          STRIP     PATFNAME
          RETURN
.------------------------------------------------------------
. U/R Search Should Not Happen Here
.------------------------------------------------------------
DUMMY000  RETURN
.------------------------------------------------------------
. Link to Next Group
.------------------------------------------------------------
NEXT0000  CALL      SETLNK00  * Set up Link
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          WRITE     HTMLFILE;"priweb01.pbl?reportno=4":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 HTMLLINK;
          RETURN
.------------------------------------------------------------
. Link to Last Group
.------------------------------------------------------------
LAST0000  CALL      SETLNK00  * Set up Link
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          WRITE     HTMLFILE;"priweb01.pbl?reportno=4":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 HTMLLINK;
          RETURN
.------------------------------------------------------------
. Setup Link Detail
.------------------------------------------------------------
SETLNK00  CLEAR     HTMLLINK
          MATCH     SP70,SRCHSNAM
          IF        !@EQUAL
            APPEND    "&srchsnam=",HTMLLINK
            REP       "'~",SRCHSNAM
            STRIP     SRCHSNAM
            APPEND    SRCHSNAM,HTMLLINK
            REP       "~'",SRCHSNAM
          ENDIF
          MATCH     SP70,SRCHGNAM
          IF        !@EQUAL
            APPEND    "&srchgnam=",HTMLLINK
            STRIP     SRCHGNAM
            APPEND    SRCHGNAM,HTMLLINK
          ENDIF
          MATCH     SP70,SRCHTYPE
          IF        !@EQUAL
            APPEND    "&srchtype=",HTMLLINK
            STRIP     SRCHTYPE
            APPEND    SRCHTYPE,HTMLLINK
          ENDIF
.
          MATCH     SP70,KEYWORDS
          IF        !@EQUAL
            APPEND    "&keywords=",HTMLLINK
            REP       "'~",KEYWORDS
            REP       " +",KEYWORDS
            STRIP     KEYWORDS
            APPEND    KEYWORDS,HTMLLINK
            REP       "~'",KEYWORDS
            REP       "+ ",KEYWORDS
          ENDIF
.
          RESET     HTMLLINK
          RETURN

.------------------------------------------------------------
.  Account Receivable Debtor Search                 
.------------------------------------------------------------
DEBAR000  PACK      DBDBNA1,SRCHSNAM,SP70
.
          CALL      DEBHD000
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.

          PACK      KEY43,DBDBNA1,SP70
          CALL      RSDBDB2                      * position in file using
.                                                * surname/given name
DEBAR100  CALL      RKDBDB2                      * read next record
          BRANCH    OVRCD,DEBAR910
.
          MATCH     DBDBNA1,SRCHSNAM            * same surname ?
          GOTO      DEBAR910 IF NOT EQUAL        * no
.
..          MATCH     SP14,SRCHGNAM                * given name entered ?
..          GOTO      DEBAR200 IF EOS              * no
..          GOTO      DEBAR200 IF EQUAL            * no
.
..          MATCH     DBDBNA2,SRCHGNAM            * surname matches ?
..          GOTO      DEBAR100 IF NOT EQUAL        * no - get next record
.
DEBAR200  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DEBAR100
          ENDIF
.
          CALL      DARRW000               
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DEBAR100 IF NOT EQUAL
.
DEBAR900  WRITE     HTMLFILE;"</table>"
          WRITE     HTMLFILE;"</div>"
          GOTO      DEBAR999
.
DEBAR910  WRITE     HTMLFILE;"</table>"
          WRITE     HTMLFILE;"<p align=center><b>End of Search</b>"
          WRITE     HTMLFILE;"</div>"
.
DEBAR999  RETURN
+
.------------------------------------------------------------
.  Keyword Account Receivable Debtor Search 
.------------------------------------------------------------
DEBAK000  PACK      DBDBNA1,KEYWORDS,SP70
.
          CALL      DEBHD000
.
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          mOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY23,KEYWRD01,SP70
          CALL      RSDBDK2                      * position in file using
DEBAK100  CALL      RKDBDK2                      * read next record
          BRANCH    OVRCD,DEBAK910
.
          PACK      KEY8,DBDKDEB,SP70
          CALL      RDDBDB1
          BRANCH    OVRCD,DEBAK100
.
          CALL      DEBAKK00
          BRANCH    OVRCD,DEBAK100,DEBAK900
.
DEBAK200  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DEBAK100
          ENDIF
.
          CALL      DARRW000
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DEBAK100 IF NOT EQUAL
.
DEBAK900  WRITE     HTMLFILE;"</table>"
          WRITE     HTMLFILE;"</div>"
          GOTO      DEBAK999
.
DEBAK910  WRITE     HTMLFILE;"</table>"
          WRITE     HTMLFILE;"<p align=center><b>End of Search</b>"
          WRITE     HTMLFILE;"</div>"
.
DEBAK999  RETURN
+
.------------------------------------------------------------
. Check Record
.------------------------------------------------------------
DEBAKK00  MATCH     KEYWRD01,DBDKKWD
          GOTO      DEBAKK92 IF NOT EQUAL
.
          IF        KEYWRDNO>1
            PACK      SAVKEY23,DBDKKWD,DBDKDEB,SP70
            CALL      DEBAKC00
            BRANCH    EXIT,DEBAKK91
.
            MOVE      SAVKEY23,KEY23
            CALL      RSDBDK2
          ENDIF
.
DEBAKK90  MOVE      ZERO,OVRCD
          GOTO      DEBAKK99
.
DEBAKK91  MOVE      ONE,OVRCD
          GOTO      DEBAKK99
.
DEBAKK92  MOVE      TWO,OVRCD
DEBAKK99  RETURN
+
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
DEBAKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY8,DBDKDEB,SP70
.
DEBAKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      DEBAKC99 IF EQUAL     * Exit OK
.
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
.
          PACK      KEY23,SAVKEY8,KEYWRDXX
          CALL      RDDBDK1               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      DEBAKC10 IF EQUAL
.
          CALL      RKDBDK1               * Not Exact so Read Next Record
          BRANCH    OVRCD,DEBAKC90        * No Match So Exit No Match
.
          MATCH     SAVKEY8,DBDKDEB       * Match Key Fields
          GOTO      DEBAKC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     DBDKKWD,KEYWRDXX      * Check Key Word
          GOTO      DEBAKC90 IF NOT EQUAL * No Match So Exit
.
          GOTO      DEBAKC10              * Check Next Search Word
.
DEBAKC90  MOVE      ONE,EXIT
.
DEBAKC99  RETURN
+
.------------------------------------------------------------
. Debtor Search Table Row               
.------------------------------------------------------------
DARRW000  MOVE      DBDBNA1,PSNAME
          MOVE      DBDBNA2,PGNAME
          MOVE      SP10,PTITL
.
          WRITE     HTMLFILE;"<tr valign=top><td>":
                              "<table><tr valign=top><td>";
.
          REP       "+ ",DBDBDEB
...          CALL      JAVNAM00
          WRITE     HTMLFILE;"<a href='javascript:updateParent(#"",DBDBNA1:
                              "#",#"",DBDBDEB,"#");'>"
.
          PACK      DISPNAME,SP70
          CLEAR     DISPNAME
          MOVE      DBDBAD1,NAME35
          CALL      NAMSTR00
          MATCH     SP70,DBDBAD2
          IF        !@EQUAL
            MOVE      DBDBAD2,NAME35
            CALL      NAMSTR00
          ENDIF
          MATCH     SP70,DBDBAD3
          IF        !@EQUAL
            MOVE      DBDBAD3,NAME35
            CALL      NAMSTR00
          ENDIF
          MATCH     SP70,DBDBAD4
          IF        !@EQUAL
            MOVE      DBDBAD4,NAME35
            CALL      NAMSTR00
          ENDIF
          MATCH     SP70,DBDBPC
          IF        !@EQUAL
            MOVE      DBDBPC,NAME35
            CALL      NAMSTR00
          ENDIF
          RESET     DISPNAME
.
          MOVE      DISPNAME,FADDRESS
.
          WRITE     HTMLFILE;"<img src=../images/PatientFolder010.gif":
                             " class=Icon></a>":
                             "</td><td>";
.
          CLEAR     DISPNAME
          APPEND    "<b>",DISPNAME
          APPEND    DBDBNA1,DISPNAME
          APPEND    "</b>",DISPNAME
          MOVE      DBDBNA2,NAME35
          CALL      NAMSTR00
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          WRITE     HTMLFILE;DISPNAME;
.
          WRITE     HTMLFILE;"<br>",FADDRESS,"</td>";
          WRITE     HTMLFILE;"</td></tr></table>";
          WRITE     HTMLFILE;"<td><b>",DBDBDEB,"</b></td>";
          WRITE     HTMLFILE;"</tr>";

DARRW999  RETURN
+
.------------------------------------------------------------------------------
. GLIN0000 - General Ledger Inferface Maintenance
.------------------------------------------------------------------------------
GLIN0000  BRANCH    FLDITMNO,GLIN0100,GLIN0200,GLIN0300,GLIN0400,GLIN0500:
                             GLIN0600,GLIN0700,GLIN0800,GLIN0900,GLIN1000:
                             GLIN1100,GLIN1200,GLIN1300,GLIN1400,GLIN1500:
                             GLIN1600,GLIN1700,GLIN1800,GLIN1900,GlIN2000:
                             GLIN2100,GLIN2200,GLIN2300,GLIN2400,GLIN2500:
                             GLIN2600,GLIN2700,GLIN2800,GLIN2900,GLIN3000
.
          GOTO      GLIN9999
.
.   Report Sub Section - Misc Items/Journals
.
GLIN0100  WRITE     HTMLFILE;PRFMSUB;
          GOTO      GLIN9999
.
.   Report Sub Section Code
.
GLIN0200  WRITE     HTMLFILE;PRFMCOD;
          GOTO      GLIN9999
.
.   Fees Invoiced Dissection Selection List
.
GLIN0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN0310
          WRITE     HTMLFILE;PRFMIDI;
          GOTO      GLIN9999
.
GLIN0310  PACK      KEY5,SP10
          CALL      RSFMDS1
GLIN0320  CALL      RKFMDS1
          BRANCH    OVRCD,GLIN9999
          MATCH     FMDSCODE,PRFMIDI
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",FMDSCODE,"#" selected> ":
                               FMDSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",FMDSCODE,"#"> ":
                               FMDSDESC,"</option>"
          ENDIF
          GOTO      GLIN0320
.
.   Fees Invoiced Responsibility Selection List
.
GLIN0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN0410
          WRITE     HTMLFILE;PRFMIRE;
          GOTO      GLIN9999
.
GLIN0410  PACK      KEY4,SP70
          CALL      RSFMRS1
GLIN0420  CALL      RKFMRS1
          BRANCH    OVRCD,GLIN9999
.
          MATCH     FMRSCODE,PRFMIRE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMRSCODE," selected>":
                               FMRSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMRSCODE,">":
                               FMRSDESC,"</option>"
          ENDIF
          GOTO      GLIN0420
.
.   Fees Invoiced Ledger Selection List
.
GLIN0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN0510
          WRITE     HTMLFILE;PRFMILD;
          GOTO      GLIN9999
.
GLIN0510  PACK      KEY2,SP70
          CALL      RSFMLA1
GLIN0520  CALL      RKFMLA1
          BRANCH    OVRCD,GLIN9999
.
          MATCH     FMLALEDG,PRFMILD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMLALEDG," selected>":
                               FMLADESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMLALEDG,">":
                               FMLADESC,"</option>"
          ENDIF
          GOTO      GLIN0520
.
.   Fees Invoiced Credit Account/Income Account
.
GLIN0600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     PRFMICA,SP20
          GOTO      GLIN9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;PRFMICA;  * Credit account
          ELSE
            PACK      KEY14,PRFMILD,PRFMICA,SP70
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Credit account
            ENDIF
          ENDIF
          GOTO      GLIN9999
.
.   Fees Invoiced Debit Account/Debtors Control Account
.
GLIN0700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          CALL      GSTACC00
          MATCH     PRFMIDA,SP20
          GOTO      GLIN9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;PRFMIDA;  * Debtor account
          ELSE
            PACK      KEY14,PRFMILD,PRFMIDA,SP70
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Debtor account
            ENDIF
          ENDIF
          GOTO      GLIN9999
.
.   Fees Invoiced GST Control Account
.
GLIN0800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          CALL      GSTACC00
          MATCH     PRFMIGS,SP20
          GOTO      GLIN9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;PRFMIGS;
          ELSE
            PACK      KEY14,PRFMILD,PRFMIGS,SP70
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Debtor account
            ENDIF
          ENDIF
          GOTO      GLIN9999
.
.   Fees Invoiced BAS Code
.
GLIN0900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1

          COMPARE   ONE,IBCNUBAS
          GOTO      GLIN9999 IF NOT EQUAL
.
          BRANCH    F1,GLIN0910
          WRITE     HTMLFILE;PRFMBASC;
          GOTO      GLIN9999
.
GLIN0910  PACK      KEY3,SP70
          CALL      RSIBBA1
GLIN0920  CALL      RKIBBA1
          BRANCH    OVRCD,GLIN9999
          COMPARE   IBBAACTV,ONE                 *List only active bas codes
          GOTO      GLIN0920 IF EQUAL
.
          PACK      KEY5,QUOTE,IBBABASC,QUOTE
          MATCH     IBBABASC,PRFMBASC
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5,"selected>",IBBADESC:
                               "</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",IBBADESC:
                               "</option>";
          ENDIF
          GOTO      GLIN0920
.
.   Fees to be Invoiced Dissection Selection List
.
GLIN1000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN1010
          WRITE     HTMLFILE;PRFMTDI;
          GOTO      GLIN9999
.
GLIN1010  PACK      KEY5,SP10
          CALL      RSFMDS1
GLIN1020  CALL      RKFMDS1
          BRANCH    OVRCD,GLIN9999
          MATCH     FMDSCODE,PRFMTDI
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",FMDSCODE,"#" selected> ":
                               FMDSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",FMDSCODE,"#"> ":
                               FMDSDESC,"</option>"
          ENDIF
          GOTO      GLIN1020
.
.   Fees to be Invoiced Responsibility Selection List
.
GLIN1100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN1110
          WRITE     HTMLFILE;PRFMTRE;
          GOTO      GLIN9999
.
GLIN1110  PACK      KEY4,SP70
          CALL      RSFMRS1
GLIN1120  CALL      RKFMRS1
          BRANCH    OVRCD,GLIN9999
.
          MATCH     FMRSCODE,PRFMTRE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMRSCODE," selected>":
                               FMRSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMRSCODE,">":
                               FMRSDESC,"</option>"
          ENDIF
          GOTO      GLIN1120
.
.   Fees to be Invoiced Ledger Selection List
.
GLIN1200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN1210
          WRITE     HTMLFILE;PRFMTLD;
          GOTO      GLIN9999
.
GLIN1210  PACK      KEY2,SP70
          CALL      RSFMLA1
GLIN1220  CALL      RKFMLA1
          BRANCH    OVRCD,GLIN9999
.
          MATCH     FMLALEDG,PRFMTLD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMLALEDG," selected>":
                               FMLADESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMLALEDG,">":
                               FMLADESC,"</option>"
          ENDIF
          GOTO      GLIN1220
.
.   Fees to be Invoiced Credit Account
.
GLIN1300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     PRFMTCA,SP20
          GOTO      GLIN9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;PRFMTCA;  * Credit account
          ELSE
            PACK      KEY14,PRFMTLD,PRFMTCA
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Credit account
            ENDIF
          ENDIF
          GOTO      GLIN9999
.
.   Fees to be Invoiced Debit Account
.
GLIN1400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     PRFMTDA,SP20
          GOTO      GLIN9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;PRFMTDA;
          ELSE
            PACK      KEY14,PRFMTLD,PRFMTDA
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Credit account
            ENDIF
          ENDIF
          GOTO      GLIN9999
.
GLIN1500  MOVE      CODEJ,CATEGORY            * Journal Code
          MOVE      JOURNALC,CODE
          CALL      CODITM00
          GOTO      GLIN9999
.
GLIN1600  WRITE     HTMLFILE;IBCNUGST;
          GOTO      GLIN9999
.
GLIN1700  WRITE     HTMLFILE;IBCNUBAS;
          GOTO      GLIN9999
.
GLIN1800  WRITE     HTMLFILE;PRGLI001;
          GOTO      GLIN9999
.
GLIN1900  WRITE     HTMLFILE;PRGLI002;
          GOTO      GLIN9999
.
GLIN2000  MATCH     "1",NEWRECRD
          GOTO      GLIN2010 IF EQUAL
.
          WRITE     HTMLFILE;ZERO;            * record found
          GOTO      GLIN9999
.
GLIN2010  WRITE     HTMLFILE;ONE;             * record not found
          GOTO      GLIN9999
.
GLIN2100  CALL      DISACC00
          GOTO      GLIN9999
.
GLIN2200  CALL      NXTACC00
          GOTO      GLIN9999
.
GLIN2300  CALL      PRVACC00
          GOTO      GLIN9999
.
GLIN2400  WRITE     HTMLFILE;SUBSECTN;
          GOTO      GLIN9999
.
GLIN2500  MOVE      CODEPG,CATEGORY            * Group Code
          MOVE      GROUPCOD,CODE
          CALL      CODITM00
          GOTO      GLIN9999
.
GLIN2600  COMPARE   THREE,PRGLI001
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * journal codes
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN2690 IF EQUAL
.
          UNPACK    PRGLI002,JOURNALC,KEY15
          MATCH     JOURNALC,SP2
          GOTO      GLIN2690 IF EQUAL
.
          PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          BRANCH    OVRCD,GLIN2690
          CMATCH    ANSG,THCSCOD
          GOTO      GLIN2690 IF NOT EQUAL
          WRITE     HTMLFILE;ONE;
          GOTO      GLIN9999
.
GLIN2690  WRITE     HTMLFILE;ZERO;
          GOTO      GLIN9999
.
GLIN2700  COMPARE   THREE,PRGLI001              * Journal
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * Journal codes
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
.
          UNPACK    PRGLI002,JOURNALC,KEY15
          MATCH     SP3,JOURNALC
          GOTO      GLIN9999 IF EQUAL
          PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,JOURNALC,INVALIDE,SP70
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      GLIN9999
.
GLIN2800  COMPARE   ONE,PRGLI001              * Item
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * Group code
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
.
          UNPACK    PRGLI002,GROUPCOD,KEY14
          MATCH     SP20,KEY14
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     GROUPCOD,SP3
          GOTO      GLIN9999 IF EQUAL
.
          PACK      KEY5,CODEPG,GROUPCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,GROUPCOD,INVALIDE,SP70
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      GLIN9999
.
GLIN2900  COMPARE   ONE,PRGLI001              * Item
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "3",SUBSECTN              * Item code
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
.
          MOVE      PRGLI002,PRITDESC
          UNPACK    PRGLI002,PRITSETC,KEY2,ITEMNUMB,ISUBNUMB
          MOVE      KEY2,ITEMFLAG
.
          MATCH     SP9,ITEMNUMB
          IF        !@EQUAL
            CALL      CHKITM00
            IF        EXIT=1
              PACK      PRITDESC,INVALIDS,ITEMFLAG,COMMA,ITEMNUMB:
                                 COMMA,ISUBNUMB,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE       HTMLFILE;PRITDESC;
          GOTO        GLIN9999
.
GLIN3000  WRITE     HTMLFILE;PTCNUFMS;
          GOTO      GLIN9999
.
GLIN9999  RETURN
+
.******************************************************************************
.* GSTACC00 - Get Debtors & GST control details                              *
.******************************************************************************
GSTACC00  COMPARE   TWO,IBCNUGST             * Aust GST
          GOTO      GSTACC99 IF NOT EQUAL
          COMPARE   THREE,PRFMSUB            * Journal ?
          GOTO      GSTACC99 IF EQUAL
          COMPARE   ONE,PTCNUFMS             * FMS System
          GOTO      GSTACC99 IF NOT EQUAL
.
          MOVE      PRFMILD,KEY2
          CALL      RDFMLA1
          BRANCH    OVRCD,GSTACC99
.
          MOVE      FMLADEB,FMCSDEB
          MOVE      FMLAAGST,FMCSAGST
          PACK      KEY14,PRFMILD,PRFMICA    * ledger,income
          CALL      RDFMCS1
          MATCH     SP70,FMCSDEB
          IF        @EQUAL
            MOVE      FMLADEB,PRFMIDA        * Debit account/Debtor account
          ELSE
            MOVE      FMCSDEB,PRFMIDA        * Debit account/Debtor account
          ENDIF
          MATCH     SP70,FMCSAGST
          IF        @EQUAL
            MOVE      FMLAAGST,PRFMIGS       * GST Control
          ELSE
            MOVE      FMCSAGST,PRFMIGS       * GST Control
          ENDIF
.
GSTACC99  RETURN
+
.------------------------------------------------------------
. Display GL Maintanence List
.------------------------------------------------------------
DISACC00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        PTCNUFMS=0 | PTCNUFMS=2
            MOVE      "003",LINKTEM       * template without validation
          ENDIF
.
DISACC05  CALL      DGLHD000              * Finance Letter List Table Heading
.
          IF        NORECORD=0
            MOVE      "14",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY18,PRGLI001,STARTKEY,SP70
DISACC06  CALL      RSPRFM1
          IF        OVRCD=0
            CALL      RPPRFM1 
          ENDIF
DISACC10  CALL      RKPRFM1
          BRANCH    OVRCD,DISACC99
.
          COMPARE   PRGLI001,PRFMSUB
          GOTO      DISACC99 IF NOT EQUAL
.
          MATCH     SP20,PRFMCOD              * skip Default
          GOTO      DISACC10 IF EQUAL
          GOTO      DISACC30
.
DISACC30  MATCH     PRFMILD,SP2
          IF        @EQUAL
            MOVE      NBSP,LEDDESC1
            GOTO      DISACC40
          ELSE
            PACK    LEDDESC1,PRFMILD,SP70
          ENDIF
.
          MATCH     "002",LINKTEM         * template with field validation
          IF        @EQUAL
            PACK      KEY2,PRFMILD,SP10
            CALL      RDFMLA1
            IF        OVRCD=0
              PACK    LEDDESC1,FMLADESC,SP70
            ENDIF
          ENDIF
.
DISACC40  COMPARE   THREE,PRFMSUB               * Journals
          GOTO      DISACC80 IF EQUAL
.
          MATCH     PRFMTLD,SP2
          IF        @EQUAL
            MOVE      NBSP,LEDDESC2
            GOTO      DISACC80
          ELSE
            PACK    LEDDESC2,PRFMTLD,SP70
          ENDIF
.
          MATCH     "002",LINKTEM         * template with field validation
          IF        @EQUAL
            PACK      KEY2,PRFMTLD,SP10
            CALL      RDFMLA1
            IF        OVRCD=0
              PACK    LEDDESC2,FMLADESC,SP70
            ENDIF
          ENDIF
.
DISACC80  CALL      DGLRW000
          BRANCH    NOTSHOWN,DISACC10
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DISACC10 IF NOT EQUAL
          GOTO      DISACC99
.
DISACC90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
DISACC99  RETURN
.------------------------------------------------------------
.  Table GL Maintenance (TABLE HEADING)
.------------------------------------------------------------
DGLHD000  COMPARE   ONE,PRGLI001            * Item
          GOTO      DGLHD100 IF EQUAL
          COMPARE   THREE,PRGLI001            * Journal
          GOTO      DGLHD300 IF EQUAL
          GOTO      DGLHD999
.
.         Misc Item
.
DGLHD100  CMATCH    "2",SUBSECTN            * Group Codes
          GOTO      DGLHD110 IF EQUAL
          CMATCH    "3",SUBSECTN            * Item Codes
          GOTO      DGLHD120 IF EQUAL
          GOTO      DGLHD999
.
DGLHD110  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Group Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
DGLHD120  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Group Code</td>":
                       "<td class=HeadingCell>Item Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
.         Journals
.
DGLHD300  CMATCH    "2",SUBSECTN            * Journal Codes
          GOTO      DGLHD310 IF EQUAL
          GOTO      DGLHD999
.
DGLHD310  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Journal Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
DGLHD999  RETURN
.------------------------------------------------------------
.  Table GL Maintenance (TABLE ROWS)
.------------------------------------------------------------
.
DGLRW000  MOVE      ONE,NOTSHOWN              * Set record not shown = true
.
          COMPARE   ONE,PRGLI001              * Items
          GOTO      DGLRW100 IF EQUAL
          COMPARE   THREE,PRGLI001            * Journals
          GOTO      DGLRW300 IF EQUAL
          GOTO      DGLRW999
.
.         Items
.
DGLRW100  CMATCH    "2",SUBSECTN            * Group Codes
          GOTO      DGLRW110 IF EQUAL
          CMATCH    "3",SUBSECTN            * Item Codes
          GOTO      DGLRW120 IF EQUAL
          GOTO      DGLRW999
.
.         Item - Group Codes
.
DGLRW110  UNPACK    PRFMCOD,GROUPCOD,KEY14
          MATCH     KEY14,SP20
          GOTO      DGLRW999 IF NOT EQUAL         * Eliminate incorrect data
          MATCH     GROUPCOD,SP3
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
.
          PACK      KEY5,CODEPG,GROUPCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,GROUPCOD,INVALIDE,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DGLRW999
          ENDIF
.
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&prgli001=",PRFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&prgli002=",PRFMCOD,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          MOVE      ZERO,NOTSHOWN              * Set record not shown = false;
          GOTO      DGLRW999
.
.         Item - Item codes
.
DGLRW120  UNPACK    PRFMCOD,PRITSETC,KEY2,ITEMNUMB,ISUBNUMB * Item codes
          MATCH     PRITSETC,SP3
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
          MATCH     ITEMNUMB,SP9
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
.
          TYPE      KEY2
          GOTO      DGLRW999 IF NOT EQUAL           * Invalid field
.
          MOVE      KEY2,ITEMFLAG
          MOVE      "MBS",KEY3
          IF        ITEMFLAG=1
            MOVE      "AMA",KEY3
          ENDIF
.
          PACK      SETCODD,SP70
          PACK      KEY5,CODEPG,PRITSETC,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      SETCODD,INVALIDS,PRITSETC,INVALIDE,SP70
          ELSE
            MOVE      TDESC,SETCODD
          ENDIF
.
          MOVE      SP10,KEY10
          MATCH     SP10,ISUBNUMB
          IF        !@EQUAL
            PACK      KEY10,OBRACKET,ISUBNUMB,CBRACKET,SP70
          ENDIF
.
          PACK      TDESC,KEY3,SP1,ITEMNUMB,KEY10,SP70
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DGLRW999
          ENDIF
.
          WRITE     HTMLFILE;"<td>",SETCODD,"</td>":
                             "<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&prgli001=",PRFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&prgli002=",PRFMCOD,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          MOVE      ZERO,NOTSHOWN              * Set record not shown = false;
          GOTO      DGLRW999
.
.         Journals
.
DGLRW300  CMATCH    "2",SUBSECTN            * Journal Codes
          GOTO      DGLRW310 IF EQUAL
          GOTO      DGLRW999
.
DGLRW310  UNPACK    PRFMCOD,JOURNALC,KEY15
          MATCH     JOURNALC,SP2
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
          MATCH     KEY15,SP20
          GOTO      DGLRW999 IF NOT EQUAL           * eliminate incorrect data
.
          PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,JOURNALC,INVALIDE,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DGLRW999
          ENDIF
.
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&prgli001=",PRFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&prgli002=",PRFMCOD,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "</tr>";
          MOVE      ZERO,NOTSHOWN              * Set record not shown = false;
          GOTO      DGLRW999
.
DGLRW999  RETURN
+
.-----------------------------------------------------------
. Link to Next GL Interface
.-----------------------------------------------------------
NXTACC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prgli001=",PRGLI001:
                                 "&startkey=",STARTKEY:
                                 "&subsectn=",SUBSECTN;
.
          REP       "+ ",PRGLI002
.
NXTACC99  RETURN
.-------------------------------------------------------------
. Link to Prev GL Interface
.-------------------------------------------------------------
PRVACC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prgli001=",PRGLI001:
                                 "&startkey=",STARTKEY:
                                 "&subsectn=",SUBSECTN;
.
          REP       "+ ",PRGLI002
.
PRVACC99  RETURN
.
.---------------------------------------------------------------------
. Medical Practice Batch Number : Display,Add,Update,Delete
.---------------------------------------------------------------------
PRIBAT00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PRIBAT50 IF EQUAL
.
          MATCH     ANSU,UPDTTYPE
          GOTO      PRIBAT20 IF EQUAL
.
          GOTO      PRIBAT91
.
.         ************ UPDATE FORMACTION **********
.
PRIBAT20  PACK      KEY33,HICBC001,HICBC002,HICBC003,HICBC004,SP70 
          CALL      RDHCBCN1
          BRANCH    OVRCD,PRIBAT93
.
          MATCH     Z70,HICBC005
          IF        !@EQUAL
            MOVE      HICBC005,HCBCBCNT     * Batch count
          ENDIF
.
          MATCH     Z70,HICBC006
          IF        !@EQUAL
            MOVE      HICBC006,HCBCSTAT     * Batch status
          ENDIF
.
          CALL      UPHCBCN1
.
          MOVE      ZERO,EXIT
          GOTO      PRIBAT99
.
.         ************ DISPLAY FORMACTION **********
.
PRIBAT50  PACK      KEY6,MEDIPRAC,SP70  * Read Medical Practice Record
          CALL      RDPRPR1
          BRANCH    OVRCD,PRIBAT92
.
          PACK      KEY33,HICBC001,HICBC002,HICBC003,HICBC004,SP70
          CALL      RDHCBCN1
          IF        OVRCD=1
            CALL      CLHICB00
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Batch Numbers",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRIBAT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRIBAT99
.
PRIBAT91  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIBAT99
.
PRIBAT92  MOVE      "Invalid Medical Practice.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIBAT99
.
PRIBAT93  MOVE      "Invalid Medical Practice Batch Range.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIBAT99
.
PRIBAT99  RETURN
.
.-----------------------------------------------------------
. General tags for batch range listing
.-----------------------------------------------------------
HCBC0000  BRANCH    FLDITMNO,HCBC0100,HCBC0200,HCBC0300,HCBC0400,HCBC0500:
                             HCBC0600,HCBC0700,HCBC0800,HCBC0900,HCBC1000
          GOTO      HCBC9999
.
HCBC0100  WRITE     HTMLFILE;HCBCPMCI;  * MCI (3 Alpha 5 Numeric)
          GOTO      HCBC9999
.
HCBC0200  WRITE     HTMLFILE;HCBCPYEE;  * Payee Provider Number
          GOTO      HCBC9999
.
HCBC0300  WRITE     HTMLFILE;HCBCPSRV;  * Service Provider Number
          GOTO      HCBC9999
.
HCBC0400  WRITE     HTMLFILE;HCBCBTCH;  * Batch Number (1 Alpha 4 Numeric)
          GOTO      HCBC9999
.
HCBC0500  WRITE     HTMLFILE;HCBCBCNT;  * Batch Counter        
          GOTO      HCBC9999
.
HCBC0600  WRITE     HTMLFILE;HCBCSTAT;  * Batch Number Status   
          GOTO      HCBC9999
.
HCBC0700  CALL      NEXTBA00     * Link to Next Set of Batch Numbers
          GOTO      HCBC9999
.
HCBC0800  CALL      PREVBA00     * Link to Prev Set of Batch Numbers
          GOTO      HCBC9999
.
HCBC0900  CALL      MEDBAT00     * List medical practice batch ranges
          GOTO      HCBC9999
.
HCBC1000  WRITE     HTMLFILE;MEDIPRAC;  * Medical practice      
          GOTO      HCBC9999
.
HCBC9999  RETURN
.
.-----------------------------------------------------------
. Link to Next Group Lab Codes
.-----------------------------------------------------------
NEXTBA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",MEDIPRAC
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&mediprac=",MEDIPRAC;
.
          REP       "+ ",MEDIPRAC
.
NEXTBA99  RETURN
.-----------------------------------------------------------
. Link to Prev Group Lab Codes
.-----------------------------------------------------------
PREVBA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",MEDIPRAC
.
          WRITE     HTMLFILE;"priweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&mediprac=",MEDIPRAC;
.
          REP       "+ ",MEDIPRAC
.
PREVBA99  RETURN
.
.
.------------------------------------------------------------
. Table of a Medical Practices Batch Range
.------------------------------------------------------------
MEDBAT00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      MPHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,MEDIPRAC,SP70
          CALL      RDPRPR1
          BRANCH    OVRCD,MEDBAT99    
.
          PACK      KEY33,PRPRPMCI,PRPRPYEE,SP70
          CALL      RSHCBCN1
MEDBAT10  CALL      RKHCBCN1
          BRANCH    OVRCD,MEDBAT90
.
          MATCH     PRPRPMCI,HCBCPMCI       * Same MCI
          GOTO      MEDBAT90 IF NOT EQUAL
.
          MATCH     PRPRPYEE,HCBCPYEE       * Same payee provider number
          GOTO      MEDBAT90 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MEDBAT10
          ENDIF
.
          CALL      MPROW000      * Display Batch Range Details Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MEDBAT10 IF NOT EQUAL
          GOTO      MEDBAT99
.
MEDBAT90  CALL      NOMORE00      * Display No More Records Message
.
MEDBAT99  RETURN
.------------------------------------------------------------
. All Medical Practice Batch Range Heading(TABLE HEADING)
.------------------------------------------------------------
MPHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "MCI</td>":
                               "<td class=HeadingCell width=20%>":
                               "Payee Provider Number</td>":
                               "<td class=HeadingCell width=20%>":
                               "Service Provider Number</td>":
                               "<td class=HeadingCell width=15%>":
                               "Batch Number</td>":
                               "<td class=HeadingCell width=15%>":
                               "Batch Counter</td>":
                               "<td class=HeadingCell width=10%>":
                               "Status</td>":
                             "</tr>"
.
MPHED999  RETURN
.------------------------------------------------------------
. All Medical Practice Batch Range Details (TABLE ROW)
.------------------------------------------------------------
MPROW000  MATCH     "1",HCBCSTAT
          IF        @EQUAL
            MOVE    "Completed",ACTIDESC
          ELSE
            MOVE    "Active",ACTIDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail08":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&hicbc001=",HCBCPMCI:
                             "&hicbc002=",HCBCPYEE:
                             "&hicbc003=",HCBCPSRV:
                             "&hicbc004=",HCBCBTCH:
                             "&mediprac=",MEDIPRAC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             HCBCPMCI,"&nbsp;</td>":
                             "<td>",HCBCPYEE,"&nbsp;</td>":
                             "<td>",HCBCPSRV,"&nbsp;</td>":
                             "<td>",HCBCBTCH,"&nbsp;</td>":
                             "<td>",HCBCBCNT,"&nbsp;</td>":
                             "<td>",ACTIDESC,"&nbsp;</td>":
                             "</tr>"
.
MPROW999 RETURN
.
.-------------------------------------------------------------------------------
.   Set Parameters for Option 8 - Medical Practice batch counter file
.-------------------------------------------------------------------------------
STHBC000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STHBC001,STHBC002,STHBC003,STHBC004,STHBC005,STHBC006
.
          GOTO      STHBC999
.
STHBC001  PACK      HICBC001,QRYDATA,SP70
          GOTO      STHBC999
.
STHBC002  PACK      HICBC002,QRYDATA,SP70
          GOTO      STHBC999
.
STHBC003  PACK      HICBC003,QRYDATA,SP70
          GOTO      STHBC999
.
STHBC004  PACK      HICBC004,QRYDATA,SP70
          GOTO      STHBC999
.
STHBC005  MOVE      QRYDATA,HICBC005
          GOTO      STHBC999
.
STHBC006  MOVE      QRYDATA,HICBC006
          GOTO      STHBC999
.
STHBC999  RETURN
.
.-------------------------------------------------------------------------------
. Clear file vars for HICBCNFD                                         
.-------------------------------------------------------------------------------
CLHICB00  MOVE      SP70,HCBCPMCI
          MOVE      SP70,HCBCPYEE
          MOVE      SP70,HCBCPSRV
          MOVE      SP70,HCBCBTCH
          MOVE      ZERO,HCBCBCNT
          MOVE      SP70,HCBCSTAT
          MOVE      SP70,HCBCSPAR 
.
CLHICB99  RETURN
.
.-----------------------------------------------------------
.  Register Selection List - rcpregaf
.-----------------------------------------------------------
REGLST00  PACK      KEY38,SP70
          CALL      RDSREGA4
REGLST10  CALL      RDKREGA4
          BRANCH    OVRCD,REGLST99
.
          MATCH     "1",REGACTIV                      * 1=Inactive
          GOTO      REGLST10 IF EQUAL                 * bypass Inactive
.
          COMPARE   TWO,REGIBACD                      * Private Practice
          GOTO      REGLST10 IF NOT EQUAL
.
REGLST80  PACK      KEY7,QUOTE,REGCODE,REGIBACD,QUOTE
          MATCH     PRPRREGI,REGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY7,"selected>",REGDESC:
                               "</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY7,">",REGDESC:
                               "</option>";
          ENDIF
          GOTO      REGLST10
.
REGLST99  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.------------------------------------------------------------------------------
.
          INC       IBAWEBCD
          INC       PATDOCCD
.
          INC       APSMASIO/INC
          INC       DEBDBTIO/INC    * Debtors File
          INC       DEBDKIIO/INC
          INC       IBABASIO/INC    
.
          INC       PATDO1IO/INC
          INC       PATIN1IO/INC
          INC       PRIFMSIO/INC    * Fin. Man. Interface for Private Practice
          INC       PRIPRAIO/INC    * Medical Practice - Private Practice
          INC       PRIHTRIO/INC    * Medical Practice - Holding table
          INC       PRIPCEIO/INC    * G/L interface
          INC       PRIDOCIO/INC    * Doctors File - Private Practice          
          INC       PMSHCPIO/INC    * Doctors File
...          INC       PRIDBTIO/INC    * Debtors File
          INC       PRIITMIO/INC    * Item file
          INC       PRIALSIO/INC    
          INC       PRISECIO/INC    
          INC       PRIHREIO/INC                 * holding referral file
          INC       PRIHDBIO/INC                 * holding header file
          INC       RCPREGIO/INC
.
          INC       FMSDISIO/INC
          INC       FMSRESIO/INC
          INC       FMSLMAIO/INC
          INC       FMSAMAIO/INC
          INC       FMSCSAIO/INC
          INC       FMSCHQIO/INC
          INC       FMSCAFIO/INC
.
          INC       HICBCNIO/INC
.
          INC       PMSHCPTM
          INC       DAYOFWEK
          INC       NAMSTRCD
          INC       WEBDATCD
.

. *****************************************************************************
. *                                                                           *
. *              P R O G R A M  S U M M A R Y                                 *
. *              -------------  -------------                                 *
. *                                                                           *
. * Program Name:           IBAPAT37                                          *
. *                                                                           *
. * Function:               MONTHLY DOCTORS STATISTIC REPORTS                 *
. *                                                                           *
. * Author:                 MALCOLM HAYSE (I.B.A)                             *
. *                                                                           *
. * Date Written:           6/9/86                                            *
. *                                                                           *
. * Modifications:                                                            *
. *                                                                           *
. *       V12.00.01 29/05/2025  J.Tan          TSK 0955096                    *
. *                 Added Alphanumeric visit number changes                   *
. *       V11.01.01 22/02/2021  J.Tan          TSK 0888639                    *
. *                 Changed patmmbs counter record to DIM3                    *
. *       V10.13.01 05/12/2018  Don Nguyen       TSK 0838558                  *
. *                 Deleted temp file (PSTROL) after processing               *
. *       V10.05.01 01/01/2015  Ania P                      CAR 261630        *
. *                 Removed use of PORT for temp file naming                  *
. *       V10.02.01 28/03/2011  Mike Laming   CAR 240107                      *
. *                 Mods to PATECDaf & PATECOaf variables & Keys - file change*
. *       V10.01.01 03/02/2011 Jill Parkinson CAR 233088                      *
. *                 Added pmsvx1af                                            *
. *       V9.02.01  24.10.2001  B.G.Ackland                                   *
. *                 Replace pi with Record IO Locks                           *
. *       V5.09.B03 01/03/2001  Ebon Clements 509 Doctors Mods                *
. *                 Recompiled for PATAD1FD changes                           *
. *       V5.09.B02 10/01/2001  Ebon Clements 509 Doctors Mods                *
. *                 Changed for new patdstat file layout                      *
. *       V5.08.02  28/08/2000  Caleb Sharman                                 *
. *                 Changed Health Fund variables to be 8 chars               *
. *       V5.08.01  11/07/2000  Steve Downing                                 *
. *                 Replaced CKYIDEF3 with CKYIDEF6 for PATDOCKY              *
. *       V5.08.B01 15/03/2000  Greg Horvat                                   *
. *                 Changed to get the coding from the episode coding files   *
. *****************************************************************************
. *                V5.07.03 19/10/1999  Steve Downing  SRF 646137             *
. *                         Added PTCNDCQS - Single column for doctor         *
. *                         code search                                       *
. *                V5.07.02 29/07/1999  Steve Downing                         *
. *                         Changes to CALC                                   *
. *                V5.07.01 20/11/1998  Jill Habasque                         *
. *                         Mods to include century                           *
. *****************************************************************************
. *                V5.01.02 07/09/89 J.Tan (I.B.A.)                           *
. *                         Fixed to read master record                       *
. *                         SRF 454                                           *
. *                V5.01.03 29/11/89 S.Barcham                                *
. *                         Fixed Reprint Of Option 8                         *
. *                         SRF 103184                                        *
. *                V5.01.04 14/02/90 J.Tan SRF 4700                           *
. *                         Fixed Tempfile                                    *
. *                V5.01.05 15/03/90 J.Tan SRF 104189                         *
. *                         Mods option 8                                     *
. *                V5.01.06 18/07/90 K.Peak                                   *
. *                         Changed the report to print grand totals          *
. *                         equal to a form 5, also changed the               *
. *                         calculating of number of periods within           * 
. *                         the financial year                                *
. *               V5.01.121 27/11/90 Glen Hobby                               *
. *                         Recompiled for changes to PATMX1FD                *
. *               V5.01.122 14/01/90 J.Tan  SRF 107477                        *
. *                         Not to print doctor with zero figures             *
. *               V5.01.123 22/02/94 I.Rutt                                   *
. *                         Standards Upgrade                                 *
. *               V5.01.124 11/04.94 Sandra Barcham                           *
. *                         New Keyins                                        * 
. *****************************************************************************
.
          INC       STD001FD
          INC       PATCOMM/INC
.
          INC       PATAD1FD/INC
          INC       PATCONFD/INC
          INC       PATCODFD/INC
          INC       PATDO1FD/INC
          INC       PATDRGFD/INC
          INC       PATDSTFD/INC
          INC       PATECOFD/INC
          INC       PATMI1FD/INC
          INC       PMSVX1FD/INC
          INC       PATDSCFD/INC
          INC       PATTRNFD/INC
          INC       PATMMBFD/INC
          INC       PATMA1FD/INC
          INC       IBASEQFD/INC  
          INC       TFILEVAR/INC
          INC       WEBERRFD/INC
.
.         WORK AREA
.------------------------------------------------------------------
.Name       Type       Length      Physical      Start
DSTYPE      DIM           1             1           1
.DRTYPE     DIM           3             3           2
DSCODE      DIM           6             6           5
DUNIQUE     DIM           8             8          11
.DSCBED1    FORM          4             3          19
.DSCBED2    FORM          4             3          22
.DSCBED3    FORM          4             3          25
.DSCBED4    FORM          4             3          28
.DSCBED5    FORM          4             3          31
.DSCBED6    FORM          4             3          34
.DSCBED7    FORM          4             3          37
.DSCBED8    FORM          4             3          40
.DSCBED9    FORM          4             3          43
.DSCBED10   FORM          4             3          46
.DSCBED11   FORM          4             3          49
.DSCBED12   FORM          4             3          52
.DSCBED13   FORM          4             3          55
YOPERS      FORM          4             3          58
YBEDS       FORM          4             3          61
YADMNS      FORM          5             4          64
YMBS        FORM          4             3          68
DSBUDG1     FORM          4             3          71
DSBUDG2     FORM          4             3          74
DSBUDG3     FORM          4             3          77
DSBUDG4     FORM          4             3          80
DSBUDG5     FORM          4             3          83
DSBUDG6     FORM          4             3          86
DSBUDG7     FORM          4             3          89
DSBUDG8     FORM          4             3          92
DSBUDG9     FORM          4             3          95
DSBUDG10    FORM          4             3          98
DSBUDG11    FORM          4             3          101
DSBUDG12    FORM          4             3          104
DSBUDG13    FORM          4             3          107
NAVDAY      FORM        3.2             4          110
RECFLG      DIM           1             1          114
SPARES      DIM           4             4          115
.  END OF RECORD                                   119
.
.  redefine form fields from key
.  -----------------------------
.Name     Type       Length      Start
.----     ----       ------      -----
UNIQUE    FORM      8           1
.------------------------------------------------------------------
ANSDT     DIM       1
.
AJDAY     FORM      3           * JULIAN ADMISSION DAY
CJDAY     FORM      3           * JULIAN DISCHARGE DAY
.
CODE      DIM       2
CODEDT    INIT      "DT"
.
DIM3      DIM       3
DIM4      DIM       4
DIM5      DIM       5
DIM6      DIM       6
DIM6A     DIM       6
DIM16     DIM       16
DIM22     DIM       22
DIM40     DIM       40
DIM80     DIM       80
. Fields for calculating yearly data
DSCDSH1    FORM      4 - DISCHARGES  OFFSET MONTH 1
DSCDSH2    FORM      4 - DISCHARGES  OFFSET MONTH 2
DSCDSH3    FORM      4 - DISCHARGES  OFFSET MONTH 3
DSCDSH4    FORM      4 - DISCHARGES  OFFSET MONTH 4
DSCDSH5    FORM      4 - DISCHARGES  OFFSET MONTH 5
DSCDSH6    FORM      4 - DISCHARGES  OFFSET MONTH 6
DSCDSH7    FORM      4 - DISCHARGES  OFFSET MONTH 7
DSCDSH8    FORM      4 - DISCHARGES  OFFSET MONTH 8
DSCDSH9    FORM      4 - DISCHARGES  OFFSET MONTH 9
DSCDSH10   FORM      4 - DISCHARGES  OFFSET MONTH 10
DSCDSH11   FORM      4 - DISCHARGES  OFFSET MONTH 11
DSCDSH12   FORM      4 - DISCHARGES  OFFSET MONTH 12
DSCDSH13   FORM      4 - DISCHARGES  OFFSET MONTH 13
DSCBED1    FORM      4 - BED DAYS    OFFSET MONTH 1
DSCBED2    FORM      4 - BED DAYS    OFFSET MONTH 2
DSCBED3    FORM      4 - BED DAYS    OFFSET MONTH 3
DSCBED4    FORM      4 - BED DAYS    OFFSET MONTH 4
DSCBED5    FORM      4 - BED DAYS    OFFSET MONTH 5
DSCBED6    FORM      4 - BED DAYS    OFFSET MONTH 6
DSCBED7    FORM      4 - BED DAYS    OFFSET MONTH 7
DSCBED8    FORM      4 - BED DAYS    OFFSET MONTH 8
DSCBED9    FORM      4 - BED DAYS    OFFSET MONTH 9
DSCBED10   FORM      4 - BED DAYS    OFFSET MONTH 10
DSCBED11   FORM      4 - BED DAYS    OFFSET MONTH 11
DSCBED12   FORM      4 - BED DAYS    OFFSET MONTH 12
DSCBED13   FORM      4 - BED DAYS    OFFSET MONTH 13
DSCOPR1    FORM      4 - OPERATIONS  OFFSET MONTH 1
DSCOPR2    FORM      4 - OPERATIONS  OFFSET MONTH 2
DSCOPR3    FORM      4 - OPERATIONS  OFFSET MONTH 3
DSCOPR4    FORM      4 - OPERATIONS  OFFSET MONTH 4
DSCOPR5    FORM      4 - OPERATIONS  OFFSET MONTH 5
DSCOPR6    FORM      4 - OPERATIONS  OFFSET MONTH 6
DSCOPR7    FORM      4 - OPERATIONS  OFFSET MONTH 7
DSCOPR8    FORM      4 - OPERATIONS  OFFSET MONTH 8
DSCOPR9    FORM      4 - OPERATIONS  OFFSET MONTH 9
DSCOPR10   FORM      4 - OPERATIONS  OFFSET MONTH 10
DSCOPR11   FORM      4 - OPERATIONS  OFFSET MONTH 11
DSCOPR12   FORM      4 - OPERATIONS  OFFSET MONTH 12
DSCOPR13   FORM      4 - OPERATIONS  OFFSET MONTH 13
DSXOPR1    FORM      4 - OPERATIONS  OFFSET MONTH 1
DSXOPR2    FORM      4 - OPERATIONS  OFFSET MONTH 2
DSXOPR3    FORM      4 - OPERATIONS  OFFSET MONTH 3
DSXOPR4    FORM      4 - OPERATIONS  OFFSET MONTH 4
DSXOPR5    FORM      4 - OPERATIONS  OFFSET MONTH 5
DSXOPR6    FORM      4 - OPERATIONS  OFFSET MONTH 6
DSXOPR7    FORM      4 - OPERATIONS  OFFSET MONTH 7
DSXOPR8    FORM      4 - OPERATIONS  OFFSET MONTH 8
DSXOPR9    FORM      4 - OPERATIONS  OFFSET MONTH 9
DSXOPR10   FORM      4 - OPERATIONS  OFFSET MONTH 10
DSXOPR11   FORM      4 - OPERATIONS  OFFSET MONTH 11
DSXOPR12   FORM      4 - OPERATIONS  OFFSET MONTH 12
DSXOPR13   FORM      4 - OPERATIONS  OFFSET MONTH 13
.
DSCDSH    FORM      4
DSCBED    FORM      4
DSCOPR    FORM      4
DOCCODE   DIM       6 
DOCNAME   DIM       15
DTSRCH    DIM       3
LAST      DIM       3
STRDOC    DIM       6
ENDDOC    DIM       6
.
FORM3     FORM      3
FORM8     FORM      8
INDEX     FORM      2
.
STATUS    FORM      1
STRTPERD  DIM       2
OPCND     FORM      1
CMDLINE   DIM       50
.
JDAYS     FORM      3
JYEAR     FORM      2
JULCCYY   DIM       4
JULCY     FORM      4
.
NDIS      FORM      5
.
OPTIONA   FORM      2
PAGENO    FORM      3
.
SORTSTR   DIM       27
SORT1     INIT      "U1-1,2-4,5-10,11-18"
SORT2     INIT      "U1-1,2-4,5-10,114-114,11-18"
.
PSTTMP    IFILE     SQL, FIXED=119, KEY=SORTSTR
PSTROL    FILE      ASCII, FIXED=256
.
TTYOPERS      FORM          4
TTYBEDS       FORM          4
TTYADMNS      FORM          5
TTYMBS        FORM          4
.
FNAMET    DIM       8       ***TEMPORARY FILE
FNAMER    DIM       8       *** ROLLOUT FILE
.
FINYEAR   DIM       4
NOWYEAR   DIM       4
NOWPERD   DIM       2
CURYR     DIM       4
CURNUM    DIM       2
.
.      EXTRA VARIABLES
.
STRTFLAG  FORM      1
.
DSEX      DIM       6
.
.        Special Variables used by NHOSPDAY
.
WDATE1    DIM       8
WDATE2    DIM       8
TODATE    DIM       8
FROMDATE  DIM       8
LYR       FORM      1
.
WTOTDAY   FORM      4
WTOTCCYY  DIM       4
WTOTCY    FORM      4
WADM      FORM      4
WSBED     FORM      4
WORK      FORM      4
.
.
DHEAD     DIM       36
TYPHEAD   DIM       20
DUPDATE   INIT      "STATISTICS - Monthly Update   "
DBUDG     INIT      "Budget"
DHEAD1    INIT      "BED DAYS by Referring Doctor  "
DHEAD2    INIT      "BED DAYS by Attending Doctor  "
DHEAD3    INIT      "ADMISSIONS by Referring Doctor"
DHEAD4    INIT      "ADMISSIONS by Attending Doctor"
DHEAD5    INIT      "OPERATIONS by Referring Doctor"
DHEAD6    INIT      "OPERATIONS by Attending Doctor"
DHEAD7    INIT      "MBS CODES by Referring Doctor "
DHEAD8    INIT      "MBS CODES by Attending Doctor "
DHEAD9    INIT      "Single Doctor Type "
DHEAD10   INIT      "Range Doctor Type "
DHEAD11   INIT      "Bed Days/Adm./Oper.by Doc.Code"
DHEAD12   INIT      "Single Doctor Code "
DHEAD13   INIT      "Range Doctor Code "
.
DHEAD1A   INIT      "BED DAYS by Referring V.M.P.  "
DHEAD2A   INIT      "BED DAYS by Attending V.M.P.  "
DHEAD3A   INIT      "ADMISSIONS by Referring V.M.P."
DHEAD4A   INIT      "ADMISSIONS by Attending V.M.P."
DHEAD5A   INIT      "OPERATIONS by Referring V.M.P."
DHEAD6A   INIT      "OPERATIONS by Attending V.M.P."
DHEAD7A   INIT      "MBS CODES by Referring V.M.P. "
DHEAD8A   INIT      "MBS CODES by Attending V.M.P. "
DHEAD9A   INIT      "Single V.M.P. Type "
DHEAD10A  INIT      "Range V.M.P. Type "
.
DOCTOR    DIM       6
DOCTORLC  DIM       6
.
DOCOPT0   INIT      "DOCTOR"
DOCOPT1   INIT      "V.M.P."
.
DLCOPT0   INIT      "Doctor"
.
.       PRINTING VARIABLES
.
DNAME     DIM       27
DNAMESH   DIM       21
.
SPERIOD   FORM      2
TAVDAY    FORM      7.2    * AVERAGE/DAY in 7.2
.
TDSDOC1   FORM      5
TDSDOC2   FORM      5
TDSDOC3   FORM      5
TDSDOC4   FORM      5
TDSDOC5   FORM      5
TDSDOC6   FORM      5
TDSDOC7   FORM      5
TDSDOC8   FORM      5
TDSDOC9   FORM      5
TDSDOC10  FORM      5
TDSDOC11  FORM      5
TDSDOC12  FORM      5
TDSDOC13  FORM      5
.
TDBDOC1   FORM      5
TDBDOC2   FORM      5
TDBDOC3   FORM      5
TDBDOC4   FORM      5
TDBDOC5   FORM      5
TDBDOC6   FORM      5
TDBDOC7   FORM      5
TDBDOC8   FORM      5
TDBDOC9   FORM      5
TDBDOC10  FORM      5
TDBDOC11  FORM      5
TDBDOC12  FORM      5
TDBDOC13  FORM      5
.
TYMBS     FORM      6
TYOPERS   FORM      6     *YTD TOTALS
TYBEDS    FORM      6
TYADMNS   FORM      7
.
SUBDOC1   FORM      4
SUBDOC2   FORM      4
SUBDOC3   FORM      4
SUBDOC4   FORM      4
SUBDOC5   FORM      4
SUBDOC6   FORM      4
SUBDOC7   FORM      4
SUBDOC8   FORM      4
SUBDOC9   FORM      4
SUBDOC10  FORM      4
SUBDOC11  FORM      4
SUBDOC12  FORM      4
SUBDOC13  FORM      4
.
STYMBS    FORM      6     *YTD TOTALS
STYOPERS  FORM      6
STYBEDS   FORM      6
STYADMNS  FORM      7
.
SNAVDAY   FORM      3.2    * AVERAGE/DAY
STAVDAY   FORM      7.2    * AVERAGE/DAY in 7.2
.
MONTH     DIM       78
MONTH12   DIM       72
NUMPERS   FORM      2
.
.
PRGID     INIT      "IBAPAT37"
PRGNAM    INIT      "Monthly Doctor Statistics"
VERSION   INIT      "V12.00.01"
.
          CALL      DISPHEAD
          DISPLAY   *P56:24,"Opening patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patdo1af";
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATDO1A2,"patdo1af"
.
          DISPLAY   *P64:24,"patdstat";
          OPEN      PATDSTA1,"patdstat"
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A2,"patmi1af"
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH2,"patdschf"
.
          DISPLAY   *P64:24,"patdrgaf";
          OPEN      PATDRGA1,"patdrgaf"
          OPEN      PATDRGA3,"patdrgaf"
.
          DISPLAY   *P64:24,"patecoaf";
          OPEN      PATECOA2,"patecoaf"
.
          DISPLAY   *P64:24,"pattranf";
          OPEN      PATTRAN2,"pattranf"
.
          DISPLAY   *P64:24,"patmmbsf";
          OPEN      PATMMBS1,"patmmbsf"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
.
          DISPLAY   *P64:24,"patmx1af";
          OPEN      PATMX1A1,"patmx1af"

.
OPFIL     DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TEN3;*154,CUSEMBS,*200,CDOCVMP
          READ      CONTROLF,TWENTY1;*247,PTCNDCQS
          READ      CONTROLF,FIFTY9;*27,CPERMTH
.
          MOVE      DOCOPT0,DOCTOR
          MOVE      DLCOPT0,DOCTORLC
.
          LOAD      DOCTOR USING CDOCVMP OF DOCOPT1
          LOAD      DOCTORLC USING CDOCVMP OF DOCOPT1
.
          LOAD      DHEAD1 USING CDOCVMP OF DHEAD1A
          LOAD      DHEAD2 USING CDOCVMP OF DHEAD2A
          LOAD      DHEAD3 USING CDOCVMP OF DHEAD3A
          LOAD      DHEAD4 USING CDOCVMP OF DHEAD4A
          LOAD      DHEAD5 USING CDOCVMP OF DHEAD5A
          LOAD      DHEAD6 USING CDOCVMP OF DHEAD6A
          LOAD      DHEAD7 USING CDOCVMP OF DHEAD7A
          LOAD      DHEAD8 USING CDOCVMP OF DHEAD8A
          LOAD      DHEAD9 USING CDOCVMP OF DHEAD9A
          LOAD      DHEAD10 USING CDOCVMP OF DHEAD10A
.
          PACK      CPTDATE,CCC,CYY,CMM,CDD
          REP       " 0",CPTDATE
          CALL      GPERD
          BRANCH    EXIT,NOCPER
.
          MOVE      DRGYR,FINYEAR
          MOVE      DRGCYR,CURYR
          MOVE      DRGCNUM,CURNUM
.
          CALL      TFILENAM
          MOVE      TFILNAME,FNAMER
.
          CALL      TFILENAM
          MOVE      TFILNAME,FNAMET
          GOTO      START
.
NOCPER    DISPLAY   *P1:24,*EL,*B:
                    "Error: Current date not found in Period file. ";
          CALL      HITENTER
          GOTO      ENDIT
.
.         MAIN        MENU
.
START     MOVE      ZERO,PAGENO
          MOVE      TEN4,CVERT
.
          HLINE     *G37,2,53,80
          DISPLAY   *P1:3,*EF:
                    *P2:4,*V2LON,ZERO,*HOFF," = Exit":
                    *P2:5,*V2LON,ONE,*HOFF," = Monthly Update":
                    *P2:6,*V2LON,TWO,*HOFF," = ",DHEAD1:
                    *P2:7,*V2LON,THREE,*HOFF," = ",DHEAD2:
                    *P2:8,*V2LON,FOUR,*HOFF," = ",DHEAD3:
                    *P2:9,*V2LON,FIVE,*HOFF," = ",DHEAD4:
                    *P2:10,*V2LON,SIX,*HOFF," = ",DHEAD5:
                    *P2:11,*V2LON,SEVEN,*HOFF," = ",DHEAD6:
                  *P2:12,*V2LON,EIGHT,*HOFF," = Bed Days/Admissions/Operations":
                    " by Doctor Code"
          BRANCH    CUSEMBS OF STMBS,STMBS
          GOTO      REKSTRT
.
STMBS     ADD       TWO,CVERT
          DISPLAY   *P2:13,*V2LON,NINE,*HOFF," = ",DHEAD7:
                    *P1:14,*V2LON,TEN,*HOFF,"= ",DHEAD8
.
REKSTRT   KEYIN     *P1:CVERT,*EF,"Select Option : ",*EL,*V2LON,OPTION
.
          COMPARE   ZERO TO OPTION
          GOTO      ENDIT IF EQUAL
.
BRNCH     CLOCK     TIME,CTIMEIS
          BRANCH    OPTION OF UPDATE,TDATE,TDATE,TDATE:
                              TDATE,TDATE,TDATE,TDATE,CMBS,CMBS
          BEEP
          GOTO      REKSTRT
.
CMBS      BRANCH    CUSEMBS OF TDATE,TDATE
          BEEP
          GOTO      REKSTRT
.
NODATA    DISPLAY   *P1:24,*EL,*B:
                    "No Available Data for ",NOWYEAR,". ";
          CALL      HITENTER
          GOTO      START
.
.             KEYIN TO DATE
.
TDATE     MOVE      FINYEAR,NOWYEAR
          DISPLAY   *P1:17,*EF,"Financial Year : ",*V2LON,NOWYEAR
.
          KEYIN     *P18:17,*V2LON,*RV,*JR,*DE,NOWYEAR
.
          PACK      DHEAD WITH SP20,SP20
          LOAD      DHEAD USING OPTION OF DUPDATE,DHEAD1,DHEAD2,DHEAD3:
                                  DHEAD4,DHEAD5,DHEAD6,DHEAD11,DHEAD7,DHEAD8
.
          RESET     DHEAD,30
          APPEND    "(",DHEAD
          APPEND    NOWYEAR,DHEAD
          APPEND    ")",DHEAD
          RESET     DHEAD
.
          DISPLAY   *P53:2,*V2LON,DHEAD;
          MOVE      ZERO,OPTIONA
          COMPARE   EIGHT,OPTION
          GOTO      KDOCT01 IF EQUAL
.
          MOVE      SORT1,SORTSTR
+
.           KEYIN  TO DOCTOR TYPE
.
TDOCT01   DISPLAY   *P1:16,*EF,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:17,*V2LON,ONE,*HOFF," = ",DHEAD9:
                    *P1:18,*V2LON,TWO,*HOFF," = ",DHEAD10
.
          BRANCH    OPTIONA OF TDOCT05,TDOCT05
.
TDOCT02   KEYIN     *P1:20,*EF,"Select Option : ",*V2LON,OPTIONA
.
          COMPARE   ZERO,OPTIONA
          GOTO      START IF EQUAL
.
          LOAD      TYPHEAD USING OPTIONA OF DHEAD9,DHEAD10
.
TDOCT05   DISPLAY   *P1:20,"Select Option : ",*V2LON,OPTIONA
.
          BRANCH    OPTIONA OF TDOCT10,TDOCT20
          BEEP
          GOTO      TDOCT02
.
TDOCT10   MOVE      SP3,DTSRCH
.          DISPLAY   *P1:22,*EF,*P36:22,*V2LON," ? for ":
          DISPLAY   *P1:22,*HOFF,DOCTORLC," Type : "
          MOVE      ONE,CNEWDS
          MOVE      TEN5,ECOL
          MOVE      TWENTY2,EVERT
          MOVE      CODEDT,CODE
          MOVE      SP3,CKYIDEF6
          MOVE      ZERO,CKYIMAND
          CALL      PATCODKY  
          IF        EXIT = ONE
            MOVE      ZERO,OPTIONA
          ENDIF
          BRANCH    EXIT,TDOCT01,START 
          MOVE      ACODE,DTSRCH     
          GOTO      TDOCT30 
.
TDOCT20   MOVE      SP3,LAST
          MOVE      SP3,DTSRCH
          DISPLAY   *P1:22,*HOFF,"Starting ",DOCTORLC:
                    " Type : "
          MOVE      ONE,CNEWDS
          MOVE      TWENTY5,ECOL
          MOVE      TWENTY2,EVERT
          MOVE      CODEDT,CODE
          MOVE      SP3,CKYIDEF6
          MOVE      ZERO,CKYIMAND
          CALL      PATCODKY  
          IF        EXIT = ONE
            MOVE      SP3,DTSRCH
            DISPLAY   *P25:22,*EL,*V2LON,"START"
          ELSE
            IF        EXIT = 2
              GOTO      START
            ELSE
              MOVE      ACODE,DTSRCH     
            ENDIF  
          ENDIF
.
          RESET     DTSRCH
          MATCH     SP3,DTSRCH 
          GOTO      TDOCT30 IF NOT EQUAL
.
          GOTO      TDOCT60
.
TDOCT30   DISPLAY   *P36:22,*EL,TDESC
.
          BRANCH    OPTIONA OF CHKOK,TDOCT60
.
TDOCT60   MOVE      SP3,LAST
          DISPLAY   *P1:23,*EL,*HOFF,"Ending ":
                    DOCTORLC," Type   : "
          MOVE      ONE,CNEWDS
          MOVE      TWENTY5,ECOL
          MOVE      TWENTY3,EVERT
          MOVE      CODEDT,CODE
          MOVE      SP3,CKYIDEF6
          MOVE      ZERO,CKYIMAND
          CALL      PATCODKY  
          IF        EXIT = ONE
            MOVE      SP3,LAST
            DISPLAY   *P25:23,*EL,*V2LON,"FINISH"
          ELSE
            IF        EXIT = 2
              GOTO      START
            ELSE
              MOVE      ACODE,LAST     
            ENDIF  
          ENDIF
.
          RESET     LAST
          MATCH     SP3,LAST 
          GOTO      TDOCT70 IF NOT EQUAL
.
          GOTO      CHKOK
.
TDOCT70   DISPLAY   *P36:23,*EL,TDESC
          BRANCH    OPTIONA OF CHKOK
.
          MATCH     DTSRCH,LAST
          GOTO      INVCOD IF LESS
.
          GOTO      CHKOK
.
INVCOD    DISPLAY   *P1:24,*EL,*B,"Upper Range Should be Larger ":
                    "than Lower Range. ";
          CALL      HITENTER
          COMPARE   EIGHT,OPTION
          GOTO      KDOCT05 IF EQUAL
          GOTO      TDOCT05
.
.
.       Keyin doctor code (Option 8)
.
KDOCT01   DISPLAY   *P1:17,*EF,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:18,*V2LON,ONE,*HOFF," = ",DHEAD12:
                    *P1:19,*V2LON,TWO,*HOFF," = ",DHEAD13
.
          MOVE      SORT2,SORTSTR
          BRANCH    OPTIONA OF KDOCT05,KDOCT05
.
KDOCT02   KEYIN     *P1:20,*EF,"Select Option : ",*V2LON,OPTIONA
.
          COMPARE   ZERO,OPTIONA
          GOTO      START IF EQUAL
.
          LOAD      TYPHEAD USING OPTIONA OF DHEAD12,DHEAD13
.
KDOCT05   DISPLAY   *P1:20,"Select Option : ",*V2LON,OPTIONA
.
          BRANCH    OPTIONA OF KDOCT10,KDOCT20
          BEEP
          GOTO      KDOCT02
.
KDOCT10   MOVE      SP6,STRDOC
          DISPLAY   *P1:22,*HOFF,"Doctor Code : ",*V2LON,STRDOC
          MOVE      "16",ECOL
          MOVE      "22",EVERT
          MOVE      SP6,CKYIDEF6
          MOVE      ZERO,CKYIMAND
          MOVE      ONE,CNEWDS
          CALL      PATDOCKY
          MOVE      ONE,CNEWDS
          MOVE      DOCCODE,STRDOC
          BRANCH    EXIT,KDOCT02,START 
          GOTO      KDOCT30
.
KDOCT20   MOVE      SP6,ENDDOC
          MOVE      SP6,STRDOC
          DISPLAY   *P1:22,*HOFF,"Starting Doctor Code : ",*V2LON,STRDOC
          MOVE      "24",ECOL
          MOVE      "22",EVERT
          MOVE      SP6,CKYIDEF6
          MOVE      ZERO,CKYIMAND
          MOVE      ONE,CNEWDS
          CALL      PATDOCKY
          MOVE      ZERO,CNEWDS
          IF        EXIT = 1 
            DISPLAY   *P24:22,*EL,*V2LON,"START"
            GOTO      KDOCT60
          ELSE 
            IF          EXIT = 2
              GOTO        START
            ENDIF
          ENDIF 
          MOVE      DOCCODE,STRDOC
.
KDOCT30   MOVE      DGNAME,ANS
          DISPLAY   *P36:22,*EL,ANS,".",DSNAME
          BRANCH    OPTIONA OF CHKOK,KDOCT60
.
KDOCT60   MOVE      SP6,ENDDOC
          DISPLAY   *P1:23,*EL,*HOFF,"Ending Doctor Code   : ",*V2LON,ENDDOC
          MOVE      "24",ECOL
          MOVE      "23",EVERT
          MOVE      SP6,CKYIDEF6
          MOVE      ZERO,CKYIMAND
          MOVE      ONE,CNEWDS
          CALL      PATDOCKY
          MOVE      ZERO,CNEWDS
          IF        EXIT = 1 
            DISPLAY   *P24:23,*EL,*V2LON,"FINISH"
            GOTO      CHKOK 
          ELSE 
            IF          EXIT = 2
              GOTO        START
            ENDIF
          ENDIF 
          MOVE       DOCCODE,ENDDOC
.
KDOCT70   MOVE      DGNAME,ANS
         DISPLAY   *P36:23,*EL,*V2LON,ANS,".",DSNAME
          BRANCH    OPTIONA OF CHKOK
.
          MATCH     STRDOC,ENDDOC
          GOTO      INVCOD IF LESS
.
.        Check if it is OK to continue
.
CHKOK     CALL      CONTQST
.
          COMPARE   TWO,CEXIT
          GOTO      CHK10 IF NOT EQUAL
.
          MOVE      ZERO,OPTIONA
          BRANCH    OPTION OF TDOCT01,TDOCT01,TDOCT01,TDOCT01:
                              TDOCT01,TDOCT01,TDOCT01,KDOCT01,TDOCT01,TDOCT01
          GOTO      TDOCT01
.
CHK10     COMPARE   ONE,CEXIT 
          GOTO      PROCDA IF EQUAL
.
          GOTO      START
.
PROCDA
.
.    LOAD UP MONTH DESCRIPTION
.
          CALL      INITPR
          MOVE      ZERO,NUMPERS
          CLEAR     MONTH
          PACK      KEY6,NOWYEAR,SP2
          CALL      RDSDRGA1
NEXTM     CALL      RDKDRGA1
          BRANCH    OVRCD,ENDMPLP
.
          MATCH     DRGYR,NOWYEAR
          GOTO      ENDMPLP IF NOT EQUAL
.
          IF        NUMPERS = 0
            MOVE      DRGNUM,STRTPERD
          ENDIF
.
          ADD       ONE,NUMPERS
          APPEND    "| ",MONTH
          APPEND    DRGSDSC,MONTH
          APPEND    SP1,MONTH
          GOTO      NEXTM
.
ENDMPLP   RESET     MONTH
          MOVE      MONTH,MONTH12
.
.     READ ACTUAL DATA
.
          MOVE      ZERO,STRTFLAG
          CALL      ZEROT
.
          CLOSE     PSTTMP
          CALL      KILLIDX
          CALL      CREAIDX
.
          OPEN      PSTTMP,FNAMET
          MOVE      ONE TO UNIQUE
.
          LOAD      ANSDT USING OPTION OF SP1,ANSR,ANSA,ANSR,ANSA:
                                          ANSR,ANSA,SP1,ANSR,ANSA
          MOVE      NOWYEAR,PTDSYEAR
          MOVE      STRTPERD,PTDSPERD
          REPLACE   " 0",PTDSPERD
  
          PACK      KEY13 WITH PTDSYEAR,PTDSPERD,ANSDT,SP6
          CALL      RDSDSTA1
          DISPLAY   *P5:24,*EL,"Processing :";
.
NEXTS     CALL      RDKDSTA1
          BRANCH    OVRCD OF READDA
.
          MATCH     NOWYEAR,PTDSYEAR             * Select all this year
          GOTO      READDA IF NOT EQUAL
.    
          BRANCH    OPTION OF CDOTYP,CDOTYP,CDOTYP,CDOTYP:
                              CDOTYP,CDOTYP,CDOTYP:
                              CDOCOD,CDOTYP,CDOTYP
.
.      Check doctor code
.
CDOCOD    MOVE      ONE,STRTFLAG
          PACK      DRTYPE,SP3
          BRANCH    OPTIONA OF SCODE,RCODE
.
SCODE     MATCH     STRDOC,PTDSCODE           * Single doctor code
          GOTO      OKDOCT IF EQUAL
          GOTO      NEXTS
.
RCODE     MATCH     SP6,STRDOC              * Range doctor code
          GOTO      RCODEL IF EQUAL
.
          MATCH     STRDOC,PTDSCODE
          GOTO      NEXTS IF LESS
.
RCODEL    MATCH     SP6,ENDDOC
          GOTO      OKDOCT IF EQUAL
.
          MATCH     PTDSCODE,ENDDOC
          GOTO      NEXTS IF LESS
          GOTO      OKDOCT
.
.      Check doctor type
.
CDOTYP    MATCH     ANSDT,PTDSTYPE
          GOTO      NEXTS IF NOT EQUAL
.
          MOVE      ONE,STRTFLAG
.
          MOVE      "UNK",DRTYPE
          MOVE      PTDSCODE,KEY6
          CALL      RDDOCT1
.
          BRANCH    OPTIONA OF SDOCT,RDOCT
.
SDOCT     MATCH     DTSRCH,DRTYPE
          GOTO      OKDOCT IF EQUAL
          GOTO      NEXTS
.
RDOCT     MATCH     SP3,DTSRCH
          GOTO      RDOCTL IF EQUAL
.
          MATCH     DTSRCH,DRTYPE
          GOTO      NEXTS IF LESS
.
RDOCTL    MATCH     SP3,LAST
          GOTO      OKDOCT IF EQUAL
.
          MATCH     LAST,DRTYPE
          GOTO      OKDOCT IF EQUAL
          GOTO      NEXTS IF NOT LESS
.
OKDOCT    CALL      TOTAL
          CALL      WRITDA
          DISPLAY   *P20:24,*V2LON,PTDSCODE;
          GOTO      NEXTS
.
DISPTYP   MOVE      CODEDT,CODE
          CALL      PATCODDS
          DISPLAY   *P1:4,*EF
          GOTO      TDOCT01
.
.     WRITE DATA TO TEMPORARY FILE
.
WRITDA    MOVE      ZERO,NAVDAY
          MOVE      ZERO,RECFLG
.
          COMPARE   ZERO,YADMNS
          GOTO      WRITBCH IF EQUAL
.
          MOVE      YBEDS,TAVDAY
          DIV       YADMNS,TAVDAY
          MOVE      TAVDAY,NAVDAY
.
WRITBCH   BRANCH    OPTION OF WRIT1,WRIT1,WRIT1,WRIT2,WRIT2:
                                          WRIT3,WRIT3,WRIT3A,WRIT4,WRIT4
.
...............................................................................
.
WRIT1     PACK      KEY18 WITH PTDSTYPE,DRTYPE,PTDSCODE,UNIQUE
          MOVE      PTDSPERD,SPERIOD
          CALL      RDATTMP
          IF        OVRCD = 0
            READ     PSTTMP,KEY18;KEY18:
                                      DSCBED1,DSCBED2,DSCBED3:
                                      DSCBED4,DSCBED5,DSCBED6:
                                      DSCBED7,DSCBED8,DSCBED9:
                                      DSCBED10,DSCBED11,DSCBED12:
                                      DSCBED13:
                                      TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                      DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                      DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                      DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                      DSBUDG13:
                                      NAVDAY,RECFLG,SPARES
.
            ADD       YOPERS,TTYOPERS
            ADD       YBEDS,TTYBEDS
            ADD       YADMNS,TTYADMNS
            ADD       YMBS,TTYMBS
.
            LOAD      FORM8,SPERIOD,DSCBED1,DSCBED2,DSCBED3:
                                    DSCBED4,DSCBED5,DSCBED6:
                                    DSCBED7,DSCBED8,DSCBED9:
                                    DSCBED10,DSCBED11,DSCBED12:
                                    DSCBED13
            ADD       PTDSBEDD,FORM8
            STORE     FORM8,SPERIOD,DSCBED1,DSCBED2,DSCBED3:
                                    DSCBED4,DSCBED5,DSCBED6:
                                    DSCBED7,DSCBED8,DSCBED9:
                                    DSCBED10,DSCBED11,DSCBED12:
                                    DSCBED13
.
            LOAD      FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
            ADD       PTDSBBED,FORM8
            STORE     FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
.
            UPDATE   PSTTMP;KEY18:
                                DSCBED1,DSCBED2,DSCBED3:
                                DSCBED4,DSCBED5,DSCBED6:
                                DSCBED7,DSCBED8,DSCBED9:
                                DSCBED10,DSCBED11,DSCBED12:
                                DSCBED13:
                                TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                DSBUDG13:
                                NAVDAY,RECFLG,SPARES            
          ELSE
            CALL      CDAT0000 
            STORE     PTDSBEDD,SPERIOD,DSCBED1,DSCBED2,DSCBED3:
                                        DSCBED4,DSCBED5,DSCBED6:
                                        DSCBED7,DSCBED8,DSCBED9:
                                        DSCBED10,DSCBED11,DSCBED12:
                                        DSCBED13
.
            STORE     PTDSBBED,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                       DSBUDG4,DSBUDG5,DSBUDG6:
                                       DSBUDG7,DSBUDG8,DSBUDG9:
                                       DSBUDG10,DSBUDG11,DSBUDG12:
                                       DSBUDG13
.
            WRITE     PSTTMP,KEY18;KEY18:
                                       DSCBED1,DSCBED2,DSCBED3:
                                       DSCBED4,DSCBED5,DSCBED6:
                                       DSCBED7,DSCBED8,DSCBED9:
                                       DSCBED10,DSCBED11,DSCBED12:
                                       DSCBED13:
                                       YOPERS,YBEDS,YADMNS,YMBS:
                                       DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                       DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                       DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                       DSBUDG13:
                                       NAVDAY,RECFLG,SPARES
          ENDIF
.         ADD       ONE,UNIQUE
.
.        GRAND TOTALS   (T is moved to N in print and added)
.
          LOAD      FORM8,SPERIOD,TDSDOC1,TDSDOC2,TDSDOC3:
                                  TDSDOC4,TDSDOC5,TDSDOC6:
                                  TDSDOC7,TDSDOC8,TDSDOC9:
                                  TDSDOC10,TDSDOC11,TDSDOC12:
                                  TDSDOC13
          ADD       PTDSBEDD,FORM8
          STORE     FORM8,SPERIOD,TDSDOC1,TDSDOC2,TDSDOC3:
                                  TDSDOC4,TDSDOC5,TDSDOC6:
                                  TDSDOC7,TDSDOC8,TDSDOC9:
                                  TDSDOC10,TDSDOC11,TDSDOC12:
                                  TDSDOC13
          LOAD      FORM8,SPERIOD,TDBDOC1,TDBDOC2,TDBDOC3:
                                  TDBDOC4,TDBDOC5,TDBDOC6:
                                  TDBDOC7,TDBDOC8,TDBDOC9:
                                  TDBDOC10,TDBDOC11,TDBDOC12:
                                  TDBDOC13
          ADD       PTDSBBED,FORM8
          STORE     FORM8,SPERIOD,TDBDOC1,TDBDOC2,TDBDOC3:
                                  TDBDOC4,TDBDOC5,TDBDOC6:
                                  TDBDOC7,TDBDOC8,TDBDOC9:
                                  TDBDOC10,TDBDOC11,TDBDOC12:
                                  TDBDOC13
          RETURN
.
...............................................................................
.
WRIT2     PACK      KEY18 WITH PTDSTYPE,DRTYPE,PTDSCODE,UNIQUE
          MOVE      PTDSPERD,SPERIOD  
          CALL      RDATTMP
          IF        OVRCD = 0
            READ     PSTTMP,KEY18;KEY18:
                                      DSCDSH1,DSCDSH2,DSCDSH3:
                                      DSCDSH4,DSCDSH5,DSCDSH6:
                                      DSCDSH7,DSCDSH8,DSCDSH9:
                                      DSCDSH10,DSCDSH11,DSCDSH12:
                                      DSCDSH13:
                                      TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                      DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                      DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                      DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                      DSBUDG13:
                                      NAVDAY,RECFLG,SPARES
.
            ADD       YOPERS,TTYOPERS
            ADD       YBEDS,TTYBEDS
            ADD       YADMNS,TTYADMNS
            ADD       YMBS,TTYMBS
            LOAD      FORM8,SPERIOD,DSCDSH1,DSCDSH2,DSCDSH3:
                                    DSCDSH4,DSCDSH5,DSCDSH6:
                                    DSCDSH7,DSCDSH8,DSCDSH9:
                                    DSCDSH10,DSCDSH11,DSCDSH12:
                                    DSCDSH13
            ADD       PTDSADMS,FORM8
            STORE     FORM8,SPERIOD,DSCDSH1,DSCDSH2,DSCDSH3:
                                    DSCDSH4,DSCDSH5,DSCDSH6:
                                    DSCDSH7,DSCDSH8,DSCDSH9:
                                    DSCDSH10,DSCDSH11,DSCDSH12:
                                    DSCDSH13
.
            LOAD      FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
            ADD       PTDSBADM,FORM8
            STORE     FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
.
            UPDATE   PSTTMP;KEY18:
                                DSCDSH1,DSCDSH2,DSCDSH3:
                                DSCDSH4,DSCDSH5,DSCDSH6:
                                DSCDSH7,DSCDSH8,DSCDSH9:
                                DSCDSH10,DSCDSH11,DSCDSH12:
                                DSCDSH13:
                                TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                DSBUDG13:
                                NAVDAY,RECFLG,SPARES
          ELSE
            CALL      CDAT0000
            STORE     PTDSADMS,SPERIOD,DSCDSH1,DSCDSH2,DSCDSH3:
                                        DSCDSH4,DSCDSH5,DSCDSH6:
                                        DSCDSH7,DSCDSH8,DSCDSH9:
                                        DSCDSH10,DSCDSH11,DSCDSH12:
                                        DSCDSH13
            STORE     PTDSBADM,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
.
            WRITE     PSTTMP,KEY18;KEY18:
                                       DSCDSH1,DSCDSH2,DSCDSH3:
                                       DSCDSH4,DSCDSH5,DSCDSH6:
                                       DSCDSH7,DSCDSH8,DSCDSH9:
                                       DSCDSH10,DSCDSH11,DSCDSH12:
                                       DSCDSH13:
                                       YOPERS,YBEDS,YADMNS,YMBS:
                                       DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                       DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                       DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                       DSBUDG13:
                                       NAVDAY,RECFLG,SPARES
          ENDIF
.         ADD       ONE,UNIQUE
.
.        GRAND TOTALS   (T is moved to N in print and added)
.
          LOAD      FORM8,SPERIOD,TDSDOC1,TDSDOC2,TDSDOC3:
                                  TDSDOC4,TDSDOC5,TDSDOC6:
                                  TDSDOC7,TDSDOC8,TDSDOC9:
                                  TDSDOC10,TDSDOC11,TDSDOC12:
                                  TDSDOC13
          ADD       PTDSADMS,FORM8
          STORE     FORM8,SPERIOD,TDSDOC1,TDSDOC2,TDSDOC3:
                                  TDSDOC4,TDSDOC5,TDSDOC6:
                                  TDSDOC7,TDSDOC8,TDSDOC9:
                                  TDSDOC10,TDSDOC11,TDSDOC12:
                                  TDSDOC13
.
          LOAD      FORM8,SPERIOD,TDBDOC1,TDBDOC2,TDBDOC3:
                                  TDBDOC4,TDBDOC5,TDBDOC6:
                                  TDBDOC7,TDBDOC8,TDBDOC9:
                                  TDBDOC10,TDBDOC11,TDBDOC12:
                                  TDBDOC13
          ADD       PTDSBADM,FORM8
          STORE     FORM8,SPERIOD,TDBDOC1,TDBDOC2,TDBDOC3:
                                  TDBDOC4,TDBDOC5,TDBDOC6:
                                  TDBDOC7,TDBDOC8,TDBDOC9:
                                  TDBDOC10,TDBDOC11,TDBDOC12:
                                  TDBDOC13
.
          RETURN
.
...............................................................................
.
WRIT3     PACK      KEY18 WITH PTDSTYPE,DRTYPE,PTDSCODE,UNIQUE
          MOVE      PTDSPERD,SPERIOD
          CALL      RDATTMP
          IF        OVRCD = 0
            READ     PSTTMP,KEY18;KEY18:
                                      DSCOPR1,DSCOPR2,DSCOPR3:
                                      DSCOPR4,DSCOPR5,DSCOPR6:
                                      DSCOPR7,DSCOPR8,DSCOPR9:
                                      DSCOPR10,DSCOPR11,DSCOPR12:
                                      DSCOPR13:
                                      TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                      DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                      DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                      DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                      DSBUDG13:
                                      NAVDAY,RECFLG,SPARES
.
            ADD       YOPERS,TTYOPERS
            ADD       YBEDS,TTYBEDS
            ADD       YADMNS,TTYADMNS
            ADD       YMBS,TTYMBS
            LOAD      FORM8,SPERIOD,DSCOPR1,DSCOPR2,DSCOPR3:
                                    DSCOPR4,DSCOPR5,DSCOPR6:
                                    DSCOPR7,DSCOPR8,DSCOPR9:
                                    DSCOPR10,DSCOPR11,DSCOPR12:
                                    DSCOPR13
            ADD       PTDSOPRS,FORM8
            STORE     FORM8,SPERIOD,DSCOPR1,DSCOPR2,DSCOPR3:
                                    DSCOPR4,DSCOPR5,DSCOPR6:
                                    DSCOPR7,DSCOPR8,DSCOPR9:
                                    DSCOPR10,DSCOPR11,DSCOPR12:
                                    DSCOPR13
.
            LOAD      FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
            ADD       PTDSBOPR,FORM8
            STORE     FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
.
            UPDATE   PSTTMP;KEY18:
                                DSCOPR1,DSCOPR2,DSCOPR3:
                                DSCOPR4,DSCOPR5,DSCOPR6:
                                DSCOPR7,DSCOPR8,DSCOPR9:
                                DSCOPR10,DSCOPR11,DSCOPR12:
                                DSCOPR13:
                                TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                DSBUDG13:
                                NAVDAY,RECFLG,SPARES
          ELSE
            CALL      CDAT0000
            STORE     PTDSOPRS,SPERIOD,DSCOPR1,DSCOPR2,DSCOPR3:
                                       DSCOPR4,DSCOPR5,DSCOPR6:
                                       DSCOPR7,DSCOPR8,DSCOPR9:
                                       DSCOPR10,DSCOPR11,DSCOPR12:
                                       DSCOPR13
            STORE     PTDSBOPR,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                       DSBUDG4,DSBUDG5,DSBUDG6:
                                       DSBUDG7,DSBUDG8,DSBUDG9:
                                       DSBUDG10,DSBUDG11,DSBUDG12:
                                       DSBUDG13
.
            WRITE     PSTTMP,KEY18;KEY18:
                                       DSCOPR1,DSCOPR2,DSCOPR3:
                                       DSCOPR4,DSCOPR5,DSCOPR6:
                                       DSCOPR7,DSCOPR8,DSCOPR9:
                                       DSCOPR10,DSCOPR11,DSCOPR12:
                                       DSCOPR13:
                                       YOPERS,YBEDS,YADMNS,YMBS:
                                       DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                       DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                       DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                       DSBUDG13:
                                       NAVDAY,RECFLG,SPARES
          ENDIF
.         ADD       ONE,UNIQUE
.
.        GRAND TOTALS   (T is moved to N in print and added)
.
          LOAD      FORM8,SPERIOD,TDSDOC1,TDSDOC2,TDSDOC3:
                                  TDSDOC4,TDSDOC5,TDSDOC6:
                                  TDSDOC7,TDSDOC8,TDSDOC9:
                                  TDSDOC10,TDSDOC11,TDSDOC12:
                                  TDSDOC13
          ADD       PTDSOPRS,FORM8
          STORE     FORM8,SPERIOD,TDSDOC1,TDSDOC2,TDSDOC3:
                                  TDSDOC4,TDSDOC5,TDSDOC6:
                                  TDSDOC7,TDSDOC8,TDSDOC9:
                                  TDSDOC10,TDSDOC11,TDSDOC12:
                                  TDSDOC13
          LOAD      FORM8,SPERIOD,TDBDOC1,TDBDOC2,TDBDOC3:
                                  TDBDOC4,TDBDOC5,TDBDOC6:
                                  TDBDOC7,TDBDOC8,TDBDOC9:
                                  TDBDOC10,TDBDOC11,TDBDOC12:
                                  TDBDOC13
          ADD       PTDSBOPR,FORM8
          STORE     FORM8,SPERIOD,TDBDOC1,TDBDOC2,TDBDOC3:
                                  TDBDOC4,TDBDOC5,TDBDOC6:
                                  TDBDOC7,TDBDOC8,TDBDOC9:
                                  TDBDOC10,TDBDOC11,TDBDOC12:
                                  TDBDOC13
          RETURN
.
...............................................................................
.
WRIT3A    MOVE      ONE,RECFLG              * Admission record
          MOVE      PTDSPERD,SPERIOD
          MOVE      RECFLG,UNIQUE
          MOVE      UNIQUE,DUNIQUE
          PACK      KEY19 WITH PTDSTYPE,DRTYPE,PTDSCODE,RECFLG,DUNIQUE
          CALL      RDATTMP
          IF        OVRCD = 0
            READ     PSTTMP,KEY19;PTDSTYPE,DRTYPE,PTDSCODE,DUNIQUE:
                                   DSCDSH1,DSCDSH2,DSCDSH3:
                                   DSCDSH4,DSCDSH5,DSCDSH6:
                                   DSCDSH7,DSCDSH8,DSCDSH9:
                                   DSCDSH10,DSCDSH11,DSCDSH12:
                                   DSCDSH13:
                                   TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                   DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                   DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                   DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                   DSBUDG13:
                                   NAVDAY,RECFLG,SPARES
            ADD       YOPERS,TTYOPERS
            ADD       YBEDS,TTYBEDS
            ADD       YADMNS,TTYADMNS
            ADD       YMBS,TTYMBS
            LOAD      FORM8,SPERIOD,DSCDSH1,DSCDSH2,DSCDSH3:
                                    DSCDSH4,DSCDSH5,DSCDSH6:
                                    DSCDSH7,DSCDSH8,DSCDSH9:
                                    DSCDSH10,DSCDSH11,DSCDSH12:
                                    DSCDSH13
            ADD       PTDSADMS,FORM8
            STORE     FORM8,SPERIOD,DSCDSH1,DSCDSH2,DSCDSH3:
                                    DSCDSH4,DSCDSH5,DSCDSH6:
                                    DSCDSH7,DSCDSH8,DSCDSH9:
                                    DSCDSH10,DSCDSH11,DSCDSH12:
                                    DSCDSH13
.
            LOAD      FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
            ADD       PTDSBADM,FORM8
            STORE     FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
.
            UPDATE   PSTTMP;PTDSTYPE,DRTYPE,PTDSCODE,DUNIQUE:
                                      DSCDSH1,DSCDSH2,DSCDSH3:
                                      DSCDSH4,DSCDSH5,DSCDSH6:
                                      DSCDSH7,DSCDSH8,DSCDSH9:
                                      DSCDSH10,DSCDSH11,DSCDSH12:
                                      DSCDSH13:
                                      TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                      DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                      DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                      DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                      DSBUDG13:
                                      NAVDAY,RECFLG,SPARES
          ELSE
            CALL      CDAT0000
            STORE     PTDSADMS,SPERIOD,DSCDSH1,DSCDSH2,DSCDSH3:
                                       DSCDSH4,DSCDSH5,DSCDSH6:
                                       DSCDSH7,DSCDSH8,DSCDSH9:
                                       DSCDSH10,DSCDSH11,DSCDSH12:
                                       DSCDSH13
            STORE     PTDSBADM,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
.
            WRITE     PSTTMP,KEY19;PTDSTYPE,DRTYPE,PTDSCODE,DUNIQUE:
                                   DSCDSH1,DSCDSH2,DSCDSH3:
                                   DSCDSH4,DSCDSH5,DSCDSH6:
                                   DSCDSH7,DSCDSH8,DSCDSH9:
                                   DSCDSH10,DSCDSH11,DSCDSH12:
                                   DSCDSH13:
                                   YOPERS,YBEDS,YADMNS,YMBS:
                                   DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                   DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                   DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                   DSBUDG13:
                                   NAVDAY,RECFLG,SPARES
          ENDIF
.         ADD       ONE,UNIQUE
.
          MOVE      TWO,RECFLG              * Bed days
          MOVE      RECFLG,UNIQUE
          MOVE      UNIQUE,DUNIQUE
          PACK      KEY19 WITH PTDSTYPE,DRTYPE,PTDSCODE,RECFLG,DUNIQUE
          CALL      RDATTMP
          IF        OVRCD = 0
            READ      PSTTMP,KEY19;PTDSTYPE,DRTYPE,PTDSCODE,DUNIQUE:
                                   DSCBED1,DSCBED2,DSCBED3:
                                   DSCBED4,DSCBED5,DSCBED6:
                                   DSCBED7,DSCBED8,DSCBED9:
                                   DSCBED10,DSCBED11,DSCBED12:
                                   DSCBED13:
                                   TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                   DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                   DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                   DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                   DSBUDG13:
                                   NAVDAY,RECFLG,SPARES
.
            ADD       YOPERS,TTYOPERS
            ADD       YBEDS,TTYBEDS
            ADD       YADMNS,TTYADMNS
            ADD       YMBS,TTYMBS
            LOAD      FORM8,SPERIOD,DSCBED1,DSCBED2,DSCBED3:
                                    DSCBED4,DSCBED5,DSCBED6:
                                    DSCBED7,DSCBED8,DSCBED9:
                                    DSCBED10,DSCBED11,DSCBED12:
                                    DSCBED13
            ADD       PTDSBEDD,FORM8
            STORE     FORM8,SPERIOD,DSCBED1,DSCBED2,DSCBED3:
                                    DSCBED4,DSCBED5,DSCBED6:
                                    DSCBED7,DSCBED8,DSCBED9:
                                    DSCBED10,DSCBED11,DSCBED12:
                                    DSCBED13
.
            LOAD      FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
            ADD       PTDSBEDD,FORM8
            STORE     FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
.
            UPDATE   PSTTMP;PTDSTYPE,DRTYPE,PTDSCODE,DUNIQUE:
                                      DSCBED1,DSCBED2,DSCBED3:
                                      DSCBED4,DSCBED5,DSCBED6:
                                      DSCBED7,DSCBED8,DSCBED9:
                                      DSCBED10,DSCBED11,DSCBED12:
                                      DSCBED13:
                                      TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                      DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                      DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                      DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                      DSBUDG13:
                                      NAVDAY,RECFLG,SPARES
          ELSE
            CALL      CDAT0000
            STORE     PTDSBEDD,SPERIOD,DSCBED1,DSCBED2,DSCBED3:
                                       DSCBED4,DSCBED5,DSCBED6:
                                       DSCBED7,DSCBED8,DSCBED9:
                                       DSCBED10,DSCBED11,DSCBED12:
                                       DSCBED13
            STORE     PTDSBBED,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                       DSBUDG4,DSBUDG5,DSBUDG6:
                                       DSBUDG7,DSBUDG8,DSBUDG9:
                                       DSBUDG10,DSBUDG11,DSBUDG12:
                                       DSBUDG13
.
            WRITE     PSTTMP,KEY19;PTDSTYPE,DRTYPE,PTDSCODE,DUNIQUE:
                                   DSCBED1,DSCBED2,DSCBED3:
                                   DSCBED4,DSCBED5,DSCBED6:
                                   DSCBED7,DSCBED8,DSCBED9:
                                   DSCBED10,DSCBED11,DSCBED12:
                                   DSCBED13:
                                   YOPERS,YBEDS,YADMNS,YMBS:
                                   DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                   DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                   DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                   DSBUDG13:
                                   NAVDAY,RECFLG,SPARES
          ENDIF
.         ADD       ONE,UNIQUE
.
          MOVE      THREE,RECFLG            * Operations
          MOVE      RECFLG,UNIQUE
          MOVE      UNIQUE,DUNIQUE
          PACK      KEY19 WITH PTDSTYPE,DRTYPE,PTDSCODE,RECFLG,DUNIQUE
          CALL      RDATTMP
          IF        OVRCD = 0
            READ     PSTTMP,KEY19;PTDSTYPE,DRTYPE,PTDSCODE,DUNIQUE:
                                  DSCOPR1,DSCOPR2,DSCOPR3:
                                  DSCOPR4,DSCOPR5,DSCOPR6:
                                  DSCOPR7,DSCOPR8,DSCOPR9:
                                  DSCOPR10,DSCOPR11,DSCOPR12:
                                  DSCOPR13:
                                  TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                  DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                  DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                  DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                  DSBUDG13:
                                  NAVDAY,RECFLG,SPARES
.
            ADD       YOPERS,TTYOPERS
            ADD       YBEDS,TTYBEDS
            ADD       YADMNS,TTYADMNS
            ADD       YMBS,TTYMBS
            LOAD      FORM8,SPERIOD,DSCOPR1,DSCOPR2,DSCOPR3:
                                    DSCOPR4,DSCOPR5,DSCOPR6:
                                    DSCOPR7,DSCOPR8,DSCOPR9:
                                    DSCOPR10,DSCOPR11,DSCOPR12:
                                    DSCOPR13
            ADD       PTDSOPRS,FORM8
            STORE     FORM8,SPERIOD,DSCOPR1,DSCOPR2,DSCOPR3:
                                    DSCOPR4,DSCOPR5,DSCOPR6:
                                    DSCOPR7,DSCOPR8,DSCOPR9:
                                    DSCOPR10,DSCOPR11,DSCOPR12:
                                    DSCOPR13
.
            LOAD      FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
            ADD       PTDSBOPR,FORM8
            STORE     FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
.
            UPDATE   PSTTMP;PTDSTYPE,DRTYPE,PTDSCODE,DUNIQUE:
                                     DSCOPR1,DSCOPR2,DSCOPR3:
                                     DSCOPR4,DSCOPR5,DSCOPR6:
                                     DSCOPR7,DSCOPR8,DSCOPR9:
                                     DSCOPR10,DSCOPR11,DSCOPR12:
                                     DSCOPR13:
                                     TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                     DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                     DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                     DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                     DSBUDG13:
                                     NAVDAY,RECFLG,SPARES
          ELSE
            CALL      CDAT0000
            STORE     PTDSOPRS,SPERIOD,DSCOPR1,DSCOPR2,DSCOPR3:
                                       DSCOPR4,DSCOPR5,DSCOPR6:
                                       DSCOPR7,DSCOPR8,DSCOPR9:
                                       DSCOPR10,DSCOPR11,DSCOPR12:
                                       DSCOPR13
            STORE     PTDSBOPR,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                       DSBUDG4,DSBUDG5,DSBUDG6:
                                       DSBUDG7,DSBUDG8,DSBUDG9:
                                       DSBUDG10,DSBUDG11,DSBUDG12:
                                       DSBUDG13
.
            WRITE     PSTTMP,KEY19;PTDSTYPE,DRTYPE,PTDSCODE,DUNIQUE:
                                   DSCOPR1,DSCOPR2,DSCOPR3:
                                   DSCOPR4,DSCOPR5,DSCOPR6:
                                   DSCOPR7,DSCOPR8,DSCOPR9:
                                   DSCOPR10,DSCOPR11,DSCOPR12:
                                   DSCOPR13:
                                   YOPERS,YBEDS,YADMNS,YMBS:
                                   DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                   DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                   DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                   DSBUDG13:
                                   NAVDAY,RECFLG,SPARES
          ENDIF
.         ADD       ONE,UNIQUE
          RETURN
.
...............................................................................
.
WRIT4     PACK      KEY18 WITH PTDSTYPE,DRTYPE,PTDSCODE,UNIQUE
          MOVE      PTDSPERD,SPERIOD
          CALL      RDATTMP
          IF        OVRCD = 0
            READ     PSTTMP,KEY18;KEY18:
                                  DSXOPR1,DSXOPR2,DSXOPR3:
                                  DSXOPR4,DSXOPR5,DSXOPR6:
                                  DSXOPR7,DSXOPR8,DSXOPR9:
                                  DSXOPR10,DSXOPR11,DSXOPR12:
                                  DSXOPR13:
                                  TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                  DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                  DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                  DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                  DSBUDG13:
                                  NAVDAY,RECFLG,SPARES
.
            ADD       YOPERS,TTYOPERS
            ADD       YBEDS,TTYBEDS
            ADD       YADMNS,TTYADMNS
            ADD       YMBS,TTYMBS
            LOAD      FORM8,SPERIOD,DSXOPR1,DSXOPR2,DSXOPR3:
                                    DSXOPR4,DSXOPR5,DSXOPR6:
                                    DSXOPR7,DSXOPR8,DSXOPR9:
                                    DSXOPR10,DSXOPR11,DSXOPR12:
                                    DSXOPR13
            ADD       PTDSMBSC,FORM8
            STORE     FORM8,SPERIOD,DSXOPR1,DSXOPR2,DSXOPR3:
                                    DSXOPR4,DSXOPR5,DSXOPR6:
                                    DSXOPR7,DSXOPR8,DSXOPR9:
                                    DSXOPR10,DSXOPR11,DSXOPR12:
                                    DSXOPR13
.
            LOAD      FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
            ADD       PTDSBMBS,FORM8
            STORE     FORM8,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                    DSBUDG4,DSBUDG5,DSBUDG6:
                                    DSBUDG7,DSBUDG8,DSBUDG9:
                                    DSBUDG10,DSBUDG11,DSBUDG12:
                                    DSBUDG13
.
            UPDATE   PSTTMP;KEY18:
                                DSXOPR1,DSXOPR2,DSXOPR3:
                                DSXOPR4,DSXOPR5,DSXOPR6:
                                DSXOPR7,DSXOPR8,DSXOPR9:
                                DSXOPR10,DSXOPR11,DSXOPR12:
                                DSXOPR13:
                                TTYOPERS,TTYBEDS,TTYADMNS,TTYMBS:
                                DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                DSBUDG13:
                                NAVDAY,RECFLG,SPARES            
          ELSE
            CALL      CDAT0000
            STORE     PTDSMBSC,SPERIOD,DSXOPR1,DSXOPR2,DSXOPR3:
                                       DSXOPR4,DSXOPR5,DSXOPR6:
                                       DSXOPR7,DSXOPR8,DSXOPR9:
                                       DSXOPR10,DSXOPR11,DSXOPR12:
                                       DSXOPR13
            STORE     PTDSBMBS,SPERIOD,DSBUDG1,DSBUDG2,DSBUDG3:
                                       DSBUDG4,DSBUDG5,DSBUDG6:
                                       DSBUDG7,DSBUDG8,DSBUDG9:
                                       DSBUDG10,DSBUDG11,DSBUDG12:
                                       DSBUDG13
.
            WRITE     PSTTMP,KEY18;KEY18:
                                   DSXOPR1,DSXOPR2,DSXOPR3:
                                   DSXOPR4,DSXOPR5,DSXOPR6:
                                   DSXOPR7,DSXOPR8,DSXOPR9:
                                   DSXOPR10,DSXOPR11,DSXOPR12:
                                   DSXOPR13:
                                   YOPERS,YBEDS,YADMNS,YMBS:
                                   DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                   DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                   DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                   DSBUDG13:
                                   NAVDAY,RECFLG,SPARES
          ENDIF
.         ADD       ONE,UNIQUE
.
.         GRAND TOTALS   (T is moved to N in print and added)
.
          LOAD      FORM8,SPERIOD,TDSDOC1,TDSDOC2,TDSDOC3:
                                  TDSDOC4,TDSDOC5,TDSDOC6:
                                  TDSDOC7,TDSDOC8,TDSDOC9:
                                  TDSDOC10,TDSDOC11,TDSDOC12:
                                  TDSDOC13
          ADD       PTDSMBSC,FORM8
          STORE     FORM8,SPERIOD,TDSDOC1,TDSDOC2,TDSDOC3:
                                  TDSDOC4,TDSDOC5,TDSDOC6:
                                  TDSDOC7,TDSDOC8,TDSDOC9:
                                  TDSDOC10,TDSDOC11,TDSDOC12:
                                  TDSDOC13
          LOAD      FORM8,SPERIOD,TDBDOC1,TDBDOC2,TDBDOC3:
                                  TDBDOC4,TDBDOC5,TDBDOC6:
                                  TDBDOC7,TDBDOC8,TDBDOC9:
                                  TDBDOC10,TDBDOC11,TDBDOC12:
                                  TDBDOC13
          ADD       PTDSBMBS,FORM8
          STORE     FORM8,SPERIOD,TDBDOC1,TDBDOC2,TDBDOC3:
                                  TDBDOC4,TDBDOC5,TDBDOC6:
                                  TDBDOC7,TDBDOC8,TDBDOC9:
                                  TDBDOC10,TDBDOC11,TDBDOC12:
                                  TDBDOC13
          RETURN
.
...............................................................................
.
.     READ ACTUAL DATA
.
READDA    COMPARE   ZERO,STRTFLAG
          GOTO      NODATA IF EQUAL
.
          MOVE      ZERO,STRTFLAG
          MOVE      "60",CLNO
.
          COMPARE   EIGHT,OPTION
          GOTO      READ10 IF EQUAL
.
          MOVE      SP20,KEY18
          READ      PSTTMP,KEY18;;
          GOTO      READ20
.
READ10    MOVE      SP20,KEY19
          READ      PSTTMP,KEY19;;
.
READ20    
          CALL      ZEROS
.
          DISPLAY   *P5:24,*EL,"Generating :";
.
NEXTT     READKS    PSTTMP;DSTYPE,DRTYPE,DSCODE,DUNIQUE:
                                 DSCDSH1,DSCDSH2,DSCDSH3:
                                 DSCDSH4,DSCDSH5,DSCDSH6:
                                 DSCDSH7,DSCDSH8,DSCDSH9:
                                 DSCDSH10,DSCDSH11,DSCDSH12:
                                 DSCDSH13:
                                 YOPERS,YBEDS,YADMNS,YMBS:
                                 DSBUDG1,DSBUDG2,DSBUDG3,DSBUDG4:
                                 DSBUDG5,DSBUDG6,DSBUDG7,DSBUDG8:
                                 DSBUDG9,DSBUDG10,DSBUDG11,DSBUDG12:
                                 DSBUDG13:
                                 NAVDAY,RECFLG,SPARES
          GOTO      ENDP IF OVER
          CALL      PRNTDA
          DISPLAY   *P20:24,*V2LON,DSCODE;
          CALL      TOTSUB
          GOTO      NEXTT
.
+
.
.     PRINT ACTUAL PRNT
.
PRNTDA    COMPARE   "55",CLNO
          CALL      HEAD IF NOT LESS
.
          COMPARE   EIGHT,OPTION
          GOTO      PRNTBCH IF EQUAL
.
          BRANCH    STRTFLAG OF CHKTYP
          MOVE      DRTYPE,SDRTYPE
          MOVE      ONE,STRTFLAG
.
CHKTYP    MATCH     DRTYPE,SDRTYPE
          GOTO      PRNTBCH IF EQUAL
.
          CALL      PAGSEP
          CALL      PRNTSUB
          CALL      PAGSEP
.
.         NEW PAGE PER DOCTOR TYPE
.
          COMPARE   "50",CLNO
          GOTO      MID1 IF LESS
          CALL      HEAD
          GOTO      PRNTBCH
.
MID1      CALL      MIDHD
.
PRNTBCH   MOVE      SP30,DGNAME
          MOVE      SP30,DSNAME
          MOVE      SP30,DTITL
.
          MATCH     "NODOCT",DSCODE
          GOTO      OKDOC IF NOT EQUAL
.
          CLEAR     DNAME
          APPEND    "NO ",DNAME
          APPEND    DOCTOR,DNAME
          APPEND    SP30,DNAME
          RESET     DNAME
.
          GOTO      OKDOCN
.
OKDOC     MOVE      DSCODE,KEY6
          CALL      RDDOCT1
.
          MATCH     SP20,DSNAME
          GOTO      BADDOC IF EQUAL
.
          MOVE      DGNAME,ANS
          MOVE      DTITL,DIM4
          PACK      DNAME WITH DIM4,SP1,ANS,DOT,DSNAME,SP20
          GOTO      OKDOCN
.
BADDOC    CLEAR     DNAME
          APPEND    "MISSING ",DNAME,
          APPEND    "NAME: ",DNAME
          APPEND    DSCODE,DNAME
          APPEND    SP20,DNAME
          RESET     DNAME
.
OKDOCN    CALL      CHKZERO               * Ignore if all figures are zero
          BRANCH    EXIT OF PRNT9
.
          COMPARE   TEN2,NUMPERS
          GOTO      OKD13N IF NOT EQUAL
.
          BRANCH    OPTION OF PRNT1,PRNT1,PRNT1,PRNT2,PRNT2:
                              PRNT3,PRNT3,PRNT3A,PRNT4,PRNT4
          GOTO      PRNT1
.
OKD13N    MOVE      DNAME,DNAMESH
          BRANCH    OPTION OF P13T1,P13T1,P13T1,P13T2,P13T2:
                              P13T3,P13T3,P13T3A,P13T4,P13T4
          GOTO      P13T1
.
PRNT1     PRINT     *1,"| ",DNAME:
                    *30,"| ",DSCDSH1,*36,"| ",DSCDSH2,*42,"| ",DSCDSH3:
                    *48,"| ",DSCDSH4,*54,"| ",DSCDSH5,*60,"| ",DSCDSH6:
                    *66,"| ",DSCDSH7,*72,"| ",DSCDSH8,*78,"| ",DSCDSH9:
                    *84,"| ",DSCDSH10,*90,"| ",DSCDSH11,*96,"| ",DSCDSH12:
                    *102,"|  ",YBEDS,*109,"|  ":
                    *109,"| ",YADMNS,*117,"| ",NAVDAY,*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG:
                    *30,"| ",DSBUDG1,*36,"| ",DSBUDG2,*42,"| ",DSBUDG3:
                    *48,"| ",DSBUDG4,*54,"| ",DSBUDG5,*60,"| ",DSBUDG6:
                    *66,"| ",DSBUDG7,*72,"| ",DSBUDG8,*78,"| ",DSBUDG9:
                    *84,"| ",DSBUDG10,*90,"| ",DSBUDG11,*96,"| ",DSBUDG12:
                    *102,"|  ":
                    *109,"| ",*117,"| ",*125,"|"
          ADD       ONE,CLNO
          RETURN
.
P13T1     PRINT     *1,"| ",DNAMESH,*24,"| ",DSCDSH1:
                    *30,"| ",DSCDSH2,*36,"| ",DSCDSH3,*42,"| ",DSCDSH4:
                    *48,"| ",DSCDSH5,*54,"| ",DSCDSH6,*60,"| ",DSCDSH7:
                    *66,"| ",DSCDSH8,*72,"| ",DSCDSH9,*78,"| ",DSCDSH10:
                    *84,"| ",DSCDSH11,*90,"| ",DSCDSH12,*96,"| ",DSCDSH13:
                    *102,"|  ",YBEDS,*109,"|  ":
                    *109,"|  ",YADMNS,*117,"| ",NAVDAY,*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG,*24,"| ",DSBUDG1:
                    *30,"| ",DSBUDG2,*36,"| ",DSBUDG3,*42,"| ",DSBUDG4:
                    *48,"| ",DSBUDG5,*54,"| ",DSBUDG6,*60,"| ",DSBUDG7:
                    *66,"| ",DSBUDG8,*72,"| ",DSBUDG9,*78,"| ",DSBUDG10:
                    *84,"| ",DSBUDG11,*90,"| ",DSBUDG12,*96,"| ",DSBUDG13:
                    *102,"|  ":
                    *109,"|  ",*117,"| ",*125,"|"
          ADD       ONE,CLNO
          RETURN
.
PRNT2     PRINT     *1,"| ",DNAME:
                    *30,"| ",DSCDSH1,*36,"| ",DSCDSH2,*42,"| ",DSCDSH3:
                    *48,"| ",DSCDSH4,*54,"| ",DSCDSH5,*60,"| ",DSCDSH6:
                    *66,"| ",DSCDSH7,*72,"| ",DSCDSH8,*78,"| ",DSCDSH9:
                    *84,"| ",DSCDSH10,*90,"| ",DSCDSH11,*96,"| ",DSCDSH12:
                    *102,"|  ",YADMNS,*110,"|  ":
                    *110,"|  ",YBEDS,*117,"| ",NAVDAY,*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG:
                    *30,"| ",DSBUDG1,*36,"| ",DSBUDG2,*42,"| ",DSBUDG3:
                    *48,"| ",DSBUDG4,*54,"| ",DSBUDG5,*60,"| ",DSBUDG6:
                    *66,"| ",DSBUDG7,*72,"| ",DSBUDG8,*78,"| ",DSBUDG9:
                    *84,"| ",DSBUDG10,*90,"| ",DSBUDG11,*96,"| ",DSBUDG12:
                    *102,"|  ",*110,"|  ":
                    *110,"|  ",*117,"| ",*125,"|"
          ADD       ONE,CLNO
          RETURN
.
P13T2     PRINT     *1,"| ",DNAMESH,*24,"| ",DSCDSH1:
                    *30,"| ",DSCDSH2,*36,"| ",DSCDSH3,*42,"| ",DSCDSH4:
                    *48,"| ",DSCDSH5,*54,"| ",DSCDSH6,*60,"| ",DSCDSH7:
                    *66,"| ",DSCDSH8,*72,"| ",DSCDSH9,*78,"| ",DSCDSH10:
                    *84,"| ",DSCDSH11,*90,"| ",DSCDSH12,*96,"| ",DSCDSH13:
                    *102,"|  ",YADMNS:
                    *110,"|  ",YBEDS,*117,"| ",NAVDAY,*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG,*24,"| ",DSBUDG1:
                    *30,"| ",DSBUDG2,*36,"| ",DSBUDG3,*42,"| ",DSBUDG4:
                    *48,"| ",DSBUDG5,*54,"| ",DSBUDG6,*60,"| ",DSBUDG7:
                    *66,"| ",DSBUDG8,*72,"| ",DSBUDG9,*78,"| ",DSBUDG10:
                    *84,"| ",DSBUDG11,*90,"| ",DSBUDG12,*96,"| ",DSBUDG13:
                    *102,"|  ":
                    *110,"|  ",*117,"| ",*125,"|"
          ADD       ONE,CLNO
          RETURN
.
PRNT3     PRINT     *1,"| ",DNAME:
                    *30,"| ",DSCDSH1,*36,"| ",DSCDSH2,*42,"| ",DSCDSH3:
                    *48,"| ",DSCDSH4,*54,"| ",DSCDSH5,*60,"| ",DSCDSH6:
                    *66,"| ",DSCDSH7,*72,"| ",DSCDSH8,*78,"| ",DSCDSH9:
                    *84,"| ",DSCDSH10,*90,"| ",DSCDSH11,*96,"| ",DSCDSH12:
                    *102,"|  ",YOPERS:
                    *109,"|  ",YBEDS,*116,"|  ",YADMNS,*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG:
                    *30,"| ",DSBUDG1,*36,"| ",DSBUDG2,*42,"| ",DSBUDG3:
                    *48,"| ",DSBUDG4,*54,"| ",DSBUDG5,*60,"| ",DSBUDG6:
                    *66,"| ",DSBUDG7,*72,"| ",DSBUDG8,*78,"| ",DSBUDG9:
                    *84,"| ",DSBUDG10,*90,"| ",DSBUDG11,*96,"| ",DSBUDG12:
                    *102,"|  ":
                    *109,"|  ",*116,"|  ",*125,"|"
          ADD       ONE,CLNO
          RETURN
.
P13T3     PRINT     *1,"| ",DNAMESH,*24,"| ",DSCDSH1:
                    *30,"| ",DSCDSH2,*36,"| ",DSCDSH3,*42,"| ",DSCDSH4:
                    *48,"| ",DSCDSH5,*54,"| ",DSCDSH6,*60,"| ",DSCDSH7:
                    *66,"| ",DSCDSH8,*72,"| ",DSCDSH9,*78,"| ",DSCDSH10:
                    *84,"| ",DSCDSH11,*90,"| ",DSCDSH12,*96,"| ",DSCDSH13:
                    *102,"|  ",YOPERS:
                    *109,"|  ",YBEDS,*116,"|   ",YADMNS,*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG,*24,"| ",DSBUDG1:
                    *30,"| ",DSBUDG2,*36,"| ",DSBUDG3,*42,"| ",DSBUDG4:
                    *48,"| ",DSBUDG5,*54,"| ",DSBUDG6,*60,"| ",DSBUDG7:
                    *66,"| ",DSBUDG8,*72,"| ",DSBUDG9,*78,"| ",DSBUDG10:
                    *84,"| ",DSBUDG11,*90,"| ",DSBUDG12,*96,"| ",DSBUDG13:
                    *102,"|  ":
                    *109,"|  ",*116,"|   ",*125,"|"
          ADD       ONE,CLNO
          RETURN
.
.         RECFLG = 1 - Admissions, 2 - Bed days, 3 - Operations
.
PRNT3A    PACK      DIM22,DNAME,SP10
          MOVE      RECFLG,FORM1
          BRANCH    FORM1 OF PRNT3B,PRNT3C,PRNT3D
.
PRNT3B    PRINT     *1,"| ",DIM22,*26,"(",DSTYPE,")":
                    *30,"| ",DSCDSH1,*36,"| ",DSCDSH2,*42,"| ",DSCDSH3:
                    *48,"| ",DSCDSH4,*54,"| ",DSCDSH5,*60,"| ",DSCDSH6:
                    *66,"| ",DSCDSH7,*72,"| ",DSCDSH8,*78,"| ",DSCDSH9:
                    *84,"| ",DSCDSH10,*90,"| ",DSCDSH11,*96,"| ",DSCDSH12:
                    *102,"|",YADMNS:
                    *108,"| ",NAVDAY,*116,"|Admis.",*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG,*26,"(",DSTYPE,")":
                    *30,"| ",DSBUDG1,*36,"| ",DSBUDG2,*42,"| ",DSBUDG3:
                    *48,"| ",DSBUDG4,*54,"| ",DSBUDG5,*60,"| ",DSBUDG6:
                    *66,"| ",DSBUDG7,*72,"| ",DSBUDG8,*78,"| ",DSBUDG9:
                    *84,"| ",DSBUDG10,*90,"| ",DSBUDG11,*96,"| ",DSBUDG12:
                    *102,"|":
                    *108,"| ",*116,*125,"|"
          ADD       ONE,CLNO
          RETURN
.
PRNT3C    PRINT     *1,"| ",DIM22,*26,"(",DSTYPE,")":
                    *30,"| ",DSCDSH1,*36,"| ",DSCDSH2,*42,"| ",DSCDSH3:
                    *48,"| ",DSCDSH4,*54,"| ",DSCDSH5,*60,"| ",DSCDSH6:
                    *66,"| ",DSCDSH7,*72,"| ",DSCDSH8,*78,"| ",DSCDSH9:
                    *84,"| ",DSCDSH10,*90,"| ",DSCDSH11,*96,"| ",DSCDSH12:
                    *102,"| ",YBEDS:
                    *108,"|",*116,"|Bed days",*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG,*26,"(",DSTYPE,")":
                    *30,"| ",DSBUDG1,*36,"| ",DSBUDG2,*42,"| ",DSBUDG3:
                    *48,"| ",DSBUDG4,*54,"| ",DSBUDG5,*60,"| ",DSBUDG6:
                    *66,"| ",DSBUDG7,*72,"| ",DSBUDG8,*78,"| ",DSBUDG9:
                    *84,"| ",DSBUDG10,*90,"| ",DSBUDG11,*96,"| ",DSBUDG12:
                    *102,"| ":
                    *108,"|",*116,*125,"|"
          ADD       ONE,CLNO
          RETURN
.
PRNT3D    PRINT     *1,"| ",DIM22,*26,"(",DSTYPE,")":
                    *30,"| ",DSCDSH1,*36,"| ",DSCDSH2,*42,"| ",DSCDSH3:
                    *48,"| ",DSCDSH4,*54,"| ",DSCDSH5,*60,"| ",DSCDSH6:
                    *66,"| ",DSCDSH7,*72,"| ",DSCDSH8,*78,"| ",DSCDSH9:
                    *84,"| ",DSCDSH10,*90,"| ",DSCDSH11,*96,"| ",DSCDSH12:
                    *102,"| ",YOPERS:
                    *108,"|",*116,"|Oper.",*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG,*26,"(",DSTYPE,")":
                    *30,"| ",DSBUDG1,*36,"| ",DSBUDG2,*42,"| ",DSBUDG3:
                    *48,"| ",DSBUDG4,*54,"| ",DSBUDG5,*60,"| ",DSBUDG6:
                    *66,"| ",DSBUDG7,*72,"| ",DSBUDG8,*78,"| ",DSBUDG9:
                    *84,"| ",DSBUDG10,*90,"| ",DSBUDG11,*96,"| ",DSBUDG12:
                    *102,"| ":
                    *108,"|",*116,*125,"|"
          ADD       ONE,CLNO
          CALL      PAGEND
          RETURN
.
P13T3A    PACK      DIM16,DNAMESH,SP10
          MOVE      RECFLG,FORM1
          BRANCH    FORM1 OF P13T3B,P13T3C,P13T3D
.
P13T3B    PRINT     *1,"| ",DIM16,*20,"(",DSTYPE,")",*24,"| ",DSCDSH1:
                    *30,"| ",DSCDSH2,*36,"| ",DSCDSH3,*42,"| ",DSCDSH4:
                    *48,"| ",DSCDSH5,*54,"| ",DSCDSH6,*60,"| ",DSCDSH7:
                    *66,"| ",DSCDSH8,*72,"| ",DSCDSH9,*78,"| ",DSCDSH10:
                    *84,"| ",DSCDSH11,*90,"| ",DSCDSH12,*96,"| ",DSCDSH13:
                    *102,"|",YADMNS:
                    *108,"| ",NAVDAY,*116,"|Admis.",*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG,*20,"(",DSTYPE,")",*24,"| ",DSBUDG1:
                    *30,"| ",DSBUDG2,*36,"| ",DSBUDG3,*42,"| ",DSBUDG4:
                    *48,"| ",DSBUDG5,*54,"| ",DSBUDG6,*60,"| ",DSBUDG7:
                    *66,"| ",DSBUDG8,*72,"| ",DSBUDG9,*78,"| ",DSBUDG10:
                    *84,"| ",DSBUDG11,*90,"| ",DSBUDG12,*96,"| ",DSBUDG13:
                    *102,"|":
                    *108,"| ",*116,*125,"|"
          ADD       ONE,CLNO
          RETURN
.
P13T3C    PRINT     *1,"| ",DIM16,*20,"(",DSTYPE,")",*24,"| ",DSCDSH1:
                    *30,"| ",DSCDSH2,*36,"| ",DSCDSH3,*42,"| ",DSCDSH4:
                    *48,"| ",DSCDSH5,*54,"| ",DSCDSH6,*60,"| ",DSCDSH7:
                    *66,"| ",DSCDSH8,*72,"| ",DSCDSH9,*78,"| ",DSCDSH10:
                    *84,"| ",DSCDSH11,*90,"| ",DSCDSH12,*96,"| ",DSCDSH13:
                    *102,"| ",YBEDS:
                    *108,"| ",*116,"|Bed days",*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG,*20,"(",DSTYPE,")",*24,"| ",DSBUDG1:
                    *30,"| ",DSBUDG2,*36,"| ",DSBUDG3,*42,"| ",DSBUDG4:
                    *48,"| ",DSBUDG5,*54,"| ",DSBUDG6,*60,"| ",DSBUDG7:
                    *66,"| ",DSBUDG8,*72,"| ",DSBUDG9,*78,"| ",DSBUDG10:
                    *84,"| ",DSBUDG11,*90,"| ",DSBUDG12,*96,"| ",DSBUDG13:
                    *102,"| ":
                    *108,"| ",*116,*125,"|"
          ADD       ONE,CLNO
          RETURN
.
P13T3D    PRINT     *1,"| ",DIM16,*20,"(",DSTYPE,")",*24,"| ",DSCDSH1:
                    *30,"| ",DSCDSH2,*36,"| ",DSCDSH3,*42,"| ",DSCDSH4:
                    *48,"| ",DSCDSH5,*54,"| ",DSCDSH6,*60,"| ",DSCDSH7:
                    *66,"| ",DSCDSH8,*72,"| ",DSCDSH9,*78,"| ",DSCDSH10:
                    *84,"| ",DSCDSH11,*90,"| ",DSCDSH12,*96,"| ",DSCDSH13:
                    *102,"| ",YOPERS,*108,"|  ":
                    *108,"|",*116,"|Oper.",*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG,*20,"(",DSTYPE,")",*24,"| ",DSBUDG1:
                    *30,"| ",DSBUDG2,*36,"| ",DSBUDG3,*42,"| ",DSBUDG4:
                    *48,"| ",DSBUDG5,*54,"| ",DSBUDG6,*60,"| ",DSBUDG7:
                    *66,"| ",DSBUDG8,*72,"| ",DSBUDG9,*78,"| ",DSBUDG10:
                    *84,"| ",DSBUDG11,*90,"| ",DSBUDG12,*96,"| ",DSBUDG13:
                    *102,"| ":
                    *108,"|",*116,*125,"|"
          ADD       ONE,CLNO
          CALL      PAGEND
          RETURN
.
PRNT4     PRINT     *1,"| ",DNAME:
                    *30,"| ",DSCDSH1,*36,"| ",DSCDSH2,*42,"| ",DSCDSH3:
                    *48,"| ",DSCDSH4,*54,"| ",DSCDSH5,*60,"| ",DSCDSH6:
                    *66,"| ",DSCDSH7,*72,"| ",DSCDSH8,*78,"| ",DSCDSH9:
                    *84,"| ",DSCDSH10,*90,"| ",DSCDSH11,*96,"| ",DSCDSH12:
                    *102,"|  ",YMBS:
                    *109,"|  ",YBEDS,*116,"|   ",YADMNS,*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG:
                    *30,"| ",DSBUDG1,*36,"| ",DSBUDG2,*42,"| ",DSBUDG3:
                    *48,"| ",DSBUDG4,*54,"| ",DSBUDG5,*60,"| ",DSBUDG6:
                    *66,"| ",DSBUDG7,*72,"| ",DSBUDG8,*78,"| ",DSBUDG9:
                    *84,"| ",DSBUDG10,*90,"| ",DSBUDG11,*96,"| ",DSBUDG12:
                    *102,"|  ":
                    *109,"|  ",*116,"|   ",*125,"|"
          ADD       ONE,CLNO
          RETURN
.
P13T4     PRINT     *1,"| ",DNAMESH,*24,"| ",DSBUDG1:
                    *30,"| ",DSCDSH2,*36,"| ",DSCDSH3,*42,"| ",DSCDSH4:
                    *48,"| ",DSCDSH5,*54,"| ",DSCDSH6,*60,"| ",DSCDSH7:
                    *66,"| ",DSCDSH8,*72,"| ",DSCDSH9,*78,"| ",DSCDSH10:
                    *84,"| ",DSCDSH11,*90,"| ",DSCDSH12,*96,"| ",DSCDSH13:
                    *102,"|  ",YMBS:
                    *109,"|  ",YBEDS,*116,"|   ",YADMNS,*125,"|"
          ADD       ONE,CLNO
          PRINT     *1,"| ",DBUDG,*24,"| ",DSBUDG1:
                    *30,"| ",DSBUDG2,*36,"| ",DSBUDG3,*42,"| ",DSBUDG4:
                    *48,"| ",DSBUDG5,*54,"| ",DSBUDG6,*60,"| ",DSBUDG7:
                    *66,"| ",DSBUDG8,*72,"| ",DSBUDG9,*78,"| ",DSBUDG10:
                    *84,"| ",DSBUDG11,*90,"| ",DSBUDG12,*96,"| ",DSBUDG13:
                    *102,"|  ":
                    *109,"|  ",*116,"|   ",*125,"|"
          ADD       ONE,CLNO
PRNT9     RETURN
.
.         Check if the doctor has got any adms/bed days/opers or budgets
.
CHKZERO   MOVE      ZERO,EXIT             * initialise, ok to print
          COMPARE   ZERO,YBEDS
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,YADMNS
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,YOPERS
          GOTO      CHKZ999 IF NOT EQUAL

          COMPARE   ZERO,DSBUDG1
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG2
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG3
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG4
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG5
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG6
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG7
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG8
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG9
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG10
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG11
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG12
          GOTO      CHKZ999 IF NOT EQUAL
          COMPARE   ZERO,DSBUDG13
          GOTO      CHKZ999 IF NOT EQUAL
.
CHKZ900   MOVE      ONE,EXIT
CHKZ999   RETURN
.
.    PRINT SUB TOTALS
.
PRNTSUB   MOVE      "DT",TCODE
          CLEAR     TDESC
          APPEND    "UNKNOWN ",TDESC
          APPEND    DOCTOR,TDESC
          APPEND    " TYPE",TDESC
          APPEND    SP20,TDESC
          RESET     TDESC
          MATCH     SP3,SDRTYPE
          GOTO      UNKDC IF EQUAL
.
          PACK      KEY5 WITH TCODE,SDRTYPE
          CALL      RDCODE1
UNKDC     MOVE      DRTYPE,SDRTYPE
          MOVE      ZERO,SNAVDAY
.
          COMPARE   ZERO,STYADMNS
          GOTO      PRTTSUB IF EQUAL
.
          MOVE      STYBEDS,STAVDAY
          DIV       STYADMNS,STAVDAY
          MOVE      STAVDAY,SNAVDAY
.
PRTTSUB   COMPARE   TEN2,NUMPERS
          GOTO      P13TSUB IF NOT EQUAL
.
          BRANCH    OPTION OF PRSUB1,PRSUB1,PRSUB1,PRSUB2,PRSUB2:
                              PRSUB3,PRSUB3,ENDSUB1,PRSUB4,PRSUB4
          GOTO      PRSUB1
.
P13TSUB   BRANCH    OPTION OF P13SUB1,P13SUB1,P13SUB1,P13SUB2,P13SUB2:
                              P13SUB3,P13SUB3,ENDSUB1,P13SUB4,P13SUB4
          GOTO      P13SUB1
.
PRSUB1    PRINT     *1,"| ",TDESC:
                    *30,"| ",SUBDOC1,*36,"| ",SUBDOC2,*42,"| ",SUBDOC3:
                    *48,"| ",SUBDOC4,*54,"| ",SUBDOC5,*60,"| ",SUBDOC6:
                    *66,"| ",SUBDOC7,*72,"| ",SUBDOC8,*78,"| ",SUBDOC9:
                    *84,"| ",SUBDOC10,*90,"| ",SUBDOC11,*96,"| ",SUBDOC12:
                    *102,"|",STYBEDS,*109,"|",STYADMNS:
                    *117,"|",SNAVDAY,*125,"|"
          GOTO      ENDSUBT
.
P13SUB1   PRINT     *1,"| ",TDESC,*24,"| ",SUBDOC1:
                    *30,"| ",SUBDOC2,*36,"| ",SUBDOC3,*42,"| ",SUBDOC4:
                    *48,"| ",SUBDOC5,*54,"| ",SUBDOC6,*60,"| ",SUBDOC7:
                    *66,"| ",SUBDOC8,*72,"| ",SUBDOC9,*78,"| ",SUBDOC10:
                    *84,"| ",SUBDOC11,*90,"| ",SUBDOC12,*96,"| ",SUBDOC13:
                    *102,"|",STYBEDS,*109,"|",STYADMNS:
                    *117,"|",SNAVDAY,*125,"|"
          GOTO      ENDSUBT
.
PRSUB2    PRINT     *1,"| ",TDESC:
                    *30,"| ",SUBDOC1,*36,"| ",SUBDOC2,*42,"| ",SUBDOC3:
                    *48,"| ",SUBDOC4,*54,"| ",SUBDOC5,*60,"| ",SUBDOC6:
                    *66,"| ",SUBDOC7,*72,"| ",SUBDOC8,*78,"| ",SUBDOC9:
                    *84,"| ",SUBDOC10,*90,"| ",SUBDOC11,*96,"| ",SUBDOC12:
                    *102,"|",STYADMNS:
                    *110,"|",STYBEDS,*117,"| ",SNAVDAY,*125,"|"
          GOTO      ENDSUBT
.
P13SUB2   PRINT     *1,"| ",TDESC,*24,"| ",SUBDOC1:
                    *30,"| ",SUBDOC2,*36,"| ",SUBDOC3,*42,"| ",SUBDOC4:
                    *48,"| ",SUBDOC5,*54,"| ",SUBDOC6,*60,"| ",SUBDOC7:
                    *66,"| ",SUBDOC8,*72,"| ",SUBDOC9,*78,"| ",SUBDOC10:
                    *84,"| ",SUBDOC11,*90,"| ",SUBDOC12,*96,"| ",SUBDOC13:
                    *102,"|",STYADMNS:
                    *110,"|",STYBEDS,*117,"| ",SNAVDAY,*125,"|"
          GOTO      ENDSUBT
.
PRSUB3    PRINT     *1,"| ",TDESC:
                    *30,"| ",SUBDOC1,*36,"| ",SUBDOC2,*42,"| ",SUBDOC3:
                    *48,"| ",SUBDOC4,*54,"| ",SUBDOC5,*60,"| ",SUBDOC6:
                    *66,"| ",SUBDOC7,*72,"| ",SUBDOC8,*78,"| ",SUBDOC9:
                    *84,"| ",SUBDOC10,*90,"| ",SUBDOC11,*96,"| ",SUBDOC12:
                    *102,"|",STYOPERS:
                    *109,"|",STYBEDS,*116,"|",STYADMNS,*125,"|"
          GOTO      ENDSUBT
.
P13SUB3   PRINT     *1,"| ",TDESC,*24,"| ",SUBDOC1:
                    *30,"| ",SUBDOC2,*36,"| ",SUBDOC3,*42,"| ",SUBDOC4:
                    *48,"| ",SUBDOC5,*54,"| ",SUBDOC6,*60,"| ",SUBDOC7:
                    *66,"| ",SUBDOC8,*72,"| ",SUBDOC9,*78,"| ",SUBDOC10:
                    *84,"| ",SUBDOC11,*90,"| ",SUBDOC12,*96,"| ",SUBDOC13:
                    *102,"|",STYOPERS:
                    *109,"|",STYBEDS,*116,"|",STYADMNS,*125,"|"
          GOTO      ENDSUBT
.
PRSUB4    PRINT     *1,"| ",TDESC:
                    *30,"| ",SUBDOC1,*36,"| ",SUBDOC2,*42,"| ",SUBDOC3:
                    *48,"| ",SUBDOC4,*54,"| ",SUBDOC5,*60,"| ",SUBDOC6:
                    *66,"| ",SUBDOC7,*72,"| ",SUBDOC8,*78,"| ",SUBDOC9:
                    *84,"| ",SUBDOC10,*90,"| ",SUBDOC11,*96,"| ",SUBDOC12:
                    *102,"|",STYMBS:
                    *109,"|",STYBEDS,*116,"| ",STYADMNS,*125,"|"
          GOTO      ENDSUBT
.
P13SUB4   PRINT     *1,"| ",TDESC,*24,"| ",SUBDOC1:
                    *30,"| ",SUBDOC2,*36,"| ",SUBDOC3,*42,"| ",SUBDOC4:
                    *48,"| ",SUBDOC5,*54,"| ",SUBDOC6,*60,"| ",SUBDOC7:
                    *66,"| ",SUBDOC8,*72,"| ",SUBDOC9,*78,"| ",SUBDOC10:
                    *84,"| ",SUBDOC11,*90,"| ",SUBDOC12,*96,"| ",SUBDOC13:
                    *102,"|",STYMBS:
                    *109,"|",STYBEDS,*116,"| ",STYADMNS,*125,"|"
.
ENDSUBT   ADD       ONE,CLNO
ENDSUB1   CALL      ZEROS
          RETURN
+
.
.    TOTALS PRINT OUT
.
PRNTTOT   MOVE      ZERO,NAVDAY
.
          COMPARE   ZERO,TYADMNS
          GOTO      PRTTBCH IF EQUAL
.
          MOVE      TYBEDS,TAVDAY
          DIV       TYADMNS,TAVDAY
          MOVE      TAVDAY,NAVDAY
.
PRTTBCH   COMPARE   TEN2,NUMPERS
          GOTO      P13TBCH IF NOT EQUAL
.
          BRANCH    OPTION OF PRNTT1,PRNTT1,PRNTT1,PRNTT2,PRNTT2:
                              PRNTT3,PRNTT3,PRNTT3A,PRNTT4,PRNTT4
          GOTO      PRNTT1
.
P13TBCH   MOVE      DNAME,DNAMESH
          BRANCH    OPTION OF P13TT1,P13TT1,P13TT1,P13TT2,P13TT2:
                              P13TT3,P13TT3,PRNTT3A,P13TT4,P13TT4
          GOTO      P13TT1
.
PRNTT1    PRINT     *1,"| ",DNAME:
                    *30,"|",TDSDOC1,*36,"|",TDSDOC2,*42,"|",TDSDOC3:
                    *48,"|",TDSDOC4,*54,"|",TDSDOC5,*60,"|",TDSDOC6:
                    *66,"|",TDSDOC7,*72,"|",TDSDOC8,*78,"|",TDSDOC9:
                    *84,"|",TDSDOC10,*90,"|",TDSDOC11,*96,"|",TDSDOC12:
                    *102,"|",TYBEDS:
                    *109,"|",TYADMNS,*117,"| ",NAVDAY,*125,"|"
          ADD       ONE,CLNO
.
          MOVE      "BUDGET GRAND TOTAL      ",DNAME
          PRINT     *1,"| ",DNAME:
                    *30,"|",TDBDOC1,*36,"|",TDBDOC2,*42,"|",TDBDOC3:
                    *48,"|",TDBDOC4,*54,"|",TDBDOC5,*60,"|",TDBDOC6:
                    *66,"|",TDBDOC7,*72,"|",TDBDOC8,*78,"|",TDBDOC9:
                    *84,"|",TDBDOC10,*90,"|",TDBDOC11,*96,"|",TDBDOC12:
                    *102,"|",*109,"|":
                    *117,"| ",*125,"|"
          ADD       ONE,CLNO
          RETURN
.
P13TT1    PRINT     *1,"| ",DNAMESH,*24,"|",TDSDOC1:
                    *30,"|",TDSDOC2,*36,"|",TDSDOC3,*42,"|",TDSDOC4:
                    *48,"|",TDSDOC5,*54,"|",TDSDOC6,*60,"|",TDSDOC7:
                    *66,"|",TDSDOC8,*72,"|",TDSDOC9,*78,"|",TDSDOC10:
                    *84,"|",TDSDOC11,*90,"|",TDSDOC12,*96,"|",TDSDOC13:
                    *102,"|",TYBEDS:
                    *109,"|",TYADMNS,*117,"| ",NAVDAY,*125,"|"
          ADD       ONE,CLNO
.
          MOVE      "BUDGET GRAND TOTAL      ",DNAME
          PRINT     *1,"| ",DNAME: 
                    *30,"|",TDBDOC1,*36,"|",TDBDOC2,*42,"|",TDBDOC3:
                    *48,"|",TDBDOC4,*54,"|",TDBDOC5,*60,"|",TDBDOC6:
                    *66,"|",TDBDOC7,*72,"|",TDBDOC8,*78,"|",TDBDOC9:
                    *84,"|",TDBDOC10,*90,"|",TDBDOC11,*96,"|",TDBDOC12:
                    *102,"|",*109,"|":
                    *117,"|",*125
          ADD       ONE,CLNO
          RETURN
.
PRNTT2    PRINT     *1,"| ",DNAME:
                    *30,"|",TDSDOC1,*36,"|",TDSDOC2,*42,"|",TDSDOC3:
                    *48,"|",TDSDOC4,*54,"|",TDSDOC5,*60,"|",TDSDOC6:
                    *66,"|",TDSDOC7,*72,"|",TDSDOC8,*78,"|",TDSDOC9:
                    *84,"|",TDSDOC10,*90,"|",TDSDOC11,*96,"|",TDSDOC12:
                    *102,"|",TYADMNS:
                    *110,"|",TYBEDS,*117,"| ",NAVDAY,*125,"|"
          ADD       ONE,CLNO
.
          MOVE      "BUDGET GRAND TOTAL      ",DNAME
          PRINT     *1,"| ",DNAME: 
                    *30,"|",TDBDOC1,*36,"|",TDBDOC2,*42,"|",TDBDOC3:
                    *48,"|",TDBDOC4,*54,"|",TDBDOC5,*60,"|",TDBDOC6:
                    *66,"|",TDBDOC7,*72,"|",TDBDOC8,*78,"|",TDBDOC9:
                    *84,"|",TDBDOC10,*90,"|",TDBDOC11,*96,"|",TDBDOC12:
                    *102,"|",*110,"|":
                    *117,"|",*125,"| "
          ADD       ONE,CLNO
          RETURN
.
P13TT2    PRINT     *1,"| ",DNAMESH,*24,"|",TDSDOC1:
                    *30,"|",TDSDOC2,*36,"|",TDSDOC3,*42,"|",TDSDOC4:
                    *48,"|",TDSDOC5,*54,"|",TDSDOC6,*60,"|",TDSDOC7:
                    *66,"|",TDSDOC8,*72,"|",TDSDOC9,*78,"|",TDSDOC10:
                    *84,"|",TDSDOC11,*90,"|",TDSDOC12,*96,"|",TDSDOC13:
                    *102,"|",TYADMNS:
                    *110,"|",TYBEDS,*117,"| ",NAVDAY,*125,"|"
          ADD       ONE,CLNO
.
          MOVE      "BUDGET GRAND TOTAL      ",DNAME
          PRINT     *1,"| ",DNAME: 
                    *30,"|",TDBDOC1,*36,"|",TDBDOC2,*42,"|",TDBDOC3:
                    *48,"|",TDBDOC4,*54,"|",TDBDOC5,*60,"|",TDBDOC6:
                    *66,"|",TDBDOC7,*72,"|",TDBDOC8,*78,"|",TDBDOC9:
                    *84,"|",TDBDOC10,*90,"|",TDBDOC11,*96,"|",TDBDOC12:
                    *102,"|",*110,"|":
                    *117,"|",*125,"| "
          ADD       ONE,CLNO
          RETURN
.
PRNTT3    PRINT     *1,"| ",DNAME:
                    *30,"|",TDSDOC1,*36,"|",TDSDOC2,*42,"|",TDSDOC3:
                    *48,"|",TDSDOC4,*54,"|",TDSDOC5,*60,"|",TDSDOC6:
                    *66,"|",TDSDOC7,*72,"|",TDSDOC8,*78,"|",TDSDOC9:
                    *84,"|",TDSDOC10,*90,"|",TDSDOC11,*96,"|",TDSDOC12:
                    *102,"|",TYOPERS:
                    *109,"|",TYBEDS,*116,"|",TYADMNS,*125,"|"
          ADD       ONE,CLNO
.
          MOVE      "BUDGET GRAND TOTAL      ",DNAME
          PRINT     *1,"| ",DNAME: 
                    *30,"|",TDBDOC1,*36,"|",TDBDOC2,*42,"|",TDBDOC3:
                    *48,"|",TDBDOC4,*54,"|",TDBDOC5,*60,"|",TDBDOC6:
                    *66,"|",TDBDOC7,*72,"|",TDBDOC8,*78,"|",TDBDOC9:
                    *84,"|",TDBDOC10,*90,"|",TDBDOC11,*96,"|",TDBDOC12:
                    *102,"|",*109,"|":
                    *116,"|",*125,"| "
          ADD       ONE,CLNO
          RETURN
.
P13TT3    PRINT     *1,"| ",DNAMESH,*24,"|",TDSDOC1:
                    *30,"|",TDSDOC2,*36,"|",TDSDOC3,*42,"|",TDSDOC4:
                    *48,"|",TDSDOC5,*54,"|",TDSDOC6,*60,"|",TDSDOC7:
                    *66,"|",TDSDOC8,*72,"|",TDSDOC9,*78,"|",TDSDOC10:
                    *84,"|",TDSDOC11,*90,"|",TDSDOC12,*96,"|",TDSDOC13:
                    *102,"|",TYOPERS:
                    *109,"|",TYBEDS,*116,"|",TYADMNS,*125,"|"
          ADD       ONE,CLNO
.
          MOVE      "BUDGET GRAND TOTAL      ",DNAME
          PRINT     *1,"| ",DNAME: 
                    *30,"|",TDBDOC1,*36,"|",TDBDOC2,*42,"|",TDBDOC3:
                    *48,"|",TDBDOC4,*54,"|",TDBDOC5,*60,"|",TDBDOC6:
                    *66,"|",TDBDOC7,*72,"|",TDBDOC8,*78,"|",TDBDOC9:
                    *84,"|",TDBDOC10,*90,"|",TDBDOC11,*96,"|",TDBDOC12:
                    *102,"|":
                    *109,"|",*116,"| ",*125,"|"
          ADD       ONE,CLNO
PRNTT3A   RETURN
.
PRNTT4    PRINT     *1,"| ",DNAME:
                    *30,"|",TDSDOC1,*36,"|",TDSDOC2,*42,"|",TDSDOC3:
                    *48,"|",TDSDOC4,*54,"|",TDSDOC5,*60,"|",TDSDOC6:
                    *66,"|",TDSDOC7,*72,"|",TDSDOC8,*78,"|",TDSDOC9:
                    *84,"|",TDSDOC10,*90,"|",TDSDOC11,*96,"|",TDSDOC12:
                    *102,"|",TYMBS:
                    *109,"|",TYBEDS,*116,"| ",TYADMNS,*125,"|"
          ADD       ONE,CLNO
.
          MOVE      "BUDGET GRAND TOTAL      ",DNAME
          PRINT     *1,"| ",DNAME: 
                    *30,"|",TDBDOC1,*36,"|",TDBDOC2,*42,"|",TDBDOC3:
                    *48,"|",TDBDOC4,*54,"|",TDBDOC5,*60,"|",TDBDOC6:
                    *66,"|",TDBDOC7,*72,"|",TDBDOC8,*78,"|",TDBDOC9:
                    *84,"|",TDBDOC10,*90,"|",TDBDOC11,*96,"|",TDBDOC12:
                    *102,"|":
                    *109,"|",*116,"| ",*125,"|"
          ADD       ONE,CLNO
          RETURN
.
P13TT4    PRINT     *1,"| ",DNAMESH,*24,"|",TDSDOC1:
                    *30,"|",TDSDOC2,*36,"|",TDSDOC3,*42,"|",TDSDOC4:
                    *48,"|",TDSDOC5,*54,"|",TDSDOC6,*60,"|",TDSDOC7:
                    *66,"|",TDSDOC8,*72,"|",TDSDOC9,*78,"|",TDSDOC10:
                    *84,"|",TDSDOC11,*90,"|",TDSDOC12,*96,"|",TDSDOC13:
                    *102,"|",TYMBS:
                    *109,"|",TYBEDS,*116,"| ",TYADMNS,*125,"|"
          ADD       ONE,CLNO
.
          MOVE      "BUDGET GRAND TOTAL      ",DNAME
          PRINT     *1,"| ",DNAME: 
                    *30,"|",TDBDOC1,*36,"|",TDBDOC2,*42,"|",TDBDOC3:
                    *48,"|",TDBDOC4,*54,"|",TDBDOC5,*60,"|",TDBDOC6:
                    *66,"|",TDBDOC7,*72,"|",TDBDOC8,*78,"|",TDBDOC9:
                    *84,"|",TDBDOC10,*90,"|",TDBDOC11,*96,"|",TDBDOC12:
                    *102,"|",*109,"|":
                    *116,"|",*125,"| "
          ADD       ONE,CLNO
          RETURN
.
+
.
.           OVER CONDITION FOUND..PRINT LAST LINE OF -- AND DISPLAY MESSAGE
.
ENDP      COMPARE   ZERO,PAGENO
          GOTO      NODATA IF EQUAL
.
.         GRAND TOTALS AT END
.
          CALL      PAGSEP
          CALL      PRNTSUB
.
          COMPARE   EIGHT,OPTION
          GOTO      NOGRND IF EQUAL
.
          CALL      PAGSEP
          MOVE      "GRAND TOTAL             ",DNAME
.
          PRINT     " "
          CALL      PAGEND
          CALL      PRNTTOT
          CALL      PAGEND
.
NOGRND    PRINT     *N,*N,"*** END OF REPORT ***"
.
.         SHOULD BE DONE ONCE PROGRAM IS WORKING OK
.
          CLOSE     PSTTMP
          CALL      KILLIDX
.
          GOTO      START
+
.
.          LAST LINE ON THE PAGE
.
PAGEND    PRINT     "*---------------------------------------------":
                    "--------------------------------------------------":
                    "-----------------------------------*"
          ADD       ONE,CLNO
          RETURN
.
.         PAGE SEPERATOR
.
PAGSEP    COMPARE   TEN2,NUMPERS
          GOTO      P13SEP IF NOT EQUAL
.
          BRANCH    OPTION OF PSEP1,PSEP1,PSEP1,PSEP2,PSEP2:
                              PSEP3,PSEP3,PSEP3A,PSEP3,PSEP3
          GOTO      PSEP1
.
P13SEP    BRANCH    OPTION OF P13P1,P13P1,P13P1,P13P2,P13P2:
                              P13P3,P13P3,PSEP3A,P13P3,P13P3
          GOTO      P13P1
.
PSEP1     PRINT     "*----------------------------":
                    "------------------------------------":
                    "------------------------------------":
                    "-------------------------------"
          ADD       ONE,CLNO
          RETURN
.
P13P1     PRINT     "*----------------------------":
                    "------------------------------------":
                    "------------------------------------":
                    "-------------------------------"
          ADD       ONE,CLNO
          RETURN
.
PSEP2     PRINT     "*----------------------------":
                    "------------------------------------":
                    "------------------------------------":
                    "-------------------------------"
          ADD       ONE,CLNO
          RETURN
.
P13P2     PRINT     "*----------------------------":
                    "------------------------------------":
                    "------------------------------------":
                    "-------------------------------"
          ADD       ONE,CLNO
          RETURN
.
PSEP3     PRINT     "*----------------------------":
                    "------------------------------------":
                    "------------------------------------":
                    "-------------------------------"
          ADD       ONE,CLNO
          RETURN
.
P13P3     PRINT     "*----------------------------":
                    "------------------------------------":
                    "------------------------------------":
                    "-------------------------------"
          ADD       ONE,CLNO
PSEP3A    RETURN
+
.
.                 HEADINGS FOR OUTPUT
.
HEAD      ADD       ONE,PAGENO
.
          BRANCH    PAGENO OF FRSTHD
.
          COMPARE   "55",CLNO
          CALL      PAGEND IF NOT LESS
.
FRSTHD    CALL      HEAD132
          PRINT     DHEAD; 
.
          BRANCH    OPTIONA OF FRST10,FRST20
.
FRST10    COMPARE   EIGHT,OPTION
          GOTO      FRST15 IF NOT EQUAL
.
          PRINT     *49,TYPHEAD," : ",STRDOC,*N
          GOTO      FRST30
.
FRST15    PRINT     *49,TYPHEAD," : ",DTSRCH,*N
          GOTO      FRST30
.
FRST20    COMPARE   EIGHT,OPTION
          GOTO      FRST22 IF NOT EQUAL
.
.         Range of doctor code
.
          MOVE      STRDOC,DIM6
          MOVE      ENDDOC,DIM6A
.
          MATCH     SP6,STRDOC
          GOTO      FRST21 IF NOT EQUAL
          MOVE      "START",DIM6
.
FRST21    MATCH     SP6,ENDDOC
          GOTO      FRST28 IF NOT EQUAL
          MOVE      "FINISH",DIM6A
          GOTO      FRST28
.
.         Range of doctor type
.
FRST22    MOVE      DTSRCH,DIM6
          MOVE      LAST,DIM6A
.
          MATCH     SP3,DTSRCH
          GOTO      FRST24 IF NOT EQUAL
          MOVE      "START",DIM6
.
FRST24    MATCH     SP3,LAST
          GOTO      FRST28 IF NOT EQUAL
          MOVE      "FINISH",DIM6A
.
FRST28    PRINT     *66,TYPHEAD," : ",DIM6," to ",DIM6A,*N
.
FRST30    MOVE      FOUR,CLNO
          CALL      PAGEND
.
          COMPARE   TEN2,NUMPERS
          GOTO      F13T30 IF NOT EQUAL
.
          BRANCH    OPTION OF PTYPE1,PTYPE1,PTYPE1,PTYPE2,PTYPE2:
                              PTYPE3,PTYPE3,PTYPE3A,PTYPE4,PTYPE4
          GOTO      PTYPE1
.
F13T30    BRANCH    OPTION OF PT13E1,PT13E1,PT13E1,PT13E2,PT13E2:
                              PT13E3,PT13E3,PT13E3A,PT13E4,PT13E4
          GOTO      PTYPE1
.
PTYPE1    PRINT     *1,"| ",DOCTOR:
                    *30,"|",*48,"M O N T H L Y   T O T A L S":
                    *102,"| BED ":
                    *109,"|ADMISS",*117,"|A.L.O.S",*125,"|":
                    *N,"|",*30,MONTH12:
                    *102,"| YTD":
                    *109,"| YTD",*117,"|",*125,"|"
          GOTO      ENDHEAD
.
PT13E1    PRINT     *1,"| ",DOCTOR:
                    *24,"|",*48,"M O N T H L Y   T O T A L S":
                    *102,"|  BED":
                    *110,"|ADMISS",*118,"|A.L.O.S",*126,"|":
                    *N,"|",*24,MONTH:
                    *102,"| YTD":
                    *109,"| YTD",*117,"|",*125,"|"
          GOTO      ENDHEAD
.
PTYPE2    PRINT     *1,"| ",DOCTOR:
                    *30,"|",*48,"M O N T H L Y   T O T A L S":
                    *102,"|  ADMI ":
                    *110,"|B/DAYS",*117,"|A.L.O.S",*125,"|":
                    *N,"|",*30,MONTH12:
                    *102,"|  YTD":
                    *110,"|  YTD",*117,"|",*125,"|"
          GOTO      ENDHEAD
.
PT13E2    PRINT     *1,"| ",DOCTOR:
                    *24,"|",*48,"M O N T H L Y   T O T A L S":
                    *102,"|  ADMI ":
                    *110,"|B/DAYS",*117,"|A.L.O.S",*125,"|":

                    *N,"|",*24,MONTH:
                    *102,"|  YTD":
                    *110,"|  YTD",*117,"|",*125,"|"
          GOTO      ENDHEAD
.
PTYPE3    PRINT     *1,"| ",DOCTOR:
                    *30,"|",*48,"M O N T H L Y   T O T A L S":
                    *102,"| OPER ":
                    *109,"|B/DAYS",*116,"| ADMISS",*125,"|":

                    *N,"|",*30,MONTH12:
                    *102,"|  YTD":
                    *109,"|  YTD",*116,"|",*125,"|"
          GOTO      ENDHEAD
.
PT13E3    PRINT     *1,"| ",DOCTOR:
                    *24,"|",*48,"M O N T H L Y   T O T A L S":
                    *102,"| OPER ":
                    *109,"|B/DAYS",*116,"| ADMISS",*125,"|":

                    *N,"|",*24,MONTH:
                    *102,"|  YTD":
                    *109,"|  YTD",*116,"|",*125,"|"
          GOTO      ENDHEAD
.
PTYPE3A   PRINT     *1,"| ",DOCTOR:
                    *30,"|",*48,"M O N T H L Y   T O T A L S":
                    *102,"|":
                    *125,"|":

                    *N,"|",*30,MONTH12:
                    *102,"| YTD":
                    *108,"|A.L.O.S",*115,"|",*125,"|"
          GOTO      ENDHEAD
.
PT13E3A   PRINT     *1,"| ",DOCTOR:
                    *24,"|",*48,"M O N T H L Y   T O T A L S":
                    *102,"|":
                    *125,"|":

                    *N,"|",*24,MONTH:
                    *102,"| YTD":
                    *108,"|A.L.O.S",*115,"|",*125,"|"
          GOTO      ENDHEAD
.
PTYPE4    PRINT     *1,"| ",DOCTOR:
                    *30,"|",*48,"M O N T H L Y   T O T A L S":
                    *102,"| MBS ":
                    *109,"|B/DAYS",*116,"|ADMISS",*125,"|":
                    *N,"|",*30,MONTH12:
                    *102,"| YTD":
                    *109,"|  YTD",*116,"|",*125,"|"
          GOTO      ENDHEAD
.
PT13E4    PRINT     *1,"| ",DOCTOR:
                    *24,"|",*48,"M O N T H L Y   T O T A L S":
                    *102,"| MBS ":
                    *198,"|B/DAYS",*116,"| ADMISS",*125,"|":
                    *N,"|",*24,MONTH:
                    *102,"| YTD":
                    *109,"|  YTD",*116,"|",*125,"|"
.
ENDHEAD   CALL      PAGEND
          ADD       TWO,CLNO
          CLOCK     TIME,CTIMEIS
          RETURN
.
MIDHD     PRINT     *N;
          ADD       ONE,CLNO
          CALL      PAGEND
          RETURN
+
.
.       PRINTING VARIABLES
.
ZEROT     MOVE      ZERO,TDSDOC1
          MOVE      ZERO,TDSDOC2
          MOVE      ZERO,TDSDOC3
          MOVE      ZERO,TDSDOC4
          MOVE      ZERO,TDSDOC5
          MOVE      ZERO,TDSDOC6
          MOVE      ZERO,TDSDOC7
          MOVE      ZERO,TDSDOC8
          MOVE      ZERO,TDSDOC9
          MOVE      ZERO,TDSDOC10
          MOVE      ZERO,TDSDOC11
          MOVE      ZERO,TDSDOC12
          MOVE      ZERO,TDSDOC13
.
          MOVE      ZERO,TDBDOC1
          MOVE      ZERO,TDBDOC2
          MOVE      ZERO,TDBDOC3
          MOVE      ZERO,TDBDOC4
          MOVE      ZERO,TDBDOC5
          MOVE      ZERO,TDBDOC6
          MOVE      ZERO,TDBDOC7
          MOVE      ZERO,TDBDOC8
          MOVE      ZERO,TDBDOC9
          MOVE      ZERO,TDBDOC10
          MOVE      ZERO,TDBDOC11
          MOVE      ZERO,TDBDOC12
          MOVE      ZERO,TDBDOC13
.
          MOVE      ZERO,TYOPERS
          MOVE      ZERO,TYBEDS
          MOVE      ZERO,TYADMNS
          MOVE      ZERO,TYMBS
          RETURN
.
.         SUB TOTAL VARIABLES
.
ZEROS     MOVE      ZERO,SUBDOC1
          MOVE      ZERO,SUBDOC2
          MOVE      ZERO,SUBDOC3
          MOVE      ZERO,SUBDOC4
          MOVE      ZERO,SUBDOC5
          MOVE      ZERO,SUBDOC6
          MOVE      ZERO,SUBDOC7
          MOVE      ZERO,SUBDOC8
          MOVE      ZERO,SUBDOC9
          MOVE      ZERO,SUBDOC10
          MOVE      ZERO,SUBDOC11
          MOVE      ZERO,SUBDOC12
          MOVE      ZERO,SUBDOC13
.
          MOVE      ZERO,STYOPERS
          MOVE      ZERO,STYBEDS
          MOVE      ZERO,STYADMNS
          MOVE      ZERO,STYMBS
          RETURN
.
.        GRAND TOTALS   (T is moved to N in print and added)
.
TOTAL
.
.      ADD IN CURRENT VALUES
.
          MOVE      PTDSBEDD,YBEDS
          MOVE      PTDSADMS,YADMNS
          MOVE      PTDSOPRS,YOPERS
          MOVE      PTDSMBSC,YMBS
.
          ADD       YOPERS,TYOPERS
          ADD       YADMNS,TYADMNS
          ADD       YBEDS,TYBEDS
          ADD       YMBS,TYMBS
          RETURN
.
.
.       TOTAL BUDGETS
.
TOTSUB    ADD       YOPERS,STYOPERS
          ADD       YADMNS,STYADMNS
          ADD       YBEDS,STYBEDS
          ADD       YMBS,STYMBS
.
          ADD       DSCDSH1,SUBDOC1
          ADD       DSCDSH2,SUBDOC2
          ADD       DSCDSH3,SUBDOC3
          ADD       DSCDSH4,SUBDOC4
          ADD       DSCDSH5,SUBDOC5
          ADD       DSCDSH6,SUBDOC6
          ADD       DSCDSH7,SUBDOC7
          ADD       DSCDSH8,SUBDOC8
          ADD       DSCDSH9,SUBDOC9
          ADD       DSCDSH10,SUBDOC10
          ADD       DSCDSH11,SUBDOC11
          ADD       DSCDSH12,SUBDOC12
          ADD       DSCDSH13,SUBDOC13
.
          RETURN
.
.         This code is for the monthly update of the Doctors Statistics file
.         First we ask what month/year is to be updated. The default is
.         last month
.
UPDATE    PACK      DHEAD WITH DUPDATE,SP30
          DISPLAY   *P53:2,*V2LON,DHEAD
.
.         Key in the month and year of the update
.
KEYMY     DISPLAY   *P1:17,*EF,"Enter ",CPERMTH," & Year of the Update : ";
.
          MOVE      "37",CCOL
          MOVE      TEN7,CVERT
          UNPACK    CURYR,CCENT,CYEAR
          MOVE      CURNUM,CMON
          MOVE      ZERO,CHIGHLT
.
          CALL      KEYPER
.
          PACK      KEY6,ICENT,IYEAR,IMON
          REP       " 0",KEY6
          CALL      RDDRGA3
          BRANCH    OVRCD,INVMY
.
          GOTO      DSPMY
.
INVMY     DISPLAY   *P1:24,*EL,*B:
                    "Invalid Date. ";
          CALL      HITENTER 
          GOTO      KEYMY
.
DSPMY     RESET     DHEAD,29
          APPEND    DRGCNUM,DHEAD
          APPEND    SLASH,DHEAD
          APPEND    DRGCYR,DHEAD
          RESET     DHEAD
.
          DISPLAY   *P53:2,*V2LON,DHEAD
.
          UNPACK    DRGFDTE,FROMDATE
          UNPACK    DRGTDTE,TODATE
.
.         Add one to the TODATE so test can be made for less than TODATE
.
          UNPACK    TODATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CDAY,DD
          MOVE      CMON,MM
          MOVE      CYEAR,YY
          MOVE      CCENT,CC
          CALL      DMYCON
.
          ADD       ONE,JULDAY
          MOVE      JULDAY,JWKDAY
          MOVE      JULYR,JWKYER
          MOVE      JULCC,JWKCC
          CALL      JULCON
.
          PACK      TODATE,CC,YY,MM,DD
          REP       " 0",TODATE
.
.         Calculate the month offset
.
          MOVE      DRGYR,FINYEAR
          MOVE      DRGNUM,INDEX
.
.         Check that this is correct
.
CHKMY     CALL      CONTQST
.
          BRANCH    CEXIT,ZDOCS,UPDATE,START
.
.         Zero the current statistics for this month/year
.
ZDOCS     DISPLAY   *P1:24,*EL:
                    *P20:24,"Doctor code :";
.
          MOVE      FINYEAR,NOWYEAR
          MOVE      INDEX,NOWPERD
          REPLACE   " 0",NOWPERD
.
.         Pack up the key for the starting record to zero
.
          PACK      KEY13 WITH NOWYEAR,NOWPERD,ANSA,SP6
          CALL      RDSDSTA1
ZEROLP    CALL      RDKDSTA1
          BRANCH    OVRCD OF MTHUPD
.
          MATCH     PTDSYEAR,NOWYEAR
          GOTO      MTHUPD IF NOT EQUAL
.
          MATCH     PTDSPERD,NOWPERD
          GOTO      MTHUPD IF NOT EQUAL   
.
          DISPLAY   *P34:24,*V2LON,PTDSCODE;
.
.         Zero Admission data
.
          MOVE      ZERO,PTDSADMS
          MOVE      ZERO,PTDSBEDD
          MOVE      ZERO,PTDSOPRS
          MOVE      ZERO,PTDSMBSC
.
          CALL      UPDSTA1
.
.         Read next doctor's record
.
          GOTO      ZEROLP
.
.         Zeroing of current data finished - Now we start to calculate the data
.
MTHUPD    DISPLAY   *P1:24,*EL:
                    *P20:24,"Processed :",*P60:24,"Scanning :";
.
          MOVE      NOWYEAR,PTDSYEAR
          MOVE      NOWPERD,PTDSPERD
          REPLACE   " 0",PTDSPERD
.
.         Loop over discharged patients
.
          PACK      KEY16 WITH FROMDATE,SP8
          CALL      RDSDSCH2
CRTELP    CALL      RDKDSCH2
          BRANCH    OVRCD OF PROCURR
.
          DISPLAY   *P71:24,DADMNO;
.
.         Read in admission record
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF CRTELP
.
          CALL      PROCESS
          GOTO      CRTELP
.
.         Process current admissions
.
PROCURR   PACK      KEY9 WITH TWO,SP8
          CALL      RDSMISS2
PROCLP    CALL      RDKMISS2
          BRANCH    OVRCD OF ENDRECRT
.
          BRANCH    ASTAT OF PROCLP,PROOPR,PRONLV,PROOPR,ENDRECRT
.
.         Start scanning on-leave patients
.
PRONLV    PACK      KEY9 WITH FOUR,SP8
          CALL      RDSMISS2
          GOTO      PROCLP
.
.         Check for operations
.
PROOPR    CALL      PROCESS
          GOTO      PROCLP
.
.         Check if the patient has got master record
.
PROCESS   MOVE      AURNO,KEY8  
          CALL      RDMAST1
          COMPARE   ZERO,OVRCD
          RETURN    IF NOT EQUAL
.
.         If admitted before the end of the period - process data
.
          MATCH     TODATE,ADATE
          RETURN    IF NOT LESS
.
.         Recreate bed day data
.
          CALL      UPDDSTA
.
.         If admission date is in range, then recreate admission data
.
          MATCH     FROMDATE,ADATE
          GOTO      DOOPR IF LESS
.
          MATCH     TODATE,ADATE
          CALL      UPDDSTAA IF LESS
.
.         Recreate operation data
.
DOOPR     CALL      UPDDSTAO
.
.         Check if this person has any MBS codes
.
          CALL      UPDDSTAM
.
          DISPLAY   *P32:24,*V2LON,AADMNO;
.
          RETURN
.
.         Subroutines to do the Doctors Statistics (Admissions)
.
UPDDSTAA  MOVE      ADATE,XDATE
.
          CALL      GETADOC       * Get the attending doctor for date XDATE
.
          MOVE      ANSA,PTDSTYPE
          CALL      ADDADM00
.
          MOVE      ADOCTR,PTDSCODE
          MATCH     SP6,PTDSCODE
          CALL      UNODOCT IF EQUAL
          MOVE      ANSR,PTDSTYPE
          MOVE      INDEX,PTDSPERD
          REPLACE   " 0",PTDSPERD
          CALL      ADDADM00
          RETURN
.
ADDADM00  PACK      KEY13 WITH PTDSYEAR,PTDSPERD,PTDSTYPE,PTDSCODE
          CALL      RLDSTA1
          BRANCH    OVRCD,ADDADM80,ADDADM90
          ADD       ONE,PTDSADMS   * Update the appropriate variable
          CALL      UPDSTA1
          CALL      UUDSTA1
          GOTO      ADDADM99
.
ADDADM80  CALL      ZERODSTA
          GOTO      ADDADM00
.
ADDADM90  DISPLAY   *W5
          GOTO      ADDADM00
.
ADDADM99  RETURN
.
.        Subroutines to update the Doctors Statistics (Bed Days)
.
UPDDSTA   MOVE      SP8,STDATE
          MOVE      " ",STMOVE
          MOVE      SP6,STADOCT
.
          MATCH     ADATE,DDATE
          GOTO      DAYCASE IF EQUAL
.
          PACK      KEY30 WITH AADMNO,SP20
          CALL      RDSTRAN2
NEXTTRN   CALL      RDKTRAN2
          BRANCH    OVRCD OF XXXX
.
          MATCH     TADMN,AADMNO
          GOTO      XXXX IF NOT EQUAL
.
          MOVE      TMOVE,STMOVE
          REP       " 0",TDATE
.
          MATCH     "A",TMOVE
          GOTO      ARITYPE IF EQUAL
.
          MATCH     "R",TMOVE
          GOTO      ARITYPE IF EQUAL
.
          MATCH     "C",TMOVE
          GOTO      LOTYPE IF EQUAL
.
          MATCH     "L",TMOVE
          GOTO      LOTYPE IF EQUAL
.
          MATCH     FROMDATE,TDATE
          RETURN    IF LESS
.
          MATCH     TODATE,TDATE
          GOTO      XXXX IF LESS
.
          MOVE      TODATE,TDATE
          GOTO      XXXX
.
.       Day Case - Get last doctor for this patient
.
DAYCASE   PACK      KEY30 WITH AADMNO,SP20
          CALL      RDSTRAN2
DCLOOP    CALL      RDKTRAN2
          BRANCH    OVRCD OF DCCALC
.
          MATCH     TADMN,AADMNO
          GOTO      DCCALC IF NOT EQUAL
.
          MOVE      TADOCT,PTDSCODE
          GOTO      DCLOOP
.
DCCALC    MOVE      ONE,WTOTDAY
          MOVE      ANSA,PTDSTYPE
          MATCH     SP6,PTDSCODE
          CALL      UNODOCT IF EQUAL
.
          CALL      ADDBED00
.
          MOVE      ADOCTR,PTDSCODE
          MATCH     SP6,PTDSCODE
          CALL      UNODOCT IF EQUAL
          MOVE      ANSR,PTDSTYPE
.
          CALL      ADDBED00
          RETURN
+
.
.       End of a period, calculate the data needed, and then start new period
.
LOTYPE    MATCH     FROMDATE,TDATE
          GOTO      ARITYPE IF LESS
.
          MATCH     TODATE,TDATE
          GOTO      CONT8 IF LESS
.
          MOVE      TODATE,WDATE1
          MOVE      STDATE,WDATE2
.
          CALL      CALC
          RETURN
.
CONT8     MOVE      TDATE,WDATE1
          MOVE      STDATE,WDATE2
          CALL      CALC
.
.       Save new parameters for the start of the new period
.
ARITYPE   MATCH     TODATE,TDATE
          RETURN    IF NOT LESS
          MATCH     FROMDATE,TDATE
          GOTO      CONT2 IF NOT LESS
          MOVE      FROMDATE,STDATE
          GOTO      CONT30
.
CONT2     MOVE      TDATE,STDATE
.
CONT30    MOVE      TADOCT,STADOCT
          GOTO      NEXTTRN
.
XXXX      MATCH     "L",STMOVE
          RETURN    IF EQUAL
.
          MATCH     " ",STMOVE
          RETURN    IF EQUAL
.
          MATCH     "D",STMOVE
          GOTO      CONT9 IF NOT EQUAL
.
          MOVE      TDATE,WDATE1
          MOVE      STDATE,WDATE2
          GOTO      CONT10
.
CONT9     MOVE      TODATE,WDATE1
          MOVE      STDATE,WDATE2
CONT10    CALL      CALC
          RETURN
+
.
.              CALCULATE DATES DIFFERENCE
.
CALC      DAYSEP    WDATE2,WDATE1,WTOTDAY
.
          MOVE      STADOCT,PTDSCODE
          MOVE      ANSA,PTDSTYPE
          MATCH     SP6,PTDSCODE
          CALL      UNODOCT IF EQUAL
.
          CALL      ADDBED00
.
          MOVE      ADOCTR,PTDSCODE
          MATCH     SP6,PTDSCODE
          CALL      UNODOCT IF EQUAL
          MOVE      ANSR,PTDSTYPE
          MOVE      INDEX,PTDSPERD
          REPLACE   " 0",PTDSPERD
.
          CALL      ADDBED00
          RETURN
.
ADDBED00  PACK      KEY13 WITH PTDSYEAR,PTDSPERD,PTDSTYPE,PTDSCODE
          CALL      RLDSTA1
          BRANCH    OVRCD,ADDBED80,ADDBED90
          ADD       WTOTDAY,PTDSBEDD
          CALL      UPDSTA1
          CALL      UUDSTA1
          GOTO      ADDBED99
.
ADDBED80  CALL      ZERODSTA 
          GOTO      ADDBED00
.
ADDBED90  DISPLAY   *W5
          GOTO      ADDBED00
.
ADDBED99  RETURN
.
.         Update Operation Statistics
.
UPDDSTAO  PACK      KEY16,AADMNO,SP20                                 *C-240107
          CALL      RSPTECO2
OPRLP     CALL      RKPTECO2
          BRANCH    OVRCD,ENDOPR
.
          MATCH     AADMNO,PTEOADMN
          GOTO      ENDOPR IF NOT EQUAL
.
          MOVE      PTEODATE,XDATE
          MATCH     FROMDATE,XDATE
          GOTO      OPRLP IF LESS
.
          MATCH     TODATE,XDATE
          GOTO      OPRLP IF NOT LESS
.
          CALL      GETADOC       * Get the attending doctor for date XDATE
.
          MOVE      ANSA,PTDSTYPE
          CALL      ADDOPR00
.
          MOVE      ADOCTR,PTDSCODE
          MATCH     SP6,PTDSCODE
          CALL      UNODOCT IF EQUAL
          MOVE      ANSR,PTDSTYPE
          MOVE      INDEX,PTDSPERD
          REPLACE   " 0",PTDSPERD
.
          CALL      ADDOPR00
          GOTO      OPRLP
.
ADDOPR00  PACK      KEY11 WITH PTDSYEAR,PTDSPERD,PTDSTYPE,PTDSCODE
          CALL      RLDSTA1
          BRANCH    OVRCD,ADDOPR80,ADDOPR90
          ADD       ONE,PTDSOPRS
          CALL      UPDSTA1
          CALL      UUDSTA1
          GOTO      ADDOPR99
.
ADDOPR80  CALL      ZERODSTA
          GOTO      ADDOPR00
.
ADDOPR90  DISPLAY   *W5
          GOTO      ADDOPR00
.
ADDOPR99  RETURN
.
ENDOPR    RETURN
.
.         Update MBS statistics
.
UPDDSTAM  PACK      KEY11 WITH AADMNO,SP70
          CALL      RDSMMBS1
MBSLP     CALL      RDKMMBS1
          BRANCH    OVRCD OF ENDMBS
.
          MATCH     AADMNO,MMADMN
          GOTO      ENDMBS IF NOT EQUAL
.
          UNPACK    MMDATE WITH XCENT,XYEAR,XMON,XDAY
          PACK      XDATE WITH XCENT,XYEAR,XMON,XDAY
.
          MATCH     FROMDATE,XDATE
          GOTO      MBSLP IF LESS
.
          MATCH     TODATE,XDATE
          GOTO      MBSLP IF NOT LESS
.
          CALL      GETADOC       * Get the attending doctor for date XDATE
.
          MOVE      ANSA,PTDSTYPE
          CALL      ADDMBS00
.
          MOVE      ADOCTR,PTDSCODE
          MATCH     SP6,PTDSCODE
          CALL      UNODOCT IF EQUAL
          MOVE      ANSR,PTDSTYPE
          MOVE      INDEX,PTDSPERD
          REPLACE   " 0",PTDSPERD
.
          CALL      ADDMBS00
          GOTO      MBSLP
.
ADDMBS00  PACK      KEY13 WITH PTDSYEAR,PTDSPERD,PTDSTYPE,PTDSCODE
          CALL      RLDSTA1
          BRANCH    OVRCD,ADDMBS80,ADDMBS90
          ADD       ONE,PTDSMBSC
          CALL      UPDSTA1
          CALL      UUDSTA1
          GOTO      ADDMBS99
.
ADDMBS80  CALL      ZERODSTA
          GOTO      ADDMBS00
.
ADDMBS90  DISPLAY   *W5
          GOTO      ADDMBS00
.
ADDMBS99  RETURN
.
ENDMBS    RETURN
.
.         Subroutine to create an empty record for the Doctors statistics
.
ZERODSTA  MOVE      ZERO,PTDSBADM
          MOVE      ZERO,PTDSBBED
          MOVE      ZERO,PTDSBOPR
          MOVE      ZERO,PTDSBMBS
.
ZEROLP1   MOVE      ZERO,PTDSADMS
          MOVE      ZERO,PTDSBEDD
          MOVE      ZERO,PTDSOPRS
          MOVE      ZERO,PTDSMBSC
.
ZEROEND   CALL      WRDSTA1
          RETURN
.
.         Subroutine to select code for unknown doctor
.
UNODOCT   MOVE      "NODOCT",DSCODE
          RETURN
.
ENDRECRT  DISPLAY   *P1:24,*EL,*V2LON,*P20:24:
                    "** Monthly Update Completed **",*W2;
          GOTO      START
.
.         Subroutine to get the attending doctor at a given date
.
GETADOC   MOVE      SP6,DSCODE
          PACK      KEY30 WITH AADMNO,SP30
          CALL      RDSTRAN2
GADOCLP   CALL      RDKTRAN2
          BRANCH    OVRCD OF ENDGDOC
.
          MATCH     TADMN,AADMNO
          GOTO      ENDGDOC IF NOT EQUAL
.
          MATCH     TDATE,XDATE
          GOTO      ENDGDOC IF LESS
.
          MOVE      TADOCT,PTDSCODE
          GOTO      GADOCLP
.
ENDGDOC   MATCH     SP6,PTDSCODE
          CALL      UNODOCT IF EQUAL
.
          RETURN
+
.       Deleting  AN INDEXED FILE BASED ON PORT
.
KILLIDX   CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMET,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
          RETURN
.
CREAIDX   PREP      PSTROL,FNAMER
          WRITE     PSTROL,SEQ;"isbuild ",FNAMET," 119 ",SORTSTR
          WEOF      PSTROL,SEQ
.
          MOVE      ONE,STATUS
          DISPLAY   *P1:23,*EF,*P1:23
.
          CLEAR     CMDLINE
          APPEND    "sh ",CMDLINE
          APPEND    FNAMER,CMDLINE
          APPEND    ".txt",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
          BRANCH    STATUS TO INDOK
.
          MOVE      ONE,OPCND
          DISPLAY   *P20:24,*B,*V2LON:
                    "** The Index File Not Created **",*W3;
.
INDOK     DISPLAY   *P1:23,*EF,*P1:23
          CLOSE     PSTROL,DELETE
          RETURN
.
.  Subroutine to initialize printer
.
INITPR    CLOCK     TIME,CTIMEIS
          MOVE      ZERO,CPAGENO
          MOVE      ONE,CNOUNDLN
          RETURN
.
. IO for temp file
.
RDATTMP   IF        OPTION = 8
            MOVE      ZERO,OVRCD
            RESET     KEY19
            READ      PSTTMP,KEY19;ANS
            GOTO      OVERCOND IF OVER
          ELSE
            MOVE      ZERO,OVRCD
            RESET     KEY18
            READ      PSTTMP,KEY18;ANS
            GOTO      OVERCOND IF OVER
          ENDIF
          RETURN
.******************************************************************************
.*                      CDAT0000                                              *
.*                      Clear all temp file fields before load of figures     *
.******************************************************************************
CDAT0000  MOVE      ONE,FORM2
.
CDAT1000  STORE     ZERO,FORM2,DSCDSH1,DSCDSH2,DSCDSH3,DSCDSH4:
                               DSCDSH5,DSCDSH6,DSCDSH7,DSCDSH8:
                               DSCDSH9,DSCDSH10,DSCDSH11,DSCDSH12,DSCDSH13
.
          STORE     ZERO,FORM2,DSCBED1,DSCBED2,DSCBED3,DSCBED4:
                               DSCBED5,DSCBED6,DSCBED7,DSCBED8:
                               DSCBED9,DSCBED10,DSCBED11,DSCBED12,DSCBED13
.
          STORE     ZERO,FORM2,DSCOPR1,DSCOPR2,DSCOPR3,DSCOPR4:
                               DSCOPR5,DSCOPR6,DSCOPR7,DSCOPR8:
                               DSCOPR9,DSCOPR10,DSCOPR11,DSCOPR12,DSCOPR13
.
          STORE     ZERO,FORM2,DSXOPR1,DSXOPR2,DSXOPR3,DSXOPR4:
                               DSXOPR5,DSXOPR6,DSXOPR7,DSXOPR8:
                               DSXOPR9,DSXOPR10,DSXOPR11,DSXOPR12,DSXOPR13
.
          STORE     ZERO,FORM2,DSBUDG1,DSBUDG2,DSBUDG3:
                               DSBUDG4,DSBUDG5,DSBUDG6:
                               DSBUDG7,DSBUDG8,DSBUDG9:
                               DSBUDG10,DSBUDG11,DSBUDG12:
                               DSBUDG13
.
          COMPARE   TEN3,FORM2
          GOTO      CDAT9999 IF EQUAL
.
          ADD       ONE,FORM2
          GOTO      CDAT1000
CDAT9999  RETURN
.
.
ENDIT     CHAIN     PGM
.
          INCLUDE   PATCOMN3
          INC       PATCODKY
          INC       PATDOCKY
          INC       PATCODIO/INC
          INC       PATDSCIO/INC
          INC       PATDRGIO/INC
          INC       PATDO1IO/INC
          INC       PATECOIO/INC
          INC       PATMI1IO/INC
          INC       PMSVX1IO/INC
          INC       PATMMBIO/INC
          INC       PATTRNIO/INC
          INC       PATDSTIO/INC
          INC       PATMA1IO/INC
          INC       STD001IO
          INC       TFILENAM 
          INC       IBASEQIO/INC 
          INC       WEBERRIO/INC
.

.******************************************************************************
.* System         : Mental Health                                             *
.*                                                                            *
.* Include Name   : MHAUDVIS.PBL                                              *
.*                                                                            *
.* Function       : Maintain the MEH Visit file audits.                       *
.*                                                                            *
.* Author         : Justin Coates                                             *
.*                                                                            *
.* Date Written   : 17/09/1991                                                *
.*                                                                            *
.* Index used     : MEHAUDVI,"mehaudvi"                                       *
.*                                                                            *
.* Parameters     : MHCNAUDA      Audits being used; 1 = No; 0 = Yes          *
.*                  AUDIFLAG      which type of audit to do                   *
.*                     1 = 'ADD' audit                                        *
.*                     2 = 'BEFORE CHANGE' audit                              *
.*                     3 = 'AFTER CHANGE' audit                               *
.*                     4 = 'DELETE' audit                                     *
.*                     5 = delete 'before change' audit                       *
.*                                                                            *
.* Modifications  :                                                           *
.******************************************************************************
.
MHAUDVIS  BRANCH    MHCNAUDA,AUDVI999       * audits not on
.
          COMPARE   FIVE,AUDIFLAG
          GOTO      AUDVI700 IF EQUAL       * delete before change audit
.
          COMPARE   THREE,AUDIFLAG
          GOTO      AUDVI200 IF EQUAL       * after change - leave date/time
.
.         get the current date and time
.
          CALL      IBACLOCK                * get date and time
          PACK      MHVIAUDD,CCC,CYY,CMM,CDD
          REP       " 0",MHVIAUDD           * date
          MOVE      CTIMEIS,MHVIAUDT        * time
.
AUDVI200  MOVE      PORT,MHVIAUDP           * port
          MOVE      AUDIFLAG,MHVIAUDR       * copy audit type
          REP       "1A2B3C4D",MHVIAUDR     * get the correct letter
          MOVE      ONE,MHVIAUDS            * set as not printed
          MOVE      PASSCODE,MHVIAUDO       * operator id
.
          PACK      KEY19,MHVIAUDD,MHVIAUDT,MHVIAUDP,MHVIAUDR
          CALL      AWMHVIS                 * write the audit
          GOTO      AUDVI999
.
.         delete the before change audit
.
AUDVI700  PACK      KEY19,MHVIAUDD,MHVIAUDT,MHVIAUDP,ANSB
          CALL      ADMHVIS                 * delete the audit
.
AUDVI999  RETURN
+

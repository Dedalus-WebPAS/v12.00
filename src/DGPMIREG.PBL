.**************************************************************************
.*  DGPMIREG  :  Register a patient for a Datagate request                *
.*               ~~~~~~~~                                                 *
.*                                                                        *
.*  Author    :  ROD   (19/10/95)                                         *
.*  Mods      :                                                           *
.*           V12.00.01 22/05/2025  Alina Bhari   TSK 0955096              *
.*                     Added alpanumeric visit number generation          *
.                      -DGPRG600,PPRV5000                                 *
.*           V10.02.02 13/07/2011  Steve Armstrong   CAR 240722           *
.*                     Further mods to cater for second given name as     *
.*                     part PATGSRFD of keys                              *
.*           V10.02.01 22/06/2011  Steve Armstrong   CAR 240722           *
.*                     Mods to cater for changes to PATGSRFD:             *
.*                       - GSRSNAM & GSRGNAM extended to 30 chars.        *
.*                       - PTGSGNM2 added.                                *
.*                       - all indexes changed in length.                 *
.**************************************************************************
.*           V10.01.01 02/02/2011  Steve Armstrong   CAR 237520           *
.*                     Mods to remove Detente interface (PATDETNT)        *
.**************************************************************************
.*            V9.02.05 14/11/2002  Davin                                  *
.*                     Removed reference to $$DBASE WEB compile option    *
.*            V9.02.04  24/05/2002  Steve Armstrong   srf 18019           *
.*                     Mods to allow a U/R number to be passed for        *
.*                     Register.                                          *
.*            V9.02.03  22/04/2002  Mike Laming                           *
.*                     Replace PMEDI with Composite variable PMEDIXX      *
.*                     (which contains PMEDI+PTMXMCCD) Add call (SPLTPMED)*
.*                     to split these                                     *
.*            V9.02.02 26/09/2001  Mike Laming                            *
.*                     Add fields from PMI Master Extension 2 - PMSPX2    *
.*                     data fields PMPXINTR -> PMPXFREL (for RCH & SVHM)  *
.*                     for WEB based versions only                        *
.*            V9.02.01  08/09/2001  Glenn Saunders                        *
.*                     Chg keys for patgsrn reads to reflect enhanced indx*
.*            V5.10.B01 29/03/2001  Glenn Saunders                        *
.*                     Remove access to PTCNSNDX and associated processing*
.*                     Remove all references to PATSUR file (old surnames)*
.*            V5.09.B01 03/01/2001  J.Tan                                 *
.*                     Added Sex & Date of Birth to patgsrnf file         *
.*            V5.07.04 22/02/2000  Steve Armstrong                        *
.*                     Fixed setting of Unique Eclipse Patient Id in      *
.*                     dgtrplaf                                           *
.*            V5.07.03 18/02/2000  Steve Armstrong                        *
.*                     Fixed setting of RPLYCODE to "00000" when no       *
.*                     error occurs.                                      *
.*            V5.07.02 28/01/2000  Steve Armstrong                        *
.*                     Mods to cater for messages from ECSRVPMI (Eclipse) *
.*                     as well as DGSRVPMI.                               *
.*            V5.07.01 22/12/1998  Davin                                  *
.*                     Y2K mods                                           *
.*            V5.07.00 26/10/1998  Davin                                  *
.*                     Mods for 507                                       *
.**************************************************************************
.*            V5.05.02 16/12/1997  Steve Armstrong      HWK               *
.*                     Mods for using NHI number instead of generating UR *
.*            V5.05.01 13/10/1997  Steve Armstrong   WHL                  *
.*                     Mods for new Master extension file variables       *
.*                     (PTMXOPER - PTMXPOST)                              *
.**************************************************************************
.*            V5.04.01 16/04/1997  Steve Armstrong                        *
.*                     Mods to use separate inbound & outbound comms      *
.*                     clients for PMI requests (DGATEIN/DGATEOUT)        *
.*                                                                        *
.**************************************************************************
.
DGPMIREG  MATCH     "ECSRVPMI",PRGID
          IF        !@EQUAL
            MOVE      "REG",RPLYHEAD
.
            READ      DGATEOUT;PTITL,PHOSP,PLDAYS,PBDEBT,PSNAME,PGNAME,PPSNAME:
                            PADD1,PADD2,PSUBRB,PADD4,PPOST,PTELEP,PTELEB:
                            PSEX,PMSTAT,PBDATE,PCONT,PREG,PTYPE,POCCUP:
                            PLDDATE,PMEDIXX,PPENNO,PPNDTE,PREPAT,PSMOK,PMICRO:
                            PCEASE,PCASE,PAUTOPY,PHIGH1,PHIGH2,PHIGH3:
                            PLOCDOC,PFUNDH,PFNDTB,PFNDMM,PUSR1,PUSR2,PUSR3:
                            PUSR4,PUSR5,PUSR6,PUYN1,PUYN2,PUYN3,PYRRES:
                            PNKNAME,PNKADD1,PNKADD2,PNKSUBR,PNKADD4,PNKPOST:
                            PNKTELP,PNKTELB,PNKRELP,PFNDYY,PFNDCG,PDECDTE:
                            PDIET,PINITHOS,PHKADUNI,PTMAEMPC,PTMANOKO:
                            PTMANOKE,PTMADCNO,PTMXRDAT,PTMXMEAL,PTMXLGA:
                            PTMXLS,PTMXLSDT,PTMXFHMD,PTMXMHU1,PTMXMHU2:
                            PTMXMHU3,PTMXECNM,PTMXECA1,PTMXECA2,PTMXECA3:
                            PTMXECA4,PTMXECPC,PTMXECPP,PTMXECBP,PTMXECRE:
                            PTMXNRNM,PTMXNRA1,PTMXNRA2,PTMXNRA3,PTMXNRA4:
                            PTMXNRPC,PTMXNRPP,PTMXNRBP,PTMXNRRE,PTMX3BEX:
                            PTMXCARD,PTMXCEXP,PTMXCXMP,PTMXFMLY,PTMXCHNM:
                            PTMXDOFR,PMPXRHC1,PMPXRH1G,PTMXSPID,PMPXR1GC:
                            PTMXOSDT,PTNINMPI:
                            PTMXOPER,PTMXUKDO,PTMXCELL,PTMXADD1,PTMXADD2:
                            PTMXADD3,PTMXADD4,PTMXPOST:
                            PMPXINTR,PMPXLNG1,PMPXLNG2,PMPXLNG3,PMPXPEML:
                            PMPXEDOB,PMPXCMOB,PMPXCEML,PMPXCCRP,PMPXKMOB:
                            PMPXKEML,PMPXKCRP,PMPXRMOB,PMPXREML,PMPXRCRP:
                            PMPXMEDC,PMPXDETY,PMPXPRIS,PMPXCSER,PMPXPHEI:
                            PMPXPWEI,PMPXDREC,PMPXDVAC,PMPXPNSD,PMPXUYN4:
                            PMPXUYN5,PMPXUYN6,PMPXABRG,PMPXPRVI,PMPXCRIN:
                            PMPXHOML,PMPXUDC1,PMPXUDC2,PMPXUDC3,PMPXUSR7:
                            PMPXUSR8,PMPXUSR9,PMPXMSNA,PMPXMGNA,PMPXMTLE:
                            PMPXMAD1,PMPXMAD2,PMPXMAD3,PMPXMAD4,PMPXMPOS:
                            PMPXMPNO,PMPXMBNO,PMPXMMNO,PMPXMEML,PMPXMCNT:
                            PMPXMCRP,PMPXMLAB,PMPXMREL,PMPXFSNA,PMPXFGNA:
                            PMPXFTLE,PMPXFAD1,PMPXFAD2,PMPXFAD3,PMPXFAD4:
                            PMPXFPOS,PMPXFPNO,PMPXFBNO,PMPXFMNO,PMPXFEML:
                            PMPXFCNT,PMPXFCRP,PMPXFLAB,PMPXFREL,PURNO
.
          CALL      SPLTPMED                * Split PMEDIXX into PMEDI, PTMXMCCD
          ELSE
            CALL      SETECL00                   * set up Eclipse PMI fields
          ENDIF
.
          MATCH     SP20,PTNINMPI                * national number passed ?
          GOTO      DGPRG500 IF EQUAL            * no - generate number
.
          COMPARE   ONE,PTCNNHII                 * using NHI ?
          GOTO      DGPRG500 IF NOT EQUAL        * no - generate number
.
          SQUEEZE   PTNINMPI                     * yes
          PACK      KEY8,SP1,PTNINMPI
          CALL      RDAMAST1                     * U/R on file already ?
          IF        OVRCD = 0
            MOVE      "Patient Master record exists already",RPLYDESC
            MOVE      "01103",RPLYCODE
            GOTO      DGPRG900
          ELSE
            MOVE    KEY8,PURNO
            GOTO    DGPRG600
          ENDIF
.
.         Computer generate U/R Number if none provided
.
DGPRG500  MATCH     SP8,PURNO
          IF        !@EQUAL
            MOVE      PURNO,KEY8
            CALL      RDAMAST1
            IF        OVRCD = 0
              MOVE      "Patient Master record exists already",RPLYDESC
              MOVE      "01103",RPLYCODE
              GOTO      DGPRG900
            ELSE
              GOTO      DGPRG600
            ENDIF
  
          ENDIF
.
          MOVE      THREE,CPSYSTEM
          CALL      GNXTUR                       * Get next U/R Number
. 
.         set other fields for U/R write
.
DGPRG600  MOVE      ZERO,PSTAT                    * we have a valid U/R flag
          MOVE      SP30,PHCNOTES                 * Zero Fill Case Notes Indic.
          REP       " 0",PHCNOTES
          MOVE      CHOSPNUM,PINITHOS             * Init Hospital Number
          MOVE      ZEROVISN,PVIBILL              * No pre-attend rec. to update
          MOVE      THREE,PVITYPE                 * Inpatient System    
          MOVE      SP2,PPORT
          MOVE      SP8,PCHGDTE
          MOVE      ZEROVISN,PLSTINP
          MOVE      ZEROVISN,PLSTOUT
          MOVE      ZERO,PNXRAY
          MOVE      SP4,PTMXOPER
.
          CALL      IBACLOCK
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          REP       " 0",AGEDATE
          CALL      CALCAGE 
          MOVE      PSAGEYRS,PSAGE
.
. write U/R details to patmastf,patsurnf/patgsrnf,master audit,U/R change audit
.                               patsurnf - no longer in service V.10.B01
.
          CALL      WRTUR
.
.         If this is the Eclipse interface, then we need to return the U/R
.         generated by TBL, back to Eclipse via the dgtrplaf file
.         
          MATCH     "ECSRVPMI",PRGID
          IF        @EQUAL
            CALL      IBACLOCK
            MOVE      "RGR",DGRPRPLY
            MOVE      "00000",DGRPSTAT
            MOVE      SP50,DGRPERRD
            PACK      DGRPPAS1,ECINECID,SP30,SP20
            MOVE      DGMISC2,DGRPPAS2
            MOVE      DGMISC3,DGRPPAS3
            MOVE      PURNO,DGRPURNO
            MOVE      PTNINMPI,DGRPNHSN
            PACK      DGRPDATE,CCC,CYY,CMM,CDD
            REPLACE   " 0",DGRPDATE
            MOVE      CTIMEIS,DGRPTIME
            MOVE      PRGID,DGRPPROG
            MOVE      PASSCODE,DGRPUSER
            MOVE      SP50,DGRPSPAR
            CALL      WRDGRPL1                   * write new record
          ENDIF
.
. now write other U/R details
.
          MOVE      PURNO,KEY8
          CALL      RDMAST1
          CALL      RDPMPX21
.
          PACK      PUSR1,PUSR1,SP3
          MATCH     SP3,PUSR1
          IF        !@EQUAL
            MOVE      SP20,TDESC
            MOVE      "P1",DIM2
            PACK      KEY5,DIM2,PUSR1
            CALL      RDCODE1
          ENDIF
            
          MOVE      THREE,DETNTREC
.
          CALL      PPRV0000                * post previous surname as alias
.
          MOVE      PTNINMPI,NMPNUMB        * set national number
          CALL      PNMP0000                * Post National Number
.
. send reply message as successful
.     NB.  SP1 at end of reply has been added because the interpreter does
.     not place a "|" after the last field, and Datagate requires this.  By
.     putting an extra field on the end (which is blank), a "|" will then
.     be added after the last field.
.
          MOVE      "00000",RPLYCODE        * successful message
          MATCH     "ECSRVPMI",PRGID
          IF        !@EQUAL
            MOVE      SP50,RPLYDESC           * clear error description
            PACK      CCENCODE,CCDATE,CCDST,CCSRC,CCNAME,REPLYRPL
            WRITE     DGATEIN;CCENCODE:
                            RPLYHEAD,RPLYCODE,RPLYDESC,DGMISC1,DGMISC2:
                            DGMISC3,PURNO,PTNINMPI,SP1
          ENDIF
          ADD       ONE,SUCCPROC            * increment # successful processed
          GOTO      DGPRG999
.
. --- send back an Error response ---
.
DGPRG900  MATCH     "ECSRVPMI",PRGID
          IF        !@EQUAL
            PACK      CCENCODE,CCDATE,CCDST,CCSRC,CCNAME,REPLYRPL
            WRITE     DGATEIN;CCENCODE:
                               RPLYHEAD,RPLYCODE,RPLYDESC,DGMISC1:
                               DGMISC2,DGMISC3,PURNO,PTNINMPI,SP1
          ENDIF
          ADD       ONE,ERRRPROC                  * increm # error transactions
.
DGPRG999  RETURN
+
.************************************************************************
.*                           PPRV0000                                   *
.*       Post previous surname as an alias if desired                   *
.************************************************************************
PPRV0000  BRANCH    PTPRVALS,PPRV0100        * parameter switched on
          GOTO      PPRV9999                 * parameter off
.
.         Check if we have a previous surname
.
PPRV0100  PACK      GSRSNAM,PPSNAME,SP70     * surname
          MATCH     GSRSNAM,SP70             * surname blank ?
          GOTO      PPRV9999 IF EQUAL        * yes, do nothing
.
.         Given name soundex file
.
PPRV5000  MOVE      PMPXFNAM,GSRGNAM
          MOVE      PMPXSNAM,PTGSGNM2
          MOVE      PBDATE,GSRDOB           * Date of birth
          MOVE      PSEX,GSRSEX             * Sex
          MOVE      PURNO,GSRURNO
          MOVE      ZEROVISN,GSRBILL
          MOVE      ZERO,GSRSYS
          CALL      SOUNDEX                  * get soundex key for surname
          CALL      SOUNDX2                  * get soundex key for given names
.
          PACK      KEY115,GSRURNO,GSRBILL,GSRSNAM,GSRGNAM,PTGSGNM2,GSRDOB:
                           GSRSEX
          CALL      RDPTGSR1                 * check if its already there
          BRANCH    OVRCD,PPRV6000
          GOTO      PPRV9999
.
.         Record does not exist, post it away
.
PPRV6000  CALL      WRPTGSR1
.
PPRV9999  RETURN
+
.***************************************************************************
.*                           SETECL00                                      *
.*         Update the relevant PMI fields if the update flag is not "{{"   *
.***************************************************************************
.
SETECL00    MATCH     UPDFLAG,ECINTITL
            IF        !@EQUAL
              MOVE      ECINTITL,PTITL
            ENDIF
.
            MATCH     UPDFLAG,ECINDEBT
            IF        !@EQUAL
              MOVE      ECINDEBT,PBDEBT
            ENDIF
.
            MATCH     UPDFLAG,ECINSNAM
            IF        !@EQUAL
              MOVE      ECINSNAM,PSNAME
            ENDIF
.
            MATCH     UPDFLAG,ECINGNAM
            IF        !@EQUAL
              MOVE      ECINGNAM,PGNAME
            ENDIF
.
            MATCH     UPDFLAG,ECINADD1
            IF        !@EQUAL
              MOVE      ECINADD1,PADD1
            ENDIF
.
            MATCH     UPDFLAG,ECINADD2
            IF        !@EQUAL
              MOVE      ECINADD2,PADD2
            ENDIF
.
            MATCH     UPDFLAG,ECINADD3
            IF        !@EQUAL
              MOVE      ECINADD3,PSUBRB
            ENDIF
.
            MATCH     UPDFLAG,ECINADD4
            IF        !@EQUAL
              MOVE      ECINADD4,PADD4
            ENDIF
.
            MATCH     UPDFLAG,ECINPOST
            IF        !@EQUAL
              MOVE      ECINPOST,PPOST
            ENDIF
.
            MATCH     UPDFLAG,ECINPTEL
            IF        !@EQUAL
              MOVE      ECINPTEL,PTELEP
            ENDIF
.
            MATCH     UPDFLAG,ECINBTEL
            IF        !@EQUAL
              MOVE      ECINBTEL,PTELEB
            ENDIF
.
            MATCH     UPDFLAG,ECINPSEX
            IF        !@EQUAL
              MOVE      ECINPSEX,PSEX
            ENDIF
.
            MATCH     UPDFLAG,ECINMSTA
            IF        !@EQUAL
              MOVE      ECINMSTA,PMSTAT
            ENDIF
.
            MATCH     UPDFLAG,ECINPDOB
            IF        !@EQUAL
              MOVE      ECINPDOB,PBDATE
            ENDIF
.
            MATCH     UPDFLAG,ECINCONT
            IF        !@EQUAL
              MOVE      ECINCONT,PCONT
            ENDIF
.
            MATCH     UPDFLAG,ECINPREG
            IF        !@EQUAL
              MOVE      ECINPREG,PREG
            ENDIF
.
            MATCH     UPDFLAG,ECINPTYP
            IF        !@EQUAL
              MOVE      ECINPTYP,PTYPE
            ENDIF
.
            MATCH     UPDFLAG,ECINOCCP
            IF        !@EQUAL
              MOVE      ECINOCCP,POCCUP
            ENDIF
.
            MATCH     UPDFLAG,ECINSMOK
            IF        !@EQUAL
              MOVE      ECINSMOK,PSMOK
            ENDIF
.
            MATCH     UPDFLAG,ECINCEAS
            IF        !@EQUAL
              MOVE      ECINCEAS,PCEASE
            ENDIF
.
            MATCH     UPDFLAG,ECINCASE
            IF        !@EQUAL
              MOVE      ECINCASE,PCASE
            ENDIF
.
            MATCH     UPDFLAG,ECINAUTO
            IF        !@EQUAL
              MOVE      ECINAUTO,PAUTOPY
            ENDIF
.
            MATCH     UPDFLAG,ECINLDOC
            IF        !@EQUAL
              MOVE      ECINLDOC,PLOCDOC
            ENDIF
.
            MATCH     UPDFLAG,ECINHFND
            IF        !@EQUAL
              MOVE      ECINHFND,PFUNDH
            ENDIF
.
            MATCH     UPDFLAG,ECINFTBL
            IF        !@EQUAL
              MOVE      ECINFTBL,PFNDTB
            ENDIF
.
            MATCH     UPDFLAG,ECINFMEM
            IF        !@EQUAL
              MOVE      ECINFMEM,PFNDMM
            ENDIF
.
            MATCH     UPDFLAG,ECINYRES
            IF        !@EQUAL
              MOVE      ECINYRES,PYRRES
            ENDIF
.
            MATCH     UPDFLAG,ECINNNAM
            IF        !@EQUAL
              MOVE      ECINNNAM,PNKNAME
            ENDIF
.
            MATCH     UPDFLAG,ECINNAD1
            IF        !@EQUAL
              MOVE      ECINNAD1,PNKADD1
            ENDIF
.
            MATCH     UPDFLAG,ECINNAD2
            IF        !@EQUAL
              MOVE      ECINNAD2,PNKADD2
            ENDIF
.
            MATCH     UPDFLAG,ECINNAD3
            IF        !@EQUAL
              MOVE      ECINNAD3,PNKSUBR
            ENDIF
.
            MATCH     UPDFLAG,ECINNAD4
            IF        !@EQUAL
              MOVE      ECINNAD4,PNKADD4
            ENDIF
.
            MATCH     UPDFLAG,ECINNPOS
            IF        !@EQUAL
              MOVE      ECINNPOS,PNKPOST
            ENDIF
.
            MATCH     UPDFLAG,ECINNPTL
            IF        !@EQUAL
              MOVE      ECINNPTL,PNKTELP
            ENDIF
.
            MATCH     UPDFLAG,ECINNBTL
            IF        !@EQUAL
              MOVE      ECINNBTL,PNKTELB
            ENDIF
.
            MATCH     UPDFLAG,ECINNREL
            IF        !@EQUAL
              MOVE      ECINNREL,PNKRELP
            ENDIF
.
            MATCH     UPDFLAG,ECINYRSM
            IF        !@EQUAL
              MOVE      ECINYRSM,PFNDYY
            ENDIF
.
            MATCH     UPDFLAG,ECINFCHG
            IF        !@EQUAL
              MOVE      ECINFCHG,PFNDCG
            ENDIF
.
            MATCH     UPDFLAG,ECINDDAT
            IF        !@EQUAL
              MOVE      ECINDDAT,PDECDTE
            ENDIF
.
            MATCH     UPDFLAG,ECINDIET
            IF        !@EQUAL
              MOVE      ECINDIET,PDIET
            ENDIF
.
            MATCH     UPDFLAG,ECINDCNO
            IF        !@EQUAL
              MOVE      ECINDCNO,PTMADCNO
            ENDIF
.
            MATCH     UPDFLAG,ECINRDAT
            IF        !@EQUAL
              MOVE      ECINRDAT,PTMXRDAT
            ENDIF
.
            MATCH     UPDFLAG,ECINMEAL
            IF        !@EQUAL
              MOVE      ECINMEAL,PTMXMEAL
            ENDIF
.
            MATCH     UPDFLAG,ECINFHMD
            IF        !@EQUAL
              MOVE      ECINFHMD,PTMXFHMD
            ENDIF
.
            MATCH     UPDFLAG,ECINECNM
            IF        !@EQUAL
              MOVE      ECINECNM,PTMXECNM
            ENDIF
.
            MATCH     UPDFLAG,ECINECA1
            IF        !@EQUAL
              MOVE      ECINECA1,PTMXECA1
            ENDIF
.
            MATCH     UPDFLAG,ECINECA2
            IF        !@EQUAL
              MOVE      ECINECA2,PTMXECA2
            ENDIF
.
            MATCH     UPDFLAG,ECINECA3
            IF        !@EQUAL
              MOVE      ECINECA3,PTMXECA3
            ENDIF
.
            MATCH     UPDFLAG,ECINECA4
            IF        !@EQUAL
              MOVE      ECINECA4,PTMXECA4
            ENDIF
.
            MATCH     UPDFLAG,ECINECPC
            IF        !@EQUAL
              MOVE      ECINECPC,PTMXECPC
            ENDIF
.
            MATCH     UPDFLAG,ECINECPP
            IF        !@EQUAL
              MOVE      ECINECPP,PTMXECPP
            ENDIF
.
            MATCH     UPDFLAG,ECINECBP
            IF        !@EQUAL
              MOVE      ECINECBP,PTMXECBP
            ENDIF
.
            MATCH     UPDFLAG,ECINECRE
            IF        !@EQUAL
              MOVE      ECINECRE,PTMXECRE
            ENDIF
.
            MATCH     UPDFLAG,ECINNRNM
            IF        !@EQUAL
              MOVE      ECINNRNM,PTMXNRNM
            ENDIF
.
            MATCH     UPDFLAG,ECINNRA1
            IF        !@EQUAL
              MOVE      ECINNRA1,PTMXNRA1
            ENDIF
.
            MATCH     UPDFLAG,ECINNRA2
            IF        !@EQUAL
              MOVE      ECINNRA2,PTMXNRA2
            ENDIF
.
            MATCH     UPDFLAG,ECINNRA3
            IF        !@EQUAL
              MOVE      ECINNRA3,PTMXNRA3
            ENDIF
.
            MATCH     UPDFLAG,ECINNRA4
            IF        !@EQUAL
              MOVE      ECINNRA4,PTMXNRA4
            ENDIF
.
            MATCH     UPDFLAG,ECINNRPC
            IF        !@EQUAL
              MOVE      ECINNRPC,PTMXNRPC
            ENDIF
.
            MATCH     UPDFLAG,ECINNRPP
            IF        !@EQUAL
              MOVE      ECINNRPP,PTMXNRPP
            ENDIF
.
            MATCH     UPDFLAG,ECINNRBP
            IF        !@EQUAL
              MOVE      ECINNRBP,PTMXNRBP
            ENDIF
.
            MATCH     UPDFLAG,ECINNRRE
            IF        !@EQUAL
              MOVE      ECINNRRE,PTMXNRRE
            ENDIF
.
            MATCH     UPDFLAG,ECINCARD
            IF        !@EQUAL
              MOVE      ECINCARD,PTMXCARD
            ENDIF
.
            MATCH     UPDFLAG,ECINCEXP
            IF        !@EQUAL
              MOVE      ECINCEXP,PTMXCEXP
            ENDIF
.
            MATCH     UPDFLAG,ECINCXMP
            IF        !@EQUAL
              MOVE      ECINCXMP,PTMXCXMP
            ENDIF
.
            MATCH     UPDFLAG,ECINFMLY
            IF        !@EQUAL
              MOVE      ECINFMLY,PTMXFMLY
            ENDIF
.
            MATCH     UPDFLAG,ECINREGP
            IF        !@EQUAL
              MOVE      ECINREGP,PMPXRHC1
            ENDIF
.
            MATCH     UPDFLAG,ECINGPPC
            IF        !@EQUAL
              MOVE      ECINGPPC,PMPXRH1G
            ENDIF
.
            MATCH     UPDFLAG,ECINOSDT
            IF        !@EQUAL
              MOVE      ECINOSDT,PTMXOSDT
            ENDIF
.
SETECL99  RETURN
+

. *----------------------------------------------------------------------
. * Include Name  :   MRTCAHTM.PBL
. *
. * Function      :   CGI variables for MRTCAHFD - mrtcahaf.dat
. *
. * Includes Needed : MRTCAHFD - Coding Audit Header           
. *                   MRTCAHIO - IO for Coding Audit Header         
. * Modifications :
. * V11.03.00 13/07/2023 Bella Turco     TSK 0901388
. *           Created
. *----------------------------------------------------------------------
.
.------------------------------------------------------------------------
.   Clear CGIs for Coding Audit Header          
.------------------------------------------------------------------------
.
CLCCAH00  MOVE      SP70,MRCAH001
          MOVE      SP70,MRCAH002
          MOVE      SP70,MRCAH003
          MOVE      SP70,MRCAH004
          MOVE      SP70,MRCAH005
          MOVE      SP70,MRCAH006
          MOVE      SP70,MRCAH007
          MOVE      SP70,MRCAH008
          MOVE      SP70,MRCAH009
          MOVE      SP70,MRCAH010
          MOVE      SP70,MRCAH011
          MOVE      SP70,MRCAH012
.
CLCCAH99  RETURN
.
.------------------------------------------------------------------------
.   Clear Parameters for Coding Audit Header         
.------------------------------------------------------------------------
.
CLRCAH00  MOVE      SP70,MRCHADMN
          MOVE      SP70,MRCHADAT
          MOVE      SP70,MRCHATIM
          MOVE      SP70,MRCHWEBU
          MOVE      SP70,MRCHNDRG
          MOVE      SP70,MRCHDRGV
          MOVE      SP70,MRCHHDRG
          MOVE      SP70,MRCHHDGV
          MOVE      SP70,MRCHNWAU
          MOVE      SP70,MRCHICDV
          MOVE      SP70,MRCHPDCD
          MOVE      SP70,MRCHPPCD
.
CLRCAH99  RETURN
.
.------------------------------------------------------------
. Coding Audit Header Fields
.------------------------------------------------------------
MCAH0000  BRANCH    FLDITMNO,MCAH0010,MCAH0020,MCAH0030,MCAH0040,MCAH0050:
                             MCAH0060,MCAH0070,MCAH0080,MCAH0090,MCAH0100:
                             MCAH0110,MCAH0120,MCAH0130,MCAH0140
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MCAH9999
.
MCAH0010  WRITE     HTMLFILE;MRCHADMN;   * Admission Number
          GOTO      MCAH9999
.
MCAH0020  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MCAH0021
          WRITE     HTMLFILE;MRCHADAT;    * Audit Date (ccyymmdd)
          GOTO      MCAH9999
.
MCAH0021  UNPACK    MRCHADAT,CCENT,CYEAR,CMON,CDAY
          MOVE      ZERO,F2
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,AT,SP1,MRCHATIM
          WRITE     HTMLFILE;KEY11;      * Audit Date (dd mmm ccyy)
          GOTO      MCAH9999
.
MCAH0030  WRITE     HTMLFILE;MRCHATIM;   * Audit Time (hh:mm:ss)
          GOTO      MCAH9999
.
MCAH0040  WRITE     HTMLFILE;MRCHWEBU;   * WEB user ID (websecaf)
          GOTO      MCAH9999
.
MCAH0050  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MCAH0051
          WRITE     HTMLFILE;MRCHNDRG;   * National DRG
          GOTO      MCAH9999
.
MCAH0051  PACK      KEY7,MRCHNDRG,MRCHDRGV,SP70
          CALL      RDPTDGW1
          IF        OVRCD=1
            PACK      KEY70,SP70
          ELSE
            MOVE      SP70,KEY70
            MOVE      SP70,D1
            MOVE      SP70,DIM1
            MOVE      SP70,ANS
            UNPACK    MRCHDRGV,D1,DIM1,ANS
            MATCH     SP70,MRCHDRGV
            IF        !@EQUAL
              MATCH     "0",D1
              IF        @EQUAL
                PACK      KEY70,MRCHNDRG,SLASH,DIM1,DOT,ANS,DASH,PTDWDESC,SP70
              ELSE
                PACK      KEY70,MRCHNDRG,SLASH,D1,DIM1,DOT,ANS,DASH,PTDWDESC,SP70
              ENDIF
            ENDIF
          ENDIF
          WRITE     HTMLFILE;KEY70;      * National DRG/VER/DESC
          GOTO      MCAH9999
.
MCAH0060  WRITE     HTMLFILE;MRCHDRGV;   * National DRG Version
          GOTO      MCAH9999
.
MCAH0070  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MCAH0071
          WRITE     HTMLFILE;MRCHHDRG;   * Health Fund DRG
          GOTO      MCAH9999
.
MCAH0071  PACK      KEY7,MRCHHDRG,MRCHHDGV,SP70
          CALL      RDPTDGW1
          IF        OVRCD=1
            PACK      KEY70,SP70
          ELSE
            MOVE      SP70,KEY70
            MOVE      SP70,D1
            MOVE      SP70,DIM1
            MOVE      SP70,ANS
            UNPACK    MRCHHDGV,D1,DIM1,ANS
            MATCH     SP70,MRCHHDGV
            IF        !@EQUAL
              MATCH     "0",D1
              IF        @EQUAL
                PACK      KEY70,MRCHHDRG,SLASH,DIM1,DOT,ANS,DASH,PTDWDESC,SP70
              ELSE
                PACK      KEY70,MRCHHDRG,SLASH,D1,DIM1,DOT,ANS,DASH,PTDWDESC,SP70
              ENDIF
            ENDIF
          ENDIF
          WRITE     HTMLFILE;KEY70;      * Health Fund DRG/VER/DESC
          GOTO      MCAH9999
.
MCAH0080  WRITE     HTMLFILE;MRCHHDGV;   * Health Fund DRG Version
          GOTO      MCAH9999
.
MCAH0090  WRITE     HTMLFILE;MRCHNWAU;   * NWAU
          GOTO      MCAH9999
.
MCAH0100  WRITE     HTMLFILE;MRCHICDV;   * ICD Version
          GOTO      MCAH9999
.
MCAH0110  WRITE     HTMLFILE;MRCHPDCD;   * Primary Diagnosis Code
          GOTO      MCAH9999
.
MCAH0120  WRITE     HTMLFILE;MRCHPPCD;   * Primary Procedure Code
          GOTO      MCAH9999
.
MCAH0130  PACK      KEY27,MRCHADMN,MRCHADAT,MRCHATIM,SP1,SP1,ONE,SP70
          CALL      RSMRCAD1
MCAH0131  CALL      RKMRCAD1
          MATCH     MRCHADMN,MRCDADMN
          GOTO      MCAH9999 IF NOT EQUAL
          MATCH     "03",MRCDRTYP
          GOTO      MCAH0131 IF NOT EQUAL
          WRITE     HTMLFILE;MRCDDCOD;   * Claim Type
          GOTO      MCAH9999
.
MCAH0140  PACK      KEY27,MRCHADMN,MRCHADAT,MRCHATIM,SP1,SP1,ONE,SP70
          CALL      RSMRCAD1
MCAH0141  CALL      RKMRCAD1
          MATCH     MRCHADMN,MRCDADMN
          GOTO      MCAH9999 IF NOT EQUAL
          MATCH     "04",MRCDRTYP
          GOTO      MCAH0141 IF NOT EQUAL
          WRITE     HTMLFILE;MRCDDCOD;   * Health Fund 
          GOTO      MCAH9999
.
MCAH9999  RETURN   
.
.------------------------------------------------------------
.   Set Parameters for Coding Audit Header        
.------------------------------------------------------------
SPCAH000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPCAH001,SPCAH002,SPCAH003,SPCAH004,SPCAH005:
                       SPCAH006,SPCAH007,SPCAH008,SPCAH009,SPCAH010:
                       SPCAH011,SPCAH012
.
          MOVE      ONE,EXIT
          GOTO      SPCAH999
.
SPCAH001  PACK      MRCAH001,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH002  PACK      MRCAH002,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH003  PACK      MRCAH003,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH004  PACK      MRCAH004,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH005  PACK      MRCAH005,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH006  PACK      MRCAH006,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH007  PACK      MRCAH007,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH008  PACK      MRCAH008,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH009  PACK      MRCAH009,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH010  PACK      MRCAH010,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH011  PACK      MRCAH011,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH012  PACK      MRCAH012,QRYDATA,SP70
          GOTO      SPCAH999
.
SPCAH999  RETURN
+
.------------------------------------------------------------------------
.         Move work variables to Coding Audit Header variables   
.------------------------------------------------------------------------
MVMRCH00  MOVE      MRCAH001,MRCHADMN
          MOVE      MRCAH002,MRCHADAT
          MOVE      MRCAH003,MRCHATIM
          MOVE      MRCAH004,MRCHWEBU
          MOVE      MRCAH005,MRCHNDRG
          MOVE      MRCAH006,MRCHDRGV
          MOVE      MRCAH007,MRCHHDRG
          MOVE      MRCAH008,MRCHHDGV
          MOVE      MRCAH009,MRCHNWAU
          MOVE      MRCAH010,MRCHICDV
          MOVE      MRCAH011,MRCHPDCD
          MOVE      MRCAH012,MRCHPPCD
.
MVMRCH99  RETURN
+

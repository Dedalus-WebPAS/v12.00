.----------------------------------------------------------------------
.   Program       : GENERPKI
.   CAR Number    : 22680 
.   Modifications : 
.         V11.03.02 25.09.2023  DA Sarkies    TSK 0914515
.                   Recompiled for PMSPKIPR
.         V11.03.01 03.08/2023  DA Sarkies    TSK 0914515
.                   Added CONTROLF to load state for HCP extract
.         V10.11.01 08/08/2017  Tracey Nguyen TSK 0299206
.                   Recompiled for PMSPKIPR - Added Sound-Ex key for
.                   Practice Name
.         V10.07.01 10/03/2016 Peter McMullem CAR 0815423
.                   Use mandatory env var QISNAME to detect Oracle 
.         V10.03.01 19/09/2012  Davin         CAR 269841
.                   Added isclear of keyword table
.         V9.04.00  12/05/2005  Davin S
.                   Created program
.----------------------------------------------------------------------
.
.----------------------------------------------------------------------
.  data includes
.----------------------------------------------------------------------
.
          INC       STDGENDF
          INC       PMSHCGFD/INC
          INC       PMSPKIFD/INC
          INC       PATCONFD/INC
.
.----------------------------------------------------------------------
.  local variables
.----------------------------------------------------------------------
.
CMDLINE   DIM       50
.
PRGID     INIT      "GENERPKI"
PRGNAM    INIT      "Fix pmspkiaf"
VERSION   INIT      "V12.00.00"
.
.----------------------------------------------------------------------
.  program code
.----------------------------------------------------------------------
.
.---- initialise screen and confirm desire to execute program ----
.
ML0000    CALL      DISPHEAD
.
          DISPLAY   *P1:10,"This file generate HCG Keyword records."
          CALL      CONTQST
          SUB       ONE,CEXIT
          BRANCH    CEXIT,ML9999,ML9999
.
.---- open files ----
.
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PMSPKIA1,"pmspkiaf"
          OPEN      PMSPKIA2,"pmspkiaf"
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
.
.---- clear out keyword table ----
.
          MOVE      SP70,DIM19
          GETENV    "QISNAME",DIM19
          PACK      DIM19,DIM19,SP70
.
          MATCH     SP70,DIM19
          IF        !@EQUAL
            CLEAR     CMDLINE
            APPEND    "isclear pmspkiaf",CMDLINE
            APPEND    SP70,CMDLINE
            RESET     CMDLINE
            EXECUTE   CMDLINE,TASKID
          ENDIF
.
          MOVE      ZERO,SECTOR
          PACK      KEY12,SP70
ML1000    CALL      RSPMHCG1           * read next record
ML1100    CALL      RKPMHCG1
          BRANCH    OVRCD,ML9999
.
          ADD       ONE,SECTOR
          IF        SECTOR%100=1
            DISPLAY   *P1:24,*V2LON,SECTOR," - ",PMHGPRAC,SP1,PMHGCNTR,*EF;
          ENDIF
.
          PROC      PMSPKIUP
          GOTO      ML1100
.
.---- exit program ----
.
ML9999    CHAIN     PGM
.----------------------------------------------------------------------
.  code includes
.----------------------------------------------------------------------
.
          INC       PMSHCGIO/INC
          INC       PMSPKIIO/INC
          INC       PMSPKIPR
          INC       STDGENCD
.

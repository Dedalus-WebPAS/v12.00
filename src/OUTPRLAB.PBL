.******************************************************************************
.* System    : Outpatients                                                    *
.* Include   : OUTPRLAB.PBL and contains OUTSETLB                             *
.* Desc      : Print Labels Include                                           *
.******************************************************************************
.* Mods      :                                                                *
.*        V10.09.01 02/12/2016  Steve Armstrong  TSK 0817740                  *
.*                  Fixed printing of Practice name for STV labels where no   *
.*                  HCP is available                                          *
.******************************************************************************
.*        V10.08.02 15/11/2016  Steve Armstrong  TSK 0817740                  *
.*                  Further mods to GP labels logic for STV                   *
.*        V10.08.01 10/09/2016  Steve Armstrong  TSK 0817740                  *
.*                  Mods to GP labels for STV to source GP data using the     *
.*                  sequence of visit Practice, visit HCP, PMI practice then  *
.*                  PMI HCP and using the first populated field.              *
.******************************************************************************
.*        V10.07.01 29/10/2015  Ebon Clements    CAR 268970                   *
.*                  Change to use OUTCLIFD index 1 instead of index 2         *
.*        V10.06.01 10/09/2015  Steve Armstrong  CAR 315321                   *
.*                  Mods to remove Marital Status and Religion fields from    *
.*                  STV PMI labels.                                           *
.******************************************************************************
.*        V10.05.01 21/07/2014  Steve Armstrong  CAR 294204                   *
.*                  Added code to handle layout 15 (HOLABLAY) for SJOG Geelong*
.*                  labels.                                                   *
.******************************************************************************
.*        V10.02.01 04/04/2011  Jill Parkinson     CAR 239574                 *
.*                  Removed open of ibaprntf                                  *
.******************************************************************************
.*        V9.10.01  24/09/2008  Sandra Barcham     CAR 164480                 *
.*                  Replace psage with calcage in OSB14000                    *
.******************************************************************************
.*        V9.08.01  02/03/2007  Ebon Clements      CAR 132645                 *
.*                  Save current open site prefix file in CFILEPRE            *
.******************************************************************************
.*        V9.06.01  06/06/2006  Steve Armstrong  CAR 107577                   *
.*                  Changed the font size for U/R on STV labels from 35,38 to *
.*                  30,25 and changed the horizontal position of the U/R from *
.*                  155 to 170.                                               *
.******************************************************************************
.*        V9.03.02  11/06/2004  Mike Laming   CAR 49016  July 2004 PRS/2      *
.*                  - Add Sex Description routine SEXDSC00 with Code "R" -    *
.*                  "Intersex" added                                          *
.*        V9.03.01  20/06/2003  Tonii  CAR 39332 (SV135352)                   *
.*                  Mods to allow text to wrap around to proceeding line if   *
.*                  number of characters is greater than 25 (maximum for each *
.*                  line on the label).                                       *
.******************************************************************************
.*        V9.02.04  17/03/2003  Sylvek Litewka  SRF 37018                     *
.*                  Modified procedures OUT14000 and OSB14000 to allow for    *
.*                  printing of GP labels at St. Vincent's.                   *
.*        V9.02.03  26/05/2001  Bronko                                        *
.*                  Fixed printing of St Vincent Patient Address Label        *
.*        V9.02.02  03/11/2001  Tonii                                         *
.*                  Fixed printing of St Vincent labels, batch printing now   *
.*                  faster, moved "0" to NOCOPIES after print job             *
.*        V9.02.01  13/08/2001  Tonii                                         *
.*                  Added new layout 14, for St Vincent's                     *
.******************************************************************************
.*        V5.08.02  01/09/2000  Tonii                                         *
.*                  Mods to accept Unknown and Indeterminate as valid patient *
.*                  sex description                                           *
.*        V5.08.01  16/03/2000  Steve Armstrong     5.08 Mods                 *
.*                  Mods for changes to OUTCLIFD (effective date)             *
.******************************************************************************
.*        V5.07.00  15/10/1998  Jim Stathopoulos                              *
.*                  507 Changes                                               *
.******************************************************************************
.*        V5.06.01  11/09/1998  Steve Armstrong    SRF 644970                 *
.*                  Changed HWK layout (8) to print obasite instead of "OPD"  *
.******************************************************************************
.*        V5.04.09  23/05/1997  Steve Armstrong    SRF 642902                 *
.*                  Added open on IBAPRNT1                                    *
.*        V5.04.08  13/05/97 J.Tan    SRF 620006                              *
.*                  Recomp.for OUTPRLAB - print postcode on WGH Booking labels*
.*        V5.04.07  17/02/1997  Greg Horvat                                   *
.*                  Added new label layout for WGH Consultancies - layout 13  *
.*        V5.04.06  03/02/1997  Howellsy                                      *
.*                  Added Screen Painted Labels                               *
.*        V5.04.05  16/11/1996  Greg Horvat      SRF 617349                   *
.*                  Added new label layout for MBF - layout 12                *
.*        V5.04.04  03/09/1996  Greg Horvat      SRF 615746 (Rebound)         *
.*                  Changed label layout for Joondalup - I wish they would    *
.*                  make up there fuckin mind                                 *
.*        V5.04.03  12/08/1996  Greg Horvat      SRF 615746 (Rebound)         *
.*                  Changed label layout for Joondalup - layout 11 to print   *
.*                  the hospital name instead of the site name                *
.*        V5.04.02  01/08/1996  Greg Horvat      SRF 615746                   *
.*                  Changed label layout for Joondalup - layout 11            *
.*        V5.04.01  06/06/1996  Greg Horvat      SRF 615571                   *
.*                  Added new label layout for Joondalup - layout 11          *
.*                                                                            *
.*             V5.01    23/05/89 Graeme Williams  SRF 100688                  *
.*                      Changed the fifth line of Modbury labels to print     *
.*                      the site, not "Out:".                                 *
.*             V5.02    24/05/89 Graeme Williams SRF 100688                   *
.*                      Changed the fifth line back to the same as release 4  *
.*                      for Modbury (NB: Prints "OPD" not the outpatient site)*
.*             V5.03    27/10/89 J.Tan                                        *
.*                      Fixed outpatient labels                               *
.*             V5.04    28.11.89 D.Di.Paola SRF 103144                        *
.*                      Allow line 5 to be printed on Wellington Labels,      *
.*                      printing clinic id description......                  *
.*             V5.05    05.12.89 D.Di.Paola SRF103326                         *
.*                      Allow line 5 of outpatient Wellington labels to print *
.*                      Doctor's name if no clinic id description exists.     *
.*             V5.01.06 22/12/89 E.Phan SRF 103510                            *
.*                      Fixed I*C for print labels by changing RDCLIA1 to 2.  *
.*             V5.01.07 10/01/90 K.Peak SRF 103240                            *
.*                      Added the choice to print additional blank labels     *
.*             V5.01.08 14/03/90  E.Phan  Quote 6650                          *
.*                      Added New Zealand Label Format                        *
.*             V5.01.09 22/03/90  E.Phan  Quote 6650                          *
.*                      Did actual formatting of Southland/New Zealand Labels.*
.*                      Note that HOLSIZE is not used in this option.         *
.*             V5.01.10 02/05/90  D.Di.Paola    SRF 104814                    *
.*                      Changed southland labels, line 3 to print clinic type *
.*                      code instead of clinic id...                          *
.*             V5.01.11 19/02/91  Graeme Williams                             *
.*                      Changed the names on some variables to reduce the data*
.*                      area in the IBAOUT66 program.                         *
.*             V5.01.12 13/07/92  DIG                             SRF  115734 *
.*                      Put "*N" at the start of Booking Labels for layout 4 -*
.*                      N.Z. This involved taking out a "*C,*F" at the end.   *
.*                      This was the only format with an "*C,*F" and I have no*
.*                      idea why. This change will therefore require thourough*
.*                      testing to make sure they still work.                 *
.*             V5.01.13 15/07/92  DIG                                         *
.*                      Yep, they don't work. I'm afraid nobody really knows  *
.*                      which labels are stuffing up. I am now told that the  *
.*                      Booking labels are fine and the Appointment and       *
.*                      Mailing Labels are incorrect. So I have now changed   *
.*                      the Booking Labels back again, except for the strange *
.*                      "*C,*F" combination, and modified the others. Will    *
.*                      they work this time? Who knows!!                      *
.*             V5.01.14 29/07/92  DIG                             SRF 116244  *
.*                      Man, this is the last time, hopefully!!!! Somebody    *
.*                      finally told me why the "*C,*F" was there and it is   *
.*                      still needed as Southlands labels are now burged.     *
.*                      The problem with doing this is that this would burg   *
.*                      Whakatane's labels again. Therefore the "*C,*F" will  *
.*                      be added to Mailing + Appointment Labels for Whakatane*
.*                                                                SRF 116263  *
.*        V5.01.15  24/08/1992    Justin Coates  Quote 7401 SRF 116242        *
.*                  Added label type 5 - Whakatane                            *
.*        V5.01.16  16/09/92 J.Tan    SRF 117193                              *
.*                  Fixed opening clinic type file                            *
.*        V5.01.17  21/09/1992    Justin Coates  Quote 7401 SRF 116242        *
.*                  changes to layout 5 - put clinic desc not attending doct. *
.*        V5.01.18  05/11/1992    Justin Coates  (HONG KONG changes)          *
.*                  Added label type 6 - Hong Kong                            *
.*        V5.01.19  07/03/93 J.Tan                                            *
.*                  Added Dudley patient label (labtype = 7)                  *
.*        V5.01.20  18/03/1993    Justin Coates                               *
.*                  Added patient sex to Dudley patient label                 *
.*        V5.01.21  21/10/1993    Gabrielle     Hawkes Bay                    *
.*                  Added Hawkes Bay Label                                    *
.*        V5.01.22  04/11/1993    Gabrielle     Hawkes Bay                    *
.*                  Changed Hawkes Bay Label                                  *
.*        V5.01.23  05/11/1993    Gabrielle     Hawkes Bay                    *
.*                  Fixed Hawkes Bay label                                    *
.*        V5.01.24  09/11/1993    Gabrielle     Hawkes Bay                    *
.*                  Fixed Hawkes Bay label  ....again.....                    *
.*        V5.01.25  16/02/1994  Glenn Berry      Taranaki Mods (3.3.4)        *
.*                  Added Taranaki Outpatient Label                           *
.*        V5.01.26  03/06/1994  Rob Leonard                                   *
.*                  Dont print "Invalid Code" when no Gp in Taranaki Labels   *
.*        V5.01.27  08/07/1994  Rob Leonard   SRF 129741 (QUOTE)              *
.*                  Option for all labels to print age in years,months or week*
.*        V5.01.28  30/11/1994  ROD           SRF 132917                      *
.*                  Always calculate age for Hawkes Bay layout                *
.*        V5.02.01  03/01/1995  Graeme Williams  SRF  134242                  *
.*                  Added CTYPLAB 10 - Greenslope labels                      *
.*        V5.02.02  20/01/1995  whirlpool                                     *
.*                  changed hawkes bay label to print gp from master file     *
.*        V5.02.03  23/01/1995  whirlpool                                     *
.*                  changed hawkes bay label back !!!! no idea                *
.*        V5.02.04  07/03/1995  Paul Howells    SRF134635                     *
.*                  Sent labels line-up print to the label printer!!          *
.*        V5.02.05  31/03/1995  Greg Horvat      Quote 8316                   *
.*                  Remove the doctor from Greenslopes label                  *
.*        V5.03.01  18/12/1995  Greg Horvat      Quote 8591                   *
.*                  Changed Taranakis labels to print the number of medical   *
.*                  warnings for each patient                                 *
.*        V5.03.02  03/01/1996  Greg Horvat      Quote 8591 Rebound           *
.*                  Fixed to read the parameter PTCNDATE in label set up      *
.*                                                                            *
.******************************************************************************
.                 LINE-UP PRINT
.------------------------------------------------------------------------------
.
OUTLINUP  CALL      OSLU0000                 * Set up label for lineup print
          DISPLAY   *P1:24,*EL,*P20:24,*V2LON:
                    " ** Generating Line-Up **";
          MOVE      LABPAGE,NOLABEL
          MOVE      CDEFPRT1,CDEFPRT
          CALL      OUTPRLAB
          RETURN
.
.------------------------------------------------------------------------------
.          START OF PRINTING LABELS
.------------------------------------------------------------------------------
.
OUTPRLAB  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,EIGHTY;*229,PTCNDATE
          MOVE      ZERO,ENDFLG
.
          COMPARE   ONE,STOPQUE
          CALL      OPNPRINT IF NOT EQUAL
.
          MOVE      MAMMFLAG,FORM1  * Use this so only 1 x-ray label produced
.
          COMPARE   SEVEN,LABTYPE
          GOTO      OUTDUD IF EQUAL    * Dudley label
.
          COMPARE   TEN4,LABTYPE
          GOTO      OUTNXTLB IF EQUAL    * St Vincent's has no label size set
.
          COMPARE   TEN5,LABTYPE
          GOTO      OUTNXTLB IF EQUAL    * SJOG Geelong has no label size set
.
          BRANCH    LABSIZE,OUTSMAL,OUTWIDE
.
          KEYIN     *P1:24,*EL,*B:
                    "ERROR : Label size not set. ";
          CALL      HITENTER
          GOTO      ENDOUTLB
.
.          36 Character width
.
OUTSMAL   MOVE      "37",TABPOS2
          MOVE      "73",TABPOS3
          GOTO      OUTNXTLA
.
.          40 Character width
.
OUTWIDE   MOVE      "42",TABPOS2
          MOVE      "83",TABPOS3
          GOTO      OUTNXTLA
.
OUTDUD    MOVE      "32",TABPOS2
          MOVE      "63",TABPOS3
          MOVE      "94",TABPOS4
.
.          Print wrist band labels
.
OUTNXTLA  BRANCH    LABTYPE,OUTNXTLB,OUTNXTLB,OUTNXTLB,OUTNXTLB,OUTNXTLB:
                            OUTNXTLB,OUTNXTLB,OUTNXTLB,OUTNXTLB,OUTNXTLB:
                            OUTNXTLB,OUTNXTLB,OUTNXTLB,OUTNXTLB,OUTNXTLB
.
.          Loop over the number of labels still to print
.
OUTNXTLB  COMPARE   ZERO,NOLABEL
          GOTO      ENDOUTLB IF EQUAL
          GOTO      ENDOUTLB IF LESS
.
          COMPARE   NOLABEL,LABPAGE
          GOTO      OUTCNTLB IF LESS
.
          MOVE      NOLABEL,LABPAGE       *** PRINT REMAINDER
.
.         New Zealand/Southland labels have different separation gaps
.
OUTCNTLB  BRANCH    LABTYPE,OUTL0000,OUTL0000,OUTL0000,OUTL4000,OUTL5000:
                            OUTL6000,OUTL7000,OUTL8000,OUTL8000,OUT10000:
                            OUT11000,OUT12000,OUT13000,OUT14000,OUT15000
.
OUTL0000  BRANCH    LABPAGE,OUTL1000,OUTL2000,OUTL3000
          GOTO      ENDOUTLB
.
.------------------------------------------------------------------------------
.         1 label across page
.------------------------------------------------------------------------------
.
OUTL1000  PRINT     *1,WFLINE1:
                    *N,WFLINE2:
                    *N,WFLINE3:
                    *N,WFLINE4:
                    *N,WFLINE5
.
          BRANCH    LABTYPE,OUTL1100,OUTL1200
.
.         Modbury layout
.
OUTL1100  PRINT     *1
          GOTO      OUTL1300
.
.         St.Andrews Rockhampton layout
.
OUTL1200  PRINT     *1,WFLINE6:
                    *N,WFLINE7:
                    *N,WFLINE8,*N
          GOTO      OUTL1300
.
.         If mammography system, print x-ray labels as well
.
OUTL1300  COMPARE   ONE,FORM1
          GOTO      OUTL1900 IF NOT EQUAL
.
          PRINT     *1,MXRLINE1:
                    *N,MXRLINE2:
                    *N,MXRLINE3:
                    *N,MXRLINE4:
                    *N,MXRLINE5
.
          BRANCH    LABTYPE,OUTL1400,OUTL1500,OUTL1400
.
.         Modbury layout
.
OUTL1400  PRINT     *1
          gOTO      OUTL1900
.
.         St.Andrews Rockhampton layout
.
OUTL1500  PRINT     *1,MXRLINE6:
                    *N,MXRLINE7:
                    *N,MXRLINE8,*N
          GOTO      OUTL1900
.
OUTL1900  SUB       ONE,NOLABEL
          MOVE      ZERO,FORM1                * No more x-ray labels
          GOTO      OUTNXTLB
.
.------------------------------------------------------------------------------
.         2 labels across page
.------------------------------------------------------------------------------
.
OUTL2000  PRINT     *1,WFLINE1,*TABPOS2,WFLINE1:
                    *N,WFLINE2,*TABPOS2,WFLINE2:
                    *N,WFLINE3,*TABPOS2,WFLINE3:
                    *N,WFLINE4,*TABPOS2,WFLINE4:
                    *N,WFLINE5,*TABPOS2,WFLINE5
.
          BRANCH    LABTYPE,OUTL2100,OUTL2200
.
.         Modbury layout
.
OUTL2100  PRINT     *1
          GOTO      OUTL2300
.
.         St.Andrews Rockhampton layout
.
OUTL2200  PRINT     *1,WFLINE6,*TABPOS2,WFLINE6:
                    *N,WFLINE7,*TABPOS2,WFLINE7:
                    *N,WFLINE8,*TABPOS2,WFLINE8,*N
          GOTO      OUTL2300
.
.         If mammography system, print x-ray labels as well
.
OUTL2300  COMPARE   ONE,FORM1
          GOTO      OUTL2900 IF NOT EQUAL
.
          PRINT     *1,MXRLINE1:
                    *N,MXRLINE2:
                    *N,MXRLINE3:
                    *N,MXRLINE4:
                    *N,MXRLINE5
.
          BRANCH    LABTYPE,OUTL2400,OUTL2500
.
.         Modbury layout
.
OUTL2400  PRINT     *1
          GOTO      OUTL2900
.
.         St.Andrews Rockhampton layout
.
OUTL2500  PRINT     *1,MXRLINE6:
                    *N,MXRLINE7:
                    *N,MXRLINE8
          GOTO      OUTL2900
.
OUTL2900  SUB       TWO,NOLABEL
          MOVE      ZERO,FORM1                * No more x-ray labels
          GOTO      OUTNXTLB
.
.------------------------------------------------------------------------------
.         3 labels across page
.------------------------------------------------------------------------------
.
OUTL3000  PRINT     *1,WFLINE1,*TABPOS2,WFLINE1,*TABPOS3,WFLINE1:
                    *N,WFLINE2,*TABPOS2,WFLINE2,*TABPOS3,WFLINE2:
                    *N,WFLINE3,*TABPOS2,WFLINE3,*TABPOS3,WFLINE3:
                    *N,WFLINE4,*TABPOS2,WFLINE4,*TABPOS3,WFLINE4:
                    *N,WFLINE5,*TABPOS2,WFLINE5,*TABPOS3,WFLINE5
.
          BRANCH    LABTYPE,OUTL3100,OUTL3200
.
.         Modbury layout
.
OUTL3100  PRINT     *1
          GOTO      OUTL3300
.
.         St.Andrews Rockhampton layout
.
OUTL3200  PRINT     *1,WFLINE6,*TABPOS2,WFLINE6,*TABPOS3,WFLINE6:
                    *N,WFLINE7,*TABPOS2,WFLINE7,*TABPOS3,WFLINE7:
                    *N,WFLINE8,*TABPOS2,WFLINE8,*TABPOS3,WFLINE8,*N
          GOTO      OUTL3300
.
.         If mammography system, print x-ray labels as well
.
OUTL3300  COMPARE   ONE,FORM1
          GOTO      OUTL3900 IF NOT EQUAL
.
          PRINT     *1,MXRLINE1:
                    *N,MXRLINE2:
                    *N,MXRLINE3:
                    *N,MXRLINE4:
                    *N,MXRLINE5
.
          BRANCH    LABTYPE,OUTL3400,OUTL3500
.
.         Modbury layout
.
OUTL3400  PRINT     *1
          GOTO      OUTL3900
.
.         St.Andrews Rockhampton layout
.
OUTL3500  PRINT     *1,MXRLINE3:
                    *N,MXRLINE4:
                    *N,MXRLINE5
          GOTO      OUTL3900
.
OUTL3900  SUB       THREE,NOLABEL
          MOVE      ZERO,FORM1                * No more x-ray labels
          GOTO      OUTNXTLB
.
.*******************************************************************************
.*        New Zealand/Southland Layout                                         *
.*******************************************************************************
.
OUTL4000  BRANCH    LABPAGE,OUTL4100,OUTL4200,OUTL4300 * No of labels to print
          GOTO      ENDOUTLB
.
. ------- 1 across page -------
.
OUTL4100  PRINT     *1,WLINE1:
                    *N,WLINE2:
                    *N,WLINE3:
                    *N,WLINE4:
                    *N,WLINE5,*C,*F;
          SUB       ONE,NOLABEL
          GOTO      OUTNXTLB
.
. ------- 2 across page -------
.
OUTL4200  PRINT     *1,WLINE1,*35,WLINE1:
                    *N,WLINE2,*35,WLINE2:
                    *N,WLINE3,*35,WLINE3:
                    *N,WLINE4,*35,WLINE4:
                    *N,WLINE5,*35,WLINE5,*C,*F;
          SUB       TWO,NOLABEL
          GOTO      OUTNXTLB
.
. ------- 3 across page -------
.
OUTL4300  PRINT     *1,WLINE1,*35,WLINE1,*69,WLINE1:
                    *N,WLINE2,*35,WLINE2,*69,WLINE2:
                    *N,WLINE3,*35,WLINE3,*69,WLINE3:
                    *N,WLINE4,*35,WLINE4,*69,WLINE4:
                    *N,WLINE5,*35,WLINE5,*69,WLINE5,*C,*F;
          SUB       THREE,NOLABEL
          GOTO      OUTNXTLB
.
.*******************************************************************************
.*        Whakatane Layout                                                     *
.*******************************************************************************
OUTL5000  BRANCH    LABPAGE,OUTL5100,OUTL5200,OUTL5300 * No of labels to print
          GOTO      ENDOUTLB
.
. ------- 1 across page -------
.
OUTL5100  PRINT     *1,WLINE1A:
                    *N,WLINE2A:
                    *N,WLINE3A:
                    *N,WLINE4A:
                    *N,WLINE5A,*C,*F;
          SUB       ONE,NOLABEL
          GOTO      OUTNXTLB
.
. ------- 2 across page -------
.
OUTL5200  PRINT     *1,WLINE1A,*40,WLINE1A:
                    *N,WLINE2A,*40,WLINE2A:
                    *N,WLINE3A,*40,WLINE3A:
                    *N,WLINE4A,*40,WLINE4A:
                    *N,WLINE5A,*40,WLINE5A,*C,*F;
          SUB       TWO,NOLABEL
          GOTO      OUTNXTLB
.
. ------- 3 across page -------
.
OUTL5300  PRINT     *1,WLINE1A,*40,WLINE1A,*79,WLINE1A:
                    *N,WLINE2A,*40,WLINE2A,*79,WLINE2A:
                    *N,WLINE3A,*40,WLINE3A,*79,WLINE3A:
                    *N,WLINE4A,*40,WLINE4A,*79,WLINE4A:
                    *N,WLINE5A,*40,WLINE5A,*79,WLINE5A,*C,*F;
          SUB       THREE,NOLABEL
          GOTO      OUTNXTLB
.
.*******************************************************************************
.         Hong Kong Layout                                                     *
.*******************************************************************************
OUTL6000  BRANCH    LABPAGE,OUTL6100,OUTL6200,OUTL6300
          GOTO      ENDOUTLB
.
OUTL6100  PRINT     *1,*+,WLINE1
          PRINT     *1,*+,WLINE2
          PRINT     *1,*+,WLINE3
          PRINT     *1,*+,WLINE4
          PRINT     *1,*+,WLINE5
          PRINT     *N;
          SUB       ONE,NOLABEL
          GOTO      OUTNXTLB
.
OUTL6200  PRINT     *1,*+,WLINE1,*27,*+,WLINE1
          PRINT     *1,*+,WLINE2,*27,*+,WLINE2
          PRINT     *1,*+,WLINE3,*27,*+,WLINE3
          PRINT     *1,*+,WLINE4,*27,*+,WLINE4
          PRINT     *1,*+,WLINE5,*27,*+,WLINE5
          PRINT     *N;
          SUB       TWO,NOLABEL
          GOTO      OUTNXTLB
.
OUTL6300  PRINT     *1,*+,WLINE1,*27,*+,WLINE1,*53,*+,WLINE1
          PRINT     *1,*+,WLINE2,*27,*+,WLINE2,*53,*+,WLINE2
          PRINT     *1,*+,WLINE3,*27,*+,WLINE3,*53,*+,WLINE3
          PRINT     *1,*+,WLINE4,*27,*+,WLINE4,*53,*+,WLINE4
          PRINT     *1,*+,WLINE5,*27,*+,WLINE5,*53,*+,WLINE5
          PRINT     *N;
          SUB       THREE,NOLABEL
          GOTO      OUTNXTLB
.
.*******************************************************************************
.         Dudley Layout                                                        *
.*******************************************************************************
OUTL7000  BRANCH    LABPAGE,OUTL7100,OUTL7200,OUTL7300
          GOTO      ENDOUTLB
.
OUTL7100  PRINT     *1,WLINE1A,*TABPOS4,WLINE1,*N:
                    *1,WLINE2A,*N:
                    *1,WLINE3A,*TABPOS4,WLINE2,*N:
                    *1,WLINE4A,*N:
                    *1,WLINE5A,*N:
                    *1,WLINE6A,*N:
                    *1,WLINE7A,*N:
                    *1,WLINE8A,*N
          SUB       ONE,NOLABEL
          GOTO      OUTNXTLB
.
OUTL7200  PRINT     *1,WLINE1A,*TABPOS2,WLINE1A,*TABPOS4,WLINE1,*N:
                    *1,WLINE2A,*TABPOS2,WLINE2A,*N:
                    *1,WLINE3A,*TABPOS2,WLINE3A,*TABPOS4,WLINE2,*N:
                    *1,WLINE4A,*TABPOS2,WLINE4A,*N:
                    *1,WLINE5A,*TABPOS2,WLINE5A,*N:
                    *1,WLINE6A,*TABPOS2,WLINE6A,*N:
                    *1,WLINE7A,*TABPOS2,WLINE7A,*N:
                    *1,WLINE8A,*TABPOS2,WLINE8A,*N
.
          SUB       TWO,NOLABEL
          GOTO      OUTNXTLB
.
OUTL7300  PRINT     *1,WLINE1A,*TABPOS2,WLINE1A,*TABPOS3,WLINE1A:
                    *TABPOS4,WLINE1,*N:
                    *1,WLINE2A,*TABPOS2,WLINE2A,*TABPOS3,WLINE2A,*N:
                    *1,WLINE3A,*TABPOS2,WLINE3A,*TABPOS3,WLINE3A:
                    *TABPOS4,WLINE2,*N:
                    *1,WLINE4A,*TABPOS2,WLINE4A,*TABPOS3,WLINE4A,*N:
                    *1,WLINE5A,*TABPOS2,WLINE5A,*TABPOS3,WLINE5A,*N:
                    *1,WLINE6A,*TABPOS2,WLINE6A,*TABPOS3,WLINE6A,*N:
                    *1,WLINE7A,*TABPOS2,WLINE7A,*TABPOS3,WLINE7A,*N:
                    *1,WLINE8A,*TABPOS2,WLINE8A,*TABPOS3,WLINE8A,*N
.
          SUB       THREE,NOLABEL
          GOTO      OUTNXTLB
.
.*******************************************************************************
.         Hawkes Bay and Taranaki                                              *
.*******************************************************************************
OUTL8000  
.
          MOVE      WLINE1A,WLINE1
          MOVE      WLINE2A,WLINE2
          MOVE      WLINE3A,WLINE3
          MOVE      WLINE4A,WLINE4
          MOVE      WLINE5A,WLINE5
.          
          IF        LABSIZE=2
             GOTO  OUTL8050          * Wide Label Format
          ELSE
             GOTO  OUTL8400          * Small Label Format
          ENDIF
.
. ---- Small Label Format ----
OUTL8050  BRANCH    LABPAGE,OUTL8100,OUTL8200,OUTL8300
          GOTO      ENDOUTLB
.
OUTL8100  PRINT     *1,WLINE1A
          PRINT     *1,WLINE2A
          PRINT     *1,WLINE3A
          PRINT     *1,WLINE4A
          PRINT     *1,WLINE5A,*N
          SUB       ONE,NOLABEL
          GOTO      OUTNXTLB
.
OUTL8200  PRINT     *1,WLINE1A,*TABPOS2,WLINE1A
          PRINT     *1,WLINE2A,*TABPOS2,WLINE2A
          PRINT     *1,WLINE3A,*TABPOS2,WLINE3A
          PRINT     *1,WLINE4A,*TABPOS2,WLINE4A
          PRINT     *1,WLINE5A,*TABPOS2,WLINE5A,*N
          SUB       TWO,NOLABEL
          GOTO      OUTNXTLB
.
OUTL8300  PRINT     *1,WLINE1A,*TABPOS2,WLINE1A,*TABPOS3,WLINE1A
          PRINT     *1,WLINE2A,*TABPOS2,WLINE2A,*TABPOS3,WLINE2A
          PRINT     *1,WLINE3A,*TABPOS2,WLINE3A,*TABPOS3,WLINE3A
          PRINT     *1,WLINE4A,*TABPOS2,WLINE4A,*TABPOS3,WLINE4A
          PRINT     *1,WLINE5A,*TABPOS2,WLINE5A,*TABPOS3,WLINE5A,*N
          SUB       THREE,NOLABEL
          GOTO      OUTNXTLB
.
. ----- Wide Label Format ----
OUTL8400  BRANCH    LABPAGE,OUTL8500,OUTL8600,OUTL8700
          GOTO      ENDOUTLB
.
OUTL8500  PRINT     *1,WLINE1
          PRINT     *1,WLINE2
          PRINT     *1,WLINE3
          PRINT     *1,WLINE4
          PRINT     *1,WLINE5,*N
          SUB       ONE,NOLABEL
          GOTO      OUTNXTLB
.
OUTL8600  PRINT     *1,WLINE1,*TABPOS2,WLINE1
          PRINT     *1,WLINE2,*TABPOS2,WLINE2
          PRINT     *1,WLINE3,*TABPOS2,WLINE3
          PRINT     *1,WLINE4,*TABPOS2,WLINE4
          PRINT     *1,WLINE5,*TABPOS2,WLINE5,*N
          SUB       TWO,NOLABEL
          GOTO      OUTNXTLB
.
OUTL8700  PRINT     *1,WLINE1,*TABPOS2,WLINE1,*TABPOS3,WLINE1
          PRINT     *1,WLINE2,*TABPOS2,WLINE2,*TABPOS3,WLINE2
          PRINT     *1,WLINE3,*TABPOS2,WLINE3,*TABPOS3,WLINE3
          PRINT     *1,WLINE4,*TABPOS2,WLINE4,*TABPOS3,WLINE4
          PRINT     *1,WLINE5,*TABPOS2,WLINE5,*TABPOS3,WLINE5,*N
          SUB       THREE,NOLABEL
          GOTO      OUTNXTLB
.
.*******************************************************************************
.
.
.*******************************************************************************
. Greenslopes Labels
.*******************************************************************************
OUT10000  BRANCH    LABPAGE,OUT10100,OUT10200,OUT10300
          GOTO      ENDOUTLB
.
OUT10100  PRINT     *1,WLINE1,*1,WLINE1
          PRINT     *1,WLINE2
          PRINT     *1,WLINE3
          PRINT     *1,WLINE4
          PRINT     *1,WLINE5,*N
          SUB       ONE,NOLABEL
          GOTO      OUTNXTLB
.
OUT10200  PRINT     *1,WLINE1,*TABPOS2,WLINE1:
                    *1,WLINE1,*TABPOS2,WLINE1
          PRINT     *1,WLINE2,*TABPOS2,WLINE2
          PRINT     *1,WLINE3,*TABPOS2,WLINE3
          PRINT     *1,WLINE4,*TABPOS2,WLINE4
          PRINT     *1,WLINE5,*TABPOS2,WLINE5,*N
          SUB       TWO,NOLABEL
          GOTO      OUTNXTLB
.
OUT10300  PRINT     *1,WLINE1,*TABPOS2,WLINE1,*TABPOS3,WLINE1:
                    *1,WLINE1,*TABPOS2,WLINE1,*TABPOS3,WLINE1
          PRINT     *1,WLINE2,*TABPOS2,WLINE2,*TABPOS3,WLINE2
          PRINT     *1,WLINE3,*TABPOS2,WLINE3,*TABPOS3,WLINE3
          PRINT     *1,WLINE4,*TABPOS2,WLINE4,*TABPOS3,WLINE4
          PRINT     *1,WLINE5,*TABPOS2,WLINE5,*TABPOS3,WLINE5,*N
          SUB       THREE,NOLABEL
          GOTO      OUTNXTLB
.
.*******************************************************************************
.*        Joondalup Layout                                                     *
.*******************************************************************************
OUT11000  BRANCH    LABPAGE,OUT11100,OUT11200,OUT11300 * No of labels to print
          GOTO      ENDOUTLB
.
. ----- 1 across page -----
.
OUT11100  PRINT     *1,WLINE1A:
                    *N,WLINE2A:
                    *N,WLINE3A:
                    *N,WLINE4A:
                    *N,WLINE5A:
                    *N,WLINE6A:
                    *N,*N,*N
          SUB       ONE,NOLABEL
          GOTO      OUTNXTLB
.
. ----- 2 across page -----
.
OUT11200  PRINT     *1,WLINE1A,*40,WLINE1A:
                    *N,WLINE2A,*40,WLINE2A:
                    *N,WLINE3A,*40,WLINE3A:
                    *N,WLINE4A,*40,WLINE4A:
                    *N,WLINE5A,*40,WLINE5A:
                    *N,WLINE6A,*40,WLINE6A:
                    *N,*N,*N
          SUB       TWO,NOLABEL
          GOTO      OUTNXTLB
.
. ----- 3 across page -----
.
OUT11300  PRINT     *1,WLINE1A,*40,WLINE1A,*79,WLINE1A:
                    *N,WLINE2A,*40,WLINE2A,*79,WLINE2A:
                    *N,WLINE3A,*40,WLINE3A,*79,WLINE3A:
                    *N,WLINE4A,*40,WLINE4A,*79,WLINE4A:
                    *N,WLINE5A,*40,WLINE5A,*79,WLINE5A:
                    *N,WLINE6A,*40,WLINE6A,*79,WLINE6A:
                    *N,*N,*N
          SUB       THREE,NOLABEL
          GOTO      OUTNXTLB
.
.*******************************************************************************
.*        MBF Layout                                                           *
.*******************************************************************************
OUT12000  BRANCH    LABPAGE,OUT12100,OUT12200,OUT12300 * No of labels to print
          GOTO      ENDOUTLB
.
. ----- 1 across page -----
.
OUT12100  PRINT     *1,WFLINE1:
                    *N,WFLINE2:
                    *N,WFLINE3:
                    *N,WFLINE4:
                    *N,WFLINE5:
                    *N,WFLINE6:
                    *N,*N,*N
          SUB       ONE,NOLABEL
          GOTO      OUTNXTLB
.
. ----- 2 across page -----
.
OUT12200  PRINT     *1,WFLINE1,*TABPOS2,WFLINE1:
                    *N,WFLINE2,*TABPOS2,WFLINE2:
                    *N,WFLINE3,*TABPOS2,WFLINE3:
                    *N,WFLINE4,*TABPOS2,WFLINE4:
                    *N,WFLINE5,*TABPOS2,WFLINE5:
                    *N,WFLINE6,*TABPOS2,WFLINE6:
                    *N,*N,*N
          SUB       TWO,NOLABEL
          GOTO      OUTNXTLB
.
. ----- 3 across page -----
.
OUT12300  PRINT     *1,WFLINE1,*TABPOS2,WFLINE1,*TABPOS3,WFLINE1:
                    *N,WFLINE2,*TABPOS2,WFLINE2,*TABPOS3,WFLINE2:
                    *N,WFLINE3,*TABPOS2,WFLINE3,*TABPOS3,WFLINE3:
                    *N,WFLINE4,*TABPOS2,WFLINE4,*TABPOS3,WFLINE4:
                    *N,WFLINE5,*TABPOS2,WFLINE5,*TABPOS3,WFLINE5:
                    *N,WFLINE6,*TABPOS2,WFLINE6,*TABPOS3,WFLINE6:
                    *N,*N,*N
          SUB       THREE,NOLABEL
          GOTO      OUTNXTLB
.
.******************************************************************************
.*        WGH Consultancies Layout                                            *
.******************************************************************************
OUT13000  BRANCH    LABPAGE,OUT13100,OUT13200,OUT13300
          GOTO      ENDOUTLB
.
OUT13100  PRINT     *1,WFLINE1
          PRINT     *1,WFLINE2
          PRINT     *1,WFLINE3
          PRINT     *1,WFLINE4
          PRINT     *1,WFLINE5
          PRINT     *1,WFLINE6
          PRINT     *N,*N
          SUB       ONE,NOLABEL
          GOTO      OUTNXTLB
.
OUT13200  PRINT     *1,WFLINE1,*TABPOS2,WFLINE1
          PRINT     *1,WFLINE2,*TABPOS2,WFLINE2
          PRINT     *1,WFLINE3,*TABPOS2,WFLINE3
          PRINT     *1,WFLINE4,*TABPOS2,WFLINE4
          PRINT     *1,WFLINE5,*TABPOS2,WFLINE5
          PRINT     *1,WFLINE6,*TABPOS2,WFLINE6
          PRINT     *N,*N
          SUB       TWO,NOLABEL
          GOTO      OUTNXTLB
.
OUT13300  PRINT     *1,WFLINE1,*TABPOS2,WFLINE1,*TABPOS3,WFLINE1
          PRINT     *1,WFLINE2,*TABPOS2,WFLINE2,*TABPOS3,WFLINE2
          PRINT     *1,WFLINE3,*TABPOS2,WFLINE3,*TABPOS3,WFLINE3
          PRINT     *1,WFLINE4,*TABPOS2,WFLINE4,*TABPOS3,WFLINE4
          PRINT     *1,WFLINE5,*TABPOS2,WFLINE5,*TABPOS3,WFLINE5
          PRINT     *1,WFLINE6,*TABPOS2,WFLINE6,*TABPOS3,WFLINE6
          PRINT     *N,*N
          SUB       THREE,NOLABEL
          GOTO      OUTNXTLB
.
.
.****************************************************************************
.*        St Vincent Hospital Labels                                        *
.****************************************************************************
.
OUT14000  BRANCH    ZEBRAFLG,OUT14100,OUT14100,OUT14300
          GOTO      ENDOUTLB
.
OUT14100  PRINT     *1,ZXA:
                    *N,ZBARCOD,WLINEZ16:
                    *N,"^FO170,007^A0,30,25",ZFD,WLINEZ1,ZFS:
                    *N,"^FO001,037^A0,25,25",ZFD,WLINEZ2,ZFS:
                    *N,"^FO236,062^A0,18,18",ZFD,WLINEZ5,ZFS:
                    *N,"^FO250,060^A0,20,18",ZFD,WLINEZ7,ZFS:
                    *N,"^FO001,060^A0,25,25",ZFD,WLINEZ3,ZFS:
                    *N,"^FO220,042^A0,18,18",ZFD,WLINEZ4,ZFS:
                    *N,"^FO001,096^A0,18,18",ZFD,WLINEZ8,ZFS:
                    *N,"^FO220,096^A0,18,18",ZFD,WLINEZ14,ZFS:
                    *N,"^FO001,112^A0,18,18",ZFD,WLINEZ17,ZFS:
                    *N,"^FO001,128^A0,18,18",ZFD,WLINEZ9,ZFS:
                    *N,"^FO180,145^A0,20,18",ZFD,WLINEZ13,ZFS:
                    *N,"^FO001,150^A0,15,18",ZFD,WLINEZ11,ZFS:
                    *N,"^FO170,078^A0,20,18",ZFD,WLINEZ6,ZFS:
                    *N,"^PQ",ZCOPY:
                    *N,ZXZ         
          MOVE      ZERO,NOCOPIES
          GOTO      ENDOUTLB
.
OUT14300  PRINT     *1,ZXA:
                    *N,"^FO001,037^A0,20,20",ZFD,WLINEZ15,ZFS:
                    *N,"^FO001,062^A0,20,20",ZFD,WLINEZ1,ZFS 
.
          IF        PRTOPT1 = 0 & PRTOPT2 = 0
            PRINT     *1,"^FO001,087^A0,20,20",ZFD,WLINEZ3,ZFS:
                      *N,"^FO001,112^A0,20,20",ZFD,WLINEZ5,ZFS
          ENDIF
.
          IF        PRTOPT1 = 1 & PRTOPT2 = 0
            PRINT     *1,"^FO001,087^A0,20,20",ZFD,WLINEZ2,ZFS:
                      *N,"^FO001,112^A0,20,20",ZFD,WLINEZ3,ZFS:
                      *N,"^FO001,137^A0,20,20",ZFD,WLINEZ5,ZFS
          ENDIF
.
          IF        PRTOPT1 = 0 & PRTOPT2 = 1
            PRINT     *1,"^FO001,087^A0,20,20",ZFD,WLINEZ3,ZFS:
                      *N,"^FO001,112^A0,20,20",ZFD,WLINEZ4,ZFS:
                      *N,"^FO001,137^A0,20,20",ZFD,WLINEZ5,ZFS
          ENDIF
.
          IF        PRTOPT1 = 1 & PRTOPT2 = 1
            PRINT     *1,"^FO001,087^A0,20,20",ZFD,WLINEZ2,ZFS:
                      *N,"^FO001,112^A0,20,20",ZFD,WLINEZ3,ZFS:
                      *N,"^FO001,137^A0,20,20",ZFD,WLINEZ4,ZFS:
                      *N,"^FO001,162^A0,20,20",ZFD,WLINEZ5,ZFS
          ENDIF
.
          PRINT     *1,"^PQ",ZCOPY:
                    *N,ZXZ
          MOVE      ZERO,NOCOPIES
          GOTO      ENDOUTLB
+
.****************************************************************************
.*                                  OUT15000                                *
.*                        Label 15 for SJOG Geelong                         *
.****************************************************************************
.
OUT15000  CALL      PRTSJOGL                     * in SJOGLABL.PBL
.
          GOTO      ENDOUTLB
+
.------------------------------------------------------------------------------
.         Finished ...
.------------------------------------------------------------------------------
.
ENDOUTLB  COMPARE   ONE,ENDFLG
          GOTO      ENDO9000 IF EQUAL
.
          COMPARE   ZERO,ADLABEL
          GOTO      ENDO9000 IF EQUAL     * no additional blank labels to print
          MOVE      HADDLABS,NOLABEL
          MOVE      HOLPAGE,LABPAGE
.
          PACK      WFLINE1,SP30,SP10
          PACK      WFLINE2,SP30,SP10
          PACK      WFLINE3,SP30,SP10
          PACK      WFLINE4,SP30,SP10
          PACK      WFLINE5,SP30,SP10
          PACK      WFLINE6,SP30,SP10
          PACK      WFLINE7,SP30,SP10
          PACK      WFLINE8,SP30,SP10
.
          PACK      WLINE1A,SP30,SP10
          PACK      WLINE2A,SP30,SP10
          PACK      WLINE3A,SP30,SP10
          PACK      WLINE4A,SP30,SP10
          PACK      WLINE5A,SP30,SP10
          PACK      WLINE6A,SP30,SP10
          PACK      WLINE7A,SP30,SP10
          PACK      WLINE8A,SP30,SP10
.
          PACK      WLINE1,SP30,SP10
          PACK      WLINE2,SP30,SP10
          PACK      WLINE3,SP30,SP10
          PACK      WLINE4,SP30,SP10
          PACK      WLINE5,SP30,SP10
          PACK      WLINE6,SP30,SP10
          PACK      WLINE7,SP30,SP10
          PACK      WLINE8,SP30,SP10
.
          MOVE      ONE,ENDFLG
          GOTO      OUTNXTLB
.
ENDO9000  COMPARE   ONE,STOPQUE
          CALL      CLSPRINT IF NOT EQUAL
          RETURN
.
.*******************************************************************************
.*        OUTSETLB - Set up variables for Labels                               *
.*******************************************************************************
.
OUTSETLB  CALL      GETDET00        * Read PMI to get details
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,EIGHTY;*229,PTCNDATE
.
          BRANCH    MAMMFLAG,SETMAM10        * Mammography system
          BRANCH    LABTYPE,OSLB1000,OSLB1000,OSLB2000,OSLB3000,OSLB5000:
                            OSLB6000,OSLB7000,OSLB8000,OSLB9000,OSB10000:
                            OSB11000,OSB12000,OSB13000,OSB14000,OSB15000
.
.-------------------------------------------------------------------------------
.         Normal Outpatient labels
.-------------------------------------------------------------------------------
.           First line of label
.
OSLB1000  PACK      WFLINE1,SP30,SP10
          CLEAR     WFLINE1
          APPEND    PSNAME,WFLINE1
          APPEND    SP1,WFLINE1
          APPEND    PTITL,WFLINE1
          APPEND    SP1,WFLINE1
          APPEND    PSEX,WFLINE1
          APPEND    " UR:",WFLINE1
          APPEND    OBAURNO,WFLINE1
          APPEND    DESCASEN,WFLINE1
          RESET     WFLINE1
          MOVE      SP1,DESCASEN
.
.          second line of label
.
GOTMASTU  MOVE      SP20,TDESC
          PACK      KEY5,ANSC,ANSL,OBACOMP
          CALL      RDCODE1
          COMPARE   ZERO,OVRCD
          GOTO      NOTSTNDR IF EQUAL
          MOVE      "STNDRD",TDESC
.
NOTSTNDR  UNPACK    SP8,CCENT,CYEAR,CMON,CDAY
          PACK      WFLINE2,SP30,SP10
          CLEAR     WFLINE2
          CALL      GETGNAM
          APPEND    DIM20,WFLINE2
          MATCH     SP6,PBDATE
          GOTO      DOB10 IF EQUAL
          UNPACK    PBDATE INTO CCENT,CYEAR,CMON,CDAY
DOB10     PACK      WFLINE3,SP1,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR:
                    SP1,TDESC,SP20
          APPEND    WFLINE3,WFLINE2
          RESET     WFLINE2
.
.          third line of label
.
          PACK      WFLINE3,SP30,SP10
          CLEAR     WFLINE3
          APPEND    PADD1,WFLINE3
          CALL      FINENDG3
          APPEND    SP1,WFLINE3
          APPEND    PADD2,WFLINE3
          CALL      FINENDG3
          APPEND    SP2,WFLINE3
          APPEND    PPOST,WFLINE3
          APPEND    SP10,WFLINE3
          RESET     WFLINE3
.
.          Fourth line of label
.
          PACK      WFLINE4,SP30,SP10
          CLEAR     WFLINE4
          APPEND    OCADESC,WFLINE4
          RESET     WFLINE4,29
          APPEND    " Class:HNIP",WFLINE4
          RESET     WFLINE4
.
.          Fifth line of label
.
          PACK      WFLINE5 WITH SP30,SP10
          CLEAR     WFLINE5
          APPEND    "Medi: ",WFLINE5
          APPEND    PMEDI,WFLINE5
          APPEND    SP20,WFLINE5
          RESET     WFLINE5,18
          APPEND    OBACTYP,WFLINE5
          APPEND    SP20,WFLINE5
          RESET     WFLINE5,27
          APPEND    "OPD: ",WFLINE5
          APPEND    OBAOUTNO,WFLINE5
          APPEND    SP10,WFLINE5
          RESET     WFLINE5
.
.          These variables are not used
.
          PACK      WFLINE6,SP30,SP10
          PACK      WFLINE7,SP30,SP10
          PACK      WFLINE8,SP30,SP10
.
          GOTO      OSLB9999                       * Return
.
.-------------------------------------------------------------------------------
.         Wellington Format
.-------------------------------------------------------------------------------
.
OSLB2000  PACK      WFLINE1 WITH SP30,SP10
          CLEAR     WFLINE1
.
          APPEND    PSNAME,WFLINE1            * Patient's Surname
          RESET     WFLINE1,16
.
          APPEND    PTITL,WFLINE1             * Patients Title
.
          UNPACK    SP10,XCENT,XYEAR,XMON,XDAY      * Patient's Birth Date
          UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
          REP       " 0",XDAY
          REP       " 0",XMON
          REP       " 0",XYEAR
          REP       " 0",XCENT
          APPEND    XDAY,WFLINE1
          APPEND    SLASH,WFLINE1
          APPEND    XMON,WFLINE1
          APPEND    SLASH,WFLINE1
          APPEND    XYEAR,WFLINE1
.
          APPEND    SP2,WFLINE1               * Admission Number
          APPEND    PURNO,WFLINE1
          RESET     WFLINE1
.
.          Line Two
.
          PACK      WFLINE2 WITH SP30,SP10
          CLEAR     WFLINE2
.
          APPEND    PGNAME,WFLINE2            * Patients Given Name
          RESET     WFLINE2,22
.
          APPEND    SP1,WFLINE2               * Patients Sex
          APPEND    PSEX,WFLINE2
.
          APPEND    SP1,WFLINE2               * Patient's Age
.
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,WFLINE2
            APPEND    PSAGETYP,WFLINE2
          ELSE
            APPEND    PSAGE,WFLINE2
          ENDIF
.
          APPEND    SP7,WFLINE2
          APPEND    SP3,WFLINE2
          RESET     WFLINE2
.
.          Line Three
.
          PACK      WFLINE3 WITH SP30,SP10
          CLEAR     WFLINE3
.
          APPEND    PADD1,WFLINE3             * Patient's Address
          CALL      FINENDG3
.
          APPEND    SP1,WFLINE3
          APPEND    PADD2,WFLINE3
          CALL      FINENDG3
.
          APPEND    SP1,WFLINE3
          APPEND    PSUBRB,WFLINE3
          CALL      FINENDG3
.
          APPEND    SP1,WFLINE3
          APPEND    PPOST,WFLINE3
.
          RESET     WFLINE3,28
          APPEND    "PH:",WFLINE3
          APPEND    PTELEP,WFLINE3
.
          RESET     WFLINE3
.
.
.          Line Four
.
          PACK      WFLINE4 WITH SP30,SP10
          CLEAR     WFLINE4
.
          APPEND    OBAOUTNO,WFLINE4
.
          PACK      CFNAME,UID,FILCTYA1
          MOVE      UID,CFILEPRE             * Save Current File Prefix
          OPEN      OUTCTYA1,CFNAME
          PACK      KEY12 WITH OBASITE,OBACTYP
          CALL      RDCTYA1
          CLOSE     OUTCTYA1
          BRANCH    OVRCD OF CLINICE
          MOVE      OCTDESC TO DIM25
.
          APPEND    SP1,WFLINE4
          APPEND    DIM25,WFLINE4
.
CLINICE   RESET     WFLINE4,35
          APPEND    "OPD",WFLINE4
          RESET     WFLINE4
.
.-------- Line 5 ------
.
          PACK      WFLINE5 WITH SP30,SP10
          CLEAR     WFLINE5
.
          PACK      KEY20,OBASITE,OBACLIN,OBADATE
          CALL      RDCLIA1
          IF        OVRCD = 1
            CALL      RDPCLIA1
            IF        OVRCD = 0
              MATCH     OBASITE,OCASITE
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ELSE
                MATCH     OBACLIN,OCACLIN
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          IF        OVRCD = 1
            MOVE      "Unknown clinic",OCADESC
            PACK      OCADESC,OCADESC,SP30
            GOTO      CLINICE1
          ENDIF
.
          MATCH     SP6,OCADOCT               * if no doctor get clinic desc
          GOTO      CLINICE1 IF EQUAL
.
          PACK      KEY6,OCADOCT              * check if doctor exists
          CALL      RDDOCT1
          BRANCH    OVRCD,CLINICE1
          CALL      FDOC0000                  * format docs name into OCADESC
.
CLINICE1  PACK      WFLINE5,OCADESC
          RESET     WFLINE5
.
GOTBRD    GOTO      OSLB9999                       * Return
.
.-------------------------------------------------------------------------------
.         Southland/New Zealand Format
.-------------------------------------------------------------------------------
.
. ------- Line 1 -------
.
OSLB3000  PACK      WLINE1,SP20,SP20        * Clear print line
          CLEAR     WLINE1                  * Reset form pointer to 0
          APPEND    SP1,WLINE1              * 1 space to start with
          APPEND    PSNAME,WLINE1           * Surname
          RESET     WLINE1,16               * Reset to position 16
          APPEND    SP1,WLINE1              * Space in between
          APPEND    PTITL,WLINE1            * Title
          APPEND    SP1,WLINE1              * Space in between
          APPEND    "UR:",WLINE1            * Heading desc
          RESET     PURNO,3                 * Set pointer to 1st char of U/R
          APPEND    PURNO,WLINE1            * U/R number
          RESET     WLINE1                  * Reset form pointer to 1
.
. ------- Line 2 -------
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY  * Set up birthdate components
          PACK      WLINE2,SP20,SP20        * Clear print line
          CLEAR     WLINE2                  * Reset form pointer to 0
          APPEND    SP1,WLINE2              * 1 space to start with
          APPEND    PGNAME,WLINE2           * Given Name
          RESET     WLINE2,16               * Reset to position 16
          APPEND    SP1,WLINE2              * Space in between
          APPEND    PSEX,WLINE2             * Sex (1 char)
          APPEND    SP1,WLINE2              * Space in between
          APPEND    CDAY,WLINE2             * Birth day
          APPEND    SLASH,WLINE2            * Date separator
          APPEND    CMON,WLINE2             * Birth month
          APPEND    SLASH,WLINE2            * Date separator
          APPEND    CYEAR,WLINE2            * Birth year
          APPEND    SP1,WLINE2              * Space in between
.
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            PACK      DIM4,PSAGECON,PSAGETYP,SP4
            SQUEEZE   DIM4
            APPEND    DIM4,WLINE2
          ELSE
            APPEND    PSAGE,WLINE2          * Age
          ENDIF
.
          RESET     WLINE2                  * Reset form pointer to 1
.
. ------- Line 3 -------
.
          PACK      WLINE3,SP20,SP20        * Clear print line
          CLEAR     WLINE3                  * Reset form pointer to 0
          APPEND    SP1,WLINE3              * 1 space to start with
          APPEND    "OP:",WLINE3            * Heading desc
          APPEND    OBACTYP,WLINE3          * Clinic Type
          APPEND    SP1,WLINE3              * Space in between
          APPEND    OBAOUTNO,WLINE3         * Event Number
          APPEND    SP1,WLINE3              * Space in between
.
          PACK      KEY20,OBASITE,OBACLIN,OBADATE
          CALL      RDCLIA1
          IF        OVRCD = 1
            CALL      RDPCLIA1
            IF        OVRCD = 0
              MATCH     OBASITE,OCASITE
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ELSE
                MATCH     OBACLIN,OCACLIN
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          BRANCH    OVRCD,OSLB3330           * No record - no desc
.
          MATCH     SP6,OCADOCT              * No doctor code ?
          GOTO      OSLB3320 IF EQUAL        * Yes - use description
          PACK      KEY6,OCADOCT             * Use doctor code to read name
          CALL      RDDOCT1                  * Read doctor file
          BRANCH    OVRCD,OSLB3330           * No record - no desc
          APPEND    DTITL,WLINE3            * Title is 1st part
          ENDSET    WLINE3                  * Set to end of string
OSLB3300  CMATCH    SP1,WLINE3              * Found end of title ?
          GOTO      OSLB3310 IF NOT EQUAL    * Yes - get surname
          BUMP      WLINE3,-1               * Move pointer back 1 char
          GOTO      OSLB3300                 * Test for end of title
OSLB3310  APPEND    SP1,WLINE3              * Space in between title & surname
          APPEND    DSNAME,WLINE3           * Surname
          GOTO      OSLB3330                 * Reset string
OSLB3320  APPEND    OCADESC,WLINE3          * Local Doctor
OSLB3330  RESET     WLINE3,31               * Set pointer to 2nd last char
          APPEND    SP1,WLINE3              * Last char is a blank
          RESET     WLINE3                  * Reset form pointer to 1
.
. ------- Line 4 -------
.
          PACK      WLINE4,SP20,SP20        * Clear print line
          CLEAR     WLINE4                  * Reset form pointer to 0
          APPEND    SP1,WLINE4              * 1 space to start with
          APPEND    PADD1,WLINE4            * 1st line of address
          ENDSET    WLINE4                  * Set pointer to end of line
OSLB3400  CMATCH    SP1,WLINE4              * Is this a space ?
          GOTO      OSLB3410 IF NOT EQUAL    * No - found end of address
          BUMP      WLINE4,-1               * Move pointer back 1 char
          GOTO      OSLB3400                 * Test for end of address
OSLB3410  APPEND    ",",WLINE4              * Comma between both parts of addr
          APPEND    SP1,WLINE4              * Space in between
          APPEND    PADD2,WLINE4            * 2nd line of address
          RESET     WLINE4,31               * Set pointer to 2nd last char
          APPEND    SP1,WLINE4              * Last char is a blank
          RESET     WLINE4                  * Reset form pointer to 1
.
. ------- Line 5 -------
.
          PACK      WLINE5,SP20,SP20        * Clear print line
          CLEAR     WLINE5                  * Reset form pointer to 0
          APPEND    SP1,WLINE5              * 1 space to start with
          APPEND    PSUBRB,WLINE5           * Suburb
          APPEND    SP3,WLINE5              * Spaces in between
          APPEND    "PH:",WLINE5            * Heading desc
          APPEND    PTELEP,WLINE5           * Private Telephone
          RESET     WLINE5,31               * Set pointer to 2nd last char
          APPEND    SP1,WLINE5              * Last char is a blank
          RESET     WLINE5                  * Reset form pointer to 1
.
OSLB3999  GOTO      OSLB9999                 * Finished
.
.-------------------------------------------------------------------------------
.         Whakatane Format
.-------------------------------------------------------------------------------
OSLB5000  PACK      WLINE1A,SP30,SP10
          PACK      WLINE2A,SP30,SP10
          PACK      WLINE3A,SP30,SP10
          PACK      WLINE4A,SP30,SP10
          PACK      WLINE5A,SP30,SP10
.
          CLEAR     WLINE1A                 * line 1
          APPEND    PSNAME,WLINE1A
          RESET     WLINE1A,19
          APPEND    SP1,WLINE1A
          APPEND    PTITL,WLINE1A
          APPEND    SP1,WLINE1A
          APPEND    "UR:",WLINE1A
          UNPACK    OBAURNO,KEY1,KEY7
          APPEND    KEY7,WLINE1A
          RESET     WLINE1A
.
          CLEAR     WLINE2A                 * line 2
          APPEND    PGNAME,WLINE2A
          RESET     WLINE2A,20
          APPEND    SP1,WLINE2A
          MOVE      PSEX,ANS
          APPEND    ANS,WLINE2A
          APPEND    SP1,WLINE2A
.
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            PACK      DIM4,PSAGECON,PSAGETYP,SP4
            SQUEEZE   DIM4
            APPEND    DIM4,WLINE2A
          ELSE
            APPEND    PSAGE,WLINE2A
          ENDIF
.
          APPEND    SP1,WLINE2A
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          APPEND    CPDATE,WLINE2A
          RESET     WLINE2A
.
          CLEAR     WLINE3A                 * line 3
          APPEND    PADD1,WLINE3A
          RESET     WLINE3A
          SETLPTR   WLINE3A,17              * want <= 17 chars
          STRIP     WLINE3A
          ENDSET    WLINE3A
          APPEND    ", ",WLINE3A
          APPEND    PADD2,WLINE3A
          RESET     WLINE3A
.
          CLEAR     WLINE4A                 * line 4
          APPEND    "OP:",WLINE4A
          APPEND    OBACTYP,WLINE4A
          APPEND    SP1,WLINE4A
          APPEND    OBAOUTNO,WLINE4A
          APPEND    SP1,WLINE4A
.
          PACK      KEY20,OBASITE,OBACLIN,OBADATE
          CALL      RDCLIA1
          IF        OVRCD = 1
            CALL      RDPCLIA1
            IF        OVRCD = 0
              MATCH     OBASITE,OCASITE
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ELSE
                MATCH     OBACLIN,OCACLIN
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          IF        OVRCD = 1
            MOVE      "Unknown clinic",OCADESC
            PACK      OCADESC,OCADESC,SP30
          ENDIF
          BRANCH    OVRCD,OSLB5400
.
          MATCH     SP6,OCADOCT
          IF        !@EQUAL
            MOVE      OCADOCT,KEY6
            CALL      RDDOCT1
            IF        OVRCD = ZERO
              MOVE      DTITL,OCADESC
              STRIP     OCADESC
              ENDSET    OCADESC
              APPEND    SP1,OCADESC
              APPEND    DSNAME,OCADESC
              RESET     OCADESC
            ENDIF
          ENDIF
.
OSLB5400  APPEND    OCADESC,WLINE4A
          RESET     WLINE4A
.
          CLEAR     WLINE5A                 * line 5
          APPEND    "PH:",WLINE5A
          APPEND    PTELEP,WLINE5A
          APPEND    SP1,WLINE5A
          APPEND    PLOCDOC,WLINE5A
          RESET     WLINE5A
          GOTO      OSLB9999                * Finished
.
.------------------------------------------------------------------------------
.         Hong Kong Format - will print only 25 characters of label
.------------------------------------------------------------------------------
OSLB6000  SETLPTR   WLINE1
          SETLPTR   WLINE2
          SETLPTR   WLINE3
          SETLPTR   WLINE4
          SETLPTR   WLINE5
          PACK      WLINE1,SP20,SP20
          PACK      WLINE2,SP20,SP20
          PACK      WLINE3,SP20,SP20
          PACK      WLINE4,SP20,SP20
          PACK      WLINE5,SP20,SP20
.
          PROC      OTLBHK00                * set up WLINE1
.
          MOVE      PSNAME,PACSNAME
          MOVE      PGNAME,PACGNAME
          MOVE      SP4,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME                 * want Surname, Given names
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
...       MOVE      DSEXDESC,KEY8
.* ******************************************   End of Changes         *C-49016
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          MOVE      PACFNAME,WLINE2
.....     PACK      WLINE3,KEY7,SP6,CPCDATE,SP30                        D-49016
          PACK      WLINE3,DSEXDESC,SP5,CPCDATE,SP30                   *I-49016
          PACK      WLINE4,PURNO,SP30
.
          SETLPTR   WLINE1,25
          SETLPTR   WLINE2,25
          SETLPTR   WLINE3,25
          SETLPTR   WLINE4,25
          SETLPTR   WLINE5,25
          GOTO      OSLB9999
+
.------------------------------------------------------------------------------
.         Dudley Format 
.------------------------------------------------------------------------------
.
.-------  Set up Line 1 -------------------------------------
.
OSLB7000  PACK      WLINE1A,SP20,SP20
          CLEAR     WLINE1A
          APPEND    PSNAME,WLINE1A
          RESET     WLINE1A,20
          APPEND    SP1,WLINE1A
          APPEND    PURNO,WLINE1A
          RESET     WLINE1A
.
.-------  Set up Line 2 -------------------------------------
.
          PACK      WLINE2A,SP20,SP20
.
.-------  Set up Line 3 -------------------------------------
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      PSEX,ANS
          PACK      WLINE3A,SP20,SP20
          CLEAR     WLINE3A
          APPEND    PGNAME,WLINE3A
          RESET     WLINE3A,18               
          APPEND    SP1,WLINE3A
          APPEND    ANS,WLINE3A
          APPEND    SP1,WLINE3A
          APPEND    CPDATE,WLINE3A
          RESET     WLINE3A
.
.-------  Set up Line 4 -------------------------------------
.
          PACK      WLINE4A,SP20,SP20
.
.-------  Set up Line 5 -------------------------------------
.
          PACK      WLINE5A,SP20,SP20  
          CLEAR     WLINE5A
          APPEND    PADD1,WLINE5A
          RESET     WLINE5A,29
          APPEND    SP20,WLINE5A
          RESET     WLINE5A
.
.-------  Set up Line 6 -------------------------------------
.
          PACK      WLINE6A,SP20,SP20
          CLEAR     WLINE6A
          APPEND    PADD2,WLINE6A
          RESET     WLINE6A,29
          APPEND    SP20,WLINE6A
          RESET     WLINE6A
.
.-------  Set up Line 7 -------------------------------------
.
          PACK      WLINE7A,SP20,SP20
          CLEAR     WLINE7A
          APPEND    PSUBRB,WLINE7A
          RESET     WLINE7A,29
          APPEND    SP20,WLINE7A
          RESET     WLINE7A
.
.-------  Set up Line 8 -------------------------------------
.
          PACK      WLINE8A,SP20,SP20
          CLEAR     WLINE8A
          APPEND    PADD4,WLINE8A
          RESET     WLINE8A,20
          APPEND    SP1,WLINE8A
          APPEND    PPOST,WLINE8A
          RESET     WLINE8A
.
.-------  Set up Last label Line 1 -------------------------------------
.
          UNPACK    PGNAME,ANS
          PACK      WLINE1,SP20,SP20
          CLEAR     WLINE1
          APPEND    PSNAME,WLINE1
          RESET     WLINE1,12
          APPEND    SP1,WLINE1
          APPEND    ANS,WLINE1
          APPEND    SP1,WLINE1
.
          RESET     WLINE1,15
          APPEND    PSNAME,WLINE1
          RESET     WLINE1,27
          APPEND    SP1,WLINE1
          APPEND    ANS,WLINE1
          RESET     WLINE1
.
.-------  Set up Last label Line 2 -------------------------------------
.
          PACK      WLINE2,SP20,SP20
          CLEAR     WLINE2
          APPEND    PURNO,WLINE2
          RESET     WLINE2,8
          APPEND    SP1,WLINE2
          APPEND    PSEX,WLINE2
          APPEND    SP1,WLINE2
.
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,WLINE2
            APPEND    PSAGETYP,WLINE2
          ELSE
            APPEND    PSAGE,WLINE2
          ENDIF
.
          RESET     WLINE2,15
          APPEND    PURNO,WLINE2
          RESET     WLINE2,23
          APPEND    SP1,WLINE2
          APPEND    PSEX,WLINE2
          APPEND    SP1,WLINE2
.
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,WLINE2
            APPEND    PSAGETYP,WLINE2
          ELSE
            APPEND    PSAGE,WLINE2
          ENDIF
. 
          RESET     WLINE2
.
          RETURN
+
.------------------------------------------------------------------------------
.         Hawkes Bay Format 
.------------------------------------------------------------------------------
OSLB8000  PACK      WLINE1A,SP30,SP10         * Ensure Lines are clear
          PACK      WLINE2A,SP30,SP10
          PACK      WLINE3A,SP30,SP10
          PACK      WLINE4A,SP30,SP10
          PACK      WLINE5A,SP30,SP10
.
.         Line 1
          PACK      DIM20,PSNAME             * Surname
          PACK      WLINE1A,DIM20
.
          RESET     WLINE1A,22                * Title
          APPEND    PTITL,WLINE1A
.
          RESET     WLINE1A,30                * UR No
          APPEND    OBAURNO,WLINE1A
          RESET     WLINE1A
.
.         Line 2
          PACK      DIM15,PGNAME             * Given Name
          PACK      WLINE2A,DIM15
.
          RESET     WLINE2A,16                * Sex
          APPEND    PSEX,WLINE2A
.
          CALL      IBACLOCK
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE
.
          RESET     WLINE2A,19                * Age
          IF        PTCNDATE=1
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,WLINE2A
            APPEND    PSAGETYP,WLINE2A
          ELSE
            APPEND    PSAGEYRS,WLINE2A
            APPEND    ANSY,WLINE2A
          ENDIF
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY  * Date of Birth
          PACK      DIM8,CDAY,SLASH,CMON,SLASH,CYEAR
          REP       " 0",DIM8
          RESET     WLINE2A,30
          APPEND    DIM8,WLINE2A
          RESET     WLINE2A
.
.         Line 3
          PACK      WFLINE3,SP30,SP10        * Address Line 1
          CLEAR     WFLINE3
          APPEND    PADD1,WFLINE3
.
          CALL      FINENDG3
          MOVE      ",",DIM1
          APPEND    DIM1,WFLINE3
          APPEND    SP1,WFLINE3
          APPEND    PADD2,WFLINE3            * Address Line 2
          RESET     WFLINE3
          PACK      WLINE3A,WFLINE3
          RESET     WLINE3A
.
.         Line 4
.
          PACK      KEY6,OCADOCT             * Attending Doctor
          CALL      RDDOCT1
          IF        OVRCD = ZERO
            MOVE      DGNAME,ANS 
            MOVE      ANS,WLINE4A 
            APPEND    SP1,WLINE4A 
            APPEND    DSNAME,WLINE4A 
          ELSE
            MOVE      OCADESC,DIM17
            MOVE      DIM17,WLINE4A
          ENDIF
.
          RESET     WLINE4A,18                * Private Telephone
          APPEND    PTELEP,WLINE4A
.
          RESET     WLINE4A,32                * Ward
          APPEND    OBASITE,WLINE4A
          RESET     WLINE4A
.
.         Line 5  
.
          
          MOVE      "GP:",WLINE5A             * Referring GP
          RESET     WLINE5A,4
.
          MOVE      PLOCDOC,DIM14 
          APPEND    DIM14,WLINE5A
.
          MOVE      SP20,HOSDESC
          RESET     WLINE5A,18                * Hospital Name
          PACK      KEY2,CHOSINDX
          CALL      RDHOSP2
          APPEND    SP1,WLINE5A
          APPEND    HOSDESC,WLINE5A
          RESET     WLINE5A
          RETURN
+
.------------------------------------------------------------------------------
. Taranaki set up
.------------------------------------------------------------------------------
OSLB9000  PACK      WLINE1A,SP30,SP10         * Ensure Lines are clear
          PACK      WLINE2A,SP30,SP10
          PACK      WLINE3A,SP30,SP10
          PACK      WLINE4A,SP30,SP10
          PACK      WLINE5A,SP30,SP10
.
.-----    Line 1    "XXXXXXXXXXXXXXXXXXXX 99/99/99 99999999"
          PACK      DIM20,PSNAME             * Surname
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY  * Date of Birth
          PACK      DIM8,CDAY,SLASH,CMON,SLASH,CYEAR
          REP       " 0",DIM8
.
          PACK      WLINE1A,PSNAME,SP1,DIM8,SP1,OBAURNO
.
.-----    Line 2    "XXXXXXXXXXXXXXXXXXXX X     XXX  MWS:99"
          PACK      DIM20,PGNAME             * Given Name
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            PACK      WLINE2A,DIM20,SP1,PSEX,SP5,PSAGECON,PSAGETYP,SP20
          ELSE
            PACK      WLINE2A,DIM20,SP1,PSEX,SP5,PSAGE,SP20
          ENDIF
          MOVE      ZERO,FORM2
          OPEN      PATMWSA1,"patmwsaf"
          PACK      KEY14,PURNO,SP20
          CALL      RSPTMWS1                * Position on & read the medical
OSLB9100  CALL      RKPTMWS1                  warnings file
          BRANCH    OVRCD,OSLB9200
.
          MATCH     PURNO,PTMWURNO
          GOTO      OSLB9200 IF NOT EQUAL   * Different U/R number
.
          ADD       ONE,FORM2               * Patient warning
          GOTO      OSLB9100
.
OSLB9200  CLOSE     PATMWSA1
          IF        FORM2<>0
            RESET     WLINE2A,32
            APPEND    "MWS:",WLINE2A
            APPEND    FORM2,WLINE2A
            APPEND    SP30,WLINE2A
            RESET     WLINE2A
          ENDIF
.
.-----    Line 3    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
          PACK      WFLINE3,SP30,SP10        * Address Line 1
          CLEAR     WFLINE3
          APPEND    PADD1,WFLINE3
.
          CALL      FINENDG3
          MOVE      ",",DIM1
          APPEND    DIM1,WFLINE3
          APPEND    SP1,WFLINE3
          APPEND    PADD2,WFLINE3            * Address Line 2
          RESET     WFLINE3
          PACK      WLINE3A,WFLINE3
          RESET     WLINE3A
.
.-----    Line 4    "PH:XXXXXXXXXX GP:XXXXXXXXXXXXXXXXXXXX"
.
          MOVE      "PH:",KEY3
          MOVE      "GP:",DIM3
.
          PACK      KEY10,OTBBRFGP,SP10
          MATCH     SP10,KEY10                * no GP?
          IF        @EQUAL
            PACK      KEY10,PMPXRHC1,SP10
          ENDIF
.
          MOVE      SP20,KEY20
          MATCH     SP10,KEY10 
          GOTO      OSLB9300 IF EQUAL
.
          CALL      RDPMHCP1
          IF        OVRCD=1
            MOVE      "Invalid Code:",KEY13
            PACK      KEY20,KEY13,KEY10,SP20
          ELSE
            CALL    GPINI000                * Get GP Initials
            PACK    KEY20,DIM1,SP1,KEY1,SP1,PMHCSNAM
          ENDIF
.
OSLB9300  MOVE      PTELEP,KEY10
          PACK      WLINE4A,KEY3,SP1,KEY10,SP1,DIM3,KEY20,SP20
.
.         Line 5    "XXXXXXXXXX XXXXXX XXX 99/99/99 99:99 XXX"
.
          MATCH     OBADOCT,SP6
          IF        @EQUAL
            PACK      KEY20,OBASITE,OBACLIN,OBADATE
            CALL      RDCLIA1
            IF        OVRCD = 1
              CALL      RDPCLIA1
              IF        OVRCD = 0
                MATCH     OBASITE,OCASITE
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ELSE
                  MATCH     OBACLIN,OCACLIN
                  IF        !@EQUAL
                    MOVE      ONE,OVRCD
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
            IF        OVRCD = 1
              MOVE      "Unknown clinic",OCADESC
              PACK      OCADESC,OCADESC,SP30
            ENDIF
            MOVE      OCADESC,KEY10
          ELSE
            PACK      KEY6,OCADOCT             * Attending Doctor
            CALL      RDDOCT1
            IF        OVRCD = ZERO
              MOVE      DGNAME,ANS 
              PACK      KEY10,ANS,SP1,DSNAME,SP20
            ELSE
              MOVE      OCADESC,KEY10
            ENDIF
          ENDIF
.
........  RESET     WLINE5A,18                
........  PACK      KEY2,CHOSINDX
........  MOVE      SP4,HOSCODE
........  CALL      RDHOSP2
.
          CALL      GHSCM000                  * Get Hospital from Clinic Master
.
          UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          PACK      WLINE5A,KEY10,SP1,OBACLIN,SP1,CPDATE,SP1,OBASTRT,SP1:
                            OTMAHOSP,SP1
          RETURN
+
.------------------------------------------------------------------------------
. Greenslopes set up
.------------------------------------------------------------------------------
OSB10000  PACK      WLINE1,SP30,SP10         * Ensure Lines are clear
          PACK      WLINE2,SP30,SP10
          PACK      WLINE3,SP30,SP10
          PACK      WLINE4,SP30,SP10
          PACK      WLINE5,SP30,SP10
.
          CLEAR     WLINE1
          APPEND    PSNAME,WLINE1
          RESET     WLINE1
          STRIP     WLINE1
          ENDSET    WLINE1
          APPEND    SP1,WLINE1
          APPEND    PTITL,WLINE1
          RESET     WLINE1
          STRIP     WLINE1
          ENDSET    WLINE1
          APPEND    SP1,WLINE1
          APPEND    PGNAME,WLINE1
          RESET     WLINE1
.
          CLEAR     WLINE2
          MOVE      PADD1,DIM25
          APPEND    DIM25,WLINE2
          APPEND    SP5,WLINE2
          APPEND    PSEX,WLINE2
          RESET     WLINE2
.
          CLEAR     WLINE3
          APPEND    PADD2,WLINE3
          RESET     WLINE3
          STRIP     WLINE3
          ENDSET    WLINE3
          APPEND    SP1,WLINE3
          APPEND    PPOST,WLINE3
.
          RESET     WLINE3,24
          UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
          APPEND    XDAY,WLINE3
          APPEND    "/",WLINE3
          APPEND    XMON,WLINE3
          APPEND    "/",WLINE3
          APPEND    XYEAR,WLINE3
          RESET     WLINE3
.
          CLEAR     WLINE5
          OPEN      PATNIDA1,"patnidaf"
          PACK      KEY10,CHOSINDX,PURNO
          CALL      RDPTNID1
          IF        OVRCD = 0
            SQUEEZE   PTNINMPI
            APPEND    PTNINMPI,WLINE5
          ELSE
            APPEND    SP20,WLINE5
          ENDIF
          CLOSE     PATNIDA1
          RESET     WLINE5,12
          APPEND    "UR:",WLINE5
          MOVE      PURNO,KEY8
          UNPACK    KEY8,ANS,KEY7
          APPEND    KEY7,WLINE5
          APPEND    SP8,WLINE5
.
          RESET     WLINE5,23
          APPEND    "OP:",WLINE5
          MOVE      OBAOUTNO,KEY8
          UNPACK    KEY8,ANS,KEY7
          APPEND    KEY7,WLINE5
          APPEND    SP30,WLINE5
          RESET     WLINE5
          RETURN
.
.******************************************************************************
.*        Joondalup Format                                                    *
.******************************************************************************
OSB11000
.
. ----- Line 1 -----
.
          PACK      WLINE1A,SP30,SP10
          CLEAR     WLINE1A
          APPEND    PSNAME,WLINE1A          * Patient surname
          RESET     WLINE1A,19
          APPEND    SP1,WLINE1A
          APPEND    PTITL,WLINE1A           * Patient title
          APPEND    SP1,WLINE1A
          APPEND    "UR:",WLINE1A
          UNPACK    OBAURNO,KEY1,KEY7
          APPEND    KEY7,WLINE1A            * Outpatient U/R number
          RESET     WLINE1A
.
. ----- Line 2 -----
.
          PACK      WLINE2A,SP30,SP10
          CLEAR     WLINE2A
          APPEND    PGNAME,WLINE2A          * Patient given name
          RESET     WLINE2A,20
          APPEND    SP1,WLINE2A
          MOVE      PSEX,ANS                * Patient sex
          APPEND    ANS,WLINE2A
          APPEND    SP1,WLINE2A
.
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            PACK      DIM4,PSAGECON,PSAGETYP,SP4
            SQUEEZE   DIM4
            APPEND    DIM4,WLINE2A          * Patient age
          ELSE
            APPEND    PSAGE,WLINE2A         * Patient age
          ENDIF
.
          APPEND    SP1,WLINE2A
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          APPEND    CPDATE,WLINE2A          * Patient DOB
          RESET     WLINE2A
.
. ----- Line 3 -----
.
          PACK      WLINE3A,SP30,SP10
          CLEAR     WLINE3A
          APPEND    PADD1,WLINE3A           * Address line 1
          RESET     WLINE3A
          SETLPTR   WLINE3A,17
          STRIP     WLINE3A
          ENDSET    WLINE3A
          APPEND    ", ",WLINE3A
          APPEND    PADD2,WLINE3A           * Address line 2
          RESET     WLINE3A
.
. ----- Line 4 -----
.
          PACK      WLINE4A,SP30,SP10
          CLEAR     WLINE4A
          APPEND    "OP:",WLINE4A
          APPEND    OBACTYP,WLINE4A         * Clinic type
          APPEND    SP1,WLINE4A
          APPEND    OBAOUTNO,WLINE4A        * Outpatient number
          APPEND    SP1,WLINE4A
.
          PACK      KEY20,OBASITE,OBACLIN,OBADATE
          CALL      RDCLIA1
          IF        OVRCD = 1
            CALL      RDPCLIA1
            IF        OVRCD = 0
              MATCH     OBASITE,OCASITE
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ELSE
                MATCH     OBACLIN,OCACLIN
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          IF        OVRCD = 1
            MOVE      "Unknown clinic",OCADESC
            PACK      OCADESC,OCADESC,SP30
          ELSE
            MATCH     SP6,OCADOCT
            IF        !@EQUAL
              MOVE      OCADOCT,KEY6
              CALL      RDDOCT1             * Read doctors file
              IF        OVRCD = ZERO
                MOVE      DTITL,OCADESC
                STRIP     OCADESC
                ENDSET    OCADESC
                APPEND    SP1,OCADESC
                APPEND    DSNAME,OCADESC
                RESET     OCADESC
              ENDIF
            ENDIF
          ENDIF
.
          APPEND    OCADESC,WLINE4A         * Doctors name
          RESET     WLINE4A
.
. ----- Line 5 -----
.
          PACK      WLINE5A,SP30,SP10
          CLEAR     WLINE5A
          APPEND    "PH:",WLINE5A           * Patient home telephone number
          APPEND    PTELEP,WLINE5A
          APPEND    SP1,WLINE5A
          APPEND    PLOCDOC,WLINE5A         * Local doctor
          RESET     WLINE5A
.
. ----- Line 6 -----
.
          PACK      WLINE6A,SP30,SP10
          CLEAR     WLINE6A
          MATCH     SP3,OBACOMP
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,OBACOMP
            CALL      RDCODE1               * Read the codes file
            IF        OVRCD<>1
              APPEND    TDESC,WLINE6A       * Claim code description
            ENDIF
          ENDIF
          APPEND    SP30,WLINE6A
          APPEND    SP10,WLINE6A
          RESET     WLINE6A
.
          PACK      WLINE7A,SP30,SP10
          PACK      WLINE8A,SP30,SP10
          RETURN
.
.******************************************************************************
.*        MBF Format                                                          *
.******************************************************************************
OSB12000  PACK      CFNAME,UID,FILXSCA1
          MOVE      UID,CFILEPRE             * Save Current File Prefix
          OPEN      OUTXSCA1,CFNAME
.
. ----- Line 1 -----
.
          PACK      WFLINE1,SP30,SP10
          CLEAR     WFLINE1
          APPEND    CNAME,WFLINE1           * Company name
          APPEND    SP30,WFLINE1
          RESET     WFLINE1
.
. ----- Line 2 -----
.
          PACK      WFLINE2,SP30,SP10
          CLEAR     WFLINE2
          APPEND    SP10,WFLINE2
          APPEND    SP30,WFLINE2
          RESET     WFLINE2
.
. ----- Line 3 -----
.
          PACK      WFLINE3,SP30,SP10
          CLEAR     WFLINE3
          APPEND    PTITL,WFLINE3           * Patient title
          APPEND    SP1,WFLINE3
          STRIP     PSNAME
          APPEND    PSNAME,WFLINE3          * Patient surname
          APPEND    ", ",WFLINE3
          APPEND    PGNAME,WFLINE3          * Patient given name
          RESET     WFLINE3,26
          APPEND    " Age:",WFLINE3
.
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            PACK      DIM4,PSAGECON,PSAGETYP,SP4
            SQUEEZE   DIM4
            APPEND    DIM4,WFLINE3          * Patient age
          ELSE
            APPEND    PSAGE,WFLINE3         * Patient age
          ENDIF
.
          APPEND    SP30,WFLINE3
          RESET     WFLINE3
.
. ----- Line 4 -----
.
          PACK      WFLINE4,SP30,SP10
          CLEAR     WFLINE4
          APPEND    "Date: ",WFLINE4
          UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format the clinic date
          REP       " 0",CPCDATE
          APPEND    CPCDATE,WFLINE4         * Clinic date
          RESET     WFLINE4,16
          APPEND    " U/R No.:",WFLINE4
          APPEND    OBAURNO,WFLINE4         * U/R number
          APPEND    DESCASEN,WFLINE4        * Case notes indicator
          APPEND    SP30,WFLINE4
          RESET     WFLINE4
.
. ----- Line 5 -----
.
          PACK      WFLINE5,SP30,SP10
          CLEAR     WFLINE5
          APPEND    "Ref.Doctor: ",WFLINE5
          PACK      KEY8,OBAOUTNO
          CALL      RDOTXSC1                * Read the xtra screen details file
          IF        OVRCD<>1
            MATCH     SP6,OTXSDOC1
            IF        !@EQUAL
              PACK      KEY6,OTXSDOC1
              CALL      RDDOCT1             * Read the doctors file
              IF        OVRCD<>1
                APPEND    OTXSDOC1,WFLINE5  * Referral doctor code
                APPEND    SP1,WFLINE5
                STRIP     DTITL
                APPEND    DTITL,WFLINE5     * Referral doctor title
                APPEND    ". ",WFLINE5
                MOVE      DGNAME,DIM1
                APPEND    DIM1,WFLINE5      * Referral doctor initial
                APPEND    ". ",WFLINE5
                APPEND    DSNAME,WFLINE5    * Referral doctor surname
              ENDIF
            ENDIF
          ENDIF
          APPEND    SP30,WFLINE5
          APPEND    SP10,WFLINE5
          RESET     WFLINE5
.
. ----- Line 6 -----
.
          PACK      WFLINE6,SP30,SP10
          CLEAR     WFLINE6
          APPEND    "Ref. Date : ",WFLINE6
          PACK      KEY8,OBAOUTNO
          CALL      RDOTXSC1                * Read the xtra screen details file
          IF        OVRCD<>1
            MATCH     SP8,OTXSDTE1
            IF        !@EQUAL
              UNPACK    OTXSDTE1,CCENT,CYEAR,CMON,CDAY
              CALL      PACDATE             * Format the referral date
              REP       " 0",CPCDATE
              APPEND    CPCDATE,WFLINE6     * Referral date
            ENDIF
          ENDIF
          APPEND    SP30,WFLINE6
          APPEND    SP10,WFLINE6
          RESET     WFLINE6
          RETURN
+
.******************************************************************************
.*                                 OSB13000                                   *
.*                      Label 13 for WGH Consultancies                        *
.******************************************************************************
.
. ----- Line 1 ----- "XXXXXXXXXXXXXXXXXX XXXX X Id:XXXXXXXX" 37chars
.
OSB13000  PACK      WFLINE1,SP30,SP30
          CLEAR     WFLINE1
          APPEND    PSNAME,WFLINE1          * Surname
          RESET     WFLINE1,18
          APPEND    SP1,WFLINE1
          APPEND    PTITL,WFLINE1           * Title
          APPEND    SP1,WFLINE1
          MOVE      PSEX,ANS
          APPEND    ANS,WFLINE1             * Sex - M/F
          APPEND    " Id:",WFLINE1
          APPEND    PURNO,WFLINE1           * U/R number
          APPEND    SP30,WFLINE1
          RESET     WFLINE1
.
. ----- Line 2 ----- "XXXXXXXXXXXXXXXXXXXXXXX XX.XX.XX XXXX" 37chars
.
          PACK      WFLINE2,SP30,SP30
          CLEAR     WFLINE2
          APPEND    PGNAME,WFLINE2          * Given name
          RESET     WFLINE2,23
          APPEND    SP1,WFLINE2
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          APPEND    CDAY,WFLINE2            * DOB - day
          APPEND    DOT,WFLINE2
          APPEND    CMON,WFLINE2            * DOB - month
          APPEND    DOT,WFLINE2
          APPEND    CYEAR,WFLINE2           * DOB - year
          APPEND    SP1,WFLINE2
          IF        PTCNDATE=1
            CALL      IBACLOCK              * Get the current date
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE               * Calculate the current age
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,WFLINE2
            APPEND    PSAGETYP,WFLINE2      * Age
          ELSE
            APPEND    PSAGE,WFLINE2         * Age
          ENDIF
          APPEND    SP30,WFLINE2
          RESET     WFLINE2
.
. ----- Line 3 ----- "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" 37chars
.
          PACK      WFLINE3,SP30,SP30
          CLEAR     WFLINE3
          STRIP     PADD1
          APPEND    PADD1,WFLINE3           * Address line 1
          APPEND    SP1,WFLINE3
          APPEND    PADD2,WFLINE3           * Address line 2
          RESET     WFLINE3,34
          APPEND    PPOST,WFLINE3
          APPEND    SP30,WFLINE3
          RESET     WFLINE3
.
. ----- Line 4 ----- "PH:XXXXXXXXXXXXX BH PH:XXXXXXXXXXXXXX" 37chars
.
          PACK      WFLINE4,SP30,SP30
          CLEAR     WFLINE4
          APPEND    "PH:",WFLINE4
          APPEND    PTELEP,WFLINE4          * Private telephone no
          RESET     WFLINE4,16
          APPEND    " BH PH:",WFLINE4
          APPEND    PTELEB,WFLINE4          * Business telephone no
          APPEND    SP30,WFLINE4
          RESET     WFLINE4
.
. ----- Line 5 ----- "XXXXXXXXXXXXXXXXXXXXXXXXXX XXXXXXXXXX" 37chars
.
          PACK      WFLINE5,SP30,SP30
          CLEAR     WFLINE5
          PACK      KEY10,OTBBRFGP,SP70
          CALL      RDPMHCP1                * Read a national GP file record
          IF        OVRCD<>1
            STRIP     PMHCGNAM
            APPEND    PMHCGNAM,WFLINE5      * National GP doctor title/given
            APPEND    ". ",WFLINE5
            APPEND    PMHCSNAM,WFLINE5      * National GP doctor surname
          ENDIF
          RESET     WFLINE5,26
          APPEND    SP1,WFLINE5
          APPEND    PMEDI,WFLINE5           * Medicare no
          APPEND    SP30,WFLINE5
          RESET     WFLINE5
.
. ----- Line 6 ----- "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" 37chars
.
          PACK      WFLINE6,SP30,SP30
          CLEAR     WFLINE6
          PACK      KEY10,OTBBRFGP,SP70
          CALL      RDPMHCP1                * Read a national GP file record
          IF        OVRCD<>1
            STRIP     PMHCADR1
            APPEND    PMHCADR1,WFLINE6      * National GP doctor address line 1
            APPEND    SP1,WFLINE6
            STRIP     PMHCADR2
            APPEND    PMHCADR2,WFLINE6      * National GP doctor address line 2
          ENDIF
          APPEND    SP30,WFLINE6
          APPEND    SP30,WFLINE6
          RESET     WFLINE6
          RETURN
.******************************************************************************
.*                                 OSB14000                                   *
.*                       Label 14 for St Vincent's Hospital                   *
.******************************************************************************
.
OSB14000  BRANCH    ZEBRAFLG,OSB14100,OSB14100,OSB14300
          RETURN
.
OSB14100  PACK      WLINEZ1,SP20,SP20
          PACK      WLINEZ2,SP20,SP20
          PACK      WLINEZ3,SP20,SP20
          PACK      WLINEZ4,SP20,SP20
.
          MOVE      OBAURNO,WLINEZ1
          RESET     WLINEZ1,8
.
          MOVE      PSNAME,WLINEZ2
          RESET     WLINEZ2,16
.
          MOVE      PGNAME,WLINEZ3
          RESET     WLINEZ3,20
.
          MOVE      PTITL,WLINEZ4
          RESET     WLINEZ4,4
.
          MOVE      PSEX,WLINEZ5
          RESET     WLINEZ5,6
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      WLINEZ6,SP20,SP20
          MOVE      "DoB:",WLINEZ6
          ENDSET    WLINEZ6
          APPEND    CPCDATE,WLINEZ6
          RESET     WLINEZ6,14
.
          PACK      WLINEZ7,SP20,SP20
          MOVE      "yr",DIM2
          CALL      IBACLOCK
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE
          PACK      WLINEZ7,PSAGEYRS,DIM2
          RESET     WLINEZ7,5
.
          PACK      WLINEZ8,SP20,SP20
          MOVE      PADD1,WLINEZ8
          RESET     WLINEZ8,25
.
          PACK      WLINEZ17,SP20,SP20
          MOVE      PADD2,WLINEZ17
          RESET     WLINEZ8,25
.
          PACK      WLINEZ9,SP20,SP20
          STRIP     PSUBRB
          STRIP     PPOST
          PACK      WLINEZ9,PSUBRB,SP1,PPOST
          RESET     WLINEZ9,25
.
          PACK      WLINEZ11,SP20,SP20
          PACK      CURRDATE,CDD,SLASH,CMM,SLASH,CYY
          REP       " 0",CURRDATE
          MOVE      "(Printed ",WLINEZ11
          ENDSET    WLINEZ11
          APPEND    CURRDATE,WLINEZ11
          APPEND    ")",WLINEZ11
.
          PACK      WLINEZ13,SP20,SP20
          MOVE      PTELEP,WLINEZ13
          RESET     WLINEZ13,12
.
          PACK      WLINEZ14,SP20,SP20
          PACK      WLINEZ14,ZOP,OBACLASS,OBACOMP
          ENDSET    WLINEZ14
.
          MOVE      OBAURNO,WLINEZ16
          RESET     WLINEZ16,8
          APPEND    ZFS,WLINEZ16
.
          UNPACK    NOLABEL,DIM1,ZCOPY
          REP       " 0",ZCOPY
.
          RETURN
.
OSB14300  PACK      WLINEZ1,SP20,SP20
          PACK      WLINEZ2,SP20,SP20
          PACK      WLINEZ3,SP20,SP20
          PACK      WLINEZ4,SP20,SP20
          PACK      WLINEZ5,SP20,SP20
          PACK      WLINEZ15,SP20,SP20,SP20
          PACK      DIM60,SP20,SP20,SP20
          MOVE      ZERO,COUNTER
          MOVE      ZERO,ENDSTR
          MOVE      ZERO,TMPPTR
          MOVE      ZERO,PRTOPT1         * flag for print option
          MOVE      ZERO,PRTOPT2
.
.         Check to see if visit based HCP fields are populated and
.         read the corresponding record where populated.
.
          MOVE      ZERO,HCPDATFL                * initialise HCP data flag
.
          MATCH     SP10,OTBBRFGP                * visit HCP blank ?
          IF        !@EQUAL
            ADD       ONE,HCPDATFL               * no - update flag
            MOVE      OTBBRFGP,KEY10
            CALL      RDPMHCP1                   * visit HCP on file ?
            IF        OVRCD = 1
              MOVE      "Invalid HCP Code.",WLINEZ15
              GOTO      OSB14380
            ENDIF
          ENDIF
.
          MATCH     SP10,OTBBGPPC                * visit practice blank ?
          IF        !@EQUAL
            ADD       TWO,HCPDATFL               * no - update flag
            PACK      KEY12,OTBBGPPC,SP1,ONE
            CALL      RDPMHCG1                   * visit practice on file ?
            IF        OVRCD = 1
              MOVE      "Invalid Practice Code.",WLINEZ15
              GOTO      OSB14380
            ENDIF
          ENDIF
.
          COMPARE   ZERO,HCPDATFL                * visit based data available ?
          GOTO      OSB14310 IF EQUAL            * no - use PMI data
.
.         Load the visit based details
.
          IF        HCPDATFL = 1
            MOVE      PMHCADR1,DIM60ZA           * load visit HCP address
            MOVE      PMHCADR2,DIM60ZB
            MOVE      PMHCADR3,DIM60ZC
            MOVE      PMHCPOST,DIMZ8
          ELSE
            MOVE      PMHGADD1,DIM60ZA           * load visit Practice address
            MOVE      PMHGADD2,DIM60ZB
            MOVE      PMHGADD3,DIM60ZC
            MOVE      PMHGPOST,DIMZ8
          ENDIF
          GOTO      OSB14315
.
.         The visit based data is not available, so use the PMI
.         based data.
.
OSB14310  MATCH     SP10,PMPXRHC1                * PMI HCP blank ?
          IF        !@EQUAL
            ADD       ONE,HCPDATFL               * no - update flag
            MOVE      PMPXRHC1,KEY10
            CALL      RDPMHCP1                   * PMI HCP on file ?
            IF        OVRCD = 1
              MOVE      "Invalid HCP Code.",WLINEZ15
              GOTO      OSB14380
            ENDIF
          ENDIF
.
          MATCH     SP10,PMPXRH1G                * PMI practice blank ?
          IF        !@EQUAL
            ADD       TWO,HCPDATFL               * no - update flag
            PACK      KEY12,PMPXRH1G,SP1,ONE
            CALL      RDPMHCG1                   * PMI practice on file ?
            IF        OVRCD = 1
              MOVE      "Invalid Practice Code.",WLINEZ15
              GOTO      OSB14380
            ENDIF
          ENDIF
.
          COMPARE   ZERO,HCPDATFL                * PMI based data available ?
          IF        @EQUAL
            MOVE      "No HCP Data.",WLINEZ15
            GOTO      OSB14380
          ENDIF
.
          IF        HCPDATFL = 1
            MOVE      PMHCADR1,DIM60ZA           * load PMI HCP address
            MOVE      PMHCADR2,DIM60ZB
            MOVE      PMHCADR3,DIM60ZC
            MOVE      PMHCPOST,DIMZ8
          ELSE
            MOVE      PMHGADD1,DIM60ZA           * load PMI Practice address
            MOVE      PMHGADD2,DIM60ZB
            MOVE      PMHGADD3,DIM60ZC
            MOVE      PMHGPOST,DIMZ8
          ENDIF
.
OSB14315  IF        HCPDATFL = 1 | HCPDATFL = 3
            CALL      GPINI000                   * Get GP Initials
            PACK      WLINEZ15,DIM1,SP1,KEY1,SP1,PMHCSNAM
          ELSE
            MOVE      PMHGPNAM,WLINEZ15
          ENDIF
.
.  * I-90300, mods for wrap around text for address
.
          STRIP     DIM60ZA
          STRIP     DIM60ZB
          STRIP     DIM60ZC
          STRIP     DIMZ8
          MOVE      DIM60ZA,DIM60
.
          MOVELPTR  DIM60,ENDSTR
          IF        ENDSTR<=25
            MOVE      DIM60,WLINEZ1
            GOTO      OSB14350
          ENDIF
.
          MOVE      ONE,PRTOPT1          * two lines for address one
          RESET     DIM60,25             * Position on 25th char
          LENSET    DIM60
OSB14340  BUMP      DIM60,-1             * search backwards for space
          MOVE      DIM60,ANS
          MATCH     SP1,ANS
          GOTO      OSB14340 IF NOT EQUAL
.
          BUMP      DIM60,-1             * don't keep space on end
          MOVEFPTR  DIM60,TMPPTR         * save current postion of FP
          LENSET    DIM60                * set LL to current FP position
          RESET     DIM60,1              * move FP back to first char
          MOVE      DIM60,WLINEZ1        
.
          RESET     DIM60,TMPPTR         * move FP back to previous position
          SETLPTR   DIM60,ENDSTR         * move LL back to end of string
.
          BUMP      DIM60,2
.
          MOVE      DIM60,WLINEZ2
.
OSB14350  MOVE      ZERO,COUNTER
          MOVE      ZERO,ENDSTR
          MOVE      ZERO,TMPPTR
          PACK      DIM60,SP20,SP20,SP20
          MOVE      DIM60ZB,DIM60
          MOVELPTR  DIM60,ENDSTR
          IF        ENDSTR<=25
            MOVE      DIM60,WLINEZ3
            GOTO      OSB14370
          ENDIF
.
          MOVE      ONE,PRTOPT2          * two lines for address 2
          RESET     DIM60,25
          LENSET    DIM60
OSB14360  BUMP      DIM60,-1
          MATCH     SP1,DIM60
          GOTO      OSB14360 IF NOT EQUAL
.
          BUMP      DIM60,-1             * don't keep space on end
          MOVEFPTR  DIM60,TMPPTR         * save current postion of FP
          LENSET    DIM60                * set LL to current FP position
          RESET     DIM60,1              * move FP back to first char
          MOVE      DIM60,WLINEZ3
.
          RESET     DIM60,TMPPTR         * move FP back to previous position
          SETLPTR   DIM60,ENDSTR         * move LL back to end of string
.
          BUMP      DIM60,2
.
          MOVE      DIM60,WLINEZ4
.
OSB14370  PACK      WLINEZ5,DIM60ZC,SP1,DIMZ8 
.
          GOTO      OSB14390
.
OSB14380  MOVE      ONE,PRTOPT1
          MOVE      ONE,PRTOPT2
          MOVE      "U/R Number:",WLINEZ1
          MOVE      OBAURNO,WLINEZ2
          MOVE      "Visit Number:",WLINEZ3
          MOVE      OBAOUTNO,WLINEZ4
.
OSB14390  UNPACK    NOLABEL,DIM1,ZCOPY
          REP       " 0",ZCOPY
.
          RETURN
+
.******************************************************************************
.*                                 OSB15000                                   *
.*                       Label 15 for SJOG Geelong                            *
.******************************************************************************
.
OSB15000  MOVE      TWO,SJOGFLAG                 * set flag for O/P label
.
          CALL      SETSJOGL                     * in SJOGLABL.PBL
.
          RETURN
+
.********************************************************************** 
. GHSCM000 : Get Hospital from Clinic Master
.********************************************************************** 
GHSCM000  PACK      CFNAME,UID,SP10          * open file
          MOVE      UID,CFILEPRE             * Save Current File Prefix
          CALL      OPOTMA11
.
          UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          CALL      DATECONV                 * convert date to number
.
          MOVE      SP3,OTMAHOSP             * clear variable
          PACK      KEY18,OBASITE,OBACLIN,WEEKDAY,OBASTRT
          CALL      RDMASA1
.
GHSCM999  RETURN
+
.
.********************************************************************** 
. GPINI000 : Get Initials in Given Name for GP
. Returns : DIM1,KEY1 as initials
.********************************************************************** 
GPINI000  RESET     PMHCGNAM
          MOVE      PMHCGNAM,DIM1           * got first initial
GPINI300  BUMP      PMHCGNAM                * get next char
          IF        @EOS
            MOVE      SP1,KEY1              * no second given name
            GOTO      GPINI999
          ENDIF
          MATCH     SP1,PMHCGNAM            * space?
          GOTO      GPINI300 IF NOT EQUAL
.
          BUMP      PMHCGNAM
          MOVE      PMHCGNAM,KEY1             * get next initial
          RESET     PMHCGNAM
.
GPINI999  RETURN
+
.
.------------------------------------------------------------------------------
.         Set up Mammography label print variables
.------------------------------------------------------------------------------
.         1st line of mammography label
.
SETMAM10  PACK      WFLINE1,SP30,SP10           * Clear string
          CLEAR     WFLINE1
          APPEND    CNAME,WFLINE1
          RESET     WFLINE1
.
.         2nd line of mammography label
.
SETMAM20  PACK      WFLINE2,SP30,SP10           * Clear string
          CLEAR     WFLINE2
          APPEND    HMLBMESG,WFLINE2
          RESET     WFLINE2
.
.         3rd line of mammography label
.
SETMAM30  PACK      WFLINE3,SP30,SP10           * Clear string
          CLEAR     WFLINE3
          APPEND    "Name: ",WFLINE3
          APPEND    PSNAME,WFLINE3
          CALL      FINENDG3
          APPEND    ", ",WFLINE3
          APPEND    PGNAME,WFLINE3
          RESET     WFLINE3,26
          APPEND    " Age:",WFLINE3
.
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,WFLINE3
            APPEND    PSAGETYP,WFLINE3
          ELSE
            APPEND    PSAGE,WFLINE3
          ENDIF
.
          RESET     WFLINE3
.
.         4th line of mammography label
.
SETMAM40  PACK      WFLINE4,SP30,SP10           * Clear string
          CLEAR     WFLINE4
          APPEND    "Date: ",WFLINE4
          UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          PACK      WFLINE5,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          APPEND    WFLINE5,WFLINE4
          RESET     WFLINE4,16
          APPEND    " U/R No.:",WFLINE4
          APPEND    OBAURNO,WFLINE4
          APPEND    DESCASEN,WFLINE4
          RESET     WFLINE4
.
.         5th line of mammography label
.
SETMAM50  PACK      WFLINE5,SP30,SP10           * Clear string
          CLEAR     WFLINE5
          APPEND    "Ref.Doctor: ",WFLINE5
          APPEND    OCADESC,WFLINE5
          RESET     WFLINE5,34
          APPEND    SP10,WFLINE5
          RESET     WFLINE5
.
.         6th line of mammography label
.
SETMAM60  PACK      WFLINE6,SP30,SP10           * Clear string
          CLEAR     WFLINE6
          APPEND    "X-Ray Type:",WFLINE6
          RESET     WFLINE6
.
.         7th line of mammography label
.
SETMAM70  PACK      WFLINE7,SP30,SP10
.
.         8th line of mammography label
.
SETMAM80  PACK      WFLINE8,SP30,SP10
.
.         1st line of mammography x-ray label
.
SETMXR10  PACK      MXRLINE1,SP30                * Clear string
          CLEAR     MXRLINE1
          APPEND    CNAME,MXRLINE1
          RESET     MXRLINE1
.
.         2nd line of mammography x-ray label
.
SETMXR20  PACK      MXRLINE2,SP30                * Clear string
          CLEAR     MXRLINE2
          APPEND    HMLBMESG,MXRLINE2
          RESET     MXRLINE2
.
.         3rd line of mammography x-ray label
.
SETMXR30  PACK      MXRLINE3,SP30                * Clear string
          CLEAR     MXRLINE3
          APPEND    "Name: ",MXRLINE3
          APPEND    PSNAME,MXRLINE3
          CALL      FINENDM3
          APPEND    ", ",MXRLINE3
          APPEND    PGNAME,MXRLINE3
          RESET     MXRLINE3
.
.         4th line of mammography x-ray label
.
SETMXR40  PACK      MXRLINE4,SP30                * Clear string
          CLEAR     MXRLINE4
          APPEND    "Age: ",MXRLINE4
.
          IF        PTCNDATE=1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
            APPEND    PSAGECON,MXRLINE4
            APPEND    PSAGETYP,MXRLINE4
          ELSE
            APPEND    PSAGE,MXRLINE4
          ENDIF
.
          RESET     MXRLINE4,13
          APPEND    "Date: ",MXRLINE4
          UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          PACK      MXRLINE5,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          APPEND    MXRLINE5,MXRLINE4
          RESET     MXRLINE4
.
.         5th line of mammography x-ray label
.
SETMXR50  PACK      MXRLINE5,SP30                * Clear string
.
.         6th line of mammography x-ray label
.
SETMXR60  PACK      MXRLINE6,SP30                * Clear string
.
.         7th line of mammography x-ray label
.
SETMXR70  PACK      MXRLINE7,SP30                * Clear string
.
.         8th line of mammography x-ray label
.
SETMXR80  PACK      MXRLINE8,SP30                * Clear string
.
.         Finished setting up print variables
.
OSLB9999  RETURN
.
.*******************************************************************************
.*        Subroutine to set up a lineup print                                  *
.*******************************************************************************
OSLU0000  BRANCH    MAMMFLAG,OSMAM000        * Mammography labels - diff setup
          BRANCH    LABTYPE,OSLU1000,OSLU1000,OSLU1000,OSLU3000,OSLU5000:
                            OSLU6000,OSLU7000,OSLU8000,OSLU9000,OSLU1000:
                            OSU11000,OSU12000,OSU13000,OSU14000
.
.-------------------------------------------------------------------------------
.         Standard & Wellington Labels
.-------------------------------------------------------------------------------
OSLU1000  MOVE      "XXXXXXXXXXXXXXXXXXXX XXXX X UR:99999999*",WFLINE1
          MOVE      "XXXXXXXXXXXXXXXXXXXXX 99/99/1999 XXXXXXX",WFLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WFLINE3
          MOVE      "XXXXXX XXXXXXXXXXXXXXXXXXXXX Class: HNIP",WFLINE4
          MOVE      "Medi:9999999999             Out:99999999",WFLINE5
          PACK      WFLINE6,SP30,SP10
          PACK      WFLINE7,SP30,SP10
          PACK      WFLINE8,SP30,SP10
          GOTO      OSLU9999
.
.-------------------------------------------------------------------------------
.         Southland/New Zealand Labels
.-------------------------------------------------------------------------------
OSLU3000  MOVE      " XXXXXXXXXXXXXXX XXXX UR:XXXXXX  ",WLINE1
          MOVE      " XXXXXXXXXXXXXXX X 99/99/99 XXX  ",WLINE2
          MOVE      " OP:XXXXXX XXXXXXXX XXXXXXXXXXX  ",WLINE3
          MOVE      " XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  ",WLINE4
          MOVE      " XXXXXXXXXXXXXXX   PH:XXXXXXXXX  ",WLINE5
          PACK      WLINE6,SP30,SP10
          PACK      WLINE7,SP30,SP10
          PACK      WLINE8,SP30,SP10
          GOTO      OSLU9999
.
.-------------------------------------------------------------------------------
.         Whakatane Labels
.-------------------------------------------------------------------------------
OSLU5000  MOVE      "XXXXXXXXXXXXXXXXXXX XXXXUR:XXXXXXXX   ",WLINE1A
          MOVE      "XXXXXXXXXXXXXXXXXXXX X XXX XX/XX/XX   ",WLINE2A
          MOVE      "XXXXXXXXXXXXXXXXX, XXXXXXXXXXXXXXXX   ",WLINE3A
          MOVE      "OP:XXXXXX XXXXXXXX XXXXXXXXXXXXXXXX   ",WLINE4A
          MOVE      "PH:XXXXXXXXXXXX XXXXXXXXXXXXXXXXXX    ",WLINE5A
          PACK      WLINE6A,SP30,SP10
          PACK      WLINE7A,SP30,SP10
          PACK      WLINE8A,SP30,SP10
          GOTO      OSLU9999
.
.-------------------------------------------------------------------------------
.         Hong Kong format
.-------------------------------------------------------------------------------
OSLU6000  MOVE      "XXXXXXXXXX XXXXXXXXXXXX  ",WLINE1
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXX ",WLINE2
          MOVE      "XXXXXX       XX/XX/XXXX  ",WLINE3
          MOVE      "XXXXXXXX                 ",WLINE4
          MOVE      "                         ",WLINE5
          GOTO      OSLU9999
.
.-------------------------------------------------------------------------------
.         Dudley format
.-------------------------------------------------------------------------------
.
OSLU7000  MOVE      "XXXXXXXXXXXXXXXXXXXX 99999999 ",WLINE1A
          MOVE      "                              ",WLINE2A
          MOVE      "XXXXXXXXXXXXXXXXXX X 99/99/99 ",WLINE3A
          MOVE      "                              ",WLINE4A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE5A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE6A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE7A
          MOVE      "XXXXXXXXXXXXXXXXXXXX 99999999 ",WLINE8A
.
          MOVE      "XXXXXXXXXXXX X XXXXXXXXXXXX X ",WLINE1
          MOVE      "99999999 X 999 99999999 X 999 ",WLINE2
          RETURN
.
.-------------------------------------------------------------------------------
. Hawkes Bay Line Up?
.-------------------------------------------------------------------------------
.
OSLU8000  MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE1A       
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE2A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE3A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE4A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX ",WLINE5A
          RETURN
.
.-------------------------------------------------------------------------------
. Taranaki Line Up
.-------------------------------------------------------------------------------
OSLU9000  MOVE      "XXXXXXXXXXXXXXXXXXXX 99/99/99 99999999",WLINE1A
          MOVE      "XXXXXXXXXXXXXXXXXXXX X     XXX  MWS:99",WLINE2A
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WLINE3A
          MOVE      "PH: XXXXXXXXXX GP: XXXXXXXXXXXXXXXXXXX",WLINE4A
          MOVE      "XXXXXXXXXXXXXXXX  99/99/99 99:99 XXX  ",WLINE5A
          RETURN
.
.-------------------------------------------------------------------------------
.         Joondalup Labels
.-------------------------------------------------------------------------------
OSU11000  MOVE      "XXXXXXXXXXXXXXXXXXX XXXXUR:XXXXXXXX   ",WLINE1A
          MOVE      "XXXXXXXXXXXXXXXXXXXX X XXX XX/XX/XX   ",WLINE2A
          MOVE      "XXXXXXXXXXXXXXXXX, XXXXXXXXXXXXXXXX   ",WLINE3A
          MOVE      "OP:XXXXXX XXXXXXXX XXXXXXXXXXXXXXXX   ",WLINE4A
          MOVE      "PH:XXXXXXXXXXXX XXXXXXXXXXXXXXXXXX    ",WLINE5A
          MOVE      "XXXXXXXXXXXXXXXXXXXX                  ",WLINE6A
          PACK      WLINE7A,SP30,SP10
          PACK      WLINE8A,SP30,SP10
          GOTO      OSLU9999
.
.-------------------------------------------------------------------------------
.         MBF Labels      
.-------------------------------------------------------------------------------
OSU12000  MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX     ",WFLINE1
          PACK      WFLINE2,SP30,SP10
          MOVE      "XXXX XXXXXXXXXX, XXXXXXX Age:XXXX       ",WFLINE3
          MOVE      "Date: XX/XX/XXXX U/R No.:XXXXXXXX       ",WFLINE4
          MOVE      "Ref.Doctor: XXXXXX XX. X. XXXXXXXXXXXXXX",WFLINE5
          MOVE      "Ref. Date : XX/XX/XXXX                  ",WFLINE6
          PACK      WFLINE7,SP30,SP10
          PACK      WFLINE8,SP30,SP10
          GOTO      OSLU9999
.
.------------------------------------------------------------------------------
.         WGH Consultancies Line Up
.------------------------------------------------------------------------------
OSU13000  MOVE      "XXXXXXXXXXXXXXXXXX XXXX X Id:XXXXXXXX",WFLINE1
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXX XX.XX.XX XXXX",WFLINE2
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WFLINE3
          MOVE      "PH:XXXXXXXXXXXXX BH PH:XXXXXXXXXXXXXX",WFLINE4
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXX XXXXXXXXXX",WFLINE5
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",WFLINE6
          GOTO      OSLU9999
.
.------------------------------------------------------------------------------
.         St Vincent's Hosp Line Up
.------------------------------------------------------------------------------
OSU14000  MOVE      "XXXXXXX",WLINEZ1
          MOVE      "XXXXXXXXXXXXXXXX",WLINEZ2
          MOVE      "XXXXXXXXXXXXXXXXXXXX",WLINEZ3
          MOVE      "XXXX",WLINEZ4
          MOVE      "XXXXXX",WLINEZ5
          MOVE      "DoB:99/99/9999",WLINEZ6
          MOVE      "999yr",WLINEZ7
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXX",WLINEZ8
          MOVE      "XXXXXXXXXXXXXXXXXXXX 9999",WLINEZ9
          MOVE      "XXXXXXXXXXX",WLINEZ10
          MOVE      "(Printed 99/99/99)",WLINEZ11
          MOVE      "(X)",WLINEZ12
          MOVE      "99999999999",WLINEZ13
          MOVE      "XXXXXXXX",WLINEZ14
          RETURN 
.
.-------------------------------------------------------------------------------
.          Mammography labels
.-------------------------------------------------------------------------------
OSMAM000  MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          ",WFLINE1
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          ",WFLINE2
          MOVE      "Name: XXXXXXXXXXXXXXXXXXXX Age:999      ",WFLINE3
          MOVE      "Date: 99/99/9999 U/R No.:99999999*      ",WFLINE4
          MOVE      "Ref.Doct: XXXXXXXXXXXXXXXXXXXXXXXX      ",WFLINE5
          MOVE      "X-Ray Type:                             ",WFLINE6
          PACK      WFLINE7,SP30,SP10
          PACK      WFLINE8,SP30,SP10
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",MXRLINE1
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",MXRLINE2
          MOVE      "Name: XXXXXXXXXXXXXXXXXXXXXXXX",MXRLINE3
          MOVE      "Age: 999      Date: 99/99/9999",MXRLINE4
          PACK      MXRLINE5,SP30
          PACK      MXRLINE6,SP30
          PACK      MXRLINE7,SP30
          PACK      MXRLINE8,SP30
.
OSLU9999  RETURN
.
.------------------------------------------------------------------------------
.          Subroutine to get the Patients first name, returned in DIM20
.------------------------------------------------------------------------------
.
GETFNAM   MOVE      PGNAME,DIM20
OLOOP1    CMATCH    SP1,DIM20
          GOTO      ONCONT1 IF EQUAL
          BUMP      DIM20
          GOTO      OLOOP1 IF NOT EOS
.
ONCONT1   APPEND    SP30,DIM20
          RESET     DIM20
          RETURN
.
.------------------------------------------------------------------------------
.          Subroutine to find the end of the string in WFLINE2
.------------------------------------------------------------------------------
.
FINENDG2  CMATCH    SP1,WFLINE2
          RETURN    IF NOT EQUAL
          BUMP      WFLINE2,-1
          GOTO      FINENDG2 IF NOT EOS
          RESET     WFLINE2
          RETURN
.
.------------------------------------------------------------------------------
.          Subroutine to find the end of the string in WFLINE3
.------------------------------------------------------------------------------
.
FINENDG3  CMATCH    SP1,WFLINE3
          RETURN    IF NOT EQUAL
          BUMP      WFLINE3,-1
          GOTO      FINENDG3 IF NOT EOS
          RESET     WFLINE3
          RETURN
.
.------------------------------------------------------------------------------
.          Subroutine to find the end of the string in WFLINE4
.------------------------------------------------------------------------------
.
FINENDG4  CMATCH    SP1,WFLINE4
          RETURN    IF NOT EQUAL
          BUMP      WFLINE4,-1
          GOTO      FINENDG4 IF NOT EOS
          RESET     WFLINE4
          RETURN
.
.------------------------------------------------------------------------------
.          Subroutine to find the end of the string in MXRLINE3
.------------------------------------------------------------------------------
.
FINENDM3  CMATCH    SP1,MXRLINE3
          RETURN    IF NOT EQUAL
          BUMP      MXRLINE3,-1
          GOTO      FINENDM3 IF NOT EOS
          RESET     MXRLINE3
          RETURN
.
.------------------------------------------------------------------------------
.          Subroutine to get details
.------------------------------------------------------------------------------
.          If PMI details exist, overwrite bookings file details
.
GETDET00  MOVE      SP1,DESCASEN
          MOVE      OBAURNO,PURNO
          MOVE      PURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,GETDET10
.
          CALL      CLPMSPX2
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
.
          COMPARE   ZERO,PCASE
          GOTO      GETDET20 IF EQUAL
.
          MOVE      ASK,DESCASEN
          GOTO      GETDET20
.
GETDET10  MOVE      OBAOUTNO,PURNO
          MOVE      PURNO,KEY8
          CALL      RDPRAM1
          MOVE      ZEROUR,PURNO
.
.          If keyin doctor, get OBADOCT, else use OBACLIN
.
GETDET20  PACK      OCADESC,SP30
          CLEAR     OCADESC
          CMATCH    ANSY,OMAKDOC
          GOTO      GETDET30 IF NOT EQUAL
.
          APPEND    OBADOCT,OCADESC
          APPEND    SP1,OCADESC
.
          MOVE      OBADOCT,KEY6
          GOTO      GETDET40
.
GETDET30  PACK      KEY20,OBASITE,OBACLIN,OBADATE
          CALL      RDCLIA1
          IF        OVRCD = 1
            CALL      RDPCLIA1
            IF        OVRCD = 0
              MATCH     OBASITE,OCASITE
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ELSE
                MATCH     OBACLIN,OCACLIN
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          IF        OVRCD = 1
            MOVE      "Unknown clinic",OCADESC
            PACK      OCADESC,OCADESC,SP30
          ENDIF
          BRANCH    OVRCD,GETDET50
.
          MATCH     SP6,OCADOCT
          GOTO      GETDET50 IF EQUAL
.
          APPEND    OCADOCT,OCADESC
          APPEND    SP1,OCADESC
          MOVE      OCADOCT,KEY6
.
GETDET40  CALL      RDDOCT1
          BRANCH    OVRCD,GETDET50
.
          MOVE      DTITL,PNTITLE
          MOVE      DGNAME,PNGNAME
          MOVE      DSNAME,PNSNAME
          CALL      PACKNAME
          APPEND    PNFNAME,OCADESC
.
GETDET50  RESET     OCADESC
.
GETDET99  RETURN
.
.------------------------------------------------------------------------------
.         Format a name string in the form TITLE INIT1. INIT2. etc. SURNAME
.         Requires : IBACOMM.PBL
.                    Title in PNTITLE (DIM 4)
.                    Given name in PNGNAME (DIM 30)
.                    Surname in PNSNAME (DIM 30)
.         Output   : Formatted name in PNFNAME (DIM 30)
.------------------------------------------------------------------------------
.
PACKNAME  MOVE      SP30,PNFNAME
          RESET     PNSNAME
          RESET     PNGNAME
          RESET     PNTITLE
          MATCH     SP4,PNTITLE
          GOTO      PNGLOOP1 IF EQUAL
          RESET     PNFNAME,0
          APPEND    PNTITLE,PNFNAME
          APPEND    SP1,PNFNAME
PNGLOOP1  MOVE      PNGNAME,ANS
          CMATCH    SP1,ANS
          GOTO      PNGLOOP2 IF NOT EQUAL
          MOVE      ZERO,OVRCD
          GOTO      PNGLOOP3
PNGLOOP2  BRANCH    OVRCD TO PNGLOOP3
          APPEND    ANS,PNFNAME
          APPEND    DOT,PNFNAME
          APPEND    SP1,PNFNAME
          MOVE      ONE,OVRCD
PNGLOOP3  BUMP      PNGNAME
          GOTO      PNGEXIT IF EOS
          GOTO      PNGLOOP1
PNGEXIT   APPEND    PNSNAME,PNFNAME
          RESET     PNFNAME
          MOVE      ZERO,OVRCD
          RETURN
.
.------------------------------------------------------------------------------
.          Subroutine to get the Patients first name, returned in DIM20
.------------------------------------------------------------------------------
.
GETGNAM   MOVE      PGNAME,DIM20
PLOOP1    CMATCH    SP1,DIM20
          GOTO      LCONT1A IF EQUAL
          BUMP      DIM20
          GOTO      PLOOP1 IF NOT EOS
.
LCONT1A   APPEND    SP30,DIM20
          RESET     DIM20
          RETURN
.
.**************************************************************************
.*                              FDOC0000                                  *
.*                      Format doctors name                               *
.**************************************************************************
FDOC0000  MOVE      DTITL,OCADESC
          ENDSET    OCADESC
.
FDOC1000  CMATCH    SP1,OCADESC
          GOTO      FDOC2000 IF NOT EQUAL
          BUMP      OCADESC,-1
          GOTO      FDOC1000
.
FDOC2000  APPEND    SP1,OCADESC
          APPEND    DGNAME,OCADESC
          ENDSET    OCADESC
.
FDOC2200  CMATCH    SP1,OCADESC
          GOTO      FDOC3000 IF NOT EQUAL
          BUMP      OCADESC,-1
          GOTO      FDOC2200
.
FDOC3000  APPEND    SP1,OCADESC
          APPEND    DSNAME,OCADESC
          ENDSET    OCADESC
.
FDOC3200  CMATCH    SP1,OCADESC
          GOTO      FDOC9000 IF NOT EQUAL
          BUMP      OCADESC,-1
          GOTO      FDOC3200
.
FDOC9000  RESET     OCADESC
.
FDOC9999  RETURN
.
.*********************************************************************
.         get the Hong Kong Id for a patient
.         Returns : WLINE1        the first label line
.*********************************************************************
          DEFPROC   OTLBHK00
.
          INC       PATNIDFD/INC
DIM10     DIM       10
.
          MOVE      PTMXCHNM,DIM10          * truncate chinese name
          PACK      PNGNAME,SP20,SP20
          OPEN      PATNIDA1,"patnidaf"
          PACK      KEY10,CHOSINDX,PURNO
          MOVE      SP20,PTNINMPI           * clear the field
          CALL      RDPTNID1
          CLOSE     PATNIDA1
.
          PACK      PNGNAME,PTNINMPI,SP30
          SQUEEZE   PNGNAME
.
          PACK      WLINE1,DIM10,SP1,PNGNAME,SP30
          GOTO      OTLBHK99
.
          INC       PATNIDIO/INC
          INC       IBAOVRIO/INC
.
OTLBHK99  ENDPROC
+

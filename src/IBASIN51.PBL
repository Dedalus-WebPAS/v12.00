.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.04.01  13.04.2005 Peter Vela CAR 59696
.           Recompiled for SINSUAFD
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.00.02  22.12.1999 Charles Handaya
.           Recompiled for Fixing Audit Date (CCYYMMDD)
. VF.00.01  03.11.1999 Sandra Barcham
.           Change locked message to use X
.-------------------------------------------------------
F12P4     FORM      12.4
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASIN51
.   Function      :   Service Code Maintenance                
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       IBAGEDFD/INC
          INC       IBAGSTFD/INC
          INC       SINCCAFD/INC
          INC       SINSUAFD/INC
          INC       SINSVAFD/INC
          INC       SINSVBFD/INC
.=========================
.Local Variable Definition
.-------------------------
WHOLEQTY  FORM     12 * Scr 00 Fld    14
.
.Word Processor File * Scr 00 Fld    16
.
NAMSIVB1  INIT      "Wsivb1"
FILSIVB1  DIM       8
.
TOTALGST  FORM     12.2 * Scr 00 Fld    26
TOTALCST  FORM     12.2 * Scr 00 Fld    27
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASIN51"
PRGNAM    INIT      "Service Code Maintenance                "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMPWORD,FILSIVB1
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     TEMPWORD,DELETE
          ENDIF
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening ibagedaf";
          OPEN      IBAGEDA1,"ibagedaf"
          DISPLAY   *P56:24,"Opening ibagstaf";
          OPEN      IBAGSTA1,"ibagstaf"
          DISPLAY   *P56:24,"Opening ibagstaf";
          OPEN      IBAGSTA2,"ibagstaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA1,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA2,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA1,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA2,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA3,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsvaaf";
          OPEN      SINSVAA1,"sinsvaaf"
          DISPLAY   *P56:24,"Opening sinsvbaf";
          OPEN      SINSVBA1,"sinsvbaf"
.--------------------------------------------------------
. Initialise Wp Filename for Notes                              
.--------------------------------------------------------
          PACK      FILSIVB1,NAMSIVB1,PORT
          REP       " 0",FILSIVB1
          DISPLAY   *P56:24,"Create & Open ",FILSIVB1;
          PREP      TEMPWORD,FILSIVB1
.
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Screen                        
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Screen                        
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Screen                        
.-------------------------------------------------------
CF00L000
          MOVE      SP70,SIVACOD 
          MOVE      SP70,SIVADES 
          MOVE      SP70,SIVAPN  
          MOVE      SP70,SIVASUT 
          MOVE      SP70,SIVACST 
          MOVE      SP70,SICADESC
          MOVE      SP70,SIVAPRD 
          MOVE      SP70,SISADESC
          MOVE      ZERO,SIVALED 
          MOVE      ZERO,WHOLEQTY
          MOVE      ZERO,SIVAAMT 
          MOVE      SP70,SIVAUR1 
          MOVE      SP70,SIVAUR2 
          MOVE      SP70,SIVAUD1 
          MOVE      SP70,SIVAUD2 
          MOVE      SP70,SIVAUY1 
          MOVE      SP70,SIVAUY2 
          MOVE      SP70,SIVAGST 
          MOVE      SP70,IBGSDESC
          MOVE      ZERO,SIVAGSTA
          MOVE      ZERO,TOTALGST
          MOVE      ZERO,TOTALCST
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Screen                        
.--------------------------------------------------------
KY00L000
.
KY00L110
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "2",CKEYTYP
          CALL      KSIVA000
          BRANCH    EXIT,KY00L900,KY00L900
          MOVE      OVRCD,ACCEPT
          CALL      MSIVA000
          MOVE      SIVACOD,VAR      
          CALL      DISPITEM
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Screen                        
.---------------------------------------------------------
WP00L000
          PREP     TEMPWORD,FILSIVB1
          PACK     KEY7,SIVACOD,SP70
          MOVE     KEY7,SAVKEY80
          SETLPTR  SAVKEY80,4 
          CALL      RDSIVB1 
          IF        OVRCD=0
            CALL      RPSIVB1 
          ENDIF
WP00L100
          CALL     RKSIVB1 
          BRANCH   OVRCD,WP00L105
          PACK     KEY7,SIVBCOD,SIVBLIN
          MATCH    SAVKEY80,KEY7    
          GOTO     WP00L105 IF NOT EQUAL
          PACK     VAR,SIVBCOM,SP70,SP70
          STRIP    VAR
          MOVELPTR VAR,F3
          SFORMAT  VAR,F3
          MOVE     SIVBCOM,VAR
          IF       F3=0
            WRITE    TEMPWORD,SEQ;
          ELSE
            WRITE    TEMPWORD,SEQ;VAR
          ENDIF
          SFORMAT  VAR,127
          GOTO     WP00L100
WP00L105  CLOSE    TEMPWORD
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Screen                        
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Screen                        
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Screen                        
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L101,PS00L102,PS00L103:
                            PS00L104,PS00L105,PS00L106,PS00L107:
                            PS00L108,PS00L109,PS00L110,PS00L111:
                            PS00L112,PS00L113,PS00L114,PS00L115:
                            PS00L116,PS00L117,PS00L118,PS00L119:
                            PS00L120,PS00L121,PS00L122
          GOTO     PS00L999
.
PS00L101
          MOVE      SIVADES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      SIVAPN,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      SIVASUT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      SIVACST,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      SICADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      SIVAPRD,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      SISADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      SIVALED,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      WHOLEQTY,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      SIVAAMT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          MOVE     FILSIVB1,WORDNAME
          CALL     DISPWORD
          GOTO     PS00L999
.
PS00L112
          MOVE      SIVAUR1,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L113
          MOVE      SIVAUR2,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L114
          UNPACK    SIVAUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L115
          MOVE      SIVAUD2,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L116
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SIVAUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L117
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SIVAUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L118
          MOVE      SIVAGST,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L119
          MOVE      IBGSDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L120
          MOVE      SIVAGSTA,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L121
          MOVE      TOTALGST,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L122
          MOVE      TOTALCST,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Screen                        
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L006,SF00L104,SF00L105,SF00L106:
                            SF00L107,SF00L006,SF00L108,SF00L006:
                            SF00L109,SF00L110,SF00L111,SF00L112:
                            SF00L113,SF00L114,SF00L115,SF00L116:
                            SF00L117,SF00L118,SF00L119,SF00L006:
                            SF00L006,SF00L006,SF00L006
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L104,SF00L105,SF00L106:
                            SF00L107,SF00L020,SF00L108,SF00L020:
                            SF00L109,SF00L110,SF00L111,SF00L112:
                            SF00L113,SF00L114,SF00L115,SF00L116:
                            SF00L117,SF00L118,SF00L119,SF00L020:
                            SF00L020,SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      POST0000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      DELT0000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KDESC000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
            BRANCH    EXIT,SF00L104,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      SIVADES,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L105
          CALL     SELECTED
          STRIP     SIVAPN  
          SFORMAT   VAR,SCPSLEN
          MOVE      SIVAPN,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,SIVAPN  
          SFORMAT   VAR,127
          ENDSET    SIVAPN  
          APPEND    SP70,SIVAPN  
          RESET     SIVAPN  
          CMATCH    EXITCHAR,SIVAPN  
          GOTO      SF00L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,SIVAPN  
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
          ENDIF
          MOVE      SIVAPN,VAR       
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L106
          CALL     SELECTED
          STRIP     SIVASUT 
          SFORMAT   VAR,SCPSLEN
          MOVE      SIVASUT,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,SIVASUT 
          SFORMAT   VAR,127
          ENDSET    SIVASUT 
          APPEND    SP70,SIVASUT 
          RESET     SIVASUT 
          CMATCH    EXITCHAR,SIVASUT 
          GOTO      SF00L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,SIVASUT 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L106
            ENDIF
          ENDIF
          MOVE      SIVASUT,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L107
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KSICAA00
          MOVE      SICACODE,SIVACST
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L107
            ENDIF
            BRANCH    EXIT,SF00L107,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      SIVACST,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICADESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L108
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SISADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KSISAA00
          MOVE      SISACODE,SIVAPRD
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L108
            ENDIF
            BRANCH    EXIT,SF00L108,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      SIVAPRD,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   12",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SISADESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L109
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,SIVALED 
          IF        SCPSMAN=1
            COMPARE   ZERO,SIVALED 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L109
            ENDIF
          ENDIF
          MOVE      SIVALED,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L110
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EQTY0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L110
            ENDIF
            BRANCH    EXIT,SF00L110,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      WHOLEQTY,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L111
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIVAGSTA
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   26",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOTALGST
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOTALCST
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EPRIC000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L111
            ENDIF
            BRANCH    EXIT,SF00L111,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      SIVAAMT,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIVAGSTA,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   26",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOTALGST,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOTALCST,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L112
          CALL     SELECTED
          IF       EXIT=1
            IF       ACCEPT=0
              MOVE     "17",SCPSROW
              MOVE     " 16",SCPSCOL
              MOVE     " 60",SCPSLEN
              MOVE     " 4",SCPSNOR
              MOVE     SCPSROW,CVERT
              MOVE     SCPSCOL,CCOL
              MOVE     ZERO,HLEF
              CALL     GETSCR00
              MOVE     FILSIVB1,WORDNAME
              MOVE     "  8",WORDTYPE
              CALL     EDITWORD
              CALL     PUTSCR00
            ENDIF
          ELSE
            MOVE     FILSIVB1,WORDNAME
            MOVE     "  8",WORDTYPE
            CALL     EDITWORD
          ENDIF
          GOTO     SF00L001
.
SF00L113
          CALL     SELECTED
          STRIP     SIVAUR1 
          SFORMAT   VAR,SCPSLEN
          MOVE      SIVAUR1,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,SIVAUR1 
          SFORMAT   VAR,127
          ENDSET    SIVAUR1 
          APPEND    SP70,SIVAUR1 
          RESET     SIVAUR1 
          CMATCH    EXITCHAR,SIVAUR1 
          GOTO      SF00L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,SIVAUR1 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L113
            ENDIF
          ENDIF
          MOVE      SIVAUR1,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L114
          CALL     SELECTED
          STRIP     SIVAUR2 
          SFORMAT   VAR,SCPSLEN
          MOVE      SIVAUR2,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,SIVAUR2 
          SFORMAT   VAR,127
          ENDSET    SIVAUR2 
          APPEND    SP70,SIVAUR2 
          RESET     SIVAUR2 
          CMATCH    EXITCHAR,SIVAUR2 
          GOTO      SF00L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,SIVAUR2 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L114
            ENDIF
          ENDIF
          MOVE      SIVAUR2,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L115
          CALL     SELECTED
          CALL      KEYDATE
          PACK      SIVAUD1,CCENT,CYEAR,CMON,CDAY           
          UNPACK    SIVAUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L116
          CALL     SELECTED
          STRIP     SIVAUD2 
          SFORMAT   VAR,SCPSLEN
          MOVE      SIVAUD2,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,SIVAUD2 
          SFORMAT   VAR,127
          ENDSET    SIVAUD2 
          APPEND    SP70,SIVAUD2 
          RESET     SIVAUD2 
          CMATCH    EXITCHAR,SIVAUD2 
          GOTO      SF00L990 IF EQUAL
          IF        SCPSMAN=1
            MATCH     SP70,SIVAUD2 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L116
            ENDIF
          ENDIF
          MOVE      SIVAUD2,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L117
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,SIVAUY1 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SIVAUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L118
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,SIVAUY2 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SIVAUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L119
.
.
          MOVE      "   24",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,IBGSDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EGST0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L119
            ENDIF
            BRANCH    EXIT,SF00L119,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      SIVAGST,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   24",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      IBGSDESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------------------------------------
. Set accept mode if record does not exist
.----------------------------------------------------------------------
MSIVA000  PACK      KEY4,SIVACOD,SP70
          CALL      RDSIVA1
          MOVE      OVRCD,ACCEPT
.
          IF        OVRCD=1
            PACK      IBGSDESC,SP70
            MOVE      ZERO,WHOLEQTY
            MOVE      ZERO,TOTALCST
            MOVE      ZERO,TOTALGST
            MOVE      ZERO,SIVAQTY
            GOTO      MSIVA999
          ENDIF
.
          MATCH     SP70,SIVACST
          IF        !@EQUAL
            PACK      SICADESC,SP70
            PACK      KEY5,SIVACST,SP70
            CALL      RDSICA1
          ENDIF
.
          MATCH     SP70,SIVAPRD
          IF        !@EQUAL
            PACK      SISADESC,SP70
            PACK      KEY5,SIVAPRD,SP70
            CALL      RDSISA1
          ENDIF
.
MSIVA999  RETURN
.----------------------------------------------------------------------
. Post Data
.----------------------------------------------------------------------
POST0000  PACK      KEY4,SIVACOD,SP70  * write/update master record
          CALL      RASIVA1
          IF        OVRCD=1
            CALL      WRSIVA1
          ELSE
            CALL      UPSIVA1
          ENDIF
.
          CALL      POWP0000           * post wp data
.
POST9000  CALL      UUSIVA1
.
POST9999  RETURN
.----------------------------------------------------------------------
. Post WP Data
.----------------------------------------------------------------------
POWP0000
.
.---- open temp file ----
.
          MOVE      ZERO,F3
.
          CLOSE     TEMPWORD
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMPWORD,FILSIVB1
          TRAPCLR   IO
          BRANCH    OVRCD,POWP2000               * 1 = file not found
.
.---- add wp data ----
.
POWP1000
          READ     TEMPWORD,SEQ;SIVBCOM          * read through temp file
          GOTO     POWP2000 IF OVER
.
          ADD      ONE,F3                        * get next unique id
          PACK     KEY7,SIVACOD,F3,SP70
          UNPACK   KEY7,SIVBCOD,SIVBLIN
          CALL     DESIVB1                       * save data
          CALL     WRSIVB1
          GOTO     POWP1000
.
.---- delete extra wp data ----
.
POWP2000
          PREP     TEMPWORD,FILSIVB1             * delete temp file
          CLOSE    TEMPWORD
          PACK     KEY4,SIVACOD,SP70
          PACK     KEY7,KEY4,F3,SP70
          UNPACK   KEY7,SIVBCOD,SIVBLIN
.
POWP3000
          CALL     RSSIVB1                       * get next record
          CALL     RKSIVB1
          BRANCH   OVRCD,POWP9999
          PACK     KEY7,SIVBCOD,SIVBLIN,SP70
          MATCH    KEY7,KEY4
          GOTO     POWP9999 IF NOT EQUAL
          CALL     DESIVB1                       * delete extra record
          GOTO     POWP3000
.
POWP9999  RETURN
.----------------------------------------------------------------------
. Delete Data
.----------------------------------------------------------------------
DELT0000  MOVE      SP70,DISPMSG
          CALL      MESSAGE2
          CALL      DELQST
          CALL      MESSAGE3
          SUB       ONE,CEXIT
          BRANCH    CEXIT,DELT9999,DELT9999
.
          PACK      KEY4,SIVACOD,SP70  * write/update master record
          CALL      DESIVA1
          CALL      UUSIVA1
          CALL      DEWP0000           * DELT wp data
          GOTO      DELT9999
.
DELT9999  RETURN
.----------------------------------------------------------------------
. Delete WP Data
.----------------------------------------------------------------------
DEWP0000
          PREP      TEMPWORD,FILSIVB1            * delete temp file
          CLOSE     TEMPWORD
          PACK      KEY4,SIVACOD,SP70
          PACK      KEY7,KEY4,SP70
          UNPACK    KEY7,SIVBCOD,SIVBLIN
.
DEWP3000
          CALL      RSSIVB1                      * get next record
          CALL      RKSIVB1
          BRANCH    OVRCD,DEWP9999
          PACK      KEY7,SIVBCOD,SIVBLIN,SP70
          MATCH     KEY7,KEY4
          GOTO      DEWP9999 IF NOT EQUAL
          CALL      DESIVB1                      * delete extra record
          GOTO      DEWP3000
.
DEWP9999  RETURN
.----------------------------------------------------------------------
. Keyin and lock SIVA
.----------------------------------------------------------------------
KSIVA000  CALL      KSIVAA00                     * keyin code
          BRANCH    EXIT,KSIVA999,KSIVA999
.
          REPEAT
            CALL      RLSIVA1
            BRANCH    OVRCD,KSIVA999             * check if record exists
            IF        OVRCD=2
              PACK      DISPMSG,SP70,SP70
              CALL      MESSAGE2
              KEYIN     *P1:24,*EL,"Record Locked - (":
                        *V2LON,"R",*HOFF,")etry or e(":
                        *V2LON,"X",*HOFF,")it ? ",*V2LON,ANS
              CALL      MESSAGE3
              PACK      ANS,ANS,SP70
              REP       UPPLOW,ANS
              MATCH     "X",ANS
              GOTO      KSIVA000 IF EQUAL
              MATCH     "E",ANS
              GOTO      KSIVA000 IF EQUAL
            ENDIF
          UNTIL     OVRCD=0
.
          PACK      IBGSDESC,SP70
          PACK      KEY6,SIVAGST,SP70
          CALL      RDIBGS1
.
          MOVE      SIVAQTY,WHOLEQTY
.
          CALL      CALTAX00
          MOVE      ZERO,F12P4
          ASSIGN    SIVAGSTA*WHOLEQTY,F12P4
          MOVE      F12P4,TOTALGST
          MOVE      ZERO,F12P4
          ASSIGN    SIVAAMT*WHOLEQTY,F12P4
          MOVE      F12P4,TOTALCST
.
KSIVA999  RETURN
.----------------------------------------------------------------------
. Keyin DESC
.----------------------------------------------------------------------
KDESC000
          KEYIN     *PCCOL:CVERT,*V2LON,SIVADES
          PACK      SIVADES,SIVADES,SP70
          MATCH     SIVADES,SP70
          IF        @EQUAL
            MOVE      TWO,EXIT
          ELSE
            MOVE      ZERO,EXIT
          ENDIF
.
KDESC999  RETURN
EQTY0000  MOVE      SIVAQTY,WHOLEQTY
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,WHOLEQTY:
                    *PCCOL:CVERT
.
          IF        WHOLEQTY<0
            MOVE      "Quantity Must be Positive. - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      EQTY0000
          ENDIF
.
          MOVE      WHOLEQTY,SIVAQTY
.
          CALL      CALTAX00
          MOVE      ZERO,F12P4
          ASSIGN    SIVAGSTA*WHOLEQTY,F12P4
          MOVE      F12P4,TOTALGST
          MOVE      ZERO,F12P4
          ASSIGN    SIVAAMT*WHOLEQTY,F12P4
          MOVE      F12P4,TOTALCST
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SIVAGSTA,VAR
            CALL     DISPITEM
          ENDIF
.
          MOVE      "   26",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     TOTALGST,VAR
            CALL     DISPITEM
          ENDIF
.
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     TOTALCST,VAR
            CALL     DISPITEM
          ENDIF
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
.
EQTY9999  RETURN
.
.----------------------------------------------------------
. Enter Expected Unit Cost + GST
.----------------------------------------------------------
EPRIC000  MOVE      ZERO,SIVAAMT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          KEYIN     *PCCOL:CVERT,*V2LON,SIVAAMT
.
          IF        SIVAAMT<0
            BEEP
            GOTO      EPRIC000
          ENDIF
.
          CALL      CALTAX00
.
          MOVE      ZERO,F12P4
          ASSIGN    SIVAGSTA*WHOLEQTY,F12P4
          MOVE      F12P4,TOTALGST
          MOVE      ZERO,F12P4
          ASSIGN    SIVAAMT*WHOLEQTY,F12P4
          MOVE      F12P4,TOTALCST
.
EPRIC999  RETURN
.
CALTAX00  COMPARE   ZERO,SIVAAMT
          GOTO      CALTAX90 IF EQUAL
.
          MATCH     SP6,SIVAGST
          GOTO      CALTAX90 IF EQUAL
.
          PACK      KEY8,CCC,CYY,CMM,CDD,SP70
          REP       " 0",KEY8
.
          PACK      KEY14,SIVAGST,KEY8,SP70
          CALL      RDIBGE1
          COMPARE   ZERO,OVRCD
          GOTO      CALTAX10 IF EQUAL
.
          CALL      RPIBGE1
          BRANCH    OVRCD,CALTAX90
.
          MATCH     SIVAGST,IBGECODE
          GOTO      CALTAX90 IF NOT EQUAL
.
CALTAX10  ASSIGN    (SIVAAMT-(SIVAAMT/(ONE+(IBGEAMNT/HUNDRED)))),SIVAGSTA
          GOTO      CALTAX99
.
CALTAX90  MOVE      ZERO,SIVAGSTA
.
CALTAX99  RETURN

.----------------------------------------------------------
. Enter GST Code
.----------------------------------------------------------
EGST0000  MOVE      SP6,IBGSCODE
          CALL      KIBGSA00
          BRANCH    EXIT,EGST1000,EGST9999
.
EGST1000  MOVE      IBGSCODE,SIVAGST
.
          CALL      CALTAX00
          MOVE      ZERO,F12P4
          ASSIGN    SIVAGSTA*WHOLEQTY,F12P4
          MOVE      F12P4,TOTALGST
          MOVE      ZERO,F12P4
          ASSIGN    SIVAAMT*WHOLEQTY,F12P4
          MOVE      F12P4,TOTALCST
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SIVAGSTA,VAR
            CALL     DISPITEM
          ENDIF
.
          MOVE      "   26",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     TOTALGST,VAR
            CALL     DISPITEM
          ENDIF
.
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     TOTALCST,VAR
            CALL     DISPITEM
          ENDIF
.
          MOVE      "   23",FLDID
          CALL      GETPOSIT
.
EGST9999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       IBAGEDIO/INC
          INC       IBAGKIKY    
          INC       IBAGSTIO/INC
          INC       IBAGSTKY    
          INC       SINCCAIO/INC
          INC       SINCCAKY    
          INC       SINSUAIO/INC
          INC       SINSUAKY    
          INC       SINSVAIO/INC
          INC       SINSVAKY    
          INC       SINSVBIO/INC
.
          INC       STDGENCD
.

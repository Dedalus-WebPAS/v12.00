.************************************************************************
.*  Include  : DGCLICHD  -  Datagate Delete Health Concession Card      *
.*                                                                      *
.*  Author   : Steve Armstrong  (05/08/2004)                            *
.*                                                                      *
.*  Mods     :                                                          *
.*  V10.03.01 10/10/2013  Davin S          CAR 291578                   *
.*            Added dummy label rapmqpt1 as pmsqpt is not used here     *
.*  V9.08.01   05/01/2007  Steve Armstrong  CAR 130015                  *
.*             Mods to ignore CIS interface.                            *
.************************************************************************
.*  V9.04.01   07/07/2005  Davin            CAR 64087                   *
.*             Mods to handle CIS interface.                            *
.************************************************************************
          DEFPROC   DGCLICHD
.
          INC       HL7CISFD/INC
          INC       HL7INBFD/INC
          INC       PMSQCCFD/INC
.
CISMFLAG  FORM      1             * CIS message flag
.                                    0 = don't send HL7 CIS message
.                                    1 = send HL7 CIS message
IBAMFLAG  FORM      1             * IBA proprietary message flag
.                                    0 = don't send IBA proprietary message
.                                    1 = send IBA proprietary message
.
MESSAGID  DIM       20
.
DGCLI000  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*133,IBCNUCIS
          READ      CONTROLF,HUND03;*42,PTCNDGHD
.
          MOVE      ZERO,CISMFLAG                * set default interface flag
.
.         Not a relevant message for CIS interface
.
.         MATCH     "1",IBCNUCIS                 * using CIS interface ?
.         IF        @EQUAL
.             MOVE      ONE,CISMFLAG             * yes- set flag for CIS message
.         ENDIF
.
.         Check if we are sending a new Health Concession Card (addition)
.
          IF        PTCNDGHD <> 1 & CISMFLAG <> 1
            GOTO      DGCLI999
          ENDIF
.
.         We are sending IBA Proprietary and/or CIS HL7 messages, so
.         first open the relevant holding tables
.
          MOVE      ZERO,IBAMFLAG
          IF        PTCNDGHD = 1
            OPEN      HL7INB01,"hl7inbaf"
            MOVE      ONE,IBAMFLAG
          ENDIF
          IF        CISMFLAG = 1
            OPEN      HL7CISA1,"hl7cisaf"
          ENDIF
          OPEN      PMSQCCA1,"pmsqccaf"
.
          CALL      DGMESSID                     * Get Message ID
.
.         Write a record to pmsqccaf (holding concession card details)
.
          MOVE      MESSAGID,PMQCMESI
          PACK      PMQCSPAR,SP70,SP70
          CALL      WRPMQCC1
.
          COMPARE   ONE,PTCNDGHD                 * sending proprietary message?
          IF        @EQUAL
            MOVE      "CHD",H7INMETP
            CALL      WRINB000                   * yes - write hl7inbaf record
          ENDIF
.
          CLOSE     HL7CISA1
          CLOSE     HL7INB01
          CLOSE     PMSQCCA1
.
DGCLI999  GOTO      DGCLIEND
+
.         I/O Routines
.
RAPMQPT1  GOTO      OVERCOND                    * dummy for DGMESSID
.         
          INC       BRHLCOMN
.         
          INC       HL7CISIO/INC
          INC       HL7INBIO/INC
          INC       IBAOVRIO/INC
          INC       PMSQCCIO/INC
.
DGCLIEND  ENDPROC
+

. *----------------------------------------------------------------------
. * Include Name  :   PMSPHSTM.INC
. *
. * Function      :   variables for PMSPHSFD - pmsphsaf.dat
. *----------------------------------------------------------------------
.  Modifications Done :
.
.  V11.02.01  04/02/2022  Ebon Clements  TSK 0888071
.             Added PMPHS006 and PMPHS007
.  V10.02.00  09/06/2011  Jill Parkinson CAR 240715
.             Created include
. *----------------------------------------------------------------------
.
.------------------------------------------------------------
.clear cgi vars for Previous Hospital details file
.------------------------------------------------------------
CPPMHS00  MOVE      Z70,PMPHS001
          MOVE      Z70,PMPHS002
          MOVE      Z70,PMPHS003
          MOVE      Z70,PMPHS004
          MOVE      Z70,PMPHS005
          MOVE      Z70,PMPHS006
          MOVE      Z70,PMPHS007
.
CPPMHS99  RETURN
.------------------------------------------------------------
. Add Previous Hospital details file
.------------------------------------------------------------
PMHS0000  BRANCH    FLDITMNO,PMHS0100,PMHS0200,PMHS0300,PMHS0400,PMHS0500:
                             PMHS0600,PMHS0700,PMHS0800,PMHS0900,PMHS1000:
                             PMHS1100,PMHS1200
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMHS9999
.
PMHS0100  WRITE     HTMLFILE;PMPHADMN;
          GOTO      PMHS9999
.
PMHS0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     SP70,PMPHPHOS
          GOTO      PMHS9999 IF EQUAL
          BRANCH    F1,PMHS0210
.
          WRITE     HTMLFILE;PMPHPHOS;
          GOTO      PMHS9999
.
PMHS0210  PACK      KEY5,PMPHPHOS,SP70
          CALL      RDPTVAD1
          BRANCH    OVRCD,PMHS9999
.
          WRITE     HTMLFILE;PTVADESC;
          GOTO      PMHS9999
.
PMHS0300  MATCH     PMPHADAT,SP70
          GOTO      PMHS9999 IF EQUAL
          UNPACK    PMPHADAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMHS9999
.
PMHS0400  MATCH     PMPHDDAT,SP70
          GOTO      PMHS9999 IF EQUAL
          UNPACK    PMPHDDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMHS9999
.
PMHS0500  WRITE     HTMLFILE;PMPHLDAY;
          GOTO      PMHS9999
.
PMHS0600  MATCH     SP70,PMPHCUID
          GOTO      PMHS9999 IF EQUAL
.
          PACK      KEY10,PMPHCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMPHCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PMHS9999
.
PMHS0700  MATCH     PMPHUDAT,SP70
          GOTO      PMHS9999 IF EQUAL
.
          UNPACK    PMPHUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;

          GOTO      PMHS9999
.
PMHS0800  WRITE     HTMLFILE;PMPHUTIM;
          GOTO      PMHS9999
.
PMHS0900  MATCH     SP70,PMPHUUID
          GOTO      PMHS9999 IF EQUAL
.
          PACK      KEY10,PMPHUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMPHUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PMHS9999
.
PMHS1000  CALL      LSTPHS00
          GOTO      PMHS9999
.
PMHS1100  WRITE     HTMLFILE;PMPHINCB;
          GOTO      PMHS9999
.
PMHS1200  WRITE     HTMLFILE;PMPHINCC;
          GOTO      PMHS9999
.
PMHS9999  RETURN
+
.------------------------------------------------------------
.   Set Parameters for previous hospital details
.------------------------------------------------------------
SPPHS000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPPHS001,SPPHS002,SPPHS003,SPPHS004,SPPHS005:
                       SPPHS006,SPPHS007
.
          MOVE      ONE,EXIT
          GOTO      SPPHS999
.
SPPHS001  PACK      PMPHS001,QRYDATA,SP70
          GOTO      SPPHS999
.
SPPHS002  PACK      PMPHS002,QRYDATA,SP70
          GOTO      SPPHS999
.
SPPHS003  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PMPHS003,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PMPHS003
          GOTO      SPPHS999
.
SPPHS004  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PMPHS004,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PMPHS004
          GOTO      SPPHS999
.
SPPHS005  MOVE      QRYDATA,PMPHS005
          GOTO      SPPHS999
.
SPPHS006  MOVE      QRYDATA,PMPHS006
          GOTO      SPPHS999
.
SPPHS007  MOVE      QRYDATA,PMPHS007
          GOTO      SPPHS999
.
SPPHS999  RETURN
+
.------------------------------------------------------------
.  Update previous admission details
.------------------------------------------------------------
MVPMPH00  MATCH     PMPHS001,Z70
          IF        !@EQUAL
            MOVE      PMPHS001,PMPHADMN
          ENDIF
.
          MATCH     PMPHS002,Z70
          IF        !@EQUAL
            MOVE      PMPHS002,PMPHPHOS
          ENDIF
.
          MATCH     PMPHS003,Z70
          IF        !@EQUAL
            MOVE      PMPHS003,PMPHADAT
          ENDIF
.
          MATCH     PMPHS004,Z70
          IF        !@EQUAL
            MOVE      PMPHS004,PMPHDDAT
          ENDIF
.
          MATCH     PMPHS005,Z70
          IF        !@EQUAL
            MOVE      PMPHS005,PMPHLDAY
          ENDIF
.
          MATCH     PMPHS006,Z70
          IF        !@EQUAL
            MOVE      PMPHS006,PMPHINCB
          ENDIF
.
          MATCH     PMPHS007,Z70
          IF        !@EQUAL
            MOVE      PMPHS007,PMPHINCC
          ENDIF
.
MVPMPH99  RETURN
+
.------------------------------------------------------------
. List Previous Admissions
.------------------------------------------------------------
LSTPHS00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          PACK      KEY29,ADMISSNO,SP20
          CALL      RSPMPHS1
LSTPHS10  CALL      RKPMPHS1
          BRANCH    OVRCD,LSTPHS99
.
          MATCH     ADMISSNO,PMPHADMN
          GOTO      LSTPHS99 IF NOT EQUAL
.
LSTPHS80  UNPACK    PMPHADAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISADATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    PMPHDDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISDDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          PACK      KEY5,PMPHPHOS,SP70
          CALL      RDPTVAD1
          IF        OVRCD=1
            MOVE      SP70,PTVADESC
          ENDIF
.
          REP       " +",DISADATE
          REP       " +",DISDDATE
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:":
                             "UpdatePrevious": 
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO:
                             "&pmphs001=",PMPHADMN:
                             "&pmphs002=",PMPHPHOS:
                             "&pmphs003=",DISADATE:
                             "&pmphs004=",DISDDATE,"#")'>";
          REP       "+ ",DISADATE
          REP       "+ ",DISDDATE
          WRITE     HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTVADESC,"</td>":
                             "<td>",DISADATE,"</td>":
                             "<td>",DISDDATE,"</td>":
                             "<td>",PMPHLDAY,"</td>":
                             "<td><input type=button value=#"Delete #"":
                             " onclick='DeletePrevious(#"":
                             PMPHADMN,"#",#"",DISADATE:
                             "#",#"",DISDDATE,"#",#"",PMPHPHOS,"#");'></td>":
                             "</tr>" 
          GOTO      LSTPHS10
.
LSTPHS99  RETURN
.
.------------------------------------------------------------
.  Clear  previous admission details file variables
.------------------------------------------------------------
CLPMSPHS  PACK      PMPHADMN,SP70
          PACK      PMPHPHOS,SP70
          PACK      PMPHADAT,SP70
          PACK      PMPHDDAT,SP70
          PACK      PMPHLDAY,SP70
          PACK      PMPHCUID,SP70
          PACK      PMPHCDAT,SP70
          PACK      PMPHCTIM,SP70
          PACK      PMPHUUID,SP70
          PACK      PMPHUDAT,SP70
          PACK      PMPHUTIM,SP70
          PACK      PMPHINCB,SP70
          PACK      PMPHINCC,SP70
.
          RETURN 
+


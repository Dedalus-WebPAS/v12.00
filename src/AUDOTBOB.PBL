.*****************************************************************************
.*                                AUDOTBOB                                   *
.*  Write an audit record to outaudbb for an O/P Booking B record (outbb1af) *
.* Requires: Read of HOAUDB (Sector 31, Posn 52)                             *
.*           AUDIFLAG - audit type record flag                               *
.*                      1 = add record                                       *
.*                      2 = before change record                             *
.*                      3 = after change record                              *
.*                      4 = delete record                                    *
.*           Relevant READ or setting of the outbokaf variables.             *
.*           IDDD - O/P site code                                            *
.*****************************************************************************
.
AUDOTBOB  BRANCH    HOAUDB,OTBOB999              * outbb1af audits turned off
.
          COMPARE   THREE,AUDIFLAG               * after change record ?
          GOTO      OTBOB200 IF EQUAL            * yes
.
          CALL      IBACLOCK                     * get current date
          PACK      OTBBAUDD,CCC,CYY,CMM,CDD
          REP       " 0",OTBBAUDD
          MOVE      CTIMEIS,OTBBAUDT             * set current time
          MOVE      ONE,OTBBAUDS                 * set print status
          MOVE      PASSCODE,OTBBAUDO            * get user ID
          MOVE      PORT,OTBBAUDP                * get port number
.
OTBOB200  MOVE      AUDIFLAG,OTBBAUDR
          REPLACE   "1A2B3C4D",OTBBAUDR
          PACK      KEY19,OTBBAUDD,OTBBAUDT,OTBBAUDP,OTBBAUDR
          MOVE      IDDD,OTBBSITE
          CALL      AWOTBOB                      * write audit record
.
OTBOB999  RETURN
+

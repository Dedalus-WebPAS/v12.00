. *----------------------------------------------------------------------
. * Include Name  :   PMSPODTM.INC
. *
. * Function      :   CGI variables for PMSPODFD - pmspodaf.dat
. *----------------------------------------------------------------------
.  Modifications Done :
.
. V10.00.01   07/04/2010  Davin         CAR 200414
.             Added pmpod007 to display 70 chars of comment line (pmpo1700)
.  V9.11.01   17/12/2008  Peter McMullen CAR 185473
.             Add new tag for adverse outcome select list
.  V9.09.00   03/12/2007  Jill Habasque  CAR 153381
.             Created include
. *----------------------------------------------------------------------
.
.------------------------------------------------------------
.clear cgi vars for patient adverse outcome details file
.------------------------------------------------------------
CPPMPO00  MOVE      Z70,PMPOD001
          MOVE      Z70,PMPOD002
          MOVE      Z70,PMPOD003
          MOVE      Z70,PMPOD004
          MOVE      Z70,PMPOD005
          MOVE      Z70,PMPOD006
.
CPPMPO99  RETURN
.------------------------------------------------------------
. Output Patient outcome  details file
.------------------------------------------------------------
PMPO0000  BRANCH    FLDITMNO,PMPO0100,PMPO0200,PMPO0300,PMPO0400,PMPO0500:
                             PMPO0600,PMPO0700,PMPO0800,PMPO0900,PMPO1000:
                             PMPO1100,PMPO1200,PMPO1300,PMPO1400,PMPO1500:
                             PMPO1600,PMPO1700,PMPO1800,PMPO1900
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMPO9999
.
PMPO0100  WRITE     HTMLFILE;PMPOVISN;
          GOTO      PMPO9999
.
PMPO0200  WRITE     HTMLFILE;PMPOCODE;
          GOTO      PMPO9999
.
PMPO0300  WRITE     HTMLFILE;PMPOOCNT;
          GOTO      PMPO9999
.
PMPO0400  WRITE     HTMLFILE;PMPOGRAD;
          GOTO      PMPO9999
.
PMPO0500  WRITE     HTMLFILE;PMPODELT;
          GOTO      PMPO9999
.
PMPO0600  WRITE     HTMLFILE;PMPOUNIQ;
          GOTO      PMPO9999
.
PMPO0700  PACK      KEY10,PMPOWEBC,SP70
          CALL      RDWBSE1
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PMPO9999
.
PMPO0800  MATCH     PMPODATC,SP70
          GOTO      PMPO9999 IF EQUAL
          UNPACK    PMPODATC,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMPO9999
.
PMPO0900  WRITE     HTMLFILE;PMPOTIMC;
          GOTO      PMPO9999
.
PMPO1000  PACK      KEY10,PMPOWEBU,SP70
          CALL      RDWBSE1 
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PMPO9999
.
PMPO1100  MATCH     PMPODATU,SP70
          GOTO      PMPO9999 IF EQUAL
          UNPACK    PMPODATU,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMPO9999
.
PMPO1200  WRITE     HTMLFILE;PMPOTIMU;
          GOTO      PMPO9999
.
PMPO1300  CALL      LISAD000
          GOTO      PMPO9999
.
PMPO1400  CALL      NEXTPR00     * Link to Next Set of Codes
          GOTO      PMPO9999
.
PMPO1500  CALL      PREVPR00     * Link to Prev Set of Codes
          GOTO      PMPO9999
.
PMPO1600  WRITE     HTMLFILE;CASEUNIQ;
          GOTO      PMPO9999
.
PMPO1700  PACK      KEY14,ADMISSNO,PMPOD003,SP3
          CALL      RSPMOCM1
PMPO1710  CALL      RKPMOCM1
          BRANCH    OVRCD,PMPO9999
          MATCH     ADMISSNO,PMOCVISN
          GOTO      PMPO9999 IF NOT EQUAL
          MATCH     PMPOD003,PMOCOCNT
          GOTO      PMPO9999 IF NOT EQUAL
          MOVE      PMOCLINE,PMPOD007            * display 70 chars
          WRITE     HTMLFILE;PMPOD007;
          GOTO      PMPO1710
.
PMPO1800  MATCH     SP70,PMPOCODE
          GOTO      PMPO9999 IF EQUAL
          PACK      KEY6,PMPOCODE,SP70
          CALL      RDPMPOD1
          BRANCH    OVRCD,PMPO9999
          WRITE     HTMLFILE;PMACDESC;
          GOTO      PMPO9999
.
PMPO1900  PACK      KEY6,SP70 
          CALL      RSPMADC1
PMPO1902  CALL      RKPMADC1
          BRANCH    OVRCD,PMPO9999
.
          MATCH     "1",PMACINAC                 * is this inactive?
          GOTO      PMPO1902 IF EQUAL
.
          WRITE     HTMLFILE;*+,"<option value=#"",PMACCODE,"#">":
                             PMACCODE,", ",PMACDESC,"</option>"
          GOTO      PMPO1902 
.
.       
PMPO9999  RETURN
.
.------------------------------------------------------------
.   Set Parameters for patient outcome details table
.------------------------------------------------------------
SPPOD000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPPOD001,SPPOD002,SPPOD003,SPPOD004,SPPOD005:
                       SPPOD006
.
          MOVE      ONE,EXIT
          GOTO      SPPOD999
.
SPPOD001  PACK      PMPOD001,QRYDATA,SP70
          GOTO      SPPOD999
.
SPPOD002  PACK      PMPOD002,QRYDATA,SP70
          GOTO      SPPOD999
.
SPPOD003  PACK      PMPOD003,QRYDATA,SP70
          GOTO      SPPOD999
.
SPPOD004  PACK      PMPOD004,QRYDATA,SP70
          GOTO      SPPOD999
.
SPPOD005  PACK      PMPOD005,QRYDATA,SP70
          GOTO      SPPOD999
.
SPPOD006  PACK      PMPOD006,QRYDATA,SP70
          GOTO      SPPOD999
.
SPPOD999  RETURN  
.
.------------------------------------------------------------
.  Update patient outcome details file
.------------------------------------------------------------
MVPMPO00  MATCH     PMPOD001,Z70
          IF        !@EQUAL
            MOVE      PMPOD001,PMPOVISN
          ENDIF
. 
          MATCH     PMPOD002,Z70
          IF        !@EQUAL
            MOVE      PMPOD002,PMPOCODE
          ENDIF
.
          MATCH     PMPOD003,Z70
          IF        !@EQUAL
            MOVE      PMPOD003,PMPOOCNT 
          ENDIF
.
          MATCH     PMPOD004,Z70
          IF        !@EQUAL
            MOVE      PMPOD004,PMPOGRAD
          ENDIF
.
          MATCH     PMPOD005,Z70
          IF        !@EQUAL
            MOVE      PMPOD005,PMPODELT
          ENDIF
.
          MATCH     PMPOD006,Z70
          IF        !@EQUAL
            MOVE      PMPOD006,PMPOUNIQ
          ENDIF
.
MVPMPO99  RETURN
.
.------------------------------------------------------------
.  Clear patient outcome details variables 
.------------------------------------------------------------
CLPMSPOD  PACK      PMPOVISN,SP70
          PACK      PMPOCODE,SP70
          PACK      PMPOOCNT,SP70
          PACK      PMPOGRAD,SP70
          PACK      PMPODELT,SP70
          PACK      PMPOUNIQ,SP70
          PACK      PMPOWEBC,SP70
          PACK      PMPODATC,SP70
          PACK      PMPOTIMC,SP70
          PACK      PMPOWEBU,SP70
          PACK      PMPODATU,SP70
          PACK      PMPOTIMU,SP70
.
          RETURN
+

.------------------------------------------------------------------------------
.               Adverse Outcomes List
.------------------------------------------------------------------------------
.LISAD000  UNPACK    DIM127,D1,LINKPRG,DIM127
.          UNPACK    DIM127,D1,LINKREP,DIM127
.          UNPACK    DIM127,D1,LINKTEM,DIM127
..
.          CALL      AOHED000      * Output Table Heading
..
.          IF        NORECORD=0
.            MOVE      "10",NORECORD       * Set Default No Records to Display
.          ENDIF
.          MOVE      ZERO,RECNUMB
.          MOVE      ZERO,DISNUMB
..
.          PACK      KEY6,STARTKEY,SP70
.          CALL      RSPMADC1
.LISAD100  CALL      RKPMADC1
.          BRANCH    OVRCD,LISAD999
..
.          ADD       ONE,RECNUMB
.          IF        STARTNUM>=RECNUMB
.            GOTO      LISAD100
.          ENDIF
..
.          CALL      ADORW000    * Display Table Details Row
.          ADD       ONE,DISNUMB
.          COMPARE   NORECORD,DISNUMB
.          GOTO      LISAD100 IF NOT EQUAL
..
.LISAD999  RETURN
..------------------------------------------------------------
.. Adverse Outcome Table Details (TABLE HEADING)
..------------------------------------------------------------
.AOHED000  WRITE     HTMLFILE;"<tr>":
...                               "<td class=HeadingCell>":
.                               "Code</td>":
..                               "<td class=HeadingCell>":
.                               "Description</td>":
.                             "</tr>"
..
.AOHED999  RETURN
..------------------------------------------------------------
.. Adverse Outcome Table Details  (TABLE ROW)
..------------------------------------------------------------
.ADORW000  WRITE     HTMLFILE;"<tr><td nowrap>":
.                             "<A HREF='javascript:ShowDetail":
.                             "(#"",LINKPRG,"#.pbl":
.                             "?reportno=",LINKREP:
.                             "&template=",LINKTEM:
.                             "&pmadc001=",PMACCODE,"#")'>":
.                             "<img src=../images/MaintenanceIcon.gif ":
.                             "hspace=4 border=0 align=absmiddle></a>":
.                             PMACCODE,"</td>":
.                             "<td>",PMACDESC,"</td>":
.                             "</tr>";
..
.ADORW999 RETURN
..
.-----------------------------------------------------------
.. Link to Next Group Codes
..-----------------------------------------------------------
.NEXTPR00  MOVE      NORECORD,KEY2
.          REP       " +",KEY2
.          ASSIGN    STARTNUM+NORECORD,F3
.          MOVE      F3,KEY3
.          REP       " +",KEY3
.          UNPACK    DIM127,D1,FLDPARA,DIM127
.          MOVE      REPORTNO,F1
..
.          WRITE     HTMLFILE;"patweb07.pbl":
.                                 "?reportno=",F1:
.                                 "&template=",FLDPARA:
.                                 "&startnum=",KEY3:
.                                 "&norecord=",KEY2:
.                                 "&startkey=",STARTKEY;
..
.NEXTPR99  RETURN
..-----------------------------------------------------------
.. Link to Prev Group Codes
..-----------------------------------------------------------
.PREVPR00  MOVE      NORECORD,KEY2
.          REP       " +",KEY2
.          ASSIGN    STARTNUM-NORECORD,F3
.          IF        F3<0
..            MOVE      ZERO,F3
.          ENDIF
.          MOVE      F3,KEY3
.          REP       " +",KEY3
.          UNPACK    DIM127,D1,FLDPARA,DIM127
.          MOVE      REPORTNO,F1
..
.          WRITE     HTMLFILE;"patweb07.pbl":
.                                 "?reportno=",F1:
..                                 "&template=",FLDPARA:
.                                 "&startnum=",KEY3:
.                                 "&norecord=",KEY2:
.                                 "&startkey=",STARTKEY;
..
......PREVPR99  RETURN

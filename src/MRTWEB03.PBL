.-----------------------------------------------------------------------------
. Program       : MRTWEB03
.
. Function      : Medical Records Coding Extract
.
. Modifications : 
.-----------------------------------------------------------------------------
. V12.00.02 19/08/2025  Bella Turco      TSK 0961695
.           Recompiled for MRTREXTM                                       
. V12.00.01 17/06/2025  Thanh T          TSK 0961623
.           Changed ADDEXT00 to fix issue with duplicate key written out
. V11.05.02 13/03/2025  Thanh T          TSK 0949724
.           Added EXTD0360 and EXTD0370
. V11.05.01 06/03/2025  Thanh T          TSK 0949724
.           Commented out CLMRTEXT clear function to use the generated
.           CLMRTEXT.PBL
. V11.03.02 09/01/2023  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.03.01 02/12/2022  Bella Turco    TSK 0904613
.           At end of RESTB000 & RRBDT000 routines changed ending GOTO to
.           XXXXX150 instead of XXXXX100
. V11.02.01 26/07/2022  Bella Turco    TSK 0922313
.           Added URGYCODE - Urgency Code Description (RESTB000)
.           Changed TDESC to URGYCODE in addRow() opt 8 in RESTB000 & RRBDT000
. V11.00.01 17/12/2020  Davin          TSK 0892763 CrossBrowser
.           Added single quotes to Patient Research Extract output (RESROW00)
. V10.11.02 11/09/2017  Thanh T.        TSK 0821710
.           Audit Amission/outpatient visit comments. Removed PATCOMFD/IO
. V10.11.01 07/08/2017  Davin           TSK 0842626
.           Added output of new WIES 24 fields (tags WIEW2000/WIEW2100)
.           Added option 9 - Restricted Diagnosis Codes for Grouping (PATRDC00)
.-----------------------------------------------------------------------------
. V10.10.01 07/04/2017  Peter Vela      TSK 0833050
.           Added Patient Sex Other to EXTD0310
. V10.06.01 09/04/2015  J.Tan           CAR 304813
.           Added WIES (Weights)
. V10.05.01 13/08/2014  Don Nguyen      CAR 299099
.           Added new FLDITMNO's to MRUT0000 for Required Date filtered view
.-----------------------------------------------------------------------------
. V10.04.01 31.03.2014  B.G.Ackland     CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
.-----------------------------------------------------------------------------
. V10.03.03 30/01/2012  Mike Laming     CAR 259106
.           Mods to use PTHSRCTY instead of MRCNRCTY in "Red" Hospital fields.
. V10.03.02 08/12/2011  Mike Laming     CAR 248696
.           More mods to Red or Black Hospital Id (Added Cat TY test)
. V10.03.01 05/12/2011  Mike Laming     CAR 248698 
.           Remove my "testing SUPERLEV" switch
. V10.02.05 16/09/2011  Mike Laming     CAR 248698 
.           Mods to RESTB000 to set Red hospital Id if not Home Hospital
. V10.02.04 12/09/2011  Mike Laming     CAR 240724 
.           Mods to "Hospital (of visit)" with MREXVHOS and MRTEX032   
. V10.02.03 06/07/2011  Mike Laming     CAR 240724 
.           Mods to MRT Table Keys for WA Health (add Hospital Id.)            
. V10.02.02 28/06/2011  Peter McMullen  CAR 240725 
.           Change ward election list to sort by name, not coee                
. V10.02.01 24/03/2011  Mike Laming   CAR 240107 
.           Change length of Indexes for PATECDaf and PATECOaf - Alter KEYs
. V10.01.01 13/01/2011 Jill Parkinson CAR 233088
.           Added pmsvx1af
. V9.08.04  08/05/2007  Mike Laming  CAR 137125 HDP 2007 DRG 5.2
.           Mods to PATDGWFD - Add field PTDWDRGV (add to Keys) 
. V9.08.03  19/02/2007  Neelkamal Pyla CAR 129493
.           Added code to RESTB000 to filter records based on Request Number
. V9.08.02  25/01/2007  Peter Vela CAR 127930
.           Recompiled for MRTMASFD
. V9.08.01  31/01/2007  Peter Vela    CAR 127930
.           Recompled for MRTRQHFD
. V9.07.01  11/09/2006  Peter Vela    CAR 118227
.           Added Admission Type and Admission Class
. V9.06.01  18/05/2006  Ebon Clements CAR 105051
.           Mods for multi hospital ward selection list
. V9.05.02  17/03/2006  Ebon Clements CAR 89155
.           Mods for multi hospital medical record locations
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.03  20/05/2005  Jill Habasque CAR 59013
.           Added home location and document type filters
. V9.04.02  17/09/2004  Guomin Fu     CAR 51445
.           Added in GTRQX000 to check PTCNRQCF for whether to use
.           staff code or free format for requester. If set to using free format
.           then allows ext.no and pager no. to be displayed even requester
.           field is empty.
. V9.04.01  30/08/2004  Jill Habasque CAR 54036
.           Added hospital code
. V9.03.10  11/06/2004  Mike Laming   CAR 49016  July 2004 PRS/2
.           Re-try - it got away too soon
. V9.03.09  11/06/2004  Mike Laming   CAR 49016  July 2004 PRS/2      
.           - Add Sex Description routine SEXDSC00 with Code "R" - "Intersex"
. V9.03.08  20/04/2004 Henry Son                 CAR 44792
.           Display Extension and Pager in Movement History.
. V9.03.07  26/03/2004 Peter Vela                CAR 13038
.           Recompiled for PATDOCCD - Doctor Name format Parameter
. V9.03.06  03/02/2004 pat Dirito                CAR 45718
.           RESTB000 now outputting patient details 
. V9.03.05  29/01/2004 Sylvek Litewka            CAR 46998
.           Fixed display tags in LSTDET00 - (missing ';' at the end of write
.           htmlfile statements).
. V9.03.04  23/12/2003 Pat Dirito                CAR 44742
.           Added Option 7 - WIES Dollar Value Maintenance
.           02/12/2003 Sylvek Litewka            CAR 20222
.           Modified section GTDIAG00 to remove reads of ICD9 and ICD10 files.
.           These are no longer needed as description is obtained from patecdaf.
.           Modified INIT0000 to use OPICD1 and OPICO1 to open ICD files.
.           11/12/2003 Peter Vela                CAR 40355
.           Recompiled for PATNAMCD
. V9.03.03  07/11/2003 Sylvek Litewka            CAR 44328
.           Recompiled for PATECDFD changes.
. V9.03.02  12/09/2003 Pat Dirito                CAR 43132
.           Added PTCNRQCF - Free Format for Requested By
. V9.03.01  12/08/2003  Sylvek Litewka           CAR 41293
.           Removed FD, IO and OPEN of webschaf. These are now included in
.           IBAWEBDF.PBL and IBAWEBCD.PBL.
.-----------------------------------------------------------------------------
. V9.02.10  21/11/2002  Pat Dirito               SRF 33644
.           Fixed read of PTCNI10D was reading incorrect position
. V9.02.09  01.07.2001 Pat Dirito                SRF 19036 
.           Fixed MRTRES00, MRTREL00 & RESROW00 routines                  
. V9.02.08  11.12.2001 Pat Dirito          
.           Changed Coding Extract Patient List to output PATECDFD Disease Code.
. V9.02.07  22.11.2001 Raghunandan Surve
.           Recompiled for MRTREXFD - Block Number, DRG
. V9.02.06  19.10.2001 Ebon Clements
.           Recompiled for MRTREXFD - Exclude visit types
. V9.02.05  17.10.2001 Ebon Clements
.           Recompiled for MRTREXTM - Age a birth display       
. V9.02.04  10.10.2001 Ebon Clements
.           Removed diagnosis description from research extract
.           Mods to display U/R on Coding Extract Edit Patient
. V9.02.03  17.09.2001 J.Tan
.           Mods to display U/R on Research Extract Edit Patient
. V9.02.02  06.09.2001 J.Tan
.           Recompile for MRTREXTM
. V9.02.01  31.08.2001 J.Tan
.           Fixed M/R Research extract list
. V9.00.B05 29.06.2001 B.G.Ackland
.           Recompile for WEBRSHFD
. V9.00.B04 18.05.2001 Ebon Clements 
.           Added total records selected for research Ext
. V9.00.B02 17.05.2001 Ebon Clements 
.           Added primary disease coding only for research Ext
. V9.00.B01 16.05.2001 Ebon Clements 
.           Fixed heading details for report 4              
. V5.10.B03 30.04.2001 Ebon Clements 
.           Added report 4 Patient Records Research Extract
. V5.10.B02 03.04.2001 B.G.Ackland
.           Move Remote Scripting to Option 3
. V5.10.B01 07/03/2001 J.Tan
.           Added demographic details
. V5.09.B02 10.01.2001 K.C.Nelson   
.           Rebound fixes from QA 
. V5.08.00 16.10.2000 K.C.Nelson   
.          Created Program
.
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       MRTEPSFD/INC
          INC       MRTEXTFD/INC
          INC       MRTTHDFD/INC
          INC       PATCALAG/INC  
          INC       PATCONFD/INC
          INC       PATDO1FD/INC
          INC       PATDGWFD/INC
          INC       PATDSCFD/INC
          INC       PATECDFD/INC
          INC       PATICUFD/INC
          INC       PATMA1FD/INC
          INC       PMSPX2FD/INC
          INC       PATMI1FD/INC
          INC       PMSVX1FD/INC
          INC       PATHSPFD/INC
          INC       PATWR1FD/INC
.
          INC       PATALRFD/INC
          INC       PATVISFD/INC   * Patients Visits File
          INC       OUTSITFD/INC
          INC       PATFN1FD/INC
          INC       PATPR1FD/INC
          INC       MRTMASFD/INC
          INC       MRTREXFD/INC
          INC       MRTREXTD/INC
          INC       MRTLOCFD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       PMSWDVFD/INC
          INC       PATRDCFD/INC
          INC       PATWIEFD/INC
          INC       MRTREDFD/INC
          INC       MRTRQDFD/INC
          INC       MRTRQHFD/INC
          INC       MRTMOVFD/INC
          INC       MRTSTFFD/INC
          INC       MLTSECFD/INC
          INC       WATPROFD/INC
.         
.----------------------------------------------------------------------------
.
DIAGNSIS  DIM       85     * Diagnosis Code / Description
DIM3      DIM       3
DIM4      DIM       4
DIM7A     DIM       7
DIM7B     DIM       7
DISPDATE  DIM       11     * Display Discharge Date
DFLTWARD  DIM       3      * Setup default ward
DOCTCODE  DIM       6      * Doctor Code
DOCUTYPE  DIM       3      * Document Type
BYREQDAT  FORM      1      * Filter by Required Date (0=No 1=Yes)
MRCNHMTY  DIM       3      * Type Code for Home Location
MRCNRCTY  DIM       3      * Default record type
EXTRTYPE  FORM      1      * Extract Type 1 =MR 2 = Research
EXTNTXT   INIT      "<br>Ext: "             * extention break text     *I-44792
FILLSTAT  DIM       10    
HOSPID01  DIM       50
HLOCDSC1  DIM       50
SELHOSP   DIM       3
SUPERLEV  DIM       1
STARTKEY  DIM       25       * Starting Key
.
FORM3     FORM      3
FORM8     FORM      8
HOMEHOSP  DIM       3      * Home Hospital                            *I-240724
HOMELOCT  DIM       4      * Home Location
.
RECTOTAL  FORM      5      * Total rexords in extract
MRTEX001  DIM       4      * Extract ID
MRTEX002  DIM       35     * Description
MRTEX003  DIM       8      * Discharge Date From
MRTEX004  DIM       8      * Discharge Date To
MRTEX005  DIM       8      * Admission Date From
MRTEX006  DIM       8      * Admission Date To
MRTEX007  DIM       3      * Unit 
MRTEX008  DIM       3      * Ward
MRTEX009  DIM       3      * Prcocedure Group
MRTEX010  DIM       3      * Waiting List Procedure
MRTEX011  DIM       6      * Consultant 
MRTEX012  DIM       1      * Include Deceased
MRTEX013  DIM       4      * Automatic Coding Template
MRTEX014  DIM       5      * Number of Records Extracted
MRTEX015  DIM       1      * Extract in Progress Indicator   
MRTEX016  DIM       3      * Analysis Level 1
MRTEX017  DIM       3      * Analysis Level 2
MRTEX018  DIM       3      * Analysis Level 3
MRTEX019  DIM       3      * Analysis Level 4
MRTEX020  DIM       3      * Analsysis Measures 1
MRTEX021  DIM       3      * Analsysis Measures 2
MRTEX022  DIM       3      * Analsysis Measures 3
MRTEX023  DIM       4      * Provisional DRG
MRTEX024  DIM       4      * Discharge Patients Only indicator
MRTEX025  DIM       1      * Sameday discharged
MRTEX026  DIM      35      * Suburb
MRTEX027  DIM       8      * Postcode
MRTEX028  DIM       1      * Sex
MRTEX029  DIM       3      * Country of birth
MRTEX030  DIM       3      * Admission Type
MRTEX031  DIM       3      * Admission Class
MRTEX032  DIM       3      * Hospital Id.    
MRTEX033  DIM       3      * Unplanned Return To Theatre     
.
MRTEP001  DIM       4      * Extract ID
MRTEP002  DIM       8      * Visit Number
MRTEP003  DIM       1      * Delete from extract indicator
.
PMSWD001  DIM       8      * WIES Dollar Effective Date
PMSWD002  FORM      8      * WIES Dollar Value
.
PATRD001  DIM       9      * ICD 10 Restricted Diagnosis Code
PATRD002  DIM      70      * ICD 10 Restricted Diagnosis Description
PATRD003  DIM       2      * ICD 10 Restricted Diagnosis Version
.
PATWI001  DIM       4      * WIES Weight DRG Code
PATWI002  DIM       3      * WIES Version Number
.
NEXTPAGE  DIM       1      * Next page parameter 
.
PAGERTXT  INIT      "<br>Pager: "           * page break text          *I-44792
PRESDETS  DIM       100                     * Person Resp details      *I-44792
PSAGETYP  DIM       6      * age type description
PSAGECON  DIM       3      * age converted value
.
.
UPDTTYPE  DIM       1      * Update Type
URGYCODE  DIM       20     * Urgency Code Description
.
OBB       INIT      "("
CBB       INIT      ")"
OBR       INIT      "<font color=red>("
CBR       INIT      ")</font>"
DIM8      DIM       8
CATAC     INIT      "AC"
CATTY     INIT      "TY"
CATWG     INIT      "WG"
LAST      INIT      "999"
.
.----------------------------------------------------------------------------
PRGID     INIT      "MRTWEB03"
VERSION   INIT      "V12.00.02"
PRGNAM    INIT      "Medical Records Coding Extract"
.----------------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400:
                             MAIN1500,MAIN1600,MAIN1700,MAIN1800:
                             MAIN1900
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      MRTEXT00     * Medical Records Extract Criteria Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      MRTEPS00     * Medical Records Extract Patient List
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      DELPAT00     * Delete Patient From List
          GOTO      MAIN1000
.
MAIN1400  CALL      MRTRES00     * Patient Records Research Extract
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      MRTREL00     * Research Extract Patient List
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      MRTUSR00     * Medical Reservations for a User
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      PMSWDV00     * WIES Dollar Value Maintenance  
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      PATWIE00     * WIES Cost Weights
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1900  CALL      PATRDC00     * Restricted Diagnosis Codes for Grouping
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      MRTRQHR2,"mrtrqhaf"
          OPEN      MRTRQHR4,"mrtrqhaf"
          OPEN      MRTLOCA1,"mrtlocaf" 
          OPEN      MRTMOVA1,"mrtmovaf" 
          OPEN      MRTRQDR1,"mrtrqdaf"
          OPEN      MRTEPSA1,"mrtepsaf"
          OPEN      MRTEXTA1,"mrtextaf" 
          OPEN      MRTTHDR1,"mrtthdaf"
          OPEN      MRTSTFA1,"mrtstfaf"
          OPEN      PATCODE1,"patcodes" 
          OPEN      PATCODE2,"patcodes" 
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATECDA1,"patecdaf"
          OPEN      PATICUA1,"paticuaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATWR1A1,"patwr1af" 
          OPEN      PATWR1A7,"patwr1af" 
          OPEN      MRTREXA1,"mrtrexaf"
          OPEN      MRTLOCA1,"mrtlocaf"
          OPEN      MRTREDA1,"mrtredaf"
          OPEN      MRTREDA3,"mrtredaf"
          OPEN      MRTMASA1,"mrtmasaf"
          OPEN      MRTMASA2,"mrtmasaf"
          
          OPEN      PMSWDVA1,"pmswdvaf"
          OPEN      PATRDCA1,"patrdcaf"
          OPEN      PATWIEA1,"patwieaf"
          OPEN      MLTSECA1,"mltsecaf"
          OPEN      WATPROA1,"watproaf"
.
          CALL      OPICD1
          CALL      OPICO1
.
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
.
          READ      CONTROLF,FIFTY9;*193,PTCNRQCF
          READ      CONTROLF,SIXTY;*88,MRCNRCTY,*105,MRCNHMTY
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,EIGHTY8;*59,PTCNI10D
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          MOVE      ZERO,VIEWTYPE
          MOVE      SP70,VYEARMTH
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      ZERO,BYREQDAT
          PACK      REDIRECT,SP70,SP70,SP70,SP70
.
          MOVE      Z70,MRTEX001
          MOVE      Z70,MRTEX002
          MOVE      Z70,MRTEX003
          MOVE      Z70,MRTEX004
          MOVE      Z70,MRTEX005
          MOVE      Z70,MRTEX006
          MOVE      Z70,MRTEX007
          MOVE      Z70,MRTEX008
          MOVE      Z70,MRTEX009
          MOVE      Z70,MRTEX010
          MOVE      Z70,MRTEX011
          MOVE      Z70,MRTEX012
          MOVE      Z70,MRTEX013
          MOVE      Z70,MRTEX014
          MOVE      Z70,MRTEX015
          MOVE      Z70,MRTEX016
          MOVE      Z70,MRTEX017
          MOVE      Z70,MRTEX018
          MOVE      Z70,MRTEX019
          MOVE      Z70,MRTEX020
          MOVE      Z70,MRTEX021
          MOVE      Z70,MRTEX022
          MOVE      Z70,MRTEX023
          MOVE      Z70,MRTEX024
          MOVE      Z70,MRTEX025
          MOVE      Z70,MRTEX026
          MOVE      Z70,MRTEX027
          MOVE      Z70,MRTEX028
          MOVE      Z70,MRTEX029
          MOVE      Z70,MRTEX030
          MOVE      Z70,MRTEX031
          MOVE      Z70,MRTEX032
          MOVE      Z70,MRTEX033
          MOVE      Z70,MRTEP001
          MOVE      Z70,MRTEP002
          MOVE      Z70,MRTEP003
          MOVE      ZERO,EXTRTYPE
          MOVE      SP1,SUPERLEV
.
          MOVE      SP70,PMSWD001
          MOVE      ZERO,PMSWD002
.
          MOVE      SP70,HOMEHOSP                                     *I-240724
          MOVE      SP70,HOMELOCT
          MOVE      SP70,DOCUTYPE
.
          MOVE      SP70,PATRD001
          MOVE      SP70,PATRD002
          MOVE      SP70,PATRD003
          MOVE      SP70,PATWI001
          MOVE      SP70,PATWI002
          MOVE      SP70,STARTKEY
.
          CALL      CPMRRX00           * Clear MRTREXFD CGI variables
.
CLRPAR99  RETURN
+
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "extrtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXTRTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mrtex",QRYNAME
          IF        @EQUAL
            CALL      SPMRT000          
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mrtep001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MRTEP001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mrtep002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MRTEP002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mrtep003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MRTEP003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mrtre",QRYNAME
          IF        @EQUAL
            CALL      SPMRRX00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmswd001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
            PACK      KEY11,KEY11,SP70
            UNPACK    KEY11,KEY8,KEY3
            MATCH     SP70,KEY3
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      PMSWD001,CCENT,CYEAR,CMON,CDAY
              REP       " 0",PMSWD001
            ELSE
              MOVE      QRYDATA,PMSWD001
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmswd002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSWD002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "patrd001=",QRYNAME
          IF        @EQUAL
            PACK      PATRD001,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "patrd002=",QRYNAME
          IF        @EQUAL
            PACK      PATRD002,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "patrd003=",QRYNAME
          IF        @EQUAL
            PACK      PATRD003,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "patwi001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PATWI001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "patwi002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PATWI002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "superlev=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SUPERLEV
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "homehosp",QRYNAME                                *I-240724
          IF        @EQUAL
            MOVE      QRYDATA,HOMEHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "homeloct",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HOMELOCT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "docutype",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DOCUTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "byreqdat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BYREQDAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            REP       "~'",STARTKEY
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40:
                             PROFLD50,PROFLD60,PROFLD70,PROFLD80:
                             PROFLD90
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11
          GOTO      PROFLD99
.
PROFLD11  CALL      EXTD0000  * Extract Details
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22
          GOTO      PROFLD99
.
PROFLD21  CALL      EXTD0000  * Extract Details
          GOTO      PROFLD99
.
PROFLD22  CALL      LSTDET00  * Patient List Details
          GOTO      PROFLD99
.
PROFLD30  GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41,PROFLD42
          GOTO      PROFLD99
.
PROFLD41  CALL      MRRT0000  * General Tags for Research Extract
          GOTO      PROFLD99
.
PROFLD42  CALL      MRRX0000  * Medical Records Research Extract
          GOTO      PROFLD99
.  
PROFLD50  BRANCH    FLDSETNO,PROFLD51,PROFLD52
          GOTO      PROFLD99

PROFLD51  CALL      MRRX0000  * Medical Records Research Extract
          GOTO      PROFLD99
.  
PROFLD52  CALL      LSTRES00  * Research Extract Patient List
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62
          GOTO      PROFLD99

PROFLD61  CALL      MRUT0000  * Requests by Users               
          GOTO      PROFLD99
.
PROFLD62  CALL      RCRQ0000                
          GOTO      PROFLD99
.
PROFLD70  CALL      WIED0000  * WIES Dollar Value Maintenance                
          GOTO      PROFLD99
.
PROFLD80  CALL      WIEW0000  * WIES Weights
          GOTO      PROFLD99
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91
          GOTO      PROFLD99
.
PROFLD91  CALL      RDCM0000  * Restricted Diagnosis Codes Maintenance
          GOTO      PROFLD99
.
PROFLD99  RETURN
.------------------------------------------------------------
. Medical Records Extracts
.------------------------------------------------------------
MRTEXT00  CALL      CLMRTEXT                * Clear MR Extract Variables
          MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      MRTEXT50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      MRTEXT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      MRTEXT20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      MRTEXT30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      MRTEXT99
.
MRTEXT10  CALL      ADDEXT00
          GOTO      MRTEXT99
.
MRTEXT20  CALL      UPDEXT00
          GOTO      MRTEXT99
.
MRTEXT30  CALL      DELEXT00
          GOTO      MRTEXT99
.
MRTEXT50  MOVE      MRTEX001,KEY4
          CALL      RDMREX1   
          IF        OVRCD=1
            CALL      CLMRTEXT
          ENDIF
          MATCH     "4",TEMPLATE
          IF        @EQUAL
            MOVE      "Medical Records Coding Request List",WEBTITLE
          ELSE
            MOVE      "Medical Records Coding Extract List",WEBTITLE
          ENDIF
          CALL      WEBHED00
          BRANCH    EXIT,MRTEXT99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      MRTEXT99
.
MRTEXT99  RETURN 
.------------------------------------------------------------
. Clear MR Extract Variables
.------------------------------------------------------------
.CLMRTEXT  MOVE      SP70,MREXEID  
.          MOVE      SP70,MREXDESC 
.          MOVE      SP70,MREXDDFR 
.          MOVE      SP70,MREXDDTO 
.          MOVE      SP70,MREXADFR 
.          MOVE      SP70,MREXADTO 
.          MOVE      SP70,MREXUNIT 
.          MOVE      SP70,MREXWARD 
.          MOVE      SP70,MREXPRCG 
.          MOVE      SP70,MREXWLPR 
.          MOVE      SP70,MREXCONS 
.          MOVE      SP70,MREXINCD 
.          MOVE      SP70,MREXAUTC 
.          MOVE      ZERO,MREXNUMR 
.          MOVE      SP70,MREXINPR 
.          MOVE      SP70,MREXANL1 
.          MOVE      SP70,MREXANL2 
.          MOVE      SP70,MREXANL3 
.          MOVE      SP70,MREXANL4 
.          MOVE      SP70,MREXANM1 
.          MOVE      SP70,MREXANM2 
.          MOVE      SP70,MREXANM3 
.          MOVE      SP70,MREXSPAR 
.          MOVE      SP70,MREXSDSC
.          MOVE      SP70,MREXSUBR
.          MOVE      SP70,MREXPCOD
.          MOVE      SP70,MREXPSEX
.          MOVE      SP70,MREXCNTR
.          MOVE      SP70,MREXATYP
.          MOVE      SP70,MREXPTYP
.          MOVE      SP70,MREXVHOS
.          RETURN 
.------------------------------------------------------------
. Clear Research Extract Variables
.------------------------------------------------------------
CLRESTXT  MOVE      SP70,MRRXEXID
          MOVE      SP70,MRRXDESC
          MOVE      SP70,MRRXDIFR
          MOVE      SP70,MRRXDITO
          MOVE      SP70,MRRXVIFR
          MOVE      SP70,MRRXVITO
          MOVE      SP70,MRRXUNIT
          MOVE      SP70,MRRXWARD
          MOVE      SP70,MRRXDOCT
          MOVE      SP70,MRRXDECD
          MOVE      ZERO,MRRXNOEX
          MOVE      SP70,MRRXPROG
          MOVE      SP70,MRRXDIA1
          MOVE      SP70,MRRXDIA2
          MOVE      SP70,MRRXDIA3
          MOVE      SP70,MRRXPRO1
          MOVE      SP70,MRRXPRO2
          MOVE      SP70,MRRXPRO3
          MOVE      SP70,MRRXPDRG
          MOVE      SP70,MRRXDISO
          MOVE      SP70,MRRXURFR
          MOVE      SP70,MRRXURTO
          MOVE      SP70,MRRXDTFR
          MOVE      SP70,MRRXDTTO
          MOVE      SP70,MRRXHLFR
          MOVE      SP70,MRRXHLTO
          MOVE      SP70,MRRXSMDY
          MOVE      SP70,MRRXCOFR
          MOVE      SP70,MRRXCOTO
          MOVE      SP70,MRRXSNAG
          MOVE      SP70,MRRXCDFR
          MOVE      SP70,MRRXCDTO
          MOVE      SP70,MRRXINCM
          MOVE      ZERO,MRRXAAGE
          MOVE      SP70,MRRXGEND
          MOVE      SP70,MRRXPOST
          MOVE      SP70,MRRXCOB
          MOVE      SP70,MRRXINVT
          MOVE      SP70,MRRXIPRI
          MOVE      SP70,MRRXINV1
          MOVE      SP70,MRRXINV2
          MOVE      SP70,MRRXBLFR
          MOVE      SP70,MRRXBLTO
          MOVE      SP70,MRRXDGFR
          MOVE      SP70,MRRXDGTO
          MOVE      SP70,MRRXHOSP
          MOVE      SP70,MRRXHOSF
          MOVE      SP70,MRRXHOST
          RETURN           

. Extract Details
.------------------------------------------------------------
EXTD0000  BRANCH    FLDITMNO,EXTD0010,EXTD0020,EXTD0030,EXTD0040,EXTD0050:
                             EXTD0060,EXTD0070,EXTD0080,EXTD0090,EXTD0100:
                             EXTD0110,EXTD0120,EXTD0130,EXTD0140,EXTD0150:
                             EXTD0160,EXTD0170,EXTD0180,EXTD0190,EXTD0200:
                             EXTD0210,EXTD0220,EXTD0230,EXTD0240,EXTD0250:
                             EXTD0260,EXTD0270,EXTD0280,EXTD0290,EXTD0300:
                             EXTD0310,EXTD0320,EXTD0330,EXTD0340,EXTD0350:
                             EXTD0360,EXTD0370
.
          GOTO      EXTD9999
.
EXTD0010  WRITE     HTMLFILE;MREXEID;
          GOTO      EXTD9999
.
EXTD0020  WRITE     HTMLFILE;MREXDESC;
          GOTO      EXTD9999
.
EXTD0030  MATCH     SP70,MREXDDFR
          GOTO      EXTD9999 IF EQUAL
.
          UNPACK    MREXDDFR,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      EXTD9999
.
EXTD0040  MATCH     SP70,MREXDDTO
          GOTO      EXTD9999 IF EQUAL
.
          UNPACK    MREXDDTO,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      EXTD9999
.
EXTD0050  MATCH     SP70,MREXADFR
          GOTO      EXTD9999 IF EQUAL
.
          UNPACK    MREXADFR,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      EXTD9999
.
EXTD0060  MATCH     SP70,MREXADTO
          GOTO      EXTD9999 IF EQUAL
.
          UNPACK    MREXADTO,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      EXTD9999
.
EXTD0070  MOVE      CATAC,CATEGORY 
          MOVE      MREXUNIT,CODE
          CALL      CODITM00
          GOTO      EXTD9999
.
EXTD0080  MOVE      MREXWARD,DFLTWARD
          CALL      WSEL0000
          GOTO      EXTD9999
.
EXTD0090  MOVE      CATWG,CATEGORY  
          MOVE      MREXPRCG,CODE
          CALL      CODITM00
          GOTO      EXTD9999
.
EXTD0100  WRITE     HTMLFILE;MREXWLPR
          GOTO      EXTD9999
.
EXTD0110  MOVE      MREXCONS,DOCTCODE
          CALL      DOCDET00
          GOTO      EXTD9999
.
EXTD0120  WRITE     HTMLFILE;MREXINCD;
          GOTO      EXTD9999
.
EXTD0130  WRITE     HTMLFILE;MREXAUTC
          GOTO      EXTD9999
.
EXTD0140  WRITE     HTMLFILE;MREXNUMR
          GOTO      EXTD9999
.
EXTD0150  WRITE     HTMLFILE;MREXINPR
          GOTO      EXTD9999
.
EXTD0160  WRITE     HTMLFILE;MREXANL1
          GOTO      EXTD9999
.
EXTD0170  WRITE     HTMLFILE;MREXANL2
          GOTO      EXTD9999
.
EXTD0180  WRITE     HTMLFILE;MREXANL3
          GOTO      EXTD9999
.
EXTD0190  WRITE     HTMLFILE;MREXANL4
          GOTO      EXTD9999
.
EXTD0200  WRITE     HTMLFILE;MREXANM1
          GOTO      EXTD9999
.
EXTD0210  WRITE     HTMLFILE;MREXANM2
          GOTO      EXTD9999
.
EXTD0220  WRITE     HTMLFILE;MREXANM3
          GOTO      EXTD9999
.
EXTD0230  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,EXTD0231
          WRITE     HTMLFILE;MREXPDRG;
          GOTO      EXTD9999
.
EXTD0231  PACK      KEY4,MREXPDRG,SP70
          PACK      KEY7,KEY4,LAST,SP10     * last DRG version        *I-137125
          CALL      RSPTDGW1                                          *I-137125
          CALL      RPPTDGW1                                          *C-137125
          BRANCH    OVRCD,EXTD9999
          MATCH     PTDWDRGC,KEY4                                     *I-137125
          GOTO      EXTD9999 IF NOT EQUAL                             *I-137125
          WRITE     HTMLFILE;PTDWDESC;
          GOTO      EXTD9999
.
EXTD0240  CALL      EXTTAB00                * List of Extracts
          GOTO      EXTD9999
.
EXTD0250  CALL      CODTMP00                * Automatic Coding Template
          GOTO      EXTD9999
.
EXTD0260  WRITE     HTMLFILE;MREXDIND;      * Discharge Patients Only Indicator
          GOTO      EXTD9999
.
EXTD0270  CALL      REQTAB00                * List of Request Extracts
          GOTO      EXTD9999
.
EXTD0280  WRITE     HTMLFILE;MREXSDSC;      * Sameday Discharge
          GOTO      EXTD9999
.
EXTD0290  WRITE     HTMLFILE;MREXSUBR;      * Suburb
          GOTO      EXTD9999
.
EXTD0300  WRITE     HTMLFILE;MREXPCOD;      * Postcode
          GOTO      EXTD9999
.
EXTD0310  MOVE      SP1,ANS
.
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          BRANCH    DSEXNO,EXTD0311:        * 1 = Male
                           EXTD0312:        * 2 = Female
                           EXTD0313:        * 3 = Indeterminate
                           EXTD0314         * 4 = Intersex
.
          WRITE     HTMLFILE;"<option value=",ANSF,">Female</option>":
                               "<option value=",ANSM,">Male</option>":
                               "<option value=",ANSI,">Indetermine</option>";
          IF        PTCNHDPS=3
            WRITE     HTMLFILE;"<option value=",ANSR,">Other</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ANSR,">Intersex</option>"
          ENDIF
          GOTO      EXTD9999
.
EXTD0311  MOVE      SP1,ANS
          WRITE     HTMLFILE;"<option value=",ANSF,">Female</option>":
                               "<option value=",ANSM," selected>Male</option>":
                               "<option value=",ANSI,">Indetermine</option>";
          IF        PTCNHDPS=3
            WRITE     HTMLFILE;"<option value=",ANSR,">Other</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ANSR,">Intersex</option>"
          ENDIF
          GOTO      EXTD9999
.
EXTD0312  MOVE      SP1,ANS
          WRITE     HTMLFILE;"<option value=",ANSF:
                               " selected>Female</option>":
                               "<option value=",ANSM," selected>Male</option>":
                               "<option value=",ANSI,">Indetermine</option>";
          IF        PTCNHDPS=3
            WRITE     HTMLFILE;"<option value=",ANSR,">Other</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ANSR,">Intersex</option>"
          ENDIF
          GOTO      EXTD9999
.
EXTD0313  MOVE      SP1,ANS
          WRITE     HTMLFILE;"<option value=",ANSF,">Female</option>":
                               "<option value=",ANSM,">Male</option>":
                               "<option value=",ANSI:
                               " selected>Indetermine</option>";
          IF        PTCNHDPS=3
            WRITE     HTMLFILE;"<option value=",ANSR,">Other</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ANSR,">Intersex</option>"
          ENDIF
          GOTO      EXTD9999
.
EXTD0314  MOVE      SP1,ANS
          WRITE     HTMLFILE;"<option value=",ANSF,">Female</option>":
                               "<option value=",ANSM,">Male</option>":
                               "<option value=",ANSI,">Indetermine</option>";
          IF        PTCNHDPS=3
            WRITE     HTMLFILE;"<option value=",ANSR:
                               " selected>Other</option>"
          ELSE 
            WRITE     HTMLFILE;"<option value=",ANSR:
                               " selected>Intersex</option>"
          ENDIF
          GOTO      EXTD9999
.
EXTD0320  MOVE      "C ",CATEGORY 
          MOVE      MREXCNTR,CODE
          CALL      CODITM00
          GOTO      EXTD9999
.
EXTD0330  MOVE      "A ",CATEGORY
          MOVE      MREXATYP,CODE
          CALL      CODITM00
          GOTO      EXTD9999
.
EXTD0340  MOVE      "P ",CATEGORY
          MOVE      MREXPTYP,CODE
          CALL      CODITM00
          GOTO      EXTD9999
.
EXTD0350  MOVE      MREXVHOS,SELHOSP        * Hospital (of Visit)
          MATCH     SP3,MREXVHOS
          IF        @EQUAL
            MOVE      WBSEHOSP,SELHOSP
          ENDIF
          CALL      HSEL0000
          GOTO      EXTD9999
.
EXTD0360  MOVE      "KB",CATEGORY
          MOVE      MREXURTT,CODE
          CALL      CODITM00
          GOTO      EXTD9999
.
EXTD0370  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,EXTD0371
          WRITE     HTMLFILE;MREXWLPR;
          GOTO      EXTD9999
.
EXTD0371  PACK      KEY9,MREXWLPR,SP70
          CALL      RDPROA1
          BRANCH    OVRCD,EXTD9999
.
          WRITE     HTMLFILE;WPDESC;
          GOTO      EXTD9999
.
.
EXTD9999  RETURN
.------------------------------------------------------------
. List of Extracts
.------------------------------------------------------------
EXTTAB00  MOVE      SP70,KEY4
          CALL      RSMREX1        
EXTTAB10  CALL      RKMREX1        
          BRANCH    OVRCD,EXTTAB99
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateItem('",HTMLLINK
          APPEND    MREXEID,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",MREXEID,"#",":
                             "#"",MREXDESC,"#",":
                             "#"",MREXDDFR,"#",":
                             "#"",MREXDDTO,"#",":
                             "#"",MREXADFR,"#",":
                             "#"",MREXADTO,"#",":
                             "#"",MREXUNIT,"#",":
                             "#"",MREXWARD,"#",":
                             "#"",MREXPRCG,"#",":
                             "#"",MREXWLPR,"#",":
                             "#"",MREXCONS,"#",":
                             "#"",MREXSDSC,"#",":
                             "#"",MREXSUBR,"#",":
                             "#"",MREXPCOD,"#",":
                             "#"",MREXPSEX,"#",":
                             "#"",MREXCNTR,"#",":
                             "#"",MREXATYP,"#",":
                             "#"",MREXPTYP,"#",":
                             "#"",MREXVHOS,"#");"
.
          GOTO      EXTTAB10
.
EXTTAB99  RETURN 
.------------------------------------------------------------
. List of Request Extracts
.------------------------------------------------------------
REQTAB00  MOVE      SP70,KEY4
          CALL      RSMREX1        
REQTAB10  CALL      RKMREX1        
          BRANCH    OVRCD,REQTAB99
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateItem('",HTMLLINK
          APPEND    MREXEID,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",MREXEID,"#",":
                             "#"",MREXDESC,"#",":
                             "#"",MREXDDFR,"#",":
                             "#"",MREXDDTO,"#",":
                             "#"",MREXADFR,"#",":
                             "#"",MREXADTO,"#",":
                             "#"",MREXUNIT,"#",":
                             "#"",MREXWARD,"#",":
                             "#"",MREXPRCG,"#",":
                             "#"",MREXWLPR,"#",":
                             "#"",MREXCONS,"#",":
                             "#"",MREXSDSC,"#",":
                             "#"",MREXSUBR,"#",":
                             "#"",MREXPCOD,"#",":
                             "#"",MREXPSEX,"#",":
                             "#"",MREXCNTR,"#",":
                             "#"",MREXATYP,"#",":
                             "#"",MREXPTYP,"#",":
                             "#"",MREXVHOS,"#");"
.
          GOTO      REQTAB10
.
REQTAB99  RETURN
.------------------------------------------------------------
. Add Extract
.------------------------------------------------------------
ADDEXT00  CALL      CLMRTEXT
          PACK      KEY4,MRTEX001
          CALL      RAMREX1
          COMPARE   ZERO,OVRCD
          GOTO      ADDEXT90 IF EQUAL 
.
          CALL      MVEXT000
          CALL      SETCDT00      * Set creation/modified date and time
          CALL      WRMREX1
          CALL      RUNEXT00      * Schedule Extract
          MOVE      ZERO,EXIT
          GOTO      ADDEXT99
.
ADDEXT90  MOVE      "Extract Already on File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
ADDEXT99  RETURN
.------------------------------------------------------------
. Delete Extract
.------------------------------------------------------------
DELEXT00  PACK      KEY4,MRTEX001
          CALL      RAMREX1
          IF        OVRCD=0
            CALL      DEMREX1
            CALL      RUNDEL00      * Schedule Extract Delete
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
DELEXT99  RETURN
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
HSEL0000  COMPARE   ONE,IBCNMHOS
          GOTO      HSEL9999 IF NOT EQUAL
.
          MOVE      SP10,WBSEHOSP
          PACK      KEY10,USERID,SP10
          CALL      RDWBSE1                 * get User's Hospital (default)
.
          MATCH     SP3,SELHOSP
          IF        @EQUAL
            MOVE      WBSEHOSP,SELHOSP      * set default hospital
          ENDIF
.
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HSEL0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSEL9999            * not HSEL0200
.
          MATCH     "1",SUPERLEV
          IF        @EQUAL
            PACK      KEY13,USERID,SP70       * All hospital access
            CALL      RDMLSEC1
            IF        OVRCD = 1
              PACK      KEY13,USERID,PTHSHOSP,SP70     * This hospital access
              CALL      RDMLSEC1
              IF        OVRCD = 1
                MATCH     SELHOSP,PTHSHOSP    * Default Hospital
                GOTO      HSEL0150 IF EQUAL
                GOTO      HSEL0100
              ENDIF
            ENDIF
          ELSE                                * ordinary User selections
            MATCH     SELHOSP,PTHSHOSP
            GOTO      HSEL0150 IF EQUAL
            MATCH     WBSEHOSP,PTHSHOSP
            GOTO      HSEL0100 IF NOT EQUAL
          ENDIF
.
HSEL0150  MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     SELHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSEL0100
.
.
HSEL9999  RETURN
.------------------------------------------------------------
. Ward selection - Ward Only (use Ward/Bed search for Bed Wards)
.------------------------------------------------------------
WSEL0000  PACK      KEY29,SP70
          IF        IBCNMHOS = 1
            PACK      KEY29,SP3,WBSEHOSP,SP70
          ENDIF
          CALL      RDSWARD7
WSEL0100  CALL      RDKWARD7
          BRANCH    OVRCD,WSEL9999
.
.                         if we have a bed number we have passed all the ward
.                         master records, so exit
          MATCH     SP70,WBED
          GOTO      WSEL9999 IF NOT EQUAL
.
          COMPARE   WACTIVE,ZERO                 *List only active wards
          GOTO      WSEL0100 IF NOT EQUAL
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        !@EQUAL
              MATCH     WBSEHOSP,PTWDHOSN
              GOTO      WSEL9999 IF NOT EQUAL
            ENDIF
          ENDIF
.
.                       write the select option.
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#"";
          MATCH     DFLTWARD,WWARD
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">",WBDESC;
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;" - ",PTWDHOSN;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      WSEL0100
.
WSEL9999  RETURN
.
.------------------------------------------------------------
. Automatic Coding Template
.------------------------------------------------------------
CODTMP00  PACK      KEY4,SP70
          CALL      RSMRTHD1
CODTMP10  CALL      RKMRTHD1
          BRANCH    OVRCD,CODTMP99       
.
          MATCH     MRTHTMID,MREXAUTC
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",MRTHTMID,"#" selected> ":
                               MRTHDESC," </option> " 
          ELSE   
            WRITE     HTMLFILE;"<option value=#"",MRTHTMID,"#"> ":
                               MRTHDESC," </option> " 
          ENDIF
          GOTO      CODTMP10
.
CODTMP99  RETURN  
.---------------------------------------------------------------------
. Set creation date and time
.---------------------------------------------------------------------
SETCDT00  CALL      IBACLOCK 
.
          MATCH     "U",UPDTTYPE
          GOTO      SETCDT10 IF EQUAL
.
          PACK      MREXCDAT,CCC,CYY,CMM,CDD 
          REP       " 0",MREXCDAT
          CLOCK     TIME,MREXCTIM  
          MOVE      WBSEUID,MREXCUID
.
SETCDT10  PACK      MREXMDAT,CCC,CYY,CMM,CDD 
          REP       " 0",MREXMDAT
          CLOCK     TIME,MREXMTIM  
          MOVE      WBSEUID,MREXMUID
      
SETCDT99  RETURN 
.---------------------------------------------------------------------
. Move in Medical Record Extract Details
.------------------------------------------------------------
MVEXT000  MATCH     Z70,MRTEX001
          IF        !@EQUAL
            MOVE       MRTEX001,MREXEID 
          ENDIF
.
          MATCH     Z70,MRTEX002
          IF        !@EQUAL
            MOVE       MRTEX002,MREXDESC
          ENDIF
.
          MATCH     Z70,MRTEX003
          IF        @EQUAL
            MOVE      SP70,MREXDDFR
          ELSE
            MOVE      MRTEX003,MREXDDFR
          ENDIF
.
          MATCH     Z70,MRTEX004
          IF        @EQUAL
            MOVE      SP70,MREXDDTO
          ELSE
            MOVE      MRTEX004,MREXDDTO
          ENDIF
.
          MATCH     Z70,MRTEX005
          IF        @EQUAL
            MOVE      SP70,MREXADFR
          ELSE
            MOVE      MRTEX005,MREXADFR
          ENDIF
.
          MATCH     Z70,MRTEX006
          IF        @EQUAL
            MOVE      SP70,MREXADTO
          ELSE
            MOVE      MRTEX006,MREXADTO
          ENDIF
.
          MATCH     Z70,MRTEX007
          IF        !@EQUAL
            MOVE       MRTEX007,MREXUNIT
          ENDIF
.
          MATCH     Z70,MRTEX008
          IF        !@EQUAL
            MOVE       MRTEX008,MREXWARD   
          ENDIF
.
          MATCH     Z70,MRTEX009
          IF        !@EQUAL
            MOVE       MRTEX009,MREXPRCG   
          ENDIF
.
          MATCH     Z70,MRTEX010
          IF        !@EQUAL
            MOVE       MRTEX010,MREXWLPR   
          ENDIF
.
          MATCH     Z70,MRTEX011
          IF        !@EQUAL
            MOVE       MRTEX011,MREXCONS   
          ENDIF
.
          MATCH     Z70,MRTEX012
          IF        !@EQUAL
            MOVE       MRTEX012,MREXINCD   
          ELSE
            MOVE       ZERO,MREXINCD   
          ENDIF
.
          MATCH     Z70,MRTEX013
          IF        !@EQUAL
            MOVE       MRTEX013,MREXAUTC   
          ENDIF
.
          MATCH     Z70,MRTEX014
          IF        !@EQUAL
            MOVE       MRTEX014,MREXNUMR   
          ENDIF
.
          MOVE       ONE,MREXINPR           * Extract in Process = Yes  
.
          MATCH     Z70,MRTEX016
          IF        !@EQUAL
            MOVE       MRTEX016,MREXANL1   
          ENDIF
.
          MATCH     Z70,MRTEX017
          IF        !@EQUAL
            MOVE       MRTEX017,MREXANL2   
          ENDIF
.
          MATCH     Z70,MRTEX018
          IF        !@EQUAL
            MOVE       MRTEX018,MREXANL3   
          ENDIF
.
          MATCH     Z70,MRTEX019
          IF        !@EQUAL
            MOVE       MRTEX019,MREXANL4   
          ENDIF
.
          MATCH     Z70,MRTEX020
          IF        !@EQUAL
            MOVE       MRTEX020,MREXANM1   
          ENDIF
.
          MATCH     Z70,MRTEX021
          IF        !@EQUAL
            MOVE       MRTEX021,MREXANM2   
          ENDIF
.
          MATCH     Z70,MRTEX022
          IF        !@EQUAL
            MOVE       MRTEX022,MREXANM3   
          ENDIF
.
          MATCH     Z70,MRTEX023
          IF        !@EQUAL
            MOVE       MRTEX023,MREXPDRG   
          ENDIF
.
          MATCH     Z70,MRTEX024
          IF        !@EQUAL
            MOVE       MRTEX024,MREXDIND   
          ELSE
            MOVE       ZERO,MREXDIND   
          ENDIF
.
          MATCH     Z70,MRTEX025
          IF        !@EQUAL
            MOVE       MRTEX025,MREXSDSC   
          ELSE
            MOVE       ZERO,MREXSDSC   
          ENDIF
.
          MATCH     Z70,MRTEX026
          IF        !@EQUAL
            MOVE       MRTEX026,MREXSUBR
          ENDIF
.
          MATCH     Z70,MRTEX027
          IF        !@EQUAL
            MOVE      MRTEX027,MREXPCOD
          ENDIF
.
          MATCH     Z70,MRTEX028
          IF        !@EQUAL
            MOVE      MRTEX028,MREXPSEX
          ENDIF
.
          MATCH     Z70,MRTEX029
          IF        !@EQUAL
            MOVE      MRTEX029,MREXCNTR
          ENDIF
.
          MATCH     Z70,MRTEX030
          IF        !@EQUAL
            MOVE      MRTEX030,MREXATYP
          ENDIF
.
          MATCH     Z70,MRTEX031
          IF        !@EQUAL
            MOVE      MRTEX031,MREXPTYP
          ENDIF
.
          MATCH     Z70,MRTEX032
          IF        !@EQUAL
            MOVE      MRTEX032,MREXVHOS
          ENDIF
.
          MATCH     Z70,MRTEX033
          IF        !@EQUAL
            MOVE      MRTEX033,MREXURTT
          ENDIF
.
MVEXT999  RETURN 
.------------------------------------------------------------
.                       RUNEXT00
.   Schedule Medical Record Extract to be run via Program Scheduler
.------------------------------------------------------------
RUNEXT00  MOVE      "IBAMRT53",SCHDPGID
          MOVE      "Medical Records Extraction",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]          * Option
          MOVE      MRTEX001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNEXT99  RETURN
.------------------------------------------------------------
.                       RUNDEL00
.   Schedule Waiting List Extract Delete to be run via Program Scheduler
.------------------------------------------------------------
RUNDEL00  MOVE      "IBAMRT53",SCHDPGID
          MOVE      "Delete Medical Records Coding Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S",SCHDPRNT             * Spool File
.
.         Write Keyin parameters for Extract
.
          MOVE      TWO,KEYSTARR[1]          * Option
          MOVE      MRTEX001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNDEL99  RETURN
.------------------------------------------------------------
.   Set Parameters for Medical Records Coding Extract Details
.------------------------------------------------------------
SPMRT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPMRT010,SPMRT020,SPMRT030,SPMRT040,SPMRT050:
                       SPMRT060,SPMRT070,SPMRT080,SPMRT090,SPMRT100:
                       SPMRT110,SPMRT120,SPMRT130,SPMRT140,SPMRT150:
                       SPMRT160,SPMRT170,SPMRT180,SPMRT190,SPMRT200:
                       SPMRT210,SPMRT220,SPMRT230,SPMRT240,SPMRT250:
                       SPMRT260,SPMRT270,SPMRT280,SPMRT290,SPMRT300:
                       SPMRT310,SPMRT320,SPMRT330
.
          MOVE      ONE,EXIT
          GOTO      SPMRT999

SPMRT010  MOVE      QRYDATA,MRTEX001
          GOTO      SPMRT999
.
SPMRT020  MOVE      QRYDATA,MRTEX002
          GOTO      SPMRT999
.
SPMRT030  MATCH     SP70,QRYDATA
          GOTO      SPMRT999 IF EQUAL 
          GOTO      SPMRT999 IF EOS    
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      MRTEX003,CCENT,CYEAR,CMON,CDAY
          REP       " 0",MRTEX003
          GOTO      SPMRT999
.
SPMRT040  MATCH     SP70,QRYDATA
          GOTO      SPMRT999 IF EQUAL 
          GOTO      SPMRT999 IF EOS    
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      MRTEX004,CCENT,CYEAR,CMON,CDAY
          REP       " 0",MRTEX004
          GOTO      SPMRT999
.
SPMRT050  MATCH     SP70,QRYDATA
          GOTO      SPMRT999 IF EQUAL 
          GOTO      SPMRT999 IF EOS    
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      MRTEX005,CCENT,CYEAR,CMON,CDAY
          REP       " 0",MRTEX005
          GOTO      SPMRT999
.
SPMRT060  MATCH     SP70,QRYDATA
          GOTO      SPMRT999 IF EQUAL 
          GOTO      SPMRT999 IF EOS    
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      MRTEX006,CCENT,CYEAR,CMON,CDAY
          REP       " 0",MRTEX006
          GOTO      SPMRT999
.
SPMRT070  MOVE      QRYDATA,MRTEX007
          GOTO      SPMRT999
.
SPMRT080  MOVE      QRYDATA,MRTEX008
          GOTO      SPMRT999
.
SPMRT090  MOVE      QRYDATA,MRTEX009
          GOTO      SPMRT999
.
SPMRT100  MOVE      QRYDATA,MRTEX010
          GOTO      SPMRT999
.
SPMRT110  MOVE      QRYDATA,MRTEX011
          GOTO      SPMRT999
.
SPMRT120  MOVE      QRYDATA,MRTEX012
          GOTO      SPMRT999
.
SPMRT130  MOVE      QRYDATA,MRTEX013
          GOTO      SPMRT999
.
SPMRT140  MOVE      QRYDATA,MRTEX014
          GOTO      SPMRT999
.
SPMRT150  MOVE      QRYDATA,MRTEX015
          GOTO      SPMRT999
.
SPMRT160  MOVE      QRYDATA,MRTEX016
          GOTO      SPMRT999
.
SPMRT170  MOVE      QRYDATA,MRTEX017
          GOTO      SPMRT999
.
SPMRT180  MOVE      QRYDATA,MRTEX018
          GOTO      SPMRT999
.
SPMRT190  MOVE      QRYDATA,MRTEX019
          GOTO      SPMRT999
.
SPMRT200  MOVE      QRYDATA,MRTEX020
          GOTO      SPMRT999
.
SPMRT210  MOVE      QRYDATA,MRTEX021
          GOTO      SPMRT999
.
SPMRT220  MOVE      QRYDATA,MRTEX022
          GOTO      SPMRT999
.
SPMRT230  MOVE      QRYDATA,MRTEX023
          GOTO      SPMRT999
.
SPMRT240  MOVE      QRYDATA,MRTEX024
          GOTO      SPMRT999
.
SPMRT250  MOVE      QRYDATA,MRTEX025
          GOTO      SPMRT999
.
SPMRT260  MOVE      QRYDATA,MRTEX026
          GOTO      SPMRT999
.
SPMRT270  MOVE      QRYDATA,MRTEX027
          GOTO      SPMRT999
.
SPMRT280  MOVE      QRYDATA,MRTEX028
          GOTO      SPMRT999
.
SPMRT290  MOVE      QRYDATA,MRTEX029
          GOTO      SPMRT999
.
SPMRT300  MOVE      QRYDATA,MRTEX030
          GOTO      SPMRT999
.
SPMRT310  MOVE      QRYDATA,MRTEX031
          GOTO      SPMRT999
.
SPMRT320  MOVE      QRYDATA,MRTEX032
          GOTO      SPMRT999
.
SPMRT330  MOVE      QRYDATA,MRTEX033
          GOTO      SPMRT999
.
SPMRT999  RETURN 
.------------------------------------------------------------
. Update Extract
.------------------------------------------------------------
UPDEXT00  CALL      CLMRTEXT
          PACK      KEY4,MRTEX001
          CALL      RDMREX1
          IF        OVRCD=0
            CALL      MVEXT000
            CALL      SETCDT00      * Set creation/modified date and time
            CALL      UPMREX1
            CALL      RUNEXT00      * Schedule Extract
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
UPDEXT99  RETURN       
.------------------------------------------------------------
. Display Patient List
.------------------------------------------------------------
MRTEPS00  PACK      KEY4,MRTEP001,SP70
          CALL      RDMREX1 
          BRANCH    OVRCD,MRTEPS90
.
          MATCH     "1",MREXINPR            * Is the extract in process?
          GOTO      MRTEPS91 IF EQUAL       * yes
.
          MATCH     Z70,MRTEP002            * No visit so just display list
          GOTO      MRTEPS10 IF EQUAL
.
          PACK      KEY12,MREXEID,MRTEP002,SP70
          CALL      RDMREP1
.
          PACK      KEY8,MREPVIS,SP70
          CALL      RDPTICU1
          IF        OVRCD=1
            MOVE      ZERO,PTICUINT
            MOVE      ZERO,PTICUMEC 
          ENDIF
.
          PACK      KEY8,MREPVIS,SP70       * Read admiss file to get urno
          CALL      RDMISS1  
          PACK      KEY8,AURNO,SP70         * read master file to calc pat age
          CALL      RDMAST1
.
MRTEPS10  CLEAR     WEBTITLE
          MOVE      "Medical Records Coding Extract - ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    MREXDESC,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,MRTEPS99
          CALL      WEBBOD00
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      MRTEPS99
.
MRTEPS90  MOVE      "Invalid Extract ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MRTEPS99
.
MRTEPS91  MOVE      "Extracting Patient's Still In Progress ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
MRTEPS99  RETURN 
.------------------------------------------------------------
. Patient List Details
.------------------------------------------------------------
LSTDET00  BRANCH    FLDITMNO,LSTDET10,LSTDET20,LSTDET30,LSTDET40,LSTDET50:
                             LSTDET60,LSTDET70,LSTDET80,LSTDET90
.
          GOTO      LSTDET99
.
LSTDET10  CALL      EDLIST00                * Patient Edit List
          GOTO      LSTDET99
.
LSTDET20  WRITE     HTMLFILE;MREPEID;       * Episode Extract ID
          GOTO      LSTDET99
.
LSTDET30  WRITE     HTMLFILE;MREPVIS;       * Episode Visit number
          GOTO      LSTDET99
.
LSTDET40  WRITE     HTMLFILE;MREPDEL;       * Episode Visit number
          GOTO      LSTDET99
.
LSTDET50  WRITE     HTMLFILE;PTICUINT;      * ICU Hours in itensive care
          GOTO      LSTDET99
.
LSTDET60  WRITE     HTMLFILE;PTICUMEC;      * ICU hours on mechanical ventilator
          GOTO      LSTDET99
.
LSTDET70  CALL      PATAGE00                * Patient Age in days/wks/mnths/yrs
          GOTO      LSTDET99
.
LSTDET80  CALL      NEXTEP00                * next set of patients in list
          GOTO      LSTDET99
.
LSTDET90  CALL      PREVEP00                * previous set of patients in list
          GOTO      LSTDET99
.
LSTDET99  RETURN
.------------------------------------------------------------
. Edit Patient List
.------------------------------------------------------------
EDLIST00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      MRTHD000                * Patient List Table Heading
.
          IF        NORECORD=0
            MOVE      "14",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      MREXEID,KEY4
          CALL      RDMREX1   
          BRANCH    OVRCD,EDLIST99
.
          PACK      KEY12,MREXEID,SP70
          CALL      RSMREP1 
EDLIST10  CALL      RKMREP1 
          BRANCH    OVRCD,EDLIST99
.
          MATCH     MREXEID,MREPEID
          GOTO      EDLIST99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EDLIST10
          ENDIF
.
          CALL      PATROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      EDLIST10 IF NOT EQUAL
.
EDLIST99  RETURN 
.------------------------------------------------------------
. Read patient details and write the patient row to HTMLFILE
.------------------------------------------------------------
PATROW00  PACK      KEY8,MREPVIS,SP70
          CALL      RDMISS1
          IF        OVRCD=1
            MOVE      "Invalid Admission",FORMATNM
          ENDIF
.
          PACK      KEY8,AURNO,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            MOVE      "Invalid U/R",FORMATNM
          ELSE
            IF        PCEASE=1
              MOVE      PDECDTE,AGEDATE            * Date of Death
            ELSE
              PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
            ENDIF
            REP       " 0",AGEDATE
            CALL      CALCAGE
            CALL      PATLN000
          ENDIF
.
          PACK      KEY8,AADMNO,SP70
          CALL      RDDSCH1
          IF        OVRCD=1
            MOVE      "&nbsp;",DISPDATE
.
            MATCH     "1",MREXDIND          * check for dis pats only set to yes
            GOTO      PATROW99 IF EQUAL     * pat is not discharge find next pat
          ELSE
            UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          CALL      GTDIAG00   * Get Primary Diagnosis Code for this Patient
.
          MOVE      MREPVIS,ADMISSNO
          REP       " +",ADMISSNO 
.  
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail02":
                              "(#"",LINKPRG,"#.pbl":
                              "?reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&mrtep001=",MREPEID:
                              "&mrtep002=",ADMISSNO,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              AURNO,"</td>":
                              "<td>",MREPVIS," - ",FORMATNM,"</td>":
                              "<td>",DIAGNSIS,"</td><td nowrap>":
                              DISPDATE,"</td>";
.
          MOVE      ONE,EXTRTYPE
          MATCH     "1",MREPDEL
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><input type=checkbox name=mrtep003":
                               " value=1 onclick=#"DeletePatient(this":
                               ",'",MREPEID,"','",MREPVIS,"','",EXTRTYPE,"'":
                               ");#" checked></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=mrtep003":
                               " value=1 onclick=#"DeletePatient(this":
                              ",'",MREPEID,"','",MREPVIS,"','",EXTRTYPE,"'":
                               ");#"></td>";
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
PATROW99  RETURN
.------------------------------------------------------------
.  Table Medical Records Coding Patient Extract Tables (TABLE HEADING)
.------------------------------------------------------------
MRTHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=8%>U/R Number</td>":
                             "<td class=HeadingCell width=30%>Patient</td>":
        "<td class=HeadingCell width=45%>Principle Diagnosis Description</td>":
                             "<td class=HeadingCell width=15%>Discharge Date":
                             "</td>":
                             "<td class=HeadingCell width=8%>Deleted</td>":
                             "</tr>"
MRTHD999  RETURN
.-----------------------------------------------------------------------------
.   Read Patient Episode Disease File with Admission No, Episode No=1 & 
.   Episode Counter=1 for Primary Diagnosis!
.   RETURN VAR: DIAGNSIS - Diagnosis Code / Description
.-----------------------------------------------------------------------------
GTDIAG00  MOVE      ONE,FORM2    * Use as Episode=1                   *C-240107
          MOVE      ONE,FORM3    * Use as Unique Counter=1            *C-240107
          PACK      KEY13,MREPVIS,FORM2,FORM3,SP70
          CALL      RDPTECD1
          IF        OVRCD=1 
            MOVE      "&nbsp;",DIAGNSIS     * Set Description to blank!
            GOTO      GTDIAG99              * No Diagnosis Record Found
          ENDIF
.
GTDIAG30  MOVE      " - ",KEY3
          PACK      DIAGNSIS,PTEDCODE,KEY3,PTEDDESC
.
GTDIAG99  RETURN
.------------------------------------------------------------
. Delete Patient Indicator Update
.------------------------------------------------------------
DELPAT00  CALL      XMLHED00
          BRANCH    EXIT,DELPAT99
.
          BRANCH    EXTRTYPE,DELPAT10,DELPAT20
          GOTO      DELPAT90
.
DELPAT10  PACK      KEY4,MRTEP001,SP70
          CALL      RDMREX1
          BRANCH    OVRCD,DELPAT90
          PACK      KEY12,MREXEID,MRTEP002,SP70
          CALL      RDMREP1
          BRANCH    OVRCD,DELPAT90
          MOVE      MRTEP003,MREPDEL
          CALL      UPMREP1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
          GOTO      DELPAT95
.
DELPAT20  PACK      KEY4,MRTRE001,SP70
          CALL      RDMRREX1
          BRANCH    OVRCD,DELPAT90
          PACK      KEY12,MRTRE001,MRTRE002,SP70
          CALL      RDMRED1
          BRANCH    OVRCD,DELPAT90
          MOVE      MRTEP003,MREDDEL
          CALL      UPMRED1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
          GOTO      DELPAT95
.
DELPAT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Patient":
                             "</RETURN_VALUE>"
DELPAT95  CALL      XMLEND00
DELPAT99  RETURN
.------------------------------------------------------------
. Patient Age
.------------------------------------------------------------
PATAGE00  CALL      IBACLOCK
          IF        PCEASE=1
            MOVE      PDECDTE,AGEDATE            * Date of Death
          ELSE
            PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
          ENDIF
          REP       " 0",AGEDATE
          CALL      CALCAGE
.
          MATCH     "y",PSAGETYP
          GOTO      PATAGE10 IF NOT EQUAL
          WRITE     HTMLFILE;PSAGEYRS," yrs";
          GOTO      PATAGE99
.
PATAGE10  MATCH     "d",PSAGETYP
          GOTO      PATAGE20 IF NOT EQUAL
          WRITE     HTMLFILE;PSAGEDAY," days";
          GOTO      PATAGE99
.
PATAGE20  MATCH     "m",PSAGETYP
          GOTO      PATAGE30 IF NOT EQUAL
          WRITE     HTMLFILE;PSAGEMNT," mths";
          GOTO      PATAGE99
.
PATAGE30  MATCH     "w",PSAGETYP
          GOTO      PATAGE99 IF NOT EQUAL
          WRITE     HTMLFILE;PSAGEWKS," wks";
PATAGE99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTEP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",MREXEID  
.
          WRITE     HTMLFILE;"mrtweb03.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&mrtep001=",MREXEID;
.
          REP       "+ ",MREXEID  
.
NEXTEP99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVEP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",MREXEID   
.
          WRITE     HTMLFILE;"mrtweb03.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&mrtep001=",MREXEID;
.
          REP       "+ ",MREXEID
.
PREVEP99  RETURN
.------------------------------------------------------------
. Medical Records Research Extracts
.------------------------------------------------------------
MRTRES00  CALL      CLRESTXT                * Clear MR Extract Variables
          MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      MRTRES50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      MRTRES10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      MRTRES20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      MRTRES30 IF EQUAL
.
          GOTO      MRTRES90
.
MRTRES10  CALL      ADDRES00
          GOTO      MRTRES99
.
MRTRES20  CALL      UPDRES00
          GOTO      MRTRES99
.
MRTRES30  CALL      DELRES00
          GOTO      MRTRES99
.
MRTRES50  MOVE      MRTRE001,KEY4
          CALL      RDMRREX1  
          IF        OVRCD=1
            CALL      CLRESTXT
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Medical Records Research Extract List",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,MRTRES99
          CALL      WEBBOD00
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      MRTRES99
.
MRTRES90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MRTRES99
.
MRTRES99  RETURN 
.------------------------------------------------------------
. Add Research Extract
.------------------------------------------------------------
ADDRES00  CALL      CLRESTXT
          PACK      KEY4,MRTRE001,SP30
          CALL      RAMRREX1
          COMPARE   ZERO,OVRCD
          GOTO      ADDRES90 IF EQUAL
.
          CALL      VALDRX00      * Validate fields
          BRANCH    EXIT,ADDRES99
          CALL      MVMRRX00
          CALL      WRMRREX1
          CALL      RUNRES00      * Schedule Extract
          MOVE      ZERO,EXIT
          GOTO      ADDRES99
.
ADDRES90  MOVE      "Research Extract Already on File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
ADDRES99  RETURN
.------------------------------------------------------------
. Update Research Extract
.------------------------------------------------------------
UPDRES00  CALL      CLRESTXT
          PACK      KEY4,MRTRE001,SP30
          CALL      RDMRREX1
          IF        OVRCD=0
            CALL      VALDRX00      * Validate fields
            BRANCH    EXIT,UPDRES99
            CALL      MVMRRX00
            CALL      UPMRREX1
            CALL      RUNRES00      * Schedule Extract
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Research Extract Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
UPDRES99  RETURN
.------------------------------------------------------------
. Validate fields for Research Extract
.------------------------------------------------------------
VALDRX00  IF        IBCNMHOS=1
            MATCH     MRTRE047,MRTRE048
            IF        @LESS
              CLEAR     WEBTITLE
              APPEND    "Home Location Hospital To must be > ",WEBTITLE
              APPEND    "Home Location Hospital  From",WEBTITLE
              CALL      WEBERR00
              MOVE      ONE,EXIT
            ENDIF
            MATCH     MRTRE025,MRTRE026
            IF        @LESS
              CLEAR     WEBTITLE
              APPEND    "Home Location To must be > ",WEBTITLE
              APPEND    "Home Location From",WEBTITLE
              CALL      WEBERR00
              MOVE      ONE,EXIT
            ENDIF
          ELSE
            MATCH     MRTRE025,MRTRE026
            IF        @LESS
              MOVE      "Home Location To must be > Home Location From",WEBTITLE
              CALL      WEBERR00
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
VALDRX10  MATCH     MRTRE028,MRTRE029
          IF        @LESS
            MOVE      "Coder Id To must be > Coder Id From ",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
          MATCH     MRTRE023,MRTRE024
          IF        @LESS
            MOVE      "Document Type To must be > Document Type From ",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
VALDRX99  RETURN
+
.------------------------------------------------------------
. Delete Research Extract
.------------------------------------------------------------
DELRES00  PACK      KEY4,MRTRE001
          CALL      RAMRREX1
          IF        OVRCD=0
            CALL      DEMRREX1
            CALL      RUNRED00      * Schedule Extract Delete
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Research Extract Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
DELRES99  RETURN
.------------------------------------------------------------
. List of Research Extracts
.------------------------------------------------------------
RESTAB00  MOVE      SP70,KEY4
          CALL      RSMRREX1       
RESTAB10  CALL      RKMRREX1       
          BRANCH    OVRCD,RESTAB99
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateItem('",HTMLLINK
          APPEND    MRRXEXID,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",MRRXEXID,"#",":
                             "#"",MRRXDESC,"#",":
                             "#"",MRRXDIFR,"#",":
                             "#"",MRRXDITO,"#");"
.
          GOTO      RESTAB10
.
RESTAB99  RETURN
.------------------------------------------------------------
. Add waiting list Extension Fields
.------------------------------------------------------------
MRRT0000  BRANCH    FLDITMNO,MRRT0100,MRRT0200,MRRT0300,MRRT0400:
                             MRRT0500,MRRT0600,MRRT0700
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MRRT9999
.
MRRT0100  CALL      RESTAB00           * Output list of research extracts 
          GOTO      MRRT9999
.
MRRT0200  MOVE      MRRXWARD,DFLTWARD
          CALL      WSEL0000
          GOTO      MRRT9999
.
MRRT0300  WRITE     HTMLFILE;MRRXHLFR; * MR home location from
          GOTO      MRRT9999
.
MRRT0400  MOVE      "TY",CATEGORY
          MOVE      MRRXDTFR,CODE
          CALL      CODITM00
          GOTO      MRRT9999
.
MRRT0500  WRITE     HTMLFILE;MRRXHLTO; * MR home location to
          GOTO      MRRT9999
.
MRRT0600  MOVE      "TY",CATEGORY
          MOVE      MRRXDTTO,CODE
          CALL      CODITM00
          GOTO      MRRT9999
.
MRRT0700  READ      CONTROLF,ZERO;*43,IBCNMHOS
          WRITE     HTMLFILE;IBCNMHOS;
          GOTO      MRRT9999
.
MRRT9999  RETURN
.------------------------------------------------------------
.                       RUNRES00
.   Schedule Research Extract to be run via Program Scheduler
.------------------------------------------------------------
RUNRES00  MOVE      "IBAMRT53",SCHDPGID
          MOVE      " Run Research Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      THREE,KEYSTARR[1]          * Option
          MOVE      MRTRE001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNRES99  RETURN
.------------------------------------------------------------
.                       RUNRED00
.   Schedule Research Extract Delete to be run via Program Scheduler
.------------------------------------------------------------
RUNRED00  MOVE      "IBAMRT53",SCHDPGID
          MOVE      "Delete Research Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S",SCHDPRNT             * Spool File
.
.         Write Keyin parameters for Extract
.
          MOVE      FOUR,KEYSTARR[1]          * Option
          MOVE      MRTRE001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNRED99  RETURN
.------------------------------------------------------------
. Display Research Extract List
.------------------------------------------------------------
MRTREL00  PACK      KEY4,MRTRE001,SP70
          CALL      RDMRREX1 
          BRANCH    OVRCD,MRTREL90
.
          CLEAR     WEBTITLE
          MOVE      "Research Patient Records List - ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    MRRXDESC,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,MRTREL99
          CALL      WEBBOD00
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      MRTREL99
.
MRTREL90  MOVE      "Invalid Extract ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MRTREL99
.
MRTREL99  RETURN 
.------------------------------------------------------------
. Display Medical Reservations for a user
.------------------------------------------------------------
MRTUSR00  PACK      KEY10,WBSEUID,SP70
          CALL      RDWBSE1  
          BRANCH    OVRCD,MRTUSR90
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE      * Display
          GOTO      MRTUSR10 IF EQUAL
.
          GOTO      MRTUSR90
.
MRTUSR10  CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
          APPEND    "Medical Record Request ",WEBTITLE
          IF        BYREQDAT=1
            APPEND    "by Required Date ",WEBTITLE
          ELSE
            APPEND    "for User - ",WEBTITLE
            APPEND    WBSENAM,WEBTITLE
          ENDIF

.          MOVE      "Medical Record Request for User - ",WEBTITLE
.          ENDSET    WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,MRTUSR99
          CALL      WEBBOD00
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      MRTUSR99
.
MRTUSR90  MOVE      "Invalid User ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MRTUSR99
.
MRTUSR99  RETURN 
.------------------------------------------------------------------------------
. WIES Dollar Value Maintenance      
.------------------------------------------------------------------------------
PMSWDV00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      PMSWDV40 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PMSWDV10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      PMSWDV20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PMSWDV30 IF EQUAL
.
          GOTO      PMSWDV93
.
.         ************ ADD FORMACTION **********
.
PMSWDV10  PACK      KEY8,PMSWD001,SP70
          CALL      RDPMWD1                 * Record Exists?
          COMPARE   ZERO,OVRCD              * Yes, Display error message
          GOTO      PMSWDV91 IF EQUAL
.
          CALL      WDVSAV00                * Save Variables for update
          CALL      WRPMWD1                 * Write record 
.
          MOVE      ZERO,EXIT
          GOTO      PMSWDV99
.
.         ************ UPDATE FORMACTION **********
.
PMSWDV20  PACK      KEY8,PMSWD001,SP70
          CALL      RDPMWD1                 * Record Exists?
          BRANCH    OVRCD,PMSWDV92          * No, Display error message
.
          CALL      WDVSAV00                * Save Variables for update
          CALL      UPPMWD1                 * Update record 
.
          MOVE      ZERO,EXIT
          GOTO      PMSWDV99
.
.         ************ DELETE FORMACTION **********
.
PMSWDV30  PACK      KEY8,PMSWD001,SP70
          CALL      RDPMWD1                 * Record Exists?
          BRANCH    OVRCD,PMSWDV92          * No, Display error message
.
          CALL      DEPMWD1                 * Delete record 
.
          MOVE      ZERO,EXIT
          GOTO      PMSWDV99
.
.         ************ DISPLAY FORMACTION **********
.
PMSWDV40  PACK      KEY8,PMSWD001,SP70 
          CALL      RDPMWD1 
          IF        OVRCD=1
            CALL      CLRWDV00              * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "WIES Dollar Value Maintenance",WEBTITLE                
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,PMSWDV99
.
          CALL      WEBBOD00                * Process Web Body
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PMSWDV99
.
.         ************ DISPLAY ERROR MESSAGE **********
.
PMSWDV91  MOVE      "WIES Dollar Value record already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSWDV99
.
PMSWDV92  MOVE      "WIES Dollar Value record does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSWDV99
.
PMSWDV93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSWDV99
.
PMSWDV99  RETURN
.
.------------------------------------------------------------------------------
. WIES Weights 
.------------------------------------------------------------------------------
PATWIE00  RESET     UPDTTYPE
.
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      PATWIE20 IF EQUAL
.
          GOTO      PATWIE93
.
.         ************ DISPLAY FORMACTION **********
.
PATWIE20  PACK      PATWI002,PATWI002,SP70
          MATCH     SP70,PATWI002
          GOTO      PATWIE40 IF EQUAL
.
          PACK      KEY7,PATWI001,PATWI002,SP70
          CALL      RDPTWIE1
          BRANCH    OVRCD,PATWIE91
.
PATWIE40  CLEAR     WEBTITLE
          MOVE      "WIES Weights Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,PATWIE99
.
          CALL      WEBBOD00                * Process Web Body
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PATWIE99
.
PATWIE91  MOVE      "WIES Weights record doesn't exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATWIE99
.
PATWIE93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATWIE99
.
PATWIE99  RETURN
+
.------------------------------------------------------------------------------
. Restricted Diagnosis Codes for Grouping
.------------------------------------------------------------------------------
PATRDC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      PATRDC40 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PATRDC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      PATRDC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PATRDC30 IF EQUAL
.
          GOTO      PATRDC93
.
.         ************ ADD FORMACTION **********
.
PATRDC10  PACK      KEY11,PATRD001,PATRD003,SP70
          CALL      RDPTRDC1                * Record Exists?
          COMPARE   ZERO,OVRCD              * Yes, Display error message
          GOTO      PATRDC91 IF EQUAL
.
          CALL      RDCSAV00                * Save Variables
          CALL      WRPTRDC1                * Write record
.
          MOVE      ZERO,EXIT
          GOTO      PATRDC99
.
.         ************ UPDATE FORMACTION **********
.
PATRDC20  PACK      KEY11,PATRD001,PATRD003,SP70
          CALL      RDPTRDC1                * Record Exists?
          BRANCH    OVRCD,PATRDC92          * No, Display error message
.
          CALL      RDCSAV00                * Save Variables
          CALL      UPPTRDC1                * Write record
.
          MOVE      ZERO,EXIT
          GOTO      PATRDC99
.
.         ************ DELETE FORMACTION **********
.
PATRDC30  PACK      KEY11,PATRD001,PATRD003,SP70
          CALL      RDPTRDC1                * Record Exists?
          BRANCH    OVRCD,PATRDC92          * No, Display error message
.
          CALL      DEPTRDC1                * Write record
.
          MOVE      ZERO,EXIT
          GOTO      PATRDC99
.
.         ************ DISPLAY FORMACTION **********
.
PATRDC40  PACK      KEY11,PATRD001,PATRD003,SP70
          CALL      RDPTRDC1
          IF        OVRCD=1
            MOVE      SP70,PTRCCODE
            MOVE      SP70,PTRCDESC
            MOVE      SP70,PTRCVRSN
            MOVE      SP70,PTRCSPAR
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Restrict Diagnosis Codes for Grouping",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,PATRDC99
.
          CALL      WEBBOD00                * Process Web Body
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PATRDC99
.
.         ************ DISPLAY ERROR MESSAGE **********
.
PATRDC91  MOVE      "Record already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATRDC99
.
PATRDC92  MOVE      "Record does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATRDC99
.
PATRDC93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATRDC99
.
PATRDC99  RETURN
+
.------------------------------------------------------------------------------
. Initialize's file data (WIES Dollar Value Maintenance)         
.------------------------------------------------------------------------------
CLRWDV00  MOVE      SP70,PMWDDATE  * WIES Dollar Effective Date
          MOVE      ZERO,PMWDVALU  * WIES Dollar Value
          MOVE      SP70,PMWDCDTE  * Create Date
          MOVE      SP70,PMWDCTIM  * Create Time
          MOVE      SP70,PMWDCUSR  * Create Web User ID
          MOVE      SP70,PMWDUDTE  * Update Date
          MOVE      SP70,PMWDUTIM  * Update Time
          MOVE      SP70,PMWDUUSR  * Update Web User ID
          MOVE      SP70,PMWDSPAR  * Spare
.
CLRWDV99  RETURN
.------------------------------------------------------------------------------
. Moves cgi variables into file variables (WIES Dollar Value Maintenance) 
.------------------------------------------------------------------------------
WDVSAV00  MOVE      PMSWD001,PMWDDATE  * WIES Dollar Effective Date
          MOVE      PMSWD002,PMWDVALU  * WIES Dollar Value
.
          MATCH     "A",UPDTTYPE
          IF        @EQUAL
            PACK      PMWDCDTE,CCC,CYY,CMM,CDD
            REP       " 0",PMWDCDTE
            MOVE      CTIMEIS,PMWDCTIM  * Create Time
            MOVE      USERID,PMWDCUSR   * Create Web User ID
            MOVE      SP70,PMWDUDTE     * Update Date
            MOVE      SP70,PMWDUTIM     * Update Time
            MOVE      SP70,PMWDUUSR     * Update Web User ID
          ELSE
            PACK      PMWDUDTE,CCC,CYY,CMM,CDD
            REP       " 0",PMWDUDTE
            MOVE      CTIMEIS,PMWDUTIM  * Create Time
            MOVE      USERID,PMWDUUSR   * Create Web User ID
          ENDIF
.
WDVSAV99  RETURN
+
.------------------------------------------------------------------------------
. Moves cgi vars into file variables (Restricted Diagnosis Codes Maintenance)
.------------------------------------------------------------------------------
RDCSAV00  MOVE      PATRD001,PTRCCODE  * ICD 10 Diagnosis Code
          MOVE      PATRD002,PTRCDESC  * ICD 10 Diagnosis Description
          MOVE      PATRD003,PTRCVRSN  * ICD 10 Version
RDCSAV99  RETURN
+
.------------------------------------------------------------
. Research Extract Patient List
.------------------------------------------------------------
LSTRES00  BRANCH    FLDITMNO,LSTRES10,LSTRES20,LSTRES30,LSTRES40
.
          GOTO      LSTRES99
.
LSTRES10  CALL      RESLST00                * Patient Edit List
          GOTO      LSTRES99
.
LSTRES20  CALL      NEXTRS00                * next set of research patients
          GOTO      LSTRES99
.
LSTRES30  CALL      PREVRS00                * previous set of research patients 
          GOTO      LSTRES99
.
LSTRES40  CALL      RESLTT00                * Calculate Total
          WRITE     HTMLFILE;RECTOTAL;
          GOTO      LSTRES99
.
LSTRES99  RETURN
.-----------------------------------------------------------------------------
. WIES Dollar Value File 
.-----------------------------------------------------------------------------
WIED0000  BRANCH    FLDITMNO,WIED0100,WIED0200,WIED0300,WIED0400,WIED0500
          GOTO      WIED9999
.
WIED0100  UNPACK    PMWDDATE,CCENT,CYEAR,CMON,CDAY  * WIES Dollar Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR; 
          GOTO      WIED9999
.
WIED0200  COMPARE   ZERO,PMWDVALU         * WIES Dollar Value
          GOTO      WIED9999 IF EQUAL
          WRITE     HTMLFILE;PMWDVALU;
          GOTO      WIED9999
.
WIED0300  CALL      WIETB000              * WIES Dollar Value Table             
          GOTO      WIED9999
.
WIED0400  CALL      NEXT0000              * Next set of records 
          GOTO      WIED9999
.
WIED0500  CALL      PREV0000              * Previous set of records
          GOTO      WIED9999
.
WIED9999  RETURN
.
.-----------------------------------------------------------------------------
. WIES Weights 
.-----------------------------------------------------------------------------
WIEW0000  BRANCH    FLDITMNO,WIEW0100,WIEW0200,WIEW0300,WIEW0400,WIEW0500:
                             WIEW0600,WIEW0700,WIEW0800,WIEW0900,WIEW1000:
                             WIEW1100,WIEW1200,WIEW1300,WIEW1400,WIEW1500:
                             WIEW1600,WIEW1700,WIEW1800,WIEW1900,WIEW2000:
                             WIEW2100
.
          GOTO      WIED9999
.
WIEW0100  WRITE     HTMLFILE;PTWIDRGC;
          GOTO      WIED9999
.
WIEW0200  WRITE     HTMLFILE;PTWIDRGD;
          GOTO      WIED9999
.
WIEW0300  WRITE     HTMLFILE;PTWIVRSN;
          GOTO      WIED9999
.
WIEW0400  WRITE     HTMLFILE;PTWISDMT;
          GOTO      WIED9999
.
WIEW0500  WRITE     HTMLFILE;PTWIMVEL;
          GOTO      WIED9999
.
WIEW0600  WRITE     HTMLFILE;PTWICPAY;
          GOTO      WIED9999
.
WIEW0700  WRITE     HTMLFILE;PTWILIBP;
          GOTO      WIED9999
.
WIEW0800  WRITE     HTMLFILE;PTWIHIBP;
          GOTO      WIED9999
.
WIEW0900  WRITE     HTMLFILE;PTWIILOS;
          GOTO      WIED9999
.
WIEW1000  WRITE     HTMLFILE;PTWISDOD;
          GOTO      WIED9999
.
WIEW1100  WRITE     HTMLFILE;PTWITDSW;
          GOTO      WIED9999
.
WIEW1200  WRITE     HTMLFILE;PTWITODW;
          GOTO      WIED9999
.
WIEW1300  WRITE     HTMLFILE;PTWITLOM;
          GOTO      WIED9999
.
WIEW1400  WRITE     HTMLFILE;PTWITIMW;
          GOTO      WIED9999
.
WIEW1500  WRITE     HTMLFILE;PTWITHOM;
          GOTO      WIED9999
.
WIEW1600  WRITE     HTMLFILE;PTWITHIH;
          GOTO      WIED9999
.
WIEW1700  CALL      WIELS000              * WIES Weights List
          GOTO      WIED9999
.
WIEW1800  CALL      NEXT0000              * Next set of records
          GOTO      WIED9999
.
WIEW1900  CALL      PREV0000              * Previous set of records
          GOTO      WIED9999
.
WIEW2000  WRITE     HTMLFILE;PTWISSDR;
          GOTO      WIED9999
.
WIEW2100  WRITE     HTMLFILE;PTWISSWT;
          GOTO      WIED9999
.
WIEW9999  RETURN
+
.-----------------------------------------------------------------------------
. Restricted Diagnosis Codes Maintenance
.-----------------------------------------------------------------------------
RDCM0000  BRANCH    FLDITMNO,RDCM0100,RDCM0200,RDCM0300,RDCM0400,RDCM0500:
                             RDCM0600
.
          GOTO      RDCM9999
.
RDCM0100  WRITE     HTMLFILE;PTRCCODE;
          GOTO      RDCM9999
.
RDCM0200  WRITE     HTMLFILE;PTRCDESC;
          GOTO      RDCM9999
.
RDCM0300  WRITE     HTMLFILE;PTRCVRSN;
          GOTO      RDCM9999
.
RDCM0400  CALL      RDCLS000              * Restricted Diagnosis Codes List
          GOTO      RDCM9999
.
RDCM0500  CALL      NEXT0000              * Next set of records
          GOTO      RDCM9999
.
RDCM0600  CALL      PREV0000              * Previous set of records
          GOTO      RDCM9999
.
RDCM9999  RETURN
+
.------------------------------------------------------------
. Medical Record Requests by a USER
.------------------------------------------------------------
MRUT0000  BRANCH    FLDITMNO,MRUT1000,MRUT2000,MRUT3000,MRUT4000,MRUT5000:
                             MRUT6000,MRUT7000
          GOTO      MRUT9999
.
MRUT1000  CALL      RESTB000
          GOTO      MRUT9999
.
MRUT2000  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      MRUT9999
.
MRUT3000  CALL      PREVRD00
          GOTO      MRUT9999
.
MRUT4000  CALL      NEXTRD00
          GOTO      MRUT9999
.
MRUT5000  CALL      SELV0000
          GOTO      MRUT9999
.
MRUT6000  CALL      RRBDT000
          GOTO      MRUT9999
.
MRUT7000  WRITE     HTMLFILE;BYREQDAT;
          GOTO      MRUT9999
.
MRUT9999  RETURN
.------------------------------------------------------------
.  Record Request Details
.------------------------------------------------------------
RCRQ0000  BRANCH    FLDITMNO,RCRQ0100,RCRQ0200
          GOTO      RCRQ9999
.
RCRQ0100  PACK      KEY7,SP70      * Displays list of Home Locations  *C-240724
          CALL      RDMRLOC1
RCRQ0110  CALL      RKMRLOC1
          BRANCH    OVRCD,RCRQ9999
          COMPARE   MRLOSTAT,ONE
          IF        @EQUAL
            GOTO      RCRQ0110
          ENDIF
          MATCH     MRLOTYPE,MRCNHMTY
          GOTO      RCRQ0110 IF NOT EQUAL
          PACK      KEY15,QUOTE,MRLOCODE,SP5,QUOTE
          MATCH     MRLOCODE,HOMELOCT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY15," selected>":
                               MRLODESC,"</option>"
          ELSE
            IF        IBCNMHOS=1
              MATCH     WBSEHOSP,MRLOHOSP
              GOTO      RCRQ0110 IF NOT EQUAL
            ENDIF
            WRITE     HTMLFILE;"<option value=",KEY15,">",MRLODESC,"</option>"
          ENDIF
          GOTO      RCRQ0110
.
RCRQ0200  RESET     DOCUTYPE
          MOVE      "TY",CATEGORY           * Selection List of Documents
          MOVE      DOCUTYPE,CODE
          CALL      CODITM00
          GOTO      RCRQ9999
.
RCRQ9999  RETURN
+
.------------------------------------------------------------
. Table of Medical Record Requests/Reservations by User ID
.------------------------------------------------------------
RESTB000  PACK      KEY20,WBSEUID,SP70
          CALL      RSMRRQH4
RESTB100  CALL      RKMRRQH4
          BRANCH    OVRCD,RESTB999
          MATCH     WBSEUID,MRRQUSID
          GOTO      RESTB999 IF NOT EQUAL
.
          PACK      KEY20,MRRQRQNO,SP70
          CALL      RSMRRQD1
RESTB150  CALL      RKMRRQD1
          BRANCH    OVRCD,RESTB100
.
          MATCH     MRRQRQNO,MRRDRQNO
          GOTO      RESTB100 IF NOT EQUAL
.
          MOVE      SP70,MRLODESC
          PACK      KEY7,MRRQHOSC,MRRQLOCR                            *C-240724
          CALL      RDMRLOC1
.
RESTB200  MOVE      SP70,MRMODESC
          MOVE      MRRQMOVR,KEY4
          CALL      RDMRMOV1
.
          MOVE      "QU",CATEGORY
          MOVE      MRRQURGY,CODE
          MOVE      SP70,URGYCODE
          CALL      GETCOD00
          MOVE      TDESC,URGYCODE
.
          PACK      KEY10,MRRDRKEY,SP70
          CALL      RDMRMAS2
          BRANCH    OVRCD,RESTB100
.
          MATCH     SP70,HOMELOCT
          IF        !@EQUAL
            IF        IBCNMHOS = 1
              MATCH     HOMEHOSP,MRMAHHOS
              GOTO      RESTB100 IF NOT EQUAL
            ENDIF
            MATCH     HOMELOCT,MRMAHLOC
            GOTO      RESTB100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,DOCUTYPE
          IF        !@EQUAL
            MATCH     DOCUTYPE,MRMADOTY
            GOTO      RESTB100 IF NOT EQUAL
          ENDIF
.
RESTB300  MOVE      SP70,HOSPID01                           * start   *I-248696
          IF        IBCNMHOS = 1
            PACK      HOSPID01,OBB,MRRQHOSC,CBB  * set default to black
            MATCH     MRMAHHOS,MRRQHOSC
            IF        !@EQUAL
              MOVE      SP3,PTHSHHOS
              PACK      KEY3,MRRQHOSC
              CALL      RDPTHSP1
              MATCH     PTHSHHOS,MRMAHHOS
              IF        !@EQUAL
                PACK      HOSPID01,OBR,MRRQHOSC,CBR     * red
              ELSE
                UNPACK    SP20,TCINDC1,TCINDC2,TCINDC3,TCINDC4
                PACK      KEY5,CATTY,PTHSRCTY                         *C-259106
                CALL      RDCODE1
                MATCH     "B",TCINDC1                       
                IF        !@EQUAL
                  PACK      HOSPID01,OBR,MRRQHOSC,CBR   * red
                ENDIF
              ENDIF
            ENDIF
          ENDIF                                             * end     *I-248696
.
          MOVE      SP70,KEY50
          PACK      PRESDETS,SP70,SP70                                 *I-44792
          COMPARE   ONE,PTCNRQCF       * Using Free Format Requester
          IF        @EQUAL
            MOVE      MRRQPERS,KEY50   * Requested By Free Format
            CALL      GTRQX000         *  request get pager,ext details*I-44792
          ELSE
            UNPACK    MRRQPERS,KEY6  * Requested By (Using Staff Code)
            CALL      RDMRSTF1
            IF        OVRCD=0
              PACK      KEY50,MRSTGNAM,SP1,MRSTSNAM,SP70
              CALL      GTRQX000       *  request get pager,ext details*I-44792
            ENDIF
          ENDIF
.
          PACK      KEY8,MRMAURNO
          CALL      RDMAST1
          BRANCH    OVRCD,RESTB100
.
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          MOVE      DSEXDESC,DISPSEX
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          REP       " 0",AGEDATE
          CALL      CALCAGE
.
          CLEAR     HTMLLINK
          APPEND    "javascript:RequestLink('",HTMLLINK
          APPEND    MRRDRQNO,HTMLLINK
          APPEND    MRRDRKEY,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    MRMAURNO,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          CALL      GFILST00
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",MRRQDTRQ,MRRQTMRQ,"#",":
                             "#"",MRRQDAYE,MRRQTIYM,"#",":
                             "#"",HOSPID01,MRLODESC,"#",":            *C-248696
                             "#"",MRRQCOMM,"#",":
                             "#"",PRESDETS,"#",":                      *C-44792
                             "#"",MRMODESC,"#",":
                             "#"",FILLSTAT,"#",":
                             "#"",URGYCODE,"#",":
                             "#"",MRRQEXTN,"#",":
                             "#"",MRRQPAGE,"#",":
                             "#"",PSNAME,COMMA,PGNAME,COMMA,PTITL:
                             ",",PURNO,",",PSAGEYRS,",",DISPSEX,"#");"
.
          GOTO      RESTB150
.
RESTB999  RETURN
+
.------------------------------------------------------------------------------
. Table of Medical Record Requests/Reservations by Date Required
.------------------------------------------------------------------------------
RRBDT000  PACK      KEY23,FRSTDATE,SP70
          CALL      RSMRRQH2
RRBDT100  CALL      RKMRRQH2
          BRANCH    OVRCD,RRBDT999
.
          MATCH     MRRQDTRQ,LASTDATE
          GOTO      RRBDT999 IF LESS
.
          PACK      KEY20,MRRQRQNO,SP70
          CALL      RSMRRQD1
RRBDT150  CALL      RKMRRQD1
          BRANCH    OVRCD,RRBDT100
.
          MATCH     MRRQRQNO,MRRDRQNO
          GOTO      RRBDT100 IF NOT EQUAL
.
          MOVE      SP70,MRLODESC
          PACK      KEY7,MRRQHOSC,MRRQLOCR
          CALL      RDMRLOC1
.
RRBDT200  MOVE      SP70,MRMODESC
          MOVE      MRRQMOVR,KEY4
          CALL      RDMRMOV1
.
          MOVE      "QU",CATEGORY
          MOVE      MRRQURGY,CODE
          MOVE      SP70,URGYCODE
          CALL      GETCOD00
          MOVE      TDESC,URGYCODE
.
          PACK      KEY10,MRRDRKEY,SP70
          CALL      RDMRMAS2
          BRANCH    OVRCD,RRBDT100
.
          MATCH     SP70,HOMELOCT
          IF        !@EQUAL
            IF        IBCNMHOS = 1
              MATCH     HOMEHOSP,MRMAHHOS
              GOTO      RRBDT100 IF NOT EQUAL
            ENDIF
            MATCH     HOMELOCT,MRMAHLOC
            GOTO      RRBDT100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,DOCUTYPE
          IF        !@EQUAL
            MATCH     DOCUTYPE,MRMADOTY
            GOTO      RRBDT100 IF NOT EQUAL
          ENDIF
.
RRBDT300  MOVE      SP70,HOSPID01
          IF        IBCNMHOS = 1
            PACK      HOSPID01,OBB,MRRQHOSC,CBB  * set default to black
            MATCH     MRMAHHOS,MRRQHOSC
            IF        !@EQUAL
              MOVE      SP3,PTHSHHOS
              PACK      KEY3,MRRQHOSC
              CALL      RDPTHSP1
              MATCH     PTHSHHOS,MRMAHHOS
              IF        !@EQUAL
                PACK      HOSPID01,OBR,MRRQHOSC,CBR     * red
              ELSE
                UNPACK    SP20,TCINDC1,TCINDC2,TCINDC3,TCINDC4
                PACK      KEY5,CATTY,PTHSRCTY
                CALL      RDCODE1
                MATCH     "B",TCINDC1                       
                IF        !@EQUAL
                  PACK      HOSPID01,OBR,MRRQHOSC,CBR   * red
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      SP70,KEY50
          PACK      PRESDETS,SP70,SP70
          COMPARE   ONE,PTCNRQCF       * Using Free Format Requester
          IF        @EQUAL
            MOVE      MRRQPERS,KEY50   * Requested By Free Format
            CALL      GTRQX000         *  request get pager,ext details
          ELSE
            UNPACK    MRRQPERS,KEY6  * Requested By (Using Staff Code)
            CALL      RDMRSTF1
            IF        OVRCD=0
              PACK      KEY50,MRSTGNAM,SP1,MRSTSNAM,SP70
              CALL      GTRQX000       *  request get pager,ext details
            ENDIF
          ENDIF
.
          PACK      KEY8,MRMAURNO
          CALL      RDMAST1
          BRANCH    OVRCD,RRBDT100
.
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           * returns DSEXDESC & DSEXNO
          MOVE      DSEXDESC,DISPSEX
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          REP       " 0",AGEDATE
          CALL      CALCAGE
.
          CLEAR     HTMLLINK
          APPEND    "javascript:RequestLink('",HTMLLINK
          APPEND    MRRDRQNO,HTMLLINK
          APPEND    MRRDRKEY,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    MRMAURNO,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          CALL      GFILST00
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",MRRQDTRQ,MRRQTMRQ,"#",":
                             "#"",MRRQDAYE,MRRQTIYM,"#",":
                             "#"",HOSPID01,MRLODESC,"#",":
                             "#"",MRRQCOMM,"#",":
                             "#"",PRESDETS,"#",":
                             "#"",MRMODESC,"#",":
                             "#"",FILLSTAT,"#",":
                             "#"",URGYCODE,"#",":
                             "#"",MRRQEXTN,"#",":
                             "#"",MRRQPAGE,"#",":
                             "#"",PSNAME,COMMA,PGNAME,COMMA,PTITL:
                             ",",PURNO,",",PSAGEYRS,",",DISPSEX,"#");"
.
          GOTO      RRBDT150
.
RRBDT999  RETURN
+
.------------------------------------------------------------
. Get the pager and extension if there is one.                         *I-44792
.------------------------------------------------------------
GTRQX000  PACK      PRESDETS,SP70,SP70
          PACK      PRESDETS,KEY50
          STRIP     PRESDETS
.
.... I-51445 if using staff code for requester, it needs to have
.... value to get ext.no and pager no displayed
          COMPARE   ONE,PTCNRQCF       * Using Free Format Requester
          IF        !@EQUAL
            MATCH     SP20,KEY50         * check for 20 spaces.
            GOTO      GTRQX999 IF EQUAL
          ENDIF
.
          MATCH     SP20,MRRQEXTN
          IF        !@EQUAL
            PACK      PRESDETS,PRESDETS,EXTNTXT,MRRQEXTN
            STRIP     PRESDETS
          ENDIF
.
          MATCH     SP20,MRRQPAGE
          IF        !@EQUAL
            PACK      PRESDETS,PRESDETS,PAGERTXT,MRRQPAGE
            STRIP     PRESDETS
          ENDIF
.
GTRQX999  RETURN
.
GFILST00  MOVE      SP70,FILLSTAT
          MATCH     "Y",MRRDFILL
          IF        @EQUAL
            MOVE      "Filled",FILLSTAT
          ENDIF
          MATCH     "N",MRRDFILL
          IF        @EQUAL
            MOVE      "Not Filled",FILLSTAT
          ENDIF
          MATCH     "P",MRRDFILL
          IF        @EQUAL
            MOVE      "Processing",FILLSTAT
          ENDIF
          MATCH     "C",MRRDFILL
          IF        @EQUAL
            MOVE      "Canceled",FILLSTAT
          ENDIF
GFILST99  RETURN
.------------------------------------------------------------
. Research Patient List
.------------------------------------------------------------
RESLST00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      RESHD000                * Patient List Table Heading
.
          IF        NORECORD=0
            MOVE      "14",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY4,MRTRE001,SP70
          CALL      RDMRREX1   
          BRANCH    OVRCD,RESLST99
.
          PACK      KEY20,MRTRE001,SP70
          CALL      RSMRED3 
RESLST10  CALL      RKMRED3 
          BRANCH    OVRCD,RESLST99
.
          MATCH     MRTRE001,MREDEID
          GOTO      RESLST99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RESLST10
          ENDIF
.
          CALL      RESROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RESLST10 IF NOT EQUAL
.
RESLST99  RETURN 
.------------------------------------------------------------
.  Table Patient Research Extract Tables (TABLE HEADING)
.------------------------------------------------------------
RESHD000  WRITE     HTMLFILE;"<tr>":
                              "<td class=HeadingCell width=8%>U/R Number</td>":
                              "<td class=HeadingCell width=30%>Patient</td>":
                              "<td class=HeadingCell width=15%>Discharge Date":
                              "</td>":
                              "<td class=HeadingCell width=8%>Deleted</td>":
                             "</tr>"
RESHD999  RETURN
.------------------------------------------------------------
. Read patient details and write the patient row to HTMLFILE
.------------------------------------------------------------
RESROW00  PACK      KEY8,MREDVIS,SP70
          CALL      RDMISS1
          IF        OVRCD=1
            MOVE      "Invalid Admission",FORMATNM
          ENDIF
.
          PACK      KEY8,AURNO,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            MOVE      "Invalid U/R",FORMATNM
          ELSE
            MOVE      AURNO,URNUMBER
            IF        PCEASE=1
              MOVE      PDECDTE,AGEDATE            * Date of Death
            ELSE
              PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
            ENDIF
            REP       " 0",AGEDATE
            CALL      CALCAGE
            CALL      PATLN000
          ENDIF
.
          PACK      KEY8,AADMNO,SP70
          CALL      RDDSCH1
          IF        OVRCD=1
            MOVE      "&nbsp;",DISPDATE
          ELSE
            UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          PACK      KEY4,PTMIPDRG,SP70
          PACK      KEY7,KEY4,LAST,SP20     * last DRG version        *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          IF        OVRCD=1
            MOVE      SP70,PTDWDESC 
          ELSE
            MATCH     PTDWDRGC,KEY4                                   *I-137125
            IF        !@EQUAL
              MOVE      SP70,PTDWDESC                                 *I-137125
            ENDIF
          ENDIF
.
          MOVE      MREDVIS,ADMISSNO
          REP       " +",ADMISSNO
          REP       " +",URNUMBER
.  
          WRITE     HTMLFILE;"<td nowrap><A HREF='",LINKPRG,".pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO,"'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              MREDURNO,"</td>":
                              "<td>",MREDVIS," - ",FORMATNM,"</td>":
                              "<td>",DISPDATE,"</td>";
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
          MOVE      TWO,EXTRTYPE
          MATCH     "1",MREDDEL
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><input type=checkbox name=mrted010":
                               " value=1 onclick=#"DeletePatient05(this":
                               ",'",MREDEID,"','",MREDVIS,"','",EXTRTYPE,"'":
                               ");#" checked></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=mrted010":
                               " value=1 onclick=#"DeletePatient05(this":
                               ",'",MREDEID,"','",MREDVIS,"','",EXTRTYPE,"'":
                               ");#"></td>";
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
RESROW99  RETURN
+
.-----------------------------------------------------------
. Link to Next Group of records
.-----------------------------------------------------------
NEXT0000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
          REP       "'~",STARTKEY
.
          WRITE     HTMLFILE;"mrtweb03.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "~'",STARTKEY
.
NEXT9999  RETURN
+
.-------------------------------------------------------------
. Link to Prev Group of records
.-------------------------------------------------------------
PREV0000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
          REP       "'~",STARTKEY
.
          WRITE     HTMLFILE;"mrtweb03.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "~'",STARTKEY
.
PREV9999  RETURN
+
.-----------------------------------------------------------
. Link to Next Group of research patients
.-----------------------------------------------------------
NEXTRS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",MRTRE001  
.
          WRITE     HTMLFILE;"mrtweb03.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&mrtre001=",MRTRE001;
.
          REP       "+ ",MRTRE001  
.
NEXTRS99  RETURN
+
.-------------------------------------------------------------
. Link to Prev Group of research patients
.-------------------------------------------------------------
PREVRS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",MRTRE001   
.
          WRITE     HTMLFILE;"mrtweb03.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&mrtre001=",MRTRE001;
.
          REP       "+ ",MRTRE001
.
PREVRS99  RETURN
+
.------------------------------------------------------------------------------
. Link to Next group of Medical Record Requests (by Date Request Required)
.------------------------------------------------------------------------------
NEXTRD00  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;"mrtweb03.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&viewtype=",VIEWTYPE:
                             "&byreqdat=",BYREQDAT;
.
NEXTRD99  RETURN
+
.------------------------------------------------------------------------------
. Link to Prev group of Medical Record Requests (by Date Request Required)
.------------------------------------------------------------------------------
PREVRD00  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;"mrtweb03.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&viewtype=",VIEWTYPE:
                             "&byreqdat=",BYREQDAT;
.
PREVRD99  RETURN
+
.-------------------------------------------------------------
. Total number of selected patients in research extract
.-------------------------------------------------------------
RESLTT00  MOVE      ZERO,RECTOTAL
          PACK      KEY12,MRTRE001,SP70
          CALL      RSMRED1
RESLTT10  CALL      RKMRED1
          BRANCH    OVRCD,RESLTT99
.
          MATCH     MRTRE001,MREDEID
          GOTO      RESLTT99 IF NOT EQUAL
.
          ADD       ONE,RECTOTAL
          GOTO      RESLTT10
.
RESLTT99  RETURN
.------------------------------------------------------------
. Table of WIES Dollar Value Records 
.------------------------------------------------------------
WIETB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      WIEHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,SP70
          CALL      RSPMWD1 
WIETB100  CALL      RKPMWD1
          BRANCH    OVRCD,WIETB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      WIETB100
          ENDIF
.
          CALL      WIERW000      * Display Register Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      WIETB100 IF NOT EQUAL
          GOTO      WIETB999
.
WIETB900  CALL      NOMORE00      * Display No More Records Message
.
WIETB999  RETURN
.------------------------------------------------------------
. WIES Dollar Value Maintenance (TABLE HEADING)
.------------------------------------------------------------
WIEHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Effective Date":
                             "</td>":
                             "<td class=HeadingCell>Amount":
                             "</td></tr>"
.
WIEHD999  RETURN
.------------------------------------------------------------
. WIES Dollar Value Maintenance (TABLE ROW)
.------------------------------------------------------------
WIERW000  UNPACK    PMWDDATE,CCENT,CYEAR,CMON,CDAY * WIES Dollar Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR 
.
          COMPARE   ZERO,PMWDVALU
          IF        @EQUAL
            MOVE      "&nbsp;",DIM8 
          ELSE
            MOVE      PMWDVALU,DIM8
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmswd001=",PMWDDATE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY11,"</td>":
                             "<td>",DIM8,"</td>":
                             "</tr>"
.
WIERW999  RETURN
+
.------------------------------------------------------------
. Table of WIES Weights Records
.------------------------------------------------------------
WIELS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      WIEHE000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY7,STARTKEY,SP70
          CALL      RSPTWIE1
          IF        OVRCD=0
            CALL      RPPTWIE1
          ENDIF
WIELS100  CALL      RKPTWIE1
          BRANCH    OVRCD,WIELS999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      WIELS100
          ENDIF
.
          CALL      WIELN000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      WIELS100 IF NOT EQUAL
.
WIELS999  RETURN
.------------------------------------------------------------
. WIES Weights Maintenance (TABLE HEADING)
.------------------------------------------------------------
WIEHE000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>DRG Code":
                             "</td>":
                             "<td class=HeadingCell>Description":
                             "</td>":
                             "<td class=HeadingCell>WIES Version":
                             "</td></tr>"
.
WIEHE999  RETURN
.------------------------------------------------------------
. WIES Weights Maintenance (TABLE ROW)
.------------------------------------------------------------
WIELN000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&patwi001=",PTWIDRGC:
                             "&patwi002=",PTWIVRSN,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTWIDRGC,"</td>":
                             "<td>",PTWIDRGD,"</td>":
                             "<td>",PTWIVRSN,"</td>":
                             "</tr>"
.
WIELN999  RETURN
+
.------------------------------------------------------------
. Table of Restricted Diagnosis Codes
.------------------------------------------------------------
RDCLS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      RDCHE000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY11,STARTKEY,SP70
          CALL      RSPTRDC1
          IF        OVRCD=0
            CALL      RPPTRDC1
          ENDIF
RDCLS100  CALL      RKPTRDC1
          BRANCH    OVRCD,RDCLS999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RDCLS100
          ENDIF
.
          CALL      RDCLN000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RDCLS100 IF NOT EQUAL
.
RDCLS999  RETURN
.------------------------------------------------------------
. Restricted Diagnosis Codes (TABLE HEADING)
.------------------------------------------------------------
RDCHE000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Code":
                             "</td>":
                             "<td class=HeadingCell>Description":
                             "</td>":
                             "<td class=HeadingCell>ICD Version":
                             "</td></tr>"
.
RDCHE999  RETURN
.------------------------------------------------------------
. Restricted Diagnosis Codes (TABLE ROW)
.------------------------------------------------------------
RDCLN000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&patrd001=",PTRCCODE:
                             "&patrd003=",PTRCVRSN,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTRCCODE,"</td>":
                             "<td>",PTRCDESC,"</td>":
                             "<td>",PTRCVRSN,"</td>":
                             "</tr>"
.
RDCLN999  RETURN
+
.*****************************************************************************
.*  GETALTID
.*  Procedure to get an alternate ID
.*  Exit=0  No alternate ID
.*       1  Alternate ID's exist
.*****************************************************************************
          DEFPROC   GETALIDS
.
          INC       PMSAIDFD/INC
.         
          MOVE      ZERO,EXIT
          PACK      KEY20,SP70
          OPEN      PMSAIDA1,"pmsaidaf"
.         
          PACK      KEY31,PURNO,SP70
          CALL      RSPMAID1           * Read alternate id Table
GETALI10  CALL      RKPMAID1
          BRANCH    OVRCD,GETALI99
.         
          MATCH     PURNO,PMAIURNO     * Check same UR
          GOTO      GETALI99 IF NOT EQUAL
.         
          MATCH     "1",PMAIDISU            
          GOTO      GETALI10 IF NOT EQUAL
.
          PACK      KEY20,PMAIALID,SP70
          MOVE      ONE,EXIT
          GOTO      GETALI99
.
          INC       PMSAIDIO/INC
          INC       IBAOVRIO/INC
.
GETALI99  CLOSE     PMSAIDA1
.
          ENDPROC
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.------------------------------------------------------------
.------------------------------------------------------------
.
          INC       IBAWEBCD
          INC       WEBDATCD
          INC       RSHWEBCD
          INC       CLMRTEXT
          INC       MRTEPSIO/INC
          INC       MRTEXTIO/INC
          INC       MRTTHDIO/INC
          INC       PATDO1IO/INC
          INC       PATDGWIO/INC
          INC       PATDSCIO/INC
          INC       PATECDIO/INC
          INC       PATICUIO/INC
          INC       PATMA1IO/INC
          INC       PATMI1IO/INC
          INC       PMSVX1IO/INC
          INC       PATHSPIO/INC
          INC       PATWR1IO/INC
.
          INC       PATALRIO/INC
          INC       PATVISIO/INC   * Patients Visits File
          INC       OUTSITIO/INC
          INC       PATFN1IO/INC
          INC       PATPR1IO/INC
          INC       MRTMASIO/INC
          INC       MRTREXIO/INC
          INC       MRTLOCIO/INC
          INC       PATICDIO/INC
          INC       PATICOIO/INC
          INC       MRTREDIO/INC
          INC       MRTRQDIO/INC
          INC       MRTRQHIO/INC
          INC       MRTMOVIO/INC
          INC       MRTSTFIO/INC
          INC       PMSWDVIO/INC
          INC       PATRDCIO/INC
          INC       PATWIEIO/INC
          INC       MLTSECIO/INC
          INC       WATPROIO/INC
.
          INC       CALCAGE
          INC       PATNAMCD
          INC       PATDOCTM
          INC       NAMSTRCD
          INC       MRTREXTM
          INC       PATDOCCD
          INC       DAYOFWEK
.

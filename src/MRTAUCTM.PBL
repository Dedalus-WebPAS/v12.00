. *----------------------------------------------------------------------
. * Include Name  :   MRTAUCTM.PBL
. *
. * Function      :   CGI variable functions for MRTAUCFD - mrtaucaf.dat
. *
. * Modifications :
. *
. *V11.00.01 16/03/2020   Tracey Nguyen   TSK 0889496
. *          Added MRAUC025/MRACDDNR - Doctor did not respond
. *          Added MRAUC026/MRACOHCP - HCP                       
. *          Added MRAUC027/MRACOCOF - Outcome of change (cat aO)
. *          Added MRAUC028/MRACODAT - Outcome date
. *---------------------------------------------------------------------------
. *V10.11.01 29/07/2017   J.Tan          TSK 0838634
. *          Fixed DRG description
. *V10.04.01 27/03/2014   Peter Vela     CAR 294526
. *          Added MRAUC022 - Original Dollar Value
. *          Added MRAUC023 - New Dollar Value
. *          Added MRAUC024 - Difference in Dollar Value
. * V9.12.01  17/12/2009  Peter McMullen CAR 210130
. *          Convert to newer Dr name format routine DOCNM000
. * V9.08.01  08/05/2007  Mike Laming   CAR 137125 HDP 2007
. *          Add DRG Version to Key fields for reads to PATDGWaf
. * V9.04.01 25/11/2004 Lina Vo                  CAR 34301
. *          Added GETCMM00 for Comments CGI to get from a Textarea field.
. * V9.04.00 19/11/2004 Lina Vo                  CAR 34301
. *          Created include
. *----------------------------------------------------------------------
.------------------------------------------------------------------------
.   Clear parameters for the Coding Audit file
.------------------------------------------------------------------------
CPMRAC00  MOVE      Z70,MRAUC001
          MOVE      Z70,MRAUC002
          MOVE      Z70,MRAUC003
          MOVE      Z70,MRAUC004
          MOVE      Z70,MRAUC005
          MOVE      Z70,MRAUC006
          MOVE      Z70,MRAUC007
          MOVE      Z70,MRAUC008
          MOVE      Z70,MRAUC009
          MOVE      Z70,MRAUC010
          MOVE      Z70,MRAUC011
          MOVE      Z70,MRAUC012
          MOVE      Z70,MRAUC013
          MOVE      Z70,MRAUC014
          MOVE      Z70,MRAUC015
          MOVE      Z70,MRAUC016
          MOVE      Z70,MRAUC017
          MOVE      Z70,MRAUC018
          MOVE      Z70,MRAUC019
          MOVE      Z70,MRAUC020
          MOVE      Z70,MRAUC021
          MOVE      Z70,MRAUC022
          MOVE      Z70,MRAUC023
          MOVE      Z70,MRAUC024
          MOVE      Z70,MRAUC025
          MOVE      Z70,MRAUC026
          MOVE      Z70,MRAUC027
          MOVE      Z70,MRAUC028
.
CPMRAC99  RETURN
.------------------------------------------------------------
. Coding Audit file standard tags
.------------------------------------------------------------
MRAC0000  BRANCH    FLDITMNO,MRAC0010,MRAC0020,MRAC0030,MRAC0040,MRAC0050:
                             MRAC0060,MRAC0070,MRAC0080,MRAC0090,MRAC0100:
                             MRAC0110,MRAC0120,MRAC0130,MRAC0140,MRAC0150:
                             MRAC0160,MRAC0170,MRAC0180,MRAC0190,MRAC0200:
                             MRAC0210,MRAC0220,MRAC0230,MRAC0240,MRAC0250:
                             MRAC0260,MRAC0220,MRAC0280
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MRAC9999
.
MRAC0010  WRITE     HTMLFILE;MRACVISN;
          GOTO      MRAC9999
.
MRAC0020  WRITE     HTMLFILE;MRACEPSN;
          GOTO      MRAC9999
.
MRAC0030  MATCH     MRACADTE,SP70
          GOTO      MRAC9999 IF EQUAL
.
          UNPACK    MRACADTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MRAC9999
.
MRAC0040  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     MRACODRG,SP70
          GOTO      MRAC9999 IF EQUAL
.
          BRANCH    F1,MRAC0041
          WRITE     HTMLFILE;MRACODRG;
          GOTO      MRAC9999
.
MRAC0041  MOVE      MRACODRG,KEY4
          MOVE      "999",KEY3                                        *I-137125
          PACK      KEY7,KEY4,KEY3,SP10                               *C-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1                * find latest description *I-137125
          BRANCH    OVRCD,MRAC9999
.
          MATCH     PTDWDRGC,KEY4           * correct DRG code ?      *I-137125
          IF        @EQUAL    
            WRITE     HTMLFILE;PTDWDESC;
          ENDIF
          GOTO      MRAC9999
.
MRAC0050  WRITE     HTMLFILE;MRACOWIE;
          GOTO      MRAC9999
.
MRAC0060  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     MRACNDRG,SP70
          GOTO      MRAC9999 IF EQUAL
.
          BRANCH    F1,MRAC0061
          WRITE     HTMLFILE;MRACNDRG;
          GOTO      MRAC9999
.
MRAC0061  MOVE      MRACNDRG,KEY4
          MOVE      "999",KEY3                                        *I-137125
          PACK      KEY7,KEY4,KEY3,SP10                               *C-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1                * find latest description *I-137125
          BRANCH    OVRCD,MRAC9999
.
          MATCH     PTDWDRGC,KEY4           * correct DRG code ?      *I-137125
          IF        @EQUAL   
            WRITE     HTMLFILE;PTDWDESC;
          ENDIF
          GOTO      MRAC9999
.
MRAC0070  WRITE     HTMLFILE;MRACNWIE;
          GOTO      MRAC9999
.
MRAC0080  WRITE     HTMLFILE;MRACDWIE;
          GOTO      MRAC9999
.
MRAC0090  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     MRACCLNC,SP70
          GOTO      MRAC9999 IF EQUAL
.
          BRANCH    F1,MRAC0091
          WRITE     HTMLFILE;MRACCLNC;
          GOTO      MRAC9999
.
MRAC0091  MOVE      MRACCLNC,KEY10
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            WRITE     HTMLFILE;DOCFNAME;
          ENDIF
          GOTO      MRAC9999
.
MRAC0100  MOVE      CODEYA,CATEGORY        * Type of Audit              
          MOVE      MRACTYPE,CODE
          CALL      CODITM00
          GOTO      MRAC9999
.
MRAC0110  MOVE      CODEYB,CATEGORY        * Reason for Change        
          MOVE      MRACRCHG,CODE
          CALL      CODITM00
          GOTO      MRAC9999
.
MRAC0120  WRITE     HTMLFILE;MRACNCHG;
          GOTO      MRAC9999
.
MRAC0130  WRITE     HTMLFILE;MRACCOMM;
          GOTO      MRAC9999
.
MRAC0140  MATCH     MRACCDTE,SP70
          GOTO      MRAC9999 IF EQUAL
.
          UNPACK    MRACCDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MRAC9999
.
MRAC0150  WRITE     HTMLFILE;MRACCTIM;
          GOTO      MRAC9999
.
MRAC0160  MATCH     SP70,MRACCUSR
          GOTO      MRAC9999 IF EQUAL
.
          PACK      KEY10,MRACCUSR,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      MRACCUSR,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      MRAC9999
.
MRAC0170  WRITE     HTMLFILE;MRACCDSC;
          GOTO      MRAC9999
.
MRAC0180  MATCH     MRACUDTE,SP70
          GOTO      MRAC9999 IF EQUAL
.
          UNPACK    MRACUDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MRAC9999
.
MRAC0190  WRITE     HTMLFILE;MRACUTIM;
          GOTO      MRAC9999
.
MRAC0200  MATCH     SP70,MRACUUSR
          GOTO      MRAC9999 IF EQUAL
.
          PACK      KEY10,MRACUUSR,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      MRACUUSR,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      MRAC9999
.
MRAC0210  WRITE     HTMLFILE;MRACUDSC;
          GOTO      MRAC9999
.
MRAC0220  WRITE     HTMLFILE;MRACODOL;
          GOTO      MRAC9999
.
MRAC0230  WRITE     HTMLFILE;MRACNDOL;
          GOTO      MRAC9999
.
MRAC0240  WRITE     HTMLFILE;MRACDIFD;
          GOTO      MRAC9999
.
MRAC0250  WRITE     HTMLFILE;MRACDDNR;         * Doctor did not respond
          GOTO      MRAC9999
.
MRAC0260  UNPACK    DIM127,D1,KEY1,DIM127      * HCP 
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     MRACOHCP,SP70
          GOTO      MRAC9999 IF EQUAL
.
          BRANCH    F1,MRAC0261
          WRITE     HTMLFILE;MRACOHCP;
          GOTO      MRAC9999
.
MRAC0261  MOVE      MRACOHCP,KEY10
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            WRITE     HTMLFILE;DOCFNAME;
          ENDIF
          GOTO      MRAC9999
.
MRAC0270  MOVE      CATaO,CATEGORY         * Outcome of change (cat aO)
          MOVE      MRACOCOF,CODE
          CALL      CODITM00
          GOTO      MRAC9999
.
MRAC0280  MATCH     MRACODAT,SP70          * Outcome date
          GOTO      MRAC9999 IF EQUAL
.
          UNPACK    MRACODAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MRAC9999
.
MRAC9999  RETURN
.
.------------------------------------------------------------
.   Set Parameters for the Coding Audit file
.------------------------------------------------------------
SPMRA000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPMRA010,SPMRA020,SPMRA030,SPMRA040,SPMRA050:
                       SPMRA060,SPMRA070,SPMRA080,SPMRA090,SPMRA100:
                       SPMRA110,SPMRA120,SPMRA130,SPMRA140,SPMRA150:
                       SPMRA160,SPMRA170,SPMRA180,SPMRA190,SPMRA200:
                       SPMRA210,SPMRA220,SPMRA230,SPMRA240,SPMRA250:
                       SPMRA260,SPMRA270,SPMRA280
.
          MOVE      ONE,EXIT
          GOTO      SPMRA999
.
SPMRA010  MOVE      QRYDATA,MRAUC001
          GOTO      SPMRA999
.
SPMRA020  MOVE      QRYDATA,MRAUC002
          GOTO      SPMRA999
.
SPMRA030  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MRAUC003,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMRA999
.
SPMRA040  MOVE      QRYDATA,MRAUC004
          GOTO      SPMRA999
.
SPMRA050  MOVE      QRYDATA,MRAUC005
          GOTO      SPMRA999
.
SPMRA060  MOVE      QRYDATA,MRAUC006
          GOTO      SPMRA999
.
SPMRA070  MOVE      QRYDATA,MRAUC007
          GOTO      SPMRA999
.
SPMRA080  MOVE      QRYDATA,MRAUC008
          GOTO      SPMRA999
.
SPMRA090  MOVE      QRYDATA,MRAUC009
          GOTO      SPMRA999
.
SPMRA100  MOVE      QRYDATA,MRAUC010
          GOTO      SPMRA999
.
SPMRA110  MOVE      QRYDATA,MRAUC011
          GOTO      SPMRA999
.
SPMRA120  MOVE      QRYDATA,MRAUC012
          GOTO      SPMRA999
.
SPMRA130  CALL      GETCMM00
          GOTO      SPMRA999
.
SPMRA140  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MRAUC014,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMRA999
.
SPMRA150  MOVE      QRYDATA,MRAUC015
          GOTO      SPMRA999
.
SPMRA160  MOVE      QRYDATA,MRAUC016
          GOTO      SPMRA999
.
SPMRA170  MOVE      QRYDATA,MRAUC017
          GOTO      SPMRA999
.
SPMRA180  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MRAUC018,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMRA999
.
SPMRA190  MOVE      QRYDATA,MRAUC019
          GOTO      SPMRA999
.
SPMRA200  MOVE      QRYDATA,MRAUC020
          GOTO      SPMRA999
.
SPMRA210  MOVE      QRYDATA,MRAUC021
          GOTO      SPMRA999
.
SPMRA220  MOVE      QRYDATA,MRAUC022
          GOTO      SPMRA999
.
SPMRA230  MOVE      QRYDATA,MRAUC023
          GOTO      SPMRA999
.
SPMRA240  MOVE      QRYDATA,MRAUC024
          GOTO      SPMRA999
.
SPMRA250  MOVE      QRYDATA,MRAUC025
          GOTO      SPMRA999
.
SPMRA260  MOVE      QRYDATA,MRAUC026
          GOTO      SPMRA999
.
SPMRA270  MOVE      QRYDATA,MRAUC027
          GOTO      SPMRA999
.
SPMRA280  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      MRAUC028,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMRA999
.
SPMRA999  RETURN
.
.------------------------------------------------------------
.  Get Coding Audit Comments
.------------------------------------------------------------
GETCMM00  CLEAR     MRAUC013
          GOTO      GETCMM20
.
GETCMM10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA
          GOTO      GETCMM90 IF OVER
          MATCH     SP70,QRYNAME
          GOTO      GETCMM80 IF NOT EQUAL
          MATCH     SP70,QRYDATA
          GOTO      GETCMM10 IF EQUAL
          GOTO      GETCMM10 IF EOS
.
GETCMM20  STRIP     QRYDATA
          APPEND    QRYDATA,MRAUC013
          APPEND    SP1,MRAUC013
          GOTO      GETCMM10
.
GETCMM80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
.
GETCMM90  APPEND    SP70,MRAUC013
          RESET     MRAUC013
.
GETCMM99  RETURN
.
.------------------------------------------------------------
.  Update Coding Audit file
.------------------------------------------------------------
MVMRAC00  MATCH     MRAUC001,Z70
          IF        !@EQUAL
            MOVE      MRAUC001,MRACVISN
          ENDIF
.
          MATCH     MRAUC002,Z70
          IF        !@EQUAL
            MOVE      MRAUC002,MRACEPSN
          ENDIF
.
          MATCH     MRAUC003,Z70
          IF        !@EQUAL
            MOVE      MRAUC003,MRACADTE
          ENDIF
.
          MATCH     MRAUC004,Z70
          IF        !@EQUAL
            MOVE      MRAUC004,MRACODRG
          ENDIF
.
          MATCH     MRAUC005,Z70
          IF        !@EQUAL
            MOVE      MRAUC005,MRACOWIE
          ENDIF
.
          MATCH     MRAUC006,Z70
          IF        !@EQUAL
            MOVE      MRAUC006,MRACNDRG
          ENDIF
.
          MATCH     MRAUC007,Z70
          IF        !@EQUAL
            MOVE      MRAUC007,MRACNWIE
          ENDIF
.
          MATCH     MRAUC008,Z70
          IF        !@EQUAL
            MOVE      MRAUC008,MRACDWIE
          ENDIF
.
          MATCH     MRAUC009,Z70
          IF        !@EQUAL
            MOVE      MRAUC009,MRACCLNC
          ENDIF
.
          MATCH     MRAUC010,Z70
          IF        !@EQUAL
            MOVE      MRAUC010,MRACTYPE
          ENDIF
.
          MATCH     MRAUC011,Z70
          IF        !@EQUAL
            MOVE      MRAUC011,MRACRCHG
          ENDIF
.
          MATCH     MRAUC012,Z70
          IF        !@EQUAL
            MOVE      MRAUC012,MRACNCHG
          ENDIF
.
          MATCH     MRAUC013,Z70
          IF        !@EQUAL
            MOVE      MRAUC013,MRACCOMM
          ENDIF
.
          MATCH     MRAUC014,Z70
          IF        !@EQUAL
            MOVE      MRAUC014,MRACCDTE
          ENDIF
.
          MATCH     MRAUC015,Z70
          IF        !@EQUAL
            MOVE      MRAUC015,MRACCTIM
          ENDIF
.
          MATCH     MRAUC016,Z70
          IF        !@EQUAL
            MOVE      MRAUC016,MRACCUSR
          ENDIF
.
          MATCH     MRAUC017,Z70
          IF        !@EQUAL
            MOVE      MRAUC017,MRACCDSC
          ENDIF
.
          MATCH     MRAUC018,Z70
          IF        !@EQUAL
            MOVE      MRAUC018,MRACUDTE
          ENDIF
.
          MATCH     MRAUC019,Z70
          IF        !@EQUAL
            MOVE      MRAUC019,MRACUTIM
          ENDIF
.
          MATCH     MRAUC020,Z70
          IF        !@EQUAL
            MOVE      MRAUC020,MRACUUSR
          ENDIF
.
          MATCH     MRAUC021,Z70
          IF        !@EQUAL
            MOVE      MRAUC021,MRACUDSC
          ENDIF
.
          MATCH     MRAUC022,Z70
          IF        !@EQUAL
            MOVE      MRAUC022,MRACODOL
          ENDIF
.
          MATCH     MRAUC023,Z70
          IF        !@EQUAL
            MOVE      MRAUC023,MRACNDOL
          ENDIF
.
          MATCH     MRAUC024,Z70
          IF        !@EQUAL
            MOVE      MRAUC024,MRACDIFD
          ENDIF
.
          MATCH     MRAUC025,Z70
          IF        !@EQUAL
            MOVE      MRAUC025,MRACDDNR
          ENDIF
.
          MATCH     MRAUC026,Z70
          IF        !@EQUAL
            MOVE      MRAUC026,MRACOHCP
          ENDIF
.
          MATCH     MRAUC027,Z70
          IF        !@EQUAL
            MOVE      MRAUC027,MRACOCOF
          ENDIF
.
          MATCH     MRAUC028,Z70
          IF        !@EQUAL
            MOVE      MRAUC028,MRACODAT
          ENDIF
.
MVMRAC99  RETURN
.
.------------------------------------------------------------
.  Clear Coding Audit file
.------------------------------------------------------------
CLMRAC00  MOVE      SP70,MRACVISN 
          MOVE      SP70,MRACEPSN 
          MOVE      SP70,MRACADTE 
          MOVE      SP70,MRACODRG 
          MOVE      ZERO,MRACOWIE 
          MOVE      SP70,MRACNDRG 
          MOVE      ZERO,MRACNWIE 
          MOVE      ZERO,MRACDWIE 
          MOVE      SP70,MRACCLNC 
          MOVE      SP70,MRACTYPE 
          MOVE      SP70,MRACRCHG 
          MOVE      SP70,MRACNCHG 
          MOVE      SP70,MRACCOMM 
          MOVE      SP70,MRACCDTE 
          MOVE      SP70,MRACCTIM 
          MOVE      SP70,MRACCUSR 
          MOVE      SP70,MRACCDSC 
          MOVE      SP70,MRACUDTE 
          MOVE      SP70,MRACUTIM 
          MOVE      SP70,MRACUUSR 
          MOVE      SP70,MRACUDSC 
          MOVE      ZERO,MRACODOL
          MOVE      ZERO,MRACNDOL
          MOVE      ZERO,MRACDIFD
          MOVE      SP70,MRACDDNR 
          MOVE      SP70,MRACOHCP 
          MOVE      SP70,MRACOCOF 
          MOVE      SP70,MRACODAT 
          MOVE      SP70,MRACSPAR 
.
CLMRAC99  RETURN

.------------------------------------------------------------
. File       : IBALPCCD.PBL
.
. Functions  : This file contains standard routines for
.              adding new records to IBALPCFD        
.
. Routines   : ADDPRN00  - Addes new record to IBALPCFD        
.
. Variables  : PVIBILL - Visit Number
.              PVIURNO - U/R number   
.              MEDRTYPE - Medical record type CGI Variable
.
. Includes   : MRTVISFD
.              MRTVISIO
.------------------------------------------------------------
.       V10.06.01 14/08/2015  Ebon Clements   CAR 316175
.                 Set F5 to ZERO so schedule number starts at 1 when
.                 the file in empty
.       V9.11.01  26/10/2008  Ebon Clements   CAR 181583
.                             Added trap to write
.	V9.02.01  26/04/2002  Bronko Sosic
.                               Wraped a RA around the write to stop I*D
.	V5.09.00  03/01/2001  Bronko Sosic
.                               Created Include
.------------------------------------------------------------
ADDPRN00  MOVE     ZERO,F5
.
          PACK     KEY5,Z70            
          CALL     RSIBLPC1
          CALL     RPIBLPC1
.
          MOVE     IBLPSCHE,F5
ADDPRN10  ADD      ONE,F5
          MOVE     F5,KEY5
          CALL     RDIBLPC1
          IF       OVRCD=0
            GOTO     ADDPRN10
          ENDIF
.
          CALL     CLRVAR00 
          UNPACK   LABELTYP,KEY8,KEY2
          CALL     SAVVAR00
          CALL     RAIBLPC1
          IF       OVRCD=1
            MOVE     ZERO,OVRCD
            TRAP     OVERCOND IF IO
            CALL     WRIBLPC1
            TRAPCLR  IO
            BRANCH   OVRCD,ADDPRN10
          ELSE
            GOTO     ADDPRN10
          ENDIF
.
ADDPRN99  RETURN          
.-------------------------------------------------------------
.               Clears File
.-------------------------------------------------------------
CLRVAR00  MOVE     SP70,IBLPSCHE
          MOVE     SP70,IBLPURNO
          MOVE     SP70,IBLPVISN
          MOVE     SP70,IBLPSKEY
          MOVE     SP70,IBLPPRNT
          MOVE     ZERO,IBLPCOPY 
          MOVE     SP70,IBLPSTAT
          MOVE     SP70,IBLPLAPR
          MOVE     SP70,IBLPLASC
          MOVE     SP70,IBLPFRE1
          MOVE     SP70,IBLPFRE2
          MOVE     SP70,IBLPFRE3
          MOVE     SP70,IBLPFRE4
          MOVE     SP70,IBLPFRE5
          MOVE     SP70,IBLPFRE6
          MOVE     SP70,IBLPFRE7
          MOVE     SP70,IBLPRUID
          MOVE     SP70,IBLPRDAT
          MOVE     SP70,IBLPRTIM
          MOVE     SP70,IBLPSPAR
.
CLRVAR99  RETURN
.-------------------------------------------------------------
.               Save File
.-------------------------------------------------------------
SAVVAR00  MOVE     KEY5,IBLPSCHE
          MOVE     URNUMBER,IBLPURNO
          MOVE     ADMISSNO,IBLPVISN
          MOVE     SUBSYSKY,IBLPSKEY
          MOVE     SCHDPRNT,IBLPPRNT
          MOVE     SCHDCOPY,IBLPCOPY 
          MOVE     STATNCOD,IBLPSTAT
          MOVE     KEY8,IBLPLAPR
          MOVE     KEY2,IBLPLASC
          MOVE     FREETXT1,IBLPFRE1
          MOVE     FREETXT2,IBLPFRE2
          MOVE     FREETXT3,IBLPFRE3
          MOVE     FREETXT4,IBLPFRE4
          MOVE     FREETXT5,IBLPFRE5
          MOVE     FREETXT6,IBLPFRE6
          MOVE     FREETXT7,IBLPFRE7

          MOVE     WBSEUID,IBLPRUID
          CALL     IBACLOCK
          PACK     IBLPRDAT,CCC,CYY,CMM,CDD
          REP      " 0",IBLPRDAT
          CLOCK    TIME,IBLPRTIM
          MOVE     SP70,IBLPSPAR
.
SAVVAR99  RETURN

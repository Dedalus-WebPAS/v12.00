.******************************************************************************
.* System         : PMI                                                       *
.*                                                                            *
.* Include Name   : PMIGTNID                                                  *
.*                                                                            *
.* Function       : To get the National ID Number for a patient               *
.*                                                                            *
.* Author         : Justin Coates      02/01/1996                             *
.*                                                                            *
.* Parameters     : PURNO         patient UR number                           *
.*                                                                            *
.* Returns        : NMPNUMB       the National ID Number                      *
.*                                                                            *
.* Modifications  :                                                           *
.*                  05/08/1999  Steve Armstrong                               *
.*                  Added read of PTCNNHII from controlf file                 *
.*                  12/05/1997  Steve Armstrong                               *
.*                  Added open for controlf (hos31 calls with controlf closed)*
.*                  12/05/1997  Steve Armstrong                               *
.*                  Fixed format of national number from nhimasaf             *
.*                  28/04/97  ROD              SRF 619290                     *
.*                            check if using nhimasaf                         *
.******************************************************************************
GNMPI000
PMIGTNID  OPEN      PATNIDA1,"patnidaf"
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          READ      CONTROLF,FIFTY9;*234,PTCNNMPI
.
          IF        PTCNNHII=1
            OPEN      NHIMASA2,"nhimasaf"
          ENDIF
.
...          MOVE      SP20,NMPNUMB
          PACK      KEY10,CHOSINDX,PURNO
          PACK      KEY8,PURNO
          BRANCH    PTCNNMPI,GTNID200,GTNID400,GTNID400
          GOTO      GTNID999
.
. ------- Use file 1 - nhimasaf -------
.
GTNID200  COMPARE   ONE,PTCNNHII
          GOTO      GTNID999 IF NOT EQUAL
.
          CALL      RDNHMAS2
          BRANCH    OVRCD,GTNID999
          PACK      NMPNUMB,SP10,SP3,NHMANMPI
          GOTO      GTNID999
.
. ------- Use file 2 - patnidaf -------
.
GTNID400  CALL      RDPTNID1
          BRANCH    OVRCD,GTNID999
          MOVE      PTNINMPI,NMPNUMB
          GOTO      GTNID999
.
GTNID999  RETURN
+

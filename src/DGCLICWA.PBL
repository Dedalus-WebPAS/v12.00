.************************************************************************
.*  Procedure: DGCLICWA  -  Send a Put Patient on Waiting List          *
.*                                                                      *
.*  Author   : Mike Laming  (09/07/2001)                                *
.*                                                                      *
.*  Requires : PATMA1FD (Patient Master & Extension)                    *
.*             PMSPX2FD (Patient Master Extn.2)                         *
.*             WATTR1FD (Waiting List Patient Procedures)               *
.*             WATTX1FD (Waiting List file extension 1)                 *
.*                                                                      *
.*             PATCONFD (Patient Control File)                          *
.*             WATCONFD (Waiting List Control File)                     *
.*                                                                      *
.*  Requirement removed (V9.02.01)                                      *
.*             PATCGPFD (Registered GP/Practice Changes)                *
.*             PATNIDFD (Patient National ID Number)                    *
.*             NHIMASFD (NZ Health Interface)                           *
.*             PMIGTNID.PBL (Get the National ID Number)                *
.*                                                                      *
.*  Mods     :                                                          *
.*  V9.02.02 : 08/11/2001  Davin & Mikel                                *
.*             Mods to use message holding file                         *
.*  V9.02.01 : 03/09/2001  Mike Laming                                  *
.*             Add Logic to get PATCGPFD as this is not available in    *
.*             Calling Program. Also add NHIMAS-- and PATNID-- INCs     *
.*             into this Procedure.                                     *
.*                                                                      *
.*                                                                      *
.*                                                                      *
.************************************************************************
          DEFPROC   DGCLICWA
.
          INC       HL7BMTFD/INC
.
. vars in here
.
DGCLI000  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,THIRTY7;*239,WTCNDGWA
.
.   check if we are using this feature
.
          COMPARE   ONE,WTCNDGWA
          GOTO      DGCLI999 IF NOT EQUAL
.
.         Open the broadcast message holding table file
.
          OPEN      HL7BMTA1,"hl7bmtaf"
.
.         Write message
.
          MOVE      "T",HLBMSTAT                * "T" - to be processed
          MOVE      "CWA",HLBMTYPE
          MOVE      SP8,HLBMURNO
          MOVE      SP8,HLBMVISN
.                                               * Key for WATTR1A1 (Key19)
          PACK      HLBMTKEY,WMURNO,WMCODE,WMCNT,SP30,SP30,SP30
          MOVE      SP1,HLBMFLAG
          PACK      HLBMSPAR,SP30,SP30
.
          CALL      DGMESSID                    * Get Message ID, Date & Time
.
          CALL      DGHLSEND                    * Send the HL7 message
.
          CLOSE     HL7BMTA1
.
DGCLI999  GOTO      DGCLIEND                    * end procedure
.
.         IO's go in here
.
          INC       DGHLCOMN
          INC       HL7BMTIO/INC
          INC       IBAOVRIO/INC
.
DGCLIEND  ENDPROC

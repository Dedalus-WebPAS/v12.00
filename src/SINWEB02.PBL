.----------------------------------------------------------------------
. Program       : SINWEB02
.
. Function      : Supply & Inventory Web Server
.                 Report 1 - Theatre Purchase Order
.                 Report 2 - Code Search: Supply, Cost Centre             
.                 Report 3 - Add Supplier Supply Details             
.                 Report 4 - Remote Script: Validate Financial Accounts
.                 Report 5 - Supply Maintenance
.                 Report 6 - Imprest Maintenance
.                 Report 7 - Cost Centre Maintenance
.                 Report 8 - Remote Scripts
.
. Modifications : 
.----------------------------------------------------------------------
. V11.03.01 09/01/2023  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V10.07.02 28.01.2016  Peter Vela   CAR 0809657
.           Added status validation in CHKCAT00
. V10.07.01 30.12.2015  Peter Vela   CAR 0808100
.           Fixed display of Active column in CIAROW00
. V10.04.01 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
.----------------------------------------------------------------------
. V10.03.02 30/07/2012 Patrick Adair                         CAR 243843
.           Deactivating supplies - Added Active Code
. V10.03.01 16/07/2012  Don Nguyen     CAR 264682
.           Renamed Catalog to Supply
. V10.02.01 07/04/2011  Jill Parkinson CAR 239574
.           Removed open of ibaprntf
. V10.00.01 19/04/2010  Ebon Clements CAR 208232
.           Added avergage cost output to CHKCAT00 and SINKCT00
. V9.10.01  25/07/2007  Mike Laming   CAR 174378
.           Added tag for Catalog Code Type indicator INCOCATE
. V9.08.01  12/04/2007  Jill Habasque CAR 135532
.           Added report 8 - Remote scripts
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.04  15/04/2005  Peter Vela               CAR 59696
.           Changed commodity groupd code from DIM 5 to DIM 6
. V9.04.03  18/03/2005  Lina Vo                  CAR 56404
.           Added Report 5 - Catalog Maintenance
.           Added Report 6 - Imprest Maintenance - incomplete
.           Added Report 7 - Cost Centre Maintenance - incomplete
. V9.04.02  22/02/2005  Lina Vo                  CAR 56406
.           Changed CHKFMS00 to be a remote script.                     
. V9.04.01  17/02/2005  Lina Vo                  CAR 56406
.           Changed Search Cost Centre to display All Cost Centres when 
.           Cost Centre Field is blank in security table. 
.           Changed Purchase order to validate financial accounts (CHKFMS00).
. V9.04.00  25/01/2005  Lina Vo                  CAR 56406
.           Created Web Server.
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       APSCEAFD/INC
          INC       APSCEBFD/INC
          INC       APSCIOFD/INC
          INC       APSMASFD/INC
          INC       APSPPDFD/INC
          INC       APSORDFD/INC
          INC       APSSNTFD/INC
          INC       APSSUBFD/INC
.
          INC       FMSAMAFD/INC
          INC       FMSCONFD/INC
          INC       FMSCSAFD/INC
          INC       FMSFPSFD/INC
          INC       FMSLMAFD/INC
          INC       FMSLMCDF
          INC       FMSLMCFD/INC
          INC       FMSTUPFD/INC
.
          INC       IBAGSTFD/INC
.
          INC       OUTSITFD/INC
          INC       OPRCONFD/INC
.
          INC       PATCONFD/INC
          INC       PATDRGFD/INC
.
          INC       SINCODFD/INC
          INC       SINCONFD/INC
          INC       SINCCAFD/INC
          INC       SINCCATD/INC
          INC       SINCICFD/INC
          INC       SINCICTD/INC
          INC       SINCIAFD/INC
          INC       SINCIATD/INC
          INC       SINCSEFD/INC
          INC       SINDPCFD/INC
          INC       SINKCTFD/INC
          INC       SINCIFFD/INC
          INC       SINFACFD/INC
          INC       SINIMPFD/INC
          INC       SINIMPTD/INC
          INC       SINLTTFD/INC
          INC       SINNATFD/INC
          INC       SINORIFD/INC
          INC       SINPERFD/INC
          INC       SINPOAFD/INC
          INC       SINPOATD/INC
          INC       SINPOBFD/INC
          INC       SINPOCFD/INC
          INC       SINPOCTD/INC
          INC       SINPODFD/INC
          INC       SINPOFFD/INC
          INC       SINSCDFD/INC
          INC       SINSUAFD/INC
          INC       SINTMPDF/INC
          INC       SINWARFD/INC
          INC       SINWSEFD/INC
.
.----------------------------------------------------------------------
NEXTPAGE  DIM       1       * Nextpage parameter CGI parameter
UPDATETY  DIM       1       * Update Type
UPDTTYPE  DIM       1       * Update Type
STARTKEY  DIM       10      * Starting Key
.
COMMENT1  DIM       60
COMMENT2  DIM       60
COMMENT3  DIM       60
COMMENT4  DIM       60
CRELIN1   DIM       35
CRELIN2   DIM       35
CRELIN3   DIM       35
CRELIN4   DIM       35
CRELIN5   DIM       35
.
D12       DIM       12
D40       DIM       40
D50       DIM       50
DIM8      DIM       8
DIM12     DIM       12
DIM15     DIM       15
DIM15A    DIM       15
DIM15B    DIM       15
DIM35     DIM       35
DISPDIM8  DIM       8                            * Active/Inactive literal
DTOGST10  DIM       10
DUTPRC10  DIM       10
EARLYDEL  DIM       10
.
FAXNUMB   DIM       30
FORM3P2   FORM      3.2
FORM4P2   FORM      4.2
FORM5P2   FORM      5.2
FORM8P2   FORM      8.2
FORM12P2  FORM      12.2
..CODERROR  DIM       125     * Output Web error
LNK2PRT   FORM      1
.
MHGPRT    DIM       9
NEXTAKEY  DIM       7
NEXTCKEY  DIM       5
NEXTIKEY  DIM       27
NEXTMKEY  DIM       12
.
PNLN1     DIM       13
PNLN2     DIM       13
PREVAKEY  DIM       7
PREVCKEY  DIM       5
PREVIKEY  DIM       27
PREVMKEY  DIM       12
PRINTFAX  FORM      1
PRVMFLAG  FORM      1
PRVAFLAG  FORM      1
PRVCFLAG  FORM      1
PRVIFLAG  FORM      1
.
SAVKEY5   DIM       5
SAVKEY7   DIM       7
SAVKEY12  DIM       12
SAVKEY22  DIM       22
SAVKEY27  DIM       27
SUPLIN1   DIM       35
SUPLIN2   DIM       35
SUPLIN3   DIM       35
SUPLIN4   DIM       35
SUPLIN5   DIM       35
SUPPLIER  DIM       5
.
TOTGRAMT  FORM      12.2
TOTLNAMT  FORM      12.2
TF7P2B    FORM      7.2
TF6P2     FORM      6.2
.
VARIABLE  DIM       127
VALDCODE  DIM       9   
WVHAMESS  DIM       40
.
HYPHEN    INIT      "-"
OFFUSE    INIT      "Office Use Only: "
.
.----------------------------------------------------------------------
PRGID     INIT      "SINWEB02"
VERSION   INIT      "V12.00.00"
PRGNAM    INIT      "Supply & Inventory Web Server"
.----------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      PURORD00         * Purchase Orders
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      SRHCOD00         * Supply Search 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      CATSUP00         * Supply Supplier Details
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      CHKFMS00         * Remote script Validate Financial A/C
          GOTO      MAIN1000
.         
MAIN1500  CALL      SINCIA00         * Supply Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      SINIMP00         * Imprest Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      SINCCA00         * Cost Centre Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      REMOTE00                * Remote scripts
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40
.
          CALL      WINCLS00      * Refresh parent and close window
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PREDIR00      * Redirect Parent
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      IBASPOL1,"ibaspolf"
          OPEN      IBAPRTA1,"ibaprtaf"
.
          OPEN      APSMASA1,"apsmasaf"
          OPEN      APSPPDA1,"apsppdaf"
          OPEN      APSSNTA1,"apssntaf"
          OPEN      APSSUBA1,"apssubaf"
          OPEN      IBAGSTA1,"ibagstaf"
.
          OPEN      PATDRGA3,"patdrgaf"
.
          OPEN      SINCCAA1,"sinccaaf"
          OPEN      SINCIAA1,"sinciaaf"
          OPEN      SINCICA1,"sincicaf"
          OPEN      SINCICA3,"sincicaf"
          OPEN      SINKCTA1,"sinkctaf"
          OPEN      SINKCTA2,"sinkctaf"
          OPEN      SINCIFA1,"sincifaf"
          OPEN      SINCIFA2,"sincifaf"
          OPEN      SINCODA1,"sincodaf"
          OPEN      SINCSEA1,"sincseaf"
          OPEN      SINDPCA1,"sindpcaf"
          OPEN      SINFACA1,"sinfacaf"
          OPEN      SINIMPA1,"sinimpaf"
          OPEN      SINLTTA1,"sinlttaf"
          OPEN      SINORIA1,"sinoriaf"
          OPEN      SINPERA2,"sinperaf"
          OPEN      SINPOAA1,"sinpoaaf"
          OPEN      SINPOAA3,"sinpoaaf"
          OPEN      SINPOBA1,"sinpobaf"
          OPEN      SINPOCA1,"sinpocaf"
          OPEN      SINPODA1,"sinpodaf"
          OPEN      SINPOFA1,"sinpofaf"
          OPEN      SINSCDA1,"sinscdaf"
          OPEN      SINSUAA1,"sinsuaaf"
          OPEN      SINWARA1,"sinwaraf"
          OPEN      SINWSEA1,"sinwseaf"
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,FORTY2;*242,OPCNWHCD
          READ      CONTROLF,SIXTY3;*67,INCOCATE,*141,INCNNATO
          READ      CONTROLF,SIXTY3;*241,SNCOMDPC
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          CALL      RDACC000
.
INIT9999  RETURN
+
.----------------------------------------------------------------------
. HACCNT    FORM 1  Running the Accounting System          0=No
. HACCDATA  DIM  20 General Ledger Data Directory
. HDEFWH    DIM  5  Default Warehouse for Non Stock Items
. HORDDES   DIM  1  Order Number Alhpa Prefix
.----------------------------------------------------------------------
RDACC000  READ      CONTROLF,TWENTY3;*95,HACCNT,*124,HORDDES:
                                    *143,HDEFWH
          READ      CONTROLF,TWENTY4;*135,HACCDATA,*165,HLASTCIN
          COMPARE   ONE,HACCNT
          GOTO      RDACC999 IF NOT EQUAL
.
.---- GL interface is on ----
.
          CLOSE     CONTROLF           * get gl control file if possible
          MOVE      "controlf.txt",KEY12
          PACK      KEY80,HACCDATA,KEY12
          SQUEEZE   KEY80
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      CONTROLF,KEY80
          TRAPCLR   IO
          IF        OVRCD=1
            OPEN      CONTROLF,"controlf"
          ENDIF
.
          CALL      RDFMCO50           * Read Account Code Parameters
          CALL      RDFMCO51
          CALL      RDFMCO52
          CALL      RDFMCO65
          CLOSE     CONTROLF
          OPEN      CONTROLF,"controlf"
.
          UNPACK  SP70,SIPESDT  ** Fix strange corruption of SIPESDT at Mercy **
          CLEAR     SIPESDT
          DISPLAY   *P80:3,*+,SIPESDT
.
          MOVE      "fmsamaaf",KEY8
          PACK      KEY80,HACCDATA,KEY8
          SQUEEZE   KEY80
          OPEN      FMSAMAA1,KEY80
.
          MOVE      "fmslmaaf",KEY8
          PACK      KEY80,HACCDATA,KEY8
          SQUEEZE   KEY80
          OPEN      FMSLMAA1,KEY80
.
          MOVE      "fmslmcaf",KEY8
          PACK      KEY80,HACCDATA,KEY8
          SQUEEZE   KEY80
          OPEN      FMSLMCA1,KEY80
.
          MOVE      "fmscsaaf",KEY8
          PACK      KEY80,HACCDATA,KEY8
          SQUEEZE   KEY80
          OPEN      FMSCSAA1,KEY80
.
          MOVE      "fmstupaf",KEY8
          PACK      KEY80,HACCDATA,KEY8
          SQUEEZE   KEY80
          OPEN      FMSTUPA1,KEY80
.
          MOVE      ZERO,OVRCD
          MOVE      "apscioaf",KEY8
          PACK      KEY80,HACCDATA,KEY8
          SQUEEZE   KEY80
          TRAP      OVERCOND IF IO
          OPEN      APSCIOA1,KEY80
          TRAPCLR   IO
.
          MOVE      ZERO,OVRCD
          MOVE      "apsordaf",KEY8
          PACK      KEY80,HACCDATA,KEY8
          SQUEEZE   KEY80
          TRAP      OVERCOND IF IO
          OPEN      APSORDA1,KEY80
          TRAPCLR   IO
.
          MOVE      ZERO,OVRCD
          MOVE      "apsceaaf",KEY8
          PACK      KEY80,HACCDATA,KEY8
          SQUEEZE   KEY80
          TRAP      OVERCOND IF IO
          OPEN      APSCEAA1,KEY80
          TRAPCLR   IO
.
          MOVE      "apscebaf",KEY8
          PACK      KEY80,HACCDATA,KEY8
          SQUEEZE   KEY80
          TRAP      OVERCOND IF IO
          OPEN      APSCEBA1,KEY80
          TRAPCLR   IO
.
RDACC999  CALL      ONAT0000                 * Open Nato File
          RETURN
.------------------------------------------------------------------------
. Open Nato X-Ref File if required
.------------------------------------------------------------------------
ONAT0000  OPEN      CONTROLF,"controlf"
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*141,INCNNATO
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ZERO,INCNNATO
            WRITAB    CONTROLF,SIXTY3;*141,INCNNATO
          ENDIF
.
          IF        INCNNATO=1
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      SINNATA1,"sinnataf"
            TRAPCLR   IO
            IF        OVRCD=1
              DISPLAY   *P1:24,*EL,*B,"Nato file does not exist. Run fixit.  ";
              CALL      HITENTER
              CHAIN     PGM
            ENDIF
.
            OPEN      SINNATA2,"sinnataf"
          ENDIF
.
ONAT9999  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,STARTKEY
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,UPDATETY
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          MOVE      SP70,SELPRINT
          MOVE      SP70,KEYWORDS
          MOVE      SP70,VALDCODE
          MOVE      ZERO,PRINTFAX
.
          MOVE      SP70,SUPPLIER
          MOVE      SP70,NEXTIKEY
          MOVE      SP70,NEXTCKEY
          MOVE      SP70,NEXTAKEY
          MOVE      SP70,NEXTMKEY
          MOVE      SP70,PREVIKEY
          MOVE      SP70,PREVCKEY
          MOVE      SP70,PREVAKEY
          MOVE      SP70,PREVMKEY
          MOVE      ZERO,PRVIFLAG
          MOVE      ZERO,PRVCFLAG
          MOVE      ZERO,PRVAFLAG
          MOVE      ZERO,PRVMFLAG
.
          CALL      CPSCCA00
          CALL      CPSCIA00
          CALL      CPSIMP00
          CALL      CPSIIC00
          CALL      CPSIPA00
          CALL      CPSIPC00
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updatety=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATETY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.  
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF 
.  
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "selprint=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SELPRINT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "printfax=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRINTFAX
            GOTO      SETPAR99
          ENDIF 
.
          MATCH     "sipoa",QRYNAME
          IF        @EQUAL
            CALL      SPSPA000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sipoc",QRYNAME
          IF        @EQUAL
            CALL      SPSPC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sicic",QRYNAME
          IF        @EQUAL
            CALL      SPSIC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sicca",QRYNAME
          IF        @EQUAL
            CALL      SPCCA000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sicia",QRYNAME
          IF        @EQUAL
            CALL      SPCIA000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "siimp",QRYNAME
          IF        @EQUAL
            CALL      SPIMP000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "supplier=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SUPPLIER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keywords=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYWORDS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextikey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTIKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "previkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVIKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prviflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRVIFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextckey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTCKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevckey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVCKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prvcflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRVCFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextakey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTAKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevakey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVAKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prvaflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRVAFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextmkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTMKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevmkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVMKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prvmflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRVMFLAG
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.------------------------------------------------------------
. Purchase Orders for Theatre
.------------------------------------------------------------
PURORD00  PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          MATCH     SP10,OPCNWHCD
          GOTO      PURORD97 IF EQUAL
.
          PACK      KEY9,PASSCODE,OPCNWHCD,SP10
          CALL      RDSIWS1
          BRANCH    OVRCD,PURORD91
.
          MOVE      SIPOA001,SIPOC001   * Purchase Order Number
.
          MATCH     SP70,UPDTTYPE
          GOTO      PURORD70 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add Formaction
          GOTO      PURORD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE     * Update Formaction
          GOTO      PURORD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE     * Delete Formaction
          GOTO      PURORD30 IF EQUAL
.
          MATCH     "C",UPDTTYPE     * Cancel Formaction
          GOTO      PURORD40 IF EQUAL
.
          MATCH     "F",UPDTTYPE     * Finish Formaction
          GOTO      PURORD50 IF EQUAL
.
          GOTO      PURORD90
.
.   ************ ADD FORMACTION ************
.
PURORD10  PACK      KEY6,CCC,CYY,CMM,SP70      * Fin Year Period
          REP       " 0",KEY6
          CALL      RDDRGA3
          BRANCH    OVRCD,PURORD96
.
          CALL      ADDORD00
          BRANCH    EXIT,PURORD99
.
          CALL      BREDIR00
          GOTO      PURORD99
.
.
.   ************ UPDATE FORMACTION ************
.
PURORD20  CALL      UPDORD00
          BRANCH    EXIT,PURORD94,PURORD95
          CALL      BREDIR00
          GOTO      PURORD99
.
.
.   ************ DELETE FORMACTION ************
.
PURORD30  CALL      DELORD00
          BRANCH    EXIT,PURORD95
          CALL      BREDIR00
          GOTO      PURORD99
.
.   ************ CANCEL FORMACTION ************
.
PURORD40  CALL      CANORD00
          MOVE      SP70,SIPOA001
          CALL      BREDIR00
          GOTO      PURORD99
.
.
.   ************ FINISH FORMACTION ************
.
PURORD50  CALL      FSHORD00
          BRANCH    EXIT,PURORD99
          MOVE      SP70,SIPOA001
          CALL      BREDIR00
          GOTO      PURORD99
.
.
.   ************ DISPLAY FORMACTION ***********
.
PURORD70  CALL      CLRSPA00
          CALL      CLRSPC00
.
          MATCH     Z70,SIPOA001
          GOTO      PURORD80 IF EQUAL
          MATCH     SP70,SIPOA001
          GOTO      PURORD80 IF EQUAL
.
          PACK      KEY7,SIPOA001,SP70
          CALL      RDSIPA1
          BRANCH    OVRCD,PURORD94
.
          MATCH     Z70,SIPOC002
          GOTO      PURORD80 IF EQUAL
          MATCH     SP70,SIPOC002
          GOTO      PURORD80 IF EQUAL
.
          PACK      KEY10,SIPOA001,SIPOC002,SP70
          CALL      RDSIPC1
          BRANCH    OVRCD,PURORD95
.
PURORD80  CLEAR     WEBTITLE
          MOVE      "Purchase Orders",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PURORD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PURORD99
.
PURORD90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PURORD99
.
PURORD91  MOVE      "You do not have Security access to Add Purchase Orders.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PURORD99
.
PURORD92  MOVE      "Invalid Warehouse.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PURORD99
.
PURORD93  MOVE      "Warehouse Record Locked.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PURORD99
.
PURORD94  MOVE      "Cannot find Purchase Order Header Record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PURORD99
.
PURORD95  MOVE      "Cannot find Purchase Order Item Record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PURORD99
.
PURORD96  MOVE      "Invalid Financial Year Period.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PURORD99
.
PURORD97  MOVE      "Default Warehouse not setup.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PURORD99
.
PURORD99  RETURN
+
.------------------------------------------------------------
. Add Purchase Order  
.------------------------------------------------------------
ADDORD00  MATCH     SP70,SIPOA001
          GOTO      ADDORD50 IF NOT EQUAL
.
.         Generate New Purchase Order Number
.
          PACK      SIWAWAR,OPCNWHCD,SP70      * Generate Purchase Order Number
          CALL      NXTORD00
          BRANCH    OVRCD,ADDORD90,ADDORD91
.
          MOVE      SIPAPON,SIPOA001           * New Purchase Order Number
          MOVE      SIPAPON,SIPOC001
.
.         Write     Purchase Order Header
.
          CALL      CLRSPA00                   * Clear sinpoaaf field
          CALL      MVSIPA00                   * Move cgi fields
          MOVE      CURRDATE,SIPADIN           * Date Inputted
          MOVE      OPCNWHCD,SIPAWAR           * Warehouse
.
          PACK      KEY7,SIPOA001,SP10
          CALL      WRSIPA1                    * Write Purchase Order Header
.
          GOTO      ADDORD55
.
.         Get Next Item Number
.
ADDORD50  PACK      KEY7,SIPOA001,SP10
          CALL      RDSIPA1
          BRANCH    OVRCD,ADDORD92
.
          PACK      KEY10,SIPOC001,Z70
          CALL      RSSIPC1
          CALL      RPSIPC1
          BRANCH    OVRCD,ADDORD55
.
          MATCH     SIPCPON,SIPOC001
          GOTO      ADDORD55 IF NOT EQUAL
.
.         Subsequent Purchase Order Line
.
ADDORD52  MOVE      ZERO,F3
          MOVE      SIPCITM,F3
          ADD       ONE,F3
          MOVE      F3,SIPOC002                * Set Next Item
          GOTO      ADDORD60
.
.         First Purchase Order Line
.
ADDORD55  MOVE      "  1",SIPOC002             * Set First Item
.
.         Write Purchase Order Line Items
.
ADDORD60  CALL      CLRSPC00                   * Clear sinpocaf field
          CALL      MVSIPC00                   * Move cgi fields
.
          MOVE      SIPAPON,SIPCPON
          MOVE      SIPADIN,SIPEDATE
          CALL      RSIPE000
          PACK      SIPCDAT,SIPEYEAR,SIPEPER,SP70
.
          MOVE      OPCNWHCD,SIPCWAR           * Warehouse
          MOVE      SP70,SIPCFDD
          MOVE      ZERO,SIPCIQT
          MOVE      ZERO,SIPCRQT
          MOVE      ZERO,SIPCTCR
          MOVE      ZERO,SIPCTGS
          MOVE      ZERO,SIPCTIN
          MOVE      ZERO,SIPCIGS
          MOVE      SIPCOQT,SIPCOQO
          MOVE      SIPCECT,SIPCOOP
          MOVE      SIPCGSTA,SIPCOGS
.
          PACK      KEY10,SIPOC001,SIPOC002,SP10
          CALL      RASIPC1
          COMPARE   OVRCD,ZERO
          GOTO      ADDORD52 IF EQUAL
.
          CALL      WRSIPC1                    * Write Purchase Order Detail
.
          IF        HLASTCIN=1
            MATCH     SIPCCAT,SP70
            IF        !@EQUAL
              PACK      KEY27,SIPCCAT,SIPASUP,SIPCSUT,SP70
              CALL      RDSIIC1
              IF        OVRCD=0
                MOVE      TWO,AUDTTYPE
                CALL      WASIIC00
                MOVE      SIPCECT,SIICLCT
                CALL      UPSIIC1
                MOVE      THREE,AUDTTYPE
                CALL      WASIIC00
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      ADDORD99
.
ADDORD90  MOVE      "Invalid Warehouse.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDORD99
.
ADDORD91  MOVE      "Warehouse Record Locked.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDORD99
.
ADDORD92  MOVE      "Cannot find Purchase Order Header Record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDORD99
.
ADDORD99  RETURN
+
.--------------------------------------------------
. Check Accounting System
.--------------------------------------------------
CHKFMS00  CALL      XMLHED00
          BRANCH    EXIT,CHKFMS99
.
          IF       HACCNT<>1
            UNPACK   SP70,FMAMLEDG,FMAMACCT
            GOTO     CHKFMS80
          ENDIF
.
          MOVE      OPCNWHCD,KEY5
          CALL      RDSIWA1
          BRANCH    OVRCD,CHKFMS91
.
          MATCH     SP70,SIPOC007
          GOTO      CHKFMS50 IF EQUAL
.
          PACK      KEY7,SIPOC007,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,CHKFMS92
.
          BRANCH    SIIANON,CHKFMS50
.
          MOVE      SIWALED,FMAMLEDG
          BRANCH    SIWAPTY,CHKFMS10,CHKFMS10
          MOVE      SIWAPACC,FMAMACCT
          GOTO      CHKFMS70
.
CHKFMS10  STORE     SIWAPACC,FMSUUD4A,KEY1,KEY2,KEY3,KEY4,KEY5,KEY6:
                                      KEY7,KEY8,KEY9,KEY10,KEY11,KEY12
          LOAD      FMAMACCT,FMSUUD4A,KEY1,KEY2,KEY3,KEY4,KEY5,KEY6:
                                   KEY7,KEY8,KEY9,KEY10,KEY11,KEY12
          IF        FMSUUD2A=1
            PACK      FMAMACCT,FMAMACCT,FMSUUD2B
          ENDIF
          MOVE      SIIASUB,KEY5
          CALL      RDSISA1
          BRANCH    SIWAPTY,CHKFMS60,CHKFMS65
          GOTO      CHKFMS60
.
. Non Stock
.----------
CHKFMS50  PACK      SICAGL,SP70
          MOVE      SIPOC003,KEY5
          CALL      RDSICA1
          BRANCH    OVRCD,CHKFMS93
.
          UNPACK    SICAGL,FMAMLEDG,FMAMACCT
          MATCH     SP70,FMAMACCT      * use posting acc if no CC
          GOTO      CHKFMS62 IF EQUAL
.
          STORE     FMAMACCT,FMSUUD4A,KEY1,KEY2,KEY3,KEY4,KEY5,KEY6:
                                     KEY7,KEY8,KEY9,KEY10,KEY11,KEY12
          LOAD      FMAMACCT,FMSUUD4A,KEY1,KEY2,KEY3,KEY4,KEY5,KEY6:
                                     KEY7,KEY8,KEY9,KEY10,KEY11,KEY12
          IF        FMSUUD2A=1
            PACK      FMAMACCT,FMAMACCT,FMSUUD2B
          ENDIF
.
          MATCH     SP70,SIPOC004
          IF        @EQUAL
            MOVE      SIIASUB,SIPCPRD
          ELSE
            MOVE      SIPOC004,SIPCPRD
          ENDIF
          PACK      KEY5,SIPCPRD,SP70
          CALL      RDSISA1
          BRANCH    SIWATYP,CHKFMS65,CHKFMS62
.
CHKFMS60  PACK      SILTSUB,SIPCPRD,SP70
          CALL      GTRA0000                       * check for translation table
          PACK      FMAMACCT,FMAMACCT,SILTSUB,SP70 * Add subjective code
          GOTO      CHKFMS70
.
CHKFMS62  PACK      FMAMACCT,SICAPACC,SP70         * Use CC Posting Account
          GOTO      CHKFMS70
.
CHKFMS65  PACK      SILTSUB,SISACOMM,SP70
          CALL      GTRA0000                       * check for translation table
          PACK      FMAMACCT,FMAMACCT,SILTSUB,SP70 * Add commodity code
          GOTO      CHKFMS70
.
CHKFMS70  PACK      KEY14,FMAMLEDG,FMAMACCT,SP70
          CALL      RDFMAM1
          COMPARE   ZERO,OVRCD
          GOTO      CHKFMS72 IF EQUAL
          SQUEEZE   KEY14
          CALL      RDFMAM1
          BRANCH    OVRCD,CHKFMS94
.
CHKFMS72  MOVE      FMAMTYPE,F1
.
          IF        F1>0 & F1<6
            IF        FMAMSTAT<>0
              GOTO      CHKFMS90
            ELSE
              GOTO      CHKFMS80
            ENDIF
          ENDIF
          GOTO      CHKFMS94
.
CHKFMS80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Ok":
                             "</RETURN_VALUE>"
          GOTO      CHKFMS98
.
CHKFMS90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Error: Ledger/Account: ",FMAMLEDG,"/":
                              FMAMACCT," is Closed. ":
                             "</RETURN_VALUE>"
          GOTO      CHKFMS98
.
CHKFMS91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Error: Invalid Warehouse : ",OPCNWHCD:
                             "</RETURN_VALUE>"
          GOTO      CHKFMS98
.
CHKFMS92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Error: Invalid Supply : ",SIPOC007:
                             "</RETURN_VALUE>"
          GOTO      CHKFMS98
.
CHKFMS93  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Error: Invalid Cost Centre : ",SIPOC005:
                             "</RETURN_VALUE>"
          GOTO      CHKFMS98
.
CHKFMS94  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Error: Invalid Ledger/Account : ",FMAMLEDG:
                             "/",FMAMACCT:
                             "</RETURN_VALUE>"
          GOTO      CHKFMS98
.
CHKFMS98  CALL      XMLEND00
CHKFMS99  RETURN
+
.----------------------------------------------------------------------
. get subjective/commodity translation
.----------------------------------------------------------------------
GTRA0000  PACK      KEY8,FMAMLEDG,SILTSUB,SP70                         *C-59696
          CALL      RDSILT1
.
GTRA9999  RETURN
+
.----------------------------------------------------------------------
. Allocate Next Purchase Order Number
. Input  SIWAWAR - Warehouse Code
. Output SIPAPON - Purchase Order Number
.----------------------------------------------------------------------
NXTORD00  MOVE     ZERO,COUNT
          MOVE     SIWAWAR,KEY5
.
NXTORD05  CALL     RLSIWA1
          BRANCH   OVRCD,NXTORD99,NXTORD10
          MOVE     SIWANPO,ORDERNO
          SUB      ONE,ORDERNO
.
          REPEAT
            ADD      ONE,ORDERNO
            MOVE     ORDERNO,KEY7
            CALL     RASIPA1
          UNTIL    (OVRCD=1)
.
          MOVE     ORDERNO,SIPAPON
          ADD      ONE,ORDERNO
          MOVE     ORDERNO,SIWANPO
          CALL     UPSIWA1
          CALL     UUSIWA1
          MOVE     ZERO,OVRCD
          GOTO     NXTORD99
.
NXTORD10  ADD      ONE,COUNT
          COMPARE  FIVE,COUNT
          GOTO     NXTORD05 IF NOT EQUAL
          MOVE     ZERO,COUNT
.
NXTORD99  RETURN
+
.------------------------------------------------------------------------------
. Build Redirect
.------------------------------------------------------------------------------
.
BREDIR00  REP       " +",SIPOA001
          REP       " +",SELPRINT
.
          STRIP     REDIRECT
          ENDSET    REDIRECT
          APPEND    "&sipoa001=",REDIRECT
          APPEND    SIPOA001,REDIRECT
          APPEND    "&selprint=",REDIRECT
          APPEND    SELPRINT,REDIRECT
          APPEND    "&printfax=",REDIRECT
          APPEND    PRINTFAX,REDIRECT
          RESET     REDIRECT
.
          REP       "+ ",SIPOA001
          REP       "+ ",SELPRINT
.
BREDIR99  RETURN
+
.------------------------------------------------------------
. Update Purchase Order 
.------------------------------------------------------------
UPDORD00  MATCH     Z70,SIPOA001
          GOTO      ADDORD90 IF EQUAL
          MATCH     SP70,SIPOA001
          GOTO      ADDORD90 IF EQUAL
          MATCH     Z70,SIPOC002
          GOTO      ADDORD91 IF EQUAL
          MATCH     SP70,SIPOC002
          GOTO      ADDORD91 IF EQUAL
.
          PACK      KEY10,SIPOA001,SIPOC002,SP70
          CALL      RDSIPC1
          BRANCH    OVRCD,UPDORD91
.
          CALL      MVSIPC00
          CALL      UPSIPC1
          GOTO      UPDORD99
.
UPDORD90  MOVE      ONE,EXIT     * Cannot find header record
          GOTO      UPDORD99
.
UPDORD91  MOVE      TWO,EXIT     * Cannot find detail record
          GOTO      UPDORD99
.
UPDORD99  RETURN
+
.------------------------------------------------------------
. Delete Purchase Order Item
.------------------------------------------------------------
DELORD00  MATCH     Z70,SIPOC001
          GOTO      DELORD90 IF EQUAL
          MATCH     SP70,SIPOC001
          GOTO      DELORD90 IF EQUAL
          MATCH     Z70,SIPOC002
          GOTO      DELORD90 IF EQUAL
          MATCH     SP70,SIPOC002
          GOTO      DELORD90 IF EQUAL
.
          PACK      KEY10,SIPOC001,SIPOC002,SP70
          CALL      RDSIPC1
          BRANCH    OVRCD,DELORD90
.
          CALL      DESIPC1
          GOTO      DELORD99
.
DELORD90  MOVE      ONE,EXIT     * Cannot find record
          GOTO      DELORD99
.
DELORD99  RETURN
+
.------------------------------------------------------------
. Cancel Purchase Order
.------------------------------------------------------------
CANORD00  MATCH     Z70,SIPOA001
          GOTO      CANORD99 IF EQUAL
          MATCH     SP70,SIPOA001
          GOTO      CANORD99 IF EQUAL
.
          PACK      KEY7,SIPOA001,SP70
          CALL      RDSIPA1
          BRANCH    OVRCD,CANORD20
.
          CALL      DESIPA1
.
CANORD20  PACK      KEY10,SIPOA001,SP70
          CALL      RSSIPC1
          CALL      RKSIPC1
          BRANCH    OVRCD,CANORD99
.
          MATCH     SIPOA001,SIPCPON
          GOTO      CANORD99 IF NOT EQUAL
.
          PACK      KEY10,SIPCPON,SIPCITM,SP10
          CALL      DESIPC1
          GOTO      CANORD20
.
CANORD99  RETURN
.------------------------------------------------------------
. Finish Purchase Order
.------------------------------------------------------------
FSHORD00  PACK      KEY15,SP8,SIPOA001,SP70
          CALL      RDSIPA3
          BRANCH    OVRCD,FSHORD90
.
          REP       " 0",SIPADCN
          MATCH     "00000000",SIPADCN           * cancelled ?
          GOTO      FSHORD92 IF NOT EQUAL
.
          REP       " 0",SIPADCM
          MATCH     "00000000",SIPADCM           * completed ?
          GOTO      FSHORD91 IF NOT EQUAL
.
          MOVE      ZERO,EXIT
          IF        PRINTFAX=1
            CALL      FAXPO000
          ELSE
            MATCH     SP70,SELPRINT
            GOTO      FSHORD99 IF EQUAL
            GOTO      FSHORD99 IF EOS
            CALL      SINPRT00
          ENDIF
          GOTO      FSHORD99
.
FSHORD90  MOVE      "Cannot find Purchase order.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FSHORD99
.
FSHORD91  MOVE      "Purchase order has been completed.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FSHORD99
.
FSHORD92  MOVE      "Purchase order has been cancelled.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FSHORD99
.
FSHORD99  RETURN
+
.********************************************************************
. Single Order Print
.********************************************************************
SINPRT00  MOVE      ZERO,NOPRINT
          CALL      SINORDPR                     * print purchase order
          MOVE      ZERO,EXIT
.
SINPRT99  RETURN
+
.------------------------------------------------------------
. Fax Orders Not Yet Printed
.------------------------------------------------------------
FAXPO000  MOVE      ONE,NOPRINT          * we'll control printing here !
.
          CALL      FXRAN000
          BRANCH    EXIT,FAXPO900
.
          CALL      SINORDFX                     * fax purchase order
          GOTO      FAXPO999                    
.
FAXPO900  MOVE      ONE,EXIT
FAXPO999  RETURN
+
.------------------------------------------------------------
. Supply Code Search
.------------------------------------------------------------
SRHCOD00  RESET     UPDTTYPE
.
          CLEAR     WEBTITLE
          MOVE      "Code Search",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SRHCOD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      SRHCOD99
.
SRHCOD99  RETURN
+
.------------------------------------------------------------
. Supply Supplier Details
.------------------------------------------------------------
CATSUP00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      CATSUP70 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add Formaction
          GOTO      CATSUP10 IF EQUAL
.
          GOTO      CATSUP90
.
CATSUP10  PACK      KEY7,SICIC001,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,CATSUP91
.
          PACK      KEY27,SICIC001,SICIC002,SICIC003,SP70
          CALL      RDSIIC1
          COMPARE   ZERO,OVRCD
          GOTO      CATSUP92 IF EQUAL
.
          CALL      CLRSIC00
          CALL      MVSIIC00
          CALL      WRSIIC1
          GOTO      CATSUP99
.
CATSUP70  PACK      KEY7,SICIC001,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,CATSUP91
.
          PACK      KEY5,SICIC002,SP10
          CALL      RDAPMA1
          BRANCH    OVRCD,CATSUP93
.
          CLEAR     WEBTITLE
          MOVE      "Supply Supplier",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CATSUP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      CATSUP99
.
CATSUP90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CATSUP99
.
CATSUP91  MOVE      "Cannot find Supply Master Record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CATSUP99
.
CATSUP92  MOVE      "Supply Supplier Details already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CATSUP99
.
CATSUP93  MOVE      "Cannot find Supplier Record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CATSUP99
.
CATSUP99  RETURN
+
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD99,PROFLD50:
                             PROFLD60,PROFLD70
.
          GOTO      PROFLD99 
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13
          GOTO      PROFLD99
.
PROFLD11  CALL      SIPA0000    * Purchase Order Header
          GOTO      PROFLD99  
.
PROFLD12  CALL      SIPC0000    * Purchase Order Line Detail
          GOTO      PROFLD99  
.
PROFLD13  CALL      MISC0000    
          GOTO      PROFLD99  
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21
          GOTO      PROFLD99  
.
PROFLD21  CALL      SRCH0000
          GOTO      PROFLD99  
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31,PROFLD32
          GOTO      PROFLD99  
.
PROFLD31  CALL      MISC0000
          GOTO      PROFLD99  
.
PROFLD32  CALL      SIIC0000
          GOTO      PROFLD99  
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51,PROFLD52
          GOTO      PROFLD99
.
PROFLD51  CALL      SCIA0000
          GOTO      PROFLD99
.
PROFLD52  CALL      SIIA0000
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62
          GOTO      PROFLD99
.
PROFLD61  CALL      SIMP0000
          GOTO      PROFLD99
.
PROFLD62  CALL      SIIM0000
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71,PROFLD72
          GOTO      PROFLD99
.
PROFLD71  CALL      SCCA0000
          GOTO      PROFLD99
.
PROFLD72  
..CALL      SICA0000
          GOTO      PROFLD99
.
PROFLD99  RETURN
.------------------------------------------------------------------------------
. Miscellanous tags
.------------------------------------------------------------------------------
MISC0000  BRANCH    FLDITMNO,MISC0100,MISC0200,MISC0300,MISC0400,MISC0500:
                             MISC0600,MISC0700,MISC0800,MISC0900
          GOTO      MISC9999
.
MISC0100  WRITE     HTMLFILE;OPCNWHCD;
          GOTO      MISC9999
.
MISC0200  WRITE     HTMLFILE;SNCOMDPC;
          GOTO      MISC9999
.
MISC0300  CALL      LSTPOC00
          GOTO      MISC9999
.
MISC0400  WRITE     HTMLFILE;PRINTFAX;
          GOTO      MISC9999
.
MISC0500  WRITE     HTMLFILE;SELPRINT;
          GOTO      MISC9999
.
MISC0600  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISC0610
.
          WRITE     HTMLFILE;SICIC001;
          GOTO      MISC9999
.
MISC0610  WRITE     HTMLFILE;SIIADES; * read of sinciaf is in the main
          GOTO      MISC9999
.         
MISC0700  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISC0710
.
          WRITE     HTMLFILE;SICIC002;
          GOTO      MISC9999
.
MISC0710  WRITE     HTMLFILE;APMASN1; * read of apsmasaf is in the main
          GOTO      MISC9999
.
MISC0800  PACK      KEY30,SIIAISS,SP70
          CALL      RSSIFA1
MISC0810  CALL      RKSIFA1
          BRANCH    OVRCD,MISC9999
.
          MATCH     SIIAISS,SIFAISSU
          GOTO      MISC9999 IF NOT EQUAL
.
          PACK      KEY17,QUOTE,SIFASUPP,QUOTE,SP70
          WRITE     HTMLFILE;"<option value=",KEY17,">",SIFASUPP,"</option>";
          GOTO      MISC0810
.
MISC0900  MATCH     Z70,SIPOC007
          GOTO      MISC9999 IF EQUAL
          WRITE     HTMLFILE;SIPOC007;
          GOTO      MISC9999
.
MISC9999  RETURN
+
.------------------------------------------------------------------------------
. List of Purchase Order Line Items
.------------------------------------------------------------------------------
LSTPOC00  MATCH     Z70,SIPOA001
          GOTO      LSTPOC99 IF EQUAL
          MATCH     SP70,SIPOA001
          GOTO      LSTPOC99 IF EQUAL
          MOVE      ZERO,TOTGRAMT
.
          PACK      KEY10,SIPOA001,SP10
          CALL      RSSIPC1
LSTPOC10  CALL      RKSIPC1
          BRANCH    OVRCD,LSTPOC90
.
          MATCH     SIPOA001,SIPCPON
          GOTO      LSTPOC90 IF NOT EQUAL
.
          MOVE      SIPCECT,TOTLNAMT
          MULT      SIPCOQT,TOTLNAMT
          ADD       TOTLNAMT,TOTGRAMT
.
          MOVE      SIPCOQT,F10
          REP       "#' #" ",SIPCPN
          REP       "#' #" ",SIPCPD
          WRITE     HTMLFILE;"<tr><td><a href='javascript:UpdateItem":
                             "(#"",SIPCPON,"#",#"",SIPCITM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif":
                             " hspace=4 border=0 align=absmiddle></a>":
                             SIPCPN,"</td>":
                             "<td>",SIPCPD,"</td>":
                             "<td align=right>",F10,"</td>":
                             "<td align=right>$",SIPCECT,"</td>":
                             "<td align=right>$",TOTLNAMT,"</td></tr>";
          
          GOTO      LSTPOC10
.
.         Total Line
.
LSTPOC90  WRITE     HTMLFILE;"<tr><td colspan=3>&nbsp;</td>":
                             "<td align=right><b>Total</b></td>":
                             "<td align=right><b>$",TOTGRAMT,"</td></tr>";
LSTPOC99  RETURN
+
.------------------------------------------------------------------------------
. Search tags
.------------------------------------------------------------------------------
SRCH0000  BRANCH    FLDITMNO,SRCH0100,SRCH0200,SRCH0300,SRCH0400,SRCH0500:
                             SRCH0600,SRCH0700,SRCH0800
          GOTO      MISC9999
.
SRCH0100  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,SRCH0110
.
          WRITE     HTMLFILE;SUPPLIER;
          GOTO      SRCH9999
.
SRCH0110  PACK      KEY5,SUPPLIER,SP10
          CALL      RDAPMA1
          IF        OVRCD=1
            MOVE      "Unknown Supplier",APMASN1
          ENDIF
          WRITE     HTMLFILE;APMASN1;
          GOTO      SRCH9999
          
SRCH0200  CALL      TABCAT00      * Search Supply Supplier Details
          GOTO      SRCH9999
.
SRCH0300  CALL      NEXTCT00      * Link to Next Group
          GOTO      SRCH9999
.
SRCH0400  CALL      PREVCT00      * Link to Previous Group
          GOTO      SRCH9999
.
SRCH0500  CALL      TABCST00      * Search Cost Center
          GOTO      SRCH9999
.
SRCH0600  CALL      NEXTCC00      * Link to Next Group
          GOTO      SRCH9999
.
SRCH0700  CALL      PREVCC00      * Link to Previous Group
          GOTO      SRCH9999
.
SRCH0800  WRITE     HTMLFILE;STARTKEY;
          GOTO      SRCH9999
.
SRCH9999  RETURN
+
.------------------------------------------------------------
. Supply Supplier Details Search List
.------------------------------------------------------------
TABCAT00  CALL      CATHED00              * Table Heading
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button
.
          IF        PRVIFLAG = 1
            MATCH     SP70,PREVIKEY
            IF        !@EQUAL
              CALL      GPRCAT00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVIKEY
              GOTO      TABCAT05
            ENDIF
            PACK      KEY27,SUPPLIER,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      TABCAT05
          ENDIF
.
.         * Next button
.
          MATCH     SP70,NEXTIKEY
          IF        !@EQUAL
            CALL      GNXCAT00              * Check to see if at the last rec
            PACK      KEY27,NEXTIKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTIKEY
            GOTO      TABCAT05
          ENDIF
.
          PACK      KEY27,SUPPLIER,STARTKEY,SP70
TABCAT05  CALL      RSSIIC3
TABCAT10  CALL      RKSIIC3
          BRANCH    OVRCD,TABCAT99
.
          MATCH     SUPPLIER,SIICSUP
          GOTO      TABCAT99 IF NOT EQUAL
.
          PACK      NEXTIKEY,SIICSUP,SIICCAT,SIICSUT,SP70
          MATCH     SP70,PREVIKEY
          IF        @EQUAL
            PACK      PREVIKEY,SIICSUP,SIICCAT,SIICSUT,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TABCAT10
          ENDIF
.
          CALL      CATROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TABCAT10 IF NOT EQUAL
.
TABCAT99  RETURN
+
.--------------------------------------------------------------------------
. GPRCAT00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
GPRCAT00  PACK      SAVKEY27,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          PACK      KEY27,PREVIKEY,Z70
          CALL      RSSIIC3                     * Position for batch #
GPRCAT10  CALL      RPSIIC3                     * read next record
          BRANCH    OVRCD,GPRCAT91               * end of file
.
          MATCH     SUPPLIER,SIICSUP
          GOTO      GPRCAT91 IF NOT EQUAL
.
          PACK      SAVKEY27,SIICSUP,SIICCAT,SIICSUT,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      GPRCAT90 IF EQUAL
.
          GOTO      GPRCAT10
.
GPRCAT90  MOVE      SAVKEY27,KEY27          * New start key for display
          SUB       ONE,NORECORD
          GOTO      GPRCAT99
.
GPRCAT91  PACK      KEY27,SUPPLIER,SP70
          SUB       ONE,NORECORD
          GOTO      GPRCAT99
.
GPRCAT99  RETURN
+
.------------------------------------------------------------
. GNXCAT00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
GNXCAT00  PACK      KEY27,NEXTIKEY,SP70
          CALL      RSSIIC3                     * Position for batch #
          CALL      RKSIIC3                     * read next record
          BRANCH    OVRCD,GNXCAT90               * end of file
.
          MATCH     SUPPLIER,SIICSUP
          GOTO      GNXCAT90 IF NOT EQUAL
.
          GOTO      GNXCAT99
.
GNXCAT90  PACK      NEXTIKEY,SUPPLIER,SP70
          GOTO      GNXCAT99                * No more record goto first record
.
GNXCAT99  RETURN
.------------------------------------------------------------
.  Table Selected Supply (TABLE HEADING)
.------------------------------------------------------------
CATHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>Supply</td>":
                             "<td class=HeadingCell width=20%>Supply Unit</td>":
                             "<td class=HeadingCell width=65%>Description</td>":
                             "</tr>"
CATHED99  RETURN
.------------------------------------------------------------
. Read Selected Supply details and display 
.------------------------------------------------------------
CATROW00  PACK      KEY7,SIICCAT,SP10
          CALL      RDSIIA1
          IF        OVRCD=1
            MOVE      "Unknown Supply",SIIADES
          ENDIF
          REP       "#' #" ",SIIADES
          REP       "#' #" ",SIICPD1
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:updateParent":
                             "(#"",SIICSUP,"#",#"",SIIADES,"#",#"",SIICCAT:
                             "#",#"",SIICSUT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             SIICCAT,"</td>":
                             "<td>",SIICSUT,"</td>":
                             "<td>",SIIADES,"</td>":
                             "</tr>"
.
CATROW99  RETURN
.-----------------------------------------------------------
. Link to Next Group 
.-----------------------------------------------------------
NEXTCT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",SUPPLIER
          REP       " +",NEXTIKEY
.
          WRITE     HTMLFILE;"sinweb02.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nextikey=",NEXTIKEY:
                                 "&supplier=",SUPPLIER;
.
          REP       "+ ",SUPPLIER
          REP       "+ ",NEXTIKEY
.
NEXTCT99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of patients
.-------------------------------------------------------------
PREVCT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",SUPPLIER
          REP       " +",PREVIKEY
.
          WRITE     HTMLFILE;"sinweb02.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prviflag=",ONE:
                                 "&previkey=",PREVIKEY:
                                 "&supplier=",SUPPLIER;
.
          REP       "+ ",SUPPLIER
          REP       "+ ",PREVIKEY
.
PREVCT99  RETURN
+
.------------------------------------------------------------
. Cost Center Search List
.------------------------------------------------------------
TABCST00  CALL      CSTHED00              * Table Heading
.         
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button
.
          IF        PRVCFLAG = 1
            MATCH     SP70,PREVCKEY
            IF        !@EQUAL
              CALL      GPRCST00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              PACK      PREVCKEY,STARTKEY,SP70
              GOTO      TABCST05
            ENDIF
            PACK      KEY5,STARTKEY,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      TABCST05
          ENDIF
.
.         * Next button
.
          MATCH     SP70,NEXTCKEY
          IF        !@EQUAL
            CALL      GNXCST00              * Check to see if at the last rec
            PACK      KEY5,NEXTCKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            PACK      NEXTCKEY,STARTKEY,SP70
            CALL      RSSICA1                * skip this key
            GOTO      TABCST10
          ENDIF
.
          PACK      KEY5,STARTKEY,SP70
TABCST05  CALL      RDSICA1                  * read full key
          COMPARE   ZERO,OVRCD
          GOTO      TABCST15 IF EQUAL
.
TABCST10  CALL      RKSICA1
          BRANCH    OVRCD,TABCST99
.
TABCST15  PACK      KEY9,PASSCODE,SP70      * check if All Warehouse
          CALL      RDSICS1
          IF        OVRCD=1 
            PACK      KEY9,PASSCODE,SICACODE,SP70  * check specific WH security
            CALL      RDSICS1
            BRANCH    OVRCD,TABCST10
          ENDIF
.
          PACK      NEXTCKEY,SICACODE,SP70
          MATCH     SP70,PREVCKEY
          IF        @EQUAL
            PACK      PREVCKEY,SICACODE,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TABCST10
          ENDIF
.
          CALL      CSTROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TABCST10 IF NOT EQUAL
.
TABCST99  RETURN
+
.--------------------------------------------------------------------------
. GPRCST00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
GPRCST00  PACK      SAVKEY5,STARTKEY,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          PACK      KEY5,PREVCKEY,Z70
          CALL      RDSICA1                     * Position for batch #
          COMPARE   ZERO,OVRCD
          GOTO      GPRCST15 IF EQUAL
.
GPRCST10  CALL      RPSICA1                     * read next record
          BRANCH    OVRCD,GPRCST91              * end of file
.
GPRCST15  PACK      KEY9,PASSCODE,SP70      * check if All Warehouse
          CALL      RDSICS1
          IF        OVRCD=1
            PACK      KEY9,PASSCODE,SICACODE,SP70  * check specific WH security
            CALL      RDSICS1
            BRANCH    OVRCD,GPRCST10
          ENDIF 
.
          PACK      SAVKEY5,SICACODE,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      GPRCST90 IF EQUAL
.
          GOTO      GPRCST10
.
GPRCST90  MOVE      SAVKEY5,KEY5          * New start key for display
          SUB       ONE,NORECORD
          GOTO      GPRCST99
.
GPRCST91  PACK      KEY5,STARTKEY,SP70
          SUB       ONE,NORECORD
          GOTO      GPRCST99
.
GPRCST99  RETURN
+
.------------------------------------------------------------
. GNXCST00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
GNXCST00  PACK      KEY5,NEXTCKEY,SP70
          CALL      RSSICA1                     * Position for batch #
          CALL      RKSICA1                     * read next record
          BRANCH    OVRCD,GNXCST90               * end of file
.
          GOTO      GNXCST99
.
GNXCST90  PACK      NEXTCKEY,STARTKEY,SP70
          GOTO      GNXCST99                * No more record goto first record
.
GNXCST99  RETURN
.------------------------------------------------------------
.  Table Selected Supply (TABLE HEADING)
.------------------------------------------------------------
CSTHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>Cost Centre</td>":
                             "<td class=HeadingCell width=48%>Description</td>":
                             "<td class=HeadingCell width=17%>Telephone</td>":
                             "<td class=HeadingCell width=20%>Contact</td>":
                             "</tr>"
CSTHED999  RETURN
.------------------------------------------------------------
. Read Selected Supply details and display
.------------------------------------------------------------
CSTROW00  REP       "#' #" ",SICADESC
          REP       "#' #" ",SICACONT
.
          MATCH     SP70,SICATELE
          IF        @EQUAL
            MOVE      "&nbsp;",SICATELE
          ENDIF
.
          MATCH     SP70,SICACONT
          IF        @EQUAL
            MOVE      "&nbsp;",SICACONT
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:updateParent":
                             "(#"",SICACODE,"#",#"",SICADESC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             SICACODE,"</td>":
                             "<td>",SICADESC,"</td>":
                             "<td>",SICATELE,"</td>":
                             "<td>",SICACONT,"</td>":
                             "</tr>"
.
CSTROW99  RETURN
+
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTCC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY
          REP       " +",NEXTCKEY
.
          WRITE     HTMLFILE;"sinweb02.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nextckey=",NEXTCKEY:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "+ ",NEXTCKEY
.
NEXTCC99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of patients
.-------------------------------------------------------------
PREVCC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY
          REP       " +",PREVCKEY
.
          WRITE     HTMLFILE;"sinweb02.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prvcflag=",ONE:
                                 "&prevckey=",PREVCKEY:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "+ ",PREVCKEY
.
PREVCC99  RETURN
+
.------------------------------------------------------------
. Check Range Details
.------------------------------------------------------------
FXRAN000  MOVE      ZERO,EXIT
.
          MOVE      SIPASUP,KEY5
          CALL      RDAPMA1
          BRANCH    OVRCD,FXRAN900
          MATCH     SP70,APMAUR2              * Must have a Fax Number to Fax
          GOTO      FXRAN900 IF EQUAL
.
          GOTO      FXRAN999
.
FXRAN900  MOVE      "Supplier has missing fax number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FXRAN999
.
FXRAN999  RETURN
+
.**********************************************************************
.*                            SPLDELET                                *
.*                     Delete the Spool File                          *
.**********************************************************************
SPLDELET  PACK        CSPDESC,CSPDESC,SP20
          MATCH       SP20,CSPDESC
          IF          !(@EQUAL)
            PREPARE     SPLTFILE,CSPDESC
            CLOSE       SPLTFILE
.
            OPEN        IBASPOL1,"ibaspolf"
            MOVE        SPLFILE,KEY8
            CALL        DESPOL1              * delete from files spooled
          ENDIF
          MOVE        SP8,SPLFILE
SPLDEL99  RETURN
.
.
.**********************************************************************
.*                            OPTNS000                                *
.**********************************************************************
OPTNS000
OPTNS999  RETURN
.**********************************************************************
.*                            CLSBOX00                                *
.**********************************************************************
CLRBX000
CLRBX999  RETURN
+
.----------------------------------------------------------------------
. SINORDFX - Fax Purchase Order
.
.  Returns  EXIT    (0=faxed 1=missing or locked)
.
.  Requires SIPAPON (Purchase order number)
.           NOPRINT (0=print from this routine, 1=print elsewhere)
.           SELPRINT called prior to this routine   } These two requirements
.           Open Files : IBACODE1 + IBAPRINT1       } exist in function SELPRT00
.           Includes   : IBACODFD/INC IBAPRNFD/INC
.                        IBAIOCOD/INC IBAIOPRN/INC IBAPRINT
.                        SINTMPDF/INC SINCODFD/IO  SINORIFD/IO  APSMASFD/IO
.                        SINSIAFD/IO  SINPOAFD/IO  SINPOBFD/INC SINPOCFD/INC
.                        SINPODFD/IO
.           Note : already includes IBAPASFD & IBAPASIO
.
.  Mods:  18/03/2003  Davin  Quote 15040
.                     Print new delivery point in header (if parameter on)
.----------------------------------------------------------------------
SINORDFX  READ      CONTROLF,TWENTY3;*124,HORDDES
          READ      CONTROLF,TWENTY6;*248,HPURCHP
          CALL      LCKPO000                * Lock P/O
          BRANCH    OVRCD,SINFAX99,SINFAX99
.
          CALL      RDCON000                * Read Control File Details
.
          CALL      OPNPRINT
.
          CALL      FORD0000                * print routine
          BRANCH    EXIT,SINFAX99           * could not print ?
.                                           * check if anything to print
          CALL      UUSIPA1
.
          IF        NOPRINT=0
            IF        !(CPAGENO>0)
              CLEAR     WEBTITLE
              APPEND    "Nothing to Print for PO ",WEBTITLE
              APPEND    "SIPAPON",WEBTITLE
              RESET     WEBTITLE
              CALL      WEBERR00
              MOVE      ONE,EXIT
              GOTO      SINFAX99
            ENDIF
          ENDIF
.
          MOVE      APMAUR2,FAXNUMB
          CALL      FAXPRINT
.
SINFAX99  RETURN
.------------------------------------------------------------
. Lock Purchase Order
.------------------------------------------------------------
LCKPO000  PACK      KEY7,SIPAPON,SP70            * lock purchase order record
          CALL      RLSIPA1
          BRANCH    OVRCD,LCKPO999,LCKPO999             * 1=missing, 2=locked
.
LCKPO999  RETURN
.------------------------------------------------------------
. Read Control File Details
.------------------------------------------------------------
RDCON000  READ      CONTROLF,TEN3;CHADD1,CHADD2,CHPOST:
                                 *129,CHTELEB
.
          MOVE      "30",MAXITEMS  * NEED TO ADJUST
.
RDCON999  RETURN
.------------------------------------------------------------
. FORD - Fax Order
.        Requires SIPAPON (Purchase order number)
.        Returns  EXIT    (0=printed 1=missing or locked)
.------------------------------------------------------------
FORD0000  MOVE      ZERO,CPAGENO                 * reset page no.
          MOVE      "999",CLNO                   * init last line number
          MOVE      ZERO,TF7P2                   * clear total
          MOVE      "1",COUNTFL1                 * count number of pages
          MOVE      "0",COUNTFL2
          CALL      WFAX0000                     * print details
.
          MOVE      CPAGENO,F2B                  * save total page number
          MOVE      ZERO,CPAGENO                 * reset page no.
          MOVE      "999",CLNO                   * init last line number
          MOVE      ZERO,TF7P2                   * clear total
          MOVE      "0",COUNTFL1                 * count number of pages
          CALL      WFAX0000                     * print details
.
          COMPARE   ZERO,CPAGENO
          CALL      ENDF0000 IF NOT EQUAL        * print end of purchase order
.
FORD9000  MOVE      ZERO,EXIT                    * everything is cool !!
FORD9999  RETURN
.----------------------------------------------------------------------
. FHED - print report                               Called by PORD
.----------------------------------------------------------------------
FHED0000  IF        (COUNTFL1=0)&(COUNTFL2=0)&(CPAGENO>0)
            CALL      FILPAG00              * fill to end of page if printing
          ENDIF
.
          ADD       ONE,CPAGENO             * next page
          MOVE      "0",CLNO                * reset line number
.
          COMPARE   ONE,COUNTFL1
          GOTO      FHED9999 IF EQUAL       * just counting pages ?
          COMPARE   ONE,COUNTFL2
          GOTO      FHED9999 IF EQUAL       * just counting pages ?
.
          REP       " 0",SIPADCN            * check if cancelled
          MATCH     "00000000",SIPADCN
          IF        @EQUAL
            REP       " 0",SIPADCM          * check if completed
            MATCH     "00000000",SIPADCM
            IF        @EQUAL
              REP       " 0",SIPADPR        * check if reprint
              MATCH     "00000000",SIPADPR
              IF        @EQUAL
                MOVE      SP70,KEY20
              ELSE
                MOVE      " Reprint            ",KEY20
              ENDIF
            ELSE
              MOVE      "Completed ",KEY10
              UNPACK    SIPADCM,CCENT,CYEAR,CMON,CDAY
              CALL      PACDATE
              PACK      KEY20,KEY10,CPCDATE,SP70
            ENDIF
          ELSE
            MOVE      "Cancelled ",KEY10
            UNPACK    SIPADCN,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            PACK      KEY20,KEY10,CPCDATE,SP70
          ENDIF
.
          PACK      KEY10,CCC,CYY,CMM,CDD,SP70
          REP       " 0",KEY10
          UNPACK    KEY10,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          UNPACK    SP70,SIORHOSP,SIOREXT
          PACK      KEY3,SIPAORI,SP70
          CALL      RDSIOR1
.
          UNPACK    SP70,APMASN1,APMASN2
          UNPACK    SP70,APMASA1,APMASA2
          UNPACK    SP70,APMASA3,APMASPC,APMASTEL,APMAUR2
          UNPACK    SP70,APMASCON
          PACK      KEY5,SIPASUP,SP70
          CALL      RDAPMA1
.
          MOVE      SP70,SICDDESC
          MATCH     SP70,SIPAMES
          IF        !@EQUAL
            MOVE      "ME ",KEY3
            PACK      KEY6,KEY3,SIPAMES,SP70
            CALL      RDSICD1
          ENDIF
          PACK      MESSDESK,SICDDESC,SP70
.
          MOVE      SP70,SICDDESC
          MATCH     SP70,SIPACON
          IF        !(@EQUAL)
            MOVE      "CF ",KEY3
            PACK      KEY6,KEY3,SIPACON,SP70
            CALL      RDSICD1
          ENDIF
          PACK      CONFDESK,SICDDESC,SP70
.
          MOVE      CPAGENO,F2A
.
          MOVE      SP70,SIWADES
          PACK      KEY5,SIPAWAR,SP70
          CALL      RDSIWA1
.
          CALL      FSUPP000             * Format Supplier Name & Address
          CALL      FCRED000             * Format Creditor
.
          READ      CONTROLF,SIXTY3;*241,SNCOMDPC   * multiple delivery point
          COMPARE   ONE,SNCOMDPC
          IF        @EQUAL
            MOVE      SIPAMDP,KEY3
            CALL      RDSIDP1
          ENDIF
.
.
FHED0500  STRIP     SUPLIN1
          STRIP     SUPLIN2
          STRIP     SUPLIN3
          STRIP     SUPLIN4
          STRIP     SUPLIN5 
.
          APPEND    SUPLIN1,D40
          APPEND    SP1,D40
          APPEND    SUPLIN2,D40
          APPEND    SP1,D40
          APPEND    SUPLIN3,D40
          APPEND    SP1,D40
          APPEND    SUPLIN4,D40
          APPEND    SP1,D40
          APPEND    SUPLIN5,D40
.
          RESET     D40
.
          PRINT        "To Supplier: ",APMACRD:
                       *38,"Deliver To:":
                       *79,"Order:  ",SIPAPON:
                    *N,CRELIN1:
                       *38,D40:
                       *79,"Page :",F2A,"  of ",F2B:
                    *N,CRELIN2:
                       *79,"Date : ",CPCDATE:
                    *N,CRELIN3:
                       *38,"Ph.:       ",APMASTEL:
                    *N,CRELIN4:
                       *38,"Fax:       ",APMASFAX:
                    *N,CRELIN5:
                       *38,KEY20:
                    *N,"Ph.: ",APMACTEL:
                    *N,"Fax: ",APMACFAX:
                    *N,"----------------------------------------------":
                      "-----------------------------------------------":
                    *N,"Line No  Supplier Part Number         Quantity":
                      "  Unit and       Cost      Unit Price     Value":
                    *N," Stk No  and Description                      ":
                      "  Delivery Date  Centre":
                    *N,"----------------------------------------------":
                      "-----------------------------------------------"
.
          UNPACK    SP70,DELDT1,DELDT2,DELDT3,DELDT4,DELDT5
          UNPACK    SP70,DELDT6,DELDT7,DELDT8,DELDT9,DELDT10
.
FHED9999  RETURN
.----------------------------------------------------------------------
. WFAX - print data line                            Called by PORD
.        Requires : COUNTFL1 (1=don't print)
.----------------------------------------------------------------------
WFAX0000  PACK      KEY10,SIPAPON,SP70         * loop through line items
          CALL      RSSIPC1                    * line item loop
WFAX1000  CALL      RKSIPC1                    * get next line item
          BRANCH    OVRCD,WFAX5000
          MATCH     SIPCPON,SIPAPON            * at end of purchase order ?
          IF        !@EQUAL
            CALL      RPSIPC1                  * get previous details for print
            GOTO      WFAX5000
          ENDIF
.
WFAX2000  MOVE      "1",COUNTFL2               * just counting !!
          MOVE      CLNO,SCLNO                 * save current line number
          MOVE      CPAGENO,SCPAGENO           * save current page number
          CALL      FAXA0000                   * count line item data lines
.                                              * check if page will be filled
.                                              * and if item goes over 1 page
          IF        (CPAGENO-1=SCPAGENO)&!(CLNO>SCLNO)&!(999=SCLNO)
            MOVE      SCLNO,CLNO               * restore current line number
            MOVE      SCPAGENO,CPAGENO         * restore current page number
            MOVE      "0",COUNTFL2
            CALL      FHED0000                 * get next page
            GOTO      WFAX2000                 * restart from next page
          ENDIF
.
          IF        COUNTFL1=0
            MOVE      SCLNO,CLNO               * restore current line number
            MOVE      SCPAGENO,CPAGENO         * restore current page number
            MOVE      "0",COUNTFL2
            CALL      FAXA0000                 * print line item data lines
          ENDIF
.
          GOTO      WFAX1000                   * get next line item
.
.---- purchase order comment loop ----
.
WFAX5000  PACK      KEY10,SIPAPON,SP70         * loop through purch ord comments
          CALL      RSSIPB1
WFAX6000  CALL      RKSIPB1                    * get next line item comment
          BRANCH    OVRCD,WFAX9000
          MATCH     SIPBPON,SIPAPON            * at end of comments ?
          GOTO      WFAX9000 IF NOT EQUAL
          MATCH     SIPBCOM,SP70               * blank line ?
          GOTO      WFAX6000 IF EQUAL
.
WFAX7000  COMPARE   MAXITEMS,CLNO              * end of page ?
          CALL      FHED0000 IF NOT LESS       * start new page
          ADD       "1",CLNO                   * increment line number
          IF        COUNTFL1=0
            PRINT     *10,SIPBCOM
          ENDIF
          GOTO      WFAX6000
.
WFAX9000
WFAX9999  RETURN
.----------------------------------------------------------------------
. FAXA - print line items                           Called by WFAX
.        Requires : COUNTFL2 (1=dont print)
.----------------------------------------------------------------------
FAXA0000  CALL      CLRLIN00
          PACK      LINE1,SIPCPN,SP70        * Get Part Number
          MATCH     SP70,SIPCCAT             * Supply blank ?
          IF        @EQUAL
            MOVE      SIPCPD,LINE2           * Not Catloged
          ELSE
            MOVE      SP70,SIICPD1
            MOVE      SP70,SIICPD2
            PACK      KEY27,SIPCCAT,SIPASUP,SIPCSUT,SP70
            CALL      RDSIIC1
            IF        OVRCD=0
              MOVE      SIICPD1,LINE2        * Use Supplier Part Description
              MOVE      SIICPD2,LINE3
            ELSE
              MOVE      SIPCPD,LINE2
            ENDIF
          ENDIF
.
.---- get purchase order references from contract details ----
.
          PACK      SISDPO1,SP70
          PACK      SISDPO2,SP70
          PACK      KEY45,SIPCCON,SIPASUP,SIPCCAT,SIPCCDT,SIPCSUT,SP70
          CALL      RDSISD1
          UNPACK    SISDPO1,LINE4
          UNPACK    SISDPO2,LINE5
.
          MOVE      SIPCOQT,F7
          ASSIGN    SIPCOQT*SIPCECT,F7P2
          MOVE      SIPCECT,F8P4
          IF        !(SIPCECT=-1)&(COUNTFL1=0)&(COUNTFL2=0)
            ADD       F7P2,TF7P2
          ENDIF
.
.     ---- line item comment loop ----
.
          MOVE      "0",PRTFLAG                * nothing printed yet !!
          PACK      KEY13,SIPCPON,SIPCITM,SP70 * loop through line item comments
          CALL      RSSIPD1
FAXA2000  CALL      RKSIPD1                    * get next line item comment
          BRANCH    OVRCD,FAXA4000
          MATCH     SIPDPON,SIPCPON            * at end of comments ?
          GOTO      FAXA4000 IF NOT EQUAL
          MATCH     SIPDITM,SIPCITM            * at end of comments ?
          GOTO      FAXA4000 IF NOT EQUAL
          MATCH     SIPDCOM,SP70               * blank line ?
          GOTO      FAXA2000 IF EQUAL
.
          CALL      FAXB0000                   * print crap
          GOTO      FAXA2000
.
FAXA4000  MOVE      SP70,SIPDCOM
          CALL      FAXB0000                   * make sure crap printed
.
FAXA9999  RETURN
.------------------------------------------------------------
. Clear LINE1..7
.------------------------------------------------------------
CLRLIN00  MOVE      SP70,LINE1                 * clear lines
          MOVE      SP70,LINE2
          MOVE      SP70,LINE3
          MOVE      SP70,LINE4
          MOVE      SP70,LINE5
          MOVE      SP70,LINE6
          MOVE      SP70,LINE7
          RETURN
.----------------------------------------------------------------------
. FAXB - print line items                           Called by FAXA
.        Requires : COUNTFL2 (1=don't print)
.                   PRTFLAG  (1=main data already printed)
.----------------------------------------------------------------------
FAXB0000  BRANCH    PRTFLAG,FAXB1000
.
          MATCH     LINE6,SP70              * save line
          IF        @EQUAL
            PACK      LINE6,SIPDCOM,SP70
            MATCH     SIPDCOM,SP70          * check if it is time to unload
            GOTO      FAXB9999 IF NOT EQUAL
          ELSE
            PACK      LINE7,SIPDCOM,SP70
          ENDIF
.
FAXB0100  MOVE      "0",SECTOR              * consolidate data lines
          MATCH     SP70,LINE1
          WHILE     @EQUAL & (SECTOR<7)
            ADD       ONE,SECTOR
            MOVE      LINE2,LINE1
            MOVE      LINE3,LINE2
            MOVE      LINE4,LINE3
            MOVE      LINE5,LINE4
            MOVE      LINE6,LINE5
            MOVE      LINE7,LINE6
            MOVE      SP70,LINE7
            MATCH     SP70,LINE1
          DO
          MATCH     SP70,LINE2
          WHILE     @EQUAL & (SECTOR<7)
            ADD       ONE,SECTOR
            MOVE      LINE3,LINE2
            MOVE      LINE4,LINE3
            MOVE      LINE5,LINE4
            MOVE      LINE6,LINE5
            MOVE      LINE7,LINE6
            MOVE      SP70,LINE7
            MATCH     SP70,LINE2
          DO
          MATCH     SP70,LINE3
          WHILE     @EQUAL & (SECTOR<7)
            ADD       ONE,SECTOR
            MOVE      LINE4,LINE3
            MOVE      LINE5,LINE4
            MOVE      LINE6,LINE5
            MOVE      LINE7,LINE6
            MOVE      SP70,LINE7
            MATCH     SP70,LINE3
          DO
          MATCH     SP70,LINE4
          WHILE     @EQUAL & (SECTOR<7)
            ADD       ONE,SECTOR
            MOVE      LINE5,LINE4
            MOVE      LINE6,LINE5
            MOVE      LINE7,LINE6
            MOVE      SP70,LINE7
            MATCH     SP70,LINE4
          DO
          MATCH     SP70,LINE5
          WHILE     @EQUAL & (SECTOR<7)
            ADD       ONE,SECTOR
            MOVE      LINE6,LINE5
            MOVE      LINE7,LINE6
            MOVE      SP70,LINE7
            MATCH     SP70,LINE5
          DO
          MATCH     SP70,LINE6
          WHILE     @EQUAL & (SECTOR<7)
            ADD       ONE,SECTOR
            MOVE      LINE7,LINE6
            MOVE      SP70,LINE7
            MATCH     SP70,LINE6
          DO
.
          COMPARE   MAXITEMS,CLNO
          CALL      FHED0000 IF NOT LESS
.
          MOVE      LINE1,KEY60                * print main line 1
          CALL      LINBK000                 * Break up line to 30
.
          ADD       ONE,CLNO                   * increment line number
          IF        COUNTFL2=0
            IF        F8P4=-1
              MOVE      "  T.B.A.       ",KEY13
              MOVE      "  T.B.A.       ",KEY10
            ELSE
              MOVE      F8P4,KEY13
              MOVE      F7P2,KEY10
            ENDIF
.
            PRINT     *5,SIPCITM,*10,KEY30,F7:
                      SP2,SIPCSUT,SIPCCST,SP2,KEY13,KEY10
          ENDIF
.
          COMPARE   MAXITEMS,CLNO              * end of page ?
          CALL      FHED0000 IF NOT LESS       * start new page
.
          MOVE      LINE1,KEY60
          CALL      LINBK000                   * break up line neatly
.
          PACK      KEY60,KEY60,SP70           * print main line 2
          MATCH     SP70,KEY60
          IF        @EQUAL
            MOVE      LINE2,KEY60
            MOVE      LINE3,LINE2
            MOVE      LINE4,LINE3
            MOVE      LINE5,LINE4
            MOVE      LINE6,LINE5
            MOVE      SP70,LINE6
          ENDIF
          PACK      KEY60,KEY60,SP70
          CALL      LINBK000                 * Break up line to 38
.
          UNPACK    SIPCEDD,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          ADD       "1",CLNO                   * increment line number
          IF        COUNTFL2=0
            PRINT     SIPCCAT,*10,KEY30,*52,CPCDATE
            MATCH     SP70,CPCDATE
            IF        !@EQUAL
              MOVE      ZERO,F1
              REPEAT
                ADD       ONE,F1
                MOVE      SP70,KEY15
                LOAD      KEY15,F1,DELDT1,DELDT2,DELDT3,DELDT4,DELDT5:
                                   DELDT6,DELDT7,DELDT8,DELDT9,DELDT10
                MATCH     SP70,KEY15
              UNTIL     @EQUAL
              PACK      KEY15,SIPCITM,DOT,SP1,CPCDATE,SP70
              STORE     KEY15,F1,DELDT1,DELDT2,DELDT3,DELDT4,DELDT5:
                                 DELDT6,DELDT7,DELDT8,DELDT9,DELDT10
            ENDIF
          ENDIF
.
          MATCH     SP70,KEY60                 * print rest of data line
          IF        !@EQUAL
            COMPARE   MAXITEMS,CLNO            * end of page ?
            CALL      FHED0000 IF NOT LESS     * start new page
            ADD       "1",CLNO                 * increment line number
            IF        COUNTFL2=0
              PRINT     *10,KEY60
            ENDIF
          ENDIF
.
          MATCH     SP70,LINE2                 * print data line 2
          IF        !@EQUAL
            COMPARE   MAXITEMS,CLNO            * end of page ?
            CALL      FHED0000 IF NOT LESS     * start new page
            ADD       "1",CLNO                 * increment line number
            IF        COUNTFL2=0
              PRINT     *10,LINE2
            ENDIF
          ENDIF
.
          MATCH     SP70,LINE3                 * print data line 3
          IF        !@EQUAL
            COMPARE   MAXITEMS,CLNO            * end of page ?
            CALL      FHED0000 IF NOT LESS     * start new page
            ADD       "1",CLNO                 * increment line number
            IF        COUNTFL2=0
              PRINT     *10,LINE3
            ENDIF
          ENDIF
.
          MATCH     SP70,LINE4                 * print data line 4
          IF        !@EQUAL
            COMPARE   MAXITEMS,CLNO            * end of page ?
            CALL      FHED0000 IF NOT LESS     * start new page
            ADD       "1",CLNO                 * increment line number
            IF        COUNTFL2=0
              PRINT     *10,LINE4
            ENDIF
          ENDIF
.
          MATCH     SP70,LINE5                 * print data line 5
          IF        !@EQUAL
            COMPARE   MAXITEMS,CLNO            * end of page ?
            CALL      FHED0000 IF NOT LESS     * start new page
            ADD       "1",CLNO                 * increment line number
            IF        COUNTFL2=0
              PRINT     *10,LINE5
            ENDIF
          ENDIF
.
          MATCH     SP70,LINE6                 * print data line 6
          IF        !@EQUAL
            COMPARE   MAXITEMS,CLNO            * end of page ?
            CALL      FHED0000 IF NOT LESS     * start new page
            ADD       "1",CLNO                 * increment line number
            IF        COUNTFL2=0
              PRINT     *10,LINE6
            ENDIF
          ENDIF
.
          MATCH     SP70,LINE7                 * print data line 7
          IF        !@EQUAL
            COMPARE   MAXITEMS,CLNO            * end of page ?
            CALL      FHED0000 IF NOT LESS     * start new page
            ADD       "1",CLNO                 * increment line number
            IF        COUNTFL2=0
              PRINT     *10,LINE7
            ENDIF
          ENDIF
.
          MOVE      ONE,PRTFLAG                * main data printed
          GOTO      FAXB9999
.
.---- print comments data ----
.
FAXB1000  MATCH     SP70,SIPDCOM               * print data line if not blank
          IF        !@EQUAL
            COMPARE   MAXITEMS,CLNO            * end of page ?
            CALL      FHED0000 IF NOT LESS     * start new page
            ADD       "1",CLNO                 * increment line number
            IF        COUNTFL2=0
              PRINT     *10,SIPDCOM
            ENDIF
          ENDIF
.
FAXB9999  RETURN
.----------------------------------------------------------------------
. LINBK - Break up KEY60 into two neat halves        Called by lots
.         Requires - KEY60   (original line)
.         Returns  - KEY30   (line 1)
.                    KEY60   (line 2)
.----------------------------------------------------------------------
LINBK000  RESET     KEY60,31
          CMATCH    SP70,KEY60
          WHILE     !@EQUAL&!@EOS
            BUMP      KEY60,-1
            IF        !@EOS
              CMATCH    SP70,KEY60
            ENDIF
          DO
.
          IF        @EOS
            SETLPTR   KEY60
            RESET     KEY60
            UNPACK    KEY60,KEY30,KEY60
          ELSE
            LENSET    KEY60
            RESET     KEY60
            MOVE      KEY60,KEY30
            PACK      KEY30,KEY30,SP70
.
            ENDSET    KEY60
            SETLPTR   KEY60
            BUMP      KEY60
            PACK      KEY60,KEY60,SP70
          ENDIF
.
          RETURN
.----------------------------------------------------------------------
. FILP - fill to end of purchase order                Called by FHED
.----------------------------------------------------------------------
FILPAG00  WHILE     MAXITEMS>CLNO
            ADD       "1",CLNO                   * print blank lines
            PRINT     SP1
          DO
          PRINT     *N,*N,*77," CONTINUED",*N,*N
          RETURN
.----------------------------------------------------------------------
. ENDF - fax end of purchase order                Called by PORD
.----------------------------------------------------------------------
ENDF0000  WHILE     MAXITEMS>CLNO
            ADD       "1",CLNO                   * print blank lines
            PRINT     SP1
          DO
.
.---- print total ----
.
          PRINT     *N,"----------------------------------------------":
                      "-----------------------------------------------":
                    *N,*77,"Total: ",TF7P2:
                    *N,"----------------------------------------------":
                      "-----------------------------------------------"
.
          MOVE      "2",AUDTTYPE
          CALL      WASIPA00               * Write to Audit file
.
          PACK      KEY7,SIPAPON,SP70
          CALL      RDSIPA1
          IF        OVRCD=0
            PACK      SIPADPR,CCC,CYY,CMM,CDD,SP70
            REP       " 0",SIPADPR
            CALL      UPSIPA1                    * update date printed
          ENDIF
.
          MOVE      "3",AUDTTYPE
          CALL      WASIPA00               * Write to Audit file
.
ENDF9999  RETURN
.------------------------------------------------------------
. Format Supplier Name & Address (remove blank lines)
.------------------------------------------------------------
FSUPP000  PACK     APMASN1,APMASN1,SP70
          PACK     APMASN2,APMASN2,SP70
          PACK     APMASA1,APMASA1,SP70
          PACK     APMASA2,APMASA2,SP70
          PACK     APMASA3,APMASA3,SP70
.
          MOVE     SP70,SUPLIN1
          MOVE     SP70,SUPLIN2
          MOVE     APMASA1,SUPLIN3
          MOVE     APMASA2,SUPLIN4
          MOVE     APMASA3,SUPLIN5
.
          MOVE      "0",SECTOR              * consolidate data lines
          MATCH     SP70,SUPLIN1
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      SUPLIN2,SUPLIN1
            MOVE      SUPLIN3,SUPLIN2
            MOVE      SUPLIN4,SUPLIN3
            MOVE      SUPLIN5,SUPLIN4
            MOVE      SP70,SUPLIN5
            MATCH     SP70,SUPLIN1
          DO
          MATCH     SP70,SUPLIN2
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      SUPLIN3,SUPLIN2
            MOVE      SUPLIN4,SUPLIN3
            MOVE      SUPLIN5,SUPLIN4
            MOVE      SP70,SUPLIN5
            MATCH     SP70,SUPLIN2
          DO
          MATCH     SP70,SUPLIN3
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      SUPLIN4,SUPLIN3
            MOVE      SUPLIN5,SUPLIN4
            MOVE      SP70,SUPLIN5
            MATCH     SP70,SUPLIN3
          DO
          MATCH     SP70,SUPLIN4
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      SUPLIN5,SUPLIN4
            MOVE      SP70,SUPLIN5
            MATCH     SP70,SUPLIN4
          DO
.
          PACK      SUPLIN1,SUPLIN1,SP70
          PACK      SUPLIN2,SUPLIN2,SP70
          PACK      SUPLIN3,SUPLIN3,SP70
          PACK      SUPLIN4,SUPLIN4,SP70
          PACK      SUPLIN5,SUPLIN5,SP70
.
          MATCH     SP70,SUPLIN5
          IF        !@EQUAL
            STRIP     SUPLIN5
            ENDSET    SUPLIN5
            APPEND    ", ",SUPLIN5
            APPEND    APMASPC,SUPLIN5
            APPEND    SP70,SUPLIN5
            RESET     SUPLIN5
            GOTO      FSUPP999
         ENDIF
.
          MATCH     SP70,SUPLIN4
          IF        !@EQUAL
            STRIP     SUPLIN4
            ENDSET    SUPLIN4
            APPEND    ", ",SUPLIN4
            APPEND    APMASPC,SUPLIN4
            APPEND    SP70,SUPLIN4
            RESET     SUPLIN4
            GOTO      FSUPP999
          ENDIF
.
          MATCH     SP70,SUPLIN3
          IF        !@EQUAL
            STRIP     SUPLIN3
            ENDSET    SUPLIN3
            APPEND    ", ",SUPLIN3
            APPEND    APMASPC,SUPLIN3
            APPEND    SP70,SUPLIN3
            RESET     SUPLIN3
            GOTO      FSUPP999
          ENDIF
.
          MATCH     SP70,SUPLIN2
          IF        !@EQUAL
            STRIP     SUPLIN2
            ENDSET    SUPLIN2
            APPEND    ", ",SUPLIN2
            APPEND    APMASPC,SUPLIN2
            APPEND    SP70,SUPLIN2
            RESET     SUPLIN2
            GOTO      FSUPP999
          ENDIF
.
FSUPP999  RETURN
.
.------------------------------------------------------------
. Format Creditor Address (remove blank lines)
.------------------------------------------------------------
FCRED000  PACK     APMACN1,APMACN1,SP70
          PACK     APMACN2,APMACN2,SP70
          PACK     APMACA1,APMACA1,SP70
          PACK     APMACA2,APMACA2,SP70
          PACK     APMACA3,APMACA3,SP70
.
          MOVE     APMACN1,CRELIN1
          MOVE     APMACN2,CRELIN2
          MOVE     APMACA1,CRELIN3
          MOVE     APMACA2,CRELIN4
          MOVE     APMACA3,CRELIN5
.
          MOVE      "0",SECTOR              * consolidate data lines
          MATCH     SP70,CRELIN1
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      CRELIN2,CRELIN1
            MOVE      CRELIN3,CRELIN2
            MOVE      CRELIN4,CRELIN3
            MOVE      CRELIN5,CRELIN4
            MOVE      SP70,CRELIN5
            MATCH     SP70,CRELIN1
          DO
          MATCH     SP70,CRELIN2
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      CRELIN3,CRELIN2
            MOVE      CRELIN4,CRELIN3
            MOVE      CRELIN5,CRELIN4
            MOVE      SP70,CRELIN5
            MATCH     SP70,CRELIN2
          DO
          MATCH     SP70,CRELIN3
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      CRELIN4,CRELIN3
            MOVE      CRELIN5,CRELIN4
            MOVE      SP70,CRELIN5
            MATCH     SP70,CRELIN3
          DO
          MATCH     SP70,CRELIN4
          WHILE     @EQUAL & (SECTOR<5)
            ADD       ONE,SECTOR
            MOVE      SUPLIN5,CRELIN4
            MOVE      SP70,CRELIN5
            MATCH     SP70,CRELIN4
          DO
.
          PACK      CRELIN1,CRELIN1,SP70
          PACK      CRELIN2,CRELIN2,SP70
          PACK      CRELIN3,CRELIN3,SP70
          PACK      CRELIN4,CRELIN4,SP70
          PACK      CRELIN5,CRELIN5,SP70
.
          MATCH     SP70,CRELIN5
          IF        !@EQUAL
            STRIP     CRELIN5
            ENDSET    CRELIN5
            APPEND    ", ",CRELIN5
            APPEND    APMACPC,CRELIN5
            APPEND    SP70,CRELIN5
            RESET     CRELIN5
            GOTO      FCRED999
         ENDIF
.
          MATCH     SP70,CRELIN4
          IF        !@EQUAL
            STRIP     CRELIN4
            ENDSET    CRELIN4
            APPEND    ", ",CRELIN4
            APPEND    APMACPC,CRELIN4
            APPEND    SP70,CRELIN4
            RESET     CRELIN4
            GOTO      FCRED999
          ENDIF
.
          MATCH     SP70,CRELIN3
          IF        !@EQUAL
            STRIP     CRELIN3
            ENDSET    CRELIN3
            APPEND    ", ",CRELIN3
            APPEND    APMACPC,CRELIN3
            APPEND    SP70,CRELIN3
            RESET     CRELIN3
            GOTO      FCRED999
          ENDIF
.
          MATCH     SP70,CRELIN2
          IF        !@EQUAL
            STRIP     CRELIN2
            ENDSET    CRELIN2
            APPEND    ", ",CRELIN2
            APPEND    APMACPC,CRELIN2
            APPEND    SP70,CRELIN2
            RESET     CRELIN2
            GOTO      FCRED999
          ENDIF
.
FCRED999  RETURN
.
.********************************************************************
.*                          FAXPRINT                                *
.*                       Fax a Print File                           *
.********************************************************************
FAXPRINT  COMPARE   ZERO,CPRTFLG
          GOTO      FAXPR999 IF NOT EQUAL
.
.         Check if file is of non-zero size
.
          CALL      SPLEMPTY
          BRANCH    OVRCD,FAXPR800,FAXPR900
.
          CLEAR     KEY80
          APPEND    "ibasin59.us1 ",KEY80
          APPEND    SPLFILE,KEY80
          APPEND    SP1,KEY80
          APPEND    "#"",KEY80
          APPEND    FAXNUMB,KEY80
          APPEND    "#"",KEY80
          APPEND    SP1,KEY80
          APPEND    PASSCODE,KEY80
          RESET     KEY80
.
          MOVE      "23",EVERT
          MOVE      "3",ECOL
          GETVAR    DIM2,KEY2,ECOL,EVERT
          MATCH     "eX",DIM2
          IF        @EQUAL
            CALL      CLRBX000                * Clear the Box
            DISPLAY   *P20:23,*V2LON,"Fax being queued. Please wait.";
            EXECUTE   KEY80,TASKID
            CALL      OPTNS000                * Redisplay the Option Line
          ELSE
            DISPLAY   *P20:24,*EL,*V2LON,"Fax being queued. Please wait";
            EXECUTE   KEY80,TASKID
          ENDIF
.
          GOTO      FAXPR900
.
.         Quick delete of spool file
.
FAXPR800  MOVE      FILENAME,CSPDESC       * name of file to be deleted
          CALL      SPLDELET
.
FAXPR900  MOVE      SP8,SPLFILE
          GOTO      FAXPR9999
.
FAXPR999  RETURN
.
.------------------------------------------------------------
. Supply Maintenance              
.------------------------------------------------------------
SINCIA00  MATCH     SP70,UPDTTYPE
          GOTO      SINCIA80 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add Formaction
          GOTO      SINCIA10 IF EQUAL
.
          MATCH     "U",UPDTTYPE     * Update Formaction
          GOTO      SINCIA20 IF EQUAL
.
          MATCH     "D",UPDTTYPE     * Delete Formaction
          GOTO      SINCIA30 IF EQUAL
.
          GOTO      SINCIA90
.
.   ************ ADD FORMACTION ************
.
SINCIA10  PACK      KEY7,SICIA001,SP70
          CALL      RDSIIA1
          COMPARE   ZERO,OVRCD
          GOTO      SINCIA91 IF EQUAL
.
          CALL      MVSCIA00
          PACK      SIIADTC,CCC,CYY,CMM,CDD
          REP       " 0",SIIADTC
          CLOCK     TIME,SIIATMC
          MOVE      PASSCODE,SIIAUSC
          CALL      WRSIIA1
          CALL      PALIA000
          GOTO      SINCIA99
.
.
.   ************ UPDATE FORMACTION ************
.
SINCIA20  PACK      KEY7,SICIA001,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,SINCIA92
.
          CALL      MVSCIA00
          PACK      SIIADTC,CCC,CYY,CMM,CDD
          REP       " 0",SIIADTC
          CLOCK     TIME,SIIATMC
          MOVE      PASSCODE,SIIAUSC
          CALL      UPSIIA1
          CALL      PALIA000
          GOTO      SINCIA99
.
.
.   ************ DELETE FORMACTION ************
.
SINCIA30  PACK      KEY7,SICIA001,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,SINCIA92
.
          CALL      DESIIA1
          GOTO      SINCIA99
.
.   ************ DISPLAY FORMACTION ***********
.
SINCIA80  PACK      KEY7,SICIA001,SP70
          CALL      RDSIIA1
          IF        OVRCD=1
            CALL      CLSCIA00
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Supply Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SINCIA99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      SINCIA99
.
SINCIA90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SINCIA99
.
SINCIA91  MOVE      "Supply master record already exists. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SINCIA99
.
SINCIA92  MOVE      "Cannot find Supply master record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SINCIA99
.
SINCIA99  RETURN
+
.------------------------------------------------------------
. Post Alias
.------------------------------------------------------------
PALIA000  PACK      KEY67,SIIACAT,SP70
          CALL      RSSIIF2
.
PALIA100  CALL      RKSIIF2
          BRANCH    OVRCD,PALIA200
          MATCH     SIIFCAT,SIIACAT
          GOTO      PALIA200 IF NOT EQUAL
          COMPARE   ZERO,SIIFATY
          GOTO      PALIA100 IF EQUAL
          PACK      KEY67,SIIFCAT,SIIFALI
          CALL      DESIIF2
          GOTO      PALIA100
.
PALIA200
          MOVE      SIIACAT,SIIFCAT
          MOVE      SIIADES,SIIFALI
          MOVE      ONE,SIIFATY
          CALL      POSTALIA
.
          PACK      KEY27,SIIACAT,SP70
          CALL      RSSIIC1
PALIA300  CALL      RKSIIC1
          BRANCH    OVRCD,PALIA400
          MATCH     SIICCAT,SIIACAT
          GOTO      PALIA400 IF NOT EQUAL
.
          PACK      SIIFALI,SIICPD1,SP70
          MOVE      SIIACAT,SIIFCAT
          MOVE      TWO,SIIFATY
          CALL      POSTALIA
.
          PACK      SIIFALI,SIICPD2,SP70
          MOVE      SIIACAT,SIIFCAT
          MOVE      TWO,SIIFATY
          CALL      POSTALIA
.
          PACK      SIIFALI,SIICPNO,SP70
          MOVE      SIIACAT,SIIFCAT
          MOVE      THREE,SIIFATY
          CALL      POSTALIA
          GOTO      PALIA300
PALIA400  PROC      WRKCT000            * Update Keyword Index
          RETURN
.
POSTALIA  MATCH     SP70,SIIFALI
          RETURN    IF EQUAL
          PACK      KEY67,SIIFCAT,SIIFALI
          CALL      RASIIF2
          IF        OVRCD=1
            CALL      WRSIIF2
          ENDIF
          RETURN
.
.------------------------------------------------------------
. Cost Centre Misc Tags          
.------------------------------------------------------------
SIIA0000  BRANCH    FLDITMNO,SIIA0100,SIIA0200,SIIA0300,SIIA0400,SIIA0500:
                             SIIA0600,SIIA0700,SIIA0800,SIIA0900
.       
          WRITE     HTMLFILE;"Invalid Tag - SIIA0000";
          GOTO      SIIA9999
.
SIIA0100  WRITE     HTMLFILE;STARTKEY;
          GOTO      SIIA9999
.
SIIA0200  CALL      TABCIA00      * Search Supply
          GOTO      SIIA9999
.
SIIA0300  CALL      PREVIA00      * Link to Previous Group
          GOTO      SIIA9999
.
SIIA0400  CALL      NEXTIA00      * Link to Next Group
          GOTO      SIIA9999
.
SIIA0500  WRITE     HTMLFILE;INCNNATO;
          GOTO      SIIA9999
.
SIIA0600  CALL      SINKCT00       * Supply keyword search
          GOTO      SIIA9999
.     
SIIA0700  CALL      PREVKC00
          GOTO      SIIA9999
.
SIIA0800  CALL      NEXTKC00
          GOTO      SIIA9999
.
SIIA0900  WRITE     HTMLFILE;INCOCATE;      * Supply Code format
          GOTO      SIIA9999
.
SIIA9999  RETURN
.------------------------------------------------------------
. Supply Keyword Search Results Table
.------------------------------------------------------------
SINKCT00  WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=5>":
                               "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                               "<td class=HeadingCell>Supply</td>":
                               "<td class=HeadingCell>Description</td>":
                             "</tr>"
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY22,KEYWRD01,SP70
          CALL      RSSIKC1
SINKCT10  CALL      RKSIKC1
          BRANCH    OVRCD,SINKCT90
.
          PACK      KEY7,SIKCCAT,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,SINKCT10
.                                                                   CAR 243843
          MATCH     "1",SIIAACTV
          GOTO      SINKCT10 IF EQUAL
.
          CALL      SINDKB00
          BRANCH    OVRCD,SINKCT10,SINKCT90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SINKCT10
          ENDIF
.
SINKCT20 WRITE     HTMLFILE;"<tr valign=top>":
                              "<td nowrap><a href=#"":
                              "javascript:updateParent('",SIIACAT:
                             "','",SIIADES,"','",SIIAAVC,"')#">":
                              SIIACAT,"<td>",SIIADES,"</td></tr>";
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SINKCT10 IF NOT EQUAL
SINKCT90
.
SINKCT99  RETURN
.
.-----------------------------------------------------------
. Link to Next Supply keyword
.-----------------------------------------------------------
NEXTKC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",SIIACAT
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"sinweb02.pbl":
                                 "?reportno=",F1:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&keywords=",KEYWORDS:
                                 "&sicia001=",SIIACAT;
.
          REP       "+ ",SIIACAT
          REP       "+ ",KEYWORDS
.
NEXTKC99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Supply
.-------------------------------------------------------------
PREVKC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",SIIACAT
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"sinweb02.pbl":
                                "?reportno=",F1:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&keywords=",KEYWORDS:
                                "&sicia001=",SIIACAT;
.
          REP       "+ ",SIIACAT
          REP       "+ ",KEYWORDS
.
PREVKC99  RETURN
.------------------------------------------------------------
. Check Record
.------------------------------------------------------------
SINDKB00  MATCH     KEYWRD01,SIKCKWD
          GOTO      SINDKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY22,SIKCKWD,SIKCCAT
            CALL      SINDKC00
            BRANCH    EXIT,SINDKB91
            MOVE      SAVKEY22,KEY22
            CALL      RDSIKC1
          ENDIF
.
SINDKB90  MOVE      ZERO,OVRCD
          GOTO      SINDKB99
.
SINDKB91  MOVE      ONE,OVRCD
          GOTO      SINDKB99
.
SINDKB92  MOVE      TWO,OVRCD
SINDKB99  RETURN
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
SINDKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY7,SIKCCAT,SP70
.
SINDKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SINDKC99 IF EQUAL     * Exit OK
.
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
.
          PACK      KEY22,SIKCCAT,KEYWRDXX
          CALL      RDSIKC2               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SINDKC10 IF EQUAL
.
          CALL      RKSIKC2               * Not Exact so Read Next Record
          BRANCH    OVRCD,SINDKC90        * No Match So Exit No Match
.
          PACK      KEY7,SIKCCAT,SP70
          MATCH     SAVKEY7,KEY7          * Match Key Fields
          GOTO      SINDKC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     SIKCKWD,KEYWRDXX         * Check Key Word
          GOTO      SINDKC90 IF NOT EQUAL * No Match So Exit
.
          GOTO      SINDKC10              * Check Next Search Word
.
SINDKC90  MOVE      ONE,EXIT
.
SINDKC99  RETURN
.
.------------------------------------------------------------
. Supply Supplier Details Search List
.------------------------------------------------------------
TABCIA00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CIAHED00              * Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button
.
          IF        PRVAFLAG = 1
            MATCH     SP70,PREVAKEY
            IF        !@EQUAL
              CALL      GPRCIA00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              PACK      PREVAKEY,STARTKEY,SP70
              GOTO      TABCIA05
            ENDIF
            PACK      KEY7,STARTKEY,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      TABCIA05
          ENDIF
.
.         * Next button
.
          MATCH     SP70,NEXTAKEY
          IF        !@EQUAL
            CALL      GNXCIA00              * Check to see if at the last rec
            PACK      KEY7,NEXTAKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            PACK      NEXTAKEY,STARTKEY,SP70
            CALL      RSSIIA1                * skip this key
            GOTO      TABCIA10
          ENDIF
.
          PACK      KEY7,STARTKEY,SP70
TABCIA05  CALL      RDSIIA1                  * read full key
          COMPARE   ZERO,OVRCD
          GOTO      TABCIA15 IF EQUAL
.
TABCIA10  CALL      RKSIIA1
          BRANCH    OVRCD,TABCIA90
.
TABCIA15  PACK      NEXTAKEY,SIIACAT,SP70
          MATCH     SP70,PREVAKEY
          IF        @EQUAL
            PACK      PREVAKEY,SIIACAT,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TABCIA10
          ENDIF
.
          CALL      CIAROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TABCIA10 IF NOT EQUAL
          GOTO      TABCIA99
.
TABCIA90  CALL      NOMORE00     * Display No More Records Message
.
TABCIA99  RETURN
+
.--------------------------------------------------------------------------
. GPRCIA00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
GPRCIA00  PACK      SAVKEY7,STARTKEY,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          PACK      KEY7,PREVAKEY,Z70
          CALL      RDSIIA1                     * Position for batch #
          COMPARE   ZERO,OVRCD
          GOTO      GPRCIA15 IF EQUAL
.
GPRCIA10  CALL      RPSIIA1                     * read next record
          BRANCH    OVRCD,GPRCIA91              * end of file
.
GPRCIA15  PACK      SAVKEY7,SIIACAT,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      GPRCIA90 IF EQUAL
.
          GOTO      GPRCIA10
.
GPRCIA90  MOVE      SAVKEY7,KEY7          * New start key for display
          SUB       ONE,NORECORD
          GOTO      GPRCIA99
.
GPRCIA91  PACK      KEY7,STARTKEY,SP70
          SUB       ONE,NORECORD
          GOTO      GPRCIA99
.
GPRCIA99  RETURN
+
.------------------------------------------------------------
. GNXCIA00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
GNXCIA00  PACK      KEY7,NEXTAKEY,SP70
          CALL      RSSIIA1                     * Position for batch #
          CALL      RKSIIA1                     * read next record
          BRANCH    OVRCD,GNXCIA90               * end of file
.
          GOTO      GNXCIA99
.
GNXCIA90  PACK      NEXTAKEY,STARTKEY,SP70
          GOTO      GNXCIA99                * No more record goto first record
.
GNXCIA99  RETURN
+
.------------------------------------------------------------
.  Table Selected Supply (TABLE HEADING)
.------------------------------------------------------------
CIAHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=30%>Supply</td>":
                             "<td class=HeadingCell width=70%>Description</td>":
                             "<td class=HeadingCell width=10%>Active</td>":
                             "</tr>"
CIAHED99  RETURN
+
.------------------------------------------------------------
. Read Selected Supply details and display
.------------------------------------------------------------
CIAROW00  MATCH     "1",SIIAACTV
          IF        @EQUAL
            MOVE      "Inactive",DISPDIM8
          ELSE
            MOVE      "Active",DISPDIM8
          ENDIF
.
          REP       "#' #" ",SIIADES
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sicia001=",SIIACAT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             SIIACAT,"</td>":
                             "<td>",SIIADES,"</td>":
                             "<td>",DISPDIM8,"</td>":
                             "</tr>"
.
CIAROW99  RETURN
+
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTIA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY
          REP       " +",NEXTAKEY
.
          WRITE     HTMLFILE;"sinweb02.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nextakey=",NEXTAKEY:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "+ ",NEXTAKEY
.
NEXTIA99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of patients
.-------------------------------------------------------------
PREVIA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY
          REP       " +",PREVAKEY
.
          WRITE     HTMLFILE;"sinweb02.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prvaflag=",ONE:
                                 "&prevakey=",PREVAKEY:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "+ ",PREVAKEY
.
PREVIA99  RETURN
+
.------------------------------------------------------------
. Cost Centre Maintenance
.------------------------------------------------------------
SINCCA00  MATCH     SP70,UPDTTYPE
          GOTO      SINCCA80 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add Formaction
          GOTO      SINCCA10 IF EQUAL
.
          MATCH     "U",UPDTTYPE     * Update Formaction
          GOTO      SINCCA20 IF EQUAL
.
          MATCH     "D",UPDTTYPE     * Delete Formaction
          GOTO      SINCCA30 IF EQUAL
.
          GOTO      SINCCA90
.
.   ************ ADD FORMACTION ************
.
SINCCA10  PACK      KEY5,SICCA001,SP70
          CALL      RDSICA1
          COMPARE   ZERO,OVRCD
          GOTO      SINCCA91 IF EQUAL
.
          CALL      MVSCCA00
          CALL      WRSICA1
          GOTO      SINCCA99
.
.
.   ************ UPDATE FORMACTION ************
.
SINCCA20  PACK      KEY5,SICCA001,SP70
          CALL      RDSICA1
          BRANCH    OVRCD,SINCCA92
.
          CALL      MVSCCA00
          CALL      UPSICA1
          GOTO      SINCCA99
.
.
.   ************ DELETE FORMACTION ************
.
SINCCA30  PACK      KEY5,SICCA001,SP70
          CALL      RDSICA1
          BRANCH    OVRCD,SINCCA92
.
          CALL      DESICA1
          GOTO      SINCCA99
.
.   ************ DISPLAY FORMACTION ***********
.
SINCCA80  PACK      KEY5,SICCA001,SP70
          CALL      RDSICA1
          IF        OVRCD=1
            CALL      CLSCCA00
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Cost Centre Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SINCCA99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      SINCCA99
.
SINCCA90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SINCCA99
.
SINCCA91  MOVE      "Cost Centre master record already exists. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SINCCA99
.
SINCCA92  MOVE      "Cannot find Cost Centre master record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SINCCA99
.
SINCCA99  RETURN
+
.------------------------------------------------------------
. Imprest Maintenance
.------------------------------------------------------------
SINIMP00  MATCH     SP70,UPDTTYPE
          GOTO      SINIMP80 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add Formaction
          GOTO      SINIMP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE     * Update Formaction
          GOTO      SINIMP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE     * Delete Formaction
          GOTO      SINIMP30 IF EQUAL
.
          GOTO      SINIMP90
.
.   ************ ADD FORMACTION ************
.
SINIMP10  PACK      KEY12,SIIMP001,SIIMP002,SP70
          CALL      RDSIIM1
          COMPARE   ZERO,OVRCD
          GOTO      SINIMP91 IF EQUAL
.
          CALL      MVSIMP00
          CALL      WRSIIM1
          GOTO      SINIMP99
.
.
.   ************ UPDATE FORMACTION ************
.
SINIMP20  PACK      KEY12,SIIMP001,SIIMP002,SP70
          CALL      RDSIIM1
          BRANCH    OVRCD,SINIMP92
.
          CALL      MVSIMP00
          CALL      UPSIIM1
          GOTO      SINIMP99
.
.
.   ************ DELETE FORMACTION ************
.
SINIMP30  PACK      KEY12,SIIMP001,SIIMP002,SP70
          CALL      RDSIIM1
          BRANCH    OVRCD,SINIMP92
.
          CALL      DESIIM1
          GOTO      SINIMP99
.
.   ************ DISPLAY FORMACTION ***********
.
SINIMP80  PACK      KEY12,SIIMP001,SIIMP002,SP70
          CALL      RDSIIM1
          IF        OVRCD=1
            CALL      CLSIMP00
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Imprest Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SINIMP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      SINIMP99
.
SINIMP90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SINIMP99
.
SINIMP91  MOVE      "Imprest record already exists. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SINIMP99
.
SINIMP92  MOVE      "Cannot find Imprest record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SINIMP99
.
SINIMP99  RETURN
+
.------------------------------------------------------------
. Imprest Misc Tags
.------------------------------------------------------------
SIIM0000  BRANCH    FLDITMNO,SIIM0100,SIIM0200,SIIM0300,SIIM0400
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      SIIM9999
.
SIIM0100  WRITE     HTMLFILE;STARTKEY;
          GOTO      SIIM9999
.
SIIM0200  CALL      TABIMP00      * Search Supply
          GOTO      SIIM9999
.
SIIM0300  CALL      PREVIM00      * Link to Previous Group
          GOTO      SIIM9999
.
SIIM0400  CALL      NEXTIM00      * Link to Next Group
          GOTO      SIIM9999
.
SIIM9999  RETURN
.------------------------------------------------------------
. Imprest List
.------------------------------------------------------------
TABIMP00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      IMPHED00              * Table Heading
.
          IF        NORECORD=0
            MOVE      "15",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button
.
          IF        PRVMFLAG = 1
            MATCH     SP70,PREVMKEY
            IF        !@EQUAL
              CALL      GPRIMP00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              PACK      PREVMKEY,STARTKEY,SP70
              GOTO      TABIMP05
            ENDIF
            PACK      KEY12,STARTKEY,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      TABIMP05
          ENDIF
.
.         * Next button
.
          MATCH     SP70,NEXTMKEY
          IF        !@EQUAL
            CALL      GNXIMP00              * Check to see if at the last rec
            PACK      KEY7,NEXTMKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            PACK      NEXTMKEY,STARTKEY,SP70
            CALL      RSSIIM1                * skip this key
            GOTO      TABIMP10
          ENDIF
.
          PACK      KEY12,STARTKEY,SP70
TABIMP05  CALL      RDSIIM1                  * read full key
          COMPARE   ZERO,OVRCD
          GOTO      TABIMP15 IF EQUAL
.
TABIMP10  CALL      RKSIIM1
          BRANCH    OVRCD,TABIMP99
.
TABIMP15  PACK      NEXTMKEY,SIIMCST,SIIMCAT,SP70
          MATCH     SP70,PREVMKEY
          IF        @EQUAL
            PACK      PREVMKEY,SIIMCST,SIIMCAT,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TABIMP10
          ENDIF
.
          CALL      IMPROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TABIMP10 IF NOT EQUAL
.
TABIMP99  RETURN
+
.--------------------------------------------------------------------------
. GPRIMP00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
GPRIMP00  PACK      SAVKEY12,STARTKEY,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          PACK      KEY12,PREVMKEY,Z70
          CALL      RDSIIM1                     * Position for batch #
          COMPARE   ZERO,OVRCD
          GOTO      GPRIMP15 IF EQUAL
.
GPRIMP10  CALL      RPSIIM1                     * read next record
          BRANCH    OVRCD,GPRIMP91              * end of file
.
GPRIMP15  PACK      SAVKEY12,SIIMCST,SIIMCAT,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      GPRIMP90 IF EQUAL
.
          GOTO      GPRIMP10
.
GPRIMP90  MOVE      SAVKEY12,KEY12          * New start key for display
          SUB       ONE,NORECORD
          GOTO      GPRIMP99
.
GPRIMP91  PACK      KEY12,STARTKEY,SP70
          SUB       ONE,NORECORD
          GOTO      GPRIMP99
.
GPRIMP99  RETURN
+
.------------------------------------------------------------
. GNXIMP00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
GNXIMP00  PACK      KEY12,NEXTMKEY,SP70
          CALL      RSSIIM1                     * Position for batch #
          CALL      RKSIIM1                     * read next record
          BRANCH    OVRCD,GNXIMP90               * end of file
.
          GOTO      GNXIMP99
.
GNXIMP90  PACK      NEXTMKEY,STARTKEY,SP70
          GOTO      GNXIMP99                * No more record goto first record
.
GNXIMP99  RETURN
+
.------------------------------------------------------------
.  Table Selected Imprest (TABLE HEADING)
.------------------------------------------------------------
IMPHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>Cost Centre</td>":
                             "<td class=HeadingCell width=40%>Description</td>":
                             "<td class=HeadingCell width=10%>Supply</td>":
                             "<td class=HeadingCell width=40%>Description</td>":
                             "</tr>"
IMPHED99  RETURN
+
.------------------------------------------------------------
. Read Selected Supply details and display
.------------------------------------------------------------
IMPROW00  PACK      KEY5,SIIMCST,SP70
          CALL      RDSICA1
          IF        OVRCD=1
            MOVE      "Invalid Cost Centre",SICADESC
          ENDIF
.
          PACK      KEY7,SIIMCAT,SP70
          CALL      RDSIIA1
          IF        OVRCD=1
            MOVE      "Invalid Supply",SIIADES
          ENDIF
.
          REP       "#' #" ",SICADESC
          REP       "#' #" ",SIIADES
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&siimp001=",SIIMCST:
                             "&siimp002=",SIIMCAT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             SIIMCST,"</td>":
                             "<td>",SICADESC,"</td>":
                             "<td>",SIIMCAT,"</td>":
                             "<td>",SIIADES,"</td>":
                             "</tr>"
.
IMPROW99  RETURN
+
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTIM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY
          REP       " +",NEXTMKEY
.
          WRITE     HTMLFILE;"sinweb02.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nextmkey=",NEXTMKEY:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "+ ",NEXTMKEY
.
NEXTIM99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of patients
.-------------------------------------------------------------
PREVIM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY
          REP       " +",PREVMKEY
.
          WRITE     HTMLFILE;"sinweb02.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prvaflag=",ONE:
                                 "&prevmkey=",PREVMKEY:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "+ ",PREVMKEY
.
PREVIM99  RETURN
+
.******************************************************************************
.                    REMOTE SCRIPTING FUNCTION
.******************************************************************************
REMOTE00  CALL      XMLHED00
          BRANCH    EXIT,REMOTE99
.
          MOVE      ZERO,F1
          MOVE      UPDATETY,F1
          BRANCH    F1,REMOTE10
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                    " INVALID UPDATE TYPE ":
                    "</RETURN_VALUE>"
          GOTO      REMOTE90
.
REMOTE10  CALL      CHKCAT00      * Validate Supply code
          GOTO      REMOTE90 
.
REMOTE90  CALL      XMLEND00
.
REMOTE99  RETURN
.
.******************************************************************************
. Check if a valid Supply code was entered
.******************************************************************************
CHKCAT00  PACK      KEY7,VALDCODE,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,CHKCAT90
.
          MATCH     "1",SIIAACTV
          GOTO      CHKCAT91 IF EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                    SIIADES,"|",SIIAAVC:
                    "</RETURN_VALUE>"
          GOTO      CHKCAT99
.
CHKCAT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                    " Invalid Supply code ":
                    "</RETURN_VALUE>"
          GOTO      CHKCAT99
.
CHKCAT91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                    " Inactive Supply code ":
                    "</RETURN_VALUE>"
          GOTO      CHKCAT99
.
CHKCAT99  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.------------------------------------------------------------
.           
          INC       IBAWEBCD
          INC       WEBDATCD
.                        
          INC       APSCEAIO/INC
          INC       APSCEBIO/INC
          INC       APSCIOIO/INC
          INC       APSMASIO/INC
          INC       APSPPDIO/INC
          INC       APSORDIO/INC
          INC       APSSNTIO/INC
          INC       APSSUBIO/INC
.  
          INC       FMSAMAIO/INC
          INC       FMSCONIO/INC
          INC       FMSCSAIO/INC
          INC       FMSFPSIO/INC
          INC       FMSLMAIO/INC
          INC       FMSLMCIO/INC
          INC       FMSTUPIO/INC
.
          INC       IBAGSTIO/INC
.
          INC       OUTSITIO/INC
          INC       PATDRGIO/INC
.
          INC       SINCCAIO/INC
          INC       SINCIAIO/INC
          INC       SINCICIO/INC
          INC       SINCODIO/INC
          INC       SINCSEIO/INC
          INC       SINDPCIO/INC
          INC       SINCIFIO/INC
          INC       SINKCTIO/INC
          INC       SINFACIO/INC
          INC       SINIMPIO/INC
          INC       SINLTTIO/INC
          INC       SINNATIO/INC
          INC       SINORIIO/INC
          INC       SINPERIO/INC
          INC       SINPOAIO/INC            
          INC       SINPOBIO/INC
          INC       SINPOCIO/INC
          INC       SINPODIO/INC            
          INC       SINPOFIO/INC
          INC       SINSCDIO/INC
          INC       SINSUAIO/INC
          INC       SINWARIO/INC
          INC       SINWSEIO/INC
.
          INC       SINCCATM
          INC       SINCIATM
          INC       SINCICTM
          INC       SINIMPTM
          INC       SINPERCD
          INC       SINPOATM
          INC       SINPOCTM
          INC       SINORDPR
          INC       SINKCTPR
.
          INC       DAYOFWEK
          INC       RSHWEBCD
.
.

.------------------------------------------------------------
. Contract Procedure Matrix Table
.
. Inputs  -  Valid record from the nzpcmtaf
. Outputs -  Field specified by FLDITMNO & DIM127 for any parameters
.
. Include's needed - NZPCMTFD
.                    PATCODFD
. Modifications :    
.
. V11.00.01 11/03/2020  J.Tan          TSK 0838262
.           Added Effective from and to date to MBS Item file
. V9.08.02  26/06/2007  Jill Habasque CAR 142154
.           Changed GMSC0000 to not check claim code
. V9.08.01  14/02/2007  Davin         CAR 128957
.           Added misc item group (NZCMMIGP)
.------------------------------------------------------------
. Contract Procedure matrix table
.------------------------------------------------------------
NZTX0000  BRANCH    FLDITMNO,NZTX0100,NZTX0200,NZTX0300,NZTX0400,NZTX0500:
                             NZTX0600,NZTX0700,NZTX0800,NZTX0900
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      NZTX9999
.
NZTX0100  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      NZCMCLMC,CODE
          CALL      CODITM00
          GOTO      NZTX9999
.
NZTX0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZTX0210
          WRITE     HTMLFILE;NZCMCNTR;       * Health Fund
          GOTO      NZTX9999
.
NZTX0210  MATCH     SP70,NZCMCNTR
          GOTO      NZTX9999 IF EQUAL
.
          PACK      KEY14,NZCMCNTR,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,NZTX9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      NZTX9999
.
NZTX0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZTX0310
          WRITE     HTMLFILE;NZCMCPRC;      * Contract Procedure Code
          GOTO      NZTX9999
.
NZTX0310  MATCH     SP70,NZCMCPRC
          GOTO      NZTX9999 IF EQUAL
.
          PACK      KEY9,NZCMCPRC,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,NZTX9999
          WRITE     HTMLFILE;PTCADES1;      * Contract Procedure Code Desc
          GOTO      NZTX9999
.
NZTX0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZTX0410
          WRITE     HTMLFILE;NZCMRTYP;      * Record Type
          GOTO      NZTX9999
.
NZTX0410  MATCH     ANSO,NZCMRTYP
          IF        @EQUAL
            WRITE     HTMLFILE;"Overnight";
            GOTO      NZTX9999
          ENDIF
.
          MATCH     ANSD,NZCMRTYP
          IF        @EQUAL
            WRITE     HTMLFILE;"Sameday";
            GOTO      NZTX9999
          ENDIF
.
          MATCH     ANSE,NZCMRTYP
          IF        @EQUAL
            WRITE     HTMLFILE;"Either";
            GOTO      NZTX9999
          ENDIF
          GOTO      NZTX9999
.
NZTX0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZTX0510
          WRITE     HTMLFILE;NZCMITYP;      * Item Type
          GOTO      NZTX9999
.
NZTX0510  MOVE      "Procedure",KEY9
          MATCH     "1",NZCMITYP
          IF        @EQUAL
            MOVE      "Misc.Item",KEY9
          ENDIF
          WRITE     HTMLFILE;KEY9;          * Procedure/Misc.item type
          GOTO      NZTX9999
.
NZTX0600  WRITE     HTMLFILE;NZCMFTYP;      * Field Type
          GOTO      NZTX9999
.
NZTX0700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZTX0710
          WRITE     HTMLFILE;NZCMPROC;      * Procedure/Misc.Item Code
          GOTO      NZTX9999
.
NZTX0710  MOVE      NZCMPROC,KEY9
          MATCH     "1",NZCMITYP            * Misc.item
          IF        @EQUAL
            CALL      GMSC0000                * Misc.Item Description
            BRANCH    EXIT,NZTX9999
          ELSE
            PACK      KEY17,KEY9,SP70
            CALL      PATITMRD              * Procedure Description
            BRANCH    OVRCD,NZTX9999
          ENDIF
          WRITE     HTMLFILE;IDESC;
          GOTO      NZTX9999
.
NZTX0800  WRITE     HTMLFILE;NZCMCCNT;
          GOTO      NZTX9999
.
NZTX0900  MOVE      "FI",CATEGORY            * Item group
          MOVE      NZCMMIGP,CODE
          CALL      CODITM00
          GOTO      NZTX9999
.
NZTX9999  RETURN
+
.------------------------------------------------------------
.  Update Casemix Matrix fields
.------------------------------------------------------------
UPCMTA00  MATCH     NZCMT001,Z70
          IF        !@EQUAL
            MOVE      NZCMT001,NZCMCLMC
          ENDIF
.
          MATCH     NZCMT002,Z70
          IF        !@EQUAL
            MOVE      NZCMT002,NZCMCNTR
          ENDIF
.
          MATCH     NZCMT003,Z70
          IF        !@EQUAL
            MOVE      NZCMT003,NZCMRTYP
          ENDIF
.
          MATCH     NZCMT004,Z70
          IF        !@EQUAL
            MOVE      NZCMT004,NZCMCPRC
          ENDIF
.
          MATCH     NZCMT005,Z70
          IF        !@EQUAL
            MOVE      NZCMT005,NZCMITYP
          ENDIF
.
          MATCH     NZCMT006,Z70
          IF        !@EQUAL
            MOVE      NZCMT006,NZCMCCNT
          ENDIF
.
          MATCH     NZCMT007,SP70
          IF        @EQUAL
            MOVE      "0",NZCMFTYP
          ELSE
            MOVE      NZCMT007,NZCMFTYP
          ENDIF
.
          MATCH     NZCMT008,Z70
          IF        !@EQUAL
            MOVE      NZCMT008,NZCMPROC
          ENDIF
.
          MATCH     NZCMT009,Z70
          IF        !@EQUAL
            MOVE      NZCMT009,NZCMMIGP
          ENDIF
.
          RETURN
.------------------------------------------------------------------------
.   Clear Parameters for casemix matrix table
.------------------------------------------------------------------------
CLRCMT00  MOVE      Z70,NZCMT001
          MOVE      Z70,NZCMT002
          MOVE      Z70,NZCMT003
          MOVE      Z70,NZCMT004
          MOVE      Z70,NZCMT005
          MOVE      Z70,NZCMT006
          MOVE      Z70,NZCMT007
          MOVE      Z70,NZCMT008
          MOVE      Z70,NZCMT009
CLRCMT99  RETURN
+
.---------------------------------------------------------------------------
. Clear NZ Private Casemix Matrix Vars
.---------------------------------------------------------------------------
CLRNZCMT  MOVE      SP70,NZCMCLMC    * Claim code
          MOVE      SP70,NZCMCNTR    * Health Fund
          MOVE      SP70,NZCMRTYP    * Record type
          MOVE      SP70,NZCMCPRC    * Contract procedure
          MOVE      SP70,NZCMITYP    * Item type
          MOVE      SP70,NZCMCCNT    * Counter
          MOVE      SP70,NZCMFTYP    * Field type
          MOVE      SP70,NZCMPROC    * Procedure/Misc.charge code
          MOVE      SP70,NZCMMIGP    * Misc Item Group
          RETURN
+
.------------------------------------------------------------
.   Set Parameters for Casemix matrix file
.------------------------------------------------------------
SNCMT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SNCMT010,SNCMT020,SNCMT030,SNCMT040,SNCMT050:
                       SNCMT060,SNCMT070,SNCMT080,SNCMT090
.
          MOVE      ONE,EXIT
          GOTO      SNCMT999
.
SNCMT010  MOVE      QRYDATA,NZCMT001
          PACK      NZCMT001,NZCMT001,SP70
          GOTO      SNCMT999
.
SNCMT020  MOVE      QRYDATA,NZCMT002
          PACK      NZCMT002,NZCMT002,SP70
          GOTO      SNCMT999
.
SNCMT030  MOVE      QRYDATA,NZCMT003
          PACK      NZCMT003,NZCMT003,SP70
          GOTO      SNCMT999
.
SNCMT040  MOVE      QRYDATA,NZCMT004
          PACK      NZCMT004,NZCMT004,SP70
          GOTO      SNCMT999
.
SNCMT050  MOVE      QRYDATA,NZCMT005
          PACK      NZCMT005,NZCMT005,SP70
          GOTO      SNCMT999
.
SNCMT060  MOVE      QRYDATA,NZCMT006
          PACK      NZCMT006,NZCMT006,SP70
          GOTO      SNCMT999
.
SNCMT070  MOVE      QRYDATA,NZCMT007
          PACK      NZCMT007,NZCMT007,SP70
          GOTO      SNCMT999
.
SNCMT080  MOVE      QRYDATA,NZCMT008
          PACK      NZCMT008,NZCMT008,SP70
          GOTO      SNCMT999
.
SNCMT090  MOVE      QRYDATA,NZCMT009
          PACK      NZCMT009,NZCMT009,SP70
          GOTO      SNCMT999
.
SNCMT999  RETURN
+
.------------------------------------------------------------
. Get Misc.item description
.------------------------------------------------------------
GMSC0000  PACK      KEY37,KEY9,NZCMT001,SP70
          CALL      RSNZMCH3
GMSC1000  CALL      RKNZMCH3
          BRANCH    OVRCD,GMSC5000
.
          MATCH     KEY9,NZMCMCHG
          GOTO      GMSC5000 IF NOT EQUAL        * does charge code exist?
.
          MATCH     NZCMT001,NZMCCLMC
          GOTO      GMSC8000 IF EQUAL            * correct claim code?
.
GMSC5000  PACK      KEY37,KEY9,SP70
          CALL      RSNZMCH3
          CALL      RKNZMCH3
          BRANCH    OVRCD,GMSC9000
.
          MATCH     KEY9,NZMCMCHG
          GOTO      GMSC9000 IF NOT EQUAL        * does charge code exist?
.
GMSC8000  PACK      IDESC,NZMCDESC,SP70
          PACK      GDESC,NZMCCGRP,SP70
          MOVE      ZERO,EXIT
          GOTO      GMSC9999
.
GMSC9000  MOVE      ONE,EXIT
GMSC9999  RETURN
+

.*----------------------------------------------------------------------
.* Include Name  :   PMSSMHTM.PBL
.*
.* Function      :   CGI variables for PMSSMHFD - pmssmhaf.dat
.*
.*----------------------------------------------------------------------
. Modifications :
.
. V11.05.01  31/01/2025  Don Nguyen         TSK 0896463
.            Added new strings for status value '6' - No Mobile Number
. V11.04.01  21/12/2023  Don Nguyen         TSK 0893290
.            Added descriptive message output for each Message Status; PMSM0162
. V11.00.01  23/03/2020  Peter Vela         TSK 0889143
.            Fixed OUTLET IO calls
.            Fixed WATLET IO calls
. V10.08.01  14/09/2016  Ebon Clements      TSK 0294154
.            Changed contact type tag to use CODITM00 - PMSM0190
. V10.08.00  25/07/2016  Ebon Clements      TSK 0294154
.            Created include
.*----------------------------------------------------------------------
.------------------------------------------------------------
. Clear SMS history file cgi vars
.------------------------------------------------------------
CLPMSM00  MOVE      Z70,PMSMH001
          MOVE      Z70,PMSMH002
          MOVE      Z70,PMSMH003
          MOVE      Z70,PMSMH004
          MOVE      Z70,PMSMH005
          MOVE      Z70,PMSMH006
          MOVE      Z70,PMSMH007
          MOVE      Z70,PMSMH008
          MOVE      Z70,PMSMH009
          MOVE      Z70,PMSMH010
          MOVE      Z70,PMSMH011
          MOVE      Z70,PMSMH012
          MOVE      Z70,PMSMH013
          MOVE      Z70,PMSMH014 
          MOVE      Z70,PMSMH015
          MOVE      Z70,PMSMH016
          MOVE      Z70,PMSMH017
          MOVE      Z70,PMSMH018
          MOVE      Z70,PMSMH019
          MOVE      Z70,PMSMH020
.
CLPMSM99  RETURN
.------------------------------------------------------------
. SMS history file tags
.------------------------------------------------------------
PMSM0000  BRANCH    FLDITMNO,PMSM0010,PMSM0020,PMSM0030,PMSM0040,PMSM0050:
                             PMSM0060,PMSM0070,PMSM0080,PMSM0090,PMSM0100:
                             PMSM0110,PMSM0120,PMSM0130,PMSM0140,PMSM0150:
                             PMSM0160,PMSM0170,PMSM0180,PMSM0190,PMSM0200
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMSM9999
.
PMSM0010  WRITE     HTMLFILE;PMSMUMID;
          GOTO      PMSM9999
.
PMSM0020  WRITE     HTMLFILE;PMSMURNO;
          GOTO      PMSM9999
.
PMSM0030  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMSM0031
.
          WRITE     HTMLFILE;PMSMMTYP;
          GOTO      PMSM9999
.         
PMSM0031  MATCH     " 2",PMSMMTYP
          IF        @EQUAL
            WRITE     HTMLFILE;"Outpatient";
            GOTO      PMSM9999
          ENDIF
.
          MATCH     " 3",PMSMMTYP
          IF        @EQUAL
            WRITE     HTMLFILE;"Inpatient";
            GOTO      PMSM9999
          ENDIF
.
          MATCH     " 9",PMSMMTYP
          IF        @EQUAL
            WRITE     HTMLFILE;"Waiting List";
            GOTO      PMSM9999
          ENDIF
          GOTO      PMSM9999
.
PMSM0040  WRITE     HTMLFILE;PMSMRKEY;
          GOTO      PMSM9999
.
PMSM0050  MATCH     " 2",PMSMMTYP
          IF        @EQUAL
            PACK      KEY6,PMSMSCOD,SP1,SP1,ZERO,SP70
            CALL      RDOTLET1
            IF        OVRCD=1
              MOVE      PMSMSCOD,OTLTTEXT
            ENDIF
            WRITE     HTMLFILE;OTLTTEXT;
            GOTO      PMSM9999
          ENDIF
.
          MATCH     " 3",PMSMMTYP
          IF        @EQUAL
            PACK      KEY6,PMSMSCOD,SP1,SP1,ZERO,SP70
            CALL      RDPTLET1
            IF        OVRCD=1 
              MOVE      PMSMSCOD,PTLETEXT
            ENDIF
            WRITE     HTMLFILE;PTLETEXT;
            GOTO      PMSM9999
          ENDIF
.
          MATCH     " 9",PMSMMTYP
          IF        @EQUAL
            PACK      KEY6,PMSMSCOD,SP1,SP1,ZERO,SP70
            CALL      RDLET1
            IF        OVRCD=1 
              MOVE      PMSMSCOD,WLTEXT
            ENDIF
            WRITE     HTMLFILE;WLTEXT;
            GOTO      PMSM9999
          ENDIF
          GOTO      PMSM9999
.
PMSM0060  MATCH     PMSMSDAT,SP70
          GOTO      PMSM9999 IF EQUAL
.
          UNPACK    PMSMSDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMSM9999
.
PMSM0070  WRITE     HTMLFILE;PMSMSTIM;
          GOTO      PMSM9999
.
PMSM0080  WRITE     HTMLFILE;PMSMMNUM;
          GOTO      PMSM9999
.
PMSM0090  MATCH     SP70,PMSMSUID
          GOTO      PMSM9999 IF EQUAL
.
          PACK      KEY10,PMSMSUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMSMSUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PMSM9999
.
PMSM0100  WRITE     HTMLFILE;PMSMMESA;
          GOTO      PMSM9999
.
PMSM0110  WRITE     HTMLFILE;PMSMMESB;
          GOTO      PMSM9999
.
PMSM0120  WRITE     HTMLFILE;PMSMMESC;
          GOTO      PMSM9999
.
PMSM0130  WRITE     HTMLFILE;PMSMMESD;
          GOTO      PMSM9999
.
PMSM0140  WRITE     HTMLFILE;PMSMMESE;
          GOTO      PMSM9999
.
PMSM0150  WRITE     HTMLFILE;PMSMMESF;
          GOTO      PMSM9999
.
PMSM0160  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMSM0161,PMSM0162
.
          WRITE     HTMLFILE;PMSMSTAT;
          GOTO      PMSM9999
.
PMSM0161  MATCH     " 0",PMSMSTAT
          IF        @EQUAL
            WRITE      HTMLFILE;"Sent";
          ENDIF
.
          MATCH     " 1",PMSMSTAT
          IF        @EQUAL
            WRITE      HTMLFILE;"Response Received";
          ENDIF
.
          MATCH     " 2",PMSMSTAT
          IF        @EQUAL
            WRITE      HTMLFILE;"Error";
          ENDIF
.
          MATCH     " 3",PMSMSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Re-Sent"
          ENDIF
.
          MATCH     " 4",PMSMSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Waiting";
          ENDIF
.
          MATCH     " 5",PMSMSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Error Corrected (Bulk Resend)";
          ENDIF
.
          MATCH     " 6",PMSMSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"No Mobile Number";
          ENDIF
.
          GOTO      PMSM9999
.
PMSM0162  MATCH     " 0",PMSMSTAT
          IF        @EQUAL
            WRITE      HTMLFILE;"The message was sent";
          ENDIF
.
          MATCH     " 1",PMSMSTAT
          IF        @EQUAL
            WRITE      HTMLFILE;"A response was received for the sent message";
          ENDIF
.
          MATCH     " 2",PMSMSTAT
          IF        @EQUAL
            WRITE      HTMLFILE;"An error occurred with sending the message";
          ENDIF
.
          MATCH     " 3",PMSMSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"The message was re-sent"
          ENDIF
.
          MATCH     " 4",PMSMSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"The message is awaiting to be sent";
          ENDIF
.
          MATCH     " 5",PMSMSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"The message was error-corrected (Bulk Resend)";
          ENDIF
.
          MATCH     " 6",PMSMSTAT
          IF        @EQUAL
            WRITE      HTMLFILE;"An error occurred with sending the message - No Mobile Number";
          ENDIF
.
          GOTO      PMSM9999
.
PMSM0170  WRITE     HTMLFILE;PMSMAHOC;
          GOTO      PMSM9999
.
PMSM0180  WRITE     HTMLFILE;PMSMCONT;
          GOTO      PMSM9999
.
PMSM0190  MOVE      "tc",CATEGORY
          MOVE      PMSMCTYP,CODE
          CALL      CODITM00
          GOTO      PMSM9999
.
PMSM0200  WRITE     HTMLFILE;PMSMRMID;
          GOTO      PMSM9999
.
PMSM9999  RETURN
.
.------------------------------------------------------------
. Set SMS history file cgi vars
.------------------------------------------------------------
SPPMS000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPPMS001,SPPMS002,SPPMS003,SPPMS004,SPPMS005:
                       SPPMS006,SPPMS007,SPPMS008,SPPMS009,SPPMS010:
                       SPPMS011,SPPMS012,SPPMS013,SPPMS014,SPPMS015:
                       SPPMS016,SPPMS017,SPPMS018,SPPMS019,SPPMS020
.
          MOVE      ONE,EXIT
          GOTO      SPPMS999 
.
SPPMS001  PACK      PMSMH001,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS002  PACK      PMSMH002,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS003  PACK      PMSMH003,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS004  PACK      PMSMH004,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS005  PACK      PMSMH005,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS006  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMSMH006,CCENT,CYEAR,CMON,CDAY
          GOTO      SPPMS999
.
SPPMS007  PACK      PMSMH007,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS008  PACK      PMSMH008,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS009  PACK      PMSMH009,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS010  PACK      PMSMH010,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS011  PACK      PMSMH011,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS012  PACK      PMSMH012,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS013  PACK      PMSMH013,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS014  PACK      PMSMH014,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS015  PACK      PMSMH015,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS016  PACK      PMSMH016,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS017  PACK      PMSMH017,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS018  PACK      PMSMH018,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS019  PACK      PMSMH019,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS020  PACK      PMSMH020,QRYDATA,SP70
          GOTO      SPPMS999
.
SPPMS999  RETURN
.
.------------------------------------------------------------
.  Update SMS history table file
.------------------------------------------------------------
MVPMRM00  MATCH     PMSMH001,Z70
          IF        !@EQUAL
            MOVE      PMSMH001,PMSMUMID
          ENDIF
.
          MATCH     PMSMH002,Z70
          IF        !@EQUAL
            MOVE      PMSMH002,PMSMURNO
          ENDIF
.
          MATCH     PMSMH003,Z70
          IF        !@EQUAL
            MOVE      PMSMH003,PMSMMTYP
          ENDIF
.
          MATCH     PMSMH004,Z70
          IF        !@EQUAL
            MOVE      PMSMH004,PMSMRKEY
          ENDIF
.
          MATCH     PMSMH005,Z70
          IF        !@EQUAL
            MOVE      PMSMH005,PMSMSCOD
          ENDIF
.
          MATCH     PMSMH006,Z70
          IF        !@EQUAL
            MOVE      PMSMH006,PMSMSDAT
          ENDIF
.
          MATCH     PMSMH007,Z70
          IF        !@EQUAL
            MOVE      PMSMH007,PMSMSTIM
          ENDIF
.
          MATCH     PMSMH008,Z70
          IF        !@EQUAL
            MOVE      PMSMH008,PMSMMNUM
          ENDIF
.
          MATCH     PMSMH009,Z70
          IF        !@EQUAL
            MOVE      PMSMH009,PMSMSUID
          ENDIF
.
          MATCH     PMSMH010,Z70
          IF        !@EQUAL
            MOVE      PMSMH010,PMSMMESA
          ENDIF
.
          MATCH     PMSMH011,Z70
          IF        !@EQUAL
            MOVE      PMSMH011,PMSMMESB
          ENDIF
.
          MATCH     PMSMH012,Z70
          IF        !@EQUAL
            MOVE      PMSMH012,PMSMMESC
          ENDIF
.
          MATCH     PMSMH013,Z70
          IF        !@EQUAL
            MOVE      PMSMH013,PMSMMESD
          ENDIF
.
          MATCH     PMSMH014,Z70
          IF        !@EQUAL
            MOVE      PMSMH014,PMSMMESE
          ENDIF
.
          MATCH     PMSMH015,Z70
          IF        !@EQUAL
            MOVE      PMSMH015,PMSMMESF
          ENDIF
.
          MATCH     PMSMH016,Z70
          IF        !@EQUAL
            MOVE      PMSMH016,PMSMSTAT
          ENDIF
.
          MATCH     PMSMH017,Z70
          IF        !@EQUAL
            MOVE      PMSMH017,PMSMAHOC
          ENDIF
.
          MATCH     PMSMH018,Z70
          IF        !@EQUAL
            MOVE      PMSMH018,PMSMCONT
          ENDIF
.
          MATCH     PMSMH019,Z70
          IF        !@EQUAL
            MOVE      PMSMH019,PMSMCTYP
          ENDIF
.
          MATCH     PMSMH020,Z70
          IF        !@EQUAL
            MOVE      PMSMH020,PMSMRMID
          ENDIF
.
MVPMSM99  RETURN

.*****************************************************************************
. Program      : V12PTMA1                                    
. Description  : Conversion patma1af to new File layout      
.*****************************************************************************
. Modifications:           
.*****************************************************************************
. V12.00.00  11/04/2025 Thanh T       TSK 0955096 
.            Initial Version
.*****************************************************************************
.
.  using vi Global change command      :%s/FromString/ToString/g
.
.  Global change V12PTMA1  eg F57PTDOC
.  Global change v12ptma1  eg f57ptdoc
.  Global change PATMA1FD  eg PATDOCFD (new layout)
.  Global change patma1af  eg patdoctf
.  Global change PATMA1A1  eg PATDOCT1
.  Global change KEY8      eg KEY8
.  Global change KEY8      eg KEY9
.  Global change WRMAST1   eg WRDOCT1
.  Global change spatma1f  eg sptdoctf
.
.  Global changes if Oracle Option is required -
.
.  Global Change answeryn  to Yes
.  Global change RSPTMAS1  eg RSPTDOC1
.  Global change RKPTMAS1  eg RKPTDOC1
.  Global change UPPTMAS1  eg UPPTDOC1
.
.  Global changes if Oracle Option is NOT required -

.  Global Change answeryn  to No
.  Global change RSPTMAS1  to OFDUMYIO
.  Global change RKPTMAS1  to OFDUMYIO
.  Global change UPPTMAS1  to OFDUMYIO
.
          INC       STD001FD
.
FINDFILE  FILE      ASCII, FIXED=256
LOGFILE   FILE      ASCII, FIXED=256
.
. Enter the first or the shortest index from the original FD and rename
. the index OLDFILE1
.
.                                     ******** copy the old FD here *******
.                                     * comment out all continuing fields and
.                                     * prefix changing fields with "OLD" -
.                                     * remove old Indexes and Redefines     
.
..OLDFILE1  IFILE     SQL, FIXED=xxx, KEY="Uxx-xx"
OLDFILE1  IFILE     SQL, FIXED=1045, KEY="U1-8"
.
.Name     Type      Length  Phys.  Start  Description
.-------  ----      ------  -----  -----  ----------------------------------
.PURNO      DIM      8         8          1      PATIENT U.R NO.
.PPORT      DIM      2         2          9      PORT CURRENTLY UPDATING U/R
.PCHGDTE    DIM      8         8         11      date of last change   (ccyymmdd)
.PTITL      DIM      4         4         19      PATIENT TITLE
.PHOSP      FORM     1         2         23      HOSPITAL LAST 12 MONTHS
.                                               1-YES,0-NO
.PLDAYS     FORM     3         3         25      NO DAYS LAST IN HOSPITAL
.PBDEBT     FORM     1         2         28      BAD DEBTOR INDICATOR 0-NO 1-YES
.PSNAME     DIM     20        20         30      PATIENT SURNAME
.PGNAME     DIM     25        25         50      PATIENTS GIVEN NAMES
.PPSNAME    DIM     19        19         75      PATIENTS PREVIOUS SURNAME /
.                                               New UR number for merged URs
.PADD1      DIM     35        35         94      PATIENT ADDRESS LINE 1
.PADD2      DIM     35        35        129      PATIENT ADDRESS LINE 2
.PSUBRB     DIM     35        35        164      PATIENT ADDRESS LINE 3
.PADD4      DIM     35        35        199      PATIENT ADDRESS LINE 4
.PPOST      DIM      8         8        234      PATIENT POSTCODE
.PTELEP     DIM     20        20        242      TELEPHONE PRIVATE
.PTELEB     DIM     20        20        262      TELEPHONE BUSINESS
.PSEX       DIM      1         1        282      PATIENTS SEX
.PMSTAT     DIM      3         3        283      PATIENTS MARTIAL STATUS (Cat M)
.PBDATE     DIM      8         8        286      date of birth         (ccyymmdd)
.PSAGE      FORM     3         3        294      PATIENTS AGE
.PCONT      DIM      3         3        297      COUNTRY OF BIRTH (Cat C)
.PREG       DIM      3         3        300      PATIENTS RELIGION (Cat R)
.PTYPE      DIM      3         3        303      PATIENTS TYPE (Cat T)
.POCCUP     DIM     14        14        306      PATIENTS OCCUPATION
.PLDDATE    DIM      8         8        320      last discharge date   (ccyymmdd)
.PMEDI      DIM     10        10        328      MEDICARE NUMBER
.PPENNO     DIM     15        15        338      PENSION NUMBER
.PPNDTE     DIM      6         6        353      pension no expiry date  (ccyymm)
.PREPAT     DIM     10        10        359      REPATRIATION NUMBER
.PSMOK     FORM      1         2        369      PATIENT SMOKER
.                                               1 = YES
.                                               2 = NO
.PSTAT      FORM     1         2        371      PATIENT STATUS
.                                               0 - VALID U/R  (IN MASTER FILE)
.                                               1 - CANCELLED U/R
.                                               2 - ASSOCIATED U/R
.                                               NOTE :- ASSOCIATED U/R IS NOW
.                                                       PLACED IN THE PADMNO
.                                               3 - NOT YET ALLOCATED
.                                               ****** (IN PRAM FILE) ********
.                                               4 - EBS Created U/R
.PMICRO     DIM     20        20        373      MICROFILM ADDRESS
.                                               1 -  6  U.R. NO.
.                                               7 - 10  ROLL NO.
.                                               11 - 14  POSITION NO.
.                                               15 - 16  YEAR
.PCEASE     FORM     1         2        393      DECEASED INDICATOR
.                                               0 = NO
.                                               1 = YES
.PCASE      FORM     1         2        395      CASE NOTES INDICATOR
.PAUTOPY    FORM     1         2        397      AUTOPSY INDICATOR
.                                               0 = NO
.                                               1 = YES
.
.PHIGH1     DIM      3         3        399      HIGHLIGHT CODE 1 (Cat H1)
.PHIGH2     DIM      3         3        402      HIGHLIGHT CODE 2 (Cat H2)
.PHIGH3     DIM      3         3        405      HIGHLIGHT CODE 3 (Cat H3)
.
.PLOCDOC    DIM     30        30        408      LOCAL DOCTOR
.
.PFUNDH     DIM      6         6        438      HEALTH FUND
.PFNDTB     DIM      8         8        444      HEALTH FUND TABLE
.PTMASPAR   DIM     10        10        452      Spare - was HF membership no
.
.PUSR1      DIM      3         3        462      USER DEFINED FIELD 1 (Cat P1)
.PUSR2      DIM      3         3        465      USER DEFINED FIELD 2 (Cat P2)
.PUSR3      DIM      3         3        468      USER DEFINED FIELD 3 (Cat P3)
.PUSR4      DIM      3         3        471      USER DEFINED FIELD 4 (Cat P4)
.PUSR5      DIM      3         3        474      USER DEFINED FIELD 5 (Cat P5)
.PUSR6      DIM      3         3        477      USER DEFINED FIELD 6 (Cat P6)
.PUYN1      FORM     1         2        480      USER DEFINED Y/N FIELD 1
.                                               (1=Y,0=N)
.PUYN2      FORM     1         2        482      USER DEFINED Y/N FIELD 2
.                                               (1=Y,0=N)
.PUYN3      FORM     1         2        484      USER DEFINED Y/N FIELD 3
.                                               (1=Y,0=N)
.PYRRES     FORM     2         2        486      NUMBER OF YEARS RESIDENT
.
.              NEXT OF KIN DATA
.
.PNKNAME    DIM     20        20        488      NEXT OF KIN 1 NAME
.PNKADD1    DIM     35        35        508      N.O.K 1 ADDRESS LINE 1
.PNKADD2    DIM     35        35        543      N.O.K 1 ADDRESS LINE 2
.PNKSUBR    DIM     35        35        578      N.O.K 1 ADDRESS LINE 3
.PNKADD4    DIM     35        35        613      N.O.K 1 ADDRESS LINE 4
.PNKPOST    DIM      8         8        648      N.O.K 1 POSTCODE
.PNKTELP    DIM     20        20        656      N.O.K 1 PRIVATE TELEPHONE
.PNKTELB    DIM     20        20        676      N.O.K 1 BUSINESS TELEPHONE
.PNKRELP    DIM     10        10        696      N.O.K 1 RELATIONSHIP
.
OPLSTINP    FORM     8         5        706      LAST INPATIENT  VISIT NUMBER
OPLSTOUT    FORM     8         5        711      LAST OUTPATIENT VISIT NUMBER
.PNXRAY     FORM     3         3        716      NUMBER OF PREVIOUS X-RAYS
.
.          Additional Health Fund details
.
.PFNDYY     DIM      2         2        719      YRS OF FUND MEMBERSHIP (JR,DE)
.PFNDCG     DIM      6         6        721      fund cover change       (ccyymm)
.
.PDECDTE    DIM      8         8        727      date of death         (ccyymmdd)
.PHCNOTES   DIM     20        20        735      CASE NOTES INDICATORS
.PDIET      DIM      3         3        755      DEFAULT DIET CODE (Cat DC)
.PINITHOS   DIM      2         2        758      HOSPITAL U/R INITIATED FROM
.PHKADUNI   DIM     10        10        760      HONG KONG UNIQUE ADDRESS ID
.PTMAEMPC   DIM      6         6        770      PATIENT EMPLOYER CODE
.PTMANOKO   DIM     14        14        776      NEXT OF KIN OCCUPATION
.PTMANOKE   DIM      6         6        790      NEXT OF KIN EMPLOYER CODE
.PTMADCNO   DIM     10        10        796      DEATH CERTIFICATE NUMBER
.PTMAUKDB   DIM      1         1        806      Unknown Date of Birth (Y/N)
.PTMAUKDD   DIM      1         1        807      Unknown Date of Death (Y/N)
.PFNDMM     DIM     19        19        808      Health Fund Membership no.
.PTMADCDT   DIM      8         8        827      Demographics Conf Date CCYYMMDD
.PTMAHCP1   DIM     10        10        835      HCP 1 (pmshcpaf)
.PTMAHCL1   DIM     10        10        845      HCP 1 Practice (pmshclaf)
.PTMAHCG1   DIM      2         2        855      HCP 1 Grp Count (pmshcgaf
.PTMAHCP2   DIM     10        10        857      HCP 2 (pmshcpaf)
.PTMAHCL2   DIM     10        10        867      HCP 2 Practice (pmshclaf)
.PTMAHCG2   DIM      2         2        877      HCP 2 Grp Count (pmshcgaf
.PTMAHCP3   DIM     10        10        879      HCP 3 (pmshcpaf)
.PTMAHCL3   DIM     10        10        889      HCP 3 Practice (pmshclaf)
.PTMAHCG3   DIM      2         2        899      HCP 3 Grp Count (pmshcgaf
.PTMAHCP4   DIM     10        10        901      HCP 4 (pmshcpaf)
.PTMAHCL4   DIM     10        10        911      HCP 4 Practice (pmshclaf)
.PTMAHCG4   DIM      2         2        921      HCP 4 Grp Count (pmshcgaf
.PTMAHCP5   DIM     10        10        923      HCP 5 (pmshcpaf)
.PTMAHCL5   DIM     10        10        933      HCP 5 Practice (pmshclaf)
.PTMAHCG5   DIM      2         2        943      HCP 5 Grp Count (pmshcgaf
.PTMASNAM   DIM     40        40        945      Patient Surname
.PTMADCUD   DIM      8         8        985      Demog. Conf Upd Date (CCYYMMDD)
.PTMADCUT   DIM      8         8        993      Demog. Conf Upd Time (HH:MM:SS)
.PTMADCUU   DIM      10       10       1001      Demog. Conf Upd User (websecaf)
.PTMAUUID   DIM      10       10       1011      Web User Id who Last Updated
.                                               Record (websecaf)
.PTMAUTIM   DIM      8         8       1021      Time Record Last Updated
.                                               (hh:mm:ss)
OPTMASPA   DIM     16        16       1029      Spare
.End of Record                        1045
.
.
.                                     ******** copy the new FD here *******
.
PATMA1A1   IFILE SQL, FIXED=1045, KEY="U1-8"
PATMA1A2   IFILE SQL, FIXED=1045, KEY="D286-293"
PATMA1A3   IFILE SQL, FIXED=1045, KEY="U328-337,1-8"
PATMA1A4   IFILE SQL, FIXED=1045, KEY="U75-93,1-8"
.
. NAME     TYPE  LENGTH  PHYSICAL  START LOC.   DESCRIPTION
. ----     ----  ------  --------  ----------   -----------
PURNO      DIM      8         8          1      PATIENT U.R NO.
PPORT      DIM      2         2          9      PORT CURRENTLY UPDATING U/R
PCHGDTE    DIM      8         8         11      date of last change   (ccyymmdd)
PTITL      DIM      4         4         19      PATIENT TITLE
PHOSP      FORM     1         2         23      HOSPITAL LAST 12 MONTHS
.                                               1-YES,0-NO
PLDAYS     FORM     3         3         25      NO DAYS LAST IN HOSPITAL
PBDEBT     FORM     1         2         28      BAD DEBTOR INDICATOR 0-NO 1-YES
PSNAME     DIM     20        20         30      PATIENT SURNAME
PGNAME     DIM     25        25         50      PATIENTS GIVEN NAMES
PPSNAME    DIM     19        19         75      PATIENTS PREVIOUS SURNAME /
.                                               New UR number for merged URs
PADD1      DIM     35        35         94      PATIENT ADDRESS LINE 1
PADD2      DIM     35        35        129      PATIENT ADDRESS LINE 2
PSUBRB     DIM     35        35        164      PATIENT ADDRESS LINE 3
PADD4      DIM     35        35        199      PATIENT ADDRESS LINE 4
PPOST      DIM      8         8        234      PATIENT POSTCODE
PTELEP     DIM     20        20        242      TELEPHONE PRIVATE
PTELEB     DIM     20        20        262      TELEPHONE BUSINESS
PSEX       DIM      1         1        282      PATIENTS SEX
PMSTAT     DIM      3         3        283      PATIENTS MARTIAL STATUS (Cat M)
PBDATE     DIM      8         8        286      date of birth         (ccyymmdd)
PSAGE      FORM     3         3        294      PATIENTS AGE
PCONT      DIM      3         3        297      COUNTRY OF BIRTH (Cat C)
PREG       DIM      3         3        300      PATIENTS RELIGION (Cat R)
PTYPE      DIM      3         3        303      PATIENTS TYPE (Cat T)
POCCUP     DIM     14        14        306      PATIENTS OCCUPATION
PLDDATE    DIM      8         8        320      last discharge date   (ccyymmdd)
PMEDI      DIM     10        10        328      MEDICARE NUMBER
PPENNO     DIM     15        15        338      PENSION NUMBER
PPNDTE     DIM      6         6        353      pension no expiry date  (ccyymm)
PREPAT     DIM     10        10        359      REPATRIATION NUMBER
PSMOK     FORM      1         2        369      PATIENT SMOKER
.                                               1 = YES
.                                               2 = NO
PSTAT      FORM     1         2        371      PATIENT STATUS
.                                               0 - VALID U/R  (IN MASTER FILE)
.                                               1 - CANCELLED U/R
.                                               2 - ASSOCIATED U/R
.                                               NOTE :- ASSOCIATED U/R IS NOW
.                                                       PLACED IN THE PADMNO
.                                               3 - NOT YET ALLOCATED
.                                               ****** (IN PRAM FILE) ********
.                                               4 - EBS Created U/R
PMICRO     DIM     20        20        373      MICROFILM ADDRESS
.                                               1 -  6  U.R. NO.
.                                               7 - 10  ROLL NO.
.                                               11 - 14  POSITION NO.
.                                               15 - 16  YEAR
PCEASE     FORM     1         2        393      DECEASED INDICATOR
.                                               0 = NO
.                                               1 = YES
PCASE      FORM     1         2        395      CASE NOTES INDICATOR
PAUTOPY    FORM     1         2        397      AUTOPSY INDICATOR
.                                               0 = NO
.                                               1 = YES
.
PHIGH1     DIM      3         3        399      HIGHLIGHT CODE 1 (Cat H1)
PHIGH2     DIM      3         3        402      HIGHLIGHT CODE 2 (Cat H2)
PHIGH3     DIM      3         3        405      HIGHLIGHT CODE 3 (Cat H3)
.
PLOCDOC    DIM     30        30        408      LOCAL DOCTOR
.
PFUNDH     DIM      6         6        438      HEALTH FUND
PFNDTB     DIM      8         8        444      HEALTH FUND TABLE
PTMASPAR   DIM     10        10        452      Spare - was HF membership no
.
PUSR1      DIM      3         3        462      USER DEFINED FIELD 1 (Cat P1)
PUSR2      DIM      3         3        465      USER DEFINED FIELD 2 (Cat P2)
PUSR3      DIM      3         3        468      USER DEFINED FIELD 3 (Cat P3)
PUSR4      DIM      3         3        471      USER DEFINED FIELD 4 (Cat P4)
PUSR5      DIM      3         3        474      USER DEFINED FIELD 5 (Cat P5)
PUSR6      DIM      3         3        477      USER DEFINED FIELD 6 (Cat P6)
PUYN1      FORM     1         2        480      USER DEFINED Y/N FIELD 1
.                                               (1=Y,0=N)
PUYN2      FORM     1         2        482      USER DEFINED Y/N FIELD 2
.                                               (1=Y,0=N)
PUYN3      FORM     1         2        484      USER DEFINED Y/N FIELD 3
.                                               (1=Y,0=N)
PYRRES     FORM     2         2        486      NUMBER OF YEARS RESIDENT
.
.              NEXT OF KIN DATA
.
PNKNAME    DIM     20        20        488      NEXT OF KIN 1 NAME
PNKADD1    DIM     35        35        508      N.O.K 1 ADDRESS LINE 1
PNKADD2    DIM     35        35        543      N.O.K 1 ADDRESS LINE 2
PNKSUBR    DIM     35        35        578      N.O.K 1 ADDRESS LINE 3
PNKADD4    DIM     35        35        613      N.O.K 1 ADDRESS LINE 4
PNKPOST    DIM      8         8        648      N.O.K 1 POSTCODE
PNKTELP    DIM     20        20        656      N.O.K 1 PRIVATE TELEPHONE
PNKTELB    DIM     20        20        676      N.O.K 1 BUSINESS TELEPHONE
PNKRELP    DIM     10        10        696      N.O.K 1 RELATIONSHIP
.
PLSTINP    DIM      8         8        706      LAST INPATIENT  VISIT NUMBER
PLSTOUT    DIM      8         8        714      LAST OUTPATIENT VISIT NUMBER
PNXRAY     FORM     3         3        722      NUMBER OF PREVIOUS X-RAYS
.
.          Additional Health Fund details
.
PFNDYY     DIM      2         2        725      YRS OF FUND MEMBERSHIP (JR,DE)
PFNDCG     DIM      6         6        727      fund cover change       (ccyymm)
.
PDECDTE    DIM      8         8        733      date of death         (ccyymmdd)
PHCNOTES   DIM     20        20        741      CASE NOTES INDICATORS
PDIET      DIM      3         3        761      DEFAULT DIET CODE (Cat DC)
PINITHOS   DIM      2         2        764      HOSPITAL U/R INITIATED FROM
PHKADUNI   DIM     10        10        766      HONG KONG UNIQUE ADDRESS ID
PTMAEMPC   DIM      6         6        776      PATIENT EMPLOYER CODE
PTMANOKO   DIM     14        14        782      NEXT OF KIN OCCUPATION
PTMANOKE   DIM      6         6        796      NEXT OF KIN EMPLOYER CODE
PTMADCNO   DIM     10        10        802      DEATH CERTIFICATE NUMBER
PTMAUKDB   DIM      1         1        812      Unknown Date of Birth (Y/N)
PTMAUKDD   DIM      1         1        813      Unknown Date of Death (Y/N)
PFNDMM     DIM     19        19        814      Health Fund Membership no.
PTMADCDT   DIM      8         8        833      Demographics Conf Date CCYYMMDD
PTMAHCP1   DIM     10        10        841      HCP 1 (pmshcpaf)
PTMAHCL1   DIM     10        10        851      HCP 1 Practice (pmshclaf)
PTMAHCG1   DIM      2         2        861      HCP 1 Grp Count (pmshcgaf
PTMAHCP2   DIM     10        10        863      HCP 2 (pmshcpaf)
PTMAHCL2   DIM     10        10        873      HCP 2 Practice (pmshclaf)
PTMAHCG2   DIM      2         2        883      HCP 2 Grp Count (pmshcgaf
PTMAHCP3   DIM     10        10        885      HCP 3 (pmshcpaf)
PTMAHCL3   DIM     10        10        895      HCP 3 Practice (pmshclaf)
PTMAHCG3   DIM      2         2        905      HCP 3 Grp Count (pmshcgaf
PTMAHCP4   DIM     10        10        907      HCP 4 (pmshcpaf)
PTMAHCL4   DIM     10        10        917      HCP 4 Practice (pmshclaf)
PTMAHCG4   DIM      2         2        927      HCP 4 Grp Count (pmshcgaf
PTMAHCP5   DIM     10        10        929      HCP 5 (pmshcpaf)
PTMAHCL5   DIM     10        10        939      HCP 5 Practice (pmshclaf)
PTMAHCG5   DIM      2         2        949      HCP 5 Grp Count (pmshcgaf
PTMASNAM   DIM     40        40        951      Patient Surname
PTMADCUD   DIM      8         8        991      Demog. Conf Upd Date (CCYYMMDD)
PTMADCUT   DIM      8         8        999      Demog. Conf Upd Time (HH:MM:SS)
PTMADCUU   DIM      10       10       1007      Demog. Conf Upd User (websecaf)
PTMAUUID   DIM      10       10       1017      Web User Id who Last Updated
.                                               Record (websecaf)
PTMAUTIM   DIM      8         8       1027      Time Record Last Updated
.                                               (hh:mm:ss)
PTMASPA2   DIM     10        10       1035      Spare
.End of Record                        1045
.
. LOCAL VARIABLES
. ---------------
CMDLINE   DIM       200
.
DEFPATH   DIM       60
DIM60     DIM       60
DISNUM    FORM      4
.
ERORTEXT  DIM       80
.
INPFILE   DIM       8
.
MINUS3    FORM      "-3"
.
NEWFILE   DIM       60
NEWPATH   DIM       60
.
OLDPATH   DIM       60
.
RECNUM    FORM      8
.
SAVEFLG   FORM      1
.
USINGORC  DIM       1
.
.
. PROGRAM CONSTANTS
. -----------------
CREATEXT  INIT    "Log file created "
DASHLINE  INIT      "--------------------------------------------------":
                    "------------------------------"
ENDGTEXT  INIT    "Ending   fixit (Option "
OPENTEXT  INIT    "Log file opened "
SP60      INIT    "                                                            "
STARTTXT  INIT    "Starting fixit (Option "
.
.
.
PRGNAM    INIT      "CONVERSION PATMA1FD"
PRGID     INIT      "V12PTMA1"
VERSION   INIT      "V12.00.00"
+
.*****************************************************************************
.*                             MAIN0000                                      *
.*                         Program Mainline                                  *
.*****************************************************************************
.
MAIN0000  CALL      INIT0000                      * init and open files
.
          CALL      OLOG0000                      * create/open log file
MAIN0500  CALL      OPTN0000                      * get option
          BRANCH    COPTION,MAIN1000:             * run c-isam fixit
                            MAIN2000              * run oracle fixit
          GOTO      MAIN9999                      * exit selected
.
MAIN1000  CALL      KDIR0000                      * Keyin directory
          BRANCH    EXIT,MAIN9000
.
MAIN2000  CALL      CONTQST                       * Ok to continue ?
          BRANCH    CEXIT,MAIN5000:               * yes
                          MAIN0500:               * no
                          MAIN9000                * cancel
.
MAIN5000  BRANCH    COPTION,MAIN6000:             * c-isam fixit
                            MAIN7000              * oracle fixit
.
.         Running c-isam fix
.
MAIN6000  CALL      PREP0000                      * preparing files
          BRANCH    EXIT,MAIN9000
.
          CALL      READ0000                      * read old records and write
          CALL      ENDP0000                      * save/zip saved file
          GOTO      MAIN9000
.
.         Running oracle fix
.
MAIN7000  CALL      OFIX0000                      * run oracle fix
.
MAIN9000  CALL      CLOG0000                      * close log file
.
MAIN9999  CHAIN     PGM
+
.********************************************************************
.*                          INIT0000                                *
.*  Display heading and check that the files needed exist&open them *
.********************************************************************
.
INIT0000  CALL      DISPHEAD
          MOVE      ZERO,RECNUM
          MOVE      ZERO,DISNUM
          
INIT9999  RETURN
+
.*****************************************************************************
.*                                OPTN0000             Called by: MAIN0000   *
.*                        Get user options or exit                           *
.*    Returns:  EXIT    = FALSE (0)  Ok to proceed                           *
.*                        TRUE  (1)  Exit option selected                    *
.*              COPTION - option selected                                    *
.*****************************************************************************
.
OPTN0000  MOVE      "No",USINGORC
          REP       "yYnN",USINGORC
          MOVE      USINGORC,KEY1
          REP       "Y-N-",KEY1
          MATCH     "-",KEY1
          GOTO      OPTN9200 IF NOT EQUAL
.
          DISPLAY   *P1:3,*EF,*P1:4,*V2LON,ZERO,*HOFF,". Exit":
                    *P1:5,*V2LON,ONE,*HOFF,". Run Fixit (c-isam only)"
          MATCH     "Y",USINGORC
          IF        @EQUAL
            DISPLAY   *P1:6,*V2LON,TWO,*HOFF,". Run Fixit (Oracle only)"
          ENDIF
.
OPTN0500  KEYIN     *P1:8,*EL,"Select Option : ":
                    *P17:8,*V2LON,COPTION
.
          COMPARE   ZERO,COPTION                 * exit selected ?
          GOTO      OPTN9500 IF EQUAL            * yes
.
          BRANCH    COPTION,OPTN9000:            * run c-isam fixit
                            OPTN9000             * run oracle fixit
.
          BEEP
          GOTO      OPTN0500
.
OPTN9000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9200  DISPLAY   *P1:3,*EF,*P1:4," Oracle Option has not been set up ":
                          "correctly":
                    *P1:6," Program will terminate    - ";
          MOVE      "Oracle Option has not been set up correctly",ERORTEXT
          WRITE     LOGFILE,SEQ;*+,ERORTEXT
          CALL      HITENTER
.
OPTN9500  MOVE      ONE,EXIT
.
OPTN9999  RETURN
+
.********************************************************************
.*                          KDIR0000                                *
.*  Keyin directories                                               *
.********************************************************************
.
KDIR0000  MOVE      ONE,SAVEFLG        * Default to keep file
          KEYIN     *P1:10,*EL,"Do you want to save the original file (Y/N) ? ":
                    ANS;
          REP       "yYnN",ANS
          CMATCH    "Y",ANS
          GOTO      KDIR1000 IF EQUAL
          MOVE      ZERO,SAVEFLG       * not to keep file
          CMATCH    "N",ANS
          GOTO      KDIR1000 IF EQUAL
          BEEP
          GOTO      KDIR0000
.
KDIR1000  CALL      DEFT0000                * Get the default path
          BRANCH    EXIT,KDIR9999
          MOVE      SP60,OLDPATH
.
          DISPLAY   *P1:24,*EL,"The directory path must end with a slash (/) ";
.
.
          MOVE      DEFPATH,OLDPATH
          BRANCH    SAVEFLG,KDIR2000
.
.         Keyin the path for the original file
.
          KEYIN     *P1:12,*EL,"Keyin path for temporarily saving original ":
                    "file: ":
                    *P10:13,*EL,*DV,*RV,OLDPATH:
                    *P10:13,OLDPATH;
          GOTO      KDIR3000
.
KDIR2000  KEYIN     *P1:12,*EL,"Keyin path for saving original file: ":
                    *P10:13,*EL,*DV,*RV,OLDPATH:
                    *P10:13,OLDPATH;
.
KDIR3000  ENDSET    OLDPATH
          APPEND    SP60,OLDPATH
          RESET     OLDPATH
.
          MATCH     SP60,OLDPATH
          IF        @EQUAL
            PACK      OLDPATH,DEFPATH      * use the default
            DISPLAY   *P10:13,*EL,*V2LON,OLDPATH;
          ENDIF
.
          SQUEEZE   OLDPATH
          CMATCH    EXITCHAR,OLDPATH
          GOTO      KDIR9000 IF EQUAL
.
          PACK      DIM60,OLDPATH,SP60
          CALL      VALD0000         * check if it's a valid directory
          BRANCH    EXIT,KDIR1000
.
.         Keyin the path for the new file
.
KDIR5000  MOVE      SP60,NEWPATH
          MOVE      DEFPATH,NEWPATH
          KEYIN     *P1:15,*EL,"Keyin path for the new file: ":
                    *P10:16,*EL,*DV,*RV,NEWPATH:
                    *P10:16,NEWPATH;
          ENDSET    NEWPATH
          APPEND    SP60,NEWPATH
          RESET     NEWPATH
.
          MATCH     SP60,NEWPATH
          IF        @EQUAL
            PACK      NEWPATH,DEFPATH      * use the default
            DISPLAY   *P10:16,*V2LON,NEWPATH;
          ENDIF
.
          SQUEEZE   NEWPATH
          CMATCH    EXITCHAR,NEWPATH
          GOTO      KDIR9000 IF EQUAL
.
          PACK      DIM60,NEWPATH,SP60
          CALL      VALD0000         * check if it's a valid directory
          BRANCH    EXIT,KDIR5000
          GOTO      KDIR9999
.
KDIR9000  MOVE      ONE,EXIT
.
KDIR9999  DISPLAY   *P1:24,*EL;
          RETURN
+
.********************************************************************
.*                          PREP0000                                *
.*  Preparing files                                                 *
.********************************************************************
.
PREP0000  CALL      IBACLOCK
          REP       " 0",CDATE
          REP       " 0",CTIMEIS
          DISPLAY   *P1:18,"Started : ",CDATE,SP1,CTIMEIS:
                    *P1:20,"Record : "
.
          CALL      SLOG0000                      * write start to log file
.
          MOVE      "patma1af",INPFILE
          CALL      CHEK0000             * check file exists or has been changed
          BRANCH    EXIT,PREP9000
.
          CLOSE     OLDFILE1
          DISPLAY   *P1:24,*EL,"Copying files ... Please wait !! ";
.
.         Copy old file to the keyin directory
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cp `ldat patma1af.dat` ",CMDLINE
          APPEND    OLDPATH,CMDLINE
          APPEND    "spatma1f.dat",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            GOTO      PREP8000
          ENDIF
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cp `ldat patma1af.idx` ",CMDLINE
          APPEND    OLDPATH,CMDLINE
          APPEND    "spatma1f.idx",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            GOTO      PREP8000
          ENDIF
.
.         Remove the original files
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    DEFPATH,CMDLINE
          APPEND    "patma1af",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            MOVE      "Unable to remove the original file.  ",ERORTEXT
            WRITE     LOGFILE,SEQ;ERORTEXT
            DISPLAY   *P1:24,*EL,*B,*+,ERORTEXT;
            CALL      HITENTER
            GOTO      PREP9000
          ENDIF
.
.         Opening old file after being copied
.
          MOVE      SP60,DIM60
          CLEAR     DIM60
          APPEND    OLDPATH,DIM60
          APPEND    "spatma1f",DIM60
          APPEND    SP60,DIM60
          RESET     DIM60
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OLDFILE1,DIM60
          TRAPCLR   IO
          IF        OVRCD = 1
            MOVE      "Unable to open saved original file.  ",ERORTEXT
            WRITE     LOGFILE,SEQ;ERORTEXT
            DISPLAY   *P1:24,*EL,*B,*+,ERORTEXT;
            CALL      HITENTER
            GOTO      PREP9000
          ENDIF
.
.         Create the new file
.
          DISPLAY   *P1:24,*EL,"Creating new files ... Please wait !! ";
          PACK      NEWFILE,SP60
          CLEAR     NEWFILE
          APPEND    NEWPATH,NEWFILE
          APPEND    "patma1af",NEWFILE
          APPEND    SP60,NEWFILE
          RESET     NEWFILE
          SQUEEZE   NEWFILE
.
PREP1000  PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    NEWFILE,CMDLINE
.
.  The files new record length and unique key must be written here
.      eg    APPEND    " 195 UC9-16",CMDLINE
.
. Index 1
          APPEND    " 1045 UC1-8",CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
.  If the file has more than one index, this piece of code below has 
.  to be repeated with for each individual index
.
. Index 2
           PACK      CMDLINE,SP60,SP60
           CLEAR     CMDLINE
           APPEND    "isadd ",CMDLINE
           APPEND    NEWFILE,CMDLINE
           APPEND    " D286-293",CMDLINE
           APPEND    SP60,CMDLINE
           RESET     CMDLINE
           EXECUTE   CMDLINE,TASKID
. Index 3
           PACK      CMDLINE,SP60,SP60
           CLEAR     CMDLINE
           APPEND    "isadd ",CMDLINE
           APPEND    NEWFILE,CMDLINE
           APPEND    " UC328-337,1-8",CMDLINE
           APPEND    SP60,CMDLINE
           RESET     CMDLINE
           EXECUTE   CMDLINE,TASKID
. Index 4
           PACK      CMDLINE,SP60,SP60
           CLEAR     CMDLINE
           APPEND    "isadd ",CMDLINE
           APPEND    NEWFILE,CMDLINE
           APPEND    " UC75-93,1-8",CMDLINE
           APPEND    SP60,CMDLINE
           RESET     CMDLINE
           EXECUTE   CMDLINE,TASKID
.
          OPEN      PATMA1A1,NEWFILE
.
          DISPLAY   *P1:24,*EL;
          MOVE      ZERO,EXIT
          GOTO      PREP9999
.
PREP5000  MOVE      "Old file not found.  ",ERORTEXT
          WRITE     LOGFILE,SEQ;ERORTEXT
          DISPLAY   *P1:24,*EL,*B,*+,ERORTEXT;
          CALL      HITENTER
          GOTO      PREP9000
.
PREP8000  MOVE      "Unable to copy original file.  (Error: ",ERORTEXT
          ENDSET    ERORTEXT
          APPEND    TASKID,ERORTEXT
          APPEND    ")  ",ERORTEXT
          RESET     ERORTEXT
          WRITE     LOGFILE,SEQ;ERORTEXT
          DISPLAY   *P1:24,*EL,*B,*+,ERORTEXT;
          CALL      HITENTER
.
PREP9000  MOVE      ONE,EXIT
.
PREP9999  RETURN
+
.********************************************************************
.*                          CHEK0000                                *
.*  Check if file exists, or has already been converted             *
.********************************************************************
.
CHEK0000  MOVE      ZERO,EXIT
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND GIVING DIM60 IF IO
          OPEN      OLDFILE1,INPFILE
          TRAPCLR   IO
          BRANCH    OVRCD,CHEK2000       * Original file does not exist
          CLOSE     OLDFILE1
          GOTO      CHEK9999
.
CHEK2000  RESET     DIM60
          SCAN      "I * I",DIM60
          DISPLAY   *P1:23,*EF,"File '",INPFILE,"' ";
          IF        @EQUAL
            DISPLAY   "does not exist - ";
            MOVE      "File does not exist",ERORTEXT
            WRITE     LOGFILE,SEQ;ERORTEXT
          ELSE
            RESET     DIM60
            SCAN      "I * L",DIM60
            IF        @EQUAL
              DISPLAY   "has already been converted - ";
              MOVE      "File has already been converted",ERORTEXT
              WRITE     LOGFILE,SEQ;ERORTEXT
            ELSE
              DISPLAY   "has caused an IO error - ";
              MOVE      "File has caused an IO Error",ERORTEXT
              WRITE     LOGFILE,SEQ;ERORTEXT
            ENDIF
          ENDIF
          MOVE      "File will be bypassed",ERORTEXT
          WRITE     LOGFILE,SEQ;ERORTEXT
          DISPLAY   *+,ERORTEXT
.
          CALL      HITENTER
          DISPLAY   *P1:23,*EF;
.
CHEK9000  MOVE      ONE,EXIT
.
CHEK9999  RETURN
+
.**********************************************************************
.*                               READ0000                             *
.*             loop thru old file and write each record               *
.**********************************************************************
.
READ0000  DISPLAY   *P1:20,*EL,"Record No. : ";
.
          PACK      KEY8,SP60
          CALL      READSOLD                      * position at start
READ1000  CALL      READKOLD                      * read next record
          BRANCH    OVRCD,READ6000                * no more records
.
          ADD       ONE,RECNUM                    * update record counter
          ADD       ONE,DISNUM                    * Display counter
.
          IF        DISNUM = 5000  | RECNUM = 1
            MOVE      ZERO,DISNUM
            DISPLAY   *P15:20,*V2LON,RECNUM
          ENDIF
.
.  All necessary changes to the files field lengths, date changes
.  or any other sort of modification must be made here
.
.    eg    PACK      DSPARE,SP70
.          PACK      PTDSDMDC,SP10
.          PACK      PTDSDDRG,SP10
.
          MOVE      OPLSTINP,PLSTINP
          MOVE      OPLSTOUT,PLSTOUT
          MOVE      SP70,PTMASPA2 
.                                               * Pack key here
          PACK      KEY8,PURNO,SP70
          CALL      WRMAST1                    * write to new file

          GOTO      READ1000                      * get next record
.
READ6000  CLOSE     PATMA1A1                      * close new file
          CLOSE     OLDFILE1                      * close old file
.
          CALL      IBACLOCK
          REP       " 0",CDATE
          REP       " 0",CTIMEIS
          DISPLAY   *P15:20,*V2LON,RECNUM,*HOFF:
                    *P1:22,"Ended  : ",CDATE,SP1,CTIMEIS:
                    *P1:24;
.
READ9999  RETURN
+
.**********************************************************************
.*                               VALD0000                             *
.*        Check if it a valid directory                               *
.**********************************************************************
.
VALD0000  MOVE      ZERO,EXIT
.
          SQUEEZE   DIM60
          ENDSET    DIM60
          CMATCH    SLASH,DIM60
          IF        !@EQUAL
            MOVE      "Directory path must end with a slash (/) ",ERORTEXT
            WRITE     LOGFILE,SEQ;ERORTEXT
            DISPLAY   *P1:24,*EL,*B,*+,ERORTEXT;
            CALL      HITENTER
            GOTO      VALD9000
          ENDIF
          RESET     DIM60
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          APPEND    "cd ",CMDLINE
          APPEND    DIM60,CMDLINE
          APPEND    SP60,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID      * check if exists
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            MOVE      "Directory does not exist ",ERORTEXT
            WRITE     LOGFILE,SEQ;ERORTEXT
            DISPLAY   *P1:24,*EL,*B,*+,ERORTEXT;
            CALL      HITENTER
            GOTO      VALD9000
          ENDIF
          GOTO      VALD9999
.
VALD9000  MOVE      ONE,EXIT            * Not valid
.
VALD9999  RETURN
+
.**********************************************************************
.*                               ENDP0000                             *
.*        Remove or zip save file                                     *
.**********************************************************************
.
ENDP0000  MOVE      SP60,DIM60
          CLEAR     DIM60
          APPEND    OLDPATH,DIM60        * set up the saved file with path
          APPEND    "spatma1f*",DIM60
          APPEND    SP60,DIM60
          RESET     DIM60
          SQUEEZE   DIM60
.
          PACK      CMDLINE,SP60,SP60
          CLEAR     CMDLINE
          IF        SAVEFLG = 1
            APPEND    "gzip -f ",CMDLINE
            APPEND    DIM60,CMDLINE
            APPEND    SP60,CMDLINE
            RESET     CMDLINE
            DISPLAY   *P1:24,*EL,"Compressing original file.. ":
                      "Please wait !!  ";
          ELSE
            APPEND    "rm ",CMDLINE
            APPEND    DIM60,CMDLINE
            APPEND    SP60,CMDLINE
            RESET     CMDLINE
            DISPLAY   *P1:24,*EL,"Removing original file.. Please wait !!  ";
          ENDIF
          EXECUTE   CMDLINE,TASKID      * check if exists
.
          CMATCH    "0",TASKID
          IF        !@EQUAL
            MOVE      "Saved file not zipped or removed.  ",ERORTEXT
            WRITE     LOGFILE,SEQ;ERORTEXT
            DISPLAY   *P1:24,*EL,*B,*+,ERORTEXT;
            CALL      HITENTER
            GOTO      ENDP9999
          ENDIF
.
          CALL      IBACLOCK
          REP       " 0",CDATE
          REP       " 0",CTIMEIS
          DISPLAY   *P1:24,*EL,*B,"Finished processing  ",CDATE,SP1,CTIMEIS:
                    ".  ";
          CALL      HITENTER
.
          CALL      ELOG0000                     * write an end log entry
.
ENDP9999  RETURN
+
.**********************************************************************
.*        DEFT0000 -  Get the default directory                       *
.**********************************************************************
.
DEFT0000  EXECUTE   "ldat patma1af.dat > temp.txt",TASKID
.
          PACK      DEFPATH,SP30,SP30
          CLOSE     FINDFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      FINDFILE,"temp"
          TRAPCLR   IO
          BRANCH    OVRCD,DEFT3000
.
          READ      FINDFILE,SEQ;DEFPATH
          GOTO      DEFT3000 IF OVER
.
          ENDSET    DEFPATH
DEFT1000  CMATCH    "/",DEFPATH
          GOTO      DEFT2000 IF EQUAL
.
          BUMP      DEFPATH,-1
          GOTO      DEFT1000 IF NOT EOS
          GOTO      DEFT3000
.
DEFT2000  LENSET    DEFPATH
          RESET     DEFPATH
.
          PACK      DEFPATH,DEFPATH,SP30,SP30,SP30,SP30
          STRIP     DEFPATH
          ENDSET    DEFPATH
          RESET     DEFPATH
          CLOSE     FINDFILE
          MOVE      ZERO,EXIT
          GOTO      DEFT9999
.
DEFT3000  MOVE      "Error finding 'patma1af'.  ",ERORTEXT
          WRITE     LOGFILE,SEQ;ERORTEXT
          DISPLAY   *P1:24,*EL,*B,*+,ERORTEXT;
          CALL      HITENTER
          CLOSE     FINDFILE
          MOVE      ONE,EXIT
.
DEFT9999  RETURN
+
.*****************************************************************************
.*                            OLOG0000                                       *
.*                    Open the log file                                      *
.*****************************************************************************
.
OLOG0000  CALL      IBACLOCK
          REP       " 0",CDATE
          REP       " 0",CTIMEIS
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      LOGFILE,"v12ptma1.log"       * open log file
          TRAPCLR   IO
          IF        OVRCD = 1
            PREP      LOGFILE,"v12ptma1.log"     * create and open log file
            WRITE     LOGFILE,MINUS3;DASHLINE
            WRITE     LOGFILE,SEQ;CREATEXT,CDATE,SP1,CTIMEIS
          ELSE
            WRITE     LOGFILE,MINUS3;DASHLINE
            WRITE     LOGFILE,SEQ;OPENTEXT,CDATE,SP1,CTIMEIS
          ENDIF
.
OLOG9999  RETURN
+
.*****************************************************************************
.*                            CLOG0000                                       *
.*                    Close the log file                                     *
.*****************************************************************************
.
CLOG0000  CLOSE     LOGFILE
.
CLOG9999  RETURN
+
.*****************************************************************************
.*                            SLOG0000                                       *
.*                    Write a start log to the log file                      *
.*****************************************************************************
.
SLOG0000  WRITE     LOGFILE,SEQ;DASHLINE
          WRITE     LOGFILE,SEQ;STARTTXT,COPTION,RBRACK,SP1,CDATE,SP1:
                                   CTIMEIS
.
SLOG9999  RETURN
+
.*****************************************************************************
.*                            ELOG0000                                       *
.*                    Write an end log to the log file                       *
.*****************************************************************************
.
ELOG0000  WRITE     LOGFILE,SEQ;ENDGTEXT,COPTION,RBRACK,SP1,CDATE,SP1:
                                   CTIMEIS
ELOG9999  RETURN
+
.*****************************************************************************
.*                            OFIX0000                                       *
.*                    Oracle fix to "PATMA1FD"                               *
.*****************************************************************************
.
OFIX0000  DISPLAY   *P1:24,*EL;
          CALL      IBACLOCK
          REP       " 0",CDATE
          REP       " 0",CTIMEIS
          DISPLAY   *P1:18,"Started : ",CDATE,SP1,CTIMEIS:
                    *P1:20,*EL,"Record No. :";
.
          CALL      SLOG0000                      * write start to log file
.
          OPEN      PATMA1A1,"patma1af"
.
          PACK      KEY8,SP70
          CALL      RSPTMAS1                      * position at start of file
OFIX0500  CALL      RKPTMAS1                      * read next record
          BRANCH    OVRCD,OFIX9000                * eof - finished
.
          ADD       ONE,RECNUM                    * increment record counter
          ADD       ONE,DISNUM                    * Display counter
.         
          IF        DISNUM = 5000  | RECNUM = 1
            MOVE      ZERO,DISNUM 
            DISPLAY   *P15:20,*V2LON,RECNUM
          ENDIF
.
.>>>>>>>  Add code here to populate/update variables
.
          CALL      UPPTMAS1
.
          GOTO      OFIX0500                     * get next record
.         
OFIX9000  CLOSE     PATMA1A1
.
          CALL      IBACLOCK
          REP       " 0",CDATE
          REP       " 0",CTIMEIS
          DISPLAY   *P15:20,*V2LON,RECNUM,*HOFF:
                    *P1:22,"Update completed ",CDATE,SP1,CTIMEIS:
                    *P1:24;
          CALL      HITENTER
.
          CALL      ELOG0000                     * write an end log entry
.
OFIX9999  RETURN
.
OFDUMYIO  RETURN
+
.*****************************************************************************
.*        I/O Routines                                                       *
.*****************************************************************************
.
.                  ******************************    OLD IO ROUTINES
.                  Copy the Positional Read (RS or RDS) from original I/O file,
.                  - change Label to READSOLD and the index name to OLDFILE1
.
READSOLD  RESET     KEY8
          MOVE      ZERO,OVRCD
          READ      OLDFILE1,KEY8;;
          RETURN
.
.                  Copy the Read Next (RK or RDK) from the original I/O file
.                  - change Label to READKOLD and the index name to OLDFILE1
.                  - change any fields that are changing to a prefix of OLD,
.                    eg. PTEDSPAR becomes OLDDSPAR
.
READKOLD  MOVE      ZERO,OVRCD
          READKS    OLDFILE1;PURNO,PPORT,PCHGDTE,PTITL,PHOSP:
                                  PLDAYS,PBDEBT,PSNAME,PGNAME,PPSNAME:
                                  PADD1,PADD2,PSUBRB,PADD4,PPOST:
                                  PTELEP,PTELEB,PSEX,PMSTAT,PBDATE:
                                  PSAGE,PCONT,PREG,PTYPE:
                                  POCCUP,PLDDATE,PMEDI,PPENNO,PPNDTE:
                                  PREPAT,PSMOK,PSTAT,PMICRO,PCEASE:
                                  PCASE,PAUTOPY,PHIGH1,PHIGH2,PHIGH3:
                                  PLOCDOC,PFUNDH,PFNDTB,PTMASPAR,PUSR1:
                                  PUSR2,PUSR3,PUSR4,PUSR5,PUSR6:
                                  PUYN1,PUYN2,PUYN3,PYRRES,PNKNAME:
                                  PNKADD1,PNKADD2,PNKSUBR,PNKADD4,PNKPOST:
                                  PNKTELP,PNKTELB,PNKRELP,OPLSTINP,OPLSTOUT:
                                  PNXRAY,PFNDYY,PFNDCG,PDECDTE,PHCNOTES:
                                  PDIET,PINITHOS,PHKADUNI,PTMAEMPC,PTMANOKO:
                                  PTMANOKE,PTMADCNO,PTMAUKDB,PTMAUKDD:
                                  PFNDMM,PTMADCDT,PTMAHCP1,PTMAHCL1,PTMAHCG1:
                                  PTMAHCP2,PTMAHCL2,PTMAHCG2,PTMAHCP3,PTMAHCL3:
                                  PTMAHCG3,PTMAHCP4,PTMAHCL4,PTMAHCG4,PTMAHCP5:
                                  PTMAHCL5,PTMAHCG5,PTMASNAM,PTMADCUD,PTMADCUT:
                                  PTMADCUU,PTMAUUID,PTMAUTIM,OPTMASPA
          GOTO      OVERCOND IF OVER
          RETURN
.
.                  ******************************    NEW IO ROUTINES
.                  Copy the Write statement from the new I/O file           
.                  (no changes are needed to this routine)               
.
.                  For Oracle fixits, you will probably also need to copy
.                  the RS.., RK.... & UP.... I/O routines for the new FD.
.
RSPTMAS1  RESET     KEY8
          READ      PATMA1A1,KEY8;;
          RETURN
.
RKPTMAS1  MOVE      ZERO,OVRCD
          READKS    PATMA1A1;PURNO,PPORT,PCHGDTE,PTITL,PHOSP:
                                  PLDAYS,PBDEBT,PSNAME,PGNAME,PPSNAME:
                                  PADD1,PADD2,PSUBRB,PADD4,PPOST:
                                  PTELEP,PTELEB,PSEX,PMSTAT,PBDATE:
                                  PSAGE,PCONT,PREG,PTYPE:
                                  POCCUP,PLDDATE,PMEDI,PPENNO,PPNDTE:
                                  PREPAT,PSMOK,PSTAT,PMICRO,PCEASE:
                                  PCASE,PAUTOPY,PHIGH1,PHIGH2,PHIGH3:
                                  PLOCDOC,PFUNDH,PFNDTB,PTMASPAR,PUSR1:
                                  PUSR2,PUSR3,PUSR4,PUSR5,PUSR6:
                                  PUYN1,PUYN2,PUYN3,PYRRES,PNKNAME:
                                  PNKADD1,PNKADD2,PNKSUBR,PNKADD4,PNKPOST:
                                  PNKTELP,PNKTELB,PNKRELP,PLSTINP,PLSTOUT:
                                  PNXRAY,PFNDYY,PFNDCG,PDECDTE,PHCNOTES:
                                  PDIET,PINITHOS,PHKADUNI,PTMAEMPC,PTMANOKO:
                                  PTMANOKE,PTMADCNO,PTMAUKDB,PTMAUKDD:
                                  PFNDMM,PTMADCDT,PTMAHCP1,PTMAHCL1,PTMAHCG1:
                                  PTMAHCP2,PTMAHCL2,PTMAHCG2,PTMAHCP3,PTMAHCL3:
                                  PTMAHCG3,PTMAHCP4,PTMAHCL4,PTMAHCG4,PTMAHCP5:
                                  PTMAHCL5,PTMAHCG5,PTMASNAM,PTMADCUD,PTMADCUT:
                                  PTMADCUU,PTMAUUID,PTMAUTIM,PTMASPA2
.
          GOTO      OVERCOND IF OVER
.
          RETURN
.
UPPTMAS1  MOVE      ZERO,OVRCD
.
          UPDATE    PATMA1A1;PURNO,PPORT,PCHGDTE,PTITL,PHOSP:
                             PLDAYS,PBDEBT,PSNAME,PGNAME,PPSNAME:
                             PADD1,PADD2,PSUBRB,PADD4,PPOST:
                             PTELEP,PTELEB,PSEX,PMSTAT,PBDATE:
                             PSAGE,PCONT,PREG,PTYPE:
                             POCCUP,PLDDATE,PMEDI,PPENNO,PPNDTE:
                             PREPAT,PSMOK,PSTAT,PMICRO,PCEASE:
                             PCASE,PAUTOPY,PHIGH1,PHIGH2,PHIGH3:
                             PLOCDOC,PFUNDH,PFNDTB,PTMASPAR,PUSR1:
                             PUSR2,PUSR3,PUSR4,PUSR5,PUSR6:
                             PUYN1,PUYN2,PUYN3,PYRRES,PNKNAME:
                             PNKADD1,PNKADD2,PNKSUBR,PNKADD4,PNKPOST:
                             PNKTELP,PNKTELB,PNKRELP,PLSTINP,PLSTOUT:
                             PNXRAY,PFNDYY,PFNDCG,PDECDTE,PHCNOTES:
                             PDIET,PINITHOS,PHKADUNI,PTMAEMPC,PTMANOKO:
                             PTMANOKE,PTMADCNO,PTMAUKDB,PTMAUKDD:
                             PFNDMM,PTMADCDT,PTMAHCP1,PTMAHCL1,PTMAHCG1:
                             PTMAHCP2,PTMAHCL2,PTMAHCG2,PTMAHCP3,PTMAHCL3:
                             PTMAHCG3,PTMAHCP4,PTMAHCL4,PTMAHCG4,PTMAHCP5:
                             PTMAHCL5,PTMAHCG5,PTMASNAM,PTMADCUD,PTMADCUT:
                             PTMADCUU,PTMAUUID,PTMAUTIM,PTMASPA2
.
          RETURN
.
WRMAST1   RESET     KEY8
          MOVE      ZERO,OVRCD
.
          WRITE     PATMA1A1,KEY8;KEY8,PPORT,PCHGDTE,PTITL,PHOSP:
                                  PLDAYS,PBDEBT,PSNAME,PGNAME,PPSNAME:
                                  PADD1,PADD2,PSUBRB,PADD4,PPOST:
                                  PTELEP,PTELEB,PSEX,PMSTAT,PBDATE:
                                  PSAGE,PCONT,PREG,PTYPE:
                                  POCCUP,PLDDATE,PMEDI,PPENNO,PPNDTE:
                                  PREPAT,PSMOK,PSTAT,PMICRO,PCEASE:
                                  PCASE,PAUTOPY,PHIGH1,PHIGH2,PHIGH3:
                                  PLOCDOC,PFUNDH,PFNDTB,PTMASPAR,PUSR1:
                                  PUSR2,PUSR3,PUSR4,PUSR5,PUSR6:
                                  PUYN1,PUYN2,PUYN3,PYRRES,PNKNAME:
                                  PNKADD1,PNKADD2,PNKSUBR,PNKADD4,PNKPOST:
                                  PNKTELP,PNKTELB,PNKRELP,PLSTINP,PLSTOUT:
                                  PNXRAY,PFNDYY,PFNDCG,PDECDTE,PHCNOTES:
                                  PDIET,PINITHOS,PHKADUNI,PTMAEMPC,PTMANOKO:
                                  PTMANOKE,PTMADCNO,PTMAUKDB,PTMAUKDD:
                                  PFNDMM,PTMADCDT,PTMAHCP1,PTMAHCL1,PTMAHCG1:
                                  PTMAHCP2,PTMAHCL2,PTMAHCG2,PTMAHCP3,PTMAHCL3:
                                  PTMAHCG3,PTMAHCP4,PTMAHCL4,PTMAHCG4,PTMAHCP5:
                                  PTMAHCL5,PTMAHCG5,PTMASNAM,PTMADCUD,PTMADCUT:
                                  PTMADCUU,PTMAUUID,PTMAUTIM,PTMASPA2
          RETURN
.
          INC       STD001IO

.----------------------------------------------------------------------
. Program       : COMWEB70
.
. Function      : Patient Polling Server
.
. Modifications :
.
.------------------------------------------------------------------------------
. V12.00.08 10/10/2025  J.Tan          TSK 0946593
.           Recompiled for PATCATBI - Sort Casepayment Theatre fee items
. V12.00.07 06/10/2025  J.Tan          TSK 0966784
.           Recompiled for PATCATAI - Fixed printing ICD10 on reprint
. V12.00.06 30/09/2025  Thanh T        TSK 0937505
.           Recompiled for PATINVHL changes
. V12.00.05 27/08/2025  Alina Bhari      TSK 0954453
.           Recompiled for PRIINVHL - Added Patient Name
. V12.00.04 17/07/2025  J.Tan          TSK 0961277
.           Recompiled for PATCATBI - Check if Accom.has been incl.in Pat.inv.
.           22/07/2025  J.Tan          TSK 0963587
.           Recompiled for PINCATBI - Check if patient is discharged & invoiced
. V12.00.03 17/07/2025  J.Tan          TSK 0961277
.           Recompiled for PATCATBI - Check if Accom.has been incl.in Pat.inv.
.           22/07/2025  J.Tan          TSK 0963587
.           Recompiled for PINCATBI - Check if patient is discharged & invoiced
. V12.00.02 23/06/2025  J.Tan          TSK 0961589
.           Recompiled for PATCATBI - Fixed invoice rebate with zero MV hours
.           01/07/2025  J.Tan          TSK 0960457
.           Recompiled for PATCATBI-print inv.on first date of Findate
. V12.00.01 15/05/2025 Nikitha B         TSK 0955096                      
.           Alphanumeric changes                                      
. V11.05.08 14/04/2025  Davin            TSK 0951723
.           Recompiled for WEBGROUP - send 'I' procedures to grouper
. V11.05.07 27/03/2025  Davin            TSK 0956210
.           Recompiled for WEBGROUP - DRG Version 12.0
. V11.05.06 07/03/2025  Ebon Clements    TSK 0944729
.           Recompiled for WEBGROUP - Load Codefinder QLD complication prefix
. V11.05.05 03/03/2025  J.Tan            TSK 0957678
.          Mod to set tempfile name for FNAMEQ
. V11.05.04 24/02/2025  J.Tan            TSK 0946490
.           Recompiled for PATCATBI - Changes for MV CWO Payment Model
. V11.05.03 04/02/2025  Peter Vela       TSK 0939466
.           Recompiled for PRIINVPR - Added Distance In kms
.           Eclipse WebServices DVAW
.           04/02/2025  Ebon Clements    TSK 0951861
.           Recompiled for WEBGROUP - Added OPRTSMFD
. V11.05.02 26/11/2024  J.Tan          TSK 0946342
.           Mod to process Transaction Type=018
. V11.05.01 15/11/2024  Davin            TSK 0950787
.           Recompiled for WEBGROUP - Send CTYPE Tag to Codefinder (MRCNSCTC)
. V11.04.17 07/11/2024 Thanh T          TSK 0946085
.           Added RCCNSTRF field - Display Statement Reference
. V11.04.16 25/10/2024 J.Tan             TSK 0951578
.           Recompiled for ABFPTINV-Added Min.to roundup ICU Hrs(ABF)
. V11.04.15 18/10/2024  Davin            TSK 0922271
.           Recompiled for WEBGROUP - allow grouper to handle up to 100 codes
. V11.04.14 04/10/2024  J.Tan          TSK 0951441
.           Recompiled for PATCATBI - Charging AddOn for NoPayDay
. V11.04.13 23/09/2024  J.Tan          TSK 0949848
.           Recompiled for ABFPTINV - DRG List used in for COVID Adjustor
. V11.04.12 20/09/2024 J.Tan           TSK 0950577
.           Recompiled for PATIPERH - Fixed issue with Hold Invoice audit
. V11.04.11 11/09/2024  J.Tan          TSK 0947315
.           Recompiled for ABFPTINV - fixed Total Unqualified
. V11.04.10 01/08/2024  J.Tan          TSK 0947804
.           Recompiled for ABFMHINV - Changes for Discharges after 1/7/2023 
. V11.04.09 17/07/2024  J.Tan          TSK 0947315
.           Recompiled for ABFPTINV (LOS ICU adjusted & unqualified Newborn)
. V11.04.08 09/07/2024  J.Tan            TSK 0934944
.           Mod to check Referral Provider no from a linked Practice
. V11.04.07 05/07/2024  Ebon Clements  TSK 0948817
.           Recompiled for WEBGROUP - CGS/Codefinder Separation mode
. V11.04.06 17/06/2024  PJ Le Febour   TSK 0937495
.           Recompiled for WEBGROUP - get DCLs from new position in grouper v11
. V11.04.05 13/03/2024  J.Tan          TSK 0919335
.           Recompiled for HF history
. V11.04.04 22/02/2024  Ebon Clements  TSK 0943354
.           Recompiled for WEBGROUP - TG export separation mode
. V11.04.03 29/01/2024  Jacob Jackson  TSK 0919335
.           Add HF History includes
. V11.04.02 29/01/2024  Jacob Jackson  TSK 0919335
.           Add new local variable and recompile for GETTFEES
.           25/01/2024  Davin          TSK 0928468
.           Recompiled for WEBGROUP - Added AMHCC Grouper
. V11.04.01 09/01/2024 Thanh T         TSK 0936263             
.           Added CLPMSQPX to clear pmsqpxaf table variables
.------------------------------------------------------------------------------
. V11.03.17 17/11/2023  J.Tan          TSK 0940089
.           Recompiled for ABFPTINV - checking for blank Disc.DRG
. V11.03.16 13/11/2023  J.Tan          TSK 0939019
.           Recompiled for ABFPTINV - HAC ICD10 Edition 12
. V11.03.15 08/11/2023  Nikitha B      TSK 0927699c
.           Read CAPPRVNO and PTCNHABN for Hospital Approval and ABN number.
. V11.03.14 04/10/2023  Nikitha B     TSK 0927699
.           Recomplied for PATINVHL, PATINVTL - Stationary variables
. V11.03.13 04/10/2023  J.Tan          TASK 0938230
.           Recompiled for ABFAECCL - Emergency ABF
. V11.03.12 26/09/2023  Ebon Clements  TSK 0934837
.           Recompiled for WEBGROUP - Load Codefinder default clinician
. V11.03.11 04/09/2023  Ebon Clements  TSK 0936661
.           Recompiled for WEBGROUP - TurboGrouper QLD condition onset type
. V11.03.10 29/08/2023  J.Tan          TSK 0916870
.           Recompiled for ABFPTINV - Claim code Cat CL Multiple NEP value
. V11.03.09 21/08/2023  Davin          TSK 0935074
.           Recompiled for WEBGROUP - loading operation codes from codefinder
. V11.03.08 28/07/2023  Ebon Clements  TSK 0935527
.           Recompiled for OPRQUEFD - Theatre booking hospital
. V11.03.07 05/07/2023  Ebon Clements  TSK 0934723
.           Recompiled for WEBGROUP - DRG 11 - 2 character separation mode
.           if discharged post DRG 11 go live
. V11.03.06 26/06/2023  Ebon Clements  TSK 0932535
.           Recompiled for WEBGROUP - DRG 11 - 2 character separation mode
. V11.03.05 15/06/2023  Bella Turco    TSK 0931756
.           Recompiled for PRTINVBD                                    
. V11.03.04 25/05/2023  J.Tan          TSK 0923703
.           Recompiled for ABF new calculations
. V11.03.03 09/05/2023 J.Tan           TSK 0911166
.           Recompiled for PATIPERH - Hold Invoice Audit
. V11.03.02 05/04/2023 Bella Turco     TSK 0911166
.           Recompiled for PATIPERH - Hold Invoice Audit
.           04/04/2023 J.Tan          TSK 0847250
.           Mod for Reprint PP invoice
. V11.03.01 23/12/2022  Davin          TSK 0926029
.           Recompiled for WEBGROUP - Use pateco code/desc for non-hosp ops
. V11.02.12 11/11/2022  J.Tan          TSK 0906597
.           Recompiled for ABFOTINV - Multidisciplinary clinic Cat CQ TCINDC2=M
. V11.02.11 10/10/2022  Peter Vela          0925622
.           Recompiled for PATINVS - Removed old Eclipse IHC from Inpatient
.           Invoicing
. V11.02.10 29/06/2022  J.Tan           TSK 0914045
.           Recompiled for NZPCATBI - check for next available Contract Funding
. V11.02.09 29/06/2022 J.Tan           TSK 0920712
.           Recompiled for ABFAECCL - I*D on emrvcdaf file
. V11.02.08 14/06/2022  Ebon Clements  TSK 0906596
.           Recompiled for WEBGROUP - Charlson score 
. V11.02.07 02/06/2022 Ebon Clements   TSK 0902519
.           Recompiled for WEBGROUP - Aboriginality to use cat VA indicator 4
. V11.02.06 02/05/2022 Ebon Clements   TSK 0888071
.           Update document flags to yes/no if document type exists - OBSV0000
. V11.02.05 21/04/2022  Davin          TSK 0917793
.           Recompiled for WEBGROUP - DRG Version 11.0
. V11.02.04 03/03/2022  J.Tan           TSK 0902652
.           Recompiled for OUTCATBI/AAECATBI - Patient Invoice new functionality
. V11.02.03 11/02/2022  Ebon Clements  TSK 0915238
.           Recompiled for WEBGROUP - TG export/import operation times
. V11.02.02 08/02/2022  Ebon Clements  TSK 0915238
.           Recompiled for WEBGROUP - TG operation times
.           10/02/2022  Thanh T        TSK 0905641
.           Recompiled as OUTHEDFD/OUTMA1FD/WATTR1FD changes
. V11.02.01 27/01/2022 Ebon Clements   TSK 0888071
.           Added report 16 - Clinical document update visit extension file
. V11.01.33 09/11/2021 J.Tan           TSK 0880410
.           Recompiled for PATIPERH - added Hospital and System
. V11.01.32 11/11/2021  J.Tan          TSK 0913621
.           Recompiled for ABFAEINV/ABFOTINV - Mod for Multiple NEP Values
. V11.01.31 19/11/2021  Ebon Clements TSK 0911383
.           Recompiled for WEBGROUP - CGS Condition onset flag for NWAU
. V11.01.30 18/11/2021  Ebon Clements  TSK 0911851
.           Recompiled for WEBGROUP - Codefinder/CGS - ICU NICU hrs
. V11.01.29 17/11/2021  Ebon Clements  TSK 0911414
.           Recompiled for WEBGROUP - Export additional fields to TG
. V11.01.28 28/10/2021 J.Tan           TSK 0913056
.           Recompiled for ABFAECCL-ADMFLAG and CCAR0000(Clinical Care)
. V11.01.27 13/10/2021 J.Tan    TSK 0905305
.           Recompiled for ABFAECCL - Adjustment type 068 & 069
. V11.01.26 29/09/2021  J.Tan          TSK 0901515
.           Recompiled for CMXMATRX-Added 4th,5th,6th CMBS & Prim.Proc to Matrix
. V11.01.25 14/09/2021  J.Tan          TSK 0906222
.           Recompiled for ABFPTINV - Mod for Multiple NEP Values
. V11.01.24 15/09/2021  Ebon Clements   TSK 0902389
.           Recompiled for WEBGROUP - Urgency of Admission
. V11.01.23 14/09/2021  Davin           TSK 0911277
.           Recompiled for PRTINVBD
. V11.01.22 14/09/2021  Ebon Clements   TSK 0897701
.           Recompiled for WEBGROUP - Gender
. V11.01.21 10/09/2021  Davin           TSK 0911277
.           Recompiled for PATINVTL - Changed field 20 length to 12.2
. V11.01.20 24/08/2021  J.Tan           TSK 0905305
.           Recompiled for AAECATBI - AE Care class (ABFAECCL)
.           31/08/2021  J.Tan           TSK 0910799
.           Recompiled for PRTINVBD - printing Referring ADF
. V11.01.19 24/08/2021  Davin           TSK 0897318
.           Recompiled for PATINVTL - added field 57(Adjustment Total)
.           25/08/2021  J.Tan           TSK 0903454
.           Recompiled for PATCATBI - Added claim code to LS/Daily for CACCFEE=4
. V11.01.18 20/08/2021  Ebon Clements   TSK 0909624
.           Recompiled for WEBGROUP - LOS
. V11.01.17 03/08/2021  J.Tan           TSK 0909724
.           Recompiled for PRTINVBD - SJOG invoice
. V11.01.16 13/07/2021  Ebon Clements   TSK 0902615
.           Recompiled for WEBGROUP - Not using NWAU test
. V11.01.15 07/07/2021  J.Tan           TSK 0908588
.           Recompiled for PATCATBI - Exclude Unqualified days for Casepayment
. V11.01.14 07/07/2021  Ebon Clements  TSK 0908708
.           Recompiled for WEBGROUP - ICU Hours
. V11.01.13 06/07/2021  Ebon Clements  TSK 0908709
.           Recompiled for WEBGROUP - Use cat S admission mode
. V11.01.12 30/06/2021  Ebon Clements  TSK 0902615
.           Recompiled for WEBGROUP - Export Care Type to TG
. V11.01.11 30/06/2021  Ebon Clements  TSK 0902615
.           Recompiled for WEBGROUP - Don't restrict codes for NWAU
. V11.01.10 29/06/2021  Ebon Clements  TSK 0902615
.           Recompiled for WEBGROUP - NWAU unix grouper changes
. V11.01.09 22/06/2021  Ebon Clements  TSK 0907810
.           Recompiled for WEBGROUP - Contract care type flag
. V11.01.08 18/06/2021  Ebon Clements  TSK 0902615
.           Recompiled for WEBGROUP - NWAU unix grouper changes
. V11.01.07 16/06/2021  Peter Vela     TSK 0907637
.           Recompiled for PATINVS - Added parameter check for WebServices
.           IBAWEB04 Raise and Claim
. V11.01.06 05/05/2021  Ebon Clements  TSK 0902615
.           Added read of NWAU parameters MRCNUNWA and MRCNENWA
. V11.01.05 27/04/2021  J.Tan           TSK 0863287
.           Recompiled for PATCATBI - Mod for Patient Invoice new functionality
.           28/04/2021  Thanh T        TSK 0895165
.           Recompiled for OPRARDFD changes
. V11.01.04 01/04/2021  Peter Vela     Task 0902857
.           Recompiled for WEBIHCFD - Added Index 8
.           07/04/2021  Tracey Nguyen   TSK 0901515
.           Recompiled for PMSCMTFD - Added new fields
.           a) 1 File type for ICD procedure (PMCCIPF)
.           b) 3 new CMBS Field Type (PMCCFTS4/PMCCFT5C/PMCCFT6C)
.           c) 3 new CMBS Codes From (PMCCPC4F,PMCCSC5F,PMCCTC6F)
.           d) 3 new CMBS Codes To   (PMCCPC4T/PMCCSC5T,PMCCTC6T)
. V11.01.03 23/03/2021  Peter Vela     Task 0902857
.           Recompiled for PATINVS - WebServices IHCW
. V11.01.02 11/03/2021  Tracey Nguyen   TSK 0901515                          
.           Recompiled for PMSCMTFD - Added Primary ICD Procedure 1-5        
.           (PMCCICP1-5)                                                     
. V11.01.01 22/02/2021  Peter Vela     Task 0902857
.           Recompiled for PATINVS - WebServices IHCW
.------------------------------------------------------------------------------
. V11.00.26 19/01/2021  J.Tan          TSK 0883075
.           Recompiled for PRTINVBD - mod to print ADF address line on invoice
. V11.00.25 08/10/2020  Ebon Clements  TSK 0892694
.           Recompiled for WEBGROUP - Export 6.2 DRG as 6.0x to TurboGrouper
. V11.00.24 09/12/2020  Thanh T        TSK 0872840
.           Recompiled as PMSPX2TM changes
. V11.00.23 08/10/2020  Ebon Clements  TSK 0892694
.           Recompiled for WEBGROUP - Send health fund defails to TG
. V11.00.22 10/11/2020  J.Tan           TSK 0899562
.           Recompiled for CMXMATRX - setup date for reading MBS item
. V11.00.21 22/10/2020  J.Tan           TSK 0898866
.           Recompiled for PATIPERH - on hold invoice(Contract for Eff.Adm.from)
. V11.00.20 14/10/2020  J.Tan          TSK 0894879
.           Recompiled for PRTINVBD - Print 30 item desc.for RCH Invoice layout
. V11.00.19 08/10/2020  Ebon Clements  TSK 0893634
.           Recompiled for WIESCALC - WIES27 Aboriginal and Torres Strait
.           Islander loading
. V11.00.18 29/09/2020  J.Tan          TSK 0896829
.           Recompiled for CMXMATRX - use National(PTPGNDRG)instead of State DRG
. V11.00.17 23/09/2020  Ebon Clements  TSK 0893634
.           Recompiled for WIESCALC - Added WIES27 for 2020/2021
. V11.00.16 22/09/2020  J.Tan           TSK 0895330
.           Recompiled for CMXMATRX - reposition read of Matrix table
. V11.00.15 20/07/2020  J.Tan           TSK 0892319
.           Recompiled for ABFPTINV - Additional NEP and Psych.Adjus.changes
. V11.00.14 14/07/2020  J.Tan          TSK 0892902
.           Recompiled for PATCATBI - Mod to initialise CASMXKEY
. V11.00.13 10/07/2020  Ebon Clements   TSK 0894249
.           Recompiled for WEBGROUP - TurboGrouper load DRG version 10
. V11.00.12 08/07/2020  Ebon Clements   TSK 0894249
.           Recompiled for WEBGROUP - TurboGrouper load DRG versions
.           08/07/2020  J.Tan           TSK 0886178
.           Recompiled for WEBGROUP - automate calculate Charles scores
. V11.00.11 01/07/2020  J.Tan           TSK 0892765
.           Recompiled for PATCATBI - Low outlier exclude unqualified days
.           05/07/2020  J.Tan           TSK 0892746
.           Recompiled for ABFPTINV - CALCAGE as at Admission date
. V11.00.10 29/06/2020  J.Tan           TSK 0893767
.           Recompiled for ABFPTINV - Changed CALCFLAG to 01/01/2021  *
. V11.00.09 20/04/2020 J.Tan           TSK 0890733
.           Recompiled for ABFPTINV - ABF new 2020 calculation
. V11.00.08 15/06/2020  J.Tan          TSK 0886178
.           Mod to update GST Unknown file for Outpat and Emergency (DGTU0000)
. V11.00.07 25/05/2020  Davin          TSK 0890603
.           Recompiled for WEBGROUP/WIESCALC - WIES for private facility
. V11.00.06 15/05/2020  Ebon Clements  TSK 0891590
.           Recompiled for WEBGROUP - TurboGrouper DRG version 6.2
. V11.00.05 07/05/2020  J.Tan            TSK 0891341
.           Recompiled for ABFOTINV - added TRAP to write pmsabfaf
. V11.00.04 08/04/2020 J.Tan           TSK 0868813
.           Recompiled for PATINVHL
. V11.00.03 01/04/2020  J.Tan             TSK 0868813
.           Changed PKNAME to DIM80
. V11.00.02 31/03/2020  Ebon Clements  TSK 0889596
.           Recompiled for WEBGROUP - Call mrtweb02.us7 for TG import
. V11.00.01 12/03/2020  J.Tan          TSK 0838262
.           Removed PATITMVD 
. V10.15.07 19/02/2020  J.Tan          TSK 0888623
.           Removed BACKDATE in INVPN000
. V10.15.06 17/02/2020  Davin          TSK 0881493
.           Recompiled for WEBGROUP - restrict diag codes to grouper
. V10.15.05 18/12/2019  Ebon Clements    TSK 0885679
.           Set PASSCODE for printing PR script calls
. V10.15.04 12/11/2019  Nicole Torrisi   TSK 0881409
.           Recompiled for WEBGROUP - Added HMV
. V10.15.03 11/10/2019  Peter Vela       TSK 0882906
.           Recompiled for OUTCATBI - Fixed I*C for OUTBB1 ABF
. V10.15.02 09/10/2019  Ebon Clements  TSK 0877429
.           Added channel and job to TurbGrouper import/export file
. V10.15.01 09/10/2019  Thanh T        TSK 0860841
.           Removed CALCCODE.INC since it is not used
.------------------------------------------------------------------------------
. V10.14.18 03/10/2019  Thanh T        TSK 0882260
.           Recompiled for WEBGRPVA - DRG Version 11.0
. V10.14.17 02/10/2019  Ebon Clements  TSK 0877430
.           Populate TurboGrouper coded by user date and time
. V10.14.16 30/09/2019  Ebon Clements  TSK 0877428
.           Populate TurboGrouper campus code      
. V10.14.15 09/09/2019  J.Tan          TSK 0857392
.           Recompiled for ABF invoice
. V10.14.14 26/08/2019  Davin          TSK 0880255
.           Recompiled for WIESCALC - Added WIES26 for 2019/2020
. V10.14.13 05/08/2019  J.Tan           TSK 0857392
.           Recompiled for ABF Admitted invoice
. V10.14.12 21/07/2019  J.Tan           TSK 0857392
.           Recompiled for ABF Admitted invoice
. V10.14.11 04/06/2019  Ebon Clements  TSK 0875790
.           Recompiled for WEBGROUP - TurboGrouper operation prefix
. V10.14.10 31/05/2019  Ebon Clements  TSK 0875696
.           Recompiled for WEBGROUP - TurboGrouper coder id
. V10.14.09 21/05/2019  Davin          TSK 0870480
.           Recompiled for WEBGROUP - Changed eccsraw codefinder tag
. V10.14.08 14/05/2019  Ebon Clements  TSK 0874778
.           Recompiled for WEBGROUP - TurboGrouper diagnosis codes
. V10.14.07 02/05/2019  Ebon Clements  TSK 0874135
.           Recompiled for WEBGROUP - TurboGrouper theatre date/time defaults
. V10.14.06 01/05/2019  Ebon Clements  TSK 0872200
.           Recompiled for WEBGROUP - Added TURBOSAV - Retain previous details
. V10.14.05 08/04/2019  Ebon Clements  TSK 0872901
.           Recompiled for WEBGROUP -  Auto Coding user id
. V10.14.04 27/03/2019  Ebon Clements  TSK 0872200
.           Recompiled for WEBGROUP -  Export leave days
. V10.14.03 04/03/2019  Ebon Clements  TSK 0870711
.           Recompiled for WEBGROUP - TurboGrouper
.           13/03/2019  Tracey Nguyen  TSK 0863060
.           Recompiled for PATVISTM - Added VISS6400 and VISS6500
. V10.14.02 27/02/2019  Richa Phogat   TSK 0870439
.           Recompiled for WEBGROUP - DRG Version 10.0
.           27/02/2019  Ken Bell       TSK 0869548
.           Recompiled for PATCLMTM - Added Diagnosis Codes for NZ template
. V10.14.01 25/02/2019  Ebon Clements  TSK 0870711
.           Recompiled for WEBGROUP - TurboGrouper
.------------------------------------------------------------------------------
. V10.13.09 24/01/2019  Ebon Clements  TSK 0869592
.           Recompiled for WEBGROUP - TurboGrouper
. V10.13.08 15/01/2019  Davin          TSK 0867068
.           Fixed read position of CMOPRT parameter (post-surgical op. type)
. V10.13.07 11/01/2019  Peter Vela     TSK 0867807
.           Recompiled for OUTCATBI
. V10.13.06 20/12/2018  Don Nguyen     TSK 0837732
.           Recompiled for WEBGROUP - Modified GODTM000 to get the first
.           matching MBS Item time values (if operation date exists).
. V10.13.05 01/11/2018  Davin          TSK 0852820
.           Recompiled for WEBGROUP - Use "TOTWT:" tag for nz wies
. V10.13.04 25/10/2018  Thanh T        TSK 0859743
.           Added CATECODE for OUTCATBI Changes
. V10.13.03 25/10/2018  Thanh T        TSK 0859743
.           Added open to OUTBOKA6 for OUTCATBI changes
. V10.13.02 06/09/2018  Richa Phogat   TSK 0862786
.           Recompiled for WEBGROUP - Removed bypass Morphology
. V10.13.01 21/08/2018  Davin          TSK 0860935
.           Recompiled for WIESCALC - Added WIES25 for 2018/2019
. V10.12.09 18/07/2018  J.Tan          TSK 0310703
.           Mod INVPN000 to check for pre-adm and cancelled admission
.           19/07/2018  J.Tan          TSK 0859911
.           Recompiled for PATCATBI - No Payday Add on charge
. V10.12.08 18/06/2018  Ebon Clements  TSK 0846868
.           Recompiled for PATINVS - Eclipse exclude claim type
. V10.12.07 05/06/2018  Ebon Clements  TSK 0845772
.           Recompiled for WEBGROUP - TurboGrouper diagnosis
. V10.12.06 04/05/2018  Ebon Clements  TSK 0845772
.           Recompiled for WEBGROUP - TurboGrouper
.           18/05/2018  Thanh T.       TSK 0851528
.           Recompiled for PATVISTM changed
. V10.12.05 11/05/2018  J.Tan          TSK 0856648
.           Added PMI Extension (pmspx2af) on Reprint Invoice
. V10.12.04 03/05/2018  Ebon Clements   TSK 0856094
.           Fixed DNA referral letter expiry - NATX0000
. V10.12.03 26/03/2018  Tracey Nguyen  TSK 0852793
.           Recompiled for WEBGROUP - DRG Version 9.0
. V10.12.02 28/02/2018  J.Tan          TSK 0852351
.           Recompiled for PATINVHL-fields 226 & 227(Program Code/Desc)
. V10.12.01 29/01/2018  Ania P           TSK 0851398
.           Recompiled for WEBGROUP
. V10.11.12 27/12/2017  Steve Armstrong  TSK 0850165
.           Recompiled for changes to DGCLICAC.
. V10.11.11 15/12/2017  Peter Vela       TSK 0847747
.           Recompiled for WEBGROUP
. V10.11.10 11/12/2017  Don Nguyen       TSK 0848767
.           Recompiled for WEBGROUP - Modified GDSPX300 to include ACT
. V10.11.09 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.08 27/09/2017  Davin            TSK 0845070
.           Recompiled for WEBGROUP - fixed codefinder tag BWIES
. V10.11.07 01/09/2017  J.Tan            TSK 0837479
.           Mod checking Consumption type
. V10.11.06 30/07/2017  Thanh T.         TSK 0821710
.           Removed PAYCMNTS.
. V10.11.05 15/08/2017  Davin            TSK 0842626
.           Recompiled for WIESCALC - Added WIES24 for 2017/2018
. V10.11.04 10/08/2017  Peter Vela     TSK 0837619
.           Recompiled for PATINVS
. V10.11.03 30/07/2017  Thanh T.         TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
. V10.11.02 27/07/2017  J.Tan            TSK 0842559
.           Recompiled for PATCATBI - CHKACCM0 to check for inv.number
. V10.11.01 14/07/2017  Thanh T.         TSK 0821710
.           Audit Amission/outpatient visit comments. PATMISTM changed.
.------------------------------------------------------------------------------
.     V10.10.14   03/07/2017  Richa Phogat   TSK 0817112
.                 Rollback changes done for task 0817112
.     V10.10.13   21/06/2017  Davin          TSK 0836775
.                 Recompiled for WEBGROUP - mental health legal status
.     V10.10.12   20/06/2017  Richa Phogat   TSK 0817112
.                 Added functionality to handle new IBPLTYPE record type:
.                 016 -Update outbooking fields by new Referral values(UPREF000)
.     V10.10.11   13/06/2017  J.Tan          TSK 0839991
.                 Recompiled for PATDBTYP 
.     V10.10.10   07/06/2017  Jill Parkinson TSK 0832750
.                 Recompiled for WIESCALC - R64Z issues
.     V10.10.09   01/06/2017  Don Nguyen     TSK 0838360
.                 Recompiled for WEBGROUP - Fixed RLTAGS00
.                 01/06/2017  Don Nguyen     TSK 0838196
.                 Added WCFINPFN & WCFOUTFN. Recompiled for WEBGROUP.
.     V10.10.08   25/05/2017  Jill Parkinson TSK 0832750
.                 Recompiled for WIESCALC - surgical DRG check
.     V10.10.07   17/05/2017  J.Tan          TSK 0310703
.                 Fixed INVPN0000 to check no of invoices printed
.     V10.10.06   16/05/2017  J.Tan          TSK 0310703
.                 Fixed INVPN0000 to check claim code CLMC0000 before CALCTBI
.     V10.10.05   28/04/2017  Davin          TSK 0836380     
.                 Recompiled for WEBGROUP
.     V10.10.04   11/04/2017  J.Tan          TSK 0836088
.                 Mod to get service doctor for Invoice items grouped by Doc.
.     V10.10.03   24/03/2017  J.Tan          TSK 0310703
.                 Mod INVPN000- to check claim codes ind12 and discharge status
.     V10.10.02   09/03/2017  J.Tan          TSK 0310703
.                 Mod INVPN000- to check claim codes ind12 for pending invoice
.     V10.10.01   25/01/2017  J.Tan          TSK 0832407
.                 Recompiled for PATCATBI- multi bed trans on sameday for MV
.     V10.09.05   18/01/2017  Jill Parkinson TSK 0831665
.                 Recompiled for WEBGROUP
.     V10.09.04   09/01/2017  Jill Parkinson TSK 0831665
.                 Recompiled for WEBGROUP
.     V10.09.03  20/12/2016  J.Tan          TSK 0323541
.                 Recompiled for PATCATBI - set PMMIAMTT for printing inv.
.     V10.09.02  13/12/2016  Jill Parkinson TSK 0817492
.                 Recompiled for WIESCALC - Added check for surgical procs
.     V10.09.01   17/11/2016  J.Tan          TSK 0317714
.                 Recompiled for PATCATBI - fixed MV Daycse (ptdtepsd)
.     V10.08.26   24/11/2016  Jill Parkinson TSK 0817492
.                 Recompiled for WIESCALC - Added check for surgical procs
.     V10.08.25   08/11/2016  Don Nguyen    TSK 0828544
.                 Recompiled for WEBGROUP - Modified RLTAGS00
.     V10.08.24   07/11/2016  Ebon Clements  TSK 0827937
.                 Recompiled for PATINVHL - Hospital approval number
.     V10.08.23   20/10/2016  J.Tan          TSK 0827903
.                 Recompiled for PRTELIGI - chk refund dep.for released rec.only
.     V10.08.22   05/10/2016  J.Tan          TSK 0826826
.                 Recompiled for PRTELIGI - checking for refund deposit
.     V10.08.21   06/10/2016  J.Tan         TSK 0826824
.                 Recompiled for CALCMVHR - MV Hours
.     V10.08.20   05/10/2016  Davin            TSK 0826104
.                 Recompiled for WEBGROUP - importing codefinder procedure date
.     V10.08.19   21/09/2016  J.Tan         TSK 0826370
.                 Recompiled for CMXMATRX - Chgd MCHGARR MCHGAMT array to F3
.     V10.08.18   15/09/2016  J.Tan         TSK 0298257
.                 Recompiled for PRTELIGI - Printing Sundary Misc.
.     V10.08.17   13/09/2016  J.Tan         TSK 0825673
.                 Recompiled for PRTELIGI - printing Sameday excess 
.     V10.08.16   09/09/2016  Steve Armstrong  TSK 0825587
.                 Added THS15M00 routine to trigger a theatre booking
.                 cancellation after the patient has been deceased.
.     V10.08.15   08/09/2016  J.Tan         TSK 0825719
.                 Recompiled for PATCATBI - fixed No payday Oper.date=Adate
.     V10.08.14   02/09/2016  Davin         TSK 0825157
.                 Recompiled for WIESCALC
.     V10.08.13   30/08/2016  Don Nguyen    TSK 0814947
.                 Recompiled for WEBGROUP - Modified COPRS000 to check PT0ODTMN
.     V10.08.12   26/08/2016  Don Nguyen    TSK 0312570
.                 Recompiled for CMXMATRX - Added check for PTCNDGED=1
.                 Added PMSEDGFD/IO and GETEFDRG
.     V10.08.11   17/08/2016  J.Tan         TSK 0808745
.                 Recompiled for PATCATBI - for NPDAYFLG=1
.                 22/08/2016  J.Tan         TSK 0822442
.                 Mods to set BDTEFLAG and BACKDATE to INVPN000
.     V10.08.10   20/07/2016  J.Tan         TSK 0819914
.                 Recompiled for PATCATBI - Non ICU MV Hours
.     V10.08.09   19/07/2016  Davin         TSK 0822753
.                 Recompiled for WIESCALC - Added WIES23 for 2016/2017
.     V10.08.08   10/07/2016  J.Tan         TSK 0822042
.                 Mods checking CFEETYP before opening pmsmteaf
.     V10.08.07   15/07/2016  J.Tan         TSK 0819914
.                 Recompiled for PATCATBI - Calculating non ICU MV hours
.     V10.08.06   20/06/2016  J.Tan         TSK 0820816
.                 Recompiled for PATCATBI - Fixed No payday for Daycase
.     V10.08.05   02/06/2016  J.Tan         TSK 0816651
.                 Recompiled for PATCATBI -Continuous Bill.to chk for Matrix
.     V10.08.04   27/04/2016  Ebon Clements   TSK 0813977
.                 Update referral renewal with the new expiry date - REFX0000
.     V10.08.03   27/04/2016  Don Nguyen      TSK 0815007
.                 Recompiled for WEBGROUP - Modified RDUNIX1 & RDCME1
.     V10.08.02   13/04/2016  Don Nguyen      TSK 0321353
.                 Recompiled for WEBGROUP - Modified WRENC000 to use GETDRG
.     V10.08.01   12/04/2016  Don Nguyen      TSK 0815007
.                 Recompiled for WEBGROUP - process "I10ECCSRAW:" & "HNIV:"
.----------------------------------------------------------------------
.     V10.07.10   09/03/2016  J.Tan           CAR 0319403
.                 Recompiled for PRTELIGI - printing Overnight/Daycase excess
.     V10.07.09   04/03/2016  J.Tan         CAR 290448
.                 Recompiled for PATCATBI - Mods for Addon with No Pay DAy
.                 07/03/2016  J.Tan           CAR 0814361
.                 Recompiled for PRTELIGI - Changed bed days variables
.     V10.07.08   16/02/2016  J.Tan           CAR 0310703
.                 Added ibapolaf.ibpltype=014 for checking invoice pending
.     V10.07.07   31/12/2015  Peter Vela      CAR 0807988
.                 Recompiled for PRTELIGI
.     V10.07.06   21/12/2015  J.Tan           CAR 0303942
.                 Recompiled for OTAEINVS- setup payment code
.     V10.07.05   04/12/2015  J.Tan           CAR 324305
.                 Recompiled for OTAEINVS- fixed deleting invoice pending
.     V10.07.04   30/10/2015  Don Nguyen      CAR 320394
.                 Recompiled for changes to WATTX1FD/IO
.     V10.07.03   29/10/2015  Ebon Clements   CAR 268970
.                 Change to use OUTCLIFD index 1 instead of index 2
.     V10.07.02   19/10/2015  Don Nguyen      CAR 316625
.                 Added ALLCASFD/IO and opened file
.     V10.07.01   12/10/2015  J.Tan           CAR 320522
.                 Recompiled for PRBILCMN
.----------------------------------------------------------------------
.     V10.06.14   01/09/2015  J.Tan           CAR 317216 
.                 Added options to schedule and print invoices
.     V10.06.13   14/08/2015  J.Tan           CAR 320073 
.                 Recompiled for PATCATAI - reprint invoice for unreleased cash
.     V10.06.12   13/08/2015  Don Nguyen      CAR 308621 
.                 Recompiled for PATVISTM - Added VISS6100
.     V10.06.11   07/08/2015  Davin           CAR 317002
.                 Recompiled for PRTINVBD - Print pmexname for ADF MO
.     V10.06.10   30/07/2015  Don Nguyen      CAR 318792
.                 Recompiled for WEBGROUP - Modified RLTAGS00 to use KEY200
.     V10.06.09   14/07/2015  J.Tan           CAR 317921
.                 Recompiled for PMSEXTTM - checking for inactive Insurance code
.     V10.06.08   23/06/2015  J.Tan           CAR 318039
.                 Recompiled for PRBILCMN - printing billing comments for EMR
.     V10.06.07   18/06/2015  Don Nguyen      CAR 314792
.                 Recompiled for WEBGROUP - Modified ENCDT000; output PTEDACDT
.     V10.06.06   11/06/2015  Patrick Adair   CAR 313223
.                 Recompiled for WEBGROUP - admission weight check
.     V10.06.05   29/05/2015  Ebon Clements   CAR 317094
.                 Recompiled for WEBGROUP - DRG 8
.     V10.06.04   25/06/2015  J.Tan           CAR 276452
.                 Added Pooling type 009 for Reprint invoice
.                 25/06/2015  J.Tan           CAR 294739
.                 Added Pooling type 010 for Print Billing statement
.     V10.06.03   10/04/2015  J.Tan           CAR 304813
.                 Added WIESCALC
.     V10.06.02   24/03/2015  Don Nguyen      CAR 314100
.                 Recompiled for WEBGROUP - modified output for mrtweb02.us1/us2
.     V10.06.01   12/03/2015  Steve Armstrong   CAR 314108  
.                 Removed definition of PTCGDATE as PATCGPFD is no
.                 longer in use
.----------------------------------------------------------------------
.     V10.05.05   20/02/2015  Ebon Clements   CAR 291413 
.                 Added type 008 - Update referral expiry date after OP
.                 appointment DNA
.     V10.05.04   14/11/2014  Ebon Clements   CAR 292656 
.                 Added link cancelled OP visit to a referral functionality
.     V10.05.03   16/10/2014  Ebon Clements   CAR 291413 
.                 Added type 007 - Upate an AH referral expiry date
.     V10.05.02   09/09/2014  Davin           CAR 296980
.                 Changes for WIES 21  -  Re-compile for WEBGROUP
.     V10.05.01   17/07/2014  Ebon Clements   CAR 251384
.                 Added transaction type 6 - Update OP booking tier 2 code
.----------------------------------------------------------------------
.     V10.04.04   03/07/2014  Ebon Clements   CAR 302036
.                 Recompiled for WEBGROUP - Urgency of admission tag
.     V10.04.03   07/04/2014  Peter Vela      CAR 286258
.                 Recompiled for PATMASTM
.     V10.04.02   21/03/2014  Steve Armstrong   CAR 298483
.                 Recompiled for changes to DGCLICOC
.     V10.04.01   13/03/2014  Don Nguyen       CAR 294888
.                 Recompiled for changes to WEBGROUP
.----------------------------------------------------------------------
.     V10.03.15   10/12/2013  Davin            CAR 295110
.                 Recompiled for changes to DGCLICCP
.     V10.03.14   14/11/2013  Steve Armstrong   CAR 294040
.                 Recompiled for changes to DGCLICCP
.     V10.03.13   14/10/2013  Don Nguyen       CAR 282453
.                 Recompiled for WEBGROUP
.     V10.03.12   09/10/2013  Don Nguyen       CAR 291522
.                 Modified GROUP000 so that it bails if no discharge record
.     V10.03.11   09/10/2013  Peter Vela       CAR 292070
.                 Recompiled for WEBGROUP
.     V10.03.10   04/10/2013  Peter Vela       CAR 284261
.                 Recompiled for PATWIS19 PATWIS20
.     V10.03.09   02/10/2013  Ania P           CAR 292081
.                 Recompiled for WEBGROUP
.     V10.03.08   09/09/2013  Ania P           CAR 290324
.                 Added DIM3 and recompiled for WEBGROUP
.     V10.03.07   10/09/2013  Steve Armstrong  CAR 291089
.                 Recompiled for changes to PMSQVIIO
.     V10.03.06   29/08/2013  Ania P           CAR 290324
.                 Added DIM3 and recompiled for WEBGROUP
.                 02/09/2013  Davin            CAR 290919
.                 Recompiled for PATWIS18/19/20
.     V10.03.05   07/08/2013  Davin            CAR 284960
.                 Changes for WIES 20  -  Re-compile for WEBGROUP
.     V10.03.04   18/07/2013  Steve Armstrong  CAR 268961
.                 Recompiled for changes to PMSQVIFD.
.     V10.03.03   13/05/2013  Davin            CAR 284669 HDP 2013 DRG 7.0
.                 Recompiled for WEBGROUP
.     V10.03.02   15/04/2013  Steve Armstrong  CAR 267329
.                 Added functionality to handle new ibapolaf record types:
.                  002 - Trigger HL7 message (W/L Cancel Booking)
.                  003 - Trigger HL7 message (O/P Cancel Booking)
.                  004 - Trigger HL7 message (Cancel Pre-admission)
.                  005 - Trigger Grouper for admission
.     V10.03.01   05/03/2013  Davin          CAR 268971
.                 Created new server - poll ibapolaf
.----------------------------------------------------------------------
.
          INC       IBAWEBDF
          INC       RSHWEBDF
          INC       STDHLPDF
          INC       WEBDATDF
.
          INC       TFILEVAR/INC
          INC       NZPSPRTD/INC
          INC       NZPEXTFD/INC
          INC       CHKDIGVR/INC
          INC       PABXVARS/INC
          INC       EMRSITFD/INC
          INC       EMRHISFD/INC
          INC       EMRVCDFD/INC
          INC       IBATMDFD/INC
          INC       IBAGEDFD/INC
          INC       IBAGSTFD/INC
          INC       PATCOMM/INC
          INC       VISXDCTD/INC
.
          INC       ACCDIAFD/INC    * AE Diagnosis
          INC       AAEDI1FD/INC
          INC       APSMASFD/INC
          INC       AAEDTRFD/INC
          INC       AAEDEBFD/INC
          INC       AAEDE1FD/INC
          INC       COMDEPFD/INC
          INC       COMPARTD/INC
          INC       COMPARFD/INC
          INC       EMRICDFD/INC    * AE Diagnosis Codes
          INC       PATAFEFD/INC
          INC       PATASDFD/INC
          INC       PATBFEFD/INC
          INC       NZPBFEFD/INC
          INC       NZPTFEFD/INC
          INC       NZPCFNFD/INC
          INC       MLTCFNFD/INC
          INC       MLTCF1FD/INC
          INC       NZPCMTFD/INC
          INC       NZPIBRFD/INC
          INC       NZPIVBFD/INC
          INC       NZPRBRFD/INC
          INC       NZPRVBFD/INC
          INC       NZPPFEFD/INC
          INC       NZPSPRFD/INC
          INC       NZPPICFD/INC
          INC       NZPRDTFD/INC
          INC       PATCFAFD/INC
          INC       PATCMCFD/INC
          INC       PATCMXFD/INC
          INC       PATCRAFD/INC
          INC       PATCURFD/INC
          INC       PATALWFD/INC
          INC       PATACHFD/INC
          INC       PMSBRQFD/INC
          INC       PMSCCDFD/INC
          INC       PATECMFD/INC            * Episode Morbidity Changes
          INC       PMSRESFD/INC
          INC       PMSABFFD/INC
          INC       PMSPWAFD/INC
          INC       PATCERFD/INC
          INC       PATCTFFD/INC
          INC       PMSCIDFD/INC
          INC       PMSTLEFD/INC
          INC       PATELGFD/INC
          INC       PATDGWFD/INC
          INC       PATDRGFD/INC
          INC       PATDTRFD/INC
          INC       PATECHFD/INC
          INC       PATEDSFD/INC
          INC       PATEDTFD/INC
          INC       PATEORFD/INC
          INC       PATFN2FD/INC
          INC       PATFX1FD/INC
          INC       PATFHIFD/INC
          INC       PATGTUFD/INC
          INC       PATHDFFD/INC
          INC       PATHLFFD/INC
          INC       PATHTRFD/INC
          INC       OUTHTRFD/INC
          INC       EMRHTRFD/INC
          INC       PATIPRFD/INC
          INC       PATIBLFD/INC
          INC       PATIN1FD/INC
          INC       PATINMFD/INC
          INC       PATINLFD/INC
          INC       PATINPFD/INC
          INC       PATIPEFD/INC
          INC       PATINVFD/INC
          INC       PATIOVFD/INC
          INC       PATIRNFD/INC
          INC       NZPIRNFD/INC
          INC       PATITMFD/INC
          INC       PATLDFFD/INC
          INC       PATLSDFD/INC
          INC       PATFACFD/INC
          INC       PATFEEFD/INC
          INC       PATFIGFD/INC
          INC       NZPFIGFD/INC
          INC       PATFINFD/INC
          INC       NZPFINFD/INC
          INC       PATFMOFD/INC
          INC       PMSEXTFD/INC
          INC       PMSEXTTD/INC
          INC       PMSCNOFD/INC
          INC       PMSFCIFD/INC
          INC       PMSECTFD/INC
          INC       PMSEVTFD/INC
          INC       PMSBBIFD/INC
          INC       PMSBIIFD/INC
          INC       PMSCTCFD/INC
          INC       PMSPRGFD/INC
          INC       PMSWX1FD/INC
          INC       PMSHATFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCLFD/INC
          INC       PATCHXFD/INC
          INC       PMSPX2TD/INC
          INC       PATMCHFD/INC
          INC       NZPMCHFD/INC
          INC       PMSPTDFD/INC
          INC       NZPMXCFD/INC
          INC       PATNHHFD/INC
          INC       PATNZRFD/INC
          INC       PATOVBFD/INC
          INC       PATPARFD/INC
          INC       PATRATFD/INC
          INC       PATRBLFD/INC
          INC       PATRFNFD/INC
          INC       PATRFGFD/INC
          INC       NZPRFNFD/INC
          INC       PATSCFFD/INC
          INC       PATSGCFD/INC
          INC       PATSRBFD/INC
          INC       PATTFEFD/INC
          INC       PATRCAUD/INC
          INC       PATREMFD/INC
          INC       PATVADFD/INC
          INC       PATVENFD/INC
          INC       PATDADFD/INC
          INC       PATJRNFD/INC
          INC       PATWC1FD/INC
          INC       PATWMAFD/INC
          INC       PATWVEFD/INC
          INC       PMSSINFD/INC
          INC       PMSCMTFD/INC
          INC       PATCMTFD/INC
          INC       OBSPCOFD/INC
          INC       OPRARDFD/INC
          INC       OPRPMBFD/INC
          INC       OPRDEAFD/INC
          INC       OPRDECFD/INC
          INC       OPRSESFD/INC
          INC       OPRSRGFD/INC
          INC       OPRTSMFD/INC
          INC       OUTDTRFD/INC
          INC       OUTCLIFD/INC
          INC       OUTCTYFD/INC
.         INC       RCPCONFD/INC
          INC       RCPBNKFD/INC
          INC       RCPREGFD/INC
          INC       RCPBDTFD/INC
          INC       RCPDTEFD/INC
          INC       RCPCRSFD/INC
          INC       RESLNKFD/INC
          INC       MAMMASFD/INC
          INC       VISCMTFD/INC
          INC       VISMDTFD/INC
          INC       VISXDCFD/INC
          INC       PRIITMFD/INC
          INC       PATSTAFD/INC
          INC       PATAA1FD/INC
          INC       PMSSGAFD/INC
          INC       PMSICMFD/INC
          INC       PATFAPFD/INC
          INC       PATPFAFD/INC
          INC       PATRGMFD/INC
          INC       PATONHFD/INC
.
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
          INC       VARGBCRN/INC     * I-48227
          INC       VISPAYFD/INC
          INC       VISPAYTD/INC
          INC       VISPMAFD/INC
          INC       VISPMATD/INC
          INC       PMSMTIFD/INC
          INC       PMSMTEFD/INC
          INC       PMSMPRFD/INC
          INC       PMSPYRTD/INC
          INC       PMSPYRFD/INC
          INC       PMSPBRFD/INC
          INC       PMSIVBFD/INC
          INC       PMSIDEFD/INC
          INC       PMSREGFD/INC
.
          INC       PRIINVFD/INC
.
          INC       ALLCASFD/INC
          INC       ALLCONFD/INC
          INC       ALLENCFD/INC
          INC       ALLLNKFD/INC
          INC       ALLQUEFD/INC
          INC       ALLREFFD/INC
          INC       ALLRNWFD/INC
          INC       BOKRC1FD/INC
          INC       EMRCONFD/INC
          INC       EMRVISFD/INC
          INC       HL7CISFD/INC
          INC       HL7INBFD/INC
          INC       IBAPOLFD/INC
          INC       MEHDLSFD/INC
          INC       MEHHONFD/INC
          INC       MEHLERFD/INC
          INC       MRTCONFD/INC
          INC       MRTMASFD/INC
          INC       NHIETHFD/INC
          INC       NHIMASFD/INC
          INC       OPRCONFD/INC
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       OUTCANFD/INC
          INC       OUTCONFD/INC
          INC       OUTHEDFD/INC
          INC       OUTMA1FD/INC
          INC       OUTSESFD/INC
          INC       OUTRSHFD/INC
          INC       OUTSITFD/INC
          INC       PATALRFD/INC
          INC       PATASFFD/INC
          INC       PATCALAG/INC
          INC       PATCHCFD/INC
          INC       PATCMPFD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PMSVMTFD/INC
          INC       PATMASTD/INC
          INC       PATCONFD/INC
          INC       PATDO1FD/INC
          INC       PATDHEAD/INC
          INC       PATDSCFD/INC
          INC       PATECDFD/INC
          INC       PATECOFD/INC
          INC       PATFN1FD/INC
          INC       PATHSPFD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       PATICUFD/INC
          INC       PATMA1FD/INC
          INC       PATMI1FD/INC
          INC       PATMMBFD/INC
          INC       PATNIDFD/INC
          INC       PATONLFD/INC
          INC       PATPGRFD/INC
          INC       PATPR1FD/INC
          INC       PATRE1FD/INC
          INC       PATTRNFD/INC
          INC       PATVISFD/INC
          INC       PATW11FD/INC
          INC       PATW12FD/INC
          INC       PATW13FD/INC
          INC       PATW14FD/INC
          INC       PATW15FD/INC
          INC       PATW16FD/INC
          INC       PATW17FD/INC
          INC       PATW18FD/INC
          INC       PATW19FD/INC
          INC       PATW20FD/INC
          INC       PATW21FD/INC
          INC       PATWIEFD/INC
          INC       PATRDCFD/INC
          INC       PATWR1FD/INC
          INC       PMSHCPFD/INC
          INC       PMSPX2FD/INC
          INC       PMSQPTFD/INC
          INC       PMSVX1FD/INC
          INC       PTW12BFD/INC
          INC       VARWIS11/INC
          INC       VARWIS12/INC
          INC       VARWIS13/INC
          INC       VARWIS14/INC
          INC       VARWIS15/INC
          INC       VARWIS16/INC
          INC       VARWIS17/INC
          INC       VARWIS18/INC
          INC       VARWIS19/INC
          INC       VARWIS20/INC
          INC       VARWIS21/INC
          INC       VARWISCM/INC
          INC       WATCONFD/INC
          INC       WATTR1FD/INC
          INC       WATTX1FD/INC
          INC       WEBDINVS/INC
          INC       WEBGRPVA/INC
          INC       WEBIHCFD/INC
          INC       PMSEDGFD/INC       * Effective DRG Dates
          INC       PATDDHFD/INC
.
. ----- Program Variables -----
.
BULKBILL  DIM       1
.
CCENT1    DIM       2
CYEAR1    DIM       2
CMON1     DIM       2
CDAY1     DIM       2
.
CALDAYS   FORM      4
CASEKEYS  DIM       28
CFILEPRE  DIM       3
CMDLINE   DIM       227
CMPCNT    FORM      1
CATECODE  DIM       3
COD1CNT   FORM      3
COD9CNT   FORM      2
CODETYPE  DIM       1       * Type of code, O - operation
.                                           D - disease
CISMFLAG  FORM      1
COUNTER   FORM      3
CURRDATE  DIM       8       * Current date
CURRDAT1  FORM      8       * Current date
.
DAYCOL    FORM      2
DDRGCODE  DIM       4
DIM3      DIM       3
DIM4      DIM       4
DIM12A    DIM       12
DIM18     DIM       18
DIM18A    DIM       18
DIM20A    DIM       20
DIM30     DIM       30
DISCOUNT  FORM      3       * Diagnosis code counter
DISECODE  DIM       5
DISTYPE   DIM       1       * Disease type
.DMDCCODE  DIM       4
DOCTCODE  DIM       6
DRGCODE   DIM       3
DRGOUTFN  DIM       12
.DRGVER    DIM       3
DSSCODE   DIM       9       * Disease/operation code
.
ENCDSP    DIM       2
ENCFILEF  FILE      ASCII,FIXED=256
ENCODERF  DIM       1
ENCOUTAF  FILE      ASCII,FIXED=256
ENCOUTFN  DIM       12
EPSCD001  FORM      2
EXPRDATE  DATE      8
.
FILENAM1  DIM       8
FILENAM2  DIM       8
FILENAM3  DIM       8
FILENAM4  DIM       8
FORM8     FORM      8
.
IBAMFLAG  FORM      1
ICDCODE   DIM       9
.
LASTDIAG  FORM      3
LASTPROC  FORM      3
LINKVIST  DIM       8
LINKREFN  DIM       8
LOADCNT   FORM      3
LOADFILE  FILE      ASCII,FIXED=200
LOADNAME  DIM       8
.
MESSAGID  DIM       20
MDCCODE   DIM       3
.
NMPNUMB   DIM       20
NOOFCODE  FORM      2
.
OLDDTCOD  DIM       3       * Old tier 2 code 
OPERCLIN  DIM       10      * Operation Clinician Code
OPERDATE  DIM       8       * Operation date (CCYYMMDD)
OPERETME  DIM       5       * Operation finish time
OPERSTME  DIM       5       * Operation start time
OPERTYPE  DIM       1       * Operation type
OPRCODE   DIM       9       * Operation code
.
PROCCODE  DIM       7
.
RTDAYS    FORM      4
.
SAVTXWRD  DIM       3
SVEOCLIN  DIM       10      * Save field for Oper Clinician
.
EXCLMISC  DIM       1
TYPOFCOD  DIM       2
.
UPDTTYPE  DIM       1
.
WAHPDATE  FORM      1         * WA Health procedure date test
WDATE1    DIM       8
WDATE2    DIM       8
.
YESSADMP  DIM       1      * Adm Paperwork Received
YESSCONO  DIM       1      * Consent Obtained
YESSMEDH  DIM       1      * Medical History Received
.
.  The following vars for PATCATBI
.
MPGEFLAG  FORM      1
MTIFLAG   FORM      1
.
.   Work Variables
.
ADD       DIM       2
AMM       DIM       2
AYY       DIM       2
ACC       DIM       2
ACTION    DIM       1
ACCPORDN  DIM       20

CERTINDC  FORM      1
CMBSFEE   FORM      1
CURSESS   DIM       18
TFFSAMNT  FORM      12.2
TOTALFEE  FORM      12.2
.
DAYFORMT  DIM       4
DIM1A     DIM       1
DIM3A     DIM       3
DIM3B     DIM       3
DIM9      DIM       9
DIM14     DIM       14
DIM24A    DIM       24
DIM26A    DIM       26
DIM30A    DIM       30
.
FHDUDT1   DIM       8
FHDUDT2   DIM       8
FORM3A    FORM      3
FORM5     FORM      5
FORM52    FORM      5.2
.
FGSTFLAG  FORM      1
HJNL      DIM       2         * Journal type for discount
HDUDAY1   FORM      3                       * High Dependency
HDUDAY2   FORM      3
HL7ITMFL  DIM       1
HSTANDM   FORM      1        132      Which A&E being used
HFHIFUND  FORM      2
.
JOURFLAG  FORM      1
JOURTOT   FORM      6.2
KEY21A    DIM       21                      * required for PATINVS
KEY29A    DIM       29                      * required for PATINVS
KEYFLAG   FORM      1
.
LNO       FORM      2
LWCHG     FORM      6.2                     * Labour Ward Fee
LWDT      DIM       8
.
MBSDESC   DIM       40
MBSFLAG   FORM      1
MBS1      DIM       9
MBS2      DIM       9
MBS3      DIM       9
MBSDT1    DIM       8
MBSDT2    DIM       8
MBSDT3    DIM       8
MBSCH1    DIM       9
MBSCH2    DIM       9
MBSCH3    DIM       9
MTHNAM3A  DIM       3
PREVTRID  DIM      24
RACLINDC  DIM       1
SAVAMNT   FORM      12.2
SAVIND6   DIM       1
.
NJAN      INIT      "January"
NFEB      INIT      "February"
NMAR      INIT      "March"
NAPR      INIT      "April"
NMAY      INIT      "May"
NJUN      INIT      "June"
NJUL      INIT      "July"
NAUG      INIT      "August"
NSEP      INIT      "September"
NOCT      INIT      "October"
NNOV      INIT      "November"
NDEC      INIT      "December"
.
OPOCFLAG  FORM      1
OPERCODE  DIM       4
OPRDATE   DIM       8
OTCHG1    FORM      6.2
OTCHG2    FORM      6.2
OTDESC1   DIM       15
OTDESC2   DIM       15
OTDT1     DIM       8           * Other Items
OTDT2     DIM       8
.
RCCNSTRF  DIM       1        * Display Statement Reference
.
REGIST8   DIM       2
SAVBEND   FORM      3
SAVALLW   FORM      6.2
SAVDISC   FORM      6.2
SDATE     DIM       8
SERVDOCT  DIM       10
.
TFEEIND   FORM      1
THCFLG    FORM      2
THDUDT1   DIM       8
THDUDT2   DIM       8
THEACHG   FORM      6.2                     * Theatre Fee
THEADTE   DIM       8
.
UNIQUE    FORM      8
UPADMTYP  DIM       1
VISXDCIN  FORM      1
HOSPARAM  FORM      1       * Hospital parameters available (comparaf)
.
WARNINGL  DIM       20
WCFINPFN  DIM       22       * Web Codefinder input filename
WCFOUTFN  DIM       22       * Web Codefinder output filename
WORKDATE  DATE      8
.
XDESC     DIM       30
.
. ----- Variables for automatic admission type change / exploding charges -----
.
EFTADMIN  DIM       6                       * Effective admission number
EFTATYPE  DIM       3                       * Effective admission type
EFTDATE   DIM       8                       * Effective date (ccyymmdd)
EFTTIME   DIM       8                       * Effective time
EXPCHCNT  FORM      2                       * Exploding MBS charge counter
MBSCOUNT  FORM      2                       * MBS item counter
SAVKEY9   DIM       9
SAVKEY12  DIM       12
.
AECNCHRS  FORM      1
AECNFTYP  FORM      1        200      Type of A & E charging
AECNAEIH  DIM       6         40      AAE Invoice Header Code (templated)
AECNAEIT  DIM       6         46      AAE Invoice Tail Code (templated)
HINVDES   DIM       30       133      Description on top of inv. Epw only
HESYST    FORM      1
.
.   Constants
.
CODEA     INIT      "A "
CODEBT    INIT      "BT"
CATCR     INIT      "cr"
CODECL    INIT      "CL"
HDUFLG    FORM      "0"
LWCODE    INIT      "LW"
CATLWI    INIT      "wi"
MBSNUM    FORM      "0"
SP14      INIT      "              "
SURGFLG   FORM      "0"
SUMDAYS   FORM      4
.
OTCODE    INIT      "OT"
OTFLG     FORM      "0"
ZERO8     INIT      "0000    "              * needed by PATINVS
.
.
. ----- Program Constants -----
.
CATU1     INIT      "U1"
CATU2     INIT      "U2"
CATU3     INIT      "U3"
CATU4     INIT      "U4"
CATU5     INIT      "U5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATVI     INIT      "VI"
CBB       INIT      ")"
CODED     INIT      "D "
CODEDD    INIT      "DD"
CODEPY    INIT      "Py"
DRGINP    INIT      "drginp"
ENCERR01  INIT      "Backup at Key Word Prompt               "
ENCERR02  INIT      "Abort at Key Word Prompt                "
ENCERR03  INIT      "No Entry at Key Word Prompt             "
ENCERR04  INIT      "Next at Key Word Prompt                 "
ENCERR05  INIT      "Invalid File Format                     "
ENCERR06  INIT      "Bad Command or Command Unauthorised     "
ENCERR07  INIT      "Error Opening Interface Input File      "
ENCERR08  INIT      "Error Opening Interface Output File     "
ENCERR09  INIT      "Output File Already Exists              "
ENCERR10  INIT      "Invalid DRG / Fiscal Year               "
ENCERR12  INIT      "Invalid Codes Passed to Application     "
ENCERR34  INIT      "Not Authorised                          "
ENCERR37  INIT      "Invalid or No Age in Input File         "
ENCERR38  INIT      "Invalid or No Gender in Input File      "
ENCERR39  INIT      "Invalid or Not Integrated in Input File "
ENCERR40  INIT      "Invalid or No State in Input File       "
ENCERR41  INIT      "Invalid or No Payor in Input File       "
ENCERR42  INIT      "Invalid Discharge Date in Input File    "
ENCINP    INIT      "encinp"
OBB       INIT      "("
.
.----------------------------------------------------------------------
PRGID     INIT      "COMWEB70"
VERSION   INIT      "V12.00.08"
PRGNAM    INIT      "Patient Polling Server         "
.----------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
.
          CALL      INIT0000       * Open Files
.
MAIN0000  COMMIT                   * Match BEGIN in WEBINT00 for Transactions
.
          BEGIN
.
          DISPLAY   *W5
          PACK      KEY10,SP70
          CALL      RSIBPOL1
MAIN1000  CALL      RKIBPOL1
          BRANCH    OVRCD,MAIN0000
          MOVE      IBPLUNIQ,KEY10
          CALL      RLIBPOL1
          BRANCH    OVRCD,MAIN0000,MAIN1000
.
          MOVE      IBPLPSCD,PASSCODE       * Set passcode for PR script
.
          MOVE      IBPLTYPE,F3
          BRANCH    F3,MAIN1100:            * transaction type 1
                       MAIN1200:            * transaction type 2
                       MAIN1300:            * transaction type 3
                       MAIN1400:            * transaction type 4
                       MAIN1500:            * transaction type 5
                       MAIN1600:            * transaction type 6
                       MAIN1700:            * transaction type 7
                       MAIN1800:            * transaction type 8
                       MAIN1900:            * transaction type 9
                       MAIN2000:            * transaction type 10
                       MAIN2100:            * transaction type 11
                       MAIN2200:            * transaction type 12
                       MAIN2300:            * transaction type 13
                       MAIN2400:            * transaction type 14
                       MAIN2500:            * transaction type 15
                       MAIN2600:            * transaction type 16
                       MAIN2700:            * transaction type 17
                       MAIN2400             * transaction type 18
.
          GOTO      MAIN9000
.
MAIN1100  CALL      HL7VIS00                * Visit based HL7 Triggers for a UR
          GOTO      MAIN9000
.
MAIN1200  CALL      WLA38M00                * Trigger HL7 W/L A38 message
          GOTO      MAIN9000
.
MAIN1300  CALL      OPA38M00                * Trigger HL7 O/P A38 message
          GOTO      MAIN9000
.
MAIN1400  CALL      IPA27M00                * Trigger HL7 I/P A27 message
          GOTO      MAIN9000
.
MAIN1500  CALL      GROUP000                * Group an admission
          GOTO      MAIN9000
.
MAIN1600  CALL      TIER0000                * Update OP booking tier 2 code
          GOTO      MAIN9000
.
MAIN1700  CALL      REFX0000                * On OP attendance udpate AH 
          GOTO      MAIN9000                * referral expiry date if required
.
MAIN1800  CALL      NATX0000                * On OP DNA udpate AH 
          GOTO      MAIN9000                * referral expiry date if required
.
MAIN1900  CALL      RPINV000                * Reprint Invoice
          GOTO      MAIN9000                * referral expiry date if required
.
MAIN2000  CALL      PRTBS000                * Print Billing Statement
          GOTO      MAIN9000
.
MAIN2100  CALL      PIINV000                * Print Inpatient Invoice
          GOTO      MAIN9000
.
MAIN2200  CALL      POINV000                * Print Outpatient Invoice
          GOTO      MAIN9000
.
MAIN2300  CALL      PEINV000                * Print Emergency Invoice
          GOTO      MAIN9000
.
MAIN2400  CALL      INVPN000                * Check Invoice pending
          GOTO      MAIN9000
.
MAIN2500  CALL      THS15M00                * Trigger HL7 Theatre S15 message
          GOTO      MAIN9000
.
MAIN2600  CALL      OBSV0000                * Clinic document visit extension 
          GOTO      MAIN9000                * file update
.
MAIN2700  CALL      REPRPP00                * Reprint Private Practice Invoice
          GOTO      MAIN9000                * file update
.
MAIN9000  MOVE      IBPLUNIQ,KEY10
          CALL      DEIBPOL1
          PACK      KEY10,SP70
          CALL      RSIBPOL1
.
          COMMIT
.
          BEGIN
.
          GOTO      MAIN1000
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      IBAPRTA1,"ibaprtaf"        * For Printer Selection
          OPEN      IBACODE1,"ibacodef"        * For Printer Selection
          OPEN      IHAPASS1,"ihapassf"        * For Printer Selection
          OPEN      IBAPDFA1,"ibapdfaf"        * For default printer selection
          OPEN      IBASPOL1,"ibaspolf"
.
          OPEN      NHIMASA2,"nhimasaf"
.
          OPEN      PRIINVO1,"priinvof"
          OPEN      OBSPCOA1,"obspcoaf"
          OPEN      OPRDETA2,"oprdetaf"
          OPEN      OPRDETA3,"oprdetaf"
          OPEN      OPRSESA1,"oprsesaf"
          OPEN      OPRTSMA1,"oprtsmaf"
.
          OPEN      PATAFEA1,"patafeaf"
          OPEN      PATASDA1,"patasdaf"
          OPEN      PATBFEE1,"patbfeef"
          OPEN      NZPBFEA1,"nzpbfeaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCERA1,"patceraf"
          OPEN      PATCFAA1,"patcfaaf"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATCMCA1,"patcmcaf"
          OPEN      PATCMXA1,"patcmxaf"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATDSCH2,"patdschf"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATECMA1,"patecmaf"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATFX1A1,"patfx1af"
          OPEN      PATGTUA1,"patgtuaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PATLDFA1,"patldfaf"
          OPEN      PATLSDA1,"patlsdaf"
          OPEN      PATTRAN1,"pattranf"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PATDTRA1,"patdtraf"
          OPEN      PMSMTIA1,"pmsmtiaf"
          OPEN      PMSMTIA2,"pmsmtiaf"
          OPEN      PMSMTIA4,"pmsmtiaf"
          OPEN      IBAGSTA1,"ibagstaf"
          OPEN      PATDTRA3,"patdtraf"
          OPEN      PATDRGA1,"patdrgaf"
          OPEN      PATDRGA2,"patdrgaf"
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATMCHG4,"patmchgf"
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      PATINVR1,"patinvrf"
          OPEN      PATINVR5,"patinvrf"
          OPEN      PATINVR3,"patinvrf"
          OPEN      PATFEEP1,"patfeepf"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATTFEE1,"pattfeef"
          OPEN      OPRARDA1,"oprardaf"
          OPEN      OPRDETC1,"oprdetcf"
          OPEN      PATCTFA1,"patctfaf"
          OPEN      PATHLFA1,"pathlfaf"
          OPEN      PATHDFA1,"pathdfaf"
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATMI1A2,"patmi1af"
          OPEN      PATIN1A1,"patin1af"
          OPEN      PATFIGA1,"patfigaf"
          OPEN      PATFINS1,"patfinsf"
          OPEN      NZPFIGA1,"nzpfigaf"
          OPEN      NZPFINA1,"nzpfinaf"
          OPEN      PATIPEN1,"patipenf"
          OPEN      PATIRNG1,"patirnge"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATVADA1,"patvadaf"
          OPEN      PATDADA1,"patdadaf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATMMBS1,"patmmbsf"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PMSPX2A1,"pmspx2af"
.         OPEN      SCRMASA1,"scrmasaf"
          OPEN      PATWMAB1,"patwmabf"
          OPEN      PATWC1A1,"patwc1af"
          OPEN      PMSBBIA1,"pmsbbiaf"
          OPEN      PMSBIIA1,"pmsbiiaf"
          OPEN      PMSRESA1,"pmsresaf"
          OPEN      PMSEXTA1,"pmsextaf"
          OPEN      PMSWX1A1,"pmswx1af"
          OPEN      PATWVET1,"patwvetf"
          OPEN      VISCMTA1,"viscmtaf"
          OPEN      VISMDTA1,"vismdtaf"
          OPEN      VISPAYA1,"vispayaf"
          OPEN      VISPAYA2,"vispayaf"
          OPEN      VISPMAA1,"vispmaaf"
          OPEN      PMSCTCA1,"pmsctcaf"
          OPEN      COMDEPA1,"comdepaf"
          OPEN      RCPBDTA1,"rcpbdtaf"
          OPEN      RCPDTEA1,"rcpdteaf"
          OPEN      RCPDTEA6,"rcpdteaf"
          OPEN      RCPBNKA1,"rcpbnkaf"
          OPEN      PMSSGAA1,"pmssgaaf"
          OPEN      PATFACT1,"patfactf"
          OPEN      PATCFAA1,"patcfaaf"
          OPEN      PATFAPA1,"patfapaf"
          OPEN      PATPARA1,"patparaf"
          OPEN      PATPFAA1,"patpfaaf"
          OPEN      PMSCIDA1,"pmscidaf"
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      PATECDA1,"patecdaf"
          OPEN      PATECDA3,"patecdaf"
          OPEN      PATECDA5,"patecdaf"
          OPEN      PATECOA1,"patecoaf"
          OPEN      PATECOA3,"patecoaf"
          OPEN      PATASFA1,"patasfaf"
          OPEN      PMSICMA1,"pmsicmaf"
.
          OPEN      PMSREGA1,"pmsregaf"
          OPEN      PMSREGA4,"pmsregaf"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PATELGA1,"patelgaf"
          OPEN      PMSEVTA1,"pmsevtaf"
          OPEN      NZPSPRA1,"nzpspraf"
          OPEN      NZPSPRA2,"nzpspraf"
          OPEN      NZPPICA1,"nzppicaf"
.
          OPEN      EMRVCDA1,"emrvcdaf"
          OPEN      AAEDE1A1,"aaede1af"
          OPEN      AAEDTRE1,"aaedtref"
          OPEN      AAEDTRE3,"aaedtref"
          OPEN      AAEDI1A1,"aaedi1af"
          OPEN      ACCDIAA1,"accdiaaf"
          OPEN      EMRICDA1,"emricdaf"
.
          CALL      RDCNT000                       *Read control file
          IF        CFEETYP=9
            OPEN      PMSMTEA1,"pmsmteaf"
            OPEN      PMSMTEA4,"pmsmteaf"
          ENDIF
.
...  used in ABFAECCL
          CALL      TFILENAM                * Get file name calculating Exponent
          MOVE      TFILNAME,FNAMEN
.
...  used in PATCATBI CRMV0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEX
.
...  used in PATCATBI PTMP0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEZ
.
...  used in PATCATBI PT2P0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEY
.
...  used in NZPCATBI CRWL0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEQ
.
...  used in PABXBILL
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAME
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAM2
.
          MOVE      ONE,WEBFLAG
.
          OPEN      ALLLNKA1,"alllnkaf"
          OPEN      ALLLNKA2,"alllnkaf"
          OPEN      ALLREFA1,"allrefaf"
          OPEN      ALLRNWA1,"allrnwaf"
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      EMRVISA3,"emrvisaf"
          OPEN      IBAPOLA1,"ibapolaf"
          OPEN      OUTSITA1,"outsitaf"
          OPEN      PATASFA1,"patasfaf"
          OPEN      PATCHCO2,"patchcof"
          OPEN      PATCMPA1,"patcmpaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATECDA1,"patecdaf"
          OPEN      PATECDA2,"patecdaf"
          OPEN      PATECOA1,"patecoaf"
          OPEN      PATECOA2,"patecoaf"
          OPEN      PATECOA3,"patecoaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATICUA1,"paticuaf"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMI1A8,"patmi1af"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMMBS1,"patmmbsf"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PATPGRA1,"patpgraf"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATW16A1,"patw16af"
          OPEN      PATW17A1,"patw17af"
          OPEN      PATW18A1,"patw18af"
          OPEN      PATW19A1,"patw19af"
          OPEN      PATW20A1,"patw20af"
          OPEN      PATW21A1,"patw21af"
          OPEN      PATWIEA1,"patwieaf"
          OPEN      PATRDCA1,"patrdcaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      WATTR1A1,"wattr1af"
          OPEN      WATTX1A1,"wattx1af"
          OPEN      ALLCASA1,"allcasaf"
.
          CALL      OPICD1
          CALL      OPICO1
.
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,TEN;*36,CMDISD:       * disability disease type
                                 *37,CMOPRT:       * post-surgical op. type
                                 *79,CAPPRVNO:     * hospital approval number
                                 *235,CMDISP:      * primary disease prefix
                                 *236,CMDISS:      * sequela disease prefix
                                 *237,CMDISC:      * complication prefix
                                 *238,CMDISA       * associated disease prefix
          READ      CONTROLF,TWENTY1;*45,PTCNDRSM
          READ      CONTROLF,TWENTY1;*217,CMDISL   * prefix for LOS disease
          READ      CONTROLF,FIFTY9;*63,CFFMORB    * allow free format desc
          READ      CONTROLF,SIXTY;*133,MRCNEPSC:  * coding in single screen
                                   *147,MRCNSOMV:  * send MV Hrs to grouper
                                   *248,MRCN3MCD,*249,MRCN3MCG
.
          READ      CONTROLF,SIXTY1;*240,MRCNUNWA,*241,MRCNENWA
.
          READ      CONTROLF,SEVENTY7;*220,PTCNEDRG * proc. code to exclude
          READ      CONTROLF,SEVENTY9;*82,PTCNDSCI: * code for disch. intention
                                      *92,PTCNOENC: * using online encoder
                                      *119,PTCNEAPD * alloc. prim dis, prefix
          READ      CONTROLF,EIGHTY;*243,PTCNODRG: * using online grouper
                                    *250,PTCNHDPS  * hospital state for extracts
          READ      CONTROLF,EIGHTY8;*242,PNSWRACE * udf for race
          READ      CONTROLF,EIGHTY9;*221,EMCNGINV
          READ      CONTROLF,NINTY7;*145,MRCNGRUP: * type of grouper used
                                    *173,MRCNOPDT: * default operation date
                                    *174,MRCNCLIN: * display proc. clinician
                                    *178,MRCNRCDT: * reset coding date
                                    *245,MRCNDFPR: * Default Proceduralist
                                    *248,MRCNEACA,*251,MRCNSCTC
          READ      CONTROLF,HUND05;*104,PTCNDGET: * delete grpr/cdr temp files
                                    *147,CMDISM    * morphology disease prefix
          READ      CONTROLF,HUND06;*27,ALCNRAUD   * Using referral audit file
          READ      CONTROLF,HUND13;*50,OPCNCONS
          READ      CONTROLF,HUND24;*121,PTCNDGED,*123,PTCNEMDB
          READ      CONTROLF,HUND28;*239,PTCNE110
          READ      CONTROLF,HUND30;*1,PTCNHABN     * hospital ABN number
.
          MATCH     "1",ALCNRAUD
          IF        @EQUAL
            OPEN      ALLAUDRE,"allaudre"
          ENDIF
.
          MOVE      "out",CFILEPRE          * Save Current File Prefix
          CALL      OPNOUT00                * Open Outpatient Files
.
          MOVE      ZERO,VISXDCIN
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      VISXDCA1,"visxdcaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,VISXDCIN
          ENDIF
.
          MOVE      ZERO,HOSPARAM
          MOVE      ZERO,OVRCD              * Trap to check if comparaf exists
          TRAP      OVERCOND IF IO
          OPEN      COMPARA1,"comparaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,HOSPARAM
          ENDIF
.
INIT9999  RETURN
+
.------------------------------------------------------------
.   Read the control file for PATCATBI
.------------------------------------------------------------
RDCNT000  READ      CONTROLF,ZERO;*85,IBCNUGST
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TEN;*32,PTCNUBRD,*66,CINVLAY:
                                 *73,DD,MM,YY,*79,CAPPRVNO,*94,CAGECOFF:
                                 *104,PTCNMBSF,*166,CMEMB:             *C-47385
                                *183,CVIEWIP,*188,CCHKRAT,*192,CACCFEE:
                                *217,CAUDQ
          READ      CONTROLF,TEN3;CHADD1,CHADD2,CHPOST,CHPADD1,CHPADD2,CHPPOST:
                                  CHTELEB,*154,CUSEMBS,*163,BEDTYP:
                             *211,CINV1ST,*245,CHOSTYP
          READ      CONTROLF,TEN4;CNOCLMS,CINMES1,CINMES2:
                             *228,CINVFF,*245,CMAXINV
          READ      CONTROLF,TEN5;*189,CTHETR:
                                  *247,CSTDOWN
          READ      CONTROLF,TEN9;*212,CFEETYP,*216,CINVRIP:
                                  *219,CINVRAE
          READ      CONTROLF,TWENTY;*193,PTCNDCLM:
                                    *198,PTCNPIOP,PTCNBCUT,PTCNBDOM:
                                    *211,PTCNCNDY,*239,PTCNMXCH
          READ      CONTROLF,TWENTY1;*44,PTCNIDES:
                                    *51,PTCNINVL,*60,PTCNCCRR,PTCNCLOR:
                                    *120,PTCNADDC,*136,PTCNMITM,*138,PTCNNHII:
                                    *174,PTCNDONR,*178,PTCNMPTR:
                                    *190,PTCNPCON,*200,PTCNICRA,*235,PTCNDPL8:
                                    *237,PTCNPAOF
          READ      CONTROLF,THIRTY;*132,HSTANDM,HINVDES
          READ      CONTROLF,TWENTY;*164,PTRESDAY
          READ      CONTROLF,THIRTY2;*57,OTCNOTIH,*63,OTCNOTIT
          READ      CONTROLF,FIFTY9;*1,CDLSTEP,*23,CFUTINV,*25,CFUTCOM:
                                   *66,CGSTPERC,CGSTITEM
          READ      CONTROLF,SEVENTY9;*248,PTCNIPEN
          READ      CONTROLF,SEVENTY7;*214,PTCNBTNM:
                                      *240,PTCNAXEU
          READ      CONTROLF,SEVENTY8;*40,AECNAEIH,*46,AECNAEIT
          READ      CONTROLF,SEVENTY9;*68,PTCNMFEE,PTCNJFEE
          READ      CONTROLF,EIGHTY;*248,PTCNPEFR,*250,PTCNHDPS
          READ      CONTROLF,NINTY8;*127,PTCNPMIS:
                                    *130,PTCNAGST:
                                    *136,PTCNPAIH,*142,PTCNPAIT:
                                    *148,PTCNINVB
          READ      CONTROLF,HUND03;*220,PTCNDEES,*221,PTCNDDES
          READ      CONTROLF,HUND05;*99,PTCNNWCM:     * using matrix
                                    *130,PTCNAUAT:    * auto update adm.type
                                         PTCNWSPC:    * Warning for sub-seq item
                                    *177,PTCNTFEE:    * Using theatre fees
                                    *190,PTSGCOPT:    * Using suggested class.
                                    *195,PTCNLASR:
                                    *215,PTCNBINV:
                                    *226,PTCNPRWD:    * Print wrd/bed on inv.
                                    *235,PTCNQCCT:
                                    *247,PTCNCDIS
          READ      CONTROLF,HUND09;*238,PTCNPRIN     * Display zero invoice
          READ      CONTROLF,HUND10;*115,PTCNUEDI
          READ      CONTROLF,HUND12;*102,PTCNHITC,*103,PTCNHICC,*113,PTCNXCHS:
                                    *118,PTCNTRPR
          READ      CONTROLF,HUND14;*153,PTCNECLO,*249,PTCNDFUP
          READ      CONTROLF,HUND16;*209,PTCNADEP:
                                    *210,PTCNICLS:
                                    *219,PTCNCLEV:
                                    *222,PTCNXCOM,*226,PTCNGPHR

          READ      CONTROLF,HUND18;*165,PTCNPPRC,*166,PTCNPITM
          READ      CONTROLF,HUND29;*89,PTCNPPIN
.
          MATCH     "1",PTCNTRPR
          IF        @EQUAL
            OPEN      PMSPTDA1,"pmsptdaf"
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
            OPEN      MLTCFN11,"mltcf1af"
            OPEN      MLTCFNA1,"mltcfnaf"
            IF        PTCNNHII=ONE
              OPEN      NZPCFNA1,"nzpcfnaf"
            ENDIF
          ENDIF
.
RDCNT999  RETURN
+
.------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILBOKA1  * Get the name of the BOKA1 file
          CLOSE     OUTBOKA1
          OPEN      OUTBOKA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILBB1A1  * Get the name of the BB1A1 file
          CLOSE     OUTBB1A1
          OPEN      OUTBB1A1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILSESA1  * Get the name of the SESA1 file
          CLOSE     OUTSESA1
          OPEN      OUTSESA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILMA1A1
          CLOSE     OUTMA1A1
          OPEN      OUTMA1A1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILHEDA1
          CLOSE     OUTHEDA1
          OPEN      OUTHEDA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILDTRO1
          CLOSE     OUTDTRO1
          OPEN      OUTDTRO1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILCLIA1
          OPEN      OUTCLIA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILBOKA6
          CLOSE     OUTBOKA6
          OPEN      OUTBOKA6,CFNAME
.
OPNOUT99  RETURN
+
.------------------------------------------------------------
. Trigger Visit based HL7 messages for a UR (ibpltype = 1)
.------------------------------------------------------------
HL7VIS00  PACK      KEY17,IBPLURNO,SP70
          CALL      RSPTMI18
HL7VIS10  CALL      RKPTMI18                * check for inp adms & preadms
          BRANCH    OVRCD,HL7VIS50
.
          MATCH     IBPLURNO,AURNO
          GOTO      HL7VIS50 IF NOT EQUAL
.
          COMPARE   ONE,ASTAT
          IF        !@EQUAL
            COMPARE   TWO,ASTAT
            GOTO      HL7VIS50 IF NOT EQUAL
          ENDIF
.
          MOVE      DAADMNO,LINKVIST
          CALL      WA08A000           * Write A08 ADT message for the visit
          GOTO      HL7VIS10
.
HL7VIS50  PACK      KEY16,IBPLURNO,SP70
          CALL      RSEMVIS3
HL7VIS60  CALL      RKEMVIS3                * check for current emr visits
          BRANCH    OVRCD,HL7VIS99
.
          MATCH     IBPLURNO,EMVIURNO
          GOTO      HL7VIS99 IF NOT EQUAL
.
          COMPARE   ONE,EMVISTAT
          GOTO      HL7VIS60 IF NOT EQUAL
.
          MOVE      DEMVIADM,LINKVIST
          CALL      WA08E000           * Write A08 EMR message for the visit
          GOTO      HL7VIS60
.
HL7VIS99  RETURN
+
.------------------------------------------------------------
. Write A08 ADT message for the visit
.------------------------------------------------------------
WA08A000  PACK      KEY8,LINKVIST,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,WA08A999
.
          PACK      KEY8,AURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,WA08A999
.
          PACK      KEY8,AURNO,SP70
          CALL      RDPMPX21
          IF        OVRCD = 1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY8,LINKVIST,SP70
          CALL      RDVISA1
          IF        OVRCD=1
            CALL      CLPATVIS
          ENDIF
.
          PACK      KEY8,LINKVIST,SP70
          CALL      RDDSCH1
          IF        OVRCD=1
            CALL      CLPATDSC
          ENDIF
.
          PACK      KEY8,LINKVIST,SP70
          CALL      RDRESP1
          IF        OVRCD=1
            CALL      CLPATRE1
          ENDIF
.
          CALL      PMIGTNID            * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          IF        ASTAT = 1
            MOVE      ONE,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLICCP          * broadcast change Pre-admission
          ELSE
            PACK      KEY30,AADMNO,Z70
            CALL      RDSTRAN2                     * position in file
            CALL      RDPTRAN2                     * read previous record
            MATCH     AADMNO,TADMN                 * same admission still ?
            IF        @EQUAL
              MOVE      TWO,HL7TRGID
              MOVE      SP8,HL7INCLD
              PROC      DGCLICAC          * broadcast change admission
            ELSE
              CALL      CLPATTRN
            ENDIF
          ENDIF
.
WA08A999  RETURN
+
.------------------------------------------------------------
. Write A08 EMR message for the visit
.------------------------------------------------------------
WA08E000  PACK      KEY8,LINKVIST,SP70
          CALL      RDEMVIS1
          BRANCH    OVRCD,WA08E999
.
          PACK      KEY8,EMVIURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,WA08E999
.
          PACK      KEY8,EMVIURNO,SP70
          CALL      RDPMPX21
          IF        OVRCD = 1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY8,LINKVIST,SP70
          CALL      RDVISA1
          IF        OVRCD=1
            CALL      CLPATVIS
          ENDIF
.
          PACK      KEY8,LINKVIST,SP70
          CALL      RDPMVX11
          IF        OVRCD=1
            CALL      CLPMSVX1
          ENDIF
.
          PACK      KEY8,LINKVIST,SP70
          CALL      RDDSCH1
          IF        OVRCD=1
            CALL      CLPATDSC
          ENDIF
.
          PACK      KEY8,LINKVIST,SP70
          CALL      RDRESP1
          IF        OVRCD=1
            CALL      CLPATRE1
          ENDIF
.
          CALL      PMIGTNID                   * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      THREE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLICEC                   * send update emr details
.
WA08E999  RETURN
+
.*****************************************************************************
.*                                WLA38M00         Called by: MAIN0000       *
.*         Trigger an A38 HL7 cancellation message for the W/L record        *
.*****************************************************************************
.
.         Get the corresponding current W/L record
.
WLA38M00  PACK      KEY19,IBPLURNO,SP20
          CALL      RDSTREA1                     * position at start of U/R
WLA38M10  CALL      RDKTREA1                     * read next record
          BRANCH    OVRCD,WLA38M99               * eof - finished
.
          MOVE      WMBOOK,DIM8
          MATCH     IBPLVISN,DIM8                * same booking number ?
          GOTO      WLA38M10 IF NOT EQUAL        * no - get next record
.
.         The W/L record has been found, so get the extension record as well
.
          PACK      KEY19,WMURNO,WMCODE,WMCNT
          CALL      RDWTTX11
          IF        OVRCD = 1
            CALL      CLWATTX1
          ENDIF
.
.         Read all the PMI detail records for the patient
.
          MOVE      WMURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,WLA38M99
.
          MOVE      WMURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD = 1
            CALL      CLPMSPX2
          ENDIF
.
.         Trigger an A38 message to the relevant HL7 holding tables
.         (hl7cisaf, pmsqptaf & watqueaf)
.
          CALL      PMIGTNID                * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      FOUR,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIWLD
.
WLA38M99  RETURN
+
.*****************************************************************************
.*                                OPA38M00         Called by: MAIN0000       *
.*         Trigger an A38 HL7 cancellation message for the O/P record        *
.*****************************************************************************
.
.         The outbokaf and outbb1af records for the O/P booking no longer
.         exist after the cancellation, so get the corresponding O/P booking
.         cancellation record from outcanaf.
.         First we need to loop through the site file and try each outcanaf
.         to see if there is a matching visit record.
.
OPA38M00  MOVE      SP6,KEY6
          CALL      RDSSITA1                     * position at start of file
OPA38M10  CALL      RDKSITA1                     * read next record
          BRANCH    OVRCD,OPA38M99               * eof - finished
.
          MATCH     SP3,OSTFILE                  * file prefix blank ?
          GOTO      OPA38M10 IF EQUAL            * yes - ignore record
.
.         Open site specific outcanaf
.
          PACK      CFNAME,OSTFILE,FILCANA1
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OUTCANA1,CFNAME
          TRAPCLR   IO
          BRANCH    OVRCD,OPA38M10
.
          MOVE      IBPLVISN,KEY8
          CALL      RDOTCAN1                     * cancellation record found ?
          BRANCH    OVRCD,OPA38M10               * no - get next site prefix
.
.         Read all the PMI detail records for the patient
.
          MOVE      IBPLURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,OPA38M99
.
          MOVE      IBPLURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD = 1
            CALL      CLPMSPX2
          ENDIF
.
          CALL      CLOUTBOA                     * clear holding table variables
          CALL      CLOUTBB1
          CALL      CLOUTRSH
          MOVE      SP3,OTMALTYP
.
.         Load the outcanaf variables into their equivalent outbokaf
.         and outbb1af variables
.
          MOVE      OPCNSITE,OBASITE
          MOVE      OPCNCLIN,OBACLIN
          MOVE      OPCNDATE,OBADATE
          MOVE      OPCNSTRT,OBASTRT
          MOVE      OPCNTIME,OBATIME
          MOVE      OPCNSLOT,OBASLOT
          MOVE      OPCNOUTN,OBAOUTNO
          MOVE      OPCNURNO,OBAURNO
          MOVE      OPCNSRCR,OBASRCR
          MOVE      OPCNCOMP,OBACOMP
          MOVE      OPCNCLAS,OBACLASS
          MOVE      OPCNINS,OBAINS
          MOVE      OPCNCAT,OBACAT
          MOVE      OPCNPRTY,OBAPRTY
          MOVE      OPCNTRAN,OTBBTRAN
          MOVE      OPCNVTYP,OBAVISIT
          MOVE      OPCNCTYP,OBACTYP
          MOVE      OPCNNMDS,OTBBNMDS
          MOVE      OPCNSRVC,OTBBSRVD
          MOVE      OPCNCART,OTBBCART
.
.         Trigger an A38 message to the relevant HL7 holding tables
.         (hl7cisaf, pmsqptaf & outqueaf)
.
          CALL      PMIGTNID                * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      FIVE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLICOC
.
OPA38M99  RETURN
+
.*****************************************************************************
.*                                IPA27M00         Called by: MAIN0000       *
.*         Trigger an A27 HL7 cancellation message for the I/P record        *
.*****************************************************************************
.
.         Get the corresponding current I/P record
.
IPA27M00  MOVE      IBPLVISN,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,IPA27M99
.
.         Read all the PMI detail records for the patient
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,IPA27M99
.
          MOVE      AURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD = 1
            CALL      CLPMSPX2
          ENDIF
.
          MOVE      IBPLVISN,KEY8
          CALL      RDVISA1
          IF        OVRCD = 1
            CALL      CLPATVIS
          ENDIF
.
          MOVE      IBPLVISN,KEY8
          CALL      RDDSCH1
          IF        OVRCD = 1
            CALL      CLPATDSC
          ENDIF
.
          MOVE      IBPLVISN,KEY8
          CALL      RDRESP1
          IF        OVRCD = 1
            CALL      CLPATRE1
          ENDIF
.
.         Trigger an A27 message to the relevant HL7 holding tables
.         (hl7cisaf, pmsqptaf & pmsqviaf)
.
          CALL      PMIGTNID                * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      SIX,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLICPA
.
IPA27M99  RETURN
+
.*****************************************************************************
.*                              GROUP000           Called by: MAIN0000       *
.*                  Group an inpatient admission                             *
.* Note: There is no error handling here for errors which occur in the       *
.*       grouper, given that this is only a polling server which processes   *
.*       in the background.                                                  *
.*****************************************************************************
.
GROUP000  MOVE      IBPLURNO,URNUMBER     * load U/R variable for Grouper
          MOVE      IBPLVISN,ADMISSNO     * load visit # variable for Grouper
          MOVE      ONE,EPSCD001          * set episode to 1
.
          MOVE      IBPLVISN,KEY8
          CALL      RDMISS1               * admission record found ?
          BRANCH    OVRCD,GROUP999        * no
.
          MOVE      ADATE,ENCSTDAT        * Dates and Times for Codefinder
          MOVE      ATIME,ENCSTTIM
          MOVE      AADMNO,KEY8
          CALL      RDDSCH1
          BRANCH    OVRCD,GROUP999        * bail since not discharged
.
          MOVE      DDATE,ENCENDAT
          MOVE      DTIME,ENCENTIM
.
          COMPARE   ONE,PTCNODRG                 * using online grouper ?
          GOTO      GROUP999 IF NOT EQUAL        * no - finished
.
          COMPARE   ONE,MRCNGRUP                 * yes - using PC grouper ?
          GOTO      GROUP999 IF EQUAL            * yes - finished
.
.         This function is only available for the Unix grouper, given
.         that it is only a polling server running in background and not
.         associated with a PC.
.
          IF        MRCNGRUP=3
            MOVE      "O",UPDTTYPE                 * Run TurboGrouper
          ELSE
            MOVE      "U",UPDTTYPE                 * Run UNIX Grouper
          ENDIF
.
          CALL      SETGRP00
.
GROUP999  RETURN
.------------------------------------------------------------
. Update outpatient tier 2 code OTBBTCOD for OP bookings.
. Loop open sessions after the slot template header effective
. date but before the close date. If the OP booking has the
. old tier 2 code update it with the new tier 2 code.
.
. IBPLTYPE - 006 - Update OP Booking Tier 2 Code
. IBPLSKEY - OTHESITE - Site
.            OTHECLIN - Clinic
.            OTHEWDAY - DAY
.            OTHESTRT - SESSION START
.            OTHESHNO - SCHEDULE NUMBER
.            OTHESDAT - SCHEDULE DATE
.            OTHETCOD - OLD TIER 2 Code
.------------------------------------------------------------
TIER0000  UNPACK    IBPLSKEY,KEY28,OLDDTCOD  * See above for layout
.
          PACK      KEY6,KEY28
          CALL      RDSITA1                  * Read OP site
          BRANCH    OVRCD,TIER9999
.
          MATCH     OSTFILE,CFILEPRE         * Check Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          CALL      RDOTHED1                * Read slot template header
          BRANCH    OVRCD,TIER9999          * using KEY28 from above
.
          MATCH     SP70,OTHETCOD           * Exit if no tier 2 code     
          GOTO      TIER9999 IF EQUAL
.
          MATCH     SP70,OTHETCED           * Exit if no effective date
          GOTO      TIER9999 IF EQUAL
.
          PACK      KEY25,OTHESITE,OTHECLIN,OTHETCED,SP70
          CALL      RDSSESA1                * Sessions after effective date
TIER1000  CALL      RDKSESA1
          BRANCH    OVRCD,TIER9999
.
          MATCH     OTHESITE,OSESITE        * Same site
          GOTO      TIER9999 IF NOT EQUAL
.
          MATCH     OTHECLIN,OSECLIN        * Same clinic
          GOTO      TIER9999 IF NOT EQUAL
.
          MATCH     SP70,OTHEDTCC
          IF        !@EQUAL
            MATCH     OSEDATE,OTHEDTCC      * Date before closed date
            GOTO      TIER9999 IF LESS
          ENDIF
.
          MATCH     OTHESHNO,OSESSHNO       * Same schedule number
          GOTO      TIER1000 IF NOT EQUAL
.
          MATCH     OTHESDAT,OSESSDAT       * Same schedule date
          GOTO      TIER1000 IF NOT EQUAL
.
          PACK      KEY28,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
          CALL      RDSBOKA1
TIER2000  CALL      RDKBOKA1
          BRANCH    OVRCD,TIER1000
.
          MATCH     OBASITE,OSESITE         * Same site
          GOTO      TIER1000 IF NOT EQUAL
.
          MATCH     OBACLIN,OSECLIN         * Same clinic
          GOTO      TIER1000 IF NOT EQUAL
.
          MATCH     OBADATE,OSEDATE         * Same date
          GOTO      TIER1000 IF NOT EQUAL
.
          MATCH     OBASTRT,OSESTRT         * Same start time
          GOTO      TIER1000 IF NOT EQUAL
.
          COMPARE   ONE,OBASTAT             * Booked only
          GOTO      TIER2000 IF NOT EQUAL
.
          PACK      KEY8,OBAOUTNO,SP70
          CALL      RDBOKB1
          BRANCH    OVRCD,TIER2000
.
          MATCH     OLDDTCOD,OTBBTCOD       * Same old tier 2 code
          GOTO      TIER2000 IF NOT EQUAL
.
          MOVE      OTHETCOD,OTBBTCOD       * Update tier 2 code
.
          CALL      UPBOKB1
          GOTO      TIER2000
.
TIER9999  RETURN
+
.
. Dummy Labels
.
DELECD00
DELECO00
PATGNFEE  RETURN
+
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  RETURN
.------------------------------------------------------------
. Process Fields
.------------------------------------------------------------
PROFLD00  RETURN
.
.------------------------------------------------------------
. When attending an OP appointment. If there is a linked AH
. Referral. Recalculate the referral expiry date if this is 
. the first OP attendance after a referral renewal.
. If so update the referral expiry and set the renewal
. record status to completed.
.------------------------------------------------------------
REFX0000  PACK      KEY8,IBPLURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,REFX9999
.
          PACK      KEY8,IBPLURNO,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,REFX9999
.
          UNPACK    IBPLSKEY,CASEKEYS        * OP visit case key    
.
          PACK      KEY6,CASEKEYS
          CALL      RDSITA1                  * Read OP site
          BRANCH    OVRCD,REFX9999
.
          MATCH     OSTFILE,CFILEPRE         * Check Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          PACK      KEY28,CASEKEYS,SP70      * Read OP booking
          CALL      RDBOKA1
          BRANCH    OVRCD,REFX9999
.
          COMPARE   FOUR,OBASTAT             * Is the OP visit attended
          GOTO      REFX9999 IF NOT EQUAL
.
          PACK      KEY16,OBAOUTNO,SP70
          CALL      RSALLNK2
          CALL      RKALLNK2
          BRANCH    OVRCD,REFX9999          * Exit no linked referral
.
          MATCH     DOBAOUTN,ALLNLNKV       * Exit no linked referral
          GOTO      REFX9999 IF NOT EQUAL
.
          MATCH     "1",ALLNSTAT            * Cancelled appointment
          GOTO      REFX9999 IF EQUAL
.
          PACK      KEY8,ALLNVISN,SP70
          CALL      RDALREF1                * Read linked referral
          BRANCH    OVRCD,REFX9999
.
          MATCH     SP70,ALRERTYP           * No referral type so no
          GOTO      REFX9999 IF EQUAL       * expiry date

          MATCH     "1",ALRESTAT            * Active referrals only
          GOTO      REFX9999 IF NOT EQUAL
.
          MATCH     ALRERDAT,OBADATE        * OP booking date before 
          GOTO      REFX9999 IF LESS        * the referral date
.
          MATCH     SP70,ALREREXP           * Any referral expiry date
          IF        !@EQUAL
            MATCH     OBADATE,ALREREXP      * Referral expiry date before
            GOTO      REFX9999 IF LESS      * this booking
          ENDIF
.
          PACK      KEY24,ALREVISN,OBADATE,Z70
          CALL      RSALRNW1
REFX1000  CALL      RPALRNW1
          BRANCH    OVRCD,REFX9999          * Check for a referral renewal
.
          MATCH     ALREVISN,ALRNVISN       * Correct referral
          GOTO      REFX9999 IF NOT EQUAL
.
          MATCH     "2",ALRNSTAT            * Check if expiry date has
          GOTO      REFX9999 IF EQUAL       * already been re calculated
.
          MATCH     "1",ALRNSTAT            * If renewal deleted check
          GOTO      REFX1000 IF EQUAL       * previous renewal
.
          MATCH     OBADATE,ALRNNXDT        * Referral renewal new expiry date
          GOTO      REFX9999 IF LESS        * before this booking
.
          MOVE      TWO,AUDTTYPE            * before history record
          CALL      WAALRE00
.
          CALL      CALX0000                * calculate expiry date
.
          CALL      UPALREF1                * Update referral record
.
          MOVE      ALREREXP,ALRNNXDT       * Update new expiry date
          MOVE      "2",ALRNSTAT            * Update status to completed
          CALL      UPALRNW1
.
          MOVE      THREE,AUDTTYPE          * after history record
          CALL      WAALRE00
.
          CALL      PMIGTNID             * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      SEVEN,HL7TRGID
          MOVE      SP8,HL7INCLD
          CALL      DGCLII13             * broadcast Update Ref. (REF^I13)
.
REFX9999  RETURN
.
.------------------------------------------------------------
. Calculate referral expiry date 
.------------------------------------------------------------
CALX0000  PACK      KEY5,ANSR,ANSI,ALRERTYP,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CALX9999
.
          COMPARE   ZERO,TCFORM6            * No days for expiry warning
          GOTO      CALX9999 IF EQUAL
.
          MOVE      OBADATE,EXPRDATE
          ADD       TCFORM6,EXPRDATE
          MOVE      EXPRDATE,ALREREXP
.
CALX9999  RETURN
.
.------------------------------------------------------------
. When non attending an OP appointment. If there is a linked AH
. Referral. Clear the referral expiry date if all the appointemnts
. are cancelled or DNA
.------------------------------------------------------------
NATX0000  PACK      KEY8,IBPLURNO,SP70
          CALL      RDMAST1                  * Read the PMI
          BRANCH    OVRCD,NATX9999
.
          PACK      KEY8,IBPLURNO,SP70
          CALL      RDPMPX21                 * Read the pmi extn 
          BRANCH    OVRCD,NATX9999
.
          UNPACK    IBPLSKEY,CASEKEYS        * OP visit case key
.
          PACK      KEY6,CASEKEYS
          CALL      RDSITA1                  * Read OP site
          BRANCH    OVRCD,NATX9999
.
          MATCH     OSTFILE,CFILEPRE         * Check Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          PACK      KEY28,CASEKEYS,SP70      * Read OP booking
          CALL      RDBOKA1
          BRANCH    OVRCD,NATX9999
.
          COMPARE   FIVE,OBASTAT             * Is the OP visit non attended
          GOTO      NATX9999 IF NOT EQUAL
.
          PACK      KEY16,OBAOUTNO,SP70
          CALL      RSALLNK2
          CALL      RKALLNK2
          BRANCH    OVRCD,NATX9999          * Exit no linked referral
.
          MATCH     DOBAOUTN,ALLNLNKV       * Exit no linked referral
          GOTO      NATX9999 IF NOT EQUAL
.
          MATCH     "1",ALLNSTAT            * Cancelled appointment
          GOTO      NATX9999 IF EQUAL
.
          MOVE      ALLNVISN,LINKREFN       * Save the referral number
.
          PACK      KEY16,LINKREFN,SP70
          CALL      RSALLNK1
NATX4000  CALL      RKALLNK1
          BRANCH    OVRCD,NATX5000          * Exit no linked referral
.
          MATCH     LINKREFN,ALLNVISN
          GOTO      NATX5000 IF NOT EQUAL
.
          MATCH     "1",ALLNSTAT            * Cancelled appointment
          GOTO      NATX4000 IF EQUAL
.
          PACK      KEY28,ALLNSITE,ALLNCLIN,ALLNDATE:
                          ALLNSTRT,ALLNSLOT,SP70          * Read OP booking
          CALL      RDBOKA1
          BRANCH    OVRCD,NATX4000
.
          COMPARE   FIVE,OBASTAT            * Is the OP visit non attended
          GOTO      NATX4000 IF EQUAL
.
          GOTO      NATX9999                * Exit if all bookings are not
.                                           * cancelled or DNA
NATX5000  PACK      KEY8,LINKREFN,SP70
          CALL      RDALREF1                * Read linked referral
          BRANCH    OVRCD,NATX9999
.
          MATCH     SP70,ALRERTYP           * No referral type so no
          GOTO      NATX9999 IF EQUAL       * expiry date

          MATCH     "1",ALRESTAT            * Active referrals only
          GOTO      NATX9999 IF NOT EQUAL
.
          MOVE      TWO,AUDTTYPE            * before history record
          CALL      WAALRE00
.
          MOVE      SP70,ALREREXP           * Clear referral expiry date
.
          CALL      UPALREF1                * Update the referral
.
          MOVE      THREE,AUDTTYPE          * after history record
          CALL      WAALRE00
.
          CALL      PMIGTNID             * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      EIGHT,HL7TRGID
          MOVE      SP8,HL7INCLD
          CALL      DGCLII13             * broadcast Update Ref. (REF^I13)
.
NATX9999  RETURN
.

.------------------------------------------------------------
. Re-Print Invoice
.------------------------------------------------------------
RPINV000  UNPACK    IBPLSKEY,KEY8,SELPRINT,KEY10
          CALL      RDINV1                   * Read invoice number
          BRANCH    OVRCD,RPINV999
.
          CALL      RDWBSE1
          BRANCH    OVRCD,RPINV999
.
          MOVE      WBSEPCD,PASSCODE        * Set passcode for PR script
.
          MOVE      ZERO,DBILFLAG
          MOVE      ZERO,DBSFLAG
          MOVE      SP70,IVDETAIL
.
          MOVE      "PATWEB76",PRGID
          MOVE      "Re-Print Patient Invoice Server",PRGNAM
          CALL      CLPMSVX1
          CALL      CLPATDSC
.
          CALL      IBACLOCK
          PACK      CDATE,CDD,SLASH,CMM,SLASH,CCC,CYY
          REP       " 0",CDATE
          MOVE      SP10,ADATE
          MOVE      SP10,DDATE
          MOVE      SP10,ACLAIM
          MOVE      ZERO,PRTIFLAG
          MOVE      ZERO,PAGENO
.
          MOVE      ONE,WEBFLAG
          MOVE      PINVADM,ADMISSNO
          MOVE      PINVADM,AADMNO
          MOVE      PINVUR,URNUMBER
.
          MOVE      URNUMBER,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,RPINV900
          CALL      RDPMPX21
          BRANCH    OVRCD,RPINV900
.
          CALL      GPNAME00
.
          MOVE      ADMISSNO,KEY8
          IF        PINVSYS=3
            CALL      RDMISS1
            MOVE      OVRCD,MISSFLAG
            IF        ASTAT=3
              CALL      RDDSCH1
            ENDIF
          ELSE
            IF        PINVSYS=1
              CALL      RDPMEVT1
              IF        OVRCD=0
                MOVE      PMEVCCOD,ACLAIM       * Event Claim code
              ENDIF
             CALL      RDEMVIS1
             IF        OVRCD=0
               MOVE      EMVIDATE,ADATE
               MOVE      EMVIDDAT,DDATE
               MOVE      EMVICOMP,ACLAIM
             ENDIF
           ELSE
             IF        PINVSYS=2
               CALL      RDBOKB1
               IF        OVRCD=0
                 MOVE      OBADATE,ADATE     * admission date
               ENDIF
             ENDIF
           ENDIF
          ENDIF
.
          MOVE      ADMISSNO,KEY8
          CALL      RDRESP1
.
          PACK      KEY8,ADMISSNO
          CALL      RDPMVX11
          IF        OVRCD=1
            CALL      CLPMSVX1
          ENDIF
.
          CALL      OPNPRINT
          MOVE      ZERO,CRDNFLAG
          CALL      INVPR000              * reprint invoice
          CALL      CLSPRINT
.
          MOVE      ZERO,EXIT
.
RPINV900  MOVE      "COMWEB70",PRGID
          MOVE      "Patient Polling Server         ",PRGNAM
RPINV999  RETURN
+
.------------------------------------------------------------
.         Get the name of the patient
.------------------------------------------------------------
GPNAME00  CLEAR     PNAME
          REP       ", ",PTITL
          REP       ", ",PGNAME
          REP       ", ",PSNAME
.
          PACK      DIM6 WITH SP1,PTITL,SP1
GPNAME10  CMATCH    SP1,DIM6
          GOTO      GPNAME20 IF NOT EQUAL
          BUMP      DIM6
          GOTO      GPNAME10 IF NOT EOS
          IF        CFEETYP <> 9
            APPEND    PGNAME,PNAME     * original
          ELSE
            APPEND    PSNAME,PNAME     * Singapore
          ENDIF
          GOTO      GPNAME50
.
GPNAME20  APPEND    DIM6,PNAME
GPNAME30  CMATCH    SP1,PNAME
          GOTO      GPNAME40 IF NOT EQUAL
          BUMP      PNAME,-1
          GOTO      GPNAME30 IF NOT EOS
          CLEAR     PNAME
          IF        CFEETYP <> 9
            APPEND    PGNAME,PNAME     * original
          ELSE
            APPEND    PSNAME,PNAME     * Singapore
          ENDIF
          GOTO      GPNAME50
.
GPNAME40  APPEND    SP1,PNAME
          IF        CFEETYP <> 9
            APPEND    PGNAME,PNAME     * original
          ELSE
            APPEND    PSNAME,PNAME     * Singapore
          ENDIF
.
GPNAME50  CMATCH    SP1,PNAME
          GOTO      GPNAME60 IF NOT EQUAL
          BUMP      PNAME,-1
          GOTO      GPNAME50 IF NOT EOS
          CLEAR     PNAME
          IF        CFEETYP <> 9
            APPEND    PSNAME,PNAME     * original
          ELSE
            APPEND    PGNAME,PNAME     * Singapore
          ENDIF
          GOTO      GPNAME70
.
GPNAME60  APPEND    SP1,PNAME
          IF        CFEETYP <> 9
            APPEND    PSNAME,PNAME     * original
          ELSE
            APPEND    PGNAME,PNAME     * Singapore
          ENDIF
.
GPNAME70  APPEND    SP30,PNAME
          APPEND    SP30,PNAME
          RESET     PNAME
GPNAME99  RETURN
+
.------------------------------------------------------------
.    Re-print invoice in bulk - a copy of PATANVS label INVPR
.------------------------------------------------------------
INVPR000  MOVE      ZERO,GROSSTOT
          MOVE      ZERO,NETTOT
          MOVE      ZERO,GOVTOTAL
          MOVE      ZERO,TOTDAYS
          MOVE      ZERO,NODAYS
          MOVE      ZERO,PAGENO
.
          MOVE      SP10,DINVTP
          LOAD      DINVTP USING PINVTYP OF DINSUR
.
.         Open a spool file for this reprint
.
          MOVE      PINVADM,ADANUMB
          MOVE      ADANUMB,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,INVPR100
.
          IF        PVITYPE=9
            MATCH     " 1",PVISYST
            GOTO      INVPR100 IF EQUAL    * Events
          ENDIF
.
          IF        PVITYPE=2
            MOVE      PFUNDH,AFUNDH
            MOVE      PFNDTB,AFNDTB
            MOVE      PFNDMM,AFNDMM
            MOVE      PFNDMM,PMVXFNDM
          ENDIF
.
          COMPARE   ONE,PVITYPE
          GOTO      INVPR300 IF NOT EQUAL
.
INVPR100  MOVE      SP70,DPROV
          OPEN      PATDO1A1,"patdo1af"
          MOVE      ADADOCT,KEY6
          CALL      RDDOCT1
.
          PACK      SERVDOCT,SP70
          MATCH     "1",EMCNGINV            * Group invoice by Service Doctor
          IF        @EQUAL
            CALL      GSDC0000              * Get Service doctor
            OPEN      PMSHCPA1,"pmshcpaf"
            PACK      KEY10,SERVDOCT,SP70
            CALL      RDPMHCP1
            IF        OVRCD<>1
              MOVE      PMHCTITL,DTITL
              MOVE      PMHCGNAM,DGNAME
              MOVE      PMHCSNAM,DSNAME
              MOVE      PMHCPRV1,DPROV
            ENDIF
          ENDIF
.
          UNPACK    ADADATE WITH CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,A10DATE
.
          MOVE      PFUNDH,AFUNDH
          MOVE      PFNDTB,AFNDTB
          MOVE      PFNDMM,AFNDMM
          MOVE      PFNDMM,PMVXFNDM
.
          COMPARE   ZERO,HSTANDM
          GOTO      INVPR200 IF NOT EQUAL
.
          MOVE      ADANUMB,KEY8
          CALL      RDDISA1
          BRANCH    OVRCD OF INVPR200
.
          UNPACK    ADSDATE WITH CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,D10DATE
          GOTO      INVPR220
.
INVPR200  MOVE      SP10,D10DATE
          GOTO      INVPR220
.
INVPR300  UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,A10DATE
.
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,D10DATE
.
.         Get the discharge diagnosis if available
.
          MATCH     SP8,DDATE
          GOTO      INVPR220 IF EQUAL
.
          MATCH     SP70,DDIAG         * Does discharge diagnosis exist?
          GOTO      INVPR220 IF EQUAL  * No, don't replace admission diagnosis
          MOVE      DDIAG,ADIAG1
          MOVE      DDIAG2,ADIAG2
.
          MATCH     SP9,DFMBS
          GOTO      INVPR220 IF EQUAL
          MOVE      DFMBS,AMBS
.
INVPR220  CALL      GPRAC000                 * Get PRFA details
.
.         Print the heading
.
          CALL      HEAD
.
.         Print the body of the invoice
.
          MOVE      ONE,PRINTFLG
          CALL      CALCTAI
.
INVPR999  RETURN
+
.******************************************************************************
.         Get the person responsible for the account
.******************************************************************************
GPRAC000  COMPARE   ONE,ISBLFLAG
          GOTO      GPRAC080 IF NOT EQUAL       * Not Independence Serv.billing
.
          CALL      IPYR0000                    * Get payer details
          BRANCH    EXIT,GPRAC999
          GOTO      GPRAC300
.
GPRAC080  COMPARE   "22",PTCNINVL
          GOTO      GPRAC100 IF NOT EQUAL       * John Hopkins invoice
.
          CALL      JHPFA000                    * Set default PRFA name
          MOVE      PFNAME,PKNAME
          GOTO      GPRAC200
.
GPRAC100  COMPARE   "23",PTCNINVL
          GOTO      GPRAC300 IF NOT EQUAL   * Not Southern Cross invoice
.
GPRAC200  MATCH     "PRFA",EXPPAYER
          GOTO      GPRAC300 IF EQUAL
          MATCH     SP70,EXPPAYER
          GOTO      GPRAC300 IF EQUAL
.
          OPEN      PATFN1A1,"patfn1af"
          PACK      KEY14,EXPPAYER,ZERO8,SP70
          CALL      RDFUND1
          IF        OVRCD=0
            PACK      PKNAME,HFNAME,SP70,SP10
            PACK      PKADD1,HFADD1,SP70
            PACK      PKADD2,HFADD2,SP70
            PACK      PKSUBR,HFADD3,SP70
            PACK      PKADD4,HFADD4,SP70
            PACK      PKPOST,HFPCODE,SP70
            GOTO      GPRAC400
          ENDIF
.
GPRAC300  MOVE      PINVADM,KEY8
          OPEN      PATRE1A1,"patre1af"
          CALL      RDRESP1
.
          COMPARE   "22",PTCNINVL
          GOTO      GPRAC400 IF NOT EQUAL
          MATCH     "SELF",PKRELP
          GOTO      GPRAC900 IF EQUAL
.
GPRAC400  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TWENTY1;*237,PTCNPAOF
          READ      CONTROLF,HUND03;*220,PTCNDEES,*221,PTCNDDES
.
          MATCH     "1",PTCNDEES             * using deceased PRFA indicator
          GOTO      GPRAC500 IF NOT EQUAL     * no
.
          CMATCH    "$",PKNAME
          IF        @EQUAL
            STRIP     PTCNDDES
            MOVE      PTCNDDES,PFNAME
            UNPACK    PKNAME,DIM2,KEY78      * ignore "$ "
            PACK      PFNAME,PFNAME,SP1,KEY78,SP30
            GOTO      GPRAC700
          ENDIF
.
GPRAC500  COMPARE   ONE,PTCNPAOF             * using 'parent of'?
          GOTO      GPRAC600 IF NOT EQUAL      * no
.
.---- If first character of PKNAME is "@" then replace with "Parent of"
.
          CMATCH    "@",PKNAME
          IF        @EQUAL
            MOVE      "Parent of ",PFNAME
            UNPACK    PKNAME,KEY2,KEY78      * ignore "@ "
            PACK      PFNAME,PFNAME,KEY78,SP30
            GOTO      GPRAC700
          ENDIF
.
GPRAC600  MATCH     SP70,PKNAME
          GOTO      GPRAC720 IF EQUAL
          GOTO      GPRAC720 IF EOS
          PACK      PFNAME WITH PKNAME,SP70
.
GPRAC700  COMPARE   ZERO,OVRCD
          GOTO      GPRAC999 IF EQUAL
.
GPRAC720  RESET     PGNAME
          MOVE      PGNAME,ANS
          PACK      DIM8 WITH SP1,PTITL,SP1,ANS,DOT
GPRAC780  CMATCH    SP1,DIM8
          GOTO      GPRAC800 IF NOT EQUAL
          BUMP      DIM8
          GOTO      GPRAC780  IF NOT EOS
.
GPRAC800  PACK      PFNAME WITH DIM8,PSNAME
          REP       ", ",PFNAME
.
GPRAC900  MOVE      PSUBRB,PKSUBR
          MOVE      PADD1,PKADD1
          MOVE      PADD2,PKADD2
          MOVE      PPOST,PKPOST
          MOVE      SP10,PKRELP
GPRAC999  RETURN
+
.*******************************************************************************
.         Get payer name as Person responsible for Account
.*******************************************************************************
IPYR0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSPYRA1,"pmspyraf"
          TRAPCLR   IO
          BRANCH    OVRCD,IPYR8000
.
          PACK      KEY19,SPVIURNO,PINVCLM,PINVDTE,SP70
          CALL      RSPMPYR1
IPYR1000  CALL      RPPMPYR1
          BRANCH    OVRCD,IPYR8000
.
          MATCH     SPVIURNO,PMPYURNO
          GOTO      IPYR8000 IF NOT EQUAL
          MATCH     PINVCLM,PMPYCLTY
          GOTO      IPYR8000 IF NOT EQUAL
.
          RESET     PMPYGNAM
          MOVE      PMPYGNAM,ANS
          MATCH     SP70,ANS
          IF        @EQUAL
            PACK      DIM8 WITH SP1,PMPYTITL,SP70
          ELSE
            PACK      DIM8 WITH SP1,PMPYTITL,SP1,ANS,DOT
          ENDIF
.
IPYR2200  CMATCH    SP1,DIM8
          GOTO      IPYR3000 IF NOT EQUAL
          BUMP      DIM8
          GOTO      IPYR2200 IF NOT EOS
.
IPYR3000  PACK      PFNAME WITH DIM8,PMPYSNAM
          REP       ", ",PFNAME
          PACK      PKNAME,PFNAME,SP70,SP10
          MOVE      PMPYADD1,PKADD1
          MOVE      PMPYADD2,PKADD2
          MOVE      PMPYADD3,PKSUBR
          MOVE      PMPYADD4,PKADD4
          MOVE      PMPYPOST,PKPOST
          MOVE      PMPYRELP,PKRELP
          MOVE      ONE,EXIT
          GOTO      IPYR9999
.
IPYR8000  MOVE      ZERO,EXIT
IPYR9999  RETURN
+
.------------------------------------------------------------
.         Set up JH PRFA name
.------------------------------------------------------------
JHPFA000  SQUEEZE   PTITL
          SQUEEZE   PGNAME
.
          MOVE      SP70,PFNAME
          CLEAR     PFNAME
          APPEND    PTITL,PFNAME
          APPEND    SP1,PFNAME
          APPEND    PGNAME,PFNAME
          APPEND    SP1,PFNAME
          APPEND    PSNAME,PFNAME
          APPEND    SP70,PFNAME
          RESET     PFNAME
JHPFA999  RETURN
+
.------------------------------------------------------------
.      Print Billing Statement in bulk
.------------------------------------------------------------
PRTBS000  UNPACK    IBPLSKEY,SELPRINT,KEY10
          CALL      RDWBSE1
          BRANCH    OVRCD,PRTBS999
.
          MOVE      WBSEPCD,PASSCODE        * Set passcode for PR script
.
          MOVE      "PATWEB71",PRGID
          MOVE      "Patient Invoice Print Server   ",PRGNAM
          MOVE      IBPLVISN,ADMISSNO
          MOVE      IBPLURNO,URNUMBER
.
          MOVE      ZERO,EXIT
          MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,PRTBS900
          CALL      RDMISS1
          BRANCH    OVRCD,PRTBS900                * missing admission record
.
          MOVE      PVIURNO,KEY8
          CALL      RDMAST1
          CALL      RDPMPX21
          BRANCH    OVRCD,PRTBS900
.
          CALL      IBACLOCK
          MOVE      SP70,EXCLMISC
          MOVE      ONE,DBILFLAG
          MOVE      ONE,DBSFLAG
          MOVE      "1",IVDETAIL                 * print raised invoices
          MOVE      ONE,BDTEFLAG
          PACK      BACKDATE,CCC,CYY,CMM,CDD
          REP       " 0",BACKDATE
.
          MOVE      ONE,WEBFLAG
          MOVE      ONE,PROGFLAG
          MOVE      ZERO,JHFLAG
          MOVE      ZERO,REVBFLAG
          MOVE      ZERO,PAGENO
.
          MOVE      ZERO,INVTYPE            * Standard invoice
          MOVE      SP70,DDATE
          IF        ASTAT=3
            MOVE      AADMNO,KEY8
            CALL      RDDSCH1
          ENDIF
          CALL      CALCTBI                     * Work out invoice date range
.
          CALL      OPNPRINT
          MOVE      THREE,PROGFLAG
          MOVE      ZERO,ERRFLAG
.
          MOVE      ADMISSNO,KEY8
          CALL      RDPTELG1
          IF        OVRCD=1
            MOVE      ZERO,PTELPPRI
            MOVE      ZERO,PTELPPUT
            MOVE      ZERO,PTELPSHA
            MOVE      ZERO,PTELPSUT
            MOVE      ZERO,PTELPSDY
            MOVE      ZERO,PTELPCCU
            MOVE      ZERO,PTELPSDU
            MOVE      ZERO,PTELPHSP
            MOVE      ZERO,PTELPHSU
            MOVE      ZERO,PTELPTHE
            MOVE      ZERO,PTELPTUT
            MOVE      ZERO,PTELXCSS
            MOVE      ZERO,PTELXCSD
          ENDIF
.
          MOVE      ZERO,IPASS
          MOVE      ONE,NUMINVS
          MOVE      ZERO,TDBSAMNT
          MOVE      ZERO,TOTALFEE
          MOVE      ZERO,CPAYPRIV             * Co-payment for private
          MOVE      ZERO,CPAYSHRD             * Co-payment for shared
          MOVE      ZERO,CPAYCCUH             * Co-payment for CCU/ICU/SCN/HDU
          MOVE      ZERO,BPDAYS
          MOVE      ZERO,BSDAYS
          MOVE      ZERO,BCDAYS
          MOVE      ZERO,EPSFLAG              * flag for first invoice
          MOVE      SIX,PROGFLAG              * Discharge billing statement
          MOVE      ONE,MSGFLAG               * not display error message
          MOVE      ZERO,CREDTOT
          MOVE      ZERO,CNEXTINV
          CALL      PRNTINV1
          BRANCH    EXIT,PRTBS900
.
          CALL      PRTELIGI                  * Print eligibility table
          MOVE      ONE,PRINTFLG
          CALL      DSIV0000                  * Print all Invoices details
          CALL      CLSPRINT
          MOVE      ZERO,EXIT
.
PRTBS900  MOVE      "COMWEB70",PRGID
          MOVE      "Patient Polling Server         ",PRGNAM
PRTBS999  RETURN
+
.------------------------------------------------------------
.         Display all Invoices details
.------------------------------------------------------------
DSIV0000  MOVE      "PATWEB76",PRGID
          MATCH     "1",IVDETAIL
          GOTO      DSIV2000 IF NOT EQUAL
.
          PACK      KEY32,URNUMBER,ADMISSNO,Z70
          CALL      RDSINV5
DSIV1000  CALL      RDPINV5
          BRANCH    OVRCD,DSIV2000
.
          MATCH     URNUMBER,PINVUR
          GOTO      DSIV2000 IF NOT EQUAL      * Different U/R number
          MATCH     ADMISSNO,DPINVADM
          GOTO      DSIV2000 IF NOT EQUAL      * Different Admission number
.
          COMPARE   THREE,PINVSYS
          GOTO      DSIV1000 IF NOT EQUAL      * Not inpatient invoice
.
          MATCH     "1",PTINCRST
          GOTO      DSIV1000 IF EQUAL          * Fully credit note
.
          MOVE      PINVAMT,FORM12P2
          SUB       PINVREB,FORM12P2           * patient portion
.
          COMPARE   ZERO,FORM12P2
          GOTO      DSIV1200 IF EQUAL
          GOTO      DSIV1200 IF LESS           * no patient portion
          GOTO      DSIV1800
.
DSIV1200  CALL      CPMN0000                * Check for deposit or pat.payment
          BRANCH    EXIT,DSIV1000
.
DSIV1800  IF        PRINTFLG=1
            COMPARE   MAXLINE,COUNT                   * Check For A Full Page
            CALL      TAIL IF NOT LESS
            PRINT     *N;
            ADD       ONE,COUNT
.
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            COMPARE   MAXLINE,COUNT                   * Check For A Full Page
            CALL      TAIL IF NOT LESS
            IF        PTCNINVL=25
              PRINT     *1,"Invoice :",PINVNO,"  Invoice Date:",CPCDATE
            ELSE
              PRINT     *1,"Invoice No.:",PINVNO,"  Invoice Date:",CPCDATE
            ENDIF
            ADD       ONE,COUNT
          ENDIF
.
          MOVE      ONE,DBSFLAG                * Discharge billing
          CALL      CALCTAI                    * Display inpat invoice
          ADD       PAYMTTOT,TOTALFEE
          GOTO      DSIV1000
.
.         Print balance payable
.
DSIV2000  MOVE      TDBSAMNT,GROSSTOT
          MOVE      GROSSTOT,INVCTOTL
          ADD       TOTALFEE,TDBSAMNT
          MOVE      TOTALFEE,PAYMTTOT
          MOVE      ZERO,CSAMT
          MOVE      ZERO,TOTGST
          MOVE      ZERO,CREDTOT
.
.         Print balance payable for Cabrini layout
.
          IF        PTCNINVL=25
            COMPARE   MAXLINE,COUNT                   * Check For A Full Page
            CALL      TAIL IF NOT LESS
            PRINT     *19,"Balance Payable",*66,TDBSAMNT
            ADD       ONE,COUNT
          ENDIF
.
          MOVE      MAXLINE,FORM2
DSIV4200  COMPARE   FORM2,COUNT
          GOTO      DSIV5000 IF NOT LESS
.
          PRINT     *N;
          ADD       ONE,COUNT
          GOTO      DSIV4200
.
DSIV5000  MOVE      THREE,PINVSYS
          CALL      SINVT000                 * set up tail stationery code
          BRANCH    EXIT,DSIV9000
.
          MOVE      SP70,PINVNO
          MOVE      SP70,PINVDTE
          MOVE      ZERO,MPGEFLAG            * indicate single/last page
          ADD       ONE,CPAGENO
          CALL      PRTINVTL                 * print templated invoice tail
.
          COMPARE   FORM3,IBTHLENG           * check if last line is same as
          GOTO      DSIV9000 IF EQUAL        * page length
          PRINT     *N;
.
DSIV9000  MOVE      "COMWEB70",PRGID
DSIV9999  RETURN
+
.------------------------------------------------------------
.         Print Deposit or any Patient payments
.------------------------------------------------------------
CPMN0000  MOVE      ZERO,EXIT
          IF        PINVSYS = 3
            PACK      KEY23 WITH PINVADM,PINVNO,FIVE,SP30
          ELSE
            PACK      KEY31 WITH PINVADM,PINVNO,TWO,SP30
            PACK      KEY22 WITH PINVADM,PINVNO,SP30
          ENDIF
          CALL      RDSDTRAN
CPMN1000  CALL      RDKDTRAN
          BRANCH    OVRCD OF CPMN9000
.
          MATCH     PINVNO,TREF
          GOTO      CPMN9000 IF NOT EQUAL
.
          IF        PINVSYS<>3
            COMPARE   FIVE,TRECTYPE
            GOTO      CPMN1000 IF NOT EQUAL
          ELSE
            COMPARE   FIVE,TRECTYPE
            GOTO      CPMN9000 IF NOT EQUAL
          ENDIF
.
          MATCH     "P" TO TTYPEDEB
          GOTO      CPMN9999 IF EQUAL     * Payment from patient
          MATCH     SP70,TDEPTYP
          GOTO      CPMN9999 IF NOT EQUAL * deposit
.
          GOTO      CPMN1000
.
CPMN9000  MOVE      ONE,EXIT
          GOTO      CPMN9999
.
CPMN9999  RETURN
+
.------------------------------------------------------------
.         Check Invoice pending - for Public hospital
.------------------------------------------------------------
INVPN000  MOVE      IBPLVISN,ADMISSNO
          MOVE      IBPLURNO,URNUMBER
          MOVE      ZERO,EXIT
.
          MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,INVPN999
          MOVE      PVIURNO,KEY8
          CALL      RDMAST1
          CALL      RDPMPX21
          BRANCH    OVRCD,INVPN999
.
          MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,INVPN999
.
          BRANCH    ASTAT,INVPN800          * Pre-adm. - NO pending
          COMPARE   FIVE,ASTAT
          GOTO      INVPN800 IF EQUAL       * Cancelled adm - NO pending
.
          MOVE      ONE,PROGFLAG
          MOVE      ZERO,JHFLAG
          MOVE      ZERO,REVBFLAG
          MOVE      ZERO,PAGENO
          MOVE      ZERO,DBILFLAG
          MOVE      ZERO,DBSFLAG
          MOVE      SP70,IVDETAIL
          MOVE      ZERO,IBCNUGST           * No GST for invoice pending
          MOVE      ZERO,GROSSTOT
          MOVE      ZERO,NETTOT
.
          MOVE      ONE,DISFLG                   * Assume no discharge record
          MOVE      ZERO,INVTYPE            * Standard invoice
          MOVE      SP70,DDATE
          IF        ASTAT=3
            MOVE      ZERO,DISFLG                  * Patient is discharged
            MOVE      AADMNO,KEY8
            CALL      RDDSCH1
          ENDIF
.
          CALL      IBACLOCK
          MOVE      ZERO,BDTEFLAG
          CALL      CALCTBI                     * Work out invoice date range
          MOVE      NETTOT,GROSSTOT
          READ      CONTROLF,ZERO;*85,IBCNUGST  * restore
.
          MATCH     "018",IBPLTYPE
          GOTO      INVPN400 IF EQUAL    * Record type=018 - Upd.Extra data file
.
          CALL      CLMC0000                    * Check Claim code
          BRANCH    EXIT,INVPN100               * Not chargeable
.
          COMPARE   THREE,ASTAT
          GOTO      INVPN200 IF NOT EQUAL
.
          MATCH     ADATE,DDATE                 * Daycase ?
          IF        @EQUAL
            COMPARE   ZERO,AINVPRT
            GOTO      INVPN200 IF EQUAL         * Daycase and No invoice raised
          ENDIF
.
          COMPARE   ZERO,TOTDAYS
          GOTO      INVPN200 IF NOT EQUAL       * Invoice has number of days
.
.         Check for to be invoiced
.
INVPN100  COMPARE   ZERO,GROSSTOT
          GOTO      INVPN800 IF EQUAL
.
.         still has to be invoiced, should have a record in patipenf
.
INVPN200  PACK      KEY8,AADMNO,SP70
          CALL      RDIPEN1
          COMPARE   ZERO,OVRCD
          GOTO      INVPN999 IF EQUAL
.
          MOVE      AADMNO,IPADMNO
          MOVE      PVITYPE,IPSYSTM
          MOVE      PVISITE,IPSITE
.
          MOVE      SP70,PENDHOSP
          IF        IBCNMHOS=1
            PACK      KEY8,IPADMNO,SP70
            CALL      RDPMVX11
            IF        OVRCD=0
              MOVE      PMVXMHOS,PENDHOSP         * Hospital ID
            ENDIF
          ENDIF
          MOVE      " 3",PENDSYST                 * Inpatient
.
          MOVE      SP70,PTIPRHLD
          MOVE      SP70,PTIPRDES
          MOVE      ADATE,PENDADAT                * admission date
          MOVE      SP70,PENDDDAT
          IF        ASTAT=3
            CALL      RDDSCH1
            IF        OVRCD=0
              MOVE      DDATE,PENDDDAT            * discharged date
            ENDIF
          ENDIF
          UNPACK    IBPLSKEY,PENDSDAT,PTIPRSTA    * as at date and record status
.
          MOVE      AFUNDH,PENDFUND               * IP
          MOVE      ACLAIM,PENDCLAM
          CALL      IPRH0000
.
          MOVE      FIVE,PTIPRSTA                 * Update Record status
          MOVE      SP70,PTIPSVAR
          PACK      KEY8,AADMNO,SP70
          CALL      WRIPEN1
.
          GOTO      INVPN999
.
.         Record type 018 - Update Visit Extra data file
.
INVPN400  COMPARE   ZERO,GROSSTOT
          GOTO      INVPN9999 IF EQUAL
.
          CALL      UPVXDC00            * Update Visit Extra data
          GOTO      INVPN999
.
INVPN800  PACK      KEY8,AADMNO,SP70
          CALL      DEIPEN1
.
INVPN999  RETURN
+
.------------------------------------------------------------
.         Update Visit Extra data file
.------------------------------------------------------------
UPVXDC00  COMPARE   ONE,VISXDCIN
          GOTO      UPVXDC99 IF EQUAL
          COMPARE   ONE,HOSPARAM
          GOTO      UPVXDC99 IF EQUAL
.
          MOVE      "PTCNCIPA",D8                * hospital parameter
          COMPARE   ZERO,IBCNMHOS
          GOTO      UPVXDC20 IF EQUAL
.
          PACK      KEY8,AADMNO,SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,UPVXDC20
.
          PACK      KEY11,PMVXMHOS,D8,SP70
          CALL      RDCMPAR1                     * Read system parameter
          BRANCH    OVRCD,UPVXDC20
.
          MATCH     "0",CMPAACTV
          GOTO      UPVXDC40 IF EQUAL            * found active data
.
UPVXDC20  PACK      KEY11,SP3,D8,SP70
          CALL      RDCMPAR1                    * Read default system parameter
          BRANCH    OVRCD,UPVXDC99
.
          MATCH     "0",CMPAACTV
          GOTO      UPVXDC40 IF EQUAL            * found active data
.
          GOTO      UPVXDC99
.
UPVXDC40  MOVE      GROSSTOT,FORM7P2             * amount to be invoiced
.
          CALL      IBACLOCK                     * current date/time
          PACK      KEY11,AADMNO,VSTYP003,SP70
          CALL      RDVSXDC1
          BRANCH    OVRCD,UPVXDC50
.
          MOVE      FORM7P2,VSXDVAL1             * form 7.2 = dim 10
          UNPACK    IBPLSKEY,VSXDUUSR            * User id
          PACK      VSXDUDAT,CCC,CYY,CMM,CDD
          REP       " 0",VSXDUDAT
          MOVE      CTIMEIS,VSXDUTIM
          CALL      UPVSXDC1
          GOTO      UPVXDC99
.
UPVXDC50  CALL      CLVISXDC
.
          MOVE      AADMNO,VSXDVISN             * visit number
          MOVE      VSTYP003,VSXDTYDA            * data type = "003"
.
          MOVE      FORM7P2,VSXDVAL1
.
          UNPACK    IBPLSKEY,VSXDCUSR            * User id
          PACK      VSXDCDAT,CCC,CYY,CMM,CDD
          REP       " 0",VSXDCDAT
          MOVE      CTIMEIS,VSXDCTIM
          CALL      WRVSXDC1
.
UPVXDC99  RETURN
+
.------------------------------------------------------------
.         Check Claim code if it's chargeable
.------------------------------------------------------------
CLMC0000  MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,CLMC9000
.
          PACK      ACLAIM,ACLAIM,SP70
          MATCH     SP70,ACLAIM
          GOTO      CLMC9000 IF EQUAL      * no charge
.
          PACK      KEY5,CODECL,ACLAIM
          CALL      RDCODE1
          BRANCH    OVRCD,CLMC8000
.
          MATCH     "P",TCINDC12
          GOTO      CLMC9000 IF EQUAL      * Public - no charge
          MATCH     "R",TCINDC12
          GOTO      CLMC9000 IF EQUAL      * Reciprocal - no charge
          MATCH     "J",TCINDC12
          GOTO      CLMC9000 IF EQUAL      * Prisoner - no charge
.
CLMC8000  MOVE      ZERO,EXIT              * chargeable
          GOTO      CLMC9999
.
CLMC9000  MOVE      ONE,EXIT               * no charge
CLMC9999  RETURN
+
.*****************************************************************************
.*                                THS15M00         Called by: MAIN0000       *
.*         Trigger an S15 HL7 theatre booking cancellation message           *
.*****************************************************************************
.
.         Use the Theatre Unique Id to get the cancelled record
.
THS15M00  MOVE      IBPLSKEY,KEY10
          CALL      RDOPDEA3                     * theatre record on file ?
          BRANCH    OVRCD,THS15M99               * no - finished
.
.         Read all the PMI detail records for the patient
.
          MOVE      IBPLURNO,KEY8
          CALL      RDMAST1                      * PMI master record on file ?
          BRANCH    OVRCD,THS15M99               * no - finished
.
          MOVE      IBPLURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD = 1
            CALL      CLPMSPX2
          ENDIF
.
.         Trigger an S15 message to the relevant HL7 holding tables
.         (hl7cisaf, pmsqptaf & oprqueaf)
.
          CALL      PMIGTNID                * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      NINE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLIS15
.
THS15M99  RETURN
+
.------------------------------------------------------------
.      Print Inpatient invoice in bulk
.------------------------------------------------------------
PIINV000  UNPACK    IBPLSKEY,SELPRINT,KEY10
          CALL      RDWBSE1
          BRANCH    OVRCD,PIINV900
.
          MOVE      WBSEPCD,PASSCODE        * Set passcode for PR script
.
          MOVE      "PATWEB71",PRGID
          MOVE      "Patient Invoice Print Server   ",PRGNAM
          MOVE      IBPLVISN,ADMISSNO
          MOVE      IBPLURNO,URNUMBER
.
          MOVE      ZERO,EXIT
.
          MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,PIINV900
          MOVE      PVIURNO,KEY8
          CALL      RDMAST1
          CALL      RDPMPX21
          BRANCH    OVRCD,PIINV900
.
          MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,PIINV900
.
          CALL      DGTU0000                * Check unknown gst file
          MOVE      ONE,WEBFLAG
          MOVE      ONE,PROGFLAG
          MOVE      ZERO,JHFLAG
          MOVE      ZERO,REVBFLAG
          MOVE      ZERO,PAGENO
          MOVE      ZERO,DBILFLAG
          MOVE      ZERO,DBSFLAG
          MOVE      SP70,IVDETAIL
.
          MOVE      ONE,DISFLG                   * Assume no discharge record
          MOVE      ZERO,INVTYPE            * Standard invoice
          MOVE      SP70,DDATE
          IF        ASTAT=3
            MOVE      ZERO,DISFLG                  * Patient is discharged
            MOVE      AADMNO,KEY8
            CALL      RDDSCH1
          ENDIF
.
          CALL      CALCTBI                     * Work out invoice date range
          COMPARE   ZERO,GROSSTOT
          GOTO      PIINV900 IF EQUAL
.
          CALL      ICDSG000                    * Check for ICD10 Sugg. Class.
          CALL      OPNPRINT
          MOVE      THREE,PROGFLAG
          MOVE      ZERO,ERRFLAG
.
          CALL      PRNTINV1                    * Print inpatient invoice
.
          BRANCH    ERRFLAG,PIINV900,PIINV900,PIINV900
          BRANCH    EXIT,PIINV900
          CALL      CLSPRINT
.
          CALL      INVC0000                  * Transfer tobe invoiced comments
          MOVE      ZERO,EXIT
.
PIINV900  MOVE      "COMWEB70",PRGID
          MOVE      "Patient Polling Server         ",PRGNAM
PIINV999  RETURN
+
.------------------------------------------------------------
.      Print Outpatient invoice in bulk
.------------------------------------------------------------
POINV000  UNPACK    IBPLSKEY,SELPRINT,KEY10
          CALL      RDWBSE1
          BRANCH    OVRCD,POINV900
.
          MOVE      WBSEPCD,PASSCODE        * Set passcode for PR script
.
          MOVE      "OUTWEB07",PRGID
          MOVE      "Outpatient Invoice Web Server   ",PRGNAM
          MOVE      IBPLVISN,ADMISSNO
          MOVE      IBPLURNO,URNUMBER
.
          MOVE      ZERO,EXIT
.
          MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,POINV900
          MOVE      PVIURNO,KEY8
          CALL      RDMAST1
          CALL      RDPMPX21
          BRANCH    OVRCD,POINV900
.
          PACK      CFNAME,CFILEPRE,FILBB1A2
          MOVE      PVISITE,KEY6             * For this site ...
          CALL      RDSITA1                  * Get file prefix
.
          PACK      CFNAME,OSTFILE,FILBB1A2  * Set up physical filename
          CALL      OPOTBB12
          PACK      KEY16,PVIDATE,PVIBILL    * Key is date & outpatient no.
          CALL      RDBOKB2                  * Read record
          BRANCH    OVRCD,POINV900
.
          CALL      DGTU0000                * Check unknown gst file
.
          MOVE      PVISITE,OBASITE
          MOVE      PVIBILL,OBAOUTNO
          MOVE      PVIURNO,OBAURNO
.
          MOVE      OBACOMP,ACLAIM
          MOVE      OBACOMP,ACLAIM
          MOVE      OTBBFUND,AFUNDH
          MOVE      OTBBTBLE,AFNDTB
.
          MOVE      ZERO,PAGENO
          MOVE      ONE,WEBFLAG
          MOVE      ONE,PROGFLAG
          MOVE      ZERO,TOTDAYS
          CALL      OUTTBI
          COMPARE   ZERO,GROSSTOT
          GOTO      POINV900 IF EQUAL
.
          CALL      OPNPRINT
          MOVE      THREE,PROGFLAG
          MOVE      OBAOUTNO,OTNUMB
          CALL      OTIV0000                  * Print Invoice
          CALL      CLSPRINT
.
          CALL      INVC0000                  * Transfer tobe invoiced comments
          MOVE      ZERO,EXIT
.
POINV900  MOVE      "COMWEB70",PRGID
          MOVE      "Patient Polling Server         ",PRGNAM
.
POINV999  RETURN
+
.------------------------------------------------------------
.      Print Emergency invoice in bulk
.------------------------------------------------------------
PEINV000  UNPACK    IBPLSKEY,SELPRINT,KEY10
          CALL      RDWBSE1
          BRANCH    OVRCD,PEINV900
.
          MOVE      WBSEPCD,PASSCODE        * Set passcode for PR script
.
          MOVE      "EMRWEB04",PRGID
          MOVE      "Print EMR Invoices         ",PRGNAM
          MOVE      IBPLVISN,ADMISSNO
          MOVE      IBPLURNO,URNUMBER
.
          MOVE      ZERO,EXIT
.
          MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,PEINV900
          MOVE      PVIURNO,KEY8
          CALL      RDMAST1
          CALL      RDPMPX21
          BRANCH    OVRCD,PEINV900
.
          MOVE      ADMISSNO,ADANUMB
          MOVE      PVIURNO,ADAURNO
.
          COMPARE   NINE,PVITYPE
          GOTO      PEINV200 IF NOT EQUAL
.
          MATCH     " 1",PVISYST              * check for Emergency event
          IF        @EQUAL
            MOVE      ADMISSNO,KEY8
            CALL      RDPMEVT1
            IF        @EQUAL
              MOVE      PMEVCCOD,ADACOMP
              MOVE      PMEVADTE,ADADATE
              MOVE      PMEVCCOD,ACLAIM
              MOVE      PFUNDH,AFUNDH
              MOVE      PFNDTB,AFNDTB
              GOTO      PEINV400
            ENDIF
          ENDIF
.
PEINV200  MOVE      ADMISSNO,KEY8
          CALL      RDDETA1
          BRANCH    OVRCD,PEINV900
          MOVE      ADACOMP,ACLAIM
          MOVE      AEDAFUND,AFUNDH
          MOVE      AEDATBLE,AFNDTB
.
PEINV400  CALL      DGTU0000                * Check unknown gst file
.
          MOVE      ZERO,PAGENO
          MOVE      ONE,WEBFLAG
.
          MOVE      ONE,PROGFLAG
          MOVE      ZERO,TOTDAYS
          CALL      AAETBI
          COMPARE   ZERO,GROSSTOT
          GOTO      PEINV900 IF EQUAL
.
          CALL      OPNPRINT
          MOVE      THREE,PROGFLAG
          CALL      AEIV0000                  * Print emergency invoice
          CALL      CLSPRINT
.
          CALL      INVC0000                  * Transfer tobe invoiced comments
          MOVE      ZERO,EXIT
.
PEINV900  MOVE      "COMWEB70",PRGID
          MOVE      "Patient Polling Server         ",PRGNAM
.
PEINV999  RETURN
+
.*********************************************************************
.*                  DGTU0000                                         *
.*   Check if there is anymore Unknown GST item code in patdtraf file*
.*********************************************************************
DGTU0000  MOVE      ADMISSNO,DPTGTADM
          CALL      CDTR0000
          BRANCH    EXIT,DGTU2000          * Found other unknown GST item code
.
.         No item without GST code found. Should not have record in patgtuaf
.         ( or field for unknown MBS/Item GST - PTGTGSTM should be zero)
.
          MOVE      ADMISSNO,KEY8
          CALL      RDPTGTU1
          BRANCH    OVRCD,DGTU9999
.
.         No item without GST Code
.
          IF        PTGTGSTA=1
            MOVE      ZERO,PTGTGSTM         * Set "No" to Unknown Item GST
            CALL      UPPTGTU1
          ELSE
            CALL      DEPTGTU1
          ENDIF
          GOTO      DGTU9999
.
.         Found unknown gst item, should have a record in patgtuaf file
.
DGTU2000  MOVE      ADMISSNO,KEY8
          CALL      RDPTGTU1
          BRANCH    OVRCD,DGTU2200
.
          MOVE      ONE,PTGTGSTM           * Set 'Yes' to Unknown Item GST
          CALL      UPPTGTU1
          GOTO      DGTU9999
.
DGTU2200  MOVE      ADMISSNO,PTGTADMN
          MOVE      ZERO,PTGTGSTA           * Set 'No' to Unknown Accom.GST
          MOVE      ONE,PTGTGSTM           * Set 'Yes' to Unknown Item GST
          PACK      PTGTSPAR,SP70
          CALL      WRPTGTU1
DGTU9999  RETURN
+
.------------------------------------------------------------
.      Unknown MBS/Misc.GST Code
.------------------------------------------------------------
CDTR0000  MOVE      ZERO,EXIT
          PACK      KEY14,DPTGTADM,SP70
          CALL      RSPMMTI1
CDTR1000  CALL      RKPMMTI1
          BRANCH    OVRCD,CDTR9999
.
          MATCH     DPTGTADM,PMMIVISN
          GOTO      CDTR9999 IF NOT EQUAL
.
          MATCH     "1",OPCNCONS            * Enable Consumption type ?
          IF        @EQUAL
            MATCH     "3",PMMIRTYP
            IF        @EQUAL
              REP       " 0",PMMICTYP
              MATCH     "0",PMMICTYP
              GOTO      CDTR1000 IF NOT EQUAL  * Misc.Item Not Used
            ENDIF
          ENDIF
.
          COMPARE   TWO,PMMIGSTA
          GOTO      CDTR1000 IF NOT EQUAL       * not unknown GST
.
          MOVE      ONE,EXIT                    * Found unknown gst item
CDTR9999  RETURN
+
.-------------------------------------------------------------------------
.         Tranfer any tobe invoiced comments to invoiced
.-------------------------------------------------------------------------
INVC0000  PACK      KEY19,ADMISSNO,SP70
          CALL      RSPMICM1
          CALL      RKPMICM1
          BRANCH    OVRCD,INVC9999
          MATCH     ADMISSNO,PMICVISN      * Same visit no?
          GOTO      INVC9999 IF NOT EQUAL
          MATCH     SP70,PMICINVN
          GOTO      INVC9999 IF NOT EQUAL
.
          MOVE      CNEXTINV,PMICINVN
          PACK      PMICUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMICUDAT
          CLOCK     TIME,PMICUTIM                * System time
          MOVE      USERID,PMICUUID              * web user id
          CALL      UPPMICM1
          GOTO      INVC0000
.
INVC9999  RETURN
+
.*****************************************************************************
.         Get Service doctor for Emergency items grouped by Service doctor
.*****************************************************************************
GSDC0000  PACK      KEY31,PINVADM,PINVNO,SP70
          CALL      RDSDTRE3
GSDC1000  CALL      RDKDTRE3
          BRANCH    OVRCD,GSDC9999
          MATCH     PINVADM,ADANUMB
          GOTO      GSDC9999 IF NOT EQUAL
          MATCH     PINVNO,ATINVNO               * Check if Same Invoice
          GOTO      GSDC9999 IF NOT EQUAL
.
          MATCH     SP70,ATDTEDAD
          GOTO      GSDC1000 IF EQUAL
.
          MOVE      ATDTEDAD,SERVDOCT            * get service doctor
GSDC9999  RETURN
+
.------------------------------------------------------------
. Check clinical document type cat wi ind 2 to see if we need
. to update the visit extension file
. cat wi ind 2 = S = PMVXADMP - Adm Paperwork Received
.                C = PMVXCONO - Consent Obtained
.                M = PMVXMEDH - Medical History Received
.------------------------------------------------------------
OBSV0000  MOVE      IBPLVISN,ADMISSNO       * Visit number
          MOVE      IBPLURNO,URNUMBER       * U/R
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMVX11                * Read visit extension file
          BRANCH    OVRCD,OBSV9999
.
          MOVE      ZERO,YESSADMP           * No Adm Paperwork Received
          MOVE      ZERO,YESSCONO           * No Consent Obtained
          MOVE      ZERO,YESSMEDH           * No Medical History Received
.
          PACK      KEY20,URNUMBER,ADMISSNO,SP70
          CALL      RSOBPC1
OBSV1000  CALL      RKOBPC1                 * Check correspondence records
          BRANCH    OVRCD,OBSV8000
.
          MATCH     URNUMBER,OBPCURNO       * Correct U/R
          GOTO      OBSV8000 IF NOT EQUAL
.
          MATCH     ADMISSNO,OBPCCVIS       * Correct U/R
          GOTO      OBSV8000 IF NOT EQUAL
.
          MATCH     "1",OBPCMDEL            * Deleted ?
          GOTO      OBSV1000 IF EQUAL
.
          MATCH     SP70,OBPCCTYP           * Blank type of Correspondence
          GOTO      OBSV1000 IF EQUAL
.
          PACK      KEY5,CATLWI,OBPCCTYP,SP70   * Type of Correspondence cat wi
          CALL      RDCODE1
          BRANCH    OVRCD,OBSV1000
.
          MATCH     "S",TCINDC2
          IF        @EQUAL
            MOVE      ONE,YESSADMP           * Yes Adm Paperwork Received
          ENDIF
.
          MATCH     "C",TCINDC2
          IF        @EQUAL
            MOVE      ONE,YESSCONO           * Yes Consent Obtained
          ENDIF
.
          MATCH     "M",TCINDC2
          IF        @EQUAL
            MOVE      ONE,YESSMEDH           * Yes Medical History Received
          ENDIF
.
          GOTO      OBSV1000
.
OBSV8000  MOVE      YESSADMP,PMVXADMP       * Adm Paperwork Received
          MOVE      YESSCONO,PMVXCONO       * Consent Obtained
          MOVE      YESSMEDH,PMVXMEDH       * Medical History Received
.
          CALL      UPPMVX11                * Update visit extn file
.
OBSV9999  RETURN
.
+
.------------------------------------------------------------
. Reprint Private Practice Invoice
.------------------------------------------------------------
REPRPP00  UNPACK    IBPLSKEY,KEY8,SELPRINT,KEY10
          CALL      RDPRIN1                  * Read invoice number
          BRANCH    OVRCD,REPRPP99
.
          CALL      RDWBSE1
          BRANCH    OVRCD,REPRPP99
.
          MOVE      WBSEPCD,PASSCODE        * Set passcode for PR script
.
          MOVE      "PRIWEB02",PRGID
          MOVE      "Print Private Practice Invoice Server",PRGNAM
          CALL      CLPMSVX1
          CALL      CLPATDSC
.
          CALL      IBACLOCK
          MOVE      ONE,WEBFLAG
          MOVE      PRINDEBT,URNUMBER
          MOVE      URNUMBER,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,REPRPP90
          CALL      RDPMPX21
          BRANCH    OVRCD,REPRPP90
.
          MOVE      PRINNUMB,KEY8         * Invoice number
          PROC      PRIINVRP
.
          MOVE      ZERO,EXIT
.
REPRPP90  MOVE      "COMWEB70",PRGID
          MOVE      "Patient Polling Server         ",PRGNAM
REPRPP99  RETURN
+
.------------------------------------------------------------
.      These are dummy routine's that need to be defined for
.      PATDSBFE,PATINVS.
.------------------------------------------------------------
ADDWRN00
PATSTRYR
          RETURN
+
.----------------------------------------------------------------------
          INC       IBAWEBCD
.
          INC       CLPATICU
          INC       PATITMRD
          INC       PMSPYRTM
          INC       PRTIPROV                   * Print Insurance provider
          INC       NZPSPRTM
          INC       CLNHIMAS                   * Clear nhimasaf file variables
          INC       CMGETTHR
          INC       CHKCMXPT
          INC       PATCALFN
          INC       PATCMSTP
          INC       PATCOMN3
          INC       PATDOCTM
          INC       PATGBCRN                   * I-48227
          INC       PMSPX2TM
          INC       PATMSXTM
          INC       PATVISTM
          INC       PATCLMTM
          INC       PATDSCTM
          INC       PMSHCPTM
          INC       PMSHCGTM
          INC       VISPAYTM
          INC       VISPMATM
          INC       STEPDOWN
          INC       NHOSPDAY
          INC       PATSBTYP     * calculate bed days for a specialty bed
          INC       OTAEINVS
          INC       PATINVHL
          INC       PATINVTL
          INC       PATCATAI
          INC       PATCATBI
          INC       OUTCATBI
          INC       AAECATBI
          INC       WEBDATCD
          INC       DAYOFWEK
          INC       GETALTID
          INC       ICDSCLAS
          INC       GETBFEES
          INC       GETTFEES
          INC       GETCNEFF
          INC       VALCMXFN
          INC       PATIPERH
          INC       PATNAMCD
          INC       PMSEXTTM
          INC       KYPTBANK
          INC       CLPATDTR
          INC       CLOUTDTR
          INC       PATCKEXC
          INC       PATIVMES
          INC       CHNADMTP
          INC       CLVISPAY
          INC       CLPATINV
          INC       PMSOSDTM                * Outstanding Debt alert routine
          INC       PATMCHRD                * Miscellaneous Charges read routine
          INC       PROSTRAK
          INC       CLPMSPTD
          INC       CLPMSPYR
          INC       CLPMSPBR
          INC       CLPMSIDE
          INC       RSHWEBCD
          INC       TFILENAM
          INC       PRTELIGI
          INC       PATINVS
          INC       PRIINVRP
          INC       CLPMSQPX
.
          INC       ACCDIAIO/INC
          INC       AAEDI1IO/INC
          INC       APSMASIO/INC
          INC       COMDEPIO/INC
          INC       COMPARIO/INC
          INC       EMRSITIO/INC
          INC       EMRHISIO/INC
          INC       EMRICDIO/INC
          INC       EMRVCDIO/INC
          INC       IBAGEDIO/INC
          INC       IBAGSTIO/INC
          INC       AAEDEBIO/INC
          INC       AAEDE1IO/INC
          INC       AAEDTRIO/INC
          INC       IBATMDIO/INC
          INC       PATAFEIO/INC
          INC       PATALRIO/INC
          INC       PATASDIO/INC
          INC       PMSABFIO/INC
          INC       PMSPWAIO/INC
          INC       PATCERIO/INC
          INC       PMSCCDIO/INC
          INC       PMSRESIO/INC
          INC       PATCMXIO/INC
          INC       PATCRAIO/INC
          INC       PATCTFIO/INC
          INC       PMSCIDIO/INC
          INC       PMSTLEIO/INC
          INC       PATELGIO/INC
          INC       PATDRGIO/INC
          INC       PATDGWIO/INC
.
          INC       PATFEEIO/INC
          INC       PMSCTCIO/INC
          INC       PMSWX1IO/INC
          INC       PATINLIO/INC
          INC       PATHDFIO/INC
          INC       PATHLFIO/INC
          INC       PATHTRIO/INC
          INC       OUTHTRIO/INC
          INC       EMRHTRIO/INC
          INC       PATIPRIO/INC
          INC       PATALWIO/INC
          INC       PATACHIO/INC
          INC       PATBFEIO/INC
          INC       PATCFAIO/INC
          INC       NZPCMTIO/INC
          INC       NZPIBRIO/INC
          INC       NZPIVBIO/INC
          INC       NZPRBRIO/INC
          INC       NZPRVBIO/INC
          INC       NZPBFEIO/INC
          INC       NZPTFEIO/INC
          INC       PATONHIO/INC
.
          INC       NZPPFEIO/INC
          INC       NZPCFNIO/INC
          INC       MLTCFNIO/INC
          INC       MLTCF1IO/INC
          INC       NZPSPRIO/INC
          INC       NZPEXTIO/INC
          INC       NZPPICIO/INC
          INC       PATCMCIO/INC
          INC       PATCURIO/INC
          INC       PATDO1IO/INC
          INC       PATDTRIO/INC
          INC       PATECHIO/INC
          INC       PATEDSIO/INC
          INC       PATEDTIO/INC
          INC       PATEORIO/INC
          INC       PATFN2IO/INC
          INC       PATFX1IO/INC
          INC       PATFHIIO/INC
          INC       PATIPEIO/INC
          INC       PATIBLIO/INC
          INC       PATINVIO/INC
          INC       PATIOVIO/INC
          INC       PATIRNIO/INC
          INC       NZPIRNIO/INC
          INC       PATITMIO/INC
          INC       PATIN1IO/INC
          INC       PATINMIO/INC
          INC       PATFACIO/INC
          INC       PATFIGIO/INC
          INC       NZPFIGIO/INC
          INC       PATFINIO/INC
          INC       NZPFINIO/INC
          INC       PATFMOIO/INC
          INC       PATFN1IO/INC
          INC       PATGTUIO/INC
          INC       PATCHXIO/INC
          INC       PATMCHIO/INC
          INC       NZPMCHIO/INC
          INC       NZPMXCIO/INC
          INC       PATNHHIO/INC
          INC       PATPR1IO/INC
          INC       PATRATIO/INC
          INC       PATRBLIO/INC
          INC       PATRCAIO/INC
          INC       PATREMIO/INC
          INC       PATTFEIO/INC
          INC       PATWC1IO/INC
          INC       PATWMAIO/INC
          INC       PATWR1IO/INC
          INC       PATWVEIO/INC
          INC       MRTMASIO/INC
          INC       PATLDFIO/INC
          INC       PATLSDIO/INC
          INC       PATOVBIO/INC
          INC       PATVENIO/INC
          INC       PATVADIO/INC
          INC       PATDADIO/INC
          INC       PATJRNIO/INC
          INC       PATRFNIO/INC
          INC       PATRFGIO/INC
          INC       NZPRFNIO/INC
          INC       NZPRDTIO/INC
          INC       PATSCFIO/INC
          INC       PATSGCIO/INC
          INC       PATSRBIO/INC
          INC       OPRARDIO/INC
          INC       OPRPMBIO/INC
          INC       OPRDEAIO/INC
          INC       OPRDECIO/INC
          INC       OPRSESIO/INC
          INC       OPRSRGIO/INC
          INC       OPRTSMIO/INC
          INC       OUTDTRIO/INC
          INC       OUTCTYIO/INC
          INC       OUTCLIIO/INC
          INC       RCPREGIO/INC
          INC       RCPBNKIO/INC
          INC       RCPBDTIO/INC
          INC       RCPDTEIO/INC
          INC       RCPCRSIO/INC
          INC       PATNZRIO/INC
          INC       PMSEXTIO/INC
          INC       PMSCNOIO/INC
          INC       PMSFCIIO/INC
          INC       PMSEVTIO/INC
          INC       PMSBBIIO/INC
          INC       PMSBIIIO/INC
          INC       PMSSINIO/INC
          INC       PMSCMTIO/INC
          INC       PATCMTIO/INC
          INC       PMSECTIO/INC
          INC       PMSMTIIO/INC
          INC       PMSMTEIO/INC
          INC       PMSMPRIO/INC
          INC       PMSPYRIO/INC
          INC       PMSPBRIO/INC
          INC       PMSIVBIO/INC
          INC       PMSIDEIO/INC
          INC       PMSREGIO/INC
          INC       PMSPTDIO/INC
          INC       VISCMTIO/INC
          INC       VISMDTIO/INC
          INC       VISPAYIO/INC
          INC       VISPMAIO/INC
          INC       PRIITMIO/INC
          INC       PATSTAIO/INC
          INC       PATAA1IO/INC
          INC       PMSSGAIO/INC
          INC       PMSICMIO/INC
          INC       PATPARIO/INC
          INC       PMSPRGIO/INC
          INC       PATFAPIO/INC
          INC       PATPFAIO/INC
          INC       PATRGMIO/INC
.
          INC       IBAGSTKY
          INC       IBAGKIKY
          INC       PATGNCMX
          INC       CMXMATRX
          INC       PABXBILL
          INC       PTDRCHRG
          INC       CLNZPPIC
          INC       DGCLIITM
          INC       PMIGTNID
          INC       RTIODAYS
          INC       PRTINVBD
          INC       CLPMSEXT
.
          INC       BRHLCOMN
          INC       CALCAGE
          INC       CLOUTBOA
          INC       CLOUTBB1
          INC       CLOUTRSH
          INC       CLPATCHC
          INC       CLPATDSC
          INC       CLPATRE1
          INC       CLPATTRN
          INC       CLPATVIS
          INC       CLPMSPX2
          INC       CLPMSVX1
          INC       CLVISXDC
          INC       CLWATTX1
          INC       DGCLICAC
          INC       DGCLICEC
          INC       DGCLICCP
          INC       DGCLII13
          INC       DGCLICOC
          INC       DGCLICPA
          INC       DGCLIS15
          INC       DGCLIWLD
          INC       NAMSTRCD
          INC       PATGILOS
          INC       PATM10T9
          INC       PATMASTM
          INC       PATWIS11
          INC       PATWIS12
          INC       PATWIS13
          INC       PATWIS14
          INC       PATWIS15
          INC       PATWIS16
          INC       PATWIS17
          INC       PATWIS18
          INC       PATWIS19
          INC       PATWIS20
          INC       PATWIS21
          INC       WIESCALC
          INC       RHIHDAYS
          INC       WEBGROUP
          INC       GETDRG
          INC       GETEFDRG
          INC       GETCHSCR
          INC       PATADTYP
.
          INC       PRIINVIO/INC
.
          INC       ALLCASIO/INC
          INC       ALLENCIO/INC
          INC       ALLLNKIO/INC
          INC       ALLREFIO/INC
          INC       ALLRNWIO/INC
          INC       ALLQUEIO/INC
          INC       BOKRC1IO/INC
          INC       EMRVISIO/INC
          INC       HL7CISIO/INC
          INC       HL7INBIO/INC
          INC       IBAPOLIO/INC
          INC       MEHDLSIO/INC
          INC       MEHHONIO/INC
          INC       NHIETHIO/INC
          INC       OUTHEDIO/INC
          INC       NHIMASIO/INC
          INC       OBSPCOIO/INC
          INC       OUTBOAIO/INC
          INC       OUTBB1IO/INC
          INC       OUTCANIO/INC
          INC       OUTSESIO/INC
          INC       OUTSITIO/INC
          INC       PATASFIO/INC
          INC       PATCHCIO/INC
          INC       PATCMPIO/INC
          INC       PATECMIO/INC            * Episode Morbidity Changes
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PMSVMTIO/INC
          INC       PATDSCIO/INC
          INC       PATECDIO/INC
          INC       PATECOIO/INC
          INC       PATHSPIO/INC
          INC       PATICDIO/INC
          INC       PATICOIO/INC
          INC       PATICUIO/INC
          INC       PATMA1IO/INC
          INC       PATMI1IO/INC
          INC       PATMMBIO/INC
          INC       PATNIDIO/INC
          INC       PATPGRIO/INC
          INC       PATRE1IO/INC
          INC       PATTRNIO/INC
          INC       PATVISIO/INC
          INC       PATW11IO/INC
          INC       PATW12IO/INC
          INC       PTW12BIO/INC
          INC       PATW13IO/INC
          INC       PATW14IO/INC
          INC       PATW15IO/INC
          INC       PATW16IO/INC
          INC       PATW17IO/INC
          INC       PATW18IO/INC
          INC       PATW19IO/INC
          INC       PATW20IO/INC
          INC       PATW21IO/INC
          INC       PATWIEIO/INC
          INC       PATRDCIO/INC
          INC       PMSHATIO/INC
.         INC       PMSHCPIO/INC
          INC       PMSPX2IO/INC
          INC       PMSQPTIO/INC
          INC       PMSVX1IO/INC
          INC       VISXDCIO/INC
          INC       WATTR1IO/INC
          INC       WATTX1IO/INC
          INC       WEBIHCIO/INC
          INC       PMSEDGIO/INC       * Effective DRG Dates
          INC       PATDDHIO/INC
+

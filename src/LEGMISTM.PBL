.*****************************************************************************
.* Modifications:
.----------------------------------------------------------------------
. V10.11.01 18/08/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments.
.  V9.08.01 08/05/2007  Mike Laming    CAR 137125 HDP 2007 DRG 5.2
.           Mods to PATDGWFD - Add field PTDWDRGV (add to Keys)
.----------------------------------------------------------------------
. Add Admission Field
.----------------------------------------------------------------------
LMIS0000  BRANCH    FLDITMNO,LMIS0100,LMIS0200,LMIS0300,LMIS0400,LMIS0500:
                             LMIS0600,LMIS0700,LMIS0800,LMIS0900,LMIS1000:
                             LMIS1100,LMIS1200,LMIS1300,LMIS1400,LMIS1500:
                             LMIS1600,LMIS1700,LMIS1800,LMIS1900,LMIS2000:
                             LMIS2100,LMIS2200,LMIS2300,LMIS2400,LMIS2500:
                             LMIS2600,LMIS2700,LMIS2800,LMIS2900,LMIS3000:
                             LMIS3100,LMIS3200,LMIS3300,LMIS3400,LMIS3500:
                             LMIS3600,LMIS3700,LMIS3800,LMIS3900,LMIS4000:
                             LMIS4100,LMIS4200,LMIS4300,LMIS4400,LMIS4500:
                             LMIS4600,LMIS4700,LMIS4800,LMIS4900,LMIS5000:
                             LMIS5100,LMIS5200,LMIS5300,LMIS5400,LMIS5500:
                             LMIS5600,LMIS5700,LMIS5800,LMIS5900,LMIS6000:
                             LMIS6100,LMIS6200,LMIS6300,LMIS6400,LMIS6500:
                             LMIS6600,LMIS6700,LMIS6800,LMIS6900,LMIS7000:
                             LMIS7100,LMIS7200,LMIS7300,LMIS7400,LMIS7500:
                             LMIS7600,LMIS7700,LMIS7800,LMIS7900,LMIS8000:
                             LMIS8100,LMIS8200,LMIS8300,LMIS8400,LMIS8500
.
LMIS0100  WRITE     HTMLFILE;LAADMNO;
          GOTO      LMIS9999
.
LMIS0200  MATCH     SP70,LADATE
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          UNPACK    LADATE,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CDAY
          GOTO      LMIS9999 IF EQUAL
          MATCH     "00",CMON
          GOTO      LMIS9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      LMIS9999
.
LMIS0300  MATCH     SP70,LATIME
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LATIME;
          GOTO      LMIS9999
.
LMIS0400  BRANCH    LASTAT,LMIS0410,LMIS0420,LMIS0430,LMIS0440,LMIS0450
LMIS0410  MOVE      "Pre-Admission   ",LTDESC
          GOTO      LMIS0490
LMIS0420  MOVE      "Current         ",LTDESC
          GOTO      LMIS0490
LMIS0430  MOVE      "Discharged      ",LTDESC
          GOTO      LMIS0490
LMIS0440  MOVE      "On-Leave        ",LTDESC
          GOTO      LMIS0490
LMIS0450  MOVE      "Cancelled       ",LTDESC
          GOTO      LMIS0490
LMIS0490  WRITE     HTMLFILE;LTDESC;
          GOTO      LMIS9999
.
LMIS0500  MATCH     SP70,LAWARD
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          PACK      KEY6,LAWARD,SP70
          CALL      RDLGWRD1
          BRANCH    OVRCD,LMIS9999
          WRITE     HTMLFILE;LWBDESC;
          GOTO      LMIS9999
.
LMIS0600  MATCH     SP70,LABED
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LABED;
          GOTO      LMIS9999
.
LMIS0700  MOVE      LADOCTR,DOCTCODE
          CALL      LDCDET00
          GOTO      LMIS9999
.
LMIS0800  MOVE      LADOCTA,DOCTCODE
          CALL      LDCDET00
          GOTO      LMIS9999
.
LMIS0900  MATCH     SP70,LADOCTL
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LADOCTL;
          GOTO      LMIS9999
.
LMIS1000  MOVE      "S ",CATEGORY
          PACK      CODE,LASRCE,SP70
          CALL      LCDITM00 
          GOTO      LMIS9999
.
LMIS1100  MOVE      "A ",CATEGORY
          MOVE      LADTYPE,CODE
          CALL      LCDITM00 
          GOTO      LMIS9999
.
LMIS1200  MOVE      "P ",CATEGORY
          MOVE      LACLSS,CODE
          CALL      LCDITM00 
          GOTO      LMIS9999
.
LMIS1300  MOVE      "CC",CATEGORY
          MOVE      LACARE,CODE
          CALL      LCDITM00 
          GOTO      LMIS9999
.
LMIS1400  PACK      KEY14,LAFUNDH,ZERO,ZERO,ZERO,ZERO,ZERO,ZERO,ZERO,ZERO
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
          ELSE
            WRITE     HTMLFILE;LAFUNDH;
          ENDIF
          GOTO      LMIS9999
.
LMIS1500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,LMIS1510
          WRITE     HTMLFILE;LAFNDTB;      * Table code
          GOTO      LMIS9999

LMIS1510  PACK      KEY14 WITH LAFUNDH,LAFNDTB
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;      * Description of Table
          ELSE
            WRITE     HTMLFILE;LAFNDTB;     * Table code
          ENDIF
          GOTO      LMIS9999
.
LMIS1600  MATCH     SP70,LAFNDMM
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LAFNDMM;
          GOTO      LMIS9999
.
LMIS1700  MOVE      NO,YESNO
          IF        LAELIG=1
            MOVE      YES,YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      LMIS9999
.
LMIS1800  COMPARE   "1",LAVISIT
          GOTO      LMIS1810 IF EQUAL 
.
          COMPARE   "2",LAVISIT
          GOTO      LMIS1820 IF EQUAL 
.
          MOVE      UNK,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      LMIS9999
.
LMIS1810  MOVE      YES,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      LMIS9999
.
LMIS1820  MOVE      NO,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      LMIS9999
.
LMIS1900  COMPARE   "1",LAALERG
          GOTO      LMIS1910 IF EQUAL 
.
          COMPARE   "2",LAALERG
          GOTO      LMIS1920 IF EQUAL 
.
          MOVE      UNK,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      LMIS9999
.
LMIS1910  MOVE      YES,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      LMIS9999
.
LMIS1920  MOVE      NO,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      LMIS9999
.
LMIS2000  COMPARE   "1",LAILLN
          GOTO      LMIS2010 IF EQUAL 
.
          COMPARE   "2",LAILLN
          GOTO      LMIS2020 IF EQUAL 
.
          MOVE      UNK,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      LMIS9999
.
LMIS2010  MOVE      YES,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      LMIS9999
.
LMIS2020  MOVE      NO,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      LMIS9999
.
LMIS2100  MATCH     SP70,LADIAG1
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LADIAG1;
          GOTO      LMIS9999
.
LMIS2200  MATCH     SP70,LADIAG2
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LADIAG2;
          GOTO      LMIS9999
.
LMIS2300  MOVE      LADOCTT,DOCTCODE
          CALL      LDCDET00
          GOTO      LMIS9999
.
LMIS2400  MOVE      "AC",CATEGORY
          MOVE      LACLSSFT,CODE
          CALL      LCDITM00 
          GOTO      LMIS9999
.
LMIS2500  MATCH     SP70,LAMBS
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LAMBS;
          GOTO      LMIS9999
.
LMIS2600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      "CL",CATEGORY
          MOVE      LACLAIM,CODE
          CALL      LGETCD00
          MOVE      ZERO,F1 
          MOVE      KEY1,F1
          BRANCH    F1,LMIS2610,LMIS2620,LMIS2630,LMIS2640
          WRITE     HTMLFILE;LTDESC;
.
LMIS2610  WRITE     HTMLFILE;CODE;
          GOTO      LMIS9999
.
LMIS2620  CALL      LCDSEL00 
          GOTO      LMIS9999
.
LMIS2630  CALL      LCDIND00
          GOTO      LMIS9999 
.
LMIS2640  WRITE     HTMLFILE;LACODE,LTCINDC1,LTCINDC2,LTCINDC3,LTCINDC4:
                                    LTCINDC5,LTCINDC6,LTCINDC7,LTCINDC8:
                                    LTCINDC9,LTCNDC10,LTCNDC11,LTHCSCOD:
                                    LPCDNHCP,LTCFORM6;
          GOTO      LMIS9999
.
LMIS2632  WRITE     HTMLFILE;CODE;
          GOTO      LMIS9999
.
LMIS2700  MOVE      "DC",CATEGORY
          MOVE      LADIET,CODE
          CALL      LCDITM00 
          GOTO      LMIS9999
.
LMIS2800  MOVE      "PO",CATEGORY
          MOVE      LAPLOCCR,CODE
          CALL      LGETCD00
          WRITE     HTMLFILE;LTDESC;
          GOTO      LMIS9999
.
LMIS2900  WRITE     HTMLFILE;LASTAY;
          GOTO      LMIS9999
.
LMIS3000  WRITE     HTMLFILE;LADYHOSP;
          GOTO      LMIS9999
.
LMIS3100  MATCH     SP70,LACOMM1
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LACOMM1;
          GOTO      LMIS9999
.
LMIS3200  MATCH     SP70,LACOMM2
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LACOMM2;
          GOTO      LMIS9999
.
LMIS3300  MOVE      "U1",CATEGORY
          MOVE      LAUSR1,CODE
          CALL      LCDITM00 
          GOTO      LMIS9999
.
LMIS3400  MOVE      "U2",CATEGORY
          MOVE      LAUSR2,CODE
          CALL      LCDITM00
          GOTO      LMIS9999
.
LMIS3500  MOVE      "U3",CATEGORY
          MOVE      LAUSR3,CODE
          CALL      LCDITM00 
          GOTO      LMIS9999
.
LMIS3600  MOVE      "U4",CATEGORY
          MOVE      LAUSR4,CODE
          CALL      LCDITM00 
          GOTO      LMIS9999
.
LMIS3700  MOVE      "U5",CATEGORY
          MOVE      LAUSR5,CODE
          CALL      LCDITM00 
          GOTO      LMIS9999
.
LMIS3800  MOVE      "U6",CATEGORY
          MOVE      LAUSR6,CODE
          CALL      LCDITM00
          GOTO      LMIS9999
.
LMIS3900  MOVE      "U7",CATEGORY
          MOVE      LAUSR7,CODE
          CALL      LCDITM00
          GOTO      LMIS9999
.
LMIS4000  MATCH     SP70,LPTMIPDR
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LPTMIPDR;
          GOTO      LMIS9999
LMIS4100  
..        WRITE     HTMLFILE;PTMIPVIS;
          GOTO      LMIS9999
LMIS4200  
..        WRITE     HTMLFILE;PTMSRFGP;
          GOTO      LMIS9999
LMIS4300  
..        WRITE     HTMLFILE;PTMSGPPC;
          GOTO      LMIS9999
LMIS4400  
..        WRITE     HTMLFILE;PTMSFHAN;
          GOTO      LMIS9999
LMIS4500  
..        WRITE     HTMLFILE;PTMSECRA;
          GOTO      LMIS9999
LMIS4600  
..        WRITE     HTMLFILE;PTMSMGIN;
          GOTO      LMIS9999
LMIS4700  
..        WRITE     HTMLFILE;PTMIGPPT;
          GOTO      LMIS9999
LMIS4800  
..        WRITE     HTMLFILE;PTMIDOFR;
          GOTO      LMIS9999
LMIS4900  
..        WRITE     HTMLFILE;PTMIREFD;
          GOTO      LMIS9999
LMIS5000  
..        WRITE     HTMLFILE;PTMIDFCN;
          GOTO      LMIS9999
LMIS5100  
..        WRITE     HTMLFILE;PTMIPHPU;
          GOTO      LMIS9999
LMIS5200  
..        WRITE     HTMLFILE;PTMIAGNC;
          GOTO      LMIS9999
LMIS5300  
..        WRITE     HTMLFILE;PTMIESSF;
          GOTO      LMIS9999
.
LMIS5400  MOVE      "U8",CATEGORY
          MOVE      LPTMIU08,CODE
          CALL      LCDITM00
          GOTO      LMIS9999
.
LMIS5500  MOVE      "U9",CATEGORY
          MOVE      LPTMIU09,CODE
          CALL      LCDITM00
          GOTO      LMIS9999
.
LMIS5600  MOVE      "V1",CATEGORY
          MOVE      LPTMIU10,CODE
          CALL      LCDITM00
          GOTO      LMIS9999
.
LMIS5700  
..        WRITE     HTMLFILE;PTMIOPER;
          GOTO      LMIS9999
LMIS5800  
..        WRITE     HTMLFILE;PTMIXWRD;
          GOTO      LMIS9999
LMIS5900  
..        WRITE     HTMLFILE;PTMIADOC;
          GOTO      LMIS9999
LMIS6000  
..        WRITE     HTMLFILE;PTMIREGS;
          GOTO      LMIS9999
LMIS6100  
..        WRITE     HTMLFILE;PTMIUYN1;
          GOTO      LMIS9999
LMIS6200  
..        WRITE     HTMLFILE;PTMIUYN2;
          GOTO      LMIS9999
LMIS6300  
..        WRITE     HTMLFILE;PTMIPANO;
          GOTO      LMIS9999
LMIS6400  
..        WRITE     HTMLFILE;PTMIPADT;
          GOTO      LMIS9999
LMIS6500  
..        WRITE     HTMLFILE;PTMIDDIG;
          GOTO      LMIS9999
.
LMIS6600  BRANCH    RESPFLAG,LMIS9999
          MATCH     SP70,PKNAME
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;PKNAME;
          GOTO      LMIS9999
.
LMIS6700  BRANCH    RESPFLAG,LMIS9999
          MATCH     SP70,PKADD1
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;PKADD1;
          GOTO      LMIS9999
.
LMIS6800  BRANCH    RESPFLAG,LMIS9999
          MATCH     SP70,PKADD2
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;PKADD2;
          GOTO      LMIS9999
.
LMIS6900  BRANCH    RESPFLAG,LMIS9999
          MATCH     SP70,PKSUBR
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;PKSUBR;
          GOTO      LMIS9999
.
LMIS7000  BRANCH    RESPFLAG,LMIS9999
          MATCH     SP70,PKPOST
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;PKPOST;
          GOTO      LMIS9999
.
LMIS7100  BRANCH    RESPFLAG,LMIS9999
          MATCH     SP70,PKTELEP
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;PKTELEP;
          GOTO      LMIS9999
.
LMIS7200  BRANCH    RESPFLAG,LMIS9999
          MATCH     SP70,PKTELEB
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;PKTELEB;
          GOTO      LMIS9999
.
LMIS7300  BRANCH    RESPFLAG,LMIS9999
          MATCH     SP70,PKRELP
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;PKRELP;
          GOTO      LMIS9999
.
LMIS7400  MOVE      LAADMNO,KEY8 
          PACK      KEY20,KEY8,VSCMTTYP,SP70
          CALL      RSVSMTX1
LMIS7410  CALL      RKVSMTX1
          BRANCH    OVRCD,LMIS9999
.
          MATCH     KEY8,VSMTVISN
          GOTO      LMIS9999 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMTTYPE
          GOTO      LMIS9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;VSMTCMNT,SP1
          GOTO      LMIS7410
.
LMIS7500  WRITE     HTMLFILE;CLABPRT;
          GOTO      LMIS9999
.
LMIS7600  WRITE     HTMLFILE;LAMEMB;
          GOTO      LMIS9999
.
LMIS7700  WRITE     HTMLFILE;LAMEMBNO;
          GOTO      LMIS9999
.
LMIS7800  MATCH     SP70,LAFNDYY
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LAFNDYY;
          GOTO      LMIS9999
.
LMIS7900  MATCH     SP70,LAFNDCG
          GOTO      LMIS9999 IF EQUAL
          GOTO      LMIS9999 IF EOS
          WRITE     HTMLFILE;LAFNDCG;
          GOTO      LMIS9999
.
LMIS8000  PACK      KEY17,LAMBS,LADATE,SP70
          CALL      PATITMRD
          IF        OVRCD=0
            WRITE     HTMLFILE;IDESC;
          ELSE
            WRITE     HTMLFILE;LAMBS;
          ENDIF
          GOTO      LMIS9999
.
LMIS8100  UNPACK    LPTMIPDR,KEY4,KEY6
          MATCH     SP6,KEY6
          GOTO      LMIS8150 IF EQUAL
.
          PACK      KEY17,LPTMIPDR,LADATE,SP70
          CALL      PATITMRD
          IF        OVRCD=0
            MOVE      IDESC,MBSDESC
            MOVE      SP70,IDESC
            WRITE     HTMLFILE;MBSDESC;
          ELSE
            WRITE     HTMLFILE;LPTMIPDR;
          ENDIF
          GOTO      LMIS9999
.
...S8150  PACK      KEY3,LPTMIPDR
LMIS8150  MOVE      "999",KEY3                                        *I-137125
          PACK      KEY7,KEY4,KEY3,SP10                               *C-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1                * find latest description *I-137125
.         
          IF        OVRCD=0
            MATCH     PTDWDRGV,KEY4         * correct DRG code ?      *I-137125
            IF        @EQUAL
              WRITE     HTMLFILE;PTDWDESC;
            ELSE
              WRITE     HTMLFILE;LPTMIPDR;
            ENDIF
          ELSE
            WRITE     HTMLFILE;LPTMIPDR;
          ENDIF
          GOTO      LMIS9999
.
LMIS8200  WRITE     HTMLFILE;LEGADMNO;
          GOTO      LMIS9999
.
LMIS8300  PACK      KEY8,LEGADMNO,SP70
          CALL      RDLGDAD1
          BRANCH    OVRCD,LMIS9999
.
          PACK      KEY5,LPTDAADT,SP70
          CALL      RDPTVAD1
          BRANCH    OVRCD,LMIS9999
.
          WRITE     HTMLFILE;PTVADESC;   * Admission Transfer Source Desc
          GOTO      LMIS9999
.
LMIS8400  MOVE      "V2",CATEGORY
          MOVE      LPTMIU11,CODE
          CALL      LCDITM00
          GOTO      LMIS9999
.
LMIS8500  READ      CONTROLF,HUND05;*211,PTCNBPAY
          WRITE     HTMLFILE;PTCNBPAY;
          GOTO      LMIS9999
.
LMIS9100  MOVE      FLDITEM,F3    * Check for Link to Doctor Template Page
          IF        F3=1
            UNPACK    DIM127,D1,FLDPARA,DIM127    * Remove Parameter
          ENDIF
.
LMIS9999  RETURN


. *----------------------------------------------------------------------
. * Include Name  :   PMSLEVTM.PBL
. *
. * Function      :   CGI variables for PMSLEVFD - pmslevaf
. *
. * Includes Needed :
. *
. *----------------------------------------------------------------------
.  Modifications Done :
.
.  V10.00.00  28/07/2010  Jill Parkinson CAR 222551
.             Created include
.
.------------------------------------------------------------------------
.   Clear Parameters for labour event table
.------------------------------------------------------------------------
CPPMLV00  MOVE      Z70,PMLEV001
          MOVE      Z70,PMLEV002 
          MOVE      Z70,PMLEV003
          MOVE      Z70,PMLEV004
          MOVE      Z70,PMLEV005
          MOVE      Z70,PMLEV006
          MOVE      Z70,PMLEV007
          MOVE      Z70,PMLEV008
          MOVE      Z70,PMLEV009
.
CPPMLV99  RETURN
+
.------------------------------------------------------------
.   Set Parameters for Labour Event table
.------------------------------------------------------------
SPMLV000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPMLV001,SPMLV002,SPMLV003,SPMLV004,SPMLV005:
                       SPMLV006,SPMLV007,SPMLV008,SPMLV009
.
          MOVE      ONE,EXIT
          GOTO      SPMLV999
.
SPMLV001  PACK      PMLEV001,QRYDATA,SP70
          GOTO      SPMLV999
.
SPMLV002  PACK      PMLEV002,QRYDATA,SP70
          GOTO      SPMLV999
.
SPMLV003  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMLEV003,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMLV999
.
SPMLV004  PACK      PMLEV004,QRYDATA,SP70
          GOTO      SPMLV999
.
SPMLV005  PACK      PMLEV005,QRYDATA,SP70
          GOTO      SPMLV999
.
SPMLV006  PACK      PMLEV006,QRYDATA,SP70
          GOTO      SPMLV999
.
SPMLV007  PACK      PMLEV007,QRYDATA,SP70
          GOTO      SPMLV999
.
SPMLV008  PACK      PMLEV008,QRYDATA,SP70
          GOTO      SPMLV999
.
SPMLV009  PACK      PMLEV009,QRYDATA,SP70
          GOTO      SPMLV999
.
SPMLV999 RETURN
+
.------------------------------------------------------------
. Output labour event details
.------------------------------------------------------------
PMLV0000  BRANCH    FLDITMNO,PMLV0010,PMLV0020,PMLV0030,PMLV0040,PMLV0050:
                             PMLV0060,PMLV0070,PMLV0080,PMLV0090,PMLV0100:
                             PMLV0110,PMLV0120,PMLV0130,PMLV0140,PMLV0150:
                             PMLV0160,PMLV0170
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMLV9999
.
PMLV0010  WRITE     HTMLFILE;PMLVUNIQ;      * Pregnancy Unique Id
          GOTO      PMLV9999
.
PMLV0020  WRITE     HTMLFILE;PMLVADMN;      * Admission Number
          GOTO      PMLV9999
.
PMLV0030  MATCH     PMLVDATE,SP70           * Compication/treatment date
          GOTO      PMLV9999 IF EQUAL
          UNPACK    PMLVDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMLV9999
.
PMLV0040  WRITE     HTMLFILE;PMLVTIME;      * Time
          GOTO      PMLV9999
.
PMLV0050  WRITE     HTMLFILE;PMLVTYPE;      * Category AG,AH,AJ,AK
          GOTO      PMLV9999
.
PMLV0060  MOVE      PMLVTYPE,CATEGORY       * Event Type
          MOVE      PMLVETYP,CODE
          CALL      CODITM00
          GOTO      PMLV9999
.
PMLV0070  MOVE      "AL",CATEGORY           * Event Status
          MOVE      PMLVSTAT,CODE
          CALL      CODITM00
          GOTO      PMLV9999
.
PMLV0080  WRITE     HTMLFILE;PMLVDES1;      * Description 1
          GOTO      PMLV9999
.
PMLV0090  WRITE     HTMLFILE;PMLVDES2;      * Description 2
          GOTO      PMLV9999
.
PMLV0100  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Web User ID rec. creator
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLV0105
          WRITE     HTMLFILE;PMLVWEBC;
          GOTO      PMLV9999
PMLV0105  PACK      KEY10,PMLVWEBC,SP70       * .1
          CALL      RDWBSE1
          BRANCH    OVRCD,PMLV9999
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PMLV9999
.
PMLV0110  MATCH     PMLVDATC,SP70             * Date Record Created
          GOTO      PMLV9999 IF EQUAL
          UNPACK    PMLVDATC,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMLV9999
.
PMLV0120  MATCH     PMLVTIMC,SP70             * Time Record Created
          GOTO      PMLV9999 IF EQUAL
          WRITE     HTMLFILE;PMLVTIMC;
          GOTO      PMLV9999
.
PMLV0130  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Web User ID rec. updated
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMLV0135
          WRITE     HTMLFILE;PMLVWEBU;
          GOTO      PMLV9999
PMLV0135  PACK      KEY10,PMLVWEBU,SP70       * .1
          CALL      RDWBSE1
          BRANCH    OVRCD,PMLV9999
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PMLV9999
.
PMLV0140  MATCH     PMLVDATU,SP70             * Date Record Updated
          GOTO      PMLV9999 IF EQUAL
          UNPACK    PMLVDATU,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMLV9999
.
PMLV0150  MATCH     PMLVTIMU,SP70             * Time Record Created
          GOTO      PMLV9999 IF EQUAL
          WRITE     HTMLFILE;PMLVTIMU;
          GOTO      PMLV9999
.
PMLV0160  CALL      LEVE0000                  * Labour Event  List
          GOTO      PMLV9999
.
PMLV0170  WRITE     HTMLFILE;BRTHUNIQ;
          GOTO      PMLV9999
.
PMLV9999  RETURN
+
.------------------------------------------------------------
.  Update labour event file
.------------------------------------------------------------
MVPMLV00  MATCH     PMLEV001,Z70
          IF        !@EQUAL
            MOVE      PMLEV001,PMLVUNIQ
          ENDIF
.
          MATCH     PMLEV002,Z70
          IF        !@EQUAL
            MOVE      PMLEV002,PMLVADMN
          ENDIF
.
          MATCH     PMLEV003,Z70
          IF        !@EQUAL
            MOVE      PMLEV003,PMLVDATE
          ENDIF
.
          MATCH     PMLEV004,Z70
          IF        !@EQUAL
            MOVE      PMLEV004,PMLVTIME
          ENDIF
.
          MATCH     PMLEV005,Z70
          IF        !@EQUAL
            MOVE      PMLEV005,PMLVTYPE
          ENDIF
.
          MATCH     PMLEV006,Z70
          IF        !@EQUAL
            MOVE      PMLEV006,PMLVETYP
          ENDIF
.
          MATCH     PMLEV007,Z70
          IF        !@EQUAL
            MOVE      PMLEV007,PMLVSTAT
          ENDIF
.
          MATCH     PMLEV008,Z70
          IF        !@EQUAL
            MOVE      PMLEV008,PMLVDES1
          ENDIF
.
          MATCH     PMLEV009,Z70
          IF        !@EQUAL
            MOVE      PMLEV009,PMLVDES2
          ENDIF
.
MVPMLV99  RETURN
+
.------------------------------------------------------------
.  Clear labour event file variables
.------------------------------------------------------------
CLPMLV00  PACK      PMLVUNIQ,SP70
          PACK      PMLVADMN,SP70
          PACK      PMLVDATE,SP70
          PACK      PMLVTIME,SP70
          PACK      PMLVTYPE,SP70
          PACK      PMLVETYP,SP70
          PACK      PMLVSTAT,SP70
          PACK      PMLVDES1,SP70
          PACK      PMLVDES2,SP70
          PACK      PMLVWEBC,SP70
          PACK      PMLVDATC,SP70
          PACK      PMLVTIMC,SP70
          PACK      PMLVWEBU,SP70
          PACK      PMLVDATU,SP70
          PACK      PMLVTIMU,SP70
          PACK      PMLVSPAR,SP70
.
          RETURN
+
.------------------------------------------------------------
.   List of records on pmslevaf
.------------------------------------------------------------
LEVE0000  MATCH     Z70,PREGUNIQ
          GOTO      LEVE9999 IF EQUAL
.
          PACK      KEY39,PREGUNIQ,Z70
          CALL      RSPMLEV1
LEVE0100  CALL      RPPMLEV1
          BRANCH    OVRCD,LEVE9999
.
          MATCH     PREGUNIQ,PMLVUNIQ
          GOTO      LEVE9999 IF NOT EQUAL
.
          CLEAR     HTMLLINK
          APPEND    "javascript:ViewDetails('",HTMLLINK
          APPEND    URNUMBER,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PMLVUNIQ,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PMLVADMN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PMLVDATE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PMLVTIME,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PMLVTYPE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PMLVETYP,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          PACK      RECODESC,SP70
          MOVE      SP70,TDESC
          PACK      KEY5,PMLVTYPE,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,SP70
          ENDIF
          PACK      RECODESC,TDESC,SP70
          MOVE      SP70,TDESC
          PACK      KEY5,PMLVTYPE,PMLVETYP,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,SP70
          ENDIF
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PMLVUNIQ,"#",":
                             "#"",PMLVADMN,"#",":
                             "#"",PMLVDATE,"#",":
                             "#"",PMLVTIME,"#",":
                             "#"",RECODESC,"#",":
                             "#"",PMLVETYP,"#",":
                             "#"",TDESC,"#",":
                             "#"",PMLVSTAT,"#",":
                             "#"",PMLVDES1,"#",":
                             "#"",PMLVDES2,"#",":
                             "#"",PMLVWEBC,"#",":
                             "#"",PMLVDATC,"#",":
                             "#"",PMLVTIMC,"#",":
                             "#"",PMLVWEBU,"#",":
                             "#"",PMLVDATU,"#",":
                             "#"",PMLVTIMU,"#",":
                             "#"",RECODESC,"#");"
.
          GOTO      LEVE0100
.
LEVE9999  RETURN
+


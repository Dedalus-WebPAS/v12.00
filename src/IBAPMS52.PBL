******************************************************************************
.* System         :  Patient Billing                                          *
.* Program        :  IBAPMS52                                                 *
.* Description    :  Upload ABF Weights                                       *
.******************************************************************************
.* Date           :  04/04/2019                                               *
.* Author         :  J.Tan                                                    *
.* Function       :  Upload ABF Weights                                       *
.* Modifications  :                                                           *
.******************************************************************************
.* V11.03.07 12/07/2021  J.Tan     TSK 0923703                                *
.*           Mod Upload MHC value set record to write to keyword file pmsukiaf*
.* V11.03.06 23/05/2023 Thanh T    TSK 0923703                                *
.*           Added Private Patient Service Adjustment % field (PMMHPPSA)      *
.* V11.03.05 22/05/2023 Thanh T    TSK 0923703                                *
.*           Changed MHPW8000 to Insert new pmsvscaf when AMHCC code does not *
.*           exist                                                            *
.* V11.03.04 15/05/2023 Thanh T    TSK 0923703                                *
.*           Added New option to upload Admitted Mental Health Price Weights  *
.*           pmsamhaf data                                                    * 
.* V11.03.03 24/02/2023 Thanh T    TSK 0929764                                *
.*           Changed the end report wording to be more meaningful             *
.*           Total in file to Total Records In File                           *
.*           Total Errors to Total Errors Found                               *
.*           Total Added to Total Records Added                               *
.*           Total Updated to Total Records Updated                           *
.* V11.03.02 21/11/2022 Thanh T    TSK 0906597                                *
.*           Fixed issue with mandatory field are blank, no error is shown    *
.* V11.03.01 14/11/2022 Thanh T    TSK 0906597                                *
.*           Changed SAPW1000 to fix issue with when the non-mandatory field  *
.*           are blank                                                        *
.* V11.02.01 30/09/2022 Thanh T    TSK 0906597                                *
.*           Added New option to upload Admitted Sub-Acute Price              *
.*           Weights pmssawaf data                                            *
.******************************************************************************
.*         V11.01.01 10/08/2021 J.Tan      TSK 0905305                        *
.*                   Replaced 'URG Code' with 'AECC Class' EMR Price weights  *
.*         V11.00.01 20/05/2020 J.Tan      TSK 0890733                        *
.*                   Added HAC 15                                             *
.*         V10.14.04 12/07/2019 Peter Vela TSK 0857392                        *
.*                   Removed Total Added, Total Updated from HAC Baseline, MDC*
.*                   Age and Charlson                                         *
.*         V10.14.03 12/07/2019 Peter Vela TSK 0857392                        *
.*                   Fixed MDC Upload                                         *
.*         V10.14.02 11/07/2019 Peter Vela TSK 0857392                        *
.*                   Added MDC Ventilation,Unknown                            *
.*         V10.14.01 02/07/2019 Peter Vela TSK 0857392                        *
.*                   Added Age 095 - 099                                      *
.*                   Added MDC Mental Diseases & Disorders, Alcohol/Drug Use &*
.*                   Induced Organic Mental Disorder                          *
.*         V10.14.00 18/06/2019 Peter Vela  0857392                           *
.*                   Added date validation in VURG0000                        *
.*                   Changed URG Type of Visit to non mandatory VURG0000      *
.*                   Check for inactive codes for categories ED AA ee         *
.*                   Added alphanumeric validation for MDB Code               *
.*                   Added validation for URG code                            *
.*                   18/06/2019 Peter Vela  0857392                           *
.*                   Changed HACC0000, MDCC0000, CHAC0000, AGEC0000           *
.*                   to skip values instead of the record if                  *
.*                   the value is invalid                                     *
.*                   04/06/2019 Peter Vela  0857392                           *
.*                   Fixed Contract Id validation for HACC0000,MDCC0000       *
.*                   AGEC0000,CHAC0000                                        *
.*                   30/05/2019 Peter Vela  0857392                           *
.*                   Added URG upload                                         *
.*                   28/05/2019 Peter Vela  0857392                           *
.*                   Fixed numeric complexity value validation for HAC        *
.*                   Baseline, MDC, Age, Charlson                             *
.*                   01/05/2019 Peter Vela  0857392                           *
.*                   Created - ABF HAC Baseline Complexity Table              *
.*                   Created - MDC     Detail Complexity                      *
.*                   Created - Age     Detail Complexity                      *
.*                   Created - Charlson Detail Complexity                     *
.*                   04/04/2019 J.Tan   CAR 0857392                           *
.*                   Created - Admitted Acute Price weights                   *
.*                           - Non-Admitted Price weights                     *
.*                           - EMR Department Price weights                   *
.******************************************************************************
.
          INC       STD001FD
.
          INC       IBACONFD/INC
          INC       EMRURGFD/INC            * URG File
          INC       PATCONFD/INC
          INC       PATCODFD/INC            * Codes file
          INC       PMSCIDFD/INC            * Contract ID file
          INC       PATDGWFD/INC            * DRG file
          INC       PMSHACFD/INC            * ABF HAC Baseline Complexity
          INC       PMSHDEFD/INC            * ABF HAC Detail Complexity
          INC       PMSPWAFD/INC            * Admitted Acute Price weights
          INC       OUTPWOFD/INC            * Non-Admitted Price weights
          INC       EMRPWDFD/INC            * Emergency Price weights
          INC       PMSSAWFD/INC            * ABF Sub-Acute Price Weights
          INC       PMSAMHFD/INC            * ABF MH Price Weights
          INC       PMSSNPFD/INC            * AN-SNAP Classification Code
          INC       PMSVSCFD/INC            * Clinical Coding Value Set Codes
          INC       PMSUKIFD/INC            * Key Words file for Value Set ID
.
.         Temporary file for Admitted Acute records which
.         are loaded from the upload file provided by the customer (PROC0000)
.
.         Admitted Acute Upload file
.
ADMPWTXT  FILE       HL7, FIXED=1000        * Upload file for Adm.acute PW
.
.Name     Type     Size     Start
.----     ----     ----     -----
XADMCNTR  DIM       6      Contract ID
XADMDRGC  DIM       4      DRG Code
XADMDRGD  DIM       80     DRG Description
XADMSDPY  DIM       1      Same-Day Payment List
XADMBICU  DIM       1      Bundle ICU
XADMALOS  FORM      6.2    ALOS
XADMLOWB  FORM      4      Lower bound (Inlier Bounds)
XADMUPPB  FORM      4      Upper bound (Inlier Bounds)
XADMPSRV  FORM      3.2    Private Patient Service(Adjust.)%
XADMPAED  FORM      3.2    Paediatric (Adjustment)%
XADMSDAY  FORM      10.4   Same Day (Price Weight)
XADMSSOB  FORM      10.4   Short Stay Outlier Base (PW)
XADMSSOP  FORM      10.4   Short Stay Outlier Per Diem (PW)
XADMINLI  FORM      10.4   Inlier (Price Weight)
XADMLSOP  FORM      10.4   Long Stay Outlier Per Diem (PW)
XADMPPSA  FORM      3.2    Private Patient Service Adjustment %
.End of Record
.
.         Non-Admitted Upload file
.
NADPWTXT  FILE       HL7, FIXED=1000        * Upload file for Non-Adm.PW
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
XNADCNTR  DIM       6      6        1     Contract ID
XNADTIER  DIM       3      3        7     Tier 2 Clinic V5.0 Cat NC
XNADPWEI  FORM      10.4   8        10    Price Weight
.
.         EMR Department Price weight
.
EMRPWTXT  FILE       HL7, FIXED=1000        * Upload file for Non-Adm.PW
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
XPWACNTR  DIM       6      6        1     Contract ID
XPWAURGV  DIM       6      6        7     URG V1.4 Value
XPWAURGD  DIM       80     80       13    URG V1.4 Description
XPWAPWEI  FORM      10.4   8        93    Price Weight
.
.         ABF HAC Baseline Complexity Upload file
.
PMSHATXT  FILE       HL7, FIXED=1000        * Upload file for ABF HAC Baseline 
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
XPMHCNTR  DIM       6      6        1     Contract ID
XPMHHACG  DIM       3      3        7     HAC Group 01=16 Cat Ha
XPMHHACF  DIM       3      3        10    HAC Complexity Field
.                                         001 - Baseline
.                                         002 - Emergency Admission
.                                         003 - ICU Hours
.                                         004 - Admission Transfer Status
.                                         005 - DRG 9 Type Medical
.                                         006 - DRG 9 Type Intervention
.                                         007 - Male
.                                         008 - Female
XPMHHACV  FORM      10.4   8        13    Complexity Value
.
.         MDC Detail Complexity Upload file
.
MDCHDTXT  FILE       HL7, FIXED=1000        * Upload file for MDC Detail
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
XMDDCNTR  DIM       6      6        1     Contract ID
XMDDHACG  DIM       3      3        7     HAC Group 01-16 Cat Ha
XMDDHACT  DIM       3      3        10    HAC Complexity Type
.                                         001 - Charlson
.                                         002 - Age
.                                         003 - MDC
XMDDHACF  DIM       3      3        13    HAC Complexity Field
XMDDCOMV  FORM      10.4   8        16    Complexity Value
.
.         Age Detail Complexity Upload file
.
AGEHDTXT  FILE       HL7, FIXED=1000        * Upload file for Age Detail
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
XAGECNTR  DIM       6      6        1     Contract ID
XAGEHACG  DIM       3      3        7     HAC Group 01-16 Cat Ha
XAGEHACT  DIM       3      3        10    HAC Complexity Type
.                                         001 - Charlson
.                                         002 - Age
.                                         003 - MDC
XAGEHACF  DIM       3      3        13    HAC Complexity Field
XAGECOMV  FORM      10.4   8        16    Complexity Value
.
.         Charlson Detail Complexity Upload file
.
CHAHDTXT  FILE       HL7, FIXED=1000        * Upload file for Charlson Detail
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
XCHACNTR  DIM       6      6        1     Contract ID
XCHAHACG  DIM       3      3        7     HAC Group 01-16 Cat Ha
XCHAHACT  DIM       3      3        10    HAC Complexity Type
.                                         001 - Charlson
.                                         002 - Age
.                                         003 - MDC
XCHAHACF  DIM       3      3        13    HAC Complexity Field
XCHACOMV  FORM      10.4   8        16    Complexity Value
.
.         ABF EMR URG Classification Upload file
.
EMRURTXT  FILE       HL7, FIXED=1000        * Upload file for URG Detail
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
XURGEDAT  DIM       8      8        1     Effective End Date (ccyymmdd)
XURGESTA  DIM       3      3        9     Episode End Status Cat ED
XURGTRIA  DIM       3      3        12    Triage Code Cat AA
XURGVTYP  DIM       3      3        15    Type of Visit Cat ee
XURGMDBC  DIM       30     30       18    MDB Code
XURGURGV  DIM       6      6        48    URG Value
XURGURGD  DIM       80     80       54    URG Description
.
.          Admitted Sub-Acute Price Weights Upload file
.
SUBAWTXT  FILE       HL7, FIXED=1000        * Upload file 
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
XSAWCNTR  DIM       6      6        1     Contract ID
XSAWDRGC  DIM       4      4        7     AN-SNAP Code
XSAWADSC  DIM       80     80       11    AN-SNAP Description
XSAWEDSC  DIM       50     50       91    Episode Type Description
XSAWCCOD  DIM       1      1        141   Care type Cat CC UDF6
XSAWSDOV  DIM       1      1        142   Sameday 
XSAWALOS  FORM      6.2    9        143   Average LOS 
XSAWLBIN  FORM      4      4        152   Lower Bound (Inlier Bounds)
XSAWUBIN  FORM      4      4        156   Upper Bound (Inlier Bounds)
XSAWSDPW  FORM      10.4   15       160   Same Day (Price Weight) 
XSAWSSOP  FORM      10.4   15       175   Short Stay Outlier Per Diem (PW)
XSAWINPW  FORM      10.4   15       190   Same Day (Price Weight) 
XSAWLSOP  FORM      10.4   15       205   Long Stay Outlier Per Diem (PW) 
.
.          Admitted MH Price Weights Upload file
.
AMHPWTXT  FILE       HL7, FIXED=1000        * Upload file
.
.Name     Type      Length Physical Start Description
.----     ----      ------ -------- ----- -----------
XMHWCNTR  DIM       6      6        1     Contract ID
XMHWAMHC  DIM       10     10       7     AMHCC Code
XMHWAMHD  DIM       80     80       17    AMHCC Description
XMHWAVPL  FORM      6.2    9        97    Average Phase Length (Days)
XMHWLOWB  FORM      4      4        106   Lower Bound (Inlier Bounds)
XMHWUPPB  FORM      4      4        120   Upper Bound (Inlier Bounds)
XMHWSSOB  FORM      10.4   15       124   Short Stay Outlier Base (PW)
XMHWSSOP  FORM      10.4   15       139   Short Stay Outlier Per Diem (PW)
XMHWINLI  FORM      10.4   15       154   Inlier (Price Weight)
XMHWLSOP  FORM      10.4   15       169   Long Stay Outlier Per Diem (PW)
XMHWPPSA  FORM      3.2    6        184   Private Patient Service Adjustment%
.
. ----- Program Variables -----
.
ADDCOUNT  FORM      8
CMDLINE   DIM       200
WORKLINE  DIM       200
SPACLINE  INIT      "                                                                                                                                                                                                        "
CMPCOUNT  FORM      3
DIM3      DIM       3
DIM4      DIM       4
DIM15     DIM       15
DIM30     DIM       30
DIM80     DIM       80
DIM100    DIM       100
ERRCOUNT  FORM      8
ERORDESC  DIM       60
ERRFLAG   FORM      1
ERORFLAG  FORM      1
ERRORMSG  DIM       45
ERRORMS1  DIM       70
ERRORMS2  DIM       70
FNAMEI    DIM       500
FLDNAME   DIM       40
.
DINFIELD  DIM       30
DINFIEL1  DIM       100
DINTLEN   FORM      2
DDECLEN   FORM      2
DNEGALLW  FORM      1
DTOTLEN   FORM      2
.
ERRAMHD   DIM       18
FORM3     FORM      3
.
WORKFLD   DIM       30
WORKFLDI  DIM       30
WORKFLDD  DIM       30
.
LINECNTR  FORM      8
OUTFNAME  DIM       8
PATHNAME  DIM       150
SAVKEY20  DIM       20
USERID    DIM       10
UPDCOUNT  FORM      8
.
XFLD0001  DIM       30
XFLD0002  DIM       30
XFLD0003  DIM       80
XFLD0004  DIM       30
XFLD0005  DIM       30
XFLD0006  DIM       30
XFLD0007  DIM       30
XFLD0008  DIM       30
XFLD0009  DIM       30
XFLD0010  DIM       30
XFLD0011  DIM       30
XFLD0012  DIM       30
XFLD0013  DIM       30
XFLD0014  DIM       30
XFLD0015  DIM       30
XFLD0016  DIM       30
XFLD0017  DIM       100
XFLD0018  DIM       100
.
XFLDVERS  DIM       1
XFLDCODE  DIM       3 
XFLDDAYC  DIM       1
VPMHHACV  DIM       15
VMDDCOMV  DIM       15
VAGECOMV  DIM       15
VCHACOMV  DIM       15
.
ALPHANUM  INIT      "a~b~c~d~e~f~g~h~i~j~k~l~m~n~o~p~q~r~s~t~u~v~w~x~y~z~A~B~C~D~E~F~G~H~I~J~K~L~M~N~O~P~Q~R~S~T~U~V~W~X~Y~Z~1~2~3~4~5~6~7~8~9~0~ ~"
MDBALNUM  INIT      "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
.
CISBLANK  INIT      "Is Blank"
CINVALID  INIT      "Invalid"
.
HYPHEN    INIT      "-"
.
PRGID     INIT      "IBAPMS52"
PRGNAM    INIT      "Upload & Update ABF Weights"
VERSION   INIT      "V12.00.00"
+
.******************************************************************************
.*                                  ML0000                                    *
.*                                Main Module                                 *
.******************************************************************************
ML0000    CALL      INIT0000                * Initailize variables & open files
          CALL      KOPT0000                * Keyin Upload or Update option
          BRANCH    EXIT,ML9999
.
          BRANCH    COPTION,ML1000,ML1000,ML1000,ML1000,ML1000:
                            ML1000,ML1000,ML1000,ML1000,ML1000
          GOTO      ML9999
.
ML1000    CALL      KASC0000                * Keyin file
          BRANCH    EXIT,ML9900
.
ML1100    CALL      SCRD0000                * Display screen
.
          CALL      KUSR0000                * Keyin user id
          BRANCH    EXIT,ML0000
.
          CALL      KPTH0000                * Keyin pathname
          BRANCH    EXIT,ML0000
.
          CALL      SFLD0000
          BRANCH    EXIT,ML1100
.
          CALL      PRHD0000                * Print header
.
          CALL      CTOT0000                * Clear total vars
.
          CALL      PROC0000                * with Updating file
.
          CALL      PTOT0000                * Print report totals
.
          GOTO      ML9999
.
ML9900    CALL      HEAD132
          PRINT     *N,"Failed to open upload file. "
.
ML9999    CHAIN     PGM
+
.******************************************************************************
.*                                 INIT0000                                   *
.*                     Initialize Variables & Open Files                      *
.******************************************************************************
INIT0000  CALL      DISPHEAD                * Display screen heading
.
          CALL      IBACLOCK
.
          DISPLAY   *P56:24,"Opening patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"pmscidaf";
          OPEN      PMSCIDA1,"pmscidaf"
.
          DISPLAY   *P64:24,"patdgwaf";
          OPEN      PATDGWA1,"patdgwaf"
.
          DISPLAY   *P64:24,"pmshacaf";
          OPEN      PMSHACA1,"pmshacaf"
.
          DISPLAY   *P64:24,"pmshdeaf";
          OPEN      PMSHDEA1,"pmshdeaf"
.
          DISPLAY   *P64:24,"pmspwaaf";
          OPEN      PMSPWAA1,"pmspwaaf"
.
          DISPLAY   *P64:24,"outpwoaf";
          OPEN      OUTPWOA1,"outpwoaf"
.
          DISPLAY   *P64:24,"emrpwdaf";
          OPEN      EMRPWDA1,"emrpwdaf"
          OPEN      EMRPWDA2,"emrpwdaf"
.
          DISPLAY   *P64:24,"emrurgaf";
          OPEN      EMRURGA1,"emrurgaf"
.
          DISPLAY   *P64:24,"pmssawaf";
          OPEN      PMSSAWA1,"pmssawaf"
.
          DISPLAY   *P64:24,"pmssnpaf";
          OPEN      PMSSNPA1,"pmssnpaf"
.
          DISPLAY   *P64:24,"pmsamhaf";
          OPEN      PMSAMHA1,"pmsamhaf"
.
          DISPLAY   *P64:24,"pmsvscaf";
          OPEN      PMSVSCA1,"pmsvscaf"
.
          OPEN      CONTROLF,"controlf"
INIT9999  RETURN
+
.******************************************************************************
.*                                 KOPT0000                                   *
.*                            Choose Upload or Update files                   *
.******************************************************************************
KOPT0000  MOVE      ZERO,EXIT
          MOVE      ZERO,COPTION
          DISPLAY   *P1:4,*EF:
                    *P1:4,*V2LON,"0",*HOFF," = Exit":
                    *P1:5,*V2LON,"1",*HOFF," = Upload Admitted Acute PW":
                    *P1:6,*V2LON,"2",*HOFF," = Upload Non-Admitted Weights":
                    *P1:7,*V2LON,"3",*HOFF," = Upload Emergency Department":
                    *P1:8,*V2LON,"4",*HOFF," = Upload HAC Baseline Complexity":
                                           " Scores":
                    *P1:9,*V2LON,"5",*HOFF," = Upload HAC Detail Complexity":
                                           " Scores":
                    *P1:9,*V2LON,"5",*HOFF," = Upload MDC Complexity Scores":
                    *P1:10,*V2LON,"6",*HOFF," = Upload Age Complexity Scores":
                    *P1:11,*V2LON,"7",*HOFF," = Upload Charlson Complexity":
                                            " Scores":
                    *P1:12,*V2LON,"8",*HOFF," = Upload URG Classifications":
                    *P1:13,*V2LON,"9",*HOFF," = Upload Admitted Sub-Acute":
                                            " Price Weights":   
                    *P1:14,*V2LON,"10",*HOFF," = Upload Admitted Mental":
                                            " Health Price Weights";   
.
          DISPLAY   *P1:16,"Select Option : ";
.
KOPT1000  KEYIN     *P17:16,*V2LON,COPTION;
          BRANCH    COPTION,KOPT9999,KOPT9999,KOPT9999,KOPT9999,KOPT9999:
                            KOPT9999,KOPT9999,KOPT9999,KOPT9999,KOPT9999
.
          COMPARE   ZERO,COPTION
          GOTO      KOPT9000 IF EQUAL
          BEEP
          GOTO      KOPT1000
.
KOPT9000  MOVE      ONE,EXIT
KOPT9999  RETURN
+
.******************************************************************************
.*                                 KASCI000                                   *
.*                            Keyin file                                 *
.******************************************************************************
KASC0000  MOVE      ZERO,EXIT
          PACK      FNAMEI WITH SP70,SP70,SP70
.
          IF        COPTION=1
            DISPLAY   *P20:17,*EF,"Admitted Acute PW Load File";
          ENDIF
          IF        COPTION=2
            DISPLAY   *P20:17,*EF,"Non-Admitted PW Load File";
          ENDIF
          IF        COPTION=3
            DISPLAY   *P20:17,*EF,"EMR Department PW Load File";
          ENDIF
          IF        COPTION=4
            DISPLAY   *P20:17,*EF,"ABF HAC Baseline Complexity Load File";
          ENDIF
          IF        COPTION=5
            DISPLAY   *P20:17,*EF,"MDC Complexity Load File";
          ENDIF
          IF        COPTION=6
            DISPLAY   *P20:17,*EF,"Age Complexity Load File";
          ENDIF
          IF        COPTION=7
            DISPLAY   *P20:17,*EF,"Charlson Complexity Load File";
          ENDIF
          IF        COPTION=8
            DISPLAY   *P20:17,*EF,"URG Classifications Load File";
          ENDIF
          IF        COPTION=9
            DISPLAY   *P20:17,*EF,"Admitted Sub-Acute Price Weights Load File";
          ENDIF
          IF        COPTION=10
            DISPLAY   *P20:17,*EF,"Admitted Mental Health Price Weights Load File";
          ENDIF
.
          KEYIN     *P1:18,*EL,"Keyin Path & File Name : ",*V2LON,FNAMEI
.
          PACK      FNAMEI,FNAMEI,SP70,SP70,SP70
.
          MATCH     SP70,FNAMEI
          GOTO      KASC9000 IF EQUAL
.
          SCAN      ".txt",FNAMEI
          IF        !@EQUAL
            SQUEEZE   FNAMEI
            ENDSET    FNAMEI
            APPEND    ".txt",FNAMEI      * add ".txt" if there is a path
            APPEND    SP70,FNAMEI
            RESET     FNAMEI
          ENDIF
          RESET     FNAMEI
.
          IF        COPTION=1
            DISPLAY   *P26:16,*V2LON,*EL,FNAMEI;
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      ADMPWTXT,FNAMEI
            TRAPCLR   IO
            BRANCH    OVRCD,KASC8000
          ENDIF
.
          IF        COPTION=2
            DISPLAY   *P26:16,*V2LON,*EL,FNAMEI;
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      NADPWTXT,FNAMEI
            TRAPCLR   IO
            BRANCH    OVRCD,KASC8000
          ENDIF
.
          IF        COPTION=3
            DISPLAY   *P26:18,*V2LON,*EL,FNAMEI;
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      EMRPWTXT,FNAMEI
            TRAPCLR   IO
            BRANCH    OVRCD,KASC8000
          ENDIF
.
          IF        COPTION=4
            DISPLAY   *P26:18,*V2LON,*EL,FNAMEI;
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      PMSHATXT,FNAMEI
            TRAPCLR   IO
            BRANCH    OVRCD,KASC8000
          ENDIF
.
          IF        COPTION=5
            DISPLAY   *P26:18,*V2LON,*EL,FNAMEI;
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      MDCHDTXT,FNAMEI
            TRAPCLR   IO
            BRANCH    OVRCD,KASC8000
          ENDIF
.
          IF        COPTION=6
            DISPLAY   *P26:18,*V2LON,*EL,FNAMEI;
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      AGEHDTXT,FNAMEI
            TRAPCLR   IO
            BRANCH    OVRCD,KASC8000
          ENDIF
.
          IF        COPTION=7
            DISPLAY   *P26:18,*V2LON,*EL,FNAMEI;
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      CHAHDTXT,FNAMEI
            TRAPCLR   IO
            BRANCH    OVRCD,KASC8000
          ENDIF
.
          IF        COPTION=8
            DISPLAY   *P26:18,*V2LON,*EL,FNAMEI;
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      EMRURTXT,FNAMEI
            TRAPCLR   IO
            BRANCH    OVRCD,KASC8000
          ENDIF
.
          IF        COPTION=9
            DISPLAY   *P26:18,*V2LON,*EL,FNAMEI;
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      SUBAWTXT,FNAMEI
            TRAPCLR   IO
            BRANCH    OVRCD,KASC8000
          ENDIF
.
          IF        COPTION=10
            DISPLAY   *P26:18,*V2LON,*EL,FNAMEI;
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      AMHPWTXT,FNAMEI
            TRAPCLR   IO
            BRANCH    OVRCD,KASC8000
          ENDIF
.
          CALL      KOUT0000                * Keyin output file
          BRANCH    EXIT,KASC9000
.
          CALL      EXCUS000
          MOVE      ZERO,EXIT
          GOTO      KASC9999
.
KASC8000  DISPLAY   *P1:24,*EL,*B,"File not found.  ";
          CALL      HITENTER
          GOTO      KASC0000
.
KASC9000  MOVE      ONE,EXIT
.
KASC9999  RETURN
+
.******************************************************************************
.*                                 SCRD0000                                   *
.*                            Screen display                                  *
.******************************************************************************
SCRD0000  DISPLAY   *P1:20,*EF:
                    *P1:20," 1. Keyin User id      :":
                    *P1:21," 2. Keyin Path name    :";
SCRD9999  RETURN
+
.******************************************************************************
.*                                  KUSR0000                                  *
.*                     Keyin user id                                          *
.******************************************************************************
KUSR0000  KEYIN     *P26:20,*EL,*V2LON,USERID;
          PACK      USERID,USERID,SP70
          MATCH     SP70,USERID
          GOTO      KUSR9500 IF EQUAL
.
          MOVE      ZERO,EXIT
          GOTO      KUSR9999
.
KUSR9500  MOVE      ONE,EXIT
KUSR9999  RETURN
+
.******************************************************************************
.*                                  KPTH0000                                  *
.*                     Keyin path name                                        *
.******************************************************************************
KPTH0000  PACK      PATHNAME,SP70,SP70,SP70
          KEYIN     *P26:21,*EL,*V2LON,PATHNAME;
          ENDSET    PATHNAME
          APPEND    SP70,PATHNAME
          APPEND    SP70,PATHNAME
          APPEND    SP70,PATHNAME
          RESET     PATHNAME
.
.         PACK      PATHNAME,PATHNAME,SP70,SP70,SP70
          MATCH     SP70,PATHNAME
          GOTO      KPTH9500 IF EQUAL
.
          MOVE      ZERO,EXIT
          GOTO      KPTH9999
.
KPTH9500  MOVE      ONE,EXIT
KPTH9999  RETURN
+
.******************************************************************************
.*                                  KOUT0000                                  *
.*                     Keyin output file                                      *
.******************************************************************************
KOUT0000  DISPLAY   *P1:19,"Keyin Output file :";
.
          KEYIN     *P26:19,*EL,*V2LON,OUTFNAME;
          PACK      OUTFNAME,OUTFNAME,SP70
          MATCH     SP70,OUTFNAME
          GOTO      KOUT9500 IF EQUAL
.
          MOVE      ZERO,EXIT
          GOTO      KOUT9999
.
KOUT9500  MOVE      ONE,EXIT
KOUT9999  RETURN
+
.******************************************************************************
.*                                  SFLD0000                                  *
.*                        Select Field                                        *
.******************************************************************************
SFLD0000  CALL      MAINQST                 * Select Item, (P)ost, (C)ancel ?
.
          COMPARE   ZERO,CCITEM
          GOTO      SFLD9999 IF EQUAL
          GOTO      SFLD1000 IF LESS
.
          MOVE      ZERO,EXIT
.
          PERFORM   CCITEM,KUSR0000:             * Keyin user id
                           KPTH0000              * Keyin pathname
          BRANCH    EXIT,SFLD9999
          GOTO      SFLD0000
.
SFLD1000  MOVE      ONE,EXIT
SFLD9999  RETURN
+
.******************************************************************************
.*                                  PRHD0000                                  *
.*                        Print the selection details                         *
.******************************************************************************
PRHD0000  CALL      HEAD132
.
          BRANCH    COPTION,PRHD1000,PRHD2000,PRHD3000,PRHD4000,PRHD5000:
                            PRHD6000,PRHD7000,PRHD8000,PRHD8100,PRHD8200
          GOTO      PRHD9999
.
PRHD1000  PRINT     *N,"Upload Admitted Acute Price Weights"
.
          PRINT     *N,"Date     : ",CDATE:
                    *N,"Time     : ",CTIMEIS:
                    *N,"User ID  : ",USERID
.
          PRINT     *N,"Admitted Acute Price Weight Load file         : ":
                    *N,"     ",PATHNAME
          CALL      UND132
.
          PRINT     *1,"| Line No.",*12,"|Error Messages",*59,"|Contract ID":
                    *71,"|DRG Code",*80,"|DRG Description":
                    *132,"|"
          GOTO      PRHD9000
.
PRHD2000  PRINT     *N,"Upload Non-Admitted Price Weights"
.
          PRINT     *N,"Date     : ",CDATE:
                    *N,"Time     : ",CTIMEIS:
                    *N,"User ID  : ",USERID
.
          PRINT     *N,"Non-Admitted Price Weight Load file         : ":
                    *N,"     ",PATHNAME
          CALL      UND132
.
          PRINT     *1,"| Line No.",*12,"|Error Messages",*59,"|Contract ID":
                    *71,"|Tier 2",*80,"| Price Weight":
                    *132,"|"
          GOTO      PRHD9000
.
PRHD3000  PRINT     *N,"Upload Emergency Department Price Weights"
.
          PRINT     *N,"Date     : ",CDATE:
                    *N,"Time     : ",CTIMEIS:
                    *N,"User ID  : ",USERID
.
          PRINT     *N,"Emergency Department Price Weight Load file         : ":
                    *N,"     ",PATHNAME
          CALL      UND132
.
          PRINT     *1,"| Line No.",*12,"|Error Messages",*59,"|Contract ID":
.                   *71,"|URG Code",*82,"|URG Description":
                    *71,"|AECC Cls",*82,"|AECC Description":
                    *132,"|"
          GOTO      PRHD9000
.
PRHD4000  PRINT     *N,"Upload ABF HAC Baseline Complexity"
.
          PRINT     *N,"Date     : ",CDATE:
                    *N,"Time     : ",CTIMEIS:
                    *N,"User ID  : ",USERID
.
          PRINT     *N,"ABF HAC Baseline Complexity Load file         : ":
                    *N,"     ",PATHNAME
          CALL      UND132
.
          PRINT     *1,"| Line No.",*12,"|Error Messages",*59,"|Contract ID":
                    *71,"|HAC Grp",*80,"|HAC Complexity Field":
                    *110,"| Complexity Value":
                    *132,"|"
          GOTO      PRHD9000
.
PRHD5000  PRINT     *N,"Upload MDC Complexity"
.
          PRINT     *N,"Date     : ",CDATE:
                    *N,"Time     : ",CTIMEIS:
                    *N,"User ID  : ",USERID
.
          PRINT     *N,"MDC Complexity Load file         : ":
                    *N,"     ",PATHNAME
          CALL      UND132
.
          PRINT     *1,"| Line No.",*12,"|Error Messages",*59,"|Contract ID":
                    *71,"|HAC Grp",*80,"|HAC Cm Ty":
                    *90,"| HAC Cmp":
                    *100,"| Complexity Val":
                    *132,"|"
          GOTO      PRHD9000
.
PRHD6000  PRINT     *N,"Upload Age Complexity"
.
          PRINT     *N,"Date     : ",CDATE:
                    *N,"Time     : ",CTIMEIS:
                    *N,"User ID  : ",USERID
.
          PRINT     *N,"Age Complexity Load file         : ":
                    *N,"     ",PATHNAME
          CALL      UND132
.
          PRINT     *1,"| Line No.",*12,"|Error Messages",*59,"|Contract ID":
                    *71,"|HAC Grp",*80,"|HAC Cm Ty":
                    *90,"| HAC Cmp":
                    *100,"| Complexity Val":
                    *132,"|"
          GOTO      PRHD9000
.
PRHD7000  PRINT     *N,"Upload Charlson Complexity"
.
          PRINT     *N,"Date     : ",CDATE:
                    *N,"Time     : ",CTIMEIS:
                    *N,"User ID  : ",USERID
.
          PRINT     *N,"Charlson Complexity Load file         : ":
                    *N,"     ",PATHNAME
          CALL      UND132
.
          PRINT     *1,"| Line No.",*12,"|Error Messages",*59,"|Contract ID":
                    *71,"|HAC Grp",*80,"|HAC Cm Ty":
                    *90,"| HAC Cmp":
                    *100,"| Complexity Val":
                    *132,"|"
          GOTO      PRHD9000
.
PRHD8000  PRINT     *N,"Upload URG Classifications"
.
          PRINT     *N,"Date     : ",CDATE:
                    *N,"Time     : ",CTIMEIS:
                    *N,"User ID  : ",USERID
.
          PRINT     *N,"URG Classifications Load file         : ":
                    *N,"     ",PATHNAME
          CALL      UND132
.
          PRINT     *1,"| Line No.",*12,"|Error Messages",*59,"|End Date":
                    *71,"|End Stt",*80,"|Triage Cd":
                    *90,"| Typ Vis":
                    *100,"| MDB Code      ":
                    *132,"|":
                    *N,*1,"| URG Val",*12,"| URG Description":
                    *132,"|"
   
          GOTO      PRHD9000
.
PRHD8100  PRINT     *N,"Upload ABF Sub-Acute Price Weights"
.
          PRINT     *N,"Date     : ",CDATE:
                    *N,"Time     : ",CTIMEIS:
                    *N,"User ID  : ",USERID
.
          PRINT     *N,"ABF Sub-Acute Price Weights Load file : ":
                    *N,"     ",PATHNAME
          CALL      UND132
.
          PRINT     *1,"| Line No.",*12,"|Error Messages",*89,"|Contract ID":
                    *101,"|AN-SNAP Code",*114,"|Care Type":
                    *132,"|"
.
          GOTO      PRHD9000
.
PRHD8200  PRINT     *N,"Upload ABF Mental Health Price Weights"
.
          PRINT     *N,"Date     : ",CDATE:
                    *N,"Time     : ",CTIMEIS:
                    *N,"User ID  : ",USERID
.
          PRINT     *N,"ABF Mental Health Price Weights Load file : ":
                    *N,"     ",PATHNAME
          CALL      UND132
.
          PRINT     *1,"| Line No.",*12,"|Error Messages",*89,"|Contract ID":
                    *101,"|AMHCC Code",*112,"|AMHCC Description":
                    *132,"|"
.
          GOTO      PRHD9000
.
PRHD9000  CALL      UND132
          GOTO      PRHD9999
.
PRHD9999  RETURN
+
.******************************************************************************
.*                                  PROC0000                                  *
.*                        Generate ABF Weight tables                          *
.******************************************************************************
PROC0000  MOVE      ZERO,LINECNTR
.
          BRANCH    COPTION,PROC1000,PROC2000,PROC3000,PROC4000,PROC5000:
                            PROC6000,PROC7000,PROC8000,PROC8100,PROC8200
.
PROC1000  CALL      ADMA0000         * Process Admitted Acute Price weight
          GOTO      PROC9999
.
PROC2000  CALL      NADM0000         * Process Non-Admitted Price weight
          GOTO      PROC9999
.
PROC3000  CALL      EMRD0000         * Process Emergency Price weight
          GOTO      PROC9999
.
PROC4000  CALL      HACC0000         * Process ABF HAC Baseline Complexity
          GOTO      PROC9999
.
PROC5000  CALL      MDCC0000         * Process MDC Complexity
          GOTO      PROC9999
.
PROC6000  CALL      AGEC0000         * Process Age Complexity
          GOTO      PROC9999
.
PROC7000  CALL      CHAC0000         * Process Charslon Scores
          GOTO      PROC9999
.
PROC8000  CALL      URGC0000         * Process URG Classifications
          GOTO      PROC9999
.
PROC8100  CALL      SAPW0000         * Process Admitted Sub-Acute Price Weights
          GOTO      PROC9999
.
PROC8200  CALL      MHPW0000         * Process Admitted MH Price Weights
          GOTO      PROC9999
.
PROC9999  RETURN
+
.******************************************************************************
.*                                  ADMA0000                                  *
.*                        Generate Admitted Acute PW                          *
.******************************************************************************
ADMA0000  OPEN      ADMPWTXT,FNAMEI
.
ADMA1000  READ      ADMPWTXT,SEQ;XFLD0001,XFLD0002,XFLD0003,XFLD0004,XFLD0005:
                                 XFLD0006,XFLD0007,XFLD0008,XFLD0009,XFLD0010:
                                 XFLD0011,XFLD0012,XFLD0013,XFLD0014,XFLD0015
          GOTO      ADMA9000 IF OVER
.
          PACK      XADMCNTR,XFLD0001,SP70
          MATCH     SP70,XADMCNTR
          GOTO      ADMA1000 IF EQUAL
.
          ADD       ONE,LINECNTR            * Text file line counter for error
          CALL      PFLD0000                * pack fields with spaces
.
          PACK      XADMDRGC,XFLD0002,SP70
          PACK      XADMDRGD,XFLD0003,SP70
.
          MOVE      "0",XADMSDPY             * default to '0'
          PACK      KEY1,XFLD0004,SP70
          REP       "Y1",KEY1
          MATCH     "1",KEY1
          IF        @EQUAL
            MOVE      "1",XADMSDPY           * same day payment list
          ENDIF
.
          MOVE      "0",XADMBICU             * default to '0'
          PACK      KEY1,XFLD0005,SP70
          MATCH     "1",KEY1
          IF        @EQUAL
            MOVE      "1",XADMBICU           * bundle ICU
          ENDIF
.
          CALL      VALD0000                 * Validate fields
          BRANCH    ERRFLAG,ADMA1000
.
          MOVE      ZERO,XADMALOS
          SQUEEZE   XFLD0006
          MOVE      XFLD0006,XADMALOS        * los
.
          MOVE      ZERO,XADMLOWB
          SQUEEZE   XFLD0007
          MOVE      XFLD0007,XADMLOWB        * lower bound
.
          MOVE      ZERO,XADMUPPB
          SQUEEZE   XFLD0008
          MOVE      XFLD0008,XADMUPPB        * upper bound
.
          MOVE      ZERO,XADMPSRV
          SQUEEZE   XFLD0009
          MOVE      XFLD0009,XADMPSRV        * private patient service
.
          MOVE      ZERO,XADMPAED
          SQUEEZE   XFLD0010
          MOVE      XFLD0010,XADMPAED        * paeditric
.
          MOVE      ZERO,XADMSDAY
          SQUEEZE   XFLD0011
          MOVE      XFLD0011,XADMSDAY        * same day
.
          MOVE      ZERO,XADMSSOB
          SQUEEZE   XFLD0012
          MOVE      XFLD0012,XADMSSOB        * short stay outlier base
.
          MOVE      ZERO,XADMSSOP
          SQUEEZE   XFLD0013
          MOVE      XFLD0013,XADMSSOP        * short stay outlier per diem
.
          MOVE      ZERO,XADMINLI
          SQUEEZE   XFLD0014
          MOVE      XFLD0014,XADMINLI        * inlier
.
          MOVE      ZERO,XADMLSOP
          SQUEEZE   XFLD0015
          MOVE      XFLD0015,XADMLSOP        * long stay outlier per diem
.
          CALL      CLPMSPWA                 * clear fields
.
          PACK      KEY10,XADMCNTR,XADMDRGC
          CALL      RDPMPWA1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMPWCUID
            CALL      IBACLOCK
            PACK      PMPWCDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMPWCDAT
            MOVE      CTIMEIS,PMPWCTIM
            CALL      WRPMPWA1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMPWUUID
            CALL      IBACLOCK
            PACK      PMPWUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMPWUDAT
            MOVE      CTIMEIS,PMPWUTIM
            CALL      UPPMPWA1
          ENDIF
.
          GOTO      ADMA1000
.
ADMA9000  CLOSE     ADMPWTXT
ADMA9999  RETURN
+
.******************************************************************************
.*                                  NADM0000                                  *
.*                        Generate Non Admitted PW                            *
.******************************************************************************
NADM0000  OPEN      NADPWTXT,FNAMEI
.
NADM1000  READ      NADPWTXT,SEQ;XFLD0001,XFLD0002,XFLD0003
          GOTO      NADM9000 IF OVER
.
          PACK      XNADCNTR,XFLD0001,SP70
          MATCH     SP70,XNADCNTR
          GOTO      NADM1000 IF EQUAL
.
          ADD       ONE,LINECNTR            * Text file line counter for error
          CALL      PFLD0000                * pack fields with spaces
.
          PACK      XNADTIER,XFLD0002,SP70
.
          MOVE      ZERO,XNADPWEI
          SQUEEZE   XFLD0003
          MOVE      XFLD0003,XNADPWEI        * Price weight
.
          CALL      VALD0000                 * Validate fields
          BRANCH    ERRFLAG,NADM1000
.
          CALL      CLOUTPWO                 * clear fields
.
          PACK      KEY9,XNADCNTR,XNADTIER
          CALL      RDOTPWO1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,OTPWCUID
            CALL      IBACLOCK
            PACK      OTPWCDAT,CCC,CYY,CMM,CDD
            REP       " 0",OTPWCDAT
            MOVE      CTIMEIS,OTPWCTIM
            CALL      WROTPWO1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,OTPWUUID
            CALL      IBACLOCK
            PACK      OTPWUDAT,CCC,CYY,CMM,CDD
            REP       " 0",OTPWUDAT
            MOVE      CTIMEIS,OTPWUTIM
            CALL      UPOTPWO1
          ENDIF
.
          GOTO      NADM1000
.
NADM9000  CLOSE     NADPWTXT
NADM9999  RETURN
+
.******************************************************************************
.*                                  EMRD0000                                  *
.*                    Generate Emergency Price weight                         *
.******************************************************************************
EMRD0000  OPEN      EMRPWTXT,FNAMEI
.
EMRD1000  READ      EMRPWTXT,SEQ;XFLD0001,XFLD0002,XFLD0003,XFLD0004
          GOTO      EMRD9000 IF OVER
.
          PACK      XPWACNTR,XFLD0001,SP70
          MATCH     SP70,XPWACNTR
          GOTO      EMRD1000 IF EQUAL
.
          ADD       ONE,LINECNTR            * Text file line counter for error
          CALL      PFLD0000                * pack fields with spaces
.
          PACK      XPWAURGV,XFLD0002,SP70
          PACK      XPWAURGD,XFLD0003,SP70
.
          MOVE      ZERO,XPWAPWEI
          SQUEEZE   XFLD0004
          MOVE      XFLD0004,XPWAPWEI        * Price weight
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,EMRD1000
.
          CALL      CLEMRPWD                 * clear fields
.
          PACK      KEY12,XPWACNTR,XPWAURGV
          CALL      RDEMPWD1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,EMPWCUID
            CALL      IBACLOCK
            PACK      EMPWCDAT,CCC,CYY,CMM,CDD
            REP       " 0",EMPWCDAT
            MOVE      CTIMEIS,EMPWCTIM
            CALL      WREMPWD1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,EMPWUUID
            CALL      IBACLOCK
            PACK      EMPWUDAT,CCC,CYY,CMM,CDD
            REP       " 0",EMPWUDAT
            MOVE      CTIMEIS,EMPWUTIM
            CALL      UPEMPWD1
          ENDIF
.
          GOTO      EMRD1000
.
EMRD9000  CLOSE     EMRPWTXT
EMRD9999  RETURN
+
.******************************************************************************
.*                                  HACC0000                                  *
.*                        Generate ABF HAC Baseline Complexity                *
.******************************************************************************
HACC0000  OPEN      PMSHATXT,FNAMEI
          MOVE      ZERO,CMPCOUNT
.
HACC1000  READ      PMSHATXT,SEQ;XFLD0001,XFLD0002,XFLD0003,XFLD0004,XFLD0005:
                                 XFLD0006,XFLD0007,XFLD0008,XFLD0009,XFLD0010:
                                 XFLD0011,XFLD0012,XFLD0013,XFLD0014,XFLD0015:
                                 XFLD0016
          GOTO      HACC9000 IF OVER
.
          PACK      WORKLINE,XFLD0001,XFLD0002,XFLD0003,XFLD0004,XFLD0005:
                             SP70,SP70,SP70
          MATCH     SPACLINE,WORKLINE
          GOTO      HACC1000 IF EQUAL
.
          PACK      XPMHCNTR,XFLD0002,SP70
.         MATCH     SP70,XPMHCNTR
.         GOTO      HACC1000 IF EQUAL
.
          ADD       ONE,LINECNTR            * Text file line counter for error
.
          COMPARE   EIGHT,CMPCOUNT
          IF        @EQUAL
            MOVE      ZERO,CMPCOUNT
          ENDIF
.
          ADD       ONE,CMPCOUNT
          MOVE      CMPCOUNT,DIM3
          RJUSTIFY  DIM3
          REP       " 0",DIM3
.
          PACK      XPMHHACF,DIM3,SP70
.
. HAC Group 01 
.
HACC1010  PACK      XPMHHACG,ZERO,ONE,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0003
          MOVE      XFLD0003,XPMHHACV        
          MOVE      XFLD0003,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1020
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 02
.
HACC1020  PACK      XPMHHACG,ZERO,TWO,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0004
          MOVE      XFLD0004,XPMHHACV
          MOVE      XFLD0004,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1030
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 03
.
HACC1030  PACK      XPMHHACG,ZERO,THREE,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0005
          MOVE      XFLD0005,XPMHHACV
          MOVE      XFLD0005,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1040
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 04
.
HACC1040  PACK      XPMHHACG,ZERO,FOUR,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0006
          MOVE      XFLD0006,XPMHHACV
          MOVE      XFLD0006,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1060
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 06
.
HACC1060  PACK      XPMHHACG,ZERO,SIX,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0007
          MOVE      XFLD0007,XPMHHACV
          MOVE      XFLD0007,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1070
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 07
.
HACC1070  PACK      XPMHHACG,ZERO,SEVEN,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0008
          MOVE      XFLD0008,XPMHHACV
          MOVE      XFLD0008,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1080
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 08
.
HACC1080  PACK      XPMHHACG,ZERO,EIGHT,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0009
          MOVE      XFLD0009,XPMHHACV
          MOVE      XFLD0009,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1090
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 09
.
HACC1090  PACK      XPMHHACG,ZERO,NINE,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0010
          MOVE      XFLD0010,XPMHHACV
          MOVE      XFLD0010,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1100
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 10
.
HACC1100  PACK      XPMHHACG,ONE,ZERO,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0011
          MOVE      XFLD0011,XPMHHACV
          MOVE      XFLD0011,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1110
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 11
.
HACC1110  PACK      XPMHHACG,ONE,ONE,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0012
          MOVE      XFLD0012,XPMHHACV
          MOVE      XFLD0012,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1120
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 12
.
HACC1120  PACK      XPMHHACG,ONE,TWO,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0013
          MOVE      XFLD0013,XPMHHACV
          MOVE      XFLD0013,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1130
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 13
.
HACC1130  PACK      XPMHHACG,ONE,THREE,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0014
          MOVE      XFLD0014,XPMHHACV
          MOVE      XFLD0014,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1140
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
. HAC Group 14
.
HACC1140  PACK      XPMHHACG,ONE,FOUR,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0015
          MOVE      XFLD0015,XPMHHACV
          MOVE      XFLD0015,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1150
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
.
. HAC Group 15
.
HACC1150  PACK      XPMHHACG,ONE,FIVE,SP70
.
          MOVE      ZERO,XPMHHACV
          SQUEEZE   XFLD0016
          MOVE      XFLD0016,XPMHHACV
          MOVE      XFLD0016,VPMHHACV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,HACC1000
.
          CALL      CLPMSHAC                 * clear fields
.
          PACK      KEY12,XPMHCNTR,XPMHHACG,XPMHHACF,SP70
          CALL      RDPMHAC1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHACUID
            CALL      IBACLOCK
            PACK      PMHACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHACDAT
            MOVE      CTIMEIS,PMHACTIM
            CALL      WRPMHAC1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHAUUID
            CALL      IBACLOCK
            PACK      PMHAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHAUDAT
            MOVE      CTIMEIS,PMHAUTIM
            CALL      UPPMHAC1
          ENDIF
.
          GOTO      HACC1000
.
HACC9000  CLOSE     PMSHATXT
HACC9999  RETURN
+
.******************************************************************************
.*                                  MDCC0000                                  *
.*                        Generate MDC Detail Complexity                      *
.******************************************************************************
MDCC0000  OPEN      MDCHDTXT,FNAMEI
          MOVE      ZERO,CMPCOUNT
.
MDCC1000  READ      MDCHDTXT,SEQ;XFLD0001,XFLD0002,XFLD0003,XFLD0004,XFLD0005:
                                 XFLD0006,XFLD0007,XFLD0008,XFLD0009,XFLD0010:
                                 XFLD0011,XFLD0012,XFLD0013,XFLD0014,XFLD0015:
                                 XFLD0016
          GOTO      MDCC9000 IF OVER
.
          PACK      WORKLINE,XFLD0001,XFLD0002,XFLD0003,XFLD0004,XFLD0005:
                             SP70,SP70,SP70
          MATCH     SPACLINE,WORKLINE
          GOTO      MDCC1000 IF EQUAL
.
          PACK      XMDDCNTR,XFLD0002,SP70
.         MATCH     SP70,XMDDCNTR
.         GOTO      MDCC1000 IF EQUAL
.
          PACK      XMDDHACT,ZERO,ZERO,THREE,SP70
.         PACK      XMDDHACF,XFLD0002,SP70
.
          ADD       ONE,LINECNTR            * Text file line counter for error
.
          COMPARE   SIXTY9,CMPCOUNT
          IF        @EQUAL
            MOVE      FORTY4,CMPCOUNT
          ENDIF
.
          COMPARE   SIXTY2,CMPCOUNT
          IF        @EQUAL
            MOVE      SIXTY6,CMPCOUNT
          ENDIF
.
          COMPARE   SIXTY8,CMPCOUNT
          IF        @EQUAL
            MOVE      SIXTY2,CMPCOUNT
          ENDIF 
.
          COMPARE   SIXTY5,CMPCOUNT
          IF        @EQUAL
            MOVE      SIXTY9,CMPCOUNT
          ENDIF
.
          COMPARE   SEVENTY,CMPCOUNT
          IF        @EQUAL
            MOVE      SIXTY8,CMPCOUNT
          ENDIF
.
          COMPARE   ZERO,CMPCOUNT
          IF        @EQUAL
            MOVE      SIXTY8,CMPCOUNT
          ENDIF
.
          ADD       ONE,CMPCOUNT
          MOVE      CMPCOUNT,DIM3
          RJUSTIFY  DIM3
          REP       " 0",DIM3
.
          PACK      XMDDHACF,DIM3,SP70
.
. MDC HAC Group 01
.
MDCC1010  PACK      XMDDHACG,ZERO,ONE,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0003
          MOVE      XFLD0003,XMDDCOMV
          MOVE      XFLD0003,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1020
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 02
.
MDCC1020  PACK      XMDDHACG,ZERO,TWO,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0004
          MOVE      XFLD0004,XMDDCOMV
          MOVE      XFLD0004,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1030
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 03
.
MDCC1030  PACK      XMDDHACG,ZERO,THREE,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0005
          MOVE      XFLD0005,XMDDCOMV
          MOVE      XFLD0005,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1040
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 04
.
MDCC1040  PACK      XMDDHACG,ZERO,FOUR,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0006
          MOVE      XFLD0006,XMDDCOMV
          MOVE      XFLD0006,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1060
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 06
.
MDCC1060  PACK      XMDDHACG,ZERO,SIX,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0007
          MOVE      XFLD0007,XMDDCOMV
          MOVE      XFLD0007,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1070
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 07
.
MDCC1070  PACK      XMDDHACG,ZERO,SEVEN,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0008
          MOVE      XFLD0008,XMDDCOMV
          MOVE      XFLD0008,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1080
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 08
.
MDCC1080  PACK      XMDDHACG,ZERO,EIGHT,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0009
          MOVE      XFLD0009,XMDDCOMV
          MOVE      XFLD0009,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1090
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 09
.
MDCC1090  PACK      XMDDHACG,ZERO,NINE,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0010
          MOVE      XFLD0010,XMDDCOMV
          MOVE      XFLD0010,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1100
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 10
.
MDCC1100  PACK      XMDDHACG,ONE,ZERO,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0011
          MOVE      XFLD0011,XMDDCOMV
          MOVE      XFLD0011,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1110
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 11
.
MDCC1110  PACK      XMDDHACG,ONE,ONE,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0012
          MOVE      XFLD0012,XMDDCOMV
          MOVE      XFLD0012,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1120
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 12
.
MDCC1120  PACK      XMDDHACG,ONE,TWO,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0013
          MOVE      XFLD0013,XMDDCOMV
          MOVE      XFLD0013,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1130
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 13
.
MDCC1130  PACK      XMDDHACG,ONE,THREE,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0014
          MOVE      XFLD0014,XMDDCOMV
          MOVE      XFLD0014,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1140
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 14
.
MDCC1140  PACK      XMDDHACG,ONE,FOUR,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0015
          MOVE      XFLD0015,XMDDCOMV
          MOVE      XFLD0015,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1150
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. MDC HAC Group 15
.
MDCC1150  PACK      XMDDHACG,ONE,FIVE,SP70
.
          MOVE      ZERO,XMDDCOMV
          SQUEEZE   XFLD0016
          MOVE      XFLD0016,XMDDCOMV
          MOVE      XFLD0016,VMDDCOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,MDCC1000
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XMDDCNTR,XMDDHACG,XMDDHACT,XMDDHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
          GOTO      MDCC1000
.
MDCC9000  CLOSE     MDCHDTXT
MDCC9999  RETURN
+
.******************************************************************************
.*                                  AGEC0000                                  *
.*                        Generate Age Detail Complexity                      *
.******************************************************************************
AGEC0000  OPEN      AGEHDTXT,FNAMEI
          MOVE      TWENTY4,CMPCOUNT
.
AGEC1000  READ      AGEHDTXT,SEQ;XFLD0001,XFLD0002,XFLD0003,XFLD0004,XFLD0005:
                                 XFLD0006,XFLD0007,XFLD0008,XFLD0009,XFLD0010:
                                 XFLD0011,XFLD0012,XFLD0013,XFLD0014,XFLD0015:
                                 XFLD0016
          GOTO      AGEC9000 IF OVER
.
          PACK      WORKLINE,XFLD0001,XFLD0002,XFLD0003,XFLD0004,XFLD0005:
                             SP70,SP70,SP70
          MATCH     SPACLINE,WORKLINE
          GOTO      AGEC1000 IF EQUAL
.
          PACK      XAGECNTR,XFLD0002,SP70
.         MATCH     SP70,XAGECNTR
.         GOTO      AGEC1000 IF EQUAL
.
          PACK      XAGEHACT,ZERO,ZERO,TWO,SP70
.         PACK      XAGEHACF,XFLD0002,SP70
.
          ADD       ONE,LINECNTR            * Text file line counter for error
.
          COMPARE   FORTY4,CMPCOUNT
          IF        @EQUAL
            MOVE      TWENTY4,CMPCOUNT
          ENDIF
.
          ADD       ONE,CMPCOUNT
          MOVE      CMPCOUNT,DIM3
          RJUSTIFY  DIM3
          REP       " 0",DIM3
.
          PACK      XAGEHACF,DIM3,SP70
.
. Age HAC Group 01
.
AGEC1010  PACK      XAGEHACG,ZERO,ONE,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0003
          MOVE      XFLD0003,XAGECOMV
          MOVE      XFLD0003,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1020
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 02
.
AGEC1020  PACK      XAGEHACG,ZERO,TWO,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0004
          MOVE      XFLD0004,XAGECOMV
          MOVE      XFLD0004,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1030
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 03
.
AGEC1030  PACK      XAGEHACG,ZERO,THREE,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0005
          MOVE      XFLD0005,XAGECOMV
          MOVE      XFLD0005,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1040
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 04
.
AGEC1040  PACK      XAGEHACG,ZERO,FOUR,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0006
          MOVE      XFLD0006,XAGECOMV
          MOVE      XFLD0006,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1060
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 06
.
AGEC1060  PACK      XAGEHACG,ZERO,SIX,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0007
          MOVE      XFLD0007,XAGECOMV
          MOVE      XFLD0007,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1070
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 07
.
AGEC1070  PACK      XAGEHACG,ZERO,SEVEN,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0008
          MOVE      XFLD0008,XAGECOMV
          MOVE      XFLD0008,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1080
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 08
.
AGEC1080  PACK      XAGEHACG,ZERO,EIGHT,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0009
          MOVE      XFLD0009,XAGECOMV
          MOVE      XFLD0009,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1090
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 09
.
AGEC1090  PACK      XAGEHACG,ZERO,NINE,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0010
          MOVE      XFLD0010,XAGECOMV
          MOVE      XFLD0010,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1100
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 10
.
AGEC1100  PACK      XAGEHACG,ONE,ZERO,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0011
          MOVE      XFLD0011,XAGECOMV
          MOVE      XFLD0011,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1110
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 11
.
AGEC1110  PACK      XAGEHACG,ONE,ONE,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0012
          MOVE      XFLD0012,XAGECOMV
          MOVE      XFLD0012,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1120
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 12
.
AGEC1120  PACK      XAGEHACG,ONE,TWO,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0013
          MOVE      XFLD0013,XAGECOMV
          MOVE      XFLD0013,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1130
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 13
.
AGEC1130  PACK      XAGEHACG,ONE,THREE,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0014
          MOVE      XFLD0014,XAGECOMV
          MOVE      XFLD0014,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1140
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 14
.
AGEC1140  PACK      XAGEHACG,ONE,FOUR,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0015
          MOVE      XFLD0015,XAGECOMV
          MOVE      XFLD0015,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1150
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Age HAC Group 15
.
AGEC1150  PACK      XAGEHACG,ONE,FIVE,SP70
.
          MOVE      ZERO,XAGECOMV
          SQUEEZE   XFLD0016
          MOVE      XFLD0016,XAGECOMV
          MOVE      XFLD0016,VAGECOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,AGEC1000
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XAGECNTR,XAGEHACG,XAGEHACT,XAGEHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
          GOTO      AGEC1000
.
AGEC9000  CLOSE     MDCHDTXT
AGEC9999  RETURN
+
.******************************************************************************
.*                                  CHAC0000                                  *
.*                        Generate Charlson Detail Complexity                 *
.******************************************************************************
CHAC0000  OPEN      CHAHDTXT,FNAMEI
          MOVE      SIXTY5,CMPCOUNT
.
CHAC1000  READ      CHAHDTXT,SEQ;XFLD0001,XFLD0002,XFLD0003,XFLD0004,XFLD0005:
                                 XFLD0006,XFLD0007,XFLD0008,XFLD0009,XFLD0010:
                                 XFLD0011,XFLD0012,XFLD0013,XFLD0014,XFLD0015:
                                 XFLD0016
          GOTO      CHAC9000 IF OVER
.
          PACK      WORKLINE,XFLD0001,XFLD0002,XFLD0003,XFLD0004,XFLD0005:
                             SP70,SP70,SP70
          MATCH     SPACLINE,WORKLINE
          GOTO      CHAC1000 IF EQUAL
.
          PACK      XCHACNTR,XFLD0002,SP70
.         MATCH     SP70,XCHACNTR
.         GOTO      CHAC1000 IF EQUAL
.
          PACK      XCHAHACT,ZERO,ZERO,ONE,SP70
.         PACK      XCHAHACF,XFLD0002,SP70
.
          ADD       ONE,LINECNTR            * Text file line counter for error
.
          COMPARE   SIXTY6,CMPCOUNT
          IF        @EQUAL
            MOVE      EIGHT,CMPCOUNT
          ENDIF
.
          COMPARE   TWENTY4,CMPCOUNT
          IF        @EQUAL
            MOVE      SIXTY5,CMPCOUNT
          ENDIF
.
          ADD       ONE,CMPCOUNT
          MOVE      CMPCOUNT,DIM3
          RJUSTIFY  DIM3
          REP       " 0",DIM3
.
.         COMPARE   EIGHT,CMPCOUNT
.         IF        @EQUAL
.           PACK      DIM3,ZERO,SIX,SIX
.         ENDIF
.
          PACK      XCHAHACF,DIM3,SP70
.
. Charlson HAC Group 01
.
CHAC1010  PACK      XCHAHACG,ZERO,ONE,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0003
          MOVE      XFLD0003,XCHACOMV
          MOVE      XFLD0003,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1020
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 02
.
CHAC1020  PACK      XCHAHACG,ZERO,TWO,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0004
          MOVE      XFLD0004,XCHACOMV
          MOVE      XFLD0004,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1030
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charslon HAC Group 03
.
CHAC1030  PACK      XCHAHACG,ZERO,THREE,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0005
          MOVE      XFLD0005,XCHACOMV
          MOVE      XFLD0005,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1040
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 04
.
CHAC1040  PACK      XCHAHACG,ZERO,FOUR,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0006
          MOVE      XFLD0006,XCHACOMV
          MOVE      XFLD0006,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1060
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 06
.
CHAC1060  PACK      XCHAHACG,ZERO,SIX,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0007
          MOVE      XFLD0007,XCHACOMV
          MOVE      XFLD0007,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1070
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 07
.
CHAC1070  PACK      XCHAHACG,ZERO,SEVEN,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0008
          MOVE      XFLD0008,XCHACOMV
          MOVE      XFLD0008,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1080
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 08
.
CHAC1080  PACK      XCHAHACG,ZERO,EIGHT,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0009
          MOVE      XFLD0009,XCHACOMV
          MOVE      XFLD0009,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1090
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 09
.
CHAC1090  PACK      XCHAHACG,ZERO,NINE,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0010
          MOVE      XFLD0010,XCHACOMV
          MOVE      XFLD0010,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1100
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 10
.
CHAC1100  PACK      XCHAHACG,ONE,ZERO,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0011
          MOVE      XFLD0011,XCHACOMV
          MOVE      XFLD0011,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1110
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 11
.
CHAC1110  PACK      XCHAHACG,ONE,ONE,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0012
          MOVE      XFLD0012,XCHACOMV
          MOVE      XFLD0012,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1120
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 12
.
CHAC1120  PACK      XCHAHACG,ONE,TWO,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0013
          MOVE      XFLD0013,XCHACOMV
          MOVE      XFLD0013,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1130
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 13
.
CHAC1130  PACK      XCHAHACG,ONE,THREE,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0014
          MOVE      XFLD0014,XCHACOMV
          MOVE      XFLD0014,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1140
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 14
.
CHAC1140  PACK      XCHAHACG,ONE,FOUR,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0015
          MOVE      XFLD0015,XCHACOMV
          MOVE      XFLD0015,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1150
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
. Charlson HAC Group 15
.
CHAC1150  PACK      XCHAHACG,ONE,FIVE,SP70
.
          MOVE      ZERO,XCHACOMV
          SQUEEZE   XFLD0016
          MOVE      XFLD0016,XCHACOMV
          MOVE      XFLD0016,VCHACOMV
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,CHAC1000
.
          CALL      CLPMSHDE                 * clear fields
.
          PACK      KEY15,XCHACNTR,XCHAHACG,XCHAHACT,XCHAHACF,SP70
          CALL      RDPMHDE1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMHECUID
            CALL      IBACLOCK
            PACK      PMHECDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHECDAT
            MOVE      CTIMEIS,PMHECTIM
            CALL      WRPMHDE1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMHEUUID
            CALL      IBACLOCK
            PACK      PMHEUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMHEUDAT
            MOVE      CTIMEIS,PMHEUTIM
            CALL      UPPMHDE1
          ENDIF
.
          GOTO      CHAC1000
.
CHAC9000  CLOSE     MDCHDTXT
CHAC9999  RETURN
+
.******************************************************************************
.*                                  URGC0000                                  *
.*                    Generate Emergency Price weight                         *
.******************************************************************************
URGC0000  OPEN      EMRURTXT,FNAMEI
.
URGC1000  READ      EMRURTXT,SEQ;XFLD0001,XFLD0002,XFLD0003,XFLD0004,XFLD0005:
                                 XFLD0006,XFLD0007
          GOTO      URGC9000 IF OVER
.
.
          UNPACK    XFLD0001,CDAY,KEY1,CMON,KEY1,CCENT,CYEAR
          PACK      XURGEDAT,CCENT,CYEAR,CMON,CDAY,SP70
.
          MATCH     SP70,XURGEDAT
          GOTO      URGC1000 IF EQUAL
.
          ADD       ONE,LINECNTR            * Text file line counter for error
          CALL      PFLD0000                * pack fields with spaces
.
          PACK      XURGESTA,XFLD0002,SP70
          PACK      XURGTRIA,XFLD0003,SP70
          PACK      XURGVTYP,XFLD0004,SP70
          PACK      XURGMDBC,XFLD0005,SP70
          PACK      XURGURGV,XFLD0006,SP70
          PACK      XURGURGD,XFLD0007,SP70
.
          CALL      VALD0000              * Validate fields
          BRANCH    ERRFLAG,URGC1000
.
.
          CALL      CLEMRURG                 * clear fields
.
          PACK      KEY47,XURGEDAT,XURGESTA,XURGTRIA,XURGVTYP,XURGMDBC,SP70
          CALL      RDEMURG1
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,EMURCUID
            CALL      IBACLOCK
            PACK      EMURCDAT,CCC,CYY,CMM,CDD
            REP       " 0",EMURCDAT
            MOVE      CTIMEIS,EMURCTIM
            CALL      WREMURG1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,EMURUUID
            CALL      IBACLOCK
            PACK      EMURUDAT,CCC,CYY,CMM,CDD
            REP       " 0",EMURUDAT
            MOVE      CTIMEIS,EMURUTIM
            CALL      UPEMURG1
          ENDIF
.
          GOTO      URGC1000
.
URGC9000  CLOSE     EMRURTXT
URGC9999  RETURN
+
.******************************************************************************
.* Generate ABF Sub-Acute Price Weights                                       *
.******************************************************************************
SAPW0000  OPEN      SUBAWTXT,FNAMEI
.
SAPW1000  READ      SUBAWTXT,SEQ;XFLD0001,XFLD0002,XFLD0017,XFLD0018,XFLD0005:
                                 XFLD0006,XFLD0007,XFLD0008,XFLD0009,XFLD0010:
                                 XFLD0011,XFLD0012,XFLD0013
          GOTO      SAPW9000 IF OVER
.
          PACK      XFLD0001,XFLD0001,SP70
          MATCH     SP70,XFLD0001            * Contract ID
          GOTO      SAPW2000 IF NOT EQUAL
.
          PACK      XFLD0002,XFLD0002,SP70
          MATCH     SP70,XFLD0002            * AN-SNAP Code 
          GOTO      SAPW2000 IF NOT EQUAL
.
          PACK      XFLD0017,XFLD0017,SP70
          MATCH     SP70,XFLD0017            * AN-SNAP Description 
          GOTO      SAPW2000 IF NOT EQUAL
.
          PACK      XFLD0018,XFLD0018,SP70
          MATCH     SP70,XFLD0018            * Episode Type Description
          GOTO      SAPW2000 IF NOT EQUAL
.
          PACK      XFLD0005,XFLD0005,SP70
          MATCH     SP70,XFLD0005            * Care Type
          GOTO      SAPW2000 IF NOT EQUAL
.
          GOTO      SAPW1000
.
SAPW2000  ADD       ONE,LINECNTR            * Text file line counter for error
          CALL      PFLD0000                * pack fields with spaces
.
          CALL      VALD0000                * Validate fields
          BRANCH    ERRFLAG,SAPW1000
.
          PACK      XSAWCNTR,XFLD0001,SP70
.
          STRIP     XFLD0002
          CMATCH    SP1,XFLD0002
          IF        @EQUAL
            BUMP      XFLD0002
          ENDIF
          PACK      XSAWDRGC,XFLD0002,SP70
          UNPACK    XSAWDRGC,XFLDVERS,XFLDCODE 
.
          PACK      XSAWADSC,XFLD0017,SP70,SP70
          CMATCH    SP1,XSAWADSC
          IF        @EQUAL
            BUMP      XSAWADSC
          ENDIF
.
          PACK      XSAWEDSC,XFLD0018,SP70
          CMATCH    SP1,XSAWEDSC
          IF        @EQUAL
            BUMP      XSAWEDSC
          ENDIF
.
          MOVE      XFLD0005,XSAWCCOD
          MOVE      XFLD0006,XSAWSDOV
.
          MOVE      ZERO,XSAWALOS            * Average LOS
          SQUEEZE   XFLD0007
          MOVE      XFLD0007,XSAWALOS
.
          MOVE      ZERO,XSAWLBIN            * Lower Bound
          SQUEEZE   XFLD0008
          MOVE      XFLD0008,XSAWLBIN
.
          MOVE      ZERO,XSAWUBIN            * Upper Bound
          SQUEEZE   XFLD0009
          MOVE      XFLD0009,XSAWUBIN
.
          MOVE      ZERO,XSAWSDPW            * Same Day (Price Weight)
          SQUEEZE   XFLD0010
          MOVE      XFLD0010,XSAWSDPW
.
          MOVE      ZERO,XSAWSSOP            * Short Stay Outlier Per Diem (PW)
          SQUEEZE   XFLD0011
          MOVE      XFLD0011,XSAWSSOP
.
          MOVE      ZERO,XSAWINPW            * Inlier (Price Weight)
          SQUEEZE   XFLD0012
          MOVE      XFLD0012,XSAWINPW
.
          MOVE      ZERO,XSAWLSOP            * Long Stay Outlier Per Diem (PW)
          SQUEEZE   XFLD0013
          MOVE      XFLD0013,XSAWLSOP
.
          CALL      CLPMSSAW              * clear fields
.
          PACK      KEY13,XSAWCNTR,XFLDCODE,SP1,XFLDVERS,XSAWCCOD,SP70
          CALL      RDPMSAW1 
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMSACUID
            CALL      IBACLOCK
            PACK      PMSACDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMSACDAT
            MOVE      CTIMEIS,PMSACTIM
            CALL      WRPMSAW1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMSAUUID
            CALL      IBACLOCK
            PACK      PMSAUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMSAUDAT
            MOVE      CTIMEIS,PMSAUTIM
            CALL      UPPMSAW1
          ENDIF
.
          GOTO      SAPW1000
.
SAPW9000  CLOSE     SUBAWTXT
SAPW9999  RETURN
+
.******************************************************************************
.* Generate ABF MH Price Weights                                              *
.******************************************************************************
MHPW0000  OPEN      AMHPWTXT,FNAMEI
.
MHPW1000  READ      AMHPWTXT,SEQ;XFLD0001,XFLD0002,XFLD0017,XFLD0003,XFLD0004:
                                 XFLD0005,XFLD0006,XFLD0007,XFLD0008,XFLD0009:
                                 XFLD0010
          GOTO      MHPW9000 IF OVER
.
          PACK      XFLD0001,XFLD0001,SP70
          MATCH     SP70,XFLD0001            * Contract ID
          GOTO      MHPW2000 IF NOT EQUAL
.
          PACK      XFLD0002,XFLD0002,SP70
          MATCH     SP70,XFLD0002            * AMHCC Code
          GOTO      MHPW2000 IF NOT EQUAL
.
          PACK      XFLD0017,XFLD0017,SP70,SP70
          MATCH     SP70,XFLD0017            * AMHCC Description
          GOTO      MHPW2000 IF NOT EQUAL
.
          GOTO      MHPW1000
.
MHPW2000  ADD       ONE,LINECNTR            * Text file line counter for error
          CALL      PFLD0000                * pack fields with spaces
.
          CALL      VALD0000                * Validate fields
          BRANCH    ERRFLAG,MHPW1000
.
          PACK      XMHWCNTR,XFLD0001,SP70
          PACK      XMHWAMHC,XFLD0002,SP70
.
          PACK      XMHWAMHD,XFLD0017,SP70,SP70
.
          MOVE      ZERO,XMHWAVPL            * Average Phase Length (Days)
          SQUEEZE   XFLD0003
          MOVE      XFLD0003,XMHWAVPL
.
          MOVE      ZERO,XMHWLOWB            * Lower Bound (Inlier Bounds)
          SQUEEZE   XFLD0004
          MOVE      XFLD0004,XMHWLOWB
.
          MOVE      ZERO,XMHWUPPB            * Upper Bound (Inlier Bounds)
          SQUEEZE   XFLD0005
          MOVE      XFLD0005,XMHWUPPB
.
          MOVE      ZERO,XMHWSSOB            * Short Stay Outlier Base (PW)
          SQUEEZE   XFLD0006
          MOVE      XFLD0006,XMHWSSOB
.
          MOVE      ZERO,XMHWSSOP            * Short Stay Outlier Per Diem (PW)
          SQUEEZE   XFLD0007
          MOVE      XFLD0007,XMHWSSOP
.
          MOVE      ZERO,XMHWINLI            * Inlier (Price Weight)
          SQUEEZE   XFLD0008
          MOVE      XFLD0008,XMHWINLI
.
          MOVE      ZERO,XMHWLSOP            * Long Stay Outlier Per Diem (PW)
          SQUEEZE   XFLD0009
          MOVE      XFLD0009,XMHWLSOP
.
          MOVE      ZERO,XMHWPPSA            * Private Patient Service Adjust %
          SQUEEZE   XFLD0010
          MOVE      XFLD0010,XMHWPPSA
.
          CALL      CLPMSAMH                 * clear fields
.
MHPW8000  PACK      KEY16,XMHWCNTR,XMHWAMHC,SP70
          CALL      RDPMAMH1 
          IF        OVRCD=1
            CALL      SETF0000
            ADD       ONE,ADDCOUNT       * Total records added
            MOVE      USERID,PMMHCUID
            CALL      IBACLOCK
            PACK      PMMHCDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMMHCDAT
            MOVE      CTIMEIS,PMMHCTIM
            CALL      WRPMAMH1
          ELSE
            CALL      SETF0000
            ADD       ONE,UPDCOUNT       * Total records updated
            MOVE      USERID,PMMHUUID
            CALL      IBACLOCK
            PACK      PMMHUDAT,CCC,CYY,CMM,CDD
            REP       " 0",PMMHUDAT
            MOVE      CTIMEIS,PMMHUTIM
            CALL      UPPMAMH1
          ENDIF
.
          MOVE      "MHC",PMVCVSID
          PACK      PMVCCODE,XMHWAMHC,SP70        
          PACK      KEY33,PMVCVSID,PMVCCODE,SP70
          CALL      RDPMVSC1
          IF        OVRCD=1
            PACK      PMVCPTRM,XMHWAMHD,SP70,SP70,SP70,SP70
            PACK      PMVCFNAM,SP70,SP70,SP70,SP70
            MOVE      "1",PMVCACTV
            MOVE      SP70,PMVCSPAR 
            CALL      WRPMVSC1
          ELSE
            PACK      PMVCPTRM,XMHWAMHD,SP70,SP70,SP70,SP70
            CALL      UPPMVSC1  
          ENDIF
.
          PROC      PMSUKIUP      * Updates keyword index
.
          GOTO      MHPW1000
.
MHPW9000  CLOSE     AMHPWTXT
MHPW9999  RETURN
+
.******************************************************************************
.*                             Set fields                                     *
.******************************************************************************
SETF0000  BRANCH   COPTION,SETF1000,SETF2000,SETF3000,SETF4000,SETF5000:
                           SETF6000,SETF7000,SETF8000,SETF8100,SETF8200
          GOTO     SETF9999
.
SETF1000  MOVE     XADMCNTR,PMPWCNTR  *  Contract ID
          MOVE     XADMDRGC,PMPWDRGC  *  DRG Code
          MOVE     XADMDRGD,PMPWDRGD  *  DRG Description
          MOVE     XADMSDPY,PMPWSDPY  *  Same-Day Payment List
          MOVE     XADMBICU,PMPWBICU  *  Bundle ICU
          MOVE     XADMALOS,PMPWALOS  *  ALOS
          MOVE     XADMLOWB,PMPWLOWB  *  Lower bound (Inlier Bounds)
          MOVE     XADMUPPB,PMPWUPPB  *  Upper bound (Inlier Bounds)
          MOVE     XADMPSRV,PMPWPSRV  *  Private Patient Service(Adjust.)%
          MOVE     XADMPAED,PMPWPAED  *  Paediatric (Adjustment)%
          MOVE     XADMSDAY,PMPWSDAY  *  Same Day (Price Weight)
          MOVE     XADMSSOB,PMPWSSOB  *  Short Stay Outlier Base (PW)
          MOVE     XADMSSOP,PMPWSSOP  *  Short Stay Outlier Per Diem (PW)
          MOVE     XADMINLI,PMPWINLI  *  Inlier (Price Weight)
          MOVE     XADMLSOP,PMPWLSOP  *  Long Stay Outlier Per Diem (PW)
          GOTO     SETF9999
.
SETF2000  MOVE     XNADCNTR,OTPWCNTR  *  Contract ID
          MOVE     XNADTIER,OTPWTIER  *  Tier 2 Clinic V5.0 Cat NC
          MOVE     XNADPWEI,OTPWPWEI  *  Price Weight
          GOTO     SETF9999
.
SETF3000  MOVE     XPWACNTR,EMPWCNTR  *  Contract ID
          MOVE     XPWAURGV,EMPWURGV  *  URG V1.4 Value/AECC Class
          MOVE     XPWAURGD,EMPWURGD  *  URG V1.4 Description/AECC Desc.
          MOVE     XPWAPWEI,EMPWPWEI  *  Price Weight
          GOTO     SETF9999
.
SETF4000  MOVE     XPMHCNTR,PMHACNTR  *  Contract ID
          MOVE     XPMHHACG,PMHAHACG  *  HAC Group 01=16 Cat Ha
          MOVE     XPMHHACF,PMHAHACF  *  HAC Complexity Field
          MOVE     XPMHHACV,PMHAHACV  *  Complexity Value
          GOTO     SETF9999
.
SETF5000  MOVE     XMDDCNTR,PMHECNTR  * Contract ID
          MOVE     XMDDHACG,PMHEHACG  * HAC Group 01-16 Cat Ha
          MOVE     XMDDHACT,PMHEHACT  * HAC Complexity Type
          MOVE     XMDDHACF,PMHEHACF  * HAC Complexity Field
          MOVE     XMDDCOMV,PMHECOMV  * Complexity Value          
          GOTO     SETF9999
.
SETF6000  MOVE     XAGECNTR,PMHECNTR  * Contract ID
          MOVE     XAGEHACG,PMHEHACG  * HAC Group 01-16 Cat Ha
          MOVE     XAGEHACT,PMHEHACT  * HAC Complexity Type
          MOVE     XAGEHACF,PMHEHACF  * HAC Complexity Field
          MOVE     XAGECOMV,PMHECOMV  * Complexity Value
          GOTO     SETF9999
.
SETF7000  MOVE     XCHACNTR,PMHECNTR  * Contract ID
          MOVE     XCHAHACG,PMHEHACG  * HAC Group 01-16 Cat Ha
          MOVE     XCHAHACT,PMHEHACT  * HAC Complexity Type
          MOVE     XCHAHACF,PMHEHACF  * HAC Complexity Field
          MOVE     XCHACOMV,PMHECOMV  * Complexity Value
          GOTO     SETF9999
.
SETF8000  MOVE     XURGEDAT,EMUREDAT  * Effective End Date (ccyymmdd)
          MOVE     XURGESTA,EMURESTA  * Episode End Status Cat ED
          MOVE     XURGTRIA,EMURTRIA  * Triage Code Cat AA
          MOVE     XURGVTYP,EMURVTYP  * Type of Visit Cat ee
          MOVE     XURGMDBC,EMURMDBC  * MDB Code
          MOVE     XURGURGV,EMURURGV  * URG Value
          MOVE     XURGURGD,EMURURGD  * URG Description
          GOTO     SETF9999
.
SETF8100  MOVE      XSAWCNTR,PMSACNTR
          MOVE      XFLDCODE,PMSACLCD 
          PACK      PMSAASVR,SP1,XFLDVERS,SP70
          MOVE      XSAWADSC,PMSAADSC
          MOVE      XSAWEDSC,PMSAEDSC 
          MOVE      XSAWCCOD,PMSACCOD
.
          MOVE      SP70,PMSASDOV
          MATCH     "S",XSAWSDOV
          IF        @EQUAL
            MOVE      "1",PMSASDOV
          ELSE
            MATCH     "O",XSAWSDOV
            IF        @EQUAL
              MOVE      "0",PMSASDOV
            ENDIF
          ENDIF
.
          MOVE      ZERO,PMSAALOS            * Average LOS  
          MOVE      XSAWALOS,PMSAALOS        
.
          MOVE      ZERO,PMSALBIN            * Lower Bound
          MOVE      XSAWLBIN,PMSALBIN
.
          MOVE      ZERO,PMSAUBIN            * Upper Bound
          MOVE      XSAWUBIN,PMSAUBIN
.
          MOVE      ZERO,PMSASDPW            * Same Day (Price Weight)
          MOVE      XSAWSDPW,PMSASDPW
.
          MOVE      ZERO,PMSASSOP            * Short Stay Outlier Per Diem (PW)
          MOVE      XSAWSSOP,PMSASSOP
.
          MOVE      ZERO,PMSAINPW            * Inlier (Price Weight)
          MOVE      XSAWINPW,PMSAINPW
.
          MOVE      ZERO,PMSALSOP            * Long Stay Outlier Per Diem (PW)
          MOVE      XSAWLSOP,PMSALSOP
.
          MATCH     SP70,PMSAEDSC
          IF        @EQUAL
            PACK      KEY5,PMSACLCD,PMSAASVR,SP70
            CALL      RDPMSNP1
            IF        OVRCD = 0
              MOVE      PMSNDESC,PMSAADSC
            ENDIF
          ENDIF
.
          GOTO      SETF9999
.
SETF8200  MOVE      XMHWCNTR,PMMHCNTR
          MOVE      XMHWAMHC,PMMHAMHC
          MOVE      XMHWAMHD,PMMHAMHD
.
          MOVE      ZERO,PMMHAVPL            * Average Phase Length (Days)
          MOVE      XMHWAVPL,PMMHAVPL
.
          MOVE      ZERO,PMMHLOWB            * Lower Bound
          MOVE      XMHWLOWB,PMMHLOWB
.
          MOVE      ZERO,PMMHUPPB            * Upper Bound
          MOVE      XMHWUPPB,PMMHUPPB
.
          MOVE      ZERO,PMMHSSOB            * Short Stay Outlier Base (PW)
          MOVE      XMHWSSOB,PMMHSSOB
.
          MOVE      ZERO,PMMHSSOP            * Short Stay Outlier Per Diem (PW)
          MOVE      XMHWSSOP,PMMHSSOP
.
          MOVE      ZERO,PMMHINLI            * Inlier (Price Weight)
          MOVE      XMHWINLI,PMMHINLI
.
          MOVE      ZERO,PMMHLSOP            * Long Stay Outlier Per Diem (PW)
          MOVE      XMHWLSOP,PMMHLSOP
.
          MOVE      ZERO,PMMHPPSA            * Private Patient Service Adjust %
          MOVE      XMHWPPSA,PMMHPPSA
.
          GOTO      SETF9999
.
SETF9999  RETURN
+
.******************************************************************************
.         Execute us1 command before processing
.******************************************************************************
EXCUS000  CLEAR     CMDLINE
          APPEND    "ibapms52.us1 ",CMDLINE
          SQUEEZE   FNAMEI
          APPEND    FNAMEI,CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    OUTFNAME,CMDLINE
          APPEND    SP70,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
EXCUS999  RETURN
+
.******************************************************************************
. Validate input text file fields
.******************************************************************************
VALD0000  MOVE      ZERO,EXIT
          MOVE      ZERO,ERRFLAG
          BRANCH    COPTION,VALD1000,VALD2000,VALD3000,VALD4000,VALD5000:
                            VALD6000,VALD7000,VALD8000,VALD8100,VALD8200
          GOTO      VALD9999
.
VALD1000  CALL      VPWA0000           * Validate Admitted acute PW
          GOTO      VALD9999
.
VALD2000  CALL      VPWO0000           * Validate Non-Admitted PW
          GOTO      VALD9999
.
VALD3000  CALL      VPWD0000           * Validate Emergency PW
          GOTO      VALD9999
.
VALD4000  CALL      VHAC0000           * Validate ABF HAC Baseline Complexity
          GOTO      VALD9999
.
VALD5000  CALL      VMDC0000           * Validate MDC Complexity
          GOTO      VALD9999
.
VALD6000  CALL      VAGE0000           * Validate Age Complexity
          GOTO      VALD9999
.
VALD7000  CALL      VCHA0000           * Validate Charlson Complexity
          GOTO      VALD9999
.
VALD8000  CALL      VURG0000           * Validate URG Classifications
          GOTO      VALD9999
.
VALD8100  CALL      VSPW0000           * Validate Sub-Acute Price Weights
          GOTO      VALD9999
.
VALD8200  CALL      VMHPW000           * Validate MH Price Weights
          GOTO      VALD9999
.
VALD9999  RETURN
+
.******************************************************************************
. Validate Admitted acute PW input text file fields
.******************************************************************************
VPWA0000  MATCH     SP70,XFLD0001
          IF        @EQUAL
            MOVE      "Contract ID is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            PACK      KEY6,XFLD0001,SP70
            CALL      RDPMCID1
            IF        OVRCD=0
              MATCH     "1",PMCIDELE
              IF        @EQUAL
                MOVE      "Contract Id is deleted",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ELSE
              MOVE      "Invalid Contract Id",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XFLD0002
          IF        @EQUAL
            MOVE      "DRG Code is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          MATCH     SP70,XFLD0003
          IF        @EQUAL
            MOVE      "DRG Description blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          PACK      KEY1,XFLD0004,SP70
          MATCH     SP70,XFLD0004
          IF        !@EQUAL
            MATCH     "Y",KEY1
            IF        @EQUAL
              MOVE      "1",KEY1
            ENDIF
            REP       " 010",KEY1
            MATCH     "0",KEY1
            IF        !@EQUAL
              MOVE      "Same-Day Pay.List must be blank, 0 or 1",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.      
          PACK      KEY1,XFLD0005,SP70
          MATCH     SP70,XFLD0005
          IF        !@EQUAL
            REP       " 010",KEY1
            MATCH     "0",KEY1
            IF        !@EQUAL
              MOVE      "Bundled ICU must be blank, 0 or 1",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          PACK      XFLD0006,XFLD0006,SP70
          MATCH     SP70,XFLD0006
          IF        !@EQUAL
            SQUEEZE   XFLD0006
            TYPE      XFLD0006
            IF        !@EQUAL
              MOVE      "Invalid ALOS",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.      
          PACK      XFLD0007,XFLD0007,SP70
          MATCH     SP70,XFLD0007
          IF        !@EQUAL
            PACK      KEY4,XFLD0007,SP70
            MATCH     SP70,KEY4
            IF        !@EQUAL
              SQUEEZE   KEY4
              TYPE      KEY4
              IF        !@EQUAL
                MOVE      "Invalid Lower Bound",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ENDIF
          ENDIF
.      
          PACK      XFLD0008,XFLD0008,SP70
          MATCH     SP70,XFLD0008
          IF        !@EQUAL
            PACK      KEY4,XFLD0008,SP70
            MATCH     SP70,KEY4
            IF        !@EQUAL
              SQUEEZE   KEY4
              TYPE      KEY4
              IF        !@EQUAL
                MOVE      "Invalid Upper Bound",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ENDIF
          ENDIF
.
          PACK      XFLD0009,XFLD0009,SP70
          REP       "% ",XFLD0009
          MATCH     SP70,XFLD0009
          IF        !@EQUAL
            SQUEEZE   XFLD0009
            TYPE      XFLD0009
            IF        !@EQUAL
              MOVE      "Invalid Private Patient Service Adjusment",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.      
          PACK      XFLD0010,XFLD0010,SP70
          REP       "% ",XFLD0010
          MATCH     SP70,XFLD0010
          IF        !@EQUAL
            SQUEEZE   XFLD0010
            TYPE      XFLD0010
            IF        !@EQUAL
              MOVE      "Invalid Paediatric Adjusment",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.      
          PACK      XFLD0011,XFLD0011,SP70
          MATCH     SP70,XFLD0011
          IF        !@EQUAL
            SQUEEZE   XFLD0011
            TYPE      XFLD0011
            IF        !@EQUAL
              MOVE      "Invalid Same Day Price Weight",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.      
          PACK      XFLD0012,XFLD0012,SP70
          MATCH     SP70,XFLD0012
          IF        !@EQUAL
            SQUEEZE   XFLD0012
            TYPE      XFLD0012
            IF        !@EQUAL
              MOVE      "Invalid Short Stay Outlier Base",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.      
          PACK      XFLD0013,XFLD0013,SP70
          MATCH     SP70,XFLD0013
          IF        !@EQUAL
            SQUEEZE   XFLD0013
            TYPE      XFLD0013
            IF        !@EQUAL
              MOVE      "Invalid Short Stay Per Diem",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.      
          PACK      XFLD0014,XFLD0014,SP70
          MATCH     SP70,XFLD0014
          IF        !@EQUAL
            SQUEEZE   XFLD0014
            TYPE      XFLD0014
            IF        !@EQUAL
              MOVE      "Invalid Inlier",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.      
          PACK      XFLD0015,XFLD0015,SP70
          MATCH     SP70,XFLD0015
          IF        !@EQUAL
            SQUEEZE   XFLD0015
            TYPE      XFLD0015
            IF        !@EQUAL
              MOVE      "Invalid Long Stay Outlier Per Diem",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.      
VPWA9999  RETURN
+
.******************************************************************************
. Validate Non-Admitted PW input text file fields
.******************************************************************************
VPWO0000  MATCH     SP70,XFLD0001
          IF        @EQUAL
            MOVE      "Contract ID is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            PACK      KEY6,XFLD0001,SP70
            CALL      RDPMCID1
            IF        OVRCD=0
              MATCH     "1",PMCIDELE
              IF        @EQUAL
                MOVE      "Contract Id is deleted",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ELSE
              MOVE      "Invalid Contract Id",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XFLD0002
          IF        @EQUAL
            MOVE      "Tier 2 blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            MOVE      "NC",KEY2
            UNPACK    XFLD0002,KEY3
            PACK      KEY5,KEY2,KEY3,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid Tier 2 Code",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ELSE
              MATCH     "I",PTCOACTV
              IF        @EQUAL
                MOVE      "Inactive Tier 2 Code",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,XFLD0003
          IF        !@EQUAL
            SQUEEZE   XFLD0003
            TYPE      XFLD0003
            IF        !@EQUAL
              MOVE      "Invalid Price Weight",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.      
VPWO9999  RETURN
+
.******************************************************************************
. Validate Emergency PW input text file fields
.******************************************************************************
VPWD0000  MATCH     SP70,XFLD0001
          IF        @EQUAL
            MOVE      "Contract ID is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            PACK      KEY6,XFLD0001,SP70
            CALL      RDPMCID1
            IF        OVRCD=0
              MATCH     "1",PMCIDELE
              IF        @EQUAL
                MOVE      "Contract Id is deleted",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ELSE
              MOVE      "Invalid Contract Id",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XFLD0002
          IF        @EQUAL
.           MOVE      "URG Code is blank",ERRORMSG
            MOVE      "AECC Class is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          MATCH     SP70,XFLD0003
          IF        @EQUAL
.           MOVE      "URG Description is blank",ERRORMSG
            MOVE      "AECC Description is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          SQUEEZE   XFLD0004
          TYPE      XFLD0004
          IF        !@EQUAL | @EOS
            MOVE      "Invalid Price Weight",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
VPWD9999  RETURN
+
.******************************************************************************
. Validate ABF HAC Baseline Complexity input text file fields
.******************************************************************************
VHAC0000  MATCH     SP70,XPMHCNTR
          IF        @EQUAL
            MOVE      "Contract ID is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            PACK      KEY6,XPMHCNTR,SP70
            CALL      RDPMCID1
            IF        OVRCD=0
              MATCH     "1",PMCIDELE
              IF        @EQUAL
                MOVE      "Contract Id is deleted",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ELSE
              MOVE      "Invalid Contract Id",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XPMHHACG
          IF        @EQUAL
            MOVE      "HAC Group is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            MOVE      "Ha",KEY2
            UNPACK    XPMHHACG,KEY3
            PACK      KEY5,KEY2,KEY3,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid HAC Group Code",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XPMHHACF
          IF        @EQUAL
            MOVE      "HAC Complexity Field is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          MOVE      SP70,DIM15
          MOVE      VPMHHACV,DIM15
          TYPE      DIM15
          IF        !@EQUAL | @EOS
            MOVE      "Invalid Complexity Value",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
VHAC9999  RETURN
+
.******************************************************************************
. Validate Complexity input text file fields
.******************************************************************************
VMDC0000  MATCH     SP70,XMDDCNTR
          IF        @EQUAL
            MOVE      "MDC Contract ID is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            PACK      KEY6,XMDDCNTR,SP70
            CALL      RDPMCID1
            IF        OVRCD=0
              MATCH     "1",PMCIDELE
              IF        @EQUAL
                MOVE      "MDC Contract Id is deleted",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ELSE
              MOVE      "Invalid MDC Contract Id",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XMDDHACG
          IF        @EQUAL
            MOVE      "MDC HAC Group is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            MOVE      "Ha",KEY2
            UNPACK    XMDDHACG,KEY3
            PACK      KEY5,KEY2,KEY3,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid MDC HAC Group Code",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XMDDHACT
          IF        @EQUAL
            MOVE      "MDC HAC Complexity Type is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          MATCH     SP70,XMDDHACF
          IF        @EQUAL
            MOVE      "MDC HAC Complexity Field is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          MOVE      SP70,DIM15
          MOVE      VMDDCOMV,DIM15
          TYPE      DIM15
          IF        !@EQUAL | @EOS
            MOVE      "MDC Invalid Complexity Value",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
VMDC9999  RETURN
+
.******************************************************************************
. Validate Complexity input text file fields
.******************************************************************************
VAGE0000  MATCH     SP70,XAGECNTR
          IF        @EQUAL
            MOVE      "Age Contract ID is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            PACK      KEY6,XAGECNTR,SP70
            CALL      RDPMCID1
            IF        OVRCD=0
              MATCH     "1",PMCIDELE
              IF        @EQUAL
                MOVE      "Age Contract Id is deleted",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ELSE
              MOVE      "Invalid Age Contract Id",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XAGEHACG
          IF        @EQUAL
            MOVE      "Age HAC Group is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            MOVE      "Ha",KEY2
            UNPACK    XAGEHACG,KEY3
            PACK      KEY5,KEY2,KEY3,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid Age HAC Group Code",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XAGEHACT
          IF        @EQUAL
            MOVE      "Age HAC Complexity Type is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          MATCH     SP70,XAGEHACF
          IF        @EQUAL
            MOVE      "Age HAC Complexity Field is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          MOVE      SP70,DIM15
          MOVE      VAGECOMV,DIM15
          TYPE      DIM15
          IF        !@EQUAL | @EOS
            MOVE      "Age Invalid Complexity Value",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
VAGE9999  RETURN
+
.******************************************************************************
. Validate Complexity input text file fields
.******************************************************************************
VCHA0000  MATCH     SP70,XCHACNTR
          IF        @EQUAL
            MOVE      "Charlson Contract ID is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            PACK      KEY6,XCHACNTR,SP70
            CALL      RDPMCID1
            IF        OVRCD=0
              MATCH     "1",PMCIDELE
              IF        @EQUAL
                MOVE      "Charlson Contract Id is deleted",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ELSE
              MOVE      "Invalid Charlson Contract Id",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XCHAHACG
          IF        @EQUAL
            MOVE      "Charlson HAC Group is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            MOVE      "Ha",KEY2
            UNPACK    XCHAHACG,KEY3
            PACK      KEY5,KEY2,KEY3,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid Charlson HAC Group Code",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
          ENDIF
.
          MATCH     SP70,XCHAHACT
          IF        @EQUAL
            MOVE      "Charlson HAC Complexity Type is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          MATCH     SP70,XCHAHACF
          IF        @EQUAL
            MOVE      "Charlson HAC Complexity Field is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
          MOVE      SP70,DIM15
          MOVE      VCHACOMV,DIM15
          TYPE      DIM15
          IF        !@EQUAL | @EOS
            MOVE      "Charlson Invalid Complexity Value",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
VCHA9999  RETURN
+
.******************************************************************************
. Validate Classifications input text file fields
.******************************************************************************
VURG0000  MATCH     SP70,XURGEDAT
          IF        @EQUAL
            MOVE      "Effective End Date is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            SQUEEZE   XURGEDAT
            TYPE      XURGEDAT
            IF        !@EQUAL
              MOVE      "Invalid Effective End Date",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ELSE
              UNPACK      XURGEDAT,CCENT,CYEAR,CMON,CDAY
.
              MOVE        ZERO,FORM2
              MOVE        CDAY,FORM2
              IF          FORM2 < 1
                MOVE      "Invalid Date. Day must be more than 0.",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF              
.
              MOVE        ZERO,FORM2
              MOVE        CDAY,FORM2
              IF          FORM2 > 31
                MOVE      "Invalid Date. Day must be <= 31.",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
.
              MOVE        ZERO,FORM2
              MOVE        CMON,FORM2
              IF          FORM2 < 1
                MOVE      "Invalid Date. Month must be > 0.",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
.
              MOVE        ZERO,FORM2
              MOVE        CMON,FORM2
              IF          FORM2 > 12
                MOVE      "Invalid Date. Month must be <= 12.",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
.
              MOVE        ZERO,FORM2
              MOVE        SP70,DIM4
              PACK        DIM4,CCENT,CYEAR,SP70
              MOVE        DIM4,FORM4
              IF          FORM4 < 1
                MOVE      "Invalid Date. Year must be > 0.",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
.
            ENDIF
          ENDIF
.
          MATCH     SP70,XURGESTA
          IF        @EQUAL
            MOVE      "Episode End Status is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            MOVE      "ED",KEY2
            UNPACK    XURGESTA,KEY3
            PACK      KEY5,KEY2,KEY3,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid Episode End Status Code",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ELSE
              MATCH     "I",PTCOACTV
              IF        @EQUAL
                MOVE      "Inactive Episode End Status Code",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,XURGTRIA
          IF        @EQUAL
            MOVE      "Triage Code is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            MOVE      "AA",KEY2
            UNPACK    XURGTRIA,KEY3
            PACK      KEY5,KEY2,KEY3,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid Triage Code",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ELSE
              MATCH     "I",PTCOACTV
              IF        @EQUAL
                MOVE      "Inactive Triage Code",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,XURGVTYP
          IF        @EQUAL
.           MOVE      "Type of Visit is blank",ERRORMSG
.           CALL      PERR0000
.           MOVE      ONE,EXIT
          ELSE
            MOVE      "ee",KEY2
            UNPACK    XURGVTYP,KEY3
            PACK      KEY5,KEY2,KEY3,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid Type of Visit",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ELSE
              MATCH     "I",PTCOACTV
              IF        @EQUAL
                MOVE      "Inactive Type of Visit Code",ERRORMSG
                CALL      PERR0000
                MOVE      ONE,EXIT
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,XURGMDBC
          IF        @EQUAL
            MOVE      "MDB Code is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
            MOVE      XURGMDBC,DIM30
            REP       ALPHANUM,DIM30
            MATCH     DIM30,MDBALNUM
            IF        !@EQUAL
              MOVE      "Invalid MDB Code",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF  
          ENDIF
.
          MATCH     SP70,XURGURGV
          IF        @EQUAL
            MOVE      "URG Value is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ELSE
.
            PACK      KEY12,XURGURGV,Z70
            CALL      RSEMPWD2
            CALL      RPEMPWD2
            IF        OVRCD=ONE
              MOVE      "Invalid URG Value",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
.
            MATCH     XURGURGV,EMPWURGV
            IF        !@EQUAL
              MOVE      "Invalid URG Value",ERRORMSG
              CALL      PERR0000
              MOVE      ONE,EXIT
            ENDIF
.
          ENDIF
.
          MATCH     SP70,XURGURGD
          IF        @EQUAL
            MOVE      "URG Description is blank",ERRORMSG
            CALL      PERR0000
            MOVE      ONE,EXIT
          ENDIF
.
VURG9999  RETURN
.
.******************************************************************************
. Validate Admitted Sub-Acute Price Weights input text file fields
.******************************************************************************
VSPW0000  MOVE      XFLD0001,XSAWCNTR        * Contract ID
          MOVE      XFLD0002,XSAWDRGC        * AN-SNAP Code
          MOVE      XFLD0005,XSAWCCOD        * Care type
.
          MATCH     SP70,XFLD0001
          IF        @EQUAL
            MOVE      "Contract ID is blank",ERRORMS1
            CALL      PERR0000
          ENDIF
.
          MATCH     SP70,XFLD0002
          IF        @EQUAL | @EOS
            MOVE      "AN-SNAP Code is blank",ERRORMS1
            CALL      PERR0000
          ENDIF
.
          MATCH     SP70,XFLD0006
          IF        !@EQUAL
            MOVE      XFLD0006,XFLDDAYC
            REP       "C1O1S11 ",XFLDDAYC
            MATCH     "1", XFLDDAYC
            IF        !@EQUAL          
              MOVE      "Same Day Class must be C, O or S",ERRORMS1
              CALL      PERR0000
            ENDIF
          ELSE
            MOVE      "Same Day Class must be C, O or S",ERRORMS1
            CALL      PERR0000
          ENDIF
.
          MATCH     SP70,XFLD0007
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0007,DINFIELD
            MOVE      "ALOS",FLDNAME
            CALL      C62NUM00
          ENDIF
.
          MATCH     SP70,XFLD0008
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0008,DINFIELD
            MOVE      "Lower Bound (Inlier Bound)",FLDNAME
            CALL      C4NUMB00
          ENDIF
.
          MATCH     SP70,XFLD0009
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0009,DINFIELD
            MOVE      "Upper Bound (Inlier Bound)",FLDNAME
            CALL      C4NUMB00
          ENDIF
.
          MATCH     SP70,XFLD0010
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0010,DINFIELD
            MOVE      "Same Day Price Weight",FLDNAME
            CALL      C104NM00
          ENDIF
.
          MATCH     SP70,XFLD0011
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0011,DINFIELD
            MOVE      "Short Stay Outlier Price Weight",FLDNAME
            CALL      C104NM00
          ENDIF
.
          MATCH     SP70,XFLD0012
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0012,DINFIELD
            MOVE      "Inlier Price Weight",FLDNAME
            CALL      C104NM00
          ENDIF
.
          MATCH     SP70,XFLD0013
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0013,DINFIELD
            MOVE      "Long Stay Outlier Price Weight",FLDNAME
            CALL      C104NM00
          ENDIF
.
VSPW9999  RETURN                    
.
.******************************************************************************
. Validate Admitted MH Price Weights input text file fields
.******************************************************************************
VMHPW000  MOVE      XFLD0001,XMHWCNTR        * Contract ID
          MOVE      XFLD0002,XMHWAMHC        * AMHCC Code
          MOVE      XFLD0017,ERRAMHD
.
          MATCH     SP70,XFLD0001
          IF        @EQUAL
            MOVE      "Contract ID is blank",ERRORMS1
            CALL      PERR0000
          ELSE
            PACK      KEY6,XFLD0001,SP70
            CALL      RDPMCID1
            IF        OVRCD=0
              MATCH     "1",PMCIDELE
              IF        @EQUAL
                MOVE      "Contract Id is deleted",ERRORMS1
                CALL      PERR0000
              ENDIF
            ELSE
              MOVE      "Invalid Contract Id",ERRORMS1
              CALL      PERR0000
            ENDIF
          ENDIF
.
          MATCH     SP70,XFLD0002
          IF        @EQUAL | @EOS
            MOVE      "AMHCC Code is blank",ERRORMS1
            CALL      PERR0000
          ELSE
            MOVE      XFLD0002,DINFIEL1
            MOVE      10,DINTLEN
            MOVE      "AMHCC Code",FLDNAME
            CALL      CCHLEN00
          ENDIF
.
          MATCH     SP70,XFLD0017
          IF        @EQUAL | @EOS
            MOVE      "AMHCC Description is blank",ERRORMS1
            CALL      PERR0000
          ELSE
            MOVE      XFLD0017,DINFIEL1
            MOVE      80,DINTLEN
            MOVE      "AMHCC Description",FLDNAME
            CALL      CCHLEN00
          ENDIF
.
          MATCH     SP70,XFLD0003
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0003,DINFIELD
            MOVE      "Average Phase Length",FLDNAME
            CALL      C62NUM00
          ENDIF
.
          MATCH     SP70,XFLD0004
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0004,DINFIELD
            MOVE      "Lower Bound (Inlier Bound)",FLDNAME
            CALL      C4NUMB00
          ENDIF
.
          MATCH     SP70,XFLD0005
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0005,DINFIELD
            MOVE      "Upper Bound (Inlier Bound)",FLDNAME
            CALL      C4NUMB00
          ENDIF
.
          MATCH     SP70,XFLD0006
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0006,DINFIELD
            MOVE      "Short Stay Outlier Base (PW)",FLDNAME
            CALL      C104NM00
          ENDIF
.
          MATCH     SP70,XFLD0007
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0007,DINFIELD
            MOVE      "Short Stay Outlier Per Diem (PW)",FLDNAME
            CALL      C104NM00
          ENDIF
.
          MATCH     SP70,XFLD0008
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0008,DINFIELD
            MOVE      "Inlier Price Weight",FLDNAME
            CALL      C104NM00
          ENDIF
.
          MATCH     SP70,XFLD0009
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0009,DINFIELD
            MOVE      "Long Stay Outlier Per Diem (PW)",FLDNAME
            CALL      C104NM00
          ENDIF
.
          MATCH     SP70,XFLD0010
          IF        !@EQUAL & !@EOS
            MOVE      XFLD0010,DINFIELD
            MOVE      "Private Patient Service Adjustment%",FLDNAME
            CALL      C32NUM00
          ENDIF
.
VMHPW999  RETURN
.
.------------------------------------------------------------------------------
. Validate a character field total Size
. Requires:  DINFIEL1 - Charcater field
.            FLDNAME  - Field Name
.            DINTLEN  - Character length
. Returns:   ERORFLAG - 1 if an error in the validation occurs.
.------------------------------------------------------------------------------
CCHLEN00  STRIP     DINFIEL1
          MOVE      DINFIEL1,DIM100
          MATCH     SP70,DIM100                * blank number ?
          IF        @EQUAL | @EOS
            GOTO      CCHLEN99
          ENDIF
.
          MOVELPTR  DIM100,FORM3
          IF        FORM3 > DINTLEN
            MOVE      "Total Char Length > Max Length Allowed",ERORDESC 
            CALL      NERR0000
            GOTO      CCHLEN99
          ENDIF
.
CCHLEN99  RETURN
.
.------------------------------------------------------------------------------
. Validate a numeric field size 3.2
.------------------------------------------------------------------------------
C32NUM00  STRIP     DINFIELD
          TYPE      DINFIELD
          IF        !@EQUAL
            PACK      ERRORMS1,CINVALID,SP1,FLDNAME
            CALL      PERR0000
            GOTO      C32NUM99
          ENDIF
.
C32NUM20  MOVE      3,DINTLEN
          MOVE      2,DDECLEN
          MOVE      0,DNEGALLW
.
          CALL      NUMDC000
.
C32NUM99  RETURN
.
.------------------------------------------------------------------------------
. Validate a numeric field size 6.2
.------------------------------------------------------------------------------
C62NUM00  STRIP     DINFIELD
          TYPE      DINFIELD
          IF        !@EQUAL
            PACK      ERRORMS1,CINVALID,SP1,FLDNAME
            CALL      PERR0000
            GOTO      C62NUM99
          ENDIF
.
C62NUM20  MOVE      6,DINTLEN
          MOVE      2,DDECLEN
          MOVE      0,DNEGALLW
.
          CALL      NUMDC000
.
C62NUM99  RETURN
.
.------------------------------------------------------------------------------
. Validate a numeric field size 10.4
.------------------------------------------------------------------------------
C104NM00  STRIP     DINFIELD
          TYPE      DINFIELD
          IF        !@EQUAL
            PACK      ERRORMS1,CINVALID,SP1,FLDNAME
            CALL      PERR0000
            GOTO      C104NM99
          ENDIF
.
C104NM20  MOVE      10,DINTLEN
          MOVE      4,DDECLEN
          MOVE      0,DNEGALLW
.
          CALL      NUMDC000
.
C104NM99  RETURN
.
.------------------------------------------------------------------------------
. Validate a numeric with decimal field
. Requires:  DINFIELD - Number/Decimal field
.            FLDNAME  - Field Name
.            DINTLEN  - Integer length
.            DDECLEN  - Decimal length
.            DNEGALLW - 1 (Yes), 0 (No)
. Returns:   ERORFLAG - 1 if an error in the validation occurs.
.            ERORDESC - Description of error when an error is occurred
.------------------------------------------------------------------------------
NUMDC000  MOVE      SP70,ERORFLAG
          STRIP     DINFIELD
          MOVE      DINFIELD,WORKFLD
          MATCH     SP70,WORKFLD               * blank number ?
          IF        @EQUAL | @EOS
            GOTO      NUMDC999
          ENDIF
.
          ASSIGN    DINTLEN+DDECLEN+1,DTOTLEN
          MOVELPTR  WORKFLD,FORM2
          IF        FORM2 > DTOTLEN
            MOVE      "Total Length > Max Length Allowed",ERORDESC
            CALL      NERR0000
            GOTO      NUMDC999
          ENDIF
.
NUMDC200  SCAN      ".",WORKFLD
          IF        @EQUAL
            BUMP      WORKFLD
            MOVEFPTR  WORKFLD,FORM2
            MOVE      WORKFLD,WORKFLDD
            SUB       TWO,FORM2
            MOVE      DINFIELD,WORKFLD
            SETLPTR   WORKFLD,FORM2
            MOVE      WORKFLD,WORKFLDI
          ELSE
            MOVE      WORKFLD,WORKFLDI
            MOVE      SP70,WORKFLDD
          ENDIF
.
          SQUEEZE   WORKFLDI
          MOVELPTR  WORKFLDI,FORM2
          IF        FORM2 > DINTLEN
            MOVE      "Integer Length",ERORDESC
            CALL      NERR0000
            GOTO      NUMDC999
          ENDIF
.
          SQUEEZE   WORKFLDD
          MOVELPTR  WORKFLDD,FORM2
          IF        FORM2 > DDECLEN
            MOVE      "Decimal Length",ERORDESC
            CALL      NERR0000
            GOTO      NUMDC999
          ENDIF
.
          COMPARE   ZERO,DNEGALLW
          IF        @EQUAL
            SCAN      HYPHEN,WORKFLD
            IF        @EQUAL
              MOVE      "Negative SIGN Not Allowed",ERORDESC
              CALL      NERR0000
              GOTO      NUMDC999
            ENDIF
          ENDIF
.
NUMDC999  RETURN
.
.------------------------------------------------------------------------------
. Validate a numeric number field size 4.
.------------------------------------------------------------------------------
C4NUMB00  STRIP     DINFIELD
          TYPE      DINFIELD
          IF        !@EQUAL
            PACK      ERRORMS1,CINVALID,SP1,FLDNAME
            CALL      PERR0000
            GOTO      C4NUMB99
          ENDIF
.
C4NUMB20  MOVE      4,DINTLEN
          MOVE      0,DNEGALLW
.
          CALL      NUMBR000
.
C4NUMB99  RETURN
.
.------------------------------------------------------------------------------
. Validate a numeric with no decimal field
.
. Requires:  DINFIELD - Number field
.            FLDNAME  - Field Name
.            DINTLEN  - Integer length
.            DNEGALLW - 1 (Yes), 0 (No)
. Returns:   ERORFLAG - 1 if an error in the validation occurs.
.            ERORDESC - Description of error when an error is occurred
.------------------------------------------------------------------------------
NUMBR000  MOVE      SP70,ERORFLAG
          STRIP     DINFIELD
          MOVE      DINFIELD,WORKFLD
          MATCH     SP70,WORKFLD               * blank number ?
          IF        @EQUAL | @EOS
            GOTO      NUMBR999
          ENDIF
.
          SQUEEZE   WORKFLD
          MOVELPTR  WORKFLD,FORM2
          IF        FORM2 > DINTLEN
            MOVE      "Integer Length > Max Length Allowed",ERORDESC
            CALL      NERR0000
            GOTO      NUMBR999
          ENDIF
.
          SCAN      ".",WORKFLD
          IF        @EQUAL
             MOVE      "Decimal not allowed",ERORDESC
            CALL      NERR0000
            GOTO      NUMBR999
          ENDIF
.
          COMPARE   ZERO,DNEGALLW
          IF        @EQUAL
            SCAN      HYPHEN,WORKFLD
            IF        @EQUAL
              MOVE      "Negative SIGN Not Allowed",ERORDESC
              CALL      NERR0000
              GOTO      NUMBR999
            ENDIF
          ENDIF
.
NUMBR999  RETURN
.
.------------------------------------------------------------------------------
. Write error message for a numeric field
.------------------------------------------------------------------------------
NERR0000  MOVE      ONE,ERORFLAG
          STRIP     FLDNAME
          STRIP     ERORDESC
.
          PACK      DIM100,CINVALID,SP1,FLDNAME,SP1,HYPHEN,SP1,ERORDESC,SP70
          STRIP     DIM100
          MOVELPTR  DIM100,FORM3
          IF        FORM3 > 70
            PACK      ERRORMS1,CINVALID,SP1,FLDNAME
            PACK      ERRORMS2,HYPHEN,SP1,ERORDESC
          ELSE
            MOVE      DIM100,ERRORMS1
            MOVE      SP70,ERRORMS2
          ENDIF
.
          CALL      PERR0000
.
NERR9999  RETURN
+
.******************************************************************************
. Print error line
.******************************************************************************
PERR0000  ADD       ONE,ERRCOUNT            * Total error count
          MOVE      ONE,ERRFLAG
.
          BRANCH    COPTION,PERR1000,PERR2000,PERR3000,PERR4000,PERR5000:
                            PERR6000,PERR7000,PERR8000,PERR8100,PERR8200
          GOTO      PERR9999
.
.         Admitted Acute PW
.
PERR1000  PACK      XADMCNTR,XFLD0001,SP70
          PACK      XADMDRGC,XFLD0002,SP70
          PACK      XADMSDPY,XFLD0004,SP70
          PACK      XADMBICU,XFLD0005,SP70
.
          MOVE      SP70,KEY50
          UNPACK    XADMDRGD,KEY50
          PRINT     *1,"|",LINECNTR,*12,"|",ERRORMSG,*59,"|":
                    XADMCNTR,*71,"|",XADMDRGC,*80,"|",KEY50:
                    *132,"|"
          GOTO      PERR9999
.
.         Non Admitted PW
.
PERR2000  PACK      XNADCNTR,XFLD0001,SP70
          PACK      XNADTIER,XFLD0002,SP70
.
          MOVE      ZERO,XNADPWEI
          MOVE      XFLD0003,XNADPWEI        * Price weight
.
          PRINT     *1,"|",LINECNTR,*12,"|",ERRORMSG,*59,"|":
                    XNADCNTR,*71,"|",XNADTIER,*80,"|",XNADPWEI:
                    *132,"|"
          GOTO      PERR9999
.
.         Emergency Department PW
.
PERR3000  PACK      XPWACNTR,XFLD0001,SP70
          PACK      XPWAURGV,XFLD0002,SP70
          PACK      XPWAURGD,XFLD0003,SP70
.
          MOVE      ZERO,XPWAPWEI
          MOVE      XFLD0003,XPWAPWEI        * Price weight
.
          UNPACK    XPWAURGD,KEY40
          PRINT     *1,"|",LINECNTR,*12,"|",ERRORMSG,*59,"|":
                    XPWACNTR,*71,"|",XPWAURGV,*82,"|",KEY40:
                    *132,"|"
          GOTO      PERR9999
.
.         ABF HAC Baseline Complexity
.
PERR4000  PRINT     *1,"|",LINECNTR,*12,"|",ERRORMSG,*59,"|":
                    XPMHCNTR,*71,"|",XPMHHACG,*80,"|",XPMHHACF:
                    *110,"|",vPMHHACV:
                    *132,"|"
          GOTO      PERR9999
.
.         MDC Detail Complexity
.
PERR5000  PRINT     *1,"|",LINECNTR,*12,"|",ERRORMSG,*59,"|":
                    XMDDCNTR,*71,"|",XMDDHACG,*80,"|",XMDDHACT:
                    *90,"|",XMDDHACF,*100,"|",VMDDCOMV:
                    *132,"|"
          GOTO      PERR9999
.
.         Age Detail Complexity
.
PERR6000  PRINT     *1,"|",LINECNTR,*12,"|",ERRORMSG,*59,"|":
                    XAGECNTR,*71,"|",XAGEHACG,*80,"|",XAGEHACT:
                    *90,"|",XAGEHACF,*100,"|",VAGECOMV:
                    *132,"|"
          GOTO      PERR9999
.
.         Charlson Detail Complexity
.
PERR7000  PRINT     *1,"|",LINECNTR,*12,"|",ERRORMSG,*59,"|":
                    XCHACNTR,*71,"|",XCHAHACG,*80,"|",XCHAHACT:
                    *90,"|",XCHAHACF,*100,"|",VCHACOMV:
                    *132,"|"
          GOTO      PERR9999
.
PERR8000  PRINT     *1,"|",LINECNTR,*12,"|",ERRORMSG,*59,"|":
                    XURGEDAT,*71,"|",XURGESTA,*80,"|",XURGTRIA:
                    *90,"|",XURGVTYP:
                    *100,"|",XURGMDBC:
                    *132,"|":
                    *N,*1,"|",XURGURGV,*12,"| ",XURGURGD:
                    *132,"|"
          GOTO      PERR9999
.
PERR8100  PRINT     *1,"|",LINECNTR,*12,"|",ERRORMS1,*89,"|":
                    XSAWCNTR,*101,"|",XSAWDRGC,*114,"|":
                    *115,XSAWCCOD,*132,"|"
          GOTO      PERR9999
.
PERR8200  PRINT     *1,"|",LINECNTR,*12,"|",ERRORMS1,*89,"|":
                    XMHWCNTR,*101,"|",XMHWAMHC,*112,"|":
                    *113,ERRAMHD,*132,"|"
          GOTO      PERR9999
.
PERR9999  RETURN
+
.******************************************************************************
. Pack fields with spaces
.******************************************************************************
PFLD0000  PACK      XFLD0001,XFLD0001,SP70
          PACK      XFLD0002,XFLD0002,SP70
          PACK      XFLD0003,XFLD0003,SP70,SP70
          PACK      XFLD0004,XFLD0004,SP70
          PACK      XFLD0005,XFLD0005,SP70
          PACK      XFLD0006,XFLD0006,SP70
          PACK      XFLD0007,XFLD0007,SP70
          PACK      XFLD0008,XFLD0008,SP70
          PACK      XFLD0009,XFLD0009,SP70
          PACK      XFLD0010,XFLD0010,SP70
          PACK      XFLD0011,XFLD0011,SP70
          PACK      XFLD0012,XFLD0012,SP70
          PACK      XFLD0013,XFLD0013,SP70
          PACK      XFLD0014,XFLD0014,SP70
          PACK      XFLD0015,XFLD0015,SP70
          PACK      XFLD0016,XFLD0016,SP70
          PACK      XFLD0017,XFLD0017,SP70,SP70
          PACK      XFLD0018,XFLD0018,SP70,SP70
.
PFLD9999  RETURN
+
.******************************************************************************
. Clear total vars
.******************************************************************************
CTOT0000  MOVE      ZERO,ERRCOUNT
          MOVE      ZERO,ADDCOUNT
          MOVE      ZERO,UPDCOUNT
.
CTOT999   RETURN
+
.******************************************************************************
. Print total line
.******************************************************************************
PTOT0000  CALL      UND132
.
          PRINT     *1,"| Total Records In File  : ",LINECNTR,*132,"|"
          PRINT     *1,"| Total Errors Found     : ",ERRCOUNT,*132,"|"
.
          IF        COPTION <> 4 & COPTION <> 5 & COPTION <> 6 & COPTION <> 7
            PRINT     *1,"| Total Records Added    : ",ADDCOUNT,*132,"|"
            PRINT     *1,"| Total Records Updated  : ",UPDCOUNT,*132,"|"
          ENDIF
.
          CALL      UND132
.
PTOT9999  RETURN
.
          INC       STD001IO
          INC       CLPMSHAC                 * clear fields
          INC       CLPMSPWA                 * clear fields
          INC       CLPMSHDE                 * clear fields
          INC       CLOUTPWO                 * clear fields
          INC       CLEMRPWD                 * clear fields
          INC       CLEMRURG                 * clear fields
          INC       CLPMSSAW                 * clear fields
          INC       CLPMSAMH                 * clear fields
          INC       PMSUKIPR                * Value Set Code Key Word Proc
.
          INC       EMRURGIO/INC            * URG File
          INC       PATCODIO/INC
          INC       PMSCIDIO/INC            * Contract ID file
          INC       PATDGWIO/INC            * DRG file
          INC       PMSHACIO/INC            * ABF HAC Baseline Complexity
          INC       PMSHDEIO/INC            * ABF HAC Detail Complexity
          INC       PMSPWAIO/INC            * Admitted Acute Price weights
          INC       OUTPWOIO/INC            * Non-Admitted Price weights
          INC       EMRPWDIO/INC            * Emergency Price weights
          INC       PMSSAWIO/INC            * ABF Sub-Acute Price Weights
          INC       PMSAMHIO/INC            * ABF MH Price Weights
          INC       PMSSNPIO/INC            * AN-SNAP Classification Code
          INC       PMSVSCIO/INC            * Clinical Coding Value Set Codes
          INC       PMSUKIIO/INC            * Key Words file for Value Set ID

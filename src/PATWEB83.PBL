.----------------------------------------------------------------------
. Program       : PATWEB83
.
. Function      : Input New Borns Web Server
.
. Modifications  :
.
.--------------------------------------------------------------------------
. V12.00.04 27/07/2025  Nikitha Bhaskar   TSK 0963585
.           Recompiled for WEBCHGUR
. V12.00.03 24/06/2025  J.Tan             TSK 0961696
.           Recompiled for WEBCHGUR - Patient Debt=4 Payment Plan admission
. V12.00.02 11/06/2025  Ebon Clements   TSK 0961623
.           Alphanueric visit number changes
. V12.00.01 22/05/2025  J.Tan          TSK 0955096
.           Added Alphanumeric visit number changes
. V11.05.05 07/05/2025  Nikitha B      TSK 0959601
.           Recomplied for PATMISTM.
. V11.05.04 04/03/2025  Thanh T        TSK 0956940
.           Recompiled for OBSAUDFD changes
. V11.05.03 06.03.2025  DA Sarkies      TSK 0955909
.           Recompliled for MERGECOD 
. V11.05.02 05.12.2024  DA Sarkies      TSK 0951086
.           Increase size of PTMIS031
. V11.05.01 22.11.2024  Ebon Clements   TSK 0953786
.           Recompile for MERGECOD
.--------------------------------------------------------------------------
. V11.04.08 30/08/2024  Bella Turco     TSK 0911922
.           Added Pref Surname to alias functionality UPALIA00
. V11.04.07 20/08/2024 Bella Turco     TSK 0911922
.           Added routine for writing a new alias for Preferred Name UPALIA00
. V11.04.06 27/06/2024  DA Sarkies     TSK 0948535
.           Recompiled for PATMSXTM
. V11.04.05 27/03/2024  Ebon Clements  TSK 0944691
.           Recompiled for WEBCHGUR - Future end dated alerts
. V11.04.04 05.02.2024 DA Sarkies     TSK 0936282
.           Increased size of variable for Healthfund Number
. V11.04.03 29.01.2024 DA Sarkies     TSK 0936282
.           Increased size of PTMIS015 from 10 to 19
. V11.04.02 19/12/2023 Peter Vela     TSK 0935874
.           Added call to WPMNPL00 inm Patient Merge for Old URNumber
. V11.04.01 27/11/2023 Thanh T                TSK 0916369
.           Recompiled for PRIFACFD changes
. V11.03.04 09/11/2023 Peter Vela     TSK 0935874
.           Added single hospital / multi hospital validation in
.           before WRPMNPL1 for NIHC IHI Lookup
. V11.03.03 13/10/2023  Thanh T.         TSK 0935874
.           Changed CHUR0000 to call WPMNPL00 to write out pmsnplaf
.           record when alternate ID is deleted and PTCNUNET = 3
. V11.03.02 12/10/2023 Thanh T           TSK 0935874
.           Changed CHUR1000 to comment out the codes for PTCNUNET = '1'
.           since it is no longer used
. V11.03.01 05/10/2023  Thanh T.         TSK 0935874
.           Changed CHUR0000 to call WPMNPL00 to write out pmsnplaf
.           record when alternate ID is deleted and PTCNUNET = 3
. V11.02.06 18.08.2022  Ebon Clements  TSK 0923221
.           Populate new contact mothers NOK mobile - PMPXKMOB - INBFOR00
. V11.02.05 15.07.2022  DA Sarkies     TSK 0920112
.           Recompiled for WEBCHGUR
. V11.02.04 07.07.2022  Jacob Jackson  TSK 0918332
.           Recompiled for MRGURWEB
. V11.02.03 22.06.2022  DA Sarkies     TSK 0918318
.           Recompiled for MERGECOD
. V11.02.02 20/06/2022  Ebon Clements  TSK 0920670
.           Recompiled for WEBCHGUR - Previous address write
. V11.02.01 10/02/2022  Thanh T          TSK 0889899
.           Recompiled as WATTR1FD changes
. V11.01.04 21/06/2021  Thanh T.       TSK 0907329  
.           Added FORNAM00 to show the boarder name instead of patient names 
. V11.01.03 15/06/2021  Jill Parkinson Task 0907333
.           Added check for z70 for ptmas070 to correct multiple birth icon   
. V11.01.02 31/03/2021  Tracey Nguyen   TSK 0904417
.           Recompiled for MEHPATFD in WEBCHGUR - added MHPTFAMW Family/Whanau
.           Involvement
. V11.01.01 19/03/2021  Ebon Clements  TSK 0902467
.           Added write of opt out of SMS record to PMSOOSFD
. V11.00.08 30/12/2020  Thanh T        TSK 0878747
.           Recompiled for WEBCHGUR changes
. V11.00.07 09/12/2020  Thanh T        TSK 0872840
.           Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
. V11.00.06 05/11/2020 Thanh T        TSK 0878747
.           Added MBRTH000 SPMAS700 and SPMAS710
. V11.00.05 09/09/2020 Peter Vela     TSK 0895969
.           Recompiled for WEBCHGUR
. V11.00.04 19/06/2020 Ebon Clements  TSK 0893481  
.           Recompiled for WEBCHGUR - Infinite loop in FXDSPT00 (V11.00.01)
. V11.00.03 30/04/2020 Thanh T        TSK 0876574
.           Added SPMSX470 to SPMSX510
. V11.00.02 20/04/2020 Ebon Clements  TSK 0889129
.           Recompiled for WEBCHGUR - legacmaf comments
. V11.00.01 15/04/2020 Jill Parkinson Task 0890599
.           Added call to FXDSPT00
. V10.14.07 20/09/2019 Jill Parkinson TSK 0878880
.           Mods to only open and update acclodaf for NZ
. V10.14.06 16/09/2019 Thanh T        TSK 0878880
.           Changed CHAD0000 to add ACCURC00 for updating the new U/R number
.           for ACC details    
. V10.14.05 17/07/2019 Ebon Clements  TSK 0877986
.           Added 20 zero test to PTCNNSSI using EDWARD
. V10.14.04 12/07/2019 Richa Phogat   TSK 0864751
.           Recompiled for WEBCHGUR
. V10.14.03 10/07/2019 Richa Phogat   TSK 0864751
.           - Added code to add one second to the record in WEBCHGUR under 
.             FIXCCAUD
.           - Recompiled for WEBCHGUR
. V10.14.02 15/04/2019 Jill Parkinson Task 0873055
.           Added write to pmsedwaf when adding a contact         
. V10.14.01 12/04/2019 Jill Parkinson Task 0872956
.           Corrected pack of key before writing to pmsedwaf      
. V10.13.06 21/12/2018 Jill Parkinson Task 0864975
.           Recompiled for WEBCHGUR - removed close of pmsedwaf
. V10.13.05 18/12/2018 Jill Parkinson Task 0864975
.           Recompiled for WEBCHGUR - write to pmsedwaf
. V10.13.04 05/12/2018  Nicole Torrisi    TSK 0866945
.           Added admtflag=1 to SETRED00
. V10.13.03 24/10/2018  Ebon Clements     TSK 0865146
.           Added AH Referral EDWARD changes U/R write - WEDU0000
. V10.13.02 22/10/2018  Ebon Clements     TSK 0865146
.           Added EDWARD alteration file writes for full merge - WEDR0000
. V10.13.01 17/10/2018  Ebon Clements     TSK 0865146
.           Added EDWARD alteration file writes
. V10.12.04 25/06/2018  Ebon Clements     TSK 0845295
.           Recompiled for WEBCHGUR - eReferrals
. V10.12.03 25/05/2018  Thanh T.          TSK 0856102
.           Added PMSEHB00 for pmsehbaf in WEBCHGUR
. V10.12.02 12/04/2018  Don Nguyen       TSK 0844685
.           Added ADDMUP00 - add record to Missing UPI Patients table
.           05/04/2018  Steve Armstrong  TSK 0844685
.           Recompiled for changes to WEBCHGUR
.           06/04/2018  Davin            TSK 0844685
.           Recompiled for changes to WEBCHGUR
. V10.12.01 26/02/2018  Ken Bell       TSK 0852699
.           Added CONFDEMO to record Demographic Confirmation
.----------------------------------------------------------------------
. V10.11.09 14/12/2017  Ania P         TSK 0849648
.           Recompiled for MRGURPRI               
. V10.11.08 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.07 02/11/2017  Ebon Clements  TSK 0843363
.           Added ur comments functionality to input newborns
. V10.11.06 16/10/2017  Thanh T.       TSK 0846191
.           Recomplied for OPTHETAT
. V10.11.05 21/09/2017  Thanh T.       TSK 0821710
.           Recompiled WEBCHGUR
. V10.11.04 13/09/2017  Thanh T.       TSK 0821710
.           Recompiled WEBCHGUR
. V10.11.03 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. 
.           changed PATMASTM/PMSPX2TM.
. V10.11.02 26/07/2017  Thanh T.         TSK 0821710
.           Recompiled PASMISTM
. V10.11.01 14/07/2017  Thanh T.         TSK 0821710
.           Audit Amission/outpatient visit comments. PATMISTM changed.
.--------------------------------------------------------------------------
. V10.10.03 08/06/2017  Don Nguyen       TSK 0838220
.           Modified CHAD3500 to broadcast A44 HL7 message (change U/R)
. V10.10.02 24/04/2017  Peter Vela       TSK 0830875
.           Fixed read of PTCNNWCA
. V10.10.01 12/04/2017  Peter Vela       TSK 0836016
.           Recompiled for WEBCHGUR - Always keep bad debt in
.           FIXMAS
. V10.08.18 11/11/2016  Don Nguyen       TSK 0825275
.           Modified INBFOR00 to not call DEFMAS00 if BABYURNO exists (NZ)
. V10.08.17 18/08/2016  Ebon Clements    TSK 0260691
.           Recompiled for WEBCHGUR - A/H equipment loans
. V10.08.16 08/08/2016  Davin            TSK 0321234
.           Recompiled for WEBCHGUR - Added chronic condition alert (savesn11)
. V10.08.15 08/08/2016  Ebon Clements     TSK  0821167                  
.           Recompiled for WEBCHGUR - Referral mehvi1af record - RMHV0000
. V10.08.14 04/08/2016  Jill Parkinson    TSK  0823534                  
.           Recompiled for WEBCHGUR - Changed key32 to key35 for FIXATR00 
. V10.08.13 29/07/2016  Don Nguyen        TSK 0809271
.           Recompiled for WEBCHGUR - Modified FXBKRES1 to call UPESIS00
. V10.08.12 26/07/2016  Davin             TSK 0819297
.           Added opatcanc for change UR message (cancelled appointments)
. V10.08.11 12/07/2016  Davin             TSK 0315393
.           Added saveretn flag for record retention details
. V10.08.10 08/07/2016  Jill Parkinson    TSK 0822002
.           Recompiled for PATMASTM
. V10.08.09 05/07/2016  Jill Parkinson TSK 0821774   
.           Added move of one to exit in CHUR9000 and CHUR9200 
. V10.08.07 30/06/2016  Jill Parkinson TSK 0821774   
.           Recompiled for WEBCHGUR - added CCC into PTURDATE 
. V10.08.06 17/06/2016  Peter Vela     TSK 0820868
.           Recompiled for MRGURPRI
. V10.08.05 18/05/2016  Jill Parkinson TSK 0817063  
.           Recompiled for WEBCHGUR 
. V10.08.04 13/05/2016  Don Nguyen       TSK 0319664
.           Recompiled for WEBCHGUR - added FIXOBSNT
. V10.08.03 29/04/2016  Jill Parkinson   TSK 0817063
.           Recompiled for WEBCHGUR - added mehscraf
. V10.08.02 28/04/2016  Don Nguyen       TSK 0316489
.           Recompiled for WEBCHGUR/PATATRFD
.           18/04/2016  Peter Vela       TSK 0294177
.           Recompiled for MRGURPRI
. V10.08.01 01/04/2016  Steve Armstrong  TSK 0324703
.           Recompiled for changes to PATURCFD & WEBCHGUR
.----------------------------------------------------------------------
. V10.07.07 04/02/2016  Peter Vela       CAR 0809659
.           Recompiled for WEBCHGUR
. V10.07.06 02/02/2016  Peter Vela       CAR 0809659
.           Recompiled for SVRSPMI
. V10.07.05 04/01/2016  Ebon Clements    TSK 0294154
.           Recompiled for WEBCHGUR - Opt out of SMS in previous address
. V10.07.04 27/11/2015  Ebon Clements    CAR 294154
.           Recompiled for WEBCHGUR - PMSOOSFD
. V10.07.03 05/11/2015  Steve Armstrong  CAR 303363
.           Recompiled for changes to RESHEAFD
. V10.07.02 30/10/2015  Don Nguyen     CAR 320394
.           Recompiled for changes to WATTX1FD/IO
. V10.07.01 09/10/2015  Ebon Clements    CAR 316633               
.           Recompiled for changes to WEBCHGUR  - ALLWLNFD 
.----------------------------------------------------------------------
. V10.06.07 30/09/2015  Ania P           CAR 321333               
.           Recompiled for changes to WEBCHGUR                    
. V10.06.06 21/09/2015  Davin            CAR 313906
.           Recompiled for PMSCEXCD - allow patmx1af/patma1af details
. V10.06.05 06/07/2015  Peter Vela       CAR 316928
.           Recompiled for MRGURWEB 
. V10.06.04 03/07/2015  J.Tan            CAR 316441
.           Recompiled for changes to WEBCHGUR - pmsdauaf file
. V10.06.03 10/06/2015  Steve Armstrong  CAR 313856
.           Recompiled for changes to WEBCHGUR
. V10.06.02 30/05/2015  Ania P           CAR 313313
.           Added PMRSSTDN
. V10.06.01 12/03/2015  Steve Armstrong  CAR 314108
.           Removed reference to PATCGPFD (No Longer in use)
.----------------------------------------------------------------------
. V10.05.07 10/12/2014  Davin            CAR 304926
.           Changed BRDHST00 to check boarder end time against current time
. V10.05.06 02/12/2014  Davin            CAR 304926
.           Changed BRDHST00 to check boarder end date against current date
. V10.05.05 14/10/2014  Peter Vela       CAR 301518
.           Recompiled for MRGURWEB
. V10.05.04 30/09/2014  Davin            CAR 306539
.           Recompiled for PATBRDTM - Added "Invalid IBA Tag" to brdr0000
. V10.05.03 03/09/2014  J.Tan            CAR 298984
.           Recompiled for WEBCHGUR - changes to PATDETFD
. V10.05.02 26/08/2014  Ania P           CAR 303210
.           Recompiled for WEBCHGUR
. V10.05.01 18/08/2014 Jill Parkinson CAR 299980    
.           Added OPTHETAT functionality
.----------------------------------------------------------------------
. V10.04.05 05/06/2014  Steve Armstrong  CAR 299293
.           Removed the WMRG0000, WESIM000, WPRSP000, PRS2T000,
.           WESP0000, CHKESI00 & CLRWTESI routines out of this program
.           and put them into a common include (MERGECOD.PBL), so 
.           that the code can be shared with HL7RECVR when processing
.           merges.  All these routines are called from within the
.           CHUR0000 routine around the call to CHANGEUR.
.           Also recompiled for changes to WEBCHGUR.
. V10.04.04 16/05/2014  Ebon Clements  CAR 300668
.           Recompiled for WEBCHGUR - LEGALTFD I * U
. V10.04.03 07/04/2014  Peter Vela      CAR 286258
.           Recompiled for PATMASTM
. V10.04.02 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.01 11/03/2014  Peter Vela     CAR 218689
.           Recompiled for WEBCHGUR - Added BOKRQ1FD
.           28/02/2014  Don Nguyen     CAR 291879
.           Call WIPL0000 for U/R Merge (CHUR0000)
.----------------------------------------------------------------------
. V10.03.68 09/12/2013  Peter Vela     CAR 286158
.           Recompiled for WEBCHGUR - Added PATATRFD
. V10.03.67 12/11/2013  Ania P         CAR 232594
.           Fixed incorrect Change UR functionality in CHAD4500
. V10.03.66 08/10/2013  Ebon Clements  CAR 275205
.           Recompiled for WEBCHGUR - EBS created U/R numbers where PSTAT=4
. V10.03.65 03/10/2013  Ebon Clements  CAR 275205
.           Recompiled for PMSARQFD - Addition of transfer source
. V10.03.64 27/09/2013  Peter Vela       CAR 291485
.           Added PTCNWBDS for Boarders
. V10.03.63 25/09/2013  Ebon Clements    CAR 275205
.           Recompiled for WEBCHGUR - Electronic booking files
. V10.03.62 27/08/2013  Ebon Clements    CAR 275205
.           Recompiled for WATTX1FD - New fields WTTXPSAH and WTTXPHOS
. V10.03.61 10/09/2013  Steve Armstrong  CAR 291089
.           Recompiled for changes to PMSQVIIO
. V10.03.60 22/08/2013  Ebon Clements    CAR 281169
.           Recompiled for WEBCHGUR - Health fund program files
. V10.03.59 19/08/2013  Ebon Clements    CAR 290429
.           Recompiled for WEBCHGUR - Removed closed of booking file
. V10.03.58 30/07/2013  Ebon Clements    CAR 283202
.           Recompiled for PMSPX2TM - Preferred method of contact
. V10.03.57 26/07/2013  Steve Armstrong  CAR 287787
.           Recompiled for changes to DGCLICUA.
. V10.03.56 18/07/2013  Steve Armstrong  CAR 268961
.           Recompiled for changes to PMSQVIFD.
. V10.03.55 17/07/20213 Ania P          CAR 219768 
.           Recompiled for NEWBNMAS    
. V10.03.54 09/07/2013  Jill Parkinson  CAR 288188  
.           Recompiled for WEBCHGUR - WLSGL800 incorrect goto 
. V10.03.53 30/06/2013  Davin             CAR 283202
.           Recompiled for changes to hl7 messaging (pmsqptfd)
. V10.03.52 28/06/2013  Patrick Adair    CAR 286757
.           Recompiled for changes to MRGURWEB (in WEBCHGUR)
. V10.03.51 27/06/2013  Ebon Clements    CAR 287504
.           Open mltsecaf regardless of multi hospital
. V10.03.50 21/06/2013  Peter Vela       CAR 283202
.           Recompiled for NEWBNMAS
. V10.03.49 03/05/2013  Steve Armstrong  CAR 284376
.           Recompiled for changes to DGCLICMR & DGCLICUP.
. V10.03.48 02/05/2013  Don Nguyen       CAR 284693
.           Recompiled for changes to IBAWEBCD (TITLESEL & RELATSEL)
. V10.03.47 01/05/2013  Peter Vela       CAR 283938
.           Recompiled for WEBCHGUR
. V10.03.46 12/04/2013  Steve Armstrong  CAR 283973
.           Recompiled for changes to WEBCHGUR
. V10.03.45 03/04/2013  Davin            CAR 270648
.           Recompiled for changes to HL7 messaging includes
. V10.03.44 05/03/2013  Jill Parkinson   CAR 257831
.           Recompiled for changes to WEBCHGUR, added pmsupdaf
. V10.03.43 25/02/2013 Ania P            CAR 281021
.           Removed unnecessary modification of constants.
. V10.03.42 07/02/2013  Ebon Clements    CAR 272465
.           Recompiled for changes to WEBCHGUR - FIXPCT
. V10.03.41 13/12/2012  Jill Parkinson   CAR 278129  
.           Recompiled for changes to WEBCHGUR, fixed hospital on pmswtraf
. V10.03.40 10/12/2012  Steve Armstrong  CAR 275430
.           Recompiled for changes to WEBCHGUR
.           21/11/2012  Jill Parkinson   CAR 275033
.           Recompiled for changed to WEBCHGUR, add WL tables for booked patient
. V10.03.39 01/11/2012  Saroeun Soeur    CAR 275430
.           Recompiled for changed to WEBCHGUR to call proc FIXTRNST
.           added call to FXVT0000 routine
. V10.03.38 01/10/2012  Peter Vela       CAR 270657
.           Added hospital default for Boarder Details List
.           01/10/2012  J.Tan            CAR 273717
.           Mods to write Create/Update Date to pmsresaf file
. V10.03.37 20/09/2012  Davin            CAR 272562
.           Get tran details for dgate write in pinp0000 (gettrn00)
. V10.03.36 10/09/2012  Peter Vela       CAR 271656
.           Fixed read of Admission file @ BRDHST15 
. V10.03.35 07/09/2012  Peter Vela       CAR 269131
.           Initialise PTWDSDES before read of patwr1af
. V10.03.34 31/08/2012  J.Tan            CAR 270090
.           Recompiled for changes to WEBCHGUR to call FLAGDEBT
. V10.03.33 14/08/2012  Steve Armstrong  CAR 256888
.           Recompiled for changes to WEBCHGUR.
. V10.03.32 09/08/2012  Peter Vela    CAR 270651
.           Added tag for ASTAT
. V10.03.31 06/07/2012  Mike Laming   CAR 261603
.           Recompiled for WEBCHGUR - correct Key for MEHPATaf to KEY32
. V10.03.30 05/07/2012  Steve Armstrong  CAR 268152
.           Added PVITYPE check around CALL to VALDIN00 & VALDEM00.
.           Also changed VALDIN00 & VALDEM00 to use PVIBILL instead
.           of DPVIBILL.
. V10.03.29 02/07/2012  Jill Parkinson   CAR 268273
.           Added use of PTCNMEMR
. V10.03.28 01/06/2012  Peter Vela       CAR 266237
.           Added read of ALCNRAUD from controlf
. V10.03.27 29/05/2012  J.Tan            CAR 259554               
.           Recompiled for WEBCHGUR - Event visit to upd patinvrf 
. V10.03.26 23/05/2012  Ebon Clements   CAR 265676
.           Recompiled for WEBCHGUR
. V10.03.25 16/05/2012  Ebon Clements   CAR 265176
.           Recompiled for WEBCHGUR - Extra contacts
. V10.03.24 19/04/2012  Jill Parkinson  CAR 263850
.           Recompiled for PATCOMN2 - GNXTUR locking
. V10.03.23 11/04/2012  Steve Armstrong CAR 263369
.           Recompiled for WEBCHGUR
. V10.03.22 04/04/2012  Peter Vela      CAR 262395
.           Recompiled for WEBCHGUR
. V10.03.21 04/04/2012  Steve Armstrong CAR 262582
.           Recompiled for changes to WEBCHGUR
. V10.03.20 03/04/2012  Don Nguyen      CAR 262735
.           Recompiled for WEBCHGUR
. V10.03.19 13/03/2012  Jill Parkinson CAR 261568
.           Recompiled for WEBCHGUR
. V10.03.18 23/02/2012  Ebon Clements  CAR 260407
.           Recompiled for SAVPMIFD and SVRSPMI
. V10.03.17 15/02/2012  Davin          CAR 256006
.           Recompiled for changes to WATQUEFD
. V10.03.16 08/02/2012 Peter Vela       CAR 252171
.           Added Admission Time tag to BRDP0000
. V10.03.15 06/02/2012  Ebon Clements   CAR 257079
.           Recompiled for SVRSPMI - Patient surname
. V10.03.14 30/01/2012  Ebon Clements   CAR 258378
.           Recompiled for NEWBNMAS - NOK defaults
. V10.03.13 19/01/2012  J.Tan           CAR 257082
.           Fixed checking for Boarder Linked U/R number
. V10.03.12 17/01/2012  Ebon Clements   CAR 257079
.           Recompiled for SAVPX2FD and SVPMSPX2
. V10.03.11 16/01/2012  Sandra Barcham  CAR 256563
.           Recompiled for PATMASTM
. V10.03.10 13/12/2011 Jill Parkinson   CAR 249362
.           Fixed alert key in CHKALR00
. V10.03.09 08/12/2011 Ebon Clements    CAR 248529
.           Added webPAS unique id to contacts
. V10.03.08 06/12/2011  Ebon Clements   CAR 256372
.           Update current patient file in change ur by admission - FCUR0000
. V10.03.07 02/12/2011  Jill Parkinson   CAR 249362
.           Recompiled for changes to WEBCHGUR (alert key changes)
. V10.03.06 29/11/2011  Steve Armstrong  CAR 253264
.           Recompiled for changes to WEBCHGUR
. V10.03.05 23/11/2011  Nicole Torrisi  CAR 231879
.           Added call to FIXDET00 to CHAD0000
. V10.03.04 18/11/2011  Peter Vela      CAR 252534
.           Fixed "All" hospital default for multihospital @ BRDP2900
. V10.03.03 11/11/2011  Peter Vela      CAR 252534
.           Fixed mltsec validation in BRDHST00
. V10.03.02 10/11/2011  Ebon Clements     CAR 248529
.            Added multiple contacts of the same type functionality
. V10.03.01 07/11/2011  Nicole Torrisi  CAR 231879
.           Added FIXDET00 to update oprdetaf when changing UR
.           by admission number
.----------------------------------------------------------------------
. V10.02.32 27/10/2011  Steve Armstrong CAR 251323
.           Recompiled for PMSQVIFD changes
. V10.02.31 25/10/2011  Peter Vela       CAR 252534
.           Added mltsec validation in BRDHST00
.           24/10/2011  Jill Parkinson   CAR 251645
.           Added change U/R of an linked statistical admission
. V10.02.30 17/10/2011  Ebon Clements    CAR 251052
.           Added change U/R of an ED visits linked IP admission
. V10.02.29 11/10/2011  Mark Coupland    CAR 252429
.           Recompiled for PMSPX2TM and PATMASTM
. V10.02.28 10/10/2011  Jill Parkinson CAR 252484    
.           Added setting of PTMXRDAT before calls to WRMAST1
. V10.02.27 05/10/2011  Ebon Clements     CAR 251737
.           Added newborn write NOK to extra contact functionality
. V10.02.26 26/09/2011  Ebon Clements     CAR 250746
.           Recompiled for newborn defaults - Health fund contributor name
. V10.02.25 22/09/2011  Ebon Clements     CAR 251121
.           Recompiled for newborn defaults - extra doctors code
. V10.02.24 13/09/2011 Jill Parkinson  CAR 248652
.           Recompiled for PMSPX2TM - Added read of pmsvx1af in GETCURIP
. V10.02.23 08/09/2011  Ebon Clements    CAR 250642
.           Recompile for WEBCHGUR - Removed close of discharge file
. V10.02.22 29/08/2011  Jill Parkinson   CAR 244039
.           Added conttype and recompiled for NEWBNMAS
.           29/08/2011  Ebon Clements    CAR 242014
.           Recompile for WEBCHGUR - OP direct files
. V10.02.21 06/09/2011  Jill Parkinson CAR 249997
.           Recompiled for WEBCHGUR
. V10.02.20 29/08/2011  Peter Vela       CAR 249006
.           Added validation for blank boarder birth date
. V10.02.19 25/08/2011  Steve Armstrong  CAR 249085  
.           Added DGCLICUP trigger for Mother/Child link
. V10.02.18 25/08/2011  Jill Parkinson CAR 248489    
.           Fixed write to the surname file
. V10.02.17 11/08/2011  Peter Vela        CAR 240705
.           Added tag for PSNAME for Boarder Defaults WAHealth
. V10.02.16 09/08/2011  Peter Vela        CAR 240705
.           Fixed validation for master file @ BORD0040
. V10.02.15 01/08/2011  Peter Vela        CAR 240705
.           Added validation for master file @ BORD0040
. V10.02.14 26/07/2011  Steve Armstrong   CAR 240684
.           Recompiled for changes to LEGALTFD & WEBCHGUR
. V10.02.13 21/07/2011  Jill Parkinson    CAR 240721
.           Added manalloc - for wa health empi service
. V10.02.12 20/07/2011  J.Tan             CAR 239592
.           Mods to pmsresaf file
. V10.02.11 14/07/2011  Peter Vela        CAR 240705
.           Added tag for Admission status @ BRDP0000
. V10.02.10 13/07/2011  Steve Armstrong   CAR 240722
.           Further mods to cater for second given name as
.           part of PATGSRFD keys
. V10.02.09 09/07/2011  Steve Armstrong  CAR 240722
.           Mods to cater for changes to PATGSRFD:
.                - GSRSNAM & GSRGNAM extended to 30 chars.
.                - PTGSGNM2 added.
.                - all indexes changed in length.
. V10.02.08 05/07/2011  Peter Vela      CAR 240705
.           Changed BORD0030 to Copy to Current URNO Inpatient Admission only
. V10.02.07 05/07/2011  Jill Parkinson  CAR 242269   
.           Added RELSLK00 for boarders
. V10.02.06 04/07/2011  Steve Armstrong   CAR 240722
.           Recompiled for changes to PATLOCFD.
.           Recompiled for changes to PMSCURFD.
. V10.02.05 09/06/2011  Peter Vela     CAR 240705
.           Added Hospital Boarder functionality for WAHealth
. V10.02.04 10/05/2011  J.Tan          CAR 239588
.           Created CLPMSRES - clear patient Residency file
. V10.02.03 09/05/2011  Davin         CAR 239539
.           Recompiled for WEBCHGUR - added savesin7/8/9
. V10.02.02 05/05/2011  Mike Laming   CAR 240720
.           Recompiled for WEBCHGUR - added Appointment Request table
. V10.02.01 21/04/2011  Mike Laming   CAR 233229
.           Recompiled for WEBCHGUR - added Patient Debt Indicators
.----------------------------------------------------------------------
. V10.01.05 02/02/2011  Steve Armstrong   CAR 237520
.           Mods to remove Detente interface (PATDETNT)
. V10.01.04 10/01/2011  Mike Laming       CAR 214541
.           Changed code to use "SQUEEZE" when creating PTMIS051 (Baby Weight)
. V10.01.03 04/01/2011  Jill Parkinson    CAR 235114
.           Fixed reads for nz in REGB0000
. V10.01.02 02/12/2010  Jill Parkinson    CAR 227455
.           Added PTMAS069
. V10.01.01 17/11/2010  Jill Parkinson    CAR 233088
.           Increased PTMAS038 from 10 to 19
.----------------------------------------------------------------------
. V10.00.07 27/10/2010  Steve Armstrong   CAR 232111
.           Recompiled for changes to WEBCHGUR
. V10.00.06 23/08/2010  J.Tan             CAR 228752
.           Recompiled for MRGURPRI - Private Practice Credit notes files
. V10.00.05 28/07/2010  Jill Parkinson    CAR 224859 227087
.           Recompiled for WEBCHGUR - moved call to URNC0000
. V10.00.04 02/07/2010  Ebon Clements     CAR 218982
.           Recompiled for WEBCHGUR - watchaaf
. V10.00.03 19/03/2010  Davin S           CAR 223380
.           Recompiled for changes to PMSCCDFD
. V10.00.02 09/04/2010 Steve Armstrong   CAR 219045
.           Recompiled for changes PATMRGFD.
.           Mods to populate PTMRSTIM.
. V10.00.01 19/03/2010  Steve Armstrong   CAR 135505
.           Added HL7TRGID & HL7INCLD setting for all broadcast messages
.-------------------------------------------------------------------------------
. V9.12.07  01/03/2009  Steve Armstrong  CAR 217090
.           Recompiled for WEBCHGUR 
. V9.12.06  19/11/2009  Jill Parkinson CAR 210230
.           Mods to pack AADMNO before calling FXBKRES1
. V9.12.05  09/10/2009  WeeLee Koo    CAR 181371
.           Recompiled for WEBCHGUR 
. V9.12.04  27/08/2009  Ebon Clements CAR 202965
.           Recompiled for WEBCHGUR - pmscdnaf
. V9.12.03  26/05/2009  Jill Habasque CAR 159753
.           Added cgi for TEMPORAR
. V9.12.02  13/05/2009  Jill Habasque CAR 189816
.           Recompiled for WEBCHGUR - nzprdtaf
. V9.12.01  06/05/2009  WeeLee Koo   CAR 189361
.           Call merged events function - FIXEVT
. V9.11.07  15/04/2008  Ebon Clements     CAR 187411
.           Added newborn defaults to INBFOR00 when BABYURNO populated (NZ)
. V9.11.06  15/04/2009  Jill Habasque     CAR 159753
.           Added report option 4 - Input Boarder        
. V9.11.05  19/02/2009  Steve Armstrong   CAR 190455
.           Recompiled for (Eclipse) changes to WEBCHGUR.
. V9.11.04  16/02/2009  Jill Habasque     CAR 186302
.           Added use of PTCNEMPL
. V9.11.03  10/12/2008  Ebon Clements     CAR 174081
.           Recompiled for WEBCHGUR - Added bed board to change ur by admission
. V9.11.02  20/11/2008  Steve Armstrong   CAR 181373
.           Recompiled for changes to PMSPTDFD and WEBCHGUR.
.           Added read of PTCNTRPR.
. V9.11.01  08/10/2008  Ebon Clements    CAR 174068
.           Recompiled for WEBCHGUR - pmsbbdaf and pmsepbaf
.----------------------------------------------------------------------
. V9.10.05  03/09/2008  J.Tan            CAR 177376
.           Recompiled for WEBCHGUR - pmsfedaf file
. V9.10.04  29/08/2008  Jill Habasque    CAR 176108
.           Mods to append mothers name in NBFD0300
. V9.10.03  01/08/2008  Jill Habasque    CAR  170470
.           Added error if changing a UR to itself
. V9.10.02  07/07/2008  Jill Habasque    CAR  162660
.           Recompiled for changes to WEBCHGUR
. V9.10.01  30/04/2008  Jill Habasque    CAR 165994
.           Mods to populate WTEPEDOB for ESIS
.----------------------------------------------------------------------
. V9.09.06  28/02/2008  Ebon Clements    CAR 162564
.           Recompiled for WEBCHGUR - Related provider invoice files
. V9.09.05  30/01/2008  Peter Vela       CAR 155334
.           Recompiled for WEBCHGUR. Added PMSPTDFD, IO
. V9.09.04  18/01/2008  Steve Armstrong  CAR 159429
.           Recompiled for changes to WEBCHGUR
. V9.09.03  01/10/2007 Sandra Barcham CAR 151255
.           Fix loop for alllonaf to stop I * U
. V9.09.02  28/09/2007 Sandra Barcham CAR 151255
.           Fix loop for allpctaf to stop I * U
.           27/09/2007  Mike Laming   CAR 146598
.           Added LEGALTFD/IO for WEBCHGUR
. V9.09.01  27/08/2007  Peter Vela   CAR 147747
.           Added variables for PATCOMN2 Cabrini Health UR format
.----------------------------------------------------------------------
. V9.08.05  20/04/2007  Jill Habasque    CAR 130753
.           Recompiled for changes to WEBCHGUR
. V9.08.04  20/04/2007  Steve Armstrong   CAR 111005
.           Recompiled for changes to WEBCHGUR
.           15/03/2007  Jill Habasque CAR 127119
.           Mods to only read mothers details if registering newborn 1st time
. V9.08.03  31/01/2007  Peter Vela    CAR 127930
.           Recompled for MRTCONFD
. V9.08.02  27/12/2006  Jill Habasque CAR 127515
.           Added "missing mothers admission" for regb0000
. V9.08.01  13/10/2006  Peter Vela    CAR 120583
.           Recompiled for WEBCHGUR - Defaulted MRMACOMM to SP70 in CRMED000
.----------------------------------------------------------------------
. V9.07.07  18/09/2006  Ebon Clements CAR 107243    
.           Recompiled for WEBCHGUR - patient cdm file and alert audits
. V9.07.06  23/08/2006  Jill Habasque CAR 109594
.           Recompiled for MRGURPRI - Added save of invoice number
. V9.07.05  01/08/2006  Mike Laming   CAR 87846
.           Recompiled for WEBCHGUR - fix WRITE at FIXHIS30
. V9.07.04  13/07/2006  Jill Habasque CAR 112134
.           Recompiled for WEBCHGUR
. V9.07.03  07/07/2006  Ebon Clements     CAR 103365
.           Recompiled for WEBCHGUR - Expected payors and extra contacts
. V9.07.02  05/07/2006  Peter Vela        CAR 110905
.           Fixed mother's default for Health Fund and Table
. V9.07.01  05/07/2006  Jill Habasque     CAR 97767
.           Added call to CRMED000 for input new borns
.----------------------------------------------------------------------
. V9.06.03  08/06/2006  Steve Armstrong   CAR 108060
.           Added call to PMIGTNID to set NHI variables before call
.           to DGCLICUP.
. V9.06.02  07/06/2006  Neelkamal Pyla CAR 107159
.           Added code to get Mother's name in INBFOR00
. V9.06.01  02/05/2006  Jill Habasque CAR 94905
.           Added update of pmspx2af in REGB0000
.----------------------------------------------------------------------
. V9.05.02  27/03/2006  Jill Habasque CAR 78524
.           Added write of PTMRUSER
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B07 20/02/2006  Ebon Clements     CAR 76341
.           Added referral and encounter file audit 
. V9.05.B06 13/02/2006  Peter Vela        CAR 91884
.           Changed 'Baby of' , 'Son of or Daughter of' constants to capitals
. V9.05.B05 31/01/2006  Peter Vela    CAR 54614
.           Recompiled for PMSQVIFD
. V9.05.B04 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.05.B03 21/12/2005  Steve Armstrong   CAR 89329
.           Recompiled for changes to MRGURRES
. V9.05.B02 08/12/2005  Ebon Clements CAR 84708
.           Added edit to ensure old ur exists before processing merge CHKO0000
.----------------------------------------------------------------------
. V9.04.27  01/12/2005  Ebon Clements CAR 86579
.           Recompiled for WEBCHGUR - Retail old ur pmspx2af details
. V9.04.26  25/11/2005  Jill Habasque CAR 82652
.           Recompiled for WEBCHGUR                      
. V9.04.25  21/11/2005  Jill Habasque CAR 85085
.           Mods to not default mothers details for NZ
. V9.04.24  02/05/2005  Mike Laming   CAR 60976
.           Recompiled for WEBCHGUR - Add routine for "Intepreter Visit Dets"
. V9.04.23  18/10/2005  Steve Armstrong   CAR 64087
.           Added A44 broadcast trigger (DGCLICUR)
. V9.04.22  02/08/2005  Davin         CAR 64087
.           Mods for PAS/CIS and proprietary interface changes
. V9.04.21  05/09/2005  Jill Habasque CAR 73862
.           Mods to write to watesmaf and watespaf
. V9.04.20  12/08/2005  J.Tan         CAR 71924
.           Recompiled for WEBCHGUR - to read parameter to using HIC med claim
. V9.04.19  13/07/2005  Jill Habasque CAR 58811
.           Added check for SAVEDETL=0 before calling RSURN000
. V9.04.18  20/06/2005  Jill Habasque CAR 61859
.           Recompiled for WEBCHGUR
. V9.04.17  30/05/2005  Jill Habasque CAR 61534
.           Added newborn defaults
. V9.04.16  27/05/2005  J.Tan         CAR 56699
.           Recompiled for WEBCHGUR - update HIC files
. V9.04.15  02/05/2005  Mike Laming   CAR 60976
.           Recompiled for WEBCHGUR - Add routine for "Intepreter Visit Dets"
.           05/05/2005  Davin         CAR 22680
.           Added new field set to profld10 (PMI ext2)
. V9.04.14  29/04/2005  Peter Vela    CAR 55214
.           Recompiled for MRTCONFD
.           29/04/2005  Mike Laming   CAR 61101
.           Recompiled for WEBCHGUR - Add routine for "Previous Address"
. V9.04.13  04/04/2005  Jill Habasque  CAR 59155     
.           Recompiled for WEBCHGUR 
. V9.04.12  21/03/2005  Ebon Clements      CAR 58443
.           Recompiled for WEBCHGUR - Security alerts
. V9.04.11  07/03/2005  Steve Armstrong    CAR 59137
.           Recompiled for changes to CISINADT, HL7CISIN & HL7CISVR
. V9.04.10  01/03/2005  Peter Vela    CAR 57547
.           Recompiled for PATVADFD and PATVADIO
. V9.04.09  25/01/2005  Peter Vela    CAR 56906
.           Recompiled for WEBCHGUR
. V9.04.08  04/01/2005  Jill Habasque CAR 55904
.           Removed branch on exit after call to URALT000
. V9.04.07  21/12/2004  Jill Habasque CAR 55017
.           Added call to RDAURAD1
. V9.04.06  16/11/2004  Lina Vo       CAR 55100
.           Added set pmspx2af cgi variables.
. V9.04.05  29/09/2004  Guomin Fu     CAR 19558
.           Added flag SAVEDETL to incorporate choice of details to be kept
.           when merging UR'
.           Recompiled for WEBCHGUR
. V9.04.04  27/09/2004  Ebon Clements            CAR 53266
.           Multi hospital changes for CRMED000 - medical record link
. V9.04.01  24/08/2004  Jill Habasque CAR 50355
.           Added exit of fixres if no start date is set
.----------------------------------------------------------------------
. V9.03.25  02/08/2004  Davin         CAR 34707  
.           Recompiled for WEBCHGUR - added update of pmsccdaf
. V9.03.24  14/07/2004  Steve Armstrong   ACR 51769
.           Removed reference to PATHCSUC
. V9.03.23  05/07/2004  Lina Vo       CAR 50811
.           Recompile for MRGURPRI in WEBCHGUR
. V9.03.22  02/07/2004 Jill Habasque CAR 51382
.           Recompiled for WEBCHGUR - reslnkaf.relnpid
. V9.03.21  28/06/2004  Steve Armstrong      CAR 51167
.           Recompiled for changes to HL7CISIN
. V9.03.20  25/06/2004  Jill Habasque CAR 49987  
.           Added CHGT0000 - Change UR for booking  
. V9.03.19  24/06/2004  Jill Habasque CAR 44641  
.           Recompiled for WEBCHGUR - added pmsaidaf
. V9.03.18  17/06/2004  Peter Vela      CAR 49016
.           2004 Stat Changes PRS/2
.           Recompiled for PMSPX2TM
. V9.03.17  09/06/2004  Sylvek Litewka  CAR 50371
.           Recompiled for FIXPFA (Patient Future Actions) in WEBCHGUR.
.           09/06/2004  Steve Armstrong   PAS-CIS Product Integration
.           Recompiled for cisa34br in WEBCHGUR.
.           Mods to handle rollback from error in CHANGEUR -  CAR  49679
.           09/06/2004  Jill Habasque  CAR 50088
.           Fixed redirect for temporary UR allocation              
. V9.03.16  03/06/2004  Jill Habasque  CAR 50088
.           Added call to GNXTUR in CHUR0000 if generating UR's
. V9.03.15  11/05/2004  Steve Armstrong   PAS-CIS Product Integration
.           Added calls to cisa31br routine and included relevant variables
.           for PAS-CIS Interface  CAR  49679
. V9.03.14  05/04/2004  Jill Habasque CAR 43614
.           Recompiled for WEBCHGUR
.           26/03/2004 Peter Vela     CAR 13038
.           Recompiled for PATDOCCD - Doctor Name format Parameter
. V9.03.13  16/03/2004  Steve Armstrong  HosClaims Phase 1 (48280)
.           Recompiled for WEBCHGUR
. V9.03.12  04/03/2004  Jill Habasque CAR 48017
.           Fixed input newborns for nz
. V9.03.11  17/02/2004  Davin         CAR 22654
.           Added write/update to prspmiaf for PRS2 PMI trigger changes
. V9.03.10  18/12/2003  Peter Vela CAR 43134
.           Recompiled for MRTCONFD
. V9.03.09  03/12/2003  Davin  CAR 44095
.           Removed reference to receipting trans file
. V9.03.08  14/11/2003 Ebon Clemenys  CAR 42756
.           Recompiled for WEBCHGUR - added oprdetaf to merge
. V9.03.07  30/10/2003  Peter Vela    41829
.           Added functionality to update the Date Created field when merging
.           UR numbers.
. V9.03.06  29/10/2003 Sandra Barcham    42237
.           Recompiled for NZHISIIO and NZHISIUP
. V9.03.05  08/08/2003 Jill Habasque CAR 42237
.           Fixed display of input newborn for baby details
. V9.03.04  01/07/2003 Tonii CAR 40473
.           Added new tag to default Baby's Marital Status (BMST0000)
. V9.03.03  26/06/2003 Tonii CAR 40474
.           Default baby's health fund information to mothers Health Fund
. V9.03.02  22/05/2003 Ebon Clements CAR 39351
.           Added update of ALLLINFD for allied health change ur function.
. V9.03.01  13/05/2003 Jill Habasque SRF 38485
.           Fixed input newborn for nz
.----------------------------------------------------------------------
. V9.02.34  02/05/2003 Jill Habasque SRF 38484
.           Added call to SETRED00 when inputting a new born if not admitting
. V9.02.33  10/04/2003 Ebon Clements CAR 37904
.           Fixed change ur by admission number for outpatient bookings
. V9.02.32  04/04/2003 J Habasque SRF 37997
.           Commented out check for PTCNNHII when using babyurno
. V9.02.31  11/03/2003 J.Tan
.           Recompiled for PATMISTM - admitting point
. V9.02.30  25/02/2003  Jill Habasque                                
.           Recompiled for WEBCHGUR - added goto after MRGURRES
. V9.02.29  13/02/2003  Dean Cramer  CAR 22238                       
.           Recompiled for RCPTRNFD via WEBCHGUR                    
. V9.02.28  07/02/2003 Tonii CAR 35992
.           Recompiled for PATMISTM - inactive codes in patfundf
. V9.02.27  05/02/2003  J.Tan
.           Recompiled WEBCHGUR  - I*D on paturcaf                        
.           04/02/2003  Tonii srf 20251      
.           Recompiled WEBCHGUR                                           
. V9.02.26  13/12/2002  L.Vo                 
.           Recompiled WEBCHGUR                                           
. V9.02.25  05/12/2002  L.Vo       SRF 22709
.           Added OPNOUT00 to open outpatient files                       
.           02/12/2002  J.Habasque SRF 22697
.           Recompiled for MRGURPRI - added priaudaf,priauiaf and priauraf
. V9.02.24  28/11/2002  J.Tan            
.           Recompiled for WEBCHGUR - fixed prihtraf 
. V9.02.23  25/11/2002  J.Tan            
.           Recompiled for WEBCHGUR - UR merge for private practice
. V9.02.22  06/11/2002  J.Tan  SRF 21086
.           Recompiled for WEBCHGUR - UR merge for private practice
. V9.02.21  09/10/2002  Peter Vela     SRF 17693
.           Recompiled for PATMISTM - Admitting Point
. V9.02.20  15/08/2002  Steve Downing  SRF 14635
.           Added ETHDES1-3 for changes to PATDETNT
. V9.02.19  05/08/2002  Ebon Clements SRF 20482
.           Recompiled for WEBCHGUR - Update patient location file
. V9.02.18  23/07/2002  J.Tan
.           Recompiled for PATMISTM - added patasfaf file
. V9.02.17  05/07/2002  Jill Habasque SRF 19273 
.           Recompiled for WEBCHGUR - Added update of pmscuraf
. V9.02.16  04/07/2002  Ebon Clements SRF 18833 
.           Recompiled for WEBCHGUR - Update of booking U/R numbers
. V9.02.15  28/05/2002  Mike Laming  SRF 15999  
.           Recompiled for OUTRF1IO.INC
. V9.02.14  20/05/2002 J.Tan
.           Recompiled for Casemix billing
. V9.02.13  26/04/2002 Jill Habasque 
.           Recompiled for WEBCHGUR - bokrc1af update                   
. V9.02.12  05/03/2002 Dean Cramer   
.           Recompiled for WEBCHGUR - Alert Notes                       
. V9.02.11  07/01/2001 Ebon Clements 
.           Recompiled for WEBCHGUR - Allied Health patient merge
. V9.02.10  17/12/2001 Ebon Clements 
.           Fixed RSURN000 for changes to PATGSRFD key
. V9.02.09  12/12/2001 Jill Habasque
.           Recompiled for WEBCHGUR
. V9.02.08  04/12/2001 Katie Nelson/Harvinder   SRF 648628(nz)
.           Recompiled for NHI tags added to PATMASTM
. V9.02.07  19/11/2001  Ebon Clements
.           Recompiled for WEBCHGUR - read pmspx2af when ur is merged
. V9.02.06  14/11/2001  Steve Armstrong
.           Mods to set PHOSP to zero for "No" (instead of two)
. V9.02.05  08/11/2001  Mike Laming 
.           Rename DGCLIUPM to DGCLICUP             
.           Rename DGCLIMRG to DGCLICMR             
. V9.02.04  01/11/2001  Greg Horvat
.           Recompiled for ACTCOMN1 - Added xtra option to the parameter
.           PNSWRACE
. V9.02.03  19/10/2001 Ebon Clements                                
.           Recompiled for WEBCHGUR to update the alert flag when merging a ur
. V9.02.02  10/10/2001 Ebon Clements                                
.           Added cgi variable SAVEALIA to CLRPAR00 to clear the variable.
.           Pack key to read the surname file correctly for change ur details
. V9.02.01  08/09/2001  Glenn Saunders                                
.           Changes keys for reads to patgsrn to reflect enhanced indexes.
. V9.01.02  16.08.2001 J.Tan
.           Recompiled for PATMASTM
. V9.00.01  14.08.2001 J.Tan
.           Recompiled for PATMASTM
. V9.00.B03 13.07.2001 Sandra Barcham
.           Replace GP with HCP
. V9.00.B02 14.06.2001 B.G.Ackland
.           Recompile for Changes to PATMASTM
. V9.00.B01 18/05/2001  Ebon Clements    
.           Added nextpage to report two for a redirect        
.----------------------------------------------------------------------
. V5.10.B05 03/04/2001  Glenn Saunders   
.           Remove access to PTCNSNDX and associated processing
.           Remove all references to PATSUR file (old surnames)
.           Replace WEBEMCM2 with PATCOMN2 (now web-verted)    
. V5.10.B04 27/03/2001 Ebon Clements
.           Recomplied for PMSPX2FD file changes
. V5.10.B01 23.03.2001 Ebon Clements 
.           Added write to PMSPX2FD master extn2 file
. V5.09.01  15/01/2001 Bronko Sosic
.           Recompiled for PATMASTM
.           16/11/2000 J.Tan
.           Added Change U/R option
. V5.09.B01 12.02.2001 Sandra Barcham
.           Recompiled for CHANGEUR - MRGURCCS
. V5.08.00  05.07.2000 K.C.Nelson 
.           Created Program
.----------------------------------------------------------------------
          INC       IBAWEBDF    
.
          INC       PMSCEXTD/INC
          INC       AAEDE1FD/INC       * A&E Details file
          INC       AAEDEBFD/INC 
          INC       ALLCONFD/INC
          INC       ALLEDTFD/INC
          INC       ALLETXFD/INC
          INC       ALLLINFD/INC
          INC       ALLLONFD/INC
          INC       ALLPCTFD/INC
          INC       ALLREFFD/INC
          INC       APSMASFD/INC
          INC       BOKRC1FD/INC
          INC       EMRVISFD/INC       * Emergency
          INC       EOCLNKFD/INC
          INC       LEGALTFD/INC
          INC       LEGBOAFD/INC
          INC       LEGDEAFD/INC
          INC       LEGDSCFD/INC
          INC       LEGINVFD/INC
          INC       LEGMISFD/INC
          INC       LEGTRNFD/INC
          INC       LEGVISFD/INC
          INC       MLTSECFD/INC
          INC       MRTCONFD/INC
          INC       MRTMASFD/INC
          INC       MRTVISFD/INC
          INC       NEWBORTD/INC
          INC       NHIETHFD/INC
          INC       NHIMASFD/INC
          INC       NZHISIFD/INC
          INC       OPRDEAFD/INC
          INC       OUTARTFD/INC
          INC       OUTBB1FD/INC
          INC       OUTBOAFD/INC
          INC       OUTCANFD/INC
          INC       OUTCLIFD/INC
          INC       OUTPREFD/INC
          INC       OUTSITFD/INC
          INC       PATALRFD/INC
          INC       PATAM1FD/INC
          INC       PATASFFD/INC
          INC       PATAXEFD/INC       * Admission extension file
          INC       PATBRDFD/INC
          INC       PATBRDTD/INC
          INC       PATCALAG/INC
          INC       PATCCHFD/INC
          INC       PATCMCFD/INC
          INC       VISMDTFD/INC
          INC       VISMTXFD/INC
          INC       PMSADWFD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       PATCOMM/INC
          INC       PMSBORFD/INC
          INC       PMSNEWFD/INC
          INC       PMSOOSFD/INC
          INC       PATCONFD/INC
          INC       OUTCONFD/INC
          INC       PATDADFD/INC
          INC       PATDHEAD/INC
          INC       PATDGWFD/INC
          INC       PATDO1FD/INC
          INC       PATDRGFD/INC
          INC       PATDSCFD/INC
          INC       PATECDFD/INC
          INC       PATGSRFD/INC
          INC       PATIN1FD/INC
          INC       PATINVFD/INC
          INC       PATITMFD/INC
          INC       PATLOCFD/INC
          INC       PATLINFD/INC
          INC       PATMA1FD/INC
          INC       PATMI1FD/INC
          INC       PMSCEXFD/INC
          INC       MEHVI1FD/INC
          INC       PATMRGFD/INC
          INC       PATNIDFD/INC
          INC       PATPR1FD/INC
          INC       PATRE1FD/INC
          INC       PATTRNFD/INC
          INC       PATUADFD/INC
          INC       PATURAFD/INC
          INC       PATURCFD/INC         * U/R no. change audit file
          INC       PATVADFD/INC
          INC       PATVISFD/INC
.
          INC       PMSCCDFD/INC   * Concession Card Details
          INC       PMSALNFD/INC
          INC       PMSBRQFD/INC
          INC       PMSCURFD/INC
          INC       PMSEDWFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCLFD/INC
          INC       PMSHCGTD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCPTD/INC
.          INC       PMSIPLFD/INC
          INC       PMSNPLFD/INC       * NIHC IHI Polling
          INC       PMSRESFD/INC
          INC       PMSRELFD/INC
          INC       PMSTLEFD/INC
          INC       PMSPX2FD/INC
          INC       PMSPTDFD/INC
          INC       PMSPX2TD/INC
          INC       PMSMUPFD/INC       * Missing UPI Patients
          INC       PMSVX1FD/INC
          INC       PRSPMIFD/INC
          INC       PTMTBABV/INC
          INC       RESLNKFD/INC
          INC       SAVPX2FD/INC
          INC       TFILEVAR/INC
          INC       WATESMFD/INC
          INC       WATESPFD/INC
          INC       WATTR1FD/INC
          INC       WATTX1FD/INC
          INC       PATHSPFD/INC
          INC       PMSTSPFD/INC
          INC       PMSUPDFD/INC
          INC       PATMISTD/INC
          INC       PMSEHBFD/INC
          INC       PATWC1FD/INC
          INC       ACCLODFD/INC
          INC       PATATRFD/INC
          INC       PATATRTD/INC
.
. LOCAL VARIABLES
. ---------------
.
ACC       DIM       2
ACTION    DIM       1
ADD       DIM       2
ADMITNOW  FORM      1
ALERT001  DIM       2
ALERT002  DIM       3
ALERT013  DIM       3
ALTKEY35  DIM       35
ALLVISIN  DIM       1
AMM       DIM       2
AYY       DIM       2
.
BABDDESC  DIM       30
BABYDOB   DIM       8                       * baby date of birth (ccyymmdd)
BABYURNO  DIM       8                       * baby urnumber cgi parameter
BABYVIS   DIM       8                       * baby visit number
BNMPNUMB  DIM       20                      * babys NMP number
BURNO     DIM       8
BOARDURN  DIM       8                       * boarder urnumber cgi parameter
BORDURNO  DIM       8
BORDUNIQ  DIM       10
.
CATTC     INIT      "tc"
CATEGTC   INIT      "tc"
CONFDEMO  DIM       1                       * Demograhic Confirmation Audit
COUNT     FORM      2
.
. For the purpose of UR comments
COMFILAF  FILE      ASCII, FIXED=127
COMFILNM  DIM       8
.
CFILEPRE  DIM       3
CHGATYP   FORM      1
CHGCGP    FORM      1
CONTTYPE  DIM       3
CURRDATE  DIM       8
CURRDATX  DIM       8
.
DIM1A     DIM       1
DIM4      DIM       4
DIM8      DIM       8
DIM16     DIM       16
DIM40     DIM       40
DOCTCODE  DIM       6
.
EDLINKIP  DIM       8                  * ED linked IP admission number
EDWARDTY  DIM       3                  * EDWARD Type of Alteration
EXISTFL   FORM      1
EXPDATE   DATE      8
.
F3A       FORM      3
FLDVALUE  DIM       127
FILTHOSP  DIM       3
FORM3     FORM      3
FORM6     FORM      6
FORM8     FORM      8
FORMURNO  FORM      8
FROMLINK  FORM      1
FRSTGNAM  DIM       40
FULLGNAM  DIM       80
HOURTM    DIM       2
OLDUNIQ   DIM       10
TADTTYPE  DIM       3
TOLINK    FORM      1
.
IPLINKED  DIM       8                  * IP linked ED visit number
KEY1A     DIM       1
KEY2A     DIM       2
.
LOGERR    FORM      "0"
LEGCFLAG  FORM      1
LINKTYPE  DIM       3
.
MBSDESC   DIM       40
MANALLOC  FORM      1
MASUPDFL  FORM      1
MINTIME   DIM       2
MISUPDFL  FORM      1
MOTFNAME  DIM       20
MRGEFLAG  DIM       1
MRGODDAT  DIM       8                       * I CAR 41829
MRGURDAT  FORM      1                       * I CAR 41829
MURNO     DIM       8                       * Mother's U/R Number
.
NCCURNO   DIM       8 
NEWURNUM  DIM       8
NEWURNO   DIM       8
NEXTPAGE  DIM       1      * Nextpage parameter CGI parameter
NMPNUMB   DIM       20 
.
OCCURNO   DIM       8
OLDURNO   DIM       8
OLDURNUM  DIM       8
OPATBOOK  FORM      1                       * Valid outpatient booking      
OPATCANC  FORM      1                       * cancelled outpatient booking      
OPATSITE  DIM       6                       * Outpatient user id site code
OPERCODE  DIM       4
OURNO     DIM       8
.
PRSTRIGF  FORM      1                       * PRS2 PMI trigger flag (1=yes/0=no)
.
PMRES001  DIM       3
PMRES002  DIM       8
PMRES003  DIM       8
PMRES004  DIM       127
PMRES005  DIM       10
PMRES014  DIM       20
.
PTMAS001  DIM       4
PTMAS002  FORM      1
PTMAS003  FORM      3
PTMAS004  FORM      1
PTMAS005  DIM       20
PTMAS006  DIM       25
PTMAS007  DIM       19
PTMAS008  DIM       35
PTMAS009  DIM       35
PTMAS010  DIM       35
PTMAS011  DIM       35
PTMAS012  DIM       8
PTMAS013  DIM       20
PTMAS014  DIM       20
PTMAS015  DIM       1
PTMAS016  DIM       3
PTMAS017  DIM       8
PTMAS018  FORM      3
PTMAS019  DIM       3
PTMAS020  DIM       3
PTMAS021  DIM       3
PTMAS022  DIM       14
PTMAS023  DIM       10
PTMAS024  DIM       15
PTMAS025  DIM       6
PTMAS026  DIM       10
PTMAS027  FORM      1
PTMAS028  DIM       20
PTMAS029  FORM      1
PTMAS030  FORM      1
PTMAS031  FORM      1
PTMAS032  DIM       3
PTMAS033  DIM       3
PTMAS034  DIM       3
PTMAS035  DIM       30
PTMAS036  DIM       6
PTMAS037  DIM       8
PTMAS038  DIM       19
PTMAS039  DIM       3
PTMAS040  DIM       3
PTMAS041  DIM       3
PTMAS042  DIM       3
PTMAS043  DIM       3
PTMAS044  DIM       3
PTMAS045  FORM      1
PTMAS046  FORM      1
PTMAS047  FORM      1
PTMAS048  DIM       2
PTMAS049  DIM       20
PTMAS050  DIM       35
PTMAS051  DIM       35
PTMAS052  DIM       35
PTMAS053  DIM       35
PTMAS054  DIM       8
PTMAS055  DIM       20
PTMAS056  DIM       20
PTMAS057  DIM       10
PTMAS058  FORM      3
PTMAS059  DIM       2
PTMAS060  DIM       6
PTMAS061  DIM       8
PTMAS062  DIM       3
PTMAS063  DIM       2
PTMAS064  DIM       6
PTMAS065  DIM       14
PTMAS066  DIM       6
PTMAS067  DIM       1
PTMAS068  DIM       3
PTMAS069  DIM       8
PTMAS070  DIM       3                    * Multiple Birth Type
PTMAS071  DIM       1                    * Birth Order
.
PTMIS001  DIM       8                    * Patient Admission Date
PTMIS002  DIM       8                    * Patient Admission Time
PTMIS003  DIM       3                    * Reason Pre-Admiss Cancelation
PTMIS004  DIM       3                    * Patient Ward Number
PTMIS005  DIM       3                    * Patient Bed Number
PTMIS006  DIM       6                    * Referring Doctor
PTMIS007  DIM       6                    * Attending Doctor
PTMIS008  DIM       30                   * Local Doctor
PTMIS009  DIM       3                    * Referral Source (Cat. S)
PTMIS010  DIM       3                    * Admission Type (Cat. A )
PTMIS011  DIM       3                    * Admission Class (Cat. P)
PTMIS012  DIM       3                    * Care Class (Cat. CC)
PTMIS013  DIM       6                    * Admission health fund
PTMIS014  DIM       4                    * Admission health fund table
PTMIS015  DIM       19                   * Admission health fund Membership No
PTMIS016  FORM      1                    * Eligible for Govt. Rebate (1=y 2=n)
PTMIS017  FORM      1                    * Religious Visit (1=yes 2=no)
PTMIS018  FORM      1                    * Allergies (1=yes 2=no)
PTMIS019  FORM      1                    * Pre-existing illness (1=y 2=n)
PTMIS020  DIM       50                   * Admitting Diagnoses line 1
PTMIS021  DIM       50                   * Admitting Diagnoses line 2
PTMIS022  FORM      3.2                  * Patient Discount Percentage
PTMIS023  DIM       6                    * Treating Doctor
PTMIS024  DIM       3                    * Account Classification
PTMIS025  DIM       2
PTMIS026  DIM       9
PTMIS027  DIM       3
PTMIS028  DIM       3
PTMIS029  DIM       3
PTMIS030  FORM      3
PTMIS031  FORM      4
PTMIS032  FORM      1
PTMIS033  FORM      6
PTMIS034  DIM       40
PTMIS035  DIM       30
PTMIS036  FORM      1
PTMIS037  DIM       3
PTMIS038  DIM       3
PTMIS039  DIM       3
PTMIS040  DIM       3
PTMIS041  DIM       3
PTMIS042  DIM       3
PTMIS043  DIM       3
PTMIS044  DIM       22
PTMIS045  DIM       2
PTMIS046  DIM       6
PTMIS047  DIM       8
PTMIS048  DIM       8
PTMIS049  DIM       8
PTMIS050  DIM       8
PTMIS051  DIM       6
PTMIS052  DIM       8
PTMIS053  DIM       6
PTMIS054  DIM       20
PTMIS055  DIM       20
PTMIS056  DIM       3
PTMIS057  DIM       3
PTMIS058  DIM       8
PTMIS059  DIM       8
PTMIS060  DIM       3
PTMIS061  DIM       3
PTMIS062  DIM       1
PTMIS063  DIM       3
PTMIS064  DIM       3
PTMIS065  DIM       3
PTMIS066  DIM       4
PTMIS067  DIM       4
PTMIS068  DIM       3
PTMIS069  DIM       6
PTMIS070  DIM       6
PTMIS071  FORM      1
PTMIS072  FORM      1
PTMIS073  DIM       9
.
PTMSX001  DIM       8        * Registration Date
PTMSX002  DIM       30       * Special Meal Requirements
PTMSX003  DIM       4        * LGA Code
PTMSX004  DIM       3        * Current Legal Status (Cat LS)
PTMSX005  DIM       8        * Date of Legal Status
PTMSX006  DIM       1        * Familial History of mental disorder? 1=yes, 2=No
PTMSX007  DIM       3        * M.H. User Defined Field (Cat V6)
PTMSX008  DIM       3        * M.H. User Defined Field (Cat V7)
PTMSX009  DIM       3        * M.H. User Defined Field (Cat V8)
PTMSX010  DIM       20       * Emergency Contact Name
PTMSX011  DIM       35       * Emergency Contact Address Line 1
PTMSX012  DIM       35       * Emergency Contact Address Line 2
PTMSX013  DIM       35       * Emergency Contact Address Line 3
PTMSX014  DIM       35       * Emergency Contact Address Line 4
PTMSX015  DIM       8        * Emergency Contact Postcode
PTMSX016  DIM       20       * Emergency Contact Private Phone
PTMSX017  DIM       20       * Emergency Contact Business Phone
PTMSX018  DIM       10       * Emergency Contact Relationship
PTMSX019  DIM       20       * Nearest Relative Name
PTMSX020  DIM       35       * Nearest Relative Address Line 1
PTMSX021  DIM       35       * Nearest Relative Address Line 2
PTMSX022  DIM       35       * Nearest Relative Address Line 3
PTMSX023  DIM       35       * Nearest Relative Address Line 4
PTMSX024  DIM       8        * Nearest Relative Post Code
PTMSX025  DIM       20       * Nearest Relative Private Phone
PTMSX026  DIM       20       * Nearest Relative Business Phone
PTMSX027  DIM       10       * Nearest Relative Relationship
PTMSX028  DIM       8        * 3B certificate Expiry Date
PTMSX029  DIM       20       * Card number (NZ billing)
PTMSX030  DIM       8        * Card expiry date (NZ billing)
PTMSX031  DIM       3        * Card exemption type (Cat XM)
PTMSX032  DIM       12       * Family ID
PTMSX033  DIM       3        * Disctrict of Residence (Cat DA)
PTMSX034  DIM       8        * Registered GP
PTMSX035  DIM       6        * GP Practice Code
PTMSX036  DIM       20       * Supplementary ID
PTMSX037  DIM       2        * GP Practice Count
PTMSX038  DIM       1        * Date Arrived From Overseas
PTMSX039  DIM       20       * Cellular Phone Number
PTMSX040  DIM       35       * Postal Address Line 1
PTMSX041  DIM       35       * Postal Address Line 2
PTMSX042  DIM       35       * Postal Address Line 3
PTMSX043  DIM       35       * Postal Address Line 4
PTMSX044  DIM       8        * Postal Address Post Code
PTMSX045  DIM       2        * Medicare Code
PTMSX046  DIM       48       * Filler Number 1
PTMSX047  DIM       8        * Hearing
PTMSX048  DIM       2        * Year last Psych adm psych
PTMSX049  DIM       3        * Hearing
PTMSX050  DIM       1        * Opt out of SMS
PTMSX051  DIM       2        * Episode Special Purpose Flag
.
QRYDATA1  DIM       240
.
SAVEALIA  FORM      1
SAVEDETL  FORM      1                       * I-19558
SAVEHOSP  DIM       3
SAVERETN  FORM      1
SAVEURNO  DIM       8
SAVKEY8   DIM       8
SAVKEY25  DIM       25
SAVKEY32  DIM       32
SAVKEY35  DIM       35
SVKEY115  DIM       115
SAVMHFMM  DIM       19                      * Fund membership number
SAVMHFND  DIM       6                       * Health Fund
SAVMHFTB  DIM       8                       * Health Fund Table
SAVKEY16  DIM       16
SAVKEY19  DIM       19
SAVKEY28  DIM       28
SAVTXWRD  DIM       3
NEWKEY16  DIM       16
SAVESIN7  DIM       1
SAVESIN8  DIM       1
SAVESIN9  DIM       1
SAVESN11  DIM       1
SCNDGNAM  DIM       40
SECTIME   DIM       2
SRCHSNAM  DIM       20
SRCHGNAM  DIM       25
SRCHPDOB  DIM       8
SRCHPSEX  DIM       1
SNMPNUMB  DIM       20
STATLINK  DIM       8                  * IP linked ED visit number
.
TEMPORAR  FORM      1
TITLE     DIM       80                     *pack Patient name and server details
TODAY     DIM       8
.
UPDATETY  DIM       1
UPDTTYPE  FORM      1                       * Update Type
URCHKDGT  FORM      4
URCMTLIN  FORM      3
URNLNGTH  FORM      2
URCHKPRD  FORM      2
URCMTFLG  FORM      1
URTXUNIQ  FORM      3
URNOWGHT  FORM      1
.
WARDTEXT  DIM       20
WBEDTEXT  DIM       20
WLOTPACN  DIM       8
WLOTANAE  DIM       8
ZERO2     INIT      "00"
.
. Boarder Work Variables
.
BORDTITL  DIM       4  
BORDSNAM  DIM       20
BORDGNAM  DIM       25
BORDGEND  DIM       1
BORDBDAT  DIM       8
BORDADR1  DIM       35
BORDADR2  DIM       35
BORDADR3  DIM       35
BORDADR4  DIM       35
BORDPOST  DIM       8
BORDHPHN  DIM       20
BORDWPHN  DIM       20
BORDMPHN  DIM       20
BORDEMAL  DIM       80
.
VIEWTYPE  DIM       1
.
XXFILE    DIM       8
XXDESC    DIM       80
.
.
. PROGRAM CONSTANTS
. -----------------
.
BABDDSC0  INIT      "SON OF OR DAUGHTER OF "
BABDDSC1  INIT      "BABY OF "
SEC1      FORM      "00001"
REPUNIQ   INIT      "yzxywxvwuvtustrsqrpqopnomnlmkljkijhighfgefdecdbcab"
TILDA35   INIT      "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
URWTARAY  INIT      "234567"
.
.----------------------------------------------------------------------
PRGID     INIT      "PATWEB83"
VERSION   INIT      "V12.00.04"
PRGNAM    INIT      "Input New Borns Web Server"
.----------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      INPNEW00                * Input New Born 
          GOTO      MAIN1000
.
MAIN1200  CALL      CHUR0000                * Change U/R
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00               
          GOTO      MAIN1000
.
MAIN1300  CALL      CHAD0000                * Change U/R by admission no
          BRANCH    EXIT,MAIN1000
.          CALL      WINCLS00                
          CALL      NXTPAG00               
          GOTO      MAIN1000
.
MAIN1400  CALL      INPBOR00                * Input Boarder  
          GOTO      MAIN1000
.
MAIN1500  CALL      BORD0000                * Hospital Boarder WAHealth
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000 
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  CALL      INTMAS00 
          OPEN      CONTROLF,"controlf"
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      EMRVISA1,"emrvisaf" 
          OPEN      EMRVISA3,"emrvisaf"
          OPEN      NHIMASA1,"nhimasaf"
          OPEN      PATAM1A1,"patam1af"
          OPEN      PATBRDA1,"patbrdaf"
          OPEN      PATBRDA2,"patbrdaf"
          OPEN      PATBRDA3,"patbrdaf"
          OPEN      PATBRDA4,"patbrdaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      VISMDTA1,"vismdtaf"
          OPEN      VISMTXA1,"vismtxaf"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATDSCH3,"patdschf"
          OPEN      PATDRGA1,"patdrgaf"
          OPEN      PATINVR1,"patinvrf"
          OPEN      PATMRGG1,"patmrgaf"
          OPEN      PATNIDA1,"patnidaf"
          OPEN      PATTRAN1,"pattranf"
          OPEN      PATURAD1,"paturadf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PMSCEXA1,"pmscexaf"
          OPEN      PMSEDWA2,"pmsedwaf"
          OPEN      PMSRELA1,"pmsrelaf"
          OPEN      PMSTLEA1,"pmstleaf"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMI1A2,"patmi1af"
          OPEN      PATMI1A8,"patmi1af"
          OPEN      PMSALNA1,"pmsalnaf"
          OPEN      PMSADWA1,"pmsadwaf"
          OPEN      PMSCURA1,"pmscuraf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PMSHCLA1,"pmshclaf"
          OPEN      PMSRESA1,"pmsresaf"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PMSBORA2,"pmsboraf"
          OPEN      PMSNEWA2,"pmsnewaf"
          OPEN      PRSPMIA1,"prspmiaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      WATESMA1,"watesmaf"
          OPEN      PATLINK1,"patlinkf"
          OPEN      WATESPA1,"watespaf"
          OPEN      MRTVISA1,"mrtvisaf"
          OPEN      MRTMASA1,"mrtmasaf"
          OPEN      MRTMASA2,"mrtmasaf"
.          OPEN      PMSIPLA1,"pmsiplaf"     * Polling table for DHS Medicare
          OPEN      PATWC1A1,"patwc1af"
.
          OPEN      PATATRA1,"patatraf"
.
          READ      CONTROLF,TEN;*196,CGENRUR
          READ      CONTROLF,TEN;*213,CAUDM
          READ      CONTROLF,TEN9;*72,CNBRG,*208,CPMIAD
          READ      CONTROLF,TWENTY1;*1,PTCNBABD,*121,PTCNUADM,*138,PTCNNHII
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,EIGHTY8;*116,CHCSDTE
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND12;*104,PTCNWBDS,*118,PTCNTRPR
          READ      CONTROLF,HUND18;*138,PTCNNEWC,*167,PTCNNWCA,*179,PTCNH7ID
          READ      CONTROLF,HUND06;*27,ALCNRAUD
          READ      CONTROLF,HUND20;*158,PTCNUNET,*243,PTCNSMSN
          READ      CONTROLF,HUND25;*93,PTCNNSSI
          READ      CONTROLF,HUND28;*226,PTCNNMPR
.
          CALL      OPSU0000                * Open surname files
.
          OPEN      MLTCODA1,"mltcodaf"
          OPEN      MLTCODA2,"mltcodaf"
          OPEN      MLTSECA1,"mltsecaf"
.
          MOVE      "out",CFILEPRE
          CALL      OPNOUT00                * open outpatient files
.
          MATCH     "1",PTCNNWCA
          IF        @EQUAL
            OPEN      PMSAUDCE,"pmsaudce"
            OPEN      PMSAUDC2,"pmsaudce"
          ENDIF
.
          OPEN      PMSMUPA1,"pmsmupaf"
          CALL      TFILENAM
          MOVE      TFILNAME,COMFILNM
.
          MATCH     "3",PTCNUNET
          IF        @EQUAL
            OPEN      PMSNPLA1,"pmsnplaf"
          ENDIF
.
          RETURN
.------------------------------------------------------------
. Open surname files
.------------------------------------------------------------
OPSU0000  OPEN      PATGSRN1,"patgsrnf"
          OPEN      PATGSRN2,"patgsrnf"
          OPEN      PATGSRN3,"patgsrnf"
          OPEN      PATGSRN4,"patgsrnf"
OPSU9999  RETURN
.------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILCLIA1  * Get the name of the CLIA1 file
          OPEN      OUTCLIA1,CFNAME    
OPNOUT99  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,URNUMBER
          MOVE      ZERO,NEXTPAGE
          MOVE      ZERO,MANALLOC
          MOVE      SP70,ADMISSNO
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,UPDTTYPE
          MOVE      SP70,UPDATETY
          MOVE      ZERO,TEMPORAR
          MOVE      ONE,ADMITNOW            * 1 - Do not admit patient
          MOVE      SP70,BABYURNO
          MOVE      SP70,BOARDURN
          MOVE      SP70,BORDURNO
          MOVE      ZERO,SAVEALIA           * Set save alias no no
          MOVE      ZERO,SAVEDETL           * Set save details to no  I-19558
          MOVE      ZERO,SAVERETN
          MOVE      SP70,OPATSITE
          MOVE      ZERO,OPATBOOK
          MOVE      ZERO,OPATCANC
          MOVE      ZERO,MRGURDAT           * I CAR 41829
          MOVE      SP70,EDLINKIP
          MOVE      SP70,IPLINKED
          MOVE      SP70,STATLINK
          MOVE      ZERO,URCMTFLG
          MOVE      ZERO,URCMTLIN
          MOVE      Z70,CONFDEMO            * Demograhic Confirmation Audit
.
          MOVE      Z70,PTMAS001
          MOVE      ZERO,PTMAS002
          MOVE      ZERO,PTMAS003
          MOVE      ZERO,PTMAS004
          MOVE      Z70,PTMAS005
          MOVE      Z70,PTMAS006
          MOVE      Z70,PTMAS007
          MOVE      Z70,PTMAS008
          MOVE      Z70,PTMAS009
          MOVE      Z70,PTMAS010
          MOVE      Z70,PTMAS011
          MOVE      Z70,PTMAS012
          MOVE      Z70,PTMAS013
          MOVE      Z70,PTMAS014
          MOVE      Z70,PTMAS015
          MOVE      Z70,PTMAS016
          MOVE      Z70,PTMAS017
          MOVE      ZERO,PTMAS018
          MOVE      Z70,PTMAS019
          MOVE      Z70,PTMAS020
          MOVE      Z70,PTMAS021
          MOVE      Z70,PTMAS022
          MOVE      Z70,PTMAS023
          MOVE      Z70,PTMAS024
          MOVE      Z70,PTMAS025
          MOVE      Z70,PTMAS026
          MOVE      ZERO,PTMAS027
          MOVE      Z70,PTMAS028
          MOVE      ZERO,PTMAS029
          MOVE      ZERO,PTMAS030
          MOVE      ZERO,PTMAS031
          MOVE      Z70,PTMAS032
          MOVE      Z70,PTMAS033
          MOVE      Z70,PTMAS034
          MOVE      Z70,PTMAS035
          MOVE      Z70,PTMAS036
          MOVE      Z70,PTMAS037
          MOVE      Z70,PTMAS038
          MOVE      Z70,PTMAS039
          MOVE      Z70,PTMAS040
          MOVE      Z70,PTMAS041
          MOVE      Z70,PTMAS042
          MOVE      Z70,PTMAS043
          MOVE      Z70,PTMAS044
          MOVE      ZERO,PTMAS045
          MOVE      ZERO,PTMAS046
          MOVE      ZERO,PTMAS047
          MOVE      Z70,PTMAS048
          MOVE      Z70,PTMAS049
          MOVE      Z70,PTMAS050
          MOVE      Z70,PTMAS051
          MOVE      Z70,PTMAS052
          MOVE      Z70,PTMAS053
          MOVE      Z70,PTMAS054
          MOVE      Z70,PTMAS055
          MOVE      Z70,PTMAS056
          MOVE      Z70,PTMAS057
          MOVE      ZERO,PTMAS058
          MOVE      Z70,PTMAS059
          MOVE      Z70,PTMAS060
          MOVE      Z70,PTMAS061
          MOVE      Z70,PTMAS062
          MOVE      Z70,PTMAS063
          MOVE      Z70,PTMAS064
          MOVE      Z70,PTMAS065
          MOVE      Z70,PTMAS066
          MOVE      Z70,PTMAS067
          MOVE      Z70,PTMAS068
          MOVE      Z70,PTMAS069
          MOVE      Z70,PTMAS070
          MOVE      Z70,PTMAS071
.
          MOVE      SP70,MOTFNAME
          UNPACK    SP70,NEWURNUM,OLDURNUM
          MOVE      Z70,LINKTYPE
.
          MOVE      Z70,PTMSX001
          MOVE      Z70,PTMSX002
          MOVE      Z70,PTMSX003
          MOVE      Z70,PTMSX004
          MOVE      Z70,PTMSX005
          MOVE      Z70,PTMSX006
          MOVE      Z70,PTMSX007
          MOVE      Z70,PTMSX008
          MOVE      Z70,PTMSX009
          MOVE      Z70,PTMSX010
          MOVE      Z70,PTMSX011
          MOVE      Z70,PTMSX012
          MOVE      Z70,PTMSX013
          MOVE      Z70,PTMSX014
          MOVE      Z70,PTMSX015
          MOVE      Z70,PTMSX016
          MOVE      Z70,PTMSX017
          MOVE      Z70,PTMSX018
          MOVE      Z70,PTMSX019
          MOVE      Z70,PTMSX020
          MOVE      Z70,PTMSX021
          MOVE      Z70,PTMSX022
          MOVE      Z70,PTMSX023
          MOVE      Z70,PTMSX024
          MOVE      Z70,PTMSX025
          MOVE      Z70,PTMSX026
          MOVE      Z70,PTMSX027
          MOVE      Z70,PTMSX028
          MOVE      Z70,PTMSX029
          MOVE      Z70,PTMSX030
          MOVE      Z70,PTMSX031
          MOVE      Z70,PTMSX032
          MOVE      Z70,PTMSX033
          MOVE      Z70,PTMSX034
          MOVE      Z70,PTMSX035
          MOVE      Z70,PTMSX036
          MOVE      Z70,PTMSX037
          MOVE      Z70,PTMSX038
          MOVE      Z70,PTMSX039
          MOVE      Z70,PTMSX040
          MOVE      Z70,PTMSX041
          MOVE      Z70,PTMSX042
          MOVE      Z70,PTMSX043
          MOVE      Z70,PTMSX044
          MOVE      Z70,PTMSX045
          MOVE      Z70,PTMSX046
          MOVE      Z70,PTMSX047
          MOVE      Z70,PTMSX048
          MOVE      Z70,PTMSX049
          MOVE      Z70,PTMSX050
          MOVE      Z70,PTMSX051
.
          MOVE      SP70,SRCHSNAM
          MOVE      SP70,SRCHGNAM
          MOVE      SP70,SRCHPSEX
          MOVE      SP70,SRCHPDOB
          UNPACK    SP70,SAVMHFND,SAVMHFTB,SAVMHFMM
.
          CALL      CVPMI000            * clear parameter for PMI Extension
.
          PACK      PMRES001,Z70
          PACK      PMRES002,Z70
          PACK      PMRES003,Z70
          PACK      PMRES004,Z70
          PACK      PMRES005,Z70
          PACK      PMRES014,Z70
.
          CALL      CPABRD00
.
          MOVE      SP70,BORDUNIQ
          MOVE      SP70,FILTHOSP
.
          MOVE      SP70,VIEWTYPE
          MOVE      SP70,WLOTPACN
          MOVE      SP70,WLOTANAE
.
          CALL      CPPMCE00
          RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "manalloc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MANALLOC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "temporar=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPORAR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "linktype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LINKTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "babyurno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BABYURNO   
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "boardurn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BOARDURN   
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bordurno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BORDURNO
            GOTO      SETPAR99
          ENDIF

.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admitnow=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMITNOW
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updatety=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATETY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptmas",QRYNAME
          IF        @EQUAL
            CALL      SPMAS000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "ptmsx",QRYNAME
          IF        @EQUAL
            CALL      SPMSX000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "pmpxi",QRYNAME
          IF        @EQUAL
            CALL      SVPMI000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "ptmis",QRYNAME
          IF        @EQUAL
            CALL      SPMIS000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "oldurnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OLDURNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "newurnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEWURNUM
            PACK      NEWURNUM,NEWURNUM,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "savealia=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAVEALIA
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "savedetl=",QRYNAME              *I-19558
          IF        @EQUAL
            MOVE      QRYDATA,SAVEDETL
            GOTO      SETPAR99
          ENDIF                                      *End I
.
          MATCH     "saveretn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SAVERETN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "opatsite=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OPATSITE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mrgurdat=",QRYNAME           * I CAR 41829
          IF        @EQUAL
            MOVE      QRYDATA,MRGURDAT
            GOTO      SETPAR99
          ENDIF
.                                                 * end I CAR 41829
          MATCH     "pmres001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMRES001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmres002=",QRYNAME
          IF        @EQUAL
            MATCH     SP70,QRYDATA
            IF        @EQUAL|@EOS
              PACK      PMRES002,QRYDATA,SP70
              GOTO      SETPAR99
            ENDIF
.
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * Set CMON from MTHNAM3
            PACK      PMRES002,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmres003=",QRYNAME
          IF        @EQUAL
            MATCH     SP70,QRYDATA
            GOTO      SETPAR99 IF EQUAL
            GOTO      SETPAR99 IF EOS
.
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * Set CMON from MTHNAM3
            PACK      PMRES003,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmres004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMRES004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmres005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMRES005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmres014=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMRES014
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchsnam=",QRYNAME
          IF        @EQUAL
            PACK      SRCHSNAM,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchgnam=",QRYNAME
          IF        @EQUAL
            PACK      SRCHGNAM,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchpsex=",QRYNAME
          IF        @EQUAL
            PACK      SRCHPSEX,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchpdob=",QRYNAME
          IF        @EQUAL
            MATCH     SP70,QRYDATA
            GOTO      SETPAR99 IF EQUAL
            GOTO      SETPAR99 IF EOS
.
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * Set CMON from MTHNAM3
            PACK      SRCHPDOB,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptbrd",QRYNAME
          IF        @EQUAL
            CALL      SPTBRD00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "borduniq=",QRYNAME
          IF        @EQUAL
            PACK      BORDUNIQ,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filthosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmcex",QRYNAME
          IF        @EQUAL
            CALL      SPPMC000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "edlinkip=",QRYNAME
          IF        @EQUAL
            PACK      EDLINKIP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "iplinked=",QRYNAME
          IF        @EQUAL
            PACK      IPLINKED,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "statlink=",QRYNAME
          IF        @EQUAL
            PACK      STATLINK,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urcommnt=",QRYNAME
          IF        @EQUAL
            MOVE      ONE,URCMTFLG
            CALL      GTURCM00              * Read in U/R Comments
          ENDIF
.
          MATCH     "confdemo=",QRYNAME     * Demographic Confirmation Audit
          IF        @EQUAL
            MOVE      QRYDATA,CONFDEMO
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------
. Display Input NewBorn Form
. Returns:   EXIT  0 = Ok to continue
.                  1 = Error
.------------------------------------------------------------
.
INPNEW00  BRANCH    UPDTTYPE,INPNEW50    
.
          CALL      INBFOR00                * Input New Born Form   
          GOTO      INPNEW90
.
INPNEW50  CALL      REGB0000                * Register New Born
          BRANCH    EXIT,INPNEW91       
.
          CALL      SETRED00                * Set redirect to admission form
          CALL      RDIREC00    
.
INPNEW90  MOVE      ZERO,EXIT
          GOTO      INPNEW99
.
INPNEW91  MOVE      ONE,EXIT
.
INPNEW99  RETURN
+
.------------------------------------------------------------
. Display Input Boarder Form
. Returns:   EXIT  0 = Ok to continue
.                  1 = Error
.------------------------------------------------------------
.
INPBOR00  BRANCH    UPDTTYPE,INPBOR50
.
          CALL      INBO0000                * Input Boarder Form
          GOTO      INPBOR90
.
INPBOR50  CALL      REBD0000                * Register Boarder
          BRANCH    EXIT,INPBOR91
.
          CALL      SETRBD00                * Set redirect to admission form
          CALL      RDIREC00
.
INPBOR90  MOVE      ZERO,EXIT
          GOTO      INPBOR99
.
INPBOR91  MOVE      ONE,EXIT
.
INPBOR99  RETURN
+
.------------------------------------------------------------
. Set redirection to the admission form             
.------------------------------------------------------------
SETRED00  CLEAR     REDIRECT
          IF        ADMITNOW=1
            APPEND    "patweb98.pbl?reportno=01&template=001&urnumber=",REDIRECT
          ELSE
           APPEND    "patweb89.pbl?reportno=03&template=001&newbornf=1",REDIRECT
           APPEND    "&admtflag=1",REDIRECT
           APPEND    "&mothadmn=",REDIRECT
           APPEND    ADMISSNO,REDIRECT
           APPEND    "&urnumber=",REDIRECT
          ENDIF
.
          REP       " +",URNUMBER
          APPEND    URNUMBER,REDIRECT
          RESET     REDIRECT
SETRED99  RETURN
.------------------------------------------------------------
. Set redirection for boarders to the admission form
.------------------------------------------------------------
SETRBD00  CLEAR     REDIRECT
          IF        ADMITNOW=1
            APPEND    "patweb98.pbl?reportno=01&template=001&urnumber=",REDIRECT
          ELSE
           APPEND    "patweb89.pbl?reportno=03&template=001&boarderf=1",REDIRECT
           APPEND    "&mothadmn=",REDIRECT
           APPEND    ADMISSNO,REDIRECT
           APPEND    "&urnumber=",REDIRECT
          ENDIF
.
          REP       " +",URNUMBER
          APPEND    URNUMBER,REDIRECT
          RESET     REDIRECT
SETRBD99  RETURN
.------------------------------------------------------------
. Set redirect when generating a new urnumber
.------------------------------------------------------------
SETGEN00  STRIP     REDIRECT
          ENDSET    REDIRECT
          APPEND    "&newurnum=",REDIRECT
          APPEND    NEWURNUM,REDIRECT
.
          RESET     REDIRECT
SETGEN99  RETURN
.------------------------------------------------------------
. Display Input New Born Form
.------------------------------------------------------------
INBFOR00  CALL      CLPATMAS                * clear master detils
          CALL      CLPMSPX2                * clear mast ext2 details
          CALL      CLPATMIS                * clear admission details
          MOVE      SP70,MBSDESC            * clear mbs description
          MOVE      SP70,PTDWDESC           * clear drg description
.
          MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,INBFOR93
.
          MOVE      AADMNO,MADMNO           * mother admission number
          MOVE      AURNO,MURNO             * mother U/R Number
.
          PACK      KEY8,MURNO
          CALL      RDMAST1               * Read mother's details
          IF        OVRCD=0
            CALL      MOTNAM00              * Get mother's name
          ENDIF
.
          PACK      KEY8,MURNO
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          IF        PTCNHDPS=1
            MATCH     SP70,BABYURNO
            IF        !@EQUAL
              CALL      SVMTHMAS              * save mothers pmi details
            ENDIF
          ENDIF
.
          MATCH     SP70,BABYURNO
          IF        @EQUAL
            MOVE      MURNO,KEY8            * Read mother's details
          ELSE
            MOVE      BABYURNO,KEY8         * Read Baby's master details  
          ENDIF
.
          CALL      RDMAST1
          BRANCH    OVRCD,INBFOR94
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY8,PURNO,SP70
          CALL      RDPMRES1
          IF        OVRCD=1
            CALL      CLPMSRES
          ENDIF
.
          BRANCH    PCEASE,INBFOR96         * Patient Deceased
          MATCH     SP70,BABYURNO
          IF        @EQUAL
            MATCH     "M",PSEX
            GOTO      INBFOR97 IF EQUAL
          ENDIF
.
          IF        PSTAT=1
            MOVE      PURNO,SAVEURNO
            MOVE      PPSNAME,URNUMBER
            MOVE      ONE,MRGEFLAG
          ENDIF
.
          MATCH     SP70,BABYURNO
          IF        @EQUAL
            CALL      SVMTHMAS                * save mothers pmi details
            CALL      CLPATMAS                * clear master detils
            CALL      CLPMSPX2                * clear mast ext2 details
            MOVE      URNUMBER,PURNO
            MOVE      MPGNAME,PGNAME
            MOVE      MPTITL,PTITL
            MOVE      MPSEX,PSEX
            MOVE      MPBDATE,PBDATE
.

            MATCH     "1",PTCNNEWC
            IF        @EQUAL
              MOVE      MPTITL,PPNKTITL          * If using extra contacts
              MOVE      MPSNAME,PPNKSNAM         * default to NOK details to the
              MOVE      MMPXFNAM,PPNKGNAM        * mother if no newborn 
              MOVE      MMPXSNAM,PPNKGNM2        * default are set for the NOK
              MOVE      SP70,PNKNAME
              MOVE      MPADD1,PNKADD1
              MOVE      MPADD2,PNKADD2
              MOVE      MPSUBRB,PNKSUBR
              MOVE      MPADD4,PNKADD4
              MOVE      MPPOST,PNKPOST
              MOVE      MPTELEP,PNKTELP
              MOVE      MPTELEB,PNKTELB
              MOVE      SP70,PNKRELP
              MOVE      SP70,PTMANOKO
              MOVE      SP70,PTMANOKE
              MOVE      MTMXCELL,PMPXKMOB     * N.O.K 1 Mobile Number
            ENDIF
.
            CALL      DEFMAS00                * default master details 
          ELSE
            IF        PTCNHDPS=1
              MOVE      MOTFNAME,PNKNAME      * NOK Name
              MOVE      MPADD1,PNKADD1        * N.O.K 1 ADDRESS LINE 1
              MOVE      MPADD2,PNKADD2        * N.O.K 1 ADDRESS LINE 2
              MOVE      MPSUBRB,PNKSUBR       * N.O.K 1 ADDRESS LINE 3
              MOVE      MPADD4,PNKADD4        * N.O.K 1 ADDRESS LINE 4
              MOVE      MPPOST,PNKPOST        * N.O.K 1 POSTCODE
              MOVE      MPTELEP,PNKTELP       * N.O.K 1 PRIVATE TELEPHONE
              MOVE      MPTELEB,PNKTELB       * N.O.K 1 BUSINESS TELEPHONE
              MOVE      MTMXCELL,PMPXKMOB     * N.O.K 1 Mobile Number
              MOVE      MMPXPEML,PMPXKEML     * N.O.K 1 Email Address
.             CALL      DEFMAS00              * default master details (NZ)
            ENDIF
          ENDIF
.
          CLEAR     TITLE
          APPEND    PGNAME,TITLE
          APPEND    PSNAME,TITLE
          APPEND    "(Input New Born Form)",TITLE
          APPEND    SP70,TITLE
          RESET     TITLE
          MOVE      TITLE,WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,INBFOR99
          CALL      WEBBOD00
          CALL      WEBEND00
          GOTO      INBFOR99
.
INBFOR93  MOVE      "Can't Find Mother's Admission Details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INBFOR99
.
INBFOR94  MOVE      "Can't Find Master Details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INBFOR99
.
INBFOR95  MOVE      "Mother's U/R Number is Locked",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INBFOR99
.
INBFOR96  MOVE      "Patient is Deceased",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INBFOR99
.
INBFOR97  MOVE      "Patient Is Not Female",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
INBFOR99  RETURN
+
.------------------------------------------------------------
. Register New Born
. Returns:   EXIT  0 = Ok to continue
.                  1 = Error
.------------------------------------------------------------
.
REGB0000  CALL      CLPATMAS                * clear master detils
          CALL      CLPMSPX2                * clear mast ext2 details
          CALL      CLPATMIS                * clear admission details
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,REGB9200
.
          MOVE      AURNO,MURNO
.
.
... *** nz only - baby urnumber already created through nhi99***
          MATCH     SP70,BABYURNO
          IF        !@EQUAL
            PACK      KEY8,BABYURNO,SP70
            CALL      RDMAST1
            IF        OVRCD=1
              CALL      CLPATMAS
              CALL      CLPMSPX2
            ENDIF
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
          ENDIF
.
          MATCH     SP70,BABYURNO
          IF        @EQUAL
            PACK      KEY8,MURNO,SP70
            CALL      RDMAST1
            IF        OVRCD=1
              CALL      CLPATMAS
              CALL      CLPMSPX2
              GOTO      REGB0500
            ENDIF
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
          ENDIF
.
          MATCH     SP70,BABYURNO
          IF        @EQUAL
            CALL      SVMTHMAS                * save mothers pmi details
            CALL      CLPATMAS                * clear master detils
            CALL      CLPMSPX2                * clear mast ext2 details
            CALL      DEFMAS00                * default master details
          ENDIF
.
REGB0500  CALL      UPDMAS00                * move cgi params into master fields
          CALL      UPVPMI00                * Move mast ext2 parm into file vars
          IF        PTCNNHII=1
            MOVE      BABYURNO,BURNO
            MOVE      BABYURNO,PURNO
          ELSE
            MOVE      FOUR,CPSYSTEM           * Using New Born U/R Range
            IF        MANALLOC=1
              CALL      VALUR000
              BRANCH    EXIT,REGB9999
              MOVE      URNUMBER,PURNO
              MOVE      PURNO,BURNO
            ELSE
              CALL      GNXTUR                  * Generate a new U/R Number
              MOVE      PURNO,BURNO
            ENDIF
          ENDIF       
          MOVE      BURNO,SPURNO
.
          MATCH     SP4,PTITL
          IF        @EQUAL
            MATCH     "M",PSEX
            IF        @EQUAL
              MOVE      "MAST",PTITL 
            ELSE
              MOVE      "MISS",PTITL       
            ENDIF
          ENDIF
.
          MOVE      ZERO,PHOSP              * no hospital visit previously
          MOVE      TWO,PSMOK               * non - smoker
          PACK      PCHGDTE,CCC,CYY,CMM,CDD * set date of change
          REP       " 0",PCHGDTE
.
          MOVE      BURNO,KEY8
          CALL      RDAMAST1
          IF        OVRCD=0
            CALL      UPLMAST1
            CALL      RDPMPX21
            IF        OVRCD=0
              CALL      UPVPMI00          * Move mast ext2 parm into file vars
              CALL      UPPMPX21
            ELSE
              MOVE      PURNO,PMPXURNO
              PACK      KEY8,PMPXURNO
              CALL      WRPMPX21
            ENDIF
.
            CALL      PMIGTNID              * get national id for dgate write
            MOVE      NMPNUMB,PTNINMPI
            MOVE      ONE,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLICUP              * broadcast update         *C-90205
          ELSE
.           MOVE      SAVMHFND,PFUNDH       * Move mother health fund
.           MOVE      SAVMHFTB,PFNDTB       * details back for new born
.           MOVE      SAVMHFMM,PFNDMM
            PACK      PTMXRDAT,CCC,CYY,CMM,CDD
            REP       " 0",PTMXRDAT
            CALL      WRMAST1
            MOVE      PURNO,PMPXURNO
            PACK      KEY8,PMPXURNO
            CALL      WRPMPX21            * Write to extension file two 
.
            MOVE      TWO,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLICRG              * broadcast register       *C-90205
          ENDIF
.
          MATCH     "1",PTMXOSMS            * Opt out of SMS
          IF        @EQUAL
            CALL      OSMS0000              * Write opt of of SMS record
          ELSE
            CALL      DSMS0000              * Delete opt of of SMS record
          ENDIF
.
          CALL      UPRES000                * Update residency details
          CALL      CRMED000                * Create medical record
.
..        IF        PTCNNHII=1
..          UNPACK    PURNO,DIM1,KEY7
..          MOVE      KEY7,NZIBNMPI
..          CALL      TMPNHI00
..        ENDIF
.
          MOVE      SP20,TDESC
          PACK      PUSR1,PUSR1,SP3
          MATCH     SP3,PUSR1
          IF        !@EQUAL
            MOVE      "P1",DIM2
            PACK      KEY5,DIM2,PUSR1
            CALL      RDCODE1
          ENDIF
.
          MATCH     "1",PTCNNEWC
          IF        @EQUAL
            CALL      ECON0000              * Write extra contact NOK
          ENDIF
.
          CALL      URALT000                * write to U/R alteration audit file
.
          CALL      SURNF000                * write surname index file
.
          CALL      UPALIA00                * Update Preferred Name alias
.
          CALL      UPUCM000                * input comments
.
          BRANCH    CAUDM,REGB1000          * Check with the audit master file
          MOVE      "A",ACTION
          CALL      WRMAUD
.
REGB1000  MOVE      MURNO,KEY8
          CALL      RDMAST1
          CALL      UUPTMAS1
          MOVE      BURNO,KEY8
          CALL      RDMAST1 
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY * Write to U/R linkage file
          PACK      KEY8,CCENT,CYEAR,CMON,CDAY
          MOVE      KEY8,BABYDOB            * set baby date of birth
          PROC      LINKBAB                 * maintain link file (ptmtbaby)
.
          CALL      PMIGTNID                * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      EIGHT,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLICUP                * trigger PMI update message
.
          MOVE      AADMNO,SAVADMNO         * Update the new born file
          MOVE      BABYDOB,KEY8            * set baby date of birth
          PROC      MBRNS000                * maintain new born file (ptmtbaby)
.
          MOVE      BABYVIS,KEY8
          CALL      UUPTMIS1
          MOVE      BURNO,KEY8
          CALL      UUPTMAS1
          MOVE      BURNO,URNUMBER          * For setting up redirect
.
          READ      CONTROLF,HUND25;*155,PTCNEPMI
          MATCH     "1",PTCNEPMI
          IF        @EQUAL
            CALL      ADDMUP00              * Add record to Missing UPI Patients table
          ENDIF
.
          MATCH     Z70,PTMAS070
          IF        !@EQUAL
            MATCH     SP70,PTMAS070
            IF        !@EQUAL
              CALL      MBRTH000              * Write multiple birth details
            ENDIF
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      REGB9999
.
REGB9100  MOVE      BABYVIS,KEY8
          CALL      UUPTMIS1
          MOVE      BURNO,KEY8
          CALL      UUPTMAS1
          MOVE      BURNO,URNUMBER          * For setting up redirect
          MOVE      ONE,EXIT
          GOTO      REGB9999
.
REGB9200  MOVE      "Can't Find Mother's Admission Details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      REGB9999
.
REGB9999  IF        URCMTFLG<>0
            CLOSE     COMFILAF,DELETE
          ENDIF
          RETURN
+
.------------------------------------------------------------
. Update Preferred Name alias
.------------------------------------------------------------
UPALIA00  MATCH     "0",PTCNNMPR             * Preferred Names not displayed on
                                             * Demographics screens
          GOTO      UPALIA99 IF EQUAL
.
          PACK      PMPXPFGN,PMPXPFGN,SP70
          PACK      PMPXPFSN,PMPXPFSN,SP70
.
          MATCH     SP70,PMPXPFGN
          IF        !@EQUAL
            PACK      GSRGNAM,PMPXPFGN,SP70      * if Pref GN not blank
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL
              PACK      GSRSNAM,PMPXPFSN,SP70    * if Pref GN & SN not blank
            ELSE
              PACK      GSRSNAM,PTMASNAM,SP70    * if Pref SN blank
            ENDIF
          ELSE
            PACK      GSRGNAM,PMPXFNAM,SP70      * if Pref GN blank
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL
              PACK      GSRSNAM,PMPXPFSN,SP70    * if Pref SN not blank
            ELSE
              GOTO      UPALIA99                 * if Pref GN & SN blank
            ENDIF
          ENDIF
.
          PACK      PTGSGNM2,PMPXSNAM,SP70   * Second Name
          MOVE      PBDATE,GSRDOB            * Date of birth
          MOVE      PSEX,GSRSEX              * Sex
          MOVE      PURNO,GSRURNO            * DOB
          MOVE      ZEROVISN,GSRBILL         * Billing Number
          MOVE      ZERO,GSRSYS              * System
          CALL      SOUNDEX                  * get soundex key for surname
          CALL      SOUNDX2                  * get soundex key for given names
.
          PACK      KEY115,GSRURNO,GSRBILL,GSRSNAM,GSRGNAM,PTGSGNM2,GSRDOB:
                           GSRSEX
          CALL      RDPTGSR1                 * check if its already there
          IF        OVRCD = 1
            CALL      WRPTGSR1
            MOVE      "28",PMEWTYPE
            PACK      PMEWOLDV,SP70
            PACK      DIM40,GSRSNAM,SP70
            PACK      KEY40,GSRGNAM,SP70
            PACK      PMEWNEWV,DIM40,SP1,KEY40,SP1,PTGSGNM2,SP70
            CALL      WREDW000
          ENDIF
.
UPALIA99  RETURN
+
.------------------------------------------------------------
. Add a record to the Missing UPI Patients table (PMSMUPFD)
.------------------------------------------------------------
ADDMUP00  MOVE      URNUMBER,KEY8
          CALL      RAPMMUP1
          IF        OVRCD<>1
            GOTO      ADDMUP99
          ENDIF
.
          CALL      IBACLOCK
.
          MOVE      URNUMBER,PMMUURNO
          MOVE      USERID,PMMUCUID
          PACK      PMMUCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMMUCDAT
          MOVE      CTIMEIS,PMMUCTIM
.
          CALL      WRPMMUP1
.
ADDMUP99  RETURN
+
.------------------------------------------------------------
. Validate UR number is available if manually allocating (waheatlh)
.------------------------------------------------------------
VALUR000  MOVE      ZERO,EXIT
          RESET     URNUMBER,EIGHT
          MATCH     SP8,URNUMBER            * Invalid U/R
          GOTO      VALUR900 IF EQUAL
.
          RESET     URNUMBER
          MOVE      URNUMBER,PURNO
          MOVE      PURNO,KEY8
          CALL      RDAMAST1
          COMPARE   ZERO,OVRCD              * U/R Number already exists
          GOTO      VALUR910 IF EQUAL
.
          RESET     URNUMBER
          GOTO      VALUR999
.
VALUR900  MOVE      "Invalid UR Number",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALUR999
.
VALUR910  MOVE      "UR Number already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALUR999
.
VALUR999  RETURN
+
.------------------------------------------------------------
. Display Input Boarder  Form
.------------------------------------------------------------
INBO0000  CALL      CLPATMAS                * clear master detils
          CALL      CLPMSPX2                * clear mast ext2 details
          CALL      CLPATMIS                * clear admission details
          MOVE      SP70,MBSDESC            * clear mbs description
          MOVE      SP70,PTDWDESC           * clear drg description
.
          MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,INBO0093
.
          MOVE      AADMNO,MADMNO           * mother admission number
          MOVE      AURNO,MURNO             * mother U/R Number
.
          PACK      KEY8,MURNO
          CALL      RDMAST1               * Read mother's details
          IF        OVRCD=0
            CALL      MOTNAM00              * Get mother's name
          ENDIF
.
          MATCH     SP70,BOARDURN
          IF        @EQUAL
            MOVE      MURNO,KEY8            * Read mother's details
          ELSE
            MOVE      BOARDURN,KEY8         * Read Baby's master details
          ENDIF
.
          CALL      RDMAST1
          BRANCH    OVRCD,INBO0094
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY8,PURNO,SP70
          CALL      RDPMRES1
          IF        OVRCD=1
            CALL      CLPMSRES
          ENDIF
.
          BRANCH    PCEASE,INBO0096         * Patient Deceased
.
          IF        PSTAT=1
            MOVE      PURNO,SAVEURNO
            MOVE      PPSNAME,URNUMBER
            MOVE      ONE,MRGEFLAG
          ENDIF
.
          MATCH     SP70,BOARDURN
          IF        @EQUAL
            CALL      SVMTHMAS                * save mothers pmi details
            CALL      CLPATMAS                * clear master detils
            CALL      CLPMSPX2                * clear mast ext2 details
...         MOVE      URNUMBER,PURNO
...         MOVE      SRCHSNAM,PSNAME
...         MOVE      SRCHGNAM,PGNAME
...         MOVE      SRCHPSEX,PSEX
...         MOVE      SRCHPDOB,PBDATE
            MOVE      URNUMBER,PURNO
            MOVE      MPGNAME,PGNAME
            MOVE      MPTITL,PTITL
            MOVE      MPSEX,PSEX
            MOVE      MPBDATE,PBDATE
            CALL      DEFBDM00                * default boarder master details
          ENDIF
.
          CLEAR     TITLE
          APPEND    PGNAME,TITLE
          APPEND    PSNAME,TITLE
          APPEND    "(Input Boarder Form)",TITLE
          APPEND    SP70,TITLE
          RESET     TITLE
          MOVE      TITLE,WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,INBO0099
          CALL      WEBBOD00
          CALL      WEBEND00
          GOTO      INBO0099
.
INBO0093  MOVE      "Can't Find Patients Admission Details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INBO0099
.
INBO0094  MOVE      "Can't Find Master Details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INBO0099
.
INBO0095  MOVE      "Boarders U/R Number is Locked",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INBO0099
.
INBO0096  MOVE      "Patient is Deceased",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INBO0099
.
INBO0099  RETURN
+
.------------------------------------------------------------
. Register Boarder 
. Returns:   EXIT  0 = Ok to continue
.                  1 = Error
.------------------------------------------------------------
.
REBD0000  PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,REBD9200
.
          MOVE      AURNO,MURNO
.
          MATCH     SP70,BOARDURN
          IF        @EQUAL
            PACK      KEY8,MURNO,SP70
            CALL      RDMAST1
            IF        OVRCD=1
              CALL      CLPATMAS
              CALL      CLPMSPX2
              GOTO      REBD0500
            ENDIF
          ENDIF
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          MATCH     SP70,BOARDURN
          IF        @EQUAL
            CALL      SVMTHMAS                * save mothers pmi details
            CALL      CLPATMAS                * clear master detils
            CALL      CLPMSPX2                * clear mast ext2 details
            CALL      DEFBDM00                * default master details
          ENDIF
.
REBD0500  CALL      UPDMAS00                * move cgi params into master fields
          CALL      UPVPMI00                * Move mast ext2 parm into file vars
          MOVE      THREE,CPSYSTEM           * Using New Born U/R Range
          IF        TEMPORAR=1
            CALL      GATUR000             * temporary registration
          ELSE
            CALL      GNXTUR                  * Generate a new U/R Number
          ENDIF
          MOVE      PURNO,BURNO
          MOVE      BURNO,SPURNO
.
          MOVE      ZERO,PHOSP              * no hospital visit previously
          MOVE      TWO,PSMOK               * non - smoker
          PACK      PCHGDTE,CCC,CYY,CMM,CDD * set date of change
          REP       " 0",PCHGDTE
.
          MOVE      BURNO,KEY8
          CALL      RDAMAST1
          IF        OVRCD=0
            CALL      UPLMAST1
            CALL      RDPMPX21
            IF        OVRCD=0
              CALL      UPVPMI00          * Move mast ext2 parm into file vars
              CALL      UPPMPX21
            ELSE
              MOVE      PURNO,PMPXURNO
              PACK      KEY8,PMPXURNO
              CALL      WRPMPX21
            ENDIF
.
            CALL      PMIGTNID              * get national id for dgate write
            MOVE      NMPNUMB,PTNINMPI
            MOVE      THREE,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLICUP              * broadcast update         *C-90205
          ELSE
            PACK      PTMXRDAT,CCC,CYY,CMM,CDD
            REP       " 0",PTMXRDAT
            CALL      WRMAST1
            MOVE      PURNO,PMPXURNO
            PACK      KEY8,PMPXURNO
            CALL      WRPMPX21            * Write to extension file two
.
            MOVE      FOUR,HL7TRGID
            MOVE      SP8,HL7INCLD
            PROC      DGCLICRG              * broadcast register       *C-90205
          ENDIF
.
          CALL      UPRES000                * Update residency details
          CALL      CRMED000                * Create medical record
.
          MOVE      SP20,TDESC
          PACK      PUSR1,PUSR1,SP3
          MATCH     SP3,PUSR1
          IF        !@EQUAL
            MOVE      "P1",DIM2
            PACK      KEY5,DIM2,PUSR1
            CALL      RDCODE1
          ENDIF
.
          CALL      URALT000                * write to U/R alteration audit file
.
          CALL      SURNF000                * write surname index file
          CALL      UPALIA00                * Update Preferred Name alias       
.
          BRANCH    CAUDM,REBD1000          * Check with the audit master file
          MOVE      "A",ACTION
          CALL      WRMAUD
.
REBD1000  MOVE      MURNO,KEY8
          CALL      RDMAST1
          CALL      UUPTMAS1
          MOVE      BURNO,KEY8
          CALL      RDMAST1
.
          PACK      KEY8,CCENT,CYEAR,CMON,CDAY
          REP       " 0",KEY8
          CALL      WRBL0000                * write boarder link
.
......    PROC      LINKBAB                 * maintain link file (ptmtbaby)
.
......    MOVE      AADMNO,SAVADMNO         * Update the new born file
......    MOVE      BABYDOB,KEY8            * set baby date of birth
......    PROC      MBRNS000                * maintain new born file (ptmtbaby)
.
          MOVE      BABYVIS,KEY8
          CALL      UUPTMIS1
          MOVE      BURNO,KEY8
          CALL      UUPTMAS1
          MOVE      BURNO,URNUMBER          * For setting up redirect
.
          MOVE      ZERO,EXIT
          GOTO      REBD9999
.
REBD9100  MOVE      BABYVIS,KEY8
          CALL      UUPTMIS1
          MOVE      BURNO,KEY8
          CALL      UUPTMAS1
          MOVE      BURNO,URNUMBER          * For setting up redirect
          MOVE      ONE,EXIT
          GOTO      REBD9999
.
REBD9200  MOVE      "Can't Find Boarder Admission Details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      REBD9999
.
REBD9999  RETURN
+
.------------------------------------------------------------
. WRBL0000 - Write boarder link        
.---------------------------------------------------------------------
WRBL0000  MOVE      MURNO,LINKFUR
          MOVE      BURNO,LINKTUR
          PACK      LINKSPR,SP20,SP20
          PACK      KEY16,LINKFUR,LINKTUR,SP70
          CALL      IBACLOCK 
          PACK      LINKDAT,CCENT,CYEAR,CMON,CDAY
          REP       " 0",LINKDAT
          PACK      LINKREA,LINKTYPE,SP70
          MOVE      ZERO,FROMLINK
          MOVE      ZERO,TOLINK
          CALL      RDLINK1
          IF        OVRCD=1
             MOVE      ONE,FROMLINK
          ENDIF
.
          PACK      KEY16,LINKTUR,LINKFUR
          CALL      RDLINK1
          IF        OVRCD=1
             MOVE      ONE,TOLINK
          ENDIF
.
          IF        FROMLINK=0
              IF        TOLINK=0
                  GOTO      WRBL9999     * FROM rec. & TO rec. exists
              ELSE
                  CALL      DELINK1      * FROM rec. exists & TO rec. not exist
                  CALL      WRLINK1
              ENDIF
          ELSE
              IF        TOLINK=1
                  CALL      WRLINK1      * FROM rec. & TO rec. not exist
              ELSE
                  CALL      DELINK1      * FROM rec. not exist & TO rec. exists
                  CALL      WRLINK1
              ENDIF
          ENDIF
.
          GOTO      WRBL9999
.
WRBL9999  RETURN
+
.------------------------------------------------------------
. GATUR000 - Generate Temporary U/R
.---------------------------------------------------------------------
.
GATUR000  COMPARE   ONE,PTCNNHII
          GOTO      GATUR500 IF EQUAL
.
          MOVE      " 80",PRXCODE
          CALL      GETSLK00
          READ      CONTROLF,EIGHTY;*223,PTCNNXTT   * Next temp NMPI
          ADD       ONE,PTCNNXTT                    * increment
          WRITAB    CONTROLF,EIGHTY;*223,PTCNNXTT   * write back to controlf
          CALL      RELSLK00
          MOVE      PTCNNXTT,F6
          MOVE      F6,KEY6
          REP       " 0",KEY6
          MOVE      "T-",KEY2            * Temp NHI Number Prefix with a #
          PACK      KEY8,KEY2,KEY6
          CALL      RDAMAST1            * Check for Temp Number on National
          COMPARE   ZERO,OVRCD
          GOTO      GATUR000 IF EQUAL   * U/R already exists
.
          MOVE      KEY8,PURNO
          GOTO      GATUR999
.
GATUR500  MOVE      " 80",PRXCODE
          CALL      GETSLK00
          READ      CONTROLF,EIGHTY;*223,PTCNNXTT   * Next temp NMPI
          ADD       ONE,PTCNNXTT                    * increment
          WRITAB    CONTROLF,EIGHTY;*223,PTCNNXTT   * write back to controlf
          CALL      RELSLK00
          MOVE      PTCNNXTT,F5
          MOVE      F5,KEY5
          REP       " 0",KEY5
          MOVE      "T-",KEY2            * Temp NHI Number Prefix with a #
          PACK      KEY7,KEY2,KEY5
          CALL      RANHMAS1            * Check for Temp Number on National
          COMPARE   ZERO,OVRCD
          GOTO      GATUR500 IF EQUAL   * U/R already exists
.
          PACK      KEY8,SP1,KEY2,KEY5
          CALL      RDAMAST1            * Check for Temp Number on National
          COMPARE   ZERO,OVRCD
          GOTO      GATUR500 IF EQUAL   * U/R already exists
.
          PACK      PURNO,SP1,KEY7
          MOVE      KEY7,NZIBNMPI
.
GATUR999  RETURN
+
.------------------------------------------------------------
. Change U/R
. Returns:   EXIT 0 = Ok to continue
.                 1 = Error occurred
.------------------------------------------------------------
CHUR0000  COMPARE   ZERO,CGENRUR
          GOTO      CHUR1000 IF EQUAL
.
          MATCH     SP70,NEWURNUM
          IF        @EQUAL
            MOVE      THREE,CPSYSTEM          * get the next Inpatient U/R
            CALL      GNXTUR
            MOVE      PURNO,NEWURNUM
            CALL      SETGEN00
          ENDIF
.
CHUR1000  CALL      VALD0000                 * validate U/R
          BRANCH    EXIT,CHUR9900
.
          IF        SAVEALIA=0 & SAVEDETL=0
            MOVE      OLDURNUM,KEY8          * Unlock U/R
            CALL      RDMAST1
            CALL      RDPMPX21
            CALL      RSURN000               * not to keep old U/R as an alias
          ENDIF
.>>>>
          CALL      PRS2T000                * may need to write to prspmiaf
.
          MOVE      OLDURNUM,OURNO
          MOVE      OLDURNUM,OLDURNO
          MOVE      NEWURNUM,NEWURNO
          CALL      CHANGEUR
          BRANCH    EXIT,CHUR9100,CHUR9000,CHUR9200
          CALL      WRMRG000                * write to patmrgaf file
          CALL      WESIM000                * write ESIS merge record (watesmaf)
.
          CALL      WPRSP000                * record the merge on prspmiaf
.
          MOVE      OLDURNUM,KEY8
          CALL      UUPTMAS1
          MOVE      NEWURNUM,KEY8           * Unlock U/R
          CALL      UUPTMAS1
.
.          MATCH     "1",PTCNUNET
.          IF        @EQUAL
.            MOVE      "01",KEY2                 * IHI Validation
.            PACK      KEY11,WBSEUID,SP70        * User ID
.            PACK      KEY50,NEWURNO,SP70
.            CALL      WIPL0000                  * Write to polling table
.          ENDIF
.
          MOVE      NEWURNUM,DIM8
          CALL      WPMNPL00                    * Write to NIHC IHI polling
.
          MOVE      OLDURNUM,DIM8
          CALL      WPMNPL00
.
          IF        SAVEDETL=1
            CALL      WEDR0000         * Write EDWARD alteration old ur kept
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CHUR9999
.
CHUR9000  PACK      WEBTITLE,SP70,SP70
          CLEAR     WEBTITLE
          APPEND    "Both U/R Numbers have a Current Admission/",WEBTITLE
          APPEND    "On Leave patient. ",WEBTITLE
          RESET     WEBTITLE
          MOVE      ZERO,EXIT
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHUR9999
.
CHUR9100  MOVE      OLDURNUM,KEY8
          CALL      UUPTMAS1
          MOVE      NEWURNUM,KEY8           * Unlock U/R
          CALL      UUPTMAS1
          GOTO      CHUR9900
.
CHUR9200  PACK      WEBTITLE,SP70,SP70
          CLEAR     WEBTITLE
          APPEND    "Both U/R Numbers have a Current Emergency Visit.",WEBTITLE
          RESET     WEBTITLE
          MOVE      ZERO,EXIT
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHUR9999
.
CHUR9900  MOVE      ONE,EXIT
.
CHUR9999  RETURN
.
.------------------------------------------------------------
. Validate U/R 
.------------------------------------------------------------
VALD0000  MOVE      ZERO,EXIT
          MOVE      OLDURNUM,KEY8           * old U/R
          CALL      CHKO0000                * check if master file locked/merge
          BRANCH    EXIT,VALD9999
          CALL      SURNF000                * Check soundex surname
.
          MOVE      NEWURNUM,KEY8           * new U/R
          CALL      CHKU0000                * check if master file locked/merge
          BRANCH    EXIT,VALD9000
          CALL      SURNF000                * Check soundex surname
          GOTO      VALD9999
.
VALD9000  MOVE      OLDURNUM,KEY8
          CALL      UUPTMAS1
VALD9999  RETURN
.
.------------------------------------------------------------
. Check if master record locked
.------------------------------------------------------------
CHKU0000  RESET     KEY8
          MATCH     SP8,KEY8
          GOTO      CHKU2000 IF NOT EQUAL
.
          PACK      WEBTITLE,SP70,SP70
          CLEAR     WEBTITLE
          APPEND    "U/R Number is not entered. ",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKU9999
.
CHKU2000  MOVE      KEY8,DIM8
          CALL      RLPTMAS1
          IF        OVRCD=2
            PACK      WEBTITLE,SP70,SP70
            CLEAR     WEBTITLE
            APPEND    "Patient U/R Number: ",WEBTITLE
            APPEND    KEY8,WEBTITLE
            APPEND    " is locked",WEBTITLE
            RESET     WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
          CALL      CLPMSPX2
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
.
CHKU9999  RETURN
.
.------------------------------------------------------------
. Check if master record locked
.------------------------------------------------------------
CHKO0000  RESET     KEY8
          MATCH     SP8,KEY8
          GOTO      CHKO2000 IF NOT EQUAL
.
          PACK      WEBTITLE,SP70,SP70
          CLEAR     WEBTITLE
          APPEND    "U/R Number is not entered. ",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKO9999
.
CHKO2000  MOVE      KEY8,DIM8
          CALL      RLPTMAS1
          IF        OVRCD=2
            PACK      WEBTITLE,SP70,SP70
            CLEAR     WEBTITLE
            APPEND    "Patient U/R Number: ",WEBTITLE
            APPEND    KEY8,WEBTITLE
            APPEND    " is locked",WEBTITLE
            RESET     WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
          IF        OVRCD=1
            PACK      WEBTITLE,SP70,SP70
            CLEAR     WEBTITLE
            APPEND    "Can't Find Master Details U/R : ",WEBTITLE
            APPEND    KEY8,WEBTITLE
            RESET     WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
          CALL      CLPMSPX2
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
.
CHKO9999  RETURN
.
.------------------------------------------------------------
. delete record from surname index file - for not keeping alias
.------------------------------------------------------------
RSURN000  MOVE      PTMASNAM,GSRSNAM
          MOVE      PMPXFNAM,GSRGNAM
          MOVE      PMPXSNAM,PTGSGNM2
          MOVE      OLDURNUM,GSRURNO
          MOVE      ZEROVISN,GSRBILL
          MOVE      ZERO,GSRSYS
          MOVE      PBDATE,GSRDOB
          MOVE      PSEX,GSRSEX
          CALL      SOUNDEX                 * get soundex key for surname
          CALL      SOUNDX2                 * get soundex key for given names
.
          PACK      KEY115,GSRURNO,GSRBILL,GSRSNAM,GSRGNAM,PTGSGNM2,GSRDOB:
                           GSRSEX
          CALL      DEPTGSR1
RSURN999  RETURN 
.
.------------------------------------------------------------
. Change U/R by admission
.------------------------------------------------------------
CHAD0000  UNPACK    SP20,OLDURNO,NEWURNO
.
          MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          IF        OVRCD=1
            CALL      CHKB0000            * Check if outpatient booking
            BRANCH    OPATBOOK,CHAD0500
            MOVE      NEWURNUM,NEWURNO
            CALL      CHKC0000            * Check if outpatient cancellation
            BRANCH    OPATCANC,CHAD0500
            CALL      CHGT0000            * Check if theatre booking
            CALL      FIXDET00            * fix oprdetaf
            GOTO      CHAD8000
          ENDIF
CHAD0500  MOVE      PVIURNO,OURNO
          MOVE      PVIURNO,OLDURNO
          MOVE      PVIURNO,OLDURNUM
          MOVE      NEWURNUM,NEWURNO
.
          MATCH     OLDURNO,NEWURNO       * can't change to itself
          GOTO      CHAD9100 IF EQUAL
.
          IF        PVITYPE = 3
            CALL      VALDIN00            * Validate admissions visits for URs
            BRANCH    EXIT,CHAD9300
          ENDIF
.
          IF        PVITYPE = 1
            CALL      VALDEM00            * Validate emergency visits for URs
            BRANCH    EXIT,CHAD9200
          ENDIF
.
          MOVE      OLDURNO,KEY8          * old U/R
          CALL      CHKO0000              * check if master file locked/merge
          BRANCH    EXIT,CHAD9999
.
          MOVE      NEWURNO,KEY8          * new U/R
          CALL      CHKU0000              * check if master file locked/merge
          BRANCH    EXIT,CHAD8000
.
          CALL      FXVT0000              * change transport visit to new ur
.
          BRANCH    PVITYPE,CHAD1000,CHAD2000,CHAD3000,CHAD9999,CHAD9999:
                            CHAD9999,CHAD9999,CHAD9999,CHAD3500
          GOTO      CHAD9999
.
CHAD1000  CALL      PAAE0000              * A&E
.
          MOVE      "9  ",EDWARDTY
          CALL      WEDU0000              * Write EDWARD visit alteration
          GOTO      CHAD4000
.
CHAD2000  CALL      POUT0000              * Outpatient     
.
          MOVE      "10 ",EDWARDTY
          CALL      WEDU0000              * Write EDWARD visit alteration
          GOTO      CHAD4000
.
CHAD3000  CALL      PINP0000              * Inpatient
.
          MOVE      "8  ",EDWARDTY
          CALL      WEDU0000              * Write EDWARD visit alteration
          GOTO      CHAD4000
.
CHAD3500  MATCH     " 2",PVISYST          * Allied Health
          GOTO      CHAD3800 IF NOT EQUAL
.
          MOVE      "12 ",EDWARDTY
          CALL      WEDU0000              * Write EDWARD visit alteration
.
          CALL      FIXALL
          CALL      FIXCDL
          CALL      FIXART00
          CALL      RMHV0000
.
          READ      CONTROLF,HUND21;*122,ALCNA44L
          MATCH     "1",ALCNA44L
          GOTO      CHAD4000 IF NOT EQUAL
.
          CALL      PMIGTNID              * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      NINE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLICUR              * broadcast A44 message
          GOTO      CHAD4000
.
CHAD3800  CALL      FIXEVT                * Events
.
CHAD4000  COMPARE   ONE,OPATBOOK          * Outpatient booking 
          GOTO      CHAD4500 IF EQUAL
.
          COMPARE   ONE,OPATCANC          * outpatient cancelled
          GOTO      CHAD4500 IF EQUAL
.
          CALL      PDAY0000              * day
.
CHAD4500  PACK      KEY8,ADMISSNO,SP70
          CALL      RDMRVS1
          IF        OVRCD=0
            CALL      DEMRVS1
          ENDIF
.
          MOVE      NEWURNUM,PVIURNO
          MOVE      ADMISSNO,PVIBILL
          MOVE      WBSEHOSP,PMVXMHOS
          CALL      ADDVIS00              
.
          CALL      ENDCGA00              * update U/R change audit
...       CALL      WMRG0000              * write to patmrgaf file
          CALL      ACCURC00              * Update ACC details file
          CALL      FCUR0000              * Update current patient file
          PROC      FXDSPT00              * Update dispataf and disptlaf
.
          MOVE      NEWURNUM,KEY8         * Unlock U/R
          CALL      UUPTMAS1
.
CHAD8000  MOVE      OLDURNUM,KEY8         * Unlock U/R
          CALL      UUPTMAS1
.
          MATCH     SP70,EDLINKIP
          IF        !@EQUAL
            MOVE      EDLINKIP,ADMISSNO   * Change U/R of the linked IP
            MOVE      SP70,EDLINKIP       * admission for an ED visit
            GOTO      CHAD0000
          ENDIF
.
          MATCH     SP70,IPLINKED
          IF        !@EQUAL
            MOVE      IPLINKED,ADMISSNO   * Change U/R of the linked ED
            MOVE      SP70,IPLINKED       * visit for an IP admission
            GOTO      CHAD0000
          ENDIF
.
          MATCH     SP70,STATLINK
          IF        !@EQUAL
            MOVE      STATLINK,ADMISSNO   * Change U/R of the linked ED
            PACK      KEY8,ADMISSNO,SP70
            CALL      RDMISS1
            IF        OVRCD<>1
              PACK      STATLINK,PTMILSDN,SP70    * next stat discharge number
              GOTO      CHAD0000
            ENDIF
          ENDIF
          MATCH     SP70,WLOTPACN       * if O/P pac appt. move booking
          IF        !@EQUAL
            PACK      ADMISSNO,WLOTPACN,SP70
            PACK      WLOTPACN,SP70
            GOTO      CHAD0000
          ENDIF
.
          MATCH     SP70,WLOTANAE       * if O/P pac appt. move booking
          IF        !@EQUAL
            PACK      ADMISSNO,WLOTANAE,SP70
            PACK      WLOTANAE,SP70
            GOTO      CHAD0000
          ENDIF
.
          GOTO      CHAD9999
.
CHAD9000  MOVE      ZERO,EXIT
          GOTO      CHAD9999
.
CHAD9100  MOVE      "Invalid UR - cannot change to the same patient",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHAD9999
.
CHAD9200  MOVE      "Both U/R Numbers have a Current Emergency Visit.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHAD9999
.
CHAD9300  PACK      WEBTITLE,SP70,SP70
          CLEAR     WEBTITLE
          APPEND    "Both U/R Numbers have a Current Admission/",WEBTITLE
          APPEND    "On Leave patient. ",WEBTITLE 
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHAD9999
.
CHAD9999  RETURN
+
.------------------------------------------------------------
. Inpatient patient
.------------------------------------------------------------
PINP0000  PROC      FIXNMP                * fix national id.
          CALL      UPDAXE                * write national id to pataxefd
          CALL      FIXINP
          CALL      FIXDET00              * fix oprdetaf
          CALL      FEOC0000              * remove linked event
          MOVE      AADMNO,KEY8
          CALL      UUPTMIS1              * unlock admission record
.
          CALL      GETTRN00              * get tran details for dgate write
          CALL      PMIGTNID              * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      FIVE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLICUR              * broadcast A44 message
.
PINP9999  RETURN
+
GETTRN00  OPEN      PATTRAN2,"pattranf"
          PACK      KEY30,AADMNO,Z70
          CALL      RDSTRAN2
          CALL      RDPTRAN2
          BRANCH    OVRCD OF GETTRN99
.
          MATCH     TADMN,AADMNO
          GOTO      GETTRN99 IF NOT EQUAL
.
GETTRN99  CLOSE     PATTRAN2
          RETURN
+
.------------------------------------------------------------
. Change the UR number in oprdetaf
.------------------------------------------------------------
FIXDET00  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OPRDETA2,"oprdetaf"
          TRAPCLR   IO
          BRANCH    OVRCD,FIXDET99

          PACK      KEY31,AADMNO,SP70
          CALL      RSOPDEA2
FIXDET10  CALL      RKOPDEA2
          BRANCH    OVRCD,FIXDET99
.
.         Update oprdetaf file with new UR
.
          MATCH     ADMISSNO,OPDAADMN
          GOTO      FIXDET99 IF NOT EQUAL
.
          MOVE      NEWURNO,OPDAURNO
          CALL      IBACLOCK
          PACK      OPDAUDAT,CCC,CYY,CMM,CDD
          REP       " 0",OPDAUDAT
.
          CLOCK     TIME,OPDAUTIM
          MOVE      WBSEUID,OPDAWEBU
.
          CALL      UPOPDEA2
.
          MOVE      "008",TADTTYPE
          PROC      OPTHETAT
.
          GOTO      FIXDET10
.
FIXDET99  RETURN
.------------------------------------------------------------
. A&E patient
.------------------------------------------------------------
PAAE0000  CALL      FIXAAE
          CALL      FEOC0000              * remove linked event
.
          CALL      PMIGTNID              * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      SIX,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLICUR              * broadcast A44 message
PAAE9999  RETURN
.------------------------------------------------------------
. Outpatient
.------------------------------------------------------------
POUT0000  COMPARE   ONE,OPATCANC          * outpatient cancelled
          GOTO      POUT2000 IF EQUAL
.
          CALL      FBOA0000              * Fixed outbokaf file (FIXBOKA)
.
          COMPARE   ONE,OPATBOOK          * It is a booking so there is no
          GOTO      POUT2000 IF EQUAL     * visits or invoices to change
.
          CALL      FIXVIS
          MOVE      ONE,FORM1             * using pat files in fixinv
          PROC      FIXINV
.
POUT2000  CALL      FEOC0000              * remove linked event
.
          CALL      PMIGTNID              * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      SEVEN,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLICUR              * broadcast A44 message
.
POUT9999  RETURN
.------------------------------------------------------------
. day change
.------------------------------------------------------------
PDAY0000  CALL      FIXVIS
          CALL      FEOC0000              * remove linked event
PDAY9999  RETURN
.------------------------------------------------------------
. U/R change Audit
.------------------------------------------------------------
ENDCGA00  COMPARE   ONE,PTCNUADM           * U/R change for adm. audit ?
          GOTO      ENDCGA99 IF NOT EQUAL  * No.
.
          OPEN      PATUADA1,"patuadaf"
          MOVE      PVIBILL,PTUAADMN           * Billing number
          PACK      PTUADATE,CCC,CYY,CMM,CDD   * Current date
          REP       " 0",PTUADATE
          CLOCK     TIME,PTUATIME           * Current time
          MOVE      OLDURNUM,PTUAOUR        * Old U/R No.
          MOVE      NEWURNUM,PTUANUR        * New U/R No.
          MOVE      SECUSER,PTUAOPR         * Operator id
          MOVE      SP10,PTUASPAR           * Spare
          PACK      KEY24,PTUAADMN,PTUADATE,PTUATIME
          CALL      RAPTUAD1
          IF        OVRCD=1
            CALL      WRPTUAD1
          ENDIF
          CLOSE     PATUADA1
ENDCGA99  RETURN
.
.*****************************************************************************
.*                          FEOC0000                                         *
.*         Remove the record from the eoclnkaf file if one exists for        *
.*         this visit (as the visit will need to be manually relinked)       *
.*****************************************************************************
.
FEOC0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EOCLNKA1,"eoclnkaf"          * eoclnkaf found ?
          TRAPCLR   IO
          BRANCH    OVRCD,FEOC9999               * no - finished
.
          PACK      KEY23,OURNO,SP30
          CALL      RSECLNK1                     * position on U/R no.
FEOC0500  CALL      RKECLNK1                     * read next record
          BRANCH    OVRCD,FEOC9000               * eof - finished
.
          MATCH     OURNO,ECLNURNO               * same U/R still ?
          GOTO      FEOC9000 IF NOT EQUAL        * no - finished
.
          MATCH     AADMNO,ECLNVISI              * same visit no. ?
          GOTO      FEOC0500 IF NOT EQUAL        * no - ignore
.
.         The visit has been found on eoclnkaf, so remove the record so
.         that this visit is no longer linked to an EOC
.
          PACK      KEY23,ECLNURNO,ECLNEPNO,ECLNHOSP,ECLNVISI
          CALL      DEECLNK1
.
FEOC9000  CLOSE     EOCLNKA1
.
FEOC9999  RETURN
.
.*********************************************************************
.        Subroutine to fix up a single outpatient booking
.*********************************************************************
FBOA0000  OPEN      OUTSITA1,"outsitaf"
          MOVE      "out",OSTFILE
          MOVE      PVISITE,KEY6
          CALL      RDSITA1
          CLOSE     OUTSITA1
.
          PACK      CFNAME,OSTFILE,FILBOKA1
          OPEN      OUTBOKA1,CFNAME
          PACK      CFNAME,OSTFILE,FILBOKA3
          OPEN      OUTBOKA3,CFNAME
.
.        Loop over this U/R, locking booking records as we go
.
FBOA1000  PACK      KEY36 WITH PVIURNO,PVIDATE,SP30
          CALL      RDSBOKA3
FBOA2000  CALL      RDKBOKA3
          BRANCH    OVRCD OF FBOA9999
.
          MATCH     OBAURNO,PVIURNO
          GOTO      FBOA9999 IF NOT EQUAL
.
          MATCH     OBAOUTNO,PVIBILL
          GOTO      FBOA2000 IF NOT EQUAL
.
.        Lock this record if possible
.
FBOA3000  PACK      KEY28 WITH OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT
          CALL      RDBOKA1
          BRANCH    OVRCD OF FBOA9999,FBOA9999
.
          MOVE      NEWURNUM,OBAURNO
          CALL      UPBOKA1
          GOTO      FBOA1000
.
FBOA9999  RETURN
.*********************************************************************
.        Subroutine to fix up a single outpatient booking
.*********************************************************************
CHKB0000  MOVE      ZERO,OPATBOOK
          OPEN      OUTSITA1,"outsitaf"
          MOVE      "out",OSTFILE
          PACK      CFNAME,OSTFILE,FILCANA1
          OPEN      OUTCANA1,CFNAME
          PACK      CFNAME,OSTFILE,FILCANA2
          OPEN      OUTCANA2,CFNAME
          MOVE      OPATSITE,KEY6
          CALL      RDSITA1
          CLOSE     OUTSITA1
.
          PACK      CFNAME,OSTFILE,FILBOKA6
          OPEN      OUTBOKA6,CFNAME
.
.        Loop over this U/R, locking booking records as we go
.
CHKB1000  PACK      KEY36 WITH ADMISSNO,SP70
          CALL      RDSBOKA6
CHKB2000  CALL      RDKBOKA6
          BRANCH    OVRCD OF CHKB9100
.
          MATCH     DOBAOUTN,ADMISSNO
          GOTO      CHKB9100 IF NOT EQUAL
.
          MOVE      OBAURNO,PVIURNO
          MOVE      OBAOUTNO,PVIBILL
          MOVE      OBAOUTNO,AADMNO
          MOVE      OPATSITE,PVISITE
          MOVE      TWO,PVITYPE
.
CHKB9000  MOVE      ONE,OPATBOOK            * Set booking flag to yes
          CLOSE     OUTBOKA6
          GOTO      CHKB9999
.
CHKB9100  MOVE      ZERO,OPATBOOK
          CLOSE     OUTBOKA6
.
CHKB9999  RETURN
+
.*********************************************************************
.        Subroutine to fix up a outpatient cancellation
.*********************************************************************
CHKC0000  MOVE      ZERO,OPATCANC
          PACK      KEY8,ADMISSNO,SP30
          CALL      RDOTCAN1
          BRANCH    OVRCD,CHKC9999
.
          MOVE      OPCNURNO,PVIURNO
          MOVE      OPCNOUTN,PVIBILL
          MOVE      OPCNOUTN,AADMNO
          MOVE      OPCNSITE,PVISITE
          MOVE      TWO,PVITYPE
.
          MOVE      NEWURNO,OPCNURNO
          CALL      UPOTCAN1
.
          MOVE      ONE,OPATCANC
.
CHKC9999  RETURN
.
.*********************************************************************
.        Subroutine to fix up a single theatre booking
.*********************************************************************
CHGT0000  MOVE      ADMISSNO,PVIBILL
          MOVE      ADMISSNO,AADMNO
          MOVE      AADMNO,KEY8
          CALL      RDBKREC1
          BRANCH    OVRCD,CHGT9999
.
          DISPLAY   *P1:24,*EL,"Booking   : ",*V2LON,DADMNO;
          MOVE      BKREURNO,OURNO
          MOVE      BKREURNO,OURNO
          MOVE      BKREURNO,OLDURNO
          MOVE      BKREURNO,OLDURNUM

          CALL      FXBKRES1               * fix Booking record and WL
.
CHGT9999  RETURN
+
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD99,PROFLD99,PROFLD10,PROFLD10
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13,PROFLD14,PROFLD15:
                             PROFLD16,PROFLD17,PROFLD18
          GOTO      PROFLD99
.
PROFLD11  CALL      MASF0000                * Master File Details
          GOTO      PROFLD99
.
PROFLD12  CALL      MISF0000                * Admission File Details
          GOTO      PROFLD99
.
PROFLD13  CALL      MSXF0000                * Master Extension File Details
          GOTO      PROFLD99
.
PROFLD14  CALL      NBFD0000                * New Born Form Details
          GOTO      PROFLD99
.
PROFLD15  CALL      PMIX0000                * PMI ext2
          GOTO      PROFLD99
.
PROFLD16  CALL      BRDP0000
          GOTO      PROFLD99
.
PROFLD17  CALL      BRDR0000
          GOTO      PROFLD99
.
PROFLD18  CALL      GTAG0000
          GOTO      PROFLD99
.
PROFLD99  RETURN
.
+
.------------------------------------------------------------
. GTAG0000 - General / Miscellaneous Tags
.------------------------------------------------------------
GTAG0000  BRANCH    FLDITMNO,GTAG0100
.
          WRITE     HTMLFILE;"Invalid IBA Tag"
          GOTO      GTAG9999
.
GTAG0100  WRITE     HTMLFILE;PMRSSTDN;
          GOTO      GTAG9999
.
GTAG9999  RETURN
.------------------------------------------------------------
.------------------------------------------------------------
. New Born Form Details
.------------------------------------------------------------
NBFD0000  BRANCH    FLDITMNO,NBFD0100,NBFD0200,NBFD0300,NBFD0400,NBFD0500:
                             NBFD0600,NBFD0700,NBFD0800,NBFD0900,NBFD1000:
                             NBFD1100,NBFD1200,NBFD1300,NBFD1400,NBFD1500:
                             NBFD1600,NBFD1700,NBFD1800,NBFD1900,NBFD2000:
                             NBFD2100,NBFD2200,NBFD2300
          GOTO      NBFD9999      
.
NBFD0100  CALL      CDATE000                * Current Date
          GOTO      NBFD9999
.
NBFD0200  CALL      CTIME000                * Current Time
          GOTO      NBFD9999
.
NBFD0300  MOVE      BABDDSC0,BABDDESC
          LOAD      BABDDESC,PTCNBABD,BABDDSC1
          ENDSET    BABDDESC
          APPEND    PGNAME,BABDDESC
          RESET     BABDDESC
          WRITE     HTMLFILE;BABDDESC;     * Baby Name Description form CONTROLF
          GOTO      NBFD9999
.
NBFD0400  WRITE     HTMLFILE;BABYURNO;
          GOTO      NBFD9999
.
NBFD0500  CALL      BMST0000     * baby marital status 
          GOTO      NBFD9999
.
NBFD0600  WRITE     HTMLFILE;MOTFNAME;
          GOTO      NBFD9999
.
NBFD0700  MOVE      "C ",CATEGORY
          MOVE      PMRSCONT,CODE
          CALL      CODITM00                              
          GOTO      NBFD9999
.
NBFD0800  MATCH     SP70,PMRSTEXP
          GOTO      NBFD9999 IF EQUAL
          UNPACK    PMRSTEXP,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NBFD9999
.
NBFD0900  WRITE     HTMLFILE;PMRSCOMM;
          GOTO      NBFD9999
.
NBFD1000  CALL      CHKRES00             * Check for residency expiry
          WRITE     HTMLFILE;EXIT;                             
          GOTO      NBFD9999
.
NBFD1100  MATCH     SP70,PMRSVISN
          GOTO      NBFD9999 IF EQUAL
.
          WRITE     HTMLFILE;PMRSVISN;
          GOTO      NBFD9999
.
NBFD1200  WRITE     HTMLFILE;SRCHSNAM;
          GOTO      NBFD9999
.
NBFD1300  WRITE     HTMLFILE;SRCHGNAM;
          GOTO      NBFD9999
.
NBFD1400  MATCH     SP70,SRCHPDOB
          GOTO      NBFD9999 IF EQUAL
          UNPACK    SRCHPDOB,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NBFD9999
.
NBFD1500  WRITE     HTMLFILE;SRCHPSEX;
          GOTO      NBFD9999
.
NBFD1600  WRITE     HTMLFILE;BOARDURN;
          GOTO      NBFD9999
.
NBFD1700  WRITE     HTMLFILE;TEMPORAR;
          GOTO      NBFD9999
.
NBFD1800  UNPACK    DIM127,D1,KEY1,DIM127
          UNPACK    DIM127,D1,KEY1A,DIM127
.
          PACK      KEY5,CATEGTC,SP70
          CALL      RDSCODE1
NBFD1850  CALL      RDKCODE1
          BRANCH    OVRCD,NBFD9999
.
          MATCH     CATEGTC,TCODE
          GOTO      NBFD9999 IF NOT EQUAL
.
          MATCH     KEY1,TCINDC1
          GOTO      NBFD1850 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      NBFD1850 IF EQUAL
.
          MATCH     "2",TCINDC3
          GOTO      NBFD1850 IF EQUAL
.
          MATCH     "0",KEY1A
          IF        @EQUAL
            WRITE     HTMLFILE;TDESC;
          ELSE
            WRITE     HTMLFILE;ACODE;
          ENDIF
          GOTO      NBFD9999
.
NBFD1900  WRITE     HTMLFILE;PPNKTITL;
          GOTO      NBFD9999
.
NBFD2000  WRITE     HTMLFILE;PPNKSNAM;
          GOTO      NBFD9999
.
NBFD2100  WRITE     HTMLFILE;PPNKGNAM;
          GOTO      NBFD9999
.
NBFD2200  WRITE     HTMLFILE;PPNKGNM2;
          GOTO      NBFD9999
.
NBFD2300  WRITE     HTMLFILE;ASTAT;
          GOTO      NBFD9999
.
NBFD9999  RETURN 
.------------------------------------------------------------
. Default New Born Marital Status
.------------------------------------------------------------
BMST0000  PACK      KEY5,ANSM,SP10
          CALL      RDSCODE1
BMST1000  CALL      RDKCODE1
          BRANCH    OVRCD,BMST9999
.
          MATCH     "1",TCINDC1
          GOTO      BMST1000 IF NOT EQUAL
.
          WRITE     HTMLFILE;ACODE;
BMST9999  RETURN
.------------------------------------------------------------
. Calculate Current date.
.------------------------------------------------------------
CDATE000  CALL      IBACLOCK
          PACK      TODAY,CCC,CYY,CMM,CDD
          REP       " 0",TODAY
.
          UNPACK    TODAY,CCENT,CYEAR,CMON,CDAY
          MOVE      CMM,F2
          MOVE      CYY,CYEAR
          REP       " 0",CYEAR
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
.
CDATE999  RETURN
.------------------------------------------------------------
. Calculate Current time.
.------------------------------------------------------------
CTIME000  CALL      IBACLOCK
          WRITE     HTMLFILE;CTIMEIS;
.
CTIME999  RETURN
.------------------------------------------------------------
.   Set Parameters for Master Details
.------------------------------------------------------------
SPMAS000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPMAS010,SPMAS020,SPMAS030,SPMAS040,SPMAS050:
                       SPMAS060,SPMAS070,SPMAS080,SPMAS090,SPMAS100:
                       SPMAS110,SPMAS120,SPMAS130,SPMAS140,SPMAS150:
                       SPMAS160,SPMAS170,SPMAS180,SPMAS190,SPMAS200:
                       SPMAS210,SPMAS220,SPMAS230,SPMAS240,SPMAS250:
                       SPMAS260,SPMAS270,SPMAS280,SPMAS290,SPMAS300:
                       SPMAS310,SPMAS320,SPMAS330,SPMAS340,SPMAS350:
                       SPMAS360,SPMAS370,SPMAS380,SPMAS390,SPMAS400:
                       SPMAS410,SPMAS420,SPMAS430,SPMAS440,SPMAS450:
                       SPMAS460,SPMAS470,SPMAS480,SPMAS490,SPMAS500:
                       SPMAS510,SPMAS520,SPMAS530,SPMAS540,SPMAS550:
                       SPMAS560,SPMAS570,SPMAS580,SPMAS590,SPMAS600:
                       SPMAS610,SPMAS620,SPMAS630,SPMAS640,SPMAS650:
                       SPMAS660,SPMAS670,SPMAS680,SPMAS690,SPMAS700:
                       SPMAS710
.
          MOVE      ONE,EXIT
          GOTO      SPMAS999

SPMAS010  MOVE      QRYDATA,PTMAS001
          GOTO      SPMAS900
SPMAS020  MOVE      QRYDATA,PTMAS002
          GOTO      SPMAS900
SPMAS030  MOVE      QRYDATA,PTMAS003
          GOTO      SPMAS900
SPMAS040  MOVE      QRYDATA,PTMAS004
          GOTO      SPMAS900
SPMAS050  MOVE      QRYDATA,PTMAS005
          GOTO      SPMAS900
SPMAS060  MOVE      QRYDATA,PTMAS006
          GOTO      SPMAS900
SPMAS070  MOVE      QRYDATA,PTMAS007
          GOTO      SPMAS900
SPMAS080  MOVE      QRYDATA,PTMAS008
          GOTO      SPMAS900
SPMAS090  MOVE      QRYDATA,PTMAS009
          GOTO      SPMAS900
SPMAS100  MOVE      QRYDATA,PTMAS010
          GOTO      SPMAS900
SPMAS110  MOVE      QRYDATA,PTMAS011
          GOTO      SPMAS900
SPMAS120  MOVE      QRYDATA,PTMAS012
          GOTO      SPMAS900
SPMAS130  MOVE      QRYDATA,PTMAS013
          GOTO      SPMAS900
SPMAS140  MOVE      QRYDATA,PTMAS014
          GOTO      SPMAS900
SPMAS150  MOVE      QRYDATA,PTMAS015
          GOTO      SPMAS900
SPMAS160  MOVE      QRYDATA,PTMAS016
          GOTO      SPMAS900
.
SPMAS170  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMAS017,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMAS900
SPMAS180  MOVE      QRYDATA,PTMAS018
          GOTO      SPMAS900
SPMAS190  MOVE      QRYDATA,PTMAS019
          GOTO      SPMAS900
SPMAS200  MOVE      QRYDATA,PTMAS020
          GOTO      SPMAS900
SPMAS210  MOVE      QRYDATA,PTMAS021
          GOTO      SPMAS900
SPMAS220  MOVE      QRYDATA,PTMAS022
          GOTO      SPMAS900
SPMAS230  MOVE      QRYDATA,PTMAS023
          GOTO      SPMAS900
SPMAS240  MOVE      QRYDATA,PTMAS024
          GOTO      SPMAS900
SPMAS250  UNPACK    QRYDATA,KEY2,KEY1,KEY2A
          PACK      PTMAS025,KEY2,KEY2A
          GOTO      SPMAS900
SPMAS260  MOVE      QRYDATA,PTMAS026
          GOTO      SPMAS900
SPMAS270  MOVE      QRYDATA,PTMAS027
          GOTO      SPMAS900
SPMAS280  MOVE      QRYDATA,PTMAS028
          GOTO      SPMAS900
SPMAS290  MOVE      QRYDATA,PTMAS029
          GOTO      SPMAS900
SPMAS300  MOVE      QRYDATA,PTMAS030 
          GOTO      SPMAS900
SPMAS310  MOVE      QRYDATA,PTMAS031
          GOTO      SPMAS900
SPMAS320  MOVE      QRYDATA,PTMAS032
          GOTO      SPMAS900
SPMAS330  MOVE      QRYDATA,PTMAS033
          GOTO      SPMAS900
SPMAS340  MOVE      QRYDATA,PTMAS034
          GOTO      SPMAS900
SPMAS350  MOVE      QRYDATA,PTMAS035
          GOTO      SPMAS900
SPMAS360  MOVE      QRYDATA,PTMAS036
          GOTO      SPMAS900
SPMAS370  MOVE      QRYDATA,PTMAS037
          GOTO      SPMAS900
SPMAS380  MOVE      QRYDATA,PTMAS038
          GOTO      SPMAS900
SPMAS390  MOVE      QRYDATA,PTMAS039
          GOTO      SPMAS900
SPMAS400  MOVE      QRYDATA,PTMAS040
          GOTO      SPMAS900
SPMAS410  MOVE      QRYDATA,PTMAS041
          GOTO      SPMAS900
SPMAS420  MOVE      QRYDATA,PTMAS042
          GOTO      SPMAS900
SPMAS430  MOVE      QRYDATA,PTMAS043
          GOTO      SPMAS900
SPMAS440  MOVE      QRYDATA,PTMAS044
          GOTO      SPMAS900
SPMAS450  MOVE      QRYDATA,PTMAS045
          GOTO      SPMAS900
SPMAS460  MOVE      QRYDATA,PTMAS046
          GOTO      SPMAS900
SPMAS470  MOVE      QRYDATA,PTMAS047
          GOTO      SPMAS900
SPMAS480  MOVE      QRYDATA,PTMAS048
          GOTO      SPMAS900
SPMAS490  MOVE      QRYDATA,PTMAS049
          GOTO      SPMAS900
SPMAS500  MOVE      QRYDATA,PTMAS050
          GOTO      SPMAS900
SPMAS510  MOVE      QRYDATA,PTMAS051
          GOTO      SPMAS900
SPMAS520  MOVE      QRYDATA,PTMAS052
          GOTO      SPMAS900
SPMAS530  MOVE      QRYDATA,PTMAS053
          GOTO      SPMAS900
SPMAS540  MOVE      QRYDATA,PTMAS054
          GOTO      SPMAS900
SPMAS550  MOVE      QRYDATA,PTMAS055
          GOTO      SPMAS900
SPMAS560  MOVE      QRYDATA,PTMAS056
          GOTO      SPMAS900
SPMAS570  MOVE      QRYDATA,PTMAS057
          GOTO      SPMAS900
SPMAS580  MOVE      QRYDATA,PTMAS058
          GOTO      SPMAS900
SPMAS590  MOVE      QRYDATA,PTMAS059
          GOTO      SPMAS900
SPMAS600  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMAS060,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMAS900
SPMAS610  MATCH     SP70,QRYDATA
          GOTO      SPMAS900 IF EQUAL 
          GOTO      SPMAS900 IF EOS     
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMAS061,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMAS900
SPMAS620  MOVE      QRYDATA,PTMAS062
          GOTO      SPMAS900
SPMAS630  MOVE      QRYDATA,PTMAS063
          GOTO      SPMAS900
SPMAS640  MOVE      QRYDATA,PTMAS064
          GOTO      SPMAS900
SPMAS650  MOVE      QRYDATA,PTMAS065
          GOTO      SPMAS900
SPMAS660  MOVE      QRYDATA,PTMAS066
          GOTO      SPMAS900
.
SPMAS670  MOVE      QRYDATA,PTMAS067
          GOTO      SPMAS900
.
SPMAS680  MOVE      QRYDATA,PTMAS068
          GOTO      SPMAS900
.
SPMAS690  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMAS069,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMAS900
.
SPMAS700  PACK      PTMAS070,QRYDATA,SP70
          GOTO      SPMAS900
.
SPMAS710  PACK      PTMAS071,QRYDATA,SP70
          GOTO      SPMAS900
.
SPMAS900  MOVE      ONE,MASUPDFL
.
SPMAS999  RETURN
.------------------------------------------------------------
.   Set Parameters for Master Extension Details
.------------------------------------------------------------
SPMSX000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPMSX010,SPMSX020,SPMSX030,SPMSX040,SPMSX050:
                       SPMSX060,SPMSX070,SPMSX080,SPMSX090,SPMSX100:
                       SPMSX110,SPMSX120,SPMSX130,SPMSX140,SPMSX150:
                       SPMSX160,SPMSX170,SPMSX180,SPMSX190,SPMSX200:
                       SPMSX210,SPMSX220,SPMSX230,SPMSX240,SPMSX250:
                       SPMSX260,SPMSX270,SPMSX280,SPMSX290,SPMSX300:
                       SPMSX310,SPMSX320,SPMSX330,SPMSX340,SPMSX350:
                       SPMSX360,SPMSX370,SPMSX380,SPMSX390,SPMSX400:
                       SPMSX410,SPMSX420,SPMSX430,SPMSX440,SPMSX450:
                       SPMSX460,SPMSX470,SPMSX480,SPMSX490,SPMSX500:
                       SPMSX510
.
SPMSX010  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMSX001,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMSX900
SPMSX020  MOVE      QRYDATA,PTMSX002
          GOTO      SPMSX900
SPMSX030  MOVE      QRYDATA,PTMSX003
          GOTO      SPMSX900
SPMSX040  MOVE      QRYDATA,PTMSX004
          GOTO      SPMSX900
SPMSX050  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMSX005,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMSX900
SPMSX060  MOVE      QRYDATA,PTMSX006
          GOTO      SPMSX900
SPMSX070  MOVE      QRYDATA,PTMSX007
          GOTO      SPMSX900
SPMSX080  MOVE      QRYDATA,PTMSX008
          GOTO      SPMSX900
SPMSX090  MOVE      QRYDATA,PTMSX009
          GOTO      SPMSX900
SPMSX100  MOVE      QRYDATA,PTMSX010
          GOTO      SPMSX900
SPMSX110  MOVE      QRYDATA,PTMSX011
          GOTO      SPMSX900
SPMSX120  MOVE      QRYDATA,PTMSX012
          GOTO      SPMSX900
SPMSX130  MOVE      QRYDATA,PTMSX013
          GOTO      SPMSX900
SPMSX140  MOVE      QRYDATA,PTMSX014
          GOTO      SPMSX900
SPMSX150  MOVE      QRYDATA,PTMSX015
          GOTO      SPMSX900
SPMSX160  MOVE      QRYDATA,PTMSX016
          GOTO      SPMSX900
SPMSX170  MOVE      QRYDATA,PTMSX017
          GOTO      SPMSX900
SPMSX180  MOVE      QRYDATA,PTMSX018
          GOTO      SPMSX900
SPMSX190  MOVE      QRYDATA,PTMSX019
          GOTO      SPMSX900
SPMSX200  MOVE      QRYDATA,PTMSX020
          GOTO      SPMSX900
SPMSX210  MOVE      QRYDATA,PTMSX021
          GOTO      SPMSX900
SPMSX220  MOVE      QRYDATA,PTMSX022
          GOTO      SPMSX900
SPMSX230  MOVE      QRYDATA,PTMSX023
          GOTO      SPMSX900
SPMSX240  MOVE      QRYDATA,PTMSX024
          GOTO      SPMSX900
SPMSX250  MOVE      QRYDATA,PTMSX025
          GOTO      SPMSX900
SPMSX260  MOVE      QRYDATA,PTMSX026
          GOTO      SPMSX900
SPMSX270  MOVE      QRYDATA,PTMSX027
          GOTO      SPMSX900
SPMSX280  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMSX028,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMSX900
SPMSX290  MOVE      QRYDATA,PTMSX029
          GOTO      SPMSX900
SPMSX300  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMSX030,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMSX900
SPMSX310  MOVE      QRYDATA,PTMSX031
          GOTO      SPMSX900
SPMSX320  MOVE      QRYDATA,PTMSX032
          GOTO      SPMSX900
SPMSX330  MOVE      QRYDATA,PTMSX033
          GOTO      SPMSX900
SPMSX340  MOVE      QRYDATA,PTMSX034
          MOVE      ONE,CHGCGP
          GOTO      SPMSX900
SPMSX350  MOVE      QRYDATA,PTMSX035
          MOVE      ONE,CHGCGP 
          GOTO      SPMSX900
SPMSX360  MOVE      QRYDATA,PTMSX036
          GOTO      SPMSX900
SPMSX370  MOVE      QRYDATA,PTMSX037
          MOVE      ONE,CHGCGP 
          GOTO      SPMSX900
SPMSX380  MOVE      QRYDATA,PTMSX038
          GOTO      SPMSX900
SPMSX390  MOVE      QRYDATA,PTMSX039
          GOTO      SPMSX900
SPMSX400  MOVE      QRYDATA,PTMSX040
          GOTO      SPMSX900
SPMSX410  MOVE      QRYDATA,PTMSX041
          GOTO      SPMSX900
SPMSX420  MOVE      QRYDATA,PTMSX042
          GOTO      SPMSX900
SPMSX430  MOVE      QRYDATA,PTMSX043
          GOTO      SPMSX900
SPMSX440  MOVE      QRYDATA,PTMSX044
          GOTO      SPMSX900
SPMSX450  MOVE      QRYDATA,PTMSX045
          GOTO      SPMSX900
SPMSX460  MOVE      QRYDATA,PTMSX046
          GOTO      SPMSX900
.
SPMSX470  MOVE      QRYDATA,PTMSX047
          GOTO      SPMSX900
.
SPMSX480  MOVE      QRYDATA,PTMSX048
          GOTO      SPMSX900
.
SPMSX490  MOVE      QRYDATA,PTMSX049
          GOTO      SPMSX900
.
SPMSX500  MOVE      QRYDATA,PTMSX050
          GOTO      SPMSX900
.
SPMSX510  MOVE      QRYDATA,PTMSX051
          GOTO      SPMSX900
.
SPMSX900  MOVE      ONE,MASUPDFL
.
SPMSX999  RETURN
.------------------------------------------------------------
.   Set Parameters for Admission Details
.------------------------------------------------------------
SPMIS000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPMIS010,SPMIS020,SPMIS030,SPMIS040,SPMIS050:
                       SPMIS060,SPMIS070,SPMIS080,SPMIS090,SPMIS100: 
                       SPMIS110,SPMIS120,SPMIS130,SPMIS140,SPMIS150:
                       SPMIS160,SPMIS170,SPMIS180,SPMIS190,SPMIS200:
                       SPMIS210,SPMIS220,SPMIS230,SPMIS240,SPMIS250:
                       SPMIS260,SPMIS270,SPMIS280,SPMIS290,SPMIS300:
                       SPMIS310,SPMIS320,SPMIS330,SPMIS340,SPMIS350:
                       SPMIS360,SPMIS370,SPMIS380,SPMIS390,SPMIS400:
                       SPMIS410,SPMIS420,SPMIS430,SPMIS440,SPMIS450:
                       SPMIS460,SPMIS470,SPMIS480,SPMIS490,SPMIS500:
                       SPMIS510,SPMIS520,SPMIS530,SPMIS540,SPMIS550:
                       SPMIS560,SPMIS570,SPMIS580,SPMIS590,SPMIS600:
                       SPMIS610,SPMIS620,SPMIS630,SPMIS640,SPMIS650:
                       SPMIS660,SPMIS670,SPMIS680,SPMIS690,SPMIS700:
                       SPMIS710,SPMIS720,SPMIS730  
.                      
          MOVE      ONE,EXIT
          GOTO      SPMIS999
.
SPMIS010  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMIS001,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMIS900
SPMIS020  MOVE      QRYDATA,PTMIS002
          GOTO      SPMIS900
SPMIS030  MOVE      QRYDATA,PTMIS003
          GOTO      SPMIS900
SPMIS040  MOVE      QRYDATA,PTMIS004
          GOTO      SPMIS900
SPMIS050  MOVE      QRYDATA,PTMIS005
          GOTO      SPMIS900
SPMIS060  MOVE      QRYDATA,PTMIS006
          GOTO      SPMIS900
SPMIS070  MOVE      QRYDATA,PTMIS007
          MOVE      ONE,CHGATYP
          GOTO      SPMIS900
SPMIS080  MOVE      QRYDATA,PTMIS008
          GOTO      SPMIS900
SPMIS090  MOVE      QRYDATA,PTMIS009
          GOTO      SPMIS900
SPMIS100  MOVE      QRYDATA,PTMIS010
          GOTO      SPMIS900
SPMIS110  MOVE      QRYDATA,PTMIS011
          GOTO      SPMIS900
SPMIS120  MOVE      QRYDATA,PTMIS012
          GOTO      SPMIS900
SPMIS130  MOVE      QRYDATA,PTMIS013
          GOTO      SPMIS900
SPMIS140  MOVE      QRYDATA,PTMIS014
          GOTO      SPMIS900
SPMIS150  MOVE      QRYDATA,PTMIS015
          GOTO      SPMIS900
SPMIS160  MOVE      QRYDATA,PTMIS016
          GOTO      SPMIS900
SPMIS170  MOVE      QRYDATA,PTMIS017
          GOTO      SPMIS900
SPMIS180  MOVE      QRYDATA,PTMIS018
          GOTO      SPMIS900
SPMIS190  MOVE      QRYDATA,PTMIS019
          GOTO      SPMIS900
SPMIS200  MOVE      QRYDATA,PTMIS020
          GOTO      SPMIS900
SPMIS210  MOVE      QRYDATA,PTMIS021
          GOTO      SPMIS900
SPMIS220  MOVE      QRYDATA,PTMIS022
          GOTO      SPMIS900
SPMIS230  MOVE      QRYDATA,PTMIS023
          GOTO      SPMIS900
SPMIS240  MOVE      QRYDATA,PTMIS024
          GOTO      SPMIS900
SPMIS250  MOVE      QRYDATA,PTMIS025
          GOTO      SPMIS900
SPMIS260  MOVE      QRYDATA,PTMIS026
          GOTO      SPMIS900
SPMIS270  MOVE      QRYDATA,PTMIS027
          GOTO      SPMIS900
SPMIS280  MOVE      QRYDATA,PTMIS028
          GOTO      SPMIS900
SPMIS290  MOVE      QRYDATA,PTMIS029
          GOTO      SPMIS900
SPMIS300  MOVE      QRYDATA,PTMIS030
          GOTO      SPMIS900
SPMIS310  MOVE      QRYDATA,PTMIS031
          GOTO      SPMIS900
SPMIS320  MOVE      QRYDATA,PTMIS032
          GOTO      SPMIS900
SPMIS330  MOVE      QRYDATA,PTMIS033
          GOTO      SPMIS900
SPMIS340  MOVE      QRYDATA,PTMIS034
          GOTO      SPMIS900
SPMIS350  MOVE      QRYDATA,PTMIS035
          GOTO      SPMIS900
SPMIS360  MOVE      QRYDATA,PTMIS036
          GOTO      SPMIS900
SPMIS370  MOVE      QRYDATA,PTMIS037
          GOTO      SPMIS900
SPMIS380  MOVE      QRYDATA,PTMIS038
          GOTO      SPMIS900
SPMIS390  MOVE      QRYDATA,PTMIS039
          GOTO      SPMIS900
SPMIS400  MOVE      QRYDATA,PTMIS040
          GOTO      SPMIS900
SPMIS410  MOVE      QRYDATA,PTMIS041
          GOTO      SPMIS900
SPMIS420  MOVE      QRYDATA,PTMIS042
          GOTO      SPMIS900
SPMIS430  MOVE      QRYDATA,PTMIS043
          GOTO      SPMIS900
SPMIS440  MOVE      QRYDATA,PTMIS044
          GOTO      SPMIS900
SPMIS450  MOVE      QRYDATA,PTMIS045
          GOTO      SPMIS900
SPMIS460  MOVE      QRYDATA,PTMIS046
          GOTO      SPMIS900
SPMIS470  MOVE      QRYDATA,PTMIS047
          GOTO      SPMIS900
SPMIS480  MOVE      QRYDATA,PTMIS048
          GOTO      SPMIS900
SPMIS490  MOVE      QRYDATA,PTMIS049
          GOTO      SPMIS900
SPMIS500  MOVE      QRYDATA,PTMIS050
          GOTO      SPMIS900
SPMIS510  SQUEEZE   QRYDATA                                           *C-214541
          IF        @EOS
            MOVE      SP6,PTMIS051        * PTMIS051 is blank
          ELSE
            MOVE      ZERO,FORM6
            MOVE      QRYDATA,FORM6
            MOVE      FORM6,PTMIS051
          ENDIF                                                 * end *C-214541
          GOTO      SPMIS900
SPMIS520  MOVE      QRYDATA,PTMIS052
          GOTO      SPMIS900
SPMIS530  MOVE      QRYDATA,PTMIS053
          GOTO      SPMIS900
SPMIS540  MOVE      QRYDATA,PTMIS054
          GOTO      SPMIS900
SPMIS550  MOVE      QRYDATA,PTMIS055
          GOTO      SPMIS900
SPMIS560  MOVE      QRYDATA,PTMIS056
          GOTO      SPMIS900
SPMIS570  MOVE      QRYDATA,PTMIS057
          GOTO      SPMIS900
SPMIS580  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMIS058,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMIS900
SPMIS590  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTMIS059,CCENT,CYEAR,CMON,CDAY
          GOTO      SPMIS900
SPMIS600  MOVE      QRYDATA,PTMIS060
          GOTO      SPMIS900
SPMIS610  MOVE      QRYDATA,PTMIS061
          GOTO      SPMIS900
SPMIS620  MOVE      QRYDATA,PTMIS062
          GOTO      SPMIS900
SPMIS630  MOVE      QRYDATA,PTMIS063
          GOTO      SPMIS900
SPMIS640  MOVE      QRYDATA,PTMIS064
          GOTO      SPMIS900
SPMIS650  MOVE      QRYDATA,PTMIS065
          GOTO      SPMIS900
SPMIS660  MOVE      QRYDATA,PTMIS066
          GOTO      SPMIS900
SPMIS670  MOVE      QRYDATA,PTMIS067
          GOTO      SPMIS900
SPMIS680  MOVE      QRYDATA,PTMIS068
          GOTO      SPMIS900
SPMIS690  MOVE      QRYDATA,PTMIS069
          GOTO      SPMIS900
SPMIS700  MOVE      QRYDATA,PTMIS070
          GOTO      SPMIS900
SPMIS710  MOVE      QRYDATA,PTMIS071
          GOTO      SPMIS900
SPMIS720  MOVE      QRYDATA,PTMIS072
          GOTO      SPMIS900
SPMIS730  MOVE      QRYDATA,PTMIS073
          GOTO      SPMIS900
.
SPMIS900  MOVE      ONE,MISUPDFL
.
SPMIS999  RETURN
.------------------------------------------------------------
. Generate New U/R
.------------------------------------------------------------
GENUR000  MOVE      NMPNUMB,SNMPNUMB        * save mothers NMPI Number
          MOVE      PURNO,SAVURNO           * Save the mothers U/R Number
          MOVE      SP20,NMPNUMB            * clear NMPI number
.
          MOVE      FOUR,CPSYSTEM           * Using New Born U/R Range
          CALL      GNXTUR                  * Generate a new U/R Number
.
          MOVE      PURNO,BURNO             * baby U/R Number 
          MOVE      NMPNUMB,BNMPNUMB        * baby NMPI Number
          MOVE      SAVURNO,PURNO           * Restore the mothers U/R Number
          MOVE      SNMPNUMB,NMPNUMB        * Restore the mothers NMPI Number
          MOVE      BURNO,SAVURNO           * Save the babys U/R Number
.
GENUR999  RETURN
.------------------------------------------------------------
. Update Master Details
.------------------------------------------------------------
UPDMAS00  MATCH     PTMAS001,Z70
          IF        !@EQUAL
            MOVE      PTMAS001,PTITL
          ENDIF
.
          COMPARE   PTMAS002,ZERO
          IF        !@EQUAL
            MOVE      PTMAS002,PHOSP
          ENDIF
.
          COMPARE   PTMAS003,ZERO
          IF        !@EQUAL
            MOVE      PTMAS003,PLDAYS
          ENDIF
.
          COMPARE   PTMAS004,ZERO
          IF        !@EQUAL
            MOVE      PTMAS004,PBDEBT
          ENDIF
.
          MATCH     PTMAS005,Z70
          IF        !@EQUAL
            PACK      PSNAME,PTMAS005,SP70
            PACK      PTMASNAM,PTMAS005,SP70
          ENDIF
.
          MATCH     PTMAS006,Z70
          IF        !@EQUAL
            PACK      PGNAME,PTMAS006,SP70
          ENDIF
.
          MATCH     PTMAS007,Z70
          IF        !@EQUAL
            PACK      PPSNAME,PTMAS007,SP70
          ENDIF
.
          MATCH     PTMAS008,Z70
          IF        !@EQUAL
            MOVE      PTMAS008,PADD1
          ENDIF
.
          MATCH     PTMAS009,Z70
          IF        !@EQUAL
            MOVE      PTMAS009,PADD2
          ENDIF
.
          MATCH     PTMAS010,Z70
          IF        !@EQUAL
            MOVE      PTMAS010,PSUBRB
          ENDIF
.
          MATCH     PTMAS011,Z70
          IF        !@EQUAL
            MOVE      PTMAS011,PADD4
          ENDIF
.
          MATCH     PTMAS012,Z70
          IF        !@EQUAL
            MOVE      PTMAS012,PPOST
          ENDIF
.
          MATCH     PTMAS013,Z70
          IF        !@EQUAL
            MOVE      PTMAS013,PTELEP
          ENDIF
.
          MATCH     PTMAS014,Z70
          IF        !@EQUAL
            MOVE      PTMAS014,PTELEB
          ENDIF
.
          MATCH     PTMAS015,Z70
          IF        !@EQUAL
            MOVE      PTMAS015,PSEX
          ENDIF
.
          MATCH     PTMAS016,Z70
          IF        !@EQUAL
            MOVE      PTMAS016,PMSTAT
          ENDIF
.
          MATCH     PTMAS017,Z70
          IF        !@EQUAL
            MOVE      PTMAS017,PBDATE
          ENDIF
.
          COMPARE   PTMAS018,ZERO
          IF        !@EQUAL
            MOVE      PTMAS018,PSAGE
          ENDIF
.
          MATCH     PTMAS019,Z70
          IF        !@EQUAL
            MOVE      PTMAS019,PCONT
          ENDIF
.
          MATCH     PTMAS020,Z70
          IF        !@EQUAL
            MOVE      PTMAS020,PREG
          ENDIF
.
          MATCH     PTMAS021,Z70
          IF        !@EQUAL
            MOVE      PTMAS021,PTYPE
          ENDIF
.
          MATCH     PTMAS022,Z70
          IF        !@EQUAL
            MOVE      PTMAS022,POCCUP
          ENDIF
.
          MATCH     PTMAS023,Z70
          IF        !@EQUAL
            MOVE      PTMAS023,PMEDI
          ENDIF
.
          MATCH     PTMAS024,Z70
          IF        !@EQUAL
            MOVE      PTMAS024,PPENNO
          ENDIF
.
          MATCH     PTMAS025,Z70
          IF        !@EQUAL
            MOVE      PTMAS025,PPNDTE
          ENDIF
.
          MATCH     PTMAS026,Z70
          IF        !@EQUAL
            MOVE      PTMAS026,PREPAT
          ENDIF
.
          COMPARE   PTMAS027,ZERO
          IF        !@EQUAL
            MOVE      PTMAS027,PSMOK
          ENDIF
.
          MATCH     PTMAS028,Z70
          IF        !@EQUAL
            MOVE      PTMAS028,PMICRO
          ENDIF
.
          COMPARE   PTMAS029,ZERO
          IF        !@EQUAL
            MOVE      PTMAS029,PCEASE
          ELSE
            MOVE      ZERO,PCEASE
          ENDIF
.
          COMPARE   PTMAS030,ZERO
          IF        !@EQUAL
            MOVE      PTMAS030,PCASE
          ENDIF
.
          COMPARE   PTMAS031,ZERO
          IF        !@EQUAL
            MOVE      PTMAS031,PAUTOPY
          ELSE
            MOVE      ZERO,PAUTOPY
          ENDIF
.
          MATCH     PTMAS032,Z70
          IF        !@EQUAL
            MOVE      PTMAS032,PHIGH1
          ENDIF
.
          MATCH     PTMAS033,Z70
          IF        !@EQUAL
            MOVE      PTMAS033,PHIGH2
          ENDIF
.
          MATCH     PTMAS034,Z70
          IF        !@EQUAL
            MOVE      PTMAS034,PHIGH3
          ENDIF
.
          MATCH     PTMAS035,Z70
          IF        !@EQUAL
            MOVE      PTMAS035,PLOCDOC
          ENDIF
.
          MATCH     PTMAS036,Z70
          IF        !@EQUAL
            MOVE      PTMAS036,PFUNDH
          ENDIF
.
          MATCH     PTMAS037,Z70
          IF        !@EQUAL
            MOVE      PTMAS037,PFNDTB
          ENDIF
.
          MATCH     PTMAS038,Z70
          IF        !@EQUAL
            MOVE      PTMAS038,PFNDMM
          ENDIF
.
          MATCH     PTMAS039,Z70
          IF        !@EQUAL
            MOVE      PTMAS039,PUSR1
          ENDIF
.
          MATCH     PTMAS040,Z70
          IF        !@EQUAL
            MOVE      PTMAS040,PUSR2
          ENDIF
.
          MATCH     PTMAS041,Z70
          IF        !@EQUAL
            MOVE      PTMAS041,PUSR3
          ENDIF
.
          MATCH     PTMAS042,Z70
          IF        !@EQUAL
            MOVE      PTMAS042,PUSR4
          ENDIF
.
          MATCH     PTMAS043,Z70
          IF        !@EQUAL
            MOVE      PTMAS043,PUSR5
          ENDIF
.
          MATCH     PTMAS044,Z70
          IF        !@EQUAL
            MOVE      PTMAS044,PUSR6
          ENDIF
.
          COMPARE   PTMAS045,ZERO
          IF        !@EQUAL
            MOVE      PTMAS045,PUYN1
          ENDIF
.
          COMPARE   PTMAS046,ZERO
          IF        !@EQUAL
            MOVE      PTMAS046,PUYN2
          ENDIF
.
          COMPARE   PTMAS047,ZERO
          IF        !@EQUAL
            MOVE      PTMAS047,PUYN3
          ENDIF
.
          MATCH     PTMAS048,Z70
          IF        !@EQUAL
            MOVE      PTMAS048,PYRRES
          ENDIF
.
          MATCH     PTMAS049,Z70
          IF        !@EQUAL
            MOVE      PTMAS049,PNKNAME
          ENDIF
.
          MATCH     PTMAS050,Z70
          IF        !@EQUAL
            MOVE      PTMAS050,PNKADD1
          ENDIF
.
          MATCH     PTMAS051,Z70
          IF        !@EQUAL
            MOVE      PTMAS051,PNKADD2
          ENDIF
.
          MATCH     PTMAS052,Z70
          IF        !@EQUAL
            MOVE      PTMAS052,PNKSUBR
          ENDIF
.
          MATCH     PTMAS053,Z70
          IF        !@EQUAL
            MOVE      PTMAS053,PNKADD4
          ENDIF
.
          MATCH     PTMAS054,Z70
          IF        !@EQUAL
            MOVE      PTMAS054,PNKPOST
          ENDIF
.
          MATCH     PTMAS055,Z70
          IF        !@EQUAL
            MOVE      PTMAS055,PNKTELP
          ENDIF
.
          MATCH     PTMAS056,Z70
          IF        !@EQUAL
            MOVE      PTMAS056,PNKTELB
          ENDIF
.
          MATCH     PTMAS057,Z70
          IF        !@EQUAL
            MOVE      PTMAS057,PNKRELP
          ENDIF
.
          COMPARE   PTMAS058,ZERO
          IF        !@EQUAL
            MOVE      PTMAS058,PNXRAY
          ENDIF
.
          MATCH     PTMAS059,Z70
          IF        !@EQUAL
            MOVE      PTMAS059,PFNDYY
          ENDIF
.
          MATCH     PTMAS060,Z70
          IF        !@EQUAL
            MOVE      PTMAS060,PFNDCG
          ENDIF
.
          MATCH     PTMAS061,Z70
          IF        !@EQUAL
            MOVE      PTMAS061,PDECDTE
          ENDIF
.
          MATCH     PTMAS062,Z70
          IF        !@EQUAL
            MOVE      PTMAS062,PDIET
          ENDIF
.
          MATCH     PTMAS063,Z70
          IF        !@EQUAL
            MOVE      PTMAS063,PINITHOS
          ENDIF
.
          MATCH     PTMAS064,Z70
          IF        !@EQUAL
            MOVE      PTMAS064,PTMAEMPC
          ENDIF
.
          MATCH     PTMAS065,Z70
          IF        !@EQUAL
            MOVE      PTMAS065,PTMANOKO
          ENDIF
.
          MATCH     PTMAS066,Z70
          IF        !@EQUAL
            MOVE      PTMAS066,PTMANOKE
          ENDIF
.
          MATCH     PTMAS067,ANSY
          IF        @EQUAL
            MOVE     ANSY,PTMAUKDD
            MOVE     ONE,PCEASE
          ELSE
            MOVE     ANSN,PTMAUKDD
          ENDIF
.
          CALL      UPMSX000                * Update Master File Extension
.
          MATCH     Z70,PTMAS068
          IF        !@EQUAL
            READ      CONTROLF,EIGHTY8;*237,PTCNEMPL
            MOVE      SP10,ACODE
            MOVE      ZERO,FORM1
            UNPACK    SP2,DIM1,DIM1A
            UNPACK    PTCNEMPL,DIM1,DIM1A
            MOVE      DIM1A,FORM1
            MATCH     ANSU,DIM1
            IF        @EQUAL
              STORE     PTMAS068,FORM1,AUSR1,AUSR2,AUSR3,AUSR4,AUSR5,AUSR6,AUSR7
            ENDIF
.
            MATCH     ANSP,DIM1
            IF        @EQUAL
              STORE     PTMAS068,FORM1,PUSR1,PUSR2,PUSR3,PUSR4,PUSR5,PUSR6
            ENDIF
          ENDIF
.
          MATCH     Z70,PTMAS069
          IF        !@EQUAL
            MATCH     PTMAS069,PTMADCDT
            IF        !@EQUAL
              PACK      PTMADCUD,CCC,CYY,CMM,CDD * Set demographics confirmed
              REP       " 0",PTMADCUD            * updated by date,time and user
              CLOCK     TIME,PTMADCUT
              MOVE      USERID,PTMADCUU
            ENDIF
.
            MATCH     "1",CONFDEMO
            IF        @EQUAL
              PACK      KEY8,CCC,CYY,CMM,CDD
              REP       " 0",KEY8
              MATCH     KEY8,PTMAS069              * Today
              IF        @EQUAL
                PACK      PTMADCUD,CCC,CYY,CMM,CDD * Set demographics confirmed
                REP       " 0",PTMADCUD            * updated by date,time user
                CLOCK     TIME,PTMADCUT
                MOVE      USERID,PTMADCUU
              ENDIF
            ENDIF
.
            PACK      PTMADCDT,PTMAS069,SP70
          ENDIF
.
UPDMAS99  RETURN
.------------------------------------------------------------
.         UPMSX000  Update master file extension vars
.------------------------------------------------------------
UPMSX000  MATCH     Z70,PTMSX001
          IF        !@EQUAL
            MOVE      PTMSX001,PTMXRDAT
          ENDIF
.
          MATCH     Z70,PTMSX002
          IF        !@EQUAL
            MOVE      PTMSX002,PTMXMEAL
          ENDIF
.
          MATCH     Z70,PTMSX003
          IF        !@EQUAL
            MOVE      PTMSX003,PTMXLGA
          ENDIF
.
          MATCH     Z70,PTMSX004
          IF        !@EQUAL
            MOVE      PTMSX004,PTMXLS
          ENDIF
.
          MATCH     Z70,PTMSX005
          IF        !@EQUAL
            MOVE      PTMSX005,PTMXLSDT
          ENDIF
.
          MATCH     Z70,PTMSX006
          IF        !@EQUAL
            MOVE      PTMSX006,PTMXFHMD
          ENDIF
.
          MATCH     Z70,PTMSX007
          IF        !@EQUAL
            MOVE      PTMSX007,PTMXMHU1
          ENDIF
.
          MATCH     Z70,PTMSX008
          IF        !@EQUAL
            MOVE      PTMSX008,PTMXMHU2
          ENDIF
.
          MATCH     Z70,PTMSX009
          IF        !@EQUAL
            MOVE      PTMSX009,PTMXMHU3
          ENDIF
.
          MATCH     Z70,PTMSX010
          IF        !@EQUAL
            MOVE      PTMSX010,PTMXECNM
          ENDIF
.
          MATCH     Z70,PTMSX011
          IF        !@EQUAL
            MOVE      PTMSX011,PTMXECA1
          ENDIF
.
          MATCH     Z70,PTMSX012
          IF        !@EQUAL
            MOVE      PTMSX012,PTMXECA2
          ENDIF
.
          MATCH     Z70,PTMSX013
          IF        !@EQUAL
            MOVE      PTMSX013,PTMXECA3
          ENDIF
.
          MATCH     Z70,PTMSX014
          IF        !@EQUAL
            MOVE      PTMSX014,PTMXECA4
          ENDIF
.
          MATCH     Z70,PTMSX015
          IF        !@EQUAL
            MOVE      PTMSX015,PTMXECPC
          ENDIF
.
          MATCH     Z70,PTMSX016
          IF        !@EQUAL
            MOVE      PTMSX016,PTMXECPP
          ENDIF
.
          MATCH     Z70,PTMSX017
          IF        !@EQUAL
            MOVE      PTMSX017,PTMXECBP
          ENDIF
.
          MATCH     Z70,PTMSX018
          IF        !@EQUAL
            MOVE      PTMSX018,PTMXECRE
          ENDIF
.
          MATCH     Z70,PTMSX019
          IF        !@EQUAL
            MOVE      PTMSX019,PTMXNRNM
          ENDIF
.
          MATCH     Z70,PTMSX020
          IF        !@EQUAL
            MOVE      PTMSX020,PTMXNRA1
          ENDIF
.
          MATCH     Z70,PTMSX021
          IF        !@EQUAL
            MOVE      PTMSX021,PTMXNRA2
          ENDIF
.
          MATCH     Z70,PTMSX022
          IF        !@EQUAL
            MOVE      PTMSX022,PTMXNRA3
          ENDIF
.
          MATCH     Z70,PTMSX023
          IF        !@EQUAL
            MOVE      PTMSX023,PTMXNRA4
          ENDIF
.
          MATCH     Z70,PTMSX024
          IF        !@EQUAL
            MOVE      PTMSX024,PTMXNRPC
          ENDIF
.
          MATCH     Z70,PTMSX025
          IF        !@EQUAL
            MOVE      PTMSX025,PTMXNRPP
          ENDIF
.
          MATCH     Z70,PTMSX026
          IF        !@EQUAL
            MOVE      PTMSX026,PTMXNRBP
          ENDIF
.
          MATCH     Z70,PTMSX027
          IF        !@EQUAL
            MOVE      PTMSX027,PTMXNRRE
          ENDIF
.
          MATCH     Z70,PTMSX028
          IF        !@EQUAL
            MOVE      PTMSX028,PTMX3BEX
          ENDIF
.
          MATCH     Z70,PTMSX029
          IF        !@EQUAL
            MOVE      PTMSX029,PTMXCARD
          ENDIF
.
          MATCH     Z70,PTMSX030
          IF        !@EQUAL
            MOVE      PTMSX030,PTMXCEXP
          ENDIF
.
          MATCH     Z70,PTMSX031
          IF        !@EQUAL
            MOVE      PTMSX031,PTMXCXMP
          ENDIF
.
          MATCH     Z70,PTMSX032
          IF        !@EQUAL
            MOVE      PTMSX032,PTMXFMLY
          ENDIF
.
          MATCH     Z70,PTMSX033
          IF        !@EQUAL
            MOVE      PTMSX033,PTMXDOFR
          ENDIF
.
          MATCH     Z70,PTMSX034
          IF        !@EQUAL
            MOVE      PTMSX034,PTMXREGP
          ENDIF
.
          MATCH     Z70,PTMSX035
          IF        !@EQUAL
            MOVE      PTMSX035,PTMXGPPC
          ENDIF
.
          MATCH     Z70,PTMSX036
          IF        !@EQUAL
            MOVE      PTMSX036,PTMXSPID
          ENDIF
.
          MATCH     Z70,PTMSX037
          IF        !@EQUAL
            MOVE      PTMSX037,PTMXGPPT
          ENDIF
.
          MATCH     Z70,PTMSX038
          IF        !@EQUAL
            MOVE      PTMSX038,PTMXUKDO
          ENDIF
.
          MATCH     Z70,PTMSX039
          IF        !@EQUAL
            MOVE      PTMSX039,PTMXCELL
          ENDIF
.
          MATCH     Z70,PTMSX040
          IF        !@EQUAL
            MOVE      PTMSX040,PTMXADD1
          ENDIF
.
          MATCH     Z70,PTMSX041
          IF        !@EQUAL
            MOVE      PTMSX041,PTMXADD2
          ENDIF
.
          MATCH     Z70,PTMSX042
          IF        !@EQUAL
            MOVE      PTMSX042,PTMXADD3
          ENDIF
.
          MATCH     Z70,PTMSX043
          IF        !@EQUAL
            MOVE      PTMSX043,PTMXADD4
          ENDIF
.
          MATCH     Z70,PTMSX044
          IF        !@EQUAL
            MOVE      PTMSX044,PTMXPOST
          ENDIF
.
          MATCH     Z70,PTMSX045
          IF        !@EQUAL
            MOVE      PTMSX045,PTMXMCCD
          ENDIF
.
          MATCH     Z70,PTMSX047
          IF        !@EQUAL
            MOVE      PTMSX047,PTMXDEAF
          ENDIF
.
          MATCH     Z70,PTMSX048
          IF        !@EQUAL
            MOVE      PTMSX048,PTMXSLAC
          ENDIF
.
          MATCH     Z70,PTMSX049
          IF        !@EQUAL
            MOVE      PTMSX049,PTMXDEAF
          ENDIF
.
          MATCH     Z70,PTMSX050
          IF        !@EQUAL
            MOVE      PTMSX050,PTMXOSMS
          ENDIF
.
          MATCH     Z70,PTMSX051
          IF        !@EQUAL
            MOVE      PTMSX051,PTMXESPF
          ENDIF
.
          MATCH     Z70,PTMSX046
          IF        !@EQUAL
            MOVE      PTMSX046,PTMXSPAR
          ENDIF
.
UPMSX999  RETURN
.------------------------------------------------------------
. Write a new record to U/R alteration audit file
. If NHI/MWS system in use this is already performed in IBANHI01
.------------------------------------------------------------
URALT000  BRANCH    PTCNNHII,URALT999
.
          COMPARE   ONE,CPMIAD
          GOTO      URALT990 IF NOT EQUAL    
.
          MOVE      ANSA,URRTYPE
          PACK      URDATE,CCC,CYY,CMM,CDD
          REP       " 0",URDATE
          MOVE      PURNO,URURNO
          MOVE      THREE,URSYST
          MOVE      SP10,URSPARE
          PACK      KEY17,URRTYPE,URDATE,URURNO
          CALL      RDAURAD1
          IF        OVRCD=1
            CALL      WRURAD1
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      URALT999
.
URALT990  MOVE      ONE,EXIT
.
URALT999  RETURN
.------------------------------------------------------------
. Write to surname index file
.------------------------------------------------------------
.
SURNF000  CALL      NEWS0000                * New Surname file
.          
SURNF999  RETURN 
.------------------------------------------------------------
. Routine to handle new surname file
.------------------------------------------------------------
NEWS0000  MOVE      PTMASNAM,GSRSNAM
          MOVE      PMPXFNAM,GSRGNAM
          MOVE      PMPXSNAM,PTGSGNM2
          MOVE      PURNO,GSRURNO
          MOVE      ZEROVISN,GSRBILL
          MOVE      ZERO,GSRSYS
          MOVE      PBDATE,GSRDOB
          MOVE      PSEX,GSRSEX
          CALL      SOUNDEX                 * get soundex key for surname
          CALL      SOUNDX2                 * get soundex key for given names
.
          PACK      KEY115,GSRURNO,GSRBILL,GSRSNAM,GSRGNAM,PTGSGNM2,GSRDOB:
                           GSRSEX
          CALL      RDPTGSR1                * check if its already there
          BRANCH    OVRCD,NEWS1000
          GOTO      NEWS9999
.
NEWS1000  CALL      WRPTGSR1
NEWS9999  RETURN
.------------------------------------------------------------
. Dummy Labels so the program will compile with certain includes
.------------------------------------------------------------
PATCODDS  RETURN
.------------------------------------------------------------
.    Save master fields
.------------------------------------------------------------
ACTMSAV   MOVE      PMICRO,SPMICRO
          MOVE      PUSR1,SPUSR1
          MOVE      PUSR2,SPUSR2
          MOVE      PUSR3,SPUSR3
          MOVE      PUSR4,SPUSR4
          MOVE      PUSR5,SPUSR5
          MOVE      PUSR6,SPUSR6
          MOVE      PUYN1,SPUYN1
          MOVE      PUYN2,SPUYN2
          MOVE      PUYN3,SPUYN3
.
          MOVE      PURNO,SPURNO
          MOVE      PTITL,SPTITL
          MOVE      PSNAME,SPSNAME
          MOVE      PGNAME,SPGNAME
          MOVE      PPSNAME,SPPSNAME
          MOVE      PADD1,SPADD1
          MOVE      PADD2,SPADD2
          MOVE      PSUBRB,SPSUBRB
          MOVE      PPOST,SPPOST
          MOVE      PTELEP,SPTELEP
          MOVE      PTELEB,SPTELEB
          MOVE      PTMXDOFR,SPDOR
          MOVE      PSEX,SPSEX
          MOVE      PMSTAT,SPMSTAT
          MOVE      PBDATE,SPBDATE
          MOVE      PSAGE,SPSAGE
          MOVE      PCONT,SPCONT
          MOVE      PREG,SPREG
          MOVE      PTYPE,SPTYPE
          MOVE      POCCUP,SPOCCUP
          MOVE      PMEDI,SPMEDI
          MOVE      PPENNO,SPPENNO
          MOVE      PPNDTE,SPPNDTE
          MOVE      PREPAT,SPREPAT
          MOVE      PSMOK,SPSMOK
.
.-------- Save Community Card Details ---------------------------------
.
          MOVE      PTMXCARD,SPCARD
          MOVE      PTMXCEXP,SPCEXP
          MOVE      PTMXCXMP,SPCXMP
          MOVE      PTMXFMLY,SPFMLY
.
          MOVE      PNKNAME,SPNKNAME
          MOVE      PNKADD1,SPNKADD1
          MOVE      PNKADD2,SPNKADD2
          MOVE      PNKSUBR,SPNKSUBR
          MOVE      PNKPOST,SPNKPOST
          MOVE      PNKTELP,SPNKTELP
          MOVE      PNKTELB,SPNKTELB
          MOVE      PNKRELP,SPNKRELP
          RETURN
.
GETSVAR   RETURN                    * dummy routine for change U/R
WERR0000  RETURN                    * dummy routine for change U/R
.
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      PREDIR00
          GOTO      NXTPAG99
.
NXTPAG30  CALL      PARDIR00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent Parent URL
.------------------------------------------------------------------------------
PARDIR00  CALL      OPENHTML
          BRANCH    EXIT,PARDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PARDIR99
.
PARDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PARDIR99  RETURN
.------------------------------------------------------------
. Write new Temporary number to nhimasaf
.------------------------------------------------------------
TMPNHI00  MOVE      NZIBNMPI,KEY7
          MOVE      NZIBNMPI,NHMANMPI
          PACK      NHMAURNO,SP1,NZIBNMPI
.
          PACK      KEY8,NHMAURNO,SP70
          CALL      RANHMAS2
          IF        OVRCD=0
            CLEAR     WEBTITLE
            APPEND    "ERROR: Local UR ",WEBTITLE
            APPEND    KEY8,WEBTITLE
            APPEND    " Already Exists. - ",WEBTITLE
            RESET     WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
            GOTO      TMPNHI99
          ENDIF
.
          CALL      RANHMAS1
          IF        OVRCD=1
            CALL      MVNHI000
            CLOCK     TIME,NHMATIM
            PACK      NHMADAT,CCC,CYY,CMM,CDD
            REP       " 0",NHMADAT
            CALL      WRNHMAS1      * Got there now write the record.
            MOVE      ONE,AUDTTYPE
            CALL      WANHMA00
          ELSE
            CLEAR     WEBTITLE
            APPEND    "ERROR: NHI HCU ID ",WEBTITLE
            APPEND    KEY7,WEBTITLE
            APPEND    " Already Exists. - ",WEBTITLE
            RESET     WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
            GOTO      TMPNHI99
          ENDIF
.
TMPNHI99  RETURN
.------------------------------------------------------------
. Move NHI parameters for nhimasaf
.------------------------------------------------------------
MVNHI000  MOVE      PSNAME,NHMASURN
          MOVE      PGNAME,NHMAGIV1
          MOVE      PPSNAME,NHMAGIV2
          MOVE      SP70,NHMAGIV3
          MOVE      ONE,NHMAPREI
          MOVE      PADD1,NHMAADD1
          MOVE      PADD2,NHMAADD2
          MOVE      PSUBRB,NHMAADD3
          MOVE      PADD4,NHMAADD4
          MOVE      SP70,NHMAADD5
          MOVE      PBDATE,NHMADOB
          IF        PCEASE=0
            MOVE      SP70,NHMADDTH
          ELSE
            MOVE      PDECDTE,NHMADDTH
          ENDIF
          MOVE      SP70,NHMADOMC
          MOVE      "Y",NHMARES
          MOVE      PSEX,NHMASEX
          MOVE      "00",NHMAETH
          MOVE      SP70,NHMAETH2
          MOVE      SP70,NHMAETH3
.
MVNHI999  RETURN
+
.------------------------------------------------------------
. Format mothers first name                             
.------------------------------------------------------------
MOTNAM00  SCAN      SP1,PGNAME               * Locate the first blank
          GOTO      MOTNAM10 IF NOT EQUAL
.
          BUMP      PGNAME,-1                * go back 1 to end of name
          MOVEFPTR  PGNAME,CCITEM
          RESET     PGNAME                   * reset the form pointer
          SETLPTR   PGNAME,CCITEM            * set logical length to end of name
.
MOTNAM10  PACK      MOTFNAME,PGNAME,SP1,PSNAME
          RESET     PGNAME
.
MOTNAM99  RETURN
+
.******************************************************************************
.*                           UPRES000                    Called by : UPMAD000 *
.*            Update/write residency details                                  *
.******************************************************************************
.         
UPRES000  PACK      KEY8,PURNO,SP70
.
          CALL      RDPMRES1
          BRANCH    OVRCD,UPRES100
.
          CALL      MVPMSRES
          PACK      PMRSUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMRSUDAT
          CLOCK     TIME,PMRSUTIM
          MOVE      USERID,PMRSUUID

          CALL      UPPMRES1
          GOTO      UPRES999
.         
UPRES100  CALL      CLPMSRES
          CALL      MVPMSRES
          PACK      PMRSCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMRSCDAT
          CLOCK     TIME,PMRSCTIM
          MOVE      USERID,PMRSCUID
.
          PACK      KEY8,PURNO,SP70
          CALL      WRPMRES1
.
UPRES999  RETURN
.
+
MVPMSRES  PACK      PMRSURNO,PURNO,SP70
          MATCH     Z70,PMRES001
          IF        !@EQUAL
            PACK      PMRSCONT,PMRES001,SP70
          ENDIF
          MATCH     Z70,PMRES002
          IF        !@EQUAL
            PACK      PMRSTEXP,PMRES002,SP70
          ENDIF
          MATCH     Z70,PMRES003
          IF        !@EQUAL
            PACK      PMRSGRDT,PMRES003,SP70
          ENDIF
          MATCH     Z70,PMRES004
          IF        !@EQUAL
            PACK      PMRSCOMM,PMRES004,SP70,SP70
          ENDIF
          MATCH     Z70,PMRES005
          IF        !@EQUAL
            PACK      PMRSVISN,PMRES005,SP70
          ENDIF
          MATCH     Z70,PMRES014
          IF        !@EQUAL
            PACK      PMRSVISN,PMRES014,SP70
          ENDIF
.
          RETURN
.
.******************************************************************************
.*                           CHKRES00                                         *
.*            Check if expiry warning is required                             *
.******************************************************************************
.
CHKRES00  MOVE      ZERO,EXIT
          CALL      IBACLOCK
          PACK      TODAY,CCC,CYY,CMM,CDD
          REP       " 0",TODAY
          MATCH     SP70,PTYPE
          GOTO      CHKRES99 IF EQUAL
.
          PACK      KEY5,ANST,SP1,PTYPE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CHKRES99
.
          MATCH     ANST,TCINDC3
          GOTO      CHKRES99 IF NOT EQUAL
.
          PACK      KEY8,PURNO,SP70
          CALL      RDPMRES1
          BRANCH    OVRCD,CHKRES99
.
          MATCH     TODAY,PMRSTEXP
          IF        @LESS
             MOVE     TWO,EXIT
             GOTO     CHKRES99
          ENDIF
.
          MOVE      PMRSTEXP,EXPDATE
          SUB       TCFORM6,EXPDATE
.
          MATCH     TODAY,EXPDATE
          IF        @LESS
             MOVE     ONE,EXIT
          ENDIF
.
CHKRES99  RETURN
.
.------------------------------------------------------------
. Hospital Boarder WAHealth                   
.------------------------------------------------------------
BORD0000  RESET     UPDATETY
          MATCH     SP1,UPDATETY
          GOTO      BORD0040 IF EQUAL
.
          MATCH     "A",UPDATETY
          GOTO      BORD0010 IF EQUAL
.
          MATCH     "U",UPDATETY
          GOTO      BORD0020 IF EQUAL
.
          MATCH     "C",UPDATETY
          GOTO      BORD0030 IF EQUAL
.
          MATCH     "D",UPDATETY
          GOTO      BORD0050 IF EQUAL 
.
          MATCH     "E",UPDATETY
          GOTO      BORD0060 IF EQUAL
.
          GOTO      BORD0093
.
.         ************ ADD FORMACTION ***********
.
BORD0010  CALL      MVPATBRD
.
          MATCH     SP70,PTBRLURN
          GOTO      BORD0012 IF EQUAL
.
          PACK      KEY17,PTBRLURN,SP70
          CALL      RSPTMI18
          CALL      RKPTMI18
          BRANCH    OVRCD,BORD0012
.
          MATCH     AURNO,PTBRLURN
          GOTO      BORD0012 IF NOT EQUAL
.
          MATCH     "2",DASTAT
          GOTO      BORD0099 IF EQUAL   * Currently in hospital
.
BORD0012  CALL      GUBN0000
          BRANCH    EXIT,BORD0092
.
          MOVE      URNUMBER,PTBRURNO
          MOVE      ADMISSNO,PTBRVISN
          MOVE      ONE,PTBRCNTR
          MOVE      WBSEUID,PTBRCUSR
          CALL      IBACLOCK
          PACK      PTBRCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PTBRCDAT
          CLOCK     TIME,PTBRCTIM 
          MOVE      SP70,PTBRUUSR
          MOVE      SP70,PTBRUDAT
          MOVE      SP70,PTBRUTIM
          PACK      PTBRSPAR,SP70,SP70
.
          IF        IBCNMHOS=1
            MOVE      WBSEHOSP,PTBRHOSP 
          ENDIF
.
          PACK      KEY10,PTBRBRDN,SP70
          CALL      RDPTBRD1
          IF        OVRCD=0
            GOTO      BORD9999
          ENDIF
.
          CALL      WRPTBRD1
.
          MOVE      ZERO,EXIT
          GOTO      BORD9999
.
.         ************ UPDATE FORMACTION ***********
.
BORD0020  PACK      KEY10,BORDUNIQ,SP70
          CALL      RDPTBRD1
          BRANCH    OVRCD,BORD0091
.
          MOVE      PTBRD006,PTBRSNAM
          MOVE      PTBRD007,PTBRGNAM
          MOVE      PTBRD008,PTBRGEND
          MOVE      PTBRD009,PTBRBDAT
          MOVE      PTBRD010,PTBRADR1
          MOVE      PTBRD011,PTBRADR2
          MOVE      PTBRD012,PTBRADR3
          MOVE      PTBRD013,PTBRADR4
          MOVE      PTBRD014,PTBRPOST
          MOVE      PTBRD015,PTBRHPHN
          MOVE      PTBRD016,PTBRWPHN
          MOVE      PTBRD017,PTBRMPHN
          MOVE      PTBRD018,PTBREMAL
          MOVE      PTBRD020,PTBRSDAT
          MOVE      PTBRD021,PTBRSTIM
          MOVE      PTBRD022,PTBREDAT
          MOVE      PTBRD023,PTBRETIM
          MOVE      PTBRD030,PTBRTITL
.
          MOVE      WBSEUID,PTBRUUSR
          CALL      IBACLOCK
          PACK      PTBRUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PTBRUDAT
          CLOCK     TIME,PTBRUTIM
.
          PACK      KEY10,BORDUNIQ,SP70
          CALL      RAPTBRD1
          BRANCH    OVRCD,BORD0091
.
          CALL      UPPTBRD1
.
          MOVE      ZERO,EXIT
          GOTO      BORD9999
.
.         ************ COPY TO CURRENT FORMACTION ***********
.
BORD0030  PACK      KEY10,BORDUNIQ,SP70
          CALL      RDPTBRD1
          BRANCH    OVRCD,BORD0091
.
          MOVE      SP70,DIM8
          MATCH     SP70,PTBRLURN
          GOTO      BORD0035 IF EQUAL
          GOTO      BORD0035 IF EOS
.
.         Check if the Linked U/R is currently in hospital
.
          MOVE      PTBRLURN,DIM8
          PACK      KEY17,PTBRLURN,SP70
          CALL      RSPTMI18
          CALL      RKPTMI18
          BRANCH    OVRCD,BORD0032
.
          MATCH     AURNO,PTBRLURN
          GOTO      BORD0032 IF NOT EQUAL
.
          MATCH     "2",DASTAT
          GOTO      BORD0099 IF EQUAL   * Currently in hospital
.
BORD0032  PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,BORD0094
.
BORD0035  PACK      KEY17,PTBRURNO,TWO,SP70
          CALL      RSPTMI18
          CALL      RKPTMI18
          BRANCH    OVRCD,BORD0098
.
          MATCH     AURNO,PTBRURNO
          GOTO      BORD0098 IF NOT EQUAL
.
          MATCH     "2",DASTAT
          GOTO      BORD0098 IF NOT EQUAL
.
          CALL      MVPATBRD
.
          CALL      GUBN0000
          BRANCH    EXIT,BORD0092
.
          MOVE      AURNO,PTBRURNO
          MOVE      DAADMNO,PTBRVISN
          MOVE      DIM8,PTBRLURN
          MOVE      ONE,PTBRCNTR
          MOVE      WBSEUID,PTBRCUSR
          CALL      IBACLOCK
          PACK      PTBRSDAT,CCC,CYY,CMM,CDD
          REP       " 0",PTBRSDAT
          CLOCK     TIME,PTBRSTIM
          PACK      PTBRCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PTBRCDAT
          CLOCK     TIME,PTBRCTIM
          MOVE      SP70,PTBREDAT
          MOVE      SP70,PTBRETIM
          MOVE      SP70,PTBRUUSR
          MOVE      SP70,PTBRUDAT
          MOVE      SP70,PTBRUTIM
          PACK      PTBRSPAR,SP70,SP70
.
          IF        IBCNMHOS=1
            MOVE      WBSEHOSP,PTBRHOSP
          ENDIF
.
          PACK      KEY10,PTBRBRDN,SP70
          CALL      RDPTBRD1
          IF        OVRCD=0
            GOTO      BORD9999
          ENDIF
.
          CALL      WRPTBRD1
.
          MOVE      ZERO,EXIT
          GOTO      BORD9999
.
.         ************ DISPLAY FORMACTION **********
.
BORD0040  CALL      CLPATMAS                * clear master detils
          CALL      CLPMSPX2                * clear mast ext2 details
          CALL      CLPATMIS                * clear admission details
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,BORD0094 
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDDSCH1
          IF        OVRCD=1
            MOVE      SP70,DDATE
            MOVE      SP70,DTIME
          ENDIF
.
.         MATCH     "2",DASTAT
.         GOTO      BORD0096 IF NOT EQUAL
.
          MATCH     SP70,BORDURNO
          IF        !@EQUAL & !@EOS
            PACK      KEY8,BORDURNO,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BORD0097
.
            PACK      KEY8,BORDURNO,SP70
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF

            CALL      SVMTHMAS
.
.           MOVE    SP70,PTITL
.           MOVE    SP70,PSNAME
.           MOVE    SP70,PGNAME
.           MOVE    SP70,PSEX
.           MOVE    SP70,PBDATE
.           MOVE    SP70,PADD1
.           MOVE    SP70,PADD2
.           MOVE    SP70,PSUBRB
.           MOVE    SP70,PADD4
.           MOVE    SP70,PPOST
.           MOVE    SP70,PTELEP
.           MOVE    SP70,PTELEB
.           MOVE    SP70,PTMXCELL
.           MOVE    SP70,PMPXPEML
.
.           CALL    DEFBDM00
.
            MOVE    PTITL,BORDTITL
            MOVE    PSNAME,BORDSNAM
            MOVE    PGNAME,BORDGNAM
            MOVE    PSEX,BORDGEND
            MOVE    PBDATE,BORDBDAT
            MOVE    PADD1,BORDADR1
            MOVE    PADD2,BORDADR2
            MOVE    PSUBRB,BORDADR3
            MOVE    PADD4,BORDADR4  
            MOVE    PPOST,BORDPOST
            MOVE    PTELEP,BORDHPHN
            MOVE    PTELEB,BORDWPHN
            MOVE    PTMXCELL,BORDMPHN
            MOVE    PMPXPEML,BORDEMAL
.
            PACK      KEY8,AURNO,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BORD0095
.
            MOVE      PURNO,KEY8
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
.
            PACK      KEY8,PURNO,SP70
            CALL      RDPMRES1
            IF        OVRCD=1
              CALL      CLPMSRES
            ENDIF
.
          ELSE  
.
            PACK      KEY8,AURNO,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BORD0095
.
            MOVE      PURNO,KEY8
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
.
            PACK      KEY8,PURNO,SP70
            CALL      RDPMRES1
            IF        OVRCD=1
              CALL      CLPMSRES
            ENDIF
.
            CALL      SVMTHMAS
.
            MOVE    SP70,PTITL
            MOVE    SP70,PSNAME
            MOVE    SP70,PGNAME
            MOVE    SP70,PSEX
            MOVE    SP70,PBDATE
            MOVE    SP70,PADD1
            MOVE    SP70,PADD2
            MOVE    SP70,PSUBRB
            MOVE    SP70,PADD4
            MOVE    SP70,PPOST
            MOVE    SP70,PTELEP
            MOVE    SP70,PTELEB
            MOVE    SP70,PTMXCELL
            MOVE    SP70,PMPXPEML
.
            CALL      DEFBDM00
.
          ENDIF
.
          MATCH     SP70,BORDUNIQ
          IF        !@EQUAL & !@EOS
            PACK      KEY10,BORDUNIQ,SP70
            CALL      RDPTBRD1
            BRANCH    OVRCD,BORD0091
          ENDIF
.
          MATCH     "001",TEMPLATE
          IF        @EQUAL
            PACK      KEY8,AURNO,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BORD0095
.
            MOVE      PURNO,KEY8
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
          ENDIF
.
          MATCH     "002",TEMPLATE
          IF        @EQUAL
            PACK      KEY8,AURNO,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BORD0095
.
            MOVE      PURNO,KEY8
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
          ENDIF
.
.         ************ DISPLAY FORMACTION HOSPITAL LEVEL **********
.
BORD0050  CLEAR     WEBTITLE
          MOVE      "Boarder Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,BORD9999
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      BORD9999
.
.         ************ DELETE FORMACTION ***********
.
BORD0060  PACK      KEY10,BORDUNIQ,SP70
          CALL      RDPTBRD1
          IF        OVRCD=1
            GOTO      BORD0091
          ENDIF
.
          CALL      DEPTBRD1
.
          MOVE      ZERO,EXIT
          GOTO      BORD9999
.
BORD0091  MOVE      "Boarder Not Found",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BORD9999
.
BORD0092  MOVE      "CONTACT iSoft - boarder unique number allocation full.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BORD9999
.
BORD0093  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BORD9999
.
BORD0094  MOVE      "Can't Find Patients Admission Details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BORD9999
.
BORD0095  MOVE      "Can't Find Master Details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BORD9999
.
BORD0096  MOVE      "Patient is not Admitted",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BORD9999
.
BORD0097  MOVE      "Can't Find Master Details for Boarder",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BORD9999
.
BORD0098  MOVE      "No Current Inpatient Event exists for this patient at this hospital",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BORD9999
.
BORD0099  MOVE      "Boarder Linked U/R is Currently in hospital.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BORD9999
.
BORD9999  RETURN
+
.-------------------------------------------------------------------------------
. Table Outputs
.-------------------------------------------------------------------------------
BRDP0000  BRANCH    FLDITMNO,BRDP0100,BRDP0200,BRDP0300,BRDP0400,BRDP0500:
                             BRDP0600,BRDP0700,BRDP0800,BRDP0900,BRDP1000:
                             BRDP1100,BRDP1200,BRDP1300,BRDP1400,BRDP1500:
                             BRDP1600,BRDP1700,BRDP1800,BRDP1900,BRDP2000:
                             BRDP2100,BRDP2200,BRDP2300,BRDP2400,BRDP2500:
                             BRDP2600,BRDP2700,BRDP2800,BRDP2900
.
          GOTO      BRDP9999
.
BRDP0100  CALL      BRDTAB00
          GOTO      BRDP9999
.
BRDP0200  WRITE     HTMLFILE;BORDTITL;
          GOTO      BRDP9999
.
BRDP0300  WRITE     HTMLFILE;BORDSNAM;
          GOTO      BRDP9999
.
BRDP0400  WRITE     HTMLFILE;BORDGNAM;
          GOTO      BRDP9999
.
BRDP0500  WRITE     HTMLFILE;BORDGEND;
          GOTO      BRDP9999
.
BRDP0600  WRITE     HTMLFILE;BORDBDAT;
          GOTO      BRDP9999
.
BRDP0700  WRITE     HTMLFILE;BORDADR1;
          GOTO      BRDP9999
.
BRDP0800  WRITE     HTMLFILE;BORDADR2;
          GOTO      BRDP9999
.
BRDP0900  WRITE     HTMLFILE;BORDADR3;
          GOTO      BRDP9999
.
BRDP1000  WRITE     HTMLFILE;BORDADR4;
          GOTO      BRDP9999
.
BRDP1100  WRITE     HTMLFILE;BORDPOST;
          GOTO      BRDP9999
.
BRDP1200  WRITE     HTMLFILE;BORDHPHN;
          GOTO      BRDP9999
.
BRDP1300  WRITE     HTMLFILE;BORDWPHN;
          GOTO      BRDP9999
.
BRDP1400  WRITE     HTMLFILE;BORDMPHN;
          GOTO      BRDP9999
.
BRDP1500  WRITE     HTMLFILE;BORDEMAL;
          GOTO      BRDP9999
.
BRDP1600  WRITE     HTMLFILE;BORDURNO;
          GOTO      BRDP9999
.
BRDP1700  MOVE      "Male",DISPSEX
          MATCH     "F",BORDGEND
          IF        @EQUAL
            MOVE      "Female",DISPSEX
          ENDIF
          MATCH     "I",PMHCGNDR
          IF        @EQUAL
            MOVE      "Indeterminate",DISPSEX
          ENDIF
          MATCH     "U",PMHCGNDR
          IF        @EQUAL
            MOVE      "Unknown",DISPSEX
          ENDIF
          WRITE     HTMLFILE;DISPSEX;
.
          GOTO      BRDP9999
.
BRDP1800  MATCH     SP70,BORDBDAT
          GOTO      BORD9999 IF EQUAL
          UNPACK    BORDBDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BORD9999
.
BRDP1900  WRITE     HTMLFILE;BORDUNIQ;
          GOTO      BRDP9999
.
BRDP2000  MATCH     SP70,ADATE
          GOTO      BORD9999 IF EQUAL
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BORD9999
.
BRDP2100  MATCH     SP70,DDATE
          GOTO      BORD9999 IF EQUAL
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BORD9999
.
BRDP2200  WRITE     HTMLFILE;DTIME;
          GOTO      BRDP9999
.
BRDP2300  MATCH     SP70,PTBRLURN
          IF        !@EQUAL & !@EOS
            WRITE     HTMLFILE;ONE;
          ELSE
            WRITE     HTMLFILE;ZERO;
          ENDIF
          GOTO      BRDP9999
.
BRDP2400  CALL      BRDHST00
          GOTO      BRDP9999
.
BRDP2500  CALL      HOSSEL00
          GOTO      BRDP9999
.
BRDP2600  PACK      KEY18,URNUMBER,SP70
          CALL      RSPTBRD2
          CALL      RKPTBRD2
          BRANCH    OVRCD,BRDP9999
.
          MATCH     URNUMBER,PTBRURNO
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;
          ENDIF
.
          GOTO      BRDP9999
.
BRDP2700  WRITE     HTMLFILE;DASTAT; 
          GOTO      BRDP9999
.
BRDP2800  REP       "#" ",PSNAME
          MATCH     SP70,PSNAME
          GOTO      BRDP9999 IF EQUAL
          WRITE     HTMLFILE;PSNAME;
          GOTO      BRDP9999
.
BRDP2900  WRITE     HTMLFILE;ATIME;
          GOTO      BRDP9999
.
BRDP9999  RETURN
.
.------------------------------------------------------------
. Hospital Boarders Table
.------------------------------------------------------------
BRDTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          UNPACK    DIM127,D1,ALLVISIN,DIM127
.
          MATCH     "1",ALLVISIN
          GOTO      BRDTAB20 IF EQUAL
.
          PACK      KEY26,ADMISSNO,SP70
          CALL      RSPTBRD3
BRDTAB10  CALL      RKPTBRD3
          BRANCH    OVRCD,BRDTAB99
.
          MATCH     ADMISSNO,PTBRVISN
          GOTO      BRDTAB10 IF NOT EQUAL
.
          MATCH     SP70,PTBRLURN
          IF        !@EQUAL
.
            PACK      KEY8,PTBRLURN,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BRDTAB18
.
            PACK      KEY8,PTBRLURN,SP70
            CALL      RDPMPX21
.
            MATCH     SP70,PTBRSNAM
            IF        !@EQUAL & !@EOS
              MATCH     SP70,PTBRGNAM
              IF        !@EQUAL & !@EOS
                MATCH     SP70,PTBRGEND
                IF        !@EQUAL & !@EOS
                  MATCH     SP70,PTBRBDAT
                  IF        !@EQUAL & !@EOS
                    MOVE      PTBRTITL,PTITL
                    MOVE      PTBRSNAM,PSNAME
                    MOVE      PTBRGNAM,PGNAME
                    MOVE      PTBRGEND,PSEX
                    MOVE      PTBRBDAT,PBDATE
                  ENDIF
                ENDIF 
              ENDIF
            ENDIF
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            CALL      PATLN000
.
          ELSE
.
BRDTAB18    PACK      KEY8,PTBRURNO,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BRDTAB10
.
            PACK      KEY8,PTBRURNO,SP70
            CALL      RDPMPX21
.
            MATCH     SP70,PTBRSNAM
            IF        !@EQUAL & !@EOS
              MATCH     SP70,PTBRGNAM
              IF        !@EQUAL & !@EOS
.               MATCH     SP70,PTBRGEND
.               IF        !@EQUAL & !@EOS
                  MATCH     SP70,PTBRBDAT
                  IF        !@EQUAL & !@EOS
                    MOVE      PTBRTITL,PTITL
                    MOVE      PTBRSNAM,PSNAME
                    MOVE      PTBRGNAM,PGNAME
                    MOVE      PTBRGEND,PSEX
                    MOVE      PTBRBDAT,PBDATE
                  ELSE
                    MOVE      PTBRTITL,PTITL
                    MOVE      PTBRSNAM,PSNAME
                    MOVE      PTBRGNAM,PGNAME
                    MOVE      PTBRGEND,PSEX
                    PACK      PBDATE,CCC,CYY,CMM,CDD
                    REP       " 0",PBDATE
                  ENDIF
.               ENDIF
              ENDIF
            ENDIF
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
.           CALL      PATLN000
.
            MOVE     PSNAME,FMTSNAME
            MOVE     PGNAME,FMTGNAME
            MOVE     PTITL,FMTTITLE
            SFORMAT   FORMATNM,127
            PACK      FORMATNM,SP70,SP70
            REP      "#" ",FMTSNAME
            REP      "#" ",FMTGNAME
            REP      UPPLOW,FMTSNAME
.
            CLEAR    DISPNAME
            PACK     NAME35,FMTTITLE,SP70
            CALL     NAMSTR00
            APPEND   SP70,DISPNAME
            RESET    DISPNAME
            MOVE     DISPNAME,FMTTITLE
            STRIP    FMTTITLE
.
            CLEAR    DISPNAME
            PACK     NAME35,FMTGNAME,SP70
            CALL     NAMSTR00
            APPEND   SP70,DISPNAME
            RESET    DISPNAME
            MOVE     DISPNAME,FMTGNAME
.
            STRIP    FMTGNAME
.
            STRIP    FMTSNAME
            CLEAR    FORMATNM
            APPEND   "<b>",FORMATNM
            APPEND   FMTSNAME,FORMATNM
            APPEND   "</b>",FORMATNM
.
            PACK     KEY9,FMTSNAME,SP70
.
            MATCH    "ANONYMOUS",KEY9                   * match all 9 characters
            GOTO     BRDTAB19 IF EQUAL
.
            APPEND   COMMA,FORMATNM
.
            UNPACK   PBDATE,CCENT,CYEAR,CMON,CDAY
.
BRDTAB19    APPEND   FMTTITLE,FORMATNM
            APPEND   SP1,FORMATNM
            APPEND   FMTGNAME,FORMATNM
            APPEND   SP1,FORMATNM
            APPEND   LBRACK,FORMATNM
            CALL     ADDAGE00
            APPEND   COMMA,FORMATNM
            APPEND   PSEX,FORMATNM
            APPEND   RBRACK,FORMATNM
.
            APPEND    SP70,FORMATNM
            RESET     FORMATNM
            MOVE      FORMATNM,VAR
            STRIP     FORMATNM
            MOVELPTR  FORMATNM,LENGTH
            IF        LENGTH=0
              SFORMAT   FORMATNM,1
            ELSE
              SFORMAT   FORMATNM,LENGTH
            ENDIF
            MOVE      VAR,FORMATNM

.
          ENDIF
.
          PACK      KEY8,PTBRURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,BRDTAB10
.
          PACK      KEY8,PTBRURNO,SP70
          CALL      RDPMPX21
.
          CLEAR     HTMLLINK
          APPEND    "javascript:updateBoarder('",HTMLLINK
          APPEND    PTBRBRDN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PTBRLURN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          STRIP     HTMLLINK
.
          CALL      BRDROW00
.
          GOTO      BRDTAB10
.
BRDTAB20  PACK      KEY18,URNUMBER,SP70
          CALL      RSPTBRD2
BRDTAB30  CALL      RKPTBRD2
          BRANCH    OVRCD,BRDTAB99
.
          MATCH     URNUMBER,PTBRURNO
          GOTO      BRDTAB30 IF NOT EQUAL
.
          MATCH     SP70,PTBRLURN
          IF        !@EQUAL
.
            PACK      KEY8,PTBRLURN,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BRDTAB35
.
            PACK      KEY8,PTBRLURN,SP70
            CALL      RDPMPX21
.
            MATCH     SP70,PTBRSNAM
            IF        !@EQUAL & !@EOS
              MATCH     SP70,PTBRGNAM
              IF        !@EQUAL & !@EOS
                MATCH     SP70,PTBRGEND
                IF        !@EQUAL & !@EOS
                  MATCH     SP70,PTBRBDAT
                  IF        !@EQUAL & !@EOS
                    MOVE      PTBRTITL,PTITL
                    MOVE      PTBRSNAM,PSNAME
                    MOVE      PTBRGNAM,PGNAME
                    MOVE      PTBRGEND,PSEX
                    MOVE      PTBRBDAT,PBDATE
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
            CALL      PATLN000
.
          ELSE
.
BRDTAB35    PACK      KEY8,PTBRURNO,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BRDTAB30
.
            PACK      KEY8,PTBRURNO,SP70
            CALL      RDPMPX21
.
            MATCH     SP70,PTBRSNAM
            IF        !@EQUAL & !@EOS
              MATCH     SP70,PTBRGNAM
              IF        !@EQUAL & !@EOS
                MATCH     SP70,PTBRGEND
                IF        !@EQUAL & !@EOS
                  MATCH     SP70,PTBRBDAT
                  IF        !@EQUAL & !@EOS
                    MOVE      PTBRTITL,PTITL
                    MOVE      PTBRSNAM,PSNAME
                    MOVE      PTBRGNAM,PGNAME
                    MOVE      PTBRGEND,PSEX
                    MOVE      PTBRBDAT,PBDATE
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
.           CALL      PATLN000
.
            MOVE     PSNAME,FMTSNAME
            MOVE     PGNAME,FMTGNAME
            MOVE     PTITL,FMTTITLE
            SFORMAT   FORMATNM,127
            PACK      FORMATNM,SP70,SP70
            REP      "#" ",FMTSNAME
            REP      "#" ",FMTGNAME
            REP      UPPLOW,FMTSNAME
.
            CLEAR    DISPNAME
            PACK     NAME35,FMTTITLE,SP70
            CALL     NAMSTR00
            APPEND   SP70,DISPNAME
            RESET    DISPNAME
            MOVE     DISPNAME,FMTTITLE
            STRIP    FMTTITLE
.
            CLEAR    DISPNAME
            PACK     NAME35,FMTGNAME,SP70
            CALL     NAMSTR00
            APPEND   SP70,DISPNAME
            RESET    DISPNAME
            MOVE     DISPNAME,FMTGNAME
.
            STRIP    FMTGNAME
.
            STRIP    FMTSNAME
            CLEAR    FORMATNM
            APPEND   "<b>",FORMATNM
            APPEND   FMTSNAME,FORMATNM
            APPEND   "</b>",FORMATNM
.
            PACK     KEY9,FMTSNAME,SP70
.
            MATCH    "ANONYMOUS",KEY9                   * match all 9 characters
            GOTO     BRDTAB50 IF EQUAL
.
            APPEND   COMMA,FORMATNM
.
            UNPACK   PBDATE,CCENT,CYEAR,CMON,CDAY
.
BRDTAB50    APPEND   FMTTITLE,FORMATNM
            APPEND   SP1,FORMATNM
            APPEND   FMTGNAME,FORMATNM
            APPEND   SP1,FORMATNM
            APPEND   LBRACK,FORMATNM
            CALL     ADDAGE00
            APPEND   COMMA,FORMATNM
            APPEND   PSEX,FORMATNM
            APPEND   RBRACK,FORMATNM
.
            APPEND    SP70,FORMATNM
            RESET     FORMATNM
            MOVE      FORMATNM,VAR
            STRIP     FORMATNM
            MOVELPTR  FORMATNM,LENGTH
            IF        LENGTH=0
              SFORMAT   FORMATNM,1
            ELSE
              SFORMAT   FORMATNM,LENGTH
            ENDIF
            MOVE      VAR,FORMATNM
.
          ENDIF
.
          PACK      KEY8,PTBRURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,BRDTAB30
.
          PACK      KEY8,PTBRURNO,SP70
          CALL      RDPMPX21
.
          CLEAR     HTMLLINK
          APPEND    "javascript:updateBoarder('",HTMLLINK
          APPEND    PTBRBRDN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PTBRLURN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          STRIP     HTMLLINK
.
          CALL      BRDROW00
.
          GOTO      BRDTAB30
.
BRDTAB99  RETURN
.
.-------------------------------------------------------------------------------
. Hospital Boarder Table Row
.-------------------------------------------------------------------------------
BRDROW00  WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",PTBRSDAT,"#",":
                             "#"",PTBREDAT,"#",":
                             "#"",PTBRHPHN,"#",":
                             "#"",PTBRWPHN,"#",":
                             "#"",PTBRMPHN,"#",":
                             "#"",PTBREMAL,"#")"
.
BRDROW99  RETURN
.
.-----------------------------------------------------------
.        Generate Unique Boarder Number
.-----------------------------------------------------------
GUBN0000  MOVE      "118",PRXCODE
          CALL      GETSLK00
          READ      CONTROLF,HUND18;*140,PTCNUNBN
.
GUBN0100  MOVE      PTCNUNBN,PTBRBRDN
          UNPACK    PTCNUNBN,ANS,KEY9
          MATCH     "a",ANS
          GOTO      GUBN1150 IF LESS
          MOVE      ZERO,F9
          MOVE      KEY9,F9
.
GUBN1100  COMPARE   "999999999",F9               * at the end of the group
          GOTO      GUBN1110 IF NOT EQUAL
.
          MATCH     "z",ANS
          GOTO      GUBN9000 IF EQUAL
.
          REP       REPUNIQ,ANS
          MOVE      ZERO,F9
.
GUBN1110  ADD       ONE,F9
          MOVE      F9,D9
          REP       " 0",D9
.
          PACK      KEY10,ANS,D9,SP70
          CALL      RDPTBRD1
          IF        OVRCD=ONE
            GOTO      GUBN9500
          ENDIF
.
          GOTO      GUBN1100
.
. no records
.
GUBN1150  MOVE      ONE,F9
          MOVE      "a",ANS
.
          MOVE      F9,D9
          REP       " 0",D9
.
          PACK      KEY10,ANS,D9,SP70
          GOTO      GUBN9500
.
GUBN9000  MOVE      ONE,EXIT                  * Passcode allocation full
          GOTO      GUBN9999
.
GUBN9500  MOVE      KEY10,PTCNUNBN
          WRITAB    CONTROLF,HUND18;*140,PTCNUNBN
.
          MATCH     "0000000000",PTBRBRDN
          GOTO      GUBN0100 IF EQUAL
.
GUBN9999  CALL      RELSLK00
          RETURN
.------------------------------------------------------------
. Hospital Boarders Table Hospital Level
.------------------------------------------------------------
BRDHST00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      IBACLOCK
          PACK      TODAY,CCC,CYY,CMM,CDD
          REP       " 0",TODAY
.
          PACK      KEY13,SP70
          CALL      RSPTBRD4
BRDHST10  CALL      RKPTBRD4
          BRANCH    OVRCD,BRDHST99
.
          MATCH     SP70,PTBREDAT
          IF        !@EQUAL & !@EOS
            MATCH     TODAY,PTBREDAT
            GOTO      BRDHST10 IF LESS           * CAR 304926
            GOTO      BRDHST12 IF NOT EQUAL      * CAR 304926
.
            MATCH     SP70,PTBRETIM
            IF        !@EQUAL & !@EOS
              MATCH     CTIMEIS,PTBRETIM
              GOTO      BRDHST10 IF LESS         * CAR 304926
            ENDIF
          ENDIF
.
BRDHST12  IF      IBCNMHOS=1
.
            MATCH     "1",VIEWTYPE
            IF        @EQUAL
              MOVE      WBSEHOSP,FILTHOSP
            ENDIF
.
            MATCH   SP70,FILTHOSP
            IF      !@EQUAL & !@EOS
              PACK    KEY8,PTBRVISN,SP70
              CALL    RDPMVX11
              BRANCH  OVRCD,BRDHST10
.
              MATCH   FILTHOSP,PMVXMHOS            
              GOTO    BRDHST10 IF NOT EQUAL
            ELSE
.
              PACK    KEY13,WBSEUID,SP70
              CALL    RDMLSEC1
              IF      OVRCD=0
                GOTO    BRDHST15
              ENDIF
.
              PACK    KEY8,PTBRVISN,SP70
              CALL    RDPMVX11
              BRANCH  OVRCD,BRDHST10
.
              PACK    KEY13,WBSEUID,PMVXMHOS,SP70
              CALL    RDMLSEC1
              IF      OVRCD=0
                GOTO    BRDHST15
              ENDIF
.
              MATCH   SP70,WBSEHOSP
              IF      !@EQUAL & !@EOS
                MATCH   PMVXMHOS,WBSEHOSP
                GOTO    BRDHST15 IF EQUAL
              ENDIF
.
              GOTO    BRDHST10
.
            ENDIF
          ENDIF
.
BRDHST15  MATCH     SP70,PTBRLURN
          IF        !@EQUAL
.
            PACK      KEY8,PTBRLURN,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BRDHST18
.
            PACK      KEY8,PTBRLURN,SP70
            CALL      RDPMPX21
.
            MATCH     SP70,PTBRSNAM
            IF        !@EQUAL & !@EOS
              MATCH     SP70,PTBRGNAM
              IF        !@EQUAL & !@EOS
                MATCH     SP70,PTBRGEND
                IF        !@EQUAL & !@EOS
                  MATCH     SP70,PTBRBDAT
                  IF        !@EQUAL & !@EOS
                    MOVE      SP70,PTITL
                    MOVE      PTBRSNAM,PSNAME
                    MOVE      PTBRGNAM,PGNAME
                    MOVE      PTBRGEND,PSEX
                    MOVE      PTBRBDAT,PBDATE
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
.           CALL      PATLN000
            CALL      FORNAM00 
.
.           PACK      KEY17,PTBRLURN,TWO,SP70
.           CALL      RSPTMI18
.           CALL      RKPTMI18
.           IF        OVRCD=1
.             CALL      CLPATMIS
.           ENDIF
.
.           MATCH     PTBRLURN,AURNO
.           IF        !@EQUAL
.             CALL      CLPATMIS
.           ENDIF
.
            MATCH     SP70,PTBRVISN
            IF        !@EQUAL & !@EOS
              PACK      KEY8,PTBRVISN,SP70
              CALL      RDMISS1
              IF        OVRCD=1
                CALL      CLPATMIS
              ENDIF
            ENDIF

.
          ELSE
.
BRDHST18    PACK      KEY8,PTBRURNO,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,BRDTAB10
.
            PACK      KEY8,PTBRURNO,SP70
            CALL      RDPMPX21
.
            MATCH     SP70,PTBRSNAM
            IF        !@EQUAL & !@EOS
              MATCH     SP70,PTBRGNAM
              IF        !@EQUAL & !@EOS
.               MATCH     SP70,PTBRGEND
.               IF        !@EQUAL & !@EOS
                  MATCH     SP70,PTBRBDAT
                  IF        !@EQUAL & !@EOS
                    MOVE      SP70,PTITL
                    MOVE      PTBRSNAM,PSNAME
                    MOVE      PTBRGNAM,PGNAME
                    MOVE      PTBRGEND,PSEX
                    MOVE      PTBRBDAT,PBDATE
                  ELSE
                    MOVE      SP70,PTITL
                    MOVE      PTBRSNAM,PSNAME
                    MOVE      PTBRGNAM,PGNAME
                    MOVE      PTBRGEND,PSEX
                    PACK      PBDATE,CCC,CYY,CMM,CDD
                    REP       " 0",PBDATE
                  ENDIF
.               ENDIF
              ENDIF
            ENDIF
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE
.           CALL      PATLN000
            CALL      FORNAM00 
.
            MATCH     SP70,PTBRVISN
            IF        !@EQUAL & !@EOS
              PACK      KEY8,PTBRVISN,SP70
              CALL      RDMISS1
              IF        OVRCD=1
                CALL      CLPATMIS
              ENDIF
            ENDIF
.
          ENDIF
.
          PACK      KEY8,PTBRURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,BRDTAB10
.
          PACK      KEY8,PTBRURNO,SP70
          CALL      RDPMPX21
.
.         MATCH     SP70,PTBRVISN
.         IF        !@EQUAL & !@EOS
.           PACK      KEY8,PTBRVISN,SP70
.           CALL      RDMISS1
.           IF        OVRCD=1
.             CALL      CLPATMIS
.           ENDIF
.         ENDIF
.
.         MOVE      SP70,PTWDSDES
.         MATCH     SP70,AWARD
.         IF        !@EQUAL & !@EOS
.           PACK      KEY6,AWARD,SP70
.           CALL      RDWARD1
.           IF        OVRCD=1
.             MOVE      SP70,PTWDSDES
.           ENDIF
.         ENDIF
.
          MOVE      SP70,WARDTEXT
          MOVE      SP70,WBEDTEXT 
.
          MATCH     "1",PTCNWBDS 
          IF        @EQUAL
            MATCH     SP70,AWARD
            IF        !@EQUAL & !@EOS
              PACK      KEY6,AWARD,SP70
              CALL      RDWARD1
              IF        OVRCD=0
                MOVE      WBDESC,WARDTEXT
              ENDIF
.
              MATCH     SP70,ABED
              IF        !@EQUAL & !@EOS
                PACK      KEY6,AWARD,ABED,SP70
                CALL      RDWARD1
                IF        OVRCD=0
                  MOVE      WBDESC,WBEDTEXT
                ENDIF
              ENDIF
            ENDIF
          ELSE
            MATCH     "2",PTCNWBDS
            IF        @EQUAL
              MATCH     SP70,AWARD
              IF        !@EQUAL & !@EOS
                PACK      KEY6,AWARD,SP70
                CALL      RDWARD1
                IF        OVRCD=0
                  MOVE      PTWDSDES,WARDTEXT
                ENDIF
.
                MATCH     SP70,ABED
                IF        !@EQUAL & !@EOS
                  PACK      KEY6,AWARD,ABED,SP70
                  CALL      RDWARD1
                  IF        OVRCD=0
                    MOVE      PTWDSDES,WBEDTEXT
                  ENDIF
                ENDIF
              ENDIF  
            ELSE
              MATCH     SP70,AWARD
              IF        !@EQUAL & !@EOS
                PACK      KEY6,AWARD,SP70
                CALL      RDWARD1
                IF        OVRCD=0
                  MOVE      WWARD,WARDTEXT
                ENDIF
.
                MATCH     SP70,ABED
                IF        !@EQUAL & !@EOS
                  PACK      KEY6,AWARD,ABED,SP70
                  CALL      RDWARD1
                  IF        OVRCD=0
                    MOVE      WBED,WBEDTEXT
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:gotoBoarder('",HTMLLINK
          APPEND    PTBRURNO,HTMLLINK
          APPEND    "#',#'",HTMLLINK
          APPEND    PTBRVISN,HTMLLINK
          APPEND    "#',#'",HTMLLINK
          APPEND    PTBRBRDN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          STRIP     HTMLLINK
.
.         SQUEEZE   PTBRHPHN
.         SQUEEZE   PTBRWPHN
.         SQUEEZE   PTBRMPHN
.
          CALL      HSTROW00 
.
          GOTO      BRDHST10
.
BRDHST99  RETURN
.
.-----------------------------------------------------------------------
. Format name
.-----------------------------------------------------------------------
FORNAM00  MOVE      PSNAME,FMTSNAME
          MOVE      PGNAME,FMTGNAME
          MOVE      PTITL,FMTTITLE
          SFORMAT   FORMATNM,127
          PACK      FORMATNM,SP70,SP70
          REP       "#" ",FMTSNAME
          REP       "#" ",FMTGNAME
          REP       UPPLOW,FMTSNAME
.
          CLEAR     DISPNAME
          PACK      NAME35,FMTTITLE,SP70
          CALL      NAMSTR00
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,FMTTITLE
          STRIP     FMTTITLE
.
          CLEAR     DISPNAME
          PACK      NAME35,FMTGNAME,SP70
          CALL      NAMSTR00
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,FMTGNAME
.
          STRIP     FMTGNAME
.
          STRIP     FMTSNAME
          CLEAR     FORMATNM
          APPEND    "<b>",FORMATNM
          APPEND    FMTSNAME,FORMATNM
          APPEND    "</b>",FORMATNM
.
          PACK      KEY9,FMTSNAME,SP70
.
          MATCH     "ANONYMOUS",KEY9                   * match all 9 characters
          GOTO      FORNAM50 IF EQUAL
.
          APPEND    COMMA,FORMATNM
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
.
FORNAM50  APPEND    FMTTITLE,FORMATNM
          APPEND    SP1,FORMATNM
          APPEND    FMTGNAME,FORMATNM
          APPEND    SP1,FORMATNM
          APPEND    LBRACK,FORMATNM
          CALL      ADDDOB00
          APPEND    COMMA,FORMATNM
          CALL      ADDAGE00
          APPEND    COMMA,FORMATNM
          APPEND    PSEX,FORMATNM
          MOVE      PTBRLURN,DIM8
          SQUEEZE   DIM8 
          MATCH     SP70,DIM8
          IF        !@EQUAL & !@EOS
            APPEND    COMMA,FORMATNM
            APPEND    DIM8,FORMATNM
          ELSE
FORNAM51    MOVE      DIM8,DIM8             
          ENDIF
          APPEND    RBRACK,FORMATNM
.
          APPEND    SP70,FORMATNM
          RESET     FORMATNM
          MOVE      FORMATNM,VAR
          STRIP     FORMATNM
          MOVELPTR  FORMATNM,LENGTH
          IF        LENGTH=0
            SFORMAT   FORMATNM,1
          ELSE
            SFORMAT   FORMATNM,LENGTH
          ENDIF
          MOVE      VAR,FORMATNM
.
FORNAM99  RETURN
.
.------------------------------------------------------------
. Hospital Boarders Table Hospital Level
.------------------------------------------------------------
HSTROW00  WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",PTBRSDAT,"#",":
                             "#"",PTBREDAT,"#",":
                             "#"",PTBRHPHN,"#",":
                             "#"",PTBRWPHN,"#",":
                             "#"",PTBRMPHN,"#",":
                             "#"",PTBREMAL,"#",":
                             "#"",WARDTEXT," / ",WBEDTEXT,"#")"
.
HSTROW99  RETURN
.
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
HOSSEL00  MATCH     "1",VIEWTYPE
          IF        @EQUAL
            MOVE      WBSEHOSP,FILTHOSP
          ENDIF 
.
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HOSSEL10  CALL      RKPTHSP1
          BRANCH    OVRCD,HOSSEL99
.
          MATCH     SP70,WBSEHOSP
          IF        !@EQUAL & !@EOS
            MATCH     WBSEHOSP,PTHSHOSP
            GOTO      HOSSEL20 IF EQUAL
          ENDIF
.
          PACK      KEY13,WBSEUID,SP70
          CALL      RDMLSEC1
          IF        OVRCD=0
            GOTO      HOSSEL20
          ENDIF
.
.         PACK      KEY13,WBSEUID,SP70
.         CALL      RSMLSEC1
.         CALL      RKMLSEC1
.         BRANCH    OVRCD,HOSSEL99
.
.         MATCH     WBSEUID,MLSCUSID
.         GOTO      HOSSEL99 IF NOT EQUAL
.
.         MATCH     SP70,MLSCHOSP
.         GOTO      HOSSEL20 IF EQUAL
.         GOTO      HOSSEL20 IF EOS
.
          PACK      KEY13,WBSEUID,PTHSHOSP,SP70
          CALL      RDMLSEC1
          IF        OVRCD=1
            GOTO      HOSSEL10
          ENDIF
.
HOSSEL20  MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     FILTHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HOSSEL10
.
HOSSEL99  RETURN
.
.------------------------------------------------------------
. Save NOK details to extra contacts file
.------------------------------------------------------------
ECON0000  MOVE      PURNO,PMCEX001     
.
          MATCH     Z70,PMCEX002
          GOTO      ECON9999 IF EQUAL
.
          MATCH     SP70,PMCEX002
          GOTO      ECON9999 IF EQUAL
.
          MATCH     Z70,PMCEX004
          IF        !@EQUAL
            MATCH     SP70,PMCEX004
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX005
          IF        !@EQUAL
            MATCH     SP70,PMCEX005
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX006
          IF        !@EQUAL
            MATCH     SP70,PMCEX006
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX007
          IF        !@EQUAL
            MATCH     SP70,PMCEX007 
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX008
          IF        !@EQUAL
            MATCH     SP70,PMCEX008
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX009
          IF        !@EQUAL
            MATCH     SP70,PMCEX009
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX010
          IF        !@EQUAL
            MATCH     SP70,PMCEX010
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX011
          IF        !@EQUAL
            MATCH     SP70,PMCEX011
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX012
          IF        !@EQUAL
            MATCH     SP70,PMCEX012
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX013
          IF        !@EQUAL
            MATCH     SP70,PMCEX013
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX014
          IF        !@EQUAL
            MATCH     SP70,PMCEX014
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          MATCH     Z70,PMCEX015
          IF        !@EQUAL
            MATCH     SP70,PMCEX015
            GOTO      ECON3000 IF NOT EQUAL
          ENDIF
.
          GOTO      ECON9999
.
ECON3000  CALL      CLPMSCEX
          MOVE      "  1",PMCEX003
          CALL      MVPMCE00                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,PMCECDAT                * System date
          CLOCK     TIME,PMCECTIM                * System time (Var chgd HPS)
          MOVE      USERID,PMCECUID              * web user id
.
          CALL      CONU0000                    * Get contact webPAS unique id
.
          PACK      KEY14,PMCEX001,PMCEX002,PMCEX003,SP70
          CALL      RAPMCEX1
          IF        OVRCD=1
            CALL      WRPMCEX1   
            MOVE      ONE,AUDTTYPE            * write add audit record
            CALL      WAPMCE00
.  write nsw edw record for contact added
            MOVE      "14 ",PMEWTYPE
            PACK      PMEWNEWV,PMCEURNO,PMCETYPE,PMCECNTR,SP70
            CALL      WREDW000
.
          ENDIF
.
ECON9999  RETURN
.
.
.*********************************************************************
. Update current patient file for this visit number
.*********************************************************************
FCUR0000  PACK      KEY8,ADMISSNO,SP30
          CALL      RDPMCUR1
          BRANCH    OVRCD,FCUR9999
.
          MOVE      NEWURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,FCUR9999
.
          MOVE      NEWURNO,KEY8
          CALL      RDPMPX21
          BRANCH    OVRCD,FCUR9999
.
          MOVE      NEWURNO,PMCUURNO
          MOVE      PTMASNAM,PMCUSURN
          MOVE      PMPXFNAM,PMCUGNAM
          MOVE      PMPXSNAM,PMCUGNM2
.
          CALL      UPPMCUR1
.
FCUR9999  RETURN
.
.*********************************************************************
. Update ACC details file for this visit number
.*********************************************************************
ACCURC00  PACK      KEY8,ADMISSNO,SP70
          CALL      RDWCOM1
          BRANCH    OVRCD,ACCURC99
.
          MATCH     OLDURNO,PTWCURNO
          GOTO      ACCURC99 IF NOT EQUAL
.
          MOVE      NEWURNO,PTWCURNO
          CALL      UPWCOM1
.
          IF        PTCNHDPS<>1
            GOTO      ACCURC99
          ENDIF
.
          OPEN      ACCLODA1,"acclodaf"
          PACK      KEY20,WCCLMNO,SP30
          CALL      RDACLOD1
          BRANCH    OVRCD,ACCURC99
.
          MOVE      NEWURNO,ACLOURNO
          CALL      UPACLOD1
.
ACCURC99  RETURN
.
.*********************************************************************
. Validate Emergency Visits on Change UR Patient Merge
.*********************************************************************
VALDEM00  MOVE      ZERO,EXIT
.
.   *** if multiple current emr visits allowed, exit
.
          READ      CONTROLF,HUND18;*244,PTCNMEMR
          MATCH     "1",PTCNMEMR
          GOTO      VALDEM99 IF EQUAL
.
          PACK      SAVKEY8,PVIBILL,SP70
.
          PACK      KEY24,NEWURNO,SP30
          CALL      RDSVISA2
VALDEM25  CALL      RDKVISA2
          BRANCH    OVRCD,VALDEM90
          MATCH     NEWURNO,PVIURNO
          GOTO      VALDEM90 IF NOT EQUAL
.
.         Only check emergency visits
.
          COMPARE   ONE,PVITYPE
          GOTO      VALDEM25 IF NOT EQUAL
.
.         have found first emergency vis number
.
          MOVE      PVIBILL,EMVIADMN
          MOVE      EMVIADMN,KEY8
          CALL      RDEMVIS1
          BRANCH    OVRCD,VALDEM25
.
          BRANCH    EMVISTAT,VALDEM40,VALDEM25,VALDEM25,VALDEM25
          GOTO      VALDEM25
.
VALDEM40  PACK      KEY24,OLDURNO,SP30
          CALL      RDSVISA2
VALDEM45  CALL      RDKVISA2
          BRANCH    OVRCD,VALDEM90
          MATCH     OLDURNO,PVIURNO
          GOTO      VALDEM90 IF NOT EQUAL
.
.         We are only interested in emergency visits
.
          COMPARE   ONE,PVITYPE
          GOTO      VALDEM45 IF NOT EQUAL
.
.         Read emergency file
.
          MOVE      PVIBILL,EMVIADMN
          MOVE      EMVIADMN,KEY8
          CALL      RDEMVIS1
          BRANCH    OVRCD,VALDEM45
.
          BRANCH    EMVISTAT,VALDEM80,VALDEM45,VALDEM45,VALDEM45
          GOTO      VALDEM45
.
VALDEM80  MOVE      ONE,EXIT
VALDEM90  PACK      KEY8,SAVKEY8,SP70
          CALL      RDVISA1
.
VALDEM99  RETURN
.
.*********************************************************************
. Validate admissions on Change UR Patient Merge
.*********************************************************************
VALDIN00  MOVE      ZERO,EXIT
.
          PACK      SAVKEY8,PVIBILL,SP70
.
          PACK      KEY24,NEWURNO,SP30
          CALL      RDSVISA2
VALDIN25  CALL      RDKVISA2
          BRANCH    OVRCD,VALDIN90
          MATCH     NEWURNO,PVIURNO
          GOTO      VALDIN90 IF NOT EQUAL
.
.         Only check admissions 
.
          COMPARE   THREE,PVITYPE
          GOTO      VALDIN25 IF NOT EQUAL
.
.         have found first admission number
.
          MOVE      PVIBILL,AADMNO
          MOVE      AADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,VALDIN25
.
          BRANCH    ASTAT,VALDIN25,VALDIN40,VALDIN25,VALDIN40,VALDIN25
          GOTO      VALDIN25
.
VALDIN40  PACK      KEY24,OLDURNO,SP30
          CALL      RDSVISA2
VALDIN45  CALL      RDKVISA2
          BRANCH    OVRCD,VALDIN90
          MATCH     OLDURNO,PVIURNO
          GOTO      VALDIN90 IF NOT EQUAL
.
.         We are only interested in admissions
.
          COMPARE   THREE,PVITYPE
          GOTO      VALDIN45 IF NOT EQUAL
.
.         Read admission file
.
          MOVE      PVIBILL,AADMNO
          MOVE      AADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,VALDIN45
.
          BRANCH    ASTAT,VALDIN45,VALDIN80,VALDIN45,VALDIN80,VALDIN45
          GOTO      VALDIN45
.
VALDIN80  MOVE      ONE,EXIT
VALDIN90  PACK      KEY8,SAVKEY8,SP70
          CALL      RDVISA1
.
VALDIN99  RETURN
.
+
.--------------------------------------------------------------
. GTURCM00 - Get UR Comments from input UR comment TextArea and
.            and write them to the temporary file for updating
.            to the database
.--------------------------------------------------------------
.
GTURCM00  PREP      COMFILAF,COMFILNM
          GOTO      GTURCM20
.
GTURCM10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA
          GOTO      GTURCM99 IF OVER
.
          MATCH     SP70,QRYNAME
          GOTO      GTURCM80 IF NOT EQUAL
.
GTURCM20  MOVE      QRYDATA,QRYDATA1
          SQUEEZE   QRYDATA1                 * skip the blank line
          GOTO      GTURCM10 IF EOS
.
          ADD       ONE,URCMTLIN
          WRITE     COMFILAF,SEQ;QRYDATA
          COMPARE   "99",URCMTLIN
          GOTO      GTURCM99 IF EQUAL
.
          GOTO      GTURCM10
.
GTURCM80  MOVE      ONE,TEXTAREA             * Flag for Next CGI Param
.
GTURCM99  RETURN
.
.-----------------------------------------------------------------
. Insert new U/R Comments - pmsuchaf/pmsucdaf for pre-admission.
. It first deletes all the comments and then copies them back
.-----------------------------------------------------------------
.
UPUCM000  IF        URCMTFLG <> 1
            GOTO      UPUCM999
          ENDIF
.
          MOVE      URCMTTYP,KEY3
          CALL      DLUCM000                  * delete ur comments
.
          IF        URCMTLIN = 0
            GOTO      UPUCM990
          ENDIF
.
          CALL      IBACLOCK
          PACK      CURRDATX,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATX
          CLOCK     TIME,CTIMEIS              * Set created timestamp
.
.         Insert UR comment header
.
UPUCM200  MOVE      PURNO,PMUHURNO            * set ur number
          MOVE      URCMTTYP,PMUHCTYP
          MOVE      ONE,F6
          MOVE      F6,PMUHCNUM
          MOVE      USERID,PMUHCUID
          MOVE      CURRDATX,PMUHCDAT         * comment date
          MOVE      CTIMEIS,PMUHCTIM          * comment time
.
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          IF        OVRCD = 0
            MOVE      WBSEOCG,PMUHOCCG      * Occupation Group
          ELSE
            MOVE      SP70,PMUHOCCG
          ENDIF
.
          MOVE      ZERO,PMUHDELT
          MOVE      SP70,PMUHDUID
          MOVE      SP70,PMUHDDAT
          MOVE      SP70,PMUHDTIM
          MOVE      SP70,PMUHDOCG
          MOVE      SP70,PMUHSPAR
.
          CALL      WRPMUCH1
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      COMFILAF,COMFILNM
          TRAPCLR   IO
          BRANCH    OVRCD,UPUCM999
.
.         Insert UR comment detail
.
          MOVE      ZERO,F3
          MOVE      F3,URTXUNIQ
UPUCM400  READ      COMFILAF,SEQ;PMUCCOMM
          GOTO      UPUCM990 IF OVER
.
          ADD       ONE,URTXUNIQ            * add to line number
.
          MOVE      PMUHURNO,PMUCURNO       * set admission number
          MOVE      PMUHCTYP,PMUCCTTY
          MOVE      PMUHCNUM,PMUCCNUM
          MOVE      URTXUNIQ,PMUCLNUM
          MOVE      SP70,PMUCSPAR
.
          PACK      KEY20,PMUCURNO,PMUCCTTY,PMUCCNUM,PMUCLNUM,SP70
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          CALL      WRPMUCD1
          TRAPCLR   IO
.
          IF        URTXUNIQ = 99
            GOTO      UPUCM990
          ENDIF
.
          GOTO      UPUCM400
.
UPUCM990  CLOSE     COMFILAF,DELETE
.
UPUCM999  RETURN
.
.-----------------------------------------------------------------------
. Delete all ur comments for a given ur type
.-----------------------------------------------------------------------
.
DLUCM000  PACK      KEY17,PURNO,KEY3,SP70
          CALL      RSPMUCH1
DLUCM100  CALL      RKPMUCH1
          BRANCH    OVRCD,DLUCM999
.
          MATCH     PURNO,PMUHURNO           * same ur Number?
          GOTO      DLUCM999 IF NOT EQUAL
.
          MATCH     PMUHCTYP,KEY3
          GOTO      DLUCM999 IF NOT EQUAL
.
          PACK      KEY17,PMUHURNO,PMUHCTYP,PMUHCNUM,SP70
          CALL      DEPMUCH1
.
          PACK      KEY20,PMUHURNO,PMUHCTYP,PMUHCNUM,SP70
          CALL      RSPMUCD1
DLUCM400  CALL      RKPMUCD1
          BRANCH    OVRCD,DLUCM100          * end of file
.
          MATCH     PMUHURNO,PMUCURNO       * same ur Number?
          GOTO      DLUCM100 IF NOT EQUAL
.
          MATCH     PMUHCTYP,PMUCCTTY
          GOTO      DLUCM100 IF NOT EQUAL
.
          MATCH     PMUHCNUM,PMUCCNUM
          GOTO      DLUCM100 IF NOT EQUAL
.
          PACK      KEY20,PMUCURNO,PMUCCTTY,PMUCCNUM,PMUCLNUM,SP70
          CALL      DEPMUCD1
          GOTO      DLUCM400
.
DLUCM999  RETURN
.
.-----------------------------------------------------------
. Write EDWARD visit alteration record
.------------------------------------------------------------
WEDU0000  MATCH     SP70,PTCNNSSI        * no edward source system
          GOTO      WEDU9999 IF EQUAL
.
          MATCH     "00000000000000000000",PTCNNSSI  * no edward source system
          GOTO      WEDU9999 IF EQUAL
.
          MOVE      PVIBILL,PMAWVISN
          MOVE      EDWARDTY,PMAWTYPE
          PACK      PMAWOLDV,OLDURNO,SP70,SP70,SP70
          PACK      PMAWNEWV,NEWURNO,SP70,SP70,SP70
.
          CALL      IBACLOCK
          PACK      PMAWCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMAWCDAT
          MOVE      "00:00:00",PMAWCTIM
          PACK      PMAWCUID,USERID
          PACK      PMAWSPAR,SP70,SP70
.
          PACK      KEY27,PMAWCDAT,PMAWCTIM,PMAWVISN,PMAWTYPE,SP70
          CALL      RAPMADW1
          IF        OVRCD=1
            CALL      WRPMADW1
          ELSE
            CALL      UPPMADW1
          ENDIF
.
WEDU9999  RETURN
.
.******************************************************************************
.*                                 WREDW000                                   *
.* If any of the EDWWARD variables have changed, write/update pmsedwaf        *
.******************************************************************************
.
WREDW000  READ      CONTROLF,HUND25;*93,PTCNNSSI
          MATCH     SP70,PTCNNSSI        * no edward source system
          GOTO      WREDW999 IF EQUAL
.
          MATCH     "00000000000000000000",PTCNNSSI  * no edward source system
          GOTO      WREDW999 IF EQUAL
.
          OPEN      PMSEDWA2,"pmsedwaf"
.
          MOVE      PURNO,PMEWURNO
          CALL      IBACLOCK
          PACK      PMEWCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMEWCDAT
          CLOCK     TIME,PMEWCTIM
          PACK      PMEWCUID,USERID
          PACK      PMEWSPAR,SP70,SP70
.
          PACK      KEY27,PMEWURNO,PMEWTYPE,PMEWCDAT,PMEWCTIM,SP70
          CALL      RAPMEDW2
          IF        OVRCD=1
            CALL      WRPMEDW2
          ELSE
            CALL      UPPMEDW2
          ENDIF
.
WREDW999  RETURN
.
.******************************************************************************
.*                                 WEDR0000                                   *
.* Write EDWARD old U?R details kept on merge                                 *
.******************************************************************************
WEDR0000  MATCH     SP70,PTCNNSSI        * no edward source system
          GOTO      WEDR9999 IF EQUAL
.
          MATCH     "00000000000000000000",PTCNNSSI  * no edward source system
          GOTO      WEDR9999 IF EQUAL
.
          MOVE      NEWURNUM,PMEWURNO
          MOVE      "23 ",PMEWTYPE
.
          PACK      PMEWOLDV,OLDURNUM,SP70,SP70,SP70,SP70
          PACK      PMEWNEWV,NEWURNUM,SP70,SP70,SP70,SP70
.
          CALL      IBACLOCK
          PACK      PMEWCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMEWCDAT
          CLOCK     TIME,PMEWCTIM
          PACK      PMEWCUID,USERID
          PACK      PMEWSPAR,SP70,SP70
.
          PACK      KEY27,PMEWURNO,PMEWTYPE,PMEWCDAT,PMEWCTIM,SP70
          CALL      RAPMEDW2
          IF        OVRCD=1
            CALL      WRPMEDW2
          ELSE
            CALL      UPPMEDW2
          ENDIF
.
WEDR9999  RETURN
.
.-------------------------------------------------------------------------------
. Add patient attribute type 022 for multiple birth type
.-------------------------------------------------------------------------------
MBRTH000  CALL      CLPATATR
.
          MOVE      URNUMBER,PTARURNO
          PACK      PTARVISN,SP7,ZERO
          CALL      IBACLOCK
          PACK      PTARDATE,CCC,CYY,CMM,CDD
          REP       " 0",PTARDATE
          CLOCK     TIME,PTARTIME
          MOVE      ATYPE022,PTARTYPE
          MOVE      PTMAS071,PTARVAL1
          MOVE      PTMAS070,PTARCOD1
          MOVE      USERID,PTARCUSR
          MOVE      PTARDATE,PTARCDTE
          MOVE      PTARTIME,PTARCTME
.
          PACK      KEY35,PTARURNO,PTARDATE,PTARTIME,PTARTYPE,PTARVISN,SP70
          CALL      WRPTATR1
.
          MOVE      PTARURNO,KEY8
          CALL      RAPMPX21
          BRANCH    OVRCD,MBRTH999
.
          MOVE      "1",PMPXSN20
          CALL      UPPMPX21          * update the record
.
MBRTH999  RETURN
.
.-----------------------------------------------------------
. Write record from the opt out of SMS file - PMSOOSFD
.-----------------------------------------------------------
OSMS0000  MATCH     "1",PTCNSMSN
          GOTO      OSMS9999 IF NOT EQUAL
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSOOSA1,"pmsoosaf"
          TRAPCLR   IO
          BRANCH    OVRCD,OSMS9999
.
          MOVE      PURNO,PMOOURNO            * U/R Number
          MOVE      USERID,PMOOCUSR              * User Who Created Record
.
          CALL      IBACLOCK
          PACK      PMOOCDTE,CCC,CYY,CMM,CDD
          REP       " 0",PMOOCDTE                * Date Record Created
          MOVE      CTIMEIS,PMOOCTME             * Time Record Created
.
          MOVE      SP70,PMOOSPAR                * Spare
.
          PACK      KEY8,PMOOURNO,SP70
          CALL      RAPMOOS1
          IF        OVRCD=1
            CALL      WRPMOOS1
          ENDIF
.
          CLOSE     PMSOOSA1
.
OSMS9999  RETURN
.
.-----------------------------------------------------------
. Delete record from the opt out of SMS file - PMSOOSFD
.-----------------------------------------------------------
DSMS0000  MATCH     "1",PTCNSMSN
          GOTO      DSMS9999 IF NOT EQUAL
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSOOSA1,"pmsoosaf"
          TRAPCLR   IO
          BRANCH    OVRCD,DSMS9999
.
          PACK      KEY8,PURNO,SP70
          CALL      DEPMOOS1
.
          CLOSE     PMSOOSA1
.
DSMS9999  RETURN
+
.------------------------------------------------------------
. Write out pmsnplaf record
.------------------------------------------------------------
WPMNPL00  MATCH     "3",PTCNUNET
          GOTO      WPMNPL99 IF NOT EQUAL
.
          CALL      CLPMSNPL
.
          MOVE      "09",PMNPRTYP
          MOVE      DIM8,PMNPURNO
          CALL      IBACLOCK
          PACK      PMNPRDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMNPRDAT
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,PMNPRTIM
          MOVE      "   1",PMNPCNTR
.
          IF        IBCNMHOS=ONE
            MOVE      WBSEHOSP,PMNPHOSP
          ELSE
            OPEN      PATHSPA1,"pathspaf"
.
            PACK      KEY3,SP70
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            IF        OVRCD=0
              MOVE      PTHSHOSP,PMNPHOSP
            ENDIF
          ENDIF
.
          MOVE      USERID,PMNPRUID
          MOVE      "0",PMNPRSTA
          MOVE      PMNPRDAT,PMNPCDAT
          MOVE      PMNPRTIM,PMNPCTIM
          MOVE      PMNPRUID,PMNPCUID
.
          CALL      WRPMNPL1
.
WPMNPL99  RETURN
.
.-------------------------------------------------------------------------------
          INC       IBAWEBCD
.
          INC       CALCAGE
          INC       CLNHIMAS          * Clear nhimasaf file variables
          INC       CLPATMAS
          INC       CLPATMIS
          INC       CLPMSPX2
          INC       CLPMSCEX
          INC       CLPMSRES
          INC       DGCLICMR                                           *C-90205
          INC       DGCLICUP                                           *C-90205
          INC       DGCLICUR
          INC       MERGECOD
          INC       NAMSTRCD
          INC       PATBRDTM
          INC       PATCOMN2
          INC       PATCOMN3                * for GPERD
          INC       PATDOCCD
          INC       PATDOCTM
          INC       PATMASTM
          INC       PATMISTM
          INC       PATMSXTM
          INC       PATNAMCD
          INC       PMIGTNID
          INC       PMSCEXCD
          INC       PMSCEXTM
          INC       PMSHCGTM
          INC       PMSHCPTM
          INC       PMSPX2TM
          INC       PTMTBABY
          INC       SVPMSPX2
          INC       WEBCHGUR          * Copy of CHANGEUR for web
          INC       PMSOSDTM
          INC       MRTVISCD
          INC       CLMRTMAS
          INC       OPTHETAT
.
          INC       NEWBNMAS
          INC       NEWBDMAS
          INC       AAEDE1IO/INC       * A&E Details file
          INC       AAEDEBIO/INC 
          INC       ALLEDTIO/INC
          INC       ALLETXIO/INC
          INC       ALLLINIO/INC
          INC       ALLLONIO/INC
          INC       ALLPCTIO/INC
          INC       ALLREFIO/INC
          INC       APSMASIO/INC
          INC       BOKRC1IO/INC
          INC       EMRVISIO/INC       * Emergency
          INC       EOCLNKIO/INC
          INC       LEGALTIO/INC
          INC       LEGBOAIO/INC
          INC       LEGDEAIO/INC
          INC       LEGDSCIO/INC
          INC       LEGINVIO/INC
          INC       LEGMISIO/INC
          INC       LEGTRNIO/INC
          INC       LEGVISIO/INC
          INC       MLTSECIO/INC
          INC       MRTMASIO/INC
          INC       MRTVISIO/INC
          INC       NHIETHIO/INC
          INC       NHIMASIO/INC
          INC       OPRDEAIO/INC
          INC       OUTARTIO/INC
          INC       OUTBB1IO/INC
          INC       OUTBOAIO/INC
          INC       OUTCANIO/INC
          INC       OUTCLIIO/INC
          INC       OUTPREIO/INC
          INC       OUTSITIO/INC
          INC       PATALRIO/INC
          INC       PATAM1IO/INC
          INC       PATAXEIO/INC       * Admission extension file
          INC       PATBRDIO/INC
          INC       PATCMCIO/INC
          INC       VISMDTIO/INC
          INC       VISMTXIO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PATCCHIO/INC
          INC       PATDADIO/INC
          INC       PATDGWIO/INC
          INC       PATDO1IO/INC
          INC       PATDRGIO/INC
          INC       PATDSCIO/INC
          INC       PATECDIO/INC
          INC       PATFN1IO/INC
          INC       PATGSRIO/INC
          INC       PATIN1IO/INC
          INC       PATINVIO/INC
          INC       PATITMIO/INC
          INC       PATLOCIO/INC
          INC       PATLINIO/INC
          INC       PATMA1IO/INC
          INC       PATMI1IO/INC
          INC       PMSCEXIO/INC
          INC       MEHVI1IO/INC
          INC       PATMRGIO/INC
          INC       PATNIDIO/INC
          INC       PATASFIO/INC
          INC       PATPR1IO/INC
          INC       PATRE1IO/INC
          INC       PATTRNIO/INC
          INC       PATUADIO/INC
          INC       PATURAIO/INC
          INC       PATURCIO/INC         * U/R no. change audit file
          INC       PATVADIO/INC
          INC       PATVISIO/INC
          INC       PATWR1IO/INC            * ward/bed file
.
          INC       PMSCCDIO/INC   * Concession Card Details
          INC       PMSALNIO/INC
          INC       PMSADWIO/INC
          INC       PMSCURIO/INC
          INC       PMSBORIO/INC
          INC       PMSEDWIO/INC
          INC       PMSNEWIO/INC
          INC       PMSHCGIO/INC
          INC       PMSHCLIO/INC
          INC       PMSHCPIO/INC
          INC       PMSOOSIO/INC
          INC       PMSRESIO/INC
          INC       PMSRELIO/INC
          INC       PMSTLEIO/INC
          INC       PMSPX2IO/INC
          INC       PMSPTDIO/INC
          INC       PMSMUPIO/INC       * Missing UPI Patients
          INC       PMSVX1IO/INC
          INC       PRSPMIIO/INC
          INC       RESLNKIO/INC
          INC       WATESMIO/INC
          INC       WATESPIO/INC
          INC       WATTR1IO/INC
          INC       WATTX1IO/INC
          INC       PATHSPIO/INC
          INC       PMSTSPIO/INC
          INC       PMSUPDIO/INC
.          INC       PMSIPLIO/INC
          INC       PMSNPLIO/INC
.
.          INC       PMSIPLCD
          INC       TFILENAM
          INC       PMSEHBIO/INC
          INC       PATWC1IO/INC
          INC       ACCLODIO/INC
          INC       CLPATATR
          INC       CLPMSNPL
          INC       PATATRIO/INC
+

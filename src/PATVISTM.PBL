.----------------------------------------------------------------------
. Program       : PATVISTM
.
. Function      : Output Visit Variable            
.
. Modifications :
.----------------------------------------------------------------------
.  V11.04.02  26/03/2024 Bella Turco    TSK 0914658
.             Removed tag VISS7000
.  V11.04.01  26/03/2024 Bella Turco    TSK 0914658
.             Added tag VISS7000 for Visit Type/Status
.----------------------------------------------------------------------
.  V11.01.01  19/01/2022 Ebon Clements  TSK 0888071
.             Added tgs for PMVXADMP, PMVXCONO and PMVXMEDH
.----------------------------------------------------------------------
.  V11.00.01  17/03/2020 Tracey Nguyen  TSK 0887397
.             Added VISS6600 for PMVXUD13 (Cat N - NDIS Participant flag)
.----------------------------------------------------------------------
.  V10.14.01  06/03/2019 Tracey Nguyen  TSK 0863060
.             1) Added VISS6400 - default first Cat SH with HDP=7(Statistical)
.             2) Added VISS6500 - default first active Transfer code with
.                Destination type=S(Statistical)
.----------------------------------------------------------------------
.  V10.12.01  15/05/2018 Thanh T.       TSK 0851528
.             Added VISS6300 for PMVXUD12 (Cat rT - reason for transfer)
.----------------------------------------------------------------------
.  V10.11.01  10/11/2017 Ebon Clements  TSK 0843363
.             Added Cat ae and af to PMVXUD10/11
.  V10.10.02  22/03/2017 Peter Vela     TSK 0833050
.             Changed category dp to lj
.  V10.10.01  06/03/2017 Peter Vela     TSK 0833050
.             Moved Category dp to pmvxudf9
.  V10.08.01  15/06/2016 Ebon Clements  TSK 0322380
.             Added .2 to display blank if inform GP is unknown - VISF2500
.  V10.07.01  19/10/2015 Don Nguyen     CAR 316625
.             Added VISS6200 - Case Team
.  V10.06.06  16/09/2015 Don Nguyen     CAR 308621
.             Modified GETFAX00 - Use HCP Fax Number if not blank; otherwise
.             use the linked Practice Fax Number.
.  V10.06.05  13/08/2015 Don Nguyen     CAR 308621
.             Added VISS6100 - Referring HCP Fax Number
.  V10.06.04  01/06/2015 Jill Parkinson CAR 317467
.             Moved Category YF to pmvxudf8
.  V10.06.03  27/04/2015 Jill Parkinson CAR 315241
.             Added use of Category YF for pmvxudf7
.  V10.06.02  25/04/2015 Jill Parkinson CAR 311205
.             Fixed VISS6000 to just call CODITM00
.  V10.06.01  12/03/2015 Ania P         CAR 311205
.             Added VISS5900 & VISS6000
.  V10.03.02  18/01/2013 Ebon Clements  CAR 262292
.             Added interpreter required and pmi language tag VISS5800
.  V10.03.01  23/07/2012 Ebon Clements  CAR 217579
.             Added patient BMI tag
.  V10.02.05  19/10/2011 Davin          CAR 252611
.             Added output of 'Unknown' for Inform GP (visf2500)
.  V10.02.04  18/08/2011 Jill Parkinson CAR 247832
.             Added output of ptwdsdes - ward short description
.  V10.02.03  04/08/2011 Jill Parkinson CAR 247832
.             Changed output of pmvxeddt to be a date format
.  V10.02.01  23/06/2011  Peter McMullen  CAR 240725
.             Change ward selection list to be ordered by name, not code
.  V10.01.01  13/12/2010  Jill Parkinson  CAR 233088
.             Added output of PMVXFNDM
.  V10.00.02  17/08/2010  Davin         CAR 223805
.             Only display active program codes in selection list (vispc000)
.  V10.00.01  07/07/2010  Mike Laming   CAR 220069
.             Change CGI var to test for 1=Yes (not 0=No) for PMVXINGP
.   V9.11.04  07/04/2009  Peter Veal    CAR 183976
.             Added PMVXPILC - Presenting Illness Code
.   V9.11.03  13/03/2009  Jill Habasque CAR 187979
.             Added PMVXPGID - Program Identifier 
.   V9.11.02  04/03/2009  Peter Vela    CAR 183976
.             Added PMVXPOEC - Patient OEC Consent
.   V9.11.01  01/12/2008  Ebon Clements CAR 174057
.             Added PMVXPOWD - selection list tag
.   V9.09.01  03/10/2007  Ebon Clements CAR 150561
.             Added PMVXASUT and PMVXPPPT tags
.   V9.08.01  26/04/2008  Jill Habasque CAR 138049
.             Added PMVXQASN
.   V9.07.09  29/08/2006  Ebon Clements CAR 117379
.             Added PMVXEOCL, PMVXSLOC, PMVXSCLI & PMVXSTRA
.   V9.04.07  29/11/2005  Mike Laming   CAR 86040
.             Added variable PMVXPRGM (PTVIS099)
.   V9.04.06  13/07/2005 Davin         CAR 66431
.             Changed hcp practice tag (visf3200) to get name from pmshcgaf
.   V9.04.05  07/02/2005 Jill Habasque CAR 56347
.             Added extra doctor Unit fields
.   V9.04.04  22/12/2004 Lina Vo       CAR 55990
.             Changed PMVXPWGT.  FORM 4.2 is stored as FORM 6.
.             NOTE: Remember to Multiply/Divide by 100
.   V9.04.03  03/11/2004 Peter Vela CAR 53371
.             Added variable PMVXPSYP
.             Added variable PMVXFINP
.             Added variable PMVXREAD
.             Added variable PMVXUSAC
.   V9.04.02  24/08/2004 Lina Vo  CAR 52746
.             Renamed Hospital Selection routine - already existed in PATWRDTM
.   V9.04.01  18/08/2004 Lina Vo  CAR 52746
.             Added PMVXMHOS tag with read of pathspaf file for 
.             description and selection list.        
.   V9.02.05  12/03/2003 J.Tan
.             Removing multiple tags for admitting point (49 and 90)
.   V9.02.04  03/10/2002 Peter Vela     SRF 17693
.             Mods to Change Admitting Point to read from patcodes
.   V9.02.03  05/06/2002 J.Tan     
.             Added variable Patient visit extension file variables   
.   V9.02.02  17/12/2001 Pat Dirito
.             Added variable PMVXPICD                                 
.   V9.02.01  Glenn Saunders - Change PMVXCSNR flag interpretation.
.----------------------------------------------------------------------
.
          INC       PATDOCCD
          INC       PMSHCGIO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCLIO/INC
.
.------------------------------------------------------------
. Claim Details 
.------------------------------------------------------------
VISF0000  BRANCH    FLDITMNO,VISF0100,VISF0200,VISF0300,VISF0400,VISF0500:
                             VISF0600,VISF0700,VISF0800,VISF0900,VISF1000:
                             VISF1100,VISF1200,VISF1300,VISF1400,VISF1500:
                             VISF1600,VISF1700,VISF1800,VISF1900,VISF2000:
                             VISF2100,VISF2200,VISF2300,VISF2400,VISF2500:
                             VISF2600,VISF2700,VISF2800,VISF2900,VISF3000:
                             VISF3100,VISF3200,VISF3300,VISF3400,VISF3500:
                             VISF3600,VISF3700,VISF3800,VISF3900,VISF4000:
                             VISF4100,VISF4200,VISF4300,VISF4400,VISF4500:
                             VISF4600,VISF4700,VISF4800,VISF4900,VISF5000:
                             VISF5100,VISF5200,VISF5300,VISF5400,VISF5500:
                             VISF5600,VISF5700,VISF5800,VISF5900,VISF6000:
                             VISF6100,VISF6200,VISF6300,VISF6400,VISF6500:
                             VISF6600,VISF6700,VISF6800,VISF6900,VISF7000:
                             VISF7100,VISF7200,VISF7300,VISF7400,VISF7500:
                             VISF7600,VISF7700,VISF7800,VISF7900,VISF8000:
                             VISF8100,VISF8200,VISF8300,VISF8400,VISF8500:
                             VISF8600,VISF8700,VISF8800,VISF8900,VISF9000:
                             VISF9100,VISF9200,VISF9300,VISF9400,VISF9500:
                             VISF9600,VISF9700,VISF9800
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      VISF9999
.
VISF0100  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          WRITE     HTMLFILE;LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO;
          GOTO      VISF9999
.
VISF0200  WRITE     HTMLFILE;PVIURNO;
          GOTO      VISF9999
VISF0300  WRITE     HTMLFILE;PVIDATE; 
          GOTO      VISF9999
VISF0400  WRITE     HTMLFILE;PVIBILL;
          GOTO      VISF9999
VISF0500  WRITE     HTMLFILE;PVITYPE;
          GOTO      VISF9999
VISF0600  WRITE     HTMLFILE;PVIDOCT; 
          GOTO      VISF9999
VISF0700  WRITE     HTMLFILE;PVISTAT;  
          GOTO      VISF9999
VISF0800  WRITE     HTMLFILE;PVITRAN;  
          GOTO      VISF9999
VISF0900  WRITE     HTMLFILE;PVILOCK;
          GOTO      VISF9999
VISF1000  WRITE     HTMLFILE;PVISITE;
          GOTO      VISF9999
VISF1100  WRITE     HTMLFILE;PVIRESI;
          GOTO      VISF9999
VISF1200  WRITE     HTMLFILE;PVIUNQE;
          GOTO      VISF9999
VISF1300  WRITE     HTMLFILE;PVISPAR;
          GOTO      VISF9999
VISF1400  PACK      KEY6,SP6
          CALL      RSIBTH1
VISF1475  CALL      RKIBTH1
          BRANCH    OVRCD,VISF9999
.
          IF        IBTHSTFM>6
            GOTO      VISF1475
          ENDIF
.
          LOAD      F1,IBTHSTFM,TWO,ONE,THREE,THREE,THREE,THREE
          COMPARE   F1,PVITYPE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",IBTHSCOD,"#">":
                               IBTHDESC,"</option>";
          ENDIF
          GOTO      VISF1475
.
VISF1500  WRITE     HTMLFILE;PVISYST;
          GOTO      VISF9999
.***********************************************************************
. insertig here JAIDEEP - HPS
.***********************************************************************
VISF1600  WRITE     HTMLFILE;PMVXVISN;        * visit number
          GOTO      VISF9999
.
VISF1700  MATCH     PMVXVSDT,SP70             * visit date
          GOTO      VISF9999 IF EQUAL
          UNPACK    PMVXVSDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      VISF9999
.
VISF1800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF1810
          PACK      KEY6,PMVXDOCA,SP6
          CALL      RDDOCT1
          BRANCH    OVRCD,VISF9999
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF1810  WRITE     HTMLFILE;PMVXDOCA;
          GOTO      VISF9999
.
VISF1900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF1910
          PACK      KEY6,PMVXDOCT,SP6
          CALL      RDDOCT1 
          BRANCH    OVRCD,VISF9999
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF1910  WRITE     HTMLFILE;PMVXDOCT;
          GOTO      VISF9999
.
VISF2000  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Consent Release info     
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF2010
          WRITE     HTMLFILE;PMVXCSNR;
          GOTO      VISF9999
VISF2010  MATCH     "1",PMVXCSNR              * .1 
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";  
          ENDIF
          GOTO      VISF9999
.
VISF2100  WRITE     HTMLFILE;PMVXPOST;        * Post Code
          GOTO      VISF9999
.
VISF2200  MOVE      "PV",CATEGORY             * Privacy Indicator
          PACK      CODE,PMVXPIND,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF2300  WRITE     HTMLFILE;PMVXVLOC;        * Valuables Location
          GOTO      VISF9999
.
VISF2400  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Claims form Signed     
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF2410
          WRITE     HTMLFILE;PMVXCFSG;
          GOTO      VISF9999
VISF2410  MATCH     "0",PMVXCFSG              * .1 
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISF9999
.
VISF2500  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Information registered     
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF2510,VISF2510
.
          WRITE     HTMLFILE;PMVXINGP;
          GOTO      VISF9999
VISF2510  MATCH     "1",PMVXINGP              * .1                    *C-220069
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          MATCH     "0",PMVXINGP              * .1                    *C-220069
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          MATCH     "2",PMVXINGP              * .1 blank if .2
          IF        @EQUAL
            IF        F1<>2
              WRITE     HTMLFILE;"Unknown";
            ENDIF
          ENDIF
          GOTO      VISF9999
.
VISF2600  MOVE      "PW",CATEGORY             * Critical Pathway 
          PACK      CODE,PMVXCPTH,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF2700  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Notify HCP1      
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF2710
          WRITE     HTMLFILE;PMVXHCP1;
          GOTO      VISF9999
VISF2710  MATCH     "0",PMVXHCP1              * .1 
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISF9999
.
VISF2800  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Notify HCP2      
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF2810
          WRITE     HTMLFILE;PMVXHCP2;
          GOTO      VISF9999
VISF2810  MATCH     "0",PMVXHCP2              * .1 
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISF9999
.
VISF2900  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Notify HCP3      
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF2910
          WRITE     HTMLFILE;PMVXHCP3;
          GOTO      VISF9999
VISF2910  MATCH     "0",PMVXHCP3              * .1 
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISF9999
.
VISF3000  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Notify HCP4
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF3010
          WRITE     HTMLFILE;PMVXHCP4;
          GOTO      VISF9999
VISF3010  MATCH     "0",PMVXHCP4              * .1 
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISF9999
.
VISF3100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF3110
          PACK      KEY10,PMVXRHC1,SP30
          CALL      RDPMHCP1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF3110  WRITE     HTMLFILE;PMVXRHC1;
          GOTO      VISF9999
.
VISF3200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF3210
          PACK      KEY12,PMVXRH1G,PMVXRH1C,SP30
          CALL      RDPMHCG1
          BRANCH    OVRCD,VISF9999
          WRITE     HTMLFILE;PMHGPNAM;
          GOTO      VISF9999
.
VISF3210  WRITE     HTMLFILE;PMVXRH1G;
          GOTO      VISF9999
.
VISF3300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF3310
          PACK      KEY10,PMVXRH1C,SP30
          CALL      RDPMHCG1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF3310  WRITE     HTMLFILE;PMVXRH1C;
          GOTO      VISF9999
.
VISF3400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF3410
          PACK      KEY10,PMVXRHC2,SP30
          CALL      RDPMHCP1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF3410  WRITE     HTMLFILE;PMVXRHC2;
          GOTO      VISF9999
.
VISF3500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF3510
          PACK      KEY10,PMVXRH2G,SP30
          CALL      RDPMHCL1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF3510  WRITE     HTMLFILE;PMVXRH2G;
          GOTO      VISF9999
.
VISF3600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF3610
          PACK      KEY10,PMVXRH2C,SP30
          CALL      RDPMHCG1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF3610  WRITE     HTMLFILE;PMVXRH2C;
          GOTO      VISF9999
.
VISF3700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF3710
          PACK      KEY10,PMVXRHC3,SP30
          CALL      RDPMHCP1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF3710  WRITE     HTMLFILE;PMVXRHC3;
          GOTO      VISF9999
.
VISF3800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF3810
          PACK      KEY10,PMVXRH3G,SP30
          CALL      RDPMHCL1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF3810  WRITE     HTMLFILE;PMVXRH3G;
          GOTO      VISF9999
.
VISF3900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF3910
          PACK      KEY10,PMVXRH3C,SP30
          CALL      RDPMHCG1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF3910  WRITE     HTMLFILE;PMVXRH3C;
          GOTO      VISF9999
.
VISF4000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF4010
          PACK      KEY10,PMVXRHC4,SP30
          CALL      RDPMHCP1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF4010  WRITE     HTMLFILE;PMVXRHC4;
          GOTO      VISF9999
.
VISF4100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF4110
          PACK      KEY10,PMVXRH4G,SP30
          CALL      RDPMHCL1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF4110  WRITE     HTMLFILE;PMVXRH4G;
          GOTO      VISF9999
.
VISF4200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF4210
          PACK      KEY10,PMVXRH4C,SP30
          CALL      RDPMHCG1
          BRANCH    OVRCD,VISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF4210  WRITE     HTMLFILE;PMVXRH4C;
          GOTO      VISF9999
.
VISF4300  MOVE      "VA",CATEGORY             * Aboriginality (VA)
          PACK      CODE,PMVXABRG,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF4400  MOVE      "VB",CATEGORY             * Admission Criterion
          PACK      CODE,PMVXCADM,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF4500  MOVE      "VR",CATEGORY             * Intent to Re-Admit 
          PACK      CODE,PMVXIRAD,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF4600  MOVE      "VI",CATEGORY             * Intent Stay Durnation
          PACK      CODE,PMVXIDUS,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF4700  MOVE      "VK",CATEGORY             * Carer Availability 
          PACK      CODE,PMVXCRAV,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF4800  MOVE      "VJ",CATEGORY             * Crit. Care After reasion
          PACK      CODE,PMVXRCCT,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF4900  
          GOTO      VISF9999  
.
VISF5000  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Admitting point Bed 
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF5010
          WRITE     HTMLFILE;PMVXAPBD;
          GOTO      VISF9999
VISF5010  PACK      KEY6,PMVXAPWD,PMVXAPBD,SP70    * .1   Ward/bed description
          CALL      RDWARD1 
          BRANCH    OVRCD,VISF9999
          WRITE     HTMLFILE;WBDESC;      
          GOTO      VISF9999
.
VISF5100  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Post-Op Ward 
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF5110,VISF5120,VISF5110
.
          WRITE     HTMLFILE;PMVXPOWD;
          GOTO      VISF9999
.
VISF5110  PACK      KEY6,PMVXPOWD,SP70        * .1   Ward description
          CALL      RDWARD1 
          BRANCH    OVRCD,VISF9999
.
          IF        F1=3
            WRITE     HTMLFILE;PTWDSDES;      * .3 Short description
          ELSE
            WRITE     HTMLFILE;WBDESC;      
          ENDIF
          GOTO      VISF9999
.
VISF5120  PACK      KEY3,PMVXPOWD             * .2 Ward selction list 
          PROC      VWSLP000
          GOTO      VISF9999
.
.
VISF5200  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Post-Op Bed 
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF5210,VISF5210
          WRITE     HTMLFILE;PMVXPOBD;
          GOTO      VISF9999
VISF5210  PACK      KEY6,PMVXPOWD,PMVXPOBD,SP70    * .1   Ward/bed description
          CALL      RDWARD1 
          BRANCH    OVRCD,VISF9999
          IF        F1=2
            WRITE     HTMLFILE;PTWDSDES;      * .2 Short description
          ELSE
            WRITE     HTMLFILE;WBDESC;      
          ENDIF
          GOTO      VISF9999
.
VISF5300  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Parent staying    
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF5310
          WRITE     HTMLFILE;PMVXPSTY;
          GOTO      VISF9999
VISF5310 MATCH     "0",PMVXPSTY              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISF9999
.
VISF5400  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Visitors allowed   
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF5410
          WRITE     HTMLFILE;PMVXVALW;
          GOTO      VISF9999
VISF5410  MATCH     "0",PMVXVALW              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISF9999
.
VISF5500  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Phone Calls Allowed
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF5510
          WRITE     HTMLFILE;PMVXPALW;
          GOTO      VISF9999
VISF5510  MATCH     "0",PMVXPALW              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISF9999
.
VISF5600  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Intended Day Case 
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF5610
          WRITE     HTMLFILE;PMVXINDC;
          GOTO      VISF9999
VISF5610  MATCH     "0",PMVXINDC              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISF9999
.
VISF5700  MOVE      "VM",CATEGORY             * Mode of Arrival         
          PACK      CODE,PMVXMDAV,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF5800  MOVE      "VF",CATEGORY             * Forms                   
          PACK      CODE,PMVXFRMS,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF5900  MOVE      "VN",CATEGORY             * Code Snags              
          PACK      CODE,PMVXCSNG,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
.         Change Form 6 to Form 4.2
VISF6000  IF        PMVXPWGT=0
            WRITE     HTMLFILE;PMVXPWGT;    * Patient Weight
          ELSE
            MOVE      PMVXPWGT,F6P2
            DIV       "100",F6P2
            WRITE     HTMLFILE;F6P2;        * Patient Weight
          ENDIF  
          GOTO      VISF9999
.
VISF6100  WRITE     HTMLFILE;PMVXPHGT;        * Patient Height
          GOTO      VISF9999
.
VISF6200  MATCH     PMVXDHWR,SP70             * Date height/weight recorded 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXDHWR,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      VISF9999
.
VISF6300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF6310
          PACK      KEY6,PMVXEDC1,SP6
          CALL      RDDOCT1 
          BRANCH    OVRCD,VISF9999
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF6310  WRITE     HTMLFILE;PMVXEDC1;
          GOTO      VISF9999
.
VISF6400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF6410
          PACK      KEY6,PMVXEDC2,SP6
          CALL      RDDOCT1 
          BRANCH    OVRCD,VISF9999
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF6410  WRITE     HTMLFILE;PMVXEDC2;
          GOTO      VISF9999
.
VISF6500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF6510
          PACK      KEY6,PMVXEDC3,SP6
          CALL      RDDOCT1 
          BRANCH    OVRCD,VISF9999
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      VISF9999
.
VISF6510  WRITE     HTMLFILE;PMVXEDC3;
          GOTO      VISF9999
.
VISF6600  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Homeless Person  
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF6610
          WRITE     HTMLFILE;PMVXHOME;
          GOTO      VISF9999
VISF6610  MATCH     "0",PMVXHOME              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ELSE
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISF9999
.
VISF6700  WRITE     HTMLFILE;PMVXUDF1;        * User Defined Free format 1
          GOTO      VISF9999
.
VISF6800  WRITE     HTMLFILE;PMVXUDF2;        * User Defined Free format 2
          GOTO      VISF9999
.
VISF6900  WRITE     HTMLFILE;PMVXUDF3;        * User Defined Free format 3
          GOTO      VISF9999
.
VISF7000  WRITE     HTMLFILE;PMVXUDF4;        * User Defined Free format 4
          GOTO      VISF9999
.
VISF7100  MATCH     PMVXUDT1,SP70             * User Def. Date 1 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT1,CCENT,CYEAR,CMON,CDAY,KEY5
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VISF9999
.
VISF7200  MATCH     PMVXUDT1,SP70             * User Def. time 1 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT1,CCENT,CYEAR,CMON,CDAY,KEY5
          WRITE     HTMLFILE;KEY5;
          GOTO      VISF9999
.
VISF7300  MATCH     PMVXUDT2,SP70             * User Def. Date 2 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT2,CCENT,CYEAR,CMON,CDAY,KEY5
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VISF9999
.
VISF7400  MATCH     PMVXUDT2,SP70             * User Def. time 2 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT2,CCENT,CYEAR,CMON,CDAY,KEY5
          WRITE     HTMLFILE;KEY5;
          GOTO      VISF9999
.
VISF7500  MATCH     PMVXUDT3,SP70             * User Def. Date 3 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT3,CCENT,CYEAR,CMON,CDAY,KEY5
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VISF9999
.
VISF7600  MATCH     PMVXUDT3,SP70             * User Def. time 3 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT3,CCENT,CYEAR,CMON,CDAY,KEY5
          WRITE     HTMLFILE;KEY5;
          GOTO      VISF9999
.
VISF7700  MATCH     PMVXUDT4,SP70             * User Def. Date 4 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT4,CCENT,CYEAR,CMON,CDAY,KEY5
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VISF9999
.
VISF7800  MATCH     PMVXUDT4,SP70             * User Def. time 4 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT4,CCENT,CYEAR,CMON,CDAY,KEY5
          WRITE     HTMLFILE;KEY5;
          GOTO      VISF9999
.
VISF7900  MATCH     PMVXUDT5,SP70             * User Def. Date 5 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT5,CCENT,CYEAR,CMON,CDAY,KEY5
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VISF9999
.
VISF8000  MATCH     PMVXUDT5,SP70             * User Def. time 5 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT5,CCENT,CYEAR,CMON,CDAY,KEY5
          WRITE     HTMLFILE;KEY5;
          GOTO      VISF9999
.
VISF8100  MATCH     PMVXUDT6,SP70             * User Def. Date 6 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT6,CCENT,CYEAR,CMON,CDAY,KEY5
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VISF9999
.
VISF8200  MATCH     PMVXUDT6,SP70             * User Def. time 6 
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXUDT6,CCENT,CYEAR,CMON,CDAY,KEY5
          WRITE     HTMLFILE;KEY5;
          GOTO      VISF9999
.
VISF8300  MATCH     PMVXCDTE,SP70             * Date Record Created
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXCDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VISF9999
.
VISF8400  MATCH     PMVXCTIM,SP70             * Time Record Created
          GOTO      VISF9999 IF EQUAL   
          WRITE     HTMLFILE;PMVXCTIM;
          GOTO      VISF9999
.
VISF8500  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Web User ID rec. creator
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF8510
          WRITE     HTMLFILE;PMVXWEBC;
          GOTO      VISF9999
VISF8510  PACK      KEY10,PMVXWEBC,SP70       * .1
          CALL      RDWBSE1 
          BRANCH    OVRCD,VISF9999
          WRITE     HTMLFILE;WBSENAM;
          GOTO      VISF9999
.
VISF8600  MATCH     PMVXLUPD,SP70             * Date Record Last Updated
          GOTO      VISF9999 IF EQUAL   
          UNPACK    PMVXLUPD,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VISF9999
.
VISF8700  MATCH     PMVXLUPT,SP70             * Time Record Last Update
          GOTO      VISF9999 IF EQUAL   
          WRITE     HTMLFILE;PMVXLUPT
.          WRITE     HTMLFILE;PMVXLUDT;
          GOTO      VISF9999
.
VISF8800  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Web User ID rec. update
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISF8810
          WRITE     HTMLFILE;PMVXWEBU;
          GOTO      VISF9999
VISF8810  PACK      KEY10,PMVXWEBU,SP70       * .1
          CALL      RDWBSE1 
          BRANCH    OVRCD,VISF9999
          WRITE     HTMLFILE;WBSENAM;
          GOTO      VISF9999
.
VISF8900  MOVE      "LS",CATEGORY             * Mental Health Legal status 
          PACK      CODE,PMVXMHLS,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF9000  MOVE      "ap",CATEGORY                   * I SRF 17693
          MOVE      PMVXAPWD,CODE                   * Set parameter
          CALL      CODITM00                        * Look in patcodes for desc
          GOTO      VISF9999                        * end I SRF 17693
.
VISF9100  MATCH     PMVXPICD,SP70          * Provisional ICD10 Code  
          GOTO      VISF9999 IF EQUAL   
          WRITE     HTMLFILE;PMVXPICD;
          GOTO      VISF9999
.
VISF9200  MOVE      "KN",CATEGORY         * Discharge Intention 
          PACK      CODE,PMVXUDIN,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF9300  MOVE      "KG",CATEGORY         * Involvement in Palliat Care
          PACK      CODE,PMVXPALC,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF9400  MOVE      "KO",CATEGORY         * Unplanned Readmission
          PACK      CODE,PMVXUREA,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF9500  MOVE      "KB",CATEGORY         * Unplanned Visit to theatre
          PACK      CODE,PMVXUVTH,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF9600  MOVE      "KH",CATEGORY         * Prev Non-Admitt Palliat Care
          PACK      CODE,PMVXPPAL,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
VISF9700  MOVE      "KC",CATEGORY         * Elective Patient Status
          PACK      CODE,PMVXELPS,SP70
          CALL      CODITM00
          GOTO      VISF9999
.
. Link to next visit variables
.
VISF9800  UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,FLDITMNO
          CALL      VISS0000
          GOTO      MASF9999
.
VISF9999  RETURN
.


.------------------------------------------------------------ 
. Ward selection
.------------------------------------------------------------
.
.*****************************************************************************
.*  VWSLP000
.*  Procedure to build a ward selection list.
.*  This is packaged as a procedure to insulate parent code 
.*  from patwr1af index 7 (bed,hospital,description,ward) 
.*  KEY3 contains the current ward code (if any)
.*****************************************************************************
          DEFPROC   VWSLP000
.
          OPEN      PATWR1A7,"patwr1af"
          PACK      KEY29,SP70
          IF        IBCNMHOS = 1
            PACK      KEY29,SP3,WBSEHOSP,SP70
          ENDIF
          CALL      RDSWARD7
VWSLP010  CALL      RDKWARD7
          BRANCH    OVRCD,VWSLP900
.
.                         if we have a bed number we have passed all the ward
.                         master records, so exit
          MATCH     SP70,WBED
          GOTO      VWSLP900 IF NOT EQUAL
.
          COMPARE   WACTIVE,ZERO                 *List only active wards
          GOTO      VWSLP010 IF NOT EQUAL
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        !@EQUAL
              MATCH     WBSEHOSP,PTWDHOSN
              GOTO      VWSLP900 IF NOT EQUAL
            ENDIF
          ENDIF
.
.                       write the select option.
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#"";
          MATCH     KEY3,WWARD
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">",WBDESC;
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;" - ",PTWDHOSN;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      VWSLP010
.
VWSLP900  CLOSE     PATWR1A7
.
          ENDPROC                                                                                                                                  
+
.------------------------------------------------------------
. Claim Details
.------------------------------------------------------------
VISS0000  BRANCH    FLDITMNO,VISS0100,VISS0200,VISS0300,VISS0400,VISS0500:
                             VISS0600,VISS0700,VISS0800,VISS0900,VISS1000:
                             VISS1100,VISS1200,VISS1300,VISS1400,VISS1500:
                             VISS1600,VISS1700,VISS1800,VISS1900,VISS2000:
                             VISS2100,VISS2200,VISS2300,VISS2400,VISS2500:
                             VISS2600,VISS2700,VISS2800,VISS2900,VISS3000:
                             VISS3100,VISS3200,VISS3300,VISS3400,VISS3500:
                             VISS3600,VISS3700,VISS3800,VISS3900,VISS4000:
                             VISS4100,VISS4200,VISS4300,VISS4400,VISS4500:
                             VISS4600,VISS4700,VISS4800,VISS4900,VISS5000:
                             VISS5100,VISS5200,VISS5300,VISS5400,VISS5500:
                             VISS5600,VISS5700,VISS5800,VISS5900,VISS6000:
                             VISS6100,VISS6200,VISS6300,VISS6400,VISS6500:
                             VISS6600,VISS6700,VISS6800,VISS6900
.                                                                 
VISS0100  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Marketing Info
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS0110,VISS0120
          WRITE     HTMLFILE;PMVXPRMI;
          GOTO      VISS9999
VISS0110  MATCH     "1",PMVXPRMI              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMVXPRMI
            IF        @EQUAL
              WRITE     HTMLFILE;"No ";
            ENDIF
          ENDIF
          GOTO      VISS9999
.
VISS0120  MOVE      PMVXPRMI,F1              * .2
          CALL      FLDTYP00
          GOTO      VISS9999
.
VISS0200  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Advertising
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS0210,VISS0220
          WRITE     HTMLFILE;PMVXPRAI;
          GOTO      VISS9999
VISS0210  MATCH     "1",PMVXPRAI              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMVXPRAI
            IF        @EQUAL
              WRITE     HTMLFILE;"No ";
            ENDIF
          ENDIF
          GOTO      VISS9999
.
VISS0220  MOVE      PMVXPRAI,F1              * .2
          CALL      FLDTYP00
          GOTO      VISS9999
.
VISS0300  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Research
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS0310,VISS0320
          WRITE     HTMLFILE;PMVXPRES;
          GOTO      VISS9999
VISS0310  MATCH     "1",PMVXPRES              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMVXPRES
            IF        @EQUAL
              WRITE     HTMLFILE;"No ";
            ENDIF
          ENDIF
          GOTO      VISS9999
.
VISS0320  MOVE      PMVXPRES,F1              * .2
          CALL      FLDTYP00
          GOTO      VISS9999
.
VISS0400  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Training
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS0410,VISS0420
          WRITE     HTMLFILE;PMVXUITR;
          GOTO      VISS9999
VISS0410  MATCH     "1",PMVXUITR              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMVXUITR
            IF        @EQUAL
              WRITE     HTMLFILE;"No ";
            ENDIF
          ENDIF
          GOTO      VISS9999
.
VISS0420  MOVE      PMVXUITR,F1              * .2
          CALL      FLDTYP00
          GOTO      VISS9999
.
VISS0500  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Enduring POA
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS0510,VISS0520
          WRITE     HTMLFILE;PMVXRPOA;
          GOTO      VISS9999
VISS0510  MATCH     "1",PMVXRPOA              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMVXRPOA
            IF        @EQUAL
              WRITE     HTMLFILE;"No ";
            ENDIF
          ENDIF
          GOTO      VISS9999
.
VISS0520  MOVE      PMVXRPOA,F1              * .2
          CALL      FLDTYP00
          GOTO      VISS9999
.
VISS0600  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Contact 1
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS0610,VISS0620
          WRITE     HTMLFILE;PMVXRCN1;
          GOTO      VISS9999
VISS0610  MATCH     "1",PMVXRCN1              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMVXRCN1
            IF        @EQUAL
              WRITE     HTMLFILE;"No ";
            ENDIF
          ENDIF
          GOTO      VISS9999
.
VISS0620  MOVE      PMVXRCN1,F1              * .2
          CALL      FLDTYP00
          GOTO      VISS9999
.
VISS0700  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Contact 2
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS0710,VISS0720
          WRITE     HTMLFILE;PMVXRCN2;
          GOTO      VISS9999
VISS0710  MATCH     "1",PMVXRCN2              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMVXRCN2
            IF        @EQUAL
              WRITE     HTMLFILE;"No ";
            ENDIF
          ENDIF
          GOTO      VISS9999
.
VISS0720  MOVE      PMVXRCN2,F1              * .2
          CALL      FLDTYP00
          GOTO      VISS9999
.
VISS0800  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Health fund
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS0810,VISS0820
          WRITE     HTMLFILE;PMVXRHFU;
          GOTO      VISS9999
VISS0810  MATCH     "1",PMVXRHFU              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMVXRHFU
            IF        @EQUAL
              WRITE     HTMLFILE;"No ";
            ENDIF
          ENDIF
          GOTO      VISS9999
.
VISS0820  MOVE      PMVXRHFU,F1              * .2
          CALL      FLDTYP00
          GOTO      VISS9999
.
VISS0900  UNPACK    DIM127,D1,KEY1,DIM127     * .0   DVA
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS0910,VISS0920
          WRITE     HTMLFILE;PMVXRDVA;
          GOTO      VISS9999
VISS0910  MATCH     "1",PMVXRDVA              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMVXRDVA
            IF        @EQUAL
              WRITE     HTMLFILE;"No ";
            ENDIF
          ENDIF
          GOTO      VISS9999
.
VISS0920  MOVE      PMVXRDVA,F1              * .2
          CALL      FLDTYP00
          GOTO      VISS9999
.
VISS1000  UNPACK    DIM127,D1,KEY1,DIM127     * .0   RSL Visit Ok
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS1010,VISS1020
          WRITE     HTMLFILE;PMVXRSLO;
          GOTO      VISS9999
VISS1010  MATCH     "1",PMVXRSLO              * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "0",PMVXRSLO
            IF        @EQUAL
              WRITE     HTMLFILE;"No ";
            ENDIF
          ENDIF
          GOTO      VISS9999
.
VISS1020  MOVE      PMVXRSLO,F1              * .2
          CALL      FLDTYP00
          GOTO      VISS9999
.
VISS1100  MOVE      "MV",CATEGORY         * Medical Record Location
          PACK      CODE,PMVXMLOC,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS1200  MOVE      "BP",CATEGORY         * Preferred Accommodation
          PACK      CODE,PMVXPACC,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS1300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS1310,VISS1320  * 0=Desc 1=Code 2=Select
.
          PACK      KEY3,PMVXMHOS,SP10
          CALL      RDPTHSP1
          BRANCH    OVRCD,VISS9999
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      VISS9999
.
VISS1310  WRITE     HTMLFILE;PMVXMHOS;
          GOTO      VISS9999
.
VISS1320  MOVE      PMVXMHOS,D3
          CALL      VHSEL000
          GOTO      VISS9999
.
VISS1400  MOVE      "KK",CATEGORY         *Payment Status on Separation
          PACK      CODE,PMVXPYSP,SP70                                 *I-53371
          CALL      CODITM00
          GOTO      VISS9999
.
VISS1500  MOVE      "KE",CATEGORY         *Financial Program
          PACK      CODE,PMVXFINP,SP70                                 *I-53371
          CALL      CODITM00
          GOTO      VISS9999
.
VISS1600  MOVE     "KM",CATEGORY          *Readmission in 28 days
          PACK     CODE,PMVXREAD,SP70                                  *I-53371
          CALL     CODITM00
          GOTO     VISS9999
.
VISS1700  MOVE     "KP",CATEGORY          *Usual Accomodation
          PACK     CODE,PMVXUSAC,SP70                                  *I-53371
          CALL     CODITM00
          GOTO     VISS9999
.
VISS1800  MOVE     "AC",CATEGORY          *Extra Unit 1
          PACK     CODE,PMVXEDU1,SP70
          CALL     CODITM00
          GOTO     VISS9999
.
VISS1900  MOVE     "AC",CATEGORY          *Extra Unit 2
          PACK     CODE,PMVXEDU2,SP70
          CALL     CODITM00
          GOTO     VISS9999
.
VISS2000  MOVE     "AC",CATEGORY          *Extra Unit 3
          PACK     CODE,PMVXEDU3,SP70
          CALL     CODITM00
          GOTO     VISS9999
.
VISS2100  PROC     VISPC000               * display Program Code/s     *I-86040
          GOTO     VISS9999
.
VISS2200  WRITE     HTMLFILE;PMVXEOCL;    * EOC Link admission no.
          GOTO      VISS9999
.
VISS2300  MOVE      "SG",CATEGORY           * Location SOR
          PACK      CODE,PMVXSLOC,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS2400  MOVE      "SH",CATEGORY           * Clinical SOR
          PACK      CODE,PMVXSCLI,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS2500  MOVE      "SI",CATEGORY           * Transport SOR
          PACK      CODE,PMVXSTRA,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS2600  MOVE      "KD",CATEGORY            * Employment Status
          PACK      CODE,PMVXEMPL,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS2700  MATCH     SP70,PMVXQASN
          GOTO      VISS9999 IF EQUAL
.
          WRITE     HTMLFILE;PMVXQASN;       * QAS Number 
          GOTO      VISS9999
.
VISS2800  MOVE      "KA",CATEGORY            * Admission Service Unit Type
          PACK      CODE,PMVXASUT,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS2900  MOVE      "KI",CATEGORY            * Public/Private Patients
          PACK      CODE,PMVXPPPT,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS3000  WRITE     HTMLFILE;PMVXATIM;       * Arrival Time
          GOTO      VISS9999
.
VISS3100  WRITE     HTMLFILE;PMVXITIM;       * Interview Time
          GOTO      VISS9999
.
VISS3200  WRITE     HTMLFILE;PMVXPOEC;       * Patient OCE Consent
          GOTO      VISS9999
.
VISS3300  MOVE      "PK",CATEGORY            * Program Identifier 
          PACK      CODE,PMVXPGID,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS3400  MOVE      "il",CATEGORY            * Presenting Illness Code
          PACK      CODE,PMVXPILC,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS3500  WRITE     HTMLFILE;PMVXFNDM;       * Health fund membership number
          GOTO      VISS9999
.
VISS3600  WRITE     HTMLFILE;PMVXUDF6;       * UDF 6
          GOTO      VISS9999
.
VISS3700  WRITE     HTMLFILE;PMVXUDF7;       * Upload to PCEHR 0=No 1=Yes
          GOTO      VISS9999
.
VISS3800  MOVE      "YF",CATEGORY            * UDF 7 (NSW Referred to on sep)
          PACK      CODE,PMVXUDF8,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS3900  MOVE      "lj",CATEGORY            * UDF 9 Death Place
          PACK      CODE,PMVXUDF9,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS4000  MOVE      "ae",CATEGORY            * UDF 10 - Receive a survey
          PACK      CODE,PMVXUD10,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS4100  MOVE      "af",CATEGORY            * UDF 11 - Find out about Hosp
          PACK      CODE,PMVXUD11,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS4200  WRITE     HTMLFILE;PMVXUD12;       * UDF 12
          GOTO      VISS9999
.
VISS4300  WRITE     HTMLFILE;PMVXUD13;       * UDF 13
          GOTO      VISS9999
.
VISS4400  WRITE     HTMLFILE;PMVXUD14;       * UDF 14
          GOTO      VISS9999
.
VISS4500  WRITE     HTMLFILE;PMVXUD15;       * UDF 15
          GOTO      VISS9999
.
VISS4600  PROC      VISTM000                 * display Team/s
          GOTO      VISS9999
.
VISS4700  MOVE      "cw",CATEGORY    * Non WA Hospital Contact (Cat cw)
          PACK      CODE,PMVXNWHC,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS4800  MATCH     PMVXEDDT,SP70   * Expected Delivery Date (ccyymmdd)
          GOTO      VISS9999 IF EQUAL
          UNPACK    PMVXEDDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VISS9999
.
VISS4900  MOVE      "ps",CATEGORY * Property Held (Cat ps)
          PACK      CODE,PMVXPHLD,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS5000  MOVE      "pt",CATEGORY * Property Location (Cat pt)
          PACK      CODE,PMVXPLOC,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS5100  MATCH     PMVXDTRT,SP70             * Date Returned
          GOTO      VISF9999 IF EQUAL
          UNPACK    PMVXDTRT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      VISS9999
.
VISS5200  WRITE     HTMLFILE;PMVXDFLG; * Disaster Flag
          GOTO      VISS9999
.
VISS5300  MOVE      "cx",CATEGORY * Funding Source (Cat cx)
          PACK      CODE,PMVXFSRC,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS5400  WRITE     HTMLFILE;PMVXCONM; * Contributor Name
          GOTO      VISS9999
.
VISS5500  WRITE     HTMLFILE;PMVXPBMI; * Patient BMI        
          GOTO      VISS9999
.
VISS5600  COMPARE   ZERO,PMVXPWGT
          GOTO      VISS9999 IF EQUAL
.
          MOVE      PMVXPWGT,F6P2
          DIV       "100",F6P2
.
          MOVE      F6P2,KEY9
          SQUEEZE   KEY9
          WRITE     HTMLFILE;KEY9;           * Patient Weight
          RESET     KEY9
          GOTO      VISS9999
.
VISS5700  COMPARE   ZERO,PMVXPHGT
          GOTO      VISS9999 IF EQUAL
.
          MOVE      PMVXPHGT,KEY6
          SQUEEZE   KEY6
          WRITE     HTMLFILE;KEY6;       * Patient Height
          RESET     KEY6

          GOTO      VISS9999
.
VISS5800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS5850,VISS5860
.
          WRITE     HTMLFILE;PMVXINTR;
          GOTO      VISS9999
.
VISS5850  MATCH     "0",PMVXINTR
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          MATCH     "1",PMVXINTR
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          GOTO      VISS9999
.
. Display the interpreter required yes/no from the visit and the preferred
. language 1 from the pmi.
.
VISS5860  MATCH     " ",PMVXINTR
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
            GOTO      VISS9999
          ENDIF
.
          MATCH     "0",PMVXINTR
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
            GOTO      VISS9999
          ENDIF
.
          MATCH     "1",PMVXINTR
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
.
          MOVE      "LA",CATEGORY
          MOVE      PMPXLNG1,CODE
          CALL      GETCOD00
          MATCH     SP70,TDESC
          IF        !@EQUAL
            WRITE     HTMLFILE;" - <span class=#"Red#">",TDESC,"</span>";
          ENDIF
          GOTO      VISS9999
.
VISS5900  MOVE      "dr",CATEGORY            * Coding delay reason
          PACK      CODE,PMVXUDF5,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS6000  MOVE      "YE",CATEGORY            * Previous Specialized Treatment
          PACK      CODE,PMVXUDF6,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS6100  CALL      GETFAX00           * Get Referring HCP/Practice Fax Number
          GOTO      VISS9999
.
VISS6200  CALL      GETCAS00           * Get Case Team (Code/Desc)
          GOTO      VISS9999
.
VISS6300  MOVE      "rT",CATEGORY            * Reason for Transfer
          PACK      CODE,PMVXUD12,SP70
          CALL      CODITM00
          GOTO      VISS9999
.
VISS6400  PACK      KEY5,ANSS,ANSH,SP70     * Cat SH - Referred by (Clinician)
          CALL      RDSCODE1
VISS6410  CALL      RDKCODE1
          BRANCH    OVRCD,VISS9999
.
          MATCH     "7   ",THCSCOD          * Is HDP Field Statistical?
          GOTO      VISS6410 IF NOT EQUAL     * No, read next record
.
          WRITE     HTMLFILE;ACODE;           * Yes, return code
          GOTO      VISS9999
.
VISS6500  PACK      KEY5,SP70               * Transfer Source Code
          CALL      RSPTVAD1
VISS6510  CALL      RKPTVAD1
          BRANCH    OVRCD,VISS9999
.
          MATCH     ANSI,PTVAACTV           * Transfer code inactive?
          GOTO      VISS6510 IF EQUAL         * Yes, read next record
.
          MATCH     ANSS,PTVADTYP           * Destination type Statistical?
          GOTO      VISS6510 IF NOT EQUAL     * No, read next record
.
          WRITE     HTMLFILE;PTVACODE;        * Yes, return Trnf Destn Code
          GOTO      VISS9999
.
VISS6600  MOVE      "N ",CATEGORY            * NDIS Participant Flag
          MOVE      PMVXUD13,CODE
          CALL      CODITM00
          GOTO      VISS9999
.
VISS6700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS6750
.
          WRITE     HTMLFILE;PMVXADMP;      * Adm Paperwork Received
          GOTO      VISS9999
.
VISS6750  MATCH     " ",PMVXADMP
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
            GOTO      VISS9999
          ENDIF
.
          MATCH     "0",PMVXADMP
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
            GOTO      VISS9999
          ENDIF
.
          MATCH     "1",PMVXADMP
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      VISS9999
          ENDIF
.
          GOTO      VISS9999
.
VISS6800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS6850
.
          WRITE     HTMLFILE;PMVXCONO;      * Consent Obtained
          GOTO      VISS9999
.
VISS6850  MATCH     " ",PMVXCONO
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
            GOTO      VISS9999
          ENDIF
.
          MATCH     "0",PMVXCONO
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
            GOTO      VISS9999
          ENDIF
.
          MATCH     "1",PMVXCONO
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      VISS9999
          ENDIF
.
          GOTO      VISS9999
.
VISS6900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISS6950
.
          WRITE     HTMLFILE;PMVXMEDH;      * Medical History Received
          GOTO      VISS9999
.
VISS6950  MATCH     " ",PMVXMEDH
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
            GOTO      VISS9999
          ENDIF
.
          MATCH     "0",PMVXMEDH
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
            GOTO      VISS9999
          ENDIF
.
          MATCH     "1",PMVXMEDH
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      VISS9999
          ENDIF
.
          GOTO      VISS9999
.
VISS9999  RETURN
+
.------------------------------------------------------------
. Get Case Team
.------------------------------------------------------------
GETCAS00  UNPACK    DIM127,D1,KEY1,DIM127   * Case Team Code/Name
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GETCAS10
.
          PACK      KEY10,PMVXCASE,SP70
          CALL      RDALCAS1
          BRANCH    OVRCD,GETCAS99
.
          WRITE     HTMLFILE;ALCADESC;
          GOTO      GETCAS99
.
GETCAS10  WRITE     HTMLFILE;PMVXCASE;
          GOTO      GETCAS99
.
GETCAS99  RETURN
+
.------------------------------------------------------------
. Get Referring HCP/Practice Fax Number 
.------------------------------------------------------------
GETFAX00  OPEN      PMSHCLA1,"pmshclaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PMSHCPA1,"pmshcpaf"
.
.         Use HCP's fax number if not blank
.
          MATCH     SP70,PMVXRHC1
          GOTO      GETFAX99 IF EQUAL
.
          PACK      KEY10,PMVXRHC1,SP10
          CALL      RDPMHCP1
          BRANCH    OVRCD,GETFAX99
.
          MATCH     SP70,PMHCFAXN
          GOTO      GETFAX10 IF EQUAL
.
          WRITE     HTMLFILE;PMHCFAXN;
          GOTO      GETFAX99
.
GETFAX10  MATCH     SP70,PMVXRH1G
          GOTO      GETFAX99 IF EQUAL
.
.         Get linked HCP Practice
.
          PACK      KEY20,PMVXRHC1,PMVXRH1G,SP20
          CALL      RDPMHCL1
          BRANCH    OVRCD,GETFAX99
.
.         Now read Practice contact details
.
          PACK      KEY12,PMVXRH1G,PMVXRH1C,SP20
          CALL      RDPMHCG1
          BRANCH    OVRCD,GETFAX99
.
          WRITE     HTMLFILE;PMHGPFAX;
          GOTO      GETFAX99
.
GETFAX99  RETURN
+
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
VHSEL000  PACK      KEY3,SP70
          CALL      RSPTHSP1
VHSEL100  CALL      RKPTHSP1
          BRANCH    OVRCD,VHSEL999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     D3,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      VHSEL100
.
VHSEL999  RETURN

.------------------------------------------------------------------------
.   Output Yes/No selection list 
.------------------------------------------------------------------------
FLDTYP00  WRITE     HTMLFILE;"<option value=''> ";
.         
          COMPARE   "0",F1
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=0 selected> ";
          ELSE
            WRITE     HTMLFILE;"<option value=0> ";
          ENDIF
          WRITE     HTMLFILE;"No</option>";
.
          COMPARE   "1",F1
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=1 selected> ";
          ELSE
            WRITE     HTMLFILE;"<option value=1> ";
          ENDIF
          WRITE     HTMLFILE;"Yes</option>";
.
FLDTYP99  RETURN
.......................................................................
.  VISPC000 - display Program Codes                                    *I-86040
.    Tag Parameters   0=Description
.                     1=Code
.                     2=Selection List
.......................................................................
          DEFPROC   VISPC000
.
          INC       PMSPRGFD/INC
.
VISPC100  OPEN      PMSPRGA1,"pmsprgaf"
.
VISPC200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISPC210,VISPC220
.
          UNPACK    SP70,PMPGCODE,PMPGDESC       * default - display Desc
          PACK      KEY8,PMVXPRGM,SP8
          CALL      RDPMPRG1
          MATCH     SP70,PMPGDESC
          GOTO      VISPC999 IF EQUAL
          WRITE     HTMLFILE;PMPGDESC;
          GOTO      VISPC999
.
VISPC210  PACK      PMVXPRGM,PMVXPRGM,SP8        * display Code
          MATCH     SP70,PMVXPRGM
          GOTO      VISPC999 IF EQUAL
          WRITE     HTMLFILE;PMVXPRGM;
          GOTO      VISPC999
.
VISPC220  UNPACK    SP70,PMPGCODE,PMPGDESC       * display selection list
          PACK      KEY8,SP8
          CALL      RSPMPRG1
VISPC221  CALL      RKPMPRG1
          BRANCH    OVRCD,VISPC999
.
          MATCH     "1",PMPGACTV
          GOTO      VISPC221 IF EQUAL            * don't display inactive codes
.
          MATCH     PMVXPRGM,PMPGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PMPGCODE,"#" selected>":
                               PMPGDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PMPGCODE,"#">":
                               PMPGDESC,"</option>"
          ENDIF
          GOTO      VISPC221
.
.
OVERCOND  MOVE      ONE,OVRCD
          RETURN
.
          INC       PMSPRGIO/INC
.
VISPC999  CLOSE     PMSPRGA1
.
          ENDPROC
+
.......................................................................
.  VISTM000 - display Teams
.    Tag Parameters   0=Description
.                     1=Code
.                     2=Selection List
.......................................................................
          DEFPROC   VISTM000
.
          INC       PMSTEMFD/INC
.
VISTM100  OPEN      PMSTEMA1,"pmstemaf"
.
VISTM200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VISTM210,VISTM220
.
          UNPACK    SP70,PMTMTEAM,PMTMDESC       * default - display Desc
          PACK      KEY5,PMVXTEAM,SP8
          CALL      RDPMTEM1
          MATCH     SP70,PMTMDESC
          GOTO      VISTM999 IF EQUAL
          WRITE     HTMLFILE;PMTMDESC;
          GOTO      VISTM999
.
VISTM210  PACK      PMVXTEAM,PMVXTEAM,SP8        * display Code
          MATCH     SP70,PMVXTEAM
          GOTO      VISTM999 IF EQUAL
          WRITE     HTMLFILE;PMVXTEAM;
          GOTO      VISTM999
.
VISTM220  UNPACK    SP70,PMTMTEAM,PMTMDESC       * display selection list
          PACK      KEY5,SP8
          CALL      RSPMTEM1
VISTM221  CALL      RKPMTEM1
          BRANCH    OVRCD,VISTM999
.
          MATCH     "1",PMTMACTV
          GOTO      VISTM221 IF EQUAL            * don't display inactive codes
.
          MATCH     PMVXTEAM,PMTMTEAM
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PMTMTEAM,"#" selected>":
                               PMTMDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PMTMTEAM,"#">":
                               PMTMDESC,"</option>"
          ENDIF
          GOTO      VISTM221
.
.
OVERCOND  MOVE      ONE,OVRCD
          RETURN
.
          INC       PMSTEMIO/INC
.
VISTM999  CLOSE     PMSTEMA1
.
          ENDPROC
+

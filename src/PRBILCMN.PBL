.******************************************************************************
.* System   : Patient System                                                  *
.* Include  : PRBILCMN                                                        *
.* Desc     : Routine to print Billing Comments on Emergency Invoice & Reprint*
.******************************************************************************
.* Mods     :                                                                 *
.*       V10.07.01 09/10/2015 J.Tan         CAR 320522                        * .*                 Mods to read previous record after finding a deleted record*
.*       V10.06.02 14/07/2015 Peter Vela    CAR 319413                        *
.*                 Validate for deleted VISMDT record                         *
.*       V10.06.01 22/06/2014 J.Tan         CAR 318039                        *
.*                 Mods to use new Billing comments file                      *
.*       V10.00.00 27/09/2010 J.Tan         CAR 230664                        *
.*                 New routine to print Billing comments                      *
. *****************************************************************************
.         Print Billing Comments
. *****************************************************************************
          DEFPROC   PRBIL000
.
          INC       VISMDTFD/INC
          INC       VISMTXFD/INC
.
DIM50     DIM       50
.
PRBIL000  OPEN      VISMDTA1,"vismdtaf"
          OPEN      VISMTXA1,"vismtxaf"
          MOVE      "003",VSMDTYPE              * Billing comments
.
.         Get the last Note number
.
          MOVE      ADANUMB,DADANUMB
          PACK      KEY17,DADANUMB,VSMDTYPE,Z70
          CALL      RSVSMDT1
PRBIL020  CALL      RPVSMDT1
          BRANCH    OVRCD,PRBIL999
.
          MATCH     DADANUMB,VSMDVISN
          GOTO      PRBIL999 IF NOT EQUAL       * different visit number
          MATCH     "003",VSMDTYPE
          GOTO      PRBIL999 IF NOT EQUAL       * different Comment type
          MATCH     "1",VSMDDELT
          GOTO      PRBIL020 IF EQUAL           * deleted
.
          MOVE      ZERO,F1
          MOVE      ZERO,F2
          MOVE      "  1",VSMTUNIQ
.
.         Print the first three lines
.
PRBIL100  PACK      KEY20,VSMDVISN,VSMDTYPE,VSMDNOTE,VSMTUNIQ,SP70
          CALL      RDVSMTX1
          BRANCH    OVRCD,PRBIL999
.
          MATCH     VSMDVISN,VSMTVISN
          GOTO      PRBIL999 IF NOT EQUAL    * different visit
.
          MATCH     VSMDTYPE,VSMTTYPE
          GOTO      PRBIL999 IF NOT EQUAL    * different comment type
.
          MATCH     VSMDNOTE,VSMTNOTE
          GOTO      PRBIL999 IF NOT EQUAL    * different note number
.
          UNPACK    SP70,KEY50,DIM50
.
          MATCH     SP70,VSMTCMNT
          GOTO      PRBIL120 IF EQUAL    * blank line
.
          UNPACK    VSMTCMNT,KEY50,DIM50
          COMPARE   MAXLINE,COUNT
          CALL      TAIL IF NOT LESS
          PRINT     *1,KEY50
          ADD       ONE,COUNT
.
          MATCH     SP70,DIM50
          GOTO      PRBIL120 IF EQUAL
          COMPARE   MAXLINE,COUNT
          CALL      TAIL IF NOT LESS
          PRINT     *1,DIM50
          ADD       ONE,COUNT
.
PRBIL120  ADD       ONE,F1
          BRANCH    F1,PRBIL200,PRBIL300
          GOTO      PRBIL999
.
PRBIL200  MOVE      "  2",VSMTUNIQ
          GOTO      PRBIL100
.
PRBIL300  MOVE      "  3",VSMTUNIQ
          GOTO      PRBIL100
.
PRBIL999  GOTO      ENDAPRBL
.
          INC       VISMDTIO/INC
          INC       VISMTXIO/INC
          INC       IBAOVRIO/INC
.
ENDAPRBL  ENDPROC
+

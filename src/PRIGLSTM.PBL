. *----------------------------------------------------------------------
. * Include Name  :   PRIGLSTM.PBL
. *
. * Function      :   CGI Variables for PRIGLSFD - priglsaf 
. *
. * Mods          :   
. *                  V10.13.01 26/07/2018  J.Tan            TSK 0848506
. *                            Changed PP Doctor from DIM6 to DIM10
. *                   V9.03.01 10.02.2003 Lina Vo     CAR 44132
. *                            Added SELPPL00 for General letters selection list
. *                            Changed tag to display correct letter selection  
. *                            list for PRGLLTYP. 
. *                            Mods to MVPRGL00 to include practice fields
. *                            PRGL0009 & PRGL0010.  Practice and Service
. *                            Doctor Fields are treated independently.
. *                            Changed SELPPD00 to only display practicing
. *                            doctors in selection list.
. *                   V9.02.01 16.10.2001 Kuldeep Singh 
. *                            Created include
. *                :   V9.02.02 13.12.2001 Kuldeep Singh & DC
. *                            Added Variables  
. *----------------------------------------------------------------------
.------------------------------------------------------------------------
.   Clear Parameters for General Letter  
.------------------------------------------------------------------------
CPPRGL00  MOVE      SP70,PRGL0001
          MOVE      SP70,PRGL0002 
          MOVE      SP70,PRGL0003
          MOVE      SP70,PRGL0004
          MOVE      SP70,PRGL0005
          MOVE      SP70,PRGL0006
          MOVE      SP70,PRGL0007
          MOVE      SP70,PRGL0008
          MOVE      SP70,PRGL0009
          MOVE      SP70,PRGL0010
          MOVE      SP70,PRGL0011
          MOVE      SP70,PRGL0012
          MOVE      SP70,PRGL0013
          MOVE      SP70,PRGL0014
          MOVE      SP70,PRGL0015
          MOVE      SP70,PRGL0016
.
CPPRGL99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for General letter file
.------------------------------------------------------------
SPPRGL00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPPRGL01,SPPRGL02,SPPRGL03,SPPRGL04,SPPRGL05:
                       SPPRGL06,SPPRGL07,SPPRGL08,SPPRGL09,SPPRGL10:
                       SPPRGL11,SPPRGL12,SPPRGL13,SPPRGL14,SPPRGL15:
                       SPPRGL16
.
          MOVE      ONE,EXIT
          GOTO      SPPRGL99
.
SPPRGL01  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PRGL0001
          PACK      PRGL0001,PRGL0001,SP70
          GOTO      SPPRGL99
.
SPPRGL02  MOVE      QRYDATA,PRGL0002
          GOTO      SPPRGL99
.
SPPRGL03  MOVE      QRYDATA,PRGL0003 
          GOTO      SPPRGL99 
.
SPPRGL04  MOVE      QRYDATA,PRGL0004 
          GOTO      SPPRGL99
.
SPPRGL05  MOVE      QRYDATA,PRGL0005 
          GOTO      SPPRGL99
.
SPPRGL06  MOVE      QRYDATA,PRGL0006 
          GOTO      SPPRGL99
.
SPPRGL07  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPRGL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PRGL0007,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPPRGL99
.
SPPRGL08  PACK      QRYDATA,QRYDATA,SP70
          MATCH     SP70,QRYDATA
          GOTO      SPPRGL99 IF EQUAL
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PRGL0008,CCENT,CYEAR,CMON,CDAY 
          GOTO      SPPRGL99
.
SPPRGL09  MOVE      QRYDATA,PRGL0009 
          GOTO      SPPRGL99 
.
SPPRGL10  MOVE      QRYDATA,PRGL0010 
          GOTO      SPPRGL99  
.
SPPRGL11  MOVE      QRYDATA,PRGL0011
          GOTO      SPPRGL99
.
SPPRGL12  MOVE      QRYDATA,PRGL0012 
          GOTO      SPPRGL99
.
SPPRGL13  MOVE      QRYDATA,PRGL0013
          GOTO      SPPRGL99
.
SPPRGL14  MOVE      QRYDATA,PRGL0014
          GOTO      SPPRGL99
.
SPPRGL15  MOVE      QRYDATA,PRGL0015
          GOTO      SPPRGL99
.
SPPRGL16  MOVE      QRYDATA,PRGL0016
          GOTO      SPPRGL99
.
SPPRGL99  RETURN
.------------------------------------------------------------
. Clear General Letter Variables
.------------------------------------------------------------
CLPRGL00  MOVE      SP70,PRGLSEID           * Selection ID.
          MOVE      SP70,PRGLSEDC           * Selection Description
          MOVE      SP70,PRGLDBFR           * Debtor Number From
          MOVE      SP70,PRGLDBTO           * Debtor Number To
          MOVE      SP70,PRGLSNFR           * Surname From
          MOVE      SP70,PRGLSNTO           * Surname To
          MOVE      SP70,PRGLVDFR           * Visit Date From (ccyymmdd)
          MOVE      SP70,PRGLVDTO           * Visit Date To (ccyymmdd)
          MOVE      SP70,PRGLPPFR           * Practice From
          MOVE      SP70,PRGLPPTO           * Practice To
          MOVE      SP70,PRGLSDFR           * Service Doctor From
          MOVE      SP70,PRGLSDTO           * Service Doctor To
          MOVE      SP70,PRGLCCFR           * Claim Code From (category CL)
          MOVE      SP70,PRGLCCTO           * Claim Code To (category CL)
          MOVE      SP70,PRGLLTYP           * Letter Type
          MOVE      SP70,PRGLSCAN           * Scan Flag (0=Debtor 1=U/R)
.
CLPRGL99  RETURN
.------------------------------------------------------------
. Add General  Letter Fields
.------------------------------------------------------------
PRGL0000  BRANCH    FLDITMNO,PRGL0100,PRGL0200,PRGL0300,PRGL0400,PRGL0500:
                             PRGL0600,PRGL0700,PRGL0800,PRGL0900,PRGL1000:
                             PRGL1100,PRGL1200,PRGL1300,PRGL1400,PRGL1500:
                             PRGL1600,PRGL1700
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PRGL9999
.
PRGL0100  WRITE     HTMLFILE;PRGLSEID;
          GOTO      PRGL9999
.
PRGL0200  WRITE     HTMLFILE;PRGLSEDC;
          GOTO      PRGL9999
.
PRGL0300  WRITE     HTMLFILE;PRGLDBFR;
          GOTO      PRGL9999 
.
PRGL0400  WRITE     HTMLFILE;PRGLDBTO; 
          GOTO      PRGL9999 
.
PRGL0500  WRITE     HTMLFILE;PRGLSNFR; 
          GOTO      PRGL9999 
.
PRGL0600  WRITE     HTMLFILE;PRGLSNTO; 
          GOTO      PRGL9999 
.
PRGL0700  MATCH     PRGLVDFR,SP70
          GOTO      PRGL9999 IF EQUAL
          UNPACK    PRGLVDFR,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR  
          GOTO      PRGL9999
.
PRGL0800  MATCH     PRGLVDTO,SP70
          GOTO      PRGL9999 IF EQUAL
          UNPACK    PRGLVDTO,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR 
          GOTO      PRGL9999
.
PRGL0900  MOVE      PRGLPPFR,PRRMMP01 
          CALL      SELPPP00     * Private Practice Medical Practices
          GOTO      PRGL9999
.
PRGL1000  MOVE      PRGLPPTO,PRRMMP01 
          CALL      SELPPP00     * Private Practice Medical Practices
          GOTO      PRGL9999
.
PRGL1100  PACK      TMDOPR01,PRGLSDFR,SP70 
          CALL      SELPPD00     * Private Practice Doctors 
          GOTO      PRGL9999
.
PRGL1200  PACK      TMDOPR01,PRGLSDTO,SP70
          CALL      SELPPD00     * Private Practice Doctors  
          GOTO      PRGL9999
.
PRGL1300  MOVE      "CL",CATEGORY
          MOVE      PRGLCCFR,CODE
          CALL      CODITM00 
          GOTO      PRGL9999
.
PRGL1400  MOVE      "CL",CATEGORY
          MOVE      PRGLCCTO,CODE
          CALL      CODITM00 
          GOTO      PRGL9999
.
PRGL1500  MOVE      PRGLLTYP,PRLLTYP1
          CALL      SELPPL00     * Private Practice General Letter TYpe 
          GOTO      PRGL9999
.
PRGL1600  CALL      PRGTAB00 
          GOTO      PRGL9999
.
PRGL1700  WRITE     HTMLFILE;PRGLSCAN;
          GOTO      PRGL9999 
.
PRGL9999  RETURN
.------------------------------------------------------------
.  move CGI variable to file variable 
.------------------------------------------------------------
MVPRGL00  MATCH     PRGL0001,SP70
          IF        !@EQUAL
            MOVE      PRGL0001,PRGLSEID
          ENDIF
.
          MATCH     PRGL0002,SP70
          IF        !@EQUAL
            MOVE      PRGL0002,PRGLSEDC
          ENDIF
.
          MATCH     PRGL0003,SP70
          IF        !@EQUAL
            MOVE      PRGL0003,PRGLDBFR
          ENDIF
.
          MATCH     PRGL0004,SP70
          IF        !@EQUAL
            MOVE      PRGL0004,PRGLDBTO
          ENDIF
.
          MATCH     PRGL0005,SP70
          IF        !@EQUAL
            MOVE      PRGL0005,PRGLSNFR
          ENDIF
.
          MATCH     PRGL0006,SP70
          IF        !@EQUAL
            MOVE      PRGL0006,PRGLSNTO
          ENDIF
.
          MATCH     PRGL0007,SP70
          IF        @EQUAL
            MOVE      SP70,PRGLVDFR
          ELSE
            MOVE      PRGL0007,PRGLVDFR
          ENDIF
.
          MATCH     PRGL0008,SP70
          IF        @EQUAL
            MOVE      SP70,PRGLVDTO
          ELSE
            MOVE      PRGL0008,PRGLVDTO
          ENDIF
.
          MATCH     PRGL0009,SP70
          IF        @EQUAL
            MOVE      SP70,PRGLPPFR
          ELSE
            MOVE      PRGL0009,PRGLPPFR
          ENDIF
.
          MATCH     PRGL0010,SP70
          IF        @EQUAL
            MOVE      SP70,PRGLPPTO
          ELSE
            MOVE      PRGL0010,PRGLPPTO
          ENDIF
.
          MATCH     PRGL0011,SP70
          IF        !@EQUAL
            MOVE      PRGL0011,PRGLSDFR
          ENDIF
.
          MATCH     PRGL0012,SP70
          IF        !@EQUAL
            MOVE      PRGL0012,PRGLSDTO
          ENDIF
.
          MATCH     PRGL0013,SP70
          IF        !@EQUAL
            MOVE      PRGL0013,PRGLCCFR
          ENDIF
.
          MATCH     PRGL0014,SP70
          IF        !@EQUAL
            MOVE      PRGL0014,PRGLCCTO
          ENDIF
.
          MATCH     PRGL0015,SP70
          IF        !@EQUAL
            MOVE      PRGL0015,PRGLLTYP
          ENDIF
.
          MATCH     PRGL0016,SP70
          IF        !@EQUAL
            MOVE      PRGL0016,PRGLSCAN
          ENDIF
.
MVPRGL99  RETURN
.------------------------------------------------------------
. List of General Letter lists
.------------------------------------------------------------
PRGTAB00  MOVE      SP70,KEY4
          CALL      RSPRGLS1
PRGTAB10  CALL      RKPRGLS1
          BRANCH    OVRCD,PRGTAB99
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateItem('",HTMLLINK
          APPEND    PRGLSEID,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PRGLSEID,"#",":
                             "#"",PRGLSEDC,"#",":
                             "#"",PRGLDBFR,"#",":
                             "#"",PRGLDBTO,"#");"
.
          GOTO      PRGTAB10
.
PRGTAB99  RETURN
.
.------------------------------------------------------------
. Private Practice Doctors within Practice
.------------------------------------------------------------
SELPPD00  PACK      FIRST12,SP20
.
          PACK      KEY22,SP70
          CALL      RSPRDO2
SELPPD10  CALL      RKPRDO2
          BRANCH    OVRCD,SELPPD99
.
          MATCH     SP10,PRDODOCT
          GOTO      SELPPD10 IF EQUAL
.
          MATCH     SP70,FIRST12
          GOTO      SELPPD20 IF NOT EQUAL
.
          GOTO      SELPPD30
.
SELPPD20  PACK      TEST12,PRDODOCT,SP10
          MATCH     FIRST12,TEST12
          GOTO      SELPPD10 IF EQUAL
.
SELPPD30  PACK      FIRST12,PRDODOCT,SP10
          MOVE      SP25,KEY25
          MOVE      PRDODOCT,DCODE
          PACK      KEY10,PRDODOCT,SP10
          CALL      RDPMHCP1
          BRANCH    OVRCD,SELPPD40
.
          MOVE      "1",PACFRMT
          MOVE      PMHCTITL,PACTITLE
          MOVE      PMHCSNAM,PACSNAME
          MOVE      PMHCGNAM,PACGNAME
          CALL      PACNAME
          MOVE      PACFNAME,KEY25
.
SELPPD40  PACK      KEY14,QUOTE,PRDODOCT,QUOTE
.
          PACK      KEY12,PRDODOCT,SP70
          MATCH     KEY12,TMDOPR01
          IF        @EQUAL       
            WRITE     HTMLFILE;"<option value=",KEY14," selected>":
                      "(",PRDODOCT,") ",KEY25,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY14,">":
                      "(",PRDODOCT,") ",KEY25,"</option>"
          ENDIF
.
          GOTO      SELPPD10
.
SELPPD99  RETURN
.
.------------------------------------------------------------
. Private Practice Financial Letters Type
.------------------------------------------------------------
SELPPF00  PACK      KEY6,SP10
          CALL      RSPRFL2
SELPPF10  CALL      RKPRFL2
          BRANCH    OVRCD,SELPPF99
.
          MATCH "EW",PRFLTEXT
          GOTO SELPPF10 IF EQUAL
          COMPARE   ZERO,PRFLLINE               * header line ?
          GOTO      SELPPF10 IF NOT EQUAL       * no
.
          PACK      KEY25,PRFLTEXT,SP30
          PACK      KEY8,QUOTE,DPRFLNUM,QUOTE
.
          MATCH     PRLLTYP1,DPRFLNUM
          IF        @EQUAL
             WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                       "(",DPRFLNUM,") ",KEY25,"</option>"
          ELSE
             WRITE     HTMLFILE;"<option value=",KEY8,">":
                       "(",DPRFLNUM,") ",KEY25,"</option>"
          ENDIF
.
          GOTO      SELPPF10
.
SELPPF99  RETURN
+
.------------------------------------------------------------
. Private Practice General Letters Type
.------------------------------------------------------------
SELPPL00  PACK      KEY6,SP10
          CALL      RSPRLE2
SELPPL10  CALL      RKPRLE2
          BRANCH    OVRCD,SELPPL99
.
          MATCH     "EW",PRLETEXT
          GOTO      SELPPL10 IF EQUAL
          COMPARE   ZERO,PRLELINE               * header line ?
          GOTO      SELPPL10 IF NOT EQUAL       * no
.
          PACK      KEY25,PRLETEXT,SP30
          PACK      KEY8,QUOTE,DPRLENUM,QUOTE
.
          MATCH     PRLLTYP1,DPRLENUM
          IF        @EQUAL
             WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                       "(",DPRLENUM,") ",KEY25,"</option>"
          ELSE
             WRITE     HTMLFILE;"<option value=",KEY8,">":
                       "(",DPRLENUM,") ",KEY25,"</option>"
          ENDIF
.
          GOTO      SELPPL10
.
SELPPL99  RETURN
.

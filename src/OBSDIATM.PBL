
. Visit Based Comment Processing
.
. V10.06.03 29/06/2015 Ania P         CAR 306161
.           Removed CLOBSMED (moved to standalone routine in CLOBSMED.PBL)
. V10.06.02 23/06/2015 Jill Parkinson CAR 318437
.           Removed all calls to TFILENAM
. V10.06.01 16/04/2015 Ania P         CAR 261630
.           Removed use of PORT for temp file names
. V10.00.01 08/04/2010 Jill Parkinson CAR 216634
.           Added OBMEREAS,OBMESTAT,OBMECHGD,OBMECHGR,OBMENOTE
. V9.07.02 26/10/2006 Jill Habasque   CAR 121320
.          Added OBMEMCOD 
. V9.07.01 01/08/2006 Jill Habasque   CAR 103377
.          Created include
.------------------------------------------------------------
.  CLROBD00 - Call from CLRPAR00 Routine to Initialise Input File
.  SETOBD00 - Call from SETPAR00 Routine when input parameter matches "obsdi"
.  UPOBD000 - Call to Update Diagnosis for Add or Update
.  OBDHTM00 - Call to Output Diagnosis to HTML
.------------------------------------------------------------
. Clear Inputs
.------------------------------------------------------------
CLROBD00  PREP      OBSDIFIL,OBSDIFNM
.
          PREP      OBSPRFIL,OBSPRFNM
.
          PREP      OBSREFIL,OBSREFNM
.
          PREP      OBSBHFIL,OBSBHFNM
.
          PREP      OBSBPFIL,OBSBPFNM
.
          PREP      OBSLBFIL,OBSLBFNM
.
          PREP      OBSRSFIL,OBSRSFNM
.
          PREP      OBSPHFIL,OBSPHFNM
.
          PREP      OBSDTFIL,OBSDTFNM
.
          PREP      OBSCAFIL,OBSCAFNM
.
          RETURN
.------------------------------------------------------------
. Set Inputs for observation diagnosis
.------------------------------------------------------------
SETOBD00  MOVE      ZERO,BLNKFLAG
          WRITE     OBSDIFIL,SEQ;"%START:"
          PACK      QRYDATA,QRYDATA,SP70,SP70
          WRITE     OBSDIFIL,SEQ;QRYDATA
.
SETOBD10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      SETOBD99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      SETOBD80 IF NOT EQUAL
.
          PACK      QRYDATA,QRYDATA,SP70,SP70
.
          MATCH     SP70,QRYDATA
          IF        @EQUAL
            BRANCH    BLNKFLAG,SETOBD10
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBD70                   * don't write second blank line
          ENDIF
          IF        @EOS
            BRANCH    BLNKFLAG,SETOBD10          * don't write second blank line
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBD70
          ENDIF
.
          MOVE      ZERO,BLNKFLAG                * Blank line no
.
SETOBD70  WRITE     OBSDIFIL,SEQ;QRYDATA
          GOTO      SETOBD10
.
SETOBD80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
SETOBD99  RETURN
+
.------------------------------------------------------------
. Set Inputs for observation procedures
.------------------------------------------------------------
SETOBP00  MOVE      ZERO,BLNKFLAG
          WRITE     OBSPRFIL,SEQ;"%START:"
          PACK      QRYDATA,QRYDATA,SP70,SP70
          WRITE     OBSPRFIL,SEQ;QRYDATA
.
SETOBP10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      SETOBP99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      SETOBP80 IF NOT EQUAL
.
          PACK      QRYDATA,QRYDATA,SP70,SP70
.
          MATCH     SP70,QRYDATA
          IF        @EQUAL
            BRANCH    BLNKFLAG,SETOBP10
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBP70                   * don't write second blank line
          ENDIF
          IF        @EOS
            BRANCH    BLNKFLAG,SETOBP10          * don't write second blank line
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBP70
          ENDIF
.
          MOVE      ZERO,BLNKFLAG                * Blank line no
.
SETOBP70  WRITE     OBSPRFIL,SEQ;QRYDATA
          GOTO      SETOBP10
.
SETOBP80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
SETOBP99  RETURN
+
.------------------------------------------------------------
. Set Inputs - Observations reason for admission 
.------------------------------------------------------------
SETOBA00  MOVE      ZERO,BLNKFLAG
          WRITE     OBSREFIL,SEQ;"%START:"
          PACK      QRYDATA,QRYDATA,SP70,SP70
          WRITE     OBSREFIL,SEQ;QRYDATA
.
SETOBA10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      SETOBA99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      SETOBA80 IF NOT EQUAL
.
          PACK      QRYDATA,QRYDATA,SP70,SP70
.
          MATCH     SP70,QRYDATA
          IF        @EQUAL
            BRANCH    BLNKFLAG,SETOBA10
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBA70                   * don't write second blank line
          ENDIF
          IF        @EOS
            BRANCH    BLNKFLAG,SETOBA10          * don't write second blank line
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBA70
          ENDIF
.
          MOVE      ZERO,BLNKFLAG                * Blank line no
.
SETOBA70  WRITE     OBSREFIL,SEQ;QRYDATA
          GOTO      SETOBA10
.
SETOBA80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
SETOBA99  RETURN
+
.------------------------------------------------------------
. Set Inputs - Observations Brief History of Present Illness
.------------------------------------------------------------
SETOBH00  MOVE      ZERO,BLNKFLAG
          WRITE     OBSBHFIL,SEQ;"%START:"
          PACK      QRYDATA,QRYDATA,SP70,SP70
          WRITE     OBSBHFIL,SEQ;QRYDATA
.
SETOBH10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      SETOBH99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      SETOBH80 IF NOT EQUAL
.
          PACK      QRYDATA,QRYDATA,SP70,SP70
.
          MATCH     SP70,QRYDATA
          IF        @EQUAL
            BRANCH    BLNKFLAG,SETOBA10
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBH70                   * don't write second blank line
          ENDIF
          IF        @EOS
            BRANCH    BLNKFLAG,SETOBH10          * don't write second blank line
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBH70
          ENDIF
.
          MOVE      ZERO,BLNKFLAG                * Blank line no
.
SETOBH70  WRITE     OBSBHFIL,SEQ;QRYDATA
          GOTO      SETOBH10
.
SETOBH80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
SETOBH99  RETURN
+
.------------------------------------------------------------
. Set Inputs - Observations Brief Physical Exam
.------------------------------------------------------------
SETOBE00  MOVE      ZERO,BLNKFLAG
          WRITE     OBSBPFIL,SEQ;"%START:"
          PACK      QRYDATA,QRYDATA,SP70,SP70
          WRITE     OBSBPFIL,SEQ;QRYDATA
.
SETOBE10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      SETOBE99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      SETOBE80 IF NOT EQUAL
.
          PACK      QRYDATA,QRYDATA,SP70,SP70
.
          MATCH     SP70,QRYDATA
          IF        @EQUAL
            BRANCH    BLNKFLAG,SETOBE10
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBE70                   * don't write second blank line
          ENDIF
          IF        @EOS
            BRANCH    BLNKFLAG,SETOBE10          * don't write second blank line
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBE70
          ENDIF
.
          MOVE      ZERO,BLNKFLAG                * Blank line no
.
SETOBE70  WRITE     OBSBPFIL,SEQ;QRYDATA
          GOTO      SETOBE10
.
SETOBE80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
SETOBE99  RETURN
+
.------------------------------------------------------------
. Set Inputs - Laboratory Results                 
.------------------------------------------------------------
SETOBL00  MOVE      ZERO,BLNKFLAG
          WRITE     OBSLBFIL,SEQ;"%START:"
          PACK      QRYDATA,QRYDATA,SP70,SP70
          WRITE     OBSLBFIL,SEQ;QRYDATA
.
SETOBL10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      SETOBL99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      SETOBL80 IF NOT EQUAL
.
          PACK      QRYDATA,QRYDATA,SP70,SP70
.
          MATCH     SP70,QRYDATA
          IF        @EQUAL
            BRANCH    BLNKFLAG,SETOBL10
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBL70                   * don't write second blank line
          ENDIF
          IF        @EOS
            BRANCH    BLNKFLAG,SETOBL10          * don't write second blank line
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETOBL70
          ENDIF
.
          MOVE      ZERO,BLNKFLAG                * Blank line no
.
SETOBL70  WRITE     OBSLBFIL,SEQ;QRYDATA
          GOTO      SETOBL10
.
SETOBL80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
SETOBL99  RETURN
+
.------------------------------------------------------------
. Set Inputs - Observations Restrictions           
.------------------------------------------------------------ 
SETRES00  MOVE      ZERO,BLNKFLAG
          WRITE     OBSRSFIL,SEQ;"%START:"       
          PACK      QRYDATA,QRYDATA,SP70,SP70
          WRITE     OBSRSFIL,SEQ;QRYDATA
.           
SETRES10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      SETRES99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      SETRES80 IF NOT EQUAL
.
          PACK      QRYDATA,QRYDATA,SP70,SP70
.
          MATCH     SP70,QRYDATA
          IF        @EQUAL
            BRANCH    BLNKFLAG,SETRES10
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETRES70                   * don't write second blank line
          ENDIF
          IF        @EOS
            BRANCH    BLNKFLAG,SETRES10          * don't write second blank line
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETRES70
          ENDIF
.
          MOVE      ZERO,BLNKFLAG                * Blank line no
.
SETRES70  WRITE     OBSRSFIL,SEQ;QRYDATA
          GOTO      SETRES10
.
SETRES80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
SETRES99  RETURN
+
.------------------------------------------------------------
. Set Inputs - Observations Physical Activity
.------------------------------------------------------------
SETPHY00  MOVE      ZERO,BLNKFLAG
          WRITE     OBSPHFIL,SEQ;"%START:"
          PACK      QRYDATA,QRYDATA,SP70,SP70
          WRITE     OBSPHFIL,SEQ;QRYDATA
.
SETPHY10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      SETPHY99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      SETPHY80 IF NOT EQUAL
.
          PACK      QRYDATA,QRYDATA,SP70,SP70
.
          MATCH     SP70,QRYDATA
          IF        @EQUAL
            BRANCH    BLNKFLAG,SETPHY10
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETPHY70                   * don't write second blank line
          ENDIF
          IF        @EOS
            BRANCH    BLNKFLAG,SETPHY10          * don't write second blank line
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETPHY70
          ENDIF
.
          MOVE      ZERO,BLNKFLAG                * Blank line no
.
SETPHY70  WRITE     OBSPHFIL,SEQ;QRYDATA
          GOTO      SETPHY10
.
SETPHY80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
SETPHY99  RETURN
+
.------------------------------------------------------------
. Set Inputs - Observations Diet Details
.------------------------------------------------------------
SETDIT00  MOVE      ZERO,BLNKFLAG
          WRITE     OBSDTFIL,SEQ;"%START:"
          PACK      QRYDATA,QRYDATA,SP70,SP70
          WRITE     OBSDTFIL,SEQ;QRYDATA
.
SETDIT10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      SETDIT99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      SETDIT80 IF NOT EQUAL
.
          PACK      QRYDATA,QRYDATA,SP70,SP70
.
          MATCH     SP70,QRYDATA
          IF        @EQUAL
            BRANCH    BLNKFLAG,SETDIT10
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETDIT70                   * don't write second blank line
          ENDIF
          IF        @EOS
            BRANCH    BLNKFLAG,SETDIT10          * don't write second blank line
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETDIT70
          ENDIF
.
          MOVE      ZERO,BLNKFLAG                * Blank line no
.
SETDIT70  WRITE     OBSDTFIL,SEQ;QRYDATA
          GOTO      SETDIT10
.
SETDIT80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
SETDIT99  RETURN
+
.------------------------------------------------------------
. Set Inputs - Observations When to call doctor/nurse
.------------------------------------------------------------
SETCAL00  MOVE      ZERO,BLNKFLAG
          WRITE     OBSCAFIL,SEQ;"%START:"
          PACK      QRYDATA,QRYDATA,SP70,SP70
          WRITE     OBSCAFIL,SEQ;QRYDATA
.
SETCAL10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      SETCAL99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      SETCAL80 IF NOT EQUAL
.
          PACK      QRYDATA,QRYDATA,SP70,SP70
.
          MATCH     SP70,QRYDATA
          IF        @EQUAL
            BRANCH    BLNKFLAG,SETCAL10
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETCAL70                   * don't write second blank line
          ENDIF
          IF        @EOS
            BRANCH    BLNKFLAG,SETCAL10          * don't write second blank line
            MOVE      ONE,BLNKFLAG               * Blank line yes
            SQUEEZE   QRYDATA
            GOTO      SETCAL70
          ENDIF
.
          MOVE      ZERO,BLNKFLAG                * Blank line no
.
SETCAL70  WRITE     OBSCAFIL,SEQ;QRYDATA
          GOTO      SETCAL10
.
SETCAL80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
SETCAL99  RETURN
+
.------------------------------------------------------------
. Add/Update Comments
.------------------------------------------------------------
UPOBD000  OPEN      OBSDIFIL,OBSDIFNM
UPOBD100  READ      OBSDIFIL,SEQ;OBSDDIAG
          GOTO      UPOBD999 IF OVER
          MATCH     "%START:",OBSDDIAG
          IF        @EQUAL
            UNPACK    OBSDDIAG,KEY7
            CALL      CLOBD000
            MOVE      ZERO,OBSDILIN
            GOTO      UPOBD100
          ENDIF
UPOBD110  ADD       ONE,OBSDILIN
          PACK      KEY11,ADMISSNO,OBSDILIN,SP70
          UNPACK    KEY11,OBDIVISN,OBDILINE
          CALL      RAOBDIA1
          COMPARE   ZERO,OVRCD
          GOTO      UPOBD110 IF EQUAL
          MOVE      OBSDDIAG,OBDIDIAG
          CALL      WROBDIA1
          GOTO      UPOBD100
.
UPOBD999  RETURN
.------------------------------------------------------------
. Add/Update Procedures
.------------------------------------------------------------
UPOBP000  OPEN      OBSPRFIL,OBSPRFNM
UPOBP100  READ      OBSPRFIL,SEQ;OBSPRPRO
          GOTO      UPOBP999 IF OVER
          MATCH     "%START:",OBSPRPRO
          IF        @EQUAL
            CALL      CLOBP000
            MOVE      ZERO,OBSPRLIN
            GOTO      UPOBP100
          ENDIF
UPOBP110  ADD       ONE,OBSPRLIN
          PACK      KEY11,ADMISSNO,OBSPRLIN,SP70
          UNPACK    KEY11,OBPRVISN,OBPRLINE
          CALL      RAOBPRO1
          COMPARE   ZERO,OVRCD
          GOTO      UPOBP110 IF EQUAL
          MOVE      OBSPRPRO,OBPRPROC
          CALL      WROBPRO1
          GOTO      UPOBP100
.
UPOBP999  RETURN
+
.------------------------------------------------------------
. Add/Update Reasons for admission
.------------------------------------------------------------
UPOBA000  OPEN      OBSREFIL,OBSREFNM
UPOBA100  READ      OBSREFIL,SEQ;OBSREREA
          GOTO      UPOBA999 IF OVER
          MATCH     "%START:",OBSREREA
          IF        @EQUAL
            CALL      CLOBA000
            MOVE      ZERO,OBSREREA
            GOTO      UPOBA100
          ENDIF
UPOBA110  ADD       ONE,OBSRELIN
          PACK      KEY11,ADMISSNO,OBSRELIN,SP70
          UNPACK    KEY11,OBREVISN,OBRELINE
          CALL      RDOBREA1
          COMPARE   ZERO,OVRCD
          GOTO      UPOBA110 IF EQUAL
          MOVE      OBSREREA,OBREREAS
          CALL      WROBREA1
          GOTO      UPOBA100
.
UPOBA999  RETURN
+
.------------------------------------------------------------
. Add/Update Brief History of Present Illness
.------------------------------------------------------------
UPOBH000  OPEN      OBSBHFIL,OBSBHFNM
UPOBH100  READ      OBSBHFIL,SEQ;OBSBHREA
          GOTO      UPOBH999 IF OVER
          MATCH     "%START:",OBSBHREA
          IF        @EQUAL
            CALL      CLOBH000
            MOVE      ZERO,OBSBHREA
            GOTO      UPOBH100
          ENDIF
UPOBH110  ADD       ONE,OBSBHLIN
          PACK      KEY11,ADMISSNO,OBSBHLIN,SP70
          UNPACK    KEY11,OBBHVISN,OBBHLINE
          CALL      RDOBBHI1
          COMPARE   ZERO,OVRCD
          GOTO      UPOBH110 IF EQUAL
          MOVE      OBSBHREA,OBBHDESC
          CALL      WROBBHI1
          GOTO      UPOBH100
.
UPOBH999  RETURN
+
.------------------------------------------------------------
. Add/Update Brief Physical Exam
.------------------------------------------------------------
UPOBE000  OPEN      OBSBPFIL,OBSBPFNM
UPOBE100  READ      OBSBPFIL,SEQ;OBSBPREA
          GOTO      UPOBE999 IF OVER
          MATCH     "%START:",OBSBPREA
          IF        @EQUAL
            CALL      CLOBE000
            MOVE      ZERO,OBSBPREA
            GOTO      UPOBE100
          ENDIF
UPOBE110  ADD       ONE,OBSBPLIN
          PACK      KEY11,ADMISSNO,OBSBPLIN,SP70
          UNPACK    KEY11,OBBPVISN,OBBPLINE
          CALL      RDOBBPH1
          COMPARE   ZERO,OVRCD
          GOTO      UPOBE110 IF EQUAL
          MOVE      OBSBPREA,OBBPDESC
          CALL      WROBBPH1
          GOTO      UPOBE100
.
UPOBE999  RETURN
+
.------------------------------------------------------------
. Add/Update Laboratory Results 
.------------------------------------------------------------
UPOBL000  OPEN      OBSLBFIL,OBSLBFNM
UPOBL100  READ      OBSLBFIL,SEQ;OBSLBREA
          GOTO      UPOBL999 IF OVER
          MATCH     "%START:",OBSLBREA
          IF        @EQUAL
            CALL      CLOBL000
            MOVE      ZERO,OBSLBREA
            GOTO      UPOBL100
          ENDIF
UPOBL110  ADD       ONE,OBSLBLIN
          PACK      KEY11,ADMISSNO,OBSLBLIN,SP70
          UNPACK    KEY11,OBLBVISN,OBLBLINE
          CALL      RDOBLAB1
          COMPARE   ZERO,OVRCD
          GOTO      UPOBL110 IF EQUAL
          MOVE      OBSLBREA,OBLBDESC
          CALL      WROBLAB1
          GOTO      UPOBL100
.
UPOBL999  RETURN
+
.------------------------------------------------------------
. Add/Update Restrictions           
.------------------------------------------------------------
UPRES000  OPEN      OBSRSFIL,OBSRSFNM
UPRES100  READ      OBSRSFIL,SEQ;OBSRSREA
          GOTO      UPOBP999 IF OVER
          MATCH     "%START:",OBSRSREA
          IF        @EQUAL
            CALL      CLRES000
            MOVE      ZERO,OBSRSREA
            GOTO      UPRES100
          ENDIF
UPRES110  ADD       ONE,OBSRSLIN
          PACK      KEY11,ADMISSNO,OBSRSLIN,SP70
          UNPACK    KEY11,OBRSVISN,OBRSLINE
          CALL      RDOBRES1
          COMPARE   ZERO,OVRCD
          GOTO      UPOBA110 IF EQUAL
          MOVE      OBSRSREA,OBRSREST
          CALL      WROBRES1
          GOTO      UPRES100
.
UPRES999  RETURN
+
.------------------------------------------------------------
. Add/Update Physical Activity
.------------------------------------------------------------
UPPHY000  OPEN      OBSPHFIL,OBSPHFNM
UPPHY100  READ      OBSPHFIL,SEQ;OBSPHREA
          GOTO      UPPHY999 IF OVER
          MATCH     "%START:",OBSPHREA
          IF        @EQUAL
            CALL      CLPHY000
            MOVE      ZERO,OBSPHREA
            GOTO      UPPHY100
          ENDIF
UPPHY110  ADD       ONE,OBSPHLIN
          PACK      KEY11,ADMISSNO,OBSPHLIN,SP70
          UNPACK    KEY11,OBPHVISN,OBPHLINE
          CALL      RDOBPHY1
          COMPARE   ZERO,OVRCD
          GOTO      UPPHY110 IF EQUAL
          MOVE      OBSPHREA,OBPHPHYS
          CALL      WROBPHY1
          GOTO      UPPHY100
.
UPPHY999  RETURN
+
.------------------------------------------------------------
. Add/Update Diet Details 
.------------------------------------------------------------
UPDIT000  OPEN      OBSDTFIL,OBSDTFNM
UPDIT100  READ      OBSDTFIL,SEQ;OBSDTREA
          GOTO      UPDIT999 IF OVER
          MATCH     "%START:",OBSDTREA
          IF        @EQUAL
            CALL      CLDIT000
            MOVE      ZERO,OBSDTREA
            GOTO      UPDIT100
          ENDIF
UPDIT110  ADD       ONE,OBSDTLIN
          PACK      KEY11,ADMISSNO,OBSDTLIN,SP70
          UNPACK    KEY11,OBDTVISN,OBDTCNTR
          CALL      RDOBDIT1
          COMPARE   ZERO,OVRCD
          GOTO      UPDIT110 IF EQUAL
          MOVE      OBSDTREA,OBDTDIET
          CALL      WROBDIT1
          GOTO      UPDIT100
.
UPDIT999  RETURN
+
.------------------------------------------------------------
. Add/Update When to call details
.------------------------------------------------------------
UPCAL000  OPEN      OBSCAFIL,OBSCAFNM
UPCAL100  READ      OBSCAFIL,SEQ;OBSCAREA
          GOTO      UPCAL999 IF OVER
          MATCH     "%START:",OBSCAREA
          IF        @EQUAL
            CALL      CLCAL000
            MOVE      ZERO,OBSCAREA
            GOTO      UPCAL100
          ENDIF
UPCAL110  ADD       ONE,OBSCALIN
          PACK      KEY11,ADMISSNO,OBSCALIN,SP70
          UNPACK    KEY11,OBCLVISN,OBCLCNTR
          CALL      RDOBCAL1
          COMPARE   ZERO,OVRCD
          GOTO      UPCAL110 IF EQUAL
          MOVE      OBSCAREA,OBCLCALL
          CALL      WROBCAL1
          GOTO      UPCAL100
.
UPCAL999  RETURN
+
.------------------------------------------------------------
. Clear/Delete Observation Diagnosis
.------------------------------------------------------------
CLOBD000  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBDIA1
CLOBD100  CALL      RKOBDIA1
          BRANCH    OVRCD,CLOBD999
          MATCH     OBDIVISN,ADMISSNO
          GOTO      CLOBD999 IF NOT EQUAL
          PACK      KEY11,OBDIVISN,OBDILINE,SP70
          CALL      DEOBDIA1
          CALL      RSOBDIA1
          GOTO      CLOBD100
CLOBD999  RETURN
.------------------------------------------------------------
. Clear/Delete Observation Procedures
.------------------------------------------------------------
CLOBP000  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBPRO1
CLOBP100  CALL      RKOBPRO1
          BRANCH    OVRCD,CLOBP999
          MATCH     OBPRVISN,ADMISSNO
          GOTO      CLOBP999 IF NOT EQUAL
          PACK      KEY11,OBPRVISN,OBPRLINE,SP70
          CALL      DEOBPRO1
          CALL      RSOBPRO1
          GOTO      CLOBP100
CLOBP999  RETURN
.------------------------------------------------------------
. Clear/Delete Observation Reasons for admission
.------------------------------------------------------------
CLOBA000  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBREA1
CLOBA100  CALL      RKOBREA1
          BRANCH    OVRCD,CLOBA999
          MATCH     OBREVISN,ADMISSNO
          GOTO      CLOBA999 IF NOT EQUAL
          PACK      KEY11,OBREVISN,OBRELINE,SP70
          CALL      DEOBREA1
          CALL      RSOBREA1
          GOTO      CLOBA100
CLOBA999  RETURN
.------------------------------------------------------------
. Clear/Delete Observation Brief History of Present Illness
.------------------------------------------------------------
CLOBH000  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBBHI1
CLOBH100  CALL      RKOBBHI1
          BRANCH    OVRCD,CLOBH999
          MATCH     OBBHVISN,ADMISSNO
          GOTO      CLOBH999 IF NOT EQUAL
          PACK      KEY11,OBBHVISN,OBBHLINE,SP70
          CALL      DEOBBHI1
          CALL      RSOBBHI1
          GOTO      CLOBH100
CLOBH999  RETURN    
.------------------------------------------------------------
. Clear/Delete Observation Brief Physical Exam
.------------------------------------------------------------
CLOBE000  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBBPH1
CLOBE100  CALL      RKOBBPH1
          BRANCH    OVRCD,CLOBE999
          MATCH     OBBPVISN,ADMISSNO
          GOTO      CLOBE999 IF NOT EQUAL
          PACK      KEY11,OBBPVISN,OBBPLINE,SP70
          CALL      DEOBBPH1
          CALL      RSOBBPH1
          GOTO      CLOBE100
CLOBE999  RETURN
.------------------------------------------------------------
. Clear/Delete Laboratory Results
.------------------------------------------------------------
CLOBL000  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBLAB1
CLOBL100  CALL      RKOBLAB1
          BRANCH    OVRCD,CLOBL999
          MATCH     OBLBVISN,ADMISSNO
          GOTO      CLOBL999 IF NOT EQUAL
          PACK      KEY11,OBLBVISN,OBLBLINE,SP70
          CALL      DEOBLAB1
          CALL      RSOBLAB1
          GOTO      CLOBL100
CLOBL999  RETURN
.------------------------------------------------------------
. Clear/Delete Observation Restrictions
.------------------------------------------------------------
CLRES000  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBRES1
CLRES100  CALL      RKOBRES1
          BRANCH    OVRCD,CLRES999
          MATCH     OBRSVISN,ADMISSNO
          GOTO      CLRES999 IF NOT EQUAL
          PACK      KEY11,OBRSVISN,OBRSLINE,SP70
          CALL      DEOBRES1
          CALL      RSOBRES1
          GOTO      CLRES100
CLRES999  RETURN
.------------------------------------------------------------
. Clear/Delete Observation Physical Activity
.------------------------------------------------------------
CLPHY000  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBPHY1
CLPHY100  CALL      RKOBPHY1
          BRANCH    OVRCD,CLPHY999
          MATCH     OBPHVISN,ADMISSNO
          GOTO      CLPHY999 IF NOT EQUAL
          PACK      KEY11,OBPHVISN,OBPHLINE,SP70
          CALL      DEOBPHY1
          CALL      RSOBPHY1
          GOTO      CLPHY100
CLPHY999  RETURN
.------------------------------------------------------------
. Clear/Delete Observation Diet Details        
.------------------------------------------------------------
CLDIT000  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBDIT1
CLDIT100  CALL      RKOBDIT1
          BRANCH    OVRCD,CLDIT999
          MATCH     OBDTVISN,ADMISSNO
          GOTO      CLDIT999 IF NOT EQUAL
          PACK      KEY11,OBDTVISN,OBDTCNTR,SP70
          CALL      DEOBDIT1
          CALL      RSOBDIT1
          GOTO      CLDIT100
CLDIT999  RETURN
.------------------------------------------------------------
. Clear/Delete Observation When to call       
.------------------------------------------------------------
CLCAL000  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBCAL1
CLCAL100  CALL      RKOBCAL1
          BRANCH    OVRCD,CLCAL999
          MATCH     OBCLVISN,ADMISSNO
          GOTO      CLCAL999 IF NOT EQUAL
          PACK      KEY11,OBCLVISN,OBCLCNTR,SP70
          CALL      DEOBCAL1
          CALL      RSOBCAL1
          GOTO      CLCAL100
CLCAL999  RETURN
.------------------------------------------------------------
. Output Diagnosis Comments to HTMLFILE
.------------------------------------------------------------
OBDHTM00  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBDIA1
OBDHTM10  CALL      RKOBDIA1
          BRANCH    OVRCD,OBDHTM99
          MATCH     ADMISSNO,OBDIVISN
          GOTO      OBDHTM99 IF NOT EQUAL
          STRIP     OBDIDIAG
          MOVELPTR  OBDIDIAG,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      OBDIDIAG,VAR
          WRITE     HTMLFILE;VAR
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<br>"
          ENDIF
          SFORMAT   VAR,127
          GOTO      OBDHTM10
.
OBDHTM99  RETURN
.
.------------------------------------------------------------
. Output Procedures Comments to HTMLFILE
.------------------------------------------------------------
OBPHTM00  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBPRO1
OBPHTM10  CALL      RKOBPRO1
          BRANCH    OVRCD,OBPHTM99
          MATCH     ADMISSNO,OBPRVISN
          GOTO      OBPHTM99 IF NOT EQUAL
          STRIP     OBPRPROC
          MOVELPTR  OBPRPROC,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      OBPRPROC,VAR
          WRITE     HTMLFILE;VAR
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<br>"
          ENDIF
          SFORMAT   VAR,127
          GOTO      OBPHTM10
.
OBPHTM99  RETURN
+
.------------------------------------------------------------
. Output Reasons for Admission to HTMLFILE
.------------------------------------------------------------
OBRHTM00  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBREA1
OBRHTM10  CALL      RKOBREA1
          BRANCH    OVRCD,OBRHTM99
          MATCH     ADMISSNO,OBREVISN
          GOTO      OBRHTM99 IF NOT EQUAL
          STRIP     OBREREAS
          MOVELPTR  OBREREAS,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      OBREREAS,VAR
          WRITE     HTMLFILE;VAR
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<br>"
          ENDIF
          SFORMAT   VAR,127
          GOTO      OBRHTM10
.
OBRHTM99  RETURN
+
.------------------------------------------------------------
. Output Brief History of Present Illness  
.------------------------------------------------------------
OBHHTM00  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBBHI1
OBHHTM10  CALL      RKOBBHI1
          BRANCH    OVRCD,OBHHTM99
          MATCH     ADMISSNO,OBBHVISN
          GOTO      OBHHTM99 IF NOT EQUAL
          STRIP     OBBHDESC 
          MOVELPTR  OBBHDESC,LENGTH
.         
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.         
          SFORMAT   VAR,LENGTH
          MOVE      OBBHDESC,VAR
          WRITE     HTMLFILE;VAR 
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<br>"
          ENDIF
          SFORMAT   VAR,127
          GOTO      OBHHTM10
.
OBHHTM99  RETURN
+
.------------------------------------------------------------
. Output Laboratory Results
.------------------------------------------------------------
OBLHTM00  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBLAB1 
OBLHTM10  CALL      RKOBLAB1
          BRANCH    OVRCD,OBLHTM99
          MATCH     ADMISSNO,OBLBVISN
          GOTO      OBLHTM99 IF NOT EQUAL
          STRIP     OBLBDESC
          MOVELPTR  OBLBDESC,LENGTH
.         
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF     
.         
          SFORMAT   VAR,LENGTH
          MOVE      OBLBDESC,VAR
          WRITE     HTMLFILE;VAR
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<br>"
          ENDIF
          SFORMAT   VAR,127
          GOTO      OBLHTM10
. 
OBLHTM99  RETURN
+
.------------------------------------------------------------
. Output Brief Physical Exam                
.------------------------------------------------------------
OBEHTM00  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBBPH1
OBEHTM10  CALL      RKOBBPH1
          BRANCH    OVRCD,OBEHTM99
          MATCH     ADMISSNO,OBBPVISN
          GOTO      OBEHTM99 IF NOT EQUAL
          STRIP     OBBPDESC
          MOVELPTR  OBBPDESC,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      OBBPDESC,VAR
          WRITE     HTMLFILE;VAR
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<br>"
          ENDIF
          SFORMAT   VAR,127
          GOTO      OBEHTM10
.
OBEHTM99  RETURN
+
.------------------------------------------------------------
. Output Restrictions to HTMLFILE
.------------------------------------------------------------
RESHTM00  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBRES1
RESHTM10  CALL      RKOBRES1
          BRANCH    OVRCD,RESHTM99
          MATCH     ADMISSNO,OBRSVISN
          GOTO      RESHTM99 IF NOT EQUAL
          STRIP     OBRSREST
          MOVELPTR  OBRSREST,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      OBRSREST,VAR
          WRITE     HTMLFILE;VAR
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<br>"
          ENDIF
          SFORMAT   VAR,127
          GOTO      RESHTM10
.
RESHTM99  RETURN
+
.------------------------------------------------------------
. Output Physical Activity to HTMLFILE
.------------------------------------------------------------
PHYHTM00  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBPHY1
PHYHTM10  CALL      RKOBPHY1
          BRANCH    OVRCD,PHYHTM99
          MATCH     ADMISSNO,OBPHVISN
          GOTO      PHYHTM99 IF NOT EQUAL
          STRIP     OBPHPHYS
          MOVELPTR  OBPHPHYS,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      OBPHPHYS,VAR
          WRITE     HTMLFILE;VAR
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<br>"
          ENDIF
          SFORMAT   VAR,127
          GOTO      PHYHTM10
.
PHYHTM99  RETURN
+
.------------------------------------------------------------
. Output Diet Details to HTMLFILE
.------------------------------------------------------------
DITHTM00  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBDIT1
DITHTM10  CALL      RKOBDIT1
          BRANCH    OVRCD,DITHTM99
          MATCH     ADMISSNO,OBDTVISN
          GOTO      DITHTM99 IF NOT EQUAL
          STRIP     OBDTDIET
          MOVELPTR  OBDTDIET,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      OBDTDIET,VAR
          WRITE     HTMLFILE;VAR
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<br>"
          ENDIF
          SFORMAT   VAR,127
          GOTO      DITHTM10
.
DITHTM99  RETURN
+
.------------------------------------------------------------
. Output When to Call details to HTMLFILE
.------------------------------------------------------------
CALHTM00  PACK      KEY11,ADMISSNO,SP70
          CALL      RSOBCAL1
CALHTM10  CALL      RKOBCAL1
          BRANCH    OVRCD,CALHTM99
          MATCH     ADMISSNO,OBCLVISN
          GOTO      CALHTM99 IF NOT EQUAL
          STRIP     OBCLCALL
          MOVELPTR  OBCLCALL,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      OBCLCALL,VAR
          WRITE     HTMLFILE;VAR
          MATCH     "1",KEY1
          IF        @EQUAL
            WRITE     HTMLFILE;"<br>"
          ENDIF
          SFORMAT   VAR,127
          GOTO      CALHTM10
.
CALHTM99  RETURN
+

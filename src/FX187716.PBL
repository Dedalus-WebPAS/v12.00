.*****************************************************************************
.*    Program      : FX187716                                                *
.*    Description  : Clear sion pmsmtiaf to new File layout                  *
.*                                                                           *
.*    Author       : J.Tan                                                   *
.*    Date         : 07/11/2007                                              *
.*    Modifications: V9.09.00 07/11/2007 J.Tan         CAR 151803            *
.*                            Created fix                                    *
.*****************************************************************************
.
          INC       STD001FD
          INC       PMSMTIFD/INC
.
DIM4      DIM       4
DIM4A     DIM       4
DIM6      DIM       6
DIM6A     DIM       6
DIM60     DIM       60
DDCENT    DIM       2
.
RECNUM    FORM      8
SAVEFLG   FORM      1
SP50      INIT    "                                                  "
SP60      INIT    "                                                            "
.
PRGNAM    INIT      "Fix PMSMTIFD"
PRGID     INIT      "FX187716"
VERSION   INIT      "V12.00.00"
.
. Start of Program
.
MAIN0000  CALL      INIT0000                      * init and open files
          BRANCH    EXIT,MAIN9999                 * init failure
.
          CALL      CONTQST                       * Ok to continue ?
          BRANCH    CEXIT,MAIN1000,MAIN0000,MAIN9999 * Yes, no, cancel
.
MAIN1000  CALL      READ0000                     * read old records and WRPMMTI1
.
MAIN9999  CHAIN     PGM
+
.********************************************************************
.*                          INIT0000                                *
.*  Display heading and check that the files needed exist&open them *
.********************************************************************
INIT0000  CALL      DISPHEAD
          MOVE      ZERO,RECNUM
          OPEN      PMSMTIA1,"pmsmtiaf"
          
INIT9999  RETURN
.
.**********************************************************************
.*                               READ0000                             *
.*             loop thru old file and WRPTFX11 each record               *
.**********************************************************************
READ0000  DISPLAY   *P1:20,*EL,"Record No. : ";
          PACK      KEY14,SP60
          CALL      RSPMMTI1
READ1000  CALL      RKPMMTI1                      * read next record
          BRANCH    OVRCD,READ6000                * no more records
          ADD       ONE,RECNUM                    * update record counter
.
.  All necessary changes to the files field lengths, date changes
.  or any other sort of modification must be made here
.
          MOVE      "  0.00",PMMISCHF
          MOVE      SP70,PMMIITYP          
          PACK      PMMISPAR,SP70,SP70
.                                               * Pack key here
          PACK      KEY14,PMMIVISN,PMMITRAN,SP70
          CALL      UPPMMTI1                       * WRPMMTI1 to new file
.
          IF        (RECNUM%1000) = 0
            DISPLAY   *P15:20,*V2LON,RECNUM
          ENDIF
.
          GOTO      READ1000                      * get next record
.
READ6000  CLOSE     PMSMTIA1                      * close new file
.
          CALL      IBACLOCK
          REP       " 0",CDATE
          DISPLAY   *P1:22,"Ended  : ",CDATE,SP1,CTIMEIS
.
READ9999  RETURN
.
+
          INC       PMSMTIIO/INC
          INC       STD001IO

. ************************************************************
. *                P R O G R A M  S U M M A R Y              *
. *                - - - - - - -  - - - - - - -              *
. *                                                          *
. *     PROGRAM NAME:          ANSWER                        *
. *                                                          *
. *     FUNCTION:              THIS IS THE STARTING PROGRAM  *
. *                            FOR ALL SYSTEMS               *
. *                                                          *
. *     AUTHOR:                SOMEONE FROM THE PAST         *
. *                                                          *
. *     MODIFICATIONS:                                       *
. *     C1.00.01   05/10/1995  MATT                          *
. *                Changed CONTROLF definition of SFILE      *
. *                                                          *
. ************************************************************
. *                                                          *
. *                                                          *
. ************************************************************
. * Mods     : V5.07     06/10/98  Jim Stathopoulos          *
. *                      507 Changes                         *
. ************************************************************
. *     MODIFICATIONS:         10/07/89 R. Romei (I.B.A.)    *
. *                            Added 3 new variables to      *
. *                            COMMON                        *
. *                            16/08/89 Graeme Williams      *
. *                            Added CHOSINDX, CCODDIMA and  *
. *                            CCODDIMB to common data area  *
. *                            30/09/89 Graeme Williams      *
. *                            Added EXITCHAR to common data *
. *                                                          *
. *                            14/05/91 B.G.Ackland          *
. *                            Rep 0/ in Exitchar            *
. *                                                          *
. *                  * A T T E N T I O N *                   *
. *                  - - - - - - - - - - -                   *
. *            THIS PROGRAM IS THE PROPERTY OF               *
. *            INFORMATION BUILDERS (AUSTRALIA) PTY LTD      *
. *            AND MUST NOT BE UTILISED MODIFIED OR          *
. *            COPIED IN ANY MANNER WHATSOEVER WITHOUT       *
. *            THE EXPRESS WRITTEN PERMISSION OF             *
. ************************************************************
.
. ANSWER PROGRAM FOR ALL PORTS
.
ERROR    DIM       18
ERRA     FORM      1             ***** SYSTEM DATE INDICATOR
SECACC1  DIM       1
SECACC2  DIM       1
SECACC3  DIM       1
SECACC4  DIM       1
CDD      FORM      2
CMM      FORM      2
CYY      FORM      2
CCC      FORM      2
PORT     DIM       2                 /*  FOR THE PAYROLL SYSTEM THIS FIELD IS
.                                         THE SYSTEM ID.
PGM      DIM       8
FNM      DIM       5
.
PSEC     FORM      5
.
IDDD     DIM       6
CPBS     FORM      1                 /*  FOR THE PAYROLL SYSTEM THIS FIELD IS
.                                         THE FREQUENCY CODE
.
.                                    /*  FOR THE DEBTORS SYSTEM THIS FIELD IS
.                                         MENU NUMBER
.
PORTNO    FORM      2                            *  THIS IS THE PORT #
UID       DIM       3                            *  USER IDENTIFICATION
PERIOD    FORM      2                            *  COSTING PERIOD
SECLEV    FORM      1                            *  SECURITY LEVEL
PASSCODE  DIM       4                            *  USER'S PASSCODE
.
PASSCD    DIM       2                            *  PASSCODE CHECK DIGITS
CPPAPER   FORM      2                            *  Report Paper Type
SPLFILE   DIM       8                            *  SPOOL FILE NAME
CPRTFLG   FORM      2                            *  System name for printer
.                                                  0 = Normal Printing
.                                                  1 = No Printing Functions
.                                                  2 = Spooling from IBAMENU
.                                                  3 = Spooling inside program
.
.
CNAME     DIM       35                           * COMPANY NAME
CDATE     DIM       10                           * DATE DD/MM/YYCC OR MM/DD/YYCC
CPROGLEV  FORM      1                            * Program Security Level
CPRTGRP   DIM       2                            * Printer Group
CDEPCDE   DIM       3                            * Department Code
CHOSINDX  FORM      2                            * Hospital Unique Index code
CCODDIMA  DIM       3                            * Spare Variable
CCODDIMB  DIM       3                            * Spare Variable
EXITCHAR  DIM       1                            * Exit character
CCDEPT    DIM       3                * Department for Printer System
CCMENU    DIM       8                * Current Menu
.
.     THE REST ARE PROGRAM VARIABLES
.
PORTADD  FORM      1
SPNAME   DIM       8
.
 IFGE     $$VER,7
CONTROLF  SFILE     ASCII,FIXED=256
 XIF
 IFEQ     $$VER,6
CONTROLF  FILE      ASCII,FIXED=256
 XIF
.
         INC       IBACOMM/INC
         INC       JULCALEN/INC
KEY2      DIM       2
KEY60     DIM       60
.
PRGNAM   INIT      "ANSWER"
PRGID    INIT      "ANSWER"
VERSION   INIT      "V12.00.00"
.
.
.        ABORT     DENY
.
         MOVE      SP1,SECACC1
         MOVE      SP1,SECACC2
         MOVE      SP1,SECACC3
         MOVE      SP1,SECACC4
         MOVE      SP8,PGM
         MOVE      SP5,FNM
         MOVE      SP6,IDDD
         MOVE      SP20,ERROR
         MOVE      SP3,UID
         MOVE      SP4,PASSCODE
         MOVE      ZERO,ERRA   *** USED IN IHA00
         MOVE      ZERO,PSEC
         MOVE      ZERO,CPBS
         MOVE      ZERO,PERIOD
         MOVE      ZERO,SECLEV
         MOVE      SP8,SPLFILE
         MOVE      SP2,PASSCD
         MOVE      ZERO,CPPAPER
         MOVE      ZERO,CPRTFLG
         MOVE      ZERO,CPROGLEV
         MOVE      SP2,CPRTGRP
         MOVE      SP3,CDEPCDE
         MOVE      ZERO,CHOSINDX
         MOVE      SP3,CCODDIMA
         MOVE      SP3,CCODDIMB
         MOVE      SP1,EXITCHAR
         MOVE      SP3,CCDEPT
         MOVE      SP8,CCMENU
.
.   SET DATE IN CONTROL FILES
.
         TRAP      NOFILE IF IO
         OPEN      CONTROLF,"controlf"
         TRAPCLR   IO
.
         CLOCK     DEPT,CCDEPT		*  set NSM department code
         CLOCK     PORT,PORT
         MOVE      PORT,PORTNO
.
         READ      CONTROLF,ZERO;*2,CDD,CMM,CYY,CCC,EXITCHAR
.
         MOVE      CDD,CDAY
         MOVE      CMM,CMON
         MOVE      CYY,CYEAR
         MOVE      CCC,CCENT
.
         CALL      PACDATE
         MOVE      CPCDATE,CDATE
.
         READ      CONTROLF,TWO;*41,PORTADD,*154,SPNAME
         READ      CONTROLF,TEN;*244,CHOSINDX
         ADD       PORTADD,PORTNO
.
         REP       " \",EXITCHAR
         REP       "0\",EXITCHAR
.
         CALL      IBACLOCK
         CLOSE     CONTROLF
.
NODEBT   NORETURN
.
EXIT     CHAIN     SPNAME
.
NOFILE   KEYIN     *P1:24,*B,*EL,"FATAL ERROR : System Control File Missing ":
                             " Hit ",*V2LON,"<RETURN>",*HOFF:
                             " to continue ",*EOFF,ANS;
.
         SHUTDOWN  ""
.
         INC       IBAOVRIO/INC
.
         INC       IBADATE
         INC       IBACOMN
         INC       JULCON

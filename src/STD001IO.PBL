          INC      IBADATE
          INC      IBATIME
          INC      JULCON
          INC      DMYCON
          INC      IBACOMN
          INC      IBAOVRIO/INC
          INC      IBACODIO/INC
.------------------------------------------------------------
. Function   : System Locking Routines
.              These Routines are to be used in places where the
.              pi instruction would have been used to protect
.              updates to ASCII files etc.
.              System Lock Codes will be stored on the system
.              codes table ibacodef.
.              For Control File (controlf) updates the System Lock Code
.              will be the Sector that is being updated.
.              Other System Lock Code will be arbitary Alpha values.
.              Arbitary System Lock Codes will be allocated as required
.              by Analysts or Senior Programmers.
.
. Lock Codes : Code  Description    
.              BNK - PATBNKFD
.              FIN - PATFINFD
.              PFR - PRIFINFD
.              STA - PATSTAFD
.              AST - AAESTAFD
.              AUX - AAEAUXFD
.              OUX - OUTAUXFD
.              PDS - PCPDSCFD
.              PUC - PATAUCFD
.              PUM - PATAUMFD
.              PUR - PATRCAUD
.              PUF - PATAUFFD
.              PUL - PATAULFD
.              PUJ - PATAUJFD
.              PUD - PATAUDFD
.              PUB - PATAUBFD
.              PUI - PATAUIFD
.              PUP - PATAUPFD
.              PU1 - PATAU1FD
.              PZ1 - PATAZ1FD
.              PUE - PATAUEFD
.              PUT - PATAUTFD
.              PFG - PATFIGFD
.              PRF - PATRFNFD
.              PRG - PRIFIGFD
.              PRJ - PRIAUJFD
.              PUA - PATAUAFD
.
. Routine    : GETSLK00 - Get System Lock
.            : RELSLK00 - Release System Lock
.
. Input      : PRXCODE - System Lock Code
.
.------------------------------------------------------------
. Get Record Lock
.------------------------------------------------------------
GETSLK00   OPEN      IBACODE1,"ibacodef"
           MOVE      "~~",KEY2
           MOVE      PRXCODE,KEY3
           PACK      KEY5,KEY2,KEY3
           CALL      RLIBCOD1
           BRANCH    OVRCD,GETSLK90,GETSLK91
           GOTO      GETSLK99
.
GETSLK90   CALL      WRTLCK00     * Write Lock Record to ibacodes
           GOTO      GETSLK00
.
GETSLK91   DISPLAY   "Waiting on System Lock ",KEY5,*W1
           GOTO      GETSLK00
.
GETSLK99   RETURN
.------------------------------------------------------------
. Release Record Lock
.------------------------------------------------------------
RELSLK00   CALL      UUIBCOD1
           RETURN
.------------------------------------------------------------
. Write Lock Record to ibacodef
.------------------------------------------------------------
WRTLCK00   MOVE      "~~",PRXCATA
           MOVE      KEY3,PRXCODE
           CLEAR     PRXDESC
           APPEND    "System Lock ",PRXDESC
           APPEND    PRXCODE,PRXDESC
           RESET     PRXDESC
           CALL      WRIBCOD1
           RETURN
.

.*********************************************************************
.*                  OPTHETAT                                         *
.*        Write theatre audit details to opradtaf                    *
.*   Requires  a valid oprdetaf record with : Unique Theatre Id      *
.*   Requires TADTTYPE for audit type                                *
.*              Type                                                 *
.*********************************************************************
.----------------------------------------------------------------------
. V10.12.01 01/06/2018  Ebon Clements  TSK 0858171
.           Added trap to opradtaf write
. V10.11.01 16/10/2017  Thanh T.       TSK 0846191
.           Fixed the incorrect data being written to opradtaf.opadchan
.----------------------------------------------------------------------
.
          DEFPROC   OPTHETAT
.
          INC       OPRADTFD/INC
.
OPTHET00  OPEN      OPRADTA1,"opradtaf"
.
          CALL      IBACLOCK
          PACK      OPADADAT,CCC,CYY,CMM,CDD
          REP       " 0",OPADADAT
          CLOCK     TIME,OPADATIM
          PACK      OPADATYP,TADTTYPE
          PACK      OPADUNIQ,OPDAUNIQ,SP70
          PACK      OPADURNO,OPDAURNO,SP70
          PACK      OPADWEBU,USERID,SP70
          PACK      OPADVISN,OPDAADMN,SP70
.
. **** when transferring, store the new unique id in opadchan 
          MATCH     "004",OPADATYP
          IF        @EQUAL
            PACK      OPADCHAN,OPADUNIQ,SP70
            PACK      OPADUNIQ,OLDUNIQ,SP70
          ELSE
            MOVE      SP70,OPADCHAN
          ENDIF
.
          PACK      KEY39,OPADUNIQ,OPADADAT,OPADATIM,OPADATYP,OPADWEBU,SP70
          CALL      RAOPADT1
          IF        OVRCD=1
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            CALL      WROPADT1
            TRAPCLR   IO
          ENDIF
.
OPTHET99  GOTO      OPTHTEND
.
          INC       OPRADTIO/INC
          INC       IBAOVRIO/INC
.
OPTHTEND  ENDPROC

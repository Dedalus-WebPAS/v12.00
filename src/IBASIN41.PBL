.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.04.01  11.04.2005 Peter Vela CAR 59696
.           Recompiled for SINUSAGE
. V9.03.02  10.09.2003 Steve Downing (VF.11.02 CAR 9375)
.           Recompiled for SINREBFD & SINREBIO
. V9.03.01  16.07.2003 Henry Son     (VF.11.01 CAR 40970)
.           Incorrectly calculating counted stock
.           By ignoring the SNCOIMPQ control variable.
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.09.07  16.04.2003  Henry Son   CAR 38248
.           Stock items not being picked up.
. VF.09.06  05.12.2002  Steve Downing  SRF 13521
.           Fixed defaulting of Warehouse when adding items
. VF.09.05  24.10.2002  B.G.Ackland
.           Fixed logic in VERI0000 on OVER for Read on load file.
. VF.09.04  10.04.2002  Steve Armstrong   srf 16060
.           Fixed logic at IMPT1100 where SNCOIMPQ=1 such that quantity
.           required is determined correctly.
. VF.09.03  05.03.2002  Steve Armstrong   srf 16060
.           Fixed setting of EXIT flag when backorder encountered.
.           EXIT should only be set to "1" when all items are already
.           on backorder.  Previously was setting EXIT to "1" when
.           there was one item on backorder, but others weren't.
.           Also fixed check after CHKOSP00 to be on EXIT1 instead of EXIT.
. VF.09.02  01.10.2001  Glenn Saunders & Greg Horvat  SRF 12134
.           Problems for scanners caused when the SNCOCAT6 parm set.
.           Format error being raised because processing being performed on
.           an i/o variable before the trap has been cleared.
.           Routine GETCAT00 moved to AFTER i/o format trap cleared.
. VF.09.01  28.05.2001 Dave Matthews
.           Exception report when imported download file contains
.           Cost Centre/Catalogue combination for which an outstanding
.           order exists
.           SRF 10140
. VF.09.B01 02.11.2000 Charles Handaya
.           Recompiled for sincchaf and SINUSAGE change
.           Modification of Warehouse Security
.-------------------------------------------------------
. VF.01.02  08.08.2000 Sandra Barcham
.           Allow any number of Characters in catalog import file
.           SRF   4010
. VF.01.01  19.07.2000 Charles Handaya
.           Record all errors in Error Report while verifying import file
.           SRF   638926
.           13.07.2000 Charles Handaya
.           Add new Omnicell import file
.           (copy from Import Barcode Screen 02 and IMPT0000 Function)
.           Quote 9817
.-------------------------------------------------------
. VF.00.05  05.01.2000 Charles Handaya
.           Recompiled for APSMASIO change
.           22.12.1999 Charles Handaya
.           Recompiled for Fixing Audit Date (CCYYMMDD)
. VF.00.04  03.11.1999 Sandra Barcham
.           Change locked message to use X
. VF.00.03  19.08.1999 Sandra Barcham
.           Accept 6 char catalog code from barcode
.           Quote 9468
. VF.00.02  06.08.1999 Sandra Barcham
.           Only allow to backorder up to the maximum quantity
. VF.00.01  06.07.1999 Sandra Barcham
.           Allow barcode imprest entry to use quantity required or counted
.-------------------------------------------------------
BACKORDR  FORM      1             * Backorder flag
.                                    1 = All items on backorder
.                                    0 = one or more items not on backorder
CURRCAT   DIM       7
.
SECSIWS   FORM      1
.
TMCATWAR  IFILE     SQL, FIXED=13,  KEY="U1-7,8-12"
.                 Size       Start
.                 -----      -----
TMCWCAT   DIM       7          1
TMCWWAR   DIM       5          8
.                            -----
.                             13
TMPCWNAM  INIT      "sint41"
TMPCATWH  DIM       8
QTYREQ    FORM      6
QTYEXT    FORM      6
IMPFLFLG  FORM      1        * 0=normal file, 1=Omnicell file
IMPORTFN  DIM       8
IMPORTFL  FILE      ASCII, FIXED=200
LOWUP     INIT      "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"
EXIT1     FORM      1
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASIN41
.   Function      :   Input Counted Imprest Worksheets        
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       APSMASFD/INC
          INC       IBAGEDFD/INC
          INC       IBAGSTFD/INC
          INC       SINBACFD/INC
          INC       SINCCAFD/INC
          INC       SINCCBFD/INC
          INC       SINCCEFD/INC
          INC       SINCCFFD/INC
          INC       SINCCHFD/INC
          INC       SINCGBFD/INC
          INC       SINCIAFD/INC
          INC       SINCICFD/INC
          INC       SINCIEFD/INC
          INC       SINCIHFD/INC
          INC       SINCIIFD/INC
          INC       SINCONFD/INC
          INC       SINFACFD/INC
          INC       SINIMPFD/INC
          INC       SINIMXFD/INC
          INC       SINIPSFD/INC
          INC       SINITMFD/INC
          INC       SINNATFD/INC
          INC       SINNPOFD/INC
          INC       SINPERFD/INC
          INC       SINPOCFD/INC
          INC       SINREAFD/INC
          INC       SINREBFD/INC
          INC       SINSCDFD/INC
          INC       SINSCMFD/INC
          INC       SINSECFD/INC
          INC       SINSUAFD/INC
          INC       SINSUBFD/INC
          INC       SINTMPDF/INC
          INC       SINWARFD/INC
          INC       SINWRKDF    
          INC       SINWRKFD/INC
          INC       SINWSEFD/INC
.=========================
.Local Variable Definition
.-------------------------
.
.    Multi Item Key Fields Scr 00 Fld     1
.-------------------------------------------------------
SIIX1NAM  INIT      "SIIX1"
SIIX1LEN  FORM      "128"
SIIX1IDX  INIT      "DC1-5 UC6-8"
SIIX1FNM  DIM       8  * Filename
SIIX1AFL  FORM      1  * End Accept Mode
SIIX1END  FORM      1  * End Display
SIIX1SNO  FORM      5  * Number of Items on the Screen
SIIX1NXT  DIM          8
SIIX1FL1  IFILE     SQL, FIXED=128,  KEY="D1-5"
SIIX1FL2  IFILE     SQL, FIXED=128, KEY="U6-8"
SIIX1CNT  FORM      3  * Number of Items on Screen
COSTCENT  DIM       5 * Scr 00 Fld     4
RETUDATE  DIM       8 * Scr 00 Fld    35
RETUPERD  DIM       4 * Scr 00 Fld    36
COUNTER3  FORM      3 * Scr 00 Fld    40
DEFLTWH   DIM       5 * Scr 00 Fld    54
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASIN41"
PRGNAM    INIT      "Input Counted Imprest Worksheets        "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      RPAR0000
          CALL      SC01L000
          CLOSE     SIIX1FL2
          CLOSE     SIIX1FL1,DELETE
.
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   51",AUDTSECT
          MOVE      " 48",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening apsaudma";
            OPEN      APSAUDMA,"apsaudma"
          ENDIF
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA1,"apsmasaf"
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA2,"apsmasaf"
          DISPLAY   *P56:24,"Opening apsmasaf";
          OPEN      APSMASA3,"apsmasaf"
          DISPLAY   *P56:24,"Opening ibagedaf";
          OPEN      IBAGEDA1,"ibagedaf"
          DISPLAY   *P56:24,"Opening ibagstaf";
          OPEN      IBAGSTA1,"ibagstaf"
          DISPLAY   *P56:24,"Opening ibagstaf";
          OPEN      IBAGSTA2,"ibagstaf"
          DISPLAY   *P56:24,"Opening ibagstaf";
          OPEN      IBAGSTA3,"ibagstaf"
          MOVE      "   24",AUDTSECT
          MOVE      "206",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudba";
            OPEN      SINAUDBA,"sinaudba"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "207",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudic";
            OPEN      SINAUDIC,"sinaudic"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "210",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudpc";
            OPEN      SINAUDPC,"sinaudpc"
          ENDIF
          DISPLAY   *P56:24,"Opening sinbacaf";
          OPEN      SINBACA1,"sinbacaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA1,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinccbaf";
          OPEN      SINCCBA1,"sinccbaf"
          DISPLAY   *P56:24,"Opening sincceaf";
          OPEN      SINCCEA1,"sincceaf"
          DISPLAY   *P56:24,"Opening sinccfaf";
          OPEN      SINCCFA1,"sinccfaf"
          DISPLAY   *P56:24,"Opening sincchaf";
          OPEN      SINCCHA1,"sincchaf"
          DISPLAY   *P56:24,"Opening sincchaf";
          OPEN      SINCCHA4,"sincchaf"
          DISPLAY   *P56:24,"Opening sincchaf";
          OPEN      SINCCHA5,"sincchaf"
          DISPLAY   *P56:24,"Opening sincgbaf";
          OPEN      SINCGBA1,"sincgbaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA1,"sinciaaf"
          DISPLAY   *P56:24,"Opening sincicaf";
          OPEN      SINCICA1,"sincicaf"
          DISPLAY   *P56:24,"Opening sincicaf";
          OPEN      SINCICA2,"sincicaf"
          DISPLAY   *P56:24,"Opening sincicaf";
          OPEN      SINCICA3,"sincicaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA1,"sincieaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA2,"sincieaf"
          DISPLAY   *P56:24,"Opening sincihaf";
          OPEN      SINCIHA1,"sincihaf"
          DISPLAY   *P56:24,"Opening sinciiaf";
          OPEN      SINCIIA1,"sinciiaf"
          DISPLAY   *P56:24,"Opening sinfacaf";
          OPEN      SINFACA1,"sinfacaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA1,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA2,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA3,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinimxaf";
          OPEN      SINIMXA1,"sinimxaf"
          DISPLAY   *P56:24,"Opening sinimxaf";
          OPEN      SINIMXA2,"sinimxaf"
          DISPLAY   *P56:24,"Opening sinimxaf";
          OPEN      SINIMXA3,"sinimxaf"
          DISPLAY   *P56:24,"Opening  sinipsaf           ";
          OPEN      SINIPSA1,"sinipsaf"          
          DISPLAY   *P56:24,"Opening sinipsaf";
          OPEN      SINIPSA2,"sinipsaf"
          DISPLAY   *P56:24,"Opening sinitmaf";
          OPEN      SINITMA1,"sinitmaf"
          DISPLAY   *P56:24,"Opening sinnpoaf";
          OPEN      SINNPOA1,"sinnpoaf"
          DISPLAY   *P56:24,"Opening sinperaf";
          OPEN      SINPERA1,"sinperaf"
          DISPLAY   *P56:24,"Opening sinperaf";
          OPEN      SINPERA2,"sinperaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA1,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA2,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA3,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA4,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA5,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA6,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA7,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA8,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA1,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA2,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA3,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA4,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA1,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA2,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA3,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinscdaf";
          OPEN      SINSCDA1,"sinscdaf"
          DISPLAY   *P56:24,"Opening sinscdaf";
          OPEN      SINSCDA2,"sinscdaf"
          DISPLAY   *P56:24,"Opening sinscdaf";
          OPEN      SINSCDA3,"sinscdaf"
          DISPLAY   *P56:24,"Opening sinscmaf";
          OPEN      SINSCMA1,"sinscmaf"
          DISPLAY   *P56:24,"Opening sinsecaf";
          OPEN      SINSECA1,"sinsecaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA1,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsubaf";
          OPEN      SINSUBA1,"sinsubaf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA1,"sinwaraf"
          DISPLAY   *P56:24,"Opening sinwseaf";
          OPEN      SINWSEA1,"sinwseaf"
          DISPLAY   *P56:24,"Opening sinwseaf";
          OPEN      SINWSEA2,"sinwseaf"
.--------------------------------------------------------
. Initialise Batch Screen Unique ID                          
.--------------------------------------------------------
          MOVE     ZERO,SIIX1SNO
          MOVE     "00    1",KEY7
          PACK     KEY15,PRGID,KEY7,SP70
          PACK     KEY20,PRGID,KEY7,SP70
          CALL     RSSCPS2
          CALL     RKSCPS2
          IF       OVRCD=0
            PACK     KEY20,SCPSPID,SCPSSID,SCPSITM
            MATCH    KEY15,KEY20
            IF       @EQUAL
              MOVE     SCPSNOR,SIIX1SNO
            ENDIF
          ENDIF
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Screen                        
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Menu                               
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Import Barcode Download            
          ENDIF
          MATCH     "03",SCRID
          IF         @EQUAL
            CALL       PS03L000   * Import Omnicell File               
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Screen                        
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "   47",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      SETDEF00
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Screen                        
.-------------------------------------------------------
CF00L000  COMPARE   ZERO,ACCEPT
              GOTO      CF00L999 IF EQUAL
          MOVE      SP70,SIIXUNI 
          MOVE      SP70,COSTCENT
          MOVE      SP70,SICADESC
          MOVE      SP70,SIIXCAT 
          MOVE      SP70,SIIADES 
          MOVE      ZERO,SIIAAVC 
          MOVE      SP70,SIIXWAR 
          MOVE      SP70,SIWADES 
          MOVE      ZERO,SIIESOH 
          MOVE      ZERO,SIIXREQ 
          MOVE      ZERO,SIIXQOH 
          MOVE      SP70,SICATELE
          MOVE      SP70,SICACONT
          MOVE      SP70,SICAGL  
          MOVE      SP70,SICAIMPD
          MOVE      SP70,SICADAD1
          MOVE      SP70,SICADAD2
          MOVE      SP70,SICADAD3
          MOVE      ZERO,SICALOC 
          MOVE      SP70,SICAMES 
          MOVE      SP70,SICAUR1 
          MOVE      SP70,SICAUR2 
          MOVE      SP70,SICAUD1 
          MOVE      SP70,SICAUD2 
          MOVE      SP70,SICAUY1 
          MOVE      SP70,SICAUY2 
          MOVE      SP70,SIIASUB 
          MOVE      SP70,SIIAISS 
          MOVE      SP70,SIIANAT 
          MOVE      SP70,SIIAUR1 
          MOVE      SP70,SIIAUR2 
          MOVE      ZERO,SIIMMAX 
          MOVE      SP70,RETUDATE
          MOVE      SP70,RETUPERD
          MOVE      SP70,SIPEPER 
          MOVE      SP70,SIPEYEAR
          MOVE      ZERO,COUNTER3
          MOVE      SP70,DEFLTWH 
          MOVE      SP70,SIWADES 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Screen                        
.--------------------------------------------------------
KY00L000
.
KY00L110
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICATELE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICACONT
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICAGL  
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICAIMPD
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   18",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICADAD1
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   19",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICADAD2
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   20",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICADAD3
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICALOC 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   22",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICAMES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   23",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICAUR1 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   24",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICAUR2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICAUD1 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   26",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICAUD2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICAUY1 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   28",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICAUY2 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "1",CKEYTYP
          CALL      KSICA000
          BRANCH    EXIT,KY00L900,KY00L900
          MOVE      ONE,ACCEPT
          MOVE      COSTCENT,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICADESC,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   14",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICATELE,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   15",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICACONT,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   16",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICAGL,VAR       
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   17",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICAIMPD,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   18",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICADAD1,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   19",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICADAD2,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   20",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICADAD3,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   21",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      SICALOC,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   22",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICAMES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   23",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICAUR1,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   24",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICAUR2,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   25",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            UNPACK    SICAUD1,CCENT,CYEAR,CMON,CDAY           
            CALL      PACDATE
            MOVE      CPCDATE,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   26",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            UNPACK    SICAUD2,CCENT,CYEAR,CMON,CDAY           
            CALL      PACDATE
            MOVE      CPCDATE,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   27",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      SICAUY1,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   28",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      NO,YESNO
            MOVE      ZERO,FORM2
            MOVE      SICAUY2,FORM2    
            LOAD      YESNO,FORM2,YES
            MOVE      YESNO,VAR
            CALL      DISPITEM
          ENDIF
.
KY00L120
.
.
          MOVE      "   55",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIWADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "   54",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "1",CKEYTYP
          CALL      KDEFW000
          BRANCH    EXIT,KY00L110,KY00L900
          MOVE      ONE,ACCEPT
          MOVE      DEFLTWH,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   55",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIWADES,VAR      
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Screen                        
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Screen                        
.---------------------------------------------------------
LM00L000
.---------------------------------------------------------
. Load for :     1 Unique ID                          
.---------------------------------------------------------
          UNPACK    SP70,SIIXPOR,SIIXUNI
          PACK      SIIX1FNM,ANST,SIIX1NAM,PORT
          REP       " 0",SIIX1FNM
          MOVE      ZERO,SIIX1AFL
          CLOSE     SIIX1FL2
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SIIX1FL1,SIIX1FNM
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     SIIX1FL1,DELETE
          ENDIF
          PACK      KEY80,SGENISB,SIIX1FNM,SP1,SIIX1LEN,SP1,SIIX1IDX
          DISPLAY   *P1:3;
          EXECUTE   KEY80,TASKID
          OPEN      SIIX1FL1,SIIX1FNM
          OPEN      SIIX1FL2,SIIX1FNM
          PACK      KEY5,PORT,SP70
          MOVE      KEY5,SAVKEY80
          SETLPTR   SAVKEY80,2 
          CALL      RDSIIX1 
          IF        OVRCD=0
            CALL      RPSIIX1 
          ENDIF
LM00L100
          CALL      RKSIIX1 
          BRANCH    OVRCD,LM00L105
          PACK      KEY5,SIIXPOR,SIIXUNI
          MATCH     SAVKEY80,KEY5    
          GOTO      LM00L105 IF NOT EQUAL
          RESET     KEY5,3
          MOVE      KEY5,KEY3
          MOVE      SP70,SCTMROW
          MOVE      SP70,SCTMCOL
          CALL      TASIIX12
          IF        OVRCD=0
            CALL      TUSIIX12
          ELSE
            CALL      TWSIIX12
          ENDIF
          GOTO     LM00L100
LM00L105
          MOVE     SP70,KEY3   
          CALL     TSSIIX12
          RETURN
.---------------------------------------------------------
. Batch Item Selected Screen : Main Screen                        
.---------------------------------------------------------
SM00L000
          MOVE      ZERO,STDGSFLG
          MOVE      SCPSITM,FIRSTITM
          MOVE      SCPSROW,SCTMROW
          MOVE      SCPSCOL,SCTMCOL
          PACK      KEY15,PRGID,SCRID,SCPSROW,SCPSCOL
          MOVE      KEY15,SKSCPS15
          CALL      RDSCPS1
          COMPARE   ZERO,ACCEPT
          GOTO      SM00L010 IF EQUAL
SM00L005
          MOVE      SCPSROW,CVERT
          MOVE      SCPSCOL,CCOL
          MOVE      SCPSITM,FIELDNO
          MOVE      ONE,STDGSFLG
          BRANCH    FIELDNO,SM00L101,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                           SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010
SM00L006
          CALL      RKSCPS1
          BRANCH    OVRCD,SM00L007
          MATCH     PRGID,SCPSPID
          GOTO      SM00L007 IF NOT EQUAL
          MATCH     SCRID,SCPSSID
          GOTO      SM00L007 IF NOT EQUAL
          MATCH     FIRSTITM,SCPSITM
          GOTO      SM00L007 IF EQUAL
          MATCH     NAMSSFFI,SCPSMTY
          GOTO      SM00L006 IF NOT EQUAL
          GOTO      SM00L005
SM00L007
          MOVE      ZERO,STDGSFLG
          MOVE      SKSCPS15,KEY15
          CALL      RDSCPS1
SM00L010
          BRANCH    STDGSFLG,SM00L006
          CALL      RKSCPS1
          BRANCH    OVRCD,SM00L900
          MATCH     PRGID,SCPSPID
          GOTO      SM00L900 IF NOT EQUAL
          MATCH     SCRID,SCPSSID
          GOTO      SM00L900 IF NOT EQUAL
          MATCH     FIRSTITM,SCPSITM
          GOTO      SM00L900 IF EQUAL
          MATCH     NAMSSFFI,SCPSMTY
          GOTO      SM00L010 IF NOT EQUAL
          MOVE      SCPSROW,CVERT
          MOVE      SCPSCOL,CCOL
          MOVE      SCPSITM,FIELDNO
          BRANCH    FIELDNO,SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L102,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                           SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010
          GOTO      SM00L010
.
SM00L101
          MOVE     ZERO,SIIX1AFL
          MOVE     Z70,KEY3   
          CALL     TSSIIX12
          CALL     TPSIIX12
          IF       OVRCD=1
            MOVE      "3",SECTOR
            NFORMAT   FORM21,SECTOR,ZERO
            MOVE     ONE,FORM21
            MOVE     FORM21,SIIXUNI 
          ELSE
            MOVE      "3",SECTOR
            NFORMAT   FORM21,SECTOR,ZERO
            MOVE     SIIXUNI,FORM21
            ADD      ONE,FORM21
            MOVE     FORM21,SIIXUNI 
          ENDIF
          PACK     KEY5,SIIXPOR,SIIXUNI                                                            
          RESET    KEY5,3
          MOVE     KEY5,KEY3
          CALL      TASIIX12
          IF        OVRCD=0
            MOVE      "Record Already On File - ",DISPMSG
            CALL      MESSAGE1
            GOTO      SM00L101
          ENDIF
          MOVE      SIIXUNI,VAR      
          CALL      DISPITEM
          GOTO     SM00L010
.
SM00L102
          MOVE      "0",CKEYTYP
          CALL      KLINE000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SM00L102
            ENDIF
            BRANCH    EXIT,SM00L102,SM00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SM00L990 IF EQUAL
          ENDIF
          MOVE      SIIXCAT,VAR      
          CALL      DISPITEM
          CALL      GETDSC00
.
.
          MOVE      "    7",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIADES,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   30",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIAISS,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SM00L010
SM00L900
          MATCH    "SIIX1",NAMSSFFI
          IF       @EQUAL
            PACK     KEY5,SIIXPOR,SIIXUNI
            RESET    KEY5,3
            MOVE     KEY5,KEY3
            CALL      TASIIX12
            IF        OVRCD=0
              CALL      TUSIIX12
            ELSE
              CALL      TWSIIX12
            ENDIF
            GOTO      SM00L999
          ENDIF
          GOTO      SM00L999
SM00L990
          MATCH    "SIIX1",NAMSSFFI
          IF       @EQUAL
            MOVE     ONE,SIIX1AFL
          ENDIF
SM00L999
          RETURN
.--------------------------------------------------------
. Display Current Page of Multi Items
.--------------------------------------------------------
DP00L000
          MOVE     ZERO,SIIX1CNT
          MOVE     ZERO,SIIX1END
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DP00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DP00L600
          MATCH    PRGID,SCPSPID
          GOTO     DP00L600 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DP00L600 IF NOT EQUAL
          MATCH    NAMSSFFI,SCPSMTY
          GOTO     DP00L010 IF NOT EQUAL
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,DP00L101,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L102,DP00L103,DP00L010:
                            DP00L104,DP00L010,DP00L010,DP00L105:
                            DP00L106,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L107,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                           DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010
          GOTO      DP00L010
.
DP00L101
          IF        SIIX1END=0
            CALL      TKSIIX12
            IF        OVRCD=1
              MOVE      ONE,SIIX1END
            ELSE
              MOVE      ZERO,SIIX1END
              MOVE      SCPSROW,SCTMROW
              MOVE      SCPSCOL,SCTMCOL
              CALL      TUSIIX12
              MOVE      SIIXUNI,VAR      
              CALL      DISPITEM
            ENDIF
          ENDIF
          IF        SIIX1END=1
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L102
          IF        SIIX1END=0
            MOVE      SIIXCAT,VAR      
            CALL      DISPITEM
          CALL      GETDSC00
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L103
          IF        SIIX1END=0
            MOVE      SIIADES,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L104
          IF        SIIX1END=0
            MOVE      SIIXWAR,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L105
          IF        SIIX1END=0
            MOVE      SIIXREQ,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L106
          IF        SIIX1END=0
            MOVE      SIIXQOH,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L107
          IF        SIIX1END=0
            MOVE      SIIAISS,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
DP00L600
          MATCH    "SIIX1",NAMSSFFI
          GOTO     DP00L605 IF NOT EQUAL
          GOTO     DP00L999
DP00L605
DP00L999
          RETURN
.--------------------------------------------------------
. Display First Page of Multi Items
.--------------------------------------------------------
FP00L000
.
          CALL     CT00L000
          MATCH    "SIIX1",NAMSSFFI
          GOTO     FP00L105 IF NOT EQUAL
          MOVE     SP70,KEY3   
          CALL     TSSIIX12 * Start
          CALL     DP00L000
          GOTO     FP00L999
FP00L105
FP00L999  RETURN
.--------------------------------------------------------
. Display Last Page of Multi Items
.--------------------------------------------------------
LP00L000
.
          CALL     CT00L000
          MATCH    "SIIX1",NAMSSFFI
          GOTO     LP00L105 IF NOT EQUAL
          PACK     KEY3,Z70
          CALL     TSSIIX12
          IF       OVRCD=1
            CALL     TPSIIX12 * End
          ENDIF
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<SIIX1SNO
            CALL     TPSIIX12
            ADD      ONE,SECTOR
          DO
          CALL     DP00L000
          GOTO     LP00L999
LP00L105
LP00L999  RETURN
.--------------------------------------------------------
. Display Previous Page  
.--------------------------------------------------------
PP00L000
.
PP00L100
          MATCH    "SIIX1",NAMSSFFI
          GOTO     PP00L115 IF NOT EQUAL
PP00L105
          MOVE     SP70,SIIX1NXT
          PACK     KEY5,SP1,ONE,SP70
          CALL     TSSIIX11
          CALL     TKSIIX11 * First on Page
          MOVE     KEY3,SIIX1NXT
          CALL     TSSIIX12
          CALL     TPSIIX12 * Get Key
          IF       OVRCD=1
            BEEP
            GOTO      PP00L999
          ENDIF
.
          CALL     CT00L000
.
. Position and Display Page
.--------------------------
PP00L110
          MOVE     SIIX1NXT,KEY3   
          CALL     TSSIIX12
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<=SIIX1SNO
            CALL     TPSIIX12
            ADD      ONE,SECTOR
          DO
          CALL     DP00L000
          GOTO     PP00L999
PP00L115
PP00L999  RETURN
.--------------------------------------------------------
. Display Next Page of Multi Items
.--------------------------------------------------------
NP00L000
          MATCH    "SIIX1",NAMSSFFI
          GOTO     NP00L115 IF NOT EQUAL
NP00L105
          MOVE     SP70,SIIX1NXT
          PACK     KEY5,Z70
          CALL     TSSIIX11
          CALL     TPSIIX11
          MOVE     KEY3,SIIX1NXT
          CALL     TSSIIX12
          CALL     TKSIIX12
          IF       OVRCD=1
            BEEP
            GOTO      NP00L999
          ENDIF
.
          CALL     CT00L000
.
. Position and Display Page
.--------------------------
NP00L110
          MOVE     SIIX1NXT,KEY3   
          CALL     TSSIIX12
          CALL     DP00L000
          GOTO     NP00L999
NP00L115
NP00L999  RETURN
.--------------------------------------------------------
. Clear Page of Multi Items from Temp File
.--------------------------------------------------------
CT00L000
          MATCH    "SIIX1",NAMSSFFI
          GOTO     CT00L115 IF NOT EQUAL
CT00L105
          PACK     KEY5,SP1,ONE,SP70
          CALL     TSSIIX11
          CALL     TKSIIX11
          BRANCH   OVRCD,CT00L110
          CALL     TRSIIX12
          MOVE     SP70,SCTMROW
          MOVE     SP70,SCTMCOL
          CALL     TUSIIX12
          GOTO     CT00L105
CT00L110
          GOTO     CT00L999
CT00L115
CT00L999  RETURN
.----------------------------------
. Clear Pages of Multi Items 
.----------------------------------
CP00L000
          CALL     CT00L000
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
CP00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,CP00L999
          MATCH    PRGID,SCPSPID
          GOTO     CP00L999 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     CP00L999 IF NOT EQUAL
          MATCH    NAMSSFFI,SCPSMTY
          GOTO     CP00L010 IF NOT EQUAL
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,CP00L100,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L100,CP00L100,CP00L010:
                            CP00L100,CP00L010,CP00L010,CP00L100:
                            CP00L100,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L100,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                           CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010
.
CP00L100
          PACK     VAR,SP70,SP70
          CALL     DISPITEM  * Display Blank Item
          GOTO     CP00L010
CP00L999  RETURN
.---------------------------------------------------------
. Add Items
.---------------------------------------------------------
AD00L000
          CALL      CP00L000 * Clear Screen of Items
          PACK      KEY20,PRGID,SCRID,ITMSSFFI,SP70
          CALL      RSSCPS2
AD00L010  CALL      RKSCPS2
          BRANCH    OVRCD,AD00L000
          MATCH     PRGID,SCPSPID
          GOTO      AD00L000 IF NOT EQUAL
          MATCH     SCRID,SCPSSID
          GOTO      AD00L000 IF NOT EQUAL
          MATCH     ITMSSFFI,SCPSITM
          GOTO      AD00L000 IF NOT EQUAL
          PACK      SKSCPS20,SCPSPID,SCPSSID,SCPSITM,SCPSROW,SCPSCOL
          MOVE      ACCEPT,SACCEPT
          MOVE      ONE,ACCEPT
          CALL      SM00L000
          MOVE      SACCEPT,ACCEPT
          MOVE      SKSCPS20,KEY20
          CALL      RDSCPS2
          MATCH     "SIIX1",NAMSSFFI
          IF        @EQUAL
            COMPARE   ZERO,SIIX1AFL
            GOTO      AD00L010 IF EQUAL
            CALL      FP00L000
            GOTO      AD00L999
          ENDIF
AD00L999
          RETURN
.---------------------------------------------------------
. Delete Items
.---------------------------------------------------------
DL00L000  
          MOVE      SCSLDES,DISPMSG
          CALL      MESSAGE2
DL00L005  
          CALL      MDELQ000
          BRANCH    EXIT,DL00L900,DL00L900
          MOVE      SCSLITM,FIELDNO
          MATCH     ITMSSFFI,SCSLITM
          GOTO      DL00L100 IF NOT EQUAL
          CALL      SELECTED
          MATCH     "SIIX1",SCPSMTY
          IF        @EQUAL
            PACK      KEY5,SCSLROW,SCSLCOL
            CALL      TRSIIX11
            IF        OVRCD=0
              CALL      TDSIIX12
            ELSE
              BEEP
              GOTO      DL00L005
            ENDIF
            PACK      KEY5,SP1,ONE,SP70
            CALL      TSSIIX11
            CALL      TKSIIX11
            MOVE     KEY3,SIIX1NXT
            CALL      CT00L000
            MOVE      SIIX1NXT,KEY3   
            CALL      TSSIIX12
            CALL      TPSIIX12
            CALL      DP00L000
            GOTO      DL00L005
          ENDIF
DL00L100  MOVE      "Invalid Selection. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      DL00L005
DL00L900  CALL      MESSAGE3
          RETURN
.---------------------------------------------------------
. Batch IO for Screen : Main Screen                        
.---------------------------------------------------------
.---------------------------------------------------------
. Batch IO for :     1 Unique ID                          
.---------------------------------------------------------
TSSIIX11  RESET     KEY5
          READ      SIIX1FL1,KEY5;;
          RETURN
.
TSSIIX12  RESET     KEY3   
          READ      SIIX1FL2,KEY3;;
          RETURN
.
TASIIX12  RESET     KEY3   
          MOVE      ZERO,OVRCD
          READ      SIIX1FL2,KEY3;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
TDSIIX11  RESET     KEY5
          DELETE    SIIX1FL1,KEY5
          RETURN
.
TDSIIX12  RESET     KEY3
          DELETE    SIIX1FL2,KEY3
          RETURN
.
TKSIIX11  MOVE      ZERO,OVRCD
          READKS    SIIX1FL1;SCTMROW,SCTMCOL,KEY3:
                        SIIXPOR,SIIXUNI,SIIXCST,SIIXCAT,SIIXSEQ:
                        SIIXMAX,SIIXREQ,SIIXQOH,SIIXUR1,SIIXUR2,SIIXUD1:
                        SIIXUD2,SIIXUC1,SIIXUC2,SIIXUY1,SIIXUY2,SIIXWAR:
                        SIIXRESI,SIIXSPA                                        
          GOTO      OVERCOND IF OVER
          RETURN
.
TKSIIX12  MOVE      ZERO,OVRCD
          READKS    SIIX1FL2;SCTMROW,SCTMCOL,KEY3:
                        SIIXPOR,SIIXUNI,SIIXCST,SIIXCAT,SIIXSEQ:
                        SIIXMAX,SIIXREQ,SIIXQOH,SIIXUR1,SIIXUR2,SIIXUD1:
                        SIIXUD2,SIIXUC1,SIIXUC2,SIIXUY1,SIIXUY2,SIIXWAR:
                        SIIXRESI,SIIXSPA                                        
          GOTO      OVERCOND IF OVER
          RETURN
.
TPSIIX11  MOVE      ZERO,OVRCD
          READKP    SIIX1FL1;SCTMROW,SCTMCOL,KEY3:
                        SIIXPOR,SIIXUNI,SIIXCST,SIIXCAT,SIIXSEQ:
                        SIIXMAX,SIIXREQ,SIIXQOH,SIIXUR1,SIIXUR2,SIIXUD1:
                        SIIXUD2,SIIXUC1,SIIXUC2,SIIXUY1,SIIXUY2,SIIXWAR:
                        SIIXRESI,SIIXSPA                                        
          GOTO      OVERCOND IF OVER
          RETURN
.
TPSIIX12  MOVE      ZERO,OVRCD
          READKP    SIIX1FL2;SCTMROW,SCTMCOL,KEY3:
                        SIIXPOR,SIIXUNI,SIIXCST,SIIXCAT,SIIXSEQ:
                        SIIXMAX,SIIXREQ,SIIXQOH,SIIXUR1,SIIXUR2,SIIXUD1:
                        SIIXUD2,SIIXUC1,SIIXUC2,SIIXUY1,SIIXUY2,SIIXWAR:
                        SIIXRESI,SIIXSPA                                        
          GOTO      OVERCOND IF OVER
          RETURN
.
TRSIIX11  RESET     KEY5
          MOVE      ZERO,OVRCD
          READ      SIIX1FL1,KEY5;SCTMROW,SCTMCOL,KEY3:
                        SIIXPOR,SIIXUNI,SIIXCST,SIIXCAT,SIIXSEQ:
                        SIIXMAX,SIIXREQ,SIIXQOH,SIIXUR1,SIIXUR2,SIIXUD1:
                        SIIXUD2,SIIXUC1,SIIXUC2,SIIXUY1,SIIXUY2,SIIXWAR:
                        SIIXRESI,SIIXSPA                                        
          GOTO      OVERCOND IF OVER
          RETURN
.
TRSIIX12  RESET     KEY3   
          MOVE      ZERO,OVRCD
          READ      SIIX1FL2,KEY3;SCTMROW,SCTMCOL,KEY3:
                        SIIXPOR,SIIXUNI,SIIXCST,SIIXCAT,SIIXSEQ:
                        SIIXMAX,SIIXREQ,SIIXQOH,SIIXUR1,SIIXUR2,SIIXUD1:
                        SIIXUD2,SIIXUC1,SIIXUC2,SIIXUY1,SIIXUY2,SIIXWAR:
                        SIIXRESI,SIIXSPA                                        
          GOTO      OVERCOND IF OVER
          RETURN
.
TUSIIX11  UPDATE    SIIX1FL1;SCTMROW,SCTMCOL,KEY3:
                        SIIXPOR,SIIXUNI,SIIXCST,SIIXCAT,SIIXSEQ:
                        SIIXMAX,SIIXREQ,SIIXQOH,SIIXUR1,SIIXUR2,SIIXUD1:
                        SIIXUD2,SIIXUC1,SIIXUC2,SIIXUY1,SIIXUY2,SIIXWAR:
                        SIIXRESI,SIIXSPA                                        
          RETURN
.
TUSIIX12
          UPDATE    SIIX1FL2;SCTMROW,SCTMCOL,KEY3:
                        SIIXPOR,SIIXUNI,SIIXCST,SIIXCAT,SIIXSEQ:
                        SIIXMAX,SIIXREQ,SIIXQOH,SIIXUR1,SIIXUR2,SIIXUD1:
                        SIIXUD2,SIIXUC1,SIIXUC2,SIIXUY1,SIIXUY2,SIIXWAR:
                        SIIXRESI,SIIXSPA                                        
          RETURN
.
TWSIIX12  RESET     KEY3   
          WRITE     SIIX1FL2,KEY3;SCTMROW,SCTMCOL,KEY3:
                        SIIXPOR,SIIXUNI,SIIXCST,SIIXCAT,SIIXSEQ:
                        SIIXMAX,SIIXREQ,SIIXQOH,SIIXUR1,SIIXUR2,SIIXUD1:
                        SIIXUD2,SIIXUC1,SIIXUC2,SIIXUY1,SIIXUY2,SIIXWAR:
                        SIIXRESI,SIIXSPA                                        
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Screen                        
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
          MOVE      "SIIX1",NAMSSFFI
          MOVE      "    1",ITMSSFFI
          CALL      FP00L000
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Screen                        
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L101,PS00L999,PS00L999,PS00L102:
                            PS00L999,PS00L103,PS00L104,PS00L999:
                            PS00L999,PS00L105,PS00L106,PS00L107:
                            PS00L108,PS00L109,PS00L110,PS00L111:
                            PS00L112,PS00L113,PS00L114,PS00L115:
                            PS00L116,PS00L117,PS00L118,PS00L119:
                            PS00L120,PS00L999,PS00L121,PS00L122:
                            PS00L123,PS00L124,PS00L125,PS00L126:
                            PS00L999,PS00L127,PS00L128,PS00L129:
                            PS00L999,PS00L999,PS00L999,PS00L999:
                           PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L130,PS00L999
          GOTO     PS00L999
.
PS00L101
          MOVE      SICADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      SIIAAVC,VAR      
          CALL      DISPITEM
          CALL      SETACCEP
          GOTO     PS00L999
.
PS00L103
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      SIIESOH,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      SICATELE,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      SICACONT,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      SICAGL,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      SICAIMPD,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      SICADAD1,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      SICADAD2,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          MOVE      SICADAD3,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L112
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SICALOC,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L113
          MOVE      SICAMES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L114
          MOVE      SICAUR1,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L115
          MOVE      SICAUR2,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L116
          UNPACK    SICAUD1,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L117
          UNPACK    SICAUD2,CCENT,CYEAR,CMON,CDAY           
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L118
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SICAUY1,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L119
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      SICAUY2,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L120
          MOVE      SIIASUB,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L121
          MOVE      SIIANAT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L122
          MOVE      SIIAUR1,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L123
          MOVE      SIIAUR2,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L124
          MOVE      SIIMMAX,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L125
          UNPACK    RETUDATE,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L126
          MOVE      RETUPERD,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L127
          MOVE      SIPEPER,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L128
          MOVE      SIPEYEAR,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L129
          MOVE      COUNTER3,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L130
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Screen                        
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L101,SF00L102,SF00L103,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L104,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                           SF00L006,SF00L006,SF00L006,SF00L105:
                            SF00L106,SF00L107,SF00L108,SF00L109:
                            SF00L110,SF00L006,SF00L006,SF00L111
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L101,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L104,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          MOVE      "SIIX1",NAMSSFFI
          MOVE      "    1",ITMSSFFI
          CALL      FP00L000
          GOTO     SF00L001
.
SF00L101
          CALL      SELECTED
          BRANCH    EXIT,SF00L001
          MOVE      "SIIX1",NAMSSFFI
          MOVE      SCPSITM,ITMSSFFI
          IF        ACCEPT=0
            PACK      KEY5,SCPSROW,SCPSCOL
            CALL      TRSIIX11
            BRANCH    OVRCD,SF00L001
            MATCH     SCTMROW,SCSLROW
            GOTO      SF00L001 IF NOT EQUAL
            MATCH     SCTMCOL,SCSLCOL
            GOTO      SF00L001 IF NOT EQUAL
            CALL      SM00L000 * Change Line
          ELSE
            IF        SIIX1AFL=0
              MOVE      "SIIX1",NAMSSFFI
              MOVE     "    1",ITMSSFFI
              CALL      AD00L000 * Add Line
            ENDIF
          ENDIF
          GOTO     SF00L001
.
SF00L102
          CALL      CLRTMP00
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      PALL0000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
.
.
          MOVE      "   36",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,RETUPERD
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   38",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIPEPER 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   39",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIPEYEAR
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "2",CKEYTYP
          CALL      RETDAT00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
            BRANCH    EXIT,SF00L104,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          UNPACK    RETUDATE,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
.
.
          MOVE      "   36",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      RETUPERD,VAR     
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   38",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIPEPER,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "   39",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIPEYEAR,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L105
          MOVE      "SIIX1",NAMSSFFI
          MOVE      "    1",ITMSSFFI
          CALL      NP00L000
          GOTO     SF00L001
.
SF00L106
          MOVE      "SIIX1",NAMSSFFI
          MOVE      "    1",ITMSSFFI
          CALL      PP00L000
          GOTO     SF00L001
.
SF00L107
          MOVE      "SIIX1",NAMSSFFI
          MOVE      "    1",ITMSSFFI
          CALL      AD00L000
          GOTO     SF00L001
.
SF00L108
          MOVE      "SIIX1",NAMSSFFI
          MOVE      "    1",ITMSSFFI
          CALL      DL00L000
          GOTO     SF00L001
.
SF00L109
          MOVE      "SIIX1",NAMSSFFI
          MOVE      "    1",ITMSSFFI
          CALL      FP00L000
          GOTO     SF00L001
.
SF00L110
          MOVE      "SIIX1",NAMSSFFI
          MOVE      "    1",ITMSSFFI
          CALL      LP00L000
          GOTO     SF00L001
.
SF00L111
          CALL      DITEM000
          GOTO      SF00L001
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Menu                               
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Menu                               
.-------------------------------------------------------
CF01L000
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Menu                               
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Menu                               
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Menu                               
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Menu                               
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Menu                               
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L999:
                            PS01L999
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Menu                               
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L103:
                            SF01L104
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L020:
                            SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          CALL      SC00L000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L103
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L104
          CALL      SC03L000
          MOVE      ONE,EXIT
          GOTO      SF01L999
SF01L990  MOVE      ONE,EXIT * Exit Char Restart
SF01L999  RETURN
.--------------------------------
. Screen - Import Barcode Download            
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
          CALL      DEFWAR00
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Import Barcode Download            
.-------------------------------------------------------
CF02L000
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Import Barcode Download            
.--------------------------------------------------------
KY02L000
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Import Barcode Download            
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Import Barcode Download            
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Import Barcode Download            
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Import Barcode Download            
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L999,PS02L999,PS02L999,PS02L101:
                            PS02L102,PS02L103,PS02L104,PS02L105
          GOTO     PS02L999
.
PS02L101
          MOVE      SIIXWAR,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          UNPACK    RETUDATE,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      SIPEPER,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L105
          MOVE      SIPEYEAR,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Import Barcode Download            
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L101,SF02L102,SF02L103:
                            SF02L006,SF02L104,SF02L006,SF02L006
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L103:
                            SF02L020,SF02L104,SF02L020,SF02L020
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L102
          CALL      IMPA0000
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIWADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      WAREH000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L103
            ENDIF
            BRANCH    EXIT,SF02L103,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      SIIXWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIWADES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIPEPER 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIPEYEAR
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "2",CKEYTYP
          CALL      RETDAT00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L104
            ENDIF
            BRANCH    EXIT,SF02L104,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          UNPACK    RETUDATE,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIPEPER,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIPEYEAR,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
SF02L990  MOVE      FOUR,EXIT * Exit Char Exit
SF02L999  RETURN
.--------------------------------
. Screen - Import Omnicell File               
.--------------------------------
SC03L000
SC03L100
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC03L200
          CALL      CF03L000 * Clear Fields
          CALL      DEFWAR00
SC03L300
          CALL      KY03L000 * Enter Key Fields
          BRANCH    EXIT,SC03L999,SC03L999
SC03L400
          CALL      WP03L000 * Load any WP Details
SC03L500
          CALL      LM03L000 * Load any Batch Details
SC03L600
          CALL      DF03L000 * Display Fields
SC03L700
          CALL      SF03L000 * Select Fields
          BRANCH    EXIT,SC03L100,SC03L100,SC03L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC03L800
SC03L900
SC03L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Import Omnicell File               
.-------------------------------------------------------
CF03L000
CF03L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Import Omnicell File               
.--------------------------------------------------------
KY03L000
          MOVE      ZERO,EXIT
          GOTO      KY03L999
.
KY03L900  MOVE      ONE,EXIT
KY03L999  RETURN
.---------------------------------------------------------
. Load WP files for : Import Omnicell File               
.---------------------------------------------------------
WP03L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Import Omnicell File               
.---------------------------------------------------------
LM03L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Import Omnicell File               
.---------------------------------------------------------
DF03L000
          BRANCH   ACCEPT,DF03L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF03L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF03L900
          MATCH    PRGID,SCPSPID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF03L010 IF NOT EQUAL
.
          CALL     PS03L000 * Display Field
          GOTO     DF03L010
DF03L900
DF03L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Import Omnicell File               
.---------------------------------------------------------
PS03L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS03L999,PS03L999,PS03L999,PS03L101:
                            PS03L102,PS03L103,PS03L104,PS03L105
          GOTO     PS03L999
.
PS03L101
          MOVE      SIIXWAR,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L102
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L103
          UNPACK    RETUDATE,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L104
          MOVE      SIPEPER,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L105
          MOVE      SIPEYEAR,VAR     
          CALL      DISPITEM
          GOTO     PS03L999
PS03L999
          RETURN
.---------------------------------------------------------
. Selections for : Import Omnicell File               
.---------------------------------------------------------
SF03L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF03L001  BRANCH   ACCEPT,SF03L020
.
SF03L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L006,SF03L101,SF03L102,SF03L103:
                            SF03L006,SF03L104,SF03L006,SF03L006
SF03L006  BEEP
          GOTO     SF03L005
SF03L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF03L090
          MATCH    PRGID,SCSLPID
          GOTO     SF03L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF03L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L020,SF03L020,SF03L020,SF03L103:
                            SF03L020,SF03L104,SF03L020,SF03L020
          GOTO     SF03L020
SF03L090  MOVE     ZERO,ACCEPT
          GOTO     SF03L001
.
SF03L101
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L102
          CALL      IMPB0000
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIWADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      WAREH000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L103
            ENDIF
            BRANCH    EXIT,SF03L103,SF03L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF03L990 IF EQUAL
          ENDIF
          MOVE      SIIXWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIWADES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF03L001
.
SF03L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIPEPER 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIPEYEAR
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "2",CKEYTYP
          CALL      RETDAT00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L104
            ENDIF
            BRANCH    EXIT,SF03L104,SF03L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF03L990 IF EQUAL
          ENDIF
          UNPACK    RETUDATE,CCENT,CYEAR,CMON,CDAY          
          CALL      PACDATE
          MOVE      CPCDATE,VAR
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIPEPER,VAR      
            CALL      DISPITEM
          ENDIF
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIPEYEAR,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF03L001
SF03L990  MOVE      FOUR,EXIT * Exit Char Exit
SF03L999  RETURN
.@@@@@ Function Restart Point @@@@@
.********************************************************************
. RPAR - Read paramters                             Called by ML
.********************************************************************
RPAR0000  READ      CONTROLF,SIXTY3;*132,INCOSIN7,*133,INCOSI40:
                                    *150,SNCOPRS,SNCOPPR,SNCOIMS,*231,SNCOIMPQ:
                                    *232,SNCOAUBM
          PACK      INCOSI40,INCOSI40,SP70
          REP       " 0",INCOSI40
.          MATCH     "1",INCOSI40
.          IF        @EQUAL
.            BEEP
.            CLEAR     DISPMSG
.            APPEND    "You may not use this program - ",DISPMSG
.            RESET     DISPMSG
.            CALL      MESSAGE1
.            GOTO      FATALERR
.          ENDIF
          MOVE      ONE,ACCEPT
          MOVE      SP70,DEFLTWH
.
          RETURN
.----------------------------------------------------------------
. Set up Screen Defaults
.----------------------------------------------------------------
SETDEF00  MOVE      PORT,SIIXPOR
          MOVE      CCC,CCENT
          MOVE      CYY,CYEAR
          MOVE      CMM,CMON
          MOVE      CDD,CDAY
          CALL      ONAT0000
.
          CALL      CSIWS000           * check warehouse security
.
SETDEF99  RETURN
.------------------------------------------------------------------------
. Open Nato X-Ref File if required
.------------------------------------------------------------------------
ONAT0000  OPEN      CONTROLF,"controlf"
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*141,INCNNATO
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ZERO,INCNNATO
            WRITAB    CONTROLF,SIXTY3;*141,INCNNATO
          ENDIF
.
          IF        INCNNATO=1
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      SINNATA1,"sinnataf"
            TRAPCLR   IO
            IF        OVRCD=1
              DISPLAY   *P1:24,*EL,*B,"Nato file does not exist. Run fixit.  ";
              CALL      HITENTER
              CHAIN     PGM
            ENDIF
.
            OPEN      SINNATA2,"sinnataf"
          ENDIF
.
ONAT9999  RETURN
.----------------------------------------------------------------------
. Check warehouse security
. Returns SECSIWS : 0 = no access to any warehouse
.                   1 = access to one warehouse
.                   2 = access to more than one warehouse
.                   3 = access to all warehouse(Not Applicable - for future use)
.----------------------------------------------------------------------
..                                            * (for future use)
..CSIWS000  MOVE      "3",SECSIWS             * default to all warehouse's
.
..          PACK      KEY9,SP70               * any security set up ???
..          CALL      RSSIWS1
..          CALL      RKSIWS1
..          BRANCH    OVRCD,CSIWS999
.
CSIWS000  MOVE      "0",SECSIWS             * check for no warehouse's
          PACK      KEY9,PASSCODE,SP70
          CALL      RSSIWS1
          CALL      RKSIWS1
          BRANCH    OVRCD,CSIWS999
.
          MATCH     SIWSUID,PASSCODE
          GOTO      CSIWS999 IF NOT EQUAL
.
          MOVE      "1",SECSIWS             * check for one warehouse's
          CALL      RKSIWS1
          BRANCH    OVRCD,CSIWS999
.
          MATCH     SIWSUID,PASSCODE
          GOTO      CSIWS999 IF NOT EQUAL
.
          MOVE      "2",SECSIWS             * more than one warehouse
.
CSIWS999  RETURN
.
.----------------------------------------------------------------------
. Clear Temp File
.----------------------------------------------------------------------
CLRTMP00  PACK      KEY12,SP70
          CALL      RSTMCW1
          CALL      RKTMCW1
          BRANCH    OVRCD,CLRTMP99
.
          PACK      KEY12,TMCWCAT,TMCWWAR
          CALL      DETMCW1
          GOTO      CLRTMP00
.
CLRTMP99  RETURN
.----------------------------------------------------------------
. Get Catalog Description
.----------------------------------------------------------------
GETDSC00  PACK      KEY7,SIIXCAT,SP70
          CALL      RDSIIA1
.
GETDSC99  RETURN
.********************************************************************
. Set accept mode
.********************************************************************
SETACCEP  MOVE      ONE,ACCEPT
          RETURN
.----------------------------------------------------------------
. Post All Imprest Data
.----------------------------------------------------------------
PALL0000  MOVE      FALSE,EXIT
          PACK      KEY3,SP70
          CALL      TSSIIX12
          CALL      TKSIIX12
          IF         OVRCD=1
            MOVE       "No Entries to Post  -  ",DISPMSG
            BEEP
            CALL       MESSAGE1
            GOTO       PALL9999
          ENDIF
.
          DISPLAY    *P1:24,*EL,"Posting Imprest - Current Catalogue : "
          PACK       KEY3,SP70
          CALL       TSSIIX12
PALL1000  CALL       TKSIIX12
          BRANCH     OVRCD,PALL9999
          DISPLAY    *P39:24,*V2LON,SIIXCAT
.
. ------- Read Catalog Details
          PACK      KEY7,SIIXCAT,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,PALL1000
.
          BRANCH    SIIANON,PALL1100
.
. ------- Read Catalogue WareHouse Details
          PACK      KEY12,SIIXCAT,SIIXWAR,SP70
          CALL      RDSIIE1
          BRANCH    OVRCD,PALL1000
.
. ------- Read Warehouse Details
          PACK      KEY5,SIIXWAR,SP70
          CALL      RDSIWA1
.
. ------- Read Imprest Details
PALL1100  PACK      KEY12,SIIXCST,SIIXCAT
          CALL      RDSIIM1
          BRANCH    OVRCD,PALL1000
.
          CALL      POST0000                 * Post Imprest Record
          GOTO      PALL1000
.
PALL9999  CALL      UUSIRA1
          RETURN
.----------------------------------------------------------------------
. Post Data
.----------------------------------------------------------------------
POST0000  COMPARE   SIIXREQ,ZERO            * something requested ?
          GOTO      POST9999 IF NOT LESS
.
          BRANCH    SIIANON,POST1000
.
          PACK      DEFTCST,DEFTCST,SP70    * time for a new requisition ?
          MATCH     DEFTCST,COSTCENT
          IF        !@EQUAL
            CALL       UUSIRA1              * unlock last requisition
.
            PACK      DEFTCST,COSTCENT,SP70
            MOVE      "I",SIRATYP
            REPEAT
              READ      CONTROLF,TWENTY3;*201,HIMPREST
              ADD       ONE,HIMPREST
              WRITAB    CONTROLF,TWENTY3;*201,HIMPREST
              SUB       ONE,HIMPREST
              PACK      KEY8,SIRATYP,HIMPREST,SP70
              CALL      RASIRA1
            UNTIL     OVRCD=1
.
            UNPACK    KEY8,SIRATYP,SIRAREQ
            MOVE      ZERO,SIRAIND
            MOVE      COSTCENT,SIRACST
            PACK      SIRADAT,CCC,CYY,CMM,CDD,SP70
            REP       " 0",SIRADAT
            MOVE      SP70,SIRADEL
            MOVE      ZERO,SIRATOT
            CALL      WRSIRA1
            CALL      RLSIRA1  * Lock Requisition
          ENDIF
.
          CALL       UPIMP000  * Update Imprest Picking Sheet File
          CALL       UPSOH000  * Update Stock on Hand & Backorders if Required
          CALL       UPPIC000  * Update Picking Sheet Details
          CALL       UPREB000  * Update Requisition Details
          CALL       UPITM000  * Update Item History
.
          PACK       KEY5,SIRACST
          CALL       RDSICA1   * Read Cost Centre
          ASSIGN     TOTALVAL*SIIAAVC,SIUSCST
          MOVE       TOTALVAL,SIUSQTY
          CALL       SINUSAGE  * Update Usage
.
          ADD        SIUSCST,SIRATOT
          CALL       UPSIRA1   * Update Requisition Total
          GOTO       POST9999
.
POST1000  CALL       UPIMP000  * Update Imprest Picking Sheet File
          CALL       UPPOG000  * Update impres nonstock purchase generation
.
POST9999  RETURN
.----------------------------------------------------------------
. Move Variables From Temporary Imprest File to Imprest File
.----------------------------------------------------------------
UPIMP000  PACK      KEY12,SIIXCST,SIIXCAT
          CALL      RDSIIM1
          MOVE      SIIXREQ,SIIMREQ
          MOVE      SIIXQOH,SIIMQOH
          MOVE      SIIXWAR,SIIMWAR
          IF        OVRCD=0
            CALL      UPSIIM1
          ENDIF
.
UPIMP999  RETURN
.--------------------------------------------
. Update Stock on hand and Backorder File
.--------------------------------------------
UPSOH000  IF        SIIESOH<SIIMREQ
            MOVE      SIIESOH,TOTALVAL    * Insufficent Stock on Hand
            MOVE      ZERO,SIIESOH        * Use up all available stock
          ELSE
            MOVE      SIIMREQ,TOTALVAL    * Sufficent SOH
            SUB       TOTALVAL,SIIESOH    * Reduce Stock on Hand
          ENDIF
          CALL      UPSIIE1               * Update Stock on Hand
.
          MOVE      ZERO,SIBAQTY          * Set Back Ordered to Zero
          IF        TOTALVAL<SIIMREQ
            CALL      UPBAC000            * Issued < Required so Back Order
          ENDIF
UPSOH999  RETURN                          * TOTALVAL = Quantity Issued
.-----------------------------------
. Update Backorder File
.-----------------------------------
UPBAC000  READ      CONTROLF,TWENTY3;*120,HBACK
          COMPARE   ONE,HBACK                * Using Back Ordering System 1=Yes
          GOTO      UPBAC999 IF NOT EQUAL    * No
          READ      CONTROLF,SIXTY3;*147,HDISPBO
          MOVE      "19",HTOP
          MOVE      "1",HLEF
          MOVE      "80",HRIG
          MOVE      "24",HBOT
          CALL      GETSCR00                 * Save Screen
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HRIG
          MOVE      ZERO,HBOT
.
          CALL      CBACK000                 * Calculate Total on Back Order
          CALL      MBACK000                 * Allow Back Order to be Modified
.
          CALL      PUTSCR00                 * Restore Screen
          MOVE      ZERO,SIBAQTY             * Set Back Ordered to Zero
          COMPARE   ZERO,BACKQTY             * Zero to Backorder
          GOTO      UPBAC999 IF EQUAL        * Yes so Exit
.
          MOVE      SIRACST,SIBACST          * Cost Centre
          PACK      SIBAREQ,SIRATYP,SIRAREQ  * Requisition
          MOVE      SIIMCAT,SIBACAT          * Catalog
          MOVE      SIIMWAR,SIBAWAR          * Warehouse
.
          PACK      KEY25,SIBACST,SIBACAT,SIBAREQ,SIBAWAR
          CALL      RDSIBA1                  * Check for Existing Record
          IF        OVRCD=0
            MOVE      TWO,AUDTTYPE           * Update if on file
            CALL      WASIBA00               * Before Audit Change
            ASSIGN    SIBAQTY+BACKQTY,SIBAQTY
            IF        IMPFLFLG=1
              MOVE      SIIXRESI,SIBARESI    * Restock ID
            ELSE
              PACK      SIBARESI,SP70
            ENDIF
            CALL      UPSIBA1                * Update New Back Order Amount
            MOVE      THREE,AUDTTYPE
            CALL      WASIBA00               * After Audit Change
          ELSE
            MOVE      BACKQTY,SIBAQTY        * Not on file Write New Record
            MOVE      SIRADAT,SIBADAT
            IF        IMPFLFLG=1
              MOVE      SIIXRESI,SIBARESI    * Restock ID
            ELSE
              PACK      SIBARESI,SP70
            ENDIF
            CALL      WRSIBA1                * Write New Back Order Amount
            MOVE      ONE,AUDTTYPE
            CALL      WASIBA00               * Audit Added
          ENDIF
          MOVE      BACKQTY,SIBAQTY
.
UPBAC999  RETURN
.-----------------------------------
. Update Picking Sheets File
.-----------------------------------
UPPIC000  MOVE      SIIXWAR,SIIPWAR  * Warehouse
          MOVE      SIRACST,SIIPCST  * Cost Centre
          MOVE      SIRADEL,SIIPDEL  * Delivery Details
          MOVE      SIIERAS,SIIPRAC  * Rack&Shelf
          MOVE      SIIMCAT,SIIPCAT  * Catalog
          MOVE      SIIMSEQ,SIIPIMP  * Imprest Sequence Number
          MOVE      SIRATYP,SIIPTYP  * Req Type
          MOVE      SIRAREQ,SIIPREQ  * Req No
UPPIC100
          PACK     KEY83,SIIPWAR,SIIPCST,SIIPDEL,SIIPRAC,SIIPCAT,SIIPTYP,SIIPREQ
          CALL      RDSIIP1
          BRANCH    OVRCD,UPPIC500
          MATCH     SP70,SIIPPFL
          GOTO      UPPIC400 IF EQUAL
.
. Can't update a picking sheet record if it has already been printed.
.
          MATCH     SP70,SIIPDEL
          IF        @EQUAL
            MOVE      "Part 2",SIIPDEL
            GOTO      UPPIC100
          ENDIF
          ENDSET    SIIPDEL
          APPEND    " - 2",SIIPDEL
          RESET     SIIPDEL
          GOTO      UPPIC100 * If all that doesn't work there is a problem.
.
UPPIC400  ADD       TOTALVAL,SIIPAQT  * Quantity to Issue
          ADD       SIIMREQ,SIIPRQT   * Quantity Requisted
          MOVE      SIBAQTY,SIIPBQT
          MOVE      SP70,SIIPPFL      * Print Flag
          IF        IMPFLFLG=1
            MOVE      SIIXRESI,SIIPRESI  * Restock ID
          ELSE
            PACK      SIIPRESI,SP70
          ENDIF
          MOVE      SP70,SIIPSPA
          CALL      UPSIIP1
          GOTO      UPPIC999
.
UPPIC500  MOVE      TOTALVAL,SIIPAQT  * Quantity to Issue
          MOVE      SIIMREQ,SIIPRQT   * Quantity Requisted
          MOVE      SIBAQTY,SIIPBQT
          MOVE      SP70,SIIPPFL      * Print Flag
          IF        IMPFLFLG=1
            MOVE      SIIXRESI,SIIPRESI  * Restock ID
          ELSE
            PACK      SIIPRESI,SP70
          ENDIF
          MOVE      SP70,SIIPSPA
          CALL      WRSIIP1
.
UPPIC999  RETURN
.-----------------------------------
. Update Requisition Details File
.-----------------------------------
UPREB000  MOVE      SIRATYP,SIRBTYP
          MOVE      SIRAREQ,SIRBREQ
          MOVE      SIIMWAR,SIRBWAR
          MOVE      SIIMCAT,SIRBCAT
          PACK      KEY20,SIRBTYP,SIRBREQ,SIRBWAR,SIRBCAT
          CALL      RDSIRB1
          IF        OVRCD=0
            ADD       SIIMREQ,SIRBRQT
            ADD       TOTALVAL,SIRBIQT
            ASSIGN    SIIAAVC*SIRBIQT,SIRBAMT
            CALL      UPSIRB1
          ELSE
            MOVE      SIIMREQ,SIRBRQT
            MOVE      TOTALVAL,SIRBIQT
            ASSIGN    SIIAAVC*SIRBIQT,SIRBAMT
            MOVE      SIRADAT,SIRBDAT
            CALL      WRSIRB1
          ENDIF
          RETURN
.-----------------------------------
. Update Item History
.-----------------------------------
UPITM000  PACK      SIITPER,SIPEYEAR,SIPEPER,SP70  * Set from Header Details
.
          MOVE      SIIMWAR,SIITWAR                * Warehouse
          MOVE      SIIMCAT,SIITCAT                * Catalog
          ASSIGN    TOTALVAL*SEQ,SIITQTY            * Quantity
          ASSIGN    SEQ*TOTALVAL*SIIAAVC,SIITAMT
          MOVE      SIRACST,SIITCST                * Cost Centre
          PACK      SIITREQ,SIRATYP,SIRAREQ
          MOVE      "7",SIITTYP                    * Imprest
          MOVE      SP70,SIITPUR
          MOVE      SIIESOH,SIITSOH            * Stock on Hand
          MOVE      SP70,SIITSPA
          MOVE      SP70,SIITREF
.
          MOVE      PRGID,SIITPRG
          MOVE      PORT,SIITPOR
          MOVE      PASSCODE,SIITOPR
          PACK      SIITDAT,CCC,CYY,CMM,CDD
          REP       " 0",SIITDAT
          REPEAT
            CLOCK     TIME,SIITTIM
            PACK      KEY28,SIITWAR,SIITCAT,SIITDAT,SIITTIM,SP70
            CALL      RASIIT1
          UNTIL     OVRCD=1
          CALL      WRSIIT1
          RETURN
.-------------------------------------------
. Calculate Back Order Total for Imprest
.-------------------------------------------
CBACK000  MOVE      ZERO,TOTALSOB
          PACK      KEY25,SIRACST,SIIMCAT,ANSI,SP70
          PACK      KEY13,SIRACST,SIIMCAT,ANSI,SP70
          CALL      RSSIBA1
.
CBACK100  CALL      RKSIBA1
          BRANCH    OVRCD,CBACK999
          PACK      KEY25,SIBACST,SIBACAT,SIBAREQ,SP70
          MATCH     KEY13,KEY25
          GOTO      CBACK999 IF NOT EQUAL
          ADD       SIBAQTY,TOTALSOB
          GOTO      CBACK100
CBACK999  RETURN
.------------------------------------------------------------
. Modify Back Order Quantities
.------------------------------------------------------------
MBACK000  IF        HDISPBO=1
            IF        SNCOAUBM<>1
              ASSIGN    SIIMREQ-TOTALVAL,BACKQTY
              ADD       BACKQTY,TOTALSOB
              GOTO      MBACK999
            ELSE
              IF        TOTALSOB>SIIMMAX
                MOVE      ZERO,BACKQTY
                GOTO      MBACK999
              ELSE
                ASSIGN    SIIMREQ-TOTALVAL,BACKQTY
                ASSIGN    TOTALSOB+BACKQTY,F12P2
                IF        SIIMMAX>F12P2
                  GOTO      MBACK999
                ELSE
                  ASSIGN    BACKQTY-(F12P2-SIIMMAX),BACKQTY
                  GOTO      MBACK999
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      SIIADES,KEY40
          DISPLAY   *P1:18,*EF
          HLINE     *G37,18,1,80
          ASSIGN    SIIMREQ-TOTALVAL,BACKQTY
          DISPLAY   *P1:18,*V2LON,*ULON,"Insufficient Stock on Hand",*HOFF:
                    *P1:19,"Catalog Code            : ",*V2LON,SIIMCAT,*HOFF:
                    *P36:19,KEY40:
                    *P1:20,"Currently on Back Order : ",*V2LON,TOTALSOB
          KEYIN     *P1:21,"Quantity to Back Order  : ",*V2LON,*RV,BACKQTY
          ADD       BACKQTY,TOTALSOB
          DISPLAY   *P1:21,*EL,"Quantity to Back Order  : ",*V2LON,BACKQTY:
                    *P1:22,"Total on Back Order     : ",*V2LON,TOTALSOB
.
MBACK100  KEYIN     *P1:24,"Ok to Continue (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",ANS
          REP       UPPLOW,ANS
          MATCH     "Y",ANS
          GOTO      MBACK999 IF EQUAL
          MATCH     "N",ANS
          GOTO      MBACK100 IF NOT EQUAL
          SUB       BACKQTY,TOTALSOB
          GOTO      MBACK000
.
MBACK999  RETURN
.
UPPOG000  MOVE      SIIXCST,SINPCST
.
          CALL      GETSUP00
.
          MOVE      SIICSUP,SINPSUP   *   Supplier
          MOVE      SIIXCAT,SINPCAT
          PACk      KEY15,SIIAISS,SIICSUT
          CALL      RDSIFA1
          IF        OVRCD=0
            ASSIGN    SIIXREQ/SIFACTOR,F12P2
            MOVE      F12P2,F10
            MOVE      F10,SINPQTY
          ELSE
            MOVE      SIIXREQ,SINPQTY
          ENDIF
          MOVE      SIICSUT,SINPSUT   *   Supply Unit
          MOVE      SIIASUB,SINPSUB   *   Product Group (Subjective)
          MOVE      SIICPD1,SINPPD    *   Part Description
          MOVE      SIICPNO,SINPPN    *   Part Number
          MOVE      SISDCON,SINPCON   *   Contract
          MOVE      SISDSDT,SINPCDT   *   Contract Date
.
          MOVE      CCC,CC           *   Calculate Expected Delivery Date
          MOVE      CYY,YY           *   from Todays Date
          MOVE      CMM,MM
          MOVE      CDD,DD           *   Todays Date
          CALL      DMYCON           *   Convert to Jul Date
          ADD       SIICLTM,JULDAY   *   Add Lead Time
          MOVE      JULDAY,JWKDAY
          MOVE      JULYR,JWKYER
          MOVE      JULCC,JWKCC
          CALL      JULCON           *    Convert Date Back
.
          PACK      SINPEDT,CC,YY,MM,DD
          REP       " 0",SINPEDT
          MOVE      SIICLCT,SINPECT  *    Expected Unit Cost
          MOVE      SIIAGST,SINPGST
.
          CALL      CALTAX00
.
          PACK      SINPSPA,SP70
.
          PACK     KEY17,SINPCST,SINPSUP,SINPCAT,SP70
          CALL     RDSINP1
          IF       OVRCD=0
            MOVE      SIICSUT,SINPSUT   *   Supply Unit
            PACk      KEY15,SIIAISS,SIICSUT
            CALL      RDSIFA1
            IF        OVRCD=0
              ASSIGN    SIIXREQ/SIFACTOR,F12P2
              MOVE      F12P2,F10
              ADD       F10,SINPQTY
            ELSE
              ADD       SIIXREQ,SINPQTY
            ENDIF
            CALL     UPSINP1
          ELSE
            CALL     WRSINP1
          ENDIF
          RETURN
.
UPPOG999  RETURN
.
.---------------------------------------------------------------------
. Determine Supplier
.--------------------
.   - Return Catalog/Supplier Record  SIIC
.   - Return Contract & Contract Date SISDSDT & SISDCON
.---------------------------------------------------------------------
GETSUP00  PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          PACK      KEY45,SIIACAT,CURRDATE,Z70
          CALL      RSSISD2                 * Check for Contract Price
          CALL      RPSISD2                 * Lastest Price
          BRANCH    OVRCD,GETSUP10          * No Contract
.
          MATCH     SISDCAT,SIIACAT         * Correct Catalog
          GOTO      GETSUP10 IF NOT EQUAL   * No Contract
.
          MOVE      SISDCON,KEY10
          CALL      RDSISC1
          BRANCH    OVRCD,GETSUP10          * No Contract
.
          MATCH     SISCEDT,CURRDATE        * Check for Completed Contract
          GOTO      GETSUP10 IF NOT LESS    * Contract Out of Date
.
          MOVE      SISDSUP,SINPSUP
          CALL      SUPCHK00                * Check Supplier Code
          BRANCH    EXIT,GETSUP10
.
          PACK      KEY27,SISDCAT,SISDSUP,SISDSUT
          CALL      RDSIIC1
          IF        OVRCD=1
            BEEP
            DISPLAY   *P1:19,*EF
            HLINE     *G37,19,1,80
            DISPLAY   *P1:20,"Supplier/Supply Unit ",*V2LON,SISDSUP,"/",SISDSUT:
                      *HOFF," is Not a Valid Catalog/Supplier Record.":
                      *P1:21,"Catalog   : ",*V2LON,SIIECAT,*HOFF,SP1,SIIADES:
                      *P1:22,"Warehouse : ",*V2LON,SIIEWAR,*HOFF:
                      *P1:24,"Alternative Supplier Used - ";
            CALL      HITENTER
            DISPLAY   *P1:24,*EL
            GOTO      GETSUP10
          ENDIF
          GOTO      GETSUP80
.
GETSUP10  MOVE      SIIAPSC,SINPSUP
          MOVE      SP70,SISDCON
          MOVE      SP70,SISDSDT
          CALL      SUPCHK00
          BRANCH    EXIT,GETSUP20
.
          PACK      KEY12,SIIACAT,SINPSUP,SP70
          PACK      KEY27,SIIACAT,SINPSUP,SP70
          CALL      RSSIIC1
GETSUP12  CALL      RKSIIC1
          BRANCH    OVRCD,GETSUP15
          PACK      KEY27,SIICCAT,SIICSUP,SP70
          MATCH     KEY12,KEY27
          GOTO      GETSUP15 IF NOT EQUAL
          COMPARE   ZERO,SIICAPO
          GOTO      GETSUP12 IF EQUAL
          GOTO      GETSUP80
.
GETSUP15  BEEP
          DISPLAY   *P1:19,*EF
          HLINE     *G37,19,1,80
          DISPLAY   *P1:20,"Supplier Code ",*V2LON,KEY5:
                    *HOFF," Does Not have a Valid Catalog/Supplier Record.":
                    *P1:21,"Catalog   : ",*V2LON,SIIECAT,*HOFF,SP1,SIIADES:
                    *P1:22,"Warehouse : ",*V2LON,SIIEWAR,*HOFF:
                    *P1:24,"Alternative Supplier Used - ";
          CALL      HITENTER
          DISPLAY   *P1:24
.
GETSUP20  PACK      KEY27,SIIACAT,SP70
          CALL      RSSIIC1
.
GETSUP30  CALL      RKSIIC1
          BRANCH    OVRCD,GETSUP90
          MATCH     SIIACAT,SIICCAT
          GOTO      GETSUP90 IF NOT EQUAL
          MATCH     SIIAPSC,SIICSUP      * Ignore Prefered Supplier
          GOTO      GETSUP30 IF EQUAL
          COMPARE   ZERO,SIICAPO
          GOTO      GETSUP30 IF EQUAL
          GOTO      GETSUP80
.
GETSUP80  MOVE      ZERO,EXIT
          GOTO      GETSUP99
.
GETSUP90  MOVE      ONE,EXIT
GETSUP99  RETURN
.------------------------------------------------------------
. Check Supplier Code Exists and is not on hold for Orders
.------------------------------------------------------------
SUPCHK00  MOVE      SINPSUP,KEY5
          MOVE      ZERO,EXIT
          CALL      RDAPMA1
          IF        OVRCD=1
            BEEP
            DISPLAY   *P1:19,*EF
            HLINE     *G37,19,1,80
            DISPLAY   *P1:20,"Supplier Code ",*V2LON,KEY5:
                      *HOFF," No Longer Exists.":
                      *P1:21,"Catalog   : ",*V2LON,SIIECAT,*HOFF,SP1,SIIADES:
                      *P1:22,"Warehouse : ",*V2LON,SIIEWAR,*HOFF:
                      "     Contract : ",*V2LON,SINPCON:
                      *P1:24,"Alternative Supplier Used - ";
            CALL      HITENTER
            DISPLAY   *P1:24,*EL
            MOVE      ONE,EXIT
          ENDIF
.
          IF        APMAHOR=1
            BEEP
            DISPLAY   *P1:19,*EF
            HLINE     *G37,19,1,80
            DISPLAY   *P1:20,"Supplier Code ",*V2LON,KEY5:
                      *HOFF," is On Hold for Order Processing.":
                      *P1:21,"Catalog   : ",*V2LON,SIIECAT,*HOFF,SP1,SIIADES:
                      *P1:22,"Warehouse : ",*V2LON,SIIEWAR,*HOFF:
                      "     Contract : ",*V2LON,SINPCON:
                      *P1:24,"Alternative Supplier Used - ";
            CALL      HITENTER
            DISPLAY   *P1:24,*EL
            MOVE      ONE,EXIT
          ENDIF
          RETURN
.
CALTAX00  COMPARE   ZERO,SINPECT
          GOTO      CALTAX90 IF EQUAL
.
          MATCH     SP6,SINPGST
          GOTO      CALTAX90 IF EQUAL
.
          PACK      KEY8,CCC,CYY,CMM,CDD,SP70
          REP       " 0",KEY8
.
          PACK      KEY14,SINPGST,KEY8,SP70
          CALL      RDIBGE1
          COMPARE   ZERO,OVRCD
          GOTO      CALTAX10 IF EQUAL
.
          CALL      RPIBGE1
          BRANCH    OVRCD,CALTAX90
.
          MATCH     SINPGST,IBGECODE
          GOTO      CALTAX90 IF NOT EQUAL
.
CALTAX10  ASSIGN    (SINPECT-(SINPECT/(ONE+(IBGEAMNT/HUNDRED)))),SINPGSTA
          GOTO      CALTAX99
.
CALTAX90  MOVE      ZERO,SINPGSTA
.
CALTAX99  RETURN
.
.----------------------------------------------------------------------
. Keyin SICA
.----------------------------------------------------------------------
KSICA000  CALL      UUSIIM1                      * unlock last item
          CALL      UUSIIE1
          CALL      DETMP000
          CALL      CRTMP000
.
          MOVE     ZERO,CKEYTYP
          CALL     KSICAA00
          BRANCH   EXIT,KSICA900,KSICA900
          IF       SICALOC=1
            BEEP
            MOVE     "Cost Centre Not Available for Requisitions - ",DISPMSG
            CALL     MESSAGE1
            GOTO     KSICA000
          ENDIF
.
          MATCH    SP70,SICAMES
          IF       !(@EQUAL)
            BEEP
            MOVE     SICAMES,DISPMSG
            CALL     MESSAGE1
          ENDIF
          MOVE     SICACODE,COSTCENT
          MOVE     SICACODE,SIIXCST
          MOVE     ONE,OVRCD
          MOVE     ONE,ACCEPT
          MOVE     ONE,COUNTER3
          GOTO     KSICA999
.
KSICA900  CALL     DETMP000
.
KSICA999  RETURN
.
.----------------------------------------------------------------
. Delete Temp File
.----------------------------------------------------------------
DETMP000  CLOSE     TMCATWAR
          PACK      TMPCATWH,TMPCWNAM,PORT
          REP       " 0",TMPCATWH
          PACK      KEY70,SP70
          CLEAR     KEY70
          APPEND    "iserase ",KEY70
          APPEND    TMPCATWH,KEY70
          RESET     KEY70
          EXECUTE   KEY70,TASKID
DETMP999  RETURN
.----------------------------------------------------------------
. Create Temp File
.----------------------------------------------------------------
CRTMP000  PACK      TMPCATWH,TMPCWNAM,PORT
          REP       " 0",TMPCATWH
          PACK      KEY70,SP70
          CLEAR     KEY70
          APPEND    "isbuild ",KEY70
          APPEND    TMPCATWH,KEY70
          APPEND    " 13 UC1-7,8-12",KEY70
          RESET     KEY70
          EXECUTE   KEY70,TASKID
          OPEN      TMCATWAR,TMPCATWH
CRTMP999  RETURN
.
.----------------------------------------------------------------
. Keyin Line Details
.----------------------------------------------------------------
KLINE000  MOVE      FALSE,EXIT
          COMPARE   ZERO,ACCEPT
          GOTO      KLINE500 IF EQUAL
          MOVE      COUNTER3,SIIXUNI
.
KLINE100  CALL      KCATA000
          BRANCH    EXIT,KLINE950,KLINE999
.
KLINE200  CALL      KWARH000
          IF        EXIT=1
            CALL      CLRLIN00
            GOTO      KLINE000
          ENDIF
          IF        EXIT=2
            GOTO      KLINE999
          ENDIF
.
          CALL      SWARN000         * Stock Level Warning
.
. ------- Check if already in batch screen
          PACK      KEY12,SIIACAT,SIWAWAR,SP70
          CALL      RDTMCW1
          IF        OVRCD<>1
            MOVE      "Catalog already exists. Modify exisiting one - ",DISPMSG
            CALL      MESSAGE1
            CALL      CLRLIN00
            GOTO      KLINE000
          ELSE
            UNPACK    KEY12,TMCWCAT,TMCWWAR
            CALL      WRTMCW1
          ENDIF
.
          CALL      KQOHA000
          MOVE      "    6",FLDID
          CALL      GETMLPOS
          MOVE      ZERO,EXIT
          ADD       ONE,COUNTER3
          GOTO      KLINE999
.
. ------- Read WareHouse Details
KLINE500  PACK      KEY5,SIIXWAR,SP70
          CALL      RDSIWA1
          BRANCH    OVRCD,KLINE999
.
. ------- Read Catalogue Details
          PACK      KEY7,SIIXCAT,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,KLINE999
.
. ------- Read Catalogue WareHouse Details
          PACK      KEY12,SIIXCAT,SIIXWAR,SP70
          CALL      RDSIIE1
          IF        OVRCD=1
            BRANCH    SIIANON,KLINE550
            GOTO      KLINE999
          ENDIF
.
KLINE550  CALL      DCATA000                 * Display Current Line
.
KLINE600  CALL      KWARH000
          BRANCH    EXIT,KLINE500,KLINE500
.
          CALL      KQOHA000
          MOVE      "    6",FLDID
          CALL      GETMLPOS
          MOVE      ZERO,EXIT
          GOTO      KLINE999
.
KLINE900  MOVE      ONE,EXIT
          GOTO      KLINE999
.
KLINE950  MOVE      TWO,EXIT
.
KLINE999  RETURN
.------------------------------------------------------------
. Stock Level Warning
.------------------------------------------------------------
SWARN000  COMPARE   ONE,SNCOIMS
          GOTO      SWARN999 IF NOT EQUAL
.
          IF        SIIESOH<SIIEROL
            BEEP
            CLEAR     DISPMSG
            APPEND    "WARNING: LOW STOCK ON HAND (ROL=",DISPMSG
            APPEND    SIIEROL,DISPMSG
            APPEND    ") - ",DISPMSG
            RESET     DISPMSG
            CALL      MESSAGE1
          ENDIF
.
SWARN999  RETURN
.----------------------------------------------------------------
. Keyin Catalog Code
.----------------------------------------------------------------
KCATA000  MOVE      "    6",FLDID
          CALL      GETMLPOS
.
          PACK      SIIMCST,COSTCENT,SP70
          CALL      KSIIMA00                     * keyin SIIA
          PACK      SIIXCAT,SIIMCAT,SP70
          LOAD      SIIXCAT,EXIT,SP70,SP70
          BRANCH    EXIT,KCATA999,KCATA999
.
          CALL      SETIMX00                     * Setup Temporary Data
.
          PACK      KEY7,SIIMCAT,SP70
          CALL      RDSIIA1                      * read catalog data
          BRANCH    OVRCD,KCATA000
.
          MATCH     "1",INCOSIN7
          IF        !@EQUAL
            IF        SIIANON=1
              BEEP                                 * srf 121952  quote 7648
              MOVE      "Catalog Must be a Stocked Item - ",DISPMSG
              CALL      MESSAGE1
              GOTO      KCATA000
            ENDIF
          ENDIF
.
          IF        SIIANON=1
            PROC     CHKORD00      * Check for Back Orders or Outstanding PO
          ENDIF
.
          IF        SIIASUS=1 | SIIASUS=3
            BEEP
            MOVE      "Catalog Suspended - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KCATA000
          ENDIF
.
          MOVE      SIIADES,KEY60                * break up catalog description
          CALL      BKLIN0000
          PACK      SIIADES,KEY30,SP70
.
          PACK      KEY12,SIIMCST,SIIMCAT,SP70
          REPEAT
            CALL      RLSIIM1
            BRANCH    OVRCD,KCATA000             * should be there !!
            IF        OVRCD=2
              PACK      DISPMSG,SP70,SP70
              CALL      MESSAGE2
              KEYIN     *P1:24,*EL,"Imprest Record Locked - (":
                        *V2LON,"R",*HOFF,")etry or e(":
                        *V2LON,"X",*HOFF,")it ? ",*V2LON,ANS
              CALL      MESSAGE3
              PACK      ANS,ANS,SP70
              REP       UPPLOW,ANS
              MATCH     "X",ANS
              GOTO      KCATA000 IF EQUAL
              MATCH     "E",ANS
              GOTO      KCATA000 IF EQUAL
            ENDIF
          UNTIL     OVRCD=0
.
          MOVE      "   30",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIAISS,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "    7",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIADES,KEY60
            CALL      BKLIN000
            MOVE      KEY30,VAR
            CALL      DISPITEM
          ENDIF
.
KCATA999  RETURN
.----------------------------------------------------------------------
. Keyin Warehouse for Catalog Code SIIXCAT
.----------------------------------------------------------------------
KWARH000  MOVE      "    9",FLDID
          CALL      GETMLPOS
.
          IF        ACCEPT=0
            CALL      UUSIIE1
          ENDIF
.
          PACK      KEY7,SIIXCAT,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,KWARH950
.
          IF        (SIIASUS=1) | (SIIASUS=3)
            CLEAR     DISPMSG
            APPEND    "Requisitions suspended for catalog - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KWARH950
          ENDIF
.
          MATCH     DEFLTWH,SP70
          IF        @EQUAL
            IF        SIIANON=0
              PACK      KEY12,SIIXCAT,SP70
              CALL      RSSIIE1
              CALL      RKSIIE1
              BRANCH    OVRCD,KWARH890        * Not available
              MATCH     SIIECAT,SIIXCAT
              GOTO      KWARH890 IF NOT EQUAL
              MOVE      SIIEWAR,SIWAWAR
              CALL      RKSIIE1
              BRANCH    OVRCD,KWARH800        * Not available
              MATCH     SIIECAT,SIIXCAT
              GOTO      KWARH800 IF NOT EQUAL
              GOTO      KWARH010
            ELSE
              PACK      KEY5,SP70
              CALL      RSSIWA1
              CALL      RKSIWA1
              PACK      SIIXWAR,SIWAWAR,SP70
              GOTO      KWARH999
            ENDIF
          ENDIF
.
. Check For Single Warehouse or NO Warehouse
.-------------------------------------------
.
          MOVE      DEFLTWH,SIWAWAR
.
          IF        SIIANON=1
            PACK      SIIXWAR,SIWAWAR,SP70
            GOTO      KWARH999
          ENDIF
.
          PACK      KEY12,SIIXCAT,DEFLTWH
          CALL      RDSIIE1
          BRANCH    OVRCD,KWARH900        * Not available
.
          PACK      KEY12,SIIXCAT,SP70
          CALL      RSSIIE1
          CALL      RKSIIE1
          BRANCH    OVRCD,KWARH890        * Not available
.
          MATCH     SIIECAT,SIIXCAT
          GOTO      KWARH890 IF NOT EQUAL
.
          MATCH     SIIEWAR,DEFLTWH
          IF        @EQUAL
            CALL      RKSIIE1
            MOVE      Z70,SIIECAT
            MATCH     SIIXCAT,SIIECAT
            IF        !@EQUAL | OVRCD
              GOTO      KWARH800          * Single Warehouse
            ENDIF
          ENDIF
.
KWARH010  MOVE      ZERO,CKEYTYP
          CALL      KSIWSA00        * Keyin Warehouse with security
          PACK      UNDLN70,UNDLN30,UNDLN30,UNDLN30
          BRANCH    EXIT,KWARH950,KWARH950
.
          PACK      SIIXWAR,SIWAWAR,SP70
          PACK      KEY12,SIIXCAT,SIIXWAR,SP70   * lock catalog/warehouse
          REPEAT
            CALL      RLSIIE1
            IF        OVRCD=1
              CLEAR     DISPMSG
              APPEND    "Catalog Not Located At This Warehouse - ",DISPMSG
              CALL      MESSAGE1
              GOTO      KWARH000
            ENDIF
            IF        OVRCD=2
              PACK      DISPMSG,SP70,SP70
              CALL      MESSAGE2
              KEYIN     *P1:24,*EL,"Catalog/Warehouse Locked - (":
                        *V2LON,"R",*HOFF,")etry or e(":
                        *V2LON,"X",*HOFF,")it ? ",*V2LON,ANS
              CALL      MESSAGE3
              PACK      ANS,ANS,SP70
              REP       UPPLOW,ANS
              MATCH     "X",ANS
              GOTO      KWARH000 IF EQUAL
              MATCH     "E",ANS
              GOTO      KWARH000 IF EQUAL
            ENDIF
          UNTIL     OVRCD=0
.
          PACK      KEY12,SIIXCAT,SIIXWAR,SP70   * check if on stocktake
          CALL      SISIWK1
          IF        OVRCD=0
            CLEAR     DISPMSG
            APPEND    "Stocktake in progress for catalog/warehouse - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KWARH000
          ENDIF
.
          IF        (SIIESUS=1) | (SIIESUS=3)
            CLEAR     DISPMSG
            APPEND    "Requisitions suspended for catalog/warehouse - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KWARH000
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      KWARH999
.
. Only on one warehouse
.-----------------------
KWARH800  PACK      KEY5,SIWAWAR
          CALL      RDSIWA1
          BRANCH    OVRCD,KWARH000
.
          PACK      SIIXWAR,SIWAWAR,SP70
          PACK      KEY12,SIIXCAT,SIIXWAR,SP70   * lock catalog/warehouse
          REPEAT
            CALL      RLSIIE1     * We Already Know it Exists
            BRANCH    OVRCD,KWARH950
            IF        OVRCD=2
              PACK      DISPMSG,SP70,SP70
              CALL      MESSAGE2
              KEYIN     *P1:24,*EL,"Catalog/Warehouse Locked - (":
                        *V2LON,"R",*HOFF,")etry or e(":
                        *V2LON,"X",*HOFF,")it ? ",*V2LON,ANS
              CALL      MESSAGE3
              PACK      ANS,ANS,SP70
              REP       UPPLOW,ANS
              MATCH     "X",ANS
              GOTO      KWARH950 IF EQUAL
              MATCH     "E",ANS
              GOTO      KWARH950 IF EQUAL
            ENDIF
          UNTIL     OVRCD=0
.
          PACK      KEY12,SIIXCAT,SIIXWAR,SP70   * check if on stocktake
          CALL      SISIWK1
          IF        OVRCD=0
            CLEAR     DISPMSG
            APPEND    "Stocktake in progress for catalog/warehouse - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KWARH950
          ENDIF
.
          IF        (SIIESUS=1) | (SIIESUS=3)
            CLEAR     DISPMSG
            APPEND    "Requisitions suspended for catalog/warehouse - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KWARH950
          ENDIF
          MOVE      "    9",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIXWAR,VAR
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KWARH999
.
. Catalog Not in Stock
.---------------------
KWARH890  MOVE      "Catalog Not Available in ANY Warehouse - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KWARH950
.
KWARH900  MOVE      "Catalog Not Available in Warehouse - ",DISPMSG
          CALL      MESSAGE1
.
KWARH950  MOVE      TWO,EXIT
.
KWARH999  RETURN
.----------------------------------------------------------------------
. Keyin Quantity on Hand or Quantity Required
.----------------------------------------------------------------------
KQOHA000  MOVE      "   13",FLDID
          CALL      GETMLPOS
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          KEYIN     *PCCOL:CVERT,*V2LON,CONTQTY:
                    *PCCOL:CVERT,*DV,CONTQTY
          MOVE      CONTQTY,SIIXQOH
          IF        SIIXQOH<0
            CLEAR     DISPMSG
            APPEND    "Must not be less then zero - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KQOHA000
          ENDIF
.
          MATCH     "1",INCOSI40         * Enter Qty Required not On Hand
          IF        @EQUAL
            MOVE      SIIXQOH,SIIXREQ
            ASSIGN    SIIXMAX-SIIXREQ,SIIXQOH
          ELSE
            ASSIGN    SIIXMAX-SIIXQOH,SIIXREQ
          ENDIF
          IF        SIIXREQ<0
            MOVE      ZERO,SIIXREQ
          ENDIF
.
          MOVE      SIIXQOH,VAR
          CALL      DISPITEM
.
          MOVE      "   12",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIXREQ,VAR
            CALL      DISPITEM
          ENDIF
.
KQOHA999  RETURN
.----------------------------------------------------------------
. Set up the Temporary Imprest File Variables for the current Entry
.----------------------------------------------------------------
SETIMX00  MOVE      SIIMCAT,SIIXCAT
          MOVE      SIIMSEQ,SIIXSEQ
          MOVE      SIIMMAX,SIIXMAX
          MOVE      SIIMREQ,SIIXREQ
          MOVE      SIIMQOH,SIIXQOH
          MOVE      SIIMUR1,SIIXUR1
          MOVE      SIIMUR2,SIIXUR2
          MOVE      SIIMUD1,SIIXUD1
          MOVE      SIIMUD2,SIIXUD2
          MOVE      SIIMUC1,SIIXUC1
          MOVE      SIIMUC2,SIIXUC2
          MOVE      SIIMUY1,SIIXUY1
          MOVE      SIIMUY1,SIIXUY1
          MOVE      SIIMWAR,SIIXWAR
.
SETIMX99  RETURN
.----------------------------------------------------------------
. Clear Line
.----------------------------------------------------------------
CLRLIN00  MOVE      "    6",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SP70,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "    7",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SP70,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   30",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SP70,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "    9",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SP70,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   13",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SP70,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   12",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SP70,VAR
            CALL      DISPITEM
          ENDIF
.
CLRLIN99  RETURN
.----------------------------------------------------------------
. Display Fields
.----------------------------------------------------------------
DCATA000  MOVE      "    6",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIXCAT,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "    7",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIADES,KEY60
            CALL      BKLIN000
            MOVE      KEY30,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   30",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIAISS,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "    9",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIXWAR,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   13",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIXQOH,VAR
            CALL      DISPITEM
          ENDIF
.
          MOVE      "   12",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIXREQ,VAR
            CALL      DISPITEM
          ENDIF
.
DCATA999  RETURN
.********************************************************************
. BKLIN - Break up KEY60 into two neat halves        Called by lots
.         Requires - KEY60   (original line)
.         Returns  - KEY30   (line 1)
.                    KEY60   (line 2)
.********************************************************************
BKLIN000  RESET     KEY60,31
          CMATCH    SP70,KEY60
          WHILE     !@EQUAL&!@EOS
            BUMP      KEY60,-1
            IF        !@EOS
              CMATCH    SP70,KEY60
            ENDIF
          DO
.
          IF        @EOS
            SETLPTR   KEY60
            RESET     KEY60
            UNPACK    KEY60,KEY30,KEY60
          ELSE
            LENSET    KEY60
            RESET     KEY60
            MOVE      KEY60,KEY30
            PACK      KEY30,KEY30,SP70
.
            ENDSET    KEY60
            SETLPTR   KEY60
            BUMP      KEY60
            PACK      KEY60,KEY60,SP70
          ENDIF
.
BKLIN999  RETURN
.------------------------------------------------------------------------
. IO rountines
.------------------------------------------------------------------------
RSTMCW1   RESET     KEY12
          READ      TMCATWAR,KEY12;;
          RETURN
.
RDTMCW1   RESET     KEY12
          MOVE      ZERO,OVRCD
          READ      TMCATWAR,KEY12;TMCWCAT,TMCWWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RKTMCW1   MOVE      ZERO,OVRCD
          READKS    TMCATWAR;TMCWCAT,TMCWWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RPTMCW1   MOVE      ZERO,OVRCD
          READKP    TMCATWAR;TMCWCAT,TMCWWAR
          GOTO      OVERCOND IF OVER
          RETURN
.
UPTMCW1   UPDATE    TMCATWAR;TMCWCAT,TMCWWAR
          GOTO      UPDFLOCK IF LOCKED
          RETURN
.
WRTMCW1   RESET     KEY12
          WRITE     TMCATWAR,KEY12;TMCWCAT,TMCWWAR
          RETURN
.
DETMCW1   RESET     KEY12
          DELETE    TMCATWAR,KEY12
          RETURN
.------------------------------------------------------------
. Check for Outstanding P/O
.------------------------------------------------------------
          DEFPROC   CHKORD00
.
          OPEN      SINPOCA6,"sinpocaf"
          PACK      KEY25,SIIACAT,Z70
          CALL      RSSIPC6
.
CHKORD10  CALL      RPSIPC6
          BRANCH    OVRCD,CHKORD99
          MATCH     SIPCCAT,SIIACAT
          GOTO      CHKORD99 IF NOT EQUAL
          MATCH     SP70,SIPCEDD
          GOTO      CHKORD99 IF EQUAL
          MATCH     SIPCCST,COSTCENT
          GOTO      CHKORD10 IF NOT EQUAL
.
          CLEAR     DISPMSG
          APPEND    "WARNING: Order ",DISPMSG
          APPEND    SIPCPON,DISPMSG
          APPEND    " for ",DISPMSG
          MOVE      SIPCOQT,F6
          APPEND    F6,DISPMSG
          APPEND    " Due ",DISPMSG
          UNPACK    SIPCEDD,CCENT,CYEAR,CMON,CDAY
          APPEND    CDAY,DISPMSG
          APPEND    "/",DISPMSG
          APPEND    CMON,DISPMSG
          APPEND    " - ",DISPMSG
          RESET     DISPMSG
.
          CALL      MESSAGE1
.
CHKORD99  GOTO      CHKORDZZ
.
CHKORDZZ  ENDPROC
.
.----------------------------------------------------------------------
. Keyin Quantity on Hand
.----------------------------------------------------------------------
KQOH0000
          KEYIN     *PCCOL:CVERT,*V2LON,SIIMQOH:
                    *PCCOL:CVERT,*DV,SIIMQOH
          IF        SIIMQOH<0
            CLEAR     DISPMSG
            APPEND    "Must not be less then zero - ",DISPMSG
            CALL      MESSAGE1
            GOTO      KQOH0000
          ENDIF
.
          ASSIGN    SIIMMAX-SIIMQOH,SIIMREQ
          IF        SIIMREQ<0
            MOVE      ZERO,SIIMREQ
          ENDIF
.
KQOH9999  RETURN
.----------------------------------------------------------------
. Return Date - Convert to Usage period for date
.----------------------------------------------------------------
RETDAT00  PACK      RETUDATE,CCC,CYY,CMM,CDD
          REP       " 0",RETUDATE
          UNPACK    RETUDATE,CCENT,CYEAR,CMON,CDAY
          CALL      KEYDATE
          PACK      RETUDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",RETUDATE
          MOVE      RETUDATE,SIPEDATE
          CALL      RSIPE000                 * Calculate Period
          IF        OVRCD=1
            MOVE      "Period Not on File. Invalid Date - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      RETDAT00
          ENDIF
          IF        SIPELOC=1
            MOVE      "Period Locked. - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      RETDAT00
          ENDIF
.
          MATCH     SIPEYEAR,SIPECYR
          IF        !(@EQUAL)
            MOVE      "WARNING : Period Not in Current Year. - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      RETDAT00
          ENDIF
.
          PACK      RETUPERD,SIPEYEAR,SIPEPER,SP70
          REP       " 0",RETUPERD            * Usage Period
.
RETDAT99  RETURN
.----------------------------------------------------------------------
. Keyin Default Warehouse
.----------------------------------------------------------------------
KDEFW000  MOVE      "0",CKEYTYP
          MOVE      SP70,DEFLTWH
          MOVE      SP70,SIWAWAR
          CALL      KSIWSA00
          BRANCH    EXIT,KDEFW990,KDEFW999
.
          MOVE      SIWAWAR,DEFLTWH
          GOTO      KDEFW999
.
KDEFW900  PACK      DEFLTWH,SP70
          MOVE      "All Warehouses",SIWADES
          MOVE      ZERO,EXIT
          GOTO      KDEFW999
.
KDEFW990  IF        SECSIWS=1
            PACK      KEY9,PASSCODE,SP70
            CALL      RSSIWS1
            CALL      RKSIWS1
            MOVE      SIWSWAR,DEFLTWH
            PACK      KEY5,SIWSWAR,SP70
            CALL      RDSIWA1
            GOTO      KDEFW999
          ENDIF
.
          COMPARE   ZERO,SECSIWS
          GOTO      KDEFW900 IF NOT EQUAL
          BEEP
          MOVE      "You have no access for all Warehouses - ",DISPMSG
          CALL      MESSAGE1
          PACK      DEFLTWH,SP70
          MOVE      TWO,EXIT
          GOTO      KDEFW999
.
KDEFW999  MOVE     ONE,OVRCD
          MOVE     ONE,ACCEPT
          MOVE     ONE,COUNTER3
          RETURN
.------------------------------------------------------------
. Delete Item
.------------------------------------------------------------
DITEM000  MOVE      SCSLDES,DISPMSG
          CALL      MESSAGE2
DITEM005  CALL      MDELQ000
          BRANCH    EXIT,DITEM900,DITEM900
          MOVE      SCSLITM,FIELDNO
          MATCH     ITMSSFFI,SCSLITM
          GOTO      DITEM100 IF NOT EQUAL
          CALL      SELECTED
          MATCH     "SIIX1",SCPSMTY
          IF        @EQUAL
            PACK      KEY5,SCSLROW,SCSLCOL
            CALL      TRSIIX11
            IF        OVRCD=0
              CALL      TDSIIX12
              PACK      KEY12,SIIXCAT,SIIXWAR
              CALL      RDTMCW1
              IF        OVRCD=0
                CALL      DETMCW1
              ENDIF
            ELSE
              BEEP
              GOTO      DITEM005
            ENDIF
            PACK      KEY5,SP1,ONE,SP70
            CALL      TSSIIX11
            CALL      TKSIIX11
            MOVE     KEY3,SIIX1NXT
            CALL      CT00L000
            MOVE      SIIX1NXT,KEY3
            CALL      TSSIIX12
            CALL      TPSIIX12
            CALL      DP00L000
            GOTO      DITEM005
          ENDIF
DITEM100  MOVE      "Invalid Selection. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      DITEM005
DITEM900  CALL      MESSAGE3
          RETURN
.
.----------------------------------------------------------------
. Set Up Default Warehouse
.----------------------------------------------------------------
DEFWAR00  READ      CONTROLF,TWENTY3;*143,HDEFWH
          READ      CONTROLF,SIXTY3;*233,SNCOCAT6
          MOVE      ONE,ACCEPT
DEFWAR99  RETURN
.
.----------------------------------------------------------------
. Process Normal Download File
.----------------------------------------------------------------
IMPA0000  MOVE      ZERO,IMPFLFLG   * Import normal file
          CALL      IMPT0000
IMPA9999  RETURN
.----------------------------------------------------------------
. Post All Imprest Data
.----------------------------------------------------------------
IMPT0000  CALL      COPY0000        * Get Download File
          BRANCH    EXIT,IMPT9999
          CALL      VERI0000        * Verify Contents of File
          BRANCH    EXIT,IMPT9999
.
          PACK      DEFTCST,SP70    * new requisition for each C/C ?
          OPEN      IMPORTFL,IMPORTFN
          MOVE      ZERO,SECTOR
          MOVE      ZERO,CPAGENO
          MOVE      "99",CLNO
          CLOCK     TIME,CTIMEIS
.
          DISPLAY   *P1:24,*EL,"Posting Imprest - Current Catalogue : "
.
IMPT1000  IF        SNCOCAT6=1
            IF        IMPFLFLG=0
              READ      IMPORTFL,SEQ;SIIXCST,D7,QTYREQ,QTYEXT
              GOTO      IMPT9000 IF OVER
            ELSE
              READ      IMPORTFL,SEQ;SIIXCST,D7,QTYREQ,QTYEXT,SIIXRESI
              GOTO      IMPT9000 IF OVER
            ENDIF
            CALL      GETCAT00
          ELSE
            IF        IMPFLFLG=0
              READ      IMPORTFL,SEQ;SIIXCST,SIIXCAT,QTYREQ,QTYEXT
              GOTO      IMPT9000 IF OVER
            ELSE
              READ      IMPORTFL,SEQ;SIIXCST,SIIXCAT,QTYREQ,QTYEXT,SIIXRESI
              GOTO      IMPT9000 IF OVER
            ENDIF
          ENDIF
          DISPLAY   *P39:24,*V2LON,SIIXCAT
.
. ------- Read Cost Centre Details
IMPT1001  PACK      COSTCENT,SIIXCST,SP70
          PACK      KEY5,SIIXCST,SP70
          CALL      RDSICA1
          BRANCH    OVRCD,IMPT1000
.
. ------- Read Catalogue Details
IMPT1002  PACK      KEY7,SIIXCAT,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,IMPT1000
.
. ------- Re-Check for O/S order for non-stock items
IMPT1003  MOVE      SIIXCAT,SIIACAT
          COMPARE   ONE,SIIANON
          IF        @EQUAL
            CALL    CHKOSP00
            BRANCH  EXIT1,IMPT1000
          ENDIF
.
. ------- Read Catalogue WareHouse Details
IMPT1004  BRANCH    SIIANON,IMPT1100
          PACK      KEY12,SIIXCAT,SIIXWAR,SP70
          CALL      RDSIIE1
          BRANCH    OVRCD,IMPT1000
.
. ------- Read Warehouse Details
IMPT1005  PACK      KEY5,SIIXWAR,SP70
          CALL      RDSIWA1
.
. ------- Read Imprest Details
IMPT1100  PACK      KEY12,SIIXCST,SIIXCAT
          CALL      RDSIIM1
          BRANCH    OVRCD,IMPT1000
.
.         If the control variable Barcode Input Quantity Required is yes
.         then use the quantity req. otherwise its max qty - qty req.
.
          IF        SNCOIMPQ=2
            IF        QTYREQ<0
              ASSIGN    ((QTYREQ*SEQ)+SIIMMAX),SIIXQOH
              MOVE      ZERO,SIIXREQ
            ELSE
              MOVE      QTYREQ,SIIXREQ
              ASSIGN    (SIIMMAX-QTYREQ),SIIXQOH
            ENDIF
            ASSIGN    SIIXREQ+QTYEXT,SIIXREQ
          ELSE
...         ASSIGN    SIIMMAX-SIIMREQ,SIIXQOH
...         ASSIGN    QTYREQ+QTYEXT,SIIXREQ
            ASSIGN    SIIMMAX-QTYREQ,SIIXREQ                           *C-F1101
            ASSIGN    SIIMMAX-SIIXREQ,SIIXQOH                          *C-F1101
            ASSIGN    SIIXREQ+QTYEXT,SIIXREQ                           *C-F1101
          ENDIF
.
          CALL      POST0000                 * Post Imprest Record
          GOTO      IMPT1000
.
IMPT9000  CLOSE     IMPORTFL,DELETE
IMPT9999  RETURN
.------------------------------------------------------------
. Get Catalog code
.------------------------------------------------------------
GETCAT00  SQUEEZE   D7
          MOVELPTR  D7,F1
.
          MOVE      SEVEN,FORM1
          MOVE      SP7,SIIXCAT
.
GETCAT10  COMPARE   ZERO,F1
          GOTO      GETCAT90 IF EQUAL
.
          RESET     SIIXCAT,FORM1
          RESET     D7,F1
          CMOVE     D7,SIIXCAT
.
          SUB       ONE,FORM1
          SUB       ONE,F1
          GOTO      GETCAT10
.
GETCAT90  RESET     SIIXCAT
.
GETCAT99  RETURN
.------------------------------------------------------------
. Copy File from DOS to UNIX using script ibasin64.us1
.------------------------------------------------------------
COPY0000  DISPLAY   *P20:15,*EL,"Copying download file from PC ";
.
          CLEAR     IMPORTFN
          APPEND    "downld",IMPORTFN
          APPEND    PORT,IMPORTFN
          RESET     IMPORTFN
          REP       " 0",IMPORTFN
          REP       LOWUP,IMPORTFN
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IMPORTFL,IMPORTFN
          TRAPCLR   IO
          IF        OVRCD=0
            CLEAR     DISPMSG
            APPEND    "ERROR - ",DISPMSG
            APPEND    IMPORTFN,DISPMSG
            APPEND    " File Exists - ",DISPMSG
            RESET     DISPMSG
            BEEP
            MOVE      NO,DEFYESNO
            CALL      MESSAGE4
            IF        EXIT=1
              CHAIN     PGM
            ENDIF
            CLOSE     IMPORTFL,DELETE
          ENDIF
.
          MOVE      "0",HLEF
          CALL      GETSCR00
          DISPLAY   *P1:24,*EL
          CLEAR     KEY80
          APPEND    "ibasin41.us1 ",KEY80
          APPEND    IMPORTFN,KEY80
          APPEND    ".txt",KEY80
          RESET     KEY80
          EXECUTE   KEY80,TASKID
          CALL      PUTSCR00
.
          MOVE      ZERO,EXIT
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IMPORTFL,IMPORTFN
          TRAPCLR   IO
          IF        OVRCD=1
            CLEAR     DISPMSG
            APPEND    "ERROR - ",DISPMSG
            APPEND    IMPORTFN,DISPMSG
            APPEND    " File Does Not Exist - ",DISPMSG
            RESET     DISPMSG
            BEEP
            MOVE      NO,DEFYESNO
            CALL      MESSAGE1
            MOVE      ONE,EXIT
          ENDIF
          RETURN
.----------------------------------------------------------------------
. VERI0000 - Verify & Load Contents of File
.----------------------------------------------------------------------
VERI0000  MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     IMPORTFL,IMPORTFN
          TRAPCLR  IO
          BRANCH   OVRCD,VERI9100
          MOVE     ZERO,SECTOR
          MOVE     ZERO,CPAGENO
          MOVE     "99",CLNO
          CLOCK    TIME,CTIMEIS
          MOVE     ONE,BACKORDR                  * set backorder flag to
.                                                   all items on backorder
          MOVE     ZERO,EXIT
.
VERI1000  ADD      ONE,SECTOR
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF FORMAT
          IF        SNCOCAT6=1
            IF        IMPFLFLG=0
              READ     IMPORTFL,SEQ;SICACODE,D7,QTYREQ,QTYEXT
              GOTO     VERI9900 IF OVER
            ELSE
              READ     IMPORTFL,SEQ;SICACODE,D7,QTYREQ,QTYEXT,SIIXRESI
              GOTO     VERI9900 IF OVER
            ENDIF
            CALL     GETCAT00
            MOVE     SIIXCAT,SIIACAT
          ELSE
            IF        IMPFLFLG=0
              READ     IMPORTFL,SEQ;SICACODE,SIIACAT,QTYREQ,QTYEXT
              GOTO     VERI9900 IF OVER
            ELSE
              READ     IMPORTFL,SEQ;SICACODE,SIIACAT,QTYREQ,QTYEXT,SIIXRESI
              GOTO     VERI9900 IF OVER
            ENDIF
          ENDIF
          TRAPCLR  FORMAT
          BRANCH   OVRCD,VERI9200
.
          COMPARE  ZERO,QTYEXT
          GOTO     VERI1100 IF NOT EQUAL
          COMPARE  ZERO,QTYREQ          * Don't Load if Zero Quantity
          GOTO     VERI1000 IF EQUAL    * Print error and get next item
.
VERI1100  MOVE     SICACODE,KEY5
          CALL     RDSICA1              * Cost Centre Details
          BRANCH   OVRCD,VERI9300
.
          MOVE     SIIACAT,KEY7
          CALL     RDSIIA1              * Catalog Details
          BRANCH   OVRCD,VERI9400
.
          COMPARE  ONE,SIIANON          * Non - Stock 1=Yes
          GOTO     VERI3000 IF EQUAL
.
          PACK     KEY12,SIIACAT,SIIXWAR,SP70
          CALL     RDSIIE1
          BRANCH   OVRCD,VERI9500
.
          PACK      KEY12,SICACODE,SIIACAT,SP70
          CALL      RDSIIM1
          BRANCH    OVRCD,VERI9600
.
.         If you reached here must set the backorder flag off
.
          MOVE     ZERO,BACKORDR            * set flag for items not   *I-F0907
.                                           * on backorder             *I-F0907
.
          GOTO     VERI1000
.
. Non - Stock Item
.
VERI3000  COMPARE  "55",CLNO
          CALL     VHEAD000 IF NOT LESS
          ADD      ONE,CLNO
          ADD      QTYEXT,QTYREQ
          PRINT    SICACODE,SP1,SICADESC,SP1,SIIACAT,SP1,SIIADES:
                   "NON-STOCK",*126,QTYREQ
          CALL     CHKOSP00
          BRANCH   EXIT1,VERI9700
          MOVE     ZERO,BACKORDR                 * set flag for items not
.                                                   on backorder
          GOTO     VERI1000
.
VERI9100  MOVE     "ERROR : Can't Open Import File - ",DISPMSG
          BEEP
          CALL     MESSAGE1
          MOVE     ONE,EXIT
          GOTO     VERI9999
.
VERI9200  CLEAR    DISPMSG
          APPEND   "ERROR : Format Error at Line",DISPMSG
          APPEND   SECTOR,DISPMSG
          APPEND   " - ",DISPMSG
          RESET    DISPMSG
          BEEP
          CALL     MESSAGE1
          MOVE     ONE,EXIT
          GOTO     VERI9900
.
VERI9300  CLEAR    DISPMSG
          APPEND   SECTOR,DISPMSG
          APPEND   " ERROR : Cost Centre Invalid ",DISPMSG
          APPEND   KEY5,DISPMSG
          APPEND   " - ",DISPMSG
          RESET    DISPMSG
          BEEP
          CALL     MESSAGE1
.
          COMPARE  "55",CLNO
          CALL     VHEAD000 IF NOT LESS
          ADD      ONE,CLNO
          PRINT    "ERROR : Cost Centre ",KEY5," Invalid at Line ",SECTOR
          MOVE     ONE,EXIT
          GOTO     VERI1000
.
VERI9400  CLEAR    DISPMSG
          APPEND   SECTOR,DISPMSG
          APPEND   " ERROR : Catalog Code Invalid ",DISPMSG
          APPEND   KEY7,DISPMSG
          APPEND   " - ",DISPMSG
          RESET    DISPMSG
          BEEP
          CALL     MESSAGE1
.
          COMPARE  "55",CLNO
          CALL     VHEAD000 IF NOT LESS
          ADD      ONE,CLNO
          PRINT    "ERROR : Catalog Code ",KEY7," Invalid at Line ",SECTOR
          MOVE     ONE,EXIT
          GOTO     VERI1000
.
VERI9500  CLEAR    DISPMSG
          APPEND   SECTOR,DISPMSG
          APPEND   " ERROR : Catalog Warehouse Invalid ",DISPMSG
          APPEND   KEY7,DISPMSG
          APPEND   " - ",DISPMSG
          RESET    DISPMSG
          BEEP
          CALL     MESSAGE1
.
          COMPARE  "55",CLNO
          CALL     VHEAD000 IF NOT LESS
          ADD      ONE,CLNO
          PRINT    "ERROR : Catalog Warehouse ",KEY7," Invalid at Line ",SECTOR
          MOVE     ONE,EXIT
          GOTO     VERI1000
.
VERI9600  COMPARE  "55",CLNO
          CALL     VHEAD000 IF NOT LESS
          ADD      ONE,CLNO
          PRINT    "WARNING - Cost Centre/Catalog : ",SICACODE,SLASH,SIIACAT:
                   " is not in Imprest File."
          GOTO     VERI1000
.
VERI9700  COMPARE  "55",CLNO
          CALL     VHEAD000 IF NOT LESS
          ADD      ONE,CLNO
          MOVE     SIPCOQT,F6
          UNPACK   SIPCEDD,CCENT,CYEAR,CMON,CDAY
          PRINT    "WARNING - Catalog item ",SIIACAT," already on order ":
                   SIPCPON,". Above order suppressed."
          PRINT    SP70,SP70
          GOTO     VERI1000
.
VERI9900  IF       BACKORDR = 1 & EXIT = 0
            MOVE     ONE,EXIT                   * all items on backorder already
          ENDIF
.
          COMPARE  ZERO,CPAGENO
          GOTO     VERI9999 IF EQUAL
          CALL     UND132
          PRINT    *50,"*** End of Exceptions Report ***"
.
VERI9999  RETURN
.----------------------------------------------------------------------
. Exceptions Report Heading
.----------------------------------------------------------------------
VHEAD000  CALL     HEAD132
          PRINT    *40,"******** IMPREST VERIFY ERROR REPORT **********"
          CALL     UND132
          PRINT    "Cost Centre                                    ":
                   "Catalog                                        ":
                   "                              Quantity"
          CALL     UND132
VHEAD999  RETURN
.----------------------------------------------------------------------
. Check for Oustanding P/O
.----------------------------------------------------------------------
CHKOSP00  MOVE     ZERO,EXIT1
.         OPEN     SINPOCA6,"sinpocaf"
          PACK     KEY25,SIIACAT,Z70
          CALL     RSSIPC6

CHKOSP10  CALL     RPSIPC6
          BRANCH   OVRCD,CHKOSP99
          MATCH    SIPCCAT,SIIACAT
          GOTO     CHKOSP99 IF NOT EQUAL
          MATCH    SP70,SIPCEDD
          GOTO     CHKOSP99 IF EQUAL
          MATCH    SIPCCST,SICACODE
          GOTO     CHKOSP10 IF NOT EQUAL

CHKOSP98  MOVE     ONE,EXIT1

CHKOSP99  RETURN
.----------------------------------------------------------------
. Set Up Default Warehouse
.----------------------------------------------------------------
WAREH000  BRANCH    ACCEPT,WAREH100
WAREH010  MOVE      SP70,SIWADES
          CALL      KSIWSA00
          BRANCH    EXIT,WAREH990,WAREH990
          MOVE      SIWAWAR,SIIXWAR
          GOTO      WAREH999
.
WAREH100  MOVE      HDEFWH,KEY5
          MOVE      HDEFWH,SIIXWAR
          CALL      RDSIWA1
          MATCH     SP70,SIIXWAR
          IF        @EQUAL
            MOVE      SP70,KEY5
            CALL      RSSIWA1
            CALL      RKSIWA1
            MOVE      SIWAWAR,SIIXWAR
          ENDIF
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,SIWADES,SP70
            CALL      DISPITEM
          ENDIF
.
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            PACK      VAR,SIIXWAR,SP70
            CALL      DISPITEM
          ENDIF
.
. check warehouse security
.
          PACK      KEY9,PASSCODE,HDEFWH,SP70
          CALL      RDSIWS1
          IF        OVRCD=1
            CLEAR     DISPMSG
            APPEND    "You have no access for Default Warehouse ",DISPMSG
            APPEND    HDEFWH,DISPMSG
            APPEND    " - ",DISPMSG
            CALL      MESSAGE1
.
            MOVE      "    5",FLDID
            CALL      GETPOSIT
            IF        EXIT=0
              MOVE      SP70,SIWADES
              PACK      VAR,SP70,SP70
              CALL      DISPITEM
            ENDIF
.
            MOVE      "    4",FLDID
            CALL      GETPOSIT
            IF        EXIT=0
              MOVE      SP70,SIIXWAR
              PACK      VAR,SP70,SP70
              CALL      DISPITEM
            ENDIF
.
            MOVE      SP70,SIWAWAR
            GOTO      WAREH010
          ENDIF
          GOTO      WAREH999
.
WAREH990  MOVE      TWO,EXIT
          GOTO      WAREH999
.
WAREH999  RETURN
.
.----------------------------------------------------------------
. Process Omnicell File
.----------------------------------------------------------------
IMPB0000  MOVE      ONE,IMPFLFLG    * Import Omnicell file
          CALL      IMPT0000
IMPB9999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       APSMASIO/INC
          INC       IBAGEDIO/INC
          INC       IBAGSTIO/INC
          INC       SINBACIO/INC
          INC       SINCCAIO/INC
          INC       SINCCAKY    
          INC       SINCCBIO/INC
          INC       SINCCEIO/INC
          INC       SINCCFIO/INC
          INC       SINCCHIO/INC
          INC       SINCGBIO/INC
          INC       SINCIAIO/INC
          INC       SINCICIO/INC
          INC       SINCIEIO/INC
          INC       SINCIHIO/INC
          INC       SINCIIIO/INC
          INC       SINFACIO/INC
          INC       SINIMPIO/INC
          INC       SINIMPKY    
          INC       SINIMXIO/INC
          INC       SINIPSIO/INC
          INC       SINITMIO/INC
          INC       SINNATIO/INC
          INC       SINNPOIO/INC
          INC       SINPERCD    
          INC       SINPERIO/INC
          INC       SINPOCIO/INC
          INC       SINREAIO/INC
          INC       SINREBIO/INC
          INC       SINSCDIO/INC
          INC       SINSCMIO/INC
          INC       SINSECIO/INC
          INC       SINSUAIO/INC
          INC       SINSUBIO/INC
          INC       SINUSAGE    
          INC       SINWARIO/INC
          INC       SINWRKCD    
          INC       SINWRKIO/INC
          INC       SINWSEIO/INC
          INC       SINWSEKY    
.
          INC       STDGENCD
.

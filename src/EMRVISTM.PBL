.----------------------------------------------------------------------
. Program       : EMRVISTM.PBL 
.
. Modifications :
.--------------------------------------------------------
. V11.04.01 24.06.2024  DA Sarkies     TSK 0900069
.           Changed SQUEEZE to STRIP for displaying Drs Name
. V11.02.01 30/09/2022  Ebon Clements  TSK 0900069
.           Changed claim code selection list to output all indicators
.           COMPCL00
. V11.01.02 17/06/2021  Thanh T         TSK 0873184
.           Changed check for PTCNNSSI with 20 zeros as well as spaces
. V11.01.01 18/05/2021  Thanh T         TSK 0873184
.           Added EMRX0400 to EMRX0800
. V11.00.02 08/10/2020  Ebon Clements   TSK 0898282
.           Added hospital specific code test to claim code list - COMPCL00
. V11.00.01 16/09/2020  Ebon Clements  TSK 0867112
.           Added first additional diagnosis tags
. V10.14.04 11/09/2019  Richa Phogat   TSK 0880277
.           Removed matching EMVIUR01 with DOCTCODE under EMRB6600
. V10.14.03 01/04/2019  Ebon Clements  TSK  0869562
.           Added only display available locations functionality - EMCNLODD = 2
. V10.14.02 13/03/2019 Ebon Clements   TSK 0868834
.           Added EMVIVSTY and EMVIVPLC 
. V10.14.01 15/02/2019  Don Nguyen     TSK 0821139
.           Modified Location selection list code to also validate 'Emergency
.           Telehealth Service' room type (LOCN0000).
. V10.13.01 05/09/2018  Peter Vela     TSK 0859742
.           Added the following variables:
.           Referral Period (Category RF)
.           Referring Period Month
.           Referral Date
. V10.12.01 11/01/2018  Tracey Nguyen  TSK 0825792
.           1)Modified EMRA6100/EMRA6120/EMRA6400 to use pmshcpaf if EMCNURSE=1  
.           2)Added SHCPNU00 to ouptut a selection list of Nurse type 
.             from pmshcpaf
. V10.10.01 14/03/2017  Richa Phogat   TSK 0323865
.           Added 'Unknown' vlaue in drop down list for EMVIYN06
. V10.08.05 02/11/2016  Ania P         CAR 0822868
.           Strip FMT Fields in EMRA0700
. V10.08.04 28/09/2016  Ania P         CAR 0822868
.           Added code to EMRA0700 for PTCNHDPS/nz
. V10.08.03 05/08/2016  Jill Parkinson TSK 0821156
.           Move changes to LOCN0000 - incorrect goto's for 'in use' locations
. V10.08.02 02/08/2016  Jill Parkinson TSK 0821156
.           Added check for inactive locations LOCN0000
. V10.08.01 10/06/2016  Peter Vela     TSK 0816991
.           Added validations for cancelled visits in LOCN2500
. V10.06.04 05/08/2015  Peter Vela     CAR 320365
.           Fixed location type validations in LOCN2000
. V10.06.03 22/06/2015  Peter Vela     CAR 311435
.           Strip Nurse Given Name and Nurse Surname
. V10.06.02 03/03/2015  Peter Vela     CAR 282090
.           Added EMCNLODD functionality to LOCN0000
. V10.06.01 20/03/2015  Ebon Clements  CAR 304779
.           Added tags for EMVIUC31 to EMVIUC35
. V10.05.11 14/10/2014  Don Nguyen     CAR 307008
.           Modified EMRB6700 to test for "." before unpacking for EMVIUR02
. V10.05.10 20/08/2014 Peter Vela      CAR 303909
.           Added DATED000 to EMRB3300 and EMRB3400
. V10.05.03 19/08/2014 Peter Vela      CAR 303879
.           Added the following variables:
.           Meet & Greet Assessment Nurse Code
.           Meet & Greet Ass. Nurse Date Seen
.           Meet & Greet Ass. Nurse Time Seen
.           Meet & Greet Ass. Doctor Code
.           Meet & Greet Ass. Doctor Date Seen
.           Meet & Greet Ass. Doctor Time Seen
. V10.05.02 18/08/2014 Peter Vela      CAR 304873
.           Added DATED000 - Selection List from arrival date to
.           discharge date
. V10.05.01 18/08/2014 Peter Vela      CAR 304873
.           Change date selection list to display 998 days DATES000
.           15/08/2014  Ania P         CAR 303879 (also 304104/304641)
.           Added output for EMVIPURC
. V10.04.01 11/03/2014  Ebon Clements  CAR 294181
.           Added tags for EMVIAADT to EMVIDATM - EMRB7500 to EMRB7900
. V10.03.02 17/09/2012  Don Nguyen     CAR 273077
.           Added option to default to 'Attending Doctor' in EMRB6700
. V10.03.01 11/11/2011  Ebon Clements  CAR 255047
.           Added claim code tag that uses CODITM00
. V10.02.01 27/06/2011  Petr McMullen  CAR 240725
.           Change ward selection list sort order to name, not code 
. V10.00.04 09/08/2010  Peter Vela     CAR 216620
.           Added EMVCMNCD Primary Diagnosis Code
.           Added EMVCUNIQ Primary Diagnosis Unique Number
. V10.00.03 16/06/2010  Ebon Clements  CAR 218982
.           Added EMVIMPRA, EMVIMPDT and EMVIMPTM
. V10.00.02 15/06/2010  Peter Vela     CAR 216620
.           Added EMVCFTXT
. V10.00.01 31/03/2010  Ebon Clements  CAR 216782  
.           Added EMVIDPDT to EMVIDLRS 
. V9.12.01  13.10.2009  Jill Parkinson CAR 203391
.           Fixed tag for EMRA1900 to not go to EMRA9999 if blank
. V9.11.01  22/01/2009  Ebon Clements CAR 187852
.           Added semi colon to EMVIADMT tag
. V9.09.02  25/01/2007  Ebon Clements CAR 160167
.           Change date selection list to display 365 days DATES000
. V9.09.01  05/11/2007  Ebon Clements CAR 151800
.           Added tags for EMVIPRLO and EMVIPRTM
. V9.07.01  20/07/2006  Peter Vela    CAR 112999
.           Added validation for Active Location in LOCN0000
. V9.05.02  05/04/2006  Ebon Clements CAR 100159
.           Added multi hospital test to ward/bed selection lists
. V9.05.01  03/04/2006  Mike Laming   CAR 95806
.           Change EMVIREFD to use HCP Search (not Doctor Codes) at EMRA2000
. V9.04.02  20.07.2005 Ebon Clements CAR 57811
.           Added new tag for injury data available to set red buttons
. V9.04.01  24.09.2004 Ebon Clements CAR 53681
.           Added new tag for primary diagnosis description
. V9.03.06  13.02.2004 Peter Vela    CAR 38290
.           Commented out RESULT00 becuase it isn't getting used anywhere.
. V9.03.05  15.10.203  Ebon Clements CAR 44011
.           Fixed doctor selection list EMRA0700
. V9.03.04  27.08.2003 Jill Habasque CAR 42858
.           Copied 5.09 changes for EMRA1900
. V9.03.03  26.08.2003 Peter Vela    CAR 42825
.           Added spaces for blank option in DATES000
. V9.03.02  25.08.2003 Ebon Clements CAR 42813
.           Added .3 option to LOCN0000 tag to default the location selection
.           list according to the emergency site
. V9.03.01  21.08.2003 Jill Habasque
.           Added tag (EMRA8600), copied back from 5.09
. V9.02.04  20.03.2003 Peter Vela  CAR 37438 
.           Added tag (EMRA8500) for emrvisaf.emvisite (Patient's Emerg-
.           ency Site Code) for template emrweb0201105.html 	
. V9.02.03  26.05.2002 Bronko Sosic  
.           Removed striping of single quotes                              
. V9.02.02  20.12.2001 Bronko Sosic  
.           Removed defult for ward with userid defult                     
. V9.02.01  28.09.2001 Ebon Clements 
.           Corrected format of ward description in ward bed selection list
. V9.00.01  10.08.2001  kuldeep
.           Modified for Triage Nurse and Attending Nurse
.           and Doctor
.---------------------------------------------------------
.
.------------------------------------------------------------
. Add Field
.------------------------------------------------------------
EMRA0000  MOVE      ZERO,F2
          PACK      MTHNAM3,SP70
          BRANCH    FLDITMNO,EMRA0100,EMRA0200,EMRA0300,EMRA0400,EMRA0500:
                             EMRA0600,EMRA0700,EMRA0800,EMRA0900,EMRA1000:
                             EMRA1100,EMRA1200,EMRA1300,EMRA1400,EMRA1500:
                             EMRA1600,EMRA1700,EMRA1800,EMRA1900,EMRA2000:
                             EMRA2100,EMRA2200,EMRA2300,EMRA2400,EMRA2500:
                             EMRA2600,EMRA2700,EMRA2800,EMRA2900,EMRA3000:
                             EMRA3100,EMRA3200,EMRA3300,EMRA3400,EMRA3500:
                             EMRA3600,EMRA3700,EMRA3800,EMRA3900,EMRA4000:
                             EMRA4100,EMRA4200,EMRA4300,EMRA4400,EMRA4500: 
                             EMRA4600,EMRA4700,EMRA4800,EMRA4900,EMRA5000:
                             EMRA5100,EMRA5200,EMRA5300,EMRA5400,EMRA5500:
                             EMRA5600,EMRA5700,EMRA5800,EMRA5900,EMRA6000:
                             EMRA6100,EMRA6200,EMRA6300,EMRA6400,EMRA6500:
                             EMRA6600,EMRA6700,EMRA6800,EMRA6900,EMRA7000:
                             EMRA7100,EMRA7200,EMRA7300,EMRA7400,EMRA7500:
                             EMRA7600,EMRA7700,EMRA7800,EMRA7900,EMRA8000:
                             EMRA8100,EMRA8200,EMRA8300,EMRA8400,EMRA8500:
                             EMRA8600,EMRA8700,EMRA8800,EMRA8900,EMRA9000:
                             EMRA9100,EMRA9200,EMRA9300,EMRA9400,EMRA9500:
                             EMRA9600,EMRA9700,EMRA9800,EMRA9900
          GOTO      EMRA9999
.
EMRA0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA0110

          MATCH     SP70,EMVIDATE
          GOTO      EMRA9999 IF EQUAL
          UNPACK    EMVIDATE,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRA9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRA9999
.
EMRA0110  PACK      SELCDATE,EMVIDATE
          CALL      DATES000
          GOTO      EMRA9999
.
EMRA0200  MATCH     SP70,EMVITIME
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVITIME;
          GOTO      EMRA9999
.
EMRA0300  MOVE      "AA",CATEGORY
          MOVE      EMVITRIG,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA0400  MATCH     SP70,EMVICOM1
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVICOM1
          WRITE     HTMLFILE;EMVICOM1;
          GOTO      EMRA9999
.
EMRA0500  MATCH     SP70,EMVICOM2
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVICOM2
          WRITE     HTMLFILE;EMVICOM2;
          GOTO      EMRA9999
.
EMRA0600  CALL      LOCN0000
          GOTO      EMRA9999
.
EMRA0700  UNPACK    DIM127,D1,FLDITEM,DIM127
          MOVE      FLDITEM,FLDITMNO
.
          BRANCH    FLDITMNO,EMRA0710,EMRA0720 * 1=code,2=select,3=init
.
          MOVE      EMVIDOCT,KEY6             * description
          CALL      RDDOCT1
          BRANCH    OVRCD,EMRA9999

          COMPARE   "1",PTCNHDPS
          IF        @EQUAL
            READ      CONTROLF,EIGHTY9;*144,EMCNDOCT
            COMPARE   "0",EMCNDOCT
            IF        @EQUAL
              MOVE      DTITL,FMTTITLE
              MOVE      DGNAME,FMTGNAME
              MOVE      DSNAME,FMTSNAME
              STRIP     FMTTITLE
              STRIP     FMTGNAME
              STRIP     FMTSNAME
              CALL      DOCNM000
              WRITE     HTMLFILE;DOCFNAME; 
              GOTO      EMRA9999
            ENDIF
          ENDIF
.        
          STRIP     DTITL
          STRIP     DGNAME
          STRIP     DSNAME
          PACK      KEY60,DTITL,SP1,DGNAME,SP1,DSNAME  
          WRITE     HTMLFILE;KEY60;
.
          GOTO      EMRA9999
.
EMRA0710  MATCH     SP70,EMVIDOCT
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIDOCT; 
          GOTO      EMRA9999
.
EMRA0720  MOVE      SP70,KEY6
          CALL      RDSDOCT1
EMRA0725  CALL      RDKDOCT1
          BRANCH    OVRCD,EMRA9999
.
          MATCH     SP70,DCODE
          GOTO      EMRA0725 IF EQUAL
.
          COMPARE   "0",DRSTAT
          GOTO      EMRA0725 IF NOT EQUAL
.
          SQUEEZE   DTITL
          SQUEEZE   DGNAME
          SQUEEZE   DSNAME
          PACK      KEY60,DTITL,SP1,DGNAME,SP1,DSNAME  
.
          MATCH     EMVIDOCT,DCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",DCODE," selected>":
                               KEY60,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=",DCODE,">",KEY60,"</option>";
          ENDIF
          GOTO      EMRA0725
.
EMRA0800  MOVE      "CL",CATEGORY
          MOVE      EMVICOMP,CODE
          CALL      COMPTM00
          GOTO      EMRA9999
.
EMRA0900  MOVE      "A ",CATEGORY
          MOVE      EMVICLAS,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA1000  MOVE      "U1",CATEGORY
          MOVE      EMVIINSR,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA1100  MOVE      "S ",CATEGORY
          MOVE      EMVISRCE,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA1200  MOVE      "ES",CATEGORY
          MOVE      EMVISITN,CODE
          CALL      CODITM00
          GOTO      EMRA9999 
.
EMRA1300  MOVE      "EA",CATEGORY
          MOVE      EMVIMODE,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA1400  MATCH     SP70,EMVIEMPL
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIEMPL;
          GOTO      EMRA9999
.
EMRA1500  MOVE      "EW",CATEGORY
          MOVE      EMVIWAIT,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA1600  MOVE      "EP",CATEGORY
          MOVE      EMVIPREV,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA1700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA1710,EMRA1720            * 0=desc,1=code,2=select
.
          MOVE      SP70,HFNAME
          PACK      KEY14,EMVIFUND,SP70
          CALL      RDFUND1
          WRITE     HTMLFILE;HFNAME;
          GOTO      EMRA9999
.
EMRA1710  MATCH     SP70,EMVIFUND
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIFUND;
          GOTO      EMRA9999
.
EMRA1720  CALL      DFND0000
          GOTO      EMRA9999
.
EMRA1800  MATCH     SP70,EMVIFUND
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVITABL;
          GOTO      EMRA9999
.
EMRA1900  PACK      GENPCODE,EMVIREFG,SP70
          CALL      HCPDET00
          GOTO      EMRA9999
.
....EMRA2000  UNPACK    DIM127,D1,FLDITEM,DIM127
....          MOVE      FLDITEM,FLDITMNO
....          MATCH     SP70,EMVIREFD
....          GOTO      EMRA9850 IF EQUAL
....          MATCH     EMVIREFD,DOCTCODE
....          IF        !@EQUAL
....            MOVE       EMVIREFD,DOCTCODE
....            MOVE       EMVIREFD,KEY6
....            CALL       RDDOCT1
....            BRANCH     OVRCD,EMRA9999
....          ENDIF
....          CALL      DOCF0000
....          GOTO      EMRA9999
.
EMRA2000  PACK      GENPCODE,EMVIREFD,SP70
          CALL      HCPDET00                * hcp details
          GOTO      PMIX9999
.
EMRA2100  MOVE      "AP",CATEGORY
          MOVE      EMVIPLIN,CODE
          CALL      CODITM00
          GOTO      EMRA9999
. 
EMRA2200  MOVE      "AI",CATEGORY
          MOVE      EMVIINIT,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA2300  MOVE      "AR",CATEGORY
          MOVE      EMVIRTAS,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA2400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA2410
.
          MATCH     SP70,EMVIDDAT
          GOTO      EMRA9999 IF EQUAL
          UNPACK    EMVIDDAT,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRA9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRA9999
.
EMRA2410  PACK      SELCDATE,EMVIDDAT
          CALL      DATES000
          GOTO      EMRA9999
.
EMRA2500  MATCH     SP70,EMVIDTIM
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIDTIM;
          GOTO      EMRA9999
.
EMRA2600  MOVE      "ED",CATEGORY
          MOVE      EMVIDSTA,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA2700  MOVE      "AE",CATEGORY
          MOVE      EMVIELAP,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA2800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA2810
.
          MATCH     SP70,EMVINSDT
          GOTO      EMRA9999 IF EQUAL
          UNPACK    EMVINSDT,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRA9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRA9999
.
EMRA2810  PACK      SELCDATE,EMVINSDT
          CALL      DATES000
          GOTO      EMRA9999
.
EMRA2900  MATCH     SP70,EMVINSTM
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVINSTM;
          GOTO      EMRA9999
.
EMRA3000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA3010
.
          MATCH     SP70,EMVIDRDT
          GOTO      EMRA9999 IF EQUAL
          UNPACK    EMVIDRDT,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRA9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRA9999
.
EMRA3010  PACK      SELCDATE,EMVIDRDT
          CALL      DATES000
          GOTO      EMRA9999
.
EMRA3100  MATCH     SP70,EMVIDRTM
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIDRTM;
          GOTO      EMRA9999
.
EMRA3200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA3210,EMRA3220      * 0=description,1=code,2=select
.
          PACK      KEY5,EMVITSRC,SP70
          CALL      RDPTVAD1
          BRANCH    OVRCD,EMRA9999
.
          MATCH     SP70,PTVADESC
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;PTVADESC;
          GOTO      EMRA9999
.
EMRA3210  MATCH     SP70,EMVITSRC
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVITSRC;
          GOTO      EMRA9999
.
EMRA3220  MOVE      EMVITSRC,VCODE
          CALL      VADA0000
          GOTO      EMRA9999
.
EMRA3300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA3310,EMRA3320      * 0=description,1=code,2=select
.
          PACK      KEY5,EMVIDEST,SP70
          CALL      RDPTVAD1 
          BRANCH    OVRCD,EMRA9999
.
          MATCH     SP70,PTVADESC
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;PTVADESC;
          GOTO      EMRA9999
.
EMRA3310  MATCH     SP70,EMVIDEST
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIDEST;
          GOTO      EMRA9999
.
EMRA3320  MOVE      EMVIDEST,VCODE 
          CALL      VADA0000
          GOTO      EMRA9999
.
EMRA3400  MATCH     SP70,EMVIAMBL
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIAMBL;
          GOTO      EMRA9999
.
EMRA3500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA3510,EMRA3520      * 0=description,1=code,2=select
.
          PACK      KEY2,EMVIREGN,SP70
          CALL      RDEMGRC1
          BRANCH    OVRCD,EMRA9999
.
          MATCH     SP70,EMRCDESC
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMRCDESC;
          GOTO      EMRA9999
.
EMRA3510  MATCH     SP70,EMVIREGN
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIREGN;
          GOTO      EMRA9999
.
EMRA3520  CALL      REGN0000
          GOTO      EMRA9999
.
EMRA3600  MATCH     SP70,EMVITXT1
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVITXT1
          WRITE     HTMLFILE;EMVITXT1;
          GOTO      EMRA9999
.
EMRA3700  MATCH     SP70,EMVITXT2
          GOTO      EMRA9999 IF EQUAL 
          REP       "#"'",EMVITXT2
          WRITE     HTMLFILE;EMVITXT2;
          GOTO      EMRA9999
.
EMRA3800  MATCH     SP70,EMVITXT3
          GOTO      EMRA9999 IF EQUAL 
          REP       "#"'",EMVITXT3
          WRITE     HTMLFILE;EMVITXT3;
          GOTO      EMRA9999
.
EMRA3900  MATCH     SP70,EMVITXT4
          GOTO      EMRA9999 IF EQUAL 
          REP       "#"'",EMVITXT4
          WRITE     HTMLFILE;EMVITXT4;
          GOTO      EMRA9999
.
EMRA4000  MATCH     SP70,EMVITXT5
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVITXT5
          WRITE     HTMLFILE;EMVITXT5;
          GOTO      EMRA9999
.
EMRA4100  MATCH     SP70,EMUNDET1
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMUNDET1
          WRITE     HTMLFILE;EMUNDET1;
          GOTO      EMRA9999
.
EMRA4200  MATCH     SP70,EMUNDET2
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMUNDET2
          WRITE     HTMLFILE;EMUNDET2;
          GOTO      EMRA9999
.
EMRA4300  MATCH     SP70,EMUNSEX
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMUNSEX;
          GOTO      EMRA9999
.
EMRA4400  WRITE     HTMLFILE;EMUNAGE;
          GOTO      EMRA9999
.
EMRA4500  CALL      SELPRT00                * Printer Select Options
          GOTO      EMRA9999
.
EMRA4600  WRITE     HTMLFILE;EMVIADMN;     
          GOTO      EMRA9999
.
EMRA4700  WRITE     HTMLFILE;EMVISTAT;     
          GOTO      EMRA9999
.
EMRA4800  MATCH     SP70,EMVIPADM
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIPADM;
          GOTO      EMRA9999
.
EMRA4900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA4910,EMRA4920,EMRA4930
.
          PACK      KEY6,EMVIEWRD,SP70
          CALL      RDWARD1
          BRANCH    OVRCD,EMRA9999
.
          MATCH     SP70,WBDESC
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;WBDESC;
          GOTO      EMRA9999

EMRA4910  MATCH     SP70,EMVIEWRD
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIEWRD;
          GOTO      EMRA9999
.
EMRA4920  MATCH     SP70,EMVIEWRD
          IF        @EQUAL
..            MOVE      WBSEWRD,EMVIEWRD      * Default to ward against security
          ENDIF 
          CALL      WSEL0000
          GOTO      EMRA9999
.
EMRA4930  MATCH     SP70,EMVIEWRD
          IF        @EQUAL
              MOVE      WBSEWRD,EMVIEWRD      * Default to ward against security
          ENDIF
          CALL      WSEL0000
          GOTO      EMRA9999
.
EMRA5000  MATCH     SP70,EMVIEBED
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIEBED;
          GOTO      EMRA9999
.
EMRA5100  WRITE     HTMLFILE;EMVIURNO;
          GOTO      EMRA9999
.
EMRA5200  CALL      EDATES00
          GOTO      EMRA9999
.
.         proc code
EMRA5300  GOTO      EMRA9999
.
.         send in extract?
EMRA5400  GOTO      EMRA9999
.
.         diag code
EMRA5500  GOTO      EMRA9999
.
.         primary diag
EMRA5600  GOTO      EMRA9999
.
.         send in extract?
EMRA5700  GOTO      EMRA9999
.
EMRA5800  MATCH     SP70,EMVIHFMN
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIHFMN
          GOTO      EMRA9999
.
EMRA5900  MOVE      "P ",CATEGORY
          MOVE      EMVIACLS,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA6000  MOVE      "CC",CATEGORY
          MOVE      EMVICCLS,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA6100  MOVE      "A1",CATEGORY
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA6110,EMRA6120
.         *C-0825792 - START
          READ      CONTROLF,HUND22;*8,EMCNURSE
          MATCH     "1",EMCNURSE
          IF        @EQUAL
            PACK    KEY10,EMVITRNS,SP70
            CALL    RDPMHCP1
            BRANCH  OVRCD,EMRA9999
            STRIP   PMHCSNAM
            STRIP   PMHCGNAM
            PACK    KEY60,PMHCGNAM,SP1,PMHCSNAM
            WRITE   HTMLFILE;KEY60;
            GOTO    EMRA9999
          ENDIF
.         *C-0825792 - END
          PACK      KEY6,EMVITRNS,SP70 
          CALL      RDOPNUR1
          BRANCH    OVRCD,EMRA9999
          SQUEEZE   OPNRSNAM
          SQUEEZE   OPNRGNAM 
          PACK      KEY60,OPNRGNAM,SP1,OPNRSNAM
          WRITE     HTMLFILE;KEY60;
          GOTO      EMRA9999
.
EMRA6110  PACK      EMVITRNS,EMVITRNS,SP70
          MATCH     SP70,EMVITRNS
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVITRNS;
          GOTO      EMRA9999
.
EMRA6120  READ      CONTROLF,HUND22;*8,EMCNURSE          *C-0825792 - START
          MATCH     "1",EMCNURSE
          IF        @EQUAL
            CALL      SHCPNU00
          ELSE
            CALL      SELNUR00
          ENDIF
.         *C-0825792 - END
          GOTO      EMRA9999            * Triage Nurse
.
EMRA6200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA6210
.
          UNPACK    EMVITRDT,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRA9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRA9999
.
EMRA6210  PACK      SELCDATE,EMVITRDT
          CALL      DATES000
          GOTO      EMRA9999
.
EMRA6300  MATCH     SP70,EMVITRTM
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVITRTM;
          GOTO      EMRA9999            * Triage Time
.
EMRA6400  MOVE      "A1",CATEGORY
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA6410
.         *C-0825792 - START
          READ      CONTROLF,HUND22;*8,EMCNURSE
          MATCH     "1",EMCNURSE
          IF        @EQUAL
            PACK    KEY10,EMVIATNS,SP70
            CALL    RDPMHCP1
            BRANCH  OVRCD,EMRA9999
            STRIP   PMHCSNAM
            STRIP   PMHCGNAM
            PACK    KEY60,PMHCGNAM,SP1,PMHCSNAM
            WRITE   HTMLFILE;KEY60;
            GOTO    EMRA9999
          ENDIF
.         *C-0825792 - END
          PACK      KEY6,EMVIATNS,SP70
          CALL      RDOPNUR1
          BRANCH    OVRCD,EMRA9999
          STRIP     OPNRSNAM
          STRIP     OPNRGNAM 
          PACK      KEY60,OPNRGNAM,SP1,OPNRSNAM
          WRITE     HTMLFILE;KEY60;
          GOTO      EMRA9999
.
EMRA6410  PACK      EMVIATNS,EMVIATNS,SP70
          MATCH     SP70,EMVIATNS
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIATNS;
          GOTO      EMRA9999            * Attending Nurse
.
EMRA6500  MATCH     SP70,EMVIEXLC
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIEXLC;
          GOTO      EMRA9999            * External Location
.
EMRA6600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA6610,EMRA6620    *0=desc,1=code,2=selection list
.
          PACK      KEY3,WBSEESC,SP70       * description
          CALL      RDEMSIT1
          IF        OVRCD=1
            MOVE      SP70,EMSTDESC
          ENDIF
.
          MATCH     SP70,EMSTDESC
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMSTDESC;
          GOTO      EMRA9999
.
EMRA6610  MATCH     SP70,WBSEESC
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;WBSEESC;       * code
          GOTO      EMRA9999
.
EMRA6620  PACK      KEY3,SP70                * selection list
          CALL      RSEMSIT1
EMRA6630  CALL      RKEMSIT1
          BRANCH    OVRCD,EMRA9999
          MATCH     SP70,EMSTSCOD
          GOTO      EMRA6630 IF EQUAL
          PACK      KEY5,QUOTE,EMSTSCOD,QUOTE
          MATCH     WBSEESC,EMSTSCOD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMSTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",EMSTDESC,"</option>"
          ENDIF
          GOTO      EMRA6630
.
EMRA6700  OPEN      EMRHISA1,"emrhisaf"
          PACK      KEY22,DEMVIADM,Z70
          CALL      RSEMHIS1
          CALL      RPEMHIS1
          IF        OVRCD=1
            PACK      UPDATEKY,DEMVIADM,SP70
            GOTO      EMRA6750
          ENDIF
.
          MATCH     DEMVIADM,EMHIVIS
          IF        !@EQUAL
            PACK      UPDATEKY,DEMVIADM,SP70
            GOTO      EMRA6750
          ENDIF
.
          REP       " 0",EMHIDAT
          REP       " 0",EMHITIM
          PACK      UPDATEKY,EMHIVIS,EMHIDAT,EMHITIM
.
EMRA6750  WRITE     HTMLFILE;UPDATEKY;
          GOTO      EMRA9999
.
EMRA6800  * CALL      RESULT00          * D CAR 38290
          GOTO      EMRA9999
.
EMRA6900  CALL      LABEL000
          GOTO      EMRA9999
.
EMRA7000  CALL      SCODL000
          GOTO      EMRA9999
.
EMRA7100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA7110
.
          WRITE     HTMLFILE;EMVIADMT;
          GOTO      EMRA9999
.
EMRA7110  COMPARE   ONE,EMVIADMT
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      EMRA9999
.
EMRA7200  MOVE      EMVIDOCT,DOCTCODE
          CALL      DOCDET00                * Doctor (reads normal doctor file)
          GOTO      EMRA9999
.
EMRA7300  MOVE      "AC",CATEGORY
          MOVE      EMVIUNIT,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA7400  MATCH     SP70,EMVICOM3
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVICOM3
          WRITE     HTMLFILE;EMVICOM3;
          GOTO      EMRA9999
.
EMRA7500  MATCH     SP70,EMVICOM4
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVICOM4
          WRITE     HTMLFILE;EMVICOM4;
          GOTO      EMRA9999
.
EMRA7600  MATCH     SP70,EMVICOM5
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVICOM5
          WRITE     HTMLFILE;EMVICOM5;
          GOTO      EMRA9999
.
EMRA7700  MATCH     SP70,EMVICOM6
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVICOM6
          WRITE     HTMLFILE;EMVICOM6;
          GOTO      EMRA9999
.
EMRA7800  MATCH     SP70,EMVIINJ1
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVIINJ1
          WRITE     HTMLFILE;EMVIINJ1;
          GOTO      EMRA9999
.
EMRA7900  MATCH     SP70,EMVIINJ2
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVIINJ2
          WRITE     HTMLFILE;EMVIINJ2;
          GOTO      EMRA9999
.
EMRA8000  MOVE      "ex",CATEGORY
          MOVE      EMVINATI,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA8100  MOVE      "ey",CATEGORY
          MOVE      EMVIINJC,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA8200  MOVE      "ez",CATEGORY
          MOVE      EMVIHUMI,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA8300  MOVE      "EY",CATEGORY
          MOVE      EMVIACTI,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA8400  MATCH     SP70,EMVILOCO
          GOTO      EMRA9999 IF EQUAL
          REP       "#"'",EMVILOCO
          WRITE     HTMLFILE;EMVILOCO;
          GOTO      EMRA9999
.
EMRA8500  UNPACK    DIM127,D1,KEY1,DIM127    * I CAR 37438
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA8510,EMRA8520    *0=desc,1=code,2=selection list
.
          PACK      KEY3,EMVISITE,SP70       * description
          CALL      RDEMSIT1
          IF        OVRCD=1
            MOVE      SP70,EMSTDESC
          ENDIF
.
          MATCH     SP70,EMSTDESC
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMSTDESC;
          GOTO      EMRA9999
.
EMRA8510  MATCH     SP70,EMVISITE
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVISITE;       * code
          GOTO      EMRA9999
.
EMRA8520  PACK      KEY3,SP70                * selection list
          CALL      RSEMSIT1
EMRA8530  CALL      RKEMSIT1
          BRANCH    OVRCD,EMRA9999
          MATCH     SP70,EMSTSCOD
          GOTO      EMRA8530 IF EQUAL
          PACK      KEY5,QUOTE,EMSTSCOD,QUOTE
          MATCH     EMVISITE,EMSTSCOD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMSTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",EMSTDESC,"</option>"
          ENDIF
          GOTO      EMRA8530
.                                                 * end I CAR 37438     
EMRA8600  UNPACK    DIM127,D1,FLDITEM,DIM127
          MOVE      FLDITEM,FLDITMNO
.
          BRANCH    FLDITMNO,EMRA8610,EMRA8620 * 1=code,2=select,3=init
.
          MOVE      EMVIDOCT,KEY10            * description
          CALL      RDEMDO1
          BRANCH    OVRCD,EMRA9999
          WRITE     HTMLFILE;EMDODNM;
          GOTO      EMRA9999
.
EMRA8610  MATCH     SP70,EMVIDOCT
          GOTO      EMRA9999 IF EQUAL
          WRITE     HTMLFILE;EMVIDOCT;
          GOTO      EMRA9999
.
EMRA8620  MOVE      SP70,KEY10
          CALL      RSEMDO1
EMRA8625  CALL      RKEMDO1
          BRANCH    OVRCD,EMRA9999
.
          MATCH     SP70,EMDODOC
          GOTO      EMRA8625 IF EQUAL
.
          MATCH     "0",EMDOACT
          GOTO      EMRA8625 IF EQUAL
.
          MATCH     EMVIDOCT,EMDODOC
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",EMDODOC," selected>":
                               EMDODNM,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=",EMDODOC,">",EMDODNM,"</option>";
          ENDIF
          GOTO      EMRA8625
.
EMRA8700  PACK      KEY14,EMVIADMN,ZERO,ZERO,FIVE,SP70
          CALL      RSEMVCD1
EMRA8710  CALL      RKEMVCD1
          BRANCH    OVRCD,EMRA9999
.
          MATCH     DEMVIADM,EMVCVIST
          GOTO      EMRA9999 IF NOT EQUAL
.
          MATCH     "005",EMVCTYPE          * Emergency diagnosis ?
          GOTO      EMRA9999 IF NOT EQUAL
.
          MATCH     "000",EMVCSEQU          * Primary diagnosis
          GOTO      EMRA8710 IF NOT EQUAL
.
          MOVE      EMVCMNCD,KEY9
          CALL      RDEMICD1
          BRANCH    OVRCD,EMRA9999
.
          WRITE     HTMLFILE;EMICDESC;
          GOTO      EMRA9999
.
EMRA8800  MATCH     SP70,EMVIPLIN
          GOTO      EMRA8810 IF NOT EQUAL
.
          MATCH     SP70,EMVIACTI
          GOTO      EMRA8810 IF NOT EQUAL
.
          MATCH     SP70,EMVIINJC
          GOTO      EMRA8810 IF NOT EQUAL
.
          MATCH     SP70,EMVIHUMI
          GOTO      EMRA8810 IF NOT EQUAL
.
          MATCH     SP70,EMVIINJ1
          GOTO      EMRA8810 IF NOT EQUAL
.
          MATCH     SP70,EMVIINJ2
          GOTO      EMRA8810 IF NOT EQUAL
.
          WRITE     HTMLFILE;ZERO;          * No injury data available
          GOTO      EMRA9999
.
EMRA8810  WRITE     HTMLFILE;ONE;           * Injury data available
          GOTO      EMRA9999
.
EMRA8900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRA8910
.
          PACK      KEY3,EMVIPRLO,SP70
          CALL      RDEMLOC1
          BRANCH    OVRCD,EMRA9999
.
          WRITE     HTMLFILE;EMLODESC;      * Previous location
          GOTO      EMRA9999
.
EMRA8910  WRITE     HTMLFILE;EMVIPRLO; 
          GOTO      EMRA9999
.
EMRA9000  WRITE     HTMLFILE;EMVIPRTM;      * Time Left Previous Location
          GOTO      EMRA9999
.
EMRA9100  MATCH     EMVIDPDT,SP70           * Departure Date
          GOTO      EMRA9999 IF EQUAL
.
          UNPACK    EMVIDPDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRA9999
.
EMRA9200  WRITE     HTMLFILE;EMVIDPTM;      * Departure Time
          GOTO      EMRA9999
.
EMRA9300  MOVE      "RX",CATEGORY           * Extended Visit Reason
          MOVE      EMVIEXRS,CODE
          CALL      CODITM00   
          GOTO      EMRA9999
.
EMRA9400  MOVE      "RY",CATEGORY           * Departure Delay Reason
          MOVE      EMVIDLRS,CODE
          CALL      CODITM00
          GOTO      EMRA9999
.
EMRA9500  PACK      KEY14,EMVIADMN,ZERO,ZERO,FIVE,SP70
          CALL      RSEMVCD1
EMRA9510  CALL      RKEMVCD1
          BRANCH    OVRCD,EMRA9999
.
          MATCH     DEMVIADM,EMVCVIST
          GOTO      EMRA9999 IF NOT EQUAL
.
          MATCH     "005",EMVCTYPE          * Emergency diagnosis ?
          GOTO      EMRA9999 IF NOT EQUAL
.
          MATCH     "000",EMVCSEQU          * Primary diagnosis
          GOTO      EMRA9510 IF NOT EQUAL
.
          WRITE     HTMLFILE;EMVCFTXT;
          GOTO      EMRA9999
.
EMRA9600  PACK      KEY14,EMVIADMN,ZERO,ZERO,FIVE,SP70
          CALL      RSEMVCD1
EMRA9610  CALL      RKEMVCD1
          BRANCH    OVRCD,EMRA9999
.         
          MATCH     DEMVIADM,EMVCVIST
          GOTO      EMRA9999 IF NOT EQUAL
.
          MATCH     "005",EMVCTYPE          * Emergency diagnosis ?
          GOTO      EMRA9999 IF NOT EQUAL
.
          MATCH     "000",EMVCSEQU          * Primary diagnosis
          GOTO      EMRA9610 IF NOT EQUAL
.         
          WRITE     HTMLFILE;EMVCMNCD;
          GOTO      EMRA9999
.
EMRA9700  PACK      KEY14,EMVIADMN,ZERO,ZERO,FIVE,SP70
          CALL      RSEMVCD1
EMRA9710  CALL      RKEMVCD1
          BRANCH    OVRCD,EMRA9999
.         
          MATCH     DEMVIADM,EMVCVIST
          GOTO      EMRA9999 IF NOT EQUAL
.         
          MATCH     "005",EMVCTYPE          * Emergency diagnosis ?
          GOTO      EMRA9999 IF NOT EQUAL
.         
          MATCH     "000",EMVCSEQU          * Primary diagnosis
          GOTO      EMRA9710 IF NOT EQUAL
.         
          WRITE     HTMLFILE;EMVCUNIQ;
          GOTO      EMRA9999
.
EMRA9800  PACK      KEY14,EMVIADMN,ZERO,ZERO,FIVE,SP70
          CALL      RSEMVCD1
EMRA9810  CALL      RKEMVCD1
          BRANCH    OVRCD,EMRA9999
.
          MATCH     DEMVIADM,EMVCVIST
          GOTO      EMRA9999 IF NOT EQUAL
.
          MATCH     "005",EMVCTYPE          * Emergency diagnosis ?
          GOTO      EMRA9999 IF NOT EQUAL
.
          MATCH     "000",EMVCSEQU          * Skip Primary diagnosis
          GOTO      EMRA9810 IF EQUAL
.
          MOVE      EMVCMNCD,KEY9           * First additional diagnosis
          CALL      RDEMICD1
          BRANCH    OVRCD,EMRA9999
.
          WRITE     HTMLFILE;EMICDESC;
          GOTO      EMRA9999
.
EMRA9850  MOVE      FLDITEM,F3    * Check for Link to Doctor Template Page
          IF        F3=1    
            UNPACK    DIM127,D1,FLDPARA,DIM127    * Remove Parameter
          ENDIF
.
EMRA9900  UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,FLDITMNO
          CALL      EMRX0000
          GOTO      EMRA9999
.
EMRA9999  RETURN
.
.------------------------------------------------------------
. Emergency extra tags %EMRWEBXX.XX.X99.AAA
.------------------------------------------------------------
EMRX0000  BRANCH    FLDITMNO,EMRX0100,EMRX0200,EMRX0300,EMRX0400,EMRX0500:
                             EMRX0600,EMRX0700,EMRX0800
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      EMRX9999
.
EMRX0100  PACK      KEY14,EMVIADMN,ZERO,ZERO,FIVE,SP70
          CALL      RSEMVCD1
EMRX0110  CALL      RKEMVCD1
          BRANCH    OVRCD,EMRX9999
.
          MATCH     DEMVIADM,EMVCVIST
          GOTO      EMRX9999 IF NOT EQUAL
.
          MATCH     "005",EMVCTYPE          * Emergency diagnosis ?
          GOTO      EMRX9999 IF NOT EQUAL
.
          MATCH     "000",EMVCSEQU          * Skip Primary diagnosis
          GOTO      EMRX0110 IF EQUAL
.
          WRITE     HTMLFILE;EMVCMNCD;      * First additional diagnosis
          GOTO      EMRX9999
.
EMRX0200  PACK      KEY14,EMVIADMN,ZERO,ZERO,FIVE,SP70
          CALL      RSEMVCD1
EMRX0210  CALL      RKEMVCD1
          BRANCH    OVRCD,EMRX9999
.
          MATCH     DEMVIADM,EMVCVIST
          GOTO      EMRX9999 IF NOT EQUAL
.
          MATCH     "005",EMVCTYPE          * Emergency diagnosis ?
          GOTO      EMRX9999 IF NOT EQUAL
.
          MATCH     "000",EMVCSEQU          * Skip Primary diagnosis
          GOTO      EMRX0210 IF EQUAL
.
          WRITE     HTMLFILE;EMVCFTXT;      * First additional diagnosis
          GOTO      EMRX9999
.
EMRX0300  PACK      KEY14,EMVIADMN,ZERO,ZERO,FIVE,SP70
          CALL      RSEMVCD1
EMRX0310  CALL      RKEMVCD1
          BRANCH    OVRCD,EMRX9999
.
          MATCH     DEMVIADM,EMVCVIST
          GOTO      EMRX9999 IF NOT EQUAL
.
          MATCH     "005",EMVCTYPE          * Emergency diagnosis ?
          GOTO      EMRX9999 IF NOT EQUAL
.
          MATCH     "000",EMVCSEQU          * Skip Primary diagnosis
          GOTO      EMRX0310 IF EQUAL
.
          WRITE     HTMLFILE;EMVCUNIQ;      * First additional diagnosis
          GOTO      EMRX9999
.
EMRX0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRX0410
.
          PACK      KEY10,EMVIAHCP,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,EMRX9999
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      EMRX9999
.
EMRX0410  WRITE     HTMLFILE;EMVIAHCP;
          GOTO      EMRX9999
.
EMRX0500  WRITE     HTMLFILE;EMVIAHST;
          GOTO      EMRX9999
.
EMRX0600  MOVE      "dd",CATEGORY
          MOVE      EMVIDISD,CODE
          CALL      CODITM00
          GOTO      EMRX9999
.
EMRX0700  WRITE     HTMLFILE;EMVIDRUG;
          GOTO      EMRX9999
.
EMRX0800  CALL      DOCSEE00
          GOTO      EMRX9999
.
EMRX9999  RETURN
.
.----------------------------------------------------------------------
. Get doctor seen date tag
. Requires: The emr visit record read
.           Parameter EMCNPBSD to be read
.           " " or "0" = Treating Doctor
.           "1" = Treating Doctor & Initial Assessor
.           "2" = Treating Doctor & Other Doctor
.           "3" = Treating Doctor ,Initial Assessor & Other Doctor
.           The emr visit record read
. Return: Tag with SEENDTIM = date and time DD MTH CCYY HH:MM:SS
.
. Note: at 28/05/2021.
. sjog uses EMVIUD10/EMVIUT10 for senior/other date/time but wahealth
. uses EMVIUD09/EMVIUT09 for senior/other date/time. If PTCNNSSI is not  
. Blank indicates that it is sjog site.            
.----------------------------------------------------------------------
DOCSEE00  MOVE      SP70,SEENDTIM
          MOVE      SP70,TESTDTIM
.
          MATCH     SP70,PTCNNSSI        * no edward source sys/sjog
          IF        @EQUAL
            MOVE      EMVIUD09,TESTDATE  * wahealth uses EMVIUD09 uses
            MOVE      EMVIUT09,TESTTIME  * for senior/other doctor
          ELSE
            MATCH     "00000000000000000000",PTCNNSSI    
            IF        @EQUAL
              MOVE      EMVIUD09,TESTDATE  * wahealth uses EMVIUD09 uses
              MOVE      EMVIUT09,TESTTIME  * for senior/other doctor
            ELSE
              MOVE      EMVIUD10,TESTDATE  * sjog uses EMVIUD10 uses   
              MOVE      EMVIUT10,TESTTIME  * for senior/other doctor
            ENDIF
          ENDIF
.
.  Treating Doctor
.
          PACK      SEENDTIM,EMVIDRDT,EMVIDRTM,SP70   * Treating date/time
.
          MOVE      ZERO,F1
          MOVE      EMCNPBSD,F1
          BRANCH    F1,DOCSEE20,DOCSEE30,DOCSEE40
.
          GOTO      DOCSEE80
.
. Treating Doctor & Initial Assessor
.
DOCSEE20  MATCH     SP70,EMVIMDDT           * Exit initial assessor date blank
          GOTO      DOCSEE80 IF EQUAL
.
          MATCH     SP70,EMVIMDTM           * Exit initial assessor time blank
          GOTO      DOCSEE80 IF EQUAL
.
          MATCH     SP70,SEENDTIM
          IF        !@EQUAL
            PACK      TESTDTIM,EMVIMDDT,EMVIMDTM,SP70   * Accessor date/time
.
            MATCH     SEENDTIM,TESTDTIM
            GOTO      DOCSEE80 IF NOT LESS
          ENDIF
.
          PACK      SEENDTIM,EMVIMDDT,EMVIMDTM,SP70   * Use assessor date/time
          GOTO      DOCSEE80
.
. Treating Doctor & Other Doctor
.
DOCSEE30  MATCH     SP70,TESTDATE           * Exit other doctor date blank
          GOTO      DOCSEE80 IF EQUAL
.
          MATCH     SP70,TESTTIME           * Exit other doctor time blank
          GOTO      DOCSEE80 IF EQUAL
.
          MATCH     SP70,SEENDTIM
          IF        !@EQUAL
            PACK      TESTDTIM,TESTDATE,TESTTIME,SP70   * Other date/time
.
            MATCH     SEENDTIM,TESTDTIM
            GOTO      DOCSEE80 IF NOT LESS
          ENDIF
.
          PACK      SEENDTIM,TESTDATE,TESTTIME,SP70     * Use Other date/time
          GOTO      DOCSEE80
.
. Treating Doctor, Initial Assessor & Other Doctor
.
DOCSEE40  MATCH     SP70,EMVIMDDT           * Exit initial assessor date blank
          GOTO      DOCSEE45 IF EQUAL
.
          MATCH     SP70,EMVIMDTM           * Exit initial assessor time blank
          GOTO      DOCSEE45 IF EQUAL
.
          MATCH     SP70,SEENDTIM
          IF        !@EQUAL
            PACK      TESTDTIM,EMVIMDDT,EMVIMDTM,SP70   * Assessor date/time
.
            MATCH     SEENDTIM,TESTDTIM
            GOTO      DOCSEE45 IF NOT LESS
          ENDIF
.
          PACK      SEENDTIM,EMVIMDDT,EMVIMDTM,SP70   * Use assessor date/time
.
DOCSEE45  MATCH     SP70,TESTDATE           * Exit other doctor date blank
          GOTO      DOCSEE80 IF EQUAL
.
          MATCH     SP70,TESTTIME           * Exit other doctor time blank
          GOTO      DOCSEE80 IF EQUAL
.
          MATCH     SP70,SEENDTIM
          IF        !@EQUAL
            PACK      TESTDTIM,TESTDATE,TESTTIME,SP70   * Other date/time
.
            MATCH     SEENDTIM,TESTDTIM
            GOTO      DOCSEE80 IF NOT LESS
          ENDIF
.
          PACK      SEENDTIM,TESTDATE,TESTTIME,SP70     * Use Other date/time
.
.
DOCSEE80  MATCH     SP70,SEENDTIM
          GOTO      DOCSEE99 IF EQUAL
.
          UNPACK    SEENDTIM,CCENT,CYEAR,CMON,CDAY,DIM8
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,DIM8;
.
.
DOCSEE99  RETURN 
.
.------------------------------------------------------------
. Calculate different option dates for bed transfer date.
.------------------------------------------------------------
EDATES00  MOVE      ZERO,COUNTER
          CALL      IBACLOCK
          PACK      TODAY,CCC,CYY,CMM,CDD
          REP       " 0",TODAY
.
          UNPACK    EMVIDATE,CCENT,CYEAR,CMON,CDAY
.
EDATES10  ADD       ONE,COUNTER
          IF        COUNTER>20
            GOTO      EDATES99
          ENDIF
.
          PACK      KEY8,CCENT,CYEAR,CMON,CDAY
          REP       " 0",KEY8
          MATCH     TODAY,KEY8
          GOTO      EDATES20 IF EQUAL
.
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;"<option value=#"",KEY8,"#">",CDAY,SP1:
                               MTHNAM3,SP1,CCENT,CYEAR,"</option>";
          MOVE      "1",ADJDAYS
          CALL      ADJDAT00
          GOTO      EDATES10
.
EDATES20  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;"<option value=#"",KEY8,"#" selected>",CDAY,SP1:
                               MTHNAM3,SP1,CCENT,CYEAR,"</option>";
.
EDATES99  RETURN
.------------------------------------------------------------
. User Defined Codes of EMR Visit
.------------------------------------------------------------
EMRB0000  BRANCH    FLDITMNO,EMRB0100,EMRB0200,EMRB0300,EMRB0400,EMRB0500:
                             EMRB0600,EMRB0700,EMRB0800,EMRB0900,EMRB1000:
                             EMRB1100,EMRB1200,EMRB1300,EMRB1400,EMRB1500:
                             EMRB1600,EMRB1700,EMRB1800,EMRB1900,EMRB2000:
                             EMRB2100,EMRB2200,EMRB2300,EMRB2400,EMRB2500:
                             EMRB2600,EMRB2700,EMRB2800,EMRB2900,EMRB3000:
                             EMRB3100,EMRB3200,EMRB3300,EMRB3400,EMRB3500:
                             EMRB3600,EMRB3700,EMRB3800,EMRB3900,EMRB4000:
                             EMRB4100,EMRB4200,EMRB4300,EMRB4400,EMRB4500:
                             EMRB4600,EMRB4700,EMRB4800,EMRB4900,EMRB5000:
                             EMRB5100,EMRB5200,EMRB5300,EMRB5400,EMRB5500:
                             EMRB5600,EMRB5700,EMRB5800,EMRB5900,EMRB6000:
                             EMRB6100,EMRB6200,EMRB6300,EMRB6400,EMRB6500:
                             EMRB6600,EMRB6700,EMRB6800,EMRB6900,EMRB7000:
                             EMRB7100,EMRB7200,EMRB7300,EMRB7400,EMRB7500:
                             EMRB7600,EMRB7700,EMRB7800,EMRB7900,EMRB8000:
                             EMRB8100,EMRB8200,EMRB8300,EMRB8400,EMRB8500:
                             EMRB8600,EMRB8700,EMRB8800,EMRB8900,EMRB9000:
                             EMRB9100,EMRB9200,EMRB9300,EMRB9400,EMRB9500:
                             EMRB9600,EMRB9700
          GOTO      EMRB9999
.
EMRB0100  MOVE      "A1",CATEGORY
          MOVE      EMVIUC01,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB0200  MOVE      "A2",CATEGORY
          MOVE      EMVIUC02,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB0300  MOVE      "A3",CATEGORY
          MOVE      EMVIUC03,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB0400  MOVE      "A4",CATEGORY
          MOVE      EMVIUC04,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB0500  MOVE      "A5",CATEGORY
          MOVE      EMVIUC05,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB0600  MOVE      "A6",CATEGORY
          MOVE      EMVIUC06,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB0700  MOVE      "A7",CATEGORY
          MOVE      EMVIUC07,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB0800  MOVE      "A8",CATEGORY
          MOVE      EMVIUC08,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB0900  MOVE      "ea",CATEGORY
          MOVE      EMVIUC09,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB1000  MOVE      "eb",CATEGORY
          MOVE      EMVIUC10,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB1100  MOVE      "ec",CATEGORY
          MOVE      EMVIUC11,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB1200  MOVE      "ed",CATEGORY
          MOVE      EMVIUC12,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB1300  MOVE      "ee",CATEGORY
          MOVE      EMVIUC13,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB1400  MOVE      "ef",CATEGORY
          MOVE      EMVIUC14,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB1500  MOVE      "eg",CATEGORY
          MOVE      EMVIUC15,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB1600  MOVE      "eh",CATEGORY
          MOVE      EMVIUC16,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB1700  MOVE      "ei",CATEGORY
          MOVE      EMVIUC17,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB1800  MOVE      "ej",CATEGORY
          MOVE      EMVIUC18,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB1900  MOVE      "ek",CATEGORY
          MOVE      EMVIUC19,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB2000  MOVE      "el",CATEGORY
          MOVE      EMVIUC20,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB2100  MOVE      "em",CATEGORY
          MOVE      EMVIUC21,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB2200  MOVE      "en",CATEGORY
          MOVE      EMVIUC22,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB2300  MOVE      "eo",CATEGORY
          MOVE      EMVIUC23,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB2400  MOVE      "ep",CATEGORY
          MOVE      EMVIUC24,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB2500  MOVE      "eq",CATEGORY
          MOVE      EMVIUC25,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB2600  MOVE      "er",CATEGORY
          MOVE      EMVIUC26,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB2700  MOVE      "es",CATEGORY
          MOVE      EMVIUC27,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB2800  MOVE      "et",CATEGORY
          MOVE      EMVIUC28,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB2900  MOVE      "eu",CATEGORY
          MOVE      EMVIUC29,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB3000  MOVE      "ev",CATEGORY
          MOVE      EMVIUC30,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB3100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB3110,EMRB3120
. 
          MATCH     SP70,EMVIUD01
          GOTO      EMRB9999 IF EQUAL
          UNPACK    EMVIUD01,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRB9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB3110  PACK      SELCDATE,EMVIUD01
          CALL      DATES000
          GOTO      EMRB9999
.
EMRB3120  PACK      SELCDATE,EMVIUD01
          CALL      DATED000
          GOTO      EMRB9999
.
EMRB3200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB3210
.
          MATCH     SP70,EMVIUD02
          GOTO      EMRB9999 IF EQUAL
          UNPACK    EMVIUD02,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRB9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB3210  PACK      SELCDATE,EMVIUD02
          CALL      DATES000
          GOTO      EMRB9999
.
EMRB3300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB3310,EMRB3320
.
          MATCH     SP70,EMVIUD03
          GOTO      EMRB9999 IF EQUAL
          UNPACK    EMVIUD03,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRB9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB3310  PACK      SELCDATE,EMVIUD03
          CALL      DATES000
          GOTO      EMRB9999
.
EMRB3320  PACK      SELCDATE,EMVIUD03
          CALL      DATED000
          GOTO      EMRB9999
.
EMRB3400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB3410,EMRB3420
.
          MATCH     SP70,EMVIUD04
          GOTO      EMRB9999 IF EQUAL
          UNPACK    EMVIUD04,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRB9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB3410  PACK      SELCDATE,EMVIUD04
          CALL      DATES000
          GOTO      EMRB9999
.
EMRB3420  PACK      SELCDATE,EMVIUD04
          CALL      DATED000
          GOTO      EMRB9999
.
EMRB3500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB3510
.
          MATCH     SP70,EMVIUD05
          GOTO      EMRB9999 IF EQUAL
          UNPACK    EMVIUD05,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRB9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB3510  PACK      SELCDATE,EMVIUD05
          CALL      DATES000
          GOTO      EMRB9999
.
EMRB3600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB3610
.
          MATCH     SP70,EMVIUD06
          GOTO      EMRB9999 IF EQUAL
          UNPACK    EMVIUD06,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRB9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB3610  PACK      SELCDATE,EMVIUD06
          CALL      DATES000
          GOTO      EMRB9999
.
EMRB3700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB3710
.
          MATCH     SP70,EMVIUD07
          GOTO      EMRB9999 IF EQUAL
          UNPACK    EMVIUD07,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRB9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB3710  PACK      SELCDATE,EMVIUD07
          CALL      DATES000
          GOTO      EMRB9999
.
EMRB3800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB3810
.
          MATCH     SP70,EMVIUD08
          GOTO      EMRB9999 IF EQUAL
          UNPACK    EMVIUD08,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRB9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB3810  PACK      SELCDATE,EMVIUD08
          CALL      DATES000
          GOTO      EMRB9999
.
EMRB3900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB3910
.
          MATCH     SP70,EMVIUD09
          GOTO      EMRB9999 IF EQUAL
          UNPACK    EMVIUD09,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRB9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB3910  PACK      SELCDATE,EMVIUD09
          CALL      DATES000
          GOTO      EMRB9999                                
.
EMRB4000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB4010
.
          MATCH     SP70,EMVIUD10
          GOTO      EMRB9999 IF EQUAL
          UNPACK    EMVIUD10,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CMON
          GOTO      EMRA9999 IF EQUAL
          MATCH     "00",CDAY
          GOTO      EMRB9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB4010  PACK      SELCDATE,EMVIUD10
          CALL      DATES000
          GOTO      EMRB9999                                
.
EMRB4100  MATCH     SP70,EMVIUT01
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIUT01;
          GOTO      EMRB9999
.
EMRB4200  MATCH     SP70,EMVIUT02
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIUT02;
          GOTO      EMRB9999
.
EMRB4300  MATCH     SP70,EMVIUT03
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIUT03;
          GOTO      EMRB9999
.
EMRB4400  MATCH     SP70,EMVIUT04
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIUT04;
          GOTO      EMRB9999
.
EMRB4500  MATCH     SP70,EMVIUT05
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIUT05;
          GOTO      EMRB9999
.
EMRB4600  MATCH     SP70,EMVIUT06
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIUT06;
          GOTO      EMRB9999
.
EMRB4700  MATCH     SP70,EMVIUT07
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIUT07;
          GOTO      EMRB9999
.
EMRB4800  MATCH     SP70,EMVIUT08
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIUT08;
          GOTO      EMRB9999
.
EMRB4900  MATCH     SP70,EMVIUT09
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIUT09;
          GOTO      EMRB9999
.
EMRB5000  MATCH     SP70,EMVIUT10
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIUT10;
          GOTO      EMRB9999
.
EMRB5100  MOVE      "No ",YESNO
          IF        EMVIYN01=1
            MOVE      "Yes",YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      EMRB9999
.
EMRB5200  MOVE      "No ",YESNO
          IF        EMVIYN02=1
            MOVE      "Yes",YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      EMRB9999
.
EMRB5300  MOVE      "No ",YESNO
          IF        EMVIYN03=1
            MOVE      "Yes",YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      EMRB9999
.
EMRB5400  MOVE      "No ",YESNO
          IF        EMVIYN04=1
            MOVE      "Yes",YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      EMRB9999
.
EMRB5500  MOVE      "No ",YESNO
          IF        EMVIYN05=1
            MOVE      "Yes",YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      EMRB9999
.
EMRB5600  IF        EMVIYN06=0
            WRITE     HTMLFILE;"No";
            GOTO      EMRB9999
          ENDIF
          IF        EMVIYN06=1
            WRITE     HTMLFILE;"Yes";
            GOTO      EMRB9999
          ENDIF
          IF        EMVIYN06=2
            WRITE     HTMLFILE;"Unknown";
            GOTO      EMRB9999
          ENDIF
.
EMRB5700  MOVE      "No ",YESNO
          IF        EMVIYN07=1
            MOVE      "Yes",YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      EMRB9999
.
EMRB5800  MOVE      "No ",YESNO
          IF        EMVIYN08=1
            MOVE      "Yes",YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      EMRB9999
.
EMRB5900  MOVE      "No ",YESNO
          IF        EMVIYN09=1
            MOVE      "Yes",YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      EMRB9999
.
EMRB6000  UNPACK    DIM127,D1,KEY1,DIM127   * .0=description .1=Code
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB6010
          MOVE      "No ",YESNO
          IF        EMVIYN10=1
            MOVE      "Yes",YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      EMRB9999
EMRB6010  WRITE     HTMLFILE;EMVIYN10;
          GOTO      EMRB9999
.
EMRB6100  WRITE     HTMLFILE;EMVIUN01;
          GOTO      EMRB9999
.
EMRB6200  WRITE     HTMLFILE;EMVIUN02;
          GOTO      EMRB9999
.
EMRB6300  WRITE     HTMLFILE;EMVIUN03;
          GOTO      EMRB9999
.
EMRB6400  WRITE     HTMLFILE;EMVIUN04;
          GOTO      EMRB9999
.
EMRB6500  WRITE     HTMLFILE;EMVIUN05;
          GOTO      EMRB9999
.
EMRB6600  UNPACK    DIM127,D1,FLDITEM,DIM127
          MOVE      FLDITEM,FLDITMNO
          MATCH     SP70,EMVIUR01
          GOTO      EMRB9900 IF EQUAL
.
          MOVE      EMVIUR01,DOCTCODE
          MOVE      EMVIUR01,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,EMRB9999
.
          CALL      DOCF0000
          GOTO      EMRB9999
.
EMRB6700  UNPACK    DIM127,D1,FLDITEM,DIM127
          MOVE      FLDITEM,FLDITMNO
.
          MATCH     ".",DIM127
          IF        @EQUAL
            UNPACK    DIM127,D1,KEY1,DIM127
            MOVE      ZERO,F1
            MOVE      KEY1,F1
            IF        F1 = 1
              MATCH     SP70,EMVIUR02
              IF        @EQUAL
                MOVE      EMVIDOCT,EMVIUR02
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,EMVIUR02
          GOTO      EMRB9900 IF EQUAL
          MATCH     EMVIUR02,DOCTCODE
          IF        !@EQUAL
            MOVE       EMVIUR02,DOCTCODE
            MOVE       EMVIUR02,KEY6
            CALL       RDDOCT1
            BRANCH     OVRCD,EMRB9999
          ENDIF
          CALL      DOCF0000
          GOTO      EMRB9999
.
EMRB6800  UNPACK    DIM127,D1,FLDITEM,DIM127
          MOVE      FLDITEM,FLDITMNO
          MATCH     SP70,EMVIUR03
          GOTO      EMRB9900 IF EQUAL
          MATCH     EMVIUR03,DOCTCODE
          IF        !@EQUAL
            MOVE       EMVIUR03,DOCTCODE
            MOVE       EMVIUR03,KEY6
            CALL       RDDOCT1
            BRANCH     OVRCD,EMRB9999
          ENDIF
          CALL      DOCF0000
          GOTO      EMRB9999
.
EMRB6900  UNPACK    DIM127,D1,FLDITEM,DIM127
          MOVE      FLDITEM,FLDITMNO
          MATCH     SP70,EMVIUR04
          GOTO      EMRB9900 IF EQUAL
          MATCH     EMVIUR04,DOCTCODE
          IF        !@EQUAL
            MOVE       EMVIUR04,DOCTCODE
            MOVE       EMVIUR04,KEY6
            CALL       RDDOCT1
            BRANCH     OVRCD,EMRB9999
          ENDIF
          CALL      DOCF0000
          GOTO      EMRB9999
.
EMRB7000  UNPACK    DIM127,D1,FLDITEM,DIM127
          MOVE      FLDITEM,FLDITMNO
          MATCH     SP70,EMVIUR05
          GOTO      EMRB9900 IF EQUAL
          MATCH     EMVIUR05,DOCTCODE
          IF        !@EQUAL
            MOVE       EMVIUR05,DOCTCODE
            MOVE       EMVIUR05,KEY6
            CALL       RDDOCT1
            BRANCH     OVRCD,EMRB9999
          ENDIF
          CALL      DOCF0000
          GOTO      EMRB9999
.
EMRB7100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB7110
.
          PACK      KEY10,EMVIMPRA,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,EMRB9999
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      EMRB9999
.
EMRB7110  WRITE     HTMLFILE;EMVIMPRA;
          GOTO      EMRB9999
.
EMRB7200  MATCH     EMVIMPDT,SP70
          GOTO      EMRB9999 IF EQUAL
.
          UNPACK    EMVIMPDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB7300  WRITE     HTMLFILE;EMVIMPTM;
          GOTO      EMRB9999
.
EMRB7400  MOVE      "CL",CATEGORY
          MOVE      EMVICOMP,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB7500  MATCH     EMVIAADT,SP70
          GOTO      EMRB9999 IF EQUAL
.
          UNPACK    EMVIAADT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB7600  WRITE     HTMLFILE;EMVIAATM;
          GOTO      EMRB9999
.
EMRB7700  MATCH     EMVIAHDT,SP70
          GOTO      EMRB9999 IF EQUAL
.
          UNPACK    EMVIAHDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB7800  WRITE     HTMLFILE;EMVIAHTM;
          GOTO      EMRB9999
.
EMRB7900  MATCH     EMVIDADT,SP70
          GOTO      EMRB9999 IF EQUAL
.
          UNPACK    EMVIDADT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB8000  WRITE     HTMLFILE;EMVIDATM;
          GOTO      EMRB9999
.
EMRB8100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,EMRB8101,EMRB8102
.
          WRITE     HTMLFILE;EMVIPURC;
          GOTO      EMRB9999
.
EMRB8101  MOVE      "HP",CATEGORY
          MOVE      EMVIPURC,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB8102  MOVE      "HP",CATEGORY
          CALL      CODSEL00
          GOTO      EMRB9999
.
EMRB8200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB8210
          PACK      KEY6,EMVIMNCD,SP70
          CALL      RDOPNUR1
          BRANCH    OVRCD,EMRB9999
          SQUEEZE   OPNRSNAM
          SQUEEZE   OPNRGNAM
          PACK      KEY60,OPNRGNAM,SP1,OPNRSNAM
          WRITE     HTMLFILE;KEY60;
          GOTO      EMRB9999
.
EMRB8210  PACK      EMVIMNCD,EMVIMNCD,SP70
          MATCH     SP70,EMVIMNCD
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIMNCD;
          GOTO      EMRB9999
.
EMRB8300  MATCH     EMVIMNDT,SP70
          GOTO      EMRB9999 IF EQUAL
.
          UNPACK    EMVIMNDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB8400  MATCH     SP70,EMVIMNTM
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIMNTM;
          GOTO      EMRB9999
.
EMRB8500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMRB8510
.
          PACK      KEY10,EMVIMDCD,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,EMRB9999
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      EMRB9999
.
EMRB8510  WRITE     HTMLFILE;EMVIMDCD;
          GOTO      EMRB9999
.
EMRB8600  MATCH     EMVIMDDT,SP70
          GOTO      EMRB9999 IF EQUAL
.
          UNPACK    EMVIMDDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB8700  MATCH     SP70,EMVIMDTM
          GOTO      EMRB9999 IF EQUAL
          WRITE     HTMLFILE;EMVIMDTM;
          GOTO      EMRB9999
.
EMRB8800  MOVE      "YN",CATEGORY
          MOVE      EMVIUC31,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB8900  MOVE      "YO",CATEGORY
          MOVE      EMVIUC32,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB9000  MOVE      "YP",CATEGORY
          MOVE      EMVIUC33,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB9100  MOVE      "YQ",CATEGORY
          MOVE      EMVIUC34,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB9200  MOVE      "YR",CATEGORY
          MOVE      EMVIUC35,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB9300  MOVE      "RF",CATEGORY
          MOVE      EMVIREFP,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB9400  WRITE     HTMLFILE;EMVIREPM;
          GOTO      EMRB9999
.
EMRB9500  MATCH     EMVIREDT,SP70
          GOTO      EMRB9999 IF EQUAL
.
          UNPACK    EMVIREDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRB9999
.
EMRB9600  MOVE      "YW",CATEGORY
          MOVE      EMVIVSTY,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB9700  MOVE      "YX",CATEGORY
          MOVE      EMVIVPLC,CODE
          CALL      CODITM00
          GOTO      EMRB9999
.
EMRB9900  MOVE      FLDITEM,F3    * Check for Link to Doctor Template Page
          IF        F3=1
            UNPACK    DIM127,D1,FLDPARA,DIM127    * Remove Parameter
          ENDIF
.
EMRB9999  RETURN
.------------------------------------------------------------
.         LOCN0000  Locations based on site code in security file
.------------------------------------------------------------
LOCN0000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,LOCN1000,LOCN2000: * 0=desc, 1=code, 2=select list
                       LOCN3000           * 3=Default from site if blank
.
          MOVE      SP70,EMLODESC
          MOVE      EMVILOCN,KEY3
          CALL      RDEMLOC1
          WRITE     HTMLFILE;EMLODESC;
          GOTO      LOCN9999
.
LOCN1000  WRITE     HTMLFILE;EMVILOCN; 
          GOTO      LOCN9999
.
LOCN2000  READ      CONTROLF,HUND22;*3,EMCNLODD
          MATCH     "1",EMCNLODD
          GOTO      LOCN2500 IF EQUAL
.
          MATCH     "2",EMCNLODD            * Empty locations only
          GOTO      LOCN2500 IF EQUAL
.
          PACK      KEY3,SP70
          CALL      RSEMLOC1
.
LOCN2100  CALL      RKEMLOC1
          BRANCH    OVRCD,LOCN9999
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN2100 IF EQUAL
.
          MATCH     EMLOSCOD,WBSEESC
          GOTO      LOCN2100 IF NOT EQUAL
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
          MATCH     EMVILOCN,EMLOLOCA
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMLODESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",EMLODESC,"</option>"
          ENDIF
          GOTO      LOCN2100
.
LOCN2500  MOVE      EMVIADMN,SAVKEY8
          MOVE      EMVILOCN,D3
.
          PACK      KEY3,SP70
          CALL      RSEMLOC1
LOCN2510  CALL      RKEMLOC1                 * Empty Map Locations
          BRANCH    OVRCD,LOCN2520
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN2510 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN2510 IF NOT EQUAL
.
          MATCH     SP70,EMLOTYPE
          IF        !@EQUAL
            MATCH     ANSW,EMLOTYPE
            GOTO      LOCN2510 IF EQUAL
            MATCH     ANSO,EMLOTYPE
            GOTO      LOCN2510 IF EQUAL
          ENDIF
.
          MATCH     "2",EMCNLODD            * Empty locations only
          IF        @EQUAL
            MATCH     D3,EMLOLOCA
            GOTO      LOCN2519 IF EQUAL
.
            COMPARE   ZERO,EMLOMAXP         * Zero assumes unlimited
            GOTO      LOCN2519 IF EQUAL
          ENDIF
.
          MOVE      ZERO,FORM4              * Number of patients in location
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN2515  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN2519
.
          MATCH     EMLOLOCA,EMVILOCN
          IF        @EQUAL
            IF        EMVISTAT<>4
              ADD       ONE,FORM4           * Add Number of patients in location
              MATCH     "2",EMCNLODD        * Empty locations only
              IF        @EQUAL
                IF        FORM4<EMLOMAXP
                  GOTO      LOCN2515        * Location not full
                ELSE
                  GOTO      LOCN2510        * Location full
                ENDIF
              ENDIF
              GOTO      LOCN2510
            ENDIF
          ENDIF
.
LOCN2519  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
          MATCH     EMVILOCN,EMLOLOCA
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMLODESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               EMLODESC,"</option>"
          ENDIF
.
          GOTO      LOCN2510
.
LOCN2520  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.         WRITE     HTMLFILE;"<option disabled>":
.                            "----------------------------------------":
.                            "</option>"
.
          PACK      KEY7,WBSEESC,ANSW,SP70
          CALL      RSEMLOC3
LOCN2530  CALL      RKEMLOC3                * Empty Waiting Room Locations
          BRANCH    OVRCD,LOCN2540
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN2530 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN2540 IF NOT EQUAL
.
          MATCH     ANSW,EMLOTYPE
          GOTO      LOCN2540 IF NOT EQUAL
.
          MATCH     "2",EMCNLODD            * Unlimited patients can be in
          GOTO      LOCN2539 IF EQUAL       * waiting rooms
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN2535  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN2539
.
          MATCH     EMLOLOCA,EMVILOCN
          IF        @EQUAL
            IF        EMVISTAT<>4
              GOTO      LOCN2530
            ENDIF
          ENDIF
.
LOCN2539  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
          MATCH     EMVILOCN,EMLOLOCA
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMLODESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               EMLODESC,"</option>"
          ENDIF
.
          GOTO      LOCN2530
.
LOCN2540  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.         WRITE     HTMLFILE;"<option disabled>":
.                            "----------------------------------------":
.                            "</option>"
.
          PACK      KEY7,WBSEESC,ANSO,SP70
          CALL      RSEMLOC3
LOCN2550  CALL      RKEMLOC3                * Empty Other Locations
          BRANCH    OVRCD,LOCN2560
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN2550 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN2560 IF NOT EQUAL
.
          MATCH     ANSO,EMLOTYPE
          GOTO      LOCN2560 IF NOT EQUAL
.
          MATCH     "2",EMCNLODD            * Unlimited patients can be in
          GOTO      LOCN2559 IF EQUAL       * other locations
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN2555  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN2559
.
          MATCH     EMLOLOCA,EMVILOCN
          IF        @EQUAL
            IF        EMVISTAT<>4
              GOTO      LOCN2550
            ENDIF
          ENDIF
.
LOCN2559  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
          MATCH     EMVILOCN,EMLOLOCA
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMLODESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               EMLODESC,"</option>"
          ENDIF
.
          GOTO      LOCN2550
.
LOCN2560  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
LOCN2600  MATCH     "2",EMCNLODD            * Only displaying empty locations
          GOTO      LOCN2660 IF EQUAL
.
          WRITE     HTMLFILE;"<option disabled>":
                             "----------------------------------------":
                             "</option>"
.
          PACK      KEY3,SP70
          CALL      RSEMLOC1
LOCN2610  CALL      RKEMLOC1                * Occupied Map Locations
          BRANCH    OVRCD,LOCN2620
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN2610 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN2610 IF NOT EQUAL
.
          MATCH     SP70,EMLOTYPE
          IF        !@EQUAL
            MATCH     ANSW,EMLOTYPE
            GOTO      LOCN2610 IF EQUAL
            MATCH     ANSO,EMLOTYPE
            GOTO      LOCN2610 IF EQUAL
          ENDIF
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN2615  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN2610
.
          MATCH     EMLOLOCA,EMVILOCN
          GOTO      LOCN2610 IF NOT EQUAL
.
          IF        EMVISTAT=4
            GOTO      LOCN2610
          ENDIF
.
LOCN2619  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
          MATCH     EMVILOCN,EMLOLOCA
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMLODESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               EMLODESC,"</option>"
          ENDIF
.
          GOTO      LOCN2610
.
LOCN2620  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.         WRITE     HTMLFILE;"<option disabled>":
.                            "----------------------------------------":
.                            "</option>"
.
          PACK      KEY7,WBSEESC,ANSW,SP70
          CALL      RSEMLOC3
LOCN2630  CALL      RKEMLOC3                * Occupied Waiting Room Locations
          BRANCH    OVRCD,LOCN2640
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN2630 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN2640 IF NOT EQUAL
.
          MATCH     ANSW,EMLOTYPE
          GOTO      LOCN2640 IF NOT EQUAL
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN2635  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN2630
.
          MATCH     EMLOLOCA,EMVILOCN
          GOTO      LOCN2630 IF NOT EQUAL
.
          IF        EMVISTAT=4
            GOTO      LOCN2630
          ENDIF
.
LOCN2639  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
          MATCH     EMVILOCN,EMLOLOCA
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMLODESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               EMLODESC,"</option>"
          ENDIF
.
          GOTO      LOCN2630
.
LOCN2640  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.         WRITE     HTMLFILE;"<option disabled>":
.                            "----------------------------------------":
.                            "</option>"
.
          PACK      KEY7,WBSEESC,ANSO,SP70
          CALL      RSEMLOC3
LOCN2650  CALL      RKEMLOC3                * Occupied Other Locations
          BRANCH    OVRCD,LOCN2660
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN2650 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN2660 IF NOT EQUAL
.
          MATCH     ANSO,EMLOTYPE
          GOTO      LOCN2660 IF NOT EQUAL
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN2655  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN2650
.
          MATCH     EMLOLOCA,EMVILOCN
          GOTO      LOCN2650 IF NOT EQUAL
.
          IF        EMVISTAT=4
            GOTO      LOCN2650
          ENDIF
.
LOCN2659  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
          MATCH     EMVILOCN,EMLOLOCA
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMLODESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               EMLODESC,"</option>"
          ENDIF
.
          GOTO      LOCN2650
.
LOCN2660  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          GOTO      LOCN9999
.
LOCN3000  READ      CONTROLF,HUND22;*3,EMCNLODD
          MATCH     "1",EMCNLODD
          GOTO      LOCN3700 IF EQUAL
.
          MATCH     "2",EMCNLODD            * Empty locations only
          GOTO      LOCN3700 IF EQUAL
.
          PACK      KEY3,SP70
          CALL      RSEMLOC1
.
LOCN3100  CALL      RKEMLOC1
          BRANCH    OVRCD,LOCN9999
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN3100 IF EQUAL
.
          MATCH     EMLOSCOD,WBSEESC
          GOTO      LOCN3100 IF NOT EQUAL
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
.
          MATCH     SP70,EMVILOCN           * If no location default from the
          GOTO      LOCN3500 IF EQUAL       * emergency site file
.
          MATCH     EMVILOCN,EMLOLOCA
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMLODESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",EMLODESC,"</option>"
          ENDIF
.
          GOTO      LOCN3100
.
LOCN3500  MATCH     EMSTDLOC,EMLOLOCA       * Default location from site code
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMLODESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",EMLODESC,"</option>"
          ENDIF
.
          GOTO      LOCN3100
.
LOCN3700  MOVE      EMVIADMN,SAVKEY8
          MOVE      EMVILOCN,D3
.
          PACK      KEY7,WBSEESC,SP1,SP70        * Empty Map Room
          CALL      RSEMLOC3
LOCN3710  CALL      RKEMLOC3
          BRANCH    OVRCD,LOCN3720
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN3710 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN3720 IF NOT EQUAL
.
          MATCH     SP70,EMLOTYPE
          GOTO      LOCN3720 IF NOT EQUAL
.
          MATCH     "2",EMCNLODD            * Empty locations only
          IF        @EQUAL
            MATCH     D3,EMLOLOCA
            GOTO      LOCN3719 IF EQUAL
.
            COMPARE   ZERO,EMLOMAXP         * Zero assumes unlimited
            GOTO      LOCN3719 IF EQUAL
          ENDIF
.
          MOVE      ZERO,FORM4              * Number of patients in location
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN3715  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN3719
.
          MATCH     EMLOLOCA,EMVILOCN
          IF        @EQUAL
            IF        EMVISTAT<>4
              ADD       ONE,FORM4           * Add Number of patients in location
              MATCH     "2",EMCNLODD        * Empty locations only
              IF        @EQUAL
                IF        FORM4<EMLOMAXP
                  GOTO      LOCN3715        * Location not full
                ELSE
                  GOTO      LOCN3710        * Location full
                ENDIF
              ENDIF
              GOTO      LOCN3710
            ELSE
              GOTO      LOCN3715
            ENDIF
          ENDIF
.
LOCN3719  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
.
          MATCH     SP70,EMVILOCN
          IF        @EQUAL
            MATCH     EMSTDLOC,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ELSE
            MATCH     EMVILOCN,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ENDIF
.
          GOTO      LOCN3710
.
LOCN3720  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.         WRITE     HTMLFILE;"<option disabled>":
.                            "----------------------------------------":
.                            "</option>"
.
          PACK      KEY7,WBSEESC,ANSW,SP70       * Empty Waiting Room
          CALL      RSEMLOC3
LOCN3730  CALL      RKEMLOC3
          BRANCH    OVRCD,LOCN3740
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN3730 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN3740 IF NOT EQUAL
.
          MATCH     ANSW,EMLOTYPE
          GOTO      LOCN3740 IF NOT EQUAL
.
          MATCH     "2",EMCNLODD            * Unlimited patients can be in
          GOTO      LOCN3739 IF EQUAL       * waiting rooms
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN3735  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN3739
.
          MATCH     EMLOLOCA,EMVILOCN
          IF        @EQUAL
            IF        EMVISTAT<>4
              GOTO      LOCN3730
            ELSE
              GOTO      LOCN3735
            ENDIF
          ENDIF
.
LOCN3739  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
.
          MATCH     SP70,EMVILOCN
          IF        @EQUAL
            MATCH     EMSTDLOC,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ELSE
            MATCH     EMVILOCN,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ENDIF
.
          GOTO      LOCN3730
.
LOCN3740  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.         WRITE     HTMLFILE;"<option disabled>":
.                            "----------------------------------------":
.                            "</option>"
.
          PACK      KEY7,WBSEESC,ANSO,SP70       * Empty Other Department
          CALL      RSEMLOC3
LOCN3750  CALL      RKEMLOC3
          BRANCH    OVRCD,LOCN3800
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN3750 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN3800 IF NOT EQUAL
.
          MATCH     ANSO,EMLOTYPE
          GOTO      LOCN3800 IF NOT EQUAL
.
          MATCH     "2",EMCNLODD            * Unlimited patients can be in
          GOTO      LOCN3759 IF EQUAL       * waiting rooms
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN3755  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN3759
.
          MATCH     EMLOLOCA,EMVILOCN
          IF        @EQUAL
            IF        EMVISTAT<>4
              GOTO      LOCN3750
            ELSE
              GOTO      LOCN3755
            ENDIF
          ENDIF
.
LOCN3759  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
.
          MATCH     SP70,EMVILOCN
          IF        @EQUAL
            MATCH     EMSTDLOC,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ELSE
            MATCH     EMVILOCN,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ENDIF
.
          GOTO      LOCN3750
.
LOCN3800  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.         WRITE     HTMLFILE;"<option disabled>":
.                            "----------------------------------------":
.                            "</option>"
.
          PACK      KEY7,WBSEESC,ANSE,SP70       * Empty Telehealth Service
          CALL      RSEMLOC3
LOCN3811  CALL      RKEMLOC3
          BRANCH    OVRCD,LOCN3899
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN3811 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN3899 IF NOT EQUAL
.
          MATCH     ANSE,EMLOTYPE
          GOTO      LOCN3899 IF NOT EQUAL
.
          MATCH     "2",EMCNLODD            * Unlimited patients can be in
          GOTO      LOCN3830 IF EQUAL       * telehealth
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN3822  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN3830
.
          MATCH     EMLOLOCA,EMVILOCN
          IF        @EQUAL
            IF        EMVISTAT<>4
              GOTO      LOCN3811
            ELSE
              GOTO      LOCN3822
            ENDIF
          ENDIF
.
LOCN3830  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
.
          MATCH     SP70,EMVILOCN
          IF        @EQUAL
            MATCH     EMSTDLOC,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ELSE
            MATCH     EMVILOCN,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ENDIF
.
          GOTO      LOCN3811
.
.
.
LOCN3899  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
LOCN3900  MATCH     "2",EMCNLODD            * Only displaying empty locations
          GOTO      LOCN3980 IF EQUAL
. 
          WRITE     HTMLFILE;"<option disabled>":
                             "----------------------------------------":
                             "</option>"
.
          PACK      KEY7,WBSEESC,SP1,SP70
          CALL      RSEMLOC3
LOCN3910  CALL      RKEMLOC3                * Occupied Map Locations
          BRANCH    OVRCD,LOCN3920
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN3910 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN3920 IF NOT EQUAL
.
          MATCH     SP70,EMLOTYPE
          GOTO      LOCN3920 IF NOT EQUAL
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN3915  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN3910
.
          MATCH     EMLOLOCA,EMVILOCN
          GOTO      LOCN3910 IF NOT EQUAL
.
          IF        EMVISTAT=4
            GOTO      LOCN3915
          ENDIF
.
LOCN3919  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
.
          MATCH     SP70,EMVILOCN
          IF        @EQUAL
            MATCH     EMSTDLOC,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ELSE
            MATCH     EMVILOCN,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ENDIF
.
          GOTO      LOCN3910
.
LOCN3920  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.         WRITE     HTMLFILE;"<option disabled>":
.                            "----------------------------------------":
.                            "</option>"
.
          PACK      KEY7,WBSEESC,ANSW,SP70
          CALL      RSEMLOC3
LOCN3930  CALL      RKEMLOC3                * Occupied Waiting room Locations
          BRANCH    OVRCD,LOCN3940
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN3930 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN3940 IF NOT EQUAL
.
          MATCH     ANSW,EMLOTYPE
          GOTO      LOCN3940 IF NOT EQUAL
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN3935  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN3930
.
          MATCH     EMLOLOCA,EMVILOCN
          GOTO      LOCN3930 IF NOT EQUAL
.
LOCN3939  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
.
          MATCH     SP70,EMVILOCN
          IF        @EQUAL
            MATCH     EMSTDLOC,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ELSE
            MATCH     EMVILOCN,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ENDIF
.
          GOTO      LOCN3930
.
LOCN3940  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.         WRITE     HTMLFILE;"<option disabled>":
.                            "----------------------------------------":
.                            "</option>"
.
          PACK      KEY7,WBSEESC,ANSO,SP70
          CALL      RSEMLOC3
LOCN3950  CALL      RKEMLOC3                * Occupied Other Locations
          BRANCH    OVRCD,LOCN3960
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN3950 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN3960 IF NOT EQUAL
.
          MATCH     ANSO,EMLOTYPE
          GOTO      LOCN3960 IF NOT EQUAL
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN3955  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN3950
.
          MATCH     EMLOLOCA,EMVILOCN
          GOTO      LOCN3950 IF NOT EQUAL
.
          IF        EMVISTAT=4
            GOTO      LOCN3955
          ENDIF
.
LOCN3959  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
.
          MATCH     SP70,EMVILOCN
          IF        @EQUAL
            MATCH     EMSTDLOC,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ELSE
            MATCH     EMVILOCN,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ENDIF
.
          GOTO      LOCN3950
.
LOCN3960  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.         WRITE     HTMLFILE;"<option disabled>":
.                            "----------------------------------------":
.                            "</option>"
.
          PACK      KEY7,WBSEESC,ANSE,SP70
          CALL      RSEMLOC3
LOCN3970  CALL      RKEMLOC3                * Occupied Telehealth Locations
          BRANCH    OVRCD,LOCN3980
.
          MATCH     "1",EMLOACTV
          GOTO      LOCN3970 IF EQUAL
.
          MATCH     WBSEESC,EMLOSCOD
          GOTO      LOCN3980 IF NOT EQUAL
.
          MATCH     ANSE,EMLOTYPE
          GOTO      LOCN3980 IF NOT EQUAL
.
          PACK      KEY11,EMLOLOCA,SP70
          CALL      RSEMVIS7
LOCN3975  CALL      RKEMVIS7
          BRANCH    OVRCD,LOCN3970
.
          MATCH     EMLOLOCA,EMVILOCN
          GOTO      LOCN3970 IF NOT EQUAL
.
          IF        EMVISTAT=4
            GOTO      LOCN3975
          ENDIF
.
LOCN3979  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
.
          MATCH     SP70,EMVILOCN
          IF        @EQUAL
            MATCH     EMSTDLOC,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ELSE
            MATCH     EMVILOCN,EMLOLOCA
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                                 EMLODESC,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY5,">":
                                 EMLODESC,"</option>"
            ENDIF
          ENDIF
.
          GOTO      LOCN3970
.
LOCN3980  PACK      KEY8,SAVKEY8,SP70
          CALL      RDEMVIS1
          IF        OVRCD=1
            CALL      CLEMRVIS
          ENDIF
.
          GOTO      LOCN9999
.
LOCN9999  RETURN
+
.
.------------------------------------------------------------------------------
.   Display Selection List for Transfer Source Code (select Active)
.------------------------------------------------------------------------------
VADA0000  PACK      KEY35,SP70
          CALL      RSPTVAD2
VADA0100  CALL      RKPTVAD2
          BRANCH    OVRCD,VADA9999
.
          MATCH     ANSA,PTVAACTV
          GOTO      VADA0100 IF NOT EQUAL
.
          MATCH     VCODE,PTVACODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",PTVACODE," selected>":
                               PTVADESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",PTVACODE,">":
                               PTVADESC,"</option>"
          ENDIF
          GOTO      VADA0100
.
VADA9999  RETURN
+
.
.------------------------------------------------------------
.   Display Selection List for health fund
.------------------------------------------------------------
DFND0000  PACK      KEY14,SP70
          CALL      RDSFUND1
DFND0010  CALL      RDKFUND1
          BRANCH    OVRCD,DFND9999
          MATCH     "0000",HFTABL
          IF        @EQUAL
            MATCH     HCODE,EMVIFUND
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=#"",HCODE,"#" selected> ":
                                 HCODE,": ",HFNAME,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=#"",HCODE,"#"> ":
                                 HCODE,": ",HFNAME,"</option>"
            ENDIF
          ELSE
            PACK      KEY14,HCODE,Z70
            CALL      RDSFUND1
          ENDIF
          GOTO      DFND0010
.
DFND9999  RETURN
.------------------------------------------------------------
.         RESULT00  Check if results available yes=1, no=0
.         * D CAR 38290
.         * This function was removed because its output "resavail"
.         * is not used anywhere.
.         * CAR 38290: Split up RESLNKFD (reslnkaf) into yearly files
.------------------------------------------------------------
.RESULT00  MOVE      ZERO,FORM8
.          MOVE      ADMISSNO,FORM8
.          MOVE      FORM8,ADMISSNO
.          PACK      KEY29,ZERO,TWO,ADMISSNO
.          CALL      RDRELN1
.          BRANCH    OVRCD,RESULT90
.
.          MATCH     ADMISSNO,RELNLKY
.          GOTO      RESULT90 IF NOT EQUAL
.
.          WRITE     HTMLFILE;ONE;
.          GOTO      RESULT99
.
.RESULT90  WRITE     HTMLFILE;ZERO;
.
.RESULT99  RETURN
.------------------------------------------------------------
.         REGN0000  Display  body region code selection list
.------------------------------------------------------------
REGN0000  PACK      KEY2,SP70
          CALL      RSEMGRC1
REGN0010  CALL      RKEMGRC1
          BRANCH    OVRCD,REGN9999
          MATCH     EMRCCODE,EMVIREGN
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",EMRCCODE,"#" selected> ":
                               EMRCCODE,": ",EMRCDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",EMRCCODE,"#"> ":
                               EMRCCODE,": ",EMRCDESC,"</option>"
          ENDIF
          GOTO      REGN0010
.
REGN9999  RETURN
.
.------------------------------------------------------------
. Ward selection
.------------------------------------------------------------
WSEL0000  PACK      KEY3,EMVIEWRD 
          PROC      WSELP000 
          RETURN
.
.*****************************************************************************
.*  WSELP000
.*  Procedure to build a ward selection list. 
.*  This is packaged as a procedure to insulate parent code
.*  from patwr1af index 7 (bed,hospital,description,ward) 
.*  KEY3 contains the current ward code (if any)
.*****************************************************************************
          DEFPROC   WSELP000
.
          OPEN      PATWR1A7,"patwr1af"
          PACK      KEY29,SP70
          IF        IBCNMHOS = 1
            PACK      KEY29,SP3,WBSEHOSP,SP70
          ENDIF
          CALL      RDSWARD7
WSELP010  CALL      RDKWARD7
          BRANCH    OVRCD,WSELP900
.
.                         if we have a bed number we have passed all the ward
.                         master records. so exit
          MATCH     SP70,WBED
          GOTO      WSELP900 IF NOT EQUAL
.
          COMPARE   WACTIVE,ZERO                 *List only active wards
          GOTO      WSELP010 IF NOT EQUAL
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        !@EQUAL
              MATCH     WBSEHOSP,PTWDHOSN
              GOTO      WSELP900 IF NOT EQUAL
            ENDIF
          ENDIF
.
.                       write the select option. 
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#"";
          MATCH     KEY3,WWARD
          IF        @EQUAL 
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">",WBDESC;
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;" - ",PTWDHOSN;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      WSELP010
.
WSELP900  CLOSE     PATWR1A7
.
          ENDPROC
+
.------------------------------------------------------------
.         Date select list - from arrival date to current date
.         Requires Date to be selected in SELCDATE
.------------------------------------------------------------
DATES000  MOVE      ZERO,COUNTER
          CALL      IBACLOCK
          PACK      TODAY,CCC,CYY,CMM,CDD
          REP       " 0",TODAY
.
          WRITE     HTMLFILE;"<option value=#"":            * C CAR 42825
                    "           ","#"> </option>"
.
          UNPACK    TODAY,CCENT,CYEAR,CMON,CDAY
.
DATES100  ADD       ONE,COUNTER
          IF        COUNTER>998
            GOTO      DATES999
          ENDIF
.
          PACK      KEY8,CCENT,CYEAR,CMON,CDAY
          REP       " 0",KEY8
          MATCH     EMVIDATE,KEY8
          GOTO      DATES200 IF EQUAL
.
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          MATCH     SELCDATE,KEY8
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"#" selected>":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"#">":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>"
          ENDIF 
.
          MOVE      "-1",ADJDAYS
          CALL      ADJDAT00
          GOTO      DATES100
.
DATES200  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          MATCH     SP70,SELCDATE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"#">":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>"
            GOTO      DATES999
          ENDIF
.
          MATCH       TODAY,SELCDATE
          MATCH       EMVIDATE,SELCDATE
          IF          @EQUAL
            WRITE     HTMLFILE;"<option value=#"":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"#" selected>":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"#">":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>"
          ENDIF
.
DATES999  RETURN
.------------------------------------------------------------
.         Date select list - from arrival date to discharge date
.         Requires Date to be selected in SELCDATE
.------------------------------------------------------------
DATED000  MOVE      ZERO,COUNTER
          CALL      IBACLOCK
          PACK      TODAY,CCC,CYY,CMM,CDD
          REP       " 0",TODAY
.
          WRITE     HTMLFILE;"<option value=#"":            * C CAR 42825
                    "           ","#"> </option>"
.
          MATCH     SP70,EMVIDDAT
          IF        @EQUAL | @EOS
            UNPACK    TODAY,CCENT,CYEAR,CMON,CDAY
          ELSE
            UNPACK    EMVIDDAT,CCENT,CYEAR,CMON,CDAY
          ENDIF
.
DATED100  ADD       ONE,COUNTER
          IF        COUNTER>998
            GOTO      DATED999
          ENDIF
.
          PACK      KEY8,CCENT,CYEAR,CMON,CDAY
          REP       " 0",KEY8
          MATCH     EMVIDATE,KEY8
          GOTO      DATED200 IF EQUAL
.
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          MATCH     SELCDATE,KEY8
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"#" selected>":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"#">":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>"
          ENDIF
.
          MOVE      "-1",ADJDAYS
          CALL      ADJDAT00
          GOTO      DATED100
.
DATED200  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          MATCH     SP70,SELCDATE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"#">":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>"
            GOTO      DATED999
          ENDIF
.
          MATCH       EMVIDATE,SELCDATE
          IF          @EQUAL
            WRITE     HTMLFILE;"<option value=#"":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"#" selected>":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"#">":
                      CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>"
          ENDIF
.
DATED999  RETURN
.------------------------------------------------------------
.         LABEL000
.------------------------------------------------------------
LABEL000  MOVE      ONE,COUNTER
          WRITE     HTMLFILE;"<option></option>"
.
LABEL100  REPEAT
            IF        HELPRNT=COUNTER
              WRITE     HTMLFILE;"<option value=#"",COUNTER,"#" selected>":
                                 COUNTER,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=#"",COUNTER,"#">":
                                 COUNTER,"</option>"
            ENDIF 
          ADD       ONE,COUNTER
          UNTIL     COUNTER=20
.
LABEL999  RETURN
.------------------------------------------------------------
.         Compensation code for Emergency
.------------------------------------------------------------
COMPTM00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,COMPTM10,COMPTM20
          CALL      GETCOD00
          WRITE     HTMLFILE;TDESC;
          GOTO      COMPTM99
.
COMPTM10  WRITE     HTMLFILE;CODE;
          GOTO      COMPTM99
.
COMPTM20  CALL      COMPCL00
.
COMPTM99  RETURN
.------------------------------------------------------------
. Add Selection Options to Form (code value)
.------------------------------------------------------------
COMPCL00  PACK      PTCDKEY2,CATEGORY,SP70
          CALL      RDSCODE2
COMPCL10  CALL      RDKCODE2
          BRANCH    OVRCD,CODSEL99
.
          MATCH     CATEGORY,TCODE
          GOTO      COMPCL99 IF NOT EQUAL
.
          MATCH     SP70,ACODE
          GOTO      COMPCL10 IF EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      COMPCL10 IF EQUAL
.
          MATCH     "E",TCINDC8
          GOTO      COMPCL10 IF NOT EQUAL
.
          IF        IBCNMHOS=1
            MATCH    "1",PTCDHOSS
            IF       @EQUAL
              PACK     KEY8,WBSEHOSP,TCODE,ACODE,SP70
              CALL     RDMLCOD1
              BRANCH   OVRCD,COMPCL10
            ENDIF
          ENDIF
.
          PACK      KEY60,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10:
                          TCINDC11,THCSCOD,PTCDNHCP,TCFORM6:
                          TCINDC12,TCINDC13,TCINDC14,TCINDC15,TCINDC16:
                          TCINDC17,TCINDC18,TCINDC19,TCINDC20,TCINDC21:
                          PTCOACTV,TCINDC22,TCINDC23,TCINDC24,TCINDC25:
                          TCINDC26,TCINDC27,TCINDC28,TCINDC29,TCINDC30:
                          TCINDC31,TCINDC32,TCINDC33,TCINDC34,TCINDC35:
                          TCINDC36,TCINDC37,TCINDC38,TCINDC39,TCINDC40:
                          TCINDC41
.
          PACK      KEY65,QUOTE,ACODE,KEY60,QUOTE
          MATCH     CODE,ACODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY65," selected>":
                               TDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY65,">",TDESC,"</option>"
          ENDIF
          GOTO      COMPCL10
COMPCL99  RETURN
.------------------------------------------------------------
.  Outputs a selection list of Nurse type
.----------------------------------------------------------------
SELNUR00  PACK      KEY6,SP70
          CALL      RSOPNUR1                * positional read
SELNUR10  CALL      RKOPNUR1                * read a record
          BRANCH    OVRCD,SELNUR99
.
          MATCH     OPNRCODE,EMVIATNS    * Default Records Location
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",OPNRCODE,"#" selected>":
                                 OPNRSNAM,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",OPNRCODE,"#">":
                                OPNRSNAM,"</option>"
          ENDIF
.
          GOTO    SELNUR10
.
SELNUR99  RETURN
.------------------------------------------------------------
.  Outputs a selection list of Nurse type from pmshcpaf
.----------------------------------------------------------------
SHCPNU00  PACK      KEY10,SP70
          CALL      RSPMHCP1                * positional read
SHCPNU10  CALL      RKPMHCP1                * read next record
          BRANCH    OVRCD,SHCPNU99
.
.                            HCP Type - 14, 15 Nurse types
          BRANCH    PMHCHCST,SHCPNU10,SHCPNU10,SHCPNU10,SHCPNU10,SHCPNU10:
                             SHCPNU10,SHCPNU10,SHCPNU10,SHCPNU10,SHCPNU10:
                             SHCPNU10,SHCPNU10,SHCPNU10,SHCPNU20,SHCPNU20
.
          GOTO      SHCPNU10
.
SHCPNU20  MATCH     PMHCHCPC,EMVIATNS   
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PMHCHCPC,"#" selected>":
                                 PMHCSNAM,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PMHCHCPC,"#">":
                                PMHCSNAM,"</option>"
          ENDIF
.
          GOTO    SHCPNU10
.
SHCPNU99  RETURN


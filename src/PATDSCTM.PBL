.------------------------------------------------------------
. Patient Discharge Fields
.------------------------------------------------------------
. Modifications :          
. V10.10.01 29/03/2017  B.G.Ackland    TSK 0835482 
.           FHIR Enable Fields for inclusion in FHIR response templates
. V10.06.01 16/04/2015  Peter Vela     CAR 312723
.           Added PTDSCLGP
. V10.05.01 13/10/2014  Don Nguyen     CAR 276546
.           Added DSCF3200-DSCF4100
. V10.03.04 18/04/2013  J.Tan          CAR 283608
.           Added semicolon to DDATE
. V10.03.03 18/06/2012  Don Nguyen     CAR 261697
.           Undone previous change. Should be outputting the discharge ward
. V10.03.02 04/06/2012  Don Nguyen     CAR 261697
.           Modified to output ward location for a non-discharged patient
. V10.03.01 02/03/2012  Ebon Clements  CAR 261108
.           Added discharge ward short or long description tag
. V10.02.02 24/10/2011  Jill Parkinson CAR 251645
.           Mods to output PTDSLSDN
. V10.02.01 12/07/2011  Jill Parkinson CAR 242269
.           Mods to output PTDSDPMN
. V9.08.01  08/05/2007  Mike Laming  CAR 137125 HDP 2007 DRG 5.2
.           Mods to PATDGWFD - Add field PTDWDRGV (add to Keys)
. V9.04.01  01/07/2005  Peter Vela    CAR 68675
.           Added condition to check active/inactive Stationery Template
. V9.03.01  02/07/2003  Jill Habasque SRF 40660
.           Added ACAS Status
. V9.02.03  07.06.2002  Harvinder SRF No. 10889
.           Added Description field for Discharge DRG, DSCF1400
. V9.02.02  25.09.2001  Ebon Clements
.           Added output of transer source
. V9.02.01  06.09.2001  Jill Habasque
.           Added output of PTDSSREF
.------------------------------------------------------------
DSCF0000  BRANCH    FLDITMNO,DSCF0100,DSCF0200,DSCF0300,DSCF0400,DSCF0500:
                       DSCF0600,DSCF0700,DSCF0800,DSCF0900,DSCF1000:
                       DSCF1100,DSCF1200,DSCF1300,DSCF1400,DSCF1500:
                       DSCF1600,DSCF1700,DSCF1800,DSCF1900,DSCF2000:
                       DSCF2100,DSCF2200,DSCF2300,DSCF2400,DSCF2500:
                       DSCF2600,DSCF2700,DSCF2800,DSCF2900,DSCF3000:
                       DSCF3100,DSCF3200,DSCF3300,DSCF3400,DSCF3500:
                       DSCF3600,DSCF3700,DSCF3800,DSCF3900,DSCF4000:
                       DSCF4100,DSCF4200
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      DSCF9999
.
DSCF0100  MATCH     SP6,DDATE
          GOTO      DSCF0150 IF EQUAL 
          IF        @EOS
            GOTO      DSCF0150
          ENDIF
.
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          IF        FHIRTYPE=0
            WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          ELSE
            WRITE     HTMLFILE;CCENT,CYEAR,"-",CMON,"-",CDAY;
          ENDIF
          GOTO      DSCF9999
.
DSCF0150  MOVE      SP3,MTHNAM3
          MOVE      SP2,CCENT
          MOVE      SP2,CYEAR
          MOVE      SP2,CMON
          MOVE      SP2,CDAY
          GOTO      DSCF9999
.
DSCF0200  WRITE     HTMLFILE;DTIME;
          GOTO      DSCF9999
.
DSCF0300  MOVE      "D ",CATEGORY
          MOVE      DSTAT,CODE
          CALL      CODITM00
          GOTO      DOCF9999
.
DSCF0400  MOVE      "DD",CATEGORY
          MOVE      DDEST,CODE
          CALL      CODITM00
          GOTO      DOCF9999
.
DSCF0500  WRITE     HTMLFILE;DDIAG;
          GOTO      DSCF9999
.
DSCF0600  WRITE     HTMLFILE;DDIAG2;
          GOTO      DSCF9999
.
DSCF0700  MOVE      "D1",CATEGORY
          MOVE      DUSD1,CODE
          CALL      CODITM00
          GOTO      DSCF9999
.
DSCF0800  MOVE      "D2",CATEGORY
          MOVE      DUSD2,CODE
          CALL      CODITM00
          GOTO      DSCF9999
.
DSCF0900  MOVE      "D3",CATEGORY
          MOVE      DUSD3,CODE
          CALL      CODITM00
          GOTO      DSCF9999
.
DSCF1000  MOVE      "D4",CATEGORY
          MOVE      DUSD4,CODE
          CALL      CODITM00
          GOTO      DSCF9999
.
DSCF1100  MOVE      "D5",CATEGORY
          MOVE      DUSD5,CODE
          CALL      CODITM00
          GOTO      DSCF9999
.
DSCF1200  WRITE     HTMLFILE;DFMBS;
          GOTO      DSCF9999
.
DSCF1300  WRITE     HTMLFILE;PTDSDMDC;
          GOTO      DSCF9999
.
DSCF1400  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,DSCF1410
          WRITE     HTMLFILE;PTDSDDRG;
          GOTO      DSCF9999
.
DSCF1410  PACK      KEY4,PTDSDDRG,SP70
          MOVE      "999",KEY3
          PACK      KEY7,KEY4,KEY3,SP10     * last DRG version        *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          BRANCH    OVRCD,DSCF9999
          MATCH     PTDWDRGC,KEY4           * same DRG code ?         *I-137125
          GOTO      DSCF9999 IF NOT EQUAL                             *I-137125
          WRITE     HTMLFILE;PTDWDESC;
          GOTO      DSCF9999
.
DSCF1500  WRITE     HTMLFILE;PTDSSIDX;
          GOTO      DSCF9999
.
DSCF1600  WRITE     HTMLFILE;PTDSVOGU;
          GOTO      DSCF9999
.
DSCF1700  PACK      KEY6,SP6
          CALL      RSIBTH1
DSCF1750  CALL      RKIBTH1 
          BRANCH    OVRCD,DSCF9999
.
          MATCH     "1",IBTHACTV
          GOTO      DSCF1750 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=#"",IBTHSCOD,"#">":
                             IBTHDESC,"</option>"
          GOTO      DSCF1750
.
DSCF1800  WRITE     HTMLFILE;DWLREASN;
          GOTO      DSCF9999
.
DSCF1900  WRITE     HTMLFILE;PTDSOPER;
          GOTO      DSCF9999
.
DSCF2000  WRITE     HTMLFILE;PTDSUYN1;
          GOTO      DSCF9999
.
DSCF2100  WRITE     HTMLFILE;PTDSUYN2;
          GOTO      DSCF9999
.
DSCF2200  WRITE     HTMLFILE;PTDSUYN3;
          GOTO      DSCF9999
.
DSCF2300  WRITE     HTMLFILE;PTDSUYN4;
          GOTO      DSCF9999
.
DSCF2400  WRITE     HTMLFILE;PTDSDWRD;
          GOTO      DSCF9999
.
DSCF2500  WRITE     HTMLFILE;PTDSDLOS;
          GOTO      DSCF9999
.
DSCF2600  WRITE     HTMLFILE;PTDSSREF;
          GOTO      DSCF9999
.
DSCF2700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTDAD1
          IF        OVRCD<>0
            MOVE      SP70,PTDADCTS
          ENDIF
.
          MATCH     SP70,PTDADCTS
          GOTO      DSCF9999 IF EQUAL
.
          BRANCH    F1,DSCF2710
.
          WRITE     HTMLFILE;PTDADCTS;
          GOTO      DSCF9999
.
DSCF2710  PACK      KEY5,PTDADCTS
          CALL      RDPTVAD1
          BRANCH    OVRCD,DSCF9999
.
          WRITE     HTMLFILE;PTVADESC;
          GOTO      DSCF9999
.
DSCF2800  READ      CONTROLF,HUND09;*195,PTCNACAS
          LOAD      CATEGORY,PTCNACAS,CATD1,CATD2,CATD3,CATD4,CATD5:
                                      CATU6,CATU7
.
          LOAD      CODE,PTCNACAS,DUSD1,DUSD2,DUSD3,DUSD4,DUSD5:
                                  AUSR6,AUSR7
          CALL      CODITM00
          GOTO      DSCF9999
.
DSCF2900  MOVE      "SI",CATEGORY
          MOVE      PTDSDPMN,CODE
          CALL      CODITM00
          GOTO      DSCF9999
.
DSCF3000  WRITE     HTMLFILE;PTDSLSDN;
          GOTO      DSCF9999
.
DSCF3100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
.         COMPARE   THREE,ASTAT                   * Discharged status?
.         GOTO      DSCF3110 IF NOT EQUAL         * No;
.
          PACK      KEY6,PTDSDWRD,SP70
          CALL      RDWARD1
          IF        OVRCD=1
            PACK      PTWDSDES,PTDSDWRD,SP70
            PACK      WBDESC,PTDSDWRD,SP70
          ENDIF
.
DSCF3110  BRANCH    F1,DSCF3150
.
          WRITE     HTMLFILE;PTWDSDES;
          GOTO      DSCF9999
.
DSCF3150  WRITE     HTMLFILE;WBDESC;
          GOTO      DSCF9999
.
DSCF3200  READ      CONTROLF,TEN8;*73,CDUSR1
          WRITE     HTMLFILE;CDUSR1;
          GOTO      DSCF9999
.
DSCF3300  READ      CONTROLF,TEN8;*87,CDUSR2
          WRITE     HTMLFILE;CDUSR2;
          GOTO      DSCF9999
.
DSCF3400  READ      CONTROLF,TEN8;*101,CDUSR3
          WRITE     HTMLFILE;CDUSR3;
          GOTO      DSCF9999
.
DSCF3500  READ      CONTROLF,TEN8;*115,CDUSR4
          WRITE     HTMLFILE;CDUSR4;
          GOTO      DSCF9999
.
DSCF3600  READ      CONTROLF,TEN8;*129,CDUSR5
          WRITE     HTMLFILE;CDUSR5;
          GOTO      DSCF9999
.
DSCF3700  READ      CONTROLF,TEN8;*86,CDUSMAN1
          WRITE     HTMLFILE;CDUSMAN1;
          GOTO      DSCF9999
.
DSCF3800  READ      CONTROLF,TEN8;*100,CDUSMAN2
          WRITE     HTMLFILE;CDUSMAN2;
          GOTO      DSCF9999
.
DSCF3900  READ      CONTROLF,TEN8;*114,CDUSMAN3
          WRITE     HTMLFILE;CDUSMAN3;
          GOTO      DSCF9999
.
DSCF4000  READ      CONTROLF,TEN8;*128,CDUSMAN4
          WRITE     HTMLFILE;CDUSMAN4;
          GOTO      DSCF9999
.
DSCF4100  READ      CONTROLF,TEN8;*142,CDUSMAN5
          WRITE     HTMLFILE;CDUSMAN5;
          GOTO      DSCF9999
.
DSCF4200  WRITE     HTMLFILE;PTDSCLGP;
          GOTO      DSCF9999  
.
DSCF9999  RETURN

.******************************************************************************
.*                                                                            *
.*                        P R O G R A M   S U M M A R Y                       *
.*                        -------------   -------------                       *
.*                                                                            *
.*     PROGRAM NAME:     IBAOUT20                                             *
.*                                                                            *
.*     FUNCTION:         OUTPATIENT INVOICES                                  *
.*                                                                            *
.*     DATE WRITTEN:     03/10/1988                                           *
.*                                                                            *
.*     AUTHOR:           GRAEME WILLIAMS                                      *
.*                                                                            *
.*     MODIFICATIONS:                                                         *
.*----------------------------------------------------------------------------*
.* V12.00.04 30/09/2025  Thanh T        TSK 0937505                           *
.*           Recompiled for PATINVHL changes                                  *
.* V12.00.03 13/06/2025  J.Tan          TSK 0961623                           *
.*           Fixed keyin Alphanumeric Visit number                            *
.* V12.00.02 02/06/2025  Don Nguyen     TSK 0955096                           *
.*           Alphanumeric visit number changes                                *
.* V12.00.01 30/05/2025  Don Nguyen     TSK 0955096                           *
.*           Alphanumeric visit number changes                                *
.* V11.04.01 07/11/2024 Thanh T         TSK 0946085                           *
.*           Added RCCNSTRF field - Display Statement Reference               *
.* V11.03.03 08/11/2023  Nikitha B      TSK 0927699c                          *
.*           Read CAPPRVNO and PTCNHABN for Hospital Approval and ABN number. *
.* V11.03.02 04/10/2023  Nikitha B     TSK 0927699                            *
.*           Recompiled for PATINVHL, PATINVTL - Stationary variables         *
.* V11.03.01 15/06/2023  Bella Turco    TSK 0931756                           *
.*           Recompiled for PRTINVBD                                          * 
.* V11.02.02 11/10/2022  J.Tan            TSK 0908346                         *
.*           Mod checking Clinical Doc.for printing inv.(CHKCLDCP)            *
.* V11.02.01 16/03/2022  J.Tan           TSK 0902652                          *
.*           Recompiled for OUTCATBI - New Patient Invoice                    *
.* V11.01.06 17/11/2021  J.Tan          TSK 0913621                           *
.*           Recompiled for ABFOTINV - Mod for Multiple NEP Values            *
.* V11.01.05 14/09/2021  Davin           TSK 0911277                          *
.*           Recompiled for PRTINVBD                                          *
.* V11.01.04 10/09/2021  Davin           TSK 0911277                          *
.*           Recompiled for PATINVTL - Changed field 20 length to 12.2        *
.* V11.01.03 31/08/2021  J.Tan           TSK 0910799                          *
.*           Recompiled for PRTINVBD - printing Referring ADF                 *
.* V11.01.02 24/08/2021  Davin          TSK 0897318                           *
.*           Recompiled for PATINVTL - added field 57(Adjustment Total)       *
.* V11.01.01 27/04/2021  Thanh T        TSK 0895165                           *
.*           Recompiled for OPRARDFD changes                                  *
.*----------------------------------------------------------------------------*
.* V11.00.07 19/01/2021  J.Tan          TSK 0883075                           *
.*           Recompiled for PRTINVBD - mod to print ADF address on invoice    *
.* V11.00.06 14/10/2020  J.Tan          TSK 0894879                           *
.*           Recompiled for PRTINVBD - Print 30 item desc.for RCH Inv.        *
.* V11.00.05 01/07/2020 J.Tan           TSK 0886178                           *
.*           Recompiled for OUTCATBI - write to invoice pending details       *
.* V11.00.04 29/06/2020  J.Tan           TSK 0893767                          *
.*           Recompiled for ABFOTINV - Changed CALCFLAG to 01/01/2021         *
.* V11.00.03 20/04/2020 J.Tan           TSK 0890733                           *
.*           Recompiled for ABFOTINV - ABF new 2020 calculation               *
.* V11.00.02 08/04/2020 J.Tan           TSK 0868813                           *
.*           Recompiled for PATINVHL                                          *
.*           15/04/2020 Thanh T         TSK 0879163                           *
.*           Added SEXDSP00                                                   *
.* V11.00.01 20/03/2020  J.Tan          TSK 0838262                           *
.*           Added Effective from and to date to MBS Item file                *
.* V10.15.03 23/10/2019  J.Tan            TSK 0857392                         *
.*           Added Print Bulk ABF invoices                                    *
.* V10.15.01 11/10/2019  Peter Vela       TSK 0882906                         *
.*           Recompiled for OUTCATBI - Fixed I*C for OUTBB1 ABF               *
.* V10.14.01 21/05/2019  J.Tan           TSK 0857392                          *
.*           Recompiled for ABF Invoices                                      *
.* V10.13.03 11/01/2019  Peter Vela     TSK 0867807                           *
.*           Recompiled for OUTCATBI                                          *
.* V10.13.02 26/10/2018  Thanh T        TSK 0859743                           *
.*           Added BULKBILL field and removed OUTHEDFD/OUTHEDIO,              *
.*           OUTSESFD/OUTSESIO for OUTCATBI changes                           *
.* V10.13.01 25/10/2018  Thanh T        TSK 0859743                           *
.*           Added OUTHEDFD/OUTHEDIO, OUTSESFD/OUTSESIO for OUTCATBI          *
.*           changes                                                          *
.*----------------------------------------------------------------------------*
.* V10.12.01 28/02/2018  J.Tan          TSK 0852351                           *
.*           Recompiled for PATINVHL-fields 226 & 227(Program Code/Desc)      *
.* V10.11.02 27/11/2017  Thanh Tieu         TSK 0821710                       *
.*           Recompiled as PATMASTD changed                                   *
.* V10.11.01 25/08/2017  Thanh Tieu         TSK 0821710                       * 
.*           Audit admission/outpatient/UR comments                           *
.*----------------------------------------------------------------------------*
.*       V10.07.02 18/11/2015  J.Tan         CAR 303942                       *
.*                 Added new payment types                                    *
.*       V10.07.01 04/11/2015  Ebon Clements CAR 268970                       *
.*                 Change to use OUTCLIFD index 1 instead of index 2          *
.*       V10.06.05 14/08/2015  J.Tan         CAR 320073                       *
.*                 Recompiled for PATCATAI-reprint invoice for unreleased cash*
.*       V10.06.04 07/08/2015  Davin         CAR 317002                       *
.*                 Recompiled for PRTINVBD - Print pmexname for ADF MO        *
.*       V10.06.03 14/07/2015  Peter Vela     CAR 318700                      *
.*                 Recompiled for PRBILCMN - Validate for deleted VISMDT      *
.*                 record                                                     *
.*       V10.06.02 15/05/2015  Davin         CAR 310155                       *
.*                 Recompiled for PATGBCRN - added MOD10V05 for BPAY          *
.*       V10.06.01 02/04/2015  Ania P         CAR 313236                      *
.*                 Recompiled for PRTINVBD                                    *
.*       V10.05.01 12/01/2014  Peter Vela     CAR 310738                      *
.*                 Recompiled for PRTINVBD                                    *
.*       V10.04.04 01/05/2014  J.Tan          CAR 261630                      *
.*                 Removed PATAUC PATAUM and PATAUF - Audit files             *
.*       V10.04.03 15/04/2014  J.Tan          CAR 261630                      *
.*                 Removed port number from temp file name                    *
.*       V10.04.02 26/02/2014  J.Tan         CAR 275810                       *
.*                 Recompiled for PRTINVBD - to print Defence Force details   *
.*       V10.04.01 20/01/2014  J.Tan         CAR 273713                       *
.                  Recompiled for PRTINVBD -Print payment types of a receipt  * 
.*       V10.03.08 09/12/2013  Ania P        CAR 294740                       *
.*                 Recompiled for PATINVHL                                    *
.*       V10.03.07 12/09/2013  Peter Vela    CAR 271911                       *
.*                 Recompiled for PATINVTL                                    *
.*       V10.03.06 20/06/2013  Davin         CAR 287161                       *
.*                 Recompiled for PATGBCRN - right justify ptcnhbpi           *
.*       V10.03.05 17/04/2013  Don Nguyen    CAR 282342                       *
.*                 Recompiled for PATINVHL, PATINVTL                          *
.*       V10.03.04 09/04/2013  Don Nguyen    CAR 282342                       *
.*                 Recompiled for PATGBCRN, PATINVHL, PATINVTL                *
.*       V10.03.03 18/03/2013  J.Tan         CAR 280802                       *
.*                 Recompiled for PATINVHL - Outpatient HF membership         *
.*       V10.03.02 05/03/2013  Patrick Adair CAR 281898                       *
.*                 Recompiled for PATCATBI PATCATAI                           *
.*       V10.03.01 18/07/2012  Don Nguyen    CAR 264561                       *
.*                 Recompiled for PATGBCRN                                    *
.*       V10.02.01 04/04/2011 Jill Parkinson CAR 239574                       *
.*                 Removed open of ibaprntf                                   *
.*       V10.01.03 13/01/2011  Mike Laming   CAR 233084                       *
.*                 Added include CLPATINV for OUTINVS & Recompiled            *
.*       V10.01.02 21/12/2010  Mike Laming   CAR 233046                       *
.*                 Recompiled for OUTCATBI - Mods to Misc.Charges PATMCHFD    *
.*       V10.01.01 30/10/2010 J.Tan          CAR 233043                       *
.*                 Recompiled for OUTCATBI - mods to print invoice            *
.*       V10.00.01 27/09/2010 J.Tan      CAR 230664                           *
.*                 Recompiled for OUTCATBI - HEC Invoice layout               *
.*       V9.12.03  04/12/2009 Peter Vela CAR 202333                           *
.*                 Recompiled for PATINVHL - Changed variable 88 to           * 
.*                 surname only                                               *
.*       V9.12.02  24/08/2009 J.Tan  CAR 186102                               *
.*                 Recompiled for NZPCATAI -Mods to display Win/Loss after inv*
.*       V9.12.01  28/05/2009  Davin          CAR 186133                      *
.*                 Recompiled for PATGBCRN - Added 2 leading zeros to invno   *
.*       V9.11.02  23/03/2009  Davin         CAR 178015                       *
.*                 Recompiled for PATINVHL - Changed BPAY CRN to use inv. no. *
.*       V9.11.01  14/10/2008  Peter Vela    CAR 159227                       *
.*                 Recompiled for PATINVHL - Added Emergency Invoice          *
.*                 Arrival Date and Time                                      *
.*       V9.09.09  27/12/2007 Peter Vela     CAR 155907                       *
.*                 Recompiled for PATINVTL                                    *
.*       V9.09.08  16/11/2007 Peter Vela     CAR 110766                       *
.*                 Recompiled for PATINVHL                                    *
.*       V9.09.07  12/11/2007 Peter Vela     CAR 151199                       *
.*                 Added new Emergency Cancellation status
.*       V9.09.06  10/08/2007 Peter Vela     CAR 146143                       *
.*                 Recompiled for PATCATAI                                    *
.*       V9.09.05  25/07/2007 Peter Vela     CAR 144787                       *
.*                 Recomipled for PATCATAI                                    *
.*       V9.09.04  03/07/2007 Peter Vela     CAR 142173                       *
.*                 Recompiled for PATCATAI                                    *
.*       V9.09.03  29/06/2007 Peter Vela     CAR 142173                       *
.*                 Recompiled for PATCATAI                                    *
.*       V9.09.02  25/06/2007 Peter Vela     CAR 142173                       *
.*                 Recompiled for PATCATAI                                    *
.*       V9.09.01  15/06/2006  J.Tan         CAR 142173                       *
.*                 Recompiled for PATCATAI - Emergency events                 *
.*       V9.08.07  19/02/2007 Peter Vela     CAR 135241                       *
.*                 Recompiled for WEBDINVS - St. John of God invoice layout   *
.*        V9.08.06  22/02/2007 Mike Laming   CAR 119436                       *
.*                  Add PMSOSDTM (PROC FLAGDEBT) for Outstanding Debt Alert ind.
.*       V9.08.05  07/02/2007  Ebon Clements CAR 120001                       *
.*                 Added nz private billing files                             *
.*       V9.08.04  13/12/2006  J.Tan             CAR 127625                   *
.*                 Mods to JH HRN                                             *
.*       V9.08.03  27/11/2006  Steve Armstrong   CAR 126039                   *
.*                 Recompiled for changes to SGCHKDIG                         *
.*       V9.08.02  16/11/2006  Steve Armstrong   CAR 124160                   *
.*                 Recompiled for PATINVHL (Singapore HRN)                    *
.*                 Recompiled for PATINVTL (Singapore HRN)                    *
.*       V9.08.01  29/09/2006  Peter Vela    CAR 120319                       *
.*                 Recompiled for PATINVHL                                    *
.******************************************************************************
.*       V9.07.05  25/09/2006  Peter Vela    CAR 118940                       *
.*                 Recompiled for PATCATBI                                    *
.*       V9.07.04  20/09/06 J.Tan    CAR 119336                               *
.*                 Added claim code to Suggested classification file          *
.*       V9.07.03  12/09/2006  Jill Habasque CAR 109852                       *
.*                 Added procedure GETALTID                                   *
.*       V9.07.02  02/08/2006  Peter Vela    CAR 113658                       *
.*                 Recompiled for PATINV21 - Fixed Date and Cash Payment      *
.*                 display                                                    *
.*       V9.07.01  25/07/2006  Peter Vela    CAR 113658                       *
.*                 Recompiled for PATCATAI - Fixed "Journal Total" display    *
.*       V9.06.02  16/05/2006  Peter Vela    CAR 104103                       *
.*                 Recompiled for PATCATAI - PTCNINVL=12                      *
.*       V9.06.01  24/04/2006  J.Tan         CAR 102287                       *
.*                 Recompiled for PATINVHL - fields for multi hospital details*
.*       V9.05.02  29/03/2006  Peter Vela    CAR 95780                        *
.*                 Recompiled for PATINVHL - Added emg mobile contact numbers *
.*       V9.05.01  26/03/2006  Peter Vela    CAR 61299                        *
.*                 Recompiled for PATINVHL                                    *
.*       V9.04.12  17/11/2005  Peter Vela    CAR 84547                        *
.*                 Recompiled for PATINVXX subroutines - Removed CLOSE PATFN1A1
.*       V9.04.11  25/10/2005  Sandra Barcham CAR 81362                       *
.*                 Recompiled for OUTINVS - pack fincode correctly for dep.  *
.*       V9.04.10  29/09/2005  Jeni Tan       CAR 77671                       *
.*                 Recompiled for OUTCATBI - print invoice amounts            *
.*       V9.04.09  12/08/2005  Jeni Tan       CAR 62750                       *
.*                 Removed redefined variables                                *
.*       V9.04.08  14/07/2005  Peter Vela     CAR 62172                       *
.*                 Recompiled for PATINVTL                                    *
.*        V9.04.07  17/02/2005  Mike Laming   CAR 56030                       *
.*                  Re-compile for PATINV25 - fix screen painted tail printing*
.*       V9.04.06  06/12/2004  Lina Vo CAR 54561                              *
.*                 Recompiled ofr OUTINVS                                     *
.*       V9.04.05  06/10/2004  J.Tan   CAR 53798                              *
.*                 Removed PATMSCDS                                           *
.*       V9.04.04  04/10/2004  Peter Vela CAR 52906                           *
.*                 Recompiled for PATCATAI                                    *
.*                 23/09/2004  Lina Vo  CAR  53660                            *
.*                 Recompiled for OUTINVS & PATCATAI                          *
.*       V9.04.03  03/09/2004  Lina Vo       52998                            *
.*                 Initialise Page Number for PRTINVHL                        *
.*       V9.04.02  31/08/2004  J.Tan    CAR 53073                             *
.*                 Mods for multi hospital                                    *
.*       V9.04.01  20/08/2004  J.Tan     CAR 52835                            *
.*                 Recompiled for OUTCATBI - Multi hospitals                  *
.*       V9.03.11  06/04/2004  Peter Vela    48227                            *
.*                 Added VARGBCRN and PATGBCRN - BPAY Reference Number        *
.*       V9.03.10  03/02/2004  J.Tan  CAR 45047                               *
.*                 Recompiled for PATCATAI - Non-banked Cash                  *
.*       V9.03.09  19/12/2003 J.Tan   CAR 44093                               *
.*                 Replaced patcashf with comdepaf                            *
.*       V9.03.08  21/11/2003  J.Tan   CAR  44161                             *
.*                 Recompiled for PATCATAI - print credit note                *
.*       V9.03.07  07/11/2003  Peter Vela CAR 44849                           *
.*                 Recompiled for PATINVTL                                    *
.*       V9.03.06  03/11/2003  Peter Vela CAR 44757                           *
.*                 Recompiled for PATINVTL                                    *
.*       V9.03.05  20/10/2003  J.Tan    CAR 44172                             *
.*                 Recompiled for OUTCATBI - Misc.theatre item file(pmsmitaf) *
.*                 29/10/2003 Sandra Barcham   43783                          *
.*                 Recompiled for NZHISIIO and NZHISIUP                       *
.*       V9.03.04  15/09/2003  CAR 40497   Lina Vo                            *
.*                 Recompiled for OUTINVS, OUTCATBI, PATMCHFD & IO.           *
.*        V9.03.03  04/09/2003  CAR 42713   Mike Laming                       *
.*                  Recompiled for PATINVTL (correct GST twice in final Total)*
.*       V9.03.02  30/07/2003  J.Tan                                          *
.*                 Recompile for OUTINVS - WEB Billing                        *
.*       V9.03.01  30/05/2003  J.Tan   CAR 39514                              *
.*                 Recompile for OUTCATBI - checking web servers              *
.*       V9.02.17  28/11/2002  Dean Cramer Defect 33640                       *
.*                 Recompile for OUTINVS & PATDINVS                           *
.*       V9.02.16  06/11/2002  Dean Cramer Defect 23687                       *
.*                 Recompile for OUTCATBI - SVM format adjustment             *
.*       V9.02.15  26/10/2002  Dean Cramer Defect 23755                       *
.*                 Recompile for OUTINVS,PATINVHL - Clinic Name               *
.*       V9.02.14  12/10/2002  Dean Cramer                                    *
.*                 Recompile for OUTINVS,PATDINVS,PATANVS,PATINVHL            *
.*                 Printing of Fund and Claim details.                        *
.*       V9.02.13  25/06/2002  Dean Cramer                                    *
.*                 Recompile for OUTCATBI and OUTINVS - RCH Format            *
.*       V9.02.12  11/06/2002  J.Tan                                          *
.*                 Added patrfn                                               *
.*       V9.02.11  29/05/2002  J.Tan                                          *
.*                 Recompiled for PATINVHL - fixed insurance claim variable   *
.*        V9.02.10  22/05/2002  J.Tan                                         *
.*                  Mods to check parameter to print claim details            *
.*        V9.02.09  07/05/2002  J.Tan                                         *
.*                  Recompiled for release 6.09 changes                       *
.*        V9.02.08  01/03/2002  J.Tan                                         *
.*                  Recompiled for OUTINVS- commented out reading theatre fees*
.*        V9.02.07  10/02/2002  J.Tan                                         *
.*                  Recompiled for OUTINVS- not using theatre fee for oerseas *
.*                             and PATMSCDS- Miscellansous Item search        * 
.*        V9.02.06  07/12/2001  Tonii                                         *
.*                  Recompiled for PATCATAI - Casemix changes                 *
.*        V9.02.05  22.11.2001  J.Tan                                         *
.*                  Mods for view outstanding amount of invoice only          *
.*        V9.02.04  20.11.2001  B.G.Ackland                                   *
.*                  Remove pi's from Program
.*        V9.02.03  01/11/2001  Greg Horvat                                   *
.*                  Recompiled for ACTCOMN1 - Added xtra option to the        *
.*                  parameter PNSWRACE                                        *
.*        V9.02.02  17/10/2001  Dean Cramer                                   *
.*                  Recompiled for OUTINVS, make so printers election at end  *
.*        V9.02.01  22/09/2001  Tonii  SRF 13075                              *
.*                  Recompiled for PATDINVS                                   *
.******************************************************************************
.*        V5.10.B01 23/03/2001  Glenn Saunders                                *
.*                  Remove all references to PATSUR file (old surname file).  *
.*        V5.08.14  22/11/2000  Greg Horvat                                   *
.*                  Recompiled for PATCATAI - Commented out any code to do    *
.*                  with Hong Kong or Mt Alvernia                             *
.*        V5.08.13  09/11/2000  Ebon Clements SRF 6891                        *
.*                  Recompiled for PATINVS read patmchgf with key26           *
.*        V5.08.12  24/10/2000  Dean Cramer   SRF 6710                        *
.*                  Recompiled for OUTCATBI, OUTINVS & PATMSCDS               *
.*                  Changed for health fund table code size increase to       *
.*                  8 characters                                              *
.*        V5.08.11  29/09/2000  Jill Habasque SRF 3060                        *
.*                  Recompiled for PATINVHL                                   *
.*        V5.08.10  19/09/2000  Steve Armstrong   srf 647263                  *
.*                  Recompiled for changes to OUTDSCLN                        *
.*        V5.08.09  16/08/2000  Caleb Sharman                                 *
.*                  Changed Health Fund variables to be 8 chars               *
.*        V5.08.08  24/07/2000  Davin                                         *
.*                  Recompiled for PATINVTL - template multipage invoice tail *
.*        V5.08.07  06/07/2000  Davin                                         *
.*                  Recompiled for PATINVHL, PATINVTL & PATCATAI              *
.*        V5.08.06  05/07/2000  Jill Habasque                                 *
.*                  Recompiled for OUTINVS                                    *
.*        V5.08.05  29/06/2000  Steve Armstrong                               *
.*                  Recompiled for PATCATAI                                   *
.*        V5.08.04  28/06/2000  Steve Downing                                 *
.*                  Recompiled for PATFIGFD/IO                                *
.*        V5.08.03  29/05/2000  Caleb Sharman  SRF 639169                     *
.*                  Recompiled for OUTCATBI                                   *
.*        V5.08.02  17/05/2000  J.Tan                                         *
.*                  Recompiled for OUTCATBI - invoice on landscape            *
.*        V5.08.B09 03/04/2000  Davin                                         *
.*                  Added parameters for invoice templating                   *
.*        V5.08.B08 30/03/2000  Davin                                         *
.*                  Recompiled for invoice templating                         *
.*        V5.08.B07 14/03/2000  Greg Horvat                                   *
.*                  Recompiled for PATINVT3 & PATINVT7                        *
.*        V5.08.B06 13/03/2000  Steve Armstrong  5.08 Mods                    *
.*                  Mods for changes to OUTCLIFD (effective date)             *
.*        V5.08.B05 07/03/2000  J.Tan                                         *
.*                  Mods for GST                                              *
.*        V5.08.B04 29/02/2000  Greg Horvat                                   *
.*                  Recompiled for PATINVT3 & PATINVT7 - Moved the getting of *
.*                  the primary disease code to a procedure                   *
.*        V5.08.B03 29/02/2000  Jill Habasque                                 *
.*                  GST Mods                                                  *
.*        V5.08.B02 25/02/2000  Greg Horvat                                   *
.*                  Recompiled for PATINVT5                                   *
.*        V5.08.B01 22/02/2000  Steve Downing                                 *
.*                  Mods to initialise GST variables                          *
.******************************************************************************
.*        V5.07.02  15/10/1999  Steve Armstrong                               *
.*                  Removed reference to CSTRTYR (not used)                   *
.*        V5.07.01  21/06/1999  J.Tan  SRF 632459                             *
.*                  Recompiled for PATCATAI - printing accommodation          *
.*        V5.07.B04 19/01/1999  Nicole Harrington 507 rebound 096             *
.*                  Mods to defaut to current date in call to KEYDATE         *
.*        V5.07.B03 13/01/1999  Jim Stathopoulos                              *
.*                  Fixed Global Compile Errors                               *
.*        V5.07.B02 09/12/1998  Jim Stathopoulos                              *
.*                  Additional 507 Changes                                    *
.*        V5.07.B01 29/10/1998  Jim Stathopoulos                              *
.*                  507 Changes                                               *
.******************************************************************************
.*        V5.05.02  02/12/1997  Nick    SRF 622716                            *
.*                  Fixed printing of blank page after each invoice - WGH     *
.*        V5.05.01  14/10/1997  Steve Armstrong    SRF 643393                 *
.*                  Recompiled for removal of THC invoice message             *
.******************************************************************************
.*        V5.04.05  14/06/1997  Steve Armstrong                               *
.*                  Fixed bugs in global recompile                            *
.*        V5.04.04  02/05/1997  Steve Armstrong   SRF 642857                  *
.*                  Changed temp file names to standard format                *
.*        V5.04.03  16/11/1996  Greg Horvat      SRF 616143 (Rebound)         *
.*                  Recompiled for PATINV17 - Changes to invoice tail         *
.*        V5.04.02  22/07/1996  Steve Armstrong  SRF 641785                   *
.*                  Recompiled for changes to PATINV15                        *
.*        V5.04.01  15/06/1996  Greg Horvat      SRF 616143                   *
.*                  Recompiled for OUTCATBI, OUTINVS, PATCATAI & PATINV17 -   *
.*                  Added new invoice layout for MBF - layout 17              *
.*                                                                            *
.* ************************************************************************** *
.*                                                                            *
.*        V5.01.01  14/07/1989  S. O'Gorman                                   *
.*                  Converted for N.Z.                                        *
.*                  16/08/1989  Graeme Williams                               *
.*                  New PATSRCH routine                                       *
.*        V5.01.02  25/08/1989  Graeme Williams                               *
.*                  Added GST to OUTCATBI                                     *
.*        V5.01.03  30/08/1989  Graeme Williams                               *
.*                  New PATCOMN1 routine                                      *
.*        V5.01.04  15/09/1989  K.Peak            SRF 102329                  *
.*                  Fixed display of U/R Number                               *
.*        V5.01.05  19/09/1989  Graeme Williams   SRF 102348, 102346          *
.*                  Changes to PATCATAI                                       *
.*        V5.01.06  20/09/1989  Graeme Williams   SRF 101341, 101345          *
.*                  Changes to PATINVS                                        *
.*        V5.01.07  29/09/1989  S.Barcham         SRF 102239                  *
.*                  Fixed Continued Line-up                                   *
.*        V5.01.08  07/12/1989  E.Phan                                        *
.*                  Altered IBAPRNFD                                          *
.*        V5.01.09  16/01/1990  K.Peak            SRF 103661                  *
.*                  Fixed the printing of St. And Melbourne invoices PATCATAI *
.*        V5.01.10  17/01/1990  K.Peak                                        *
.*                  Fixed the reprinting of SAM invoices                      *
.*        V5.01.11  24/01/1990  K.Peak            SRF 103736                  *
.*                  Changed Site id to Site Id                                *
.*        V5.01.12  14/02/90  J.Tan      SRF 102921                           *
.*                  Recompiled for OUTINVS                                    *
.*        V5.01.13  16/02/90  J.Tan      SRF 103832                           *
.*                  Fixed OUTIOBOB, position of Port No.                      *
.*        V5.01.14  07/03/1990  Steve O'Gorman    SRF 102417                  *
.*                  Looped through all outpatient visits for a given U/R No.  *
.*        V5.01.15  15/05/90  J.Tan      SRF 104959                           *
.*                  Mods deposit date of the financial summary                *
.*        V5.01.16  22/05/90  J.Tan      SRF 104901                           *
.*                  Added 8 new theatre classifications                       *
.*        V5.01.17  04/06/90  J.Tan      SRF 105171                           *
.*                  Changed MBSLOP to FORM2                                   *
.*        V5.01.18  06/06/1990  D.Di.Paola        SRF 103773                  *
.*                  Recompiled for changes to AAECONFD                        *
.*        V5.01.19  11/07/1990  Paul Duncan                                   *
.*                  Recompiled for OUTBOA & OUTBOB audit                      *
.*        V5.01.20  25/07/1990  Paul Duncan                                   *
.*                  Implemented second surname file                           *
.*        V5.01.121 15/01/91  J.Tan      SRF 107488                           *
.*                  Recompiled for AAEINVS                                    *
.*        V5.01.122 22/01/91  J.Tan      SRF 107540                           *
.*                  Recompiled for PATINVT7                                   *
.*        V5.01.123 22/05/1991  Steve O'Gorman                                *
.*                  Fixed errors found by the New Compiler                    *
.*        V5.01.124 08/07/91  J.Tan      SRF 109291                           *
.*                  Fixed site for option by dates range                      *
.*        V5.01.125 09/12/91  J.Tan      SRF 112127                           *
.*                  Fixed I*C patipen on multiple O/Patients                  *
.*        V5.01.126 14/01/1992  Graeme Williams                               *
.*                  New Zealand billing changes.                              *
.*                  Added option for single clinic.                           *
.*        V5.01.127 31/01/1992  Graeme Williams                               *
.*                  Altered invoice layouts                                   *
.*        V5.01.128 23/03/92  J.Tan      SRF 113203                           *
.*                  Recompiled for OUTCATBI (V5.01.02)                        *
.*        V5.01.129 07/04/92  J.Tan      SRF 114007                           *
.*                  Recompiled for OUTCATBI (V5.01.03)                        *
.*        V5.01.130 12/06/92  Graeme Williams     SRF 114865                  *
.*                  Changes for 9 character miscellaneous items               *
.*        V5.01.131 26/06/1992  i chung           SRF 115282                  *
.*                  Recompiled for OUTINVS (V5.01.08)                         *
.*        V5.01.132 05/11/1992  Graeme Williams                               *
.*                  Recompiled because No. of Services was added to the DTR   *
.*        V5.01.133 06/11/1992  Graeme Williams                               *
.*                  Recompiled for OUTCATBI   (5.01.05)                       *
.*        V5.01.134 11/10/92 J.Tan       SRF 118688                           *
.*                  U/R option to allow screen outpatients without any invoice*
.*        V5.01.135 23/11/1992  Justin Coates   (HONG KONG changes)           *
.*                  Re-compile for OUTINVS/PATINV10                           *
.*        V5.01.136 27/11/1992  Justin Coates   (HONG KONG changes)           *
.*                  Recompiled for PATINV10 (line12)                          *
.*        V5.01.137 02/12/1992  Justin Coates   (HONG KONG)                   *
.*                  Added OTCNPZIN for printing zero invoices                 *
.*        V5.01.138 03/12/1992  Justin Coates   (HONG KONG)   SRF 119220      *
.*                  Add chinese name, HK id and patient name to header        *
.*        V5.01.139 03/12/1992  Justin Coates   (HONG KONG)   SRF 119220      *
.*                  Start the printing immediately ie no *N's                 *
.*        V5.01.140 03/12/1992  Justin Coates   (HONG KONG)   SRF 119225      *
.*                  re-comp for PATINV10 - print unit price                   *
.*        V5.01.141 08/12/1992  Justin Coates   (HONG KONG)   SRF 119318      *
.*                  re-comp for OUTINVS - setting up of AMDATE                *
.*        V5.01.142 14/12/1992  Graeme Williams   SRF 119448                  *
.*                  Recompiled for PATINV10                                   *
.*        V5.01.143 18/12/92  J.Tan      SRF 119597                           *
.*                  Recompiled for OUTINVS                                    *
.*        V5.01.144 23/12/92  J.Tan      SRF 119673, 119674                   *
.*                  Recompiled for PATINV10                                   *
.*        V5.01.145 05/01/1993  Graeme Williams                               *
.*                  Recompiled for PATINV10                                   *
.*        V5.01.146 06/01/93  DIG                           Quote 7522        *
.*                  Added new value to PTCNINVL for Anne Caudle               *
.*        V5.01.147 06/01/1993  Graeme Williams                               *
.*                  Removed Anne Caudle invoice layout so OUT66 would compile *
.*        V5.01.148 02/02/93  J.Tan      SRF 120426                           *
.*                  Recompiled for PATINV10                                   *
.*        V5.01.149 28/01/1993  Justin Coates     SRF 120071                  *
.*                  Recompiled for PATINV10                                   *
.*        V5.01.150 04/02/1993  Justin Coates     SRF 120070, 120071          *
.*                  Recompiled for PATINV10                                   *
.*        V5.01.151 07/01/1993  Whirlpool                                     *
.*                  Dudley Address Changes                                    *
.*        V5.01.152 15/02/93  J.Tan      SRF 120626                           *
.*                  Recompiled for PATINV10                                   *
.*                  15/02/93  J.Tan      SRF 120630                           *
.*                  Recompiled for OUTINVS                                    *
.*                  Mods to check the patient's site to the entered site      *
.*        V5.01.153 17/02/93  J.Tan      SRF 120769                           *
.*                  Mods U/R option to display invoices for today visit only  *
.*        V5.01.154 22/02/93  J.Tan      SRF 120657                           *
.*                  Added parameter OTCNIVUR - to display zero invoice amount *
.*                  and site & clinic id on the screen by U/R number          *
.*        V5.01.155 10/05/93  J.Tan      SRF 122451                           *
.*                  Recompiled for OUTINVS                                    *
.*        V5.01.156 28/05/93  J.Tan      SRF 120832                           *
.*                  Allows multiple items for non-fixed items                 *
.*        V5.01.157 22/06/93  Rob. Sumsion      SRF 122783                    *
.*                  Recompiled for PATINVS & OUTINVS changes                  *
.*        V5.01.158 29/06/93  Rob. Sumsion      SRF 122783                    *
.*                  Recompiled for PATINVS & OUTINVS changes                  *
.*        V5.01.159 07/07/93  DIG               SRF  123629; 123541           *
.*                  Fixed problem with Person Responsible for Account getting *
.*                  wiped when the PATRE1A1 file is opened.                   *
.*        V5.01.160 09/07/1993  i chung           SRF 123659                  *
.*                  Recompiled for PATINV10                                   *
.*        V5.01.161 11/08/1993  Glenn Berry      SRF 122092                   *
.*                  Recompiled for PATINVT8                                   *
.*        V5.01.162 19/08/1993  Glenn Berry   Bulletin 27  SRF 117999         *
.*                  Recompiled for OUTINVS changes                            *
.*                  Added read of PTCNPAOF                                    *
.*        V5.01.165 30/08/1993  Steve Armstrong    SRF 122092                 *
.*                  Recompiled for NZHIS                                      *
.*        V5.01.164 27/08/93  ROD                                             *
.*                  Recompiled for NZHIS                                      *
.*        V5.01.165 15/11/1993    Justin Coates                               *
.*                  added PATALRFD so it would compile                        *
.*        V5.01.166 24/11/1993  Glenn Berry      Hawkes Bay Changes           *
.*                  Added PATINV13                                            *
.*        V5.01.167 14/01/1994  Sandra Barcham                                *
.*                  Recompiled for global                                     *
.*        V5.01.168 28/01/1994  Glenn Berry      Hawkes Bay Changes           *
.*                  Recomplie for OUTINVS (fixed not printing invoice number) *
.*        V5.01.169 23/03/1994    Matt Surridge                               *
.*                  Recompile for NZHISIIO and DONORDET.                      *
.*        V5.01.170 05/04/1994  Steve Armstrong                               *
.*                  Recompiled for OUTINVS                                    *
.*                  Standards Upgrade                                         *
.*        V5.01.171 24/05/1995  Matt Surridge                                 *
.*                  Fixed bugs for global recompile.                          *
.*        V5.01.172 21/07/1994  Rob Leonard  SRF 130881                       *
.*                  Recompiled for PATINV12                                   *
.*        V5.01.173 02/08/1994  Rob Leonard  Quote 8064                       *
.*                  Recompiled for PATINV15                                   *
.*        V5.01.174 12/08/1994  Rob Leonard                                   *
.*                  Changed Taranaki invoice layout to be GST inclusive       *
.*        V5.02.01  30.11.1994    B.G.Ackland                                 *
.*                  Remove Date of Death Link to NHI/MWS                      *
.*                  Recompile for Latest NHI/MWS Changes                      *
.*        V5.02.02  14/02/1995  Greg Horvat      SRF 134920 134922 134932     *
.*                  Recompiled for IBAPRINT                                   *
.*        V5.02.03  20/02/1995  Greg Horvat      SRF 134879                   *
.*                  Recompiled for PATAUMFD & PATIOAUM - added new variable & *
.*                  changed to write to this new variable                     *
.*        V5.02.04  22/02/1995  Greg Horvat      SRF 135134                   *
.*                  Recompiled for PATCATAI - Changed printing of E.F.R.      *
.*        V5.02.05  02/03/1995  Greg Horvat      SRF 134196  Quote 8277       *
.*                  Recompiled for PATCALFN & OUTCATBI                        *
.*        V5.02.06  14/03/1995  Greg Horvat      SRF 134573  Quote 8300       *
.*                  Recompiled for PATBNKFD & PATIOBNK - Added PTBFRDTE       *
.*        V5.02.07  19/04/1995  Steve Armstrong                               *
.*                  Recompiled                                                *
.*        V5.02.08  28/04/1995  Paul Howells         SRF 134946               *
.*                  Recompiled for changes to PATINVS                         *
.*        V5.03.B2  24/05/1995  Paul Howells     SRF 134644                   *
.*                  Check whether using invoice pending file before writing.  *
.*        V5.03.01  01/08/1995  Greg Horvat      SRF 610897                   *
.*                  Recompiled for PATCATAI - Changed Port Mac. A&E invoice   *
.*                  reprints to print the attending doctor in the body of the *
.*                  invoice                                                   *
.*        V5.03.02  17/08/1995  Paul Howells     SRF 611251                   *
.*                  Moved PTCNIPEN
.*                                                                            *
.******************************************************************************
.
          INC       STD001FD
          INC       STDHLPDF
          INC       STDKWSDF
          INC       TFILEVAR/INC                 * Generate Temp File Name
          INC       WEBERRFD/INC                 * Web Server Error Logging
          INC       CHKCLDCD/INC
.
          INC       CHKDIGVR/INC
          INC       EMRHISFD/INC
          INC       EMRVISFD/INC
          INC       IBAGSTFD/INC
          INC       IBAGEDFD/INC
          INC       AAEDE1FD/INC
          INC       AAEDTRFD/INC
          INC       AAECONFD/INC
          INC       BOKRC1FD/INC
          INC       EMRCONFD/INC
          INC       IBACONFD/INC
          INC       IBAPRNFD/INC
          INC       IBATMDFD/INC
          INC       IBATMHFD/INC
          INC       MLTCFNFD/INC
          INC       NZHISIFD/INC       * for NZIBSRCH
          INC       NZPCFNFD/INC
          INC       NZPFIGFD/INC
          INC       NZPFINFD/INC
          INC       NZPIVBFD/INC
          INC       NZPRFNFD/INC
          INC       NZPRDTFD/INC
          INC       NZPSPRFD/INC
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       OUTCLIFD/INC
          INC       OUTCONFD/INC
          INC       OUTDTRFD/INC
          INC       OUTPREFD/INC
          INC       OUTSITFD/INC
          INC       OUTHTRFD/INC
          INC       OPRARDFD/INC
          INC       OPRDEAFD/INC
.
          INC       PATCALAG/INC
          INC       PATCOMM/INC
          INC       PATCMXFD/INC
          INC       PATCRAFD/INC
          INC       PATDHEAD/INC
          INC       PATDINVS/INC
          INC       PATINLFD/INC
          INC       PATALRFD/INC
          INC       VISMDTFD/INC
          INC       PATMISTD/INC
          INC       PATMASTD/INC
          INC       PATCODFD/INC
          INC       PATCONFD/INC
          INC       COMDEPFD/INC
          INC       PATDO1FD/INC
          INC       PATDRGFD/INC
          INC       PATDSCFD/INC
          INC       PATDTRFD/INC
          INC       PATECDFD/INC
          INC       PATREMFD/INC
          INC       PATRFNFD/INC
          INC       PATRFGFD/INC
          INC       PATFIGFD/INC
          INC       PATFINFD/INC
          INC       PATFN1FD/INC
          INC       PATFX1FD/INC
          INC       PATGSRFD/INC
          INC       PATIBLFD/INC
          INC       PATICDFD/INC
          INC       PATIN1FD/INC
          INC       PATINVFD/INC
          INC       PATIPEFD/INC
          INC       PATIPRFD/INC
          INC       PATIRNFD/INC
          INC       PATITMFD/INC
          INC       PATMA1FD/INC
          INC       PMSABFFD/INC
          INC       PMSPX2FD/INC
          INC       PMSEXTFD/INC
          INC       PMSEVTFD/INC
          INC       PMSHCPFD/INC
          INC       PMSTLEFD/INC
          INC       PATMCHFD/INC
          INC       PATMI1FD/INC
          INC       NHIMASFD/INC       * for PATSRCH
          INC       PATEDTFD/INC
          INC       PATPR1FD/INC
          INC       PATRE1FD/INC
          INC       PATTFEFD/INC
          INC       PATTRNFD/INC
          INC       PATVISFD/INC
          INC       PATWC1FD/INC
          INC       PATWMAFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       PMSCNOFD/INC
          INC       PMSFCIFD/INC
          INC       PMSMTIFD/INC
          INC       PMSVX1FD/INC
          INC       PMSPRGFD/INC
          INC       PATDNRFD/INC
          INC       PATHSPFD/INC
          INC       PATSDNFD/INC
          INC       PATSMWFD/INC
          INC       PATNIDFD/INC
          INC       RCPBNKFD/INC
          INC       RCPBDTFD/INC
          INC       RCPCRSFD/INC
          INC       RCPDTEFD/INC
          INC       SCRPSTFD/INC
          INC       VARGBCRN/INC          * I-48227
          INC       VISPAYFD/INC
          INC       WEBSECFD/INC
.
          INC       NZPMCHFD/INC
          INC       NZPMXCFD/INC
+
.
GSTCODE    DIM       6 
GSTAPP     FORM      1
.-----------------------------------------------------------------------
.
ADIAG     DIM       50
ADMISSNO  DIM       8
.
CMDLINE   DIM       50
CN        INIT      "CN"
BULKBILL  DIM       1
CODE      DIM       2
CODEADM   INIT      "A "
CODEA     INIT      "A "
CODEBT    INIT      "BT"
CODECL    INIT      "CL"
CODEDP    INIT      "DP"
CURSESS   DIM       16
CURRDATE  DIM       8
.
DAYSDIFF  FORM      2
DOCTCODE  DIM       6
DOCFNAME  DIM       50
DIM5A     DIM       5
DIM9      DIM       9
DIM12     DIM       12
DIM12A    DIM       12
DIM18A    DIM       18
DNAME     DIM       20
.
FMTTITLE  DIM       10
FMTGNAME  DIM       35
FMTSNAME  DIM       35
FHDUDT1   DIM       8
FHDUDT2   DIM       8
FORM5     FORM      5
FRSTGNAM  DIM       40
FULLGNAM  DIM       80
.
HJNL      DIM       2
HOSPID    DIM       3
HDUDAY1   FORM      3                  * High Dependency
HDUDAY2   FORM      3
HDUFLG    FORM      "0"
.
LWCHG     FORM      6.2                * Labour Ward Fee
LWCODE    INIT      "LW"
LWDT      DIM       8
.
MAMLFLAG  FORM      1
MAXSEPDY  FORM      "35"
MBS1      DIM       9
MBS2      DIM       9
MBS3      DIM       9
MBSDT1    DIM       8
MBSDT2    DIM       8
MBSDT3    DIM       8
MBSCH1    DIM       9
MBSCH2    DIM       9
MBSCH3    DIM       9
MBSLOP    FORM      2
MBSNUM    FORM      "0"
MENUTYPE  DIM       2
MODE1     DIM       1
NMPNUMB   DIM       20                 * used in PATSRCH
.
OTCHG1    FORM      6.2
OTCHG2    FORM      6.2
OTCODE    INIT      "OT"
OTDESC1   DIM       15
OTDESC2   DIM       15
OTDT1     DIM       8                  * Other Items
OTDT2     DIM       8
OTFLG     FORM      "0"
.
RADLFLAG  FORM      1
.
SAVKEY12  DIM       12
SAVECOL   FORM      2
SAVVERT   FORM      2
SAVHTOP   FORM      2
SCNDGNAM  DIM       40
SERVDOCT  DIM       10
SURGFLG   FORM      "0"
.
TFFSAMNT  FORM      12.2
THDUDT1   DIM       8
THDUDT2   DIM       8
THEACHG   FORM      6.2                * Theatre Fee
THEADT    DIM       8
THEADTE   DIM       8
.
USERID    DIM       10
.
DIM1A     DIM       1
DIM2A     DIM       2
DIM4      DIM       4
DIM14     DIM       14
DIM14A    DIM       14
DIM18     DIM       18
DIM30     DIM       30
DIM40     DIM       40
.
ENDDTE    DIM       8
ENDNAM    DIM       6
.
FNAMEI    DIM       8
.
ITEMCD    FORM      1
.
KEY12A    DIM       12
KEYFLAG   FORM      1
.
LASTREC   FORM      "0"
LINECNT   FORM      2
LNO       FORM      2
.
MINOWE    FORM      8.2
MULTAMT   FORM      8.2
MINFLD    FORM      2
MAXSCRN   FORM      2
.
OUT       INIT      "out"
ONAME     DIM       30
OPERCODE  DIM       4
.
PAGECNT   FORM      3
PSTROL    FILE      ASCII, FIXED=256
.
RCCNSTRF  DIM       1        * Display Statement Reference
.
REGIST8   DIM       2
.
SAVSITE   DIM       6
SMCHARGE  DIM       9
SMITMTYP  FORM      1
SMMSCGRP  DIM       3
SADMNO    DIM       8
SAVADM    DIM       8
SAVDAT    DIM       8
SAVITEM   DIM       4
SAVMAMT   FORM      6.2
SAVTYP    FORM      1
SEC       FORM      5
SELFLG    FORM      "0"
SP12      INIT      "            "
SP14      INIT      "              "
SPLING    FORM      2
STRTDAT   DIM       8
STRTNAM   DIM       6
.
TAMTT     FORM      6.2
TAMTP     FORM      6.2
TEMPAMT   FORM      6.2
THCFLG    FORM      2
THFUND    FORM      6.2
TPADM     FORM      6
TPREC     DIM       8
TPTRNO    FORM      3
TPUR      DIM       8
.
.TODATE    DIM       8
.
VCLIN     DIM       6
VSITE     DIM       6
.
WDATE1    DIM       8
WDATE2    DIM       8
WORK      FILE      ASCII, FIXED=256
.
XAMT      FORM      4.2
XMBS      FORM      5
XDESC     DIM       30
XXADM     DIM       8
XXDATE    DIM       8
XXMULT    FORM      2
XXNAM     DIM       22
.
.         Web Variables (only the include files use these variables)
.
DAYFORMT  DIM       4
NJAN      INIT      "January"
NFEB      INIT      "February"
NMAR      INIT      "March"
NAPR      INIT      "April"
NMAY      INIT      "May"
NJUN      INIT      "June"
NJUL      INIT      "July"
NAUG      INIT      "August"
NSEP      INIT      "September"
NOCT      INIT      "October"
NNOV      INIT      "November"
NDEC      INIT      "December"
.
HTMLFILE  FIFO      ASCII, FIXED=250
MTHNAM3   DIM       3
MTHNAM3A  DIM       3
.
.         end web variables
.
ZTWO      FORM      "00"
ZEIGHT    INIT      "00000000"
Z15       INIT      "zzzzzzzzzzzzzzz"
Z20       INIT      "ZZZZZZZZZZZZZZZZZZZZ"
.
.
.----------------------------------------------------------------------
PRGID     INIT      "IBAOUT20"
PRGNAM    INIT      "Print Outpatient Invoices"
VERSION   INIT      "V12.00.04"
.----------------------------------------------------------------------
+
.         DISPLAY SCREEN HEADER AND OPEN FILES
.
          CALL      DISPHEAD
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          DISPLAY   *P56:24,"Opening outsitaf";
          OPEN      OUTSITA1,"outsitaf"
.
          DISPLAY   *P64:24,"ibagstaf";
          OPEN      IBAGSTA1,"ibagstaf"
          OPEN      IBAGSTA2,"ibagstaf"
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patdo1af";
          OPEN      PATDO1A1,"patdo1af"
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH1,"patdschf"
.
          DISPLAY   *P64:24,"patfinsf";
          OPEN      PATFINS1,"patfinsf"
.
          DISPLAY   *P64:24,"patgsrnf"
          OPEN      PATGSRN2,"patgsrnf"
          OPEN      PATGSRN3,"patgsrnf"
          OPEN      PATGSRN4,"patgsrnf"
.
          DISPLAY   *P64:24,"patirnge";
          OPEN      PATIRNG1,"patirnge"
.
          DISPLAY   *P64:24,"patitemn";
          OPEN      PATITEM1,"patitemn"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
          DISPLAY   *P64:24,"patmx1af";
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY   *P64:24,"pmspx2af";
          OPEN      PMSPX2A1,"pmspx2af" 
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A1,"patmi1af"
.
          DISPLAY   *P64:24,"patwr1af";
          OPEN      PATWR1A1,"patwr1af"
.
          DISPLAY   *P64:24,"patpramf";
          OPEN      PATPR1A1,"patpr1af"
          OPEN      PATPX1A1,"patpx1af"
.
          DISPLAY   *P64:24,"patre1af";
          OPEN      PATRE1A1,"patre1af"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
.
          DISPLAY   *P64:24,"pmsmtiaf";
          OPEN      PMSMTIA1,"pmsmtiaf"
.
          DISPLAY   *P64:24,"patfx1af";
          OPEN      PATFX1A1,"patfx1af"
.
          DISPLAY   *P64:24,"pmsvx1af";
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"oprardaf";
          OPEN      OPRARDA1,"oprardaf"
.
          DISPLAY   *P64:24,"oprdetaf";
          OPEN      OPRDETA1,"oprdetaf"
.
          DISPLAY   *P64:24,"oprdetaf";
          OPEN      OPRDETA2,"oprdetaf"
.
          DISPLAY   *P64:24,"patedtaf";
          OPEN      PATEDTA1,"patedtaf"
.
          DISPLAY   *P64:24,"mltcfnaf"
          OPEN      MLTCFNA1,"mltcfnaf"
          OPEN      MLTCFNA2,"mltcfnaf"
.
          DISPLAY   *P64:24,"nzprfnaf"
          OPEN      NZPRFNA1,"nzprfnaf"
          OPEN      NZPRFNA2,"nzprfnaf"
.
          DISPLAY   *P64:24,"nzpfigaf"
          OPEN      NZPFIGA1,"nzpfigaf"
          OPEN      NZPFIGA2,"nzpfigaf"
.
          DISPLAY   *P64:24,"nzpfinaf"
          OPEN      NZPFINA1,"nzpfinaf"
          OPEN      NZPFINA2,"nzpfinaf"
.
          DISPLAY   *P64:24,"vispayaf";
          OPEN      VISPAYA1,"vispayaf"
          OPEN      VISPAYA2,"vispayaf"
.
          OPEN      WEBSECA1,"websecaf"
          OPEN      PATIPEN1,"patipenf"
.
          DISPLAY   *P64:24,"pmshcpaf";
          OPEN      PMSHCPA1,"pmshcpaf"
.
          DISPLAY   *P64:24,"pmsevtaf";
          OPEN      PMSEVTA1,"pmsevtaf"
.
          DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,SEVENTY9;*248,PTCNIPEN
          READ      CONTROLF,NINTY8;*148,PTCNINVB
.
.         Read in parameters
.
          READ      CONTROLF,ZERO;*2,CDD,CMM,CYY,CCC:
                                  *43,IBCNMHOS:
                                  *85,IBCNUGST
          READ      CONTROLF,TEN;*66,CINVLAY,*79,CAPPRVNO:
                                 *94,CAGECOFF,*96,CNEXTINV:
                                *166,CMEMB
          READ      CONTROLF,TEN3;CHADD1,CHADD2,CHPOST,CHPADD1,CHPADD2,CHPPOST:
                                  CHTELEB,*211,CINV1ST,*245,CHOSTYP
          READ      CONTROLF,TEN4;CNOCLMS,CINMES1,CINMES2:
                             *228,CINVFF,*245,CMAXINV
          READ      CONTROLF,TWENTY;*193,PTCNDCLM,*198,PTCNPIOP
          READ      CONTROLF,TWENTY1;*51,PTCNINVL,*60,PTCNCCRR,PTCNCLOR:
                                    *136,PTCNMITM,*138,PTCNNHII,*174,PTCNDONR:
                                    *178,PTCNMPTR,*190,PTCNPCON:
                                    *200,PTCNICRA,*235,PTCNDPL8,*237,PTCNPAOF
          READ      CONTROLF,THIRTY;*132,HSTANDM,HINVDES
          READ      CONTROLF,THIRTY1;*163,OTCNFTYP,OTCNCFEE,*203,OTCNPZIN:
                                     *219,OTCNIVUR
          MOVE      ZERO,OTCNIVUR    * No display of invoice
.
          READ      CONTROLF,THIRTY2;*57,OTCNOTIH,*63,OTCNOTIT
          READ      CONTROLF,FIFTY9;*66,CGSTPERC,CGSTITEM
          READ      CONTROLF,SEVENTY9;*68,PTCNMFEE,PTCNJFEE
          READ      CONTROLF,EIGHTY;*248,PTCNPEFR
          READ      CONTROLF,EIGHTY8;*86,CDAILYDT
          READ      CONTROLF,HUND28;*105,PTCNUABF
          READ      CONTROLF,HUND30;*1,PTCNHABN
.
          UNPACK    CDAILYDT,XCENT,XYEAR,XMON,XDAY
          MOVE      XCENT,CC
          MOVE      XYEAR,YY
          MOVE      XMON,MM
          MOVE      XDAY,DD
. 
          MOVE      ZERO,PRABFINV
          MATCH     SP3,PTCNDCLM
          GOTO      INIT0200 IF NOT EQUAL
          MOVE      "0  ",PTCNDCLM
.
.         Setting DISPROG to a one means that the comments maintenance will
.         not lock or unlock the Out Patient record (which doesn't exist for
.         outpatients anyway)
.
INIT0200  MOVE      ONE,DISPROG
.
.         Select the printer to be used
.
          MATCH     "IBARSH",PGM
          GOTO      START IF EQUAL
.
          CALL      SELPRINT
          MOVE      CPRTFLG,SPLING          * Save the spooling flag
+
.         START OF PROGRAM
.
START     HLINE     *G37,2,53,80
          DISPLAY   *P1:3,*EF:
                  *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                   *P1:5,*V2LON,ONE,*HOFF," = Line-up Print":
                   *P1:6,*V2LON,TWO,*HOFF," = Single Patient by Outpatient No.":
                 *P1:7,*V2LON,THREE,*HOFF," =                by U/R Number":
                  *P1:8,*V2LON,FOUR,*HOFF," = All Outpatients in a given ":
                                          "date range":
                  *P1:9,*V2LON,FIVE,*HOFF," = All Outpatients owing at ":
                                          "least X dollars":
                  *P1:10,*V2LON,SIX,*HOFF," = All Attendees for a given ":
                                          "clinic and date";
.
          MATCH     "1",PTCNUABF
          IF        @EQUAL
           DISPLAY *P1:11,*V2LON,SEVEN,*HOFF," = Bulk ABF Invoice for a given ":
                                          "date range";
          ENDIF
.
          DISPLAY   *P1:13,"Select Option : ";
.
START1    KEYIN     *P17:13,*EL,*V2LON,OPTION;
.
          COMPARE   ZERO,OPTION
          GOTO      ENDIT IF EQUAL
.
          MOVE      ZERO,WEBFLAG
          MATCH     "IBARSH",PGM
          IF        @EQUAL
            MOVE      ONE,WEBFLAG
          ENDIF
.
REPEAT    MATCH     "1",PTCNUABF
          IF        @EQUAL
            BRANCH    OPTION,START,OPTION2,OPTION3,OPTION4,OPTION5,OPTION6:
                             OPTION4
          ELSE
            BRANCH    OPTION,START,OPTION2,OPTION3,OPTION4,OPTION5,OPTION6
          ENDIF
          BEEP
          GOTO      START1
.
.        This is used when returning from options 2 to 6
.
REPEAT1   MOVE      ZERO,PRABFINV
          MATCH     "1",PTCNUABF
          IF        @EQUAL
            BRANCH    OPTION,REPEAT,REPEAT,OPT3LP1,OPT4400,OPT5C,OPT6400:
                             OPT4400
          ELSE
            BRANCH    OPTION,REPEAT,REPEAT,OPT3LP1,OPT4400,OPT5C,OPT6400
          ENDIF
          GOTO      REPEAT
+
.------------------------------------------------------------------------------
.        Option 2
.------------------------------------------------------------------------------
OPTION2   MOVE      SP70,OBAOUTNO
          DISPLAY   *P53:2,*V2LON,"- Patient by Outpatient No. ",*P1:3,*EF;
.
          KEYIN     *P1:4,"Outpatient : ",*EL,*V2LON,OBAOUTNO;
          GOTO      START IF EOS
.
          MATCH     SP70,OBAOUTNO
          GOTO      START IF EQUAL
.
          MATCH     ZEROVISN,OBAOUTNO
          GOTO      START IF EQUAL
.
.        Read in visit record
.
          MOVE      OBAOUTNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD OF INVVIST
.
.        Read in Master file record record
.
          MOVE      PVIURNO,PURNO
          MOVE      PURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF INVURNO
.
          CALL      GUSR0000                * get web user id
.
          CALL      GETB0000                 * Get patient details
          BRANCH    OVRCD,INVADMN
.
          GOTO      PRINTLN
+
.------------------------------------------------------------------------------
.        Option 3
.------------------------------------------------------------------------------
OPTION3   DISPLAY   *P53:2,*V2LON,"- Patient by U/R ",*P1:3,*EF:
                    *P1:4,"U/R Number : ";
.
          MOVE      TEN4,CCOL
          MOVE      FOUR,CVERT
          MOVE      TWO,SRCHOPT
          MOVE      ZERO,SRCHSYS
.
          CALL      KURN
.
          BRANCH    EXIT,START
          BRANCH    OVRCD,INVURNO
.
          MATCH     ZEROUR,PURNO
          GOTO      START IF EQUAL
.
          CALL      GUSR0000                * get web user id
.
          MOVE      PURNO,PVIURNO
.
.       Find the last Outpatient Number that has an invoice pending
.
          OPEN      PATVISA2,"patvisaf"
          CALL      RSPTVS00  
          CALL      RNPTVS00
          BRANCH    OVRCD OF INVPAID1
          MATCH     PURNO,PVIURNO
          GOTO      INVPAID1 IF NOT EQUAL
          GOTO      OPT3LP2
.
OPT3LP1   CALL      RNPTVS00
          BRANCH    OVRCD OF INVPAID2
.
          MATCH     PURNO,PVIURNO
          GOTO      INVPAID2 IF NOT EQUAL
.
OPT3LP2   COMPARE   TWO,PVITYPE
          GOTO      OPT3LP1 IF NOT EQUAL
.
          CALL      GETB0000                 * Get patient details
          BRANCH    OVRCD,OPT3LP1
.
          BRANCH    OTCNIVUR,PRINTLN
.
.        Check that they have an invoice pending
.
          MOVE      PVIBILL,IPADMNO
          MOVE      IPADMNO,KEY8
          CALL      RDIPEN1
          BRANCH    OVRCD OF OPT3LP1
          GOTO      PRINTLN
+
.
RSPTVS00  BRANCH    OTCNIVUR,RSPTVS10
          PACK      KEY24 WITH PVIURNO,SP20
          CALL      RDSVISA2
          RETURN
.
RSPTVS10  PACK      KEY24 WITH PVIURNO,Z20
          CALL      RDSVISA2
          RETURN
.
RNPTVS00  BRANCH    OTCNIVUR,RNPTVS10
          CALL      RDKVISA2
          RETURN
.
RNPTVS10  CALL      RDPVISA2
          RETURN
+
.------------------------------------------------------------------------------
.        Option 4
.------------------------------------------------------------------------------
OPTION4   DISPLAY   *P53:2,*V2LON,"- From ",*EF,*HOFF:
                    *P1:4,"From Date : ";
.
. ------- Get the FROM date -------
.
          UNPACK    CDATE,CDAY,ANS,CMON,ANS,CCENT,CYEAR
          MOVE      FOUR,CVERT
          MOVE      TEN3,CCOL
.
          CALL      KEYDATE
.
          MATCH     SP2,CDAY
          GOTO      START IF EQUAL
.
          PACK      STRTDAT WITH CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRTDAT
          DISPLAY   *P60:2,*V2LON,CDAY,SLASH,CMON,SLASH,CYEAR;
.
. ------- Get the TO date -------
.
          DISPLAY   *P1:5,"  To Date : ";
          UNPACK    CDATE,CDAY,ANS,CMON,ANS,CCENT,CYEAR
          MOVE      FIVE,CVERT
.
          CALL      KEYDATE
.
          PACK      ENDDTE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ENDDTE
          DISPLAY   *P69:2,*V2LON," to ",CDAY,SLASH,CMON,SLASH,CYEAR,SP1;
.
          MATCH     STRTDAT,ENDDTE
          GOTO      OPT4100 IF NOT LESS
          DISPLAY   *P1:24,*EL,*B,"Invalid Date Range.  ";
          CALL      HITENTER
          GOTO      OPTION4
.
OPT4100   IF        OPTION=4
            CALL      GETRNGE                  * Get surname range
          ENDIF
          CALL      GETSITE                  * Get site code
          CALL      KHOS0000
.
.         Check that these is the correct parameters
.
OPT4200   CALL      GUSR0000                * get web user id
.
          CALL      CONTQST                      * Ok to continue ?
          BRANCH    CEXIT,OPT4300:               * yes
                          OPTION4:               * no
                          START                  * cancel
.
.        Open spool file
.
OPT4300   
.         MATCH     "IBARSH",PGM
.         GOTO      OPT4310 IF EQUAL
.
          CALL      OPNPRINT
          MOVE      THREE,CPRTFLG   * Allow all receipts to be spooled together
.
OPT4310   PACK      KEY6,VSITE               * For this site ...
          CALL      RDSITA1                  * Get the file prefix
.
          CLOSE     OUTDTRO1                 * Close currently open dtran file
          PACK      CFNAME,OSTFILE,FILDTRO1  * Set up the physical file name
          OPEN      OUTDTRO1,CFNAME          * Open new dtran file
.
          PACK      CFNAME,OSTFILE,FILBB1A2  * Set up the physical file name
          CALL      OPOTBB12
.
          PACK      KEY16,STRTDAT,SP20       * Read from the starting date
          CALL      RDSBOKB2
OPT4400   CALL      RDKBOKB2
          BRANCH    OVRCD,OPT4500            * No more records - finished
.
          MATCH     OBADATE,ENDDTE           * Past end of date range ?
          GOTO      OPT4500 IF LESS          * Yes - finished
.
          UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ":
                    *V2LON,OBAOUTNO,SP1,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR;
.
          MOVE      ZERO,PRABFINV
          PACK      KEY8,OBAOUTNO            * Key is the outpatient no.
          CALL      RDVISA1                  * Read visit file
          BRANCH    OVRCD,OPT4400            * No visit - ignore this record
.
          MATCH     PVISITE,VSITE
          GOTO      OPT4400 IF NOT EQUAL
.
          MOVE      PVISITE,OBASITE          * Site code
          MOVE      PVIURNO,PURNO            * FORM8 to FORM6
          PACK      KEY8,PURNO               * Key is the U/R No.
          CALL      RDMAST1                  * Read PMI file
          BRANCH    OVRCD,OPT4400            * No PMI - ignore this record
.
          IF        OPTION=4
            CALL      CHKRNGE                * Check that surname in range
            BRANCH    OVRCD,OPT4400          * No - ignore this record
          ENDIF
.
          GOTO      PRINTLN                  * Process the invoice
.
OPT4500   MATCH     "IBARSH",PGM
          GOTO      OPT4502 IF EQUAL
.          
          DISPLAY   *P1:24,*EL,*V2LON,"***  Generation Completed  *** ";
          CALL      HITENTER 
          MOVE      SPLING,CPRTFLG           * Restore the original setting
.
OPT4502   CALL      CLSPRINT
.
OPT4510   GOTO      START                    * Go back to the menu
+
.------------------------------------------------------------------------------
.        OPTION 5 : All OutPatients with amounts to be billed of
.        X dollars or more
.------------------------------------------------------------------------------
OPTION5   DISPLAY   *P53:2,*V2LON,"- Owing at least X ",*P1:3,*EF;
          KEYIN     *P1:4,"Minimum Amount Owing : ",*EL,*V2LON,MINOWE:
                    *P24:4,*DV,MINOWE;
.
          COMPARE   ZERO,MINOWE
          GOTO      START IF LESS
.
          DISPLAY   *P63:2,*V2LON,*EL,"$",MINOWE;
.
          CALL      GETRNGE
          CALL      GETSITE
          CALL      KHOS0000
.
OPT5A     CALL      GUSR0000                * get web user id
.
          CALL      CONTQST                      * Ok to continue ?
          BRANCH    CEXIT,OPT5B:                 * yes
                          OPTION5:               * no
                          START                  * cancel
.
.        Open a spool file
.
OPT5B     
.         MATCH     "IBARSH",PGM
.         GOTO      OPT5B2 IF EQUAL
. 
          CALL      OPNPRINT
          MOVE      THREE,CPRTFLG   * Allow all receipts to be spooled together
.
OPT5B2    MOVE      ZEROVISN,IPADMNO
.
.        Read in next invoice pending record
.
          MOVE      IPADMNO,KEY8
          CALL      RDSIPEN1
OPT5C     CALL      RDKIPEN1
          BRANCH    OVRCD OF OPT5Z
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ",*V2LON,IPADMNO;
.
          COMPARE   TWO,IPSYSTM
          GOTO      OPT5C IF NOT EQUAL
.
          MOVE      IPADMNO,PVIBILL
          MOVE      PVIBILL,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD OF OPT5C
.
          MOVE      PVIURNO,PURNO
          MOVE      PURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF OPT5C
.
          CALL      CHKRNGE
          BRANCH    OVRCD OF OPT5C
.
          CALL      GETB0000                 * Get patient details
          BRANCH    OVRCD,OPT5C
.
          MATCH     OBASITE,VSITE
          GOTO      OPT5C IF NOT EQUAL
.
          GOTO      PRINTLN
.
OPT5Z     MATCH     "IBARSH",PGM
          GOTO      OPT5X IF EQUAL
.
          DISPLAY   *P1:24,*EL,*V2LON,"***  Generation Completed  *** ";
          CALL      HITENTER 
          MOVE      SPLING,CPRTFLG       * Restore the original setting
OPT5X     CALL      CLSPRINT
          GOTO      START
+
.------------------------------------------------------------------------------
.        OPTION 6
.------------------------------------------------------------------------------
OPTION6   DISPLAY   *P53:2,*V2LON,"- From ",*P1:3,*EF,*HOFF:
                    *P1:4,"From Date : ";
.
. ------- Get the FROM date -------
.
          UNPACK    CDATE,CDAY,ANS,CMON,ANS,CCENT,CYEAR
          MOVE      FOUR,CVERT
          MOVE      TEN3,CCOL
.
          CALL      KEYDATE
.
          MATCH     SP2,CDAY
          GOTO      START IF EQUAL
.
          PACK      STRTDAT WITH CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRTDAT
.
          DISPLAY   *P60:2,*V2LON,CDAY,SLASH,CMON,SLASH,CYEAR;
.
. ------- Get the TO date -------
.
          DISPLAY   *P1:5,"  To Date : ";
          UNPACK    CDATE,CDAY,ANS,CMON,ANS,CCENT,CYEAR
          MOVE      FIVE,CVERT
.
          CALL      KEYDATE
.
          PACK      ENDDTE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ENDDTE
          DISPLAY   *P69:2,*V2LON," to ",CDAY,SLASH,CMON,SLASH,CYEAR,SP1;
.
          MATCH     STRTDAT,ENDDTE
          GOTO      OPT6100 IF NOT LESS
          DISPLAY   *P1:24,*EL,*B,"Invalid Date Range.  ";
          CALL      HITENTER
          GOTO      OPTION6
.
OPT6100   CALL      GETRNGE                  * Get surname range
          CALL      GETSITE                  * Get site code
          CALL      CLIN0000                 * Get clinic code
          CALL      KHOS0000
.
.         Check that these is the correct parameters
.
OPT6200   CALL      GUSR0000                * get web user id
.
          CALL      CONTQST                      * Ok to continue ?
          BRANCH    CEXIT,OPT6300:               * yes
                          OPTION6:               * no
                          START                  * cancel
.
.        Open spool file
.
OPT6300   
.         MATCH     "IBARSH",PGM
.         GOTO      OPT6310 IF EQUAL
.
          CALL      OPNPRINT
          MOVE      THREE,CPRTFLG   * Allow all receipts to be spooled together
.
OPT6310   PACK      KEY6,VSITE               * For this site ...
          CALL      RDSITA1                  * Get the file prefix
.
          CLOSE     OUTDTRO1                 * Close currently open dtran file
          PACK      CFNAME,OSTFILE,FILDTRO1  * Set up the physical file name
          OPEN      OUTDTRO1,CFNAME          * Open new dtran file
.
          PACK      CFNAME,OSTFILE,FILBB1A2  * Set up the physical file name
          CALL      OPOTBB12
.
          PACK      KEY16,STRTDAT,SP20       * Read from the starting date
          CALL      RDSBOKB2
OPT6400   CALL      RDKBOKB2
          BRANCH    OVRCD,OPT6500            * No more records - finished
.
          MATCH     OBADATE,ENDDTE           * Past end of date range ?
          GOTO      OPT6500 IF LESS          * Yes - finished
.
          UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ":
                    *V2LON,OBAOUTNO,SP1,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR;
.
          PACK      KEY8,OBAOUTNO            * Key is the outpatient no.
          CALL      RDVISA1                  * Read visit file
          BRANCH    OVRCD,OPT6400            * No visit - ignore this record
.
          MATCH     PVISITE,VSITE
          GOTO      OPT6400 IF NOT EQUAL     * Wrong site
.
          MOVE      PVISITE,OBASITE          * Site code
          MOVE      PVIURNO,PURNO            * FORM8 to FORM6
          PACK      KEY8,PURNO               * Key is the U/R No.
          CALL      RDMAST1                  * Read PMI file
          BRANCH    OVRCD,OPT6400            * No PMI - ignore this record
.
          CALL      CHKRNGE                  * Check that surname in range
          BRANCH    OVRCD,OPT6400            * No - ignore this record
.
          MATCH     PVIDOCT,VCLIN            * correct clinic id ?
          GOTO      OPT6400 IF NOT EQUAL     * no, ignore this record
          GOTO      PRINTLN                  * Process the invoice
.
OPT6500   MATCH     "IBARSH",PGM
          GOTO      OPT6502 IF EQUAL
.
          DISPLAY   *P1:24,*EL,*V2LON,"***  Generation Completed  *** ";
          CALL      HITENTER 
          MOVE      SPLING,CPRTFLG           * Restore the original setting
OPT6502   CALL      CLSPRINT
.
OPT6510   GOTO      START                    * Go back to the menu
+
.------------------------------------------------------------------------------
.         Check for ABF funding
.------------------------------------------------------------------------------
WABF0000  MOVE      ZERO,PRABFINV
          MOVE      ZERO,EXIT
.
          MATCH     "1",PTCNUABF
          GOTO      WABF2000 IF NOT EQUAL     * Not using ABF
.
          PACK      KEY5,ANSC,ANSL,OBACOMP
          CALL      RDCODE1
          BRANCH    OVRCD,WABF2000
.
          MATCH     "A",TCINDC2
          GOTO      WABF2000 IF NOT EQUAL
.
          MATCH     SP70,OTBBTCOD
          GOTO      WABF2000 IF EQUAL
.
          PACK      KEY5,ANSN,ANSC,OTBBTCOD
          CALL      RDCODE1
          BRANCH    OVRCD,WABF2000
.
          MATCH     "A",TCINDC1
          GOTO      WABF2000 IF NOT EQUAL
.
.         Set PRABFINV for 'Calculating to be invoiced' amount (PROGFLAG=1)
.         Option 7 - PRABFINV = 1 for ABF charge only
.         Others   - PRABFINV = 2 for Item only
.
           IF        OPTION=7
             MOVE      ONE,PRABFINV         * ABF Charge only
           ELSE
             MOVE      TWO,PRABFINV         * Item charge only
           ENDIF
          GOTO      WABF9999
.
WABF2000  COMPARE   SEVEN,OPTION
          GOTO      WABF9999 IF NOT EQUAL   * Not printing ABF
.
WABF9000  MOVE      ONE,EXIT
WABF9999  RETURN
+
.------------------------------------------------------------------------------
PRINTLN   
.
.    Check Clinical Document Mapping table to determine if Invoice can be raised
.
          MOVE      OBAOUTNO,KEY8
          CALL      RDPMVX11
.
          MOVE      SP70,INDMHOSP
          IF        IBCNMHOS=1
            MOVE      PMVXMHOS,INDMHOSP
          ENDIF
          MOVE      OBACOMP,INDMCLAM
          MOVE      "O",INDMSYST
          MOVE      SP70,INDMCTYP
          MOVE      SP70,INDMILOS
          MOVE      OBAURNO,INDMURNO
          MOVE      OBAOUTNO,INDMADNO
.
          PROC      CHKCLDCP
          BRANCH    EXIT,REPEAT1
.
.        Calculate the amount of the invoice and determine if two invoices
.        are required (already done if we are in option 5)
.
          PACK      CFNAME,OSTFILE,FILBB1A1  * Set up physical filename
          CALL      OPOTBB11
          MOVE      ONE,PROGFLAG
.
          CALL      WABF0000                 * Check for ABF funding
          BRANCH    EXIT,REPEAT1
.
.        Check for an outstanding debt
.
          CALL      OUTTBI
          IF        OPTION=5
            COMPARE   MINOWE,NETTOT
            GOTO      REPEAT1 IF LESS
          ENDIF
.
.        Lock the outpatient record to stop anyone else from using it
.
          MOVE      OBASITE,KEY8             * For this site ...
          CALL      RDSITA1                  * get the file prefix
.
          PACK      KEY8,OBAOUTNO            * Outpatient number is the key
          PACK      CFNAME,OSTFILE,FILBB1A1  * Set up physical filename
          CALL      OPOTBB11
          CALL      RLOTBOB1                 * Lock record
          BRANCH    OVRCD,OVERROR,LKERROR    * Lock unsuccessful - error
          MOVE      PVISITE,OBASITE          * Load site code for later use
          MOVE      PVIURNO,OBAURNO          * Load u/r no. for later use
.
.         Set PRABFINV for Printing (PROGFLAG=3)
.         Option 7 - PRABFINV = 1 for printing ABF charge only
.         Others   - PRABFINV = 0 for printing Item only
.
           IF        OPTION<>7
             IF         PRABFINV=2
               MOVE      ZERO,PRABFINV       * Item charge only
             ENDIF
           ENDIF
.
          COMPARE   ZERO,GROSSTOT
          CALL      PRNTINV0 IF NOT EQUAL
.
          PACK      KEY8,OBAOUTNO            * Outpatient number is the key
          CALL      UUOTBOB1                 * Unlock record
.
.        If not a batch of invoices, goto next invoice
.
          BRANCH    OPTION OF REPEAT1,REPEAT1
.
.        CINVFF : 1 = Print FF after each invoice
.                 2 = Do not print FF after each invoice
.
          BRANCH    CINVFF OF PRTFF
          GOTO      REPEAT1
.
PRTFF     IF        PTCNINVL<>9
            IF        GROSSTOT<>0
.            PRINT     *F; *Single formfeed to seperate batched invoices
            ENDIF
          ENDIF
          GOTO      REPEAT1
.
ENDBTCH   BRANCH    OPTION OF REPEAT,REPEAT,REPEAT,OPT4500,OPT5Z,OPT6500:
                              OPT4500
          GOTO      REPEAT1
.
.        Subroutine to ask the operator for an outpatient site
.
GETSITE   MOVE      SP6,VSITE
          KEYIN     *P1:11,"Enter Site Id       : ",*EL,*DV,UNDLN6:
                    *P23:11,*V2LON,VSITE,*P23:11,*DV,VSITE;
.
          ENDSET    VSITE
          APPEND    SP6,VSITE
          RESET     VSITE
.
          MOVE      VSITE,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD OF INVSITE
          DISPLAY   *P40:11,*V2LON,OSTDESC;
          DISPLAY   *P75:2,*V2LON,VSITE;
          RETURN
.
INVSITE   DISPLAY   *P1:24,*EL,*B,"Invalid Site.  ";
          CALL      HITENTER
          GOTO      GETSITE
+
.
.        Subroutine to ask the operator for a name range
.
GETRNGE   MOVE      "A     ",STRTNAM
          MOVE      "zzzzzz",ENDNAM
.
          KEYIN     *P1:7,*EL,*P1:9,*EL:
                    *P1:7,"Enter Starting Name : ",*DV,*V2LON,STRTNAM:
                    *P23:7,*RV,STRTNAM,*HOFF:
                    *P1:9,"Enter Ending   Name : ",*DV,*V2LON,ENDNAM:
                    *P23:9,*RV,ENDNAM;
.
          MATCH     STRTNAM,ENDNAM
          RETURN    IF NOT LESS
          DISPLAY   *P1:24,*EL,*B,"Invalid Name Range.  ";
          CALL      HITENTER
          GOTO      GETRNGE
.
.         Subroutine to get the clinic code
.
CLIN0000  DISPLAY   *P1:13,*EF,"Enter Clinic Id     :";
          PACK      CFNAME,OSTFILE,FILCLIA1
          OPEN      OUTCLIA1,CFNAME
.
          MOVE      IDDD,SAVSITE
          MOVE      VSITE,IDDD
.
CLIN1000  KEYIN     *P23:13,*DV,*EL,UNDLN6,*P23:13,*V2LON,VCLIN:
                    *P23:13,*DV,VCLIN;
.
          CALL      VCLN0000                 * validate ward code
          BRANCH    EXIT,CLIN9000:           * exitchar input
                         CLIN3000:           * "?" input
                         CLIN1000:           * invalid code
                         CLIN9000            * nothing input
.
.         Valid code input
.
          DISPLAY   *P23:13,*EL,*V2LON,VCLIN,*HOFF,*P40:13,OCADESC:
                    *P75:2,*V2LON,VCLIN;
          MOVE      ZERO,EXIT
          GOTO      CLIN9999
.
.         "?" option
.
CLIN3000  MOVE      ONE,CNEWDS
          CALL      OUTDSCLN
          MOVE      ZERO,CNEWDS
.
CLIN4000  DISPLAY   *P1:24,*EF,"Enter Clinic Id     :";
.
          KEYIN     *P23:24,*DV,*EL,UNDLN6,*P23:24,*V2LON,VCLIN:
                    *P23:24,*DV,VCLIN;
.
          CALL      VCLN0000                 * validate ward code
          BRANCH    EXIT,CLIN9000:           * exitchar input
                         CLIN3000:           * "?" input
                         CLIN4000:           * invalid code
                         CLIN9000            * nothing input
.
.         Valid code input
.
          UNPACK    STRTDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          DISPLAY   *P1:3,*EF,*P1:4,"From Date : ",*V2LON,CPCDATE;
          UNPACK    ENDDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          DISPLAY   *P1:5,"  To Date : ",*V2LON,CPCDATE,*HOFF:
                    *P1:7,"Enter Starting Name : ",*V2LON,STRTNAM,*HOFF:
                    *P1:9,"Enter Ending   Name : ",*V2LON,ENDNAM,*HOFF:
                    *P1:11,"Enter Site Id       : ":
                    *P23:11,*V2LON,VSITE,*HOFF,*P40:11,OSTDESC:
                    *P1:13,"Enter Clinic Id     :":
                    *P23:13,*V2LON,VCLIN,*HOFF,*P40:13,OCADESC:
                    *P75:2,*V2LON,VCLIN;
          MOVE      ZERO,EXIT
          GOTO      CLIN9999
.
CLIN9000  MOVE      ONE,EXIT
.
CLIN9999  CLOSE     OUTCLIA1
          MOVE      SAVSITE,IDDD
          RETURN
+
.         Validate ward code input
.
VCLN0000  ENDSET    VCLIN
          APPEND    SP6,VCLIN
          RESET     VCLIN
.
          MATCH     SP6,VCLIN
          GOTO      VCLN9000 IF EQUAL
.
          CMATCH    EXITCHAR,VCLIN
          GOTO      VCLN9100 IF EQUAL
.
          CMATCH    QUEST,VCLIN
          GOTO      VCLN9200 IF EQUAL
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          PACK      KEY20,VSITE,VCLIN,KEY8
          CALL      RDCLIA1
          IF        OVRCD = 1
            CALL      RDPCLIA1
            IF        OVRCD = 0
              MATCH     VSITE,OCASITE
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ELSE
                MATCH     VCLIN,OCACLIN
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          BRANCH    OVRCD,VCLN9300
.
          MATCH     SP30,OCADESC
          GOTO      VCLN8000 IF NOT EQUAL
.
          MOVE      OCADOCT,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,VCLN8000
          CALL      CONCATDR
          MOVE      DIM40,OCADESC
.
VCLN8000  MOVE      ZERO,EXIT
          GOTO      VCLN9999
.
VCLN9000  MOVE      FOUR,EXIT
          GOTO      VCLN9999
.
VCLN9100  MOVE      ONE,EXIT
          GOTO      VCLN9999
.
VCLN9200  MOVE      TWO,EXIT
          GOTO      VCLN9999
.
VCLN9300  DISPLAY   *P1:24,*EL,*B,"Invalid Clinic Code.  ";
          CALL      HITENTER
          MOVE      THREE,EXIT
.
VCLN9999  RETURN
+
.*******************************************************************************
.       Keyin hospital ID
.*******************************************************************************
KHOS0000  MOVE       ZERO,EXIT
          MOVE       SP70,HOSPID
          COMPARE    ONE,IBCNMHOS
          GOTO       KHOS9999 IF NOT EQUAL
.
          DISPLAY    *P1:15,*EL,"Hospital Id : ";
          MOVE       TEN5,ECOL
          MOVE       "15",EVERT
          MOVE       SP3,CKYIDEF3
          MOVE       ZERO,CKYIMAND           * Not Mandatory
          OPEN       PATHSPA1,"pathspaf"
.
          CALL       PATHSPKY
          BRANCH     EXIT,KHOS1000,KHOS9000
          MOVE       PTHSHOSP,HOSPID
          MOVE       ZERO,EXIT
          GOTO       KHOS9999
.
KHOS1000  MOVE       "All Hospitals",PTHSNAME
          MOVE       SP70,HOSPID
          MOVE       ZERO,EXIT
          GOTO       KHOS9999
.
KHOS9000  MOVE       ONE,EXIT
KHOS9999  RETURN
.
.        Subroutine to check that the patient is in the required name range
.
CHKRNGE   MOVE      ZERO,OVRCD
          MATCH     STRTNAM,PSNAME
          GOTO      OVERCOND IF LESS
.
          MATCH     PSNAME,ENDNAM
          GOTO      OVERCOND IF LESS
.
          IF          IBCNMHOS=1
            MATCH       SP10,HOSPID
            IF          !@EQUAL
              OPEN        PMSVX1A1,"pmsvx1af"
              PACK        KEY8,PVIBILL,SP8
              CALL        RDPMVX11
              BRANCH      OVRCD,CHKR999
              MATCH       PMVXMHOS,HOSPID
              GOTO        OVERCOND IF NOT EQUAL
            ENDIF
          ENDIF
.
CHKR999   RETURN
+
.        End of program 
.
ENDIT     MATCH     "IBARSH",PGM
          GOTO      ABORTIT IF EQUAL
. 
ABORTIT   CHAIN     PGM
+
.------------------------------------------------------------------------------
.         Error messages
.------------------------------------------------------------------------------
INVURNO   DISPLAY   *P1:24,*EL,*B,"U/R ",PURNO," does not Exist.  ";
          CALL      HITENTER
          GOTO      REPEAT
.
INVVIST   DISPLAY   *P1:24,*EL,"Outpatient ",OBAOUTNO," does not Exist.  ";
          CALL      HITENTER
          GOTO      REPEAT
.
INVADMN   DISPLAY   *P1:24,*EL,*B,"Patient is not an Outpatient.  ";
          CALL      HITENTER
          GOTO      REPEAT
.
INVPAID1  DISPLAY   *P1:24,*EL,*B,"Patient has no Admissions.  ";
          CALL      HITENTER
          GOTO      REPEAT
.
INVPAID2  DISPLAY   *P1:24,*EL,*B,"Patient has no more Admissions.  ";
          CALL      HITENTER
          GOTO      REPEAT
.
LKERROR   DISPLAY   *P1:24,*EL,*B,"Patient Busy on Terminal ":
                    *V2LON,OBALOCK,*HOFF,".  Please Wait.  ";
          CALL      HITENTER
          GOTO      REPEAT1
.
OVERROR   DISPLAY   *P1:24,*EL,*B,"Outpatient ",OBAOUTNO:
                    " does not Exist.  ";
          CALL      HITENTER
          GOTO      REPEAT1
.
.------------------------------------------------------------------------------
.       Display the top screen after the question mark option
.------------------------------------------------------------------------------
DISPB     DISPLAY   *P1:4,*EF,"U/R Number: ",*V2LON,PVIURNO,*HOFF:
                       *P25:4,"Name : ",*V2LON,PNAME,*HOFF:
                        *P1:5,"Out Patient : ",*V2LON,PVIBILL;
.
.       This is a dummy routine that need to be defined for PATDSBFE that
.       is called from PATCRATE
.
DATAB     RETURN
+
.------------------------------------------------------------------------------
.         Subroutine to locate outpatient record given the Visit file details
.------------------------------------------------------------------------------
GETB0000  MOVE      ZERO,OVRCD               * Clear error flag
          MOVE      PVISITE,OBASITE          * Site code
          MOVE      PVIURNO,OBAURNO          * U/R number
.
          MOVE      PVISITE,KEY6             * For this site ...
          CALL      RDSITA1                  * Get file prefix
          BRANCH    OVRCD,OVERCOND           * No site record - error
.
          PACK      CFNAME,OSTFILE,FILBB1A2  * Set up physical filename
          CALL      OPOTBB12
          PACK      KEY16,PVIDATE,PVIBILL    * Key is date & outpatient no.
          CALL      RDBOKB2                  * Read record
          BRANCH    OVRCD,OVERCOND           * No record - error
.
          CLOSE     OUTDTRO1                 * Close currently open dtran file
          PACK      CFNAME,OSTFILE,FILDTRO1  * Set up physical filename
          OPEN      OUTDTRO1,CFNAME          * Open new dtran file
          RETURN
+
.
REDISPS   DISPLAY   *P1:4,*EF,"U/R Number : ";
          RETURN
.
WEBERR00
OPEN0000
CLOS0000
OLUM0000
DLUM0000
CHKCMXPT
GETSVAR   RETURN
+
.*******************************************************************************
.*                                  GUSR0000               Called by: MAIN0000 *
.*                               Get Web User Id                               *
.*******************************************************************************
.
GUSR0000  KEYIN     *P1:20,*EF,"Web User Id  : ",*V2LON,USERID
.
          PACK      USERID,USERID,SP70
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,GUSR9100
.
          MOVE      ZERO,EXIT
          GOTO      GUSR9999
.
GUSR9100  MOVE      ONE,EXIT
GUSR9999  RETURN
+
.*********************************************************************
.         need this defined for PATINV10 - actually in patcatbi
.*********************************************************************
          DEFPROC   HKCDS000
          ENDPROC
.
.*********************************************************************
.         need this defined for PATINV14 - actually in patcatbi
.*********************************************************************
          DEFPROC   MSDPY000
          ENDPROC
.------------------------------------------------------------
. Procedure to get Doctor Code from Outpatient Clinic ID
. COPTION - 1 Return DOCTCODE
.           2 Output Location
.           3 (N/A)
.           4 Output Menu Type
.           5 Output Unit
.------------------------------------------------------------
          DEFPROC  OUTDET00
.
          INC      OUTPREFD/INC
          INC      OUTCLIFD/INC
          INC      OUTBOAFD/INC
          INC      OUTMA1FD/INC
          INC      OUTBB1FD/INC
.
KEYBOA    DIM      28
KEYCLI    DIM      14
.
          MOVE     SP70,DOCTCODE
          COMPARE  ZERO,PVITYPE
          GOTO     OUTDET50 IF EQUAL
.
          PACK     KEY6,PVISITE,SP70
          CALL     RDSITA1
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYCLI,PVIDOCT,PVIDATE,SP70
          BRANCH   COPTION,OUTDET60
.
          PACK     KEY8,OSTFILE,FILBOKA1 * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTBOKA1,KEY8         * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYBOA,PVISITE,PVIDOCT,PVIDATE,SP70
          PACK     KEY28,PVISITE,PVIDOCT,PVIDATE,SP70
          PACK     KEY20,PVISITE,PVIDOCT,PVIDATE,SP70
          CALL     RDSBOKA1
OUTDET10  CALL     RDKBOKA1
          BRANCH   OVRCD,OUTDET95
          PACK     KEYBOA,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          MATCH    KEY20,KEYBOA
          GOTO     OUTDET95 IF NOT EQUAL
          MATCH    OBAOUTNO,PVIBILL         * Set up billing number
          GOTO     OUTDET10 IF NOT EQUAL
          GOTO     OUTDET80
.
OUTDET50  MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     OUTPREA1,"outpreaf"   * Pre Attendance File
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
          MOVE     ADMISSNO,KEY8
          CALL     RDPREA1               * Check for Pre-Attendance
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEY6,OPRSITE,SP70
          CALL     RDSITA1
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYCLI,OPRCLIN,OPRDATE,SP70
          PACK     KEYBOA,OPRSITE,OPRCLIN,OPRDATE,OPRSTRT,OPRSLOT
.
          BRANCH   COPTION,OUTDET60,OUTDET70,OUTDET70,OUTDET70
.
OUTDET60  MOVE     ZERO,OVRCD
          PACK     KEY8,OSTFILE,FILCLIA1 * Determine Doctor from Clinic ID
          TRAP     OVERCOND IF IO
          OPEN     OUTCLIA1,KEY8         * Clinic Details
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEY20,OPRSITE,KEYCLI,Z70  * Read for Current Effective Clinic
          CALL     RDSCLIA1
          CALL     RDPCLIA1
          BRANCH   OVRCD,OUTDET95
.
          MATCH    OCASITE,OPRSITE
          GOTO     OUTDET95 IF NOT EQUAL
.
          MOVE     OCADOCT,DOCTCODE
          MATCH    SP70,DOCTCODE
          IF       @EQUAL
            MOVE     OCACCONS,DOCTCODE
          ENDIF
          MOVE     ZERO,EXIT
          GOTO     OUTDET99
.
OUTDET70  PACK     KEY8,OSTFILE,FILBOKA1 * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTBOKA1,KEY8         * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          MOVE     KEYBOA,KEY28
          CALL     RDBOKA1
          BRANCH   OVRCD,OUTDET95
.
OUTDET80  IF       COPTION=4
            PACK     MENUTYPE,TWO,OBASTAT * Outpatient Booking
            MOVE     ZERO,EXIT
            GOTO     OUTDET99
          ENDIF
.
          IF       COPTION=5
            PACK     CFNAME,OSTFILE,FILBB1A1
            CALL     OPOTBB11
            MOVE     ADMISSNO,KEY8
            CALL     RDBOKB1
            IF       OVRCD=0
              MATCH    SP6,OTBBDEPT
              GOTO     OUTDET95 IF EQUAL
              MOVE     OTBBDEPT,CODE       * Unit code
              MOVE     ZERO,EXIT
            ENDIF
            GOTO     OUTDET99
          ENDIF
.
          MOVE     ZERO,OVRCD
          PACK     KEY8,OSTFILE,FILMA1A1  * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTMA1A1,KEY8          * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEY18,OBASITE,OBACLIN,OBADAY,OBASTRT
          CALL     RDMASA1
          BRANCH   OVRCD,OUTDET95
.
          WRITE    HTMLFILE;OTMACLOC;
          MOVE     ZERO,EXIT
          GOTO     OUTDET99
.
OUTDET95  MOVE     ONE,EXIT
          GOTO     OUTDET99
.
          INC       OUTCLIIO/INC
          INC       OUTPREIO/INC
          INC       OUTBOAIO/INC
          INC       OUTMA1IO/INC
          INC       IBAOVRIO/INC
          INC       OUTBB1IO/INC
.
OUTDET99  ENDPROC
.------------------------------------------------------------
. Procedure to get Emergency Details
.   COPTION = 1 Return Consultant DOCTCODE
.             2 Output Location
.             3 Output Triage Status
.             4 Output Menu Type
.------------------------------------------------------------
          DEFPROC  EMRCHK00
.
          INC      EMRVISFD/INC
          INC      EMRLOCFD/INC
.
EMRCHK10  MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     EMRVISA1,"emrvisaf"
          TRAPCLR  IO
          BRANCH   OVRCD,EMRCHK90
.
          MOVE     ADMISSNO,KEY8
          CALL     RDEMVIS1
          BRANCH   OVRCD,EMRCHK90
.
          COMPARE  FOUR,EMVISTAT
          GOTO     EMRCHK90 IF EQUAL
.
          MOVE     EMVIDOCT,DOCTCODE
          IF       COPTION=4
            PACK     MENUTYPE,ONE,EMVISTAT
            GOTO     EMRCHK99
          ENDIF
          IF       COPTION=2
            IF       EMVISTAT=1
              OPEN     EMRLOCA1,"emrlocaf"
              MOVE     "Other Departments",EMLODESC
              MOVE     EMVILOCN,KEY3
              CALL     RDEMLOC1
              WRITE    HTMLFILE;"Emergency - ",EMLODESC;
            ELSE
              WRITE    HTMLFILE;"Discharged";
            ENDIF
          ENDIF
          IF       COPTION=3
            WRITE    HTMLFILE;EMVITRIG;
          ENDIF
          GOTO     EMRCHK99
.
EMRCHK90  MOVE     PVIDOCT,DOCTCODE
          IF       COPTION=2
            WRITE    HTMLFILE;"Emergency";
          ENDIF
          GOTO     EMRCHK99
.
          INC      EMRVISIO/INC
          INC      EMRLOCIO/INC
          INC       IBAOVRIO/INC
.
EMRCHK99  ENDPROC
.*****************************************************************************
.*  GETALTID
.*  Procedure to get an alternate ID
.*  Exit=0  No alternate ID
.*       1  Alternate ID's exist
.*****************************************************************************
          DEFPROC   GETALIDS
.
          INC       PMSAIDFD/INC
.
          MOVE      ZERO,EXIT
          PACK      KEY20,SP70
          OPEN      PMSAIDA1,"pmsaidaf"
.
          PACK      KEY31,PURNO,SP70
          CALL      RSPMAID1           * Read alternate id Table
GETALI10  CALL      RKPMAID1
          BRANCH    OVRCD,GETALI99
.
          MATCH     PURNO,PMAIURNO     * Check same UR
          GOTO      GETALI99 IF NOT EQUAL
.
          MATCH     "1",PMAIDISU
          GOTO      GETALI10 IF NOT EQUAL
.
          PACK      KEY20,PMAIALID,SP70
          MOVE      ONE,EXIT
          GOTO      GETALI99
.
          INC       PMSAIDIO/INC
          INC       IBAOVRIO/INC
.
GETALI99  CLOSE     PMSAIDA1
.
          ENDPROC
.
PRTIPROV
DOCNM000  RETURN
.
.==============================================================================
.
          INC       STD001IO
          INC       STDHLPCD
          INC       STDKWSCD
          INC       CLPATMAS           * for PATSRCH
          INC       CLPATINV
          INC       CALCAGE
          INC       IBAPRINT
          INC       IBAGSTKY
          INC       IBAGKIKY
          INC       NZHISIIO           * for NZIBSRCH
          INC       NZIBSRCH           * for PATSRCH
          INC       OUTCATBI
          INC       OUTINVS
          INC       PATCALFN
          INC       PATCATAI
          INC       HASCMNTS
          INC       PATCOMN1
          INC       PATGBCRN           * I-48227
          INC       PATINVHL
          INC       PATINVTL
          INC       PRTINVBD
          INC       PATSNDX
          INC       PATSNX2
          INC       CHKCLDCP
.
          INC       CLPATINP
          INC       PATHSPKY
          INC       OUTDSCLN
          INC       PRNTICDC
          INC       TFILENAM                * Generate Temp File Name
          INC       SEXDSP00
.
          INC       WEBERRIO/INC            * Web Server Error Logging
          INC       IBAGSTIO/INC
          INC       IBAGEDIO/INC
          INC       AAEDE1IO/INC
          INC       AAEDTRIO/INC
          INC       BOKRC1IO/INC
          INC       EMRHISIO/INC
          INC       EMRVISIO/INC
          INC       IBAPRNIO/INC
          INC       IBATMDIO/INC
          INC       IBATMHIO/INC
.
          INC       MLTCFNIO/INC
          INC       NZPRFNIO/INC
          INC       NZPRDTIO/INC
          INC       NZPSPRIO/INC
          INC       NZPCFNIO/INC
          INC       NZPFIGIO/INC
          INC       NZPFINIO/INC
          INC       NZPIVBIO/INC
          INC       OUTBB1IO/INC
          INC       OUTCLIIO/INC
          INC       OUTDTRIO/INC
          INC       OUTSITIO/INC
          INC       OUTHTRIO/INC
          INC       OUTPREIO/INC
          INC       COMDEPIO/INC
          INC       OPRARDIO/INC
          INC       OPRDEAIO/INC
.
          INC       PATCRAIO/INC
          INC       PATDRGIO/INC
          INC       PATEDTIO/INC
          INC       PATINLIO/INC
          INC       VISMDTIO/INC
          INC       PATCMXIO/INC
          INC       PATCODIO/INC
          INC       PATDO1IO/INC
          INC       PATDSCIO/INC
          INC       PATDTRIO/INC
          INC       PATECDIO/INC
          INC       PATREMIO/INC
          INC       PATFIGIO/INC
          INC       PATFINIO/INC
          INC       PATFN1IO/INC
          INC       PATFX1IO/INC
          INC       PATGSRIO/INC
          INC       PATIBLIO/INC
          INC       PATICDIO/INC
          INC       PATIN1IO/INC
          INC       PATINVIO/INC
          INC       PATIPEIO/INC
          INC       PATIRNIO/INC
          INC       PATITMIO/INC
          INC       PATMA1IO/INC
          INC       PMSABFIO/INC
          INC       PMSPX2IO/INC
          INC       PATMCHIO/INC
          INC       PATMI1IO/INC
          INC       PATPR1IO/INC
          INC       PATRE1IO/INC
          INC       PATRFNIO/INC
          INC       PATRFGIO/INC
          INC       PATTFEIO/INC
          INC       PATVISIO/INC
          INC       PATWC1IO/INC
          INC       PATWR1IO/INC
          INC       PATWMAIO/INC
          INC       PATWVEIO/INC
          INC       NHIMASIO/INC       * for PATSRCH
          INC       PATDNRIO/INC
          INC       PATHSPIO/INC
          INC       PATIPRIO/INC
          INC       PATINPIO/INC
          INC       PATSDNIO/INC
          INC       PATSMWIO/INC
          INC       PATNIDIO/INC
          INC       PATALRIO/INC
          INC       PMSCNOIO/INC
          INC       PMSFCIIO/INC
          INC       PMSMTIIO/INC
          INC       PMSVX1IO/INC
          INC       PMSPRGIO/INC
          INC       PMSHCPIO/INC
          INC       PMSTLEIO/INC
          INC       PMSEXTIO/INC
          INC       PMSEVTIO/INC
          INC       RCPBNKIO/INC
          INC       RCPBDTIO/INC
          INC       RCPCRSIO/INC
          INC       RCPDTEIO/INC
          INC       VISPAYIO/INC
          INC       WEBSECIO/INC
          INC       CHKSUGCL
          INC       GETALTID
          INC       PMSOSDTM                * Outstanding Debt alert routine
          INC       PATMCHRD                * Miscellaneous Charges read routine
          INC       PATITMRD
.
          INC       NZPMCHIO/INC
          INC       NZPMXCIO/INC
          INC       CLPATDTR
.
AGECHK    RETURN
+

.******************************************************************************
.*                                                                            *
.*                        P R O G R A M   S U M M A R Y                       *
.*                        -------------   -------------                       *
.*                                                                            *
.*      PROGRAM NAME:    IBABIL60                                             *
.*                                                                            *
.*      FUNCTION:        INVOICE PENDING REPORT                               *
.*                                                                            *
.*      DATE WRITTEN:    12/06/86                                             *
.*                                                                            *
.*      MODIFICATIONS:                                                        *
.*                                                                            *
.*----------------------------------------------------------------------------*
.* V12.00.01 14/05/2025  J.Tan          TSK 0955096                           *
.*           Added alpanumeric visit number generation                        *
.* V11.05.01 24/02/2025  J.Tan            TSK 0946490                         *
.*           Recompiled for PATCATBI - Added PMSHATFD/IO                      *
.* V11.04.12 25/10/2024 J.Tan             TSK 0951578                         *
.*           Recompiled for ABFPTINV-Added Min.to roundup ICU Hrs(ABF)        *
.* V11.04.11 18/10/2024  Bella Turco    TSK 0947710                           *
.*           All Theatre Charges column displays N/A when patient not been to *
.*           theatre (PELN0000)                                               * 
.* V11.04.10 23/09/2024  J.Tan          TSK 0949848                           *
.*           Recompiled for ABFPTINV - DRG List used in for COVID Adjustor    *
.* V11.04.09 20/09/2024 J.Tan           TSK 0950577                           *
.*           Recompiled for PATIPERH - Hold invoice audit                     *
.* V11.04.08 11/09/2024  J.Tan          TSK 0947315                           *
.*           Recompiled for ABFPTINV - fixed Total Unqualified                *
.* V11.04.07 16/08/2024 J.Tan           TSK 0950577                           *
.*           Mod to read Discharge file for Hold invoice                      *
.* V11.04.06 07/08/2024  J.Tan            TSK 0939432                         *
.*           Recompiled for ISBITEMS - zero Item quantity (PTCNISBZ)          *
.* V11.04.05 01/08/2024  J.Tan          TSK 0947804                           *
.*           Recompiled for ABFMHINV - Changes for Discharges after 1/7/2023  *
.* V11.04.04 17/07/2024  J.Tan          TSK 0947315                           *
.*           Recompiled for ABFPTINV (LOS ICU adjusted & Newborn)             *
.* V11.04.03 15/03/2024  J.Tan          TSK 0910994                           *
.*           Recompiled for CMXMATRX                                          *
.* V11.04.02 29/01/2024  Jacob Jackson  TSK 0919335                           *
.*           Add HF History includes                                          *
.* V11.04.01 29/01/2024  Jacob Jackson  TSK 0919335                           *
.*           Add new local variable and recompile for GETTFEES                *
.* V11.03.09 17/11/2023  J.Tan          TSK 0940089                           *
.*           Recompiled for ABFPTINV - checking for blank Disc.DRG            *
.* V11.03.08 13/11/2023  J.Tan          TSK 0939019                           *
.*           Recompiled for ABFPTINV - HAC ICD10 Edition 12                   *
.* V11.03.07 04/10/2023  J.Tan          TASK 0938230                          *
.*           Recompiled for ABFAECCL - Emergency ABF                          *
.* V11.03.06 29/08/2023  J.Tan          TSK 0916870                           *
.*           Recompiled for ABFPTINV - Claim code Cat CL Multiple NEP value   *
.* V11.03.05 15/06/2023  J.Tan          TSK 0923703                           *
.*           Recompiled for ABF new calculations                              *
.* V11.03.04 30/05/2023  Davin          TSK 0933052                           *
.*           Added check for CodeFocus InvoiceOnHold reason (CHLD0000)        *
.* V11.03.03 27/04/2023 Davin           TSK 0923862                           *
.*           Only use parameter ptcnsamt to determine sending HL7 A08 messgs. *
.*           Always write 'Amount To Be Invoiced' to visxdcaf (UPVXDC00)      *
.* V11.03.02 05/04/2023 Bella Turco     TSK 0911166                           *
.*           Recompiled for PATIPERH - Hold Invoice Audit                     *
.* V11.03.01 10/11/2022 Davin           TSK 0923862                           *
.*           Added UPVXDC00 - Write 'Amount To Be Invoiced' to visxdcaf       *
.*           and trigger hl7 A08 message (based on parameter ptcnsamt)        *
.*           Added KUSR0000 - Keyin of User ID to save to visxdcaf            *
.* V11.02.04 20/07/2022 J.Tan           TSK 0922228                           *
.*           Mod Checking for Patient Hold invoice                            *
.* V11.02.03 15/07/2022 J.Tan           TSK 0922228                           *
.*           Mod to update/check status of Hold invoice                       *
.* V11.02.02 29/06/2022 J.Tan           TSK 0920712                           *
.*           Recompiled for ABFAECCL - I*D on emrvcdaf file                   *
.* V11.02.01 03/03/2022  J.Tan           TSK 0902652                          *
.*           Recompiled for OUTCATBI/AAECATBI - Pat.Invoice new functionality *
.* V11.01.10 17/11/2021  J.Tan          TSK 0913621                           *
.*           Recompiled for ABFPTINV - Mod for Multiple NEP Values            *
.* V11.01.09 28/10/2021 J.Tan           TSK 0913056                           *
.*           Recompiled for ABFAECCL-ADMFLAG and CCAR0000(Clinical Care)      *
.* V11.01.08 13/10/2021 J.Tan           TSK 0905305                           *
.*           Recompiled for ABFAECCL - Adjustment type 068 & 069              *
.* V11.01.07 29/09/2021  J.Tan          TSK 0901515                           *
.*           Recompiled for CMXMATRX - Added Primary Proc.to Matrix           *
.* V11.01.06 14/09/2021  J.Tan          TSK 0906222                           *
.*           Recompiled for ABFPTINV - Mod for Multiple NEP Values            *
.* V11.01.05 09/08/2021  J.Tan           TSK 0905305                          *
.*           Recompiled for AAECATBI - AE Care class (ABFAECCL)               *
.* V11.01.04 04/08/2021  Jill Parkinson Task 0909755                          *
.*           Commented out branch on exit after INVPND (fix us1 script exec)  *
.* V11.01.03 07/07/2021  J.Tan           TSK 0908588                          *
.*           Recompiled for PATCATBI -Exclude Unqualified days for Casepayment*
.* V11.01.02 28/04/2021  Thanh T         TSK 0895165                          *
.*           Recompiled for OPRARDFD changes                                  *
.*           07/04/2021  Tracey Nguyen   TSK 0901515                          *
.*           Recompiled for PMSCMTFD - Added new fields                       *
.*           a) 1 File type for ICD procedure (PMCCIPF)                       *
.*           b) 3 new CMBS Field Type (PMCCFTS4/PMCCFT5C/PMCCFT6C)            *
.*           c) 3 new CMBS Codes From (PMCCPC4F,PMCCSC5F,PMCCTC6F)            *
.*           d) 3 new CMBS Codes To   (PMCCPC4T/PMCCSC5T,PMCCTC6T)            *
.*           13/04/2021  J.Tan           TSK 0863287                          *
.*           Recompiled for PATCATBI - Patient Invoice new functionality      *
.* V11.01.01 10/03/2021  Tracey Nguyen   TSK 0901515                          *
.*           Recompiled for PMSCMTFD - Added Primary ICD Procedure 1-5        *
.*           (PMCCICP1-5)                                                     *
.*----------------------------------------------------------------------------*
.*        V11.00.11 10/11/2020  J.Tan           TSK 0899562                   *
.*                  Recompiled for CMXMATRX - setup date for reading MBS item *
.*        V11.00.10 29/09/2020  J.Tan          TSK 0896829                    *
.*                  Recompiled for CMXMATRX - use National(PTPGNDRG)DRG       *
.*        V11.00.09 22/09/2020  J.Tan           TSK 0895330                   *
.*                  Recompiled for CMXMATRX - reposition read of Matrix table *
.*        V11.00.08 25/08/2020  J.Tan           TSK 0895330                   *
.*                  Mod checking for Unknown GST (UGSTFLAG)                   *
.*        V11.00.07 20/07/2020  J.Tan           TSK 0892319                   *
.*                  Recompiled for ABFPTINV - Additional NEP and Psych.Adjus. *
.*        V11.00.06 14/07/2020  J.Tan          TSK 0892902                    *
.*                  Recompiled for PATCATBI - Mod to initialise CASMXKEY      *
.*        V11.00.05 01/07/2020  J.Tan           TSK 0892765                   *
.*                  Recompiled for PATCATBI-Low outlier exc. unqualified days *
.*                  05/07/2020  J.Tan           TSK 0892746                   *
.*                  Recompiled for ABFPTINV - CALCAGE as at Admission date    *
.*        V11.00.04 29/06/2020  J.Tan           TSK 0893767                   *
.*                  Recompiled for ABFPTINV - Changed CALCFLAG to 01/01/2021  *
.*        V11.00.03 20/04/2020 J.Tan           TSK 0890733                    *
.*                  Recompiled for ABFPTINV - ABF new 2020 calculation        *
.*        V11.00.02 07/05/2020  J.Tan            TSK 0891341                  *
.*                  Recompiled for ABFOTINV - added TRAP to write pmsabfaf    *
.*        V11.00.01 20/03/2020  J.Tan          TSK 0838262                    *
.*                  Added Effective from and to date to MBS Item file         *
.*        V10.15.07 17/01/2020  J.Tan            TSK 0887086                  *
.*                  Recompiled for PATCATBI - initialise NETTOT               *
.*        V10.15.06 12/12/2019  Peter Vela       TSK 0857392                  *
.*                  Recompiled for IPENBOOK                                   *
.*                  Added UR Number to ABF temp file                          *
.*        V10.15.05 10/12/2019  Peter Vela       TSK 0857392                  *
.*                  Added temp file functionality to sort ABF table by        *
.*                  Surname/Visit Number                                      *
.*        V10.15.04 21/11/2019  J.Tan            TSK 0857392                  *
.*                  Added option for ABF Booked Outpatient to be invoiced     *
.*        V10.15.03 31/10/2019  J.Tan            TSK 0882906                  *
.*                  Recompiled for ABFPTINV - looping on ICU hours            *
.*        V10.15.02 11/10/2019  Peter Vela       TSK 0882906                  *
.*                  Recompiled for OUTCATBI - Fixed I*C for OUTBB1 ABF        *
.*        V10.15.01 07/10/2019  J.Tan            TSK 0882545                  *
.*                  Mod to clear Disc.record                                  *
.*                  09/10/2019  J.Tan          TSK 0872482                    *
.*                  Recompiled for PATCATBI - Mechanical Ventilation          *
.
.*        V10.14.07 26/09/2019  J.Tan            TSK 0857392                  *
.*                  Recompiled for OUTCATBI - ABF outpatient invoice          *
.*        V10.14.06 24/09/2019  J.Tan           TSK 0881867                   *
.*                  Recompiled for ABF invoice                                *
.*        V10.14.05 09/09/2019  J.Tan           TSK 0857392                   *
.*                  Recompiled for ABF invoice                                *
.*        V10.14.04 21/05/2019  J.Tan           TSK 0857392                   *
.*                  Mod for ABF                                               *
.*        V10.14.03 23/05/2019  Tracey Nguyen  TSK 0867342                    *
.*                  Added 2 new columns Volume and Current Location after     *
.*                  Hospital Id for option Create Export File only - in       *
.*                  EHED0000, PELN0000 and MREC0000                           *
.*        V10.14.02 22/03/2019  J.Tan          TSK 0857392                    *
.*                  Changed RCP Transaction count from DIM3 to DIM5           *
.*        V10.14.01 04/02/2019  Thanh T.       TSK 0844471                    *
.*                  Added CPOUTF00 to call us1 script to copy the invoice     *
.*                  pending report to specified extract directory             * 
.*----------------------------------------------------------------------------*
.*        V10.13.03 11/01/2019  Peter Vela     TSK 0867807                    *
.*                  Recompiled for OUTCATBI                                   *
.*        V10.13.02 26/10/2018  Thanh T        TSK 0859743                    *
.*                  Added BULKBILL field and removed OUTHEDFD/OUTHEDIO,       *
.*                  OUTSESFD/OUTSESIO for OUTCATBI changes                    *
.*        V10.13.01 25/10/2018  Thanh T        TSK 0859743                    *
.*                  Added OUTHEDFD/OUTHEDIO, OUTSESFD/OUTSESIO for OUTCATBI   *
.*                  changes                                                   *
.*----------------------------------------------------------------------------*
.*        V10.12.02 18/07/2018  J.Tan          TSK 0859911                    *
.*                   Recompiled for PATCATBI - Fixed No Payday Add on charge  *
.*        V10.12.01 20/02/2018  J.Tan         TSK 0850741                     *
.*                  Fixed Patient name for Surname seq.option (LOAD0000)      *
.*        V10.11.01 07/09/2017  J.Tan         TSK 0837479                     *
.*                  Recompiled for CMXMATRX - Consumption type items          *
.*        V10.10.02 13/06/2017  J.Tan          TSK 0839991                    *
.*                  Recompiled for PATDBTYP (PATCMSTP)                        *
.*        V10.10.01 25/01/2017  J.Tan          TSK 0832407                    *
.*                  Recompiled for PATCATBI- multi bed trans on sameday for MV*
.*                  04/04/2017  J.Tan         TSK 0297904                     *
.*                  Recompiled for PATCMSTP - Non-Accumulative inlier ICU/CCU *
.*        V10.08.08 06/10/2016  J.Tan         TSK 0826824                     *
.*                  Recompiled for CALCMVHR - MV Hours                        *
.*        V10.08.07 21/09/2016  J.Tan           TSK 0826370                   *
.*                  Recompiled for CMXMATRX - Chgd MCHGARR MCHGAMT array to F3*
.*        V10.08.06 26/08/2016  Don Nguyen    TSK 0312570                     *
.*                  Recompiled for CMXMATRX - Added check for PTCNDGED=1      *
.*                  Added PMSEDGFD/IO and GETEFDRG                            *
.*        V10.08.05 17/08/2016  J.Tan         TSK 0808745                     *
.*                  Recompiled for PATCATBI - for NPDAYFLG=1                  *
.*        V10.08.04 20/07/2016  J.Tan         TSK 0819914                     *
.*                  Recompiled for PATCATBI - Non ICU MV Hours                *
.*        V10.08.03 15/07/2016  J.Tan         TSK 0819914                     *
.*                  Recompiled for PATCATBI - Calculating non ICU MV hours    *
.*        V10.08.02 20/06/2016  J.Tan         TSK 0820816                     *
.*                  Recompiled for PATCATBI - Fixed No payday for Daycase     *
.*        V10.08.01 02/06/2016  J.Tan         TSK 0816651                     *
.*                  Recompiled for PATCATBI -Continuous Bill.to chk for Matrix*
.*        V10.07.03 04/03/2016  J.Tan         CAR 290448                      *
.*                  Recompiled for PATCATBI - Mods for Addon with No Pay DAy  *
.*        V10.07.02 18/11/2015  J.Tan         CAR 303942                      *
.*                  Added new payment types                                   *
.*        V10.07.01 15/10/2015  J.Tan          CAR 322442                     *
.*                  Recompiled for PATCATBI -Fixed TOTDAYS for Casepay.daycase*
.*        V10.06.02 15/07/2015  J.Tan          CAR 319342                     *
.*                  Recompiled for CMXMATRX - Chg 'Disc.UDF' to 'Care Class'  *
.*        V10.06.01 14/07/2015  Peter Vela     CAR 318700                     *
.*                  Recompiled for PRBILCMN - Validate for deleted VISMDT     *
.*                  record                                                    *
.*        V10.05.01 04/08/2014 J.Tan           CAR 304397                     *
.*                  Mods to check Suggested classification for charging       *
.*        V10.04.08 03/07/2014 J.Tan           CAR 268860                     *
.*                  Recompiled for PATCATBI - ICD10 Suggested Classification  *
.*        V10.04.07 19/06/2014 J.Tan           CAR 302452                     *
.*                  Recompiled for PATDINVS - Changed MCHGARR/MCHGAMT         *
.*        V10.04.06 16/06/2014 Steve Armstrong  CAR 301639                    *
.*                  Moved call to TFILENAM for TEMPFILE into INIT0000         *
.*        V10.04.05 11/06/2014 Jill Parkinson CAR 301639                      *
.*                  Added call to KILL0000 to clean up tempfile when finished *
.*        V10.04.04 11/06/2014 Sandra Barcham  CAR 301639                     *
.*                  Moved call to TFILENAM to INIT0000                        *
.*        V10.04.03 27/05/2014  J.Tan          CAR 300784                     *
.*                  Recompiled for STEPDOWN - force stepdown prior inv.fromdat*
.*        V10.04.02 15/04/2013 J.Tan          CAR 261630                      *
.*                  Removed port number from temp file name                   *
.*        V10.04.01 14/02/2014  J.Tan          CAR 297139                     *
.*                  Mods for Ind.Services Billing to automaticaly update items*
.******************************************************************************
.*        V10.03.12 13/12/2013  J.Tan          CAR 294609                     *
.*                  Recompiled for CMXMATRX - mods for Default Grouper Version*
.*        V10.03.11 14/11/2013  J.Tan          CAR 285294                     *
.*                  Added option to create Export file                        *
.*        V10.03.10 07/11/2013  J.Tan          CAR 283618                     *
.*                  Recompiled for PATCATBI - mods for Ind.Services Billing   *
.*        V10.03.09 02/10/2013  J.Tan          CAR 291588                     *
.*                  Recompiled for PATCATBI - fixed stepdown return from leave*
.*        V10.03.08 21/08/2013  Ania P         CAR 280942                     *
.*                  Added display of On Hold code                             *
.*        V10.03.07 14/08/2013  J.Tan          CAR 288416                     *
.*                  Recompiled for PATCATBI - fixed Days of Hosps.            *
.*        V10.03.06 05/08/2013  J.Tan          CAR 288060                     *
.*                  Recompiled for CMXMATRX - fixed Primary/Secondary/Tertiary*
.*        V10.03.05 06/05/2013  J.Tan          CAR 284902                     *
.*                  Recompiled for STEPDOWN - force stepdown prior Inv.Fromdat*
.*        V10.03.04 10/04/2013  J.Tan    CAR 283743                           *
.*                  Recompiled for PATCATBI -  reset PTTRESPD for New Stepdown*
.*        V10.03.03 05/03/2013  Patrick Adair CAR 281898                      *
.*                  Recompiled for PATCATBI PATCATAI                          *
.*        V10.03.02 04/12/2012  J.Tan          CAR 271474                     *
.*                  Recompiled for CMXMATRX - using index 5 of pmscmtaf       *
.*                  04/12/2012  J.Tan          CAR 262673                     *
.*                  Recompiled for PATCATBI - Checking for Qualified period   *
.*        V10.03.01 27/03/2012 J.Tan      CAR 262607                          *
.*                  Fixed I*C on patipenf file                                *
.*        V10.02.01 26/11/2010 J.Tan      CAR 251941                          *
.*                  Fixed I*C on patfn1af file                                *
.*        V10.01.03 23/02/2011  Peter Vela    CAR 233034                      *
.*                  Removed PATBF2FD and PATBF2IO                             *
.*        V10.01.02 20/12/2010  Mike Laming   CAR 233046                      *
.*                  Recompiled for PABXBILL - Mods to Misc.Charges PATMCHFD   *
.*        V10.01.01 05/10/2010 J.Tan      CAR 233250                          *
.*                  Fixed I*C on patmchgf file                                *
.*        V10.00.08 27/09/2010 J.Tan      CAR 230664                          *
.*                  Recompiled for AAECATBI - HEC Invoice layout              *
.*        V10.00.07 17/08/2010 J.Tan         CAR 227873                       *
.*                  Recompiled for CMXMATRX- getting the grouper version      *
.*        V10.00.06 11/08/2010 J.Tan         CAR 227873                       *
.*                  Recompiled for CMXMATRX-searching for next rules of matrix*
.*        V10.00.05 03/08/2010  J.Tan         CAR 227319                      *
.*                  Recompiled for PATCATBI - Mechanical Ventilation          *
.*        V10.00.04 14/07/2010  J.Tan         CAR 226158                      *
.*                  Recompiled for STEPDOWN - bed fees update                 *
.*        V10.00.03 16/07/2010 J.Tan         CAR 226322                       *
.*                  Recompiled for CMXMATRX - search for next rule if Contract*
.*                  is not valid                                              *
.*        V10.00.02 12/07/2010  J.Tan         CAR 225932                      *
.*                  Recompiled for PATCATBI - set TDATE to IDATET for per-diem*
.*        V10.00.01 07/06/2010  Mike Laming   CAR 212864                      *
.*                  Recompiled for PATCATBI - mods at GCDE6500                *
.*        V9.12.14  11/03/2010  J.Tan         CAR 216044                      *
.*                  Mods to include Leave days in stepdown count for TAC      *
.*        V9.12.13  16/02/2010  Peter Vela    CAR 215485                      *
.*                  Recompiled for PATCATBI - Ignore Leave if less than a day *
.*        V9.12.12  05/02/2010  Peter Vela    CAR 215485                      *
.*                  Recompiled for PATCATBI - Ignore Leave if less than a day *
.*        V9.12.11  02/02/2010  Davin         CAR 215234                      *
.*                  Recompiled for CMXMATRX                                   *
.*        V9.12.10  27/01/2010  J.Tan         CAR 214548                      *
.*                  Recompiled for PATCATBI - Stepdown after bed fees update  *
.*                  27/01/2010  J.Tan         CAR 214877                      *
.*                  Recompiled for CMXMATRX - Checking for range of MBS items *
.*        V9.12.09  19/01/2010  J.Tan         CAR 166439                      *
.*                  Recompiled for PATCMSTP - C/P additional charge stepdown  *
.*        V9.12.08  06/11/2009  WeeLee Koo    CAR 209709                      *
.*                  Fixed I*C on patcmxaf.                                    *
.*        V9.12.07  09/10/2009  J.Tan         CAR 203934                      *
.*                  Recompiled for PATCATBI - display ICD10 Sugg.Class on Inv.*
.*        V9.12.06  21/09/2009  J.Tan         CAR 204390                      *
.*                  Recompiled for STEPDOWN - mods to old bed fees file       *
.*        V9.12.05  24/07/2009  J.Tan         CAR 201132 & 202168             *
.*                  Recompiled for CMXMATRX - checking for zero MBS amount    *
.*        V9.12.04  20/07/2009  J.Tan         CAR 201781                      *
.*                  Fixed I*C on patmchgf                                     *
.*        V9.12.03  03/07/2009  Peter Vela    CAR 199927                      *
.*                  Recompiled for EMROPOCK - Check if PMMIAMTT = 0 GPRC4000  *
.*        V9.12.02  05/06/2009  J.Tan         CAR 196010                      *
.*                  Recompiled for CMXMATRX - ICD10 Secondary/Tertiary        *
.*        V9.12.01  11/05/2009  J.Tan         CAR 125842                      *
.*                  Recompiled for PATCATBI - Recalculate zero amt of Misc.Itm*
.*        V9.11.03  16/03/2009  J.Tan         CAR 188205                      *
.*                  Recompiled for PATCATBI - Mods to Non-banked Deposits     *
.*        V9.11.02  20/11/2008  Steve Armstrong   CAR 181373                  *
.*                  Recompiled for changes to PATCATBI.                       *
.*        V9.11.01  30/10/2008 J.Tan      CAR 181263                          *
.*                  Recompiled for PATCATAI - printing Disch.Billing Statement*
.******************************************************************************
.*        V9.10.05  25/09/2008  J.Tan         CAR 178209                      *
.*                  Recompiled for PATCATBI - Fixed checking for Doct.chg rec.*
.*                  25/09/2008  J.Tan         CAR 179009                      *
.*                  Recompiled for STEPDOWN - Check 'Exclude Days of Hosp."   *
.*        V9.10.04  05/09/2008  J.Tan         CAR 177126                      *
.*                  Recompiled for PATCATBI - Checking matrix parameter       *
.*        V9.10.03  06/08/2008 J.Tan      CAR 175246                          *
.*                  Recompiled for AAECATBI                                   *
.*        V9.10.02  08/07/2008 Sandra Barcham CAR 173135                      *
.*                  Recompiled for PATCATBI - Remove close of PATDGWA1        *
.*        V9.10.01  12/05/2008  J.Tan         CAR 162313                      *
.*                  Added Deposit Status to compdeaf file                     *
.******************************************************************************
.*        V9.09.14  04/03/2008 J.Tan          CAR 157583                      *
.*                  Recompiled for AAECATBI-Invoice total with 'Out of Pocket"*
.*        V9.09.13  29/02/2008  J.Tan         CAR 162893 & 162609             *
.*                  Recompiled for PATCATBI - Inv.breakdown and Lumpsum amt   *
.*        V9.09.12  20/02/2008  Peter Vela    CAR 161535                      *
.*                  Recompiled for PATCATBI                                   *
.*        V9.09.11  23/01/2008  J.Tan         CAR 159701                      *
.*                  Added option to print zero invoice                        *
.*        V9.09.10  03/01/2008  J.Tan         CAR 136785                      *
.*                  Recompiled for STEPDOWN                                   *
.*        V9.09.09  12/11/2007 J.Tan       CAR 151803                         *
.*                  Recompiled for AAECATBI - ED Billing                      *
.*        V9.09.08  04/10/2007  Jill Habasque CAR 150322                      *
.*                  Mods to use PTCNHITC                                      *
.*        V9.09.07  24/08/2007  Peter Vela CAR 146143                         *
.*                  Recompiled for PATCATBI                                   *
.*        V9.09.06  20/08/2007 J.Tan          CAR 144656                      *
.*                  Recompiled for PATCATBI - for Multiple Procedures Billing *
.*        V9.09.05  10/08/2007  Peter Vela CAR 146143                         *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.04  17/07/2007  J.Tan     CAR 140282                          *
.*                  Recompiled for NZPCATBI - Revenue breakdown               *
.*        V9.09.03  03/07/2007  Peter Vela CAR 142173                         *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.02  29/06/2007  Peter Vela CAR 142173                         *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.01  07/06/2007 J.Tan             CAR 142173                   *
.*                  Mods for Emergency event                                  *
.******************************************************************************
.*        V9.08.08  16/04/2007  J.Tan            CAR 138026                   *
.*                  Recomp.for PATCATBI - JH Charging for discharged day      *
.*        ........  18/04/2007  Mike Laming      CAR 138285                   *
.*                  Added OPEN for PMSMTIA4                                   *
.*        V9.08.07  19/02/2007 Peter Vela     CAR 135241                      *
.*                  Recompiled for PATCATBI - St. John of God invoice layout  *
.*        V9.08.06  26/02/2007  J.Tan         CAR 120014                      *
.*                  Recompiled for NZPCATBI - NZ exploding misc.item          *
.*        V9.08.05  02/02/2007  Ebon Clements CAR 120001                      *
.*                  Added nz private billing files                            *
.*        V9.08.04  31/01/2007  Peter Vela    CAR 127930                      *
.*                  Recompiled for EMRSITFD                                   *
.*        V9.08.03  18/12/2006 J.Tan          CAR 128578                      *
.*                  Recompiled for OUTCATBI - GST amount for O/P Next invoice *
.*        V9.08.02  17/11/2006  Peter Vela    CAR 124538                      *
.*                  Recompiled for PATCATBI                                   *
.*                  Added display of PATITMFD.PTITTCER                        *
.*                  Type of Certificate Type B Type C                         *
.*        V9.08.01  18/10/2006  J.Tan         CAR 120502                      *
.*                  Recompiled for PATCATBI - Ignore Doctor Change record     *
.******************************************************************************
.*        V9.07.03  25/09/2006  Peter Vela    CAR 118940                      *
.*                  Recompiled for PATCATBI                                   *
.*        V9.07.02  12/09/2006  Jill Habasque  CAR 109852                     *
.*                  Mods to output alternate ID if PTCNDAUR=1                 *
.*        V9.07.01  01/08/2006  J.Tan         CAR 103365                      *
.*                  Recompiled for PATCATBI - John Hopkins                    *
.******************************************************************************
.*        V9.06.01  16/05/2006  Peter Vela    CAR 104103                      *
.*                  Recompiled for PATCATBI - PTCNINVL=12                     *
.******************************************************************************
.*        V9.04.B02 20/12/2005  J.Tan         CAR 89226                       *
.*                  Recompiled for PATCATBI - recalculate theatre fees        *
.*        V9.04.12  02/11/2005  Peter Vela        CAR 81394                   *
.*                  Recompiled for PATCATBI                                   *
.*        V9.04.11  02/09/2005  J.Tan         CAR 62750                       *
.*                  Recompiled for PATDINVS - changed amount to F12.2         *
.*        V9.04.10  31/08/2005  J.Tan         CAR 74153                       *
.*                  Recompiled for CMXMATRX - checking for exclusive          *
.*        V9.04.09  16/06/2005  Mike Laming   CAR 61746                       *
.*                  Recompiled for CLPATDTR - add clear PTDTTIME & PTDTCRST   *
.*        V9.04.08  29/11/2004  Mike Laming   CAR 54534                       *
.*                  Re-comple for PATCMSTP - fix Addit.Charge Description     *
.*        V9.04.07  22/10/2004  J.Tan  CAR 54506                              *
.*                  Fixed I*C on pmsmtiaf file                                *
.*        V9.04.06  18/10/2004  J.Tan    CAR 54027                            *
.*                  Fixed option 1 (Invoice pending report) consolidate report*
.*                  to include discharged patients                            *
.*                  Fixed reading system parameter for Using Matrix (PTCNNWCM)*
.*        V9.04.05  15/10/2004  J.Tan    CAR 54178                            *
.*                  Fixed File PID - keyin the sequence option                *
.*        V9.04.04  23/09/2004  Lina Vo  CAR 53660                            *
.*                  Recompiled for PATCATBI - multi hospital theatre fee      *
.*        V9.04.03  08/09/2004  J.Tan    CAR 53292                            *
.*                  Recompiled for STEPDOWN - bed fees not setup              *
.*        V9.04.02  31/08/2004  J.Tan  CAR 53073                              *
.*                  Fixed Multi hospital id variable                          *
.*        V9.04.01  23/08/2004  J.Tan  CAR 52835                              *
.*                  Recompiled for AAEINVS - Multi hospital                   *
.******************************************************************************
.*        V9.03.17  22/06/2004  Lina Vo  CAR 50811                            *
.*                  Removed use of RCPDEPFD & IO - now obselete.              *
.*        V9.03.16  09/06/2004  J.Tan    CAR 50035                            *
.*                  Re-compile for PATCATBI - Mechanical ventilation          *
.*        V9.03.15  22/04/2004  Mike Laming   CAR 46224                       *
.*                  Re-compile for PATCATBI - Theatre DTR sequences           *
.*        V9.03.14  12/02/2004  Henry Son        CAR 47385                    *
.*                  Added PTCNMBSF for checking if we allow more than         *
.*                  Six MBS Items.                                            *
.*        V9.03.13  23/02/2004  Mike Laming   CAR 47440                       *
.*                  Re-compile for PATCATBI - initialise TPATAMTP             *
.*        V9.03.12  18/12/2003  J.Tan  CAR 44093                              *
.*                  Recompiled for new receipting files                       *
.*        V9.03.11  03/12/2003  Davin  CAR 44095                              *
.*                  Removed reference to receipting trans file                *
.*        V9.03.10  18/11/2003  Henry Son   CAR 39291                         *
.*                  Allow more than 7 Theatre stepdown fees.                  *
.*                  Recompile PATCATBI.                                       *
.*        V9.03.09  03/11/2003  Mike Laming  CAR 43911                        *
.*                  Recompile for PATCATBI - correct GROSSTOT & ACCMTOT       *
.*        V9.03.08  17/10/2003  J.Tan  CAR 44176                              *
.*                  Recompiled for PATCATBI.                                  *
.*        V9.03.07  17/09/2003 Lina Vo CAR 40497                              *
.*                  Recompile for AAECATBI, OUTCATBI & PATCATBI.              *
.*        V9.03.06  17/09/2003 J.Tan  CAR 36504                               *
.*                  Recompile for PATGNCMX - Web billing changes              *
.*        V9.03.05  13/08/2003  CAR 41196   Lina Vo                           *
.*                  Recompile for big changes in PATSELFN.                    *
.*                  11/08/2003  CAR 41072   Mike Laming                       *
.*                  Recompile for PATCATBI to correct Lump Sums in BIL19      *
.*        V9.03.04  04/08/2003  CAR 34330/41952   Mike Laming                 *
.*                  Recompiled for PATCATBI & PATDINVS - Add second temp      *
.*                  file for Misc.Items to change sequence to Date/DTR seq.   *
.*        V9.03.03  30/06/2003  Dean Cramer CAR 38200                         *
.*                  Fixed were indefinite loop under some conditions          *
.*        V9.03.02  12/06/2003  Dean Cramer CAR 38200                         *
.*                  Fixed so if 2nd pass has no data won't print 0 total line *
.*        V9.03.01  02/06/2003  Dean Cramer CAR 38200                         *
.*                  Fixed Outpatients - All  heading print                    *
.*                  Change screen displays as requested                       *
.******************************************************************************
.*        V9.02.16  01/05/2003  Dean Cramer                                   *
.*                  Removed rcptrn      - not used                            *
.*        V9.02.15  13/02/2003  Dean Cramer  CAR 22238                        *
.*                  Recompiled for rcptrn                                     *
.*        V9.02.14  12/11/2002  J.Tan                                         *
.*                  Recompiled for PATIVMES                                   *
.*        V9.02.13  30/10/2002  J.Tan                                         *
.*                  Recompiled for CMXMATRX                                   *
.*        V9.02.12  19/09/2002  J.Tan                                         *
.*                  Recompiled for PATCATBI                                   *
.*        V9.02.11  09/09/2002  J.Tan     SRF 20791                           *
.*                  Recompiled for PATCATBI                                   *
.*        V9.02.10  24/07/2002  J.Tan  SRF 19425                              *
.*                  Recompiled for CMXMATRX - mods to use health fund grouper *
.*        V9.02.09  31/05/2002  Dean Cramer   Srf 17555                       *
.*                  Include name sequence.                                    *
.*        V9.02.08  22/04/2002  J.Tan                                         *
.*                  Recompiled for PATCATBI - changes from 6.09               *
.*        V9.02.07  24/01/2002  Jill Habasque                                 *
.*                  Added move zero to UNKGST to stop from looping            *
.*        V9.02.06  22/01/2002  Steve Downing  SRF 14240                      *
.*                  Recompiled for PATCATBI - changes to modbury layout       *
.*        V9.02.05  07/12/2001  Tonii                                         *
.*                  Recompiled for PATCATBI - Casemix changes                 *
.*        V9.02.04  17/10/2001  Greg Horvat      SRF 13654                    *
.*                  Recompiled for PATCATBI - Changed to display the patient's*
.*                  admission number when a casemix error occurs              *
.*                  16/10/2001  Greg Horvat      SRF 13636                    *
.*                  Recompield for PATCATBI - Changed to use AADMNO rather    *
.*                  than TADMN when reading pattranf for the 1st time when    *
.*                  calculating the amount to be invoiced                     *
.*        V9.02.03  06/10/2001  J.Tan                                         *
.*                  Recompiled for CMXMATRX                                   *
.*        V9.02.02  04/10/2001  J.Tan                                         *
.*                  Recompile for PATCATBI (casemix - matrix changes)         *
.*                  Include PATTFEFD, new variable ZERO4, dummy label GETTHR  *
.*        V9.02.01  22/09/2001  Tonii  SRF 13075                              *
.*                  Recompiled for PATDINVS                                   *
.******************************************************************************
.*        V5.10.B01 05/04/2001  Jill Habasque SRF 1768                        *
.*                  Mods to only remove zero records if CREMINV = 1           *
.*        V5.09.B01 03/01/2001  Jill Habasque                                 *
.*                  Casemix mods - recompiled for PATCATBI                    *
.*        V5.08.12  22/11/2000  Greg Horvat                                   *
.*                  Recompiled for PATCATBI - Commented out any code to do    *
.*                  with Hong Kong or Mt Alvernia                             *
.*        V5.08.11  09/11/2000  Ebon Clements SRF 6891                        *
.*                  Recompiled for PATINVS read patmchgf with key26           *
.*        V5.08.10  24/10/2000  Dean Cramer   SRF 6710                        *
.*                  Recomplied for OUTCATBI                                   *
.*                  Changed for health fund table code size increase to       *
.*                  8 characters                                              *
.*        V5.08.09  14/09/2000 Caleb Sharman                                  *
.*                  Health fund change mods                                   *
.*        V5.08.08  04/08/2000 J.Tan   SRF 2435                               *
.*                  Recomp.for PATCATBI - no totals for lanscape with RH      *
.*        V5.08.07  31/08/2000  J.Tan                                         *
.*                  Fixed checking status for different pass flag             *
.*        V5.08.06  16/08/2000  Caleb Sharman                                 *
.*                  Changed Health Fund variables to be 8 chars               *
.*        V5.08.05  29/06/2000  Steve Armstrong                               *
.*                  Recompiled for PATCATBI                                   *
.*        V5.08.04  29/05/2000  Caleb Sharman                                 *
.*                  Recompiled for OUTCATBI                                   *
.*        V5.08.03  18/05/2000  Jill Habasque                                 *
.*                  Recompiled for changes to AAECATBI                        *
.*        V5.08.02  15/05/2000 J.Tan                                          *
.*                  Recompiled for PATCATBI - landscape invoice               *
.*        V5.08.B05 10/04/2000  Greg Horvat                                   *
.*                  Removed MATADAFD MATADBFD & MATADBIO                      *
.*        V5.08.B04 30/03/2000  Steve Downing                                 *
.*                  Recompiled for PATCATBI                                   *
.*        V5.08.B03 08/03/2000  Steve Downing                                 *
.*                  Fixed read position for IBCNUGST                          *
.*        V5.08.B02 28/02/2000  Greg Horvat                                   *
.*                  Recompiled for PATCATBI - Changed a few routines into     *
.*                  procedures                                                *
.*        V5.08.B01 17/02/2000 Steve Downing                                  *
.*                  Added GST Unknown report                                  *
.******************************************************************************
.*       V5.07.05   16/12/1999 J.Tan                                          *
.*                  Recompiled for PATCATBI-nursing home & Y2K "tobe invoiced"*
.*       V5.07.04   25/08/1999  Jill Habasque SRF 633206                      *
.*                  Fixed printing of Ward/Bed in PATCATBI                    *
.*       V5.07.03   04/08/1999  Jill Habasque SRF 633553                      *
.*                  Recompiled for PATINVS                                    *
.*       V5.07.02   13/07/1999  Nicole Harrington                             *
.*                  Recompiled for AAECATBI                                   *
.*       V5.07.01   10/03/1999  J.Tan                                         *
.*                  Mods for casemix funding                                  *
.*       V5.07.B02  13/01/1999  Jim Stathopoulos                              *
.*                  Fixed Global Compile Errors                               *
.*       V5.07.B01  12/11/1998  Jim Stathopoulos                              *
.*                  507 Changes                                               *
.****************************************************************************** 
.*        V5.05.01  14/10/1997  Steve Armstrong    SRF 643393                 *
.*                  Recompiled for removal of THC invoice message             *
.******************************************************************************
.*        V5.04.03  21/02/97 J.Tan                                            *
.*                  Fixed displaying error message if both reports required   *
.*        V5.04.02  13/02/97 J.Tan   SRF 619000                               *
.*                  Fixed the error message for no data found                 *
.*        V5.04.01  15/06/1996  Greg Horvat      SRF 616143                   *
.*                  Recompiled for OUTCATBI & PATCATBI - Added new invoice    *
.*                  layout for MBF - layout 17                                *
.*                                                                            *
.* ************************************************************************** *
.*                                                                            *
. *                      V5.01.01  04/07/89 S. O'Gorman                       *
. *                                Converted for N.Z.                         *
. *                                11/08/89 Graeme Williams                   *
. *                                Added PATNZRA1, CFEETYP                    *
. *                      V5.01.02  25/08/89 Graeme Williams                   *
. *                                Added GST to PATCATBI                      *
. *                      V5.01.03  05/09/89 J.Tan           SRF 102172        *
. *                                Fixed stepdown.                            *
. *                      V5.01.04  06/09/89 J.Tan           SRF 102231        *
. *                                Heading to uppercase                       *
. *                      V5.01.05  08/09/89 K.Peak          SRF 102263        *
. *                                Zero filled accomm. date                   *
. *                      V5.01.06  26/09/89 M.Ohleiter      SRF 102444        *
. *                                Included 'end of report' messages          *
. *                      V5.01.07  28/09/89 Graeme Williams SRF 102483        *
. *                                Changes PATCATBI                           *
. *                      V5.01.08  19/10/89 J.Tan           SRF 102712        *
. *                                Fixed stepdown.                            *
. *                      V5.01.09  20/11/89 J.Tan           SRF 102252        *
. *                                Added other financial option in PATSELFN.  *
. *                      V5.01.10  23/05/90 J.Tan           SRF 104901        *
. *                                Mods PATITMFD                              *
. *                      V5.01.11  12/06/90 J.Tan           SRF 105193        *
. *                                Fixed discount for stepdown                *
. *                      V5.01.12  09/07/90 J.Tan           SRF 105437        *
. *                                Recompiled for PATCATBI                    *
. *                      V5.01.13  11/07/90 Paul Duncan                       *
. *                                recomp for OUTBOA & OUTBOB                 *
. *                      V5.01.14  07/08/90 i. chung        SRF 105195        *
. *                                Recompile due to change in STEPDOWN        *
. *                                Add CONTROLF read for CAUDQ (Rate Change   *
. *                                Audit)                                     *
. *                      V5.01.121 17/09/90 J.Tan         SRF 106164          *
. *                                Recompile for rate change audit            *
. *                      V5.01.122 26/09/90 J.Tan  SRF 106551                 *
. *                                Recompiled for PATCATBI                    *
. *                      V5.01.123 01/10/90 J.Tan         SRF 104665          *
. *                                Recompiled for PATCATBI                    *
. *                      V5.01.124 10/10/90 J.Tan         SRF 106608          *
. *                                Mods to STEPDOWN                           *
. *                      V5.01.125 27/11/90 J.Tan         SRF 107203          *
. *                                Recompiled for PATCATBI                    *
. *                      V5.01.126 27/11/90 Glen Hobby                        *
. *                                Recompiled for changes to                  *
. *                                PATMX1FD                                   *
. *                      V5.01.127 06/12/90 J.Tan         SRF 107260          *
. *                                Changes to PATCATBI - accom.fee to daycase *
. *                      V5.01.128 17/01/91 J.Tan         SRF 107348          *
. *                                Recompile for PATCATBI                     *
. *                      V5.01.129 29/01/91 J.Tan         SRF 107718          *
. *                                Recompile for PATCATBI                     *
. *                                                                           *
. *       V5.01.130 26/02/91      Justin Coates  Quote 6762 SRF 105469        *
. *                 Recompiled for STEPDOWN                                   *
. *       V5.01.131 10/05/91      ROD   (go tiges!)                           *
. *                 Recompiled for CFEETYP=3 (Wellington billing)             *
. *       V5.01.132 04/06/91 J.Tan      SRF 108733                            *
. *                 Mods to Stepdown                                          *
. *       V5.01.133 02/08/91 J.Tan     SRF 1024                               *
. *                 Recompiled for PATCATBI                                   *
. *       V5.01.134 08/08/91 J.Tan    SRF 109947                              *
. *                 Recompiled for STEPDOWN                                   *
. *       V5.01.135 21/08/91 J.Tan    SRF 110192, 110180                      *
. *                 Recompiled for STEPDOWN                                   *
. *       V5.01.136 26/08/91 J.Tan    SRF 110192, 110180                      *
. *                 Recompiled for STEPDOWN                                   *
. *       V5.01.137 10/09/91 J.Tan    SRF 110204                              *
. *                 Fixed the totals (to exclude zero amount of invoices)     *
. *       V5.01.138 19/09/91 Graeme Williams    SRF 110446                    *
. *                 Recompiled for PATCATBI                                   *
. *       V5.01.139 15/01/92 Graeme Williams                                  *
. *                 New Zealand billing changes                               *
. *       V5.01.140 29/01/91     J.Tan       SRF 112583                       *
. *                 Re-compiled for PATCATBI (V5.01.16)                       *
. *       V5.01.141 01/02/1992   Graeme Williams                              *
. *                 Changes to the billing includes                           *
. *       V5.01.142 06/05/1992   Graeme Williams            SRF 113588        *
. *                 Added the system parameter PTCNCNDY to determine if the   *
. *                 day count for the bed fee file should be reset when the   *
. *                 the admission type is changed.                            *
. *                 This change is in the STEPDOWN include.                   *
. *       V5.01.143 12/06/92  Graeme Williams               SRF 114865        *
. *                 Changes for 9 character misc items                        *
. *       V5.01.144 23/07/92 J.Tan            SRF 116056                      *
. *                 Recompiled for PATCATBI   (5.01.19)                       *
. *       V5.01.145 06/11/1992  Graeme Williams                               *
. *                 Recompiled for OUTCATBI   (5.01.05)                       *
. *       V5.01.146 04/02/1993    Justin Coates  SRF 120071                   *
. *                 Re-compile for PATCATBI                                   *
. *       V5.01.147 15/03/1993  Steve Armstrong                               *
. *                 Recompiled for STEPDOWN (new episode field PTTREPNO)      *
. *       V5.01.148 19/04/93 DIG                                              *
. *                 Added PTCNADDC parameter for additional charging.         *
. *       V5.01.149 06/09/93    DIG                        SRF : 125019       *
. *                 Re-Compiled for change to STEPDOWN                        *
. *       V5.01.150 21/01/1994  Matt Surridge                                 *
. *                 Recompiled for PATCRATE                                   *
. *       V5.01.151 18/02/1994  Steve Armstrong                               *
. *                 Recompiled for PATCATBI and mods for Mt. Alvernia         *
. *       V5.01.152 06/04/1994  Steve Armstrong                               *
. *                 Recompiled for PATCATBI.                                  *
. *                 Mods to standardise                                       *
. *       V5.01.153 29/04/1994  Steve Armstrong                               *
. *                 Recompiled for PATCATBI                                   *
. *       V5.01.154 29/04/1994  Steve Armstrong                               *
. *                 Recompiled for PATCATBI                                   *
. *       V5.01.155 24/05/1994 Ian Rutt                                       *
. *                 Fixed Global Recompile Bugs                               * 
.*        V5.01.156 16/06/1994  ROD                                           *
.*                  Recompile for Multi Dbase Receipting                      * 
.*        V5.01.157 29/07/1994  Rob Leonard  Quote 8064                       *
.*                  Recompiled for PATCATBI                                   *
.*        V5.02.01  02/03/1995  Greg Horvat      SRF 134196  Quote 8277       *
.*                  Recompiled for AAECATBI, PATCATBI & OUTCATBI              *
.*        V5.02.02  19/05/1995  Steve Armstrong                               *
.*                  Recompiled                                                *
.*        V5.02.03  05/05/1995  ROD           SRF 136175                      *
.*                  Recompiled for changes to PATINV10 & PATINV16             *
.*        V5.03.B2  24/05/1995  Paul Howells     SRF 134644                   *
.*                  Check whether using invoice pending file before writing.  *
.*        V5.03.B3  02/06/1995  Steve Armstrong                               *
.*                  Mods for changes to RCPDEPFD (RCDPADMN)                   *
.*        V5.03.B4  06/06/95  Paul Howells                  SRF 136735        *
.*                  Recompiled for PATSELFN                                   *
.*        V5.03.01  01/08/1995  Greg Horvat      SRF 610897                   *
.*                  Recompiled for AAECATBI - Changed Port Mac. invoice to    *
.*                  print the attending doctor in the body of the invoice     *
.*        V5.03.02  17/08/1995  Paul Howells     SRF 611251                   *
.*                  Moved PTCNIPEN
.*        V5.03.03  13/12/95  J.Tan      SRF 640744                           *
.*                  Recomp.for PATCATBI- no deposit display for insurance inv.*
.*                                                                            *
.******************************************************************************
.
          INC       STD001FD
          INC       PATCOMM/INC
          INC       PABXVARS/INC
          INC       IBASEQFD/INC                 * Sequential Numbers File
          INC       TFILEVAR/INC                 * Generate Temp File Name
          INC       WEBERRFD/INC                 * Web Server Error Logging
.
          INC       AAEDE1FD/INC
          INC       AAEDEBFD/INC
          INC       AAEDTRFD/INC
          INC       IBASECFD/INC
          INC       IBAPASFD/INC
          INC       IBAGEDFD/INC
          INC       IBAGSTFD/INC
          INC       IBACONFD/INC
          INC       IBATMDFD/INC
          INC       IBATMHFD/INC
          INC       NHIMASFD/INC
.
          INC       MLTCFNFD/INC
          INC       MRTLOCFD/INC                 * MR Location
          INC       MRTMASFD/INC                 * MR Tracking Master
          INC       MRTVISFD/INC                 * MR Visit Links

          INC       NZPBFEFD/INC
          INC       NZPCFNFD/INC
          INC       NZPCMTFD/INC
          INC       NZPEXTFD/INC
          INC       NZPRDTFD/INC
          INC       NZPFIGFD/INC
          INC       NZPFINFD/INC
          INC       NZPIBRFD/INC
          INC       NZPMCHFD/INC
          INC       NZPMXCFD/INC
          INC       NZPPFEFD/INC
          INC       NZPRBRFD/INC
          INC       NZPRFNFD/INC
          INC       NZPPICFD/INC
          INC       NZPSPRFD/INC
          INC       NZPTFEFD/INC
          INC       NZPRVBFD/INC
          INC       NZPIVBFD/INC
          INC       OPRARDFD/INC
          INC       OPRDEAFD/INC
          INC       OPRSESFD/INC
.
          INC       OUTSESFD/INC
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       OUTDTRFD/INC
          INC       OUTSITFD/INC
          INC       PATELGFD/INC
          INC       PATBFEFD/INC
          INC       PATCALAG/INC
          INC       PATCFAFD/INC
          INC       PATCODFD/INC
          INC       PMSCIDFD/INC
          INC       PMSCCDFD/INC
          INC       PATCONFD/INC
          INC       PATCTFFD/INC
          INC       PATDHEAD/INC
          INC       PATDINVS/INC
          INC       PATDGWFD/INC
          INC       PATDO1FD/INC
          INC       PATDRGFD/INC
          INC       PATDSCFD/INC
          INC       PATDTRFD/INC
          INC       PATECDFD/INC
          INC       PATECOFD/INC
          INC       PATFINFD/INC
          INC       PATFMOFD/INC
          INC       PATFX1FD/INC
          INC       PATFN1FD/INC
          INC       PATFN2FD/INC
          INC       PATFHIFD/INC
          INC       PATGTUFD/INC
          INC       PATHSPFD/INC
          INC       PATHTRFD/INC
          INC       EMRHTRFD/INC
          INC       OUTHTRFD/INC
          INC       PATIBLFD/INC
          INC       PATICUFD/INC
          INC       PATIN1FD/INC
          INC       PATINMFD/INC
          INC       PATINVFD/INC
          INC       PATIOVFD/INC
          INC       PATIPEFD/INC
          INC       PATITMFD/INC
          INC       PATMA1FD/INC
          INC       PATMCHFD/INC
          INC       PATMI1FD/INC
          INC       PATOVBFD/INC
          INC       PATPGRFD/INC
          INC       PATRE1FD/INC
          INC       PATRBLFD/INC
          INC       PATRATFD/INC
          INC       PATRCAUD/INC
          INC       PATRFNFD/INC
          INC       PATSELDT/INC
          INC       PATSRBFD/INC
          INC       PATONHFD/INC
          INC       PATTFEFD/INC
          INC       PATTRNFD/INC
          INC       PATVENFD/INC
          INC       PATVISFD/INC
          INC       PATWC1FD/INC
          INC       PATWMAFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       PMSEVTFD/INC
          INC       PMSCNOFD/INC
          INC       PMSHATFD/INC
          INC       PMSHCPFD/INC
          INC       PMSSINFD/INC
          INC       PATCMTFD/INC
          INC       PMSCMTFD/INC
          INC       PMSSGAFD/INC
          INC       PMSMTIFD/INC
          INC       PMSMPRFD/INC
          INC       PMSVX1FD/INC
          INC       PRIITMFD/INC
.
          INC       PATCMXFD/INC
          INC       PATAFEFD/INC
          INC       PATASDFD/INC
          INC       PATHDFFD/INC
          INC       PATHLFFD/INC
          INC       PATLDFFD/INC
          INC       PATLSDFD/INC
          INC       PATRGMFD/INC
          INC       PMSREGFD/INC
          INC       PATSTAFD/INC
          INC       PATAA1FD/INC
          INC       PATNIDFD/INC
          INC       PATONLFD/INC
.
          INC       EMRSITFD/INC
          INC       EMRHISFD/INC
          INC       EMRVISFD/INC
          INC       COMDEPFD/INC
          INC       RCPBNKFD/INC
          INC       RCPDTEFD/INC
          INC       RCPBDTFD/INC
          INC       RCPCONFD/INC
          INC       PMSBRQFD/INC
          INC       PMSPBRFD/INC
          INC       PMSIDEFD/INC
          INC       PMSEDGFD/INC       * Effective DRG Dates
          INC       PMSPX2FD/INC
.
          INC       VISXDCFD/INC
          INC       VISXDCTD/INC
.
          INC       WEBSECFD/INC
          INC       PATDDHFD/INC
.
.         Temporary File Definition
.         -------------------------
.
.         Filename : BIL60Axx.dat          (xx = port id)
.
PENTEMP1  IFILE SQL, FIXED=49, KEY="U1-20,21-40,41-48"
.
.NAME     TYPE    LENGTH     PHYSICAL     START     DESCRIPTION
.----     ----    ------     --------     -----     -----------
TEMPSUR   DIM       20          20          1       Patient Surname
TEMPGIV   DIM       20          20          21      Patient Given Name 
TEMPADM   DIM       8           8           41      Admission Number
.
.End of Record                              49
.
ABFTEMP1  IFILE SQL, FIXED=147, KEY="U1-20,21-40,41-48"
ABFTEMP2  IFILE SQL, FIXED=147, KEY="U41-48,1-20,21-40"
.
.NAME     TYPE    LENGTH     PHYSICAL     START     DESCRIPTION
.----     ----    ------     --------     -----     -----------
.TEMPSUR   DIM       20          20          1       Patient Surname
.TEMPGIV   DIM       20          20          21      Patient Given Name
.TEMPADM   DIM       8           8           41      Admission Number
TEMPGRO   DIM       15          15          49      Gross Total
TEMPTOD   DIM       4           4           64      Total Days
TEMPCLA   DIM       3           3           68      Claim Type
TEMPATY   DIM       3           3           71      Admission Type
TEMPACL   DIM       3           3           74      Admission Class
TEMPUS2   DIM       3           3           77      Category U2
TEMPAFU   DIM       6           6           80      Health Fund
TEMPTTB   DIM       15          15          86      
TEMPTTN   DIM       15          15          101
TEMPTTD   DIM       15          15          116
TEMPODT   DIM       8           8           131
TEMPURN   DIM       8           8           139
.
.End of Record                              147
.
.
.               WORK AREA
.
ERASEIT   INIT      "iserase "
ISBIT     INIT      "isbuild "
PIPE      INIT      "|"
UKEYIT    INIT      " 49 U1-20,21-40,41-48"
UKEYI1    INIT      " 147 U1-20,21-40,41-48 U41-48,1-20,21-40"
.
ADMISSNO  DIM       8
ADAY      DIM       2
AMON      DIM       2
AYER      DIM       2
ACEN      DIM       2
ACCDTE    DIM       8     * accommodation date used in AAECATBI
AECNFTYP  FORM      1
AECNCHRS  FORM      1
ACTION    DIM       1                       * Action for PATAA1FD
ADD       DIM       2                       * Day for PATAA1FD
AMM       DIM       2                       * Month for PATAA1FD
AYY       DIM       2                       * Year for PATAA1FD
ACC       DIM       2                       * Century for PATAA1FD
OPERCODE  DIM       4                       * Operator code for PATAA1FD
.
CSTRTYR   DIM       8
CDYSDAYS  FORM      6                       * CALCDAYS number of days
CDYSFDTE  DIM       8                       * CALCDAYS from date
CDYSTDTE  DIM       8                       * CALCDAYS to date
CDYSYEAR  FORM      2                       * CALCDAYS year
BULKBILL  DIM       1
CODE      DIM       2
CURRDATE  DIM       8
CMDLINE   DIM       80
CMDLIN1   DIM       70
CMDLIN2   DIM       16
CURSESS   DIM       18
CUTDAY    DIM       2
CUTMON    DIM       2
CUTYER    DIM       2
CUTCEN    DIM       2
CALDAYS   FORM      3
CATCR     INIT      "cr"
CODECL    INIT      "CL"
CODEDP    INIT      "DP"
CODEPY    INIT      "Py"
CERTINDC  FORM      1
.
DB        INIT      "DB"
DDDAY     DIM       2
DDMON     DIM       2
DDYER     DIM       2
DDCEN     DIM       2
DIM1A     DIM       1
*DIM3      DIM       3
DIM3T     DIM       3
DIM4      DIM       4
DIM5A     DIM     5
DIM9      DIM       9
DIM11     DIM       11
DIM13     DIM       13
DIM14     DIM     14
DIM18     DIM       18
DIM18A    DIM       18
DIM24A    DIM       24
DIM30     DIM       30
DOCTCODE  DIM       6
DOCFNAME  DIM       50
.
EXPORTFL  FORM      1         * Create Export File
EMCNGINV  DIM       1
EMCNDPOC  DIM       1
EMCNOPOC  DIM       15
EFTDATE   DIM       8         * Effective date (ccyymmdd)
.
FORM3A    FORM      3
FORM5     FORM      5
FIVE9     FORM      "59"
FMTGNAME  DIM       35
FMTTITLE  DIM       10
FMTSNAME  DIM       35
.
HOLDFLAG  FORM      1        * Accounts on Hold option
HOLDTEXT  INIT      "HOLD-"
HOSPID    DIM       3
HOSPNAME  DIM       50
HINVDES   DIM       30
HESYST    FORM      1
HFHIFUND  FORM      2
INCLBOOK  FORM      "0"
.
JYEAR     FORM      2
.
KEY13A    DIM       13
KEYFLAG   FORM      1
.
MHLRCODE  DIM       3
MBSFLAG   FORM      1
MRCLODSC  DIM       30                                     *T0867342
.
NMPNUMB   DIM       20
.
PASS      FORM      1
.
OPCNCONS  DIM       1
OPOCFLAG  FORM      1
OPNFLAG   FORM      "0"      * Used in stepdown
OPRDATE   DIM       8
OTCNCFEE  FORM      1
OTCNFTYP  FORM      1
.
SERVDOCT  DIM       10
SAVAMNT   FORM      12.2
SAVALLW   FORM      12.2
SAVBEND   FORM      3
SAVDISC   FORM      12.2
SAVEXTRA  FORM      12.2
SP12      INIT      "            "
SP14      INIT      "              "
SUROPT    FORM      1
.
TEMPFILE  DIM       8
TEMPFIL1  DIM       8
TFEEIND   FORM      1
THCFLG    FORM      2
THREED    INIT      "3"
TTBILL    FORM      12.2
TTDAYS    FORM      8
TTNETT    FORM      12.2
UPADMTYP  DIM       1
WDATE1    DIM       8
WDATE2    DIM       8
WARNINGL  DIM       20
ZERO4     INIT      "0000"
ZEROINVC  DIM       1
.
DISCONLY  FORM      1     * discharged only 1=no 0=yes
.
TILDA35   INIT      "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
.
USERID    DIM       10
.
.         Web Variables (only the include files use these variables)
.
DAYFORMT  DIM       4
NJAN      INIT      "January"
NFEB      INIT      "February"
NMAR      INIT      "March"
NAPR      INIT      "April"
NMAY      INIT      "May"
NJUN      INIT      "June"
NJUL      INIT      "July"
NAUG      INIT      "August"
NSEP      INIT      "September"
NOCT      INIT      "October"
NNOV      INIT      "November"
NDEC      INIT      "December"
.
HTMLFILE  FIFO      ASCII, FIXED=250
MTHNAM3   DIM       3
MTHNAM3A  DIM       3
.
CFPAYCOD  DIM       3        * 3M Codefinder PAY Code
.
.
.         end web variables
.
.------------------------------------------------------------------------
PRGID     INIT      "IBABIL60"
PRGNAM    INIT      "Invoice Pending Report"
VERSION   INIT      "V12.00.01"
.------------------------------------------------------------------------
+
.         START OF PROGRAM
.
          CALL      DISPHEAD                   * call display head routine
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS,*85,IBCNUGST
          READ      CONTROLF,TEN;*104,PTCNMBSF:                        *C-47385
                                 *217,CAUDQ    * added for V5.01.14 - SRF 105195
          READ      CONTROLF,TEN3;*245,CHOSTYP
          READ      CONTROLF,TEN5;*247,CSTDOWN
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,TWENTY;*164,PTRESDAY,*193,PTCNDCLM:
                                    *199,PTCNBCUT,*211,PTCNCNDY
          READ      CONTROLF,TWENTY1;*120,PTCNADDC
          READ      CONTROLF,THIRTY;*200,AECNFTYP
          READ      CONTROLF,THIRTY1;*163,OTCNFTYP,OTCNCFEE
          READ      CONTROLF,FIVE9;*1,CDLSTEP,*5,CREMINV:
                                   *66,CGSTPERC,CGSTITEM
          READ      CONTROLF,SEVENTY7;*214,PTCNBTNM
          READ      CONTROLF,SEVENTY9;*68,PTCNMFEE,PTCNJFEE
          READ      CONTROLF,SEVENTY9;*248,PTCNIPEN
          READ      CONTROLF,EIGHTY8;*162,PTCFEEOF,*248,PTCNISBZ
          READ      CONTROLF,HUND05;*99,PTCNNWCM
          READ      CONTROLF,HUND12;*102,PTCNHITC
          READ      CONTROLF,HUND25;*244,PTCNSAMT
          READ      CONTROLF,HUND28;*105,PTCNUABF
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMCHG1,"patmchgf"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
.
          DISPLAY   *P64:24,"patmx1af";
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY   *P64:24,"patcmxaf";
          OPEN      PATCMXA1,"patcmxaf"
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patdo1af";
          OPEN      PATDO1A1,"patdo1af"
.
          DISPLAY   *P64:24,"patwr1af";
          OPEN      PATWR1A1,"patwr1af"
.
          DISPLAY   *P64:24,"patdtraf";
          OPEN      PATDTRA1,"patdtraf"
.
          DISPLAY   *P64:24,"patre1af"
          OPEN      PATRE1A1,"patre1af"
.
          DISPLAY   *P64:24,"pmsmtiaf";
          OPEN      PMSMTIA1,"pmsmtiaf"
          OPEN      PMSMTIA2,"pmsmtiaf"
          OPEN      PMSMTIA4,"pmsmtiaf"
.
          DISPLAY   *P64:24,"pmspx2af"
          OPEN      PMSPX2A1,"pmspx2af"
.
          DISPLAY   *P64:24,"pattranf";
          OPEN      PATTRAN2,"pattranf"
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH1,"patdschf"
.
          DISPLAY   *P64:24,"patitemn";
          OPEN      PATITEM1,"patitemn"
.
          DISPLAY   *P64:24,"emrvisaf";
          OPEN      EMRVISA1,"emrvisaf"
.
          DISPLAY   *P64:24,"aaede1af";
          OPEN      AAEDE1A1,"aaede1af"
.
          DISPLAY   *P64:24,"aaedtref";
          OPEN      AAEDTRE1,"aaedtref"
.
          DISPLAY   *P64:24,"outsitaf";
          OPEN      OUTSITA1,"outsitaf"
.
          DISPLAY   *P64:24,"oprardaf";
          OPEN      OPRARDA1,"oprardaf"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
.
          DISPLAY   *P64:24,"pmsvx1af";
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"rcpbdtaf";
          OPEN      RCPBDTA1,"rcpbdtaf"
.
          DISPLAY   *P64:24,"nzpbfeaf";
          OPEN      NZPBFEA1,"nzpbfeaf"
.
          DISPLAY   *P64:24,"nzpcfnaf"
          OPEN      NZPCFNA1,"nzpcfnaf"
.
          DISPLAY   *P64:24,"nzpcmtaf"
          OPEN      NZPCMTA1,"nzpcmtaf"
          OPEN      NZPCMTA2,"nzpcmtaf"
          OPEN      NZPCMTA3,"nzpcmtaf"
.
          DISPLAY   *P64:24,"nzpfigaf"
          OPEN      NZPFIGA1,"nzpfigaf"
          OPEN      NZPFIGA2,"nzpfigaf"
.
          DISPLAY   *P64:24,"nzpfinaf"
          OPEN      NZPFINA1,"nzpfinaf"
          OPEN      NZPFINA2,"nzpfinaf"
.
          DISPLAY   *P64:24,"nzpibraf"
          OPEN      NZPIBRA1,"nzpibraf"
.
          DISPLAY   *P64:24,"nzpmchaf"
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      NZPMCHA2,"nzpmchaf"
.
          DISPLAY   *P64:24,"nzppicaf"
          OPEN      NZPPICA1,"nzppicaf"
          OPEN      NZPPICA2,"nzppicaf"
.
          DISPLAY   *P64:24,"nzprbraf"
          OPEN      NZPRBRA1,"nzprbraf"
.
          DISPLAY   *P64:24,"nzprfnaf"
          OPEN      NZPRFNA1,"nzprfnaf"
          OPEN      NZPRFNA2,"nzprfnaf"
.
          DISPLAY   *P64:24,"nzppfeaf"
          OPEN      NZPPFEA1,"nzppfeaf"
.
          DISPLAY   *P64:24,"nzpspraf"
          OPEN      NZPSPRA1,"nzpspraf"
          OPEN      NZPSPRA2,"nzpspraf"
.
          DISPLAY   *P64:24,"nzptfeaf"
          OPEN      NZPTFEA1,"nzptfeaf"
          OPEN      NZPTFEA2,"nzptfeaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA1,"oprdetaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA2,"oprdetaf"
.
          DISPLAY   *P64:24,"oprsesaf"
          OPEN      OPRSESA1,"oprsesaf"
.
          OPEN      PMSEVTA1,"pmsevtaf"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATFX1A1,"patfx1af"
          OPEN      PATCFAA1,"patcfaaf"
          OPEN      PATMCHG1,"patmchgf"
.
. If using GST
.
          IF        IBCNUGST = TWO
            DISPLAY   *P64:24,"patgtuaf";
            OPEN      PATGTUA1,"patgtuaf"
          ENDIF
.
          DISPLAY   *P64:24,"patipenf";
          OPEN      PATIPEN1,"patipenf"
.
          DISPLAY   *P64:24,"mrtvisaf";     * Medical Records visit
          OPEN      MRTVISA1,"mrtvisaf"
.
          DISPLAY   *P64:24,"mrtmasaf";     * MR Tracking Master
          OPEN      MRTMASA2,"mrtmasaf"
.
          DISPLAY   *P64:24,"mrtlocaf";     * MR Tracking Locations
          OPEN      MRTLOCA4,"mrtlocaf"
.
          DISPLAY   *P64:24,"visxdcaf";     * Visit Extra Data
          OPEN      VISXDCA1,"visxdcaf"
.
...  used in ABFAECCL
          CALL      TFILENAM                * Get file name calculating Exponent
          MOVE      TFILNAME,FNAMEN
.
...  used in PATCATBI CRMV0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEX
.
...  used in PATCATBI PTMP0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEZ
.
...  used in PATCATBI PT2P0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEY
.
...  used in PABXBILL
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAME
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAM2
.
          CALL      TFILENAM                     * Generate temporary file name
          MOVE      TFILNAME,TEMPFILE
.
          CALL      TFILENAM                     * Generate temporary file name
          MOVE      TFILNAME,TEMPFIL1
+
.        START OF PROGRAM
.
.        Determine which system this report is for
.
START     KEYIN     *P1:4,*EF:
                    *P1:4,*V2LON,*DV,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,*DV,ONE,*HOFF," = Invoice Pending Report":
                    *P1:6,*V2LON,*DV,TWO,*HOFF," = Discharged In-Patients Only":
                    *P1:8,"Option : ",*V2LON,OPTION
.
          COMPARE   ZERO,OPTION
          GOTO      ENDIT IF EQUAL
.
          MOVE      ZERO,DISCONLY
          MOVE      ZERO,INCLBOOK
          BRANCH    OPTION,STARTB,STARTA
.
          BEEP
          GOTO      START
.
STARTA    MOVE      ONE,DISCONLY
          MOVE      THREE,FSTSYS                  * Starting system = Inpatient
          MOVE      THREE,FEDSYS                  * Ending system = Inpatient
          GOTO      STARTC
.
STARTB    CALL      PATSELFN
          BRANCH    EXIT,START
.
STARTC    
.         COMPARE   ONE,CREMINV
.         GOTO      GETINV IF NOT EQUAL
.
          DISPLAY   *P1:13,*EF,*P1:14,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:15,*V2LON,ONE,*HOFF," = Patient Surname Sequence":
                    *P1:16,*V2LON,TWO,*HOFF," = Admission Number Sequence"
.
STARTD    KEYIN     *P1:18,*EL,"Select option : ",*DV,UNDLN1:
                    *P17:18,*V2LON,SUROPT 
.
          COMPARE   ZERO,SUROPT   
          GOTO      START IF EQUAL
.
          BRANCH    SUROPT,STARTE,STARTE
          BEEP
          GOTO      STARTD
.
STARTE    
.        Make sure they want to remove the zero amount of invoice from
.        invoice pending
.
          KEYIN     *P1:19,*EL,"Do you really want to delete zero ":
                    "invoices of Discharged patients (":
                    *V2LON,"Y",*HOFF,*DV,SLASH:
                    *V2LON,"N",*HOFF,")? ",ANS;
          REP       UPPLOW,ANS
.
          MATCH     "Y",ANS
          GOTO      GETINV IF EQUAL
.
          MATCH     "N",ANS
          GOTO      START IF NOT EQUAL
.
          MOVE      ZERO,CREMINV
.
GETINV    MOVE       SP10,HOSPID
          IF         IBCNMHOS = 1
            DISPLAY    *P1:20,*EL,"Hospital Id : ";
            MOVE       TEN5,ECOL
            MOVE       "20",EVERT
            MOVE       SP3,CKYIDEF3
            MOVE       ZERO,CKYIMAND           * Not Mandatory
            OPEN       PATHSPA1,"pathspaf"
.
            CALL       PATHSPKY
            BRANCH     EXIT,KYHOSP20,START
            MOVE       PTHSHOSP,HOSPID
            MOVE       PTHSNAME,HOSPNAME
            GOTO       KYHOSP30
.
KYHOSP20    MOVE       "All Hospitals",HOSPNAME
            MOVE       SP10,HOSPID
.
KYHOSP30    CLOSE      PATHSPA1
.
            DISPLAY    *P23:20,*V2LON,PTHSNAME;
          ENDIF
.
          MOVE      SP70,ZEROINVC
          KEYIN     *P1:21,*EL,"Zero Invoice (":
                    *V2LON,"0 ",*HOFF,"for Include, ":
                    *V2LON,"1 ",*HOFF,"for Exclude, ":
                    *V2LON,"2 ",*HOFF,"for Zero Inv.Only) ? ",ZEROINVC
.
.         Accounts On Hold option
.
          KEYIN     *P1:22,*EL,"Accounts On Hold (":
                    *V2LON,"0 ",*HOFF,"for Include, ":
                    *V2LON,"1 ",*HOFF,"for Exclude, ":
                    *V2LON,"2 ",*HOFF,"for Report ) ? ",HOLDFLAG
.
          CALL      CRTX0000                 * Create Export File for Excel
          CALL      BOPT0000                 * Include ABF Booked outpat.? 
          CALL      KUSR0000                 * Keyin user id
.
.        Print the report
.
          COMPARE   TWO,SUROPT  
          GOTO      GETINV1 IF EQUAL
.
          CALL      CREA0000                * Create temporary file
          CALL      LOAD0000                * Load in debtors
.
GETINV1   MOVE      ZERO,CPAGENO
          MOVE      ONE,CNOUNDLN
          MOVE      ZERO,UGSTFLAG           * Unknown GST flag
          MOVE      ZERO,CLNO
          CALL      IBACLOCK
.
          IF        EXPORTFL=1
            CALL      EHED0000               * Print the heading
            MOVE      ZERO,CLNO
          ENDIF
.
          BRANCH    FSTSYS OF PS1ONLY,PS1ONLY,PS1BOTH,PS1ONLY
.
PS1BOTH   MOVE      ZERO,PASS
          CALL      INVPND
          BRANCH    DISCONLY,PS1END
.
PS1ONLY   MOVE      ONE,PASS
          CALL      INVPND
.
          IF        IBCNUGST = TWO & UGSTFLAG=1
            MOVE      TWO,PASS
            CALL      INVPND
          ENDIF
.
......    BRANCH    EXIT,START   * removed for task 0909755
.
PS1END    CALL      CPOUTF00
          CALL      KILL0000                     * remove existing file
.
          IF        INCLBOOK=1
            CALL      CRE10000
            MOVE      ONE,PROGFLAG
            MOVE      ZERO,EXPORTFL
            MOVE      ZERO TO TTBILL
            MOVE      ZERO TO TTNETT
            MOVE      ZERO TO TTDAYS
            MOVE      "99",CLNO
            MOVE      ONE,PASS
            CALL      BOUT0000                    * 'Booked' outpatients
            MOVE      ZERO,BOUTFLAG
            CALL      KIL10000
          ENDIF
.
          DISPLAY   *P1:24,*EL,*V2LON:
                    "** Report Generation Completed **",*W2;
.
          GOTO      START
+
.****************************************************************************
.* Copy output spool file to extract directory                              *
.****************************************************************************
CPOUTF00  CLEAR     CMDLINE
          APPEND    "ibabil60.us1 ",CMDLINE
          APPEND    SPLFILE,CMDLINE
          APPEND    ".prt",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
CPOUTF99  RETURN
+
.****************************************************************************
.*                                CRTX0000             Called by: ML0000    *
.* Create export file for excel                                             *
.****************************************************************************
CRTX0000  MOVE      ZERO,EXIT
          MOVE      ZERO,EXPORTFL                  * No to create export file
          DISPLAY   *P1:23,"Create Export file for Excel : "
          KEYIN     *P32:23,*V2LON,*RV,DIM1:
                    *P32:23,*DV,DIM1
          REP       UPPLOW,DIM1
          DISPLAY   *P32:23,*V2LON,DIM1
          MOVE      ONE,EXPORTFL
          MATCH     "Y",DIM1
          GOTO      CRTX9999 IF EQUAL
          MOVE      ZERO,EXPORTFL
.
CRTX9999  RETURN
+
.****************************************************************************
.*                                BOPT0000             Called by: ML0000    *
.* Include ABF Booked outpatient                                            *
.****************************************************************************
BOPT0000 MOVE      ZERO,INCLBOOK
         MATCH     "1",PTCNUABF
         GOTO      BOPT9999 IF NOT EQUAL    * Not using ABF
.
         BRANCH    FSTSYS,BOPT9999,BOPT1000,BOPT9999,BOPT9999
.
BOPT1000 KEYIN      *P1:24,*EL,"Include Booked Outpatients in the ":
                    " 'To Be Invoiced' Section (Y/N) ? ":
                    *V2LON,ANS;
         REP        "yYnN",ANS
         MATCH      ANSN,ANS
         GOTO       BOPT9999 IF EQUAL
         MATCH      ANSY,ANS
         GOTO       BOPT9999 IF NOT EQUAL
.
         MOVE       ONE,INCLBOOK
.
BOPT9999  RETURN
+
.******************************************************************************
.*                                  KUSR0000                                  *
.*                     Keyin user id                                          *
.******************************************************************************
KUSR0000  KEYIN     *P1:24,*EL,"User ID: ",*V2LON,USERID;
          PACK      USERID,USERID,SP70
.
          MATCH     SP70,USERID
          GOTO      KUSR9500 IF EQUAL
.
          OPEN      WEBSECA1,"websecaf"
.
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          IF        OVRCD = 0
            MOVE      WBSEPCD,PASSCODE           * web user operator id
            GOTO      KUSR9999
          ENDIF
.
KUSR9500  MOVE      SP70,WBSEUID
          MOVE      SP70,USERID
          MOVE      SP70,PASSCODE
KUSR9999  RETURN
+
.******************************************************************************
INVPND    MOVE      "99" TO CLNO
          MOVE      ZERO,EXIT                  * Assume a successful finish
          MOVE      ZERO TO TTBILL
          MOVE      ZERO TO TTNETT
          MOVE      ZERO TO TTDAYS
          MOVE      ONE,PROGFLAG
.
          COMPARE   TWO,SUROPT 
          GOTO      INVPND2 IF EQUAL
.
          PACK      KEY48,SP30
          CALL      RSTMP1          
.
INVPND1   CALL      RKTMP1
          BRANCH    OVRCD,ENDP
.
          PACK      KEY8,TEMPADM,SP10
          CALL      RDIPEN1
          BRANCH    OVRCD,INVPND1 
.
          GOTO      INVPND3
.
INVPND2   MOVE      SP8,KEY8
          CALL      RDSIPEN1
.
URLOOP    CALL      RDKIPEN1
          BRANCH    OVRCD,ENDP
.
          CALL      CHLD0000                      * Check Hold invoice status
          MATCH     SP3,PTIPRHLD                  * On Hold?
          IF        !@EQUAL
            BRANCH    HOLDFLAG,URLOOP             * Do not show 'On Hold'
          ENDIF
.
.
INVPND3   DISPLAY   *P1:24,*EL,*P20:24,"Admission Number";
.
          PACK      KEY8,IPADMNO,SP8
          CALL      RDPMVX11
          IF        OVRCD=1
            MOVE      SP70,PMVXATCP
            MOVE      SP70,PMVXMHOS
          ENDIF
.
          MOVE      SP70,AFUNDH
          MOVE      SP70,ACODDTE
          UNPACK    SP70,DDCEN,DDYER,DDMON,DDDAY
          MOVE      ZERO,DCFLAG
          IF        IBCNUGST = TWO
            BRANCH    PASS,CHKGST1,CHKGST2
.
CHKGST1     PACK      KEY8,IPADMNO,SP8
            CALL      RAPTGTU1
            BRANCH    OVRCD,UNKGST
.
            MOVE      ONE,UGSTFLAG       * Unknown GST flag
            GOTO      INVPND4
.
CHKGST2     PACK      KEY8,IPADMNO,SP8
            CALL      RAPTGTU1
            BRANCH    OVRCD,INVPND4
            GOTO      UNKGST
          ENDIF
.
UNKGST    DISPLAY   *P39:24,*V2LON,IPADMNO;
.
          COMPARE   FSTSYS,IPSYSTM
          GOTO      INVPND4 IF LESS
.
          COMPARE   IPSYSTM,FEDSYS
          GOTO      INVPND4 IF LESS
.
          IF        IBCNMHOS =1
            MATCH     SP10,HOSPID
            IF        !@EQUAL
              MATCH     PMVXMHOS,HOSPID
              GOTO      INVPND4 IF NOT EQUAL
            ENDIF
          ENDIF
.
.       Calculate the amount to be invoiced - different for each system
.
          MOVE      ZERO,TOTDAYS
          BRANCH    IPSYSTM OF AAECALC,OUTCALC,INPCALC,OUTCALC,INVPND4
.
INPCALC   MOVE      IPADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF INVPND4
.
          MOVE      IPADMNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD OF INVPND4
.
          CALL      CLPATDSC                * clear discharge record
          BRANCH    PASS,CHKCURR,CONTCHK
.
          COMPARE   THREE TO ASTAT
          GOTO      INVPND4 IF NOT EQUAL
          GOTO      CONTCHK
.
.       Second pass, check for current admissions, and patients on leave
.
CHKCURR   COMPARE   TWO,ASTAT
          GOTO      CONTCHK IF EQUAL
.
          COMPARE   FOUR,ASTAT
          GOTO      INVPND4 IF NOT EQUAL
.
.       Inpatient to be invoiced
.
CONTCHK   UNPACK    ADATE TO ACEN,AYER,AMON,ADAY
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF INVPND4
.
.         Initialise variables
.
          MOVE      ONE,DISFLG
          COMPARE   THREE,ASTAT
          GOTO      INPCTBI IF NOT EQUAL
.
          MOVE      ZERO,DISFLG
          MOVE      AADMNO,KEY8
          CALL      RDDSCH1
.
          UNPACK    DDATE TO DDCEN,DDYER,DDMON,DDDAY
.
INPCTBI   CALL       ISBITEMS               * Update item for Ind.Services Bill?
.
          MOVE      ZERO,DISPROG
          MOVE      CPAGENO,FORM3A
          IF        IBCNUGST=2
            MOVE      ZERO,IBCNUGST         * set no GST for pending report
            CALL      CALCTBI
            MOVE      TWO,IBCNUGST
          ELSE
            CALL      CALCTBI
          ENDIF
          MOVE      FORM3A,CPAGENO
          GOTO      INVLOOP
.
.        Outpatient to be invoiced
.
OUTCALC   BRANCH    PASS,OUTCALC0,OUTCALC0
          GOTO      INVPND4
.
OUTCALC0  MOVE      IPADMNO,PVIBILL
          MOVE      PVIBILL,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD OF INVPND4
.
          COMPARE   FOUR,IPSYSTM
          GOTO      OUTCALC1 IF NOT EQUAL
.
.         Other financial
.
          MOVE      "out",OSTFILE
          MOVE      PVIURNO,PURNO
.
          MOVE      SP3,OBACOMP
          MOVE      SP3,OBACLASS
          MOVE      SP3,OBASRCR
          MOVE      SP3,OBAINS
          MOVE      SP10,OBADATE
          MOVE      SP70,OTBBFUND
          GOTO      OUTCALC2
.
.         Outpatient
.
OUTCALC1  MATCH     FSTSITE,PVISITE
          GOTO      INVPND4 IF LESS
.
          MATCH     PVISITE,FEDSITE
          GOTO      INVPND4 IF LESS
.
          MOVE      SP3,OSTSYST
          MOVE      "out",OSTFILE
          MOVE      PVISITE,KEY6
          CALL      RDSITA1
.
          MATCH     FSTDEPT,OSTSYST
          GOTO      INVPND4 IF LESS
.
          MATCH     OSTSYST,FEDDEPT
          GOTO      INVPND4 IF LESS
.
.        Get the finanical booking details
.
GETBDET   PACK      CFNAME WITH OSTFILE,FILBB1A2
          CLOSE     OUTBB1A2
          CALL       OPOTBB12
.
          CLOSE     OUTDTRO1
          PACK      CFNAME,OSTFILE,FILDTRO1
          OPEN      OUTDTRO1,CFNAME
.
          PACK      KEY16,PVIDATE,PVIBILL
          CALL      RDBOKB2
          BRANCH    OVRCD,INVPND4
          MOVE      PVIURNO,OBAURNO
          MOVE      PVISITE,OBASITE
.
          MOVE      OBAURNO,PURNO
OUTCALC2  MOVE      PURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF INVPND4
.
          UNPACK    OBADATE WITH ACEN,AYER,AMON,ADAY
.
          IF        IBCNUGST=2
            MOVE      ZERO,IBCNUGST         * set no GST for pending report
            CALL      OUTTBI
            MOVE      TWO,IBCNUGST
          ELSE
            CALL      OUTTBI
          ENDIF
          MOVE      ZERO,TOTDAYS
.
          MOVE      OBACOMP,ACLAIM
          MOVE      OBACLASS,ATYPE
          MOVE      OBASRCR,ACLSS
          MOVE      OBAINS,AUSR2
          MOVE      OTBBFUND,AFUNDH
          GOTO      INVLOOP
.
.        A + E to be invoiced
.
AAECALC   BRANCH    PASS,AAECALC0,AAECALC0
          GOTO      INVPND4
.
AAECALC0  MOVE      IPADMNO,PVIBILL
          MOVE      PVIBILL,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD OF INVPND4
.
          COMPARE   NINE,PVITYPE
          GOTO      AAECAL10 IF NOT EQUAL
.
          MOVE      PVIURNO,ADAURNO
          MOVE      PVIBILL,ADANUMB
          MATCH     " 1",PVISYST
          GOTO      AAECAL10 IF NOT EQUAL
.
          MOVE      PVIBILL,KEY8
          CALL      RDPMEVT1                     * check for event
          BRANCH    OVRCD,AAECAL10
          PACK      KEY5,ANSE,ANSV,PMEVEVNT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,AAECAL10
          MATCH     ANSE,TCINDC1
          GOTO      AAECAL20 IF EQUAL            * Emergency event
.
AAECAL10  MOVE      PVIBILL,KEY8
          CALL      RDEMVIS1
          BRANCH    OVRCD OF INVPND4
.
          CALL      RDDETA1
          BRANCH    OVRCD OF INVPND4
          MOVE      AEDAFUND,AFUNDH
.
AAECAL20  MOVE      ADAURNO,PURNO
          MOVE      PURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF INVPND4
.
          IF        IBCNUGST=2
            MOVE      ZERO,IBCNUGST         * set no GST for pending report
            CALL      AAETBI
            MOVE      TWO,IBCNUGST
          ELSE
            CALL      AAETBI
          ENDIF
.
          MOVE      ZERO,TOTDAYS
          MOVE      PVIBILL,KEY8
          CALL      RDPMEVT1                     * Emergency event
          IF        OVRCD=0
            MOVE      PMEVADTE,ADADATE
            MOVE      PMEVCCOD,ADACOMP
            MOVE      PMEVADMT,ADACLASS
            MOVE      SP70,ADASRC
            MOVE      SP70,ADAINSUR
          ENDIF
.
          UNPACK    ADADATE WITH ACEN,AYER,AMON,ADAY
          MOVE      ADACOMP,ACLAIM
          MOVE      ADACLASS,ATYPE
          MOVE      ADASRC,ACLSS
          MOVE      ADAINSUR,AUSR2
.
.       If the invoice is for zero amount, and zero bed days, then ignore it
.
INVLOOP   MOVE      NETTOT,GROSSTOT
.
          COMPARE   ZERO,GROSSTOT
          GOTO      GCASH IF NOT EQUAL
.
          COMPARE   ZERO,TOTDAYS
          GOTO      GCASH IF NOT EQUAL
.
.       Invoice for Zero amount, Zero days - if patient is discharged, delete
.       record from the PATIPEFD file
.
          BRANCH    IPSYSTM OF DELIPEN,DELIPEN,CHKSTAT,DELIPEN,INVPND4
.
          COMPARE   THREE,ASTAT
          GOTO      DELIPEN IF EQUAL
          GOTO      INVPND4
.
.       Process any pending cash
.
GCASH     CALL      GETCASH
          SUB       CSAMT,NETTOT
.
.       Check with the indicator to remove the zero amounts of invoice
.
          COMPARE   ONE,CREMINV
          GOTO      OKPRT IF NOT EQUAL
.
          COMPARE   ZERO,GROSSTOT
          GOTO      OKPRT IF NOT EQUAL
.
          BRANCH    IPSYSTM OF DELIPEN,DELIPEN,CHKSTAT,DELIPEN,INVPND4
.
CHKSTAT   COMPARE   THREE,ASTAT
          GOTO      DELIPEN IF EQUAL
          GOTO      INVPND4
.
DELIPEN   IF        CREMINV=1
            MOVE      IPADMNO,KEY8
            CALL      DEIPEN1
            CALL      RDSIPEN1
            GOTO      INVPND4
          ENDIF
.
OKPRT     CALL      CZINV000             * Check for Zero invoice option
          BRANCH    EXIT,INVPND4
.
          ADD       GROSSTOT,TTBILL
          ADD       NETTOT,TTNETT
          ADD       TOTDAYS,TTDAYS
          CALL      PRINTL
          GOTO      INVPND4
.
INVPND4   COMPARE   TWO,SUROPT  
          GOTO      URLOOP IF EQUAL
.
          GOTO      INVPND1
.
.*******************************************************************************
.         Check for Zero Invoice option
.         ZEROINV=0 Include 1=Exclude 2=Only Zero invoice
.*******************************************************************************
CZINV000  MOVE      ZERO,EXIT
.
.       If the invoice is for zero amount, and zero bed days, then ignore it
.
          COMPARE   ZERO,GROSSTOT
          GOTO      CZINV200 IF NOT EQUAL
          COMPARE   ZERO,TOTDAYS
          GOTO      CZINV900 IF EQUAL
.
.       Check if zero invoice to be included/excluded or print only zero inv.
.
          CMATCH    "1",ZEROINVC
          GOTO      CZINV900 IF EQUAL      * Exclude zero invoice
          GOTO      CZINV999
.
CZINV200  CMATCH    "2",ZEROINVC           * Print zero invoice only?
          GOTO      CZINV999 IF NOT EQUAL
.
CZINV900  MOVE      ONE,EXIT
CZINV999  RETURN
+
.
.*******************************************************************************
.           Check Status of Hold invoice
.*******************************************************************************
CHLD0000  MATCH     SP70,PTIPRHLD
          GOTO      CHLD0200 IF EQUAL      * not on hold
.
.         Invoice already on hold, check for Patient hold invoice
.
          MOVE      "rh",KEY2
          PACK      KEY5,KEY2,PTIPRHLD
          CALL      RDCODE1
          BRANCH    OVRCD,CHLD0200
.
          MATCH     "P",TCINDC2
          GOTO      CHLD9999 IF EQUAL             * Patient hold invoice
.
          MATCH     "C",TCINDC4
          GOTO      CHLD9999 IF EQUAL             * CodeFocus hold invoice
.
.         Check the Health fund/Claim code hold invoice for 
.         printing Exclude Hold invoice or Hold Invoice only
.
CHLD0200  MOVE      IPADMNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,CHLD9999
          CALL      RDPMVX11
          BRANCH    OVRCD,CHLD9999
.
          UNPACK    SP70,PENDHOSP,PENDDDAT,PENDCLAM,PENDFUND
          IF        IBCNMHOS=1
            MOVE      PMVXMHOS,PENDHOSP            * hospital id
          ENDIF
          MOVE      ZERO,F2
          MOVE      IPSYSTM,F2
          MOVE      F2,PENDSYST                    * system

          BRANCH    IPSYSTM OF CHLD1000,CHLD2000,CHLD3000
          GOTO      CHLD9999
.
.         Emergency
.
CHLD1000  MOVE      IPADMNO,KEY8
          CALL      RDPMEVT1                    * Emergency event
          IF        OVRCD=0
            MOVE      PMEVADTE,PENDADAT         * admission date
            MOVE      PMEVCCOD,PENDCLAM         * claim code
            MOVE      PMEVDDTE,DDATE            * discharged date
          ELSE
            CALL      RDEMVIS1
            BRANCH    OVRCD OF CHLD9999
            CALL      RDDETA1
            BRANCH    OVRCD OF CHLD9999
.
            MOVE      ADADATE,PENDADAT         * admission date
            MOVE      ADACOMP,PENDCLAM         * claim code
            MOVE      AEDAFUND,PENDFUND        * health fund
            IF        EMVISTAT=2 | EMVISTAT=3
              MOVE      EMVIDDAT,PENDDDAT      * discharged date
            ENDIF
          ENDIF
          GOTO      CHLD8000
.
.         Outpatient
.
CHLD2000  MOVE      "out",OSTFILE
          MOVE      PVISITE,KEY6
          CALL      RDSITA1
.
          PACK      CFNAME WITH OSTFILE,FILBB1A2
          CLOSE     OUTBB1A1
          CALL      OPOTBB11
.
          MOVE      IPADMNO,KEY8
          CALL      RDBOKB1
          BRANCH    OVRCD OF CHLD9999
.
          MOVE      OBADATE,PENDADAT         * admission date
          MOVE      OBACOMP,PENDCLAM         * claim code
          MOVE      OTBBFUND,PENDFUND        * health fund
          MOVE      OBADATE,PENDDDAT
          GOTO      CHLD8000
.
.         Inpatient
.
CHLD3000  MOVE      IPADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF CHLD9999
.
          MOVE      ADATE,PENDADAT         * admission date
          MOVE      ACLAIM,PENDCLAM        * claim code
          MOVE      AFUNDH,PENDFUND        * health fund
          IF        ASTAT=3
            CALL      RDDSCH1
            IF        OVRCD=0
              MOVE      DDATE,PENDDDAT     * discharged date
            ENDIF
          ENDIF
.
CHLD8000  MOVE      PENDADAT,PENDSDAT         * As at date
          CALL      IPRH0000
          CALL      UPIPEN1                * Update Hold invoice status
.
CHLD9999  RETURN
+
.*******************************************************************************
.           OVER CONDITION FOUND..PRINT LAST LINE OF -- AND DISPLAY MESSAGE
.*******************************************************************************
ENDP      BRANCH    EXPORTFL,ENDP999
.
          COMPARE   THREE,FSTSYS
          GOTO      ENDP1 IF EQUAL
.
          COMPARE   ZERO,CPAGENO
          GOTO      NODATA IF EQUAL
.
ENDP1     BRANCH    PASS,ENDPA,ENDPA
.
.        Discharged Patients Report
.
          PRINT     *96,"-------",*107,"-----------",*122,"-----------":
                    *N,*95,TTDAYS,*103,TTBILL,*118,TTNETT:
                    *N,*96,"-------",*107,"-----------",*122,"-----------":
                    *N,*N,"*** END OF REPORT ***"
          RETURN
.
.        Current Admissions Report
.
ENDPA 
          IF        FSTSYS = 3
            COMPARE   ZERO,CPAGENO
            GOTO      NODATA IF EQUAL
.
            PRINT     *93,"-------",*107,"-----------",*122,"-----------":
                      *N,*92,TTDAYS,*103,TTBILL,*118,TTNETT:
                      *N,*93,"-------",*107,"-----------",*122,"-----------":
                      *N,*N,"*** END OF REPORT ***"
            RETURN
          ENDIF

          IF        TTBILL=ZERO & TTNETT=ZERO
            RETURN
          ELSE
            PRINT     *107,"-----------",*122,"-----------":
                      *N,*103,TTBILL,*118,TTNETT:
                      *N,*107,"-----------",*122,"-----------"
.
            IF        INCLBOOK<>1
              PRINT     *N,"*** END OF REPORT ***"
            ELSE
              IF        BOUTFLAG=1
                PRINT     *N,"*** END OF REPORT ***"
              ENDIF
            ENDIF
            RETURN
          ENDIF          
.
NODATA    DISPLAY   *P1:24,*EL,*B:
                    "No Data Found for the Selected Report.  ";
          CALL      HITENTER
          MOVE      ONE,EXIT                     * No data found
ENDP999   RETURN
+
.****************************************************************************
.     PRINT ACTUAL DATA
.
PRINTL    BRANCH    PASS,PRINTLZ,PRINTLZ
.
          COMPARE   "55",CLNO
          CALL      HEAD IF NOT LESS
.
          MOVE      SP20,DIM13
.
          UNPACK    PSNAME,KEY13
          MOVE      PGNAME,DIM13
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND10;*249,PTCNDAUR
          PACK      DIM9,PURNO,SP70
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            PACK      KEY20,SP70
            PROC      GETALIDS
            MATCH     SP70,KEY20
            IF        !@EQUAL
              UNPACK    KEY20,DIM11,DIM9
            ENDIF
          ENDIF
.
          PACK      DIM8A,SP70         * Print 'On Hold' Reason
          IF        HOLDFLAG=2
            MATCH     SP70,PTIPRHLD    * Hold reason exists = 'On Hold'
            IF        !@EQUAL
              PACK      DIM8A,HOLDTEXT,PTIPRHLD,SP70
              GOTO      PRINTLB
            ENDIF
          ENDIF
.
          PACK      DIM1,SP70
          MATCH     SP10,ACODDTE
          IF        @EQUAL
            MOVE      "*",DIM1
          ENDIF
.
          PACK      DIM1A,SP70
          MATCH     "1",PTCNHITC
          GOTO      PRINTLB IF NOT EQUAL
.
          PACK      KEY8,IPADMNO,SP8
          CALL      RDPTVIS1
          BRANCH    OVRCD,PRINTLB
.
          COMPARE   THREE,PVITYPE
          GOTO      PRINTLB IF NOT EQUAL
.
          MATCH     "1",PMVXATCP
          IF        !@EQUAL
            MOVE      "*",DIM1A
          ENDIF
.
PRINTLB   IF        EXPORTFL=1
            CALL      PELN0000                * Print export file line
          ELSE
.
PRINTLC
            PRINT     IPADMNO,*10,DIM9,*19,KEY13," ",DIM13:
                      *49,ADAY,SLASH,AMON,SLASH,AYER:
                      *58,DDDAY,SLASH,DDMON,SLASH,DDYER:
                      *69,ACLAIM,*75,ACLSS;
.
            MATCH     SP70,DIM8A
            IF        !@EQUAL
              PRINT     *81,DIM8A;
            ELSE
              PRINT     *81,DIM1,DIM1A;
            ENDIF
.
            PRINT     *90,ATYPE,*99,TOTDAYS,*103,GROSSTOT,*118,NETTOT
            ADD       ONE,CLNO
          ENDIF
.
          CALL      UPVXDC00
.
          RETURN
.
.****************************************************************************
PRINTLZ   COMPARE   "55",CLNO
          CALL      HEADA IF NOT LESS
.
          BRANCH    IPSYSTM OF PRINTNP,PRINTNP,PRINTNI,PRINTNP,PRINT9
.
PRINTNI   UNPACK    PGNAME,DIM13
          UNPACK    PSNAME,KEY13
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND10;*249,PTCNDAUR
          PACK      DIM9,PURNO,SP70
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            PACK      KEY20,SP70
            PROC      GETALIDS
            MATCH     SP70,KEY20
            IF        !@EQUAL
              UNPACK    KEY20,DIM11,DIM9
            ENDIF
          ENDIF
.
          PACK      DIM8A,SP70         * Print 'On Hold' Reason
          IF        HOLDFLAG=2
            MATCH     SP70,PTIPRHLD    * Hold reason exists = 'On Hold'
            IF        !@EQUAL
              PACK      DIM8A,HOLDTEXT,PTIPRHLD,SP70
            ENDIF
          ENDIF
.
          IF        EXPORTFL=1
            CALL      PELN0000                * Print export file line
          ELSE
            PRINT     IPADMNO,*10,DIM9,*19,PSNAME," ",DIM13:
                      *57,ADAY,SLASH,AMON,SLASH,AYER:
                      *66,ACLAIM,*72,ACLSS;
.
            MATCH     SP70,DIM8A
            IF        !@EQUAL
              PRINT     *78,DIM8A;
            ELSE
              PRINT     *78,AUSR2;
            ENDIF
.
            PRINT     *87,ATYPE,*96,TOTDAYS,*103,GROSSTOT,*118,NETTOT
            ADD       ONE,CLNO
          ENDIF
.
          CALL      UPVXDC00
.
          RETURN
.
.****************************************************************************
PRINTNP   UNPACK    PGNAME,KEY20
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND10;*249,PTCNDAUR
          PACK      DIM9,PURNO,SP70
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            PACK      KEY20,SP70
            PROC      GETALIDS
            MATCH     SP70,KEY20
            IF        !@EQUAL
              UNPACK    KEY20,DIM11,DIM9
            ENDIF
          ENDIF
.                           
          PACK      DIM8A,SP70        * Print 'On Hold' Reason
          PACK      DIM1,SP70
          PACK      DIM1A,SP70
          BRANCH    BOUTFLAG,PRINTNP1  * Print ABF Booked Outpatient
.
          PACK      DIM8A,SP70        * Print 'On Hold' Reason
          IF        HOLDFLAG=2
            MATCH     SP70,PTIPRHLD    * Hold reason exists = 'On Hold'
            IF        !@EQUAL
              PACK      DIM8A,HOLDTEXT,PTIPRHLD,SP70
              GOTO      PRINTNP1
            ENDIF
          ENDIF
.
          PACK      DIM1,SP70
          MATCH     SP10,ACODDTE
          IF        @EQUAL
            MOVE      "*",DIM1
          ENDIF
.
          PACK      DIM1A,SP70
          MATCH     "1",PTCNHITC
          GOTO      PRINTNP1 IF NOT EQUAL
.
          PACK      KEY8,IPADMNO,SP8
          CALL      RDPTVIS1
          BRANCH    OVRCD,PRINTNP1
.
          COMPARE   THREE,PVITYPE
          GOTO      PRINTNP1 IF NOT EQUAL
.
          MATCH     "1",PMVXATCP
          IF        !@EQUAL
            MOVE      "*",DIM1A
          ENDIF
.
PRINTNP1  
          IF        EXPORTFL=1
            CALL      PELN0000                * Print export file line
          ELSE
            PRINT     IPADMNO,*10,DIM9,*19,PSNAME," ",KEY20:
                      *61,ADAY,SLASH,AMON,SLASH,AYER:
                      *72,ACLAIM,*77,ACLSS;
.
            MATCH     SP70,DIM8A
            IF        !@EQUAL
              PRINT     *83,DIM8A;
            ELSE
              PRINT     *83,DIM1,DIM1A;
            ENDIF
.
            PRINT     *92,ATYPE,*103,GROSSTOT,*118,NETTOT
            ADD       ONE,CLNO
          ENDIF
.
          CALL      UPVXDC00
.
PRINT9    RETURN
+
.****************************************************************************
.         Print line for Export file
.****************************************************************************
PELN0000    MOVE      "N",KEY1
            MATCH     SP70,ACODDTE
            IF        !@EQUAL
              MOVE      "Y",KEY1                * Coding Complete
            ENDIF

            MOVE      SP3,DIM3T                 * All theatre charges posted
            MATCH     "1",PMVXATCP              * if Yes
            GOTO      PELN1700 IF EQUAL
.
            PACK      KEY31,IPADMNO,SP70
            CALL      RSOPDEA2
PELN1000    CALL      RKOPDEA2                  * read oprdetaf Theatre Booking
            BRANCH    OVRCD,PELN1500
.
            MATCH     DIPADMNO,OPDAADMN
            GOTO      PELN1500 IF NOT EQUAL
.
            MATCH     "3",DOPDASTA              * if booking Cancelled
            GOTO      PELN1500 IF EQUAL
.
            MATCH     "2",DOPDASTA              * if booking Admitted   
            GOTO      PELN1600 IF EQUAL
.
            MATCH     "4",DOPDASTA              * if booking Discharged
            GOTO      PELN1600 IF EQUAL
.
            GOTO      PELN1000                  * next record
.
PELN1500    MOVE      "N/A",DIM3T                                         
            GOTO      PELN2000
.
PELN1600    MOVE      "N",DIM3T
            GOTO      PELN2000
.
PELN1700    MOVE      "Y",DIM3T
            GOTO      PELN2000
.
PELN2000    PACK      KEY27,KEY13,SP1,DIM13,SP70
            PACK      KEY8,ADAY,SLASH,AMON,SLASH,AYER,SP70
            MOVE      SP70,DIM8
            MATCH     SP70,DDDAY
            IF        !@EQUAL
              PACK      DIM8,DDDAY,SLASH,DDMON,SLASH,DDYER,SP70
            ENDIF
.
            PRINT     "<tr><td>",IPADMNO,"</td>":
                      "<td>",DIM9,"</td>":
                      "<td>",KEY27,"</td>":
                      "<td>",KEY8,"</td>":
                      "<td>&nbsp;",DIM8,"</td>"
.
            PRINT     "<td>",ACLAIM,"</td>":
                      "<td>&nbsp;",AFUNDH,"</td>":
                      "<td>",ACLSS,"</td>":
                      "<td>",KEY1,"</td>":
                      "<td>",DIM3T,"</td>":
                      "<td>",ATYPE,"</td>":
                      "<td>",TOTDAYS,"</td>":
                      "<td>",GROSSTOT,"</td>":
                      "<td>",NETTOT,"</td>":
                      "<td>",PTIPRHLD,"</td>"
.
          IF        IBCNMHOS=1
            PRINT     "<td>&nbsp;",PMVXMHOS,"</td>"
          ENDIF
.
          CALL        MREC0000                    * Get MR Vol. & Location
          PRINT       "<td>",DMRMAVOL,"</td>":
                      "<td>",MRCLODSC,"</td>"
.
          PRINT       "</tr>"
PELN9999  RETURN
+
.-----------------------------------------------------------
. Write/Update Visit Extra Data with 'Amount to be Invoiced'
.-----------------------------------------------------------
UPVXDC00  MOVE      GROSSTOT,FORM7P2             * amount to be invoiced
.
          CALL      IBACLOCK                     * current date/time
.
          PACK      KEY11,IPADMNO,VSTYP003,SP70
          CALL      RDVSXDC1
          BRANCH    OVRCD,UPVXDC50
.
          MOVE      FORM7P2,VSXDVAL1             * form 7.2 = dim 10
.
          MOVE      USERID,VSXDUUSR
          PACK      VSXDUDAT,CCC,CYY,CMM,CDD
          REP       " 0",VSXDUDAT
          MOVE      CTIMEIS,VSXDUTIM
          CALL      UPVSXDC1
          GOTO      UPVXDC90
.
UPVXDC50  CALL      CLVISXDC
.
          MOVE      IPADMNO,VSXDVISN             * visit number
          MOVE      VSTYP003,VSXDTYDA            * date type = "003"
.
          MOVE      FORM7P2,VSXDVAL1
.
          MOVE      USERID,VSXDCUSR
          PACK      VSXDCDAT,CCC,CYY,CMM,CDD
          REP       " 0",VSXDCDAT
          MOVE      CTIMEIS,VSXDCTIM
          CALL      WRVSXDC1
.
.         Read the relevant records for the patient and
.         broadcast an HL7 update visit message (A08)
.
UPVXDC90  MATCH     "1",PTCNSAMT
          GOTO      UPVXDC99 IF NOT EQUAL        * sending inv amt in A08?
.
          COMPARE   ZERO,GROSSTOT
          GOTO      UPVXDC99 IF EQUAL            * only send non-zero amounts
.
          PACK      KEY8,IPADMNO,SP70
          CALL      RDPTMIS1                     * admission on file ?
          BRANCH    OVRCD,UPVXDC99               * no - finish
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1                      * pmi record on file ?
          BRANCH    OVRCD,UPVXDC99               * no - finish
.
          CALL      CLPMSPX2
          MOVE      AURNO,KEY8
          CALL      RDPMPX21                     * get pmi extension record
.
          CALL      CLPATRE1
          PACK      KEY8,IPADMNO,SP70
          CALL      RDPTRES1                     * get PRA record
.
.         Get the last transfer record
.
          PACK      KEY30,IPADMNO,TILDA35
          CALL      RDSTRAN2                     * pos'n after last tran record
          CALL      RDPTRAN2                     * read previous record
          BRANCH    OVRCD,UPVXDC99               * eof - finish
.
          MATCH     IPADMNO,TADMN                * same admission still ?
          GOTO      UPVXDC99 IF NOT EQUAL        * no - finish
.
          MATCH     ANSD,TMOVE                   * discharged ?
          GOTO      UPVXDC99 IF NOT EQUAL        * only send discharges
.
          CALL      PMIGTNID              * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      ONE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLICAC              * broadcast change admission details
.
UPVXDC99  RETURN
+
.****************************************************************************
.                 HEADINGS FOR OUTPUT
.
HEAD      BRANCH    EXPORTFL,HEAD99
.
          MOVE      "- Discharged Patients",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          MOVE      SEVEN,CLNO
          IF        IBCNMHOS=1
            ADD       ONE,CLNO
          ENDIF
.
          CALL      PROPT000              * Print Zero Invoice option
.
          PRINT     *N,"Adm.",*10,"U/R",*49,"Billing":
                    *58,"Discharge",*69,"Comp.",*75,"Pat.",*81,"Charge":
                    *90,"Pat.",*96,"Days to",*107,"  Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *49,"Date ",*58,"Date ",*69,"Code",*75,"Cat":
                    *81,"Status",*90,"Class",*96,"Invoice":
                    *107,"  Invoiced",*122,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"-----------------":
                    "----------":
                    *49,"--------",*58,"---------",*69,"-----",*75,"----":
                    *81,"--------",*90,"-----",*96,"-------",*107,"-----------":
                    *122,"-----------"
.
HEAD99    RETURN
.
.****************************************************************************
HEADA     BRANCH    EXPORTFL,HEADA99
.
          BRANCH    FSTSYS OF HEADNIP,HEADNIP,HEADCUR,HEADNIP
.
          IF        PASS = TWO
            MOVE      "-GST Unknown Report",CPHDROPT
          ELSE
            MOVE      "-Consolidated Report",CPHDROPT
          ENDIF
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          MOVE      SEVEN,CLNO
          IF        IBCNMHOS=1
            ADD       ONE,CLNO
          ENDIF
          CALL      PROPT000              * Print Zero Invoice option
.
          IF        BOUTFLAG=1
            PRINT     *N,"*** ABF Booked Outpatients ***"
          ENDIF
.
.
          PRINT     *N,"Adm.",*10,"U/R",*56,"Admission",*66,"Comp.",*72,"Pat.":
                    *78,"Charge",*87,"Pat.",*94,"Days to",*107,"Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *60,"Date",*66,"Code",*72,"Cat",*78,"Status",*87,"Class":
                    *94,"Invoice":
                    *107,"Invoiced",*122,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"----------------------":
                    "-------------":
                    *56,"---------",*66,"-----",*72,"-----",*78,"--------":
                    *87,"-----",*94,"-------":
                    *105,"-----------",*122,"-----------"
.
HEADA99   RETURN
.
.****************************************************************************
HEADCUR   IF        PASS = TWO
            MOVE      "-GST Unknown Report",CPHDROPT
          ELSE
            MOVE      "- Current Admissions",CPHDROPT
          ENDIF
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          MOVE      SEVEN,CLNO
          IF        IBCNMHOS=1
            ADD       ONE,CLNO
          ENDIF
          CALL      PROPT000              * Print Zero Invoice option
.
          PRINT     *N,"Adm.",*10,"U/R",*56,"Admission",*66,"Comp.",*72,"Pat.":
                    *78,"Charge",*87,"Pat.",*93,"Days to",*107,"  Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *59,"Date",*66,"Code",*72,"Cat",*78,"Status",*87,"Class":
                    *93,"Invoice":
                    *107,"  Invoiced",*122,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"----------------------":
                    "----":
                    *56,"---------",*66,"-----",*72,"-----",*78,"--------":
                    *87,"-----",*93,"-------":
                    *107,"-----------",*122,"-----------"
.
          RETURN
.
.****************************************************************************
HEADNIP   BRANCH    PASS,HEADNIP2,HEADNIPG
.
HEADNIP2  BRANCH    FSTSYS,HEADNIPA,HEADNIPO,HEADCUR,HEADNIPH
          GOTO      HEADNIPA
.
HEADNIPG  MOVE      "-GST Unknown Report",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          IF        FSTSYS = TWO
            MATCH     SP3,FSTDEPT
            GOTO      HEADNIPD IF NOT EQUAL
            PRINT     *40,"SITES ",FSTSITE," TO ",FEDSITE
          ENDIF
.
          GOTO      HEADNIPC
.
HEADNIPA  MOVE      "- Acc. & Emergency",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          GOTO      HEADNIPC
.
HEADNIPH  MOVE      "- Other Financial",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          GOTO      HEADNIPC
.
HEADNIPO  MATCH     SP3,FSTDEPT
          GOTO      HEADNIPD IF NOT EQUAL
.
          MOVE      "- Outpatients",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          PRINT     *40,"SITES ";
.
          MATCH     SP6,FSTSITE
          IF  @EQUAL
            PRINT     *46,"START ";
           ELSE
            PRINT     *46,FSTSITE;
          ENDIF
.
          PRINT     *52," TO ";
.
          MATCH     "ZZZZZZ",FEDSITE
          IF  @EQUAL
            PRINT     *56,"FINISH";
           ELSE
            PRINT     *56,FEDSITE;
          ENDIF
.
          GOTO      HEADNIPC
.
HEADNIPD  MOVE      SP20,TDESC
          PACK      KEY5,CODEO,FSTDEPT
          CALL      RDCODE1
.
          MOVE      "- Outpatients",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          MATCH     SP6,FSTSITE
          GOTO      OPSITE IF NOT EQUAL
.
          PRINT     *45,"ALL SITES";
          GOTO      OPDEPT
.
OPSITE    PRINT     *40,"SITE ",FSTSITE;
.
OPDEPT    MATCH     SP3,FSTDEPT
          GOTO      HEADNIPC IF EQUAL
.
          PRINT     *55,"DEPARTMENT ",FSTDEPT
.
HEADNIPC  IF        FSTSYS = 2
            MOVE      EIGHT,CLNO
          ELSE
            MOVE      SEVEN,CLNO
          ENDIF
          IF        IBCNMHOS=1
            ADD       ONE,CLNO
          ENDIF
.
          CALL      PROPT000              * Print Zero Invoice option
.
          IF        BOUTFLAG=1
            PRINT     *N,"*** ABF Booked Outpatients ***"
          ENDIF
.
          PRINT     *N,"Bill",*10,"U/R",*61,"Service",*71,"Comp.",*77,"Sour.":
                    *83,"Insr.",*92,"Pat.",*109,"Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *62,"Date",*71,"Code",*77,"Ref",*83,"Status",*92,"Class":
                    *109,"Invoiced",*122,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"----------------------":
                    "-----------------":
                    *61,"--------",*71,"-----",*77,"-----",*83,"--------":
                    *92,"-----":
                    *107,"-----------",*122,"-----------"
.
          RETURN
.
.*******************************************************************************
.         Print Zero invoice option on header
.*******************************************************************************
PROPT000  MOVE      "(Include Zero Invoice)",KEY25
          MATCH     "1",ZEROINVC
          IF        @EQUAL
            MOVE      "(Exclude Zero Invoice)",KEY25
          ELSE
            MATCH     "2",ZEROINVC
            IF        @EQUAL
              MOVE      "(Zero Invoice Only)",KEY25
            ENDIF
          ENDIF
          PRINT     *40,KEY25
          ADD       ONE,CLNO
PROPT999  RETURN
+
.*******************************************************************************
.         Routine to print heading for Export File
.*******************************************************************************
EHED0000  PRINT     "<table border=1><tr><td width=10%>Admission No.</td>":
                    "<td>U/R No.</td>":
                    "<td>Patient Name</td>":
                    "<td>Billing Date</td>":
                    "<td>Discharge Date</td>":
                    "<td>Compensation Code</td>":
                    "<td>Health Fund</td>":
                    "<td>Patient Category</td>":
                    "<td>Coding Complete</td>"
.
          PRINT     "<td>All Theatre Charges Posted</td>":
                    "<td>Patient Class</td>":
                    "<td>Days to Invoice</td>":
                    "<td>Amt to be Invoiced</td>":
                    "<td>Amount Less Cash Received</td>":
                    "<td>Reason for Hold</td>"
.
          IF        IBCNMHOS=1
            PRINT    "<td>Hospital Id</td>"
          ENDIF
.
          PRINT     "<td>Med Rec. Volume</td>":
                    "<td>Med Rec. Location</td>"
          PRINT    "</tr>"
.
EHED9999  RETURN
+
.*******************************************************************************
.
GETCASH   OPEN      COMDEPA2,"comdepaf"
          OPEN      RCPDTEA1,"rcpdteaf"
          IF        CFEETYP = 6
            OPEN      CONTROLF,"controlf"
            READ      CONTROLF,THIRTY6;*180,RCCNDPID,RCCNDPFU
          ENDIF
.
          MOVE      ZERO,CSAMT
          MOVE      ZERO,CASHFLAG
          MOVE      IPADMNO,DAADMNO
          MOVE      "0",CMDESTAT
          PACK      KEY26,IPADMNO,CMDESTAT,SP70
          CALL      RSCMDEP2
CASHLP1   CALL      RKCMDEP2
          BRANCH    OVRCD OF ENDCSHLP
.
          MATCH     DAADMNO,CMDEADMN
          GOTO      ENDCSHLP IF NOT EQUAL
.
          MATCH     "0",CMDESTAT                   * Deposit held?
          GOTO      ENDCSHLP IF NOT EQUAL
.
          PACK      KEY17,CMDERECN,CMDETCNT
          CALL      RDRCDTE1
          BRANCH    OVRCD,CASHLP1
.
.         If Mt. Alvernia billing, then only deposits belonging to registers
.         for Initial and Further deposits will be included here
.
          IF        CFEETYP = 6
            MATCH     CMDEDTYP,RCCNDPID          * initial deposit register ?
            IF        !@EQUAL
              MATCH     CMDEDTYP,RCCNDPFU        * further deposit register ?
              GOTO      CASHLP1 IF NOT EQUAL     * no - ignore
            ENDIF
          ENDIF
.
          ADD       RCDTAMNT,CSAMT
          GOTO      CASHLP1
.
ENDCSHLP  RETURN
+
.**************************************************************************
.*                              CREA0000                                  *
.*             create a new temporary file                                *
.**************************************************************************
.
CREA0000  CALL      KILL0000                     * remove existing file
.
          PACK      CMDLIN1,ISBIT,TEMPFILE,UKEYIT
          EXECUTE   CMDLIN1,TASKID               * create temporary index file
.
          OPEN      PENTEMP1,TEMPFILE            * open temp index file
.
CREA9999  RETURN
.****************************************************************************
.*                              KILL0000                                    *
.*               close and erase the temporary file                         *
.****************************************************************************
.
KILL0000  CLOSE     PENTEMP1                     * close file
.
          PACK      CMDLIN2,ERASEIT,TEMPFILE     * set file erase command
          EXECUTE   CMDLIN2,TASKID               * erase temp file
.
KILL9999  RETURN
.****************************************************************************
.*                               LOAD0000              Called by: PROC0000  *
.*       Load the temp file with the relevant unique identifiers            *
.*       for the debtors that have pending invoices                         *
.****************************************************************************
.
LOAD0000  DISPLAY   *P1:24,*EL,"Sorting by Patient Surname....";
          PACK      KEY8,SP10
          CALL      RDSIPEN1                 
LOAD0100  CALL      RDKIPEN1                      * read next record
          BRANCH    OVRCD,LOAD9999                * end of file
.
          DISPLAY   *P32:24,*V2LON,IPADMNO;
.
          COMPARE   FSTSYS,IPSYSTM
          GOTO      LOAD0100 IF LESS
.
          COMPARE   IPSYSTM,FEDSYS
          GOTO      LOAD0100 IF LESS
.
          CALL      CHLD0000                      * Check Hold invoice status
          MATCH     SP3,PTIPRHLD                  * On Hold?
          IF        !@EQUAL
            BRANCH    HOLDFLAG,LOAD0100           * Do not show 'On Hold'
          ENDIF
.
.         set up the variables for the temp file
.
          MOVE      DIPADMNO,TEMPADM
.
          PACK      TEMPSUR,SP30  
          MOVE      "Unknown Patient",TEMPSUR 
          PACK      TEMPGIV,SP30  
.
          MOVE      IPADMNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,LOAD0100         * missing visit record
.
          MOVE      PVIURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF LOAD0100      * missing master record
.
          MOVE      PSNAME,TEMPSUR
          MOVE      PGNAME,TEMPGIV
.
          COMPARE   THREE,PVITYPE
          GOTO      LOAD0500 IF NOT EQUAL
.
          MOVE      IPADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF LOAD0100    * missing admission record
.
LOAD0500  PACK      KEY48,TEMPSUR,TEMPGIV,TEMPADM
          CALL      RATMP1                       * position on the temp file
          BRANCH    OVRCD,LOAD0900               * not on file
.
          GOTO      LOAD0100                     * get next record
.
.         write to the temp file
.
LOAD0900  CALL      WRTMP1
.
          GOTO      LOAD0100                     * get next record
.
LOAD9999  RETURN
.
.****************************************************************************
. Medical Records details                                         *T0867342 *
.****************************************************************************
MREC0000  UNPACK    SP70,DMRMAVOL,MRMACLOC,MRLODESC
          UNPACK    SP70,MRCLODSC
.          
          PACK      KEY8,IPADMNO,SP70
          CALL      RDMRVS1                       * Read mrtvisaf
          BRANCH    OVRCD,MREC9999
.
.-------- Get MR Volume & Current Location
          PACK      KEY10,MRVSMKEY,SP70
          CALL      RDMRMAS2                      * Read mrtmasaf
          BRANCH    OVRCD,MREC9999
.
.-------- Get MR current location description
           PACK     KEY7,MRMACLOC,MRMACHOS,SP70
           CALL     RDMRLOC4                      * Read mrtlocaf
           IF       OVRCD=0
             PACK     MRCLODSC,MRLODESC,SP70
           ELSE
             PACK     MRCLODSC,MRMACLOC,SP70
           ENDIF
.
MREC9999  RETURN                  
.
.****************************************************************************
.*        IO ROUTINES FOR TEMPORARY FILE                                    *
.****************************************************************************
RATMP1    MOVE      ZERO,OVRCD
          RESET     KEY48
          READ      PENTEMP1,KEY48;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTMP1    WRITE     PENTEMP1,KEY48;TEMPSUR,TEMPGIV,TEMPADM
          RETURN
.
RSTMP1    READ      PENTEMP1,KEY48;;
          RETURN
.
RKTMP1    MOVE      ZERO,OVRCD
          READKS    PENTEMP1;TEMPSUR,TEMPGIV,TEMPADM
          GOTO      OVERCOND IF OVER
          RETURN
+
.**************************************************************************
.*                              CRE10000                                  *
.*             create a new temporary file                                *
.**************************************************************************
.
CRE10000  CALL      KIL10000                     * remove existing file
.
          PACK      CMDLIN1,ISBIT,TEMPFIL1,UKEYI1
          EXECUTE   CMDLIN1,TASKID               * create temporary index file
.
          OPEN      ABFTEMP1,TEMPFIL1            * open temp index file
          OPEN      ABFTEMP2,TEMPFIL1
.
CRE19999  RETURN
.****************************************************************************
.*                              KIL10000                                    *
.*               close and erase the temporary file                         *
.****************************************************************************
.
KIL10000  CLOSE     ABFTEMP1                     * close file
          CLOSE     ABFTEMP2
.
          PACK      CMDLIN2,ERASEIT,TEMPFIL1     * set file erase command
          EXECUTE   CMDLIN2,TASKID               * erase temp file
.
KIL19999  RETURN
+
.****************************************************************************
.*        IO ROUTINES FOR TEMPORARY FILE                                    *
.****************************************************************************
RAABTMP1  MOVE      ZERO,OVRCD
          RESET     KEY48
          READ      ABFTEMP1,KEY48;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
WRABTMP1  WRITE     ABFTEMP1,KEY48;TEMPSUR,TEMPGIV,TEMPADM,TEMPGRO,TEMPTOD:
                                   TEMPCLA,TEMPATY,TEMPACL,TEMPUS2,TEMPAFU:
                                   TEMPTTB,TEMPTTN,TEMPTTD,TEMPODT,TEMPURN
          RETURN
.
RSABTMP1  READ      ABFTEMP1,KEY48;;
          RETURN
.
RKABTMP1  MOVE      ZERO,OVRCD
          READKS    ABFTEMP1;TEMPSUR,TEMPGIV,TEMPADM,TEMPGRO,TEMPTOD:
                             TEMPCLA,TEMPATY,TEMPACL,TEMPUS2,TEMPAFU:
                             TEMPTTB,TEMPTTN,TEMPTTD,TEMPODT,TEMPURN
          GOTO      OVERCOND IF OVER
          RETURN
+
.****************************************************************************
.*        IO ROUTINES FOR TEMPORARY FILE                                    *
.****************************************************************************
RAABTMP2  MOVE      ZERO,OVRCD
          RESET     KEY48
          READ      ABFTEMP2,KEY48;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
WRABTMP2  WRITE     ABFTEMP2,KEY48;TEMPSUR,TEMPGIV,TEMPADM,TEMPGRO,TEMPTOD:
                                   TEMPCLA,TEMPATY,TEMPACL,TEMPUS2,TEMPAFU:
                                   TEMPTTB,TEMPTTN,TEMPTTD,TEMPODT,TEMPURN
          RETURN
.
RSABTMP2  READ      ABFTEMP2,KEY48;;
          RETURN
.
RKABTMP2  MOVE      ZERO,OVRCD
          READKS    ABFTEMP2;TEMPSUR,TEMPGIV,TEMPADM,TEMPGRO,TEMPTOD:
                             TEMPCLA,TEMPATY,TEMPACL,TEMPUS2,TEMPAFU:
                             TEMPTTB,TEMPTTN,TEMPTTD,TEMPODT,TEMPURN
          GOTO      OVERCOND IF OVER
          RETURN
+
.*****************************************************************************
.*  GETALTID
.*  Procedure to get an alternate ID
.*  Exit=0  No alternate ID
.*       1  Alternate ID's exist
.*****************************************************************************
          DEFPROC   GETALIDS
.
          INC       PMSAIDFD/INC
.
          MOVE      ZERO,EXIT
          PACK      KEY20,SP70
          OPEN      PMSAIDA1,"pmsaidaf"
.
          PACK      KEY31,PURNO,SP70
          CALL      RSPMAID1           * Read alternate id Table
GETALI10  CALL      RKPMAID1
          BRANCH    OVRCD,GETALI99
.
          MATCH     PURNO,PMAIURNO     * Check same UR
          GOTO      GETALI99 IF NOT EQUAL
.
          MATCH     "1",PMAIDISU
          GOTO      GETALI10 IF NOT EQUAL
.
          PACK      KEY20,PMAIALID,SP70
          MOVE      ONE,EXIT
          GOTO      GETALI99
.
          INC       PMSAIDIO/INC
          INC       IBAOVRIO/INC
.
GETALI99  CLOSE     PMSAIDA1
.
          ENDPROC
.
.
.         IO includes
.
          INC       STD001IO
          INC       AAECATBI
          INC       AAEDE1IO/INC     
          INC       AAEDTRIO/INC
          INC       CALCAGE     
          INC       CLNZPPIC
          INC       IBAGEDIO/INC
          INC       IBAGSTIO/INC
          INC       IBAPASIO/INC
          INC       IBASECIO/INC
          INC       IBATMDIO/INC
          INC       NHIMASIO/INC
          INC       MLTCFNIO/INC
          INC       MRTLOCIO/INC                          
          INC       MRTMASIO/INC                          
          INC       MRTVISIO/INC                 

          INC       TFILENAM                     * Generate Temp File Name
.
          INC       IBASEQIO/INC                 * Sequential Numbers File
          INC       WEBERRIO/INC                 * Web Server Error Logging
.
          INC       NZPBFEIO/INC
          INC       NZPCFNIO/INC
          INC       NZPCMTIO/INC
          INC       NZPEXTIO/INC
          INC       NZPRDTIO/INC
          INC       NZPFIGIO/INC
          INC       NZPIBRIO/INC
          INC       NZPMCHIO/INC
          INC       NZPMXCIO/INC
          INC       NZPPFEIO/INC
          INC       NZPPICIO/INC
          INC       NZPRBRIO/INC
          INC       NZPRFNIO/INC
          INC       NZPFINIO/INC
          INC       NZPSPRIO/INC
          INC       NZPTFEIO/INC
          INC       NZPIVBIO/INC
          INC       NZPRVBIO/INC

          INC       OPRDEAIO/INC
          INC       OPRSESIO/INC
          INC       OUTCATBI
          INC       OUTSESIO/INC
          INC       OUTBOAIO/INC
          INC       OUTBB1IO/INC
          INC       OUTDTRIO/INC
          INC       OUTSITIO/INC
          INC       PATCATBI
          INC       PATCODDS
          INC       CHKCMXPT                * Check if casemix & get epis type
          INC       PATCMSTP
          INC       PATGNCMX
          INC       CMGETTHR
          INC       CMXMATRX
          INC       NHOSPDAY
          INC       CALCDAYS
          INC       PABXBILL
          INC       PATCOMN3
          INC       PATIVMES
          INC       CLPATDTR                * Clear DTR file variables
          INC       CLPATDSC                * Clear Disc.file variables
          INC       PATHSPKY
          INC       PRBILCMN
          INC       PATMCHRD
          INC       PATITMRD
          INC       GETCNEFF
          INC       GETBFEES
          INC       GETTFEES
          INC       ISBITEMS
          INC       ICDSCLAS
          INC       IPENBOOK
          INC       PATIPERH
          INC       CLVISXDC
.
          INC       PATAA1IO/INC
          INC       PATSTAIO/INC
          INC       PATAFEIO/INC       * for casemix
          INC       PATASDIO/INC
          INC       PATCMXIO/INC
          INC       PATHDFIO/INC
          INC       PATHLFIO/INC
          INC       PATLDFIO/INC
          INC       PATLSDIO/INC
          INC       PATRGMIO/INC
          INC       PMSREGIO/INC
.
          INC       PATELGIO/INC
          INC       PATBFEIO/INC
          INC       PATTFEIO/INC       *theatre fee
          INC       PATCODIO/INC
          INC       PMSCIDIO/INC
          INC       PMSCCDIO/INC
          INC       PATCFAIO/INC
          INC       PATCTFIO/INC
          INC       PATDGWIO/INC
          INC       PATDO1IO/INC
          INC       PATDSCIO/INC
          INC       PATDTRIO/INC
          INC       PATDRGIO/INC
          INC       PATECDIO/INC
          INC       PATECOIO/INC
          INC       PATGTUIO/INC
          INC       PATRE1IO/INC
          INC       PATHSPIO/INC
          INC       PATHTRIO/INC
          INC       EMRHTRIO/INC
          INC       OUTHTRIO/INC
          INC       PATFINIO/INC
          INC       PATFMOIO/INC
          INC       PATFX1IO/INC
          INC       PATFN1IO/INC
          INC       PATFN2IO/INC
          INC       PATFHIIO/INC
          INC       PATIBLIO/INC
          INC       PATICUIO/INC
          INC       PATIN1IO/INC
          INC       PATINMIO/INC
          INC       PATINVIO/INC
          INC       PATIOVIO/INC
          INC       PATIPEIO/INC
          INC       PATITMIO/INC
          INC       PATMA1IO/INC
          INC       PATMCHIO/INC
          INC       PATMI1IO/INC
          INC       PATOVBIO/INC
          INC       PATPGRIO/INC
          INC       PATRBLIO/INC
          INC       PATRCAIO/INC
          INC       PATRATIO/INC
          INC       PATSRBIO/INC
          INC       PATTRNIO/INC
          INC       PATVENIO/INC
          INC       PATVISIO/INC
          INC       PATWC1IO/INC
          INC       PATWMAIO/INC
          INC       PATWR1IO/INC
          INC       PATWVEIO/INC
          INC       PMSEVTIO/INC
          INC       PMSCNOIO/INC
          INC       PMSHATIO/INC
          INC       PMSHCPIO/INC
          INC       PMSSINIO/INC
          INC       PATCMTIO/INC
          INC       PMSCMTIO/INC
          INC       PMSSGAIO/INC
          INC       PMSMTIIO/INC
          INC       PMSMPRIO/INC
          INC       PMSVX1IO/INC
          INC       RCPBNKIO/INC
          INC       RCPBDTIO/INC
          INC       OPRARDIO/INC
          INC       PRIITMIO/INC
          INC       PATNIDIO/INC
          INC       PATONHIO/INC
          INC       PMSPX2IO/INC
.
          INC       EMRSITIO/INC
          INC       EMRHISIO/INC
          INC       EMRVISIO/INC
          INC       COMDEPIO/INC
          INC       RCPDTEIO/INC
          INC       PMSPBRIO/INC
          INC       PMSIDEIO/INC
          INC       PMSEDGIO/INC       * Effective DRG Dates
          INC       VISXDCIO/INC
          INC       WEBSECIO/INC
          INC       PATDDHIO/INC
          INC       CLPMSIDE
          INC       CLPATRE1
          INC       CLPMSPX2
          INC       STEPDOWN
          INC       VALCMXFN
          INC       PATSELFN
          INC       GETEFDRG
          INC       DGCLICAC
          INC       PMIGTNID
.
SBDY0000
PATSTRYR
ADDWRN00
.
WRITETRN
GETTHR
PATCALF
TAIL
INITIVAR
PRTEOL
PROCMISC
PRTCLMS
NXTTRAN1
WEBERR00
PRTINVTL
SINVT000
DOCNM000
PEOL0000
PRLN0000
ENDPRT00
PROACC00
CKTL0000
PRTIPROV
ENDPRT    RETURN
.
ENDIT     CHAIN     PGM
          STOP

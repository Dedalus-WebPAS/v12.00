.----------------------------------------------------------------------
. Program       : ECLWEB08
.
. Function      : Medicare WebServices OECW - ECF Polling Extract / JSON 
.                 Post Server
.
. Modifications :
.
.----------------------------------------------------------------------
. V11.04.05 26/03/2024  J.Tan          Task 0919335
.           Mod to check HF History file for HF Group
. V11.04.04 15/03/2024  J.Tan          Task 0919335
.           Mod to check HF History file for HF Group
. V11.04.03 04/03/2024  PJ Le Febour     TSK 0929044d 
.           update WBOCUUID WBOCUDTE WBOCUTIM before call UPWBOEC2 
. V11.04.02 01.02.2024  DA Sarkies       TSK 0936282
.           Increased size of variable holding health fund membership number
.           to 19.
. V11.04.01 27/11/2023  Peter Vela       TSK 0935874
.           Removed includes for DXPATMAS, PRINTEMR, WEBLBEMR
.           to prevent compile errors
. V11.03.01 17/10/2023  Peter Vela       TSK 0935874
.           Removed PMSIHI open
. V11.02.04 19/10/2022  Peter Vela           0925849
.           Added validation for EOS for memberRefNumber OECVAL09 
. V11.02.03 11/07/2022  Peter Vela           0921946
.           Added traps around UPWBOEC1
. V11.02.02 15/06/2022  Peter Vela           0921020
.           Moved reads to weboecaf before update to avoid I*A
. V11.02.01 21/03/2022  Peter Vela       TSK 0895969
.           Fixed serviceRate zero validation
. V11.01.03 11/01/2022  Peter Vela       TSK 0906538
.           Fixed Health Fund UPI
. V11.01.02 20/12/2021  Peter Vela       TSK 0906538
.           Added calculation for Discharge Date if spaces
.           Added secondInitial for Free Format
. V11.01.01 06/10/2021  Peter Vela       TSK 0895969
.           Fixed Alias First Name and Alias Last Name
. V11.00.02 16/11/2020  Thanh T          TSK 0878747
.           Added PATATRFD PATATRIO and PATATRTD for EMRMR5N2
. V11.00.01 10/09/2020  Peter Vela      Task 0895294
.           Created Medicare WebServices OECW Polling Request/Response Server
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       CHKDIGVR/INC
          INC       EMRICDFD/INC
          INC       EMRHISFD/INC 
          INC       APSMASFD/INC
          INC       AAEDE1FD/INC
          INC       EMRLPCFD/INC
          INC       EMRCONFD/INC                                       *I-50421
          INC       EMRLOCFD/INC
          INC       EMRSITFD/INC
          INC       PATCALAG/INC
          INC       PATDHEAD/INC
          INC       PATDSCFD/INC
          INC       PATELGFD/INC
          INC       ELTRONVR/INC
          INC       EOCLNKFD/INC
          INC       EOCREFFD/INC
          INC       EMRVISFD/INC
          INC       EMRCLIFD/INC
          INC       EMRGRCFD/INC
          INC       EMRPROFD/INC                                       *I-50421
          INC       EMRUNKFD/INC
          INC       IBADLABS/INC
          INC       IBATMDFD/INC
          INC       MEHDLSFD/INC
          INC       NHIETHFD/INC
          INC       NHIMASFD/INC
          INC       OUTBB1FD/INC
          INC       OUTBOAFD/INC
          INC       OPRNURFD/INC
          INC       PATCONFD/INC
          INC       AAECONFD/INC   *****
          INC       PATALRFD/INC   *****
          INC       PMSALNFD/INC
          INC       PATDO1FD/INC
          INC       PATDDHFD/INC
          INC       PATFN1FD/INC
          INC       PATFX1FD/INC
          INC       PATGO1FD/INC
          INC       PATHSPFD/INC
          INC       PMSCCDFD/INC
          INC       PMSCEXFD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
          INC       PMSIHIFD/INC
          INC       PMSMDTFD/INC
          INC       PMSMTXFD/INC
          INC       PATIN1FD/INC
          INC       PRIITMFD/INC
          INC       PATITMFD/INC                                       *I-50421
          INC       PATICDFD/INC                                       *I-50421
          INC       PATICOFD/INC                                       *I-50421
          INC       PATMA1FD/INC
          INC       PATMCHFD/INC
          INC       PATMI1FD/INC
          INC       PMSPX2FD/INC
          INC       PMSRELFD/INC              
          INC       PMSTLEFD/INC   
          INC       PATNIDFD/INC
          INC       PATRE1FD/INC
          INC       PATVADFD/INC
          INC       PATVISFD/INC
          INC       PMSVX1FD/INC                                       *I-55214
          INC       PATWC1FD/INC 
          INC       PMSWX1FD/INC
          INC       PATWMAFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       SCRPSTFD/INC
.
          INC       PATATRFD/INC
          INC       PATATRTD/INC
.
          INC       SCRSBGFD/INC
          INC       SCRSLTFD/INC
          INC       SCRMASFD/INC
          INC       PATHGPFD/INC
.
          INC       EMRDCMFD/INC       
          INC       OBSDETFD/INC                                       *I-54627
          INC       OBSMTXFD/INC
          INC       OBSMDTFD/INC
          INC       EMRISMFD/INC 
          INC       EMRINCFD/INC 
          INC       EMRWFMFD/INC
          INC       EMRVCDFD/INC
          INC       EMRMTXFD/INC
          INC       EMRVPRFD/INC
          INC       VISCMTFD/INC
          INC       VISCODFD/INC
          INC       VISMDTFD/INC
          INC       VISXDCFD/INC
          INC       EMRMANFD/INC 
          INC       VISMTXFD/INC
          INC       WEBB2BFD/INC
          INC       WEBOECFD/INC
          INC       WEBOESFD/INC
          INC       WEBELFFD/INC
          INC       WEBPARFD/INC
          INC       TFILEVAR/INC

.
ANSLI     INIT      "i"
ANSLW     INIT      "w"
CLAIMFLG  FORM      1             * compensation claim flag
.                                     0 = non compensable claim
.                                     1 = DVA claim
.                                     2 = Workers compensation claim
.                                     3 = TAC claim
DAYDESC   DIM       9
DEEXDATE  DIM       8
DIM16     DIM       16
DIM30     DIM       30
DIM35     DIM       35
DIM50     DIM       50
DIM80     DIM       80
DIM100    DIM       100
DFNAME    DIM       60
DSMOKE    DIM       3
ERRORIND  DIM       1
ERRORDSC  DIM       500
FFOECIND  FORM      1
FRSTINDC  DIM       1
GATTIMER  FORM      3
GETTOKF4  FORM      4
GPFRMTNM  DIM       40
LINEA17   DIM       17
LINEB17   DIM       17
LINEC17   DIM       17
LINED17   DIM       17
LINEE17   DIM       17
LINEF17   DIM       17
LINEG17   DIM       17
LINEH17   DIM       17
LINEI17   DIM       17
LINEA37   DIM       37
LINEB37   DIM       37
LINEC37   DIM       37
LINED37   DIM       37
LINEE37   DIM       37
LINEF37   DIM       37
LINEG37   DIM       37
LINEH37   DIM       37
LINEI37   DIM       37
.
MBIRURNO  DIM       8
MBIRTYOR  DIM       24
.
OESCOUNT  FORM      2
TYPE4     INIT      "004"
TYPE5     INIT      "005"
SAVKEY5   DIM       5
SAVKEY16  DIM       16
SAVENCOM  FORM      1
SAVEDCOM  FORM      1
SAVDOC    DIM       10
SERVINDC  DIM       1
SKEY8     DIM       8
DOCTIME   DIM       8
HOUR      DIM       2
MEDINUMB  DIM       13
MIN       DIM       2
MONTHDES  DIM       9
NUM3      FORM      3
PTFRMTNM  DIM       40
SEC       DIM       2
MEDNOTES  DIM       70
TEMPDATE  DIM       12
TILDA40   INIT      "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
.
KEY21A    DIM       21
NEWCOUNT  FORM      10
.
ADLABEL   FORM      2
ATT       DIM       80         * attribute string
AFTDECP   FORM      2          * After Decimal Place
AFTDECPF  FORM      2          * After Decimal Place Format String
.
BEFDECP   FORM      2          * Before Decimal Place
BEFDECPF  FORM      2          * Before Decimal Place Format String
BIRTHDAT  DIM       10            * formatted DOB variable
.
CALDAYS    FORM      3
CDEFPRT2  DIM       6
CHG       FORM      1
CHKMNCNT  FORM      1          * check mandatory fields cycle counter
CLAIMCOD  DIM       3
CLMDET1   DIM       50
CLMDET2   DIM       50
CMDLINE   DIM       200
CONTTYPE  DIM       1
CONTTYP2  FORM      1
COUNTER   FORM      1
CPPAPER2  FORM      2
CURRROW   FORM      3
CODEDESC  DIM       100                                                *I-50421
.
DATECALC  DATE      8
DANS1     DIM       20
DCASE     DIM       3
DECIMALP  INIT      "."  
DIM2L     DIM       2
DIM3      DIM       3
DIM6      DIM       6
DIM4      DIM       4
DIM5      DIM       5                                                  *I-54309
DIM8      DIM       8             * U/R variable (spaces removed)
DIM9      DIM       9
DIM10     DIM       10 
DIM10A    DIM       10
DIM10B    DIM       10
DIM11     DIM       11
DIM11G    DIM       11            * given name variable for small labels
DIM11S    DIM       11            * surname variable for small labels
DIM12     DIM       12
DIM14     DIM       14
DIM15     DIM       15
DIM17     DIM       17
DIM18     DIM       18            * given name variable for large labels
DIM20     DIM       20
DIM25     DIM       25
DIM31     DIM       31            * formatted address
DIM60     DIM       60
DOCTCODE  DIM       6
BURNO     DIM       9
BADMNO    DIM       9
PTURNO    DIM       8             * U/R variable (spaces removed)
PTADMNO   DIM       8             * Admission No variable (spaces removed)
EDOCNAME  DIM       23
PSURNAME  DIM       23
PGIVNAME  DIM       23
PCLMTYPD  DIM       20
PADDRSS1  DIM       23 
PADDRSS2  DIM       23
PAGEYRS   DIM       4
PGPNAME   DIM       30
PRTLABL1  DIM       17
PRTLABL2  DIM       20
PRTLABL3  DIM       16
PRTLABL4  DIM       15
PRTLABL5  DIM       17
PRTLABL6  DIM       24
.
EMRFLAG   FORM      1 
EMRPREV   DIM       20 
EMRSEEN   DIM       8
EMRDOCT   DIM       13
EMRINSUR  DIM       5
EMRDESC   DIM       20
EMRURNO   DIM       8
ENDFLG    FORM      1
.
FIRSTCH   FORM      1                                                  *I-60700
FIELDNO   FORM      5
FORM1A    FORM      1                                                  *I-54627
FORM1B    FORM      1                                                  *I-54627
FORM3     FORM      3
FORM3A    FORM      3                                                  *I-50421
FORM5     FORM      5
FORM21    FORM      21
FORMAT21  FORM      21
FRMPRINT  DIM       6
FORM12P2  FORM      12.2
.                                                                     *I-196463
DIM3A     DIM       3
DIM3B     DIM       3
DIM15A    DIM       15
DIM50A    DIM       50
DIM80A    DIM       80
.
LINSREQD  FORM      5
PAGENUMB  FORM      3
PAGETOTL  FORM      3
PAGEMAXL  FORM      3                       * Maximum lines per page
PASSNO    FORM      1
PGLINES   DIM       6
PRINTEND  FORM      1
.
WFLINE3A  DIM       20
WFLINE2A  DIM       20
WFLINE8A  DIM       20
WFLINE6A  DIM       20
WFLINE4A  DIM       20
WFLINE7A  DIM       20
WFLINE5A  DIM       20
WFLINE1A  DIM       20
.
HIGH14    DIM       4
HIGH24    DIM       4
HIGH34    DIM       4
.HELPAGE   FORM      1
.HELPRNT   FORM      3
.HELSIZE   FORM      1
.HEMR5COD  DIM       6            * Code for user defined stationary
HEPMR5B   FORM      "1"          * Patient MR5 form sheet 1=Yes, 0=No
.HEMR5L    FORM      "1"          * Layout for MR5.
.                                  0 = Modbury
.                                  1 = User Defined
.
IHINUMBR  DIM       20
JYEAR     FORM      2
.
LASTROW   FORM      3
LABSIZE   FORM      1
LARGELAB  DIM       16
SMALLLAB  DIM       21
LBLPRINT  DIM       6
LABELATT  DIM       80[24]
LABELDAT  DIM       80[24]
LABELTYP  DIM       10
LLCNT     FORM      5
LEFTBRAK  INIT      "(" 
LINE60    DIM       60                                                 *I-60700
LOOPCNTR  FORM      1
.
MANDINUR  FORM      1
MADESC    DIM       3
MODE4     DIM       4
.
NEGOFSET  DIM       8             * U/R variable (spaces removed)
NMPNUMB   DIM       20
NOLABEL   FORM      3
NOTEFILT  DIM       3
.
OPFLG     FORM      1
.
PRDGFLAG  FORM      1
PRINTVAR  DIM       80
PRNTSTRT  FORM      3
PRIDSYET  FORM      1
.
QADD1     DIM       25
QADD2     DIM       25
QADD4     DIM       15
QGNAME    DIM       14
QLOCDOC   DIM       30
QMEDI     DIM       10
QOCCUP    DIM       14
QPOST     DIM       4
QSAGE     FORM      3
QSEX      DIM       1
QSNAME    DIM       15
QSUBRB    DIM       15
QTELEP    DIM       12
QTITL     DIM       4
.
RESPONSD  DIM       3             * Cat EZ code for doctor responsible
RESPONSN  DIM       3             * Cat EZ code for nurse responsible
RESPONSC  DIM       3             * Cat EZ code for psc responsible
REFDEVF6  FORM      6
REPALPHA  INIT      "a~b~c~d~e~f~g~h~i~j~k~l~m~n~o~p~q~r~s~t~u~v~w~x~y~z~"
.
RTAOVRCD  FORM      1
.
SAVTYP    DIM       3
SAVKEY27  DIM       27
SCRID     DIM       2
SHRTBDAT  DIM       8
SHRTMDAT  DIM       7
SHRTVDAT  DIM       8
SVSTNCOD  DIM       6
STATNCOD  DIM       6
SIT4      DIM       4
SRC4      DIM       4
.
TEMPTRID  DIM       24
TEMPMSID  DIM       36
TRIDFILE  DIM       8
MSIDFILE  DIM       8
.
UNIQF5    FORM      5
VADESC    DIM       3
VARIABLE  DIM       127
VISITDAT  DIM       10            * formatted emergency visit date variable
VISITNUM  DIM       8             * emergency visit number variable
VISNOTES  DIM       100
.
WAITTIME  FORM      4
WCDESC    DIM       3
WCNAME    DIM       20
WDATE1    DIM       8
WDATE2    DIM       8
XPRIDIAG  DIM       6      * Primary Diagnosis
XADDIAG1  DIM       6      * Additional Diagnosis 1
.
VISXDCIN  FORM      1
.
ANSHP     INIT      "HP"
ANSPP     INIT      "PP"
CODEA     INIT      "A "
CODEA1    INIT      "A1"
CODEA2    INIT      "A2"
CODEA3    INIT      "A3"
CODEA4    INIT      "A4"
CODEA5    INIT      "A5"
CODEA6    INIT      "A6"
CODEA7    INIT      "A7"
CODEA8    INIT      "A8"
CODEAA    INIT      "AA"
CODEAE    INIT      "AE"
CODEAI    INIT      "AI"
CODEAP    INIT      "AP"
CODEAR    INIT      "AR"
CODECL    INIT      "CL"
CODEC     INIT      "C "
CODECC    INIT      "CC"
CODECT    INIT      "ct"
CODEEA    INIT      "EA"
CODEES    INIT      "ES"
CODEEP    INIT      "EP"
CODEED    INIT      "ED"
CODEEW    INIT      "EW"
CODEEZ    INIT      "EZ"
CODEH1    INIT      "H1"
CODEH2    INIT      "H2"
CODEH3    INIT      "H3"
CODEM     INIT      "M "
CODEP     INIT      "P "
CODEP1    INIT      "P1"
CODEP2    INIT      "P2"
CODEP3    INIT      "P3"
CODEP4    INIT      "P4"
CODEP5    INIT      "P5"
CODEP6    INIT      "P6"
CODER     INIT      "R "
CODERA    INIT      "RA"
CODET     INIT      "T "
CODEU1    INIT      "U1"
CODEV6    INIT      "V6"
CODEV7    INIT      "V7"
CODEV8    INIT      "V8"
CODES     INIT      "S "
CATcw     INIT      "cw"
CATEA     INIT      "ea"
CATEB     INIT      "eb"
CATEC     INIT      "ec"
CATED     INIT      "ed"
CATEE     INIT      "ee"
CATEF     INIT      "ef"
CATEG     INIT      "eg"
CATEH     INIT      "eh"
CATEI     INIT      "ei"
CATEJ     INIT      "ej"
CATEK     INIT      "ek"
CATEL     INIT      "el"
CATEM     INIT      "em"
CATEN     INIT      "en"
CATEO     INIT      "eo"
CATEP     INIT      "ep"
CATEQ     INIT      "eq"
CATER     INIT      "er"
CATES     INIT      "es"
CATET     INIT      "et"
CATEU     INIT      "eu"
CATEV     INIT      "ev"
CATEW     INIT      "ew"
CATEY     INIT      "ey"
CATHP     INIT      "HP"
CATLS     INIT      "LS"
CATTC     INIT      "tc"
CATWS     INIT      "ws"                                               *I-59548
CATWT     INIT      "wt"
CATWU     INIT      "wu"
CATWQ     INIT      "wq"                                               *I-59548
CATWR     INIT      "wr"                                               *I-59548
CATW0     INIT      "w0"
DASH      INIT      "-"
OTHER     INIT      "Other"
SP11      INIT      "           "
SP12      INIT      "            "
SP80      INIT      "                                        ":
                    "                                        "
SP127     INIT      "                                          ":
                    "                                          ":
                    "                                           "
SP40      INIT      "                                       "
X27       INIT      "XXXXXXXXXXXXXXXXXXXXXXXXXXX"
X100      INIT      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
ZERO4     INIT      "0000"
.
CARET     INIT      "^"
MJAN      INIT      "January"
MFEB      INIT      "February"
MMAR      INIT      "March"
MAPR      INIT      "April"
MMAY      INIT      "May"
MJUN      INIT      "June"
MJUL      INIT      "July"
MAUG      INIT      "August"
MSEP      INIT      "September"
MOCT      INIT      "October"
MNOV      INIT      "November"
MDEC      INIT      "December"
.
. webServices PRODA Variables
.
WBSPROPF  FILE      ASCII,FIXED=256
WBSACTVF  FILE      ASCII,FIXED=256
WBSTOKNF  FILE      ASCII,FIXED=256
WBSACTIF  FILE      ASCII,FIXED=256
WBSTOKIF  FILE      ASCII,FIXED=256
WBSACTEF  FILE      ASCII,FIXED=256
WBSTRIDF  FILE      ASCII,FIXED=256
WBSMSIDF  FILE      ASCII,FIXED=256
.
PRODAIND  DIM       1
.
PRDAPATH  DIM       120
ACTVPATH  DIM       120
TOKNPATH  DIM       120
ACTIPATH  DIM       120
TOKIPATH  DIM       120
ACTEPATH  DIM       120
TRIDPATH  DIM       120
MSIDPATH  DIM       120
.
PRDAFILE  INIT      "webPAS_PRODA.properties"
ACTVFILE  INIT      "webPAS_PRODA_ActivateDevice_curl_response"
TOKNFILE  INIT      "webPAS_PRODA_GetAccessToken_curl_response"
ACTIFILE  INIT      "webPAS_PRODA_ActivateDevice_curl_response_indicator"
TOKIFILE  INIT      "webPAS_PRODA_GetAccessToken_curl_response_indicator"
ACTEFILE  INIT      "webPAS_PRODA_ActivateDevice_curl_expiry_indicator"
.
WBSACTIN  DIM       1
WBSTOKIN  DIM       1
WBSACTE1  DIM       1
WBSACTE2  DIM       1
WBSACTE3  DIM       1
.
OPENBRAC  DIM       1
CLOSBRAC  DIM       1
.
DEVISLAB  DIM       20
KEYSTLAB  DIM       17
KEYEXLAB  DIM       17
DEVIXLAB  DIM       20
.
DEVISVAL  DIM       6
KEYSTVAL  DIM       6
KEYEXVAL  DIM       19
DEVIXVAL  DIM       19
.
ACCTKLAB  DIM       16
ACCTKVAL  DIM       837
ACCDELAB  DIM       30
ACCDEVAL  DIM       19
ACCKELAB  DIM       16
ACCKEVAL  DIM       19
ACCTTLAB  DIM       16
ACCTTVAL  DIM       6
ACCEILAB  DIM       15
ACCEIVAL  DIM       4
.
. ----- WebServices B2B Device Properties -----
.
WBSPROID  DIM       60                * Product ID
WBSJKSLO  DIM       60                * JKS/Certificate File Location
WBSPRORG  DIM       60                * PRODA Organisation ID
WBSDVNAM  DIM       60                * Device Name
WBSCLIID  DIM       60                * Client ID
WBSACTAU  DIM       60                * Access Token Audience
WBSACTVC  DIM       60                * Activation Code
WBSDACUR  DIM       60                * Device Activation URL
WBSDAUUR  DIM       60                * Device Authentication URL
WBSRDKUR  DIM       60                * Refresh Device Key URL
WBSWSCLI  DIM       60                * WebServices Claiming Client Id
WBSLOCAT  DIM       60                * Location Id
WBSNOTEM  DIM       60                * Notification Email
.
WBSPILAB  DIM       17                * Product ID Label
WBSJKLAB  DIM       20                * JKS File Location Label
WBSPOLAB  DIM       18                * Proda Org Id Label
WBSDNLAB  DIM       18                * Device Name Label
WBSCILAB  DIM       16                * Client ID Label
WBSATLAB  DIM       27                * Access Token Audience Label
WBSACLAB  DIM       22                * Activation Code Label
WBSDALAB  DIM       27                * Device Activation URL Label
WBSDULAB  DIM       31                * Device Authentication URL Label
WBSRDLAB  DIM       27                * Refresh Device Key URL Label
WBSWSLAB  DIM       27                * WebServices Claiming Client Id Label
WBSLOLAB  DIM       18                * Location Id Label
WBSNOLAB  DIM       25                * Notification Email Label
.
WBSRV001  DIM       60                * Product ID
WBSRV002  DIM       60                * JKS/Certificate File Location
WBSRV003  DIM       60                * PRODA Organisation ID
WBSRV004  DIM       60                * Device Name
WBSRV005  DIM       60                * Client ID
WBSRV006  DIM       60                * Access Token Audience
WBSRV007  DIM       60                * Activation Code
WBSRV008  DIM       60                * Device Activation URL
WBSRV009  DIM       60                * Device Authentication URL
WBSRV010  DIM       60                * Refresh Device Key URL
WBSRV011  DIM       60                * WebServices Claiming Client Id
WBSRV012  DIM       60                * Location Id
WBSRV013  DIM       60                * Notification Email
.
. ----- WebServices OEC - ECF Data Variables -----
.
. .properties file  Len    Pos
.-----------------  ---    ---
PRPLAB01  INIT      "webpas.oecTransactionId="
PRPVAL01  DIM       24
PRPLAB02  INIT      "webpas.oecMessageId="
PRPVAL02  DIM       36
PRPLAB03  INIT      "webpas.oecSubjectId="
PRPVAL03  DIM       19
.
. _oecw     file    Len    Pos
.---------------    ---    ---
LCBRAC    INIT    "{"
.QUOTE     INIT      "#""
OECLAB12  INIT    "claim"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.LCBRAC    INIT    "{"
.QUOTE     INIT      "#""
OECLAB01  INIT    "patient"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.LCBRAC    INIT    "{"
.QUOTE     INIT      "#""
OECLAB02  INIT    "identity"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.LCBRAC    INIT    "{"
.QUOTE     INIT      "#""
OECLAB03  INIT    "dateOfBirth"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL03  DIM     10
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB04  INIT    "familyName"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL04  DIM     40
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB05  INIT    "givenName"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL05  DIM     40
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB46  INIT    "secondInitial"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL12  DIM     1
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB06  INIT    "sex"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL06  DIM     1
.QUOTE     INIT      "#""
RCBRAC    INIT    "}"
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB44  INIT    "alsoKnownAs"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.LCBRAC    INIT    "{"
.QUOTE     INIT      "#""
.OECLAB03  INIT    "dateOfBirth"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
.OECVAL03  DIM     10
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB37  INIT    "familyName"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL37  DIM     40
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB38  INIT    "givenName"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL38  DIM     40
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB40  INIT    "sex"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL40  DIM     1
.QUOTE     INIT      "#""
.RCBRAC    INIT    "}"
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB07  INIT    "healthFund"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.LCBRAC    INIT    "{"
.QUOTE     INIT      "#""
OECLAB08  INIT    "memberNumber"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL08  DIM     19
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB09  INIT    "memberRefNumber"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL09  DIM     2
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB10  INIT    "organisation"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL10  DIM     3
.QUOTE     INIT      "#""
.RCBRAC    INIT    "}"
.RCBRAC    INIT    "}"
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB11  INIT    "senderContact"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.LCBRAC    INIT    "{"
.QUOTE     INIT      "#""
OECLAB41  INIT    "emailAddress"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL41  DIM     128
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB39  INIT    "name"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL39  DIM     40
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB13  INIT    "phoneNumber"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL13  DIM     19
.QUOTE     INIT      "#""
.RCBRAC    INIT    "}"
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB14  INIT    "accident"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.LCBRAC    INIT    "{"
.QUOTE     INIT      "#""
OECLAB15  INIT    "accidentDate"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL15  DIM     10
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB16  INIT    "accidentInd"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL16  DIM     1
.QUOTE     INIT      "#""
.RCBRAC    INIT    "}"
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB17  INIT    "typeCode"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL17  DIM     3
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB18  INIT    "accountReferenceId"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL18  DIM     20
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB19  INIT    "compensationClaimInd"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL19  DIM     1
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB20  INIT    "emergencyAdmissionInd"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL20  DIM     1
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB21  INIT    "facilityId"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL21  DIM     8
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB22  INIT    "lengthOfStay"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL22  DIM     3
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB23  INIT    "peaRequestInd"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL23  DIM     1
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB24  INIT    "presentingIllnessItemNumber"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL24  DIM     5
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB42  INIT    "presentingIllnessCode"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL42  DIM     3
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB25  INIT    "sameDayInd"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL25  DIM     1
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB26  INIT    "submissionAuthorityInd"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL26  DIM     1
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB27  INIT    "medicalEvent"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
LSQBRAC    INIT    "["
.LCBRAC    INIT    "{"
.QUOTE     INIT      "#""
OECLAB28  INIT    "id"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL28  INIT    "01"
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB29  INIT    "admissionDate"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL29  DIM     10
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB30  INIT    "dischargeDate"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL30  DIM     10
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB45  INIT    "service"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.LSQBRAC    INIT    "["
.LCBRAC    INIT    "{"
.QUOTE     INIT      "#""
OECLAB31  INIT    "id"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL31  DIM     4[50]
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB32  INIT    "chargeAmount"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL32  DIM     9[50]
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB33  INIT    "serviceCode"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL33  DIM     11[50]
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB43  INIT    "serviceCodeTypeCode"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL43  DIM     1[50]
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB34  INIT    "serviceQuantity"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL34  DIM     2[50]
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB35  INIT    "serviceRate"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL35  DIM     9[50]
.QUOTE     INIT      "#""
.COMMA     INIT    ","
.QUOTE     INIT      "#""
OECLAB36  INIT    "dateOfService"
.QUOTE     INIT      "#""
.COLON     INIT    ":"
.QUOTE     INIT      "#""
OECVAL36  DIM     10[50]
.QUOTE     INIT      "#""
.RCBRAC    INIT      "}"
RSQBRAC    INIT    "]"
.RCBRAC    INIT      "}"
.RSQBRAC    INIT    "]"
.RCBRAC    INIT      "}"
.RCBRAC    INIT      "}"
.
.
PROPFLNM  DIM       35 
PROPFILE  FILE      ASCII,FIXED=256
PROPLITR  INIT      ".properties"
.
OECWFLNM  DIM       29
OECWFILE  FILE      ASCII,FIXED=256
OECWLITR  INIT      "_oecw"
.
.
. PROGRAM CONSTANTS
. -----------------
.
ANSIL     INIT      "il"
CATCT     INIT      "ct"
CATU1     INIT      "U1"
CATU2     INIT      "U2"
CATU3     INIT      "U3"
CATU4     INIT      "U4"
CATU5     INIT      "U5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATU8     INIT      "U8"
CATU9     INIT      "U9"
CATVI     INIT      "VI"
.
. Site specific soft font (16602). Change to this when delivery to site
.
ARIAL10N  INIT      "(8U(s1p10.00v0s0b16602T"  * Arial 10pt font/normal
ARIAL10B  INIT      "(8U(s1p10.00v0s3b16602T"  * Arial 10pt font/bold
.
.ARIAL10N  INIT      "(8U(s1p10.00v0s0b0T"     * Time Roman 10pt font/normal
.ARIAL10B  INIT      "(8U(s1p10.00v0s3b0T"     * Time Roman 10pt font/bold
.
HORZT001  INIT      "&a1C"      * tab to column 1
HORZT028  INIT      "&a28C"     * tab to column 28 
HORZT049  INIT      "&a49C"     * tab to column 49 
HORZT050  INIT      "&a50C"     * tab to column 50 
HORZT057  INIT      "&a57C"     * tab to column 57
HORZT082  INIT      "&a82C"     * tab to column 82 
HORZT086  INIT      "&a86C"     * tab to column 86
HORZT099  INIT      "&a99C"     * tab to column 99
HORZT100  INIT      "&a100C"    * tab to column 100
HORZT113  INIT      "&a113C"    * tab to column 113
HORZT141  INIT      "&a141C"    * tab to column 141
HORZT148  INIT      "&a148C"    * tab to column 148
HORZT149  INIT      "&a149C"    * tab to column 149
HORZT155  INIT      "&a155C"    * tab to column 155 
HORZT170  INIT      "&a170C"    * tab to column 170 
.
LINESPAC  INIT      "&l6D"      * line spacing - 6 lines/inch
.
NBARCODE  INIT      "(6U(s0p6.25h18.0v0s-6b0T*"      * Barcode style
.
PRIRESET  INIT      "E"         * printer reset
.
TMARGIN   INIT      "&l1e68F"   * top margin - 1 line
.                                   text length - 68 lines
.
.         Vertical movement is required for the barcode otherwise
.         it will print above the top line of the large labels (verttab1/2)
.
VERTTAB1  INIT      "*p+30Y"    * move 30 PCL units down (for barcode)
VERTTAB2  INIT      "*p-30Y"    * move 30 PCL units up (for barcode)
VERTTAB3  INIT      "*p+5Y"     * move 5  PCL units up (vertical space between
VERTTAB5  INIT      "*p+5Y"     * move 2  PCL units up (vertical space between
CONST1    INIT      "ED  UR"
CONST2    INIT      "A/T"
CONST3    INIT      "GP:"
.--------------------------------------------------------------------------------
NSETBOLD  INIT      "(s0bT"
SETBOLD   INIT      "(s7bT"
.
ALRCOMM   DIM       100
MULTILIN  FORM      1  
.--------------------------------------------------------------------------------
PRGID     INIT      "ECLWEB08"
VERSION   INIT      "V12.00.00"
PRGNAM    INIT      "Medicare WebServices OECW - ECF Request Extract Server"
.--------------------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
.
          CALL      INIT0000       * Open Files
.
MAIN0000  COMMIT
.
          BEGIN
.
          DISPLAY   *W2
.
          MATCH     "1",PTCNWSIN
          GOTO      MAIN0000 IF NOT EQUAL
.
          MATCH     "1",PTCNOECW
          GOTO      MAIN0000 IF NOT EQUAL
.
          MOVE      ZERO,EXIT
.
          PACK      KEY16,SP1,ZERO,SP70
          CALL      RSWBOEC2
MAIN1000  CALL      RKWBOEC2
          BRANCH    OVRCD,MAIN9999
.
          MATCH     " 0",WBOCSTAT                * Processed Record?
          GOTO      MAIN9999 IF NOT EQUAL
.
          MOVE      SP70,ERRORIND
          PACK      ERRORDSC,SP70,SP70,SP70,SP70,SP70,SP70,SP70,SP70
.
          PACK      KEY71,WBOCHOSP,SP70          * Read B2B Device Table
          CALL      RSWBB2B3
          CALL      RKWBB2B3
          BRANCH    OVRCD,MAIN1000
.
          MATCH     WBOCHOSP,WBB2HOSP            * Same Hospital
          GOTO      MAIN1000 IF NOT EQUAL
.
          MATCH     "ACTIVE",WBB2DSTA            * Device Active
          GOTO      MAIN1000 IF NOT EQUAL
.
          MATCH     SP70,WBB2DPTH
          GOTO      MAIN1000 IF EQUAL
.
          CALL      PROPN000                     * Valid Properties File?
.
          MATCH     "1",PRODAIND
          GOTO      MAIN1000 IF EQUAL
.
          PACK      SAVKEY16,WBOCSTAT,WBOCHOSP,WBOCVISN,WBOCCNTR,SP70
.
          OPEN      WBSPROPF,PRDAPATH
.
. ******************************************************************
. Call webPAS_PRODA interface program to create a new Transaction Id
. Write new Transaction Id back to weboecaf
. ******************************************************************
.
MAIN1100  CALL      TFILENAM                     * Temp filename for Tran Id
          MOVE      TFILNAME,TRIDFILE
.
MAIN1140  CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_PRODA_run GetTransactionId ",CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/ ",CMDLINE
          APPEND    TRIDFILE,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID              * Create Tran Id file
.         
          CLEAR     TRIDPATH
          APPEND    WBB2DPTH,TRIDPATH
          RESET     TRIDPATH
          STRIP     TRIDPATH
          ENDSET    TRIDPATH
          APPEND    SLASH,TRIDPATH
          APPEND    "webPAS_messtranids/",TRIDPATH
          APPEND    TRIDFILE,TRIDPATH
          RESET     TRIDPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSTRIDF,TRIDPATH
          TRAPCLR   IO
          IF        OVRCD=1
            GOTO      MAIN1150
          ENDIF
.
          READ      WBSTRIDF,SEQ;TEMPTRID       * Read new Tran Id temp file
.
. Check if Tran Id already exists in weboecaf
.
          PACK      KEY35,TEMPTRID,SP70
          CALL      RSWBOEC3           
          CALL      RKWBOEC3
          IF        OVRCD=0
            MATCH     TEMPTRID,WBOCTRID
            IF        @EQUAL
              CLOSE     WBSTRIDF
              GOTO      MAIN1140
            ENDIF
          ENDIF
.
MAIN1150  MOVE      SAVKEY16,KEY16
          CALL      RDWBOEC2 
.
          CLOSE     WBSTRIDF
.
          CLEAR     CMDLINE
          APPEND    "rm -f ",CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_messtranids/",CMDLINE
          APPEND    TRIDFILE,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID              * Remove Tran Id file
.
          MOVE      TEMPTRID,WBOCTRID
.
          TRAP      OVERCOND IF IO

          CALL      IBACLOCK
          PACK      WBOCUDTE,CCC,CYY,CMM,CDD
          REP       " 0",WBOCUDTE
          MOVE      CTIMEIS,WBOCUTIM
          MOVE      USERID,WBOCUUID
          CALL      UPWBOEC2
          TRAPCLR   IO
.
. ******************************************************************
. Call webPAS_PRODA interface program to create a new Message Id
. Write new Message Id back to weboecaf
. ******************************************************************
.
MAIN1200  CALL      TFILENAM                     * Temp filename for Mess Id
          MOVE      TFILNAME,MSIDFILE
.
MAIN1240  CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_PRODA_run GetMessageId ",CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/ ",CMDLINE
          APPEND    MSIDFILE,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID              * Create Tran Id file
.
          CLEAR     MSIDPATH
          APPEND    WBB2DPTH,MSIDPATH
          RESET     MSIDPATH
          STRIP     MSIDPATH
          ENDSET    MSIDPATH
          APPEND    SLASH,MSIDPATH
          APPEND    "webPAS_messtranids/",MSIDPATH
          APPEND    MSIDFILE,MSIDPATH
          RESET     MSIDPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSMSIDF,MSIDPATH
          TRAPCLR   IO
          IF        OVRCD=1
            GOTO      MAIN1250
          ENDIF
.
          READ      WBSMSIDF,SEQ;TEMPMSID
.
. Check if Mess Id already exists in weboecaf
.
          PACK      KEY47,TEMPMSID,SP70
          CALL      RSWBOEC4
          CALL      RKWBOEC4
          IF        OVRCD=0
            MATCH     TEMPMSID,WBOCMSID
            IF        @EQUAL
              CLOSE     WBSMSIDF
              GOTO      MAIN1240
            ENDIF
          ENDIF
.
MAIN1250  MOVE      SAVKEY16,KEY16
          CALL      RDWBOEC2
.
          CLOSE     WBSMSIDF
.
          CLEAR     CMDLINE
          APPEND    "rm -f ",CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_messtranids/",CMDLINE
          APPEND    MSIDFILE,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID              * Remove Tran Id file
.
          MOVE      TEMPMSID,WBOCMSID
.
          TRAP      OVERCOND IF IO
          CALL      IBACLOCK
          PACK      WBOCUDTE,CCC,CYY,CMM,CDD
          REP       " 0",WBOCUDTE
          MOVE      CTIMEIS,WBOCUTIM
          MOVE      USERID,WBOCUUID
          CALL      UPWBOEC2
          TRAPCLR   IO
.
. ******************************************************************
. Validate and Extract OECW files 
. [TransactionId].properties 
. [TransactionId]_oecw
. ******************************************************************
.
          CALL      OECW0000
.
. ******************************************************************
.
          PACK      KEY16,WBOCSTAT,WBOCHOSP,WBOCVISN,WBOCCNTR,SP70
          CALL      RDWBOEC2
.
          MATCH     "1",ERRORIND
          IF        @EQUAL
            MOVE      " 3",WBOCSTAT
            MOVE      ERRORDSC,WBOCERRD
          ELSE
            MOVE      " 1",WBOCSTAT
          ENDIF
.
          TRAP      OVERCOND IF IO
          CALL      IBACLOCK
          PACK      WBOCUDTE,CCC,CYY,CMM,CDD
          REP       " 0",WBOCUDTE
          MOVE      CTIMEIS,WBOCUTIM
          MOVE      USERID,WBOCUUID
          CALL      UPWBOEC2
          TRAPCLR   IO
.
MAIN9000  CLOSE     WBSPROPF
.
          GOTO      MAIN1000
.
MAIN9999  CLOSE     WBSPROPF
.
          GOTO      MAIN0000
.
.------------------------------------------------------------
.  Open PRODA Text Files
.------------------------------------------------------------
PROPN000  MOVE      SP70,PRODAIND
.
          CLEAR     PRDAPATH
          APPEND    WBB2DPTH,PRDAPATH
          RESET     PRDAPATH
          STRIP     PRDAPATH
          ENDSET    PRDAPATH
          APPEND    SLASH,PRDAPATH
          APPEND    PRDAFILE,PRDAPATH
          RESET     PRDAPATH
.
          MOVE      ZERO,PRODAIND
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSPROPF,PRDAPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,PRODAIND
            GOTO      PROPN999
          ENDIF
          CLOSE     WBSPROPF
.
PROPN999  RETURN
+
.------------------------------------------------------------
. Read WebServices PRODA properties file
.------------------------------------------------------------
RDWBSR00  READ      WBSPROPF,SEQ;WBSPILAB,WBSPROID
          READ      WBSPROPF,SEQ;WBSJKLAB,WBSJKSLO
          READ      WBSPROPF,SEQ;WBSPOLAB,WBSPRORG
          READ      WBSPROPF,SEQ;WBSDNLAB,WBSDVNAM
          READ      WBSPROPF,SEQ;WBSCILAB,WBSCLIID
          READ      WBSPROPF,SEQ;WBSATLAB,WBSACTAU
          READ      WBSPROPF,SEQ;WBSACLAB,WBSACTVC
          READ      WBSPROPF,SEQ;WBSDALAB,WBSDACUR
          READ      WBSPROPF,SEQ;WBSDULAB,WBSDAUUR
          READ      WBSPROPF,SEQ;WBSRDLAB,WBSRDKUR
          READ      WBSPROPF,SEQ;WBSWSLAB,WBSWSCLI
          READ      WBSPROPF,SEQ;WBSLOLAB,WBSLOCAT
          READ      WBSPROPF,SEQ;WBSNOLAB,WBSNOTEM
.
RDWBSR99  RETURN
+
.------------------------------------------------------------
.  Move spaces to WebServices variables
.------------------------------------------------------------
CLWBSR00  MOVE      SP70,WBSPROID
          MOVE      SP70,WBSJKSLO
          MOVE      SP70,WBSPRORG
          MOVE      SP70,WBSDVNAM
          MOVE      SP70,WBSCLIID
          MOVE      SP70,WBSACTAU
          MOVE      SP70,WBSACTVC
          MOVE      SP70,WBSDACUR
          MOVE      SP70,WBSDAUUR
          MOVE      SP70,WBSRDKUR
          MOVE      SP70,WBSWSCLI
          MOVE      SP70,WBSLOCAT
          MOVE      SP70,WBSNOTEM
.
CLWBSR99  RETURN
+
.------------------------------------------------------------
. Program Initialisation
.------------------------------------------------------------
INIT0000  MOVE      ONE,EMRFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      EMRVISA2,"emrvisaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ZERO,EMRFLAG
          ENDIF
          OPEN      EMRCLIA1,"emrcliaf"
.
          OPEN      EMRHISA1,"emrhisaf"
          OPEN      EMRDCMA1,"emrdcmaf"
          OPEN      OBSDETA1,"obsdetaf"                                *I-54627
          OPEN      OBSMDTA1,"obsmdtaf"     * Patient Medical Notes
          OPEN      OBSMTXA1,"obsmtxaf"     * Patient Medical Notes fre

          OPEN      VISCMTA1,"viscmtaf"
          OPEN      VISMTXA1,"vismtxaf"
          OPEN      EMRICDA1,"emricdaf"
          OPEN      EMRWFMA1,"emrwfmaf"
          OPEN      EMRWFMA2,"emrwfmaf"
          OPEN      EMRWFMA3,"emrwfmaf"
          OPEN      EMRWFMA4,"emrwfmaf"
          OPEN      EMRISMA1,"emrismaf"
          OPEN      EMRINCA1,"emrincaf"
          OPEN      EMRINCA2,"emrincaf"
          OPEN      EMRINCA3,"emrincaf"
          OPEN      EMRVCDA1,"emrvcdaf"
          OPEN      EMRVCDA2,"emrvcdaf"                               *I-215117
          OPEN      EMRMTXA3,"emrmtxaf"
.
          OPEN      EMRUNKA1,"emrunkaf"
          OPEN      EMRLPCA1,"emrlpcaf"
          OPEN      EMRLOCA1,"emrlocaf"
          OPEN      EMRPROA1,"emrproaf"                                *I-50421
          OPEN      EMRSITA1,"emrsitaf"
.
          OPEN      OPRNURA1,"oprnuraf"                   
          OPEN      PATALRT1,"patalrtf"                                *I-54627
          OPEN      PATALTT1,"pataltaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATELGA1,"patelgaf"
          OPEN      PMSMDTA1,"pmsmdtaf"
          OPEN      PMSALNA1,"pmsalnaf"
          OPEN      PMSMDTA1,"pmsmdtaf"
          OPEN      PMSMTXA1,"pmsmtxaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PATVISA1,"patvisaf"
          OPEN      AAEDE1A1,"aaede1af"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATITEM1,"patitemn"                                *I-50421
          OPEN      PATICDO1,"paticdof"                                *I-50421
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATFX1A1,"patfx1af"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PATVADA1,"patvadaf"
          OPEN      PMSVX1A1,"pmsvx1af"                                *I-55214
          OPEN      PMSRELA1,"pmsrelaf"
          OPEN      PMSTLEA1,"pmstleaf"
          OPEN      PMSCEXA1,"pmscexaf"
          OPEN      PRIITEM1,"priitemf"
          OPEN      VISCODA1,"viscodaf"
          OPEN      VISMDTA1,"vismdtaf"
.
          OPEN      IBAPDFA1,"ibapdfaf"
          OPEN      IHAPASS1,"ihapassf"
          OPEN      IBACODE1,"ibacodef"
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
          OPEN      IBASPOL1,"ibaspolf"
          OPEN      MEHDLSA1,"mehdlsaf"
          OPEN      WEBSECA3,"websecaf"
.
          OPEN      SCRSBGA1,"scrsbgaf"
          OPEN      SCRPSTA1,"scrpstaf"
          OPEN      SCRMASA1,"scrmasaf"
          OPEN      PATHGRP1,"pathgrpf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TWO;*182,CSNAME                           *I-54627
          READ      CONTROLF,TEN;*79,CAPPRVNO
          READ      CONTROLF,TEN3;*194,CVETINS
          READ      CONTROLF,TWENTY;*193,PTCNDCLM
.
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          READ      CONTROLF,THIRTY;*89,HELPAGE,*90,HELPRNT,HELSIZE
.
          READ      CONTROLF,FIFTY9;*132,CALRDESC
          READ      CONTROLF,SEVENTY8;*64,AECNLABL
          READ      CONTROLF,SEVENTY9;*82,PTCNDSCI
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,EIGHTY9;*138,EMCNICDF                     *I-50421
          READ      CONTROLF,HUND03;*220,PTCNDEES,*221,PTCNDDES
          READ      CONTROLF,HUND14;*145,PTCNCLID,*213,PTCNUEDC,*214,PTCNUTPD
          READ      CONTROLF,HUND16;*69,PTCNSCEM,*149,PTCNSCPN,*189,PTCNSCPP
          READ      CONTROLF,HUND18;*138,PTCNNEWC
          READ      CONTROLF,HUND20;*158,PTCNUNET
          READ      CONTROLF,HUND22;*8,EMCNURSE
          READ      CONTROLF,HUND29;*1,PTCNWSDR,*61,PTCNWSIN,*62,PTCNRKDY:
                                    *68,PTCNTKMN,*71,PTCNOECW,*72,PTCNOECE
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          IF        EMCNICDF=0
              OPEN      PATICDD1,"paticddf"
              OPEN      PATICDD2,"paticddf"
              OPEN      PATI10D1,"pati10df"
              OPEN      PATI10D2,"pati10df"
          ELSE
              OPEN      EMRICDA1,"emricdaf"
              OPEN      EMRICDA2,"emricdaf"
              OPEN      EMRICDA3,"emricdaf"
          ENDIF
.
.          OPEN      PMSIHIA1,"pmsihiaf"     * IHI Details
.
          MOVE      ZERO,VISXDCIN
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      VISXDCA1,"visxdcaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,VISXDCIN
          ENDIF
.
. **** WebServices ****
.
          OPEN      WEBB2BA1,"webb2baf"
          OPEN      WEBB2BA2,"webb2baf"
          OPEN      WEBB2BA3,"webb2baf"
.
          OPEN      WEBOECA1,"weboecaf"
          OPEN      WEBOECA2,"weboecaf"
          OPEN      WEBOECA3,"weboecaf"
          OPEN      WEBOECA4,"weboecaf"
          OPEN      WEBOECA5,"weboecaf"
          OPEN      WEBOECA6,"weboecaf"
.
          OPEN      WEBOESA1,"weboesaf"
          OPEN      WEBOESA2,"weboesaf"
          OPEN      WEBOESA3,"weboesaf"
          OPEN      WEBOESA4,"weboesaf"
.
          OPEN      WEBELFA1,"webelfaf"
          OPEN      WEBELFA2,"webelfaf"
          OPEN      WEBELFA3,"webelfaf"
          OPEN      WEBELFA4,"webelfaf"
          OPEN      WEBELFA5,"webelfaf" 
          OPEN      WEBELFA6,"webelfaf"
          OPEN      WEBELFA7,"webelfaf"
.
          OPEN      WEBPARA1,"webparaf"
.
          RETURN
.
.
.
.------------------------------------------------------------
. Validate and Extract OECW files
. [TransactionId].properties
. [TransactionId]_oecw
.------------------------------------------------------------
OECW0000  CALL      FFOEC000
.
          CALL      PROC0000               * process
          BRANCH    EXIT,OECW9999          * error
.
          CALL      EXTR0000               * extract data 
          BRANCH    EXIT,OECW9999          * error
.
          CALL      POST0000               * Post OECW JSON to Medicare 
          BRANCH    EXIT,OECW9999          * error
.
OECW9999  RETURN
+
.*****************************************************************************
.*                               PROC0000                                    *
.*        Load the OEC variables with the relevant data                      *
.* Returns: EXIT   0 = Ok to continue                                        *
.*                 1 = error(s) encountered                                  *
.*****************************************************************************
.
. Collect data from webPAS tables         
. ***************************************
.
PROC0000  CALL      CLOEVL00  
.
          IF        FFOECIND=ONE
.
.           Get the Free Format OEC 
.
            PACK      KEY8,WBOCVISN,SP70
            CALL      RDWBELFA1
            IF        OVRCD = 1
              PACK      KEY8,WBOCELEG,SP70
              CALL      RDWBELFA1
              IF        OVRCD = 1
                MOVE      "OEC.03-Free Format OEC record missing.",ERRORDSC
                GOTO      PROC9100
              ENDIF
            ENDIF
.
            MATCH     SP70,WBOCURNO
            IF        !@EQUAL
              MOVE      WBOCURNO,KEY8
              CALL      RDPMPX21
              IF        OVRCD = 1
                MOVE      "OEC.06-PMI Master extension record missing",ERRORDSC
                GOTO      PROC9100
              ENDIF
            ENDIF
.
          ELSE
.
.           Get the PMI master and master extension records
.
            MOVE      WBOCURNO,KEY8
            CALL      RDMAST1                    * patient master record found ?
            IF        OVRCD = 1
              MOVE      "OEC.05-PMI Master record missing",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      WBOCURNO,KEY8
            CALL      RDPMPX21                   * pt. master ext record found ?
            IF        OVRCD = 1
              MOVE      "OEC.06-PMI Master extension record missing",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
.           Get the visit extension
.
            MOVE      WBOCVISN,KEY8
            CALL      RDPMVX11                     * visit ext. record found ?
            IF        OVRCD = 1
              MOVE      "OEC.04-Visit extension record not found",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
.           Get the admission record for the visit
.  
            MOVE      WBOCVISN,KEY8
            CALL      RDMISS1                      * patient adm. record found ?
            IF        OVRCD = 1
              MOVE      "OEC.07-Admission record not found",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            CALL      CLPATDSC
.
          ENDIF
.
. Collect date for .properties file
. ***************************************        
.
.         Load webpas.oecTransactionId=
.         -----------------------------
.
          MATCH     SP70,WBOCTRID
          IF        @EQUAL 
            MOVE      "OEC.01-weboecaf transactionid is blank",ERRORDSC
            GOTO      PROC9100
          ELSE
            MOVE      WBOCTRID,PRPVAL01
          ENDIF
.
.         Load webpas.oecMessageId=
.         -------------------------
.
          MATCH     SP70,WBOCMSID
          IF        @EQUAL
            MOVE      "OEC.02-weboecaf messageid is blank",ERRORDSC
            GOTO      PROC9100
          ELSE
            MOVE      WBOCMSID,PRPVAL02
          ENDIF
.
.         Load webpas.oecSubjectId=
.         -------------------------
.
          IF        FFOECIND=ONE
            MOVE      WBEFHFMN,PRPVAL03
          ELSE
            MOVE      PMVXFNDM,PRPVAL03
          ENDIF
.
          MATCH     SP70,PRPVAL03
          IF        @EQUAL
            MOVE      "N/A",PRPVAL03
            PACK      PRPVAL03,PRPVAL03,SP70
          ENDIF
.
. Collect Data for _oecw file
. ***************************************
.
.         Load claim>typeCode
.         -------------------
.
          MOVE      "ECF",OECVAL17 
.
.         Load claim>accountReferenceId
.         -----------------------------
.
          IF        FFOECIND=ONE
            MOVE      WBOCARID,OECVAL18
            SQUEEZE   OECVAL18
            PACK      OECVAL18,OECVAL18,SP20   
          ELSE
            MOVE      WBOCARID,OECVAL18
            SQUEEZE   OECVAL18
            PACK      OECVAL18,OECVAL18,SP20  
          ENDIF
.
.         Load claim>compensationClaimInd
.         -------------------------------
.
          IF        FFOECIND=ONE
.
            CALL      FCMP0000                     * see if compensable claim
            COMPARE   ZERO,CLAIMFLG
            IF        @EQUAL
              MOVE      ANSN,OECVAL19
            ELSE
              MOVE      ANSY,OECVAL19
            ENDIF
.
          ELSE
.
            CALL      COMP0000                     * see if compensable claim
            COMPARE   ZERO,CLAIMFLG
            IF        @EQUAL
              MOVE      ANSN,OECVAL19
            ELSE
              MOVE      ANSY,OECVAL19
            ENDIF
.
          ENDIF
.
.         Load claim>accident>accidentDate
.         --------------------------------
.
          MOVE      SP70,OECVAL15
.
.         Load claim>accident>accidentInd
.         -------------------------------
.
          MOVE      "N",OECVAL16
.
.         Load claim>patient>identity>dateOfBirth
.         ---------------------------------------
.
          IF        FFOECIND=ONE
.
            MATCH     SP70,WBEFBDAT
            IF        @EQUAL
              MOVE      "OEC.08-PatientDateOfBirth is blank",ERRORDSC
              GOTO      PROC9100
            ELSE
              UNPACK    WBEFBDAT,CCENT,CYEAR,CMON,CDAY
              PACK      OECVAL03,CCENT,CYEAR,DASH,CMON,DASH,CDAY
            ENDIF 
.
          ELSE
.
            MATCH     SP70,PBDATE
            IF        @EQUAL
              MOVE      "OEC.08-PatientDateOfBirth is blank",ERRORDSC
              GOTO      PROC9100
            ELSE
              UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
              PACK      OECVAL03,CCENT,CYEAR,DASH,CMON,DASH,CDAY
            ENDIF
.
          ENDIF
.
.         Load claim>patient>identity>familyName
.         --------------------------------------
.
          IF        FFOECIND=ONE
.
            PACK      OECVAL04,WBEFSNAM,SP70
            MATCH     SP70,OECVAL04
            IF        @EQUAL
              MOVE      "OEC.09-PatientFamilyName is blank",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
          ELSE
.
            PACK      OECVAL04,PSNAME,SP70
            MATCH     SP70,OECVAL04
            IF        @EQUAL
              MOVE      "OEC.09-PatientFamilyName is blank",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
         ENDIF
.
.         Load claim>patient>identity>givenName
.         -------------------------------------
.
          IF        FFOECIND=ONE
.
            PACK      OECVAL05,WBEFFNAM,SP70
            MATCH     SP70,OECVAL05
            IF        @EQUAL
              MOVE      "OEC.10-PatientGivenName is blank",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
          ELSE
.
            PACK      OECVAL05,PMPXFNAM,SP70
            MATCH     SP70,OECVAL05
            IF        @EQUAL
              MOVE      "OEC.10-PatientGivenName is blank",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
          ENDIF
.
.         Load claim>patient>identity>secondInitial
.         -----------------------------------------
.
          IF        FFOECIND=ONE
.
            PACK      OECVAL12,SP70 
.
            MATCH     SP70,WBOCURNO
            IF        !@EQUAL
              PACK      OECVAL12,PMPXSNAM,SP70
            ENDIF
.
          ELSE
.
            PACK      OECVAL12,PMPXSNAM,SP70
.
          ENDIF
.
.         Load claim>patient>identity>sex
.         -------------------------------
.
          IF        FFOECIND=ONE
.
            MOVE      NINE,OECVAL06
            MATCH     ANSF,WBEFGEND
            IF        @EQUAL
              MOVE      TWO,OECVAL06
            ELSE
              MATCH     ANSM,WBEFGEND
              IF        @EQUAL
                MOVE      ONE,OECVAL06
              ELSE
                MATCH     SP70,WBEFGEND
                IF        !@EQUAL & !@EOS
                  MOVE      THREE,OECVAL06
                ENDIF
              ENDIF
            ENDIF
.
          ELSE
.
            MOVE      NINE,OECVAL06
            MATCH     ANSF,PSEX
            IF        @EQUAL
              MOVE      TWO,OECVAL06
            ELSE
              MATCH     ANSM,PSEX
              IF        @EQUAL
                MOVE      ONE,OECVAL06
              ELSE
                MATCH     SP70,PSEX
                IF        !@EQUAL & !@EOS
                  MOVE      THREE,OECVAL06
                ENDIF
              ENDIF
            ENDIF
.
          ENDIF
.
.         Load claim>patient>alsoKnownAs>familyName
.         -----------------------------------------
.
.         IF        FFOECIND=ONE
.           MOVE      SP70,OECVAL37 
.         ELSE
.           MOVE      PMPXHFSN,OECVAL37
.         ENDIF
.
          PACK      OECVAL37,PMPXHFSN,SP70
.
.         Load claim>patient>alsoKnownAs>givenName
.         ----------------------------------------
.
.         IF        FFOECIND=ONE
.           MOVE      SP70,OECVAL38    
.         ELSE
.           MOVE      PMPXHFGN,OECVAL38 
.         ENDIF
.
          PACK      OECVAL38,PMPXHFGN,SP70
.
.         Load claim>patient>healthFund
.         -----------------------------
.
          IF        FFOECIND=ONE
.
            COMPARE   ONE,IBCNMHOS                 * using multi-hospital
            GOTO      PROC0050 IF NOT EQUAL        * no
.
            PACK      KEY10,WBEFCUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=ONE
              MOVE      "Created By User record missing",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MATCH     SP3,WBSEHOSP                 * hospital id blank ?
            IF        @EQUAL
              MOVE      "Hospital id blank",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      WBSEHOSP,KEY3
            CALL      RDPTHSP1                     * hospital code on file ?
            IF        OVRCD = 1
              MOVE      "Hospital code (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    WBSEHOSP,ERRORDSC
              APPEND    ") not on file",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
.           MATCH     SP8,PTHSLOCN                 * blank location for hosp. ?
.           IF        !@EQUAL
.             MOVE      PTHSLOCN,HDRSEG01          * set location id from hosp.
.           ENDIF
.
            MATCH     "1",PTHSUDVA                 * Using Cat. CL for DVA ?
            GOTO      PROC0050 IF NOT EQUAL        * no
.
.           "Using Category CL for DVA" is turned on for the hospital, so
.           check if this is a DVA claim type
.
            COMPARE   ONE,CLAIMFLG                 * DVA claim type ?
            GOTO      PROC0070 IF EQUAL            * yes
            GOTO      PROC0200                     * no
.
.           Not using multi-hospital
.
PROC0050    COMPARE   ONE,PTCNUEDC                 * Using Cat. CL for DVA ?
            GOTO      PROC0200 IF NOT EQUAL        * no
.
            COMPARE   ONE,CLAIMFLG                 * yes - DVA claim type ?
            GOTO      PROC0200 IF NOT EQUAL        * no
.
.           This is a DVA claim, so use the DVA number to set
.           PatientFundMembershipNum.  If there is a DVA concession card on
.           file, use the number from that
.
.           Load claim>patient>healthFund>memberNumber
.           ------------------------------------------
.
            MOVE      SP70,DIM20
            CALL      FCNC0000                     * DVA conc card on file ?
            BRANCH    EXIT,PROC0070                * no
.
            MOVE      DIM20,OECVAL08               * yes
            GOTO      PROC0080
.
PROC0070    MATCH     SP10,WBEFDVAN
            IF        @EQUAL
              MOVE      "DVA number is blank",ERRORDSC
              GOTO      PROC9100
            ELSE
              PACK      OECVAL08,WBEFDVAN,SP20
            ENDIF
.
PROC0080    MATCH     SP3,CVETINS
            IF        @EQUAL
              MOVE      "DVA participant code is blank",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      CVETINS,KEY3                * set key for participant read
            GOTO      PROC0300
.
.           Not a DVA claim, so check if this is a health fund claim
.
PROC0200    MATCH     SP6,WBEFHFND                 * blank health fund ?
            IF        @EQUAL
              MOVE      "Health Fund is blank",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
.           Load claim>patient>healthFund>memberNumber
.           ------------------------------------------
.
            MATCH     SP20,WBEFHFMN
            IF        @EQUAL
              MOVE      "Fund membership number is blank",ERRORDSC
              GOTO      PROC9100
            ELSE
              PACK      OECVAL08,WBEFHFMN,SP20     * Health fund membership no
            ENDIF
.
            PACK      KEY14,WBEFHFND,ZERO,ZERO,ZERO,ZERO,SP20
            CALL      RDFUND1
            IF        OVRCD = 1
              MOVE      "Health Fund (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    WBEFHFND,ERRORDSC
              APPEND    ") is not on file",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      WBEFHFND,KEY6
            CALL      RDPTFX11
            IF        OVRCD = 1
              MOVE      "Health Fund extension record (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    WBEFHFND,ERRORDSC
              APPEND    ") not found",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
.           Check if there are sender contact details for the health fund
.           and load if present
.
.           Load claim>senderContact>emailAddress
.           -------------------------------------
.
            MATCH     SP80,PTFXSCEM              * blank sender contact email ?
            IF        !@EQUAL
              MOVE      PTFXSCEM,OECVAL41          * no
            ENDIF
.
.           Load claim>senderContact>name
.           -----------------------------
.
            MATCH     SP40,PTFXSCPN                * blank sender contact name ?
            IF        !@EQUAL
              MOVE      PTFXSCPN,OECVAL39          * no
            ENDIF
.
.           Load claim>senderContact>phoneNumber
.           ------------------------------------
.
            MATCH     SP20,PTFXSCPP              * blank sender contact phone ?
            IF        !@EQUAL
              MOVE      PTFXSCPP,OECVAL13          * no
            ENDIF
.
            MOVE      "02",KEY2                  * check HF history for HF Group
            PACK      KEY17,WBEFHFND,KEY2,SP70
            CALL      PATDDHRD
.
.           MATCH     SP3,PTHFHGRP
.           IF        @EQUAL
.             MOVE      "Health Fund Group is blank",WBOCDESC
.             GOTO      PROC9100
.           ENDIF
.
            MATCH     SP70,PTFXECLP
            IF        @EQUAL
              MATCH     SP3,PTHFHGRP
              IF        @EQUAL
                MOVE      "Health Fund Group / Eclipse Participant is blank",ERRORDSC
                GOTO      PROC9100
              ELSE
                MOVE      PTHFHGRP,KEY3
              ENDIF
            ELSE
              MOVE      PTFXECLP,KEY3
            ENDIF
.
.           MOVE      PTHFHGRP,KEY3
PROC0300    CALL      RDWBPAR1
            IF        OVRCD = 1
              MOVE      KEY3,ERRORDSC
              ENDSET    ERRORDSC
              APPEND    " is not an Eclipse participant",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
.           Load claim>patient>healthFund>organisation
.           ------------------------------------------
.
            MOVE      WBPRCODE,OECVAL10            * set FundBrandId
.
.           Load claim>patient>healthFund>memberRefNumber
.           ---------------------------------------------
.
            MOVE      PMPXFUPI,OECVAL09
.
          ELSE
.
            COMPARE   ONE,IBCNMHOS                 * using multi-hospital
            GOTO      PROC0500 IF NOT EQUAL        * no
.
            MATCH     SP3,PMVXMHOS                 * hospital id blank ?
            IF        @EQUAL
              MOVE      "Hospital id blank",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      PMVXMHOS,KEY3
            CALL      RDPTHSP1                     * hospital code on file ?
            IF        OVRCD = 1
              MOVE      "Hospital code (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    PMVXMHOS,ERRORDSC
              APPEND    ") not on file",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
.           MATCH     SP8,PTHSLOCN                 * blank location for hosp. ?
.           IF        !@EQUAL
.             MOVE      PTHSLOCN,HDRSEG01          * set location id from hosp.
.           ENDIF
.
            MATCH     "1",PTHSUDVA                 * Using Cat. CL for DVA ?
            GOTO      PROC0500 IF NOT EQUAL        * no
.
.           "Using Category CL for DVA" is turned on for the hospital, so
.           check if this is a DVA claim type
.
            COMPARE   ONE,CLAIMFLG                 * DVA claim type ?
            GOTO      PROC0600 IF EQUAL            * yes
            GOTO      PROC2000                     * no
.
.           Not using multi-hospital
.
PROC0500    COMPARE   ONE,PTCNUEDC                 * Using Cat. CL for DVA ?
            GOTO      PROC2000 IF NOT EQUAL        * no
.
            COMPARE   ONE,CLAIMFLG                 * yes - DVA claim type ?
            GOTO      PROC2000 IF NOT EQUAL        * no
.
.           This is a DVA claim, so use the DVA number to set
.           PatientFundMembershipNum.  If there is a DVA concession card on
.           file, use the number from that
.
.           Load claim>patient>healthFund>memberNumber
.           ------------------------------------------
.
PROC0600    MOVE      SP70,DIM20
            CALL      CONC0000                     * DVA conc card on file ?
            BRANCH    EXIT,PROC0700                * no
.
            MOVE      DIM20,OECVAL08               * yes
            GOTO      PROC0800
.
PROC0700    MOVE      "DVA number is blank",ERRORDSC
            GOTO      PROC9100
.
PROC0800    MATCH     SP3,CVETINS
            IF        @EQUAL
              MOVE      "DVA participant code is blank",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      CVETINS,KEY3               * set key for participant read
            GOTO      PROC3000
.
.           Not a DVA claim, so check if this is a health fund claim
.
PROC2000    MATCH     SP6,AFUNDH                   * blank health fund ?
            IF        @EQUAL
              MOVE      "Health Fund is blank",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
.           Load claim>patient>healthFund>memberNumber
.           ------------------------------------------
.
            MATCH     SP20,PMVXFNDM
            IF        @EQUAL
              MOVE      "Fund membership number is blank",ERRORDSC
              GOTO      PROC9100
            ELSE
              PACK      OECVAL08,PMVXFNDM,SP20     * Health fund membership no
            ENDIF
.
            PACK      KEY14,AFUNDH,ZERO,ZERO,ZERO,ZERO,SP20
            CALL      RDFUND1
            IF        OVRCD = 1
              MOVE      "Health Fund (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    AFUNDH,ERRORDSC
              APPEND    ") is not on file",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      AFUNDH,KEY6
            CALL      RDPTFX11
            IF        OVRCD = 1
              MOVE      "Health Fund extension record (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    AFUNDH,ERRORDSC
              APPEND    ") not found",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
.           Check if there are sender contact details for the health fund
.           and load if present
.
.           Load claim>senderContact>emailAddress
.           -------------------------------------
.
            MATCH     SP80,PTFXSCEM              * blank sender contact email ?
            IF        !@EQUAL
              MOVE      PTFXSCEM,OECVAL41          * no
            ENDIF
.
.           Load claim>senderContact>name
.           -----------------------------
.
            MATCH     SP40,PTFXSCPN                * blank sender contact name ?
            IF        !@EQUAL
              MOVE      PTFXSCPN,OECVAL39          * no
            ENDIF
.
.           Load claim>senderContact>phoneNumber
.           ------------------------------------
.
            MATCH     SP20,PTFXSCPP               * blank sender contact phone ?
            IF        !@EQUAL
              MOVE      PTFXSCPP,OECVAL13         * no
            ENDIF
.
            MOVE      "02",KEY2                  * check HF history for HF Group
            PACK      KEY17,AFUNDH,KEY2,SP70
            CALL      PATDDHRD
.
.           MATCH     SP3,PTHFHGRP
.           IF        @EQUAL
.             MOVE      "Health Fund Group is blank",WBOCDESC
.             GOTO      PROC9100
.           ENDIF
.
            MATCH     SP70,PTFXECLP
            IF        @EQUAL
              MATCH     SP3,PTHFHGRP
              IF        @EQUAL
                MOVE      "Health Fund Group / Eclipse Participant is blank",ERRORDSC
                GOTO      PROC9100
              ELSE
                MOVE      PTHFHGRP,KEY3
              ENDIF
            ELSE
              MOVE      PTFXECLP,KEY3
            ENDIF
.
.           MOVE      PTHFHGRP,KEY3
PROC3000    CALL      RDWBPAR1
            IF        OVRCD = 1
              MOVE      KEY3,ERRORDSC
              ENDSET    ERRORDSC
              APPEND    " is not an Eclipse participant",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
.           Load claim>patient>healthFund>organisation
.           ------------------------------------------
.
            MOVE      WBPRCODE,OECVAL10            * set FundBrandId
.
.           Load claim>patient>healthFund>memberRefNumber
.           ---------------------------------------------
.
            MOVE      PMPXFUPI,OECVAL09
.
          ENDIF   
.
.         Load claim>senderContact>emailAddress
.         -------------------------------------
.
PROC3100  MATCH     SP80,OECVAL41              * blank sender contact email ?
          IF        @EQUAL
            MOVE      PTCNSCEM,OECVAL41          * no
          ENDIF
.
.         Load claim>senderContact>name
.         -----------------------------
.
          MATCH     SP40,OECVAL39                * blank sender contact name ?
          IF        @EQUAL
            MOVE      PTCNSCPN,OECVAL39          * no
          ENDIF
.
.         Load claim>senderContact>phoneNumber
.         ------------------------------------
.
          MATCH     SP20,OECVAL13               * blank sender contact phone ?
          IF        @EQUAL
            MOVE      PTCNSCPP,OECVAL13         * no
          ENDIF
.
.         Load claim>facilityId
.         ---------------------
.
          IF        IBCNMHOS = 1
            MOVE      PTHSAPPR,OECVAL21
          ELSE
            MOVE      CAPPRVNO,OECVAL21
          ENDIF
.
.         Load claim>lengthOfStay
.         Load claim>sameDayInd
.         ---------------------
.
          IF        FFOECIND=ONE
.
.           Set SameDayCode and LengthOfStay.
.           Load default values based on estimated LOS.
.
            MATCH     "  0",WBEFPLOS
            IF        @EQUAL
              MOVE      ANSY,OECVAL25              * default to sameday
            ELSE
              MOVE      ANSN,OECVAL25              * default to overnight
            ENDIF
.
.           Get discharge intention
.
.           IF        PTCNDSCI=0
.             MOVE      "P ",TCODE
.             MOVE      WBEFDINT,ACODE
.           ELSE
.             LOAD      TCODE,PTCNDSCI,CATU1,CATU2,CATU3,CATU4,CATU5,CATVI
.             LOAD      ACODE,PTCNDSCI,AUSR1,AUSR2,AUSR3,AUSR4,AUSR5,PMVXIDUS
.           ENDIF
.
            MOVE      "VI",TCODE
            MOVE      WBEFISTY,ACODE
.
            MATCH     SP3,ACODE
            IF        !@EQUAL
              PACK      KEY5,TCODE,ACODE
              CALL      RDCODE1                    * Read a codes file record
              IF        OVRCD = 0
                MATCH     "1",TCINDC1
                IF        @EQUAL
                  MOVE      ANSN,OECVAL25
                ENDIF
                MATCH     "2",TCINDC1
                IF        @EQUAL
                  MOVE      ANSY,OECVAL25
                ENDIF
              ENDIF
            ENDIF
.
.           If this is an overnight stay, then make sure that the estimated LOS
.           (pmselfaf.pmefplos) is greater than zero.
.
            MATCH     ANSN,OECVAL25
            IF        @EQUAL
              RJUSTIFY  WBEFPLOS
              MATCH     "  0",WBEFPLOS
              IF        @EQUAL
                MOVE      "Length Of Stay cannot be zero",ERRORDSC
                GOTO      PROC9100
              ELSE
                MOVE      WBEFPLOS,OECVAL22
                RJUSTIFY  OECVAL22
              ENDIF
            ENDIF
.
.           If this is a sameday stay, then make sure that the estimated LOS
.           (pmselfaf.pmefplos) is zero.
.
            MATCH     ANSY,OECVAL25
            IF        @EQUAL
              RJUSTIFY  WBEFPLOS
              MATCH     "  0",WBEFPLOS
              IF        !@EQUAL
                MOVE      "Length Of Stay must be zero",ERRORDSC
                GOTO      PROC9100
              ELSE
                MOVE      SP3,OECVAL22
              ENDIF
            ENDIF
.
          ELSE
.
.           Set SameDayCode and LengthOfStay.
.           Load default values based on estimated LOS.
.
            IF        ASTAY = 0
              MOVE      ANSY,OECVAL25              * default to sameday
            ELSE
              MOVE      ANSN,OECVAL25              * default to overnight
            ENDIF
.
.           Get discharge intention
.
            IF        PTCNDSCI=0
              MOVE      "P ",TCODE
              MOVE      ACLSS,ACODE
            ELSE
              LOAD      TCODE,PTCNDSCI,CATU1,CATU2,CATU3,CATU4,CATU5,CATVI
              LOAD      ACODE,PTCNDSCI,AUSR1,AUSR2,AUSR3,AUSR4,AUSR5,PMVXIDUS
            ENDIF
.
            MATCH     SP3,ACODE
            IF        !@EQUAL
              PACK      KEY5,TCODE,ACODE
              CALL      RDCODE1                    * Read a codes file record
              IF        OVRCD = 0
                MATCH     "1",TCINDC1
                IF        @EQUAL
                  MOVE      ANSN,OECVAL25
                ENDIF
                MATCH     "2",TCINDC1
                IF        @EQUAL
                  MOVE      ANSY,OECVAL25
                ENDIF
              ENDIF
            ENDIF
.
.           If this is an overnight stay, then make sure that the estimated LOS
.           (patmi1af.astay) is greater than zero.
.
            MATCH     ANSN,OECVAL25
            IF        @EQUAL
              COMPARE   ZERO,ASTAY
              IF        @EQUAL
                MOVE      "Length Of Stay cannot be zero",ERRORDSC
                GOTO      PROC9100
              ELSE
                MOVE      ASTAY,OECVAL22
              ENDIF
            ENDIF
.
.           If this is a sameday stay, then make sure that the estimated LOS
.           (patmi1af.astay) is zero.
.
            MATCH     ANSY,OECVAL25
            IF        @EQUAL
              COMPARE   ZERO,ASTAY
              IF        !@EQUAL
                MOVE      "Length Of Stay must be zero",ERRORDSC
                GOTO      PROC9100
              ELSE
                MOVE      SP3,OECVAL22
              ENDIF
            ENDIF
.
          ENDIF
.
.         Load      claim>peaRequestInd
.         Load      claim>emergencyAdmissionInd
.         -------------------------------------
.
          IF        FFOECIND=ONE
.
.           Load PEARequestInd,EmergencyAdmissionInd
.
.           MOVE      WBOCVISN,KEY8
.           CALL      RDPTELG1
.           IF        OVRCD = 1
.             MOVE      "Eligibility record missing for visit",ERRORDSC
.             GOTO      PROC9100
.           ENDIF
.
            MATCH     "1",WBEFPEAI
            IF        @EQUAL
              MOVE      ANSY,OECVAL23
            ELSE
              MOVE      ANSN,OECVAL23
            ENDIF
.
            MATCH     "1",WBEFEMAD
            IF        @EQUAL
              MOVE      ANSY,OECVAL20
            ELSE
              MOVE      ANSN,OECVAL20
            ENDIF
.         
          ELSE
.
.           Load PEARequestInd, EmergencyAdmissionInd
.
            MOVE      WBOCVISN,KEY8
            CALL      RDPTELG1
            IF        OVRCD = 1
              MOVE      "Eligibility record missing for visit",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MATCH     "1",PTELSPEA
            IF        @EQUAL
              MOVE      ANSY,OECVAL23
            ELSE
              MOVE      ANSN,OECVAL23
            ENDIF
.
            MATCH     "1",PTELEADM
            IF        @EQUAL
              MOVE      ANSY,OECVAL20
            ELSE
              MOVE      ANSN,OECVAL20
            ENDIF
.
          ENDIF 
.
.         Load claim>presentingIllnessCode
.         Load claim>presentingIllnessItemNumber
.         -------------------------------------------
.
          IF        FFOECIND=ONE
.
.           Load PresentingIllnessCode
.
            MATCH     SP70,WBEFPRIM
            GOTO      PROC3500 IF NOT EQUAL
.
            MATCH     SP3,WBEFPRIC                 * blank pres. illness code ?
            GOTO      PROC3500 IF EQUAL            * yes - check patmi1af.ambs
.
            PACK      KEY5,ANSIL,WBEFPRIC
            CALL      RDCODE1                      * code on file ?
            BRANCH    OVRCD,PROC3500               * no
.
            MATCH     SP4,THCSCOD                 * blank state HCP equivalent ?
            GOTO      PROC3500 IF EQUAL            * yes - check patmi1af.ambs
.
.           Presenting Illness codes are 3 digit codes, so check the code
.           we have is valid
.
            MOVE      THCSCOD,DIM4
            STRIP     DIM4
            MOVELPTR  DIM4,FORM1
            IF        FORM1 > 3
              MOVE      "Presenting Illness Code (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    WBEFPRIC,ERRORDSC
              APPEND    " - Cat ",ERRORDSC
              APPEND    "il",ERRORDSC
              APPEND    ", HDP Eq.) too long",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            TYPE      DIM4
            IF        !@EQUAL
              MOVE      "Presenting Illness Code (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    WBEFPRIC,ERRORDSC
              APPEND    " - Cat ",ERRORDSC
              APPEND    "il",ERRORDSC
              APPEND    ", HDP Eq.) not numeric",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      THCSCOD,OECVAL42           * set PresentingIllnessItemCode
            GOTO      PROC6000
.
.           There was no presenting illness code, so check for a CMBS 
.           item number
.
PROC3500    MATCH     SP9,WBEFPRIM
            IF        @EQUAL
              MOVE      "Presenting Illness not found",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      WBEFPRIM,DIM9
            STRIP     DIM9
            MOVELPTR  DIM9,FORM1
            IF        FORM1 > 5
              MOVE      "Presenting Illness Number too long",ERRORDSC
              GOTO      PROC9100
            ENDIF
            MOVE      WBEFPRIM,OECVAL24           * set PresentingIllnessItemNum
.
          ELSE
.
            MATCH     SP70,WBOCELEG
            GOTO      PROC4500 IF EQUAL
.
            PACK      KEY8,WBOCELEG,SP70
            CALL      RDWBELF1
            BRANCH    OVRCD,PROC4500
.
.           Load PresentingIllnessCode
.
            MATCH     SP70,WBEFPRIM
            GOTO      PROC4100 IF NOT EQUAL
.
            MATCH     SP3,WBEFPRIC                 * blank pres. illness code ?
            GOTO      PROC4100 IF EQUAL            * yes - check patmi1af.ambs
.
            PACK      KEY5,ANSIL,WBEFPRIC
            CALL      RDCODE1                      * code on file ?
            BRANCH    OVRCD,PROC4100               * no
.
            MATCH     SP4,THCSCOD                 * blank state HCP equivalent ?
            GOTO      PROC4100 IF EQUAL            * yes - check patmi1af.ambs
.
.           Presenting Illness codes are 3 digit codes, so check the code
.           we have is valid
.
            MOVE      THCSCOD,DIM4
            STRIP     DIM4
            MOVELPTR  DIM4,FORM1
            IF        FORM1 > 3
              MOVE      "Presenting Illness Code (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    WBEFPRIC,ERRORDSC
              APPEND    " - Cat ",ERRORDSC
              APPEND    "il",ERRORDSC
              APPEND    ", HDP Eq.) too long",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            TYPE      DIM4
            IF        !@EQUAL
              MOVE      "Presenting Illness Code (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    WBEFPRIC,ERRORDSC
              APPEND    " - Cat ",ERRORDSC
              APPEND    "il",ERRORDSC
              APPEND    ", HDP Eq.) not numeric",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      THCSCOD,OECVAL42           * set PresentingIllnessItemCode
            GOTO      PROC6000
.
.           There was no presenting illness code, so check for a CMBS 
.           item number
.
PROC4100    MATCH     SP9,WBEFPRIM
            IF        @EQUAL
              MOVE      "Presenting Illness not found",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      WBEFPRIM,DIM9
            STRIP     DIM9
            MOVELPTR  DIM9,FORM1
            IF        FORM1 > 5
              MOVE      "Presenting Illness Number too long",ERRORDSC
              GOTO      PROC9100
            ENDIF
            MOVE      WBEFPRIM,OECVAL24           * set PresentingIllnessItemNum
.
            GOTO      PROC6000
.
.           Load PresentingIllnessCode
.
PROC4500    MATCH     SP70,AMBS
            GOTO      PROC5000 IF NOT EQUAL
.
            MATCH     SP3,PMVXPILC                 * blank pres. illness code ?
            GOTO      PROC5000 IF EQUAL            * yes - check patmi1af.ambs
.
            PACK      KEY5,ANSIL,PMVXPILC
            CALL      RDCODE1                      * code on file ?
            BRANCH    OVRCD,PROC5000               * no
.
            MATCH     SP4,THCSCOD                 * blank state HCP equivalent ?
            GOTO      PROC5000 IF EQUAL            * yes - check patmi1af.ambs
.
.           Presenting Illness codes are 3 digit codes, so check the code
.           we have is valid
.
            MOVE      THCSCOD,DIM4
            STRIP     DIM4
            MOVELPTR  DIM4,FORM1
            IF        FORM1 > 3
              MOVE      "Presenting Illness Code (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    PMVXPILC,ERRORDSC
              APPEND    " - Cat ",ERRORDSC
              APPEND    "il",ERRORDSC
              APPEND    ", HDP Eq.) too long",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            TYPE      DIM4
            IF        !@EQUAL
              MOVE      "Presenting Illness Code (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    PMVXPILC,ERRORDSC
              APPEND    " - Cat ",ERRORDSC
              APPEND    "il",ERRORDSC
              APPEND    ", HDP Eq.) not numeric",ERRORDSC
              RESET     ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      THCSCOD,OECVAL42           * set PresentingIllnessItemCode
            GOTO      PROC6000
.
.           There was no presenting illness code, so check for a CMBS 
.           item number
.
PROC5000    MATCH     SP9,AMBS
            IF        @EQUAL
              MOVE      "Presenting Illness not found",ERRORDSC
              GOTO      PROC9100
            ENDIF
.
            MOVE      AMBS,DIM9
            STRIP     DIM9
            MOVELPTR  DIM9,FORM1
            IF        FORM1 > 5
              MOVE      "Presenting Illness Number too long",ERRORDSC
              GOTO      PROC9100
            ENDIF
            MOVE      AMBS,OECVAL24               * set PresentingIllnessItemNum
.
          ENDIF
.
.         Load claim>submissionAuthorityInd
.
PROC6000  MOVE      "Y",OECVAL26
.
.         Load claim>medicalEvent>admissionDate
.
          IF        FFOECIND=ONE
            UNPACK    WBEFEADT,CCENT,CYEAR,CMON,CDAY
            PACK      OECVAL29,CCENT,CYEAR,DASH,CMON,DASH,CDAY  
          ELSE
            UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
            PACK      OECVAL29,CCENT,CYEAR,DASH,CMON,DASH,CDAY
          ENDIF         
.
.         Load claim>medicalEvent>dischargeDate
.
          IF        FFOECIND=ONE
            MOVE      SP70,OECVAL30
          ELSE
            MOVE      SP70,OECVAL30            
            IF        ASTAT = 3
              MOVE      WBOCVISN,KEY8
              CALL      RDDSCH1
              IF        OVRCD = 0
                UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
                PACK      OECVAL30,CCENT,CYEAR,DASH,CMON,DASH,CDAY  
              ENDIF
            ENDIF
          ENDIF
.
.         If Discharge Date if spaces then calculate with lengthOfStay
.
          MATCH     SP70,OECVAL30
          IF        @EQUAL
.
            MATCH     SP70,OECVAL22
            IF        !@EQUAL
.        
              MOVE      ZERO,FORM3
              MOVE      OECVAL22,FORM3     
.
              UNPACK    OECVAL29,CCENT,CYEAR,DASH,CMON,DASH,CDAY
              PACK      KEY8,CCENT,CYEAR,CMON,CDAY
              MOVE      KEY8,DATECALC
              ADD       FORM3,DATECALC 
.
              UNPACK    DATECALC,CCENT,CYEAR,CMON,CDAY
              PACK      OECVAL30,CCENT,CYEAR,DASH,CMON,DASH,CDAY              
.
            ENDIF
          ENDIF
.
.         Load      claim>medicalEvent>service>
.
          IF        FFOECIND=ONE
            CALL      FOES0000                     * write services segment
            BRANCH    EXIT,PROC9100                * error occured
          ELSE
            CALL      WOES0000                     * write services segment
            BRANCH    EXIT,PROC9100                * error occured
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PROC9999
.
PROC9100  MOVE      "1",ERRORIND
          MOVE      ONE,EXIT
.
PROC9999  RETURN
+
.*****************************************************************************
.*                               EXTR0000                                    *
.*        Extract the data into a file ready for sending to Medicare         *
.*****************************************************************************
.
. Build .properties file and move to B2B Device oecw claims directory
. -------------------------------------------------------------------
.
EXTR0000  PACK      PROPFLNM,WBOCTRID,PROPLITR,SP70
.
          PREP      PROPFILE,PROPFLNM
          CLOSE     PROPFILE,DELETE
          PREP      PROPFILE,PROPFLNM
.
          WRITE     PROPFILE,SEQ;PRPLAB01,PRPVAL01
          WRITE     PROPFILE,SEQ;PRPLAB02,PRPVAL02          
          WRITE     PROPFILE,SEQ;PRPLAB03,PRPVAL03
.
          CLOSE     PROPFILE
.
.         Move .properties to B2B Device oecw claims directory 
.
          CLEAR     CMDLINE
          APPEND    "chmod 777 ",CMDLINE
          APPEND    PROPFLNM,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          MATCH     "0       ",TASKID
          IF        !@EQUAL
            MOVE      "Unable to chmod 777 .properties file.",ERRORDSC
            GOTO      EXTR9100
          ENDIF 
.
          CLEAR     CMDLINE
          APPEND    "mv ",CMDLINE
          APPEND    PROPFLNM,CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecw/.",CMDLINE 
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          MATCH     "0       ",TASKID
          IF        !@EQUAL
            MOVE      "Unable to move .properties file to claims dir.",ERRORDSC
            GOTO      EXTR9100
          ENDIF
.
. Build _oecw file and move to B2B Device oecw claims directory
. -------------------------------------------------------------------
.
EXTR1000  PACK      OECWFLNM,WBOCTRID,OECWLITR,SP70
.
          PREP      OECWFILE,OECWFLNM
          CLOSE     OECWFILE,DELETE
          PREP      OECWFILE,OECWFLNM
.
          WRITE     OECWFILE,SEQ;LCBRAC
          WRITE     OECWFILE,SEQ;SP2,QUOTE,OECLAB12,QUOTE,COLON,SP2,LCBRAC
          WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB01,QUOTE,COLON,SP2,LCBRAC
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,QUOTE,OECLAB02,QUOTE,COLON:
                                 SP2,LCBRAC
.
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,QUOTE,OECLAB03,QUOTE,COLON:
                                                 QUOTE,OECVAL03,QUOTE,COMMA
.
          CLEAR     DIM100
          APPEND    SP8,DIM100
          APPEND    QUOTE,DIM100
          APPEND    OECLAB04,DIM100
          APPEND    QUOTE,DIM100
          APPEND    COLON,DIM100
          APPEND    QUOTE,DIM100
          APPEND    OECVAL04,DIM100
          RESET     DIM100
          STRIP     DIM100
          ENDSET    DIM100
          APPEND    QUOTE,DIM100
          APPEND    COMMA,DIM100
          RESET     DIM100
          WRITE     OECWFILE,SEQ;DIM100
.
          CLEAR     DIM100
          APPEND    SP8,DIM100
          APPEND    QUOTE,DIM100
          APPEND    OECLAB05,DIM100
          APPEND    QUOTE,DIM100
          APPEND    COLON,DIM100
          APPEND    QUOTE,DIM100
          APPEND    OECVAL05,DIM100
          RESET     DIM100
          STRIP     DIM100
          ENDSET    DIM100
          APPEND    QUOTE,DIM100
          APPEND    COMMA,DIM100
          RESET     DIM100
          WRITE     OECWFILE,SEQ;DIM100
.
          MATCH     SP70,OECVAL12
          IF        !@EQUAL
            WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,QUOTE,OECLAB46,QUOTE,COLON:
                                                   QUOTE,OECVAL12,QUOTE,COMMA
          ENDIF
.
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,QUOTE,OECLAB06,QUOTE,COLON:
                                                 QUOTE,OECVAL06,QUOTE 
.
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,RCBRAC,COMMA
.
          MATCH     SP70,OECVAL37
          GOTO      EXTR1500 IF NOT EQUAL
.
          MATCH     SP70,OECVAL38
          GOTO      EXTR1500 IF NOT EQUAL
.
          GOTO      EXTR2000
.
EXTR1500  WRITE     OECWFILE,SEQ;SP2,SP2,SP2,QUOTE,OECLAB44,QUOTE,COLON,LCBRAC
.
          MATCH     SP70,OECVAL37
          IF        !@EQUAL
            CLEAR     DIM100
            APPEND    SP8,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECLAB37,DIM100
            APPEND    QUOTE,DIM100
            APPEND    COLON,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECVAL37,DIM100
            RESET     DIM100
            STRIP     DIM100
            ENDSET    DIM100
            APPEND    QUOTE,DIM100
.           APPEND    COMMA,DIM100
            RESET     DIM100
            WRITE     OECWFILE,SEQ;DIM100
          ENDIF
.
          MATCH     SP70,OECVAL38
          IF        !@EQUAL
.
            MATCH     SP70,OECVAL37
            IF        !@EQUAL
              WRITE     OECWFILE,SEQ;SP8,COMMA
            ENDIF
.
            CLEAR     DIM100
            APPEND    SP8,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECLAB38,DIM100
            APPEND    QUOTE,DIM100
            APPEND    COLON,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECVAL38,DIM100
            RESET     DIM100
            STRIP     DIM100
            ENDSET    DIM100
            APPEND    QUOTE,DIM100
            RESET     DIM100
            WRITE     OECWFILE,SEQ;DIM100
          ENDIF
.
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,RCBRAC,COMMA
.
EXTR2000  WRITE     OECWFILE,SEQ;SP2,SP2,SP2,QUOTE,OECLAB07,QUOTE,COLON,LCBRAC
.
          CLEAR     DIM100
          APPEND    SP8,DIM100
          APPEND    QUOTE,DIM100
          APPEND    OECLAB08,DIM100
          APPEND    QUOTE,DIM100
          APPEND    COLON,DIM100
          APPEND    QUOTE,DIM100
          APPEND    OECVAL08,DIM100
          RESET     DIM100
          STRIP     DIM100
          ENDSET    DIM100
          APPEND    QUOTE,DIM100
          APPEND    COMMA,DIM100
          RESET     DIM100
          WRITE     OECWFILE,SEQ;DIM100
.
          MATCH     SP70,OECVAL09
          IF        !@EQUAL & !@EOS
            CLEAR     DIM100
            APPEND    SP8,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECLAB09,DIM100
            APPEND    QUOTE,DIM100
            APPEND    COLON,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECVAL09,DIM100
            RESET     DIM100
            STRIP     DIM100
            ENDSET    DIM100
            APPEND    QUOTE,DIM100
            APPEND    COMMA,DIM100
            RESET     DIM100
            WRITE     OECWFILE,SEQ;DIM100
          ENDIF
.
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,QUOTE,OECLAB10,QUOTE,COLON:
                                                 QUOTE,OECVAL10,QUOTE
.
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,RCBRAC
          WRITE     OECWFILE,SEQ;SP2,SP2,RCBRAC,COMMA
.
EXTR2500  MATCH     SP70,OECVAL41
          GOTO      EXTR3000 IF NOT EQUAL
.
          MATCH     SP70,OECVAL39
          GOTO      EXTR3000 IF NOT EQUAL
.
          MATCH     SP70,OECVAL13
          GOTO      EXTR3000 IF NOT EQUAL
.
          GOTO      EXTR4000
.
EXTR3000  WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB11,QUOTE,COLON,LCBRAC
.
          MATCH     SP70,OECVAL41
          IF        !@EQUAL
            CLEAR     DIM100
            APPEND    SP8,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECLAB41,DIM100
            APPEND    QUOTE,DIM100
            APPEND    COLON,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECVAL41,DIM100
            RESET     DIM100
            STRIP     DIM100
            ENDSET    DIM100
            APPEND    QUOTE,DIM100
            RESET     DIM100
            WRITE     OECWFILE,SEQ;DIM100
          ENDIF
.
          MATCH     SP70,OECVAL39
          IF        !@EQUAL
            WRITE     OECWFILE,SEQ;COMMA
.
            CLEAR     DIM100
            APPEND    SP8,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECLAB39,DIM100
            APPEND    QUOTE,DIM100
            APPEND    COLON,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECVAL39,DIM100
            RESET     DIM100
            STRIP     DIM100
            ENDSET    DIM100
            APPEND    QUOTE,DIM100
            RESET     DIM100
            WRITE     OECWFILE,SEQ;DIM100
          ENDIF
.
          MATCH     SP70,OECVAL13
          IF        !@EQUAL
            WRITE     OECWFILE,SEQ;COMMA
.
            CLEAR     DIM100
            APPEND    SP8,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECLAB13,DIM100
            APPEND    QUOTE,DIM100
            APPEND    COLON,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECVAL13,DIM100
            RESET     DIM100
            STRIP     DIM100
            ENDSET    DIM100
            APPEND    QUOTE,DIM100
            RESET     DIM100
            WRITE     OECWFILE,SEQ;DIM100
          ENDIF
.
          WRITE     OECWFILE,SEQ;SP2,SP2,RCBRAC,COMMA
.
EXTR4000  WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB14,QUOTE,COLON,LCBRAC
.
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,QUOTE,OECLAB16,QUOTE,COLON:
                                             QUOTE,OECVAL16,QUOTE           
.
          WRITE     OECWFILE,SEQ;SP2,SP2,RCBRAC,COMMA 
.
          WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB17,QUOTE,COLON:
                                         QUOTE,OECVAL17,QUOTE,COMMA
.
          CLEAR     DIM100
          APPEND    SP4,DIM100
          APPEND    QUOTE,DIM100
          APPEND    OECLAB18,DIM100
          APPEND    QUOTE,DIM100
          APPEND    COLON,DIM100
          APPEND    QUOTE,DIM100
          APPEND    OECVAL18,DIM100
          RESET     DIM100
          STRIP     DIM100
          ENDSET    DIM100
          APPEND    QUOTE,DIM100
          APPEND    COMMA,DIM100
          RESET     DIM100
          WRITE     OECWFILE,SEQ;DIM100
.
          WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB19,QUOTE,COLON:
                                         QUOTE,OECVAL19,QUOTE,COMMA
.
          MATCH     SP70,OECVAL20
          IF        !@EQUAL
            WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB20,QUOTE,COLON:
                                           QUOTE,OECVAL20,QUOTE,COMMA
          ENDIF
.
          WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB21,QUOTE,COLON:
                                         QUOTE,OECVAL21,QUOTE,COMMA
.
          MATCH     SP70,OECVAL22
          IF        !@EQUAL
            WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB22,QUOTE,COLON:
                                           OECVAL22,COMMA
          ENDIF
.
          WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB23,QUOTE,COLON:
                                         QUOTE,OECVAL23,QUOTE,COMMA
.
EXTR4500  MATCH     SP70,OECVAL42
          IF        !@EQUAL
.
            RJUSTIFY  OECVAL42
            REP       " 0",OECVAL42
.
            WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB42,QUOTE,COLON:
                                           QUOTE,OECVAL42,QUOTE,COMMA 
.
          ELSE
.
            CLEAR     DIM100
            APPEND    SP4,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECLAB24,DIM100
            APPEND    QUOTE,DIM100
            APPEND    COLON,DIM100
            APPEND    QUOTE,DIM100
            APPEND    OECVAL24,DIM100
            RESET     DIM100
            STRIP     DIM100
            ENDSET    DIM100
            APPEND    QUOTE,DIM100
            APPEND    COMMA,DIM100
            RESET     DIM100
            WRITE     OECWFILE,SEQ;DIM100
.
          ENDIF
.
          WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB25,QUOTE,COLON:
                                         QUOTE,OECVAL25,QUOTE,COMMA
.
          WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB26,QUOTE,COLON:
                                         QUOTE,OECVAL26,QUOTE,COMMA
.
          WRITE     OECWFILE,SEQ;SP2,SP2,QUOTE,OECLAB27,QUOTE,COLON,LSQBRAC
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,LCBRAC
.
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,QUOTE,OECLAB28,QUOTE,COLON:
                                                 QUOTE,OECVAL28,QUOTE,COMMA
.
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,QUOTE,OECLAB29,QUOTE,COLON:
                                                 QUOTE,OECVAL29,QUOTE
.
          MATCH     SP70,OECVAL30
          IF        !@EQUAL
            WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,COMMA
            WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,QUOTE,OECLAB30,QUOTE,COLON:
                                                   QUOTE,OECVAL30,QUOTE
          ENDIF
.
          MOVE      SP70,SERVINDC
          MOVE      ZERO,FORM2
          WHILE     FORM2 < 50
            ADD       ONE,FORM2
.
            MATCH     SP70,OECVAL31[FORM2]
            IF        !@EQUAL
              MOVE      "1",SERVINDC
              GOTO      EXTR5000
            ENDIF
          DO
.
EXTR5000  MATCH     "1",SERVINDC
          IF        @EQUAL
.
            WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,COMMA
.
            WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,QUOTE,OECLAB45,QUOTE,COLON:
                                                                      LSQBRAC
.
            MOVE      SP70,FRSTINDC
            MOVE      ZERO,FORM2
            WHILE     FORM2 < 50
              ADD       ONE,FORM2
.
              MATCH     SP70,OECVAL31[FORM2]
              IF        !@EQUAL
.
                MATCH     "1",FRSTINDC
                IF        @EQUAL
                  WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,COMMA 
                ENDIF
.
                MOVE      "1",FRSTINDC
.
                WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,LCBRAC
.
                WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,SP2:
                                       QUOTE,OECLAB31,QUOTE,COLON:
                                       QUOTE,OECVAL31[FORM2],QUOTE,COMMA
.
                MATCH     SP70,OECVAL32[FORM2]
                IF        !@EQUAL
                  WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,SP2:
                                         QUOTE,OECLAB32,QUOTE,COLON:
                                         QUOTE,OECVAL32[FORM2],QUOTE,COMMA
                ENDIF
.
                MATCH     SP70,OECVAL33[FORM2]
                IF        !@EQUAL
                  CLEAR     DIM100
                  APPEND    SP10,DIM100
                  APPEND    QUOTE,DIM100
                  APPEND    OECLAB33,DIM100
                  APPEND    QUOTE,DIM100
                  APPEND    COLON,DIM100
                  APPEND    QUOTE,DIM100
                  APPEND    OECVAL33[FORM2],DIM100
                  RESET     DIM100
                  STRIP     DIM100
                  ENDSET    DIM100
                  APPEND    QUOTE,DIM100
                  APPEND    COMMA,DIM100
                  RESET     DIM100
                  WRITE     OECWFILE,SEQ;DIM100
                ENDIF
.
                MATCH     SP70,OECVAL34[FORM2]
                IF        !@EQUAL
                  WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,SP2:
                                         QUOTE,OECLAB34,QUOTE,COLON:
                                         OECVAL34[FORM2],COMMA
                ENDIF
.
                MATCH     SP70,OECVAL35[FORM2]
                IF        !@EQUAL
                  WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,SP2:
                                         QUOTE,OECLAB35,QUOTE,COLON:
                                         OECVAL35[FORM2],COMMA
                ENDIF
.
                MATCH     SP70,OECVAL36[FORM2]
                IF        !@EQUAL
                  WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,SP2:
                                         QUOTE,OECLAB36,QUOTE,COLON:
                                         QUOTE,OECVAL36[FORM2],QUOTE,COMMA
                ENDIF
.
                WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,SP2:
                                       QUOTE,OECLAB43,QUOTE,COLON:
                                       QUOTE,OECVAL43[FORM2],QUOTE
.
                WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,RCBRAC
.
              ENDIF
.
.
            DO
.
            WRITE     OECWFILE,SEQ;SP2,SP2,SP2,SP2,RSQBRAC
.
          ENDIF
.
          WRITE     OECWFILE,SEQ;SP2,SP2,SP2,RCBRAC
          WRITE     OECWFILE,SEQ;SP2,SP2,RSQBRAC
          WRITE     OECWFILE,SEQ;SP2,RCBRAC
          WRITE     OECWFILE,SEQ;RCBRAC
.
          CLOSE     OECWFILE
.
.         Move _oecw file to B2B Device oecw claims directory
.
          CLEAR     CMDLINE
          APPEND    "mv ",CMDLINE
          APPEND    OECWFLNM,CMDLINE
          APPEND    ".txt",CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    OECWFLNM,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          MATCH     "0       ",TASKID
          IF        !@EQUAL
            MOVE      "Unable to rename _oecw.txt to _oecw",ERRORDSC
            GOTO      EXTR9100
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    "chmod 777 ",CMDLINE
          APPEND    OECWFLNM,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          MATCH     "0       ",TASKID
          IF        !@EQUAL
            MOVE      "Unable to chmod 777 _oecw file.",ERRORDSC
            GOTO      EXTR9100
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    "mv ",CMDLINE
          APPEND    OECWFLNM,CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecw/.",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          MATCH     "0       ",TASKID
          IF        !@EQUAL
            MOVE      "Unable to move _oecw file to claims dir.",ERRORDSC
            GOTO      EXTR9100
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      EXTR9999
.
EXTR9100  MOVE      "1",ERRORIND
          MOVE      ONE,EXIT
.
EXTR9999  RETURN
+
.*****************************************************************************
.*                               POST0000                                    *
.*                   Post the OECW JSON to Medicare                          *
.*****************************************************************************
POST0000  CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_PRODA_run PostOECWECF ",CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/ ",CMDLINE
          APPEND    WBOCTRID,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          MATCH     "0       ",TASKID
          IF        !@EQUAL
            MOVE      "Unable to execute webPAS_PRODA PostOECWECF.",ERRORDSC
            GOTO      POST9100
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      POST9999
.
POST9100  MOVE      "1",ERRORIND
          MOVE      ONE,EXIT
.
POST9999  RETURN
+
.---------------------------------------------------------------
. Get Free Format Indicator
.---------------------------------------------------------------
FFOEC000  MOVE      ZERO,FFOECIND                * Determine if Free Format OEC
          MOVE      SP70,DIM1
          MOVE      WBOCVISN,DIM1
          REP       REPALPHA,DIM1
          MATCH     "~",DIM1
          IF        @EQUAL
            MOVE      ONE,FFOECIND
          ELSE
            PACK      KEY8,WBOCVISN,SP70
            CALL      RAPTMIS1
            IF        OVRCD=ONE
              PACK      KEY8,WBOCVISN,SP70
              CALL      RAWBELF1
              IF        OVRCD=ZERO
                MOVE      ONE,FFOECIND
                GOTO      FFOEC999
              ENDIF
.
              MATCH   SP70,WBOCELEG
              IF      !@EQUAL & !@EOS
                PACK      KEY8,WBOCELEG,SP70
                CALL      RAWBELF1
                IF        OVRCD=ZERO
                  MOVE      ONE,FFOECIND
                  GOTO      FFOEC999
                ENDIF
              ENDIF
.
            ENDIF
.
            MATCH   SP70,WBOCELEG
            IF      !@EQUAL & !@EOS
              PACK      KEY8,WBOCELEG,SP70
              CALL      RAWBELF1
              IF        OVRCD=ZERO
                MOVE      ONE,FFOECIND
                GOTO      FFOEC999
              ENDIF
            ENDIF
.
          ENDIF
.
FFOEC999  RETURN
+
.*****************************************************************************
.*                           FCMP0000              Called by: FOEV0000       *
.*           Check for a Compensable claim                                   *
.* Requires: Valid read on patmi1af for WBEFCLTY                             *
.* Returns: CLAIMFLG   0 = Not a compensable claim                           *
.*                     1 = DVA claim                                         *
.*                     2 = Workers Compensation claim                        *
.*                     3 = TAC claim                                         *
.*****************************************************************************
.
FCMP0000  MOVE      ZERO,CLAIMFLG                * initialise claim flag
.
          MATCH     SP3,WBEFCLTY                 * blank claim code ?
          GOTO      FCMP8000 IF EQUAL            * yes
.
          PACK      KEY5,ANSC,ANSL,WBEFCLTY
          CALL      RDCODE1                      * claim code found ?
          BRANCH    OVRCD,FCMP8000               * no
.
          MOVE      ZERO,FORM1                   * initialise loop count
          WHILE     FORM1 < 5
            ADD       ONE,FORM1
            LOAD      ANS,FORM1,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
            MATCH     ANSV,ANS                   * DVA claim ?
            IF        @EQUAL
              MOVE      ONE,CLAIMFLG             * yes
              GOTO      FCMP9000
            ENDIF
.
            MATCH     ANSW,ANS                   * Workers comp claim ?
            IF        @EQUAL
              MOVE      TWO,CLAIMFLG             * yes
              GOTO      FCMP9000
            ENDIF
.
            MATCH     ANSM,ANS                   * TAC claim ?
            IF        @EQUAL
              MOVE      THREE,CLAIMFLG           * yes
              GOTO      FCMP9000
            ENDIF
          DO
.
FCMP8000  MOVE      ONE,EXIT
          GOTO      FCMP9999
.
FCMP9000  MOVE      ZERO,EXIT
.
FCMP9999  RETURN
+
.*****************************************************************************
.*                           COMP0000              Called by: WOEV0000       *
.*           Check for a Compensable claim                                   *
.* Requires: Valid read on patmi1af for ACLAIM                               *
.* Returns: CLAIMFLG   0 = Not a compensable claim                           *
.*                     1 = DVA claim                                         *
.*                     2 = Workers Compensation claim                        *
.*                     3 = TAC claim                                         *
.*****************************************************************************
.
COMP0000  MOVE      ZERO,CLAIMFLG                * initialise claim flag
.
          MATCH     SP3,ACLAIM                   * blank claim code ?
          GOTO      COMP8000 IF EQUAL            * yes
.
          PACK      KEY5,ANSC,ANSL,ACLAIM
          CALL      RDCODE1                      * claim code found ?
          BRANCH    OVRCD,COMP8000               * no
.
          MOVE      ZERO,FORM1                   * initialise loop count
          WHILE     FORM1 < 5
            ADD       ONE,FORM1
            LOAD      ANS,FORM1,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
            MATCH     ANSV,ANS                   * DVA claim ?
            IF        @EQUAL
              MOVE      ONE,CLAIMFLG             * yes
              GOTO      COMP9000
            ENDIF
.
            MATCH     ANSW,ANS                   * Workers comp claim ?
            IF        @EQUAL
              MOVE      TWO,CLAIMFLG             * yes
              GOTO      COMP9000
            ENDIF
.
            MATCH     ANSM,ANS                   * TAC claim ?
            IF        @EQUAL
              MOVE      THREE,CLAIMFLG           * yes
              GOTO      COMP9000
            ENDIF
          DO
.
COMP8000  MOVE      ONE,EXIT
          GOTO      COMP9999
.
COMP9000  MOVE      ZERO,EXIT
.
COMP9999  RETURN
+
.---------------------------------------------------------------
. Clear Extract Variables
.---------------------------------------------------------------
CLOEVL00  MOVE      SP70,OECVAL03
          MOVE      SP70,OECVAL04
          MOVE      SP70,OECVAL05
          MOVE      SP70,OECVAL12
          MOVE      SP70,OECVAL06
          MOVE      SP70,OECVAL03
          MOVE      SP70,OECVAL37
          MOVE      SP70,OECVAL38
          MOVE      SP70,OECVAL40
          MOVE      SP70,OECVAL08
          MOVE      SP70,OECVAL09
          MOVE      SP70,OECVAL10
          PACK      OECVAL41,SP70,SP70,SP70
          MOVE      SP70,OECVAL39
          MOVE      SP70,OECVAL13
          MOVE      SP70,OECVAL15
          MOVE      SP70,OECVAL16
          MOVE      SP70,OECVAL17
          MOVE      SP70,OECVAL18
          MOVE      SP70,OECVAL19
          MOVE      SP70,OECVAL20
          MOVE      SP70,OECVAL21
          MOVE      SP70,OECVAL22
          MOVE      SP70,OECVAL23
          MOVE      SP70,OECVAL24
          MOVE      SP70,OECVAL25
          MOVE      SP70,OECVAL26
          MOVE      SP70,OECVAL29
          MOVE      SP70,OECVAL30
          MOVE      SP70,OECVAL41
          MOVE      SP70,OECVAL42

.
          MOVE      ZERO,FORM2
          WHILE     FORM2 < 50
            ADD       ONE,FORM2
            MOVE      SP70,OECVAL31[FORM2]
            MOVE      SP70,OECVAL32[FORM2]
            MOVE      SP70,OECVAL33[FORM2]
            MOVE      SP70,OECVAL34[FORM2]
            MOVE      SP70,OECVAL35[FORM2]
            MOVE      SP70,OECVAL36[FORM2]
            MOVE      SP70,OECVAL43[FORM2]
          DO
.
CLOEVL99  RETURN
+
.******************************************************************************
.*                             WOES0000            Called by: PROC0000        *
.*                  Populate the OES (services) variables                     *
.* Returns: EXIT   0 = no errors occurred                                     *
.*                 1 = one or more errors occurred                            *
.******************************************************************************
.
WOES0000  MOVE      ZERO,OESCOUNT                * initialise oes counter
.
          PACK      KEY14,WBOCVISN,WBOCCNTR,SP20
          CALL      RSWBOES1                     * position on visit/report
WOES0500  CALL      RKWBOES1                     * read next record
          BRANCH    OVRCD,WOES9000               * eof - finished
.
          MATCH     WBOCVISN,WBOSVISN            * same visit still ?
          GOTO      WOES9000 IF NOT EQUAL        * no - finished
.
          MATCH     WBOCCNTR,WBOSCNTR            * same report count still ?
          GOTO      WOES9000 IF NOT EQUAL        * no - finished
.
          ADD       ONE,OESCOUNT                 * increment oes count
.
.         Load claim>medicalEvent>service>id
.
          MOVE      OESCOUNT,OECVAL31[OESCOUNT]
          RJUSTIFY  OECVAL31[OESCOUNT]
          REP       " 0",OECVAL31[OESCOUNT] 
.
.         Load the ServiceCode
.
          MATCH     "6",WBOSRTYP                 * Miscellaneous charge ?
          IF        !@EQUAL
            MOVE      "Service Record Type not valid",ERRORDSC
            GOTO      WOES9100
          ENDIF
.
          CALL      GEEQ0000                     * get Eclipse equivalent
          BRANCH    EXIT,WOES9100                * error occurred
.
.         Load      claim>medicalEvent>service>dateOfService
.
          UNPACK    WBOSPDTE,CCENT,CYEAR,CMON,CDAY
          PACK      OECVAL36[OESCOUNT],CCENT,CYEAR,DASH,CMON,DASH,CDAY 
.                                                  * set DateOfService
.
.         Load      claim>medicalEvent>service>serviceQuantity
.
          MOVE      WBOSQUAN,FORM3
          IF        FORM3 > 99
            MOVE      "Service Quantity is greater than 99",ERRORDSC
            GOTO      WOES9100
          ENDIF
          MOVE      FORM3,FORM2
          MOVE      FORM2,OECVAL34[OESCOUNT]     * set ServiceQuantity
.
.         Load      claim>medicalEvent>service>serviceRate
.
WOES8000  ASSIGN    (MPATPOR+MHFPOR),FORM12P2
          MOVE      FORM12P2,DIM15
          UNPACK    DIM15,KEY5,KEY7,ANS,KEY2
          PACK      KEY9,KEY7,KEY2
.
          MATCH     "       00",KEY9
          IF        @EQUAL
            MOVE      "        0",KEY9
          ENDIF
.
          MOVE      KEY9,OECVAL35[OESCOUNT]      * set ServiceRate
.
.         Load      claim>medicalEvent>service>chargeAmount
.
          ASSIGN    ((MPATPOR+MHFPOR)*FORM2),FORM12P2
          MOVE      FORM12P2,DIM15
          UNPACK    DIM15,KEY5,KEY7,ANS,KEY2
          PACK      KEY9,KEY7,KEY2
          REP       " 0",KEY9
          MOVE      KEY9,OECVAL32[OESCOUNT]      * set ChargeAmount
.
          GOTO      WOES0500                     * get next service
.
WOES9000  MOVE      ZERO,EXIT
          GOTO      WOES9999
.
WOES9100  MOVE      ONE,EXIT
.
WOES9999  RETURN
+
.******************************************************************************
.*                                  GEEQ0000              Called by: WOES0000 *
.*                         Get the Eclipse Equivalent Code                    *
.* Requires:   WBOSITEM - Miscellaneous Charge code                           *
.*             Valid read on patmissf.                                        *
.* Returns:    EXIT  0 = EDI Equivalent code found                            *
.*                   1 = EDI Equivalent code not found                        *
.*             OECVAL33[OESCOUNT] - ServiceCode                               *
.*             OECVAL43[OESCOUNT] - ServiceCodeTypeCode                       *
.******************************************************************************
.
.         Load claim>medicalEvent>service>serviceCode
.         Load claim>medicalEvent>service>serviceCodeTypeCode
.
GEEQ0000  MOVE      ZERO,LOOPCNTR                * initialise counter
.
.         Look for a matching record in patmchgf for the item code using
.         the following criteria:
.            1. claim code, health fund/table, item code
.            2. claim code, blank health fund/table, item code
.            3. zero claim code, blank health fund/table, item code
.
          UNPACK    SP20,PTHFBCAT      * change "H/F Table" to "Table Type"
          PACK      KEY14,AFUNDH,AFNDTB,SP20
          CALL      RDFUND1            * "Table Type code" now in PTHFBCAT
.
GEEQ0500  PACK      KEY29,ACLAIM,AFUNDH,PTHFBCAT,WBOSITEM,WBOSPDTE
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      GEEQ0600 IF EQUAL
.                                           * - try a blank health fund
          PACK      KEY29,ACLAIM,SP6,SP3,WBOSITEM,WBOSPDTE
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      GEEQ0600 IF EQUAL
.                                           * - last chance, try default Claim
          PACK      KEY29,PTCNDCLM,SP6,SP3,WBOSITEM,WBOSPDTE
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      GEEQ1000 IF NOT EQUAL   * Invalid - issue message
.
.                           * process the valid Item
GEEQ0600
          MATCH     SP11,PTMCECEQ              * blank Eclipse equivalent ?
          IF        @EQUAL
            PACK      DIM11,MCHARGE,SP20       * yes - use charge code
          ELSE
            MOVE      PTMCECEQ,DIM11           * no - use Eclipse equiv.
          ENDIF
.
.           If this is a DVA claim, then simply send the item code as it
.           has been entered.
.
          IF        CLAIMFLG = 1
            STRIP     DIM11
            MOVELPTR  DIM11,FORM2
            IF        FORM2 > 5
              MOVE      "Misc. Charge code (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    DIM11,ERRORDSC
              APPEND    ") more than 5 characters in length",ERRORDSC
              RESET     ERRORDSC
              GOTO      GEEQ9500
            ENDIF
            PACK      DIM11,DIM11,SP20
            MOVE      DIM11,OECVAL33[OESCOUNT]
            MOVE      ANSM,OECVAL43[OESCOUNT]
            GOTO      GEEQ9100
          ENDIF
.
.           This is not a DVA claim, so check if the Type of Service is set
.           to a valid value
.
          MOVE      ZERO,FORM2
          MOVE      PTMCECTS,FORM2
          BRANCH    FORM2,GEEQ1100:            * external aid/prosthetics
                          GEEQ1200:            * cosmetics
                          GEEQ1300:            * dental
                          GEEQ1400:            * drugs
                          GEEQ1500:            * disposables
                          GEEQ1600:            * exceptional drug list
                          GEEQ1700:            * other - clinic
                          GEEQ1800:            * other - home
                          GEEQ1900:            * other
                          GEEQ2000:            * psych - clinic
                          GEEQ2100:            * psych - home
                          GEEQ2200:            * psych
                          GEEQ2300:            * c'wealth prosthetics
                          GEEQ2400:            * rehab - clinic
                          GEEQ2500:            * rehab - home
                          GEEQ2600             * rehab
.
.         Valid miscellaneous charge record not found
.
GEEQ1000  MOVE      "Misc. Charge code (",ERRORDSC
          ENDSET    ERRORDSC
          APPEND    WBOSITEM,ERRORDSC
          APPEND    ") record not found with Eclipse Equivalent",ERRORDSC
          RESET     ERRORDSC
          GOTO      GEEQ9500
.
.         External Aid/Prosthetics
.
GEEQ1100  PACK      OECVAL33[OESCOUNT],ANSA,ANSP
          MOVE      ANSP,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Cosmetics
.
GEEQ1200  PACK      OECVAL33[OESCOUNT],ANSC,ANSM
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Dental
.
GEEQ1300  PACK      OECVAL33[OESCOUNT],ANSD,ANSE
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Drugs
.
GEEQ1400  PACK      OECVAL33[OESCOUNT],ANSD,ANSR
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Disposables
.
GEEQ1500  PACK      OECVAL33[OESCOUNT],ANSD,ANSS
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Exceptional Drug List
.
GEEQ1600  PACK      OECVAL33[OESCOUNT],ANSD,ANSX
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Other - Clinic
.
GEEQ1700  PACK      OECVAL33[OESCOUNT],ANSO,ANSC
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Other - Home
.
GEEQ1800  PACK      OECVAL33[OESCOUNT],ANSO,ANSH
          MOVE      ANSP,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Other
.
GEEQ1900  PACK      OECVAL33[OESCOUNT],ANSO,ANST
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Psych - Clinic
.
GEEQ2000  PACK      OECVAL33[OESCOUNT],ANSP,ANSC
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Psych - Home
.
GEEQ2100  PACK      OECVAL33[OESCOUNT],ANSP,ANSH
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Psych
.
GEEQ2200  PACK      OECVAL33[OESCOUNT],ANSP,ANSS
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         C'Wealth Prosthetics
.
GEEQ2300  PACK      OECVAL33[OESCOUNT],ANSP,ANSX
          MOVE      ANSP,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Rehab - Clinic
.
GEEQ2400  PACK      OECVAL33[OESCOUNT],ANSR,ANSC
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Rehab - Home
.
GEEQ2500  PACK      OECVAL33[OESCOUNT],ANSR,ANSH
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Rehab
.
GEEQ2600  PACK      OECVAL33[OESCOUNT],ANSR,ANSE
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      GEEQ9000
.
.         Finish formatting ServiceCode
.
GEEQ9000  ENDSET    OECVAL33[OESCOUNT]
          APPEND    "00",OECVAL33[OESCOUNT]      * set default health provider
          APPEND    DIM11,OECVAL33[OESCOUNT]
          RESET     OECVAL33[OESCOUNT]
          STRIP     OECVAL33[OESCOUNT]
          ENDSET    OECVAL33[OESCOUNT]
.
          IF        FORM2 = 6 | FORM2 = 7 | FORM2 = 9
            APPEND    ANSN,OECVAL33[OESCOUNT]    * set default session type
          ENDIF
          APPEND    SP20,OECVAL33[OESCOUNT]
          RESET     OECVAL33[OESCOUNT]
.
GEEQ9100  MOVE      ZERO,EXIT
          GOTO      GEEQ9999
.
GEEQ9500  MOVE      ONE,EXIT
.
GEEQ9999  RETURN
+
.******************************************************************************
.*                             FOES0000            Called by: PROC0000        *
.*                  Write the OES (services) segment                          *
.* Returns: EXIT   0 = no errors occurred                                     *
.*                 1 = one or more errors occurred                            *
.******************************************************************************
.
FOES0000  MOVE      ZERO,OESCOUNT                * initialise oes counter
.
          PACK      KEY14,WBOCVISN,WBOCCNTR,SP20
          CALL      RSWBOES1                     * position on visit/report
FOES0500  CALL      RKWBOES1                     * read next record
          BRANCH    OVRCD,FOES9000               * eof - finished
.
          MATCH     WBOCVISN,WBOSVISN            * same visit still ?
          GOTO      FOES9000 IF NOT EQUAL        * no - finished
.
          MATCH     WBOCCNTR,WBOSCNTR            * same report count still ?
          GOTO      FOES9000 IF NOT EQUAL        * no - finished
.
          ADD       ONE,OESCOUNT                 * increment oes count
.
.         Load claim>medicalEvent>service>id
.
          MOVE      OESCOUNT,OECVAL31[OESCOUNT]
          RJUSTIFY  OECVAL31[OESCOUNT]
          REP       " 0",OECVAL31[OESCOUNT]
.
.         Load the ServiceCode
.
          MATCH     "6",WBOSRTYP                 * Miscellaneous charge ?
          IF        !@EQUAL
            MOVE      "Service Record Type not valid",ERRORDSC
            GOTO      FOES9100
          ENDIF
.
          CALL      FEEQ0000                     * get Eclipse equivalent
          BRANCH    EXIT,FOES9100                * error occurred
.
.         Load      claim>medicalEvent>service>dateOfService
.
          UNPACK    WBOSPDTE,CCENT,CYEAR,CMON,CDAY
          PACK      OECVAL36[OESCOUNT],CCENT,CYEAR,DASH,CMON,DASH,CDAY
.                                                  * set DateOfService
.
.         Load      claim>medicalEvent>service>serviceQuantity
.
          MOVE      WBOSQUAN,FORM3
          IF        FORM3 > 99
            MOVE      "Service Quantity is greater than 99",ERRORDSC
            GOTO      FOES9100
          ENDIF
          MOVE      FORM3,FORM2
          MOVE      FORM2,OECVAL34[OESCOUNT]     * set ServiceQuantity
.
.         Load      claim>medicalEvent>service>serviceRate
.
          ASSIGN    (MPATPOR+MHFPOR),FORM12P2
          MOVE      FORM12P2,DIM15
          UNPACK    DIM15,KEY5,KEY7,ANS,KEY2
          PACK      KEY9,KEY7,KEY2
.
          MATCH     "       00",KEY9
          IF        @EQUAL
            MOVE      "        0",KEY9
          ENDIF
.
          MOVE      KEY9,OECVAL35[OESCOUNT]      * set ServiceRate
.
.         Load      claim>medicalEvent>service>chargeAmount
.
          ASSIGN    ((MPATPOR+MHFPOR)*FORM2),FORM12P2
          MOVE      FORM12P2,DIM15
          UNPACK    DIM15,KEY5,KEY7,ANS,KEY2
          PACK      KEY9,KEY7,KEY2
          REP       " 0",KEY9
          MOVE      KEY9,OECVAL32[OESCOUNT]      * set ChargeAmount
.
          GOTO      FOES0500                     * get next service
.
FOES9000  MOVE      ZERO,EXIT
          GOTO      FOES9999
.
FOES9100  MOVE      ONE,EXIT
.
FOES9999  RETURN
+
.******************************************************************************
.*                                  FEEQ0000              Called by: FOES0000 *
.*                         Get the Eclipse Equivalent Code                    *
.* Requires:   PMOSITEM - Miscellaneous Charge code                           *
.* Returns:    EXIT  0 = EDI Equivalent code found                            *
.*                   1 = EDI Equivalent code not found                        *
.*             OECVAL33[OESCOUNT] - ServiceCode                               *
.*             OECVAL43[OESCOUNT] - ServiceCodeTypeCode                       *
.******************************************************************************
.
.         Load claim>medicalEvent>service>serviceCode
.         Load claim>medicalEvent>service>serviceCodeTypeCode
.
FEEQ0000  MOVE      ZERO,LOOPCNTR                * initialise counter
.
.         Look for a matching record in patmchgf for the item code using
.         the following criteria:
.            1. claim code, health fund/table, item code
.            2. claim code, blank health fund/table, item code
.            3. zero claim code, blank health fund/table, item code
.
          UNPACK    SP20,PTHFBCAT      * change "H/F Table" to "Table Type"
          PACK      KEY14,WBEFHFND,WBEFHFNT,SP20
          CALL      RDFUND1            * "Table Type code" now in PTHFBCAT
.
FEEQ0500  PACK      KEY29,WBEFCLTY,WBEFHFND,PTHFBCAT,WBOSITEM,WBOSPDTE
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      FEEQ0600 IF EQUAL
.                                           * - try a blank health fund
          PACK      KEY29,WBEFCLTY,SP6,SP3,WBOSITEM,WBOSPDTE
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      FEEQ0600 IF EQUAL
.                                           * - last chance, try default Claim
          PACK      KEY29,PTCNDCLM,SP6,SP3,WBOSITEM,WBOSPDTE
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      FEEQ1000 IF NOT EQUAL   * Invalid - issue message
.
.                           * process the valid Item
FEEQ0600
          MATCH     SP11,PTMCECEQ              * blank Eclipse equivalent ?
          IF        @EQUAL
            PACK      DIM11,MCHARGE,SP20       * yes - use charge code
          ELSE
            MOVE      PTMCECEQ,DIM11           * no - use Eclipse equiv.
          ENDIF
.
.           If this is a DVA claim, then simply send the item code as it
.           has been entered.
.
          IF        CLAIMFLG = 1
            STRIP     DIM11
            MOVELPTR  DIM11,FORM2
            IF        FORM2 > 5
              MOVE      "Misc. Charge code (",ERRORDSC
              ENDSET    ERRORDSC
              APPEND    DIM11,ERRORDSC
              APPEND    ") more than 5 characters in length",ERRORDSC
              RESET     ERRORDSC
              GOTO      FEEQ9500
            ENDIF
            PACK      DIM11,DIM11,SP20
            MOVE      DIM11,OECVAL33[OESCOUNT]
            MOVE      ANSM,OECVAL43[OESCOUNT]
            GOTO      FEEQ9100
          ENDIF
.
.           This is not a DVA claim, so check if the Type of Service is set
.           to a valid value
.
          MOVE      ZERO,FORM2
          MOVE      PTMCECTS,FORM2
          BRANCH    FORM2,FEEQ1100:            * external aid/prosthetics
                          FEEQ1200:            * cosmetics
                          FEEQ1300:            * dental
                          FEEQ1400:            * drugs
                          FEEQ1500:            * disposables
                          FEEQ1600:            * exceptional drug list
                          FEEQ1700:            * other - clinic
                          FEEQ1800:            * other - home
                          FEEQ1900:            * other
                          FEEQ2000:            * psych - clinic
                          FEEQ2100:            * psych - home
                          FEEQ2200:            * psych
                          FEEQ2300:            * c'wealth prosthetics
                          FEEQ2400:            * rehab - clinic
                          FEEQ2500:            * rehab - home
                          FEEQ2600             * rehab
.
.         Valid miscellaneous charge record not found
.
FEEQ1000  MOVE      "Misc. Charge code (",ERRORDSC
          ENDSET    ERRORDSC
          APPEND    WBOSITEM,ERRORDSC
          APPEND    ") record not found with Eclipse Equivalent",ERRORDSC
          RESET     ERRORDSC
          GOTO      FEEQ9500
.
.         External Aid/Prosthetics
.
FEEQ1100  PACK      OECVAL33[OESCOUNT],ANSA,ANSP
          MOVE      ANSP,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Cosmetics
.
FEEQ1200  PACK      OECVAL33[OESCOUNT],ANSC,ANSM
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Dental
.
FEEQ1300  PACK      OECVAL33[OESCOUNT],ANSD,ANSE
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Drugs
.
FEEQ1400  PACK      OECVAL33[OESCOUNT],ANSD,ANSR
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Disposables
.
FEEQ1500  PACK      OECVAL33[OESCOUNT],ANSD,ANSS
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Exceptional Drug List
.
FEEQ1600  PACK      OECVAL33[OESCOUNT],ANSD,ANSX
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Other - Clinic
.
FEEQ1700  PACK      OECVAL33[OESCOUNT],ANSO,ANSC
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Other - Home
.
FEEQ1800  PACK      OECVAL33[OESCOUNT],ANSO,ANSH
          MOVE      ANSP,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Other
.
FEEQ1900  PACK      OECVAL33[OESCOUNT],ANSO,ANST
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Psych - Clinic
.
FEEQ2000  PACK      OECVAL33[OESCOUNT],ANSP,ANSC
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Psych - Home
.
FEEQ2100  PACK      OECVAL33[OESCOUNT],ANSP,ANSH
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Psych
.
FEEQ2200  PACK      OECVAL33[OESCOUNT],ANSP,ANSS
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         C'Wealth Prosthetics
.
FEEQ2300  PACK      OECVAL33[OESCOUNT],ANSP,ANSX
          MOVE      ANSP,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Rehab - Clinic
.
FEEQ2400  PACK      OECVAL33[OESCOUNT],ANSR,ANSC
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Rehab - Home
.
FEEQ2500  PACK      OECVAL33[OESCOUNT],ANSR,ANSH
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Rehab
.
FEEQ2600  PACK      OECVAL33[OESCOUNT],ANSR,ANSE
          MOVE      ANSM,OECVAL43[OESCOUNT]
          GOTO      FEEQ9000
.
.         Finish formatting ServiceCode
.
FEEQ9000  ENDSET    OECVAL33[OESCOUNT]
          APPEND    "00",OECVAL33[OESCOUNT]      * set default health provider
          APPEND    DIM11,OECVAL33[OESCOUNT]
          RESET     OECVAL33[OESCOUNT]
          STRIP     OECVAL33[OESCOUNT]
          ENDSET    OECVAL33[OESCOUNT]
.
          IF        FORM2 = 6 | FORM2 = 7 | FORM2 = 9
            APPEND    ANSN,OECVAL33[OESCOUNT]    * set default session type
          ENDIF
          APPEND    SP20,OECVAL33[OESCOUNT]
          RESET     OECVAL33[OESCOUNT]
.
FEEQ9100  MOVE      ZERO,EXIT
          GOTO      FEEQ9999
.
FEEQ9500  MOVE      ONE,EXIT
.
FEEQ9999  RETURN
+
.*****************************************************************************
.*                              CONC0000           Called by: WPAT0000       *
.*     See if the patient has concession card of DVA type on file            *
.* Requires: PURNO - U/R number                                              *
.* Returns:  EXIT  0 = valid concession card found                           *
.*                 1 = no valid concession card found                        *
.*           DIM20 - Concession Card Number                                  *
.*****************************************************************************
.
CONC0000  MOVE      SP70,DIM20
          PACK      KEY19,PURNO,TILDA40
          CALL      RSPMCCD1                     * position on U/R
CONC0500  CALL      RPPMCCD1                     * read previous record
          BRANCH    OVRCD,CONC9100               * eof - nothing found
.
          MATCH     PURNO,PMCDURNO               * same U/R still ?
          GOTO      CONC9100 IF NOT EQUAL        * no - nothing found
.
.         Check if the card type is DVA (Cat ct, Indicator 1)
.
          PACK      KEY5,CATCT,PMCDCTYP
          CALL      RDCODE1                      * code on file ?
          BRANCH    OVRCD,CONC0500               * no - ignore record
.
          MATCH     SP1,TCINDC1                  * blank indicator 1 ?
          GOTO      CONC0500 IF EQUAL            * yes - ignore record
.
          TYPE      TCINDC1                      * numeric indicator 1 ?
          GOTO      CONC0500 IF NOT EQUAL        * no - ignore record
.
          MATCH     "3",TCINDC1                  * DVA card type ?
          GOTO      CONC0500 IF NOT EQUAL        * no - ignore record
.
.         A DVA concession card has been found, so check
.         if there is an expiry date
.
          MATCH     SP8,PMCDEXDT                 * expiry date blank ?
          GOTO      CONC1000 IF EQUAL            * yes - assume valid
.
.         There is an expiry date for the card, so check that the
.         card is current
.
          CALL      IBACLOCK
          PACK      DIM8,CCC,CYY,CMM,CDD
          REP       " 0",DIM8
.
          MATCH     DIM8,PMCDEXDT                * card valid for date ?
          GOTO      CONC9100 IF LESS             * no - nothing found
.
.         Concession card is current
.
CONC1000  MATCH     SP20,PMCDCNUM                * card number blank ?
          GOTO      CONC9100 IF EQUAL            * yes - nothing found
.
          MOVE      PMCDCNUM,DIM20               * load concession card number
.
          MOVE      ZERO,EXIT
          GOTO      CONC9999
.
CONC9100  MOVE      ONE,EXIT
.
CONC9999  RETURN
+
.*****************************************************************************
.*                              FCNC0000           Called by: WPAT0000       *
.*     See if the patient has concession card of DVA type on file            *
.* Requires: WBEFURNO - U/R number                                           *
.* Returns:  EXIT  0 = valid concession card found                           *
.*                 1 = no valid concession card found                        *
.*           DIM20 - Concession Card Number                                  *
.*****************************************************************************
.
FCNC0000  MOVE      SP70,DIM20
          MATCH     SP70,WBEFURNO
          GOTO      FCNC9100 IF EQUAL
          GOTO      FCNC9100 IF EOS
.
          PACK      KEY19,WBEFURNO,TILDA40
          CALL      RSPMCCD1                     * position on U/R
FCNC0500  CALL      RPPMCCD1                     * read previous record
          BRANCH    OVRCD,FCNC9100               * eof - nothing found
.
          MATCH     WBEFURNO,PMCDURNO               * same U/R still ?
          GOTO      FCNC9100 IF NOT EQUAL        * no - nothing found
.
.         Check if the card type is DVA (Cat ct, Indicator 1)
.
          PACK      KEY5,CATCT,PMCDCTYP
          CALL      RDCODE1                      * code on file ?
          BRANCH    OVRCD,FCNC0500               * no - ignore record
.
          MATCH     SP1,TCINDC1                  * blank indicator 1 ?
          GOTO      FCNC0500 IF EQUAL            * yes - ignore record
.
          TYPE      TCINDC1                      * numeric indicator 1 ?
          GOTO      FCNC0500 IF NOT EQUAL        * no - ignore record
.
          MATCH     "3",TCINDC1                  * DVA card type ?
          GOTO      FCNC0500 IF NOT EQUAL        * no - ignore record
.
.         A DVA concession card has been found, so check
.         if there is an expiry date
.
          MATCH     SP8,PMCDEXDT                 * expiry date blank ?
          GOTO      FCNC1000 IF EQUAL            * yes - assume valid
.
.         There is an expiry date for the card, so check that the
.         card is current
.
          CALL      IBACLOCK
          PACK      DIM8,CCC,CYY,CMM,CDD
          REP       " 0",DIM8
.
          MATCH     DIM8,PMCDEXDT                * card valid for date ?
          GOTO      FCNC9100 IF LESS             * no - nothing found
.
.         Concession card is current
.
FCNC1000  MATCH     SP20,PMCDCNUM                * card number blank ?
          GOTO      FCNC9100 IF EQUAL            * yes - nothing found
.
          MOVE      PMCDCNUM,DIM20               * load concession card number
.
          MOVE      ZERO,EXIT
          GOTO      FCNC9999
.
FCNC9100  MOVE      ONE,EXIT
.
FCNC9999  RETURN
+
.---------------------------------------------------------------
. Clear Parameters (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
CLRPAR00  RETURN 
.---------------------------------------------------------------
. Set Parameters   (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
SETPAR00  RETURN
.---------------------------------------------------------------
. Process Fields   (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
PROFLD00  RETURN
.------------------------------------------------------------
+
          INC       IBAWEBCD
.
          INC       CLPMSVX1
          INC       CLPATDSC
          INC       DXPATCOD
          INC       GCCARD00
          INC       GTIHINUM
          INC       NAMSTRCD
          INC       WEBDITEM
          INC       WEBBGRND
.
          INC       PATMCHRD
.
          INC       APSMASIO/INC
          INC       EMRCHMAN
          INC       EMRLPCIO/INC
          INC       EMRLOCIO/INC
          INC       EMRSITIO/INC
          INC       EMRVISIO/INC
          INC       EMRCLIIO/INC
          INC       EMRGRCIO/INC
          INC       EMRPROIO/INC                                       *I-50421
          INC       EMRUNKIO/INC
          INC       IBATMDIO/INC
          INC       MEHDLSIO/INC
          INC       NHIETHIO/INC
          INC       NHIMASIO/INC
          INC       PATGO1IO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCGIO/INC
          INC       AAEDE1IO/INC    *****
          INC       PATALRIO/INC
          INC       PMSALNIO/INC
          INC       PMSRELIO/INC
          INC       PMSTLEIO/INC
          INC       PMSHCPTM
          INC       PMSHCGTM 
          INC       AAESETLB        *****
          INC       OPRNURIO/INC
          INC       PRIITMIO/INC
          INC       PATITMIO/INC                                       *I-50421
          INC       PATICOIO/INC                                       *I-50421
          INC       PATICDIO/INC                                       *I-50421
          INC       PATNIDIO/INC
          INC       PATVISIO/INC
          INC       PMSVX1IO/INC                                       *I-55214
          INC       PATDO1IO/INC
          INC       PATDDHIO/INC
          INC       PATHSPIO/INC
          INC       PATIN1IO/INC
          INC       PMSCCDIO/INC
          INC       PMSCEXIO/INC
          INC       PMSIHIIO/INC
          INC       PMSMDTIO/INC
          INC       PMSMTXIO/INC
          INC       PMSPX2IO/INC
          INC       PATDSCIO/INC
          INC       PATELGIO/INC
          INC       PATFN1IO/INC
          INC       PATFX1IO/INC
          INC       PATMA1IO/INC
          INC       PATMCHIO/INC
          INC       PATMI1IO/INC
          INC       PATRE1IO/INC
          INC       PATWC1IO/INC
          INC       PMSWX1IO/INC 
          INC       PATWMAIO/INC
          INC       PATWR1IO/INC
          INC       PATWVEIO/INC
          INC       PATVADIO/INC
.
          INC       PATATRIO/INC
          INC       MULBIR00
.
          INC       SCRPSTIO/INC
          INC       SCRSBGIO/INC
          INC       SCRSLTIO/INC
          INC       SCRMASIO/INC

.
          INC       EOCLNKIO/INC
          INC       EOCREFIO/INC
          INC       EMRISMIO/INC
          INC       EMRINCIO/INC
          INC       EMRWFMIO/INC
          INC       EMRVCDIO/INC
          INC       EMRMTXIO/INC
          INC       EMRVPRIO/INC
          INC       VISCMTIO/INC
          INC       VISCODIO/INC
          INC       VISMTXIO/INC
          INC       VISMDTIO/INC
          INC       VISXDCIO/INC
          INC       EMRMANIO/INC
          INC       OBSDETIO/INC                                       *I-54627
          INC       OBSMTXIO/INC
          INC       OBSMDTIO/INC
          INC       EMRDCMIO/INC   
          INC       EMRHISIO/INC 
          INC       EMRICDIO/INC 
          INC       PATHGPIO/INC
          INC       WEBB2BIO/INC
          INC       WEBOECIO/INC
          INC       WEBOESIO/INC
          INC       WEBELFIO/INC
          INC       WEBPARIO/INC
          

          INC       PATDOCTM
          INC       PATITMRD
          INC       PATDDHRD
.
          INC       PACADDRS
          INC       PMIGTNID
          INC       PMSCEXCD
          INC       CALCAGE
          INC       CALCYRS
          INC       AGECHK
          INC       PATDOCCD
          INC       CLPATMAS
          INC       CLPMSCEX
          INC       CLPMSHCP
          INC       CLPMSPX2
          INC       CLEMRVIS                                          *I-153218
          INC       CLPATVIS                                          *I-153218
          INC       DAYOFWEK
          INC       SGCHKDIG
          INC       GETALTID
          INC       TFILENAM
.

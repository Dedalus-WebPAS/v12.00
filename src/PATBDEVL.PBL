.******************************************************************************
.* Validate Billing Default effective from and to dates for overlaps          *
.*                                                                            *
.* Requires:   KEY58 populated with -                                         *
.*                      - Hospital Id                                         *
.*                      - Claim Type                                          *
.*                      - Health Fund                                         *
.*                      - H/F Table Type                                      *
.*                      - Value Set Id                                        *
.*                      - Effective Start Date                                *
.*             VALFDATE - Effective date from date                            *
.*             VALTDATE - Effective date to date                              *
.*                                                                            *
.* Returns:    EXIT  0 = Valid Billing Default effective from and to dates    *
.*                   1 = Invalid Billing Default effective from and to dates  *
.* Modifications  :                                                           *
.* V11.05.01 27/03/2022 Alina Bhari    Task 0957676                           *
.*           Updated the prior record with End-dated 1 day before the new     *
.*           Start date, if there is a previous record with a prior Effective *
.*           Start Date - FLAGLEFD,EDAT8000,EDAT1000                          *
.******************************************************************************
.
VBDDT000  MOVE      KEY58,SAVKEY50
          MOVE      ZERO,FLAGLEFD
.
          CALL      RDPTBDE1                * Record on file so must be an
          BRANCH    OVRCD,VBDDT500          * update
.
          MATCH     VALTDATE,PTBEEDTE       * No change in effective from and
          GOTO      VBDDT800 IF EQUAL       * to dates so exit
.
VBDDT500  CALL      RSPTBDE1                * Check for the same Billing Default
          CALL      RPPTBDE1                * with an earlier effective from
          BRANCH    OVRCD,VBDDT600          * date
.
          PACK      KEY50,PTBEHOSP,PTBECLMC,PTBEHFND,PTBEHFTB,PTBEVSID,SP20
          MATCH     SAVKEY50,KEY50
          GOTO      VBDDT600 IF NOT EQUAL
.
          MATCH     SP70,PTBEEDTE           * No effective to date on previous
          GOTO      VBDDT800 IF EQUAL       * Billing Default.
.
          MATCH     VALFDATE,PTBEEDTE
          IF        !@LESS
             MOVE     ONE,FLAGLEFD
.            GOTO      VBDDT900              * Effective from date overlap
          ENDIF
.
          MATCH     SP70,VALTDATE           * Blank effective to date
          GOTO      VBDDT600 IF EQUAL
.
          MATCH     VALTDATE,PTBEEDTE
          IF        !@LESS
            MOVE     ONE,FLAGLEFD
.            GOTO      VBDDT900              * Effective to date overlap
          ENDIF
.
VBDDT600  CALL      RSPTBDE1                * Check for the same Billing Default
          CALL      RKPTBDE1                * with an earlier effective from
          BRANCH    OVRCD,VBDDT800          * date
.
          PACK      KEY50,PTBEHOSP,PTBECLMC,PTBEHFND,PTBEHFTB,PTBEVSID,SP20
          MATCH     SAVKEY50,KEY50
          GOTO      VBDDT800 IF NOT EQUAL
.
          MATCH     SP70,VALTDATE           * Blank effective to date
          IF        @EQUAL
            MOVE     ONE,FLAGLEFD
          ENDIF
.          GOTO      VBDDT900 IF EQUAL
.
          MATCH     PTBESDTE,VALFDATE
          IF        !@LESS
            GOTO      VBDDT900              * Effective from date overlap
          ENDIF
.
          MATCH     PTBESDTE,VALTDATE
          IF        !@LESS
            GOTO      VBDDT900              * Effective to date overlap
          ENDIF
.
VBDDT800  MOVE      ZERO,EXIT
          GOTO      VBDDT999
.
VBDDT900  MOVE      ONE,EXIT
          GOTO      VBDDT9999
.
VBDDT999  RETURN

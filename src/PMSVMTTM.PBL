.-----------------------------------------------------------------------
.
.     Include Name : PMSVMTTM.INC
.
.     Function     : File Definition include for Patient System
.                    Clinical Codes Value Mapping
.
.     Modifications:
.     V10.11.00  14/11/2017  Don Nguyen     TSK 0816814
.                Created Include
.
.------------------------------------------------------------
.   Clear work variables for PMSVMTTD
.------------------------------------------------------------
CPVSM000  MOVE      SP70,PTVMT001
          MOVE      SP70,PTVMT002
          MOVE      SP70,PTVMT003
          MOVE      SP70,PTVMT004
          MOVE      SP70,PTVMT005
          MOVE      SP70,MAPTBNAM
          MOVE      SP70,MAPTBIND
          MOVE      SP70,MAPTBVSI
.
CPVSM999  RETURN
+
.-----------------------------------------------------------
. Initialize's file data (Clinical Codes Value Mapping)
.-----------------------------------------------------------
CLRVMT00  MOVE      SP70,PMVMTNAM
          MOVE      SP70,PMVMTIDX
          MOVE      SP70,PMVMMVSI
          MOVE      SP70,PMVMMCOD
          MOVE      SP70,PMVMMDES
.
CLRVMT99  RETURN
+
.-----------------------------------------------------------
. Save input variables to file variables
.-----------------------------------------------------------
VMTSAV00  MOVE      PTVMT001,PMVMTNAM
          MOVE      PTVMT002,PMVMTIDX
          MOVE      PTVMT003,PMVMMVSI
          MOVE      PTVMT004,PMVMMCOD
          MOVE      PTVMT005,PMVMMDES
.
VMTSAV99  RETURN
+
.-----------------------------------------------------------
. Set parameters
.-----------------------------------------------------------
STVMT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STVMT001,STVMT002,STVMT003,STVMT004,STVMT005
.
          GOTO      STVMT999
.
STVMT001  MOVE      QRYDATA,PTVMT001
          PACK      PTVMT001,PTVMT001,SP70
          GOTO      STVMT999
.
STVMT002  MOVE      QRYDATA,PTVMT002
          PACK      PTVMT002,PTVMT002,SP70
          GOTO      STVMT999
.
STVMT003  MOVE      QRYDATA,PTVMT003
          PACK      PTVMT003,PTVMT003,SP70
          GOTO      STVMT999
.
STVMT004  MOVE      QRYDATA,PTVMT004
          GOTO      STVMT999
.
STVMT005  MOVE      QRYDATA,PTVMT005
          GOTO      STVMT999
.
STVMT999  RETURN
+
.-----------------------------------------------------------
.  Value Set ID Codes Maintenance
.------------------------------------------------------------
VMPD0000  BRANCH    FLDITMNO,VMPD0100,VMPD0200,VMPD0300,VMPD0400,VMPD0500:
                             VMPD0600,VMPD0700,VMPD0800,VMPD0900
          GOTO      VMPD9999
.
VMPD0100  WRITE     HTMLFILE;PMVMTNAM;      * Table Name
          GOTO      VMPD9999
.
VMPD0200  WRITE     HTMLFILE;PMVMTIDX;      * Table Index Value
          GOTO      VMPD9999
.
VMPD0300  WRITE     HTMLFILE;PMVMMVSI;      * Map to Value Set ID
          GOTO      VMPD9999
.
VMPD0400  WRITE     HTMLFILE;PMVMMCOD;      * Map to Code
          GOTO      VMPD9999
.
VMPD0500  WRITE     HTMLFILE;PMVMMDES;      * Map to Description
          GOTO      VMPD9999
.
VMPD0600  WRITE     HTMLFILE;MAPTBNAM;      * Mapping Table Name
          GOTO      VMPD9999
.
VMPD0700  WRITE     HTMLFILE;MAPTBIND;      * Mapping Table Index Value
          GOTO      VMPD9999
.
VMPD0800  WRITE     HTMLFILE;MAPTBVSI;      * Mapping Value Set ID
          GOTO      VMPD9999
.
VMPD0900  PACK      KEY3,PMVMMVSI,SP70
          CALL      RDPMVST1
          IF        OVRCD=0
            WRITE     HTMLFILE;PMVTVSNM;    * Value Set ID Name
          ENDIF
          GOTO      VMPD9999
.
VMPD9999  RETURN
+
.-----------------------------------------------------------
.  Clinical Coding System Mappings Table
.------------------------------------------------------------
VMTTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          UNPACK    DIM127,D1,MAPTBNAM,DIM127
.
          PACK      MAPTBIND,MAPTBIND,SP70
.
          PACK      KEY41,MAPTBNAM,MAPTBIND,SP70
          CALL      RSPMVMT1
VMTTAB10  CALL      RKPMVMT1
          BRANCH    OVRCD,VMTTAB99
.
          MATCH     PMVMTNAM,MAPTBNAM
          GOTO      VMTTAB99 IF NOT EQUAL
.
          MATCH     PMVMTIDX,MAPTBIND
          GOTO      VMTTAB99 IF NOT EQUAL
.
          MOVE      "Unknown",KEY50
          PACK      KEY3,PMVMMVSI,SP70
          CALL      RDPMVST1
          IF        OVRCD=0
            MOVE      PMVTVSNM,KEY50
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                               "<td nowrap><a href='javascript:ShowDetail50(":
                               "#"",*+,PMVMTNAM,*-,"#",":
                               "#"",*+,PMVMTIDX,*-,"#",":
                               "#"",*+,PMVMMVSI,*-,"#");'>":
                               "<img src='../images/MaintenanceIcon.gif'":
                               " hspace=4 border=0 align=absmiddle></a>":
                               KEY50,"</td>":
                               "<td>&nbsp;",PMVMMCOD,"</td>":
                               "<td>&nbsp;",PMVMMDES,"</td>":
                             "</tr>"
.
          GOTO      VMTTAB10
.
VMTTAB99  RETURN
+
.------------------------------------------------------------------------------
.  Delete Clinical Coding System Mappings for the matching Table Name/Index
.------------------------------------------------------------------------------
DELCSM00  PACK      MAPTBNAM,MAPTBNAM,SP70
          PACK      MAPTBIND,MAPTBIND,SP70
.
DELCSM05  PACK      KEY41,MAPTBNAM,MAPTBIND,SP70
          CALL      RSPMVMT1
          CALL      RKPMVMT1
          BRANCH    OVRCD,DELCSM99
.
          MATCH     PMVMTNAM,MAPTBNAM
          GOTO      DELCSM99 IF NOT EQUAL
.
          MATCH     PMVMTIDX,MAPTBIND
          GOTO      DELCSM99 IF NOT EQUAL
.
          PACK      KEY41,PMVMTNAM,PMVMTIDX,PMVMMVSI,SP70
          CALL      RDPMVMT1
          IF        OVRCD=0
            CALL      DEPMVMT1
          ENDIF
.
          CALL      DELCSM05
.
DELCSM99  RETURN
+
.------------------------------------------------------------

.******************************************************************************
.* System         : Waiting Lists           Release 5.01                      *
.*                                                                            *
.* Include Name   : DXWATTRE.PBL                                              *
.*                                                                            *
.* Function       : To display the values from WATTR1FD                       *
.*                                                                            *
.* Author         : ROD           04/12/92                                    *
.*                                                                            *
.* Parameters     : WATTR1FD record for the data to display                   *
.*                  SCRSPTFD/SCRSBGFD records                                 *
.*                                                                            *
.* Includes Req'd : DXPATCOD      display a field from patcodfd               *
.*                                                                            *
.* Modifications  :                                                           *
.*        V10.13.02 05/11/2018  Richa Phogat     TSK 0864090                  *
.*                  Updated condition under DWTTR073                          *
.*        V10.13.01 30/10/2018  Richa Phogat     TSK 0864090                  *
.*                  Added DWTTR073 - ACC Number/Insurance Claim Number        *
.*        V10.12.01 20/04/2018  Peter Vela       TSK 0855360                  *
.*                  Added WMBOOK                                              *
.*        V5.09.B01 11/01/2001  Greg Horvat                                   *
.*                  Replaced STATDES with a KEY variable                      *
.*                  07/08/2000  Steve Downing  SRF 647108                     *
.*                  Fixed branch to DWTTR071 - PHSP description               *
.*                  13/06/2000  J Habasque                                    *
.*                  Added WTWMDOSA,WTWMDRSA,WTWMPHSP                          *
.*                  12/08/99    J.Tan                                         *
.*                  Added  source of referral                                 *
.*                                                                            *
.*                  21/07/93    WHIRLPOOL        SRF 123257                   *
.*                  Added  Scheduled admission date                           *
.*                  Added  Procedure status description                       *
.*                  03/11/1993    Justin Coates  QUOTE 440017 SRF 440204      *
.*                  added display of practice count to practice code field    *
.*                  10/02/1994  Rob Leonard      SRF 600152                   *
.*                  Added  Date of removal                                    *
.*                  Added  Removal reason                                     *
.*                  07/03/1994    Justin Coates  SRF 440719                   *
.*                  added display of WTWMDOFR                                 *
.*                  28/03/1994    Justin Coates                               *
.*                  added display of GP which isnt related to practice        *
.*                  29/07/1994  bez              wgh                          *
.*                  Added items 36 & 37 for wattr1af                          *
. *                 13/10/1995   Howellsy         suht  
. *                 added wtwmoper  & desc
. *                 14/04/97 Howellsy        RHA        
. *                 Added wmudef5-8, wtwmrdt3, wtwmrank             
.******************************************************************************
.
DXWATTRE  PACK      VAR,SP30,SP30,SP20
          MOVE      SCPSITM,FIELDNO
          BRANCH    FIELDNO,DWTTR001,DWTTR002,DWTTR003,DWTTR004,DWTTR005:
                            DWTTR006,DWTTR007,DWTTR008,DWTTR009,DWTTR010:
                            DWTTR011,DWTTR012,DWTTR013,DWTTR014,DWTTR015:
                            DWTTR016,DWTTR017,DWTTR018,DWTTR019,DWTTR020:
                            DWTTR021,DWTTR022,DWTTR023,DWTTR024,DWTTR025:
                            DWTTR026,DWTTR027,DWTTR028,DWTTR029,DWTTR030:
                            DWTTR031,DWTTR032,DWTTR033,DWTTR034,DWTTR035:
                            DWTTR036,DWTTR037,DWTTR038,DWTTR039,DWTTR040:
                            DWTTR041,DWTTR042,DWTTR043,DWTTR044,DWTTR045:
                            DWTTR046,DWTTR047,DWTTR048,DWTTR049,DWTTR050:
                            DWTTR051,DWTTR052,DWTTR053,DWTTR054,DWTTR055:
                            DWTTR056,DWTTR057,DWTTR058,DWTTR059,DWTTR060:
                            DWTTR061,DWTTR062,DWTTR063,DWTTR064,DWTTR065:
                            DWTTR066,DWTTR067,DWTTR068,DWTTR069,DWTTR070:
                            DWTTR071,DWTTR072,DWTTR073
          GOTO      DWTTR999
.
DWTTR001  PACK      VAR,WMTIME,SP70,SP10    * proc time
          GOTO      DWTTR995
.
DWTTR002  PACK      VAR,WMDESC,SP70,SP10    * description
          GOTO      DWTTR995
.
DWTTR003  PACK      VAR,WMREASON,SP70,SP10  * reason
          GOTO      DWTTR995
.
DWTTR004  UNPACK    WMDATE1,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * date on list
          GOTO      DWTTR995
.
DWTTR005  UNPACK    WMDATE2,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * date of last review
          GOTO      DWTTR995
.
DWTTR006  PACK      VAR,WMUNIT,SP70,SP10    * Unit/Clinic
          GOTO      DWTTR995
.
DWTTR007  MOVE      WMUNIT,ACODE
          PACK      TCODE,ANSW,ANSU
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR008  PACK      VAR,WMDOCTOR,SP70,SP10    * att doctor
          GOTO      DWTTR995
.
DWTTR009  MOVE      WMDOCTOR,KEY6
          CALL      DXPATDOC
          GOTO      DWTTR999
.
DWTTR010  MOVE      WMSTAY,WPESTLS
          PACK      VAR,WPESTLS,SP70,SP10    * estimated stay
          GOTO      DWTTR995
.
DWTTR011  PACK      VAR,WMPTY,SP70,SP10    * priority
          GOTO      DWTTR995
.
DWTTR012  MOVE      WMPTY,ACODE
          PACK      TCODE,ANST,ANSP
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR013  PACK      VAR,WMNOTICE,SP70,SP10    * short notice
          GOTO      DWTTR995
.
DWTTR014  MOVE      WMNOTICE,ACODE
          PACK      TCODE,ANSW,ANSS
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR015  PACK      VAR,WMPTYPE,SP70,SP10    * resident status
          GOTO      DWTTR995
.
DWTTR016  MOVE      WMPTYPE,ACODE 
          PACK      TCODE,ANST,SP1
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR017  PACK      VAR,WMPCAT,SP70,SP10    * patient class
          GOTO      DWTTR995
.
DWTTR018  MOVE      WMPCAT,ACODE
          PACK      TCODE,ANSA,SP1
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR019  PACK      VAR,WMUDEF1,SP70,SP10    * user def 1
          GOTO      DWTTR995
.
DWTTR020  MOVE      WMUDEF1,ACODE
          PACK      TCODE,ANSW,ONE
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR021  PACK      VAR,WMUDEF2,SP70,SP10    * user def 2
          GOTO      DWTTR995
.
DWTTR022  MOVE      WMUDEF2,ACODE 
          PACK      TCODE,ANSW,TWO
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR023  PACK      VAR,WMUDEF3,SP70,SP10    * user def 3
          GOTO      DWTTR995
.
DWTTR024  MOVE      WMUDEF3,ACODE
          PACK      TCODE,ANSW,THREE
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR025  PACK      VAR,WMUDEF4,SP70,SP10    * user def 4
          GOTO      DWTTR995
.
DWTTR026  MOVE      WMUDEF4,ACODE
          PACK      TCODE,ANSW,FOUR
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR027  UNPACK    WTWMREAD,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * reassessment date
          GOTO      DWTTR995
.
DWTTR028  UNPACK    WTWMDEDA,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * deferred or staged adm date
          GOTO      DWTTR995
.
DWTTR029  PACK      VAR,WTWMCLSS,SP70,SP10    * patient category
          GOTO      DWTTR995
.
DWTTR030  MOVE      WTWMCLSS,ACODE
          PACK      TCODE,ANSP,SP1
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR031  UNPACK    WTWMDTAD,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * Decision to admit date
          GOTO      DWTTR995
.
DWTTR032  PACK      VAR,WTWMACAT,SP70,SP10    * administrative category
          GOTO      DWTTR995
.
DWTTR033  MOVE      WTWMACAT,ACODE
          PACK      TCODE,ANSC,ANSL
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR034  UNPACK    WTWMGADD,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * guaranteed admission date
          GOTO      DWTTR995
.
DWTTR035  UNPACK    WTWMDABD,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * do not admit before date
          GOTO      DWTTR995
.
DWTTR036  PACK      VAR,WTWMEATY,SP70,SP10    * Elective Admission type
          GOTO      DWTTR995
.
DWTTR037  MOVE      WTWMEATY,ACODE
          PACK      TCODE,ANSC,ANSC
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR038  PACK      VAR,WTWMADMC,SP70,SP10    * Admission Category
          GOTO      DWTTR995
.
DWTTR039  MOVE      WTWMADMC,ACODE
          PACK      TCODE,ANSW,ANSA
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR040  PACK      VAR,WTWMECRA,SP70,SP10   * ECR Approval number
          GOTO      DWTTR995
.
DWTTR041  PACK      VAR,WTWMGPFA,SP70,SP10   * GPFH Approval number
          GOTO      DWTTR995
.
DWTTR042  PACK      VAR,WTWMRFGP,SP70,SP10
          GOTO      DWTTR995
.
DWTTR043  PACK      KEY10,WTWMRFGP,SP70
          MOVE      SP30,PMHCSNAM            
          MOVE      SP30,PMHCGNAM
          CALL      RDPMHCP1
          PACK      VAR,PMHCSNAM,SP70,SP10
          STRIP     VAR
          ENDSET    VAR
          APPEND    SP1,VAR
          APPEND    PMHCGNAM,VAR
          APPEND    SP70,VAR
          RESET     VAR
          GOTO      DWTTR995
.
DWTTR044  MOVE      "-",ANS
          MATCH     SP2,WTWMGPPT
          IF        @EQUAL
            MOVE      SP1,ANS
          ENDIF
          PACK      VAR,WTWMGPPC,ANS,WTWMGPPT,SP70,SP10
          GOTO      DWTTR995
.
DWTTR045  PACK      KEY10,WTWMGPPC,SP70
          PACK      KEY12,KEY10,WTWMGPPT,SP70
          MOVE      SP30,PMHGPNAM          
          CALL      RDPMHCG1
          PACK      VAR,PMHGPNAM,SP70,SP10
          GOTO      DWTTR995
.
DWTTR046  CLEAR     VAR
          UNPACK    WTWMNAFR,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          APPEND    CPCDATE,VAR                               
          UNPACK    WTWMNATO,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          APPEND    SP1,VAR
          APPEND    ANST,VAR
          APPEND    ANSO,VAR
          APPEND    SP1,VAR
          APPEND    CPCDATE,VAR
          RESET     VAR
          REP       "TtOo",VAR
          GOTO      DWTTR995
.
DWTTR047  UNPACK    WMDATE3,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * Scheduled Admission date
          GOTO      DWTTR995
.
DWTTR048  MOVE      SP20,KEY20
          LOAD      KEY20,WMSTAT,STAT1,STAT2,STAT3,STAT4,STAT5,STAT6,STAT7:
                                   STAT8
          PACK      VAR,KEY20,SP70,SP10
          GOTO      DWTTR995
.
DWTTR049  UNPACK    WMDATE4,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * Date of Removal
          GOTO      DWTTR995
.
DWTTR050  PACK      VAR,WMREMOVE,SP70,SP10   * Removal reason code
          GOTO      DWTTR995
.
DWTTR051  MOVE      WMREMOVE,ACODE
          PACK      TCODE,ANSW,ANSR
          MOVE      SP20,TDESC
          MATCH     SP3,ACODE
          IF        !@EQUAL
            MOVE      "Invalid Code ",TDESC
            PACK      KEY5,TCODE,ACODE,SP10
            CALL      RDCODE1
            IF        OVRCD=0
              IF        PTCNUADT=1
                MATCH     "T",TCINDC1
                IF        @EQUAL
                  OPEN      WATRTDA1,"watrtdaf"
                  OPEN      PATVADA1,"patvadaf"
                  PACK      KEY19,WMURNO,WMCODE,WMCNT
                  CALL      RDWTRTD1
                  IF        OVRCD=0
                    PACK      KEY5,WTRTTDES
                    CALL      RDPTVAD1
                    IF        OVRCD=0
                      PACK      TDESC,PTVADESC,SP20
                    ENDIF
                  ENDIF
                  CLOSE     WATRTDA1
                  CLOSE     PATVADA1
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          PACK      VAR,TDESC,SP30,SP30,SP30
          CALL      DISPITEM                  * Display description
          GOTO      DWTTR999
.
DWTTR052  PACK      VAR,WTWMDOFR,SP70,SP10    * District of Residence
          GOTO      DWTTR995
.
DWTTR053  MOVE      WTWMDOFR,ACODE
          PACK      TCODE,ANSD,ANSA
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR054  PACK      VAR,WTWMRFGP,SP70,SP10    * GP Code - no practice
          GOTO      DWTTR995
.
DWTTR055  PACK      VAR,WTWMOPER,SP70,SP10    * security code         
          GOTO      DWTTR995
.
DWTTR056  MOVE      SP70,SECUSER
          MATCH     SP4,WTWMOPER
          IF        !@EQUAL
            CALL      OPPASS1
            PACK      KEY4,WTWMOPER,SP6
            CALL      RDPASS1  
          ENDIF 
          PACK      VAR,SECUSER,SP70,SP10
          GOTO      DWTTR995
.
DWTTR057  PACK      VAR,WMUDEF5,SP70,SP10    * user def 5
          GOTO      DWTTR995
.
DWTTR058  MOVE      WMUDEF5,ACODE
          PACK      TCODE,ANSX,FIVE
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR059  PACK      VAR,WMUDEF6,SP70,SP10    * user def 6
          GOTO      DWTTR995
.
DWTTR060  MOVE      WMUDEF6,ACODE
          PACK      TCODE,ANSX,SIX
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR061  PACK      VAR,WMUDEF7,SP70,SP10    * user def 7
          GOTO      DWTTR995
.
DWTTR062  MOVE      WMUDEF7,ACODE
          PACK      TCODE,ANSX,SEVEN
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR063  PACK      VAR,WMUDEF8,SP70,SP10    * user def 8
          GOTO      DWTTR995
.
DWTTR064  MOVE      WMUDEF8,ACODE
          PACK      TCODE,ANSX,EIGHT
          CALL      DXPATCOD
          GOTO      DWTTR999
.
DWTTR065  PACK      VAR,WTWMRANK,SP70,SP10    * Patient Rank                 
          GOTO      DWTTR995
.
DWTTR066  PACK      VAR,WTWMSRCR,SP70,SP10    * Source of referral
          GOTO      DWTTR995
.
DWTTR067  MATCH     SP3,WTWMSRCR
          GOTO      DWTTR999 IF EQUAL
.
          MOVE      WTWMSRCR,ACODE
          PACK      TCODE,ANSS,SP1
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1
          PACK      VAR,TDESC,SP70,SP10       * Source of referral description
.
          IF        PTCNUADT=1
            MATCH     "1",TCINDC2           * Adm. Source's ind. 2 = "1" ?
            IF        @EQUAL
              OPEN      WATRTDA1,"watrtdaf"
              PACK      KEY19,WMURNO,WMCODE,WMCNT
              CALL      RDWTRTD1
              IF        OVRCD=0
                MATCH     SP5,WTRTREFR
                IF        !@EQUAL
                  MOVE      WTRTREFR,KEY5       * Referring hospital
                  OPEN      PATVADA1,"patvadaf"
                  CALL      RDPTVAD1
                  CLOSE     PATVADA1
                  IF        OVRCD=0
                    PACK      VAR,PTVADESC,SP70,SP10
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          GOTO      DWTTR995
.
DWTTR068  UNPACK    WTWMDRSA,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * Date of referral for FSA
          GOTO      DWTTR995
.
DWTTR069  UNPACK    WTWMDOSA,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10    * Date of FSA
          GOTO      DWTTR995
.
DWTTR070  PACK      VAR,WTWMPHSP,SP70,SP10    * Principal Health purchaser
          GOTO      DWTTR995
.
DWTTR071  MATCH     SP3,WTWMPHSP
          GOTO      DWTTR999 IF EQUAL
.
          MOVE      WTWMPHSP,ACODE
          PACK      TCODE,ANSH,ANSP
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1
          PACK      VAR,TDESC,SP70,SP10       * PHSP description
          GOTO      DWTTR995
.
DWTTR072  PACK      VAR,WMBOOK,SP70,SP10    * Principal Health purchaser
          GOTO      DWTTR995
.
DWTTR073  PACK      VAR,SP70
          PACK      KEY19,WMURNO,WMCODE,WMCNT,SP70
          CALL      RDWTTX11
          IF        OVRCD=0
            MOVE      "CL",CATEGORY
            PACK      KEY5,CATEGORY,WTTXCTYP,SP10
            CALL      RDCODE1
            MATCH     ANSW,TCINDC1
            IF        @EQUAL
              PACK      KEY8,WMBOOK,SP70
              CALL      RDWCOM1 
              IF        OVRCD = 0
                MATCH     SP20,WCCLMNO
                IF        !@EQUAL
                  PACK      VAR,WCCLMNO,SP70        * ACC Number 
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          GOTO      DWTTR995
.
DWTTR995  CALL      DISPITEM
          GOTO      DWTTR999
.
DWTTR999  RETURN
.

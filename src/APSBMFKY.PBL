EAPBMA00  UNPACK     APBMDAT,CCENT,CYEAR,CMON,CDAY
          CALL       PACDATE
          RETURN
.
EAPBMB00  UNPACK     APBMUDT,CCENT,CYEAR,CMON,CDAY
          CALL       PACDATE
          RETURN
.
EAPBMC00  PACK       KEY4,APBMOPR
          CALL       RDPASS1
          IF         OVRCD=1
            MOVE       SP70,SECUSER
          ENDIF
          RETURN
.
.---- check if batch is balanced ----
.
EAPBMD00  MOVE       ZERO,APINAMT      * note we use APINAMT to total batch
          PACK       KEY40,APBMBCH,SP70
          CALL       RSAPIM1
.
EAPBMD10  CALL       RKAPIM1           * read through batch and accumulate total
          BRANCH     OVRCD,EAPBMD20
          MATCH      APBMBCH,APIMBCH
          GOTO       EAPBMD20 IF NOT EQUAL
.
          ASSIGN     APIMTOT-APIMDIS+APIMGST+APINAMT,APINAMT
          GOTO       EAPBMD10
.
EAPBMD20  IF         APBMTOT=APINAMT
            IF         APBMTOT=ZERO
              MOVE       "Header Only",DISPMSG     * no transactions
            ELSE
              MOVE       "Balanced",DISPMSG        * unbalanced
            ENDIF
          ELSE
            MOVE       "Unbalanced",DISPMSG        * unbalanced
          ENDIF
          RETURN
.
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System            
.   Include   :   APSBMFKY
.   Routine   :   KAPBMA00 Keyin Batch               
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KAPBMA00 TOPIC     "APBMBCH "
          MOVE      UNDLN70,APBMBCH 
          KEYIN     *PCCOL:CVERT,*DV,APBMBCH:                                   
                    *PCCOL:CVERT,*V2LON,*JR,*ZF,APBMBCH:                        
                    *PCCOL:CVERT,*DV,APBMBCH 
.
          ENDSET    APBMBCH 
          APPEND    SP70,APBMBCH 
          RESET     APBMBCH 
.
          MATCH     SP70,APBMBCH 
          GOTO      KAPBMA90 IF EQUAL
.
          ENDSET    APBMBCH 
          CMATCH    EXITCHAR,APBMBCH 
          GOTO      KAPBMA95 IF EQUAL
.
          CMATCH    QUEST,APBMBCH 
          GOTO      KAPBMA10 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HAPBMA00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    APBMBCH 
          APPEND    SP70,APBMBCH 
          RESET     APBMBCH 
.
          MATCH     SP70,APBMBCH 
          GOTO      KAPBMA00 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,APBMBCH                                 
KAPBMA10
          RESET     APBMBCH 
          PACK      KEY5,APBMBCH                                                
          CALL      RAAPBM1 
          BRANCH    OVRCD,KAPBMA80
          BRANCH    CKEYTYP,KAPBMA75
          CALL      RDAPBM1 
KAPBMA70
          MOVE      ZERO,EXIT
          GOTO      KAPBMA99
KAPBMA75
          MOVE      "Batch Already Exist - ",DISPMSG                                                 
          CALL      MESSAGE1
          GOTO      KAPBMA00
KAPBMA80
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KAPBMA99,KAPBMA99
          MOVE      "Batch Does Not Exist - ",DISPMSG                                                
          CALL      MESSAGE1
          GOTO      KAPBMA00
KAPBMA90
          MOVE      ONE,EXIT
          GOTO      KAPBMA99
KAPBMA95
          MOVE      TWO,EXIT
KAPBMA99 TOPIC    PRGID
          RETURN
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System            
.   Include   :   APSBMFKY
.   Routine   :   HAPBMA00 Batch               
.   Return    :           
.-------------------------------------------------------------------------------
HAPBMA00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "10",HTOP
            MOVE      "24",HBOT
            MOVE      "40",HLEF
            MOVE      "80",HRIG
          ENDIF
HAPBMA04
          CALL      GSCRN000
          BRANCH    EXIT,HAPBMA99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Batch"              
.
          MOVE      STDCOL01,STDCOL02
          ADD       " 6",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Entered"            
.
          MOVE      STDCOL02,STDCOL03
          ADD       "11",STDCOL03
          DISPLAY   *PSTDCOL03:STDROW,*V2LON,*ULON,"Updated"           
.
          MOVE      STDCOL03,STDCOL04
          ADD       "11",STDCOL04
          DISPLAY   *PSTDCOL04:STDROW,*V2LON,*ULON,"           Total"   
.
          MOVE      STDCOL04,STDCOL05
          ADD       "16",STDCOL05
HAPBMA08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,APBMBCH 
          PACK      KEY5,APBMBCH,SP70                                           
.                                                                               
.                                                                               
          CALL      RSAPBM1 
HAPBMA10
          CALL      RKAPBM1 
          BRANCH    OVRCD,HAPBMA15
          PACK      KEY5,APBMBCH,SP70                                           
.                                                                               
.                                                                               
          BRANCH    CSEARCH,HAPBMA12
          CALL      HAPBMA60
          BRANCH    OVRCD,HAPBMA10
HAPBMA12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY5,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,APBMBCH 
          CALL      EAPBMA00
          DISPLAY   *PSTDCOL02:STDROW,CPCDATE 
          CALL      EAPBMB00
          DISPLAY   *PSTDCOL03:STDROW,CPCDATE 
          DISPLAY   *PSTDCOL04:STDROW,APBMTOT 
          COMPARE   MAXITEM,XITEMNO
          GOTO      HAPBMA10 IF NOT EQUAL
HAPBMA15
.                                                                               
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HAPBMA20
          CALL      HSCRI000
          BRANCH    EXIT,HAPBMA30,HAPBMA35,HAPBMA40,HAPBMA45,HAPBMA04:
                              HAPBMA91,HAPBMA50
          GOTO      HAPBMA92
HAPBMA30
          CALL      RKAPBM1 
          BRANCH    OVRCD,HAPBMA85
          PACK      KEY5,APBMBCH,SP70                                           
.                                                                               
.                                                                               
          CALL      RPAPBM1 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMA10
HAPBMA35
          MOVE      ST1,KEY5 
          CALL      RDAPBM1 
          CALL      RPAPBM1 
          BRANCH    OVRCD,HAPBMA85
          PACK      KEY5,APBMBCH,SP70                                           
.                                                                               
.                                                                               
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HAPBMA36
          CALL      RPAPBM1 
          BRANCH    OVRCD,HAPBMA37
          PACK      KEY5,APBMBCH,SP70                                           
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HAPBMA36 IF NOT EQUAL
HAPBMA37
          MOVE      ZERO,XITEMNO
          GOTO      HAPBMA10
HAPBMA40
          MOVE      ST1,KEY5 
          CALL      RDAPBM1 
          CALL      RPAPBM1 
          BRANCH    OVRCD,HAPBMA85
          PACK      KEY5,APBMBCH,SP70                                           
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMA08
HAPBMA45
          CALL      RKAPBM1 
          BRANCH    OVRCD,HAPBMA85
          PACK      KEY5,APBMBCH,SP70                                           
.                                                                               
.                                                                               
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY5,Z70                                                    
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSAPBM1 
HAPBMA46
          CALL      RPAPBM1 
          BRANCH    OVRCD,HAPBMA47
          PACK      KEY5,APBMBCH,SP70                                           
.                                                                               
.                                                                               
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HAPBMA46 IF NOT EQUAL
HAPBMA47
          MOVE      ZERO,XITEMNO
          GOTO      HAPBMA10
HAPBMA50  COMPARE   ZERO,CSEARCH
          GOTO      HAPBMA55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          KEYIN     *PSTDCOL03:STDROW,*V2LON,SCHFLD03
          RESET     SCHFLD03
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMA08
HAPBMA55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMA08
HAPBMA60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HAPBMA61 IF EQUAL
          MATCH     SCHFLD01,APBMBCH 
          GOTO      HAPBMA72 IF NOT EQUAL
HAPBMA61
          CALL      EAPBMA00
          MATCH     SP70,SCHFLD02
          GOTO      HAPBMA62 IF EQUAL
          MATCH     SCHFLD02,CPCDATE 
          GOTO      HAPBMA72 IF NOT EQUAL
HAPBMA62
          CALL      EAPBMB00
          MATCH     SP70,SCHFLD03
          GOTO      HAPBMA63 IF EQUAL
          MATCH     SCHFLD03,CPCDATE 
          GOTO      HAPBMA72 IF NOT EQUAL
HAPBMA63
HAPBMA64
HAPBMA65
HAPBMA66
HAPBMA67
HAPBMA68
HAPBMA69
HAPBMA70
          GOTO      HAPBMA75
HAPBMA72  MOVE      ONE,OVRCD
HAPBMA75  RETURN
HAPBMA85
          LOAD      KEY5,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY5,APBMBCH                                                
          CALL      RDAPBM1 
HAPBMA90
.                                                                               
          BEEP
          GOTO      HAPBMA20
HAPBMA91
          MOVE      SP70,APBMLED 
          MOVE      SP70,APBMDIS 
          MOVE      SP70,APBMRES 
          MOVE      ZERO,APBMTOT 
          MOVE      SP70,APBMTYP 
          MOVE      SP70,APBMOPR 
          MOVE      SP70,APBMDAT 
          MOVE      SP70,APBMADT 
          MOVE      SP70,APBMUDT 
          MOVE      SP70,APBMCHQ 
          MOVE      SP70,APBMSPA 
          MOVE      SP70,KEY5 
          MOVE      SP70,APBMBCH 
          GOTO      HAPBMA96
HAPBMA92
          MOVE      SP70,KEY5 
          MOVE      SP70,APBMBCH 
          LOAD      KEY5,CCITEM,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY5,APBMBCH                                                
HAPBMA96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HAPBMA99
          RETURN
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System
.   Include   :   APSBMFKY
.   Routine   :   KAPBMY00 Keyin Batch (by type & updated)
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KAPBMY00 TOPIC     "APBMBCH "
          MOVE      UNDLN70,APBMBCH
          KEYIN     *PCCOL:CVERT,*DV,APBMBCH:
                    *PCCOL:CVERT,*V2LON,*JR,*ZF,APBMBCH:
                    *PCCOL:CVERT,*DV,APBMBCH
.
          ENDSET    APBMBCH
          APPEND    SP70,APBMBCH
          RESET     APBMBCH
          REP       UPPLOW,APBMBCH
.
          MATCH     SP70,APBMBCH
          GOTO      KAPBMY90 IF EQUAL
.
          ENDSET    APBMBCH
          CMATCH    ANSE,APBMBCH
          GOTO      KAPBMY95 IF EQUAL
          CMATCH    ANSX,APBMBCH
          GOTO      KAPBMY95 IF EQUAL
.
          CMATCH    EXITCHAR,APBMBCH
          GOTO      KAPBMY95 IF EQUAL
.
          CMATCH    QUEST,APBMBCH
          GOTO      KAPBMY10 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HAPBMY00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    APBMBCH
          APPEND    SP70,APBMBCH
          RESET     APBMBCH
.
          MATCH     SP70,APBMBCH
          GOTO      KAPBMY00 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,APBMBCH
KAPBMY10
          RESET     APBMBCH
          PACK      KEY5,APBMBCH
          CALL      RAAPBM1
          BRANCH    OVRCD,KAPBMY80
          BRANCH    CKEYTYP,KAPBMY75
          CALL      RDAPBM1
KAPBMY70
          MOVE      ZERO,EXIT
          GOTO      KAPBMY99
KAPBMY75
          MOVE      "Batch Already Exist - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KAPBMY00
KAPBMY80
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KAPBMY99,KAPBMY99
          MOVE      "Batch Does Not Exist - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KAPBMY00
KAPBMY90
          MOVE      ONE,EXIT
          GOTO      KAPBMY99
KAPBMY95
          MOVE      TWO,EXIT
KAPBMY99  TOPIC    PRGID
          RETURN
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System            
.   Include   :   APSBMFKY
.   Routine   :   HAPBMY00 Batch by Type       
.   Return    :           
.-------------------------------------------------------------------------------
HAPBMY00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "10",HTOP
            MOVE      "24",HBOT
            MOVE      "27",HLEF
            MOVE      "80",HRIG
          ENDIF
HAPBMY04
          CALL      GSCRN000
          BRANCH    EXIT,HAPBMY99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Batch"              
.
          MOVE      STDCOL01,STDCOL02
          ADD       " 6",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Entered"            
.
          MOVE      STDCOL02,STDCOL03
          ADD       "11",STDCOL03
          DISPLAY   *PSTDCOL03:STDROW,*V2LON,*ULON,"Updated"
.
          MOVE      STDCOL03,STDCOL04
          ADD       "14",STDCOL04
          DISPLAY   *PSTDCOL04:STDROW,*V2LON,*ULON,"          Total"    
.
          MOVE      STDCOL04,STDCOL05
          ADD       "16",STDCOL05
          DISPLAY   *PSTDCOL05:STDROW,*V2LON,*ULON,"Input by          "
.
          MOVE      STDCOL05,STDCOL06
          ADD       "25",STDCOL06
HAPBMY08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,APBMBCH 
          PACK      KEY7,APBMTYP,Z70
          PACK      SAVKEY80,APBMTYP,Z70
          SETLPTR   SAVKEY80,2                                                  
          CALL      RSAPBM2 
HAPBMY10
          CALL      RPAPBM2 
          BRANCH    OVRCD,HAPBMY15
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMY15 IF NOT EQUAL
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMY10 IF EQUAL
.
          BRANCH    CSEARCH,HAPBMY12
          CALL      HAPBMY60
          BRANCH    OVRCD,HAPBMY10
.
HAPBMY12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY7,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,APBMBCH 
          CALL      EAPBMA00
          DISPLAY   *PSTDCOL02:STDROW,CPCDATE 
          CALL      EAPBMB00
          DISPLAY   *PSTDCOL03:STDROW,CPCDATE 
          DISPLAY   *PSTDCOL04:STDROW,APBMTOT 
          CALL      EAPBMC00
          DISPLAY   *PSTDCOL05:STDROW,SECUSER 
          COMPARE   MAXITEM,XITEMNO
          GOTO      HAPBMY10 IF NOT EQUAL
HAPBMY15
          UNPACK    SAVKEY80,APBMTYP,APBMBCH                                    
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HAPBMY20
          CALL      HSCRI000
          BRANCH    EXIT,HAPBMY30,HAPBMY35,HAPBMY40,HAPBMY45,HAPBMY04:
                              HAPBMY91,HAPBMY50
          GOTO      HAPBMY92
HAPBMY30
          CALL      RPAPBM2 
          BRANCH    OVRCD,HAPBMY85
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMY85 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMY30 IF EQUAL
.
          CALL      RKAPBM2 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMY10
HAPBMY35
          MOVE      ST1,KEY7 
          CALL      RDAPBM2 
.
HAPBMY3X  CALL      RKAPBM2 
          BRANCH    OVRCD,HAPBMY85
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMY85 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMY3X IF EQUAL
.
          MATCH     SP70,APBMBCH                                                
          GOTO      HAPBMY85 IF EQUAL                                           
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HAPBMY36
          CALL      RKAPBM2 
          BRANCH    OVRCD,HAPBMY37
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMY37 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMY36 IF EQUAL
.
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HAPBMY36 IF NOT EQUAL
HAPBMY37
          MOVE      ZERO,XITEMNO
          GOTO      HAPBMY10
HAPBMY40
          MOVE      ST1,KEY7 
          CALL      RDAPBM2 
.
HAPBMY41  CALL      RKAPBM2 
          BRANCH    OVRCD,HAPBMY85
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMY85 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMY41 IF EQUAL
.
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMY08
HAPBMY45
          CALL      RPAPBM2 
          BRANCH    OVRCD,HAPBMY85
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMY85 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMY45 IF EQUAL
.
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY7,SAVKEY80,SP70                                           
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSAPBM2 
HAPBMY46
          CALL      RKAPBM2 
          BRANCH    OVRCD,HAPBMY47
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMY47 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMY46 IF EQUAL
.
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HAPBMY46 IF NOT EQUAL
HAPBMY47
          MOVE      ZERO,XITEMNO
          GOTO      HAPBMY10
.
HAPBMY50  COMPARE   ZERO,CSEARCH
          GOTO      HAPBMY55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          KEYIN     *PSTDCOL03:STDROW,*V2LON,SCHFLD03
          RESET     SCHFLD03
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMY08
HAPBMY55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMY08
HAPBMY60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HAPBMY61 IF EQUAL
          MATCH     SCHFLD01,APBMBCH 
          GOTO      HAPBMY72 IF NOT EQUAL
HAPBMY61
          CALL      EAPBMA00
          MATCH     SP70,SCHFLD02
          GOTO      HAPBMY62 IF EQUAL
          MATCH     SCHFLD02,CPCDATE 
          GOTO      HAPBMY72 IF NOT EQUAL
HAPBMY62
          CALL      EAPBMB00
          MATCH     SP70,SCHFLD03
          GOTO      HAPBMY63 IF EQUAL
          MATCH     SCHFLD03,CPCDATE 
          GOTO      HAPBMY72 IF NOT EQUAL
HAPBMY63
HAPBMY64
HAPBMY65
HAPBMY66
HAPBMY67
HAPBMY68
HAPBMY69
HAPBMY70
          GOTO      HAPBMY75
HAPBMY72  MOVE      ONE,OVRCD
HAPBMY75  RETURN
HAPBMY85
          LOAD      KEY7,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY7,APBMTYP,APBMBCH                                        
          CALL      RDAPBM2 
HAPBMY90
          UNPACK    SAVKEY80,APBMTYP,APBMBCH                                    
          BEEP
          GOTO      HAPBMY20
HAPBMY91
          MOVE      SP70,APBMLED 
          MOVE      SP70,APBMDIS 
          MOVE      SP70,APBMRES 
          MOVE      ZERO,APBMTOT 
          MOVE      SP70,APBMOPR 
          MOVE      SP70,APBMDAT 
          MOVE      SP70,APBMADT 
          MOVE      SP70,APBMUDT 
          MOVE      SP70,APBMCHQ 
          MOVE      SP70,APBMSPA 
          MOVE      SP70,KEY7 
          MOVE      SP70,APBMBCH 
          GOTO      HAPBMY96
HAPBMY92
          MOVE      SP70,KEY7 
          MOVE      SP70,APBMBCH 
          LOAD      KEY7,CCITEM,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY7,APBMTYP,APBMBCH                                        
HAPBMY96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HAPBMY99
          RETURN
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System
.   Include   :   APSBMFKY
.   Routine   :   KAPBMZ00 Keyin Batch (by type & not updated)
.   Parameter :   CKEYTYP 0 = Keyin , 1 = Accept, 2 = Either
.   Return    :   EXIT = 1 null entry, 2 EXITCHAR entered
.-------------------------------------------------------------------------------
KAPBMZ00 TOPIC     "APBMBCH "
          MOVE      UNDLN70,APBMBCH
          KEYIN     *PCCOL:CVERT,*DV,APBMBCH:
                    *PCCOL:CVERT,*V2LON,*JR,*ZF,APBMBCH:
                    *PCCOL:CVERT,*DV,APBMBCH
.
          ENDSET    APBMBCH
          APPEND    SP70,APBMBCH
          RESET     APBMBCH
          REP       UPPLOW,APBMBCH
.
          MATCH     SP70,APBMBCH
          GOTO      KAPBMZ90 IF EQUAL
.
          ENDSET    APBMBCH
          CMATCH    ANSX,APBMBCH
          GOTO      KAPBMZ95 IF EQUAL
.
          CMATCH    EXITCHAR,APBMBCH
          GOTO      KAPBMZ95 IF EQUAL
.
          CMATCH    QUEST,APBMBCH
          GOTO      KAPBMZ10 IF NOT EQUAL
.
          MOVE      CCITEM,SCCITEM
          CALL      HAPBMZ00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    APBMBCH
          APPEND    SP70,APBMBCH
          RESET     APBMBCH
.
          MATCH     SP70,APBMBCH
          GOTO      KAPBMZ00 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,APBMBCH
KAPBMZ10
          RESET     APBMBCH
          PACK      KEY5,APBMBCH
          CALL      RAAPBM1
          BRANCH    OVRCD,KAPBMZ80
          BRANCH    CKEYTYP,KAPBMZ75
          CALL      RDAPBM1
KAPBMZ70
          MOVE      ZERO,EXIT
          GOTO      KAPBMZ99
KAPBMZ75
          MOVE      "Batch Already Exists - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KAPBMZ00
KAPBMZ80
          MOVE      ZERO,EXIT
          BRANCH    CKEYTYP,KAPBMZ99,KAPBMZ99
          MOVE      "Batch Does Not Exist - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KAPBMZ00
KAPBMZ90
          MOVE      ONE,EXIT
          GOTO      KAPBMZ99
KAPBMZ95
          MOVE      TWO,EXIT
KAPBMZ99  TOPIC    PRGID
          RETURN
.---------------------------------------------------------------------------
.   System    :   Accounts Payable System            
.   Include   :   APSBMFKY
.   Routine   :   HAPBMZ00 Batch by Type       
.   Return    :           
.-------------------------------------------------------------------------------
HAPBMZ00
          MOVE      ZERO,CSCRSIZ
          IF        HTOP<3
            MOVE      "10",HTOP
            MOVE      "24",HBOT
            MOVE      "27",HLEF
            MOVE      "80",HRIG
          ENDIF
HAPBMZ04
          CALL      GSCRN000
          BRANCH    EXIT,HAPBMZ99
          MOVE      STDCOL00,STDCOL01
          ADD       " 5",STDCOL01
          DISPLAY   *PSTDCOL01:STDROW,*V2LON,*ULON,"Batch"              
.
          MOVE      STDCOL01,STDCOL02
          ADD       " 6",STDCOL02
          DISPLAY   *PSTDCOL02:STDROW,*V2LON,*ULON,"Entered"            
.
          MOVE      STDCOL02,STDCOL03
          ADD       "11",STDCOL03
          DISPLAY   *PSTDCOL03:STDROW,*V2LON,*ULON,"Status"
.
          MOVE      STDCOL03,STDCOL04
          ADD       "14",STDCOL04
          DISPLAY   *PSTDCOL04:STDROW,*V2LON,*ULON,"          Total"    
.
          MOVE      STDCOL04,STDCOL05
          ADD       "16",STDCOL05
          DISPLAY   *PSTDCOL05:STDROW,*V2LON,*ULON,"Input by          "
.
          MOVE      STDCOL05,STDCOL06
          ADD       "25",STDCOL06
HAPBMZ08
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          MOVE      SP70,APBMBCH 
          PACK      KEY7,APBMTYP,Z70
          PACK      SAVKEY80,APBMTYP,Z70
          SETLPTR   SAVKEY80,2                                                  
          CALL      RSAPBM2 
HAPBMZ10
          CALL      RPAPBM2 
          BRANCH    OVRCD,HAPBMZ15
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMZ15 IF NOT EQUAL
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMZ10 IF NOT EQUAL
.
          BRANCH    CSEARCH,HAPBMZ12
          CALL      HAPBMZ60
          BRANCH    OVRCD,HAPBMZ10
.
HAPBMZ12
          ADD       ONE,XITEMNO
          ADD       ONE,STDROW
          STORE     KEY7,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          DISPLAY   *PSTDCOL00:STDROW,SP1,*V2LON,XITEMNO,DOT
          DISPLAY   *PSTDCOL01:STDROW,APBMBCH 
          CALL      EAPBMA00
          DISPLAY   *PSTDCOL02:STDROW,CPCDATE 
          CALL      EAPBMD00
          DISPLAY   *PSTDCOL03:STDROW,*+,DISPMSG 
          DISPLAY   *PSTDCOL04:STDROW,APBMTOT 
          CALL      EAPBMC00
          DISPLAY   *PSTDCOL05:STDROW,SECUSER 
          COMPARE   MAXITEM,XITEMNO
          GOTO      HAPBMZ10 IF NOT EQUAL
HAPBMZ15
          UNPACK    SAVKEY80,APBMTYP,APBMBCH                                    
          MOVE      ONE,DITEM
          MOVE      MINITEM,DROW
          ADD       ONE,DROW
          DISPLAY   *PSTDCOL00:DROW,*V2LON,*HON,SP1,DITEM,DOT
          CLIP
          FLUSH     HLEF,HTOP,HRIG,HBOT
.
HAPBMZ20
          CALL      HSCRI000
          BRANCH    EXIT,HAPBMZ30,HAPBMZ35,HAPBMZ40,HAPBMZ45,HAPBMZ04:
                              HAPBMZ91,HAPBMZ50
          GOTO      HAPBMZ92
HAPBMZ30
          CALL      RPAPBM2 
          BRANCH    OVRCD,HAPBMZ85
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMZ85 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMZ30 IF NOT EQUAL
.
          CALL      RKAPBM2 
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMZ10
HAPBMZ35
          MOVE      ST1,KEY7 
          CALL      RDAPBM2 
.
HAPBMZ3X  CALL      RKAPBM2 
          BRANCH    OVRCD,HAPBMZ85
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMZ85 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMZ3X IF NOT EQUAL
.
          MATCH     SP70,APBMBCH                                                
          GOTO      HAPBMZ85 IF EQUAL                                           
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
HAPBMZ36
          CALL      RKAPBM2 
          BRANCH    OVRCD,HAPBMZ37
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMZ37 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMZ36 IF NOT EQUAL
.
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HAPBMZ36 IF NOT EQUAL
HAPBMZ37
          MOVE      ZERO,XITEMNO
          GOTO      HAPBMZ10
HAPBMZ40
          MOVE      ST1,KEY7 
          CALL      RDAPBM2 
.
HAPBMZ41  CALL      RKAPBM2 
          BRANCH    OVRCD,HAPBMZ85
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMZ85 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMZ41 IF NOT EQUAL
.
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMZ08
HAPBMZ45
          CALL      RPAPBM2 
          BRANCH    OVRCD,HAPBMZ85
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMZ85 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMZ45 IF NOT EQUAL
.
          SUSPEND
          CLIP      1,1,CRIG,24
.
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          MOVE      ZERO,XITEMNO
          PACK      KEY7,SAVKEY80,SP70                                           
          MOVE      MINITEM,STDROW
          MOVE      MAXITEM,XITEMNO
          CALL      RSAPBM2 
HAPBMZ46
          CALL      RKAPBM2 
          BRANCH    OVRCD,HAPBMZ47
          PACK      KEY7,APBMTYP,APBMBCH,SP70                                   
          MATCH     SAVKEY80,KEY7                                               
          GOTO      HAPBMZ47 IF NOT EQUAL                                       
.
          REP       " 0",APBMUDT            * check if updated
          MATCH     "00000000",APBMUDT
          GOTO      HAPBMZ46 IF NOT EQUAL
.
          SUB       ONE,XITEMNO
          COMPARE   ZERO,XITEMNO
          GOTO      HAPBMZ46 IF NOT EQUAL
HAPBMZ47
          MOVE      ZERO,XITEMNO
          GOTO      HAPBMZ10
.
HAPBMZ50  COMPARE   ZERO,CSEARCH
          GOTO      HAPBMZ55 IF EQUAL
          MOVE      ZERO,CSEARCH
          MOVE      ZERO,XITEMNO
          MOVE      MINITEM,STDROW
          ADD       ONE,STDROW
          UNPACK    SP70,SCHFLD01,SCHFLD02,SCHFLD03,SCHFLD04,SCHFLD05
          UNPACK    SP70,SCHFLD06,SCHFLD07,SCHFLD08,SCHFLD09,SCHFLD10
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          DISPLAY   *PSTDCOL00:STDROW,*V2LON,*HON,"Sch"
          KEYIN     *PSTDCOL01:STDROW,*V2LON,SCHFLD01
          RESET     SCHFLD01
          KEYIN     *PSTDCOL02:STDROW,*V2LON,SCHFLD02
          RESET     SCHFLD02
          KEYIN     *PSTDCOL03:STDROW,*V2LON,SCHFLD03
          RESET     SCHFLD03
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMZ08
HAPBMZ55  MOVE      ONE,CSEARCH
          PACK      KEY8,SP70
          SUSPEND
          CLIP      1,1,CRIG,24
          BOXCLR    CLEF,CTOP,CRIG,CBOT
          GOTO      HAPBMZ08
HAPBMZ60  MOVE      ZERO,OVRCD
          MATCH     SP70,SCHFLD01
          GOTO      HAPBMZ61 IF EQUAL
          MATCH     SCHFLD01,APBMBCH 
          GOTO      HAPBMZ72 IF NOT EQUAL
HAPBMZ61
          CALL      EAPBMA00
          MATCH     SP70,SCHFLD02
          GOTO      HAPBMZ62 IF EQUAL
          MATCH     SCHFLD02,CPCDATE 
          GOTO      HAPBMZ72 IF NOT EQUAL
HAPBMZ62
          CALL      EAPBMB00
          MATCH     SP70,SCHFLD03
          GOTO      HAPBMZ63 IF EQUAL
          MATCH     SCHFLD03,CPCDATE 
          GOTO      HAPBMZ72 IF NOT EQUAL
HAPBMZ63
HAPBMZ64
HAPBMZ65
HAPBMZ66
HAPBMZ67
HAPBMZ68
HAPBMZ69
HAPBMZ70
          GOTO      HAPBMZ75
HAPBMZ72  MOVE      ONE,OVRCD
HAPBMZ75  RETURN
HAPBMZ85
          LOAD      KEY7,XITEMNO,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY7,APBMTYP,APBMBCH                                        
          CALL      RDAPBM2 
HAPBMZ90
          UNPACK    SAVKEY80,APBMTYP,APBMBCH                                    
          BEEP
          GOTO      HAPBMZ20
HAPBMZ91
          MOVE      SP70,APBMLED 
          MOVE      SP70,APBMDIS 
          MOVE      SP70,APBMRES 
          MOVE      ZERO,APBMTOT 
          MOVE      SP70,APBMOPR 
          MOVE      SP70,APBMDAT 
          MOVE      SP70,APBMADT 
          MOVE      SP70,APBMUDT 
          MOVE      SP70,APBMCHQ 
          MOVE      SP70,APBMSPA 
          MOVE      SP70,KEY7 
          MOVE      SP70,APBMBCH 
          GOTO      HAPBMZ96
HAPBMZ92
          MOVE      SP70,KEY7 
          MOVE      SP70,APBMBCH 
          LOAD      KEY7,CCITEM,ST1,ST2,ST3,ST4,ST5:                            
                                ST6,ST7,ST8,ST9,ST10:
                                ST11,ST12,ST13,ST14,ST15:
                                ST16,ST17
          UNPACK    KEY7,APBMTYP,APBMBCH                                        
HAPBMZ96
          PUTSCR    CSSCRNUM,HLEF,HTOP,HRIG,HBOT
          CALL      FRESCR00
          MOVE      ZERO,HTOP
          MOVE      ZERO,HLEF
          MOVE      ZERO,HBOT
          MOVE      ZERO,HRIG
HAPBMZ99
          RETURN
.

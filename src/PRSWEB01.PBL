.----------------------------------------------------------------------
. Program       : PRSWEB01
.
. Function      : PRS Extract Enquiries/Maintenance
.
. Modifications  :
.----------------------------------------------------------------------
. V11.04.01 05/02/2024  DA Sarkies    TSK 0936282
.           Increased size of variable to hold Healthfund number
. V11.03.01 05/01/2023  Bella Turco   TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.01 10/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTMA1FD changes
. V11.00.01 09/12/2020  Thanh T        TSK 0872840
.           Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
.----------------------------------------------------------------------
. V10.14.01 05/09/2019  Thanh T        TSK 0881140
.           Increased the STARTNUM size from 3 digits to 4 digits to fix
.           the issue of displaying more than 999 records for various
.           templates  
. V10.11.03 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.02 01/07/2017  Richa Phogat   TSK 0842793
.           Updated Webtitle which was missing for few reports
. V10.11.01 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
.----------------------------------------------------------------------
. V10.05.03 11/11/2014  Jill Parkinson CAR       
.           Fixed FILTHOSP check if blank          
. V10.05.02 06/10/2014  Ebon Clements  CAR 268970
.           Removed OUTCLIFD as it was not used
. V10.05.01 01/09/2014 Jil Parkinson CAR 304255
.           Added use of PMQEHOSP   
. V10.04.04 07.04.2014  Peter Vela   CAR 286158
.           Recompiled for PATMASTM
. V10.04.03 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.02 17/03/2014  Jill Parkinson CAR 294183 
.           Removed accommodation type and care type as mandatory in CHKACT00
. V10.04.01 20/12/2013  Ania P          CAR 294308
.           Recompiled for PATRDEFD
.----------------------------------------------------------------------
. V10.03.07 01/05/2013 Sandra Barcham   CAR 284537
.           Change heading of Current to Current Triggers List
. V10.03.06 04/04/2013  Davin           CAR 278075
.           Allow display of current triggers if no extracts on file (watrg430)
. V10.03.05 20/03/2013  Davin           CAR 278075
.           Commented out user id filter in WAELT000
.           Added showcurr for HMDS Triggers List menu option (watrg400)
. V10.03.04 25/02/2013  Don Nguyen      CAR 278075
.           Added WAEXR000 & WATRG000 - WA HMDS Trigger Maintenance routines
. V10.03.03 15/02/2012  Ebon Clements   CAR 244724
.           Fixed WEBTITLE in report 6
. V10.03.02 02/02/2012  Jill Parkinson  CAR 253987
.           Added WA Extract details
. V10.03.01 16/01/2012  Sandra Barcham  CAR 256563
.           Recompiled for PATMASTM
. V10.01.02 15/02/2011 Jill Parkinson   CAR 238149
.           Removed reference to PTCNACCM
. V10.01.01 20/01/2011 Jill Parkinson   CAR 236448
.           Fixed setting of P2PTDT05 and PTPTDT06
. V9.12.02  23/10/2009 WeeLee Koo          208273
.           Increased selection year by 1. (SYSL0000)
. V9.12.01  07/08/2009 Sandra Barcham      202956
.           Stop error message patient must be discharged after PRS2 reset date
.           whcn the discharge date and the reset date are the same
. V9.11.01  08/04/2008  Saroeun Soeur  CAR 192793
.           Added tag to display QLD extract summary 
.           PRSQ0000,QLDSUM00
. V9.09.01  17/08/2007  Mike Laming    CAR 147525
.           Added Medicare Suffix "Name, C-U, N-E, P-N" for PTACMEDI
. V9.08.03  08/05/2007  Mike Laming  CAR 137125 HDP 2007 DRG 5.2
.           Mods to PATDGWFD - Add field PTDWDRGV (add to Keys)
. V9.08.02  31/01/2007  Peter Vela     CAR 127930
.           Recompiled for MRTMASFD
. V9.08.01  14/12/2006  Peter Vela    CAR 128097
.           Added submit functionality for KEYSTARR[],SCHDPRNT,SCHDCOPY,SCHDTYPE
. V9.07.01  11/07/2006  Jill Habasque CAR 112032
.           Mods to display current PRS2 extracts for multi extract sites
. V9.05.02  17/04/2006  Jill Habasque CAR 99867
.           Mods to only display visits related to a sites hospital
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.04   04/08/2005  J.Tan        CAR 62750 
.           Mods not to use the redefined amount variables
. V9.04.03  20/05/2005  Peter Vela    CAR 60167
.           PRS/2 2005 Stat Changes
.           Created Web front end for IBAHMS13
.           Created Web front end for IBAINP31
. V9.04.02  01/03/2005  Peter Vela    CAR 57547
.           Recompiled for PATVADFD and PATVADIO
. V9.04.01  22/12/2004  Lina Vo       CAR 55990                       
.           Changed PMVXPWGT - Form 4.2 is stored as Form 6. Remember to     
.           Multiply/Divide by 100.
. V9.03.07  11/06/2004  Mike Laming   CAR 49016  July 2004 PRS/2      
.           - Add Sex Description routine SEXDSC00 with Code "R" - "Intersex"
. V9.03.06  07/06/2004 Peter Vela     CAR 49016
.           2004 Statutory Changes - recompiled for PMSPX2TM
. V9.03.05  25/05/2004 Davin          CAR 50042
.           Added u/r column in prspmiaf display table
. V9.03.04  07/04/2004 Lina Vo        CAR 48785
.           Fixed display of prspmiaf fields that are category codes.
.           Changed ADDP0000 to save correct PASSCODE in patpeiaf.
. V9.03.03  26/03/2004 Peter Vela     CAR 13038
.           Recompiled for PATDOCCD - Doctor Name format Parameter
. V9.03.02  09/02/2004  Davin         CAR 22654
.           Added status 4 (include & delete) when writing to patpeiaf
.           Added new fields to enquiry
.           Added option 3 for PMI triggers
.           Added new function to option 1 - update visit pmi details
. V9.03.01  11/12/2003  Peter Vela    CAR 40355
.           Recompiled for PATNAMCD
. V9.02.08  02/05/2003  Jill Habasque SRF 35150
.           Added report option 2 - patpeiaf maintenance
. V9.02.07  03/12/2002  Jill Habasque SRF 33602
.           Added output of PVIRESI
. V9.02.06  25/06/2002  Pat Dirito               SRF 18988
.           Added PTICCPAP -Hours on Constant Positive Air in PATD0000
. V9.02.05  09/01/2002  Jill Habasque
.           Added new fields to enquiry
. V9.02.04  19/12/2001  J.Tan
.           Mods to PRS2 extract listing to link to PRS2 enquiry template
.           (TADMSR00)
. V9.02.03  05/12/2001  Jill Habasque
.           Fix bugs in Enquiry Screen                    
. V9.02.02  02/11/2001  Greg Horvat
.           Added xtra option to the parameter PTCNADMT
. V9.02.01  06.10.2001 Glenn Saunders
.           Determine Patient folder suffix (icon) from PATFLD00 routine
. V9.01.02  16.08.2001 J.Tan
.           Recompiled for PATMASTM
. V9.01.01  14.08.2001 J.Tan
.           Recompiled for PATMASTM
. V9.00.B03 13.07.2001 Sandra Barcham
.           Replace GP with HCP
. V9.00.B02 14.06.2001 B.G.Ackland
.           Recompile for Changes to PATMASTM
. V9.00.B01 14/05/2001 - HPS
.            Created Program 
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
          INC       RSHWEBDF                                           *I-60167
.
          INC       APSMASFD/INC
          INC       PATMA1FD/INC   * Inpatients - Patient Master File           
          INC       PMSHCPFD/INC
          INC       PMSHCGFD/INC
          INC       PMSPX2FD/INC
          INC       PMSPX2TD/INC
          INC       PATECMFD/INC
          INC       PATMI1FD/INC   * Inpatients - Patient Admission File
          INC       PATHSPFD/INC
          INC       PMSWAEFD/INC
          INC       PMSWTRFD/INC
          INC       PATTRNFD/INC   * Inpatients - Patient Transfer File 
          INC       PMSVX1FD/INC   * Inpatients - Patient Visit Ext File
          INC       PATDGWFD/INC   * Inpatients - Patient Admission File
          INC       PATDADFD/INC   * Inpatients - Patient Admission File
          INC       PATDSCFD/INC   * Inpatients - Patient Admission File
          INC       PRSHRDFD/INC   * PRS2 Run Header Table
          INC       PRSDTLFD/INC   * PRS2 Admission Details Table
          INC       PRSPMIFD/INC   * PRS2 PMI Trigger Changes Table
          INC       OUTOSFFD/INC   * File for Outpatients open session
          INC       OUTCONFD/INC   * Control File
          INC       OUTSITFD/INC   * Outpatient Site Code
          INC       OUTCTYFD/INC   * Outpatients Clinic Type Table
          INC       OUTCLVFD/INC   * Outpatients Clinic Leave Details
          INC       OUTMA1FD/INC   * Outpatients Clininc Mastre Table A
          INC       OUTMABFD/INC   * Outpatients Clininc Mastre Table B
          INC       OUTSESFD/INC   * Outpatients Clinic Open Session
          INC       OUTPHOFD/INC   * Outpatiets Public Holiday Table
          INC       OUTBOAFD/INC   * Outpatient Clinic Session Booking Table A
          INC       PATACCFD/INC   * PRS/2 Account Status              *I-60167
          INC       PATACTFD/INC   * PRS/2 Account Status Validation   *I-60167
          INC       PATCALAG/INC   * File to calculate age
          INC       PATICUFD/INC   * Intensive care unit
          INC       PATALRFD/INC
          INC       PATVISFD/INC
.
          INC       PMSCCDFD/INC   * Concession Card Details
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       PATPR1FD/INC
          INC       PATDO1FD/INC
          INC       PATFN1FD/INC
          INC       PATIN1FD/INC
          INC       PATWR1FD/INC
          INC       MRTMASFD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       PATCONFD/INC
.
          INC       PMSPRDFD/INC
          INC       PATPEIFD/INC
          INC       PATRDEFD/INC
          INC       PATVADFD/INC
          INC       PATWMAFD/INC
          INC       PATWVEFD/INC
.
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
.
          INC       IBAGSTFD/INC   * GST Codes
.
          INC       PMSQERFD/INC
.
.----------------------------------------------------------------------
. CGI Parameters
.----------------------------------------------------------------------
NEXTPAGE  FORM      1
UPDTTYPE  DIM       1     * Update Type
SAVDATE   DIM       8
SHOWYEAR  DIM       4     * Year of Dates to Show (Leave/Sessions etc) 
STARTKEY  DIM       10    * Starting Key
.
ADMTYPE   DIM       3
CARETYPE  DIM       3
CURFLAG   FORM      1
CURRYEAR  FORM      4     * Current Year
CURRENT   DIM       3
EXTSTAT   DIM       20
EXTRACTN  DIM       8
FILTERYR  DIM       4     * year selected from the combo box
FILTHOSP  DIM       3     * Hospital filter
HOSPCODE  DIM       3
NUMRECS   DIM       3
TEMPYEAR  DIM       4     * temporary variable
PRSRUNNO  DIM       10    * PRS Extract Run no
PRSSDATE  DIM       8     * PRS Start Date
REASON    DIM       20
STATUS    DIM       20
.
PTPEI001  FORM      1     * Status 1=Excl 2=Incl 3=Delete 4=Include & Delete
PTPEI002  DIM       3     * Reason (Category RN)
PTPEI003  DIM       8     * Extract Date
P2PTDT01  DIM       8 
P2PTDT02  DIM       20
P2PTDT03  DIM       20 
P2PTDT04  DIM       20 
P2PTDT05  DIM       12 
P2PTDT06  DIM       12 
P2PTDT07  DIM       20 
P2PTDT08  DIM       20 
P2PTDT09  DIM       20 
P2PTDT10  DIM       20 
P2PTDT11  DIM       20 
P2PTDT12  DIM       12 
P2PTDT13  DIM       20 
P2PTDT14  DIM       20 
P2PTDT15  DIM       20 
P2PTDT16  DIM       20 
P2PTDT17  DIM       20 
P2PTDT18  DIM       20 
P2PTDT19  DIM       20 
P2PTDT20  DIM       20 
P2PTDT21  DIM       12 
P2PTDT22  DIM       20 
P2PTDT23  DIM       20 
P2PTDT24  DIM       20 
P2PTDT25  DIM       20 
P2PTDT26  DIM       20 
P2PTDT27  DIM       20
P2PTDT28  DIM       20 
.
PR2VPM01  DIM       20
PR2VPM02  DIM       20
PR2VPM03  DIM       20
PR2VPM04  DIM       8
PR2VPM05  DIM       1
PR2VPM06  DIM       1
PR2VPM07  DIM       1
PR2VPM08  DIM       20
PR2VPM09  FORM      6.2
PR2VPM10  FORM      6
PR2VPM11  DIM       6
PR2VPM12  DIM       8
PR2VPM13  DIM       19
.
.  PRS2 Account Status File Maintenance                                *I-60167
.
PTACC001  DIM       3     * Claim Code (CL)
PTACC002  DIM       3     * Admission Type (A)
PTACC003  FORM      3     * Highest Day in Period
PTACC004  DIM       3     * Current Year Account Status
PTACC005  DIM       3     * Previous Year Account Status
PTACC006  DIM       3     * Global Copy From Claim Code (CL)
PTACC007  DIM       3     * Global Copy From Admission Type (A)
PTACC008  DIM       3     * Global Copy To Claim Code (CL)
PTACC009  DIM       3     * Global Copy To Admission Type (A)
PTACC010  DIM       3     * Global Delete Claim Code (CL)
PTACC011  DIM       3     * Global Delete Admission Type (A)
.
.  PRS2 Account Status Validation File Maintenance                     *I-60167
.
PTACT001  DIM       3     * Account Class
PTACT002  DIM       1     * Accomodation Type
PTACT003  DIM       2     * Care Type
PTACT004  FORM      2     * Medicare Suffix
.
.  Medicare Suffix Constants
.
SUFDESC   DIM       24
SUF1      INIT      "N-E                     "
SUF2      INIT      "Name, C-U               "
SUF3      INIT      "Name, C-U, BAB          "
SUF4      INIT      "Name, C-U, BAB, P-N     "
SUF5      INIT      "Name, C-U, BAB, P-N, N-E"
SUF6      INIT      "Name, C-U, N-E          "
SUF7      INIT      "Name, C-U, BAB, N-E     "
SUF8      INIT      "C-U                     "
SUF9      INIT      "Name, P-N               "
SUF10     INIT      "Name, C-U, N-E, P-N     "
.
FBOKDATE  DIM       12
FADMDATE  DIM       12
FADMDTTM  DIM        8
FDSCDATE  DIM       12
PRFMDATE  DIM       12
PRTODATE  DIM       12
PRCRDATE  DIM       12
PRLEDATE  DIM       12
PRTPDATE  DIM       8
DISCHDAT  DIM       12
ADMINDAT  DIM       12
DISUNIT   DIM       25
DISDEST   DIM       25 
VISLSTNO  DIM       8[99]         * list of visit numbers
VISNOCNT  FORM      3             * count for vislstno
.
.  WA HMDS Extract
.
CURRDATE  DATE      8
DMON01    INIT      "Jan"
DMON02    INIT      "Feb"
DMON03    INIT      "Mar"
DMON04    INIT      "Apr"
DMON05    INIT      "May"
DMON06    INIT      "Jun"
DMON07    INIT      "Jul"
DMON08    INIT      "Aug"
DMON09    INIT      "Sep"
DMON10    INIT      "Oct"
DMON11    INIT      "Nov"
DMON12    INIT      "Dec"
DMONLN01  INIT      "January"
DMONLN02  INIT      "February"
DMONLN03  INIT      "March"
DMONLN04  INIT      "April"
DMONLN05  INIT      "May"
DMONLN06  INIT      "June"
DMONLN07  INIT      "July"
DMONLN08  INIT      "August"
DMONLN09  INIT      "September"
DMONLN10  INIT      "October"
DMONLN11  INIT      "November"
DMONLN12  INIT      "December"
EXCRDATE  DIM       11
EXENDDAT  DIM       8        * End date range
EXNORECD  FORM      3        * Number of records
EXSTADAT  DIM       8        * Start date range
EXSTARTN  FORM      3        * Start num for HMDS Extract List
EXSTATUS  DIM       11       * Extract Status (date or 'Waiting')
FDATFORM  FORM      1        * Fomrat of month name (0=short 1=long)
FDATREST  DIM       20       * Formated date string (dd MMM yyyy)
FDATSTRN  DIM       8        * Date string (ccyymmdd)
FMNTHNAM  DIM       10       * Month name
SAVESDAT  DIM       8        * Saved start date
SHOWCURR  FORM      1        * show current extract
VISITDAT  DIM       8        * Patient visit date
WAEXSDAT  DIM       11       * HMDS Extract Start Date (formatted date string)
WAEXEDAT  DIM       11       * HMDS Extract End Date (formatted date string)
.
.----------------------------------------------------------------------
. Program Variables
.----------------------------------------------------------------------
CFILEPRE  DIM       3   * Current Open File Prefix for Outpatient Files
PATLINK   DIM       127                     * changed from PSRLINK for compil.
PSTPDATE  DIM       8
DIM2A     DIM       2
DIM2B     DIM       2
FBOKDTTM  DIM       24
AT        INIT      "at"
COLDAT04  DIM       30
.    adding
DOBDESC   DIM       35
PBYEAR    DIM       4     * Public Holiday Year
SCHDLDAY  DIM       1       * Day Indicator
UPDATETY  FORM      1
UNIQNUM   DIM       3
DLINKTEM  DIM       3
DLINKREP  DIM       2
DLINKPRG  DIM       8
FORM8     FORM      8
DOCTCODE  DIM       6
HDPEQUIV  DIM       2
PSAGETYP  DIM       3
PSAGECON  DIM       3
COUNT     FORM      4
YEARSL    FORM      2
DIM4      DIM       4
FORM3     FORM      3
SAVURNO   DIM       8
TEMPVAR   DIM       3
ZEROS     DIM       20
.
. PRS2 PMI Trigger save variables
SAVXABRG  DIM       3             * indig. status
SAVXLNG1  DIM       3             * pref. language
SAVPTYPE  DIM       3             * resident status
SAVXINTR  DIM       1             * interpreter requ.
SAVPPOST  DIM       8             * postcode
.
CATD1     INIT      "D1"
CATD2     INIT      "D2"
CATD3     INIT      "D3"
CATD4     INIT      "D4"
CATD5     INIT      "D5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
.
ASTAT1    INIT      "Pre-admitted        "
ASTAT2    INIT      "Admitted            "
ASTAT3    INIT      "Discharged          "
ASTAT4    INIT      "On-leave            "
ASTAT5    INIT      "Cancelled           "
.
EXTSTAT1  INIT      "Excluded            "
EXTSTAT2  INIT      "Included            "
EXTSTAT3  INIT      "Deleted             "
EXTSTAT4  INIT      "Included and Deleted"
.
REHABDS1  INIT      "First Rehab Admission"
REHABDS2  INIT      "Re-adm. for Rehab"
.----------------------------------------------------------------------
PRGID     INIT      "PRSWEB01"
VERSION   INIT      "V12.00.00"
PRGNAM    INIT      "PRS Extract Enquiries/Maintenance"
.----------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70 
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      P2EXT000        * PRS2 Extract 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      INCEXC00        * Inclusion/Exclusion file
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      P2TRIG00        * PRS/2 PMI Trigger maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      PATACC00        * PRS/2 Account Status Maintenance
          BRANCH    EXIT,MAIN1000                                      *I-60167
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      PATACT00        * PRS/2 Account Status Val Maintenance
          BRANCH    EXIT,MAIN1000                                      *I-60167
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      WAEXT000        * WA Extracts 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      WAEXR000        * WA HMDS Extracts Runs
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      WATRG000        * WA Extract Triggers
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  CALL      INTMAS00
          OPEN      PRSHRDA1,"prshrdaf"
          OPEN      PRSHRDA2,"prshrdaf" 
.
          OPEN      PRSDTLA1,"prsdtlaf"
          OPEN      PRSDTLA2,"prsdtlaf"
          OPEN      PRSPMIA1,"prspmiaf"
          OPEN      PATCODE1,"patcodes" 
          OPEN      PATCODE2,"patcodes"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATECMA1,"patecmaf" 
          OPEN      PATHSPA1,"pathspaf" 
          OPEN      PATMI1A1,"patmi1af" 
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATDSCH3,"patdschf"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PMSWAEA1,"pmswaeaf" 
          OPEN      PMSWTRA1,"pmswtraf" 
          OPEN      PMSWTRA2,"pmswtraf" 
          
          OPEN      PATACCA1,"pataccaf"                                *I-60167
          OPEN      PATACTA1,"patactaf"                                *I-60167
          OPEN      PATICUA1,"paticuaf"
          OPEN      PMSPRDA1,"pmsprdaf" 
          OPEN      PATPEIO1,"patpeiaf" 
          OPEN      PATRDEA1,"patrdeaf" 
          OPEN      PATDADA1,"patdadaf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      CONTROLF,"controlf"
          OPEN      PATVADA1,"patvadaf"
          OPEN      PATWMAB1,"patwmabf"
          OPEN      PATWVET1,"patwvetf"
.
          OPEN      IBAGSTA1,"ibagstaf"
.
          OPEN      PMSQERA1,"pmsqeraf"
.
          READ      CONTROLF,TWENTY1;*46,PTCNBAGE,*209,PTCNADMT
          READ      CONTROLF,EIGHTY8;*116,CHCSDTE
          READ      CONTROLF,EIGHTY8;*124,CHCSST,*132,CHCSED
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND10;*247,PTCNPRSM
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          MATCH     "1",PTCNPRSM
          IF        @EQUAL
            PACK      KEY3,WBSEHOSP,SP70
            CALL      RDPMPRD1
            IF        OVRCD=0
              PACK      CHCSST,PMPRSDAT,SP70
              PACK      CHCSED,PMPREDAT,SP70
            ENDIF
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
INIT9999  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,SHOWYEAR
          MOVE      SP70,PBYEAR
          MOVE      SP70,SCHDLDAY
          MOVE      SP70,STARTKEY
          MOVE      SP70,URNUMBER
          MOVE      SP70,ADMISSNO
          MOVE      SP70,PRSSDATE
          MOVE      ZERO,PTPEI001
          MOVE      SP70,PTPEI002
          MOVE      SP70,PTPEI003
          MOVE      Z70,PR2VPM01
          MOVE      Z70,PR2VPM02
          MOVE      Z70,PR2VPM03
          MOVE      Z70,PR2VPM04
          MOVE      Z70,PR2VPM05
          MOVE      Z70,PR2VPM06
          MOVE      Z70,PR2VPM07
          MOVE      Z70,PR2VPM08
          MOVE      ZERO,PR2VPM09
          MOVE      ZERO,PR2VPM10
          MOVE      Z70,PR2VPM11
          MOVE      Z70,PR2VPM12
          MOVE      Z70,PR2VPM13
          MOVE      Z70,EXTRACTN
          MOVE      Z70,HOSPCODE
.
          MOVE      ONE,VISNOCNT
          WHILE     VISNOCNT <=99
            PACK      VISLSTNO[VISNOCNT],SP70
            ADD       ONE,VISNOCNT
          DO
          MOVE      ZERO,VISNOCNT
.
          MOVE      Z70,PTACC001                                       *I-60167
          MOVE      Z70,PTACC002                                       *I-60167
          MOVE      ZERO,PTACC003                                      *I-60167
          MOVE      Z70,PTACC004                                       *I-60167
          MOVE      Z70,PTACC005                                       *I-60167
          MOVE      Z70,PTACC006                                       *I-60167
          MOVE      Z70,PTACC007                                       *I-60167
          MOVE      Z70,PTACC008                                       *I-60167
          MOVE      Z70,PTACC009                                       *I-60167
          MOVE      Z70,PTACC010                                       *I-60167
          MOVE      Z70,PTACC011                                       *I-60167
.
          MOVE      Z70,PTACT001                                       *I-60167
          MOVE      Z70,PTACT002                                       *I-60167
          MOVE      Z70,PTACT003                                       *I-60167
          MOVE      ZERO,PTACT004                                      *I-60167
.
          MOVE      ZERO,KEYSTCNT
          MOVE      ZERO,F3
CLRPAR10  ADD       ONE,F3       * Clear Key Strokes Array
          IF        F3<=95
            PACK      KEYSTARR[F3],SP70,SP70
            GOTO      CLRPAR10
          ENDIF
.
          MOVE      SP70,SCHDPRNT
          MOVE      ZERO,SCHDCOPY
          MOVE      ZERO,SCHDTYPE
          MOVE      SP70,SCHDDATE
          MOVE      SP70,SCHDTIME
.
          MOVE      SP70,EXSTADAT
          MOVE      SP70,EXENDDAT
          MOVE      SP70,VISITDAT
          MOVE      ZERO,EXNORECD
          MOVE      ZERO,EXSTARTN
          MOVE      ZERO,SHOWCURR
          MOVE      SP70,FILTHOSP
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HOSPCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "extractn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXTRACTN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filteryr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTERYR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filthosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prsrunno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRSRUNNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prssdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRSSDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptpei001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTPEI001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptpei002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTPEI002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptpei003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTPEI003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pr2vpm",QRYNAME
          IF        @EQUAL
            CALL      SPPR2000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "vislstno=",QRYNAME
          IF        @EQUAL
            COMPARE   "99",VISNOCNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,VISNOCNT
            PACK      VISLSTNO[VISNOCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptacc",QRYNAME                                    *I-60167
          IF        @EQUAL
            CALL      STACC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME                                *I-60167
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptact",QRYNAME                                    *I-60167
          IF        @EQUAL
            CALL      STACT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keystr",QRYNAME
          IF        @EQUAL
            MATCH     "Ignore",QRYDATA
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,KEYSTCNT
            PACK      KEYSTARR[KEYSTCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdprn",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDPRNT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdcop",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,SCHDCOPY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schddate=",QRYNAME
          IF        @EQUAL
            PACK      QRYDATA,QRYDATA,SP70
            MATCH     SP70,QRYDATA
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00        * Set CMON from MTHNAM3
              PACK      SCHDDATE,CCENT,CYEAR,CMON,CDAY
              REP       " 0",SCHDDATE
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdtime=",QRYNAME
          IF        @EQUAL
            PACK      QRYDATA,QRYDATA,SP70
            MATCH     SP70,QRYDATA
            IF        !@EQUAL
              MOVE      QRYDATA,SCHDTIME   * Schedule Time (Blank for Immediate)
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exstadat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXSTADAT     * WA Extract start date range
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exenddat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXENDDAT     * WA Extract end date range
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showcurr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWCURR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exstartn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXSTARTN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exnorecd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXNORECD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "visitdat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VISITDAT
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------
.   Set Parameters for PRS/2 Visit PMI fields
.------------------------------------------------------------
SPPR2000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY6,KEY2
          MOVE      KEY2,F2
          BRANCH    F2,SPPR2010,SPPR2020,SPPR2030,SPPR2040,SPPR2050:
                       SPPR2060,SPPR2070,SPPR2080,SPPR2090,SPPR2100:
                       SPPR2110,SPPR2120,SPPR2130
.
          MOVE      ONE,EXIT
          GOTO      SPPR2999
.
SPPR2010  MOVE      QRYDATA,PR2VPM01
          GOTO      SPPR2999
.
SPPR2020  MOVE      QRYDATA,PR2VPM02
          GOTO      SPPR2999
.
SPPR2030  MOVE      QRYDATA,PR2VPM03
          GOTO      SPPR2999
.
SPPR2040  MOVE      QRYDATA,PR2VPM04
          GOTO      SPPR2999
.
SPPR2050  MOVE      QRYDATA,PR2VPM05
          GOTO      SPPR2999
.
SPPR2060  MOVE      QRYDATA,PR2VPM06
          GOTO      SPPR2999
.
SPPR2070  MOVE      QRYDATA,PR2VPM07
          GOTO      SPPR2999
.
SPPR2080  MOVE      QRYDATA,PR2VPM08
          GOTO      SPPR2999
.
SPPR2090  MOVE      QRYDATA,PR2VPM09
          GOTO      SPPR2999
.
SPPR2100  MOVE      QRYDATA,PR2VPM10
          GOTO      SPPR2999
.
SPPR2110  MOVE      QRYDATA,PR2VPM11
          GOTO      SPPR2999
.
SPPR2120  MOVE      QRYDATA,PR2VPM12
          GOTO      SPPR2999
.
SPPR2130  MOVE      QRYDATA,PR2VPM13
          GOTO      SPPR2999
.
SPPR2999  RETURN
+
.-------------------------------------------------------------------------------
. Option 4 : Set Parameters for PRS2 Account Status Maintenance        *I-60167
.-------------------------------------------------------------------------------
STACC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STACC001,STACC002,STACC003,STACC004,STACC005:
                       STACC006,STACC007,STACC008,STACC009,STACC010:
                       STACC011
.
          MOVE      ONE,EXIT
          GOTO      STACC999
.
STACC001  MOVE      QRYDATA,PTACC001
          GOTO      STACC999
.
STACC002  MOVE      QRYDATA,PTACC002
          GOTO      STACC999
.
STACC003  MOVE      QRYDATA,PTACC003
          GOTO      STACC999
.
STACC004  MOVE      QRYDATA,PTACC004
          GOTO      STACC999
.
STACC005  MOVE      QRYDATA,PTACC005
          GOTO      STACC999
.
STACC006  MOVE      QRYDATA,PTACC006
          GOTO      STACC999
.
STACC007  MOVE      QRYDATA,PTACC007
          GOTO      STACC999
.
STACC008  MOVE      QRYDATA,PTACC008
          GOTO      STACC999
.
STACC009  MOVE      QRYDATA,PTACC009
          GOTO      STACC999
.
STACC010  MOVE      QRYDATA,PTACC010
          GOTO      STACC999
.
STACC011  MOVE      QRYDATA,PTACC011
          GOTO      STACC999
.
STACC999  RETURN
.-----------------------------------------------------------------     *I-60167
. Moves cgi variables into file variables (PRS2 Account Status Maintenance)
.-----------------------------------------------------------------
ACCSAV00  MATCH     PTACC001,Z70
          IF        !@EQUAL
            MOVE      PTACC001,PTASCLAM
          ENDIF
.
          MATCH     PTACC002,Z70
          IF        !@EQUAL
            MOVE      PTACC002,PTASATYP
          ENDIF
.
.         MATCH     PTACC003,Z70
.         IF        !@EQUAL
.           SQUEEZE   PTACC003
            MOVE      PTACC003,PTASHDAY
.         ENDIF
.
          MATCH     PTACC004,Z70
          IF        !@EQUAL
            MOVE      PTACC004,PTASACCS
          ENDIF
.
          MATCH     PTACC005,Z70
          IF        !@EQUAL
            MOVE      PTACC005,PTASPRAC
          ENDIF
.
ACCSAV99  RETURN
.------------------------------------------------------------
. Checks mandatory fields (PRS2 Account Status Maintenance)            *I-60167
.------------------------------------------------------------
CHKACC00  RESET     PTACC001
          MATCH     SP70,PTACC001
          GOTO      CHKACC90 IF EQUAL
.
          RESET     PTACC002
          MATCH     SP70,PTACC002
          GOTO      CHKACC91 IF EQUAL
.
.         RESET     PTACC003
.         MATCH     SP70,PTACC003
.         GOTO      CHKACC92 IF EQUAL
.
          RESET     PTACC004
          MATCH     SP70,PTACC004
          GOTO      CHKACC93 IF EQUAL
.
          RESET     PTACC005
          MATCH     SP70,PTACC005
          GOTO      CHKACC94 IF EQUAL
.
          GOTO      CHKACC98
.
CHKACC90  MOVE      "Claim Code is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKACC99
.
CHKACC91  MOVE      "Admission Type is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKACC99
.
.CHKACC92  MOVE      "Highest Day in Period is mandatory",WEBTITLE
.          CALL      WEBERR00
.          MOVE      ONE,EXIT
.          GOTO      CHKACC99
.
CHKACC93  MOVE      "Currenct Year Account Status is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKACC99
.
CHKACC94  MOVE      "Previous Year Account Status is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKACC99
.
CHKACC98  MOVE      ZERO,EXIT
CHKACC99  RETURN
.-------------------------------------------------------------------------------
. Option 5 : Set Parameters for PRS2 Account Status Val Maintenance    *I-60167
.-------------------------------------------------------------------------------
STACT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STACT001,STACT002,STACT003,STACT004
.
          MOVE      ONE,EXIT
          GOTO      STACT999
.
STACT001  MOVE      QRYDATA,PTACT001
          GOTO      STACT999
.
STACT002  MOVE      QRYDATA,PTACT002
          GOTO      STACT999
.
STACT003  MOVE      QRYDATA,PTACT003
          GOTO      STACT999
.
STACT004  MOVE      QRYDATA,PTACT004
          GOTO      STACT999
.
STACT999  RETURN
.-----------------------------------------------------------------     *I-60167
. Moves cgi variables into file variables (PRS2 Account Status Val Maintenance)
.-----------------------------------------------------------------
ACTSAV00  MATCH     PTACT001,Z70
          IF        !@EQUAL
            MOVE      PTACT001,PTACCLSS
          ENDIF
.
          MATCH     PTACT002,Z70
          IF        !@EQUAL
            MOVE      PTACT002,PTACACCM
          ENDIF
.
          MATCH     PTACT003,Z70
          IF        !@EQUAL
            MOVE      PTACT003,PTACCARE
          ENDIF
.
          COMPARE   PTACT004,ZERO
          IF        !@EQUAL
            MOVE      PTACT004,PTACMEDI
          ENDIF
.
ACTSAV99  RETURN
.------------------------------------------------------------
. Checks mandatory fields (PRS2 Account Status Val Maintenance)        *I-60167
.------------------------------------------------------------
CHKACT00  RESET     PTACT001
          MATCH     SP70,PTACT001
          GOTO      CHKACT90 IF EQUAL
.
          COMPARE   ZERO,PTACT004
          GOTO      CHKACT93 IF EQUAL
.
          GOTO      CHKACT98
.
CHKACT90  MOVE      "Account Class is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKACT99
.
CHKACT93  MOVE      "Medicare Suffix is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKACT99
.
CHKACT98  MOVE      ZERO,EXIT
CHKACT99  RETURN
.------------------------------------------------------------
. Update PRS/2 Visit PMI Details
.------------------------------------------------------------
UPPR2000  MATCH     PR2VPM01,Z70
          IF        !@EQUAL
            MOVE      PR2VPM01,PVIRESI
          ENDIF
.
          MATCH     PR2VPM02,Z70
          IF        !@EQUAL
            MOVE      PR2VPM02,PMVXABRG
          ENDIF
.
          MATCH     PR2VPM03,Z70
          IF        !@EQUAL
            MOVE      PR2VPM03,PMVXPIND
          ENDIF
.
          MATCH     PR2VPM04,Z70
          IF        !@EQUAL
            MOVE      PR2VPM04,PMVXPOST
          ENDIF
.
          MATCH     PR2VPM05,Z70
          IF        !@EQUAL
            MOVE      PR2VPM05,PMVXCSNR
          ENDIF
.
          MATCH     PR2VPM06,Z70
          IF        !@EQUAL
            MOVE      PR2VPM06,PMVXHOME
          ENDIF
.
          MATCH     PR2VPM07,Z70
          IF        !@EQUAL
            MOVE      PR2VPM07,PMVXINTR
          ENDIF
.
          MATCH     PR2VPM08,Z70
          IF        !@EQUAL
            MOVE      PR2VPM08,PMVXLNG1
          ENDIF
.
          COMPARE   PR2VPM09,ZERO
          IF        !@EQUAL
            MULT      "100",PR2VPM09
            MOVE      PR2VPM09,PMVXPWGT
          ENDIF
.
          COMPARE   PR2VPM10,ZERO
          IF        !@EQUAL
            MOVE      PR2VPM10,PMVXPHGT
          ENDIF
.
          MATCH     PR2VPM11,Z70
          IF        !@EQUAL
            MOVE      PR2VPM11,AFUNDH
          ENDIF
.
          MATCH     PR2VPM12,Z70
          IF        !@EQUAL
            MOVE      PR2VPM12,AFNDTB
          ENDIF
.
          MATCH     PR2VPM13,Z70
          IF        !@EQUAL
            MOVE      PR2VPM13,AFNDMM
          ENDIF
.
          CALL      UPVISA1                 * update visit file
          CALL      UPPMVX11                * update visit extension file
          CALL      UPMISS1                 * update admission file
.
          CALL      WPEI0000                * write 'include' record to patpeiaf
.
UPPR2999  RETURN
+
.******************************************************************************
.*                                 WPEI0000                                   *
.*                        Write A Record To patpeiaf                          *
.******************************************************************************
WPEI0000  MOVE      "14",HDPEQUIV           * include reason=PMI change
          READ      CONTROLF,EIGHTY8;*116,CHCSDTE,*124,CHCSST,*132,CHCSED
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
.
          MATCH     "1",PTCNPRSM
          IF        @EQUAL
            PACK      KEY3,WBSEHOSP,SP70
            CALL      RDPMPRD1
            IF        OVRCD=0
              PACK      CHCSST,PMPRSDAT,SP70
              PACK      CHCSED,PMPREDAT,SP70
            ENDIF
          ENDIF
.
          COMPARE   THREE,PTCNHDPS
          GOTO      WPEI9999 IF NOT EQUAL   * Not in Victoria
.
          COMPARE   THREE,ASTAT
          GOTO      WPEI9999 IF NOT EQUAL   * Not discharged
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDDSCH1
          BRANCH    OVRCD,WPEI9999
.
          MATCH     CHCSDTE,DDATE
          GOTO      WPEI9999 IF LESS        * Discharge date < start HDP date
.
          MATCH     CHCSST,ADATE
          GOTO      WPEI9999 IF NOT LESS    * Adm date >= PRS2 extract start dte
.
          PACK      KEY16,SP8,AADMNO
          CALL      RDPTPEI1                * Read a PRS2 inc/exc file record
          COMPARE   ONE,OVRCD
          GOTO      WPEI9999 IF NOT EQUAL   * Record exists, dont write
.
          PACK      KEY16,CHCSST,AADMNO
          CALL      RDPTPEI1                * Read a PRS2 inc/exc file record
          COMPARE   ONE,OVRCD
          GOTO      WPEI9999 IF NOT EQUAL   * Record exists, dont write
.
          MOVE      SP8,PTPESTDT
          MOVE      AADMNO,PTPEADMN
          MOVE      TWO,PTPESTAT
          CALL      IBACLOCK                * Get the current date
          PACK      PTPEDATE,CCC,CYY,CMM,CDD
          REP       " 0",PTPEDATE
          MOVE      PASSCODE,PTPEOPER
.
          MOVE      SP3,PTPERESN
          PACK      KEY5,ANSR,ANSN,SP3
          CALL      RDSCODE1                * Position on & read a codes file
WPEI1000  CALL      RDKCODE1                  record
          BRANCH    OVRCD,WPEI2000
.
          MATCH     "RN",TCODE
          GOTO      WPEI2000 IF NOT EQUAL   * Different category
.
          MATCH     HDPEQUIV,THCSCOD
          GOTO      WPEI1000 IF NOT EQUAL   * Different HDP equivalent
.
          MOVE      ACODE,PTPERESN
.
WPEI2000  PACK      KEY16,PTPESTDT,PTPEADMN,SP70
          CALL      WRPTPEI1                * Write a PRS2 inc/exc file record
.
WPEI9999  RETURN
+
.*************************************************************************
.                           PRS Extract
.*************************************************************************
P2EXT000  MATCH     SP8,URNUMBER
          GOTO      P2EXT200 IF EQUAL
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,P2EXT950
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,P2EXT950
.
          MATCH     "006",TEMPLATE
          GOTO      P2EXT200 IF EQUAL
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,P2EXT960
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,P2EXT970
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,P2EXT970
.
          MATCH     ANSU,UPDTTYPE
          IF        @EQUAL
            CALL      UPPR2000            * update visit pmi details
            GOTO      P2EXT999
          ENDIF
.
          PACK      KEY18,ADMISSNO,Z70
          CALL      RSPTECM1
          CALL      RPPTECM1
          BRANCH    OVRCD,P2EXT005
.
          MATCH     ADMISSNO,DPTEMADM
          IF        !@EQUAL
P2EXT005    MOVE      SP70,PTEMCDTE
          ENDIF
.
          PACK      KEY10,ADMISSNO,SP70     * first record from sub acute
          CALL      RSPTRDE1
          CALL      RKPTRDE1
          BRANCH    OVRCD,P2EXT010
.
          MATCH     ADMISSNO,DPTRDADM
          GOTO      P2EXT015 IF EQUAL
.
P2EXT010  MOVE      SP70,PTRDARTR
          MOVE      SP70,PTRDCLSP
          MOVE      SP70,PTRDODTE
          MOVE      ZERO,PTRDBISA
          MOVE      ZERO,PTRDBISD
.
P2EXT015  MOVE      SP70,P2PTDT05
          MOVE      SP70,P2PTDT06
          PACK      KEY18,ADMISSNO,Z70
          CALL      RSP2DTL2
          CALL      RPP2DTL2
          BRANCH    OVRCD,P2EXT020
.
          MATCH     ADMISSNO,P2DTADMN
          GOTO      P2EXT020 IF NOT EQUAL
.
          MATCH     SP70,P2DTEPSD
          IF        !@EQUAL
            UNPACK    P2DTEPSD,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT:
                      NOV,DEC
            PACK      P2PTDT05,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MATCH     SP70,P2DTCODD
          IF        !@EQUAL
            UNPACK    P2DTCODD,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT:
                      NOV,DEC
            PACK      P2PTDT06,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          GOTO      P2EXT050
.
P2EXT020  MOVE      SP70,P2DTEPSS
          MOVE      SP70,P2DTCODS
          MOVE      SP70,P2DTEPSD
          MOVE      SP70,P2DTCODD

P2EXT050  PACK      KEY8,ADMISSNO,SP70
          CALL      RDDSCH1
          IF        OVRCD<>0
            CALL      CLRDIS00
            CALL      CLRTRN00
            GOTO      P2EXT200
          ENDIF
.
          PACK      KEY30,ADMISSNO,Z70
          CALL      RDSTRAN2
          CALL      RDPTRAN2
          BRANCH    OVRCD,P2EXT100
.
          MATCH     DTADMN,ADMISSNO
          GOTO      P2EXT100 IF NOT EQUAL
.
          MATCH     ANSD,TMOVE
          GOTO      P2EXT200 IF EQUAL
.
P2EXT100  CALL      CLRTRN00
          
P2EXT200  CLEAR     WEBTITLE
          MOVE      "PRS2 Listing/Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,P2EXT999
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      P2EXT999
.
P2EXT950  MOVE      "Can't Find U/R",WEBTITLE
          CALL      WEBERR00
          GOTO      P2EXT999
.
.
P2EXT960  MOVE      "Invalid admission number.",WEBTITLE
          CALL      WEBERR00
          GOTO      P2EXT999
.
P2EXT970  MOVE      "Missing visit extension record.",WEBTITLE
          CALL      WEBERR00
          GOTO      P2EXT999
.
P2EXT980  MOVE      "Missing visit record.",WEBTITLE
          CALL      WEBERR00
          GOTO      P2EXT999
.
P2EXT999  RETURN
.*************************************************************************
.                           PRS Extract
.*************************************************************************
INCEXC00  MOVE      ZERO,EXIT
          CALL      CLPATMAS
          CALL      CLPATMIS
.
          MATCH     SP70,UPDTTYPE
          GOTO      INCEXC50 IF EQUAL
.
          MATCH     ANSA,UPDTTYPE         * add patient
          GOTO      INCEXC10 IF EQUAL 
.
          MATCH     ANSD,UPDTTYPE         * delete patient
          GOTO      INCEXC20 IF EQUAL 
.
          GOTO      INCEXC90
.
INCEXC10  CALL      ADDP0000
          GOTO      INCEXC99
.
INCEXC20  CALL      DELP0000
          GOTO      INCEXC99
.
INCEXC50  MATCH     SP70,ADMISSNO
          GOTO      INCEXC55 IF EQUAL
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,INCEXC91
.
          PACK      KEY8,AURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,INCEXC92
.
          PACK      KEY16,SP8,ADMISSNO
          CALL      RDPTPEI1
.
INCEXC55  CLEAR     WEBTITLE
          MOVE      "Inclusion/Exclusion maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,INCEXC99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      INCEXC99
.
INCEXC90  MOVE      "Invalid update type",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDP9999
.
INCEXC91  MOVE      "Invalid admission number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDP9999
.
INCEXC92  MOVE      "Invalid UR number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDP9999
.
INCEXC99  RETURN
+
.*************************************************************************
.         ADDP0000 -  Add patient to patpeiaf
.*************************************************************************
ADDP0000  MATCH     SP8,ADMISSNO
          GOTO      ADDP9000 IF EQUAL
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,ADDP9000
.
          READ      CONTROLF,EIGHTY8;*124,CHCSST,*132,CHCSED
          MATCH     "1",PTCNPRSM
          IF        @EQUAL
            PACK      KEY3,WBSEHOSP,SP70
            CALL      RDPMPRD1
            IF        OVRCD=0
              PACK      CHCSST,PMPRSDAT,SP70
              PACK      CHCSED,PMPREDAT,SP70
            ENDIF
          ENDIF
          PACK      KEY16,SP8,ADMISSNO,SP70
          CALL      RDPTPEI1
          IF        OVRCD=0
            GOTO      ADDP9100
          ENDIF
.
          BRANCH    PTPEI001,ADDP1000,ADDP2000,ADDP3000,ADDP3500
.                              Excl     Incl    Del     Inc&Del
          GOTO      ADDP9000
.
ADDP1000  IF        ASTAT=2|ASTAT=4
            GOTO      ADDP4000               * current admission
          ENDIF
.
          IF        ASTAT=3
            PACK      KEY8,ADMISSNO,SP70
            CALL      RDDSCH1                * discharged within the period
            BRANCH    OVRCD,ADDP9400
            MATCH     DDATE,CHCSST
            GOTO      ADDP9500 IF NOT LESS
            GOTO      ADDP4000
          ENDIF
.
          GOTO      ADDP9500
.
ADDP2000  PACK      KEY8,ADMISSNO,SP70
          CALL      RDDSCH1
          BRANCH    OVRCD,ADDP9400
.
          MATCH     DDATE,CHCSST             * before current period
          GOTO      ADDP9300 IF LESS
.
          MATCH     DDATE,CHCSDTE            * after PRS2 reset date
          GOTO      ADDP4000 IF EQUAL
          GOTO      ADDP9600 IF NOT LESS
          GOTO      ADDP4000
.
ADDP3000  IF        ASTAT=1|ASTAT=5
            GOTO      ADDP4000
          ENDIF
.
          IF        ASTAT=3
            PACK      KEY8,ADMISSNO,SP70
            CALL      RDDSCH1                * discharged after prs2 reset date
            BRANCH    OVRCD,ADDP9400
            MATCH     DDATE,CHCSDTE
            GOTO      ADDP4000 IF EQUAL
            GOTO      ADDP9600 IF NOT LESS
            GOTO      ADDP4000
          ENDIF
.
          GOTO      ADDP9600
.
ADDP3500  PACK      KEY8,ADMISSNO,SP70
          CALL      RDDSCH1
          BRANCH    OVRCD,ADDP9400
.
          MATCH     DDATE,CHCSST             * before current period
          GOTO      ADDP9300 IF LESS
.
          MATCH     DDATE,CHCSDTE            * after PRS2 reset date
          GOTO      ADDP4000 IF EQUAL
          GOTO      ADDP9600 IF NOT LESS
.
ADDP4000  PACK      PTPESTDT,SP70
          MOVE      ADMISSNO,PTPEADMN
          MOVE      PTPEI001,PTPESTAT
          MOVE      PTPEI002,PTPERESN
          CALL      IBACLOCK                * Get the current date
          PACK      PTPEDATE,CCC,CYY,CMM,CDD
          REP       " 0",PTPEDATE
          MOVE      PASSCODE,PTPEOPER       * operator Id
.
          CALL      WRPTPEI1
          GOTO      ADDP9999
.
ADDP9000  MOVE      "Invalid admission number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDP9999
.
ADDP9100  MOVE      "Already on file.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDP9999
.
ADDP9200  MOVE      "Invalid Extract Status.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDP9999
.
ADDP9300  CLEAR     WEBTITLE
          APPEND    "Patient must be discharged prior ",WEBTITLE
          APPEND    "to current extract.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDP9999
.
ADDP9400  MOVE      "Missing discharge record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDP9999
.
ADDP9500  CLEAR     WEBTITLE
          APPEND    "Must be current admission or discharged ",WEBTITLE
          APPEND    "in the period",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDP9999
.
ADDP9600  MOVE      "Must be discharged after PRS2 reset date",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDP9999
.
ADDP9999  RETURN
.*************************************************************************
.         DELP0000 -  Delete patient from patpeiaf
.*************************************************************************
DELP0000  PACK      KEY16,PTPEI003,ADMISSNO,SP70
          CALL      RDPTPEI1
          BRANCH    OVRCD,DELP9000
.
          CALL      DEPTPEI1
          GOTO      DELP9999
.
DELP9000  MOVE      "Missing patpeiaf record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DELP9999
.
DELP9999  RETURN
+
.*************************************************************************
.                      PRS/2 PMI Trigger maintenance
.*************************************************************************
P2TRIG00  MOVE      ZERO,EXIT
          CALL      CLPATMAS
          CALL      CLPATMIS
          PACK      P2PMVALU,SP70
.
          MATCH     SP70,UPDTTYPE
          GOTO      P2TRIG50 IF EQUAL
.
          MATCH     ANSU,UPDTTYPE         * update
          GOTO      P2TRIG20 IF EQUAL
.
          GOTO      P2TRIG90
.
P2TRIG20  CALL      UPTRG000
          GOTO      P2TRIG99
.
P2TRIG50  MATCH     SP70,URNUMBER
          GOTO      P2TRIG60 IF EQUAL
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,P2TRIG91
.
P2TRIG60  CLEAR     WEBTITLE
          MOVE      "PRS/2 PMI Trigger Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,P2TRIG99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      P2TRIG99
.
P2TRIG90  MOVE      "Invalid update type.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      P2TRIG99
.
P2TRIG91  MOVE      "Invalid UR number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      P2TRIG99
.
P2TRIG99  RETURN
+
.*************************************************************************
.         UPTRG000 -  Update patient on prspmiaf
.*************************************************************************
UPTRG000  MOVE      "14",HDPEQUIV           * include reason=PMI change
          MOVE      ZERO,VISNOCNT
.
. Add the selected visits for the u/r to patpeiaf
.
UPTRG050  ADD       ONE,VISNOCNT
          MATCH     SP8,VISLSTNO[VISNOCNT]
          GOTO      UPTRG500 IF EQUAL       * finished including visits
.
          PACK      KEY8,VISLSTNO[VISNOCNT],SP70
          CALL      RDMISS1
          BRANCH    OVRCD,UPTRG050
.
          READ      CONTROLF,EIGHTY8;*124,CHCSST

          PACK      KEY16,SP8,VISLSTNO[VISNOCNT]
          CALL      RDPTPEI1                * Read a PRS2 inc/exc file record
          COMPARE   ONE,OVRCD
          GOTO      UPTRG050 IF NOT EQUAL   * Record exists, dont write
.
          PACK      KEY16,CHCSST,VISLSTNO[VISNOCNT]
          CALL      RDPTPEI1                * Read a PRS2 inc/exc file record
          COMPARE   ONE,OVRCD
          GOTO      UPTRG050 IF NOT EQUAL   * Record exists, dont write
.
          MOVE      SP8,PTPESTDT
          MOVE      VISLSTNO[VISNOCNT],PTPEADMN
          MOVE      TWO,PTPESTAT            * write 'include' record
          CALL      IBACLOCK                * Get the current date
          PACK      PTPEDATE,CCC,CYY,CMM,CDD
          REP       " 0",PTPEDATE
          MOVE      PASSCODE,PTPEOPER
.
          MOVE      SP3,PTPERESN
          PACK      KEY5,ANSR,ANSN,SP3
          CALL      RDSCODE1                * Position on & read a codes file
UPTRG100  CALL      RDKCODE1                  record
          BRANCH    OVRCD,UPTRG200
.
          MATCH     "RN",TCODE
          GOTO      UPTRG200 IF NOT EQUAL   * Different category
.
          MATCH     HDPEQUIV,THCSCOD
          GOTO      UPTRG100 IF NOT EQUAL   * Different HDP equivalent
.
          MOVE      ACODE,PTPERESN
.
UPTRG200  PACK      KEY16,PTPESTDT,PTPEADMN,SP70
          CALL      WRPTPEI1                * Write a PRS2 inc/exc file record
.
          GOTO      UPTRG050                * get next visit to include
.
. Update visit tables and delete all records from prspmiaf for this u/r
.
UPTRG500  CALL      CPMIT0000                  * clear visit based PMI triggers
          PACK      KEY11,URNUMBER,SP70
          CALL      RSP2PMI1
UPTRG600  CALL      RKP2PMI1
          BRANCH    OVRCD,UPTRG700
.
          MATCH     URNUMBER,P2PMURNO
          GOTO      UPTRG700 IF NOT EQUAL      * same u/r?
.
          CALL      SPMIT000                   * save visit based PMI triggers
.
          PACK      KEY11,P2PMURNO,P2PMUNIQ
          CALL      DEP2PMI1
          GOTO      UPTRG600
.
UPTRG700  CALL      UVISD000                   * update visit tables
UPTRG999  RETURN
+
.----------------------------------------------------------------
.                Clear visit based PMI triggers
.---------------------------------------------------------------
CPMIT000  PACK      SAVXABRG,SP70
          PACK      SAVXLNG1,SP70
          PACK      SAVPTYPE,SP70
          PACK      SAVXINTR,SP70
          PACK      SAVPPOST,SP70
CPMIT999  RETURN
+
.----------------------------------------------------------------
.                Save visit based PMI triggers
.---------------------------------------------------------------
SPMIT000  MATCH     "2",P2PMUNIQ
          IF        @EQUAL
            MOVE      P2PMVALU,SAVXABRG
          ENDIF
          MATCH     "4",P2PMUNIQ
          IF        @EQUAL
            MOVE      P2PMVALU,SAVXLNG1
          ENDIF
          MATCH     "7",P2PMUNIQ
          IF        @EQUAL
            MOVE      P2PMVALU,SAVPTYPE
          ENDIF
          MATCH     "8",P2PMUNIQ
          IF        @EQUAL
            MOVE      P2PMVALU,SAVXINTR
          ENDIF
          MATCH     "10",P2PMUNIQ
          IF        @EQUAL
            MOVE      P2PMVALU,SAVPPOST
          ENDIF
SPMIT999  RETURN
+
.----------------------------------------------------------------
.         Update visit table fields for included visits
.---------------------------------------------------------------
UVISD000  MOVE      ZERO,VISNOCNT
.
UVISD100  ADD       ONE,VISNOCNT
          MATCH     SP8,VISLSTNO[VISNOCNT]
          GOTO      UVISD999 IF EQUAL       * finished
.
          MATCH     SAVPTYPE,SP70
          GOTO      UVISD200 IF EQUAL       * don't update patvisaf
.
          PACK      KEY8,VISLSTNO[VISNOCNT],SP70
          CALL      RDVISA1
          BRANCH    OVRCD,UVISD100          * get next visit to update
.
          MOVE      SAVPTYPE,PVIRESI
          CALL      UPVISA1                 * update visit file
.
UVISD200  PACK      KEY8,VISLSTNO[VISNOCNT],SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,UVISD100          * get next visit to update
.
          MATCH     SAVXABRG,SP70
          IF        !@EQUAL
            MOVE      SAVXABRG,PMVXABRG
          ENDIF
          MATCH     SAVXLNG1,SP70
          IF        !@EQUAL
            MOVE      SAVXLNG1,PMVXLNG1
          ENDIF
          MATCH     SAVXINTR,SP70
          IF        !@EQUAL
            MOVE      SAVXINTR,PMVXINTR
          ENDIF
          MATCH     SAVPPOST,SP70
          IF        !@EQUAL
            MOVE      SAVPPOST,PMVXPOST
          ENDIF
          CALL      UPPMVX11                * update visit extension file
.
          GOTO      UVISD100                * get next visit to update
.
UVISD999  RETURN
+
.----------------------------------------------------------------
.                            Format  Date
.---------------------------------------------------------------
PRSDAT00  UNPACK    PRTPDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          UNPACK    ATIME,DIM2,DIM1,DIM2A
          MOVE      DIM2,F2
          IF        F2>=12
            MOVE      "pm",DIM2B
            IF         F2>=13
              ASSIGN     F2-12,F2
              MOVE       F2,DIM2
            ENDIF
          ELSE
            MOVE      "am",DIM2B
            MOVE      F2,DIM2
          ENDIF
.
          PACK      FBOKDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          PACK      FBOKDTTM,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1:
                             AT,DIM2,DIM1,DIM2B
.
PRSDAT99  RETURN
.
.--------------------------------------------------------------------
.  PRS/2 Extract Patient List TABLE of Admissions in a selected Runs 
.--------------------------------------------------------------------
TASR0000  IF        NORECORD = 0
            MOVE      "50",NORECORD         * number of recirds disp in one scr.
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          PACK      KEY18,PRSRUNNO,SP70
          CALL      RSP2DTL1
TASR0100  CALL      RKP2DTL1                * Read in Unique run number
          BRANCH    OVRCD,TASR9999          * No Unique run number
.
          MATCH     PRSRUNNO,P2DTURUN
          GOTO      TASR9999 IF NOT EQUAL
. 
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TASR0100
          ENDIF
.
          PACK      KEY8,P2DTADMN,SP70
          CALL      RDMISS1                 * Read in the admission record
          BRANCH    OVRCD,TASR0100          * No admission record
.
.                     Admission Date and Patient Name
          MOVE      AURNO,URNUMBER          * URNUMBER used in GETPAT
          CALL      GETPAT00                * Get Patient Details
          CALL      PATLN000                * Format Patient Name
          MOVE      ADATE,PRTPDATE
          CALL      PRSDAT00
          MOVE      FBOKDATE,ADMINDAT
.
.                       Discharge Date and Ward
          PACK      KEY8,P2DTADMN,SP70
          CALL      RDDSCH1                 * get discharge Date/Ward (patdschf)
          BRANCH    OVRCD,TASR0100          * No admission record
          MOVE      DDATE,PRTPDATE
          CALL      PRSDAT00
          MOVE      FBOKDATE,DISCHDAT
.
.                       Discharge Destination
          MOVE      "DD",DIM2
          MATCH     SP3,DDEST
          GOTO      TASR0200 IF EQUAL      
          PACK      KEY5,DIM2,DDEST,SP70
          CALL      RDCODE1                 * get the description (patcode)
          BRANCH    OVRCD,TASR0200          * No admission record
          PACK      DISDEST,THCSCOD,SP1,TDESC
.
.                        Discharge Unit
TASR0200  PACK      DISUNIT,SP70
          PACK      KEY30,P2DTADMN,Z70
          CALL      RDSTRAN2                * get Department (pattranf)
          CALL      RDPTRAN2                 
          BRANCH    OVRCD,TASR0100          * No admission record
          MATCH     "D",TMOVE
          GOTO      TASR0100 IF NOT EQUAL
          MOVE      "AC",DIM2
          MATCH     SP3,TDEPT
          GOTO      TASR0300 IF EQUAL   
          PACK      KEY5,DIM2,TDEPT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,TASR0300
          PACK      DISUNIT,THCSCOD,SP1,TDESC 
.
TASR0300  CALL      TADMSR00                * Display the data
          ADD       ONE,DISNUMB             * DISNUMB is the counter
          COMPARE   NORECORD,DISNUMB        * is the numb of recds to be disp
          GOTO      TASR0100 IF NOT EQUAL               
.
TASR9999  RETURN
.-----------------------------------------------------------------
.        Display PRS/2 Extract Patient List 
.-----------------------------------------------------------------
TADMSR00  REP       " +",P2DTADMN
          REP       " +",URNUMBER
.
.
.          CLEAR     PATLINK
.          APPEND    "prsweb01.pbl?reportno=1",PATLINK
.          APPEND    "&template=4",PATLINK
.          APPEND    "&urnumber=",PATLINK      
.          APPEND    URNUMBER,PATLINK
.          APPEND    "&admissno=",PATLINK
.          APPEND    P2DTADMN,PATLINK
.          RESET     PATLINK
.
          MOVE      "prsweb01",LINKPRG
          MOVE      "01",LINKREP
          MOVE      "004",LINKTEM
.
          CALL      PATFLD00
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&urnumber=",URNUMBER:
                             "&admissno=",P2DTADMN,"#")'>";
          REP       "+ ",P2DTADMN
          REP       "+ ",URNUMBER
..          WRITE     HTMLFILE;"<tr><td><a href=",PATLINK,">";
          WRITE     HTMLFILE;"<img src=../images/PatientFolder",KEY3,".gif ";
          WRITE     HTMLFILE;"hspace=4 border=0 align=absmiddle>";
          WRITE     HTMLFILE;"</a>",PATFNAME," (",PSEX,",";
          CALL      WRTAGE00
          WRITE     HTMLFILE;") </td>":
                             "<td>",P2DTADMN,"</td>":
                             "<td>",ADMINDAT,"</td>":
                             "<td>",DISCHDAT,"</td>":
                             "<td>",DISDEST,"</td>":
                             "<td>",PTDSDWRD,"</td>":
                             "<td>",DISUNIT,"</td></tr>";
.                             
TADMSR99 RETURN
.
.------------------------------------------------------------
. Get Patient
.------------------------------------------------------------
GETPAT00  MATCH     "       0",URNUMBER
          IF        !@EQUAL
            MOVE      URNUMBER,KEY8
            CALL      RDMAST1
            MOVE      OVRCD,MASTFLAG
            MOVE      PURNO,KEY8
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
          ELSE
            CALL      CLPMSPX2
            MOVE      ADMISSNO,KEY8
            CALL      RDPRAM1
            MOVE      OVRCD,MASTFLAG
          ENDIF
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          MOVE      DSEXDESC,DISPSEX
.* ******************************************   End of Changes         *C-49016
.
          MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          IF        OVRCD=0
            UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
            MOVE      ASTAY,ADJDAYS
            CALL      ADJDAT00
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT:
                      NOV,DEC
            PACK      COLDAT04,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF

          UNPACK    PBDATE,CDAY,CMON,CYEAR,CCENT
          IF        PCEASE=1
            MOVE      PDECDTE,AGEDATE            * Date of Death
          ELSE
            PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
          ENDIF
          REP       " 0",AGEDATE
          CALL      CALCAGE

          CALL      PATNAM00
.
GETPAT99  RETURN
.-----------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:      
                             PROFLD60,PROFLD70,PROFLD80
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13,PROFLD14
.
PROFLD11  CALL      MASF0000
          GOTO      PROFLD99 
.
. Year select / Runs for Selected year / Admissions in a selected runs
.
PROFLD12  CALL      RUNS0000    
          GOTO      PROFLD99 
.
.   PRS2 Patient Details
.
PROFLD13  CALL      PATD0000
          GOTO      PROFLD99 
.
.   PRS/2 Visit PMI Details
.
PROFLD14  CALL      VPMI0000
          GOTO      PROFLD99 
.
.   Inclusion Exclusion Details
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22
.
PROFLD21  CALL      PPEI0000 
          GOTO      PROFLD99 
.
PROFLD22  CALL      MASF0000 
          GOTO      PROFLD99 
.
.   PRS/2 PMI Trigger Details
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31,PROFLD32
.
PROFLD31  CALL      PTRG0000 
          GOTO      PROFLD99 
.
PROFLD32  CALL      MASF0000 
          GOTO      PROFLD99 
.
.   PRS/2 Account Status Details                                       *I-60167
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41
.
PROFLD41  CALL      PTAC0000
          GOTO      PROFLD99
.
.   PRS/2 Account Status Validation Details                            *I-60167
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51
.
PROFLD51  CALL      PTAT0000
          GOTO      PROFLD99
.
.   WA Extracts
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61
.
PROFLD61  CALL      WALT0000       * WA Extacts
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71
          GOTO      PROFLD99
.
PROFLD71  CALL      WAEX0000       * WA HMDS Extact List (by hospital & user ID)
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81,PROFLD82
.
PROFLD81  CALL      WAET0000       * WA HMDS Extact Triggers
          GOTO      PROFLD99
.
PROFLD82  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD99  RETURN
..------------------------------------------------------------
. Option 4 : RPRS2 Account Status Maintenance                          *I-60167
.------------------------------------------------------------
PTAC0000  BRANCH    FLDITMNO,PTAC0100,PTAC0200,PTAC0300,PTAC0400,PTAC0500:
                             PTAC0600,PTAC0700,PTAC0800
.
          GOTO      PTAC9999
.
PTAC0100  CALL      ACCTB000   *Table of PRS2 Account Status Maintenance
          GOTO      PTAC9999                                           *I-60167
.
PTAC0200  CALL      NEXTGR00    * Next set of Codes
          GOTO      PTAC9999                                           *I-60167
.
PTAC0300  CALL      PREVGR00    * Prev set of Codes
          GOTO      PTAC9999                                           *I-60167
.
PTAC0400  MOVE      "CL",CATEGORY                                      *I-60167
          MOVE      PTASCLAM,CODE
          CALL      CODITM00
          GOTO      PTAC9999
.
PTAC0500  MOVE      "A ",CATEGORY                                      *I-60167
          MOVE      PTASATYP,CODE
          CALL      CODITM00
          GOTO      PTAC9999
.
PTAC0600  WRITE     HTMLFILE;DPTASDAY;                                 *I-60167
          GOTO      PTAC9999
.
PTAC0700  WRITE     HTMLFILE;PTASACCS;                                 *I-60167
          GOTO      PTAC9999
.
PTAC0800  WRITE     HTMLFILE;PTASPRAC;                                 *I-60167
          GOTO      PTAC9999
.
PTAC9999  RETURN
+
.------------------------------------------------------------
. Option 6 : WA Extract Details
.------------------------------------------------------------
WALT0000  BRANCH    FLDITMNO,WALT0100,WALT0200,WALT0300
.
          GOTO      WALT9999
.
WALT0100  CALL      WAETB000   * Table of WA Extracts
          GOTO      WALT9999
.
WALT0200  CALL      HOSPID00   * Hospital ID selection list
          GOTO      WALT9999
.
WALT0300  WRITE     HTMLFILE;EXTRACTN;
          GOTO      WALT9999
.
WALT9999  RETURN
+
.------------------------------------------------------------
. WA Extract List
.------------------------------------------------------------
WAETB000  MATCH     Z70,HOSPCODE
          GOTO      WAETB999 IF EQUAL
.
          MATCH     Z70,EXTRACTN
          GOTO      WAETB999 IF EQUAL
.
          PACK      KEY27,HOSPCODE,EXTRACTN,SP70
          CALL      RSPMWAE1
WAETB100  CALL      RKPMWAE1
          BRANCH    OVRCD,WAETB999
.
          MATCH     HOSPCODE,PMWAHOSP
          GOTO      WAETB999 IF NOT EQUAL
.
          MATCH     EXTRACTN,PMWAPROG
          GOTO      WAETB999 IF NOT EQUAL
.  
          WRITE     HTMLFILE;"t.addRow(#"",PMWAHOSP,"#",":
                             "#"",PMWAPROG,"#",":
                             "#"",PMWASDAT,"#",":
                             "#"",PMWAEDAT,"#",":
                             "#"",PMWACDAT,"#",":
                             "#"",PMWACTIM,"#",":
                             "#"",PMWAWEBC,"#"":
                             ")"
.
          GOTO      WAETB100
.
WAETB9999 RETURN
+
.------------------------------------------------------------------------------
. Option 7 : WA Extract Run Dates
.------------------------------------------------------------------------------
WAEX0000  BRANCH    FLDITMNO,WAEX0100,WAEX0200,WAEX0300,WAEX0400,WAEX0500
          GOTO      WAEX9999
.
WAEX0100  CALL      WAELT000   * Table of WA Extracts (by Hospital & User ID)
          GOTO      WAEX9999
.
WAEX0200  CALL      NEXTEX00             * Next set of Extract Run Dates
          GOTO      WAEX9999
.
WAEX0300  CALL      PREVEX00             * Prev set of Extract Run Dates
          GOTO      WAEX9999
.
WAEX0400  CALL      HOSPID00             * Hospital ID selection list
          GOTO      WAEX9999

WAEX0500  WRITE     HTMLFILE;EXTRACTN;   * Extract name
          GOTO      WAEX9999
.
WAEX9999  RETURN
+
.******************************************************************************
.*                             WAELT000                   Called by: WAEX0000 *
.*        Output table rows (WA Extract Run Dates) by Hospital ID & User ID   *
.******************************************************************************
WAELT000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      WAEHD000           * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "10",NORECORD    * Set Default num of records to display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     Z70,HOSPCODE
          GOTO      WAELT999 IF EQUAL
.
          MATCH     Z70,EXTRACTN
          GOTO      WAELT999 IF EQUAL
.
          PACK      KEY27,HOSPCODE,EXTRACTN,Z70
          CALL      RSPMWAE1
WAELT100  CALL      RPPMWAE1
          BRANCH    OVRCD,WAELT999
.
          MATCH     HOSPCODE,PMWAHOSP
          GOTO      WAELT999 IF NOT EQUAL
.
          MATCH     EXTRACTN,PMWAPROG
          GOTO      WAELT999 IF NOT EQUAL
.
.>>>>     MATCH     WBSEUID,PMWAWEBC
.>>>>     GOTO      WAELT100 IF NOT EQUAL
.
.         If this is the 2nd page of rows then we need to take into account
.         the first row in 1st page having 1 row for the current extract date.
.         Hence we need to position at the correct record.
.
          IF        STARTNUM=10
            ASSIGN    STARTNUM-1,STARTNUM
          ENDIF   
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      WAELT100
          ENDIF
.
.         If this is the first batch of run dates we need to firstly add one row
.         for the current (next) extract range
.
          IF        RECNUMB=1
            MOVE      PMWAEDAT,CURRDATE
            ADD       ONE,CURRDATE
.
            MOVE      CURRDATE,FDATSTRN
            MOVE      ZERO,FDATFORM
            CALL      FDAT0000
.
            MOVE      NORECORD,KEY2
            REP       " +",KEY2
            ASSIGN    STARTNUM+NORECORD,F4
            MOVE      F4,KEY4
            REP       " +",KEY4
.
            WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle class=ListIcon":
                             " onclick='location.href=#"",LINKPRG,".pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&hospcode=",HOSPCODE:
                             "&extractn=",EXTRACTN:
                             "&exstartn=",KEY4:
                             "&exnorecd=",NORECORD:
                             "&exstadat=",CURRDATE:
                             "&exenddat=00000000":
                             "#";'>":
                             FDATREST,"</td>":
                             "<td><b>&nbsp;Current</b></td>":
                             "</tr>"
	    ADD       ONE,DISNUMB
          ENDIF
.
          CALL      WAERW000           * Output row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      WAELT100 IF NOT EQUAL
.
WAELT999  RETURN
+
.******************************************************************************
.*                             WAEHD000                   Called by: WAELT000 *
.*        Outputs the header row for extract range dates table                *
.******************************************************************************
WAEHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=50%>":
                               "<b>Start Date</b></td>":
                               "<td class=HeadingCell width=50%>":
                               "<b>End Date</b></td>":
                             "</tr>"
.
WAEHD999  RETURN
+
.******************************************************************************
.*                             WAERW000                   Called by: WAELT000 *
.*        Outputs the extract's date range row                                *
.******************************************************************************
WAERW000  MOVE      PMWASDAT,FDATSTRN       * Extract range start date
          MOVE      ZERO,FDATFORM
          CALL      FDAT0000
          MOVE      FDATREST,WAEXSDAT
.
          MOVE      PMWAEDAT,FDATSTRN       * Extract range end date
          MOVE      ZERO,FDATFORM
          CALL      FDAT0000
          MOVE      FDATREST,WAEXEDAT
.
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F4
          MOVE      F4,KEY4
          REP       " +",KEY4
.
          WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle class=ListIcon":
                             " onclick='location.href=#"",LINKPRG,".pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&hospcode=",HOSPCODE:
                             "&extractn=",EXTRACTN:
                             "&exstartn=",KEY4:
                             "&exnorecd=",NORECORD:
                             "&exstadat=",PMWASDAT:
                             "&exenddat=",PMWAEDAT:
                             "#";'>":
                             WAEXSDAT,"</td>":
                             "<td>&nbsp;",WAEXEDAT,"</td>":
                             "</tr>"
.
WAERW999  RETURN
+
.------------------------------------------------------------------------------
.         Link to Next group of WA HMDS Extract Run Dates
.------------------------------------------------------------------------------
NEXTEX00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F4
          MOVE      F4,KEY4
          REP       " +",KEY4
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"prsweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY4:
                                 "&norecord=",KEY2:
                                 "&hospcode=",HOSPCODE:
                                 "&extractn=",EXTRACTN;
.
NEXTEX99  RETURN
+
.------------------------------------------------------------------------------
.         Link to Prev group of WA HMDS Extract Run Dates
.------------------------------------------------------------------------------
PREVEX00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F4
          IF        F4<0
            MOVE      ZERO,F4
          ENDIF
          MOVE      F4,KEY4
          REP       " +",KEY4
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"prsweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY4:
                                 "&norecord=",KEY2:
                                 "&hospcode=",HOSPCODE:
                                 "&extractn=",EXTRACTN;
.
PREVEX99  RETURN
+
.******************************************************************************
.*                             WAET0000                   Called by: WAETR000 *
.*        WA Extract Triggers Details                                         *
.******************************************************************************
WAET0000  BRANCH    FLDITMNO,WAET0100,WAET0200,WAET0300,WAET0400,WAET0500:
                             WAET0600,WAET0700,WAET0800,WAET0900,WAET1000:
                             WAET1100,WAET1200
          GOTO      WAET9999
.
WAET0100  CALL      WAETR000   * Table of WA Extract Triggers
          GOTO      WAET9999
.
WAET0200  CALL      NEXTTR00
          GOTO      WAET9999
.
WAET0300  CALL      PREVTR00
          GOTO      WAET9999
.
WAET0400  MATCH     SP70,EXSTADAT
          GOTO      WAET9999 IF EQUAL
.
          MOVE      EXSTADAT,FDATSTRN       * Extract start date
          MOVE      ONE,FDATFORM            * long month name
          CALL      FDAT0000
.
          WRITE     HTMLFILE;*+,FDATREST,"&nbsp;",*-;   * Formatted date string
          GOTO      WAET9999
.
WAET0500  MATCH     "00000000",EXENDDAT
          GOTO      WAET0510 IF NOT EQUAL
.
          WRITE     HTMLFILE;*+,"&nbsp;Current Triggers List",*-;
          GOTO      WAET9999
.
WAET0510  MOVE      EXENDDAT,FDATSTRN       * Extract end date
          MOVE      ONE,FDATFORM            * long month name
          CALL      FDAT0000
.
          WRITE     HTMLFILE;*+,"&nbsp;",FDATREST,*-;   * Formatted date string
          GOTO      WAET9999
.
WAET0600  CALL      EXTRLT00                * Link back to WA Extract list
          GOTO      WAET9999
.
WAET0700  WRITE     HTMLFILE;EXENDDAT;      * Extract end date
          GOTO      WAET9999
.
WAET0800  LOAD      STATUS,ASTAT,ASTAT1,ASTAT2,ASTAT3,ASTAT4,ASTAT5
          WRITE     HTMLFILE;STATUS;        * Patient admission status
          GOTO      WAET9999
.
WAET0900  UNPACK    DIM127,D1,D1,DIM127
          MOVE      ZERO,F1
          MOVE      D1,F1
.
          COMPARE   F1,ONE
          GOTO      WAET0910 IF EQUAL
.
          MATCH     PMWTSDAT,SP70           * Date sent
          IF        @EQUAL
            WRITE     HTMLFILE;"Waiting";   
          ELSE
            MOVE      PMWTSDAT,FDATSTRN
            MOVE      ZERO,FDATFORM
            CALL      FDAT0000
            WRITE     HTMLFILE;FDATREST;    * formatted date string
          ENDIF
          GOTO      WAET9999
.
WAET0910  WRITE     HTMLFILE;PMWTSDAT;
          GOTO      WAET9999
.
WAET1000  MOVE      PMWTCDAT,FDATSTRN
          MOVE      ZERO,FDATFORM
          CALL      FDAT0000
          WRITE     HTMLFILE;FDATREST," ",PMWTCTIM;
          GOTO      WAET9999
.
WAET1100  PACK      KEY10,PMWTWEBC,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,WAET9999
.
          WRITE     HTMLFILE;WBSENAM;
          GOTO      WAET9999
.
WAET1200  WRITE     HTMLFILE;HOSPCODE;
          GOTO      WAET9999
.
WAET9999  RETURN
+
.******************************************************************************
.*                             WAETR000                   Called by: WAEX0000 *
.*        Outputs WA Extract Trigger rows by start date and Hospital ID       *
.******************************************************************************
WAETR000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      WATHD000           * Output Table Heading
.
WAETR050  IF        NORECORD=0
            MOVE      "10",NORECORD    * Set Default num of records to display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     "00000000",EXENDDAT          * current extract date range?
          IF        @EQUAL
            MOVE      SP70,SAVESDAT              * yes; use blank start date
          ELSE
            MOVE      EXSTADAT,SAVESDAT          * no; use start date specified
          ENDIF
.
          PACK      KEY19,HOSPCODE,SAVESDAT,Z70
          CALL      RSPMWTR2
WAETR100  CALL      RPPMWTR2
          BRANCH    OVRCD,WAETR999
.
          MATCH     PMWTHOSP,HOSPCODE
          GOTO      WAETR999 IF NOT EQUAL
.
          MATCH     PMWTSDAT,SAVESDAT
          GOTO      WAETR999 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      WAETR100
          ENDIF
.
          CALL      WATRW000
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      WAETR100 IF NOT EQUAL
.
WAETR999  RETURN
+
.******************************************************************************
.*                             WATHD000                   Called by: WAETR000 *
.*        Outputs the header row for extract triggers table                   *
.******************************************************************************
WATHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=100px>":
                               "<b>Visit No</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Patient</b></td>":
                               "<td class=HeadingCell width=100px>":
                               "<b>Status</b></td>":
                               "<td class=HeadingCell width=100px>":
                               "<b>Extract Status</b></td>":
                               "<td class=HeadingCell width=200px>":
                               "<b>Date & Time Created</b></td>":
                               "<td class=HeadingCell width=200px>":
                               "<b>User Id</b></td>":
                             "</tr>"
.
WATHD999  RETURN
+
.******************************************************************************
.*                             WATRW000                   Called by: WAETR000 *
.*        Outputs table rows for extract triggers (patient visits)            *
.******************************************************************************
WATRW000  PACK      KEY8,PMWTVISN,SP70
          CALL      RDMISS1                 * Read in the admission record
          BRANCH    OVRCD,WATRW999          * No admission record
.
.         Get Admission details and Patient Name
.
          MOVE      AURNO,URNUMBER          * URNUMBER used in GETPAT
          CALL      GETPAT00                * Get Patient Details
          CALL      PATLN000                * Format Patient Name
          CALL      PATFLD00                * Use standard Patient Folder
.
          LOAD      STATUS,ASTAT,ASTAT1,ASTAT2,ASTAT3,ASTAT4,ASTAT5
.
          MOVE      SP70,EXSTATUS
          MATCH     PMWTSDAT,SP70
          IF        @EQUAL
            MOVE      "Waiting",EXSTATUS
          ELSE
            MOVE      PMWTSDAT,FDATSTRN
            MOVE      ZERO,FDATFORM
            CALL      FDAT0000
            MOVE      FDATREST,EXSTATUS
          ENDIF
.
          MOVE      PMWTCDAT,FDATSTRN       * Created Date
          MOVE      ZERO,FDATFORM
          CALL      FDAT0000
          MOVE      FDATREST,EXCRDATE
.
          REP       " +",PURNO
          WRITE     HTMLFILE;"<tr>":
                             "<td>&nbsp;",PMWTVISN,"</td>":
                             "<td nowrap>":
                             "<a href='javascript:ShowDetail08(#"":
                             LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&urnumber=",PURNO:
                             "&template=",LINKTEM:
                             "&hospcode=",HOSPCODE:
                             "&exstadat=",PMWTSDAT;
          REP       " +",PMWTVISN
          WRITE     HTMLFILE;"&admissno=",PMWTVISN,"#")'>":
                             "<img src=../images/PatientFolder",KEY3,".gif":
                             " class=ListIcon></a>",FORMATNM,"</td>":
                             "<td>&nbsp;",STATUS,"</td>":
                             "<td>&nbsp;",EXSTATUS,"</td>":
                             "<td>&nbsp;",EXCRDATE," at ",PMWTCTIM,"</td>":
                             "<td>&nbsp;",PMWTWEBC,"</td>":
                             "</tr>"
.
WATRW999  RETURN
+
.------------------------------------------------------------------------------
.         Link to Next group of WA HMDS Extract Run Dates
.------------------------------------------------------------------------------
NEXTTR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F4
          MOVE      F4,KEY4
          REP       " +",KEY4
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"prsweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY4:
                                 "&norecord=",KEY2:
                                 "&hospcode=",HOSPCODE:
                                 "&extractn=",EXTRACTN:
                                 "&exstartn=",EXSTARTN:
                                 "&exnorecd=",EXNORECD:
                                 "&exenddat=",EXENDDAT:
                                 "&exstadat=",EXSTADAT;
.
NEXTTR99  RETURN
+
.------------------------------------------------------------------------------
.         Link to Prev group of WA HMDS Extract Run Dates
.------------------------------------------------------------------------------
PREVTR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F4
          IF        F4<0
            MOVE      ZERO,F4
          ENDIF
          MOVE      F4,KEY4
          REP       " +",KEY4
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"prsweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY4:
                                 "&norecord=",KEY2:
                                 "&hospcode=",HOSPCODE:
                                 "&extractn=",EXTRACTN:
                                 "&exstartn=",EXSTARTN:
                                 "&exnorecd=",EXNORECD:
                                 "&exenddat=",EXENDDAT:
                                 "&exstadat=",EXSTADAT;
.
PREVTR99  RETURN
+
.------------------------------------------------------------------------------
.         Link back to HMDS Extract Run Dates list (at last position)
.------------------------------------------------------------------------------
EXTRLT00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
.
          ASSIGN    EXSTARTN-EXNORECD,F4
          IF        F4<0
            MOVE      ZERO,F4
          ENDIF
          MOVE      F4,KEY4
          REP       " +",KEY4
.
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&startnum=",KEY4:
                             "&norecord=",KEY2:
                             "&hospcode=",HOSPCODE:
                             "&extractn=",EXTRACTN,"#"'";
.
EXTRLT99  RETURN
+

.******************************************************************************
.*                             FDAT0000                   Called by: WAELT000 *
.*                  Format Date for printing (dd MMM yyyy)                    *
.*                                                                            *
.* Requires: FDATSTRN   Date value (ccyymmdd)                                 *
.*           FDATFORM   Format of month name? (0=short 1=long)                *
.*                                                                            *
.* Returns:  FDATREST   Result - Formatted Date String (dd MMM ccyy)          *
.******************************************************************************
.
FDAT0000  CLEAR     FDATREST
          UNPACK    FDATSTRN,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
.
          BRANCH    FDATFORM,FDAT0010
.
.         Short month names...
.
          LOAD      FMNTHNAM,F2,DMON01,DMON02,DMON03,DMON04,DMON05:
                                DMON06,DMON07,DMON08,DMON09,DMON10:
                                DMON11,DMON12
          GOTO      FDAT0020
.
.         Long month names...
.
FDAT0010  LOAD      FMNTHNAM,F2,DMONLN01,DMONLN02,DMONLN03,DMONLN04,DMONLN05:
                                DMONLN06,DMONLN07,DMONLN08,DMONLN09,DMONLN10:
                                DMONLN11,DMONLN12
.
.         Format full date string
.
FDAT0020  STRIP     FMNTHNAM
          PACK      FDATREST,CDAY,SP1,FMNTHNAM,SP1,CCENT,CYEAR
          STRIP     FDATREST
.
FDAT9999  RETURN
+
.------------------------------------------------------------
. Hospital ID
.------------------------------------------------------------
HOSPID00  PACK      KEY3,SP10
          CALL      RSPTHSP1
HOSPID10  CALL      RKPTHSP1
          BRANCH    OVRCD,HOSPID90
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          BRANCH    IBCNMHOS,HOSPID20
          WRITE     HTMLFILE;"<option value=",KEY5,">":
                             PTHSNAME,"</option>"
          GOTO      HOSPID10
.
.         Mult-Hospital
.
HOSPID20  MATCH     SP70,HOSPCODE 
          IF        @EQUAL
            MOVE      WBSEHOSP,HOSPCODE          * default to user's Hosp code
          ENDIF
HOSPID30  MATCH     HOSPCODE,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               PTHSNAME,"</option>"
          ENDIF
          GOTO      HOSPID10
.
HOSPID90
HOSPID99  RETURN
+
.------------------------------------------------------------
. Table of PRS2 Account Status Maintenance                             *I-60167
.------------------------------------------------------------
ACCTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      ACCHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY9,STARTKEY,SP70
          CALL      RDPTACC1
          IF        OVRCD=0
            CALL      RPPTACC1
          ENDIF
ACCTB100  CALL      RKPTACC1
          BRANCH    OVRCD,ACCTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ACCTB100
          ENDIF
.
          CALL      ACCRW000      * Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ACCTB100 IF NOT EQUAL
          GOTO      ACCTB999
.
ACCTB900  CALL      NOMORE00      * Display No More Records Message
.
ACCTB999  RETURN
.------------------------------------------------------------
. PRS2 Account Status Maintanance Details (TABLE HEADING)              *I-60167
.------------------------------------------------------------
ACCHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Claim Code</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Admission Type</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Highest Day in Period</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Current Year Account Status</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Previous Year Account Status</b></td>":
                             "</tr>"
.
ACCHD999  RETURN
.------------------------------------------------------------
. PRS2 Account Status Maintanance Details (TABLE ROW)                  *I-60167 
.------------------------------------------------------------
ACCRW000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail06":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptacc001=",PTASCLAM:
                             "&ptacc002=",PTASATYP:
                             "&ptacc003=",DPTASDAY,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTASCLAM,"</td>":
                             "<td>",PTASATYP,"&nbsp</td>":
                             "<td>",DPTASDAY,"&nbsp</td>":
                             "<td>",PTASACCS,"&nbsp</td>":
                             "<td>",PTASPRAC,"&nbsp</td>":
                             "</tr>"
.
ACCRW999 RETURN
..------------------------------------------------------------
. Option 5 : PRS2 Account Status Validation Maintenance                *I-60167
.------------------------------------------------------------
PTAT0000  BRANCH    FLDITMNO,PTAT0100,PTAT0200,PTAT0300,PTAT0400,PTAT0500:
                             PTAT0600,PTAT0700
.
          GOTO      PTAT9999
.
PTAT0100  CALL      ACTTB000   *Table of PRS2 Account Status Val Maintenance
          GOTO      PTAT9999                                           *I-60167
.
PTAT0200  CALL      NEXTGR00    * Next set of Codes
          GOTO      PTAT9999                                           *I-60167
.
PTAT0300  CALL      PREVGR00    * Prev set of Codes
          GOTO      PTAT9999                                           *I-60167
.
PTAT0400  WRITE     HTMLFILE;PTACCLSS;                                 *I-60167
          GOTO      PTAT9999
.
PTAT0500  WRITE     HTMLFILE;PTACACCM;                                 *I-60167
          GOTO      PTAT9999
.
PTAT0600  WRITE     HTMLFILE;PTACCARE;                                 *I-60167
          GOTO      PTAC9999
.
PTAT0700  WRITE     HTMLFILE;PTACMEDI;                                 *I-60167
          GOTO      PTAT9999
.
PTAT9999  RETURN
.------------------------------------------------------------
. Table of PRS2 Account Status Val Maintenance                         *I-60167
.------------------------------------------------------------
ACTTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      ACTHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP70
          CALL      RDPTACT1
          IF        OVRCD=0
            CALL      RPPTACT1
          ENDIF
ACTTB100  CALL      RKPTACT1
          BRANCH    OVRCD,ACTTB900
.
          MOVE      "Unknown Medicare Suffix ",SUFDESC           * Get Med Suf
          LOAD      SUFDESC,PTACMEDI,SUF1,SUF2,SUF3,SUF4,SUF5:   * Description
                                     SUF6,SUF7,SUF8,SUF9,SUF10
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ACTTB100
          ENDIF
.
          CALL      ACTRW000      * Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ACTTB100 IF NOT EQUAL
          GOTO      ACTTB999
.
ACTTB900  CALL      NOMORE00      * Display No More Records Message
.
ACTTB999  RETURN
.------------------------------------------------------------
. PRS2 Account Status Val Maintanance Details (TABLE HEADING)          *I-60167
.------------------------------------------------------------
ACTHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Account Class</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Accomodation Type</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Care Type</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Medicare Suffix</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Description</b></td>":
                             "</tr>"
.
ACTHD999  RETURN
.------------------------------------------------------------
. PRS2 Account Status Val Maintanance Details (TABLE ROW)              *I-60167
.------------------------------------------------------------
ACTRW000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail06":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptact001=",PTACCLSS:
                             "&ptact002=",PTACACCM:
                             "&ptact003=",PTACCARE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTACCLSS,"</td>":
                             "<td>",PTACACCM,"&nbsp</td>":
                             "<td>",PTACCARE,"&nbsp</td>":
                             "<td>",PTACMEDI,"&nbsp</td>":
                             "<td>",SUFDESC,"&nbsp</td>":
                             "</tr>"
.
ACTRW999 RETURN
.-----------------------------------------------------------
. Link to Next Group                                                   *I-60167
.-----------------------------------------------------------
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F4
          MOVE      F4,KEY4
          REP       " +",KEY4
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"prsweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY4:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY;
.
NEXTGR99  RETURN
.-------------------------------------------------------------
. Link to Prev Group                                                   *I-60167
.-------------------------------------------------------------
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F4
          IF        F4<0
            MOVE      ZERO,F4
          ENDIF
          MOVE      F4,KEY4
          REP       " +",KEY4
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"prsweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY4:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY;
.
PREVGR99  RETURN
.------------------------------------------------------------
. Visit PMI Details
.------------------------------------------------------------
VPMI0000  BRANCH    FLDITMNO,VPMI0100,VPMI0200,VPMI0300,VPMI0400,VPMI0500:
                             VPMI0600,VPMI0700,VPMI0800,VPMI0900,VPMI1000:
                             VPMI1100,VPMI1200,VPMI1300
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      VPMI9999
.
VPMI0100  MOVE      "T ",CATEGORY
          MOVE      PVIRESI,CODE            * resident status
          CALL      CODITM00
          GOTO      VPMI9999
.
VPMI0200  MOVE      "VA",CATEGORY
          MOVE      PMVXABRG,CODE           * aboriginality
          CALL      CODITM00
          GOTO      VPMI9999
.
VPMI0300  MOVE      "PV",CATEGORY
          MOVE      PMVXPIND,CODE           * privacy indicator
          CALL      CODITM00
          GOTO      VPMI9999
.
VPMI0400  WRITE     HTMLFILE;PMVXPOST;      * post code
          GOTO      VPMI9999
.
VPMI0500  WRITE     HTMLFILE;PMVXCSNR;      * consent release of info
          GOTO      VPMI9999
.
VPMI0600  WRITE     HTMLFILE;PMVXHOME;      * homeless
          GOTO      VPMI9999
.
VPMI0700  WRITE     HTMLFILE;PMVXINTR;      * interpreter required
          GOTO      VPMI9999
.
VPMI0800  MOVE      "LA",CATEGORY
          MOVE      PMVXLNG1,CODE           * preferred language
          CALL      CODITM00
          GOTO      VPMI9999
.
.         Change Form 6 to Form 4.2
.
VPMI0900  IF        PMVXPWGT=0
            WRITE     HTMLFILE;PMVXPWGT;    * Patient Weight
          ELSE
            MOVE      PMVXPWGT,F6P2
            DIV       "100",F6P2
            WRITE     HTMLFILE;F6P2;        * Patient Weight
          ENDIF
          GOTO      VPMI9999
.
VPMI1000  WRITE     HTMLFILE;PMVXPHGT;      * Patient Height
          GOTO      VPMI9999
.
VPMI1100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VPMI1110
          MATCH     SP70,AFUNDH
          GOTO      VPMI9999 IF EQUAL
          WRITE     HTMLFILE;AFUNDH;        * health fund
          GOTO      VPMI9999
.
VPMI1110  PACK      KEY14,AFUNDH,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;      * description of fund
          ELSE
            WRITE     HTMLFILE;AFUNDH;      * fund code
          ENDIF
          GOTO      VPMI9999
.
VPMI1200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,VPMI1210
          MATCH     SP70,AFNDTB
          GOTO      VPMI9999 IF EQUAL
          WRITE     HTMLFILE;AFNDTB;        * health fund table
          GOTO      VPMI9999
.
VPMI1210  PACK      KEY14,AFUNDH,AFNDTB,SP70
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;      * Description of Table
          ELSE
            WRITE     HTMLFILE;AFNDTB;      * Table code
          ENDIF
          GOTO      VPMI9999
.
VPMI1300  MATCH     SP70,AFNDMM
          GOTO      VPMI9999 IF EQUAL
          WRITE     HTMLFILE;AFNDMM;        * membership number
          GOTO      VPMI9999
.
VPMI9999  RETURN
+
.------------------------------------------------------------
. PMI Triggers
.------------------------------------------------------------
PTRG0000  BRANCH    FLDITMNO,PTRG0100,PTRG0200,PTRG0300,PTRG0400,PTRG0500:
                             PTRG0600,PTRG0700,PTRG0800,PTRG0900,PTRG1000:
                             PTRG1100,PTRG1200,PTRG1300,PTRG1400,PTRG1500:
                             PTRG1600
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PTRG9999
.
PTRG0100  CALL      PMIL0000          * patients on prspmiaf
          GOTO      PTRG9999
.
PTRG0200  CALL      NEXTPMI           * next page for prspmiaf
          GOTO      PTRG9999
.
PTRG0300  CALL      PREVPMI           * previous page for prspmiaf
          GOTO      PTRG9999
.
PTRG0400  PACK      KEY11,URNUMBER,ONE,SP70
          CALL      RDP2PMI1
          BRANCH    OVRCD,PTRG9999
.
          UNPACK    P2PMVALU,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DOBDESC,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
.
          WRITE     HTMLFILE;DOBDESC;      * date of birth
          GOTO      PTRG9999
.
PTRG0500  PACK      KEY11,URNUMBER,TWO,SP70
          CALL      RDP2PMI1
          IF        OVRCD=1        
            MOVE      SP70,P2PMVALU
          ENDIF
.
          MOVE      "VA",CATEGORY
          PACK      CODE,P2PMVALU,SP70
          CALL      CODITM00                * indigenous status
          GOTO      PTRG9999
.
PTRG0600  PACK      KEY11,URNUMBER,THREE,SP70
          CALL      RDP2PMI1
          IF        OVRCD=1        
            MOVE      SP70,P2PMVALU
          ENDIF
.
          MOVE      "C ",CATEGORY
          PACK      CODE,P2PMVALU,SP70
          CALL      CODITM00                * country of birth
          GOTO      PTRG9999
.
PTRG0700  PACK      KEY11,URNUMBER,FOUR,SP70
          CALL      RDP2PMI1
          IF        OVRCD=1        
            MOVE      SP70,P2PMVALU
          ENDIF
.
          MOVE      "LA",CATEGORY
          PACK      CODE,P2PMVALU,SP70
          CALL      CODITM00                * preferred language
          GOTO      PTRG9999
.
PTRG0800  PACK      KEY11,URNUMBER,FIVE,SP70
          CALL      RDP2PMI1
          BRANCH    OVRCD,PTRG9999
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      P2PMVALU,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          MOVE      DSEXDESC,DISPSEX
.* ******************************************   End of Changes         *C-49016
.
          WRITE     HTMLFILE;DISPSEX;       * patient sex
          GOTO      PTRG9999
.
PTRG0900  PACK      KEY11,URNUMBER,SIX,SP70
          CALL      RDP2PMI1
          IF        OVRCD=1        
            MOVE      SP70,P2PMVALU
          ENDIF
.
          MOVE      "M ",CATEGORY
          PACK      CODE,P2PMVALU,SP70
          CALL      CODITM00                * marital status
          GOTO      PTRG9999
.
PTRG1000  PACK      KEY11,URNUMBER,SEVEN,SP70
          CALL      RDP2PMI1
          IF        OVRCD=1        
            MOVE      SP70,P2PMVALU
          ENDIF
.
          MOVE      "T ",CATEGORY
          PACK      CODE,P2PMVALU,SP70
          CALL      CODITM00                * resident status
          GOTO      PTRG9999
.
PTRG1100  PACK      KEY11,URNUMBER,EIGHT,SP70
          CALL      RDP2PMI1
          BRANCH    OVRCD,PTRG9999
.
          MATCH     "0",P2PMVALU            * interpreter required?
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
          ENDIF
          MATCH     "1",P2PMVALU
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ENDIF
          MATCH     SP1,P2PMVALU
          IF        @EQUAL
            WRITE     HTMLFILE;"Not Stated";
          ENDIF
          GOTO      PTRG9999
.
PTRG1200  PACK      KEY11,URNUMBER,NINE,SP70
          CALL      RDP2PMI1
          BRANCH    OVRCD,PTRG9999
.
          WRITE     HTMLFILE;P2PMVALU;      * suburb
          GOTO      PTRG9999
.
PTRG1300  PACK      KEY11,URNUMBER,TEN,SP70
          CALL      RDP2PMI1
          BRANCH    OVRCD,PTRG9999
.
          WRITE     HTMLFILE;P2PMVALU;      * postcode
          GOTO      PTRG9999
.
PTRG1400  PACK      KEY11,URNUMBER,TEN1,SP70
          CALL      RDP2PMI1
          BRANCH    OVRCD,PTRG9999
.
          WRITE     HTMLFILE;P2PMVALU;      * medicare number
          GOTO      PTRG9999
.
PTRG1500  PACK      KEY11,URNUMBER,TEN2,SP70
          CALL      RDP2PMI1
          BRANCH    OVRCD,PTRG9999
.
          WRITE     HTMLFILE;P2PMVALU;      * merged u/r
          GOTO      PTRG9999
.
PTRG1600  CALL      LODV0000                * list of discharged visits
          GOTO      PTRG9999
.
PTRG9999  RETURN
+
.------------------------------------------------------------
.  List of discharged visits for particular U/R on prspmiaf
.------------------------------------------------------------
LODV0000  UNPACK    DIM127,D1,NUMRECS,DIM127
          MOVE      NUMRECS,NORECORD
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,COUNT
.
          READ      CONTROLF,EIGHTY8;*116,CHCSDTE
.
          PACK      KEY24,URNUMBER,Z70
          CALL      RDSDSCH3
LODV0100  CALL      RDPDSCH3
          BRANCH    OVRCD,LODV9999
.
          MATCH     URNUMBER,DURNO
          GOTO      LODV9999 IF NOT EQUAL   * same u/r?
.
          MATCH     CHCSDTE,DDATE
          GOTO      LODV9999 IF LESS        * Ddate must be >= start HDP date
.
          PACK      KEY8,DADMNO,SP70
          CALL      RDMISS1                 * get admission date
          BRANCH    OVRCD,LODV9999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LODV0100
          ENDIF
.
          CALL      OUTLDV00
          BRANCH    EXIT,LODV9999           * display limit reached
.
          ADD       ONE,DISNUMB             * DISNUMB is the counter
          COMPARE   NORECORD,DISNUMB        * is the numb of recds to be disp
          GOTO      LODV0100 IF NOT EQUAL
.
LODV9999  RETURN
+
.------------------------------------------------------------
.  Output discharge visits row
.------------------------------------------------------------
OUTLDV00  UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      FADMDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      FDSCDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr><td>",DADMNO,"&nbsp","</td>":
                                 "<td>",FADMDATE,"&nbsp","</td>":
                                 "<td>",FDSCDATE,"&nbsp","</td>":
                                 "<td>",PTDSDDRG,"&nbsp","</td>":
                                 "<td><input type=checkbox name=vislstno":
                                 " value='",DADMNO,"', checked></td></tr>"
.
          ADD       ONE,COUNT
          COMPARE   NORECORD,COUNT
          IF        @EQUAL
            WRITE     HTMLFILE;"<tr bgcolor=#FF0000>":
                               "<td colspan=5 align=center> <font size=3>":
                               "Record limit is ",NORECORD:
                               ". More visits may exist for this U/R.</td></tr>"
            GOTO      OUTLDV90
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      OUTLDV99
.
OUTLDV90  MOVE      ONE,EXIT
OUTLDV99  RETURN
+
.------------------------------------------------------------
.  List of patients on prspmiaf
.------------------------------------------------------------
PMIL0000  UNPACK    DIM127,D1,NUMRECS,DIM127
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      PTCNNRTD,NORECORD
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      SAVURNO,SP70
          PACK      KEY11,SP70
          CALL      RSP2PMI1
PMIL0100  CALL      RKP2PMI1
          BRANCH    OVRCD,PMIL9000
.
          MATCH     SAVURNO,P2PMURNO
          GOTO      PMIL0100 IF EQUAL
.
          MOVE      P2PMURNO,SAVURNO           * save u/r
.
          CALL      GETPMI00
          BRANCH    EXIT,PMIL0100
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PMIL0100
          ENDIF
.
          CALL      OUTPMI00                * output prspmiaf row
          ADD       ONE,DISNUMB             * DISNUMB is the counter
          COMPARE   NORECORD,DISNUMB        * is the numb of recds to be disp
          GOTO      PMIL0100 IF NOT EQUAL
          GOTO      PMIL9999
.
PMIL9000  CALL      NOMORE00      * Display No More Records Message
.
PMIL9999  RETURN
+
.------------------------------------------------------------
.  Get details of patients on prspmiaf
.------------------------------------------------------------
GETPMI00  MOVE      P2PMURNO,URNUMBER       * URNUMBER used in GETPAT
          CALL      GETPAT00                * Get Patient Details
          CALL      PATLN000                * Format Patient Name
          CALL      PATFLD00                * Use standard Patient Folder
GETPMI99  RETURN
+
.------------------------------------------------------------
.  Output prspmi row
.------------------------------------------------------------
OUTPMI00  REP       " +",P2PMURNO
.
          WRITE     HTMLFILE;"<tr><td>",PURNO,"</td>":
                             "<td nowrap>":
                             "<img src=../images/PatientFolder",KEY3,".gif":
                             " class=ListIcon ":
                             " onclick='location.href=#"",LINKPRG,".pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&urnumber=",P2PMURNO,"#";'>":
                             FORMATNM,"</td></tr>"
.
          REP       "+ ",P2PMURNO
OUTPMI99  RETURN
+
.------------------------------------------------------------
.  Next PMI >>
.------------------------------------------------------------
NEXTPMI   MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F4
          MOVE      F4,KEY4
          REP       " +",KEY4
.
          WRITE     HTMLFILE;"prsweb01.pbl":
                             "?reportno=",REPORTNO:
                             "&template=01":
                             "&startnum=",KEY4:
                             "&norecord=",KEY2;
.
          RETURN
+
.------------------------------------------------------------
.    previus PMI <<
.-----------------------------------------------------------
PREVPMI   MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F4
          IF        F4 < 0
            MOVE      ZERO,F4
          ENDIF
          MOVE      F4,KEY4
          REP       " +",KEY4
.
          WRITE     HTMLFILE;"prsweb01.pbl":
                             "?reportno=",REPORTNO:
                             "&template=01":
                             "&startnum=",KEY4:
                             "&norecord=",KEY2;
.
          RETURN
+
.------------------------------------------------------------
. PEI Listing
.------------------------------------------------------------
PPEI0000  BRANCH    FLDITMNO,PPEI0100,PPEI0200,PPEI0300,PPEI0400,PPEI0500:
                             PPEI0600,PPEI0700,PPEI0800,PPEI0900,PPEI1000:
                             PPEI1100
.
PPEI0100  CALL      PEILIS00          * extract list
          GOTO      PPEI9999
.
PPEI0200  CALL      PATP0000          * patients on selected list
          GOTO      PPEI9999
.
PPEI0300  WRITE     HTMLFILE;PRSSDATE;* selected extract date
          GOTO      PPEI9999
.
PPEI0400  CALL      NEXTLINK
          GOTO      PPEI9999
.
PPEI0500  CALL      PREVLINK
          GOTO      PPEI9999
.
PPEI0600  UNPACK    PRSSDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PPEI9999
.
PPEI0700  WRITE     HTMLFILE;PTPESTDT;
          GOTO      PPEI9999
.
PPEI0800  MATCH     "1",PTCNPRSM
          MATCH     PRSSDATE,CHCSST
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;   * current period
          ELSE
            WRITE     HTMLFILE;ZERO;
          ENDIF
          GOTO      PPEI9999
.
PPEI0900  MOVE      "RN",CATEGORY
          MOVE      PTPERESN,CODE
          CALL      CODITM00
          GOTO      PPEI9999
.
PPEI1000  LOAD      STATUS,PTPESTAT,EXTSTAT1,EXTSTAT2,EXTSTAT3,EXTSTAT4
          WRITE     HTMLFILE;STATUS;
          GOTO      PPEI9999
.
PPEI1100  MATCH     PTPEDATE,SP70
          GOTO      PPEI9999 IF EQUAL
          UNPACK    PTPEDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PPEI9999
.
PPEI9999  RETURN
+
.------------------------------------------------------------
. PRS2 Listing
.------------------------------------------------------------
RUNS0000  BRANCH    FLDITMNO,RUNS0100,RUNS0200,RUNS0300,RUNS0400,RUNS0500:
                             RUNS0600
.                                    Year select options
RUNS0100  CALL      SYSL0000
          GOTO      RUNS9999
.
.                                     PRS2 Runs for the selected year
RUNS0200  CALL      PRSE0000
          GOTO      RUNS9999
.
.                                      Admissions in a selected run
RUNS0300  CALL      TASR0000 
          GOTO      RUNS9999
.
.                                     Next set of records
RUNS0400  CALL      NEXTLINK
          GOTO      RUNS9999
.
.                                     Previous set of records
RUNS0500  CALL      PREVLINK
          GOTO      RUNS9999
.                                     PRS2 Qld extract for the selected year
RUNS0600  CALL      PRSQ0000         
          GOTO      RUNS9999
. 
RUNS9999  RETURN 
.------------------------------------------------------------
.  List of extracts on patpeiaf
.------------------------------------------------------------
PEILIS00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      SP70,SAVDATE
.
          READ      CONTROLF,EIGHTY8;*116,CHCSDTE
          READ      CONTROLF,EIGHTY8;*124,CHCSST,*132,CHCSED
.
          MATCH     "1",PTCNPRSM
          IF        @EQUAL
            PACK      KEY3,WBSEHOSP,SP70
            CALL      RDPMPRD1
            IF        OVRCD=0
              PACK      CHCSST,PMPRSDAT,SP70
              PACK      CHCSED,PMPREDAT,SP70
            ENDIF
          ENDIF
.
          MATCH     "1",PTCNPRSM
          IF        @EQUAL
            CALL      GETPRD00
            GOTO      PEILIS05
          ENDIF
.
          MOVE      CHCSST,PTPESTDT
          MOVE      DYES,CURRENT
          CALL      OUTPEI00             * output current run
.
PEILIS05  MOVE      DNO,CURRENT
          PACK      KEY16,CHCSDTE,SP70
          CALL      RSPTPEI1
PEILIS10  CALL      RKPTPEI1
          BRANCH    OVRCD,PEILIS99
.
          MATCH     SAVDATE,PTPESTDT
          GOTO      PEILIS10 IF EQUAL
.
          MATCH     PTPESTDT,CHCSST
          GOTO      PEILIS10 IF EQUAL
.
          MOVE      PTPESTDT,SAVDATE
.
          CALL      OUTPEI00
          GOTO      PEILIS10
.
PEILIS99  RETURN
+
.------------------------------------------------------------
.  Output patpei row 
.------------------------------------------------------------
GETPRD00  PACK      KEY3,WBSEHOSP,SP70
          CALL      RDPMPRD1
          BRANCH    OVRCD,GETPRD99
.
          MOVE      DYES,CURRENT
          PACK      PTPESTDT,PMPRSDAT
          CALL      OUTPEI00             * output current run
.
GETPRD99  RETURN
+
.------------------------------------------------------------
.  Output patpei row 
.------------------------------------------------------------
OUTPEI00  CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&prssdate=",PATLINK
          APPEND    PTPESTDT,PATLINK
          RESET     PATLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",PATLINK,"#",":
                             "#"",PTPESTDT,"#",":
                             "#"",CURRENT,"#");"
.
OUTPEI99  RETURN
.
.------------------------------------------------------------
.  List of patients on patpeiaf
.------------------------------------------------------------
PATP0000  MOVE      ZERO,CURFLAG
          UNPACK    DIM127,D1,NUMRECS,DIM127
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      NUMRECS,NORECORD
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,PRSSDATE
          GOTO      PATP9999 IF EQUAL
.
          READ      CONTROLF,EIGHTY8;*124,CHCSST,*132,CHCSED
          MATCH     "1",PTCNPRSM
          IF        @EQUAL
            PACK      KEY3,WBSEHOSP,SP70
            CALL      RDPMPRD1
            IF        OVRCD=0
              PACK      CHCSST,PMPRSDAT,SP70
              PACK      CHCSED,PMPREDAT,SP70
            ENDIF
          ENDIF
          MATCH     PRSSDATE,CHCSST
          IF        @EQUAL
            MOVE      ONE,CURFLAG
          ENDIF
.
          PACK      KEY16,PRSSDATE,SP70
          CALL      RSPTPEI1
PATP0100  CALL      RKPTPEI1
          BRANCH    OVRCD,PATP0150
.
          MATCH     PTPESTDT,PRSSDATE
          GOTO      PATP9999 IF NOT EQUAL
.
          CALL      GETDET00
          BRANCH    EXIT,PATP0100
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PATP0100
          ENDIF
.
          CALL      OUTPAT00
          ADD       ONE,DISNUMB             * DISNUMB is the counter
          COMPARE   NORECORD,DISNUMB        * is the numb of recds to be disp
          GOTO      PATP0100 IF NOT EQUAL
          GOTO      PATP9999
.
PATP0150  IF        CURFLAG=0
            GOTO      PATP9999
          ENDIF
.
          PACK      KEY16,SP70
          CALL      RSPTPEI1
PATP0200  CALL      RKPTPEI1
          BRANCH    OVRCD,PATP9999
.
          MATCH     PTPESTDT,SP70
          GOTO      PATP9999 IF NOT EQUAL
.
          CALL      GETDET00
          BRANCH    EXIT,PATP0200
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PATP0200
          ENDIF
.
          CALL      OUTPAT00
          ADD       ONE,DISNUMB             * DISNUMB is the counter
          COMPARE   NORECORD,DISNUMB        * is the numb of recds to be disp
          GOTO      PATP0200 IF NOT EQUAL
.
PATP9999  RETURN
+
.------------------------------------------------------------
.  Get details of patients on patpeiaf
.------------------------------------------------------------
GETDET00  MOVE      ZERO,EXIT
          MOVE      SP70,STATUS
          MOVE      SP70,REASON
          MOVE      SP70,EXTSTAT
.
          PACK      KEY5,ANSR,ANSN,PTPERESN,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,REASON
          ENDIF
.
          LOAD      EXTSTAT,PTPESTAT,EXTSTAT1,EXTSTAT2,EXTSTAT3,EXTSTAT4
.
          PACK      KEY8,DPTPEADM,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,GETDET90
.
          PACK      URNUMBER,AURNO
          PACK      ADMISSNO,DAADMNO
          MATCH     "1",PTCNPRSM
          IF        @EQUAL
            PACK      KEY8,DPTPEADM,SP70
            CALL      RDPMVX11
            BRANCH    OVRCD,GETDET90
            MATCH     WBSEHOSP,PMVXMHOS
            GOTO      GETDET90 IF NOT EQUAL
          ENDIF
.
          LOAD      STATUS,ASTAT,ASTAT1,ASTAT2,ASTAT3,ASTAT4,ASTAT5
.
          MOVE      AURNO,URNUMBER          * URNUMBER used in GETPAT
          CALL      GETPAT00                * Get Patient Details
          CALL      PATLN000                * Format Patient Name
          GOTO      GETDET99
.
GETDET90  MOVE      ONE,EXIT
          GOTO      GETDET99
.
GETDET99  RETURN
+

.------------------------------------------------------------
.  Output patpei row
.------------------------------------------------------------
OUTPAT00  WRITE     HTMLFILE;"<tr><td>",DPTPEADM,"</td>";
          REP       " +",DPTPEADM
          IF        CURFLAG=0
            WRITE     HTMLFILE;"<td>",FORMATNM,"</td>";
            GOTO      OUTPAT10
          ENDIF
.
.  -- can only edit current run details --
.
          WRITE     HTMLFILE;"<td nowrap><a href='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&prssdate=",PTPESTDT:
                             "&admissno=",DPTPEADM,"#")'>":
                             "<img src=../images/EditIcon.gif":
                             " hspace=4 border=0 align=absmiddle></a>":
                             "</a>",FORMATNM,"</td>";
.
OUTPAT10  WRITE     HTMLFILE;"<td>",STATUS,"&nbsp","</td>":
                             "<td>",ATYPE,"&nbsp","</td>":
                             "<td>",ACARE,"&nbsp","</td>":
                             "<td>",REASON,"&nbsp","</td>":
                             "<td>",EXTSTAT,"&nbsp","</td></tr>"
          REP       "+ ",DPTPEADM
.
OUTPAT99  RETURN
.
.------------------------------------------------------------
.  Next link Next>>
.------------------------------------------------------------
NEXTLINK  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F4
          MOVE      F4,KEY4
          REP       " +",KEY4
.
          WRITE     HTMLFILE;"prsweb01.pbl":
                             "?reportno=",REPORTNO:
                             "&template=02":
                             "&startnum=",KEY4:
                             "&norecord=",KEY2:
                             "&prssdate=",PRSSDATE;
          RETURN
.------------------------------------------------------------
.    previos link <<
.-----------------------------------------------------------
PREVLINK  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F4
          IF        F4 < 0
            MOVE      ZERO,F4
          ENDIF
          MOVE      F4,KEY4
          REP       " +",KEY4
.          
          WRITE     HTMLFILE;"prsweb01.pbl":
                             "?reportno=",REPORTNO:
                             "&template=02":
                             "&startnum=",KEY4:
                             "&norecord=",KEY2:
                             "&prssdate=",PRSSDATE;
          RETURN
.-------------------------------------------------------------
. PRS2 Patient Details
.-------------------------------------------------------------
PATD0000  BRANCH    FLDITMNO,PATD0100,PATD0200,PATD0300,PATD0400,PATD0500:
                             PATD0600,PATD0700,PATD0800,PATD0900,PATD1000:
                             PATD1100,PATD1200,PATD1300,PATD1400,PATD1500:
                             PATD1600,PATD1700,PATD1800,PATD1900,PATD2000:
                             PATD2100,PATD2200,PATD2300,PATD2400,PATD2500:
                             PATD2600,PATD2700,PATD2800,PATD2900,PATD3000:
                             PATD3100,PATD3200,PATD3300,PATD3400,PATD3500:
                             PATD3600,PATD3700,PATD3800,PATD3900,PATD4000:
                             PATD4100,PATD4200,PATD4300,PATD4400,PATD4500:
                             PATD4600,PATD4700,PATD4800,PATD4900,PATD5000:
                             PATD5100,PATD5200
.
PATD0100  WRITE     HTMLFILE;ADMISSNO;
          GOTO      PATD9999
.
PATD0200  MATCH     SP5,TDEPT
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSA,ANSC,TDEPT
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Discharge Unit
          ENDIF
          GOTO      PATD9999
.
PATD0300  MATCH     SP70,TADOCT
          MOVE      TADOCT,DOCTCODE
          CALL      DOCDET00                * Discharge Consultant
          GOTO      PATD9999
.
PATD0400  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTICU1
          BRANCH    OVRCD,PATD9999
.
          WRITE     HTMLFILE;PTICUMEC;      * Mechanical Ventilation
          GOTO      PATD9999
.
PATD0500  WRITE     HTMLFILE;P2PTDT05;      * PRS Episode sent
          GOTO      PATD9999
.
PATD0600  WRITE     HTMLFILE;P2PTDT06;      * PRS Coding sent
          GOTO      PATD9999
.
PATD0700  WRITE     HTMLFILE;P2PTDT07;      * PRS/2 to be resent
          GOTO      PATD9999
.
PATD0800  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTDAD1              * Patient tranfer dest.(patdadaf)
          BRANCH    OVRCD,PATD9999
          MATCH     SP70,PTDAADTS
          GOTO      PATD9999 IF EQUAL
          PACK      KEY5,PTDAADTS,SP20
          CALL      RDPTVAD1              *Patient tranfer source code(patvadaf)
          WRITE     HTMLFILE;PTDAADTS,SP1,PTVADESC;    * Transfer From
          GOTO      PATD9999
.
PATD0900  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTDAD1              * Patient tranfer dest.(patdadaf)
          BRANCH    OVRCD,PATD9999
          MATCH     SP70,PTDADCTS
          GOTO      PATD9999 IF EQUAL
          PACK      KEY5,PTDADCTS,SP20
          CALL      RDPTVAD1              *Patient tranfer source code(patvadaf)
          WRITE     HTMLFILE;PTDADCTS,SP1,PTVADESC;    * Transfer From
          GOTO      PATD9999
.
PATD1000  MATCH     SP5,PMVXCADM
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSV,ANSB,PMVXCADM
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Admission Criteria
          ENDIF
          GOTO      PATD9999
.
.         Change Form 6 to Form 4.2
.
PATD1100  IF        PMVXPWGT=0
            WRITE     HTMLFILE;PMVXPWGT;    * Patient Weight
          ELSE
            MOVE      PMVXPWGT,F6P2
            DIV       "100",F6P2
            WRITE     HTMLFILE;F6P2;        * Patient Weight
          ENDIF  
          GOTO      PATD9999
.
PATD1200  MATCH     ADATE,SP70
          GOTO      PATD9999 IF EQUAL
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PATD9999
.
PATD1300  MATCH     SP5,ACLAIM
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSC,ANSL,ACLAIM
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Insurance Class
          ENDIF
          GOTO      PATD9999
.
PATD1400  MATCH     SP5,ASRCE
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSS,SP1,ASRCE
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Admission Source
          ENDIF
          GOTO      PATD9999
.
PATD1500  MATCH     SP5,ATYPE
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSA,SP1,ATYPE
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Qualification Status
          ENDIF
          GOTO      PATD9999
.
PATD1600  
.WRITE     HTMLFILE;P2PTDT16;      * Admission Source
.          GOTO      PATD9999
.
PATD1700  WRITE     HTMLFILE;PTMIPDRG;      * Prov.Diagnosis Code
          GOTO      PATD9999
.
PATD1800  MATCH     SP70,PTMIPDRG
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY4,PTMIPDRG
          MOVE      "999",KEY3
          PACK      KEY7,KEY4,KEY3,SP10   * last DRG version          *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          IF        OVRCD=0
            MATCH     PTDWDRGC,KEY4         * same DRG code ?         *I-137125
            GOTO      PATD9999 IF NOT EQUAL                           *I-137125
            WRITE     HTMLFILE;PTDWDESC;    * Description
          ENDIF
          GOTO      PATD9999
.
PATD1900  WRITE     HTMLFILE;AFUNDH;        * Health Fund Code
          GOTO      PATD9999
.
PATD2000  MATCH     SP70,AFUNDH
          GOTO      PATD9999 IF EQUAL
.
          MATCH     SP70,AFNDTB
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY14,AFUNDH,AFNDTB,SP70
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFHDPE,SP1,AFNDTB;      * Level of Insurance
          ENDIF
          GOTO      PATD9999
.
PATD2100  MATCH     DDATE,SP70
          GOTO      PATD9999 IF EQUAL
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PATD9999               * Discharge Date
.
PATD2200  MATCH     SP5,DDEST
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSD,ANSD,DDEST
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Discharge Dest
          ENDIF
          GOTO      PATD9999
.
PATD2300  PACK      KEY6,TWARD,SP6
          CALL      RDWARD1
          WRITE     HTMLFILE;TWARD,SP1,WBDESC;         * Discharge Ward
          GOTO      PATD9999
.
PATD2400  MATCH     SP5,DSTAT
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSD,SP1,DSTAT
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Discharge Status
          ENDIF
          GOTO      PATD9999
.
PATD2500  MATCH     SP5,PMVXIRAD
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSV,ANSR,PMVXIRAD
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * intention to readmit
          ENDIF
          GOTO      PATD9999
.
PATD2600  WRITE     HTMLFILE;PTDSSREF;      * Separation Referral Code
          GOTO      PATD9999
.
PATD2700  WRITE     HTMLFILE;PTDSDDRG;      * DRG Code
          GOTO      PATD9999
.
PATD2800  WRITE     HTMLFILE;PTDSDMDC;      * MDC Code
          GOTO      PATD9999
.
PATD2900  WRITE     HTMLFILE;ATIME;         * Admission Time
          GOTO      PATD9999
.
PATD3000  WRITE     HTMLFILE;DTIME;         * Discharge Time
          GOTO      PATD9999
.
.
PATD3100  MATCH     SP5,ACLSS
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSP,SP1,ACLSS
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Admission Type
          ENDIF
          GOTO      PATD9999
.
PATD3200  MATCH     SP5,PMVXIDUS
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSV,ANSI,PMVXIDUS
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Intended Stay
          ENDIF
          GOTO      PATD9999
.
PATD3300  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTICU1
          BRANCH    OVRCD,PATD9999
.
          WRITE     HTMLFILE;PTICUINT;      * ICU hours
          GOTO      PATD9999
.
PATD3400  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTICU1
          BRANCH    OVRCD,PATD9999
.
          WRITE     HTMLFILE;PTICHNCU;      * NICU hours
          GOTO      PATD9999
.
PATD3500  MATCH     SP5,PMVXMHLS
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSL,ANSS,PMVXMHLS
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Mental Health LS
          ENDIF
          GOTO      PATD9999
.
.
PATD3600  MATCH     SP5,ACARE
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANSC,ANSC,ACARE
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Care Type
          ENDIF
          GOTO      PATD9999
.
PATD3700  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTICU1
          BRANCH    OVRCD,PATD9999
.
          WRITE     HTMLFILE;PTICCPAP;   * Hrs on Constant Positive Air Pressure
          GOTO      PATD9999
.
PATD3800  MATCH     SP5,PVIRESI
          GOTO      PATD9999 IF EQUAL
.
          PACK      KEY5,ANST,SP1,PVIRESI,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;THCSCOD,SP1,TDESC;      * Resident Status
          ENDIF
          GOTO      PATD9999
.
PATD3900  MATCH     PTEMCDTE,SP70
          GOTO      PATD9999 IF EQUAL
          UNPACK    PTEMCDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      PATD9999               * Latest Coding Date
.
PATD4000  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTICU1
          BRANCH    OVRCD,PATD9999
.
          WRITE     HTMLFILE;PTICUCCU;   * Hrs in Critical Care
          GOTO      PATD9999
.
PATD4100  PACK      KEY8,ADMISSNO,SP70
          CALL      RDWMAB1
          BRANCH    OVRCD,PATD9999
.
          WRITE     HTMLFILE;MREFNO;     * TAC Claim Number
          GOTO      PATD9999
.
PATD4200  PACK      KEY8,ADMISSNO,SP70
          CALL      RDWMAB1
          BRANCH    OVRCD,PATD9999
.
          MATCH     SP70,MACDAT
          GOTO      PATD9999 IF EQUAL
.
          UNPACK    MACDAT,CCENT,CYEAR,CMON,CDAY      * TAC Accident Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PATD9999
.
PATD4300  PACK      KEY8,ADMISSNO,SP70
          CALL      RDWVET1
          BRANCH    OVRCD,PATD9999
.
          WRITE     HTMLFILE;VCLMNO;     * DVA Claim Number
          GOTO      PATD9999
.
PATD4400  MOVE      "VJ",CATEGORY           * Reason for Critical Care Transfer
          PACK      CODE,PMVXRCCT,SP70
          CALL      CODITM00
          GOTO      PATD9999
.
PATD4500  READ      CONTROLF,HUND09;*195,PTCNACAS
          LOAD      CATEGORY,PTCNACAS,CATD1,CATD2,CATD3,CATD4,CATD5:
                                      CATU6,CATU7
.
          LOAD      CODE,PTCNACAS,DUSD1,DUSD2,DUSD3,DUSD4,DUSD5:
                                  AUSR6,AUSR7
          CALL      CODITM00
          GOTO      PATD9999
.
PATD4600  MOVE      "VK",CATEGORY             * Carer Availability
          PACK      CODE,PMVXCRAV,SP70
          CALL      CODITM00
          GOTO      PATD9999
.
PATD4700  MATCH     SP70,PTRDARTR         * Admission/Readmission to Rehab
          GOTO      PATD9999 IF EQUAL
          MATCH     "0",PTRDARTR
          IF        @EQUAL
            WRITE     HTMLFILE;REHABDS1;
          ELSE
            WRITE     HTMLFILE;REHABDS2;
          ENDIF
          GOTO      PATD9999
.
PATD4800  COMPARE   ZERO,PTRDBISA         * Barthel Index Score on Admission
          GOTO      PATD9999 IF EQUAL
          WRITE     HTMLFILE;PTRDBISA;
          GOTO      PATD9999

PATD4900  COMPARE   ZERO,PTRDBISD         * Barthel Index Score on Discharge
          GOTO      PATD9999 IF EQUAL
          WRITE     HTMLFILE;PTRDBISD;
          GOTO      PATD9999
.
PATD5000  MOVE      "CU",CATEGORY
          MOVE      PTRDCLSP,CODE         * Clinical subprogram
          CALL      CODITM00
          GOTO      PATD9999
.
PATD5100  MATCH     SP70,PTRDODTE         * Onset Date
          GOTO      PATD9999 IF EQUAL
          UNPACK    PTRDODTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PATD9999
.
PATD5200  CALL      SELGST00     * GST Codes Selection List
          GOTO      PATD9999
.
PATD9999  RETURN
.-----------------------------------------------------------
. Show Year
.-----------------------------------------------------------
SYSL0000  CLEAR     CCC
          CLEAR     CYY
          CALL      IBACLOCK
          ADD       "01",CYY
          PACK      TEMPYEAR,CCC,CYY
          REP       " 0",TEMPYEAR
          MOVE      TEMPYEAR,CURRYEAR
          MOVE      FILTERYR,FORM4
          MOVE      "10",COUNT
          WHILE     COUNT > 0
            COMPARE     FORM4,CURRYEAR
            IF          @EQUAL
              WRITE       HTMLFILE;"<option value=",CURRYEAR," selected=#"selected#">":
                                   CURRYEAR,"</option>"
            ELSE
              WRITE       HTMLFILE;"<option value=",CURRYEAR,">":
                                   CURRYEAR,"</option>"
            ENDIF
            SUB       ONE,CURRYEAR
            SUB       ONE,COUNT
          DO
.
SYSL9999  RETURN
.----------------------------------------------------------------
.Table of PRS2 Runs for the selected Year
.---------------------------------------- 
PRSE0000  RESET     FILTERYR
          MATCH     SP10,FILTERYR
          GOTO      PRSE0100 IF NOT EQUAL
.
          CALL      IBACLOCK
          PACK      FILTERYR,CCC,CYY
          REP       " 0",FILTERYR
.
PRSE0100  PACK      KEY26,FILTERYR,SP70
          CALL      RSP2HRD2                *open PRSHRD2 
PRSE0200  CALL      RKP2HRD2
          BRANCH    OVRCD,PRSE9999
.
          MATCH     "1",PTCNPRSM
          GOTO      PRSE1000 IF NOT EQUAL
.
          MATCH     WBSEHOSP,P2HRHOSP
          GOTO      PRSE0200 IF NOT EQUAL
.
PRSE1000  MOVE      P2HRFDAT,DIM4
          MATCH     FILTERYR,DIM4
          GOTO      PRSE9999 IF NOT EQUAL 
          CALL      SUMMRY00
          GOTO      PRSE0200
.
PRSE9999  RETURN
.---------------------------------------------------------------
.Table of PRS2 Queensland extract for the selected year
.------------------------------------------------------
PRSQ0000 RESET      FILTERYR
         MATCH      SP10,FILTERYR
         GOTO       PRSQ0100 IF NOT EQUAL
.
         CALL       IBACLOCK
         PACK       FILTERYR,CCC,CYY
         REP        " 0",FILTERYR
.
PRSQ0100 PACK       KEY10,SP70
         CALL       RSPMQER1
PRSQ0200 CALL       RKPMQER1
         BRANCH     OVRCD,PRSQ9999
.
PRSQ1000 MOVE       PMQEYEAR,DIM4
         MATCH      FILTERYR,DIM4
         GOTO       PRSQ0200 IF NOT EQUAL
         MATCH      SP70,FILTHOSP
         IF         !@EQUAL
           MATCH      FILTHOSP,PMQEHOSP
           GOTO       PRSQ9999 IF NOT EQUAL
         ENDIF
         CALL       QLDSUM00
         GOTO       PRSQ0200
.
PRSQ9999 RETURN
.---------------------------------------------------------------
.PRS2 Queensland extract summary
.---------------------------------------------------------------
QLDSUM00  CLEAR     PRLEDATE
.
          MOVE      PMQEEDAT,PRTPDATE
          CALL      PRSDAT00
          MOVE      FBOKDATE,PRLEDATE

.
          MOVE      SP70,PTHSNAME
          MATCH     SP70,PMQEHOSP
          IF        !@EQUAL
            PACK      KEY3,PMQEHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD=1
              MOVE      SP70,PTHSNAME
            ENDIF
          ENDIF
            
.
          WRITE     HTMLFILE;"t.addRow(#"#",#"",PMQERUNN,"#",":
                             "#"",PRLEDATE,"#",":
                             "#"",PTHSNAME,"#");"
.
QLDSUM99  RETURN


.------------------------------------------------------------
. PRS2 Extract Summary
.------------------------------------------------------------
SUMMRY00  
.          UNPACK    DIM127,D1,LINKPRG,DIM127
.         UNPACK    DIM127,D1,LINKREP,DIM127
.         UNPACK    DIM127,D1,LINKTEM,DIM127
.
          REP       " +",P2HRURUN
.          
          CLEAR     PRFMDATE
          CLEAR     PRTODATE
          CLEAR     PRCRDATE
          CLEAR     PRLEDATE

          CLEAR     PATLINK
          APPEND    "prsweb01",PATLINK
          APPEND    ".pbl?reportno=1",PATLINK
.          APPEND    LINKREP,PATLINK
          APPEND    "&template=2",PATLINK
.          APPEND    LINKTEM,PATLINK
          APPEND    "&prsrunno=",PATLINK
          APPEND    P2HRURUN,PATLINK
          RESET     PATLINK
          SQUEEZE   PATLINK
.
          REP       "+ ",P2HRURUN
.
          MOVE      P2HRFDAT,PRTPDATE
          CALL      PRSDAT00
          MOVE      FBOKDATE,PRFMDATE
.
          MOVE      P2HRTDAT,PRTPDATE
          CALL      PRSDAT00
          MOVE      FBOKDATE,PRTODATE
.
          MOVE      P2HRCDAT,PRTPDATE
          CALL      PRSDAT00
          MOVE      FBOKDATE,PRCRDATE
.
          MOVE      P2HRRDAT,PRTPDATE
          CALL      PRSDAT00
          MOVE      FBOKDATE,PRLEDATE
. 
          WRITE     HTMLFILE;"t.addRow(#"",PATLINK,"#",":
                             "#"",P2HRURUN,"#",":
                             "#"",PRFMDATE,"#",":
                             "#"",PRTODATE,"#",":
                             "#"",PRCRDATE,"#",":
                             "#"",PRLEDATE,"#");"
.
SUMMRY99  RETURN
.------------------------------------------------------------
. PRS/2 Account Status Maintenance                                     *I-60167
.------------------------------------------------------------
PATACC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PATACC40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PATACC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PATACC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PATACC30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Global Copy formaction
          GOTO      PATACC50 IF EQUAL
.
          MATCH     "G",UPDTTYPE    * Global Delete formaction
          GOTO      PATACC60 IF EQUAL
.
          GOTO      PATACC93
.
.
.         ************ ADD FORMACTION ***********
.
PATACC10  CALL      CHKACC00      * Checks mandatory fields
          BRANCH    EXIT,PATACC99
          PACK      KEY9,PTACC001,PTACC002,PTACC003,SP70
          CALL      RDPTACC1
          COMPARE   ZERO,OVRCD
          GOTO      PATACC92 IF EQUAL
.
          CALL      ACCSAV00      * Moves input variables to file variables
.
          TYPE      PTASPRAC
          GOTO      PATACC94 IF EQUAL
.
          TYPE      PTASACCS
          GOTO      PATACC95 IF EQUAL
.
          PACK      KEY9,PTACC001,PTACC002,PTACC003,SP70
          CALL      WRPTACC1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PATACC99
.
.         ************ UPDATE FORMACTION **********
.
PATACC20  PACK      KEY9,PTACC001,PTACC002,PTACC003,SP70
          CALL      RDPTACC1
          BRANCH    OVRCD,PATACC91
          CALL      CHKACC00      * Checks mandatory fields
          BRANCH    EXIT,PATACC99
.
          CALL      ACCSAV00      * Moves input variables to file variables
.
          TYPE      PTASPRAC
          GOTO      PATACC94 IF EQUAL
.
          TYPE      PTASACCS
          GOTO      PATACC95 IF EQUAL
.
          PACK      KEY9,PTACC001,PTACC002,PTACC003,SP70
          CALL      UPPTACC1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PATACC99
.
.         ************ DELETE FORMACTION **********
.
PATACC30  PACK      KEY9,PTACC001,PTACC002,PTACC003,SP70
          CALL      RDPTACC1
          BRANCH    OVRCD,PATACC91
          CALL      DEPTACC1
.
          MOVE      ZERO,EXIT
          GOTO      PATACC99
.
.         ************ DISPLAY FORMACTION **********
.
PATACC40  PACK      KEY9,PTACC001,PTACC002,PTACC003,SP70
          CALL      RDPTACC1
          IF        OVRCD=1
            CALL      CLRACC00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "PRS2 Account Status Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PATACC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PATACC99
.
.         ************ GLOBAL COPY FORMACTION **********
.
PATACC50  CALL      GCACC000
          GOTO      PATACC99
.
.         ************ GLOBAL DELETE FORMACTION **********
.
PATACC60  CALL      GDACC000
          GOTO      PATACC99
.
PATACC91  MOVE      "PRS2 Account Status does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATACC99
.
PATACC92  MOVE      "PRS2 Account Status exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATACC99
.
PATACC93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATACC99
.
PATACC94  MOVE      "Invalid Previous Year Account Status.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATACC99
.
PATACC95  MOVE      "Invalid Current Year Account Status.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATACC99
.
PATACC99  RETURN
.-----------------------------------------------------------
. Initialize's file data (PRS2 Account Status Maintenance)             *I-60167
.-----------------------------------------------------------
CLRACC00  MOVE      SP70,PTASCLAM
          MOVE      SP70,PTASATYP
          MOVE      SP70,DPTASDAY
          MOVE      SP70,PTASACCS
          MOVE      SP70,PTASPRAC
.
CLRACC99  RETURN
.-----------------------------------------------------------
. Initialize's file data (PRS2 Account Status Val Maintenance)         *I-60167
.-----------------------------------------------------------
CLRACT00  MOVE      SP70,PTACCLSS
          MOVE      SP70,PTACACCM
          MOVE      SP70,PTACCARE
          MOVE      ZERO,PTACMEDI
.
CLRACT99  RETURN
.------------------------------------------------------------
. Clear Transfer file details
.------------------------------------------------------------
CLRTRN00  MOVE      SP70,TWARD   
          MOVE      SP70,TBED    
          MOVE      SP70,TDATE   
          MOVE      SP70,TTIME   
          MOVE      SP70,TMOVE   
          MOVE      SP70,DTADMN  
          MOVE      SP70,TRATEF 
          MOVE      SP70,TRATEG 
          MOVE      SP70,TDISC  
          MOVE      SP70,TALLW  
          MOVE      SP70,TATYPE  
          MOVE      SP70,TADOCT  
          MOVE      SP70,TRATEH 
          MOVE      SP70,TEXTRA 
          MOVE      SP70,PTTRITFS
          MOVE      SP70,TRCDATE 
          MOVE      SP70,TRCTIME 
          MOVE      SP70,TRBTYP  
          MOVE      SP70,TRBEND  
          MOVE      SP70,TCHSTAT 
          MOVE      SP70,TDEPT   
          MOVE      SP70,PTTRLTYP
          MOVE      SP70,DPTTREPN
          MOVE      SP70,PTTREPSD
          MOVE      SP70,PTTRLSPT
          MOVE      SP70,PTTRLSRB
          MOVE      SP70,PTTRAEND
          MOVE      SP70,PTTRADPT
          MOVE      SP70,PTTRADRB
          MOVE      SP70,PTTRNHAC
          MOVE      SP70,PTTROPER
CLRTRN99  RETURN
.------------------------------------------------------------
. Clear Discharge Details
.------------------------------------------------------------
CLRDIS00  PACK      DDATE,SP70
          PACK      DTIME,SP70
          PACK      DSTAT,SP70
          PACK      DDEST,SP70
.
          PACK      DDIAG,SP70
          PACK      DDIAG2,SP70
          PACK      DUSD1,SP70
          PACK      DUSD2,SP70
          PACK      DUSD3,SP70
          PACK      DUSD4,SP70
          PACK      DUSD5,SP70
          PACK      DFMBS,SP70
          PACK      PTDSDMDC,SP70
          PACK      PTDSDDRG,SP70
          PACK      DWLREASN,SP70
.      
          PACK      PTDSSIDX,SP70
          PACK      PTDSVOGU,SP70
          PACK      PTDSOPER,SP70
          MOVE      ZERO,PTDSUYN1
          MOVE      ZERO,PTDSUYN2
          MOVE      ZERO,PTDSUYN3
          MOVE      ZERO,PTDSUYN4
          PACK      PTDSDWRD,SP70
          MOVE      ZERO,PTDSDLOS
          PACK      PTDSSREF,SP70
.
CLRDIS99  RETURN
+
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PREDIR00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                             " alert(#"",WEBTITLE,"#");":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
+
.------------------------------------------------------------------------------
.*                             GCACC000                              *I-60167 *
.*           Schedule Global Copy of PRS/2 Account Status (IBAHMS13)          *
.------------------------------------------------------------------------------
GCACC000  PACK      KEY9,PTACC006,PTACC007,SP70
          CALL      RSPTACC1
          CALL      RKPTACC1
          BRANCH    OVRCD,GCACC900
.
          MATCH     PTASCLAM,PTACC006           * Validate From Claim Code
          GOTO      GCACC900 IF NOT EQUAL
.
          MATCH     PTASATYP,PTACC007           * Validate From Admission Type
          GOTO      GCACC900 IF NOT EQUAL
.
.         Schedule  to IBAHMS13 Global Copy
.
          MOVE      "IBAHMS13",SCHDPGID
          MOVE      "Global Copy of PRS/2 Account Status",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
          MOVE      FOUR,KEYSTARR[1]           * Option Number 4 Global Copy
.
          MOVE      PTACC006,KEYSTARR[2]       * From Claim Code
.
          MOVE      PTACC007,KEYSTARR[3]       * From Admission Type
.
          MOVE      PTACC008,KEYSTARR[4]       * To Claim Code
.
          MOVE      PTACC009,KEYSTARR[5]       * To Admission Type
.
          MOVE      ANSY,KEYSTARR[6]           * Yes do Global Copy
.
          MOVE      SP1,KEYSTARR[7]            * Exit
.
          MOVE      SP1,KEYSTARR[8]            * Exit
.
          MOVE      EIGHT,KEYSTCNT               * Number of Keyins
.
          CALL      SCHPRO00                   * Schedule Extract
.
          GOTO      GCACC999
.
GCACC900  MOVE      "Invalid combination of From Codes.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GCACC999
.
GCACC999  RETURN
+
.------------------------------------------------------------------------------
.*                             GDACC000                              *I-60167 *
.*           Schedule Global Delete of PRS/2 Account Status (IBAHMS13)        *
.------------------------------------------------------------------------------
GDACC000  PACK      KEY9,PTACC010,PTACC011,SP70
          CALL      RSPTACC1
          CALL      RKPTACC1
          BRANCH    OVRCD,GDACC900
.
          MATCH     PTASCLAM,PTACC010           * Validate Claim Code
          GOTO      GDACC900 IF NOT EQUAL
.
          MATCH     PTASATYP,PTACC011           * Validate Admission Type
          GOTO      GDACC900 IF NOT EQUAL
.
.         Schedule  to IBAHMS13 Global Copy
.
          MOVE      "IBAHMS13",SCHDPGID
          MOVE      "Global Delete of PRS/2 Account Status",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
          MOVE      FIVE,KEYSTARR[1]           * Option Number 5 Global Delete
.
          MOVE      PTACC010,KEYSTARR[2]       * Claim Code
.
          MOVE      PTACC011,KEYSTARR[3]       * Admission Type
.
          MOVE      ANSY,KEYSTARR[4]           * Yes do Global Delete
.
          MOVE      SP1,KEYSTARR[5]            * Exit
.
          MOVE      SP1,KEYSTARR[6]            * Exit
.
          MOVE      SIX,KEYSTCNT               * Number of Keyins
.
          CALL      SCHPRO00                   * Schedule Extract
.
          GOTO      GDACC999
.
GDACC900  MOVE      "Invalid combination of Codes.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GDACC999
.
GDACC999  RETURN
+
.------------------------------------------------------------
. PRS/2 Account Status Val Maintenance                                 *I-60167
.------------------------------------------------------------
PATACT00  PACK      PTACT001,PTACT001,SP70
          PACK      PTACT002,PTACT002,SP70
          PACK      PTACT003,PTACT003,SP70
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PATACT40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PATACT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PATACT20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PATACT30 IF EQUAL
.
          GOTO      PATACC93
.
.         ************ ADD FORMACTION ***********
.
PATACT10  CALL      CHKACT00      * Checks mandatory fields
          BRANCH    EXIT,PATACT99
          PACK      KEY6,PTACT001,PTACT002,PTACT003,SP70
          CALL      RDPTACT1
          COMPARE   ZERO,OVRCD
          GOTO      PATACT92 IF EQUAL
.
          CALL      ACTSAV00      * Moves input variables to file variables
.
          PACK      KEY6,PTACT001,PTACT002,PTACT003,SP70
          CALL      WRPTACT1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PATACT99
.
.         ************ UPDATE FORMACTION **********
.
PATACT20  PACK      KEY6,PTACT001,PTACT002,PTACT003,SP70
          CALL      RDPTACT1
          BRANCH    OVRCD,PATACT91
          CALL      CHKACT00      * Checks mandatory fields
          BRANCH    EXIT,PATACT99
.
          CALL      ACTSAV00      * Moves input variables to file variables
.
          PACK      KEY6,PTACT001,PTACT002,PTACT003,SP70
          CALL      UPPTACT1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PATACT99
.
.         ************ DELETE FORMACTION **********
.
PATACT30  PACK      KEY6,PTACT001,PTACT002,PTACT003,SP70
          CALL      RDPTACT1
          BRANCH    OVRCD,PATACT91
          CALL      DEPTACT1
.
          MOVE      ZERO,EXIT
          GOTO      PATACT99
.
.         ************ DISPLAY FORMACTION **********
.
PATACT40  PACK      KEY6,PTACT001,PTACT002,PTACT003,SP70
          CALL      RDPTACT1
          IF        OVRCD=1
            CALL      CLRACT00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "PRS2 Account Status Validation Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PATACT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PATACT99
.
PATACT91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATACT99
.
PATACT92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATACT99
.
PATACT93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATACT99
.
PATACT99  RETURN
+
.------------------------------------------------------------
. GST Code Selection
.------------------------------------------------------------
SELGST00  PACK      KEY6,SP70
          CALL      RAIBGS1
SELGST10  CALL      RKIBGS1
          BRANCH    OVRCD,SELGST99
          PACK      KEY8,QUOTE,IBGSCODE,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                             IBGSDESC,"</option>"
          GOTO      SELGST10
SELGST99  RETURN
.
.*************************************************************************
.                           WA Extracts
.*************************************************************************
WAEXT000  CLEAR     WEBTITLE
          MOVE      "Extract Run Dates",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,WAEXT999
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      WAEXT999
.
WAEXT999  RETURN
+
.*************************************************************************
.                   WA HMDS Extracts Ranges
.*************************************************************************
WAEXR000  CLEAR     WEBTITLE
          MOVE      "HMDS Extract Run Dates",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,WAEXR999
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      WAEXR999
.
WAEXR999  RETURN
.
.*************************************************************************
.                   WA Extract Triggers Processing
.*************************************************************************
WATRG000  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      WATRG400 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      WATRG100 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      WATRG200 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      WATRG300 IF EQUAL
.
          GOTO      WATRG990
.
.         ************ ADD FORMACTION ***********
.
WATRG100  PACK      KEY24,URNUMBER,VISITDAT,ADMISSNO,SP70
          CALL      RDVISA2                 * Read in the visit record
          BRANCH    OVRCD,WATRG999          * No admission record
.
          COMPARE   PVITYPE,THREE           * Inpatient visit?
          GOTO      WATRG940 IF NOT EQUAL   * no; output error message
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1                 * Read in the admission record
          BRANCH    OVRCD,WATRG910          * No admission record
.         
          COMPARE   ASTAT,THREE             * Discharged?
          GOTO      WATRG950 IF NOT EQUAL   * no; ouput error message
.
          CALL      IBACLOCK                * Get the current date & time
          PACK      PMWTCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMWTCDAT
          MOVE      CTIMEIS,PMWTCTIM
.
          PACK      PMWTHOSP,WBSEHOSP,SP70
          PACK      PMWTVISN,AADMNO,SP70
          PACK      PMWTSDAT,SP70
          PACK      PMWTWEBC,WBSEUID,SP70
.
          PACK      KEY19,PMWTHOSP,PMWTVISN,PMWTSDAT,SP70
          CALL      RAPMWTR1
          IF        OVRCD=1
            CALL      WRPMWTR1
          ELSE
            GOTO      WATRG960              * Visit already on file
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      WATRG999
.
.         ************ UPDATE FORMACTION ***********
.
WATRG200  
          MOVE      ZERO,EXIT
          GOTO      WATRG999
.
.         ************ DELETE FORMACTION ***********
.
WATRG300  PACK      KEY19,HOSPCODE,ADMISSNO,EXSTADAT,SP70
          CALL      RDPMWTR1
          BRANCH    OVRCD,WATRG930
.
          CALL      DEPMWTR1
.
          MOVE      ZERO,EXIT
          GOTO      WATRG999
.
.         ************ DISPLAY FORMACTION **********
.
WATRG400  IF        SHOWCURR=1
            MOVE      TEN,EXSTARTN
            MOVE      TEN,EXNORECD
            MOVE      "00000000",EXENDDAT
            MOVE      WBSEHOSP,HOSPCODE
            MOVE      "IBAADT50",EXTRACTN
            PACK      KEY27,HOSPCODE,EXTRACTN,Z70
            CALL      RSPMWAE1
            CALL      RPPMWAE1
            BRANCH    OVRCD,WATRG430
.
            MATCH     HOSPCODE,PMWAHOSP
            GOTO      WATRG430 IF NOT EQUAL
.
            MATCH     EXTRACTN,PMWAPROG
            GOTO      WATRG430 IF NOT EQUAL
.
            MOVE      PMWAEDAT,CURRDATE
            ADD       ONE,CURRDATE
            MOVE      CURRDATE,EXSTADAT
            GOTO      WATRG440
.
WATRG430    MOVE      SP8,EXSTADAT           * no extract on file
          ENDIF
.
WATRG440  MATCH     SP70,ADMISSNO
          GOTO      WATRG450 IF EQUAL        * Display triggers list
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,WATRG910
.
          PACK      KEY8,AURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,WATRG920
.
          PACK      KEY19,HOSPCODE,ADMISSNO,EXSTADAT,SP70
          CALL      RDPMWTR1
          BRANCH    OVRCD,WATRG930
.
WATRG450  CLEAR     WEBTITLE
          MOVE      "WA Extract Triggers",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,WATRG999
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      WATRG999
.
WATRG910  MOVE      "Invalid admission number",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WATRG999
.
WATRG920  MOVE      "Invalid UR number",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WATRG999
.
WATRG930  MOVE      "Extract Trigger record not found",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WATRG999
.
WATRG940  MOVE      "Invalid Visit Type",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WATRG999
.
WATRG950  MOVE      "Invalid Visit Status",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WATRG999
.
WATRG960  MOVE      "Visit already on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WATRG999
.
WATRG970  MOVE      "No extract on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WATRG999
.
WATRG990  MOVE      "Invalid Form Action",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WATRG999
.
WATRG999  RETURN
+
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
+
.------------------------------------------------------------
.----------------------------------------------------------------------
          INC       APSMASIO/INC
          INC       PATMA1IO/INC   * Inpatients - Patient Master File           
          INC       PMSHCPIO/INC
          INC       PMSHCGIO/INC
          INC       PMSPX2IO/INC
          INC       PATECMIO/INC
          INC       PATMI1IO/INC   * Inpatients - Patient Admission File
          INC       PATTRNIO/INC   * Inpatients - Patient Transfer File 
          INC       PMSVX1IO/INC   * Inpatients - Patient Visit Ext File
          INC       PATDGWIO/INC   * Inpatients - Patient Admission File
          INC       PATDADIO/INC   * Inpatients - Patient Admission File
          INC       PATDSCIO/INC   * Inpatients - Patient Admission File
          INC       PATHSPIO/INC
          INC       PMSWAEIO/INC
          INC       PMSWTRIO/INC
          INC       PRSHRDIO/INC   * PRS2 Run Header Table
          INC       PRSDTLIO/INC   * PRS2 Admission Details Table
          INC       PRSPMIIO/INC   * PRS2 PMI Trigger Changes Table
          INC       PATPR1IO/INC   *
          INC       PATICUIO/INC   *
          INC       OUTSITIO/INC
          INC       PATACCIO/INC                                       *I-60167
          INC       PATACTIO/INC                                       *I-60167
.          INC       PATALTIO/INC
          INC       PATDO1IO/INC
          INC       PATIN1IO/INC
          INC       PATALRIO/INC
          INC       PATWR1IO/INC
          INC       PATVISIO/INC
          INC       PATFN1IO/INC
.
          INC       PMSCCDIO/INC   * Concession Card Details
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       MRTMASIO/INC
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
.
          INC       CLPATMAS   
          INC       CLPATMIS   
          INC       DAYOFWEK   
          INC       IBAWEBCD
          INC       WEBDATCD
          INC       PATMASTM
          INC       CLPMSPX2
          INC       CLNHIMAS
          INC       PMSPX2TM
          INC       PATMSXTM
          INC       CALCAGE
          INC       PATNAMCD
          INC       NAMSTRCD
          INC       PATDOCTM
          INC       PATDOCCD
          INC       PMSHCPTM
          INC       PMSHCGTM
          INC       RSHWEBCD                                           *I-60167
.
          INC       PMSPRDIO/INC
          INC       PATPEIIO/INC
          INC       PATRDEIO/INC
          INC       PATVADIO/INC
          INC       PATWMAIO/INC
          INC       PATWVEIO/INC
.
          INC       IBAGSTIO/INC   * GST Codes
.
          INC       PMSQERIO/INC

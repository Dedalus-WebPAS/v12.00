.******************************************************************************
.* WRRHIS00 - Write to the Outpatient History
.******************************************************************************
WRRHIS00  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,SEVENTY9;*138,PTCNURHA
.
          COMPARE   ONE,PTCNURHA
          GOTO      WRRHIS99 IF NOT EQUAL
.
. ------- Check if anything has changed ---------------------------
.
          MATCH     SAOTPRIO,OTRLPRIO
          GOTO      WRRHIS50 IF NOT EQUAL 
.
          MATCH     SAOTRANK,OTRLRANK
          GOTO      WRRHIS50 IF NOT EQUAL 
.
          GOTO      WRRHIS99          * No Changes
.
. ------- write a history record -----------------------
.
WRRHIS50  PACK      CFNAME,UID,FILHISA1
          OPEN      OUTHISA1,CFNAME     
          PACK      KEY8,CCC,CYY,CMM,CDD,SP10
          REP       " 0",KEY8
          PACK      KEY28,OTRLURNO,OTRLOUTN,KEY8,Z70
          CALL      RSOTHIS1
          CALL      RPOTHIS1
          BRANCH    OVRCD,WRRHIS60
.
          MATCH     OTRLURNO,OTHIURNO
          GOTO      WRRHIS60 IF NOT EQUAL
.
          MATCH     OTRLOUTN,OTHIEVNT
          GOTO      WRRHIS60 IF NOT EQUAL
.
          MATCH     KEY8,OTHIEDAT
          GOTO      WRRHIS60 IF NOT EQUAL
.
          ADD       ONE,OTHIUCNT
          GOTO      WRRHIS70
.
WRRHIS60  MOVE      OTRLURNO,OTHIURNO
          MOVE      OTRLOUTN,OTHIEVNT
          PACK      OTHIEDAT,CCC,CYY,CMM,CDD,SP10
          REP       " 0",OTHIEDAT
          MOVE      ONE,OTHIUCNT
.
WRRHIS70  MOVE      OTRLPRIO,OTHIPRIO
          MOVE      OTRLRANK,OTHIRANK
          PACK      OTHISPAR,SP20,SP20,SP20
.
          PACK      KEY28,OTHIURNO,OTHIEVNT,OTHIEDAT,OTHIUCNT,SP20
          CALL      RAOTHIS1
          IF        OVRCD=1
            CALL      WROTHIS1
          ENDIF
.
WRRHIS99  RETURN

.*----------------------------------------------------------------------
.* Include Name  :   ALLEXTTM.PBL
.*
.* Function      :   CGI variables for ALLEXTFD - allextaf.dat
.*
.* Includes Needed :
.*
.*----------------------------------------------------------------------
. Modifications Done :
.
.  V9.09.01 31/01/2008  Mike Laming    CAR 152286
.           Change PATEORFD fields' prefix to PTER (from PTEO - is ICD10).
.  V9.08.00 26/03/2007  Ebon Clements  CAR 135530
.           Created include
.*----------------------------------------------------------------------
.------------------------------------------------------------------------
. Clear parameters for allied health external referrals table
.------------------------------------------------------------------------
CPALEX00  MOVE      Z70,ALEXT001
          MOVE      Z70,ALEXT002
          MOVE      Z70,ALEXT003
          MOVE      Z70,ALEXT004
          MOVE      Z70,ALEXT005
          MOVE      Z70,ALEXT006
          MOVE      Z70,ALEXT007
          MOVE      Z70,ALEXT008
          MOVE      Z70,ALEXT009
          MOVE      Z70,ALEXT010
          MOVE      Z70,ALEXT011
          MOVE      Z70,ALEXT012
          MOVE      Z70,ALEXT013
.
CPALEX99  RETURN
.
.------------------------------------------------------------
. Add allied health external referral table
.------------------------------------------------------------
ALEX0000  BRANCH    FLDITMNO,ALEX0010,ALEX0020,ALEX0030,ALEX0040,ALEX0050:
                             ALEX0060,ALEX0070,ALEX0080,ALEX0090,ALEX0100:
                             ALEX0110,ALEX0120,ALEX0130
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALEX9999
.
ALEX0010  WRITE     HTMLFILE;ALEXVISN;
          GOTO      ALEX9999
.
ALEX0020  WRITE     HTMLFILE;ALEXEXTR;
          GOTO      ALEX9999
.
ALEX0030  MATCH     SP70,ALEXRDAT
          GOTO      ALEX9999 IF EQUAL
.
          UNPACK    ALEXRDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALEX9999
.
ALEX0040  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALEX0041
.
          PACK      KEY10,ALEXAHCP,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,ALEX9999
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      ALRE9999
.
ALEX0041  WRITE     HTMLFILE;ALEXAHCP;
          GOTO      ALEX9999
.
ALEX0050  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALEX0051
.
          PACK      KEY10,ALEXCAST,SP70
          CALL      RDALCAS1
          BRANCH    OVRCD,ALEX9999
.
          WRITE     HTMLFILE;ALCADESC;
          GOTO      ALEX9999
.
ALEX0051  WRITE     HTMLFILE;ALEXCAST;
          GOTO      ALEX9999
.
ALEX0060  MOVE      "rf",CATEGORY
          MOVE      ALEXRREF,CODE
          CALL      CODITM00
          GOTO      ALEX9999
.
ALEX0070  MOVE      "S ",CATEGORY
          MOVE      ALEXREFT,CODE
          CALL      CODITM00
          GOTO      ALEX9999
.
.         External Organisation for Public hospital and External agency
.
ALEX0080  UNPACK    DIM127,DIM1,KEY1,DIM127
          TYPE      KEY1
          GOTO      ALEX0082 IF NOT EQUAL
.
          MOVE      KEY1,F1
          BRANCH    F1,ALEX0081
          GOTO      ALEX9999
.
ALEX0081  WRITE     HTMLFILE;ALEXORCD;
          GOTO      ALEX9999
.
ALEX0082  PACK      KEY7,KEY1,SP70
          CALL      RSPTEOR1
ALEX0083  CALL      RKPTEOR1
          BRANCH    OVRCD,ALEX9999
.
          MATCH     KEY1,PTERTYPE
          GOTO      ALEX9999 IF NOT EQUAL
.
          MATCH     "1",PTERSTAT
          GOTO      ALEX0083 IF EQUAL      * not active
.
          MOVE      PTERNAME,KEY20
          PACK      KEY8,QUOTE,PTERCODE,QUOTE
          MATCH     PTERCODE,ALEXORCD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY8," selected>",KEY20:
                               "</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY8,">",KEY20:
                               "</option>";
          ENDIF
          GOTO      ALEX0083
.
ALEX0090  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALEX0091
.
          PACK      KEY10,ALEXHCPC,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,ALEX9999
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      ALRE9999
.
ALEX0091  WRITE     HTMLFILE;ALEXHCPC;
          GOTO      ALEX9999
.
ALEX0100  WRITE     HTMLFILE;ALEXCOM1;
          GOTO      ALEX9999
.
ALEX0110  WRITE     HTMLFILE;ALEXCOM2;
          GOTO      ALEX9999
.
ALEX0120  WRITE     HTMLFILE;ALEXCOM3;
          GOTO      ALEX9999
.
ALEX0130  WRITE     HTMLFILE;ALEXCOM4;
          GOTO      ALEX9999
.
ALEX9999  RETURN
.
.------------------------------------------------------------
. Set parameters for allied health external referral table 
.------------------------------------------------------------
SPALX000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPALX001,SPALX002,SPALX003,SPALX004,SPALX005:
                       SPALX006,SPALX007,SPALX008,SPALX009,SPALX010:
                       SPALX011,SPALX012,SPALX013
.
          MOVE      ONE,EXIT
          GOTO      SPALX999
.
SPALX001  PACK      ALEXT001,QRYDATA,SP70
          GOTO      SPALX999
.
SPALX002  MOVE      QRYDATA,ALEXT002
          GOTO      SPALX999
.
SPALX003  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      ALEXT003,CCENT,CYEAR,CMON,CDAY  
          GOTO      SPALX999
.
SPALX004  MOVE      QRYDATA,ALEXT004
          GOTO      SPALX999
.
SPALX005  MOVE      QRYDATA,ALEXT005
          GOTO      SPALX999
.
SPALX006  MOVE      QRYDATA,ALEXT006
          GOTO      SPALX999
.
SPALX007  MOVE      QRYDATA,ALEXT007
          GOTO      SPALX999
.
SPALX008  MOVE      QRYDATA,ALEXT008
          GOTO      SPALX999
.
SPALX009  MOVE      QRYDATA,ALEXT009
          GOTO      SPALX999
.
SPALX010  MOVE      QRYDATA,ALEXT010
          GOTO      SPALX999
.
SPALX011  MOVE      QRYDATA,ALEXT011
          GOTO      SPALX999
.
SPALX012  MOVE      QRYDATA,ALEXT012
          GOTO      SPALX999
.
SPALX013  MOVE      QRYDATA,ALEXT013
          GOTO      SPALX999
.
SPALX999  RETURN
.
.------------------------------------------------------------
.  Update allied health external referral table
.------------------------------------------------------------
MVALEX00  MATCH     ALEXT001,Z70
          IF        !@EQUAL
            MOVE      ALEXT001,ALEXVISN
          ENDIF
.
          MATCH     ALEXT002,Z70
          IF        !@EQUAL
            MOVE      ALEXT002,ALEXEXTR
          ENDIF
.
          MATCH     ALEXT003,Z70
          IF        !@EQUAL
            MOVE      ALEXT003,ALEXRDAT
          ENDIF
.
          MATCH     ALEXT004,Z70
          IF        !@EQUAL
            MOVE      ALEXT004,ALEXAHCP
          ENDIF
.
          MATCH     ALEXT005,Z70
          IF        !@EQUAL
            MOVE      ALEXT005,ALEXCAST 
          ENDIF
.
          MATCH     ALEXT006,Z70
          IF        !@EQUAL
            MOVE      ALEXT006,ALEXRREF
          ENDIF
.
          MATCH     ALEXT007,Z70
          IF        !@EQUAL
            MOVE      ALEXT007,ALEXREFT
          ENDIF
.
          MATCH     ALEXT008,Z70
          IF        !@EQUAL
            MOVE      ALEXT008,ALEXORCD
          ENDIF
.
          MATCH     ALEXT009,Z70
          IF        !@EQUAL
            MOVE      ALEXT009,ALEXHCPC
          ENDIF
.
          MATCH     ALEXT010,Z70
          IF        !@EQUAL
            MOVE      ALEXT010,ALEXCOM1
          ENDIF
.
          MATCH     ALEXT011,Z70
          IF        !@EQUAL
            MOVE      ALEXT011,ALEXCOM2
          ENDIF
.
          MATCH     ALEXT012,Z70
          IF        !@EQUAL
            MOVE      ALEXT012,ALEXCOM3
          ENDIF
.
          MATCH     ALEXT013,Z70
          IF        !@EQUAL
            MOVE      ALEXT013,ALEXCOM4
          ENDIF
.
MVALEX99  RETURN

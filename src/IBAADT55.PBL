.******************************************************************************
.*                                                                            *
.*                        P R O G R A M   S U M M A R Y                       *
.*                        -------------   -------------                       *
.*                                                                            *
.*     PROGRAM NAME:     IBAADT55                                             *
.*                                                                            *
.*     FUNCTION:         HEALTH DEPARTMENT TRANSMISSIONS (CANBERRA)           *
.*                                                                            *
.*     DATE WRITTEN:     01/02/1999                                           *
.*                                                                            *
.*     AUTHOR:           JENI TAN                                             *
.*                                                                            *
.*     MODIFICATIONS:                                                         *
.*                                                                            *
.******************************************************************************
.* V12.00.01 20/05/2025 Thanh T         TSK 0955096                           *
.*           Changed for alphanumeric visit number                            *
.******************************************************************************
.*        V11.04.03 14.06.2024  Ebon Clements   TSK 0947827                   *
.*                  Remove leading white space from alternate Id before       *
.*                  populating the IHI number - XIHIID - MSTDB581             *
.*        V11.04.02 23.04.2024  DA Sarkies      TSK 0938082                   *
.*                  Fixed issues that had arisen during development           *
.*        V11.04.01 12.04.2024  DA Sarkies      TSK 0938082                   *
.*                  Added Gender, Admiss and Discharge Time and IHI details   *
.*                  for July 2024 Stat Changes                                *
.******************************************************************************
.*        V11.02.02 30/08/2022  Thanh T         TSK 0916396                   *
.*                  Changed PROCAR00 to fix operating date not showing        *  
.*        V11.02.01 09/08/2022  Thanh T         TSK 0916396                   *
.*                  Changed MSTDA000 to change item 56 to 58. Added Item      *
.*                  56, 57 and 59                                             *
.******************************************************************************
.*        V11.01.09 17/01/2022  Thanh T         TSK 0914103                   *
.*                  Changed MSTDA000 to fix Establishment Number/hospital     *
.*                  Name error
.*        V11.01.08 06/01/2022  Thanh T         TSK 0914103                   *
.*                  Changed MSTDA000, IMPCD000 and CLOS0000 to fix various    *
.*                  errors                                                    *
.*        V11.01.07 14/09/2021  DA Sarkies      TSK 0911206                   *
.*                  Changed default for hospital funding source from 99 to 98 *
.*        V11.01.06 17/08/2021  Thanh T         TSK 0897450                   *
.*                  Changed CLOS0000 to calculate the correct total           *
.*                  Psychiatric Care Days                                     *
.*        V11.01.05 16/08/2021  Thanh T         TSK 0897450                   *
.*                  Changed VCARTY00 to fix the incorrect error for care      *
.*                  type                                                      * 
.*        V11.01.04 11/08/2021  Thanh T         TSK 0897450                   *
.*                  Changed MSTDA070 to fix issue with trunscating of         *
.*                  country of birth                                          * 
.*        V11.01.03 03/08/2021  Thanh T         TSK 0897450                   *
.*                  Changed to show the quarter and extract date range        *
.*        V11.01.02 02/08/2021  Thanh T         TSK 0897450                   *
.*                  Changed to show the correct error message                 *
.*        V11.01.01 23/06/2021  Thanh T         TSK 0897450                   *
.*                  Added option 2 to extract applies from 01 Jul 2020        *
.******************************************************************************
.*        V11.00.01 10/03/2020  Jill Parkinson Task 0879163                   *
.*                  Added include SEXDSCIO                                    *
.*        V10.13.01 05/12/2018  Don Nguyen       TSK 0838558                  *
.*                  Deleted temp files (WORK8A & WORK10) on program exit      *
.*        V10.06.03 01/07/2015 J.Tan          CAR 318559                      *
.*                  Mods calculate rehab days on Cat CC HDP=20 (not 21,22,23) *
.*        V10.06.02 30/06/2015 Jill Parkinson CAR 318559                      *
.*                  Added back prep WORK8A                                    *
.*        V10.06.01 15/04/2015 Jill Parkinson CAR 315508                      *
.*                  July 2015 changes                                         *
.*        V10.05.03 05/12/2012 J.Tan           CAR 303664                     *
.*                  Get drg from patpgraf based on discharge date grouper     *
.*                  version. (GDRG000)                                        *
.*        V10.05.02 02/12/2014  J.Tan           CAR 308260                    *
.*                  Added Caretype=20&30 and to use System DRG                *
.*        V10.05.01 21/11/2014  J.Tan           CAR 302263                    *
.*                  Changes for 2014                                          *
.*        V10.03.02 30/05/2013  Don Nguyen      CAR 284345                    *
.*                  Changes for July 1 2013 (DOYR2013) extract                *
.*        V10.03.01 18/11/2011  Mike Laming     CAR 240184                    *
.*                  Changes to IBAPOSTF Post Code table - added State to Keys *
.*        V10.02.01 13/04/2011  Jill Parkinson    CAR 241503                  *
.*                  2011 July changes - added mechanical ventilation          *
.*        V10.02.01 28/03/2011  Mike Laming   CAR 240107                      *
.*                  Mods to PATECDaf & PATECOaf variables & Keys - file change*
.*        V10.01.01 24/09/2010  Steve Armstrong   CAR 230673                  *
.*                  Fixed setting of XHINDIC for non multi-hospital           *
.*                  environment.                                              *
.*        V10.00.01 23/09/2010  Steve Armstrong   CAR 230673                  *
.*                  Code to check Multi-hospital parameter had been           *
.*                  Code to check Multi-hospital parameter had been           *
.*        V10.00.01 23/09/2010  Steve Armstrong   CAR 230673                  *
.*                  Code to check Multi-hospital parameter had been           *
.*                  commented out.  Have now uncommented code.                *
.******************************************************************************
.*        V9.12.03  21/08/2009 Jill Habasque  CAR 174597                      *
.*                  Added call to CHIH0000 for leave records                  *
.*        V9.12.02  14/07/2009 Jill Habasque  CAR 174597                      *
.*                  More mods for psych day cases                             *
.*        V9.12.01  09/07/2009 Jill Habasque  CAR 174597                      *
.*                  More mods for psych days calculation                      *
.*        V9.11.04  01/05/2009 Mike Laming    CAR 195859                      *
.*                  July 2009 Changes - added ICD10 Ed.6 and DRG 5.1          *
.*        V9.11.03  18/02/2009 Jill Habasque  CAR 140056                      *
.*                  Mods to exclude leave days in psych days calculation      *
.*        V9.11.02  04/11/2008 Ian Farnell    CAR 174597                      *
.*                  commented out match to Cat A indicator 1 = 1 in REHB0000  *
.*                  changed HOSPID to XHINDIC at MVEXT000                     *
.*        V9.11.01  31/10/2008 Jill Habasque  CAR 174597                      *
.*                  Added NPSY0000 - New psych days calculation               *
.*        V9.10.03  01/09/2008 Ian Farnell    CAR 174593                      *
.*                  Fix spelling of CATDD.DDEST in ADMD2700                   *
.*        V9.10.02  12/08/2008 Sandra Barcham CAR 174568                      *
.*                  Fix duplicate XCODNUMB in file 7A                         *
.*        V9.10.01  29/04/2008 Jill Habasque  CAR 164874                      *
.*                  2008 July changes                                         *
.*        V9.09.02  22/11/2007 Peter Vela     CAR 132624                      *
.*                  Recompiled for PATCHCFD                                   *
.*        V9.09.01  17/09/2007 Ebon Clements  CAR 150022                      *
.*                  Add psyciatric care days to acute care days               *
.*        V9.08.03  03/05/2007 Ebon Clements  CAR 139414 140041 140043        *
.*                  2007 mods, changes to fix HITH days calculation           *
.*                  Mods to get the DRG and MDC from patpgraf only            *
.*        V9.08.02  20/04/2007 Jill Habasque  CAR 139025                      *
.*                  Mods to use PTVANHSC if populated                         *
.*        V9.08.01  17/10/2006 Sandra Barcham CAR  121196                     *
.*                  Stop Same Day Status using category KN should use PTCNDSCI*
.*        V9.06.02  16/06/2006  Peter Vela    CAR 108814                      *
.*                  2006 Statutory Changes                                    *
.*                  Added New Variables Diags, Procs, Ref Hosp Tran Dest      *
.*                  Added CRDATE1 (2006 cut off date)                         *
.*                  Added WORK5 opens and closes                              *
.*                  Added new episode record                                  *
.*        V9.06.01  17/08/2005  Jill Habasque CAR 60782                       *
.*                  Commented out check for leave on day of admission         *
.*        V9.04.09  26/07/2005  Jill Habasque CAR 60782                       *
.*                  Fixed mode of admission                                   *
.*                  Changed MDC to come from patpgraf                         *
.*                  Added use of pmvxpalc for previous palliative patient     *
.*        V9.04.08  18/07/2005  Jill Habasque CAR 60782                       *
.*                  Added match for adate to chdate to ignore care type       *
.*                  changes on day of admission                               *
.*        V9.04.07  14/07/2005  Jill Habasque CAR 54733                       *
.*                  Mods to pack XACCOMM2 with 00                             *
.*                  Fixed theatre date format to by DDMMCCYY                  *
.*                  Fixed theatre date                                        *
.*        V9.04.06  12/04/2005  Jill Habasque CAR 54733                       *
.*                  Mods to fix bed day calulations                           *
.*        V9.04.05  12/04/2005  Jill Habasque CAR 54733                       *
.*                  Mods to fix HIH bed days calulation                       *
.*        V9.04.04  25/01/2005  Guomin Fu     CAR 55795                       *
.*                  Mods to right justify Care Type field(X4CARETY)           *
.*        V9.04.03  22/11/2004  Guomin Fu     CAR 54733                       *


.*        V9.04.02  25/10/2004  Jill Habasque CAR 54596                       *
.*                  Change to use aclssft instead of ausr6                    *
.*        V9.04.01  10/08/2004  Henry Son     CAR 52576                       *
.*                  Change to use 042 DRG for ACT extract.                    *
.******************************************************************************
.*        V9.03.03  11/06/2004  Mike Laming   CAR 49016  July 2004 PRS/2      *
.*                  - Add Sex Description routine SEXDSC00 with Code "R" -    *
.*                  "Intersex" added                                          *
.*        V9.03.02  15/04/2004  Mike Laming   CAR 48888                       *
.*                  Change to only send Oper.Code with PTEOTYPE = "O"         *
.*        V9.03.01  09/01/2004  Sylvek Litewka  CAR 20222                     *
.*                  Modified procedures PDIS0000 and POPR0000 to read ICD     *
.*                  Disease and Procedure files using new IO routines and     *
.*                  patient discharge date.                                   *
.* -------------------------------------------------------------------------- *
.*        V9.02.09  20/12/2002  Mike Laming  SRF 34836 (See 18289 & 9900)     *
.*                  In GPST0000, correct mapping of W5-W9 to USR1-USR5        *
.*        V9.02.08  02/12/2002  Greg Horvat      SRF 34283                    *
.*                  Changed to use the code changes file (patchcof) to        *
.*                  calculate the care days for category CC when more than 1  *
.*                  care type change                                          *
.*        V9.02.07  29/10/2002  Guomin Fu   SRF 9900 rebound                  *
.*                  Add REPs to PTCNSORP, MHCEMPST, PTCNFPST                  *
.*        V9.02.06  28/10/2002  Guomin Fu   SRF 9900 rebound                  *
.*                  Fixed the spelling error and set default value for        *
.*                  XLEGSTAT,XACCOMM,XEMPLST, XREFCAR,XPRVSPCT,XSRFPPSY       *
.*        V9.02.05  30/09/2002  Guomin Fu   SRF 9900                          *
.*                  Get XLEGSTAT from mehlegaf(legal status) if Using Mental  *
.*                  Health parameter is set to "Y"
.*                  Get XACCOMM from mehvi1af.mhviacty if the above parameter *
.*                  set to "Y"                                                *
.*                  Get XEMPLST from mehvi1af UDF(v1-v5)if the above parameter*
.*                  set to "Y"                                                *
.*                  Get XREFCAR from mehds1af.mhdsreft  if the above parameter*
.*                  set to "Y"                                                *
.*                  Get XPRVSPCTfrom mehds1af UDF(w5-w9)if the above parameter*
.*                  set to "Y"                                                *
.*                  Get XSRFPPSYfrom mehvi1af UDF(v1-v5) or patmi1af UDF 1-11 *
.*                  if the above parameter set to "Y"                         *
.*                  set to "Y"                                                *
.*        V9.02.04  19/08/2002  Tonii SRF 20696 (rebound)                     *
.*                  Removed commas placed into extract for testing            *
.*        V9.02.03  14/08/2002  Tonii SRF 20696                               *
.*                  - populated XACCOMM2                                      *
.*                  - added 6th option (CC) for mental health XLEGSTAT        *
.*                  - popluated XDISTIME and XADMTIME                         *
.*                  - changed XDIAGRP back to 4 chars                         *
.*        V9.02.02  01/11/2001  Greg Horvat                                   *
.*                  Added xtra option to the parameter PNSWRACE & recompiled  *
.*                  for PATGILOS - Added xtra option to the parameter PTCNDSCI*
.*        V9.02.01  04/10/2001  J.Tan  01/02 mods                             *
.*                  - Added XACCOMM2                                          *
.*                  - Moved XINTLOS from position 464 to 68                   *
.*                  - Moved XIHCP from position 478 to 69                     *
.*                  - Added XADMTIME, admission time                          *
.*                  - Added XDISTIME, discharge time                          *
.*                  - Added Additional procedure field- XADPRO24              *
.*                  - Added XNURSING, Nursing home type care days             *
.*                     Cat. Code 'CL', Indicator 2 = N                        *
.*                  - Mods to use new Country codes after July 1st 2001       *
.******************************************************************************
.*        V5.10.B01 26/02/2001  Jill Habasque                                 *
.*                  Mods for ABWGHT - changed to DIM 6                        *
.*        V5.09.B02 27/12/2000  Jill Habasque
.*                  Removed read of the ICD9 file in PDIS0000                 *
.*        V5.09.B01 22/12/2000  Ebon Clements SRF 7996                        *
.*                  Changed to make indigenous status 9 a valid status        *
.*        V5.08.06  07/12/2000  Jill Habasque SRF 7265                        *
.*                  Changed private/public to be tcindc10 of category CL      *
.*                  Fixed veterans affairs to default to 2(no)                *
.*        V5.08.05  15/09/2000  Jill Habasque                                 *
.*                  Mods to use GDRG0000 (copied from BIL55)                  *
.*        V5.08.04  04/09/2000  Davin                                         *
.*                  Recompiled for GETDRG                                     *
.*        V5.08.03  31/08/2000  Tonii                                         *
.*                  Mods to accept Indeterminate as valid patient sex desc.   *
.*        V5.08.02  16/08/2000  Caleb Sharman                                 *
.*                  Changed Health Fund variables to be 8 chars               *
.*        V5.08.01  16/05/2000  Caleb Sharman                                 *
.*                  Data dictionary updates/changes                           *
.*        V5.08.B02 14/03/2000  Greg Horvat                                   *
.*                  Changed to get the coding from the episode coding files   *
.*        V5.08.B01 08/02/2000  J Habasque SRF 637718                         *
.*                  Added morphology codes                                    *
.*        V5.07.04  25/11/1999  Davin                                         *
.*                  Changed for 4 character drgs                              *
.*        V5.07.03  24/09/1999  Jill Habasque                                 *
.*                  Added Acute and Non Acute LOS                             *
.*        V5.07.02  22/09/1999  Jill Habasque                                 *
.*                  Added Mode of Separation & Person Identification          *
.*        V5.07.01  26/07/1999  Steve Armstrong                               *
.*                  Mods to read PTCNDRSM for sector 21 instead of 20.        *
.*                  Fixed extraction of indigenous status, type of episode,   *
.*                  insurance status & compensable status also.               *
.******************************************************************************
.
          INC       STD001FD
.
          INC       IBACONFD/INC
          INC       IBAPOSFD/INC           * I-54733
          INC       OPRDEAFD/INC
          INC       PATCHCFD/INC
          INC       PATCONFD/INC
          INC       PATCODFD/INC
          INC       PATCT1FD/INC
          INC       PATCALAG/INC
          INC       PATDHEAD/INC
.
          INC       PATDO1FD/INC
          INC       PATDSCFD/INC
          INC       PATDADFD/INC           * I-54733
          INC       PATVADFD/INC
          INC       PATECDFD/INC
          INC       PATICUFD/INC
          INC       PATECOFD/INC
          INC       PATFIMFD/INC
          INC       PATFN1FD/INC
          INC       PATGSRFD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       PATINVFD/INC
          INC       PATHSPFD/INC
          INC       PATMA1FD/INC
          INC       PATQRDFD/INC
          INC       PMSAIDFD/INC
          INC       PMSPX2FD/INC
          INC       PATMI1FD/INC
          INC       PATPGRFD/INC
          INC       PATTRNFD/INC
          INC       PATWR1FD/INC
          INC       PATVISFD/INC
          INC       PATASFFD/INC
          INC       PMSAPGFD/INC
          INC       PMSVX1FD/INC
          INC       MEHCONFD/INC
          INC       MEHLEGFD/INC
          INC       MEHVI1FD/INC
          INC       MEHDS1FD/INC
+
X4ADDIA2  DIM       7       108   * Additional diagnosis 1
X4ADDIA3  DIM       7       115   * Additional diagnosis 2
X4ADDIA4  DIM       7       122   * Additional diagnosis 3
X4ADDIA5  DIM       7       129   * Additional diagnosis 4
X4ADDIA6  DIM       7       136   * Additional diagnosis 5
X4ADDIA7  DIM       7       143   * Additional diagnosis 6
X4ADDIA8  DIM       7       150   * Additional diagnosis 7
X4ADDIA9  DIM       7       157   * Additional diagnosis 8
X4DDIA10  DIM       7       164   * Additional diagnosis 9
X4DDIA11  DIM       7       171   * Additional diagnosis 10
X4DDIA12  DIM       7       178   * Additional diagnosis 11
X4DDIA13  DIM       7       185   * Additional diagnosis 12
X4DDIA14  DIM       7       192   * Additional diagnosis 13
X4DDIA15  DIM       7       199   * Additional diagnosis 14
X4DDIA16  DIM       7       206   * Additional diagnosis 15
X4DDIA17  DIM       7       213   * Additional diagnosis 16
X4DDIA18  DIM       7       220   * Additional diagnosis 17
X4DDIA19  DIM       7       227   * Additional diagnosis 18
X4DDIA20  DIM       7       234   * Additional diagnosis 19
X4DDIA21  DIM       7       241   * Additional diagnosis 20
X4DDIA22  DIM       7       248   * Additional diagnosis 21
X4DDIA23  DIM       7       255   * Additional diagnosis 22
X4DDIA24  DIM       7       262   * Additional diagnosis 23
X4DDIA25  DIM       7       269   * Additional diagnosis 24
X4DDIA26  DIM       7       276   * Additional diagnosis 25
X4DDIA27  DIM       7       283   * Additional diagnosis 26
X4DDIA28  DIM       7       290   * Additional diagnosis 27
X4DDIA29  DIM       7       297   * Additional diagnosis 28
X4DDIA30  DIM       7       304   * Additional diagnosis 29
X4DDIA31  DIM       7       311   * Additional diagnosis 30
X5DDIA32  DIM       7       318   * Additional diagnosis 31
X5DDIA33  DIM       7       325   * Additional diagnosis 32
X5DDIA34  DIM       7       332   * Additional diagnosis 33
X5DDIA35  DIM       7       339   * Additional diagnosis 34
X5DDIA36  DIM       7       346   * Additional diagnosis 35
X5DDIA37  DIM       7       353   * Additional diagnosis 36
X5DDIA38  DIM       7       360   * Additional diagnosis 37
X5DDIA39  DIM       7       367   * Additional diagnosis 38
X5DDIA40  DIM       7       374   * Additional diagnosis 39
X5DDIA41  DIM       7       381   * Additional diagnosis 40
X5DDIA42  DIM       7       388   * Additional diagnosis 41
X5DDIA43  DIM       7       395   * Additional diagnosis 42
X5DDIA44  DIM       7       402   * Additional diagnosis 43
X5DDIA45  DIM       7       409   * Additional diagnosis 44
X5DDIA46  DIM       7       416   * Additional diagnosis 45
X5DDIA47  DIM       7       423   * Additional diagnosis 46
X5DDIA48  DIM       7       430   * Additional diagnosis 47
X5DDIA49  DIM       7       437   * Additional diagnosis 48
X5DDIA50  DIM       7       444   * Additional diagnosis 49
XADPRO2   DIM       8       459   * Additional procedure 2
XADPRO3   DIM       8       467   * Additional procedure 3
XADPRO4   DIM       8       475   * Additional procedure 4
XADPRO5   DIM       8       483   * Additional procedure 5
XADPRO6   DIM       8       491   * Additional procedure 6
XADPRO7   DIM       8       499   * Additional procedure 7
XADPRO8   DIM       8       507   * Additional procedure 8
XADPRO9   DIM       8       515   * Additional procedure 9
XADPRO10  DIM       8       523   * Additional procedure 10
XADPRO11  DIM       8       531   * Additional procedure 11
XADPRO12  DIM       8       539   * Additional procedure 12
XADPRO13  DIM       8       547   * Additional procedure 13
XADPRO14  DIM       8       555   * Additional procedure 14
XADPRO15  DIM       8       563   * Additional procedure 15
XADPRO16  DIM       8       571   * Additional procedure 16
XADPRO17  DIM       8       579   * Additional procedure 17
XADPRO18  DIM       8       587   * Additional procedure 18
XADPRO19  DIM       8       595   * Additional procedure 19
XADPRO20  DIM       8       603   * Additional procedure 20
XADPRO21  DIM       8       611   * Additional procedure 21
XADPRO22  DIM       8       619   * Additional procedure 22
XADPRO23  DIM       8       627   * Additional procedure 23
XADPRO24  DIM       8       635   * Additional procedure 24
XADPRO25  DIM       8       643   * Additional procedure 25
XADPRO26  DIM       8       651   * Additional procedure 26
XADPRO27  DIM       8       659   * Additional procedure 27
XADPRO28  DIM       8       667   * Additional procedure 28
XADPRO29  DIM       8       675   * Additional procedure 29
XADPRO30  DIM       8       683   * Additional procedure 30
XADPRO31  DIM       8       691   * Additional procedure 31
XADPRO32  DIM       8       699   * Additional procedure 32
XADPRO33  DIM       8       707   * Additional procedure 33
XADPRO34  DIM       8       715   * Additional procedure 34
XADPRO35  DIM       8       723   * Additional procedure 35
XADPRO36  DIM       8       731   * Additional procedure 36
XADPRO37  DIM       8       739   * Additional procedure 37
XADPRO38  DIM       8       747   * Additional procedure 38
XADPRO39  DIM       8       755   * Additional procedure 39
XADPRO40  DIM       8       763   * Additional procedure 40
XADPRO41  DIM       8       771   * Additional procedure 41
XADPRO42  DIM       8       779   * Additional procedure 42
XADPRO43  DIM       8       787   * Additional procedure 43
XADPRO44  DIM       8       795   * Additional procedure 44
XADPRO45  DIM       8       803   * Additional procedure 45
XADPRO46  DIM       8       811   * Additional procedure 46
XADPRO47  DIM       8       819   * Additional procedure 47
XADPRO48  DIM       8       827   * Additional procedure 48
XADPRO49  DIM       8       835   * Additional procedure 49
XADPRO50  DIM       8       843   * Additional procedure 50
.
.         mods to extract effective for 1/7/2008
.
.WORK7     FILE      ASCII, FIXED=258
.
.NAME     TYPE    LENGTH    START   DESCRIPTION
.----     ----    ------    -----   -----------
.XHINDIC   DIM       2         1   * Hospital identification
.XPINDIC   DIM       8         3   * Person Identification ACT Number
.XPERSNO   DIM       8        11   * Person Identification
.XEPSDNO   DIM       8        19   * Episode number
.XSEX      DIM       1        27   * Sex
.XDOB      DIM       8        28   * Date of birth
.XDOBEST   DIM       3        36   * Estimated Date of Birth
.XCOB      DIM       4        39   * Country of birth
.XINDST    DIM       1        43   * Indigenous status
.XMARST    DIM       1        44   * Marital status
.XPOST     DIM       4        45   * Post code
.XSTATID   DIM       1        49   * State Identifier
.XACCOMM2  DIM       2        50   * Type of usual accommodation
.XCHRCLS   DIM       2        52   * Charging classfication
.XURGENC   DIM       1        54   * Urgency
.XMODADM   DIM       1        55   * Mode of admission
.XEMPLST   DIM       1        56   * Employement status
.XELCTST   DIM       1        57   * Election Status
.XMEDICR   DIM       1        58   * Medicare Eligibility Status
.XINSRST   DIM       1        59   * Insurance status
.X4CARETY  DIM       3        60   * Care Type
.XILOHS     DIM       1        63   * Intended Length of hospital stay
.XIHCP     DIM       1        64   * Inter- Hospital same day contracted patient
.XADMDAT   DIM       8        65   * Admission date
.XADMTIME  DIM       4        73   * Admission time
.XDISDAT   DIM       8        77   * Discharge date
.XDISTIME  DIM       4        85   * Discharge time
.X4LEAVDY  DIM       4        89   * Total leave days
.XLEAVPR   DIM       2        93   * Number of leave periods
.XSREFER   DIM       2        95   * Source of referral
.XREFDIS   DIM       2        97   * Referral on discharge
.XSEPTYP   DIM       1        99   * Type/Mode separation
.XREFCAR   DIM       1       100   * Referral to further care
.XDIAGRP   DIM       4       101   * Diagnosis related group
.XMDIACTG  DIM       2       105   * Major diagnosis category
.XINFWEIG  DIM       4       107   * Infant weight,noenate,still born
.X4SYCDAY  DIM       5       111   * Total Psychiatric care days
.XSRFPPSY  DIM       2       116   * Source of Ref to public psych
.XPRVSPCT  DIM       1       118   * Previous specialised treatment
.XLEGSTAT  DIM       1       119   * Mental health legal status
.X4CUTDAY  DIM       4       120   * Acute care days
.X4EHADAY  DIM       4       124   * Rehabilitation days
.X4ONACUT  DIM       4       128   * Non-acute care days
.X4URSING  DIM       4       132   * Nursing home care type days
.X4EONATE  DIM       4       136   * Neonate days
.XDOSA     DIM       8       140   * Theatre Presentation Date
.XHITHDAY  DIM       3       148   * Number of Days of HITH care
.XATTDOCT  DIM       5       151   * Attending Physician(Public Hospital Only)
.XCLINUIT  DIM       5       156   * Clinical Unit(Public Hospital Only)
.XLOCALIT  DIM       50      161   * Suburb/town/locality name
.XREFHOSP  DIM       4       211   * Referring Hospital ID
.XREFHOTO  DIM       4       215   * Referring Hospital ID To
.XFFAADAT  DIM       8       219   * First Function Assess after Adm Date
.XFFPADAT  DIM       8       227   * First Function Assess Prior to Adm Date
.XEMCPDAT  DIM       8       235   * Establish Multi-disiplinary Care Date
.X4PRDIAG  DIM       7       243   * Principal diagnosis
.XADPRO1   DIM       8       250   * Additional procedure 1
.
. End of record             258
.
.         mods to extract effective for 1/7/2011
.
WORK8     FILE      ASCII, FIXED=266
.
.NAME     TYPE    LENGTH    START   DESCRIPTION
.----     ----    ------    -----   -----------
XHINDIC   DIM       2         1   * Hospital identification
XPINDIC   DIM       8         3   * Person Identification ACT Number
XPERSNO   DIM       8        11   * Person Identification
XEPSDNO   DIM       8        19   * Episode number
XSEX      DIM       1        27   * Sex
XGENDER   DIM       1        28   * Sex
XDOB      DIM       8        29   * Date of birth
XDOBEST   DIM       3        37   * Estimated Date of Birth
XCOB      DIM       4        40   * Country of birth
XINDST    DIM       1        44   * Indigenous status
XMARST    DIM       1        45   * Marital status
XPOST     DIM       4        46   * Post code
XSTATID   DIM       1        50   * State Identifier
XACCOMM2  DIM       2        51   * Type of usual accommodation
XCHRCLS   DIM       2        53   * Charging classfication
XURGENC   DIM       1        55   * Urgency
XMODADM   DIM       1        56   * Mode of admission
XEMPLST   DIM       1        57   * Employement status
XELCTST   DIM       1        58   * Election Status
XMEDICR   DIM       1        59   * Medicare Eligibility Status
XINSRST   DIM       1        60   * Insurance status
X4CARETY  DIM       3        61   * Care Type
XILOHS    DIM       1        64   * Intended Length of hospital stay
XIHCP     DIM       1        65   * Inter- Hospital same day contracted patient
XADMDAT   DIM       8        66   * Admission date
XADMTIME  DIM       4        74   * Admission time
XDISDAT   DIM       8        78   * Discharge date
XDISTIME  DIM       4        86   * Discharge time
X4LEAVDY  DIM       4        90   * Total leave days
XLEAVPR   DIM       2        94   * Number of leave periods
XSREFER   DIM       2        96   * Source of referral
XREFDIS   DIM       2        98   * Referral on discharge
XSEPTYP   DIM       1       100   * Type/Mode separation
XREFCAR   DIM       1       101   * Referral to further care
XDIAGRP   DIM       4       102   * Diagnosis related group
XMDIACTG  DIM       2       106   * Major diagnosis category
XINFWEIG  DIM       4       108   * Infant weight,noenate,still born
X4SYCDAY  DIM       5       112   * Total Psychiatric care days
XSRFPPSY  DIM       2       117   * Source of Ref to public psych
XPRVSPCT  DIM       1       119   * Previous specialised treatment
XLEGSTAT  DIM       1       120   * Mental health legal status
X4CUTDAY  DIM       4       121   * Acute care days
X4EHADAY  DIM       4       125   * Rehabilitation days
X4ONACUT  DIM       4       129   * Non-acute care days
X4URSING  DIM       4       133   * Nursing home care type days
X4EONATE  DIM       4       137   * Neonate days
XDOSA     DIM       8       141   * Theatre Presentation Date
XHITHDAY  DIM       3       149   * Number of Days of HITH care
XATTDOCT  DIM       5       152   * Attending Physician(Public Hospital Only)
XCLINUIT  DIM       5       157   * Clinical Unit(Public Hospital Only)
XLOCALIT  DIM       50      162   * Suburb/town/locality name
XREFHOSP  DIM       4       212   * Referring Hospital ID
XREFHOTO  DIM       4       216   * Referring Hospital ID To
XFFAADAT  DIM       8       220   * First Function Assess after Adm Date
XFFPADAT  DIM       8       228   * First Function Assess Prior to Adm Date
XEMCPDAT  DIM       8       236   * Establish Multi-disiplinary Care Date
X4PRDIAG  DIM       7       244   * Principal diagnosis
XADPRO1   DIM       8       251   * Additional procedure 1
XMECHVT   DIM       8       259   * Mechanical Ventilation
XIHIID    DIM       16      267   * Individual Healthcare Identifier
XIHIRS    DIM       16      283   * Individual Healthcare Id Resource Status
XIHINS    DIM       16      299   * Individual Healthcare Id Number Status
.
. End of record             315
.
.
.         Mods for extract effective from 1/7/2013
.
WORK9     FILE      ASCII, FIXED=285
.
.NAME     TYPE    LENGTH    START   DESCRIPTION
.----     ----    ------    -----   -----------
.XHINDIC   DIM       2         1   * Hospital identification
.XPINDIC   DIM       8         3   * Person Identification ACT Number
.XPERSNO   DIM       8        11   * Person Identification
.XEPSDNO   DIM       8        19   * Episode number
.XSEX      DIM       1        27   * Sex
.XDOB      DIM       8        28   * Date of birth
.XDOBEST   DIM       3        36   * Estimated Date of Birth
.XCOB      DIM       4        39   * Country of birth
.XINDST    DIM       1        43   * Indigenous status
.XMARST    DIM       1        44   * Marital status
.XPOST     DIM       4        45   * Post code
.XSTATID   DIM       1        49   * State Identifier
.XACCOMM2  DIM       2        50   * Type of usual accommodation
.XCHRCLS   DIM       2        52   * Charging classfication
.XURGENC   DIM       1        54   * Urgency
.XMODADM   DIM       1        55   * Mode of admission
.XEMPLST   DIM       1        56   * Employement status
.XELCTST   DIM       1        57   * Election Status
.XMEDICR   DIM       1        58   * Medicare Eligibility Status
.XINSRST   DIM       1        59   * Insurance status
.X4CARETY  DIM       3        60   * Care Type
.XILOHS     DIM       1        63   * Intended Length of hospital stay
.XIHCP     DIM       1        64   * Inter- Hospital same day contracted patient
.XADMDAT   DIM       8        65   * Admission date
.XADMTIME  DIM       4        73   * Admission time
.XDISDAT   DIM       8        77   * Discharge date
.XDISTIME  DIM       4        85   * Discharge time
.X4LEAVDY  DIM       4        89   * Total leave days
.XLEAVPR   DIM       2        93   * Number of leave periods
.XSREFER   DIM       2        95   * Source of referral
.XREFDIS   DIM       2        97   * Referral on discharge
.XSEPTYP   DIM       1        99   * Type/Mode separation
.XREFCAR   DIM       1       100   * Referral to further care
.XDIAGRP   DIM       4       101   * Diagnosis related group
.XMDIACTG  DIM       2       105   * Major diagnosis category
.XINFWEIG  DIM       4       107   * Infant weight,noenate,still born
.X4SYCDAY  DIM       5       111   * Total Psychiatric care days
.XSRFPPSY  DIM       2       116   * Source of Ref to public psych
.XPRVSPCT  DIM       1       118   * Previous specialised treatment
.XLEGSTAT  DIM       1       119   * Mental health legal status
.X4CUTDAY  DIM       4       120   * Acute care days
.X4EHADAY  DIM       4       124   * Rehabilitation days
.X4ONACUT  DIM       4       128   * Non-acute care days
.X4URSING  DIM       4       132   * Nursing home care type days
.X4EONATE  DIM       4       136   * Neonate days
.XDOSA     DIM       8       140   * Theatre Presentation Date
.XHITHDAY  DIM       3       148   * Number of Days of HITH care
ATDOCTOR  DIM       6       151   * Attending Physician(Public Hospital Only)
.XCLINUIT  DIM       5       157   * Clinical Unit(Public Hospital Only)
.XLOCALIT  DIM       50      162   * Suburb/town/locality name
.XREFHOSP  DIM       4       212   * Referring Hospital ID
.XREFHOTO  DIM       4       216   * Referring Hospital ID To
.XFFAADAT  DIM       8       220   * First Function Assess after Adm Date
.XFFPADAT  DIM       8       228   * First Function Assess Prior to Adm Date
.XEMCPDAT  DIM       8       236   * Establish Multi-disiplinary Care Date
.X4PRDIAG  DIM       7       244   * Principal diagnosis
.XADPRO1   DIM       8       251   * Additional procedure 1
.XMECHVT   DIM       8       259   * Mechanical Ventilation
XMEDCRDN  DIM       11      267   * Medicare Card Number
XPRIHINS  DIM       1       278   * Private Health Insurance flag
XICUHOUR  DIM       4       279   * ICU Hours (Length of Stay)
XMCARETY  DIM       2       283   * Maintenance Care Type (HCP)
.
. End of record             285
.
.
.         mods to extract effective for 1/7/2008
.
WORK8A    FILE      ASCII, FIXED=258
.
.NAME     TYPE    LENGTH    START   DESCRIPTION
.----     ----    ------    -----   -----------
.XHINDIC   DIM       2         1   * Hospital identification
.XPINDIC   DIM       8         3   * Person Identification ACT Number
.XPERSNO   DIM       8        11   * Person Identification
.XEPSDNO   DIM       8        19   * Episode number
.XDISDAT   DIM       8        27   * Discharge date
XCODTYPE   DIM       4        35   * Coding type dx=diagnosis proc=procedure
XCODNUMB   DIM       3        39   * Coding number
XCODE      DIM       8        42   * Code (either procedure or diag)
XONSETFL   DIM       1        50   * Onset flag
.
. End of Record               51
.
.         Mods for extract effective from 1/7/2014
.
WORK10    FILE      ASCII, FIXED=299
.
.NAME     TYPE    LENGTH    START   DESCRIPTION
.----     ----    ------    -----   -----------
.XHINDIC   DIM       2         1   * Hospital identification
.XPINDIC   DIM       8         3   * Person Identification ACT Number
.XPERSNO   DIM       8        11   * Person Identification
.XEPSDNO   DIM       8        19   * Episode number
.XSEX      DIM       1        27   * Sex
.XDOB      DIM       8        28   * Date of birth
.XDOBEST   DIM       3        36   * Estimated Date of Birth
.XCOB      DIM       4        39   * Country of birth
.XINDST    DIM       1        43   * Indigenous status
.XMARST    DIM       1        44   * Marital status
.XPOST     DIM       4        45   * Post code
.XSTATID   DIM       1        49   * State Identifier
.XACCOMM2  DIM       2        50   * Type of usual accommodation
.XCHRCLS   DIM       2        52   * Charging classfication
.XURGENC   DIM       1        54   * Urgency
.XMODADM   DIM       1        55   * Mode of admission
.XEMPLST   DIM       1        56   * Employement status
.XELCTST   DIM       1        57   * Election Status
.XMEDICR   DIM       1        58   * Medicare Eligibility Status
.XINSRST   DIM       1        59   * Insurance status
.X4CARETY  DIM       3        60   * Care Type
.XILOHS     DIM       1        63   * Intended Length of hospital stay
.XIHCP     DIM       1        64   * Inter- Hospital same day contracted patient
.XADMDAT   DIM       8        65   * Admission date
.XADMTIME  DIM       4        73   * Admission time
.XDISDAT   DIM       8        77   * Discharge date
.XDISTIME  DIM       4        85   * Discharge time
.X4LEAVDY  DIM       4        89   * Total leave days
.XLEAVPR   DIM       2        93   * Number of leave periods
.XSREFER   DIM       2        95   * Source of referral
.XREFDIS   DIM       2        97   * Referral on discharge
.XSEPTYP   DIM       1        99   * Type/Mode separation
.XREFCAR   DIM       1       100   * Referral to further care
.XDIAGRP   DIM       4       101   * Diagnosis related group
.XMDIACTG  DIM       2       105   * Major diagnosis category
.XINFWEIG  DIM       4       107   * Infant weight,noenate,still born
.X4SYCDAY  DIM       5       111   * Total Psychiatric care days
.XSRFPPSY  DIM       2       116   * Source of Ref to public psych
.XPRVSPCT  DIM       1       118   * Previous specialised treatment
.XLEGSTAT  DIM       1       119   * Mental health legal status
.X4CUTDAY  DIM       4       120   * Acute care days
.X4EHADAY  DIM       4       124   * Rehabilitation days
.X4ONACUT  DIM       4       128   * Non-acute care days
.X4URSING  DIM       4       132   * Nursing home care type days
.X4EONATE  DIM       4       136   * Neonate days
.XDOSA     DIM       8       140   * Theatre Presentation Date
.XHITHDAY  DIM       3       148   * Number of Days of HITH care
.ATDOCTOR  DIM       6       151   * Attending Physician(Public Hospital Only)
.XCLINUIT  DIM       5       157   * Clinical Unit(Public Hospital Only)
.XLOCALIT  DIM       50      162   * Suburb/town/locality name
.XREFHOSP  DIM       4       212   * Referring Hospital ID
.XREFHOTO  DIM       4       216   * Referring Hospital ID To
.XFFAADAT  DIM       8       220   * First Function Assess after Adm Date
.XFFPADAT  DIM       8       228   * First Function Assess Prior to Adm Date
.XEMCPDAT  DIM       8       236   * Establish Multi-disiplinary Care Date
.X4PRDIAG  DIM       7       244   * Principal diagnosis
.XADPRO1   DIM       8       251   * Additional procedure 1
.XMECHVT   DIM       8       259   * Mechanical Ventilation
.XMEDCRDN  DIM       11      267   * Medicare Card Number
.XPRIHINS  DIM       1       278   * Private Health Insurance flag
.XICUHOUR  DIM       4       279   * ICU Hours (Length of Stay)
.XMCARETY  DIM       2       283   * Maintenance Care Type (HCP)
XCONHSUR  DIM       8       285   * Contract Hospital Patients URN
XCONORID  DIM       4       293   * Contract Hospital Organisation Identifier
XCONROLE  DIM       1       297   * Contract Role
XCONTYPE  DIM       1       298   * Contract Type
.
. End of record             299
.
.
.         Mods for extract effective f0om 1/7/2021
. csv size with commas = 1946 + (59-1) fields
.                      = 2004 + 4 + 49 + 99 = 2156 (comas in 3 arrays)  
.
.WORK20    FILE      ASCII, FIXED=1749
WORK20    FILE      ASCII, FIXED=1946
.
.NAME     TYPE    LENGTH    START   DESCRIPTION
.----     ----    ------    -----   -----------
XRECIND    DIM      80         1   * State Record Identifier
XESTNUM    DIM       9        81   * Establishment Number
XHSPGEOI   DIM       1        90   * Hospital Geographical Indicator
XPERINDT   DIM      20        91   * Person Identifier
.XSEX      DIM       1       111   * Sex
.XDOB      DIM       8       112   * Date of Birth
.XCOB      DIM       4       120   * Country of Birth
.XINDST    DIM       1       124   * Indigenous Status
.XMARST    DIM       1       125   * Marital Status
XAREARES   DIM       9       126   * Area of Usual Residence               *10
.XPOST     DIM       4       135   * Australian Postcode
.XACCOMM2  DIM       2       139   * Type of Usual Accommodation
XACCOMMP   DIM       1       141   * Type of Accommodation Prior to Admission
XLABFOR    DIM       1       142   * Labour Force Status
XLABFORP   DIM       1       143   * Labour Force Status – Public Psych
.                                  * Admissions
.XELCTST   DIM       1       144   * Admitted Patient Election Status
.XINSRST   DIM       1       145   * Hospital Insurance Status
.XMEDICR   DIM       1       146   * Medicare Eligibility Status
XFNDSRC    DIM       2       147   * Funding Source for Hospital
X2CARETY   DIM       2       149   * Care Type                             *20
XQLFDAYS   DIM       5       151  * Number of Qualified Days for Newborns
XPSYCDAY   DIM       5       156   * Total Psychiatric Care Days
.XLEGSTAT  DIM       1       161   * Mental Health Legal Status
.XPRVSPCT  DIM       1       162   * Previous Specialised Treatment
.XADMDAT   DIM       8       163   * Admission Date
.XDISDAT   DIM       8       171   * Separation Date
X5LEAVDY   DIM       5       179   * Total Number of Leave Days
.XSREFER   DIM       2       184   * Source of Referral to Public Psychiatric
.                                  * Hospitals
.XURGENC   DIM       1       186   * Urgency of Admission                  
.XMODADM   DIM       1       187   * Mode of Admission                     *30
XMODSEP    DIM       2       188   * Mode of Separation
XREFDES    DIM       1       190   * Referral Destination (Mental Health Care)
.XINFWEIG  DIM       4       191   * Weight
.XILOHS    DIM       1       195   * Intended Length of Hospital Stay
XHIHCDAY   DIM       5       196   * Number of Days of Hospital in the Home Care
XCNHSPC    DIM       9       201   * Contracted Hospital Care Establishment
.                                  * Identifier
XCNPTSTS   DIM       1       210   * Inter-Hospital Contracted Patient Status
XICUHRS    DIM       4       211   * Length of Stay in Intensive Care Unit
XVENHRS    DIM       4       215   * Duration of Continuous Ventilatory Support
XESTWATI   DIM       9       219   * Establishment Identifier for Hospital  *40
.                                  * Managing Waiting List
XELSTAR    DIM      20[5]    228   * Elective Surgery Waiting Times Cluster
.                                  * Procedure Array
XPROCAR    DIM       8[50]   328   * Procedure Code Array
XDIAGAR    DIM       8[100]  728   * Diagnosis Code Array
XMEHEPSI   DIM      80      1528   * Mental Health Episode Identifier
XPRIIMPT   DIM       7      1608   * Primary Impairment Type
XFIMSAR    DIM       1[18]  1615   * Functional Independence Measure (FIM)
.                                  * Score Array
XRSULGRP   DIM       2      1633   * Resource Utilisation Groups – Activities
.                                  * of Daily Living (RUG-ADL) Total Score
XNATOSAR   DIM       1[12]  1635   * Health of the Nation Outcome Scale 65 +
.                                  * (HoNOS 65+) Score Array
XSTDMSAR   DIM       1[12]  1647   * Standardised Mini-Mental State Examination
.                                  * (SMMSE) Score Array
XPALCARL   DIM      50      1659   * Palliative Care Linking Key           *50
XRUNQTR    DIM       7      1709   * Quarter Indicator
XNWAU19    DIM       9      1716   * NWAU19
XNWAU20    DIM       9      1725   * NWAU20
XNWAU21    DIM       9      1734   * NWAU21
XILOHSO    DIM       4      1743   * Length of Stay in Intensive Care Unit –
.                                  * Other
XMEDINO    DIM      50      1747   * Medicare Number
XINVCNO    DIM      50      1797   * Invoice Number
XOPRDAT    DIM      50      1847   * Theatre Presentation Date
XPATNAM    DIM      50      1897   * Patient First name/Surname            *59
.
. End of record             1947
.
.        WORK AREA
.
BJDAY     FORM      3
CJDAY     FORM      3
CARETYPE  DIM       3       * C-54733 used to be DIM2
ADMISTIM  FORM      4
CDYSYEAR  FORM      2
CATD      INIT      "D "
CATDD     INIT      "DD"
CATCC     INIT      "CC"
CATGi     INIT      "Gi"
CODELS    INIT      "LS"
CODEAY    INIT      "AY"
CODECL    INIT      "CL"
CODERE    INIT      "RE"
CATU1     INIT      "U1"
CATU2     INIT      "U2"
CATU3     INIT      "U3"
CATU4     INIT      "U4"
CATU5     INIT      "U5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATU8     INIT      "U8"
CATU9     INIT      "U9"
CATP1     INIT      "P1"
CATP2     INIT      "P2"
CATP3     INIT      "P3"
CATP4     INIT      "P4"
CATP5     INIT      "P5"
CATP6     INIT      "P6"
CATRT     INIT      "RT"
CATVA     INIT      "VA"
CATVI     INIT      "VI"
CODEFLG   FORM      1
CODED     DIM       3
CATT      INIT      "T "
CNT       FORM      3
BEDTYPE   DIM       3
ROOMTYPE  DIM       3
CDYSDAYS  FORM      6
CALDAYS   FORM      6
NBRDAYS   FORM      6
CDYSFDTE  DIM       8
CDYSTDTE  DIM       8
CMDLINE   DIM       100
COUNT     FORM      3
CHRCOUNT  FORM      2                       * Character counter
DRG041    INIT      "041"
DRG042    INIT      "042"
DRG050    INIT      "050"
DRG051    INIT      "051"
DRG052    INIT      "052"
DRG060    INIT      "060"
DRG062    INIT      "062"
DRG070    INIT      "070"
DRGVERS   DIM       3
DAYCASE   FORM      1
DDRGCODE  DIM       4
DMDCCODE  DIM       4
DIM1A     DIM       1
DIM2A     DIM       2
DIM3      DIM       3
DIM4      DIM       4
DIM4A     DIM       4              * I-54733
DIM6      DIM       6
DIM7      DIM       7
DIM8      DIM       8
DIM15     DIM       15
DOYR2024  FORM      1
ERRFLG    FORM      5
ERRCDE    DIM       4
ERRMSG    DIM       40
ERRMSG1   DIM       54
ERRMSG2   DIM       54
RUNDATE   DIM       8
ERRRPFLG  DIM       1
.
FORM3     FORM      3
HOSPID    DIM       3
HOSPNAME  DIM       50
JUSTNO    FORM      2          * Right justification amount
WDATE1    DIM       8
WDATE2    DIM       8
.
SDAY      DIM       2
SMON      DIM       2
EDAY      DIM       2
EMON      DIM       2
QTRMTH    DIM       3
QTRNO     DIM       1
MTHNAM3   DIM       3
RUNQTRYR  DIM       7
SAVCLAIM  DIM       3 
SAVFUNDH  DIM       6 
SAVFUNDT  DIM       3 
.
WORKHITH  FORM      5
WORKICLS  FORM      4
WORKLDAY  FORM      5
WORKPSYC  FORM      5
WORKQUAL  FORM      5
ADMPFLAG  FORM      1
ADMTYPE   DIM       3
DEPTYPE   DIM       3
PSYCFLAG  FORM      1
SVADDATE  DIM       8
NUMLEV    FORM      2
.
LEAVNUM   FORM      2
LEAVDAY   FORM      4          * C-54733  (was FOMR 2)
LEAVDAY5  FORM      5          
LEAVDATE  DIM       8
LJUSCODE  DIM       80                      * Left justified code
MCOUNT    FORM      1
NURSEST   DIM       1          * Nursing Home status
MENTLFLG  DIM       1
OLDATYPE  DIM       3
OLDTHCS   DIM       3
RETNDATE  DIM       8
SPTEODTE  DIM       8
.
ELSTARR   DIM       104
PROCARR   DIM       449
DIAGARR   DIM       899
FIMSARR   DIM       18
NATOARR   DIM       12
STDMSARR  DIM       12
.
NOFREAD   FORM      6
NOFEXTR   FORM      6
.
FORM6     FORM      6
FILENAME  DIM       8
FILENAM2  DIM       8
FILENAM3  DIM       8
FROMDATE  DIM       8                  * From Date in CCYYMMDD format
PENDDATE  DIM       8
HENDDATE  DIM       8
PSYCFLG   FORM      1
PSTRDATE  DIM       8
HSTRDATE  DIM       8
FSTCODE   FORM      1
PSYCDAYS  FORM      5                  * C-54733( was FORM 3)
RJUSCODE  DIM       80                 * Right justified code
TPSYFLG   FORM      1
TODATE    DIM       8
SAVADMN   DIM       8
STILLHIH  FORM      1
STILLPSY  FORM      1
STODATE   DIM       8
STRDATE   DIM       8
ENDDATE   DIM       8
STRDATER  DIM       11
ENDDATER  DIM       11
.
EATSCNT   FORM      1
GRMSCNT   FORM      1
BTHSCNT   FORM      1
UPBSCNT   FORM      1
LWBSCNT   FORM      1
TLTSCNT   FORM      1
BLMSCNT   FORM      1
BWMSCNT   FORM      1
TBDSCNT   FORM      1
TTLSCNT   FORM      1
TBTSCNT   FORM      1
LOCSCNT   FORM      1
STRSCNT   FORM      1
COMSCNT   FORM      1
EXPSCNT   FORM      1
SCISCNT   FORM      1
PRBSCNT   FORM      1
MEMSCNT   FORM      1
.       
Z20       INIT      "ZZZZZZZZZZZZZZZZZZZ"
ZED30     INIT      "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"
.
JAN       INIT      "Jan"
FEB       INIT      "Feb"
MAR       INIT      "Mar"
APR       INIT      "Apr"
MAY       INIT      "May"
JUN       INIT      "Jun"
JUL       INIT      "Jul"
AUG       INIT      "Aug"
SEP       INIT      "Sep"
OCT       INIT      "Oct"
NOV       INIT      "Nov"
DEC       INIT      "Dec"
.
.----------------------------------------------------------------------------
PRGID     INIT      "IBAADT55"
PRGNAM    INIT      "ACT Health Department Transmission"
VERSION   INIT      "V12.00.01"
.----------------------------------------------------------------------------
+
.**********************************************************************
.*                           MAINLINE                                 *
.**********************************************************************
ML0000    CALL      INIT0000                * initialization and open files
ML1000    CALL      OPTN0000                * select options
          BRANCH    OPTION,ML2000,ML5000
          GOTO      ML9999
.
. Option 1
.
ML2000    CALL      KEYD0000                * Keyin ending date
          BRANCH    EXIT,ML1000
.
ML2100    CALL      FILE0000                * Keyin the filename
          BRANCH    EXIT,ML2000
.
ML2400    CALL      CONTQST                 * Ok to Continue (Y/N/C) ?
          BRANCH    CEXIT,ML2500,ML2400,ML1000
.                         Yes    No     Cancel
.
ML2500    CALL      PROC0000                * Processing discharged patients
          BRANCH    EXIT,ML1000
          CALL      ENDP0000                * End of processing
          CALL      MVEXT000
.
ML2900    PREP      WORK10,FILENAME
          CLOSE     WORK10,DELETE
          PREP      WORK8A,FILENAM2
          CLOSE     WORK8A,DELETE
          GOTO      ML9999
.
. Option 2
.
ML5000    CALL      FILA0000                * Keyin the filename
          BRANCH    EXIT,ML5000
.
ML5100    CALL      KEYA0000                * Keyin ending date
          BRANCH    EXIT,ML5100
.
ML5200    CALL      REPONL00                * Report only flag
          BRANCH    EXIT,ML5200
.
ML5400    CALL      CONTQST                 * Ok to Continue (Y/N/C) ?
          BRANCH    CEXIT,ML5500,ML5400,ML1000
.                         Yes    No     Cancel
.
ML5500    CALL      PROD0000                * Processing discharged patients
          BRANCH    EXIT,ML1000
          CALL      ENDPA000                * End of processing
ML5900    MATCH     ANSY,ERRRPFLG
          IF        !@EQUAL
            CALL      MVEXC000
            CLOSE     WORK20,DELETE
          ENDIF
          GOTO      ML9999
.
ML9999    CHAIN     PGM
          STOP
+
.******************************************************************************
.*                                  INIT0000                                  *
.*                      Initialization routine                                *
.******************************************************************************
INIT0000  CALL      DISPHEAD
          CALL      IBACLOCK
          DISPLAY   *P56:24,"Opening patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"ibapostf";
          OPEN      IBAPOST1,"ibapostf"
.         
          DISPLAY   *P64:24,"patct1cf";
          OPEN      PATCT1C1,"patct1cf"
.
          DISPLAY   *P64:24,"patchcof";
          OPEN      PATCHCO1,"patchcof"
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH2,"patdschf"
.
          DISPLAY   *P64:24,"patecdaf";
          OPEN      PATECDA2,"patecdaf"
.
          DISPLAY   *P64:24,"paticuaf";
          OPEN      PATICUA1,"paticuaf"
.
          DISPLAY   *P64:24,"patecdaf";
          OPEN      PATECDA2,"patecdaf"
.
          DISPLAY   *P64:24,"patecoaf";
          OPEN      PATECOA2,"patecoaf"
.
          DISPLAY   *P64:24,"patfimaf";
          OPEN      PATFIMA1,"patfimaf"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PMSPX2A1,"pmspx2af"
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A1,"patmi1af"
.
          DISPLAY   *P64:24,"patgsrnf";
          OPEN      PATGSRN1,"patgsrnf"
.
          DISPLAY   *P64:24,"patpgraf";
          OPEN      PATPGRA1,"patpgraf"
.
          DISPLAY   *P64:24,"oprdetaf";
          OPEN      OPRDETA1,"oprdetaf"
          OPEN      OPRDETA2,"oprdetaf"
.
          DISPLAY   *P64:24,"pattranf";
          OPEN      PATTRAN2,"pattranf"
.
          DISPLAY   *P64:24,"patwr1af";
          OPEN      PATWR1A1,"patwr1af"
.
          DISPLAY   *P64:24,"paticddf";
          CALL      OPICD1
.
          DISPLAY   *P64:24,"paticdof";
          CALL      OPICO1
.
          DISPLAY   *P64:24,"patinvrf";
          OPEN      PATINVR3,"patinvrf"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA2,"patvisaf"
.
          DISPLAY   *P64:24,"patasfaf";
          OPEN      PATASFA1,"patasfaf"
.
          DISPLAY   *P64:24,"pmsvx1af";
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"mehlegaf";
          OPEN      MEHLEGA1,"mehlegaf"
.
          DISPLAY   *P64:24,"mehvi1af";
          OPEN      MEHVI1A1,"mehvi1af"
.
          DISPLAY   *P64:24,"mehds1af";
          OPEN      MEHDS1A1,"mehds1af"
.
          DISPLAY   *P64:24,"patdadaf";
          OPEN      PATDADA1,"patdadaf"
.
          DISPLAY   *P64:24,"patvadaf";
          OPEN      PATVADA1,"patvadaf"
.
          DISPLAY   *P64:24,"patqrdaf";
          OPEN      PATQRDA1,"patqrdaf"
.
          DISPLAY   *P64:24,"pathspaf";
          OPEN      PATHSPA1,"pathspaf"
.
          DISPLAY   *P64:24,"pmsapgaf";
          OPEN      PMSAPGA1,"pmsapgaf" 
.
          DISPLAY   *P64:24,"patfn1af";
          OPEN      PATFN1A1,"patfn1af"
.
          DISPLAY   *P64:24,"pmsaidaf";
          OPEN      PMSAIDA1,"pmsaidaf"
.
          DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TEN;*37,CMOPRT,*54,CFILENO,*235,CMDISP
          READ      CONTROLF,TEN3;*213,CHCSCOD,*245,CHOSTYP
          READ      CONTROLF,TWENTY1;*45,PTCNDRSM
          READ      CONTROLF,SEVENTY9;*82,PTCNDSCI,*114,PTCNPPPT
          READ      CONTROLF,EIGHTY8;*237,PTCNEMPL,*239,PTCNOCCP,*241,PTCNCSTA:
                                     *242,PNSWRACE
          READ      CONTROLF,NINTY8;*85,PTCNPSOS
          READ      CONTROLF,SIXTY9;*69,MHCNUSE,*84,MHCEMPST
          READ      CONTROLF,HUND05;*158,PTCNDGPV,*206,PTCNFPST,*208,PTCNSORP
          READ      CONTROLF,HUND19;*183,PTCNED41,*191,PTCNED42,*199,PTCNED50:
                                    *207,PTCNED51,*215,PTCNED52,*223,PTCNED60:
                                    *231,PTCNED62,*239,PTCNED70
.
... D-54733 replace with PTHSHDPC in PATHSPFD to accommodate multi-hospital 
          MOVE      CFILENO,DIM6            * should be 2-digit num.  230673
          SQUEEZE   DIM6
          MOVE      DIM6,XHINDIC
.
          MOVE      ZERO,ERRFLG
          MOVE      ZERO,PSYCFLG
.
INIT9999  RETURN
+
.******************************************************************************
.*                                  OPTN0000                                  *
.*                      Main options                                          *
.******************************************************************************
OPTN0000  HLINE     *G37,2,57,80
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,ONE,*HOFF:
                      " = ACT APC Extract Applies From 01/07/2014":
                    *P1:6,*V2LON,TWO,*HOFF:
                      " = ACT APC Extract Applies From 01/07/2021":
                    *P1:8,"Select Option : ";
.
OPTN1000  KEYIN     *P17:8,*EL,*V2LON,OPTION;
.
          COMPARE   ZERO,OPTION
          GOTO      OPTN9000 IF EQUAL
.
          MOVE      ZERO,EXIT
          BRANCH    OPTION,OPTN9999,OPTN9999
.
          BEEP
          GOTO      OPTN1000
.
OPTN9000  MOVE      ONE,EXIT
.
OPTN9999  RETURN
+
.******************************************************************************
.*                      Keyin ending date                                     *
.******************************************************************************
KEYD0000  MOVE      ZERO,DOYR2024
          DISPLAY   *P1:10,*EL,"Start Date : ":
                    *P1:12,*EL,"End   Date : ":
.... I-54733
                    *P1:14,*EL,"Hospital ID: "; 
.
          MOVE      "10",CVERT
          MOVE      "15",CCOL
          UNPACK    SP6,CYEAR,CMON,CDAY
          MOVE      CCC,CCENT
          MOVE      ZERO,CHIGHLT
          MOVE      ZERO,CDEFDTE
          CALL      KEYDATE
          BRANCH    OVRCD,KEYD9500
          PACK      STRDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRDATE
.
          MOVE      "12",CVERT
          MOVE      "15",CCOL
          UNPACK    SP6,CYEAR,CMON,CDAY
          MOVE      CCC,CCENT
          MOVE      ZERO,CHIGHLT
          MOVE      ZERO,CDEFDTE
          CALL      KEYDATE
          BRANCH    OVRCD,KEYD9500
.
          PACK      ENDDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ENDDATE
.
.... I -54733  enter Hospital ID
          COMPARE   ONE,IBCNMHOS                 * CAR 230673
          GOTO      KEYD6000 IF NOT EQUAL
.
          MOVE       "15",ECOL
          MOVE       "14",EVERT
          MOVE       SP3,CKYIDEF3
          MOVE       ONE,CKYIMAND           * Mandatory for Multi hospital
.
          CALL       PATHSPKY
          BRANCH     EXIT,KEYD9500,KEYD9500
          MOVE       PTHSHOSP,HOSPID
          MOVE       PTHSNAME,HOSPNAME
          MOVE       PTHSHDPC,XHINDIC        * C-54733
          DISPLAY   *P15:14,*V2LON,PTHSNAME 
.        The new ending date should be greater than the Last Ending Date
.
KEYD6000  MOVE      ZERO,EXIT
          MATCH     ENDDATE,STRDATE
          GOTO      KEYD9999 IF LESS
.
          UNPACK    STRDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          DISPLAY   *P1:24,*EL,*B,*V2LON,"End Date must be greater than ":
                    "Start date ",CPCDATE,".  ";
          CALL      HITENTER
          GOTO      KEYD0000
.
KEYD9500  MOVE      ONE,EXIT
KEYD9999  RETURN
+
.******************************************************************************
.*                      Keyin ending date                                     *
.******************************************************************************
KEYA0000  MOVE      ZERO,DOYR2024
          DISPLAY   *P1:12,*EL,"Extract End Date : ":
                    *P1:14,*EL,"Hospital ID      : ";
.
          MOVE      "12",CVERT
          MOVE      "20",CCOL
          UNPACK    SP6,CYEAR,CMON,CDAY
          MOVE      CCC,CCENT
          MOVE      ZERO,CHIGHLT
          MOVE      ZERO,CDEFDTE
          CALL      KEYDATE
          BRANCH    OVRCD,KEYA9500
.
          PACK      RUNDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",RUNDATE
.
          COMPARE   ONE,IBCNMHOS
          GOTO      KEYA9999 IF NOT EQUAL
.
          MOVE       "14",EVERT
          MOVE       "20",ECOL
          MOVE       SP3,CKYIDEF3
          MOVE       ONE,CKYIMAND           * Mandatory for Multi hospital
.
          CALL       PATHSPKY
          BRANCH     EXIT,KEYA9500,KEYA9500
          MOVE       PTHSHOSP,HOSPID
          MOVE       PTHSNAME,HOSPNAME
          MOVE       PTHSHDPC,XHINDIC
          DISPLAY   *P24:12,*V2LON,PTHSNAME
.
          MOVE      ZERO,EXIT
          GOTO      KEYD9999 
.
KEYA9500  MOVE      ONE,EXIT
KEYA9999  RETURN
+
.******************************************************************************
.*                            Get Extract Filename                            *
.******************************************************************************
FILE0000  MOVE      "16",CVERT
          DISPLAY   *P1:CVERT,*EL,"Extract File Name: ";
.
FILE1000  MOVE      "HDP",KEY3
          UNPACK    ENDDATE,CCENT,CYEAR,CMON,CDAY
          PACK      FILENAME,KEY3,CDAY,CMON,SP10
          KEYIN     *P19:CVERT,*EL,*V2LON,*RV,FILENAME;
.
          ENDSET    FILENAME
          APPEND    SP8,FILENAME
          RESET     FILENAME
          UNPACK    FILENAME,DIM7
          PACK      FILENAM2,DIM7,TWO
.
          CMATCH    EXITCHAR,FILENAME
          GOTO      FILE9500 IF EQUAL       * Exit
.
          MATCH     SP8,FILENAME
          GOTO      FILE9500 IF EQUAL       * Exit
.
          STRIP     FILENAME
          SQUEEZE   FILENAME
          DISPLAY   *P21:CVERT,*EL,*V2LON,*+,FILENAME,".txt";
.
FILE1900  MOVE      ZERO,OVRCD     
          TRAP      OVERCOND IF IO
          OPEN      WORK10,FILENAME
          TRAPCLR   IO
          BRANCH    OVRCD,FILE9000          * File doesnt exist
          CLOSE     WORK10
.
FILE2000  KEYIN     *P1:24,*B,*EL,"An extraction file with this name":
                    " already exists. Overwrite it (",*V2LON,*DV,ANSY:
                    *HOFF,"/",*V2LON,*DV,ANSN,*HOFF,") ? ",*V2LON,ANS;
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      FILE9000 IF EQUAL       * Overwrite file
.
          MATCH     ANSN,ANS
          GOTO      FILE1000 IF EQUAL       * Keyin filename again
.
          BEEP
          GOTO      FILE2000
.
FILE9000  MOVE      ZERO,EXIT
          GOTO      FILE9999
.
FILE9500  MOVE      ONE,EXIT
FILE9999  RETURN
.
.******************************************************************************
.*                            Get Extract Filename                            *
.******************************************************************************
FILA0000  MOVE      "10",CVERT
          DISPLAY   *P1:CVERT,*EL,"Extract File Name: ";
.
FILA1000  MOVE      "HDP",KEY3
          UNPACK    RUNDATE,CCENT,CYEAR,CMON,CDAY
          PACK      FILENAM3,KEY3,CDAY,CMON,SP10
          KEYIN     *P20:CVERT,*EL,*V2LON,*RV,FILENAM3;
.
          ENDSET    FILENAM3
          APPEND    SP8,FILENAM3
          RESET     FILENAM3
.
          CMATCH    EXITCHAR,FILENAM3
          GOTO      FILA9500 IF EQUAL       * Exit
.
          MATCH     SP70,FILENAM3
          GOTO      FILA9500 IF EQUAL       * Exit
.
          STRIP     FILENAM3
          SQUEEZE   FILENAM3
          DISPLAY   *P20:CVERT,*EL,*V2LON,*+,FILENAM3,".txt";
.
FILA9000  MOVE      ZERO,EXIT
          GOTO      FILA9999
.
FILA9500  MOVE      ONE,EXIT
FILA9999  RETURN
.
.******************************************************************************
.* Get Error Report Only Flag                                                 *
.******************************************************************************
REPONL00  MOVE      "16",CVERT
          DISPLAY   *P1:CVERT,*EL,"Error Report Only (":
                    *V2LON,ANSY,*HOFF,SLASH:
                    *V2LON,ANSN,*HOFF:
                    "): ";
.
          MOVE      ANSN,ERRRPFLG
.
          KEYIN     *P26:CVERT,*EL,*V2LON,*RV,ERRRPFLG;
          REP       UPPLOW,ERRRPFLG
.
          MATCH     ANSY,ERRRPFLG
          GOTO      REPONL80 IF EQUAL
.
          MATCH     ANSN,ERRRPFLG
          GOTO      REPONL80 IF EQUAL
.
          BEEP
          GOTO      REPONL00 
.
REPONL80  MOVE      ZERO,EXIT
REPONL99  RETURN
.
.******************************************************************************
.*                                  PROC0000                                  *
.*                      Processing discharges patients                        *
.******************************************************************************
.        Create the header record for the transmission file
.
PROC0000  MOVE      ZERO,CPAGENO
          UNPACK    ENDDATE,XCENT,XYEAR,XMON,XDAY
.
          CLOSE     WORK10
          PREP      WORK10,FILENAME
          CLOSE     WORK8A
          PREP      WORK8A,FILENAM2
.
PROC0700  DISPLAY   *P1:24,*EL,*P20:24,*V2LON,"** Processing Discharges **",*W:
                    *P20:24,*EL,"Discharged Admission No. : ";
.
          MOVE      ENDDATE,STODATE
          PACK      KEY16,STRDATE,SP8
          CALL      RDSDSCH2
PROC1000  CALL      RDKDSCH2
          BRANCH    OVRCD OF PROC9000
.
.         Multi-Hospital Processing
.
          COMPARE   ONE,IBCNMHOS
          GOTO      PROC2000 IF NOT EQUAL
.
          MATCH     SP10,PTHSHOSP
          GOTO      PROC2000 IF EQUAL
.
          MOVE      DADMNO,KEY8
          CALL      RDPMVX11
          BRANCH    OVRCD,PROC1000
.
          MATCH     PMVXMHOS,PTHSHOSP
          GOTO      PROC1000 IF NOT EQUAL
.
PROC2000  MATCH     DDATE,STODATE
          GOTO      PROC9000 IF LESS
.
          MOVE      DDATE,ICDRDDTE          * Used of reading ICD files
.
          DISPLAY   *P50:24,*V2LON,DADMNO;
.
          MOVE      DURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF PROC3000
.
.... I-54733
          MOVE      PURNO,KEY8
          CALL      RDPMPX21 
....
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF PROC4000
.
          MOVE      ZERO,DAYCASE
          MATCH     ADATE,DDATE
          IF        @EQUAL
            MOVE      ONE,DAYCASE
          ENDIF
.
          MOVE      "0",XLEGSTAT
.
          COMPARE   ONE,MHCNUSE
          IF        @EQUAL
            CALL      GMLS0000
            GOTO      PROC2100
          ENDIF
.
          IF        PTCNCSTA = 6
            PACK      KEY5,CATCC,ACARE
            CALL      RDCODE1
            IF        OVRCD<>1
              UNPACK    THCSCOD,XLEGSTAT     * mental health legal status
            ENDIF
          ELSE
            LOAD      ACODE,PTCNCSTA,DUSD1,DUSD2,DUSD3,DUSD4,DUSD5
            MATCH     SP3,ACODE
            IF        !@EQUAL
              PACK      KEY5,ANSD,PTCNCSTA,ACODE    * Mental Health Legal Stat
              CALL      RDCODE1
              IF        OVRCD<>1
                MOVE      THCSCOD,XLEGSTAT
              ENDIF
            ENDIF
          ENDIF
.
PROC2100  REP       " 0",XLEGSTAT
.
          CALL      WRIT0000
          GOTO      PROC1000
.
PROC3000  DISPLAY   *P1:22,*B,*EL,*V2LON,DADMNO,*HOFF:
                    " missing Master record":
                    "..  Please Contact I.B.A. **";
          GOTO      PROC5000
.
PROC4000  DISPLAY   *P1:22,*B,*EL,*V2LON,DADMNO,*HOFF:
                    " missing Admission record":
                    "..  Please Contact I.B.A. **";
.
PROC5000  KEYIN     *P1:23,*EL,"(",*V2LON,*DV,ANSS,*HOFF,")kip this record, (":
                           *V2LON,*DV,ANSA,*HOFF,")bort process ? ",*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     "S" TO ANS
          GOTO      PROC6000 IF EQUAL
          MATCH     "A" TO ANS
          GOTO      PROC7000 IF EQUAL
          BEEP
          GOTO      PROC5000
.
PROC6000  DISPLAY   *P1:22,*EL,*P1:23,*EL;
          GOTO      PROC1000
.
PROC7000  PREP      WORK10,FILENAME
          CLOSE     WORK10,DELETE
.
          MOVE      ONE,EXIT
          GOTO      PROC9999
.
PROC9000  MOVE      ZERO,EXIT
PROC9999  IF        ERRFLG <>0
            DISPLAY   *P1:24,*EL,*B,"Errors found.  ";
            CALL      HITENTER
            PRINT     *1,"------------------------------------------":
                         "-------------"
          ENDIF
          RETURN
+
.******************************************************************************
.*                                  GMLS0000              Called by: PROC0000 *
.*                      Get legal status from mehlegaf                        *
.******************************************************************************
GMLS0000     PACK       KEY21,AADMNO,Z20
             CALL       RSMHLEG1
             CALL       RPMHLEG1
             MATCH      AADMNO,MHLEADMN
             IF         @EQUAL
              PACK        KEY5,CODELS,MHLESTAT
              CALL        RDCODE1
              IF          OVRCD<>1
                MOVE        THCSCOD,XLEGSTAT
              ENDIF
             ENDIF

GMLS9999     RETURN
+
.******************************************************************************
.*                                  WRIT0000              Called by: PROC0000 *
.*                      Write the record details                              *
.******************************************************************************
WRIT0000  CALL      MSTD0000                * extract master details
          CALL      ADMD0000                * extract admission details
.
          CALL      GDRG0000
          CALL      TRAN0000                * looping through transaction file
          CALL      VIST0000
          CALL      REHB0000 
.
          MOVE      "00000",X4SYCDAY        * I-54733
          MOVE      PSYCDAYS,X4SYCDAY       * I-54733
          REP       " 0",X4SYCDAY
.
          MOVE      X4CUTDAY,FORM4
.         ADD       PSYCDAYS,FORM4
          MOVE      FORM4,X4CUTDAY
          REP       " 0",X4CUTDAY
.
          CALL      VALD0000
          WRITE     WORK10,SEQ;XHINDIC,XPINDIC,XPERSNO,XEPSDNO,XSEX:
                            XDOB,XDOBEST,XCOB,XINDST,XMARST,XPOST,XSTATID:
                            XACCOMM2,XCHRCLS,XURGENC,XMODADM,XEMPLST:
                            XELCTST,XMEDICR,XINSRST,X4CARETY,XILOHS,XIHCP:
                            XADMDAT,XADMTIME,XDISDAT,XDISTIME,X4LEAVDY,XLEAVPR:
                            XSREFER,XREFDIS,XSEPTYP,XREFCAR,XDIAGRP,XMDIACTG:
                            XINFWEIG,X4SYCDAY,XSRFPPSY,XPRVSPCT:
                            XLEGSTAT,X4CUTDAY,X4EHADAY,X4ONACUT,X4URSING:
                            X4EONATE,XDOSA,XHITHDAY,ATDOCTOR,XCLINUIT:
                            XLOCALIT,XREFHOSP,XREFHOTO,XFFAADAT,XFFPADAT:
                            XEMCPDAT,X4PRDIAG,XADPRO1,XMECHVT,XMEDCRDN:
                            XPRIHINS,XICUHOUR,XMCARETY:
                            XCONHSUR,XCONORID,XCONROLE,XCONTYPE
.
          CALL      PDIA0000
          CALL      PPRO0000
.
WRIT9999  RETURN
+
.******************************************************************************
.*                                  MSTD0000              Called by: WRIT0000 *
.*                         Extract master details                             *
.******************************************************************************
MSTD0000  MOVE      PURNO,XPINDIC           * U/R number
          MOVE      PURNO,XPERSNO
          MOVE      ZERO,PSYCFLG
.
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          MOVE      DSEXNO,XSEX
.* ******************************************   End of Changes         *C-49016
.... I -54733 "4" is invalid for ACT extract
          MATCH     "4",XSEX
          IF        @EQUAL
            MOVE      "3",XSEX
          ENDIF
....
MSTD1000  UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
          PACK      XDOB,XDAY,XMON,XCENT,XYEAR * Birth date DDMMCCYY
          REP       " 0",XDOB
.
          MOVE      SP10,XCOB              * Country of Birth
          PACK      KEY5,ANSC,SP1,PCONT
          CALL      RDCODE1
          IF        OVRCD=0
            UNPACK    TCFORM6,DIM2,XCOB
            REP       " 0",XCOB
          ENDIF
.
          MOVE      "9",XINDST              * Indigenous status
....      UNPACK    SP10,TCODE,ACODE
....      MATCH     SP3,ACODE
....      IF        !@EQUAL
            MOVE      "VA",TCODE            * I-54733
            MOVE      PMPXABRG,ACODE        * I-54733
            PACK      KEY5,TCODE,ACODE
            CALL      RDCODE1
            IF        OVRCD = 0
              MATCH     SP4,THCSCOD
              IF        !@EQUAL
                UNPACK    THCSCOD,XINDST           * Aboriginal
              ENDIF
            ENDIF
....      ENDIF
.
.         Marital Status
.
          MOVE      "6",XMARST
          PACK      KEY5,ANSM,SP1,PMSTAT
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      THCSCOD,XMARST        * Marital status
...         MATCH     "1",XMARST
...         IF        !@EQUAL
...           IF        PSAGE<16
...             MOVE      "1",XMARST
...           ENDIF
...         ENDIF
          ENDIF
.
          MOVE      PPOST,XPOST            * Post code 
          COMPARE   ONE,MHCNUSE
          IF        @EQUAL
            CALL      GACC0000
          ELSE
            MOVE      "00",XACCOMM2           * Type of usual accommodation
          ENDIF
          MOVE      "99",XCHRCLS            * charging classification
          PACK      KEY5,ANSA,SP1,ATYPE
          CALL      RDCODE1
          BRANCH    OVRCD,MSTD1200
.
          MATCH     SP4,THCSCOD
          GOTO      MSTD1200 IF EQUAL
.
          MOVE      THCSCOD,XCHRCLS
.
          MATCH     ANSP,TCINDC3
          IF        @EQUAL
            MOVE      ONE,PSYCFLG
          ENDIF
...
          MATCH     SP2,XCHRCLS
          GOTO      MSTD1500 IF NOT EQUAL
          
MSTD1200  PACK      KEY5,CODECL,ACLAIM
          CALL      RDCODE1
          BRANCH    OVRCD,MSTD1500
.
          MOVE      THCSCOD,XCHRCLS
.
MSTD1500  MOVE      SP10,XSTATID
          PACK      XLOCALIT,SP20,SP20,SP10 * I-54733
.
          PACK      KEY56,PPOST,PADD2,SP10,PADD4,SP70                 *C-240184
          CALL      RDIBPOS1
          IF        OVRCD <> 1
            UNPACK      IBPOASGC,DIM1,DIM4,DIM4A
            PACK        XSTATID,DIM1
            MOVE        IBPOSUBR,XLOCALIT        * I-54733 Locality
          ELSE
            PACK      KEY56,PPOST,PSUBRB,SP10,PADD4,SP70              *C-240184
            CALL      RDIBPOS1
            IF        OVRCD<>1
              UNPACK      IBPOASGC,DIM1,DIM4,DIM4A
              PACK        XSTATID,DIM1
              MOVE        IBPOSUBR,XLOCALIT      * I-54733 Locality
            ELSE                                                      *I-240184
              MOVE      SP10,PMVXASGC
              PACK      KEY56,PPOST,PSUBRB,SP70
              CALL      RSIBPOS1
              CALL      RKIBPOS1
              IF        OVRCD <> 1
                MATCH     PPOST,IBPOPCOD
                IF        @EQUAL
                  MATCH     PSUBRB,IBPOSUBR
                  IF        @EQUAL
                    UNPACK      IBPOASGC,DIM1,DIM4,DIM4A
                    PACK        XSTATID,DIM1
                    MOVE        IBPOSUBR,XLOCALIT
                  ENDIF
                ENDIF
              ENDIF
            ENDIF                                               * end *I-240184
          ENDIF
          REP       " 0",XSTATID
.
MSTD2000  MOVE      "9",XURGENC            * urgency
          PACK      KEY5,ANSP,SP1,ACLSS
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      THCSCOD,XURGENC
          ENDIF
.
MSTD9999  RETURN
.******************************************************************************
.*                                  GACC0000              Called by: MSTD0000 *
.*                         Get Mental health usual accommmodation from        *
.*                         mehvi1af if using mental health system parameter   *
.*                         is set to "Y"                                      *
.******************************************************************************
GACC0000     PACK       KEY8,AADMNO
             CALL       RDMHVIS1
             IF         OVRCD<>1
              PACK        KEY5,CODEAY,MHVIACTY
              CALL        RDCODE1
              IF          OVRCD<>1
                MOVE        THCSCOD,XACCOMM2
              ELSE
                GOTO        GACC1000
              ENDIF
                GOTO        GACC9999
             ENDIF
GACC1000     MOVE      "00",XACCOMM2           * Type of usual accommodation
.
GACC9999     RETURN
.
.******************************************************************************
.*                                  ADMD0000              Called by: PROC0000 *
.*                         Extract admissions details                         *
.******************************************************************************
ADMD0000  MOVE      AADMNO,XEPSDNO          * Admission number
          MOVE      "    ",XINFWEIG           * Weight
          MATCH     SP8,ABWGHT
          IF        !@EQUAL
            UNPACK    ABWGHT,DIM2,XINFWEIG
          ENDIF
.
          MOVE      SP70,XMECHVT
          UNPACK    SP70,ATDOCTOR,XMEDCRDN,XPRIHINS,XICUHOUR
.
          PACK      KEY8,AADMNO,SP70
          CALL      RDPTICU1
          IF        OVRCD<>1
            PACK      XMECHVT,PTICUMEC,DOT,ZERO,ZERO
          ELSE
            PACK      XMECHVT,SP5,DOT,ZERO,ZERO
          ENDIF
          REP       " 0",XMECHVT
.
.... I-54733  Referring hospital ID
          MOVE      SP4,XREFHOSP
          MOVE      SP4,XREFHOTO                        * I-108841
          PACK      KEY8,AADMNO
          CALL      RDPTDAD1
          BRANCH    OVRCD,ADMD0500
          PACK      KEY5,PTDAADTS,SP70
          CALL      RDPTVAD1
          IF        OVRCD=1
            GOTO      ADMD0200
          ENDIF
          MOVE      SP4,XREFHOSP
          MATCH     SP70,PTVANHSC
          IF        !@EQUAL
            MOVE      PTVANHSC,XREFHOSP     * Valid transfer source
          ENDIF
.
ADMD0200  PACK      KEY5,PTDADCTS,SP70
          CALL      RDPTVAD1
          IF        OVRCD=1
            GOTO      ADMD0500
          ENDIF
          MOVE      SP4,XREFHOTO
          MATCH     SP70,PTVANHSC
          IF        !@EQUAL
            MOVE      PTVANHSC,XREFHOTO     * Valid transfer source
          ENDIF
.... END I
ADMD0500  MOVE      SP3,XDOBEST
          MOVE      SP5,XCLINUIT
          PACK      KEY5,ANSA,ANSC,ACLSSFT,SP70
          CALL      RDCODE1
          IF        OVRCD <> 1
            MOVE      THCSCOD,XCLINUIT               * Clinical Unit
          ENDIF
.
          MOVE      THREE,XMODADM
          PACK      KEY5,ANSS,SP1,ASRCE
          CALL      RDCODE1
          IF        OVRCD <> 1
            MOVE      TCINDC3,XMODADM
            REP       "3993",TCINDC3
            MOVE      TCINDC6,XIHCP
          ENDIF
.
          MOVE      XMODADM,FORM1
          IF        FORM1>3 | FORM1<1
            MOVE      THREE,XMODADM
          ENDIF
.
          MOVE      SP10,XILOHS             * Intended LOS
          MATCH     SP70,PMVXIDUS
          IF        !@EQUAL
            PACK      KEY5,ANSV,ANSI,PMVXIDUS,SP70
            CALL      RDCODE1
            IF        OVRCD<>1
              UNPACK    THCSCOD,XILOHS
            ENDIF
          ENDIF
.
          MATCH     SP3,PTYPE
          IF        !@EQUAL
            PACK      KEY5,CATT,PTYPE
            CALL      RDCODE1
            IF        OVRCD <> 1
              MOVE      THCSCOD,XMEDICR
              REP       " 9",XMEDICR
            ENDIF
          ENDIF
.
ADMD2000  MOVE      SP70,XDOSA
          PACK      KEY31,XEPSDNO,FOUR,KEY30
          CALL      RSOPDEA2
          CALL      RKOPDEA2
.
          MATCH     OPDAADMN,XEPSDNO
          IF        @EQUAL
            UNPACK    OPDADATE,CCENT,CYEAR,CMON,CDAY
            PACK      XDOSA,CDAY,CMON,CCENT,CYEAR
          ENDIF
.
          MOVE       "9",XINSRST
          PACK       KEY5,ANSC,ANSL,ACLAIM
          CALL       RDCODE1
          IF         OVRCD=0
            MOVE      TCINDC2,NURSEST       * Nursing Home status
            MOVE      TCINDC7,XINSRST       * Insurance status
            MOVE      TCINDC10,XELCTST
            REP       " 0",XELCTST
          ENDIF
.
          MOVE      "10 ",X4CARETY            * I -54733
          PACK      KEY5,CATCC,ACARE
          CALL      RDCODE1                      * care class on file ?
          IF        OVRCD = 0
            MOVE      THCSCOD,X4CARETY           * I-54733
          ENDIF
.
          UNPACK    ADATE,XCENT,XYEAR,XMON,XDAY
          PACK      XADMDAT,XDAY,XMON,XCENT,XYEAR  * Admission Date
          REP       " 0",XADMDAT
.
          UNPACK    ATIME,DIM2,DIM1,DIM2A,DIM4     * Admission Time (hhmm)
          PACK      XADMTIME,DIM2,DIM2A
.
          COMPARE   ONE,MHCNUSE            * Get Source of Referral
          IF        @EQUAL
            UNPACK    PTCNSORP,DIM1,DIM1A
            REP       "sS",DIM1
            MATCH     "S",DIM1
            IF        !@EQUAL
             CALL      GSOR0000
             GOTO      ADMD2700
            ENDIF
          ENDIF
.
          MOVE      "99",XSREFER             * source of referral if CAT='S'
          MOVE      " 0",XSRFPPSY            * source of referral if CAT ='A'
          PACK      KEY5,ANSS,SP1,ASRCE
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      THCSCOD,XSREFER
.
            MATCH     "86",XHINDIC           * Calvary Private
            IF        @EQUAL
              MATCH     " 9",XSREFER         * Emergency dept of this hospital
              IF        @EQUAL
                MOVE      " 3",XSREFER       * Calvary Public
              ENDIF
            ENDIF
.
            UNPACK    THCSCOD,DIM2,XSRFPPSY
            MATCH     SP2,XSRFPPSY
            IF        @EQUAL
              MOVE      " 0",XSRFPPSY
            ENDIF
          ENDIF
.
ADMD2700  MOVE      ZERO,XREFCAR
          COMPARE   ONE,MHCNUSE            * Get mental health referred to
                                           * further care from mehds1af
          IF        @EQUAL
            CALL      GMFC0000
          ENDIF
            MOVE      SP2,XSEPTYP             * Type of separtion
            MOVE      CATDD,TCODE
            LOAD      TCODE,PTCNDRSM,CATD,CATDD
            MOVE      DDEST,ACODE
            LOAD      ACODE,PTCNDRSM,DSTAT,DDEST
            MATCH     SP3,ACODE
            IF        !@EQUAL
              PACK      KEY5,TCODE,ACODE
              CALL      RDCODE1                 * Read a codes file record
              IF        OVRCD=0
                PACK      XSEPTYP,TCINDC5
              ENDIF
            ENDIF
            PACK      KEY5,CATDD,DDEST
            CALL      RDCODE1
            IF        OVRCD=0
              UNPACK    THCSCOD,DIM2,XREFDIS
            ENDIF
.           GOTO      ADMD3000

ADMD3000  MOVE      "0",XEMPLST            * Employment status
.                                            only for psych patients
          COMPARE   ONE,MHCNUSE            * Get employment status
          IF        @EQUAL
            CALL      GEMP0000
            GOTO      ADMD9999
          ENDIF
          IF        PSYCFLG=3
            GOTO      ADMD9999
          ENDIF
.
          MOVE      SP10,ACODE
          MOVE      ZERO,FORM1
          UNPACK    SP2,DIM1,DIM1A
          UNPACK    PTCNEMPL,DIM1,DIM1A
          MOVE      DIM1A,FORM1
          MATCH     ANSU,DIM1
          IF        @EQUAL
            LOAD      ACODE,FORM1,AUSR1,AUSR2,AUSR3,AUSR4,AUSR5,AUSR6,AUSR7
          ENDIF
.
          MATCH     ANSP,DIM1
          IF        @EQUAL
            LOAD      ACODE,FORM1,PUSR1,PUSR2,PUSR3,PUSR4,PUSR5,PUSR6
          ENDIF
.
          MATCH     SP3,ACODE
          IF        !@EQUAL
            PACK      KEY5,PTCNEMPL,ACODE
            CALL      RDCODE1
            IF        OVRCD = 0
              UNPACK    THCSCOD,XEMPLST          * Employment status
            ENDIF
          ENDIF
.
ADMD9999  RETURN
+
.******************************************************************************
.*                                  GSOR0000              Called by: ADMD0000 *
.*                      Get Source of Referral when PTCNSORP is not CAT"S"
.******************************************************************************
GSOR0000
          MOVE      SP10,ACODE
          MOVE      ZERO,FORM1
          UNPACK    SP2,DIM1,DIM1A
          UNPACK    PTCNSORP,DIM1,DIM1A
          REP       "vV",DIM1
          MOVE      DIM1A,FORM1
          MATCH     ANSV,DIM1
          IF        @EQUAL
            PACK      KEY8,AADMNO,SP20
            CALL      RDMHVIS1
            IF        OVRCD<>1
              LOAD      ACODE,FORM1,MHVIUSR1,MHVIUSR2,MHVIUSR3,MHVIUSR4:
                        MHVIUSR5
            ELSE
              MOVE      SP3,ACODE
            ENDIF
          ELSE
            IF        FORM1=0
              ASSIGN    TEN,FORM2
            ELSE
              ASSIGN    FORM1,FORM2
            ENDIF
            PACK      KEY8,AADMNO,SP20
            CALL      RDMISS1
            IF        OVRCD<>1
              LOAD      ACODE,FORM2,AUSR1,AUSR2,AUSR3,AUSR4,AUSR5,AUSR6:
                        AUSR7,PTMIUSR8,PTMIUSR9,PTMIUSR0
            ELSE
              MOVE      SP3,ACODE
            ENDIF
          ENDIF
.  Get HDP equivalent
GSOR0900  MATCH     SP3,ACODE
          IF        !@EQUAL
            REP      "vVuU",PTCNSORP
            PACK      KEY5,PTCNSORP,ACODE
            GOTO      GSOR2000
          ELSE
            GOTO      GSOR2600
          ENDIF
GSOR2000    CALL      RDCODE1
            IF        OVRCD = 0
             MOVE      THCSCOD,XSREFER        * Source of Referral
             UNPACK    THCSCOD,DIM2,XSRFPPSY
            ELSE
             GOTO      GSOR2600
            ENDIF
            GOTO       GSOR9999

GSOR2600  MOVE      SP2,XSREFER               * default to SP2
          MOVE      SP2,XSRFPPSY
GSOR9999  RETURN

.******************************************************************************
.*                                  GMFC0000              Called by: ADMD0000 *
.*                      Get Mental Health referred to Further Care            *
.******************************************************************************
GMFC0000
            PACK      KEY8,AADMNO,SP20
            CALL      RDMHDSC1
            IF        OVRCD<>1
              MOVE      MHDSREFT,ACODE
            ELSE
              MOVE      SP3,ACODE
            ENDIF
.  Get HDP equivalent
          MATCH     SP3,ACODE
          IF        !@EQUAL
            PACK      KEY5,CODERE,ACODE
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      THCSCOD,XREFCAR          * Mental Health referred
            ENDIF
          ELSE
              MOVE      "0",XREFCAR
          ENDIF
GMFC9999  RETURN
.******************************************************************************
.*                                  GEMP0000              Called by: ADMD0000 *
.*                      Get employment status for MH                          *
.******************************************************************************
GEMP0000
          MOVE      SP10,ACODE
          MOVE      ZERO,FORM1
          UNPACK    SP2,DIM1,DIM1A
          UNPACK    MHCEMPST,DIM1,DIM1A
          MOVE      DIM1A,FORM1
          MATCH     ANSV,DIM1
          IF        @EQUAL
            PACK      KEY8,AADMNO,SP20
            CALL      RDMHVIS1
            IF        OVRCD<>1
              LOAD      ACODE,FORM1,MHVIUSR1,MHVIUSR2,MHVIUSR3,MHVIUSR4:
                        MHVIUSR5
            ELSE
              MOVE      SP3,ACODE
            ENDIF
          ENDIF
.  Get HDP equivalent
          MATCH     SP3,ACODE
          IF        !@EQUAL
            REP      "vV",MHCEMPST
            PACK      KEY5,MHCEMPST,ACODE
            CALL      RDCODE1
            IF        OVRCD = 0
              UNPACK    THCSCOD,XEMPLST          * Employment status
            ENDIF
          ENDIF

GEMP9999  RETURN
+
.******************************************************************************
.*                                  TRAN0000              Called by: PROC0000 *
.*                           Extract bed days                                 *
.******************************************************************************
TRAN0000  MOVE      ZERO,LEAVNUM
          MOVE      ZERO,LEAVDAY
          MOVE      SP8,LEAVDATE
          MOVE      SP8,RETNDATE
          MOVE      ZERO,TPSYFLG
          MOVE      ZERO,PSYCDAYS
          MOVE      ZERO,WORKHITH          * I-54733
          MOVE      SP70,HSTRDATE
          MOVE      SP70,HENDDATE
          MOVE      SP70,PSTRDATE
          MOVE      SP70,PENDDATE
          MOVE      SP70,ROOMTYPE
.
          PACK      KEY30,AADMNO,SP20,SP10
          CALL      RDSTRAN2
TRAN1000  CALL      RDKTRAN2 
          BRANCH    OVRCD,TRAN5000
.
          MATCH     AADMNO,TADMN            * same Admission No. ?
          GOTO      TRAN5000 IF NOT EQUAL
.
          MATCH     "A",TMOVE               * admission
          GOTO      TRAN1050 IF NOT EQUAL
.
TRAN1025  MOVE      SP4,THCSCOD
...       PACK      KEY5,ANSA,SP1,TATYPE
...       CALL      RDCODE1
...       CMATCH    ANSP,TCINDC3            * 3rd indicator a "P" ?
...       IF        OVRCD = 0 & @EQUAL
...         MOVE      ONE,TPSYFLG           * set indicator for psychiatric
...         MOVE      TDATE,PSTRDATE        * set start date for psychiatric
...       ENDIF
          MOVE      TATYPE,OLDATYPE         * save Patient Type
          MOVE      THCSCOD,OLDTHCS         * save Patient Type
          MOVE      TRBTYP,BEDTYPE          * I-54733 save bed type
          PACK      KEY6,TWARD,TBED,SP70
          CALL      RDWARD1
          IF        OVRCD<>1
            PACK      ROOMTYPE,WRTYPE,SP70
          ENDIF
          CALL      CHIH0000                * Check for hospital in the home
          CALL      NPSY0000                * New psych days calculation
          GOTO      TRAN1000
.
TRAN1050  MATCH     "D",TMOVE               * discharge ?
          GOTO      TRAN1200 IF NOT EQUAL
          MOVE      TRBTYP,BEDTYPE          * I-54733 save bed type
          PACK      KEY6,TWARD,TBED,SP70
          CALL      RDWARD1
          IF        OVRCD<>1
            PACK      ROOMTYPE,WRTYPE,SP70
          ENDIF
          CALL      CHIH0000                * Check for hospital in the home
          CALL      NPSY0000                * New psych days calculation
          MOVE      SP5,XATTDOCT
          MOVE      TADOCT,KEY6
          OPEN      PATDO1A1,"patdo1af"
          CALL      RDDOCT1
          CLOSE     PATDO1A1
          IF        OVRCD=0
            MOVE      PTDOWHDP,XATTDOCT           * Attending Physician
          ENDIF
.
TRAN1100  UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY   * Discharge Date
          PACK      XDISDAT,CDAY,CMON,CCENT,CYEAR
          REP       " 0",XDISDAT
.
          UNPACK    DTIME,DIM2,DIM1,DIM2A,DIM4    * Discharge Time (hhmm)
          PACK      XDISTIME,DIM2,DIM2A
.
          GOTO      TRAN5000
.
TRAN1200  MATCH     "L",TMOVE               * Leave ? If so get Leave Date
          GOTO      TRAN1400 IF NOT EQUAL
          PACK      LEAVDATE,TDATE
          REP       " 0",LEAVDATE
          MATCH     SP70,PSTRDATE
          IF        !@EQUAL
            PACK      PENDDATE,LEAVDATE
            CALL      CALC0000             * calculate the dates difference
            ADD       CALDAYS,PSYCDAYS
            MOVE      SP70,PSTRDATE        * Clear start and end psych dates
            MOVE      SP70,PENDDATE
          ENDIF
.
          MATCH     SP70,HSTRDATE
          IF        !@EQUAL
            PACK      HENDDATE,LEAVDATE
            CALL      CALH0000             * calculate the dates difference
            ADD       CALDAYS,WORKHITH
            MOVE      SP70,HSTRDATE        * Clear start and end psych dates
            MOVE      SP70,HENDDATE
          ENDIF
.
TRAN1400  MATCH     "R",TMOVE               * Leave Return ? if so get date
          GOTO      TRAN1600 IF NOT EQUAL
.
          PACK      RETNDATE,TDATE
          REP       " 0",RETNDATE
.
          MATCH     LEAVDATE,RETNDATE
          IF        !@EQUAL
            ADD       ONE,LEAVNUM           * Number of leaves at midnight
          ENDIF
          CALL      CHIH0000
          CALL      NPSY0000
.
          CALL      LEAV0000                * Calculate no of days leave
          GOTO      TRAN1000
.
TRAN1600  MATCH     "C",TMOVE
          GOTO      TRAN1000 IF NOT EQUAL   
          MATCH     TDATE,ADATE             * change on Admission Date ?
          GOTO      TRAN1025 IF EQUAL       * yes, assume a correction
          MOVE      SP4,THCSCOD
          MOVE      TRBTYP,BEDTYPE
          PACK      KEY6,TWARD,TBED,SP70
          CALL      RDWARD1
          IF        OVRCD<>1
            PACK      ROOMTYPE,WRTYPE,SP70
          ENDIF
          CALL      CHIH0000                * Check for hospital in the home
          CALL      NPSY0000                * New psych days calculation
          MATCH     TATYPE,OLDATYPE
          GOTO      TRAN1000 IF EQUAL
.....     CALL      PSYC0000                * psychiatric bed days
          MOVE      TATYPE,OLDATYPE         * save new Admission Type
          MOVE      THCSCOD,OLDTHCS         * save new Admission Type
          MOVE      TRBTYP,BEDTYPE
          PACK      KEY6,TWARD,TBED,SP70
          CALL      RDWARD1
          IF        OVRCD<>1
            PACK      ROOMTYPE,WRTYPE,SP70
          ENDIF
          GOTO      TRAN1000                * go and get next record
.
.
TRAN5000  MOVE      WORKHITH,F3
          MOVE      F3,XHITHDAY             * I-54733 No.of days HITH
          MATCH     SP8,LEAVDATE                 * Leave Date blank?
          GOTO      TRAN7000 IF EQUAL
          MATCH     SP8,RETNDATE                 * Return Date blank?
          GOTO      TRAN7000 IF EQUAL
.
          MATCH     LEAVDATE,RETNDATE
          IF        !@EQUAL
            ADD       ONE,LEAVNUM           * Number of leaves at midnight
          ENDIF
.
          CALL      LEAV0000                     * Calculate no of days leave
.
TRAN7000  MOVE      LEAVNUM,XLEAVPR         * number of leave period
          MOVE      LEAVDAY,X4LEAVDY        * I-54733
          REP       " 0",XLEAVPR
          REP       " 0",X4LEAVDY           * I-54733
......    CALL      PSYC0000
.
          MOVE      "0000",X4CUTDAY
          MOVE      "0000",X4EHADAY
          MOVE      "0000",X4ONACUT
          MOVE      "0000",X4EONATE
          MOVE      "0000",X4URSING
...
          MOVE      ADATE,FROMDATE          * From date is the admin date
.
          PACK      KEY24,AADMNO,SP30
          CALL      RDSCHCO1                * Position on & read a code changes
TRAN7100  CALL      RDKCHCO1                  file record
          BRANCH    OVRCD,TRAN7200
.
          MATCH     AADMNO,CHADMN
          GOTO      TRAN7200 IF NOT EQUAL   * Different admin no
.
          MATCH     "CC",CHCATG
          GOTO      TRAN7100 IF NOT EQUAL   * Different category
.
          MATCH     ADATE,CHDATE
          GOTO      TRAN7100 IF EQUAL
          MOVE      X4CARETY,CARETYPE        * Default care type to admin c/t
          PACK      KEY5,ANSC,ANSC,CHCODE
          CALL      RDCODE1                 * Read a codes file record
          IF        OVRCD<>1
            MOVE      THCSCOD,CARETYPE      * Care type file codes changes file
            SQUEEZE   CARETYPE              * I-55795 remove leading/trailing sp
            PACK      CARETYPE,CARETYPE,SP70
          ENDIF
.
          MOVE      CHDATE,TODATE           * To date is the cat CC change date
          GOTO      TRAN7300
.
TRAN7200  MOVE      X4CARETY,CARETYPE        * Default care type to admin c/t
          SQUEEZE   CARETYPE
          PACK      CARETYPE,CARETYPE,SP70
          MOVE      DDATE,TODATE            * To date is the disch date
.
TRAN7300  CALL      NHOSPDAY                * Calculate no of days in hospital
          IF        NBRDAYS=0
            MOVE      ONE,NBRDAYS
          ENDIF
.
...       IF        TPSYFLG=1
...         GOTO     TRAN7900
...       ENDIF
.
.         MATCH     "21",CARETYPE
.         GOTO      TRAN7400 IF EQUAL
.
.         MATCH     "22",CARETYPE
.         GOTO      TRAN7400 IF EQUAL
.
.         MATCH     "23",CARETYPE
.         GOTO      TRAN7500 IF NOT EQUAL
.
          MATCH     "20",CARETYPE
          GOTO      TRAN7500 IF NOT EQUAL
.
TRAN7400  MOVE      X4EHADAY,FORM4
          ADD       NBRDAYS,FORM4
          MOVE      FORM4,X4EHADAY
          REP       " 0",X4EHADAY
          GOTO      TRAN7900
.
TRAN7500  MATCH     "31",CARETYPE
          GOTO      TRAN7600 IF EQUAL
.
          MATCH     "32",CARETYPE
          GOTO      TRAN7600 IF EQUAL
.
          MATCH     "33",CARETYPE
          GOTO      TRAN7600 IF EQUAL
.
          MATCH     "40",CARETYPE
          GOTO      TRAN7600 IF EQUAL
.
          MATCH     "50",CARETYPE
          GOTO      TRAN7600 IF EQUAL
.
          MATCH     "80",CARETYPE
          GOTO      TRAN7600 IF EQUAL
.
          MATCH     "90",CARETYPE
          GOTO      TRAN7600 IF  EQUAL
.
          MATCH     "100",CARETYPE
          GOTO      TRAN7700 IF NOT EQUAL
...  
TRAN7600  MOVE      X4ONACUT,FORM4
          ADD       NBRDAYS,FORM4
          MOVE      FORM4,X4ONACUT
          REP       " 0",X4ONACUT
          GOTO      TRAN7900
.
TRAN7700  MATCH     "70",CARETYPE
          GOTO      TRAN7800 IF NOT EQUAL
.
          MATCH     "88",XCHRCLS
          IF        !@EQUAL
            MOVE      X4CUTDAY,FORM4
            ADD       NBRDAYS,FORM4
            MOVE      FORM4,X4CUTDAY
            REP       " 0",X4CUTDAY
          ELSE
            MOVE      X4EONATE,FORM4
            ADD       NBRDAYS,FORM4
            MOVE      FORM4,X4EONATE
            REP       " 0",X4EONATE
          ENDIF
.    
          GOTO      TRAN7900
.
TRAN7800  MATCH     "10",CARETYPE
          IF        @EQUAL
            MATCH     NURSEST,ANSN
            IF        !@EQUAL
              MOVE      X4CUTDAY,FORM4
              ADD       NBRDAYS,FORM4
              MOVE      FORM4,X4CUTDAY
              REP       " 0",X4CUTDAY
            ELSE
              MOVE      X4URSING,FORM4
              ADD       NBRDAYS,FORM4
              MOVE      FORM4,X4URSING
              REP       " 0",X4URSING
            ENDIF
          ENDIF
.
          MATCH     "60",CARETYPE
          GOTO      TRAN7900 IF NOT EQUAL
. 
          MOVE      X4URSING,FORM4
          ADD       NBRDAYS,FORM4
          MOVE      FORM4,X4URSING
          REP       " 0",X4URSING
.
TRAN7900  MOVE      TODATE,FROMDATE
          MATCH     DDATE,TODATE
          GOTO      TRAN7100 IF LESS        * Havent processed all records
.
TRAN8000  CALL      PDIS0000                * Process diseases
          CALL      POPR0000                * Process operations
.
...       IF       TPSYFLG = 1
...         MOVE      TDATE,PENDDATE            * set the ending date
.... ADD 'RT' IND3='M'??????
...         CALL      CALC0000                  * calculate the dates difference
...         ADD       CALDAYS,PSYCDAYS
...         IF        PSYCDAYS>0
...           SUB       LEAVDAY,PSYCDAYS
...         ENDIF
.
...         MATCH     "D",TMOVE
...         IF        @EQUAL
...           COMPARE   ONE,DAYCASE
...           IF        @EQUAL
...             ADD       ONE,PSYCDAYS            * as per NSWHDP algorithm
...           ENDIF
...         ENDIF
...         MOVE      ZERO,TPSYFLG
...       ENDIF
.
.
TRAN9999  RETURN
+
.******************************************************************************
.*                                  VIST0000              Called by: PROC0000 *
.*                   Check for previous psychiatric visits                    *
.******************************************************************************
VIST0000  MOVE      AADMNO,SAVADMN
          MOVE      "0",XPRVSPCT
          MOVE      SP10,XMCARETY                * Maintenance Care Type (HCP)
          UNPACK    SP70,XCONHSUR,XCONORID,XCONROLE,XCONTYPE
.
          PACK      KEY8,DAADMNO,SP70
          CALL      RDPMVX11
          IF        OVRCD=0
            MOVE      PMVXQASN,XCONHSUR     * Contract Hospital UR
          ENDIF
          PACK      KEY25,AADMNO,ANSA,SP70
          CALL      RDPTASF1                * Read an admin SFA file record
          IF        OVRCD=0
            MOVE      PTAFCSID,XCONORID     * Contract id
            MOVE      PTAFCROL,XCONROLE     * Contract role
            MOVE      PTAFCTYP,XCONTYPE     * Contract type
          ENDIF
.
          CALL      SIHCP000                * Setup IHCP
.
          PACK      KEY5,ANSC,ANSC,ACARE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VIST0500
.
          SQUEEZE   THCSCOD
          MOVE      THCSCOD,F2
          IF        F2<31 
            GOTO      VIST0500
          ENDIF
.
          IF        F2>33 
            GOTO      VIST0500
          ENDIF
.
          PACK      KEY8,DAADMNO,SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,VIST0500
.
          MATCH     SP70,PMVXPALC
          GOTO      VIST9999 IF EQUAL
.
          PACK      KEY5,ANSK,ANSG,PMVXPALC,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VIST9999
.
          MOVE      TCINDC1,XPRVSPCT
          GOTO      VIST9999
.
VIST0500  COMPARE   ONE,MHCNUSE            * Get Previous Psychiatric Treatment
          IF        @EQUAL
            UNPACK    PTCNFPST,DIM1,DIM1A
            REP       "wW",DIM1
            MATCH     "W",DIM1
            IF        @EQUAL
             CALL      GPST0000
             GOTO      VIST9999
            ENDIF
          ENDIF
.
          MOVE      "0",XPRVSPCT
.
          MOVE      AURNO,PVIURNO
          PACK      PVIDATE,ADATE
          REP       " 0",PVIDATE
          PACK      KEY24,PVIURNO,PVIDATE,Z20
          CALL      RDSVISA2
VIST1000  CALL      RDPVISA2
          BRANCH    OVRCD,VIST3000
.
          MATCH     AURNO,PVIURNO           * Same U/R number ?
          GOTO      VIST3000 IF NOT EQUAL
.
          MATCH     PVIBILL,SAVADMN
          GOTO      VIST1000 IF EQUAL
.
          MOVE      PVIBILL,AADMNO
          MOVE      AADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,VIST1000
.
          PACK      KEY5,ANSA,SP1,ATYPE
          CALL      RDCODE1
          BRANCH    OVRCD,VIST1000
.
          CMATCH    ANSP,TCINDC3            * 3rd indicator a "P" ?
          IF        @EQUAL
            MOVE      "2",XPRVSPCT          * no to first visit
            GOTO      VIST3000
          ENDIF
          GOTO      VIST1000
.
VIST3000  MOVE      SAVADMN,KEY8
          CALL      RDMISS1
.
VIST9999  RETURN
.******************************************************************************
.*                                  SIHCP000              Called by: PROC0000 *
.******************************************************************************
SIHCP000  MOVE      SP70,XIHCP
          MATCH     "B",XCONROLE
          GOTO      SIHCP200 IF NOT EQUAL
.
          MOVE      SP70,KEY1
          MOVE      XCONTYPE,KEY1
          REP       "2X3X5X",KEY1
          MATCH     "X",KEY1
          IF        @EQUAL
            IF        CHOSTYP=1
              MOVE      "1",XIHCP             * Public Hospital
            ELSE
              MOVE      "2",XIHCP             * Private Hospital
            ENDIF
          ENDIF
          GOTO      SIHCP999
.
SIHCP200  MATCH     "A",XCONROLE
          GOTO      SIHCP999 IF NOT EQUAL
.
          MOVE      SP70,KEY1
          MOVE      XCONTYPE,KEY1
          REP       "2X3X5X",KEY1
          MATCH     "X",KEY1
          IF        @EQUAL
            IF        CHOSTYP=1
              MOVE      "3",XIHCP             * Public Hospital
            ELSE
              MOVE      "4",XIHCP             * Private Hospital
            ENDIF
          ENDIF
.
SIHCP999  RETURN
+
.******************************************************************************
.*                                  REHB0000              Called by: PROC0000 *
.*  Report dates if caretype is rehab for GEM                                 *
.******************************************************************************
REHB0000  MOVE      SP70,XFFAADAT           * First Assess after Adm Date
          MOVE      SP70,XFFPADAT           * First Assess Prior to Adm Date
          MOVE      SP70,XEMCPDAT           * Multi-disiplinary Care
.
          PACK      KEY5,ANSA,SP1,ATYPE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,REHB9999
.
.         MATCH     "1",TCINDC1
.         GOTO      REHB9999 IF NOT EQUAL
.
.
.         MATCH     "21",CARETYPE
.         GOTO      REHB0500 IF EQUAL
.
.         MATCH     "22",CARETYPE
.         GOTO      REHB0500 IF EQUAL
.
.         MATCH     "23",CARETYPE
.         GOTO      REHB0500 IF EQUAL
.
          MATCH     "20",CARETYPE
          GOTO      REHB0500 IF EQUAL
.
          MATCH     "40",CARETYPE
          GOTO      REHB0500 IF EQUAL
.
          GOTO      REHB9999
.
REHB0500  PACK      KEY12,AADMNO,SP70
          CALL      RSPTQRD1
REHB1000  CALL      RKPTQRD1
          BRANCH    OVRCD,REHB9999
.
          MATCH     AADMNO,PTQRADMN         * same admission?
          GOTO      REHB9999 IF NOT EQUAL
.
          MATCH     SP70,PTQRFADT           * First Assess after Adm Date
          GOTO      REHB2000 IF EQUAL
.
          MATCH     SP70,XFFAADAT
          IF        @EQUAL
            MOVE      PTQRFADT,XFFAADAT 
            GOTO      REHB2000
          ENDIF
.
          MATCH     XFFAADAT,PTQRFADT
          IF        @LESS
            MOVE      PTQRFADT,XFFAADAT 
          ENDIF
.
REHB2000  MATCH     SP70,PTQRFDDT           * First Assess Prior to Adm Date
          GOTO      REHB3000 IF EQUAL
.
          MATCH     SP70,XFFPADAT
          IF        @EQUAL
            MOVE      PTQRFDDT,XFFPADAT     
            GOTO      REHB3000
          ENDIF
.
          MATCH     XFFPADAT,PTQRFDDT
          IF        @LESS
            MOVE      PTQRFDDT,XFFPADAT     
          ENDIF
.
REHB3000  MATCH     SP70,PTQRMCDT           * Multi-disiplinary Care
          GOTO      REHB1000 IF EQUAL
. 
          MATCH     SP70,XEMCPDAT
          IF        @EQUAL
            MOVE      PTQRMCDT,XEMCPDAT 
          ENDIF
.
          MATCH     XEMCPDAT,PTQRMCDT
          IF        @LESS
            MOVE      PTQRMCDT,XEMCPDAT 
          ENDIF
.
          GOTO      REHB1000
.
REHB9999  RETURN
+
.******************************************************************************
.*                                  GPST0000              Called by: VIST0000 *
.*                      Get Previous Psychiatric Treatment                    *
.******************************************************************************
GPST0000
          MOVE      SP10,ACODE
          MOVE      ZERO,FORM1
          UNPACK    SP2,DIM1,DIM1A
          UNPACK    PTCNFPST,DIM1,DIM1A
          REP       "wW",DIM1
          MOVE      DIM1A,FORM1
          MATCH     ANSW,DIM1
          IF        @EQUAL
            PACK      KEY8,AADMNO,SP20
            CALL      RDMHDSC1
            IF        OVRCD<>1
.                                           * Using Mental Health Discharge
.                                           * Table UDF1-5(w5-w9)
.                                           * So map W5 to USR1, W6 to USR2, etc
              SUB       FOUR,FORM1                                     *I-90209
              LOAD      ACODE,FORM1,MHDSUSR1,MHDSUSR2,MHDSUSR3,MHDSUSR4:
                        MHDSUSR5
            ELSE
              MOVE      SP3,ACODE
            ENDIF
          ENDIF
.  Get HDP equivalent
          MATCH     SP3,ACODE
          IF        !@EQUAL
            REP      "wW",PTCNFPST
            PACK      KEY5,PTCNFPST,ACODE
            CALL      RDCODE1
            IF        OVRCD = 0
             UNPACK    THCSCOD,XPRVSPCT        * Previous Psychiatric treatment
            ENDIF
          ENDIF

GPST9999  RETURN
+
.******************************************************************************
.*                                  LEAV0000              Called by: WRIT0000 *
.*          Calculate the bed days for leave                                  *
.******************************************************************************
LEAV0000  MOVE      LEAVDATE,CDYSFDTE            * From Date
          MOVE      RETNDATE,CDYSTDTE            * To Date
          CALL      CALCDAYS                     * calc no. of days leave
          SUB       ONE,CDYSDAYS
.
          COMPARE   ZERO,CDYSDAYS                 * +ve?
          IF        @LESS | @EQUAL
            MOVE      ZERO,CDYSDAYS
          ENDIF
. 
...       Removed 17/08/2005
. --------- If the patient goes on leave on the admission date don't count
.           the day as a leave day
.
...         PACK      KEY8,ADATE,SP10
...         MATCH     KEY8,LEAVDATE 
...         IF        @EQUAL
...           SUB       ONE,CDYSDAYS
...         ENDIF
...       ENDIF
          ADD       CDYSDAYS,LEAVDAY              * leave days
          MOVE      SP8,LEAVDATE
          MOVE      SP8,RETNDATE
.
LEAV9999  RETURN
+
.******************************************************************************
.*                                  PDIS0000              Called by: TRAN0000 *
.*                  Processing the medical records (diseases)                 *
.******************************************************************************
PDIS0000  MOVE      ZERO,FSTCODE
          MOVE      SP10,X4PRDIAG
          UNPACK    SP30,X4ADDIA2,X4ADDIA3:     * diagnosis codes
                         X4ADDIA4,X4ADDIA5
          UNPACK    SP30,X4ADDIA6,X4ADDIA7,X4ADDIA8 
          UNPACK    SP30,X4ADDIA9,X4DDIA10
          UNPACK    SP30,X4DDIA11,X4DDIA12,X4DDIA13 
          UNPACK    SP30,X4DDIA14,X4DDIA15
          UNPACK    SP30,X4DDIA16,X4DDIA17,X4DDIA18 
          UNPACK    SP30,X4DDIA19,X4DDIA20
          UNPACK    SP30,X4DDIA21,X4DDIA22,X4DDIA23
          UNPACK    SP30,X4DDIA24,X4DDIA25,X4DDIA26
          UNPACK    SP30,X4DDIA27,X4DDIA28,X4DDIA29
          UNPACK    SP30,X4DDIA30,X4DDIA31
          UNPACK    SP30,X5DDIA32,X5DDIA33,X5DDIA34                * I-108841
          UNPACK    SP30,X5DDIA35,X5DDIA36,X5DDIA37
          UNPACK    SP30,X5DDIA38,X5DDIA39,X5DDIA40
          UNPACK    SP30,X5DDIA41,X5DDIA42,X5DDIA43
          UNPACK    SP30,X5DDIA44,X5DDIA45,X5DDIA46
          UNPACK    SP30,X5DDIA47,X5DDIA48,X5DDIA49
          UNPACK    SP30,X5DDIA50
.... end I 
.
          MOVE      ZERO,COUNT
          MOVE      ZERO,MCOUNT
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2
PDIS5000  CALL      RKPTECD2
          BRANCH    OVRCD,PDIS9999
.
          MATCH     AADMNO,PTEDADMN
          GOTO      PDIS9999 IF NOT EQUAL
.
          MOVE      PTEDCODE,KEY9
.
          CALL      RDPTICD1              * Read ICD Disease file
          BRANCH    OVRCD,PDIS5000
          COMPARE   ONE,ICDRDVER          * ICD9?
          GOTO      PDIS5000 IF EQUAL     * Yes, skip this record
.          
          CMATCH    CMDISP,PTEDTYPE
          GOTO      PDIS6000 IF NOT EQUAL
.
          IF        FSTCODE=1
            GOTO      PDIS6000            * already found principal diag.
          ENDIF
.
          MOVE      KEY9,X4PRDIAG
          MOVE      ONE,FSTCODE
          GOTO      PDIS5000
.
PDIS6000  ADD       ONE,COUNT
          STORE     KEY9,COUNT,X4ADDIA2,X4ADDIA3,X4ADDIA4,X4ADDIA5:
                               X4ADDIA6,X4ADDIA7,X4ADDIA8,X4ADDIA9,X4DDIA10:
                               X4DDIA11,X4DDIA12,X4DDIA13,X4DDIA14,X4DDIA15:
                               X4DDIA16,X4DDIA17,X4DDIA18,X4DDIA19,X4DDIA20:
                               X4DDIA21,X4DDIA22,X4DDIA23,X4DDIA24,X4DDIA25:
                               X4DDIA26,X4DDIA27,X4DDIA28,X4DDIA29,X4DDIA30:
                               X4DDIA31,X5DDIA32,X5DDIA33,X5DDIA34,X5DDIA35:
                               X5DDIA36,X5DDIA37,X5DDIA38,X5DDIA39,X5DDIA40:
                               X5DDIA41,X5DDIA42,X5DDIA43,X5DDIA44,X5DDIA45:
                               X5DDIA46,X5DDIA47,X5DDIA48,X5DDIA49,X5DDIA50
          COMPARE   "50",COUNT
          GOTO      PDIS5000 IF LESS
.
PDIS9999  RETURN
+
.******************************************************************************
.*                                  PDIA0000              Called by: TRAN0000 *
.*                  Processing the medical records (diseases) after 01/07/2008*
.******************************************************************************
PDIA0000  MOVE      ZERO,FSTCODE
          MOVE      ZERO,COUNT
          MOVE      ZERO,MCOUNT
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2
PDIA5000  CALL      RKPTECD2
          BRANCH    OVRCD,PDIA9999
.
          MATCH     AADMNO,PTEDADMN
          GOTO      PDIA9999 IF NOT EQUAL
.
          MOVE      PTEDCODE,KEY9
          MOVE      PTEDOSET,XONSETFL
.
          CALL      RDPTICD1              * Read ICD Disease file
          BRANCH    OVRCD,PDIA5000
          COMPARE   ONE,ICDRDVER          * ICD9?
          GOTO      PDIA5000 IF EQUAL     * Yes, skip this record
.
.         CMATCH    CMDISP,PTEDTYPE
.         GOTO      PDIA6000 IF NOT EQUAL
.
.         IF        FSTCODE=1
.           GOTO      PDIA5000            * already found principal diag.
.         ENDIF
.
          MOVE      ONE,FSTCODE
.
PDIA6000  ADD       ONE,COUNT
          IF        COUNT>100
            GOTO      PDIA9999
          ENDIF
.
          MOVE      KEY9,XCODE
          MOVE      "dx  ",XCODTYPE
          MOVE      COUNT,XCODNUMB
          WRITE     WORK8A,SEQ;XHINDIC,XPINDIC,XPERSNO,XEPSDNO:
                               XDISDAT,XCODTYPE,XCODNUMB:
                               XCODE,XONSETFL
          GOTO      PDIA5000
.
PDIA9999  RETURN
.******************************************************************************
.*                                  POPR0000              Called by: TRAN0000 *
.*                             Get the operations                             *
.******************************************************************************
POPR0000  UNPACK    SP30,XADPRO1,XADPRO2,XADPRO3
          UNPACK    SP30,XADPRO4,XADPRO5
          UNPACK    SP30,XADPRO6,XADPRO7,XADPRO8
          UNPACK    SP30,XADPRO9,XADPRO10
          UNPACK    SP30,XADPRO11,XADPRO12,XADPRO13
          UNPACK    SP30,XADPRO14,XADPRO15
          UNPACK    SP30,XADPRO16,XADPRO17,XADPRO18
          UNPACK    SP30,XADPRO19,XADPRO20
          UNPACK    SP30,XADPRO21,XADPRO22,XADPRO23
          UNPACK    SP30,XADPRO24
          UNPACK    SP30,XADPRO25,XADPRO26,XADPRO27
          UNPACK    SP30,XADPRO28,XADPRO29,XADPRO30
          UNPACK    SP30,XADPRO31
          UNPACK    SP30,XADPRO32,XADPRO33,XADPRO34             * I-108841
          UNPACK    SP30,XADPRO35,XADPRO36,XADPRO37
          UNPACK    SP30,XADPRO38,XADPRO39,XADPRO40
          UNPACK    SP30,XADPRO41,XADPRO42,XADPRO43
          UNPACK    SP30,XADPRO44,XADPRO45,XADPRO46
          UNPACK    SP30,XADPRO47,XADPRO48,XADPRO49
          UNPACK    SP30,XADPRO50
.
          MOVE      ZERO,COUNT
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2
POPR5000  CALL      RKPTECO2
          BRANCH    OVRCD,POPR9999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      POPR9999 IF NOT EQUAL
.
          MATCH     ANSO,PTEOTYPE                                      *I-48888
          GOTO      POPR5000 IF NOT EQUAL   * Ignore "X" "I" & "N"     *I-48888
.
          MOVE      PTEOCODE,KEY9
          CALL      RDPTICO1
          BRANCH    OVRCD,POPR5000
          COMPARE   ONE,ICDRDVER            * ICD9?
          IF        @EQUAL
            PACK      KEY9,OICD10CD,SP10    * ICD10 code
          ENDIF
.
          ADD       ONE,COUNT
          STORE     KEY9,COUNT,XADPRO1,XADPRO2,XADPRO3,XADPRO4,XADPRO5:
                               XADPRO6,XADPRO7,XADPRO8,XADPRO9,XADPRO10:
                               XADPRO11,XADPRO12,XADPRO13,XADPRO14,XADPRO15:
                               XADPRO16,XADPRO17,XADPRO18,XADPRO19,XADPRO20:
                               XADPRO21,XADPRO22,XADPRO23,XADPRO24,XADPRO25:
                               XADPRO26,XADPRO27,XADPRO28,XADPRO29,XADPRO30:
                               XADPRO31,XADPRO32,XADPRO33,XADPRO34,XADPRO35:
                               XADPRO36,XADPRO37,XADPRO38,XADPRO39,XADPRO40:
                               XADPRO41,XADPRO42,XADPRO43,XADPRO44,XADPRO45:
                               XADPRO46,XADPRO47,XADPRO48,XADPRO49,XADPRO50
          COMPARE   "50",COUNT
          GOTO      POPR5000 IF LESS
.
POPR9999  RETURN
+
.******************************************************************************
.*                                  PPRO0000              Called by: TRAN0000 *
.*                             Get the operations                             *
.******************************************************************************
PPRO0000  MOVE      SP70,XONSETFL
          MOVE      ZERO,COUNT
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2
PPRO5000  CALL      RKPTECO2
          BRANCH    OVRCD,PPRO9999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      PPRO9999 IF NOT EQUAL
.
          MATCH     ANSO,PTEOTYPE
          GOTO      PPRO5000 IF NOT EQUAL
.
          MOVE      PTEOCODE,KEY9
          CALL      RDPTICO1
          BRANCH    OVRCD,POPR5000
          COMPARE   ONE,ICDRDVER            * ICD9?
          IF        @EQUAL
            PACK      KEY9,OICD10CD,SP10    * ICD10 code
          ENDIF
.
.         IF        COUNT=1
.           GOTO      PPRO5000
.         ENDIF
.
PPRO6000  ADD       ONE,COUNT
          IF        COUNT>50
            GOTO      PPRO9999
          ENDIF
.
          MOVE      KEY9,XCODE
          MOVE      "proc",XCODTYPE
          MOVE      COUNT,XCODNUMB
          WRITE     WORK8A,SEQ;XHINDIC,XPINDIC,XPERSNO,XEPSDNO:
                               XDISDAT,XCODTYPE,XCODNUMB:
                               XCODE,XONSETFL
          GOTO      PPRO5000
.
PPRO9999  RETURN
.******************************************************************************
.*                                  ENDP0000                                  *
.*                             End of process                                 *
.******************************************************************************
ENDP0000  DISPLAY   *P1:24,*EL,*P19:24,*V2LON:
                    "** Transmission Data Processing Completed **",*W;
ENDP9999  RETURN
.
.******************************************************************************
.*                                  ENDP0000                                  *
.*                             End of process                                 *
.******************************************************************************
ENDPA000  DISPLAY   *P1:24,*EL,*P19:24,*V2LON:
                    "** Transmission Data Processing Completed **",*W;
.
          PRINT     *1," " 
          PRINT     *1,"Number of Records Read      : ",NOFREAD
          PRINT     *1,"Number of Records Extracted : ",NOFEXTR
          PRINT     *1,"Number of Errors Found      :  ",ERRFLG
          PRINT     *1,"Extract File Name           : ",FILENAM3
          PRINT     *1," "
          PRINT     *1,"*** End Of Report ***"
.
ENDPA999  RETURN
+
.******************************************************************************
.*                                  PSYC0000              Called by: PROC0000 *
.*          Calculate the bed days for psychiatric                            *
.******************************************************************************
...PSYC0000  PACK      KEY5,ANSA,SP1,TATYPE
...          CALL      RDCODE1
...          CMATCH    ANSP,TCINDC3            * 3rd indicator a "P" ?
...          IF        OVRCD = 0 & @EQUAL
...            IF       TPSYFLG = 0
.
.             the patient has been transferred to psychiatric
.
...              MOVE     ONE,TPSYFLG          * flag for psychiatric
...              MOVE     TDATE,PSTRDATE       * set the starting date
...            ENDIF
...          ELSE
...            IF       TPSYFLG = 1
.
.             the patient has changed from psychiatric to something else
.
...               MOVE    TDATE,PENDDATE        * set the ending date
...               CALL    CALC0000             * calculate the dates difference
...               ADD     CALDAYS,PSYCDAYS
...               MOVE    ZERO,TPSYFLG
...            ENDIF
...          ENDIF
.
...PSYC9999  RETURN
+
.******************************************************************************
.*                                  NPSY0000                                  *
.*                   New psych days calculation - based on bed type           *
.******************************************************************************
NPSY0000  MOVE      ZERO,STILLPSY 
          MATCH     SP3,ROOMTYPE
          GOTO      NPSY9999 IF EQUAL        * Dont allow blank codes
.
          PACK      KEY5,ANSR,ANST,ROOMTYPE,SP70   * Using room type
          CALL      RDCODE1
          BRANCH    OVRCD,NPSY9999
.
          MATCH     ANSM,TCINDC3
          GOTO      NPSY9900 IF NOT EQUAL    * Not psych room type
.
          MATCH     ADATE,DDATE
          IF        @EQUAL
            MOVE      ONE,PSYCDAYS
            GOTO      NPSY9999
          ENDIF
.
          MOVE      ONE,STILLPSY
          MATCH     SP70,PSTRDATE
          IF        @EQUAL
            MOVE      TDATE,PSTRDATE       * set the starting date
            GOTO      NPSY9999
          ENDIF
.
NPSY9900  MOVE      TDATE,PENDDATE        * set the ending date
          CALL      CALC0000             * calculate the dates difference
          ADD       CALDAYS,PSYCDAYS
.
          COMPARE   ONE,STILLPSY
          IF        @EQUAL
            MOVE      PENDDATE,PSTRDATE       * set the starting date
          ELSE
            MOVE      SP70,PSTRDATE        * Clear start and end psych dates
          ENDIF
          MOVE      SP70,PENDDATE
.
NPSY9999  RETURN
+
.******************************************************************************
.*                                  CHIH0000                                  *
.*                       Check For Hospital In The Home                       *
.******************************************************************************
CHIH0000  MOVE      ZERO,STILLHIH
          MATCH     SP3,BEDTYPE
          GOTO      CHIH9999 IF EQUAL        * Dont allow blank codes
.
          PACK      KEY5,ANSB,ANST,BEDTYPE   * Using bed type
          CALL      RDCODE1
          BRANCH    OVRCD,CHIH9999
.
          MATCH     ANSH,TCINDC1
          GOTO      CHIH9900 IF NOT EQUAL    * Not hospital in the home
.
          MATCH     ADATE,DDATE
          IF        @EQUAL
            MOVE      ONE,WORKHITH
            GOTO      CHIH9999
          ENDIF
.
          MOVE      ONE,STILLHIH
          MATCH     SP70,HSTRDATE
          IF        @EQUAL
            MOVE      TDATE,HSTRDATE       * set the starting date
            GOTO      CHIH9999
          ENDIF
.
CHIH9900  MOVE      TDATE,HENDDATE        * set the ending date
          CALL      CALH0000             * calculate the dates difference
          ADD       CALDAYS,WORKHITH
.
          COMPARE   ONE,STILLHIH
          IF        @EQUAL
            MOVE      HENDDATE,HSTRDATE       * set the starting date
          ELSE
            MOVE      SP70,HSTRDATE        * Clear start and end psych dates
          ENDIF
          MOVE      SP70,HENDDATE
.
CHIH9999  RETURN
.
.==============================================================================
+
.******************************************************************************
.*                                  CALC0000              Called by: PROC0000 *
.*                Calculate the dates differences                             *
.******************************************************************************
CALC0000  PACK      CDYSFDTE,PSTRDATE
          PACK      CDYSTDTE,PENDDATE
          CALL      CALCDAYS
          MOVE      CDYSDAYS,CALDAYS
          SUB       ONE,CALDAYS       * Only want the diff between the 2 dates
CALC9999  RETURN
+
.******************************************************************************
.*                                  CALH0000              Called by: PROC0000 *
.*                Calculate the dates differences                             *
.******************************************************************************
CALH0000  MOVE      ZERO,CALDAYS
          MATCH     SP70,HSTRDATE
          GOTO      CALH9999 IF EQUAL
. 
          PACK      CDYSFDTE,HSTRDATE
          PACK      CDYSTDTE,HENDDATE
          CALL      CALCDAYS
          MOVE      CDYSDAYS,CALDAYS
          SUB       ONE,CALDAYS       * Only want the diff between the 2 dates
CALH9999  RETURN
+
.******************************************************************************
.*                                  GDRG0000              Called by: GDGR0000 *
.*                              Get The DRG Code                              *
.******************************************************************************
GDRG0000  MOVE      SP4,XDIAGRP             * Default to no DRG
          MOVE      SP70,XMDIACTG           * Default to no MDC
          MATCH     SP8,DDATE
          GOTO      GDRG9000 IF EQUAL       * Patient not discharged
.
GDRG1060  MATCH     PTCNED70,DDATE          * disc.date > DRG 7.0 effect.date?
          IF        !@LESS
            MOVE      DRG070,DRGVERS        * Use 7.0 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED62,DDATE          * disc.date > DRG 6.2 effect.date?
          IF        !@LESS
            MOVE      DRG062,DRGVERS        * Using 6.2 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED60,DDATE          * disc.date > DRG 6.0 effect.date?
          IF        !@LESS
            MOVE      DRG060,DRGVERS        * Using 6.0 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED52,DDATE          * disc.date > DRG 5.2 effect.date?
          IF        !@LESS
            MOVE      DRG052,DRGVERS        * Using 5.2 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED51,DDATE          * disc.date > DRG 5.1 effect.date?
          IF        !@LESS
            MOVE      DRG051,DRGVERS        * Using 5.1 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED50,DDATE          * disc.date > DRG 5.0 effect.date?
          IF        !@LESS
            MOVE      DRG050,DRGVERS        * Using 5.0 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED42,DDATE          * disc.date > DRG 4.2 effect.date?
          IF        !@LESS
            MOVE      DRG042,DRGVERS        * Using 4.2 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED41,DDATE          * disc.date > DRG 4.1 effect.date?
          IF        !@LESS
            MOVE      DRG041,DRGVERS        * Using 4.1 DRG version
            GOTO      GDRG4000
          ENDIF
.
          GOTO      GDRG9000
.
GDRG4000  PACK      KEY13,AADMNO,SP1,ONE,DRGVERS
          CALL      RDPTPGR1                * Read a patient grouper file record
          BRANCH    OVRCD,GDRG9000
.
          MOVE      PTPGNDRG,XDIAGRP        * DRG
          MOVE      PTPGNMDC,XMDIACTG       * MDC
.
GDRG9000  MOVE      ZERO,EXIT
GDRG9999  RETURN
+
.******************************************************************************
.*                                  VALD0000              Called by: WRIT0000 *
.*                         Validate data before writing                       *
.******************************************************************************
VALD0000  MOVE      ZERO,FORM1
          MOVE      XINDST,FORM1             * indigenous status
          IF        FORM1<1 | FORM1>4 & FORM1<9
            MOVE      "Invalid Indigenous Status ",ERRMSG
            CALL      PRTL0000
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XMARST,FORM1             * marital status
          IF        FORM1<1 | FORM1 >6
            MOVE      "Invalid Marital Status ",ERRMSG
            CALL      PRTL0000
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XURGENC,FORM1            * urgency
          IF        FORM1<1 & FORM1>3|FORM1=9
            MOVE      "Invalid Urgency ",ERRMSG
            CALL      PRTL0000
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XMODADM,FORM1           * mode of admission
          IF        FORM1<0 | FORM1 >3
            MOVE      "Invalid Mode of Admission ",ERRMSG
            CALL      PRTL0000
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XINSRST,FORM1           * insurance status
          IF        FORM1<1 | FORM1>2 & FORM1<9
            MOVE      "Invalid Insurance Status",ERRMSG
            CALL      PRTL0000
          ENDIF
.
... I-54733
          MOVE      ZERO,FORM1
          MOVE      XELCTST,FORM1           * eletion status
          IF        FORM1<1 | FORM1>2            
            MOVE      "Invalid Election Status",ERRMSG
            CALL      PRTL0000
          ENDIF
..
          MOVE      ZERO,FORM2
          MOVE      ZERO,FORM3              * I-54733
.
          SQUEEZE   X4CARETY                * Remove trailing/leading spaces
          MOVE      X4CARETY,FORM3          * I-54733
          PACK      X4CARETY,X4CARETY,SP70
.
          IF        FORM3=20 | FORM3=30
            GOTO      VALD1000
          ENDIF
.
... I-54733
          IF FORM3=10|FORM3>20&FORM3<24|FORM3>30&FORM3<34|FORM3=40|FORM3=50|FORM3=60|FORM3=70|FORM3=80|FORM3=90|FORM3=100
           GOTO     VALD1000
          ENDIF
          IF       FORM3=12
            GOTO     VALD1000
          ENDIF
          MOVE     "Invalid Care Type",ERRMSG
          CALL     PRTL0000
.
VALD1000  PACK      LJUSCODE,X4CARETY,SP70         * I-55795
          MOVE      "3",JUSTNO
          CALL      RJUS0000
          MOVE      RJUSCODE,X4CARETY
          PACK      X4CARETY,X4CARETY,SP70
.
VALD1050  MOVE      ZERO,FORM2              * source of referral
          MOVE      XSREFER,FORM2
          IF        FORM2<1 | FORM2>18
            IF        FORM2<>99
              MOVE      "Invalid Source of Referral ",ERRMSG
              CALL      PRTL0000
            ENDIF
          ENDIF
.
          MOVE      ZERO,FORM2              * referral on discharge
          MOVE      XREFDIS,FORM2
          IF        FORM2<1 | FORM2>19
            IF        FORM2<>99
              MOVE      "Invalid Referral on Discharge ",ERRMSG
              CALL      PRTL0000
            ENDIF
          ENDIF
.
          MOVE      ZERO,FORM1              * mode of separation
          MOVE      XSEPTYP,FORM1
          IF        FORM1<1 | FORM1>9
            MOVE      "Invalid Mode of Separation ",ERRMSG
            CALL      PRTL0000
          ENDIF
.
          MOVE      ZERO,FORM1              * referral to further care
          MOVE      XREFCAR,FORM1
          IF        FORM1>7
            MOVE      "Invalid Referral to Further Care ",ERRMSG
            CALL      PRTL0000
          ENDIF
.
.
          MOVE      ZERO,FORM1              * employment status
          MOVE      XEMPLST,FORM1
          IF        PSYCFLG=1
            IF        FORM1<1 |FORM1>6
              MOVE     "Invalid Employment Status ",ERRMSG
              CALL     PRTL0000
            ENDIF
          ENDIF
.
VALD9999  RETURN
+
+            
.******************************************************************************
.*                                  RJUS0000              Called by: GDAT0000 *
.*                            Right Justify The Code                          *
.******************************************************************************
RJUS0000  PACK      RJUSCODE,SP70
          RESET     LJUSCODE,JUSTNO
          MOVE      ZERO,CHRCOUNT
RJUS1000  CMATCH    SP1,LJUSCODE
          GOTO      RJUS2000 IF NOT EQUAL   
.         
          ADD       ONE,CHRCOUNT
          BUMP      LJUSCODE,-1
          GOTO      RJUS2000 IF EOS
.
          COMPARE   JUSTNO,CHRCOUNT
          GOTO      RJUS1000 IF LESS
.
RJUS2000  RESET     LJUSCODE
          CLEAR     RJUSCODE
          RESET     RJUSCODE,CHRCOUNT
          APPEND    LJUSCODE,RJUSCODE
          RESET     RJUSCODE
.
RJUS9000  MOVE      ZERO,EXIT
RJUS9999  RETURN
+
.******************************************************************************
.*                         Print error message                                *
.******************************************************************************
PRTL0000  IF        ERRFLG=0
            CALL      HEAD80
            PRINT     *N,"------------------------------------------":
                         "-------------":
                      *N,"|Admission | Description ",*55,"|":
                      *N,"------------------------------------------":
                         "-------------"
          ENDIF
.
          PRINT     *1,"| ",AADMNO," |",ERRMSG,"  |"
          ADD       ONE,ERRFLG
.
PRTL9999  RETURN
+
.******************************************************************************
.*                         Print error message                                *
.******************************************************************************
PRTLA000  IF        ERRFLG=0
            CALL      HEAD80
            CALL      PRTQTR00
            PRINT     *N,"*---------------------------------------":
                         "---------------------------------------*":
                      *N,"|Adm No.  |U/R No. |Error Message ",*80,"|":
                      *N,"*---------------------------------------":
                         "---------------------------------------*"
          ENDIF
.
          PRINT     *1,"|",AADMNO," |",AURNO,"|",ERRCDE," ",ERRMSG1,"|"
          ADD       ONE,ERRFLG
.
          MATCH     SP70,ERRMSG2
          IF        !@EQUAL
            PRINT     *1,"|",*21,ERRMSG2,*80,"|"     
          ENDIF
.
          MOVE      SP70,ERRMSG1
          MOVE      SP70,ERRMSG2
.
PRTLA999  RETURN
.
.------------------------------------------------------------------------------
. Print extract quarter line
.------------------------------------------------------------------------------
PRTQTR00  UNPACK    STRDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      STRDATER,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    ENDDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      ENDDATER,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          PRINT     *20,"Quarter ",QTRNO," - ",STRDATER," to ",ENDDATER 
.
PRTQTR99  RETURN
+
.******************************************************************************
. Move Extract to Web Directory
.******************************************************************************
MVEXT000  CLEAR     CMDLINE
          APPEND    "ibaadt55.us1 ",CMDLINE
          APPEND    XHINDIC,CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    FILENAME,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "ibaadt55.us2 ",CMDLINE
          APPEND    XHINDIC,CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    FILENAM2,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
MVEXT999  RETURN
+
.--------------------------------------------------------------------------
. Move Extract .csv file to Web Directory
.--------------------------------------------------------------------------
MVEXC000  CLEAR     CMDLINE
          APPEND    "ibaadt55.us3 ",CMDLINE
          APPEND    XHINDIC,CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    FILENAM3,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
MVEXC999  RETURN
.
.--------------------------------------------------------------------------
. Processing extract from 01/07/2021  
. Create the header record for the transmission file
.--------------------------------------------------------------------------
.
PROD0000  MOVE      "Extract Date For ACT APC",PRGNAM
          CALL      RUNQTR00
.
          MOVE      ZERO,CPAGENO
          MOVE      ZERO,NOFREAD
          MOVE      ZERO,NOFEXTR
          MOVE      ZERO,ERRFLG
.
          SCAN      "PreJulyTest",REPTNAME
          IF        @EQUAL
            MATCH     "20240101",STRDATE
          ELSE
            MATCH     "20240701",STRDATE
          ENDIF 
.
          IF        !@LESS
            MOVE      ONE,DOYR2024
          ENDIF
          RESET     REPTNAME
.
          MATCH     ANSY,ERRRPFLG
          IF        !@EQUAL
            CLOSE     WORK20
            PREP      WORK20,FILENAM3
          ENDIF
.
PROD0700  DISPLAY   *P1:24,*EL,*P20:24,*V2LON,"** Processing Discharges **",*W:
                    *P20:24,*EL,"Discharged Admission No. : ";
.
. This is for testing only. It prints the column heading no. for checking 
.
          MATCH     ANSY,ERRRPFLG
          IF        !@EQUAL
            CALL      WRIHED00
          ENDIF
.
          MOVE      ENDDATE,STODATE
          PACK      KEY16,STRDATE,SP8
          CALL      RDSDSCH2
PROD1000  CALL      RDKDSCH2
          BRANCH    OVRCD OF PROD9000
.
          ADD       ONE,NOFREAD
.
.         Multi-Hospital processing
.
          COMPARE   ONE,IBCNMHOS
          GOTO      PROD2000 IF NOT EQUAL
.
          MATCH     SP10,PTHSHOSP
          GOTO      PROD2000 IF EQUAL
.
          MOVE      DADMNO,KEY8
          CALL      RDPMVX11
          BRANCH    OVRCD,PROD1000
.
          MATCH     PMVXMHOS,PTHSHOSP
          GOTO      PROD1000 IF NOT EQUAL
.
PROD2000  MATCH     DDATE,STODATE
          GOTO      PROD9000 IF LESS
.
          MOVE      DDATE,ICDRDDTE          * Used of reading ICD files
.
          DISPLAY   *P50:24,*V2LON,DADMNO;
.
          MOVE      DURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,PROD1000
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,PROD1000
.
          CALL      MENTAL00
.
          MOVE      ZERO,DAYCASE
          MATCH     ADATE,DDATE
          IF        @EQUAL
            MOVE      ONE,DAYCASE
          ENDIF
.
          CALL      WRITA000
          GOTO      PROD1000
.
PROD9000  MOVE      ZERO,EXIT
PROD9999  IF        ERRFLG <>0
            DISPLAY   *P1:24,*EL,*B,"Errors found.  ";
            CALL      HITENTER
            PRINT     *1,"*---------------------------------------":
                         "---------------------------------------*"
          ENDIF
          RETURN
.
.--------------------------------------------------------------------------
. Get extract running quarter
.--------------------------------------------------------------------------
RUNQTR00  UNPACK    RUNDATE,CCENT,CYEAR,CMON,CDAY
.         
          MOVE      0,F2
          MOVE      CMON,F2
          BRANCH    F2,RUNQTR10,RUNQTR10,RUNQTR10:
                       RUNQTR20,RUNQTR20,RUNQTR20:
                       RUNQTR30,RUNQTR30,RUNQTR30:
                       RUNQTR40,RUNQTR40,RUNQTR40
.
          GOTO      RUNQTR99
.
RUNQTR10  MOVE      "01",SDAY
          MOVE      "01",SMON
          MOVE      "31",EDAY
          MOVE      "03",EMON
          MOVE      "MAR",QTRMTH
          MOVE      "1",QTRNO
          GOTO      RUNQTR80
.
RUNQTR20  MOVE      "01",SDAY
          MOVE      "04",SMON
          MOVE      "30",EDAY
          MOVE      "06",EMON
          MOVE      "2",QTRNO
          MOVE      "JUN",QTRMTH
          GOTO      RUNQTR80
.
RUNQTR30  MOVE      "01",SDAY
          MOVE      "07",SMON
          MOVE      "30",EDAY
          MOVE      "09",EMON
          MOVE      "SEP",QTRMTH
          MOVE      "3",QTRNO
          GOTO      RUNQTR80
.
RUNQTR40  MOVE      "01",SDAY
          MOVE      "10",SMON
          MOVE      "31",EDAY
          MOVE      "12",EMON
          MOVE      "DEC",QTRMTH
          MOVE      "4",QTRNO
          GOTO      RUNQTR80
.
RUNQTR80  PACK      STRDATE,CCENT,CYEAR,SMON,SDAY
          PACK      ENDDATE,CCENT,CYEAR,EMON,EDAY
          PACK      RUNQTRYR,QTRMTH,CCENT,CYEAR  
.
RUNQTR99  RETURN
.
.--------------------------------------------------------------------------
. Initailise extract file varaibles
.--------------------------------------------------------------------------
INITA000  PACK      XRECIND,SP70,SP70
.          
          IF        DOYR2024=1
            UNPACK    SP70,XESTNUM,XHSPGEOI,XPERINDT,XSEX,XGENDER
            UNPACK    SP70,XDOB,XCOB,XIHIID,XIHIRS,XIHINS
          ELSE
            UNPACK    SP70,XESTNUM,XHSPGEOI,XPERINDT,XSEX,XDOB,XCOB
          ENDIF
.
          UNPACK    SP70,XINDST,XMARST,XAREARES,XPOST,XACCOMM2,XACCOMMP,XLABFOR
          UNPACK    SP70,XLABFORP,XELCTST,XINSRST,XMEDICR,XFNDSRC,X2CARETY
          UNPACK    SP70,XQLFDAYS,XPSYCDAY,XLEGSTAT,XPRVSPCT 
.
          IF        DOYR2024=1          
            UNPACK    SP70,XADMDAT,XADMTIME,XDISDAT,XDISTIME
          ELSE
            UNPACK    SP70,XADMDAT,XDISDAT
          ENDIF
.
          UNPACK    SP70,X5LEAVDY,XSREFER,XURGENC,XMODADM,XMODSEP,XREFDES
          UNPACK    SP70,XINFWEIG,XILOHS,XHIHCDAY,XCNHSPC,XCNPTSTS,XICUHRS
          UNPACK    SP70,XVENHRS,XESTWATI,XMEHEPSI
          UNPACK    SP70,XPRIIMPT,XRSULGRP,XPALCARL
          UNPACK    SP70,XRUNQTR,XNWAU19,XNWAU20,XNWAU21,XILOHSO
.
          IF        DOYR2024=1
            UNPACK    SP70,XIHIID,XIHIRS,XIHINS
          ENDIF
.
          MOVE      SP70,XMEDINO
          MOVE      SP70,XINVCNO
          MOVE      SP70,XOPRDAT
          MOVE      SP70,XPATNAM 
.
          MOVE      ZERO,CNT
          REPEAT 
            ADD       ONE,CNT
            MOVE      SP70,XELSTAR[CNT]
          UNTIL       CNT = 5
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      SP70,XPROCAR[CNT]
          UNTIL       CNT = 50
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      SP70,XDIAGAR[CNT]
          UNTIL       CNT = 100
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      SP70,XFIMSAR[CNT]
          UNTIL       CNT = 18
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      SP70,XNATOSAR[CNT]
          UNTIL       CNT = 12 
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      SP70,XSTDMSAR[CNT]
          UNTIL       CNT = 12
.
          MOVE      SP70,ERRMSG1 
          MOVE      SP70,ERRMSG2 
.
INITA999  RETURN
.
.----------------------------------------------------------------------------
. This section is to be used only for showing the header line with field
. number. This is ued only at the beginning of the development stage.  
.----------------------------------------------------------------------------
WRIHED00  IF        DOYR2024=1
            GOTO      WRIHED10
          ENDIF
.
          MOVE      "1",XRECIND
          MOVE      "2",XESTNUM          
          MOVE      "3",XHSPGEOI          
          MOVE      "4",XPERINDT          
          MOVE      "5",XSEX          
          MOVE      "6",XDOB
          MOVE      "7",XCOB          
          MOVE      "8",XINDST          
          MOVE      "9",XMARST          * 10
          MOVE      "10",XAREARES                
          MOVE      "11",XPOST
          MOVE      "12",XACCOMM2
          MOVE      "3",XACCOMMP
          MOVE      "4",XLABFOR
          MOVE      "5",XLABFORP
          MOVE      "6",XELCTST
          MOVE      "7",XINSRST
          MOVE      "8",XMEDICR
          MOVE      "19",XFNDSRC          * 20
          MOVE      "20",X2CARETY        
          MOVE      "21",XQLFDAYS
          MOVE      "22",XPSYCDAY 
          MOVE      "3",XLEGSTAT 
          MOVE      "4",XPRVSPCT
          MOVE      "25",XADMDAT
          MOVE      "26",XDISDAT
          MOVE      "27",X5LEAVDY
          MOVE      "28",XSREFER
          MOVE      "9",XURGENC          * 30
          MOVE      "0",XMODADM          
          MOVE      "31",XMODSEP
          MOVE      "2",XREFDES
          MOVE      "33",XINFWEIG
          MOVE      "4",XILOHS
          MOVE      "35",XHIHCDAY
          MOVE      "36",XCNHSPC
          MOVE      "7",XCNPTSTS
          MOVE      "38",XICUHRS
          MOVE      "39",XVENHRS         * 40
          MOVE      "40",XESTWATI         
.
          MOVE      ZERO,CNT
          REPEAT 
            ADD       ONE,CNT
            MOVE      "41",XELSTAR[CNT]
            PACK      XELSTAR[CNT],XELSTAR[CNT],SP70
          UNTIL       CNT = 5
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "42",XPROCAR[CNT]
            PACK      XPROCAR[CNT],XPROCAR[CNT],SP70
          UNTIL       CNT = 50
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "43",XDIAGAR[CNT]
            PACK      XDIAGAR[CNT],XDIAGAR[CNT],SP70
          UNTIL       CNT = 100
.
          MOVE      "44",XMEHEPSI
          MOVE      "45",XPRIIMPT
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "6",XFIMSAR[CNT]
          UNTIL       CNT = 18
.
          MOVE      "47",XRSULGRP
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "8",XNATOSAR[CNT]
          UNTIL       CNT = 12 
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "9",XSTDMSAR[CNT]
          UNTIL       CNT = 12
.
          MOVE      "50",XPALCARL        * 50
          MOVE      "51",XRUNQTR
          MOVE      "52",XNWAU19
          MOVE      "53",XNWAU20
          MOVE      "54",XNWAU21
          MOVE      "55",XILOHSO
          MOVE      "56",XMEDINO
          MOVE      "57",XINVCNO
          MOVE      "58",XOPRDAT
          MOVE      "59",XPATNAM
          GOTO      WRIHED98
.
WRIHED10  MOVE      "1",XRECIND
          MOVE      "2",XESTNUM          
          MOVE      "3",XHSPGEOI          
          MOVE      "4",XPERINDT          
          MOVE      "5",XSEX          
          MOVE      "6",XGENDER       
          MOVE      "7",XDOB
          MOVE      "8",XCOB          
          MOVE      "9",XINDST          
          MOVE      "10",XMARST          * 10
          MOVE      "11",XAREARES                
          MOVE      "12",XPOST
          MOVE      "13",XACCOMM2
          MOVE      "4",XACCOMMP
          MOVE      "5",XLABFOR
          MOVE      "6",XLABFORP
          MOVE      "7",XELCTST
          MOVE      "8",XINSRST
          MOVE      "9",XMEDICR
          MOVE      "20",XFNDSRC          * 20
          MOVE      "21",X2CARETY        
          MOVE      "22",XQLFDAYS
          MOVE      "23",XPSYCDAY 
          MOVE      "4",XLEGSTAT 
          MOVE      "5",XPRVSPCT
          MOVE      "26",XADMDAT
          MOVE      "27",XADMTIME     
          MOVE      "28",XDISDAT
          MOVE      "29",XDISTIME
          MOVE      "30",X5LEAVDY        * 30
          MOVE      "31",XSREFER
          MOVE      "2",XURGENC      
          MOVE      "3",XMODADM          
          MOVE      "34",XMODSEP
          MOVE      "5",XREFDES
          MOVE      "36",XINFWEIG
          MOVE      "7",XILOHS
          MOVE      "38",XHIHCDAY
          MOVE      "39",XCNHSPC
          MOVE      "0",XCNPTSTS         * 40
          MOVE      "41",XICUHRS
          MOVE      "42",XVENHRS      
          MOVE      "43",XESTWATI         
.
          MOVE      ZERO,CNT
          REPEAT 
            ADD       ONE,CNT
            MOVE      "44",XELSTAR[CNT]
            PACK      XELSTAR[CNT],XELSTAR[CNT],SP70
          UNTIL       CNT = 5
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "45",XPROCAR[CNT]
            PACK      XPROCAR[CNT],XPROCAR[CNT],SP70
          UNTIL       CNT = 50
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "46",XDIAGAR[CNT]
            PACK      XDIAGAR[CNT],XDIAGAR[CNT],SP70
          UNTIL       CNT = 100
.
          MOVE      "47",XMEHEPSI
          MOVE      "48",XPRIIMPT
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "9",XFIMSAR[CNT]
          UNTIL       CNT = 18
.
          MOVE      "50",XRSULGRP         * 50
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "1",XNATOSAR[CNT]
          UNTIL       CNT = 12 
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "2",XSTDMSAR[CNT]
          UNTIL       CNT = 12
.
          MOVE      "53",XPALCARL   
          MOVE      "54",XRUNQTR
          MOVE      "55",XNWAU19
          MOVE      "56",XNWAU20
          MOVE      "57",XNWAU21
          MOVE      "58",XILOHSO
          MOVE      "59",XIHIID
          MOVE      "60",XIHIRS
          MOVE      "61",XIHINS
          MOVE      "62",XMEDINO
          MOVE      "63",XINVCNO
          MOVE      "64",XOPRDAT
          MOVE      "65",XPATNAM
.
WRIHED98  CALL      WRIEXT00 
.
WRIHED99  RETURN
.
.--------------------------------------------------------------------------
. Write the record details                              
.--------------------------------------------------------------------------
WRITA000  CALL      INITA000

          IF        DOYR2024=0
            CALL      MSTDA000                * extract master details
          ELSE
            CALL      MSTDB000                * extract master details
          ENDIF
          ADD       ONE,NOFEXTR
.
          MATCH     ANSY,ERRRPFLG
          GOTO      WRITA999 IF EQUAL 
.   
          CALL      WRIEXT00
.
WRITA999  RETURN
.
.--------------------------------------------------------------------------
. Write extract record details
.--------------------------------------------------------------------------
WRIEXT00  CLEAR     ELSTARR
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            PACK      ELSTARR,ELSTARR,XELSTAR[CNT]
            IF        CNT < 5
              PACK      ELSTARR,ELSTARR,COMMA 
            ENDIF
          UNTIL       CNT = 5
.
          CLEAR     PROCARR
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            PACK      PROCARR,PROCARR,XPROCAR[CNT]
            IF        CNT < 50
              PACK      PROCARR,PROCARR,COMMA
            ENDIF
          UNTIL       CNT = 50
.
          CLEAR     DIAGARR
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            PACK      DIAGARR,DIAGARR,XDIAGAR[CNT]
            IF        CNT < 100
              PACK      DIAGARR,DIAGARR,COMMA
            ENDIF
          UNTIL       CNT = 100
.
WRIEXT50  CLEAR     FIMSARR
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            PACK      FIMSARR,FIMSARR,XFIMSAR[CNT]
.            IF        CNT < 18
.              PACK      FIMSARR,FIMSARR,COMMA
.            ENDIF
          UNTIL       CNT = 18
.
          CLEAR     NATOARR
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            PACK      NATOARR,NATOARR,XNATOSAR[CNT]
.            IF        CNT < 12 
.              PACK      NATOARR,NATOARR,COMMA
.            ENDIF
          UNTIL       CNT = 12
.
          CLEAR     STDMSARR
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            PACK      STDMSARR,STDMSARR,XSTDMSAR[CNT]
.            IF        CNT < 12 
.              PACK      STDMSARR,STDMSARR,COMMA
.            ENDIF
          UNTIL       CNT = 12
.
          IF        DOYR2024=1
            GOTO      WRIEXT81
          ENDIF
.
WRIEXT80  WRITE     WORK20,SEQ;XRECIND,COMMA,XESTNUM,COMMA:              * 2
                           XHSPGEOI,COMMA,XPERINDT,COMMA,XSEX,COMMA:     * 5
                           XDOB,COMMA,XCOB,COMMA,XINDST,COMMA:           * 8
                           XMARST,COMMA,XAREARES,COMMA,XPOST,COMMA:      * 11
                           XACCOMM2,COMMA,XACCOMMP,COMMA,XLABFOR,COMMA:  * 14
                           XLABFORP,COMMA,XELCTST,COMMA,XINSRST,COMMA:   * 17
                           XMEDICR,COMMA,XFNDSRC,COMMA,X2CARETY,COMMA:   * 20
                           XQLFDAYS,COMMA,XPSYCDAY,COMMA,XLEGSTAT,COMMA: * 23
                           XPRVSPCT,COMMA,XADMDAT,COMMA,XDISDAT,COMMA:   * 26
                           X5LEAVDY,COMMA,XSREFER,COMMA,XURGENC,COMMA:   * 29
                           XMODADM,COMMA,XMODSEP,COMMA,XREFDES,COMMA:    * 32
                           XINFWEIG,COMMA,XILOHS,COMMA,XHIHCDAY,COMMA:   * 35
                           XCNHSPC,COMMA,XCNPTSTS,COMMA,XICUHRS,COMMA:   * 38
                           XVENHRS,COMMA,XESTWATI,COMMA,ELSTARR,COMMA:   * 41
                           PROCARR,COMMA,DIAGARR,COMMA,XMEHEPSI,COMMA:   * 44
                           XPRIIMPT,COMMA,FIMSARR,COMMA,XRSULGRP,COMMA:  * 47
                           NATOARR,COMMA,STDMSARR,COMMA,XPALCARL,COMMA:  * 50
                           XRUNQTR,COMMA,XNWAU19,COMMA,XNWAU20,COMMA:    * 53
                           XNWAU21,COMMA,XILOHSO,COMMA,XMEDINO,COMMA:    * 56
                           XINVCNO,COMMA,XOPRDAT,COMMA,XPATNAM           * 59
.
          GOTO      WRIEXT99
.
WRIEXT81  WRITE     WORK20,SEQ;XRECIND,COMMA,XESTNUM,COMMA:              * 2
                           XHSPGEOI,COMMA,XPERINDT,COMMA,XSEX,COMMA:     * 5
                           XGENDER,COMMA,XDOB,COMMA,XCOB,COMMA:          * 8
                           XINDST,COMMA:                                 * 9
                           XMARST,COMMA,XAREARES,COMMA,XPOST,COMMA:      * 12
                           XACCOMM2,COMMA,XACCOMMP,COMMA,XLABFOR,COMMA:  * 15
                           XLABFORP,COMMA,XELCTST,COMMA,XINSRST,COMMA:   * 18
                           XMEDICR,COMMA,XFNDSRC,COMMA,X2CARETY,COMMA:   * 21
                           XQLFDAYS,COMMA,XPSYCDAY,COMMA,XLEGSTAT,COMMA: * 24
                           XPRVSPCT,COMMA,XADMDAT,COMMA,XADMTIME,COMMA:  * 27
                           XDISDAT,COMMA,XDISTIME,COMMA:                 * 29
                           X5LEAVDY,COMMA,XSREFER,COMMA,XURGENC,COMMA:   * 32
                           XMODADM,COMMA,XMODSEP,COMMA,XREFDES,COMMA:    * 35
                           XINFWEIG,COMMA,XILOHS,COMMA,XHIHCDAY,COMMA:   * 38
                           XCNHSPC,COMMA,XCNPTSTS,COMMA,XICUHRS,COMMA:   * 41
                           XVENHRS,COMMA,XESTWATI,COMMA,ELSTARR,COMMA:   * 44
                           PROCARR,COMMA,DIAGARR,COMMA,XMEHEPSI,COMMA:   * 47
                           XPRIIMPT,COMMA,FIMSARR,COMMA,XRSULGRP,COMMA:  * 50
                           NATOARR,COMMA,STDMSARR,COMMA,XPALCARL,COMMA:  * 53
                           XRUNQTR,COMMA,XNWAU19,COMMA,XNWAU20,COMMA:    * 56
                           XNWAU21,COMMA,XILOHSO,COMMA,XIHIID,COMMA:     * 59
                           XIHIRS,COMMA,XIHINS,COMMA,XMEDINO,COMMA:      * 62
                           XINVCNO,COMMA,XOPRDAT,COMMA,XPATNAM           * 65
.
WRIEXT99  RETURN
.
.--------------------------------------------------------------------------
. Extract master details        
.--------------------------------------------------------------------------
MSTDA000  MOVE      ZERO,PSYCFLG
.
. State Record Identifier (1)
.
          PACK      XRECIND,DAADMNO,SP70,SP70
.
. Establishment Number (2)
.
.          COMPARE   ONE,IBCNMHOS
.          IF        @EQUAL
.            MATCH     SP70,PMVXMHOS
.            IF        !@EQUAL
.              MOVE      PMVXMHOS,KEY3
.              CALL      RDPTHSP1                
.              IF        OVRCD=0
.                MOVE      PTHSNAME,XESTNUM 
.              ENDIF
.            ENDIF
.          ELSE
.            MOVE      CNAME,XESTNUM
.          ENDIF
.
          MOVE      CFILENO,XESTNUM
.
          MATCH     SP70,XESTNUM
          IF        @EQUAL
            MOVE      "F002",ERRCDE
            MOVE      "Establishment Number cannot be Blank",ERRMSG1
            CALL      PRTLA000
          ENDIF
.         
. Hospital Geographical Indicator (3)
.  
          MOVE      ZERO,XHSPGEOI
.
. Person Identifier (4)
.
          PACK      XPERINDT,PURNO,SP70
.
          MATCH     SP70,XPERINDT
          IF        @EQUAL
            MOVE      "E004",ERRCDE
            MOVE      "U/R Number cannot be Blank",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Sex (5)
.
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00    
          MOVE      DSEXNO,XSEX
.
          MATCH     "4",XSEX           . "4" is invalid for ACT extract
          IF        @EQUAL
            MOVE      "3",XSEX
          ENDIF
.
. Date of Birth (6)
.
          MATCH     SP70,PBDATE
          IF        !@EQUAL
            UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
            PACK      XDOB,XDAY,XMON,XCENT,XYEAR 
            REP       " 0",XDOB
          ELSE
            MOVE      "F006",ERRCDE
            MOVE      "Date of Birth cannot be Blank",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
          MATCH     "00000000",XDOB
          IF        @EQUAL
            MOVE      "F006",ERRCDE
            MOVE      "Date of Birth cannot be Blank",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Country of Birth (7)
.
MSTDA070  MATCH     SP70,PCONT
          IF        !@EQUAL
            PACK      KEY5,ANSC,SP1,PCONT,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              UNPACK    TCFORM6,DIM2,XCOB
              REP       " 0",XCOB
            ENDIF
          ENDIF
.
. Indigenous Status (8)
.
          MATCH     SP70,PMPXABRG
          IF        !@EQUAL
            PACK      KEY5,ANSV,ANSA,PMPXABRG,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE    THCSCOD,XINDST 
            ENDIF   
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XINDST,FORM1             
          IF        FORM1<1 | FORM1>4 & FORM1<9
            MOVE      "F008",ERRCDE
            MOVE      "Indigenous Status is not 1, 2, 3, 4 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Marital Status (9)
.
          MATCH     SP70,PMSTAT
          IF        !@EQUAL
            PACK      KEY5,ANSM,SP1,PMSTAT,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      THCSCOD,XMARST   
            ENDIF 
          ENDIF
          MATCH      SP70,XMARST
          IF         @EQUAL
            MOVE      "6",XMARST
          ENDIF
.
. Area of Usual Residence (10)
. 
MSTDA100  UNPACK    SP70,DIM1,DIM8
          PACK      KEY56,PPOST,PADD2,SP10,PADD4,SP70   
          CALL      RDIBPOS1
          IF        OVRCD = 0 
            UNPACK      IBPOASGC,DIM1,DIM4,DIM4A
            MOVE        IBPOSUBR,DIM8
          ELSE
            PACK      KEY56,PPOST,PSUBRB,SP10,PADD4,SP70
            CALL      RDIBPOS1
            IF        OVRCD = 0
              UNPACK      IBPOASGC,DIM1,DIM4,DIM4A
              MOVE        IBPOSUBR,DIM8 
            ELSE                            
              MOVE      SP10,PMVXASGC
              PACK      KEY56,PPOST,PSUBRB,SP70
              CALL      RSIBPOS1
              CALL      RKIBPOS1
              IF        OVRCD = 0
                MATCH     PPOST,IBPOPCOD
                IF        @EQUAL
                  MATCH     PSUBRB,IBPOSUBR
                  IF        @EQUAL
                    UNPACK      IBPOASGC,DIM1,DIM4,DIM4A
                    MOVE        IBPOSUBR,DIM8
                  ENDIF
                ENDIF
              ENDIF
            ENDIF            
          ENDIF
          PACK      XAREARES,DIM1,DIM8,SP70 
.
. Australian Postcode (11)
.
          MOVE      PPOST,XPOST         
.
. Type of Usual Accommodation (12)
.
          MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,PMVXUSAC
            IF        !@EQUAL
              PACK      KEY5,ANSK,ANSP,PMVXUSAC,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      THCSCOD,XACCOMM2
              ENDIF
            ENDIF
          ENDIF
.
. Type of Accommodation Prior to Admission (13)
.
          MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,ASRCE
            IF        !@EQUAL
              PACK      KEY5,ANSS,SP1,ASRCE,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      PTCDUDF8,XACCOMMP
              ENDIF
            ENDIF
          ENDIF
.
. Labour Force Status (14)
.
          MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,PMVXEMPL
            IF        !@EQUAL
              PACK      KEY5,ANSK,ANSD,PMVXEMPL,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      THCSCOD,XLABFOR
              ENDIF
            ENDIF
          ENDIF
.
. Labour Force Status – Public Psych Admissions (15)
.
          MOVE      SP70,XLABFORP
.
. Admitted Patient Election Status (16)
.   
MSTDA160  MATCH     SP70,PMVXCADM
          IF        !@EQUAL
            PACK      KEY5,ANSV,ANSB,PMVXCADM,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TCINDC4,XELCTST
            ENDIF
          ENDIF
          MATCH      SP70,XELCTST
          IF         @EQUAL
            MOVE      "9",XELCTST
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XELCTST,FORM1 
          IF        FORM1<1 | FORM1>2 & FORM1<9
            MOVE      "F016",ERRCDE
            MOVE      "Adm. Patient Election Status is not 1, 2 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Hospital Insurance Status (17)
.
          MATCH     SP70,ACLAIM
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TCINDC7,XINSRST
            ENDIF
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XINSRST,FORM1 
          IF        FORM1<1 | FORM1>2 & FORM1<9
            MOVE      "F017",ERRCDE
            MOVE      "Hospital Insurance Status is not 1, 2 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Medicare Eligibility Status (18)
.
          MATCH     SP70,PTYPE
          IF        !@EQUAL
            PACK      KEY5,ANST,SP1,PTYPE,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      THCSCOD,XMEDICR
            ENDIF
          ENDIF          
          MATCH      SP70,XMEDICR
          IF         @EQUAL
            MOVE      "9",XMEDICR
          ENDIF
.
. Funding Source for Hospital (19)
.
          MATCH     SP70,ACLAIM
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      THCSCOD,XFNDSRC
            ENDIF
          ENDIF
          MATCH      SP70,XFNDSRC
          IF         @EQUAL
            MOVE      "98",XFNDSRC
          ENDIF
.
. Care Type (20)
.
MSTDA200  MATCH     SP70,ACARE
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSC,ACARE,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      THCSCOD,X2CARETY
            ENDIF
          ENDIF
          CALL      VCARTY00  
.
. Mental Health Legal Status (23)
.
MSTDA230  MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,PMVXMHLS
            IF        !@EQUAL
              PACK      KEY5,ANSL,ANSS,PMVXMHLS,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      THCSCOD,XLEGSTAT
              ENDIF
            ENDIF
.
            MOVE      ZERO,FORM1
            MOVE      XLEGSTAT,FORM1   
            IF        FORM1<1 | FORM1>2 & FORM1<9
              MOVE      "F023",ERRCDE
              MOVE      "Mental Health Legal Status is not 1, 2 or 9",ERRMSG1
              CALL      PRTLA000
            ENDIF
          ENDIF
.
. Previous Specialised Treatment (24)
.
MSTDA240  MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,PMVXUDF6
            IF        !@EQUAL
              PACK      KEY5,ANSY,ANSE,PMVXUDF6,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      THCSCOD,XPRVSPCT
              ENDIF
            ENDIF
          ENDIF
.
. Admission Date (25)
.
          MATCH     SP70,ADATE
          IF        !@EQUAL
            UNPACK    ADATE,XCENT,XYEAR,XMON,XDAY
            PACK      XADMDAT,XDAY,XMON,XCENT,XYEAR
            REP       " 0",XADMDAT
          ENDIF
.
. Separation Date (26)
.
          MATCH     SP70,DDATE
          IF        !@EQUAL
            UNPACK    DDATE,XCENT,XYEAR,XMON,XDAY
            PACK      XDISDAT,XDAY,XMON,XCENT,XYEAR
            REP       " 0",XDISDAT
          ENDIF 
.
. Source of Referral to Public Psychiatric Hospitals (28)
.
          MOVE      SP70,XSREFER
.
. Urgency of Admission (29)
.
          MATCH     SP70,ACLSS
          IF        !@EQUAL
            PACK      KEY5,ANSP,SP1,ACLSS,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      THCSCOD,XURGENC
            ENDIF
          ENDIF
          MATCH      SP70,XURGENC
          IF         @EQUAL
            MOVE      "9",XURGENC
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XURGENC,FORM1 
          IF        FORM1<1 | FORM1>3 & FORM1<9
            MOVE      "F029",ERRCDE
            MOVE      "Urgency of Admission is not 1, 2, 3 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Mode of Admission (30)
.
MSTDA300  MATCH     SP70,ASRCE
          IF        !@EQUAL
            PACK      KEY5,ANSS,SP1,ASRCE,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      PTCDUDF7,XMODADM
            ENDIF
          ENDIF
          MATCH      SP70,XMODADM
          IF         @EQUAL
            MOVE      "3",XMODADM
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XMODADM,FORM1
          IF        FORM1<1 | FORM1>3 & FORM1<9
            MOVE      "E030",ERRCDE
            MOVE      "Mode of Admission is not 1, 2, 3 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Mode of Separation (31)
.
          MATCH     SP70,DDEST
          IF        !@EQUAL
            PACK      KEY5,ANSD,ANSD,DDEST,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
.              MOVE      TCINDC5,XMODSEP
              MOVE      PTCDUDF7,XMODSEP
            ENDIF
          ENDIF
.
. Referral Destination (Mental Health Care) (32) 
.
          MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,PMVXUDF8
            IF        !@EQUAL
              PACK      KEY5,ANSY,ANSF,PMVXUDF8,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      THCSCOD,XREFDES
              ENDIF 
            ENDIF
          ENDIF
.
. Weight (33)
.
MSTDA330  PACK      AGEDATE,ADATE,SP70
          CALL      CALCAGE
          IF        PSAGEDAY < 365
            MATCH     SP70,ABWGHT
            IF        !@EQUAL
              RJUSTIFY  ABWGHT
              UNPACK    ABWGHT,DIM2,XINFWEIG
              MOVE      ZERO,F4
              MOVE      XINFWEIG,F4
            ELSE
              MOVE      ZERO,F4
            ENDIF
            IF        F4 = ZERO
              MOVE      "F033",ERRCDE
              MOVE      "Admission Weight is blank and age < 365",ERRMSG1
              CALL      PRTLA000
            ENDIF
          ENDIF
.
. Intended Length of Hospital Stay (34)
.
          MATCH     SP70,PMVXIDUS
          IF        !@EQUAL
            PACK      KEY5,ANSV,ANSI,PMVXIDUS,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              UNPACK    THCSCOD,XILOHS
            ENDIF
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XILOHS,FORM1
          IF        FORM1<1 | FORM1>2 & FORM1<9
            MOVE      "E034",ERRCDE
            MOVE      "Intended Length of Stay is not 1, 2 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Contracted Hospital Care Establishment Identifier (36)
.
          MOVE      SP70,XCNHSPC
.
. Inter-Hospital Contracted Patient Status (37)
.
          MATCH     SP70,ACLAIM
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              UNPACK    PTCDUDF8,XCNPTSTS
            ENDIF
          ENDIF
.
. Length of Stay in Intensive Care Unit      (38)
. Duration of Continuous Ventilatory Support (39)
. Length of Stay in Intensive Care Unit – Other (55)
.
MSTDA380  PACK      KEY8,DAADMNO,SP70
          CALL      RDPTICU1
          IF        OVRCD = 0
MSTDA382    MOVE      ZERO,F5
            MOVE      PTICUINT,F5
            MOVE      F5,F4
            MOVE      F4,XICUHRS
            MOVE      F4,XILOHSO
            MOVE      ZERO,F5
            MOVE      PTICUMEC,F5
            MOVE      F5,F4
            MOVE      F4,XVENHRS
          ENDIF
          REP       " 0",XICUHRS
          REP       " 0",XVENHRS
          REP       " 0",XILOHSO
.
. Establishment Identifier for Hospital Managing Waiting List (40)
.
          MOVE      SP70,XESTWATI
.
. Elective Surgery Waiting Times Cluster Procedure Array (41) [5]
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      SP70,XELSTAR[CNT]
          UNTIL       CNT = 5
.
. Procedure Code Array (42) [50]
.
MSTDA420  CALL      PROCAR00
.
. Diagnosis Code Array (43) [100]
.
MSTDA430  CALL      DIAGAR00
.
. Mental Health Episode Identifier (44)
.
          PACK      XMEHEPSI,SP70,SP70
. 
. Primary Impairment Type (45)
.
          CALL      IMPCD000
.
. Functional Independence Measure (FIM) Score Array (46) [18]
.
          CALL      FIMSCR00
.
. Resource Utilisation Groups – Activities of Daily Living (RUG-ADL) Total Score
. (47)
          MOVE      "99",XRSULGRP
. 
. Health of the Nation Outcome Scale 65 + (HoNOS 65+) Score Array (48) [12]
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "8",XNATOSAR[CNT]
          UNTIL       CNT = 12
.
. Standardised Mini-Mental State Examination (SMMSE) Score Array (49) [12]
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "8",XSTDMSAR[CNT]
          UNTIL       CNT = 12
.
. Palliative Care Linking Key (50) 
.
MSTDA500  MOVE      SP70,XPALCARL
.
. Quarter Indicator (51)
.
          MOVE      RUNQTRYR,XRUNQTR
.
. NWAU19 (52)
.
          MOVE      SP70,XNWAU19
.
. NWAU20 (53)
.
          MOVE      SP70,XNWAU20
.
. NWAU21 (54)
.
          MOVE      SP70,XNWAU21
.
. Theatre Presentation Date (58)
.
MSTDA580  MATCH     SP70,SPTEODTE
          IF        !@EQUAL
            UNPACK    SPTEODTE,XCENT,XYEAR,XMON,XDAY
            PACK      XOPRDAT,XDAY,XMON,XCENT,XYEAR
            REP       " 0",XOPRDAT
          ENDIF
.
          MOVE      SP70,TCINDC1 
          MATCH     SP70,ACLAIM
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
            CALL      RDCODE1
            IF        OVRCD = 1
              MOVE      SP70,TCINDC1
            ENDIF
          ENDIF
.
. For Public Contract Patient (56) (57) (59)
.
          MATCH     ANSP,TCINDC1
          GOTO      MSTDA800 IF NOT EQUAL
.
. Medicare Number (56) XMEDINO
.
          MATCH     SP70,PMEDI
          IF        !@EQUAL
            PACK      XMEDINO,PMEDI,SLASH,PTMXMCCD
          ENDIF 
.
. Invoice Number (57) XINVCNO
.
          PACK      KEY16,DAADMNO,Z70
          CALL      RDSINV3
MSTDA582  CALL      RDPINV3
          BRANCH    OVRCD,MSTDA590
.
          MATCH     DAADMNO,DPINVADM
          GOTO      MSTDA590 IF NOT EQUAL
.
          MATCH     STRDATE,PINVDTE             * Invoice date < start date
          GOTO      MSTDA582 IF LESS
.
          MATCH     PINVDTE,STODATE             * Invoice date > end date
          GOTO      MSTDA582 IF LESS
.
          MOVE      PINVNO,XINVCNO
.
. Patient Name (59) XPATNAM
.
MSTDA590  PACK     KEY115,PURNO,SP70
          CALL     RSPTGSR1
MSTDA592  CALL     RKPTGSR1
          BRANCH   OVRCD,MSTDA800
.   
          MATCH     PURNO,GSRURNO
          GOTO      MSTDA800 IF NOT EQUAL
.
MSTDA593  STRIP     GSRGNAM
          STRIP     GSRSNAM 
          PACK      XPATNAM,GSRGNAM,SP1,GSRSNAM
.
. Number of Qualified Days for Newborns (21)
. Total Psychiatric Care Days (22)
. Total Number of Leave Days (27)
. Number of Days of Hospital in the Home Care (35)
.
MSTDA800  CALL      CLOS0000
.
MSTDA999  RETURN
.
.--------------------------------------------------------------------------
. Extract master details        
.--------------------------------------------------------------------------
MSTDB000  MOVE      ZERO,PSYCFLG
.
. State Record Identifier (1)
.
          PACK      XRECIND,DAADMNO,SP70,SP70
.
. Establishment Number (2)
.
.          COMPARE   ONE,IBCNMHOS
.          IF        @EQUAL
.            MATCH     SP70,PMVXMHOS
.            IF        !@EQUAL
.              MOVE      PMVXMHOS,KEY3
.              CALL      RDPTHSP1                
.              IF        OVRCD=0
.                MOVE      PTHSNAME,XESTNUM 
.              ENDIF
.            ENDIF
.          ELSE
.            MOVE      CNAME,XESTNUM
.          ENDIF
.
          MOVE      CFILENO,XESTNUM
.
          MATCH     SP70,XESTNUM
          IF        @EQUAL
            MOVE      "F002",ERRCDE
            MOVE      "Establishment Number cannot be Blank",ERRMSG1
            CALL      PRTLA000
          ENDIF
.         
. Hospital Geographical Indicator (3)
.  
          MOVE      ZERO,XHSPGEOI
.
. Person Identifier (4)
.
          PACK      XPERINDT,PURNO,SP70
.
          MATCH     SP70,XPERINDT
          IF        @EQUAL
            MOVE      "E004",ERRCDE
            MOVE      "U/R Number cannot be Blank",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Sex (5)
.
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00    
          MOVE      DSEXNO,XSEX
.
          MATCH     "4",XSEX           . "4" is invalid for ACT extract
          IF        @EQUAL
            MOVE      "3",XSEX
          ENDIF
.
. Gender (6)
.
          MOVE      SP70,THCSCOD 
          MATCH     SP70,PMPXUCC4
          IF        !@EQUAL
            PACK      KEY5,CATGi,PMPXUCC4,SP70
            CALL      RDCODE1
            IF        OVRCD = 1
              MOVE      SP70,THCSCOD
            ENDIF
            MOVE      THCSCOD,XGENDER
            MOVE      XGENDER,FORM1
            IF        FORM1<1 | FORM1>5 & FORM1<9
              MOVE      "W006.0",ERRCDE
              MOVE      "Gender is not 1, 2, 3, 4 or 9",ERRMSG1
              CALL      PRTLA000
            ELSE
              IF        FORM1=9
                MOVE      "W006.1",ERRCDE
                MOVE      "Gender is 9",ERRMSG1
                CALL      PRTLA000
              ENDIF
            ENDIF
          ELSE
            MOVE      "W006.0",ERRCDE
            MOVE      "Gender is not 1, 2, 3, 4 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Date of Birth (7)
.
          MATCH     SP70,PBDATE
          IF        !@EQUAL
            UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
            PACK      XDOB,XDAY,XMON,XCENT,XYEAR 
            REP       " 0",XDOB
          ELSE
            MOVE      "F007",ERRCDE
            MOVE      "Date of Birth cannot be Blank",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
          MATCH     "00000000",XDOB
          IF        @EQUAL
            MOVE      "F007",ERRCDE
            MOVE      "Date of Birth cannot be Blank",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Country of Birth (8)
.
MSTDB070  MATCH     SP70,PCONT
          IF        !@EQUAL
            PACK      KEY5,ANSC,SP1,PCONT,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              UNPACK    TCFORM6,DIM2,XCOB
              REP       " 0",XCOB
            ENDIF
          ENDIF
.
. Indigenous Status (9)
.
          MATCH     SP70,PMPXABRG
          IF        !@EQUAL
            PACK      KEY5,ANSV,ANSA,PMPXABRG,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE    THCSCOD,XINDST 
            ENDIF   
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XINDST,FORM1             
          IF        FORM1<1 | FORM1>4 & FORM1<9
            MOVE      "F009",ERRCDE
            MOVE      "Indigenous Status is not 1, 2, 3, 4 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Marital Status (10)
.
          MATCH     SP70,PMSTAT
          IF        !@EQUAL
            PACK      KEY5,ANSM,SP1,PMSTAT,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      THCSCOD,XMARST   
            ENDIF 
          ENDIF
          MATCH      SP70,XMARST
          IF         @EQUAL
            MOVE      "6",XMARST
          ENDIF
.
. Area of Usual Residence (11)
. 
MSTDB100  UNPACK    SP70,DIM1,DIM8
          PACK      KEY56,PPOST,PADD2,SP10,PADD4,SP70   
          CALL      RDIBPOS1
          IF        OVRCD = 0 
            UNPACK      IBPOASGC,DIM1,DIM4,DIM4A
            MOVE        IBPOSUBR,DIM8
          ELSE
            PACK      KEY56,PPOST,PSUBRB,SP10,PADD4,SP70
            CALL      RDIBPOS1
            IF        OVRCD = 0
              UNPACK      IBPOASGC,DIM1,DIM4,DIM4A
              MOVE        IBPOSUBR,DIM8 
            ELSE                            
              MOVE      SP10,PMVXASGC
              PACK      KEY56,PPOST,PSUBRB,SP70
              CALL      RSIBPOS1
              CALL      RKIBPOS1
              IF        OVRCD = 0
                MATCH     PPOST,IBPOPCOD
                IF        @EQUAL
                  MATCH     PSUBRB,IBPOSUBR
                  IF        @EQUAL
                    UNPACK      IBPOASGC,DIM1,DIM4,DIM4A
                    MOVE        IBPOSUBR,DIM8
                  ENDIF
                ENDIF
              ENDIF
            ENDIF            
          ENDIF
          PACK      XAREARES,DIM1,DIM8,SP70 
.
. Australian Postcode (12)
.
          MOVE      PPOST,XPOST         
.
. Type of Usual Accommodation (13)
.
          MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,PMVXUSAC
            IF        !@EQUAL
              PACK      KEY5,ANSK,ANSP,PMVXUSAC,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      THCSCOD,XACCOMM2
              ENDIF
            ENDIF
          ENDIF
.
. Type of Accommodation Prior to Admission (14)
.
          MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,ASRCE
            IF        !@EQUAL
              PACK      KEY5,ANSS,SP1,ASRCE,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      PTCDUDF8,XACCOMMP
              ENDIF
            ENDIF
          ENDIF
.
. Labour Force Status (15)
.
          MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,PMVXEMPL
            IF        !@EQUAL
              PACK      KEY5,ANSK,ANSD,PMVXEMPL,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      THCSCOD,XLABFOR
              ENDIF
            ENDIF
          ENDIF
.
. Labour Force Status – Public Psych Admissions (16)
.
          MOVE      SP70,XLABFORP
.
. Admitted Patient Election Status (17)
.   
MSTDB160  MATCH     SP70,PMVXCADM
          IF        !@EQUAL
            PACK      KEY5,ANSV,ANSB,PMVXCADM,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TCINDC4,XELCTST
            ENDIF
          ENDIF
          MATCH      SP70,XELCTST
          IF         @EQUAL
            MOVE      "9",XELCTST
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XELCTST,FORM1 
          IF        FORM1<1 | FORM1>2 & FORM1<9
            MOVE      "F017",ERRCDE
            MOVE      "Adm. Patient Election Status is not 1, 2 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Hospital Insurance Status (18)
.
          MATCH     SP70,ACLAIM
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TCINDC7,XINSRST
            ENDIF
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XINSRST,FORM1 
          IF        FORM1<1 | FORM1>2 & FORM1<9
            MOVE      "F018",ERRCDE
            MOVE      "Hospital Insurance Status is not 1, 2 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Medicare Eligibility Status (19)
.
          MATCH     SP70,PTYPE
          IF        !@EQUAL
            PACK      KEY5,ANST,SP1,PTYPE,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      THCSCOD,XMEDICR
            ENDIF
          ENDIF          
          MATCH      SP70,XMEDICR
          IF         @EQUAL
            MOVE      "9",XMEDICR
          ENDIF
.
. Funding Source for Hospital (20)
.
          MATCH     SP70,ACLAIM
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      THCSCOD,XFNDSRC
            ENDIF
          ENDIF
          MATCH      SP70,XFNDSRC
          IF         @EQUAL
            MOVE      "98",XFNDSRC
          ENDIF
.
. Care Type (21)
.
MSTDB200  MATCH     SP70,ACARE
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSC,ACARE,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      THCSCOD,X2CARETY
            ENDIF
          ENDIF
          CALL      VCARTY00  
.
. Mental Health Legal Status (24)
.
MSTDB230  MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,PMVXMHLS
            IF        !@EQUAL
              PACK      KEY5,ANSL,ANSS,PMVXMHLS,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      THCSCOD,XLEGSTAT
              ENDIF
            ENDIF
.
            MOVE      ZERO,FORM1
            MOVE      XLEGSTAT,FORM1   
            IF        FORM1<1 | FORM1>2 & FORM1<9
              MOVE      "F024",ERRCDE
              MOVE      "Mental Health Legal Status is not 1, 2 or 9",ERRMSG1
              CALL      PRTLA000
            ENDIF
          ENDIF
.
. Previous Specialised Treatment (25)
.
MSTDB240  MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,PMVXUDF6
            IF        !@EQUAL
              PACK      KEY5,ANSY,ANSE,PMVXUDF6,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      THCSCOD,XPRVSPCT
              ENDIF
            ENDIF
          ENDIF
.
. Admission Date (26)
.
          MATCH     SP70,ADATE
          IF        !@EQUAL
            UNPACK    ADATE,XCENT,XYEAR,XMON,XDAY
            PACK      XADMDAT,XDAY,XMON,XCENT,XYEAR
            REP       " 0",XADMDAT
          ENDIF
.
. Admin Time (27)
.
          MATCH   SP70,ATIME
          IF      !@EQUAL
            UNPACK  ATIME,DIM2,DIM1,DIM2A
            PACK    XADMTIME,DIM2,DIM2A
            TYPE    XADMTIME            * numeric ?
            IF      !@EQUAL
              MOVE    "W027.1",ERRCDE
              MOVE    "Admission Time must be in the form HHMM",ERRMSG1
              CALL      PRTLA000
            ENDIF
          ENDIF
.
. Separation Date (28)
.
          MATCH     SP70,DDATE
          IF        !@EQUAL
            UNPACK    DDATE,XCENT,XYEAR,XMON,XDAY
            PACK      XDISDAT,XDAY,XMON,XCENT,XYEAR
            REP       " 0",XDISDAT
          ENDIF 
.
. Separation Time (29)
.
          MATCH   SP70,DTIME
          IF      !@EQUAL
            UNPACK  DTIME,DIM2,DIM1,DIM2A
            PACK    XDISTIME,DIM2,DIM2A
            TYPE    XDISTIME            * numeric ?
            IF      !@EQUAL
              MOVE    "W029.1",ERRCDE
              MOVE    "Separation Time must be in the form HHMM",ERRMSG1
              CALL      PRTLA000
            ENDIF
            MATCH    DDATE,ADATE
            IF       @EQUAL
              MATCH    XDISTIME,XADMTIME
              IF       !@LESS
                MOVE     "W029.0",ERRCDE
                MOVE      "Arrival Time not less than Separation Time",ERRMSG1
                CALL      PRTLA000
              ENDIF
              MATCH    XADMTIME,XDISTIME
              IF       @LESS
                MOVE     "W027.0",ERRCDE
                MOVE     "Departure Time less than arrival time",ERRMSG1
                CALL     PRTLA000
              ENDIF
            ENDIF 
          ENDIF
.
. Source of Referral to Public Psychiatric Hospitals (31)
.
          MOVE      SP70,XSREFER
.
. Urgency of Admission (32)
.
          MATCH     SP70,ACLSS
          IF        !@EQUAL
            PACK      KEY5,ANSP,SP1,ACLSS,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      THCSCOD,XURGENC
            ENDIF
          ENDIF
          MATCH      SP70,XURGENC
          IF         @EQUAL
            MOVE      "9",XURGENC
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XURGENC,FORM1 
          IF        FORM1<1 | FORM1>3 & FORM1<9
            MOVE      "F032",ERRCDE
            MOVE      "Urgency of Admission is not 1, 2, 3 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Mode of Admission (33)
.
MSTDB300  MATCH     SP70,ASRCE
          IF        !@EQUAL
            PACK      KEY5,ANSS,SP1,ASRCE,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      PTCDUDF7,XMODADM
            ENDIF
          ENDIF
          MATCH      SP70,XMODADM
          IF         @EQUAL
            MOVE      "3",XMODADM
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XMODADM,FORM1
          IF        FORM1<1 | FORM1>3 & FORM1<9
            MOVE      "E033",ERRCDE
            MOVE      "Mode of Admission is not 1, 2, 3 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Mode of Separation (34)
.
          MATCH     SP70,DDEST
          IF        !@EQUAL
            PACK      KEY5,ANSD,ANSD,DDEST,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
.              MOVE      TCINDC5,XMODSEP
              MOVE      PTCDUDF7,XMODSEP
            ENDIF
          ENDIF
.
. Referral Destination (Mental Health Care) (35) 
.
          MATCH     "1",MENTLFLG
          IF        @EQUAL
            MATCH     SP70,PMVXUDF8
            IF        !@EQUAL
              PACK      KEY5,ANSY,ANSF,PMVXUDF8,SP70
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      THCSCOD,XREFDES
              ENDIF 
            ENDIF
          ENDIF
.
. Weight (36)
.
MSTDB330  PACK      AGEDATE,ADATE,SP70
          CALL      CALCAGE
          IF        PSAGEDAY < 365
            MATCH     SP70,ABWGHT
            IF        !@EQUAL
              RJUSTIFY  ABWGHT
              UNPACK    ABWGHT,DIM2,XINFWEIG
              MOVE      ZERO,F4
              MOVE      XINFWEIG,F4
            ELSE
              MOVE      ZERO,F4
            ENDIF
            IF        F4 = ZERO
              MOVE      "F036",ERRCDE
              MOVE      "Admission Weight is blank and age < 365",ERRMSG1
              CALL      PRTLA000
            ENDIF
          ENDIF
.
. Intended Length of Hospital Stay (37)
.
          MATCH     SP70,PMVXIDUS
          IF        !@EQUAL
            PACK      KEY5,ANSV,ANSI,PMVXIDUS,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              UNPACK    THCSCOD,XILOHS
            ENDIF
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      XILOHS,FORM1
          IF        FORM1<1 | FORM1>2 & FORM1<9
            MOVE      "E037",ERRCDE
            MOVE      "Intended Length of Stay is not 1, 2 or 9",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Contracted Hospital Care Establishment Identifier (39)
.
          MOVE      SP70,XCNHSPC
.
. Inter-Hospital Contracted Patient Status (40)
.
          MATCH     SP70,ACLAIM
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              UNPACK    PTCDUDF8,XCNPTSTS
            ENDIF
          ENDIF
.
. Length of Stay in Intensive Care Unit      (41)
. Duration of Continuous Ventilatory Support (42)
. Length of Stay in Intensive Care Unit – Other (58)
.
MSTDB380  PACK      KEY8,DAADMNO,SP70
          CALL      RDPTICU1
          IF        OVRCD = 0
MSTDB382    MOVE      ZERO,F5
            MOVE      PTICUINT,F5
            MOVE      F5,F4
            MOVE      F4,XICUHRS
            MOVE      F4,XILOHSO
            MOVE      ZERO,F5
            MOVE      PTICUMEC,F5
            MOVE      F5,F4
            MOVE      F4,XVENHRS
          ENDIF
          REP       " 0",XICUHRS
          REP       " 0",XVENHRS
          REP       " 0",XILOHSO
.
. Establishment Identifier for Hospital Managing Waiting List (43)
.
          MOVE      SP70,XESTWATI
.
. Elective Surgery Waiting Times Cluster Procedure Array (44) [5]
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      SP70,XELSTAR[CNT]
          UNTIL       CNT = 5
.
. Procedure Code Array (45) [50]
.
MSTDB420  CALL      PROCAR00
.
. Diagnosis Code Array (46) [100]
.
MSTDB430  CALL      DIAGAR00
.
. Mental Health Episode Identifier (47)
.
          PACK      XMEHEPSI,SP70,SP70
. 
. Primary Impairment Type (48)
.
          CALL      IMPCD000
.
. Functional Independence Measure (FIM) Score Array (49) [18]
.
          CALL      FIMSCR00
.
. Resource Utilisation Groups – Activities of Daily Living (RUG-ADL) Total Score
. (50)
          MOVE      "99",XRSULGRP
. 
. Health of the Nation Outcome Scale 65 + (HoNOS 65+) Score Array (51) [12]
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "8",XNATOSAR[CNT]
          UNTIL       CNT = 12
.
. Standardised Mini-Mental State Examination (SMMSE) Score Array (52) [12]
.
          MOVE      ZERO,CNT
          REPEAT
            ADD       ONE,CNT
            MOVE      "8",XSTDMSAR[CNT]
          UNTIL       CNT = 12
.
. Palliative Care Linking Key (53) 
.
MSTDB500  MOVE      SP70,XPALCARL
.
. Quarter Indicator (54)
.
          MOVE      RUNQTRYR,XRUNQTR
.
. NWAU19 (55)
.
          MOVE      SP70,XNWAU19
.
. NWAU20 (56)
.
          MOVE      SP70,XNWAU20
.
. NWAU21 (57)
.
          MOVE      SP70,XNWAU21
.
. Theatre Presentation Date (58)
.
MSTDB580  MATCH     SP70,SPTEODTE
          IF        !@EQUAL
            UNPACK    SPTEODTE,XCENT,XYEAR,XMON,XDAY
            PACK      XOPRDAT,XDAY,XMON,XCENT,XYEAR
            REP       " 0",XOPRDAT
          ENDIF
.
          MOVE      SP70,TCINDC1 
          MATCH     SP70,ACLAIM
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
            CALL      RDCODE1
            IF        OVRCD = 1
              MOVE      SP70,TCINDC1
            ENDIF
          ENDIF
.
. Individual Healthcare Identifier (59) (60) (61)
.
          PACK      KEY31,DURNO,SP70
          CALL      RSPMAID1
MSTDB581  CALL      RKPMAID1 
          BRANCH    OVRCD,MSTDB582
          MATCH     DURNO,PMAIURNO
          IF        !@EQUAL
            GOTO      MSTDB583
          ENDIF
.
          PACK      KEY5,ANSA,ANSI,PMAITYPE
          CALL      RDCODE1
          BRANCH    OVRCD,MSTDB581
          MATCH     "I",TCINDC2
          GOTO      MSTDB582 IF NOT EQUAL
.
          SQUEEZE   PMAIALID
.
          PACK      XIHIID,PMAIALID,SP70
          PACK      XIHIRS,PMAIVSTA,SP70
          PACK      XIHINS,PMAIASTA,SP70
.
MSTDB582  MATCH     SP70,XIHIID
          IF        @EQUAL
            MOVE      "W059",ERRCDE
            MOVE      "IHI is blank.",ERRMSG1
            CALL      PRTLA000
          ELSE
            TYPE    XIHIID            * numeric ?
            IF      !@EQUAL
              MOVE      "E059",ERRCDE
              MOVE      "IHI is not a number.",ERRMSG1
              CALL      PRTLA000
            ENDIF
.
            MOVE      ZERO,FORM1
            SQUEEZE   XIHIRS
            MOVE      XIHIRS,FORM1
            IF        FORM1<1 | FORM1>3 & FORM1<9
              MOVE      "E060",ERRCDE
              MOVE      "IHI Record Status is not 1, 2, 3 or 9",ERRMSG1
              CALL      PRTLA000
            ELSE
              IF       FORM1=9
                MOVE      "W060",ERRCDE
                MOVE      "IHI Record Status is 9",ERRMSG1
                CALL      PRTLA000
              ENDIF
            ENDIF            
.
            MOVE      ZERO,FORM1
            SQUEEZE   XIHINS
            MOVE      XIHINS,FORM1
            IF        FORM1<1 | FORM1>5 & FORM1<9
              MOVE      "E061",ERRCDE
              MOVE      "IHI Number Status is not 1, 2, 3, 4, 5 or 9",ERRMSG1
              CALL      PRTLA000
            ELSE
              IF       FORM1=9
                MOVE      "W061",ERRCDE
                MOVE      "IHI Number Status is 9",ERRMSG1
                CALL      PRTLA000
              ENDIF
            ENDIF
          ENDIF
.
. For Public Contract Patient (56) (57) (58)
.
          MATCH     ANSP,TCINDC1
          GOTO      MSTDB800 IF NOT EQUAL
.
. Medicare Number (62) XMEDINO
.
MSTDB583  MATCH     SP70,PMEDI
          IF        !@EQUAL
            PACK      XMEDINO,PMEDI,SLASH,PTMXMCCD
          ENDIF 
.
. Invoice Number (63) XINVCNO
.
          MOVE      SP70,XIHIID
          MOVE      SP70,XIHIRS
          MOVE      SP70,XIHINS
.
          PACK      KEY16,DAADMNO,Z70
          CALL      RDSINV3
MSTDB584  CALL      RDPINV3
          BRANCH    OVRCD,MSTDB590
.
          MATCH     DAADMNO,DPINVADM
          GOTO      MSTDB590 IF NOT EQUAL
.
          MATCH     STRDATE,PINVDTE             * Invoice date < start date
          GOTO      MSTDB584 IF LESS
.
          MATCH     PINVDTE,STODATE             * Invoice date > end date
          GOTO      MSTDB584 IF LESS
.
          MOVE      PINVNO,XINVCNO
.
. Patient Name (65) XPATNAM
.
MSTDB590  PACK     KEY115,PURNO,SP70
          CALL     RSPTGSR1
MSTDB592  CALL     RKPTGSR1
          BRANCH   OVRCD,MSTDB800
.   
          MATCH     PURNO,GSRURNO
          GOTO      MSTDB800 IF NOT EQUAL
.
MSTDB593  STRIP     GSRGNAM
          STRIP     GSRSNAM 
          PACK      XPATNAM,GSRGNAM,SP1,GSRSNAM
.
. Number of Qualified Days for Newborns (22)
. Total Psychiatric Care Days (23)
. Total Number of Leave Days (30)
. Number of Days of Hospital in the Home Care (38)
.
MSTDB800  CALL      CLOS0000
.
MSTDB999  RETURN
.
.--------------------------------------------------------------------------
. Get Mental health patient flag
.--------------------------------------------------------------------------
MENTAL00  MOVE      ZERO,MENTLFLG  
          PACK      KEY8,DAADMNO
          CALL      RDMHVIS1
          IF        OVRCD = 0
            MOVE      ONE,MENTLFLG
          ENDIF
.
MENTAL99  RETURN
.
.--------------------------------------------------------------------------
. Get impairment code
.--------------------------------------------------------------------------
IMPCD000  MATCH     SP70,AFUNDH
          GOTO      IMPCD500 IF NOT EQUAL  
.
. No Health fund
.
IMPCD100  PACK      KEY31,AURNO,ATYPE,ACLAIM,SP6,SP3,DDATE,SP70
          CALL      RDPMAPG1
          IF        OVRCD=0
IMPCD110    MOVE      PMAGICDE,XPRIIMPT
            GOTO      IMPCD999
          ENDIF 
.
          CALL      RSPMAPG1
IMPCD200  CALL      RPPMAPG1
          BRANCH    OVRCD,IMPCD999
.
          MATCH     AURNO,PMAGURNO
          GOTO      IMPCD999 IF NOT EQUAL
.
          MATCH     ATYPE,PMAGATYP
          GOTO      IMPCD999 IF NOT EQUAL
.
          MATCH     ACLAIM,PMAGCLAM
          GOTO      IMPCD999 IF NOT EQUAL
.
          MATCH     SP70,PMAGFUND
          GOTO      IMPCD999 IF NOT EQUAL
.
          MATCH     SP70,PMAGTABT
          GOTO      IMPCD999 IF NOT EQUAL
.
IMPCD210  MATCH     SP70,PMAGEDAT
          IF        @EQUAL
            MOVE      PMAGICDE,XPRIIMPT
            GOTO      IMPCD999
          ENDIF
.
          MATCH     DDATE,PMAGEDAT
          IF        @LESS
IMPCD220    MOVE      PMAGICDE,XPRIIMPT
            GOTO      IMPCD999
          ENDIF
.
          GOTO      IMPCD999
.
IMPCD500  PACK      KEY14,AFUNDH,AFNDTB,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,IMPCD999
.
          MOVE      ACLAIM,SAVCLAIM
          MOVE      AFUNDH,SAVFUNDH
          MOVE      PTHFBCAT,SAVFUNDT
.
IMPCD510  PACK      KEY31,AURNO,ATYPE,SAVCLAIM,SAVFUNDH,SAVFUNDT,DDATE,SP70
          CALL      RDPMAPG1
          IF        OVRCD = 0
            MOVE      PMAGICDE,XPRIIMPT
            GOTO      IMPCD999
          ENDIF
.
          CALL      RSPMAPG1
IMPCD600  CALL      RPPMAPG1
          BRANCH    OVRCD,IMPCD700
.
          MATCH     AURNO,PMAGURNO
          GOTO      IMPCD700 IF NOT EQUAL
.
          MATCH     ATYPE,PMAGATYP
          GOTO      IMPCD700 IF NOT EQUAL
.
          MATCH     SAVCLAIM,PMAGCLAM
          GOTO      IMPCD700 IF NOT EQUAL
.
          MATCH     SAVFUNDH,PMAGFUND
          GOTO      IMPCD700 IF NOT EQUAL
.
          MATCH     SAVFUNDT,PMAGTABT
          GOTO      IMPCD700 IF NOT EQUAL
.
IMPCD610  MATCH     SP70,PMAGEDAT
          IF        @EQUAL
            MOVE      PMAGICDE,XPRIIMPT
            GOTO      IMPCD999
          ENDIF
.
          MATCH     DDATE,PMAGEDAT
          IF        @LESS
            MOVE      PMAGICDE,XPRIIMPT
            GOTO      IMPCD999
          ENDIF
.
          GOTO      IMPCD999
.
IMPCD700  MATCH     SP70,SAVFUNDH
          IF        !@EQUAL
            MOVE      SP70,SAVFUNDH
            MOVE      SP70,SAVFUNDT 
            GOTO      IMPCD510
          ENDIF
.
IMPCD999  RETURN
.
.--------------------------------------------------------------------------
. Validate care type
.--------------------------------------------------------------------------
VCARTY00  MOVE      X2CARETY,DIM2
          RJUSTIFY  DIM2
          REP       " 0",DIM2
          MOVE      ZERO,F2
          MOVE      DIM2,F2
.  
          IF        F2>0 & F2<8
            GOTO      VCARTY99
          ENDIF
.
          IF        F2>8 & F2<12
            GOTO      VCARTY99
          ENDIF 
.
          IF        F2=88 | F2=99
            GOTO      VCARTY99
          ENDIF
.
          MOVE      "F020",ERRCDE
          MOVE      "Care Type is not 1-7, 9-11, 88 or 99",ERRMSG1
          CALL      PRTLA000
.
VCARTY99  RETURN
.
.--------------------------------------------------------------------------
. Get procedure code array
.--------------------------------------------------------------------------
PROCAR00  MOVE      SP70,SPTEODTE
          MOVE      ZERO,COUNT
          PACK      KEY16,AADMNO,SP70
          CALL      RSPTECO2
PROCAR20  CALL      RKPTECO2
          BRANCH    OVRCD,PROCAR99
.
          MATCH     AADMNO,PTEOADMN
          GOTO      PROCAR99 IF NOT EQUAL
.
          MATCH     ANSO,PTEOTYPE                                      
          GOTO      PROCAR20 IF NOT EQUAL      
.
          MATCH     SP70,SPTEODTE
          IF        @EQUAL
            MOVE      PTEODATE,SPTEODTE
          ENDIF  
.
          MOVE      PTEOCODE,KEY9
          CALL      RDPTICO1
          BRANCH    OVRCD,PROCAR20
.
          COMPARE   ONE,ICDRDVER            * ICD9?
          IF        @EQUAL
            PACK      KEY9,OICD10CD,SP70    * ICD10 code
          ENDIF
.
PROCAR30  ADD       ONE,COUNT
          MOVE      KEY9,XPROCAR[COUNT]
.
          COMPARE   "50",COUNT
          GOTO      PROCAR20 IF LESS
.
PROCAR99  RETURN
.
.--------------------------------------------------------------------------
. Get diagnosis code array
.--------------------------------------------------------------------------
DIAGAR00  MOVE      ZERO,FSTCODE
          MOVE      ZERO,COUNT
          PACK      KEY16,AADMNO,SP70
          CALL      RSPTECD2
DIAGAR20  CALL      RKPTECD2
          BRANCH    OVRCD,DIAGAR99
.
          MATCH     AADMNO,PTEDADMN
          GOTO      DIAGAR99 IF NOT EQUAL
.
          MOVE      PTEDCODE,KEY9
          MOVE      PTEDOSET,KEY1
.
          CALL      RDPTICD1              * Read ICD Disease file
          BRANCH    OVRCD,DIAGAR20
          COMPARE   ONE,ICDRDVER          * ICD9?
          GOTO      DIAGAR20 IF EQUAL     * Yes, skip this record
.
.          CMATCH    CMDISP,PTEDTYPE
.          GOTO      DIAGAR20 IF NOT EQUAL
.
DIAGAR30  ADD       ONE,COUNT
          PACK      XDIAGAR[COUNT],KEY1,KEY9,SP70
.
          COMPARE   "100",COUNT
          GOTO      DIAGAR20 IF LESS
.
DIAGAR99
.
.-----------------------------------------------------------------------------
. Get the FIM array
.-----------------------------------------------------------------------------
FIMSCR00  MOVE      ZERO,COUNT
          MOVE      ZERO,EATSCNT          
          MOVE      ZERO,GRMSCNT
          MOVE      ZERO,BTHSCNT
          MOVE      ZERO,UPBSCNT
          MOVE      ZERO,LWBSCNT
          MOVE      ZERO,TLTSCNT
          MOVE      ZERO,BLMSCNT
          MOVE      ZERO,BWMSCNT
          MOVE      ZERO,TBDSCNT
          MOVE      ZERO,TTLSCNT
          MOVE      ZERO,TBTSCNT
          MOVE      ZERO,LOCSCNT
          MOVE      ZERO,STRSCNT
          MOVE      ZERO,COMSCNT
          MOVE      ZERO,EXPSCNT
          MOVE      ZERO,SCISCNT
          MOVE      ZERO,PRBSCNT
          MOVE      ZERO,MEMSCNT
.
          PACK      KEY24,DAADMNO,STRDATE,SP70
          CALL      RSPTFIM1
FIMSCR20  CALL      RKPTFIM1
          BRANCH    OVRCD,FIMSCR80               
.
          MATCH     DAADMNO,PTFIVISN
          GOTO      FIMSCR80 IF NOT EQUAL
.
          MATCH     PTFIDATE,ENDDATE
          GOTO      FIMSCR80 IF LESS
.
          MATCH     "1",PTFIDELT
          GOTO      FIMSCR20 IF EQUAL
.
          MATCH     "A",PTFITYPE                 * No Adm FIM exists
          GOTO      FIMSCR20 IF NOT EQUAL
.
FIMSCR50  ADD       PTFIEATS,EATSCNT
          ADD       PTFIGRMS,GRMSCNT
          ADD       PTFIBTHS,BTHSCNT
          ADD       PTFIUPBS,UPBSCNT
          ADD       PTFILWBS,LWBSCNT
          ADD       PTFITLTS,TLTSCNT
          ADD       PTFIBLMS,BLMSCNT
          ADD       PTFIBWMS,BWMSCNT
          ADD       PTFITBDS,TBDSCNT
          ADD       PTFITTLS,TTLSCNT
          ADD       PTFITBTS,TBTSCNT
          ADD       PTFILOCS,LOCSCNT
          ADD       PTFISTRS,STRSCNT
          ADD       PTFICOMS,COMSCNT
          ADD       PTFIEXPS,EXPSCNT
          ADD       PTFISCIS,SCISCNT
          ADD       PTFIPRBS,PRBSCNT
          ADD       PTFIMEMS,MEMSCNT
.
          ADD       ONE,COUNT 
          GOTO      FIMSCR20
.
FIMSCR80  IF        COUNT = ZERO
            MOVE      ZERO,CNT
            REPEAT
              ADD       ONE,CNT
              MOVE      "9",XFIMSAR[CNT]
            UNTIL       CNT = 18
            GOTO      FIMSCR99
          ENDIF
.
          MOVE      EATSCNT,XFIMSAR[1]
          MOVE      GRMSCNT,XFIMSAR[2]
          MOVE      BTHSCNT,XFIMSAR[3]
          MOVE      UPBSCNT,XFIMSAR[4]
          MOVE      LWBSCNT,XFIMSAR[5]
          MOVE      TLTSCNT,XFIMSAR[6]
          MOVE      BLMSCNT,XFIMSAR[7]
          MOVE      BWMSCNT,XFIMSAR[8]
          MOVE      TBDSCNT,XFIMSAR[9]
          MOVE      TTLSCNT,XFIMSAR[10]
          MOVE      TBTSCNT,XFIMSAR[11]
          MOVE      LOCSCNT,XFIMSAR[12]
          MOVE      STRSCNT,XFIMSAR[13]
          MOVE      COMSCNT,XFIMSAR[14]
          MOVE      EXPSCNT,XFIMSAR[15]
          MOVE      SCISCNT,XFIMSAR[16]
          MOVE      PRBSCNT,XFIMSAR[17]
          MOVE      MEMSCNT,XFIMSAR[18]
.
FIMSCR99  RETURN
.
.--------------------------------------------------------------------------
. Calculate The LOS For This Patient    
.--------------------------------------------------------------------------
CLOS0000  MOVE      ZERO,WORKHITH           * Initialise HITH care days
          MOVE      ZERO,WORKICLS           * Initialise ICU LOS
          MOVE      ZERO,WORKLDAY           * Initialise leave days
          MOVE      ZERO,WORKPSYC           * Initialise psychiatric days
          MOVE      ZERO,PSYCFLAG           * Initialise psych flag
          MOVE      ZERO,ADMPFLAG
          MOVE      ZERO,WORKQUAL           * Initialise qualified days
          MOVE      ACLSSFT,DEPTYPE
.
. ----- Daycase -----
.
          MATCH     ADATE,DDATE
          IF        @EQUAL
            PACK      KEY30,AADMNO,SP30
            CALL      RDSTRAN2              * Position on & read the transfer
            CALL      RDKTRAN2                file
.           IF        OVRCD = 0 & AADMNO=TADMN
            IF        OVRCD = 0
             MATCH     AADMNO,TADMN
             IF        @EQUAL
              MOVE      TRBTYP,BEDTYPE
              CALL      CPSY0000            * Check for psychiatric care
              IF        EXIT=1
                MOVE      ONE,WORKPSYC
                MOVE      ZERO,EXIT
              ENDIF
             ENDIF
            ENDIF
.
            PACK      KEY30,AADMNO,SP30
            CALL      RDSTRAN2              * Position on & read the transfer
CLOS0500    CALL      RDKTRAN2                file
.           IF        OVRCD = 0 & AADMNO=TADMN
            IF        OVRCD = 0
             MATCH     AADMNO,TADMN
             IF        @EQUAL
.
              CMATCH    ANSR,TMOVE
              GOTO      CLOS0550 IF EQUAL
.
              CMATCH    ANSC,TMOVE
              GOTO      CLOS0550 IF EQUAL
.
              GOTO      CLOS0500
.
CLOS0550      MOVE      TRBTYP,BEDTYPE
              CALL      CPSY0000            * Check for psychiatric care
              IF        EXIT=1
                MOVE      ONE,WORKPSYC
                MOVE      ZERO,EXIT
              ENDIF
.
             ENDIF
            ENDIF
.
CLOS0600    PACK      KEY30,AADMNO,ZED30
            CALL      RDSTRAN2              * Position on & read the transfer
            CALL      RDPTRAN2                file
.           IF        OVRCD=0 & AADMNO=TADMN
            IF        OVRCD = 0
             MATCH     AADMNO,TADMN
             IF        @EQUAL
              MOVE      TATYPE,ADMTYPE
              MOVE      TDEPT,DEPTYPE
              MOVE      TRBTYP,BEDTYPE
              CALL      CHKC0000            * Check a stay in a ICU
              IF        EXIT=1
                MOVE      ONE,WORKICLS
                MOVE      ZERO,EXIT
              ENDIF
              CALL      CPSY0000            * Check for psychiatric care
              IF        EXIT=1
                MOVE      ONE,WORKPSYC
                MOVE      ZERO,EXIT
              ENDIF
              CALL      CQNB0000            * Check for qualified care
              IF        EXIT=1
                MOVE      ONE,WORKQUAL
                MOVE      ZERO,EXIT
              ENDIF
              CALL      CHIHA000            * Check for hospital in the home
              IF        EXIT=1
                MOVE      ONE,WORKHITH
                MOVE      ZERO,EXIT
              ENDIF
             ENDIF 
            ENDIF
            GOTO      CLOS9000
          ENDIF
.
. ----- Non Daycase -----
.
          PACK      KEY30,AADMNO,SP20
          CALL      RDSTRAN2                * Position on & read the transfer
CLOS1000  CALL      RDKTRAN2                  file
          IF        OVRCD = 1
            GOTO      CLOS7000              * Error
          ENDIF
          MATCH     AADMNO,TADMN
          IF        !@EQUAL
            GOTO      CLOS7000              * Error
          ENDIF
.
          CMATCH    ANSA,TMOVE
          GOTO      CLOS2000 IF EQUAL       * Admission record
.
          CMATCH    ANSL,TMOVE
          GOTO      CLOS3000 IF EQUAL       * Leave record
.
          CMATCH    ANSR,TMOVE
          GOTO      CLOS4000 IF EQUAL       * Return from leave record
.
          CMATCH    ANSC,TMOVE
          GOTO      CLOS5000 IF EQUAL       * Change record
.
          CMATCH    ANSD,TMOVE
          GOTO      CLOS6000 IF EQUAL       * Discharge record
.
          GOTO      CLOS5000                * Assume change record
.
. ----- Admission Record -----
.
CLOS2000  CALL      LSAV0000                * Save details
          GOTO      CLOS1000
.
. ----- Leave Record -----
.
CLOS3000  CALL      LEND0000                * Process end of a period
          GOTO      CLOS1000
.
. ----- Return Record -----
.
CLOS4000  CALL      LDAY0000                * Calculate the leave days
          CALL      LSAV0000                * Save details
          GOTO      CLOS1000
.
. ----- Change Record -----
.
CLOS5000  CALL      LEND0000                * Process end of a period
          CALL      LSAV0000                * Save new details
          GOTO      CLOS1000
.
. ----- Discharge Record -----
.
CLOS6000  CALL      LEND0000                * Process end of a period
          GOTO      CLOS9000
.
. ----- Error -----
.
CLOS7000  MOVE      DDATE,TDATE             * Assume discharge date
          CALL      LEND0000                * Process end of a period
          GOTO      CLOS9999
.
. ----- Finished -----
.
. Total Number of Leave Days (27)
. 
CLOS9000  MOVE      WORKLDAY,X5LEAVDY       * Total leave days 
          MATCH     SP70,X5LEAVDY
          IF        @EQUAL
            MOVE      "F027",ERRCDE
            MOVE      "Total Number of Leave Days is non-numeric",ERRMSG1
            CALL      PRTLA000
          ENDIF
.
. Number of Qualified Days for Newborns (21)
.
          PACK      KEY5,ANSC,ANSC,ACARE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      PTCDNHCP,DIM1
            MATCH     "7",DIM1
            IF        @EQUAL
              IF        WORKQUAL = ZERO
                MOVE      "F021",ERRCDE
                MOVE      "No. of Qual Days for Newborns is non-numeric",ERRMSG1
                CALL      PRTLA000
              ELSE
                MOVE      WORKQUAL,XQLFDAYS
              ENDIF
            ENDIF
          ENDIF
.
. Number of Days of Hospital in the Home Care (35)
.
          MOVE      WORKHITH,XHIHCDAY       * hospital in the home care days
.
. Total Psychiatric Care Days (22)
.
CLOS9002  PACK      KEY5,ANSC,ANSC,ACARE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CLOS9999
.
          MOVE      THCSCOD,DIM2
          MATCH     "11",DIM2
          GOTO      CLOS9999 IF NOT EQUAL
.
          IF        WORKPSYC = 0
            IF        PSYCFLAG = 1
              MOVE      ONE,WORKPSYC        * patient had some psych stay
            ENDIF
          ENDIF
.
          MOVE      WORKPSYC,XPSYCDAY       * Psychiatric days
.
.
CLOS9999  RETURN
+
.--------------------------------------------------------------------------
. Save Start Of Period Details For Length Of Stay Calculations
.--------------------------------------------------------------------------
LSAV0000  PACK      CDYSFDTE,TDATE
          MOVE      TATYPE,STATYPE
          MOVE      TRBTYP,STRBTYP
.
          MATCH     "A",TMOVE
          IF        @EQUAL
            PACK      SVADDATE,TDATE
.
            MATCH     SP3,TRBTYP
            GOTO      LSAV9999 IF EQUAL        * Dont allow blank codes
.
            PACK      KEY5,ANSB,ANST,TRBTYP    * first check for any psych days
            CALL      RDCODE1
            BRANCH    OVRCD,LSAV9999
.
            MATCH     ANSA,TCINDC3
            IF        @EQUAL
              MOVE      ONE,ADMPFLAG           * patient has psych care
            ENDIF
            MATCH     ANSD,TCINDC3
            IF        @EQUAL
              MOVE      ONE,ADMPFLAG           * patient has psych care
            ENDIF
          ENDIF
.
LSAV9999  RETURN
+
.--------------------------------------------------------------------------
. Process End Of Period Details For Length Of Stay 
.--------------------------------------------------------------------------
LEND0000  PACK      CDYSTDTE,TDATE
.
LEND1000  CALL      CALCDAYS                * Calculate diff between dates
          SUB       ONE,CDYSDAYS            * We dont want inclusive dates
          MOVE      STATYPE,ADMTYPE
          MOVE      TDEPT,DEPTYPE
          MOVE      STRBTYP,BEDTYPE
          CALL      CHKC0000                * Check if stay in a ICU
          IF        EXIT=1
            ADD       CDYSDAYS,WORKICLS
            MOVE      ZERO,EXIT
          ENDIF
.
          CALL      CPSY0000                * Check for psychiatric care
          IF        EXIT=1
            ADD       CDYSDAYS,WORKPSYC
            IF        WORKPSYC = 0
              CMATCH    ANSC,TMOVE          * Check if it's not a change rec
              IF        !@EQUAL
                CMATCH    ANSL,TMOVE        * Check if it's not a leave rec
                IF        !@EQUAL
                  ADD       ONE,WORKPSYC    * at least 1 psych day
                ENDIF
              ELSE
                IF        PSYCFLAG=0
                  MOVE      ZERO,WORKPSYC
                ENDIF
              ENDIF
            ENDIF
            MOVE      ZERO,EXIT
          ELSE
            CMATCH    ANSC,TMOVE
            IF        @EQUAL
              IF        PSYCFLAG=1
                MATCH     TDATE,SVADDATE
                IF        @EQUAL
                  MOVE      ZERO,WORKPSYC
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          CMATCH    ANSD,TMOVE
          IF        @EQUAL
            IF        ADMPFLAG = 1
              IF        WORKPSYC = 0
                MOVE      ONE,WORKPSYC
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CQNB0000                * Check for qualified new born
          IF        EXIT=1
            ADD       CDYSDAYS,WORKQUAL
            MOVE      ZERO,EXIT
          ENDIF
.
          CALL      CHIHA000                * Check for hospital in the home
          IF        EXIT=1
            ADD       CDYSDAYS,WORKHITH
            MOVE      ZERO,EXIT
          ENDIF
.
LEND9000  MOVE      TDATE,STDATE            * Save transfer date for leave days
LEND9999  RETURN
+
.--------------------------------------------------------------------------
. Calculate The Leave Days    
.--------------------------------------------------------------------------
LDAY0000  PACK      CDYSFDTE,STDATE
          PACK      CDYSTDTE,TDATE
          MATCH     CDYSTDTE,CDYSFDTE
          GOTO      LDAY9999 IF NOT LESS
.
          CALL      CALCDAYS                * Calculate diff between dates
          SUB       ONE,CDYSDAYS            * We dont want inclusive dates
          ADD       CDYSDAYS,WORKLDAY       * Total leave days
.
          MATCH     STDATE,ADATE
          IF        @EQUAL
.           SUB       ONE,WORKLDAY          * don't count adm.date - CAR 291926
          ENDIF
.
          COMPARE   ZERO,WORKLDAY
          GOTO      LDAY9999 IF EQUAL       * not a leave period - CAR 291926
.
          COMPARE   NINTY9,NUMLEV
          GOTO      LDAY9999 IF EQUAL       * don't increase for more than 99
.
          ADD       ONE,NUMLEV
.
LDAY9999  RETURN
+
.--------------------------------------------------------------------------
. Check For A Stay In A Critical Care Unit   
.--------------------------------------------------------------------------
CHKC0000  MOVE      ZERO,EXIT               * Default normal/HDU bed stay
          IF        PTCNHCCC=1
            MATCH     SP3,BEDTYPE
            GOTO      CHKC9999 IF EQUAL     * Dont allow blank codes
.
            PACK      KEY5,ANSB,ANST,BEDTYPE   * Using bed type for CCU/ICU
            CALL      RDCODE1
            BRANCH    OVRCD,CHKC9999
.
            MATCH     ANSI,TCINDC1
            GOTO      CHKC9999 IF NOT EQUAL * Not an CCU/ICU stay
          ELSE
            MATCH     SP3,ADMTYPE
            GOTO      CHKC9999 IF EQUAL     * Dont allow blank codes
.
            PACK      KEY5,ANSA,SP1,ADMTYPE    * Using admin type for CCU/ICU
            CALL      RDCODE1
            BRANCH    OVRCD,CHKC9999
.
            COMPARE   ONE,TCFORM6
            GOTO      CHKC9999 IF NOT EQUAL * Not an CCU/ICU stay
          ENDIF
          MOVE      ONE,EXIT                * CCU/ICU stay (not HDU)
CHKC9999  RETURN
+
.--------------------------------------------------------------------------
. Check For Psychiatric care (use category BT) 
.--------------------------------------------------------------------------
CPSY0000  MOVE      ZERO,EXIT                * Default normal/HDU bed stay
          MATCH     SP3,TRBTYP
          GOTO      CPSY9999 IF EQUAL        * Dont allow blank codes
.
          PACK      KEY5,ANSB,ANST,TRBTYP    * first check for any psych days
          CALL      RDCODE1
          BRANCH    OVRCD,CPSY9999
.
          MATCH     ANSA,TCINDC3
          IF        @EQUAL
            MOVE      ONE,PSYCFLAG           * patient has psych care
          ENDIF
          MATCH     ANSD,TCINDC3
          IF        @EQUAL
            MOVE      ONE,PSYCFLAG           * patient has psych care
          ENDIF
.
CPSY8000  MATCH     SP3,BEDTYPE
          GOTO      CPSY9999 IF EQUAL        * Dont allow blank codes
.
          PACK      KEY5,ANSB,ANST,BEDTYPE   * now check for period psych days
          CALL      RDCODE1
          BRANCH    OVRCD,CPSY9999
.
          MATCH     ANSA,TCINDC3
          GOTO      CPSY9000 IF EQUAL        * psychiatric care
.
          MATCH     ANSD,TCINDC3
          GOTO      CPSY9999 IF NOT EQUAL    * Not psychiatric care
.
CPSY9000  MOVE      ONE,EXIT
CPSY9999  RETURN
+
.--------------------------------------------------------------------------
. Check For Qualified new born  
.--------------------------------------------------------------------------
CQNB0000  MOVE      ZERO,EXIT
          MATCH     SP3,ADMTYPE
          GOTO      CQNB9999 IF EQUAL     * Dont allow blank codes
.
          PACK      KEY5,ANSA,SP1,ADMTYPE    * Using admin type for qualified
          CALL      RDCODE1
          BRANCH    OVRCD,CQNB9999
.
.          MATCH     "1",THCSCOD
.          GOTO      CQNB9000 IF EQUAL       * Qualified
.
.          MATCH     "9",THCSCOD
.          GOTO      CQNB9000 IF EQUAL       * Qualified 
.
          MATCH     "Q",THCSCOD
          GOTO      CQNB9000 IF EQUAL       * Qualified
.
          GOTO      CQNB9999                * Not qualified
.
CQNB9000  MOVE      ONE,EXIT
CQNB9999  RETURN
+
.--------------------------------------------------------------------------
. Check For Hospital In The Home
.--------------------------------------------------------------------------
CHIHA000  MATCH     SP3,BEDTYPE
          GOTO      CHIHA999 IF EQUAL        * Dont allow blank codes
.
          PACK      KEY5,ANSB,ANST,BEDTYPE   * Using bed type
          CALL      RDCODE1
          BRANCH    OVRCD,CHIHA999
.
          MATCH     ANSH,TCINDC1
          GOTO      CHIHA999 IF NOT EQUAL    * Not hospital in the home
.
          MOVE      ONE,EXIT
.
CHIHA999  RETURN
+
.--------------------------------------------------------------------------
. Calculate contracted leave days
.--------------------------------------------------------------------------
PRSCLW00  MOVE      ZERO,NBRDAYS
          UNPACK    SP30,CDYSFDTE,CDYSTDTE  * Clear the from date & to date
.
. ----- Loop thru the leave records looking for reqd Leave records -----
.
          PACK      KEY30,AADMNO,SP30
          CALL      RDSTRAN2                * Position on & read the transfer
PRSCLW10  CALL      RDKTRAN2                  file
          BRANCH    OVRCD,PRSCLW20
.
          MATCH     AADMNO,TADMN
          GOTO      PRSCLW20 IF NOT EQUAL   * Different admission number
.
          MATCH     TDATE,TODATE
          GOTO      PRSCLW20 IF LESS        * end of Tran records
.
. ----- Only looking for "L" records -----
.
          MATCH     "L",TMOVE
          GOTO      PRSCLW10 IF NOT EQUAL   * some other record
.
. ----- Leave record found -----
.
          PACK      KEY5,ANST,ANSL,PTTRLTYP
          CALL      RDCODE1                 * Read the codes file
          BRANCH    OVRCD,PRSCLW10
.
          MATCH     ANSC,THCSCOD
          GOTO      PRSCLW10 IF NOT EQUAL   * Not "contracted"
.
          MATCH     FROMDATE,TDATE
          IF        @LESS
            PACK      CDYSFDTE,FROMDATE     * Set up from date
          ELSE
            PACK      CDYSFDTE,TDATE        * Set up from date
          ENDIF
.
.
. ----- Get the return record from the transfer file -----
.
          CALL      RDKTRAN2                * Read the next transfer record
          BRANCH    OVRCD,PRSCLW20
.
          MATCH     AADMNO,TADMN
          GOTO      PRSCLW20 IF NOT EQUAL   * Different admission number
.
          MATCH     "R",TMOVE
          GOTO      PRSCLW20 IF NOT EQUAL   * Return record
.
. ----- Return record found -----
.
          MATCH     TDATE,TODATE            * C-53489 setup todate
          IF        @LESS
            PACK      CDYSTDTE,TODATE        * Set up to date
          ELSE
            PACK      CDYSTDTE,TDATE        * I-53489
          ENDIF
          CALL      CALCU000              * Calculate diff between 2 dates
.
          UNPACK    SP30,CDYSFDTE,CDYSTDTE  * Clear the from date & to date
          GOTO      PRSCLW10
.
. ----- Record out of date range, work out contract leave days -----
.
PRSCLW20  MATCH     SP8,CDYSFDTE
          GOTO      PRSCLW90 IF EQUAL       * Not a leave record, exit
.
          PACK      CDYSTDTE,TODATE         * Set up to date
          CALL      CALCU000                * Calculate diff between 2 dates
.
PRSCLW90  MOVE      ZERO,EXIT
PRSCLW99  RETURN
+
.--------------------------------------------------------------------------
. Calculate Difference Between 2 Dates  
.--------------------------------------------------------------------------
CALCU000  REP       " 0",CDYSFDTE
          REP       " 0",CDYSTDTE
          MATCH     CDYSFDTE,CDYSTDTE
          GOTO      CALCU100 IF LESS        * To date < from date, exit
.
          CALL      CALCDAYS                * Calculate diff between 2 dates
          SUB       ONE,CDYSDAYS            * We dont want inclusive dates
          ADD       CDYSDAYS,NBRDAYS        * Accumulate contract leave days
          GOTO      CALCU900
.
. ----- Error with the dates, set to zero -----
.
CALCU100  MOVE      ZERO,NBRDAYS
.
CALCU900  MOVE      ZERO,EXIT
CALCU999  RETURN
.
          INC       STD001IO
          INC       NHOSPDAY
          INC       CALCAGE
          INC       CALCDAYS
          INC       PATGILOS
          INC       PATHSPKY
          INC       SEXDSCIO
.
          INC       IBAPOSIO/INC
          INC       OPRDEAIO/INC
          INC       PATCHCIO/INC
          INC       PATCODIO/INC
          INC       PATCT1IO/INC
          INC       PATDSCIO/INC
          INC       PATDADIO/INC            * I-54733
          INC       PATVADIO/INC
          INC       PATECOIO/INC
          INC       PATECDIO/INC
          INC       PATICUIO/INC
          INC       PATFIMIO/INC
          INC       PATFN1IO/INC
          INC       PATGSRIO/INC
          INC       PATICDIO/INC
          INC       PATICOIO/INC
          INC       PATINVIO/INC
          INC       PATHSPIO/INC
          INC       PATDO1IO/INC
          INC       PATMA1IO/INC
          INC       PATQRDIO/INC
          INC       PMSAIDIO/INC
          INC       PMSPX2IO/INC
          INC       PATMI1IO/INC
          INC       PATPGRIO/INC
          INC       PATTRNIO/INC
          INC       PATWR1IO/INC
          INC       PATVISIO/INC
          INC       PATASFIO/INC
          INC       PMSAPGIO/INC
          INC       PMSVX1IO/INC
          INC       MEHLEGIO/INC
          INC       MEHVI1IO/INC
          INC       MEHDS1IO/INC

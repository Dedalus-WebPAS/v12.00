. *----------------------------------------------------------------------
. * Include Name  :   NZPPFETM.PBL
. *
. * Function      :   Common CGI functions for 
. *                   NZ Private Contract Procedure Fee
. *
. * Modifications :
. *
.------------------------------------------------------------------------
. V11.05.01 24/09/2025  J.Tan          TSK 0966921
.           Mod to use tempfiles for Revenue & Invoice breakdown
. V11.04.01 26/06/2024  Thanh T       TSK 0947684
.           Changed NZPPTB00 to display the number of rows depending on
.           system parameter
.------------------------------------------------------------------------
. * V9.08.02  28/11/2006 Ebon Clements  CAR 126035
. *           Fixed filter tests in NZPPTB00
. * V9.08.01  20/10/2006 Ebon Clements  CAR 120001
. *           Added copy cgi vars
. * V9.08.00  26/10/2006 Ebon Clements  CAR 120001
. *           Created Include
. *----------------------------------------------------------------------
.------------------------------------------------------------------------
.   Clear CGI Parameters for NZPPFEFD
.------------------------------------------------------------------------
CPNZPF00  MOVE      SP70,NZPFE001
          MOVE      SP70,NZPFE002
          MOVE      SP70,NZPFE003
          MOVE      SP70,NZPFE004
          MOVE      SP70,NZPFE005
          MOVE      SP70,NZPFE006
          MOVE      SP70,NZPFE007
          MOVE      SP70,NZPFE008
          MOVE      SP70,NZPFE009
          MOVE      SP70,NZPFE010
          MOVE      SP70,NZPFE011
          MOVE      SP70,NZPFE012
          MOVE      SP70,NZPFE013
.
          MOVE      SP70,CPPFE001
          MOVE      SP70,CPPFE002
          MOVE      SP70,CPPFE003
          MOVE      SP70,CPPFE004
          MOVE      SP70,CPPFE005
          MOVE      SP70,CPPFE006
.
CPNZPF99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for NZPPFEFD
.------------------------------------------------------------
SPNZPF00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPNZPF01,SPNZPF02,SPNZPF03,SPNZPF04,SPNZPF05:
                       SPNZPF06,SPNZPF07,SPNZPF08,SPNZPF09,SPNZPF10:
                       SPNZPF11,SPNZPF12,SPNZPF13
.
          MOVE      ONE,EXIT
          GOTO      SPNZPF99
.
SPNZPF01  PACK      NZPFE001,QRYDATA,SP70
          GOTO      SPNZPF99
.
SPNZPF02  PACK      NZPFE002,QRYDATA,SP70
          GOTO      SPNZPF99
.
SPNZPF03  PACK      NZPFE003,QRYDATA,SP70
          GOTO      SPNZPF99
.
SPNZPF04  PACK      NZPFE004,QRYDATA,SP70
          GOTO      SPNZPF99
.
SPNZPF05  PACK      NZPFE005,QRYDATA,SP70
          GOTO      SPNZPF99
.
SPNZPF06  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      NZPFE006,CCENT,CYEAR,CMON,CDAY
          GOTO      SPNZPF99
.
SPNZPF07  MOVE      QRYDATA,NZPFE007
          GOTO      SPNZPF99
.
SPNZPF08  MOVE      QRYDATA,NZPFE008
          SQUEEZE   NZPFE008
          GOTO      SPNZPF99
.
SPNZPF09  MOVE      QRYDATA,NZPFE009
          SQUEEZE   NZPFE009
          GOTO      SPNZPF99
.
SPNZPF10  MOVE      QRYDATA,NZPFE010
          GOTO      SPNZPF99
.
SPNZPF11  MOVE      QRYDATA,NZPFE011
          GOTO      SPNZPF99
.
SPNZPF12  MOVE      QRYDATA,NZPFE012
          SQUEEZE   NZPFE012
          GOTO      SPNZPF99
.
SPNZPF13  MOVE      QRYDATA,NZPFE013
          SQUEEZE   NZPFE013
          GOTO      SPNZPF99
.
SPNZPF99  RETURN
.
.------------------------------------------------------------
. Output NZPPFEFD Fields
.------------------------------------------------------------
NZPF0000  BRANCH    FLDITMNO,NZPF0100,NZPF0200,NZPF0300,NZPF0400,NZPF0500:
                             NZPF0600,NZPF0700,NZPF0800,NZPF0900,NZPF1000:
                             NZPF1100,NZPF1200,NZPF1300,NZPF1400,NZPF1500:
                             NZPF1600,NZPF1700,NZPF1800,NZPF1900,NZPF2000:
                             NZPF2100,NZPF2200,NZPF2300,NZPF2400,NZPF2500:
                             NZPF2600,NZPF2700,NZPF2800,NZPF2900,NZPF3000:
                             NZPF3100,NZPF3200,NZPF3300,NZPF3400,NZPF3500
.         
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      NZPF9999
.
NZPF0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          COMPARE   ONE,IBCNMHOS
          GOTO      NZPF9999 IF NOT EQUAL
.         
          BRANCH    F1,NZPF0110,NZPF0120
.
          PACK      KEY3,NZPFHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,NZPF9999
.
          WRITE     HTMLFILE;PTHSNAME;           * hospital name
          GOTO      NZPF9999
.
NZPF0110  WRITE     HTMLFILE;NZPFHOSP;           * hospital code
          GOTO      NZPF9999
.
NZPF0120  MOVE      NZPFHOSP,DIM3
          CALL      NZPH0000                     * hospital selectin list
          GOTO      NZPF9999
.
NZPF0200  MOVE      "CL",CATEGORY                * claim code
          MOVE      NZPFCLMC,CODE
          CALL      CODITM00
          GOTO      NZPF9999
.
NZPF0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,NZPF0310
.
          WRITE     HTMLFILE;NZPFCNTR;           * health fund code
          GOTO      NZPF9999
.
NZPF0310  PACK      KEY14,NZPFCNTR,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;           * health fund description
          ELSE
            WRITE     HTMLFILE;NZPFCNTR;         * health fund code
          ENDIF
          GOTO      NZPF9999
.
NZPF0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,NZPF0410
.
          WRITE     HTMLFILE;NZPFFTAB;           * table code
          GOTO      NZPF9999
.
NZPF0410  PACK      KEY14 WITH NZPFCNTR,NZPFFTAB,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;           * description of Table
          ELSE
            WRITE     HTMLFILE;NZPFFTAB;         * table code
          ENDIF
          GOTO      NZPF9999
.
NZPF0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZPF0510
          WRITE     HTMLFILE;NZPFCPRC;      * Casemix Code
          GOTO      NZPF9999
.
NZPF0510  MATCH     SP70,NZPFCPRC
          GOTO      NZPF9999 IF EQUAL
.
          PACK      KEY9,NZPFCPRC,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,NZPF9999
          WRITE     HTMLFILE;PTCADES1;      * Casemix Code Desc
          GOTO      NZPF9999
.
NZPF0600  MATCH     SP70,NZPFEFDT
          GOTO      NZPF9999 IF EQUAL
.
          UNPACK    NZPFEFDT,CCENT,CYEAR,CMON,CDAY * effective date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZPF9999
.
NZPF0700  WRITE     HTMLFILE;NZPFCONT;           * maximum funder cont
          GOTO      NZPF9999
.
NZPF0800  WRITE     HTMLFILE;NZPFHPOR;           * health fund portion
          GOTO      NZPF9999
.
NZPF0900  WRITE     HTMLFILE;NZPFPPOR;           * patient portion
          GOTO      NZPF9999
.
NZPF1000  WRITE     HTMLFILE;NZPFDES1;           * description 1
          GOTO      NZPF9999
.
NZPF1100  WRITE     HTMLFILE;NZPFDES2;           * description 2
          GOTO      NZPF9999
.
NZPF1200  WRITE     HTMLFILE;NZPFRBRK;           * revenue breakdown
          GOTO      NZPF9999
.
NZPF1300  WRITE     HTMLFILE;NZPFIBRK;           * invoice creakdown
          GOTO      NZPF9999
.
NZPF1400  MATCH     NZPFCDAT,SP70
          GOTO      NZPF9999 IF EQUAL
.
          UNPACK    NZPFCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZPF9999
.
NZPF1500  WRITE     HTMLFILE;NZPFCTIM;
          GOTO      NZPF9999
.
NZPF1600  MATCH     SP70,NZPFCUID
          GOTO      NZPF9999 IF EQUAL
.
          PACK      KEY10,NZPFCUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      NZPFCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      NZPF9999
.
NZPF1700  MATCH     NZPFUDAT,SP70
          GOTO      NZPF9999 IF EQUAL
.
          UNPACK    NZPFUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZPF9999
.
NZPF1800  WRITE     HTMLFILE;NZPFUTIM;
          GOTO      NZPF9999
.
NZPF1900  MATCH     SP70,NZPFUUID
          GOTO      NZPF9999 IF EQUAL
.
          PACK      KEY10,NZPFUUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      NZPFUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      NZPF9999
.
NZPF2000  CALL      NZPPTB00                     * list nz priv proc fee
          GOTO      NZPF9999
.
NZPF2100  CALL      NXTNZP00                     * next nz priv proc fee
          GOTO      NZPF9999
.
NZPF2200  CALL      PRVNZP00                     * prev nz priv proc fee
          GOTO      NZPF9999
.
NZPF2300  WRITE     HTMLFILE;FILEFLAG;           * current/new file flag
          GOTO      NZPF9999
.
NZPF2400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          COMPARE   ONE,IBCNMHOS
          GOTO      NZPF9999 IF NOT EQUAL
.
          BRANCH    F1,NZPF2410,NZPF2420
.
          PACK      KEY3,NZPFE001,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,NZPF9999
.
          WRITE     HTMLFILE;PTHSNAME;           * hospital name
          GOTO      NZPF9999
.
NZPF2410  WRITE     HTMLFILE;NZPFE001;           * hospital code
          GOTO      NZPF9999
.
NZPF2420  MOVE      NZPFE001,DIM3
          CALL      NZPH0000                     * hospital selection list
          GOTO      NZPF9999
.
NZPF2500  MOVE      "CL",CATEGORY                * claim code
          MOVE      NZPFE002,CODE
          CALL      CODITM00
          GOTO      NZPF9999
.
NZPF2600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,NZPF2610
.
          WRITE     HTMLFILE;NZPFE003;           * health fund code
          GOTO      NZPF9999
.
NZPF2610  PACK      KEY14,NZPFE003,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;           * health fund description
          ELSE
            WRITE     HTMLFILE;NZPFE003;         * health fund code
          ENDIF
          GOTO      NZPF9999
.
NZPF2700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,NZPF2710
.
          WRITE     HTMLFILE;NZPFE004;           * table code
          GOTO      NZPF9999
.
NZPF2710  PACK      KEY14,NZPFE003,NZPFE004,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;           * description of Table
          ELSE
            WRITE     HTMLFILE;NZPFE004;         * table code
          ENDIF
          GOTO      NZPF9999
.
NZPF2800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZPF2810
          WRITE     HTMLFILE;NZPFE005;      * Casemix Code
          GOTO      NZPF9999
.
NZPF2810  MATCH     SP70,NZPFE005
          GOTO      NZPF9999 IF EQUAL
.
          PACK      KEY9,NZPFE005,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,NZPF9999
          WRITE     HTMLFILE;PTCADES1;    * Casemix Code Desc
          GOTO      NZPF9999
.
NZPF2900  WRITE     HTMLFILE;BRKDTYPE;    * Breakdown type - R=Revenue I=Invoice
          GOTO      NZPF9999
.
NZPF3000  WRITE     HTMLFILE;SHOWREVN;    * Show Breakdown
          GOTO      NZPF9999
.
NZPF3100  CALL      NZPRV000    * Overnight Revenue/Invoice Breakdown list
          GOTO      NZPF9999
.
NZPF3200  MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            WRITE     HTMLFILE;"Revenue";
            GOTO      NZPF9999
          ENDIF     
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            WRITE     HTMLFILE;"Invoice";
            GOTO      NZPF9999
          ENDIF     
          GOTO      NZPF9999
.
NZPF3300  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"New File";
          ELSE
            WRITE     HTMLFILE;"Current File";
          ENDIF     
          GOTO      NZPF9999
.
NZPF3400  CALL      NZPRB000    * Overnight Revenue/Invoice Breakdown list
          GOTO      NZPF9999
.
NZPF3500  WRITE     HTMLFILE;TOTALAMT; * Total breakdown amount               
          GOTO      NZPF9999
.
NZPF9999  RETURN
.
.------------------------------------------------------------
.  Update NZPPFEFD file
.------------------------------------------------------------
MVNZPF00  MOVE      NZPFE001,NZPFHOSP
          MOVE      NZPFE002,NZPFCLMC
          MOVE      NZPFE003,NZPFCNTR
          MOVE      NZPFE004,NZPFFTAB
          MOVE      NZPFE005,NZPFCPRC
          MOVE      NZPFE006,NZPFEFDT
          MOVE      NZPFE007,NZPFCONT
          MOVE      NZPFE008,NZPFHPOR
          MOVE      NZPFE009,NZPFPPOR
          MOVE      NZPFE010,NZPFDES1
          MOVE      NZPFE011,NZPFDES2
          MOVE      NZPFE012,NZPFRBRK
          MOVE      NZPFE013,NZPFIBRK
.
          MOVE      SP70,NZPFSPAR
.
MVNZPF99  RETURN
.
.------------------------------------------------------------
.  Clear file vars for NZPPFEFD 
.------------------------------------------------------------
CLNZPF00  MOVE      SP70,NZPFHOSP
          MOVE      SP70,NZPFCLMC
          MOVE      SP70,NZPFCNTR
          MOVE      SP70,NZPFFTAB
          MOVE      SP70,NZPFCPRC
          MOVE      SP70,NZPFEFDT
          MOVE      SP70,NZPFCONT
          MOVE      ZERO,NZPFHPOR
          MOVE      ZERO,NZPFPPOR
          MOVE      SP70,NZPFDES1
          MOVE      SP70,NZPFDES2
          MOVE      ZERO,NZPFRBRK
          MOVE      SP70,NZPFIBRK
          MOVE      SP70,NZPFSPAR
.
CLNZPF99  RETURN
.
.-------------------------------------------------------------------------
. Link to Next Set NZ Private Proc Fee
.-------------------------------------------------------------------------
NXTNZP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          MOVE      F2,DIM2
          REP       " +",DIM2
.
          REP       " +",NZPFE001
          REP       " +",NZPFE002
          REP       " +",NZPFE003
          REP       " +",NZPFE004
          REP       " +",NZPFE005
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZPFE006
          IF        !@EQUAL
            UNPACK    NZPFE006,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nzpfe001=",NZPFE001:
                                 "&nzpfe002=",NZPFE002:
                                 "&nzpfe003=",NZPFE003:
                                 "&nzpfe004=",NZPFE004:
                                 "&nzpfe005=",NZPFE005:
                                 "&nzpfe006=",KEY11:
                                 "&fileflag=",FILEFLAG;
.
          REP       "+ ",NZPFE001
          REP       "+ ",NZPFE002
          REP       "+ ",NZPFE003
          REP       "+ ",NZPFE004
          REP       "+ ",NZPFE005
          MOVE      SP70,KEY11
.
NXTNZP99  RETURN
.-------------------------------------------------------------
. Link to Prev NZ Private Proc Fee
.-------------------------------------------------------------
PRVNZP00  MOVE      NORECORD,KEY2
          rEP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          MOVE      F2,DIM2
          REP       " +",DIM2
.
          REP       " +",NZPFE001
          REP       " +",NZPFE002
          REP       " +",NZPFE003
          REP       " +",NZPFE004
          REP       " +",NZPFE005
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZPFE006
          IF        !@EQUAL
            UNPACK    NZPFE006,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nzpfe001=",NZPFE001:
                                 "&nzpfe002=",NZPFE002:
                                 "&nzpfe003=",NZPFE003:
                                 "&nzpfe004=",NZPFE004:
                                 "&nzpfe005=",NZPFE005:
                                 "&nzpfe006=",KEY11:
                                 "&fileflag=",FILEFLAG;
.
          REP       "+ ",NZPFE001
          REP       "+ ",NZPFE002
          REP       "+ ",NZPFE003
          REP       "+ ",NZPFE004
          REP       "+ ",NZPFE005
          MOVE      SP70,KEY11
.
PRVNZP99  RETURN
.
.------------------------------------------------------------
. Table of NZ Private Procedure Fee Header Record Details
.------------------------------------------------------------
NZPPTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      NZPPHD00              * Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD   * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     "N",FILEFLAG
          GOTO      NZPPTB10 IF EQUAL
.
          PACK      KEY37,NZPFE001,SP70  * Cur File
          CALL      RSNZPFE1
NZPPTB05  CALL      RKNZPFE1
          BRANCH    OVRCD,NZPPTB90
          GOTO      NZPPTB20
.
NZPPTB10  PACK      KEY37,NZPFE001,SP70  * New File
          CALL      RSNZPF11
NZPPTB15  CALL      RKNZPF11
          BRANCH    OVRCD,NZPPTB90
.
NZPPTB20  MATCH     NZPFE001,NZPFHOSP            * Hospital
          GOTO      NZPPTB90 IF NOT EQUAL
.
          MATCH     SP70,NZPFE002
          IF        !@EQUAL
            MATCH     NZPFE002,NZPFCLMC          * Claim Code
            GOTO      NZPPTB50 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZPFE003
          IF        !@EQUAL
            MATCH     NZPFE003,NZPFCNTR          * Health Fund
            GOTO      NZPPTB50 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZPFE004
          IF        !@EQUAL
            MATCH     NZPFE004,NZPFFTAB          * Health Fund Table
            GOTO      NZPPTB50 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZPFE005
          IF        !@EQUAL
            MATCH     NZPFE005,NZPFCPRC          * Procedure Code
            GOTO      NZPPTB50 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            MATCH     "N",FILEFLAG
            GOTO      NZPPTB15 IF EQUAL
            GOTO      NZPPTB05
          ENDIF
.
          CALL      NZPPRW00
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            MATCH     "N",FILEFLAG
            IF        @EQUAL
              GOTO      NZPPTB15
            ELSE
              GOTO      NZPPTB05
            ENDIF
          ENDIF
          GOTO      NZPPTB99
.
NZPPTB50  MATCH     "N",FILEFLAG
          IF        @EQUAL
            GOTO      NZPPTB15
          ELSE
            GOTO      NZPPTB05
          ENDIF
.
NZPPTB90  CALL      NOMORE00     * Display No More Records Message
.
NZPPTB99  RETURN
.------------------------------------------------------------
. NZ Private Procedure Fee Table (TABLE ROW)
.------------------------------------------------------------
NZPPRW00  MATCH     SP70,NZPFHOSP
          IF        !@EQUAL
            PACK      KEY3,NZPFHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD=1
              MOVE      NZPFHOSP,PTHSNAME        * hospital
            ENDIF
          ENDIF
.
          MOVE     SP70,CLAMDESC
          MATCH    SP70,NZPFCLMC
          IF       !@EQUAL
            PACK     KEY5,ANSC,ANSL,NZPFCLMC,SP70
            CALL     RDCODE1
            IF       OVRCD=1
              MOVE     NZPFCLMC,TDESC            * claim code
            ENDIF
            MOVE    TDESC,CLAMDESC
          ENDIF
.
          MOVE      SP70,DISPEDAT
          MATCH     SP70,NZPFEFDT
          IF        !@EQUAL
            UNPACK    NZPFEFDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPEDAT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          REP       " +",NZPFHOSP
          REP       " +",NZPFCLMC
          REP       " +",NZPFCNTR
          REP       " +",NZPFFTAB
          REP       " +",NZPFCPRC
          REP       " +",NZPFEFDT
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZPFEFDT
          IF        !@EQUAL
            UNPACK    NZPFEFDT,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&nzpfe001=",NZPFHOSP:
                             "&nzpfe002=",NZPFCLMC:
                             "&nzpfe003=",NZPFCNTR:
                             "&nzpfe004=",NZPFFTAB:
                             "&nzpfe005=",NZPFCPRC:
                             "&nzpfe006=",KEY11:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>";
.
          REP       "+ ",NZPFHOSP
          REP       "+ ",NZPFCLMC
          REP       "+ ",NZPFCNTR
          REP       "+ ",NZPFFTAB
          REP       "+ ",NZPFCPRC
          REP       "+ ",NZPFEFDT
.
          PACK      KEY9,NZPFCPRC,SP70
          CALL      RDPTCMC1
          IF        OVRCD=1
            MOVE      SP70,PTCADES1
          ENDIF
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;PTHSNAME,"&nbsp;</td>":
                               "<td>",CLAMDESC,"&nbsp;</td>":
                               "<td>",NZPFCNTR,"&nbsp;</td>":
                               "<td>",NZPFFTAB,"&nbsp;</td>":
                               "<td>",NZPFCPRC,"&nbsp;</td>":
                               "<td>",PTCADES1,"&nbsp;</td>":
                               "<td>",DISPEDAT,"&nbsp;</td></tr>"
          ELSE
            WRITE     HTMLFILE;CLAMDESC,"&nbsp;</td>":
                               "<td>",NZPFCNTR,"&nbsp;</td>":
                               "<td>",NZPFFTAB,"&nbsp;</td>":
                               "<td>",NZPFCPRC,"&nbsp;</td>":
                               "<td>",PTCADES1,"&nbsp;</td>":
                               "<td>",DISPEDAT,"&nbsp;</td></tr>"
          ENDIF
.
NZPPRW99 RETURN
.------------------------------------------------------------
. NZ Private Procedure Fee's Details Table (TABLE HEADING)
.------------------------------------------------------------
NZPPHD00  WRITE     HTMLFILE;"<tr>";
.
          PACK      KEY5,ANSC,ANSL,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      SP70,TDESC
          ENDIF
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell>Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>",TDESC,"</td>":
                             "<td class=HeadingCell>Contract</td>":
                             "<td class=HeadingCell>Table</td>":
               "<td class=HeadingCell>Contract Procedure Code</td>":
               "<td class=HeadingCell>Contract Procedure Description</td>":
                             "<td class=HeadingCell>Effective Date</td>":
                             "</tr>"
.
NZPPHD99  RETURN
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
NZPH0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
NZPH0100  CALL      RKPTHSP1
          BRANCH    OVRCD,NZPH9999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     DIM3,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      NZPH0100
.
NZPH9999  RETURN
.
.------------------------------------------------------------
. Table of nz private contract procedure fee breakdown charges
.------------------------------------------------------------
NZPRV000  MOVE      ZERO,FIRST
          MOVE      ZERO,FINISHR
          MOVE      ZERO,FINISHI
.         
          PACK      KEY40,NZPFE001,NZPFE002,NZPFE003,NZPFE004:    
                          NZPFE005,NZPFE006,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RSNZRB11
          ELSE
            CALL      RSNZRBR1
          ENDIF
.
NZPRV010  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RKNZRB11
          ELSE
            CALL      RKNZRBR1
          ENDIF
          BRANCH    OVRCD,NZPRV090
.
NZPRV050  MATCH     NZPFE001,NZRBHOSP
          GOTO      NZPRV090 IF NOT EQUAL
.
          MATCH     NZPFE002,NZRBCLMC
          GOTO      NZPRV090 IF NOT EQUAL
.
          MATCH     NZPFE003,NZRBCNTR
          GOTO      NZPRV090 IF NOT EQUAL
.
          MATCH     NZPFE004,NZRBFTAB
          GOTO      NZPRV090 IF NOT EQUAL
.
          MATCH     NZPFE005,NZRBCPRC
          GOTO      NZPRV090 IF NOT EQUAL
.
          MATCH     NZPFE006,NZRBEFDT
          GOTO      NZPRV090 IF NOT EQUAL
.
          MOVE      "FI",CATEGORY
          MOVE      NZRBBRCD,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr><td>",TDESC,"</td>":
                             "<td>&nbsp;",NZRBAMNT,"</td>"
          GOTO      NZPRV100
.
NZPRV090  WRITE     HTMLFILE;"<tr><td>&nbsp</td>":
                             "<td>&nbsp;</td>"
          MOVE      ONE,FINISHR
.
NZPRV100 IF        FIRST=0
            PACK      KEY40,NZPFE001,NZPFE002,NZPFE003,NZPFE004:    
                            NZPFE005,NZPFE006,SP70
            MATCH     ANSN,FILEFLAG
            IF        @EQUAL
              CALL      RSNZIB11
            ELSE
              CALL      RSNZIBR1
            ENDIF
            MOVE      ONE,FIRST
          ENDIF
.
NZPRV110  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RKNZIB11
          ELSE
            CALL      RKNZIBR1
          ENDIF
          BRANCH    OVRCD,NZPRV190
.
NZPRV150  MATCH     NZPFE001,NZIBHOSP
          GOTO      NZPRV190 IF NOT EQUAL
.
          MATCH     NZPFE002,NZIBCLMC
          GOTO      NZPRV190 IF NOT EQUAL
.
          MATCH     NZPFE003,NZIBCNTR
          GOTO      NZPRV190 IF NOT EQUAL
.
          MATCH     NZPFE004,NZIBFTAB
          GOTO      NZPRV190 IF NOT EQUAL
.
          MATCH     NZPFE005,NZIBCPRC
          GOTO      NZPRV190 IF NOT EQUAL
.
          MATCH     NZPFE006,NZIBEFDT
          GOTO      NZPRV190 IF NOT EQUAL
.
          MOVE      "FI",CATEGORY
          MOVE      NZIBBRCD,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<td>",TDESC,"</td>":
                             "<td>&nbsp;",NZIBAMNT,"</td>"
.
          GOTO      NZPRV010
.
NZPRV190  WRITE     HTMLFILE;"<td>&nbsp</td>":
                             "<td>&nbsp;</td></tr>"
          MOVE      ONE,FINISHI
.
          COMPARE   ONE,FINISHR
          GOTO      NZPRV999 IF EQUAL
          GOTO      NZPRV010
.
NZPRV999  RETURN
.
.------------------------------------------------------------
. Table of temp NZ private contract procedure breakdown charges
.------------------------------------------------------------
NZPRB000  COMPARE   ONE,UPDATEFL
          IF        @EQUAL
            CALL      WRPRV000
          ENDIF
.
          MOVE      ZERO,TOTALAMT
.
          MATCH     ANSR,BRKDTYPE
          GOTO      NZPRB100 IF NOT EQUAL
.
          PACK      KEY40,NZPFE001,NZPFE002,NZPFE003,NZPFE004:
                          NZPFE005,NZPFE006,SP70
          CALL      RSTMRBR1
NZPRB010  CALL      RKTMRBR1
          BRANCH    OVRCD,NZPRB100
.
NZPRB050  MATCH     NZPFE001,TEMPHOSP
          GOTO      NZPRB100 IF NOT EQUAL
.
          MATCH     NZPFE002,TEMPCLMC
          GOTO      NZPRB100 IF NOT EQUAL
.
          MATCH     NZPFE003,TEMPCNTR
          GOTO      NZPRB100 IF NOT EQUAL
.
          MATCH     NZPFE004,TEMPFTAB
          GOTO      NZPRB100 IF NOT EQUAL
.
          MATCH     NZPFE005,TEMPCPRC
          GOTO      NZPRB100 IF NOT EQUAL
.
          MATCH     NZPFE006,TEMPEFDT
          GOTO      NZPRB100 IF NOT EQUAL
.
          ADD       TEMPAMNT,TOTALAMT
          CALL      NZPRBR00
          GOTO      NZPRB010
.
NZPRB100  MATCH     ANSI,BRKDTYPE
          GOTO      NZPRB999 IF NOT EQUAL
.
          PACK      KEY40,NZPFE001,NZPFE002,NZPFE003,NZPFE004:
                          NZPFE005,NZPFE006,SP70
          CALL      RSTMIBR1
NZPRB110  CALL      RKTMIBR1
          BRANCH    OVRCD,NZPRB999
.
          MATCH     NZPFE001,TEMPHOSP
          GOTO      NZPRB999 IF NOT EQUAL
.
          MATCH     NZPFE002,TEMPCLMC
          GOTO      NZPRB999 IF NOT EQUAL
.
          MATCH     NZPFE003,TEMPCNTR
          GOTO      NZPRB999 IF NOT EQUAL
.
          MATCH     NZPFE004,TEMPFTAB
          GOTO      NZPRB999 IF NOT EQUAL
.
          MATCH     NZPFE005,TEMPCPRC
          GOTO      NZPRB999 IF NOT EQUAL
.
          MATCH     NZPFE006,TEMPEFDT
          GOTO      NZPRB999 IF NOT EQUAL
.
          ADD       TEMPAMNT,TOTALAMT
          CALL      NZPRBR00
.
          GOTO      NZPRB110
.
NZPRB999  RETURN
.
.------------------------------------------------------------
. NZ Private contract procedure fee Revenue Breakdown row
.------------------------------------------------------------
NZPRBR00  MOVE      "FI",CATEGORY
          MOVE      TEMPBRCD,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:DeleteInvoice":
                             "(#"",TEMPBRCD,"#")'>":
                             "<img src=../images/DeleteIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             TDESC,"</td>":
                             "<td>&nbsp;",TEMPAMNT,"</td>"
OREROW99  RETURN
.
.
.******************************************************************************
.*                             WRPRV000                                       *
.* Write to nz private contract procedure breakdown tempfile                  *
.******************************************************************************
WRPRV000  PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          CALL      RSTMRBR1
WRPRV100  CALL      RKTMRBR1
          BRANCH    OVRCD,WRPRV200
.
          MATCH     TEMPHOSP,NZPFHOSP            * same hospital ?
          GOTO      WRPRV200 IF NOT EQUAL
.
          MATCH     TEMPCLMC,NZPFCLMC            * same claim code ?
          GOTO      WRPRV200 IF NOT EQUAL
.
          MATCH     TEMPCNTR,NZPFCNTR            * same health fund ?
          GOTO      WRPRV200 IF NOT EQUAL
.
          MATCH     TEMPFTAB,NZPFFTAB            * same health fund table ?
          GOTO      WRPRV200 IF NOT EQUAL
.
          MATCH     TEMPCPRC,NZPFCPRC            * same proc ?
          GOTO      WRPRV200 IF NOT EQUAL
.
          MATCH     TEMPEFDT,NZPFEFDT            * same effective date ?
          GOTO      WRPRV200 IF NOT EQUAL
.
          PACK      KEY40,TEMPHOSP,TEMPCLMC,TEMPCNTR,TEMPFTAB,TEMPCPRC:
                          TEMPEFDT,TEMPBRCD,SP70
          CALL      DETMRBR1
          GOTO      WRPRV100
.
WRPRV200  PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          CALL      RSTMIBR1
WRPRV300  CALL      RKTMIBR1
          BRANCH    OVRCD,WRPRV500
.
          MATCH     TEMPHOSP,NZPFHOSP            * same hospital ?
          GOTO      WRPRV500 IF NOT EQUAL
.
          MATCH     TEMPCLMC,NZPFCLMC            * same claim code ?
          GOTO      WRPRV500 IF NOT EQUAL
.
          MATCH     TEMPCNTR,NZPFCNTR            * same health fund ?
          GOTO      WRPRV500 IF NOT EQUAL
.
          MATCH     TEMPFTAB,NZPFFTAB            * same health fund table ?
          GOTO      WRPRV500 IF NOT EQUAL
.
          MATCH     TEMPCPRC,NZPFCPRC            * same proc ?
          GOTO      WRPRV500 IF NOT EQUAL
.
          MATCH     TEMPEFDT,NZPFEFDT            * same effective date?
          GOTO      WRPRV500 IF NOT EQUAL
.
          PACK      KEY40,TEMPHOSP,TEMPCLMC,TEMPCNTR,TEMPFTAB,TEMPCPRC:
                          TEMPEFDT,TEMPBRCD,SP70
          CALL      DETMIBR1
          GOTO      WRPRV300
.
WRPRV500  PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RSNZRB11
          ELSE
            CALL      RSNZRBR1
          ENDIF
.
WRPRV600  MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RKNZRB11
          ELSE
            CALL      RKNZRBR1
          ENDIF
          BRANCH    OVRCD,WRPRV700
.
          MATCH     NZRBHOSP,NZPFHOSP            * same hospital ?
          GOTO      WRPRV700 IF NOT EQUAL
.
          MATCH     NZRBCLMC,NZPFCLMC            * same claim code ?
          GOTO      WRPRV700 IF NOT EQUAL
.
          MATCH     NZRBCNTR,NZPFCNTR            * same health fund ?
          GOTO      WRPRV700 IF NOT EQUAL
.
          MATCH     NZRBFTAB,NZPFFTAB            * same health fund table ?
          GOTO      WRPRV700 IF NOT EQUAL
.
          MATCH     NZRBCPRC,NZPFCPRC            * same proc ?
          GOTO      WRPRV700 IF NOT EQUAL
.
          MATCH     NZRBEFDT,NZRBEFDT            * same effective date ?
          GOTO      WRPRV700 IF NOT EQUAL
.
          MOVE      SP70,TEMPHOSP             * clear variables before writing
          MOVE      SP70,TEMPCLMC
          MOVE      SP70,TEMPCNTR
          MOVE      SP70,TEMPFTAB
          MOVE      SP70,TEMPCPRC
          MOVE      SP70,TEMPEFDT
          MOVE      SP70,TEMPBRCD
          MOVE      ZERO,TEMPAMNT
.
          MOVE      NZRBHOSP,TEMPHOSP             
          MOVE      NZRBCLMC,TEMPCLMC
          MOVE      NZRBCNTR,TEMPCNTR
          MOVE      NZRBFTAB,TEMPFTAB
          MOVE      NZRBCPRC,TEMPCPRC
          MOVE      NZRBEFDT,TEMPEFDT
          MOVE      NZRBBRCD,TEMPBRCD
          MOVE      NZRBAMNT,TEMPAMNT
.
          PACK      KEY40,TEMPHOSP,TEMPCLMC,TEMPCNTR,TEMPFTAB,TEMPCPRC:
                          TEMPEFDT,TEMPBRCD,SP70
          CALL      RATMRBR1
          IF        OVRCD=1
            CALL      WRTMRBR1
          ENDIF
          GOTO      WRPRV600
.
WRPRV700  PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RSNZIB11
          ELSE
            CALL      RSNZIBR1
          ENDIF
.
WRPRV800  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RKNZIB11
          ELSE
            CALL      RKNZIBR1
          ENDIF
          BRANCH    OVRCD,WRPRV999
.
          MATCH     NZIBHOSP,NZPFHOSP            * same hospital ?
          GOTO      WRPRV900 IF NOT EQUAL
.
          MATCH     NZIBCLMC,NZPFCLMC            * same claim code ?
          GOTO      WRPRV900 IF NOT EQUAL
.
          MATCH     NZIBCNTR,NZPFCNTR            * same health fund ?
          GOTO      WRPRV900 IF NOT EQUAL
.
          MATCH     NZIBFTAB,NZPFFTAB            * same health fund table ?
          GOTO      WRPRV900 IF NOT EQUAL
.
          MATCH     NZIBCPRC,NZPFCPRC            * same procedure ?
          GOTO      WRPRV900 IF NOT EQUAL
.
          MATCH     NZIBEFDT,NZPFEFDT            * same effective date ?
          GOTO      WRPRV900 IF NOT EQUAL
.
          MOVE      SP70,TEMPHOSP             * clear variables before writing
          MOVE      SP70,TEMPCLMC
          MOVE      SP70,TEMPCNTR
          MOVE      SP70,TEMPFTAB
          MOVE      SP70,TEMPCPRC
          MOVE      SP70,TEMPEFDT
          MOVE      SP70,TEMPBRCD
          MOVE      ZERO,TEMPAMNT
.         
          MOVE      NZIBHOSP,TEMPHOSP
          MOVE      NZIBCLMC,TEMPCLMC
          MOVE      NZIBCNTR,TEMPCNTR
          MOVE      NZIBFTAB,TEMPFTAB
          MOVE      NZIBCPRC,TEMPCPRC
          MOVE      NZIBEFDT,TEMPEFDT
          MOVE      NZIBBRCD,TEMPBRCD
          MOVE      NZIBAMNT,TEMPAMNT
.
          PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          CALL      RATMIBR1
          IF        OVRCD=1
            CALL      WRTMIBR1
          ENDIF
          GOTO      WRPRV800
.
WRPRV900
WRPRV999  RETURN
.
.
.------------------------------------------------------------
.   Set Parameters for Copy NZPPFEFD
.------------------------------------------------------------
SCNZPF00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SCNZPF01,SCNZPF02,SCNZPF03,SCNZPF04,SCNZPF05:
                       SCNZPF06
.                      
          MOVE      ONE,EXIT
          GOTO      SCNZPF99
.         
SCNZPF01  PACK      CPPFE001,QRYDATA,SP70
          GOTO      SCNZPF99
.
SCNZPF02  PACK      CPPFE002,QRYDATA,SP70
          GOTO      SCNZPF99
.
SCNZPF03  PACK      CPPFE003,QRYDATA,SP70
          GOTO      SCNZPF99
.
SCNZPF04  PACK      CPPFE004,QRYDATA,SP70
          GOTO      SCNZPF99
.
SCNZPF05  PACK      CPPFE005,QRYDATA,SP70
          GOTO      SCNZPF99
.
SCNZPF06  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      CPPFE006,CCENT,CYEAR,CMON,CDAY
          GOTO      SCNZPF99
.
SCNZPF99  RETURN

.******************************************************************************
.*                                                                            *
.*                                 PRIINVHT                                   *
.*                                 --------                                   *
.*                                                                            *
.*    Include to print Private Practive Invoice Header and Tail               *
.*     and print transaction line                                             *
.*    (this routines were moved from PRIINVPR)                                *
.*    This routine is used for Re Print PP invoice from IBAPOL (COMWEB70)     *
.*    for Receipt Processing (Unreconcilled invoice)
.*                                                                            *
.*    AUTHOR        :  J.Tan                                                  *
.*                                                                            *
.*    DATE          :  03/04/2023                                             *
.*                                                                            *
.*    MODIFICATIONS :                                                         *
.*           V12.00.01 24/07/2025  J.Tan          TSK 0962500                 *
.*                     Mod print cash deposit to check for U/R number         *
.*           V11.04.02 11/04/2024  J.Tan         TSK 0941662                  *
.*                     Mod PRDTGSTM - GST of Total amt(Item amt x Quantity)   *
.*           V11.04.01 09/04/2024 J.Tan           Task 0944326                *
.*                     Fixed printing Cabrini invoice layout with Claim       *
.*                                                                            *
.******************************************************************************
.
.****************************************************************************
.  SINVH000 - Set up invoice header for stationery templating
.****************************************************************************
SINVH000  OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
.
          MOVE      PRCNPRIH,KEY6
          CALL      RDIBTH1                   * read header detail file
          BRANCH    OVRCD,SINVH900
.
          PACK      KEY12,PRCNPRIH,SP6        * position on details file
          CALL      RSIBDET1
          CALL      RKIBDET1
          BRANCH    OVRCD,SINVH900
.
          MATCH     PRCNPRIH,IBDTSCOD         * match stationery codes
          GOTO      SINVH950 IF EQUAL
.
.------ stationery code not on file ------
.
SINVH900  DISPLAY   *P1:24,*EL,*B:
                    "User Defined Stationery Code not on File. ";
.
.         WRITE     HTMLFILE;"<tr><center><blink><h2><b>":
.                            "User Defined Stationery Code not on File. ":
.                            "</b></h2></blink></center></tr>";
.         CALL      HITENTER
          MOVE      ONE,EXIT
          GOTO      SINVH999
.
SINVH950  MOVE      ZERO,EXIT
SINVH999  RETURN
+
.****************************************************************************
.  SINVT000 - Set up invoice tail for stationery templating
.****************************************************************************
SINVT000  OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
.
          MOVE      PRCNPRIT,KEY6
          CALL      RDIBTH1                   * read header detail file
          BRANCH    OVRCD,SINVT900
.
          PACK      KEY12,PRCNPRIT,SP6        * position on details file
          CALL      RSIBDET1
          CALL      RKIBDET1
          BRANCH    OVRCD,SINVT900
.
          MATCH     PRCNPRIT,IBDTSCOD         * match stationery codes
          GOTO      SINVT950 IF EQUAL
.
.------ stationery code not on file ------
.
SINVT900  DISPLAY   *P1:24,*EL,*B:
                    "User Defined Stationery Code not on File. ";
.         WRITE     HTMLFILE;"<tr><center><blink><h2><b>":
.                            "User Defined Stationery Code not on File. ":
.                            "</b></h2></blink></center></tr>";
.         CALL      HITENTER
          MOVE      ONE,EXIT
          GOTO      SINVT999
.
SINVT950  MOVE      ZERO,EXIT
SINVT999  RETURN
+
.**********************************************************************
.*                                PIHED000                            *
.*     Routine to print the invoice header and the claim details if   *
.*     they exist                                                     *
.**********************************************************************
PIHED000  BRANCH    FLAGBULK,PIHED999       * skip if bulk billing the patient
.
          MOVE      ZERO,PINVTOT
          MOVE      ZERO,PINVPAID
          MOVE      ZERO,VLINENO
          MOVE      CDD,XDAY
          MOVE      CMM,XMON
          MOVE      CYY,XYEAR
          REP       " 0",XDAY
          REP       " 0",XMON
          REP       " 0",XYEAR
          MOVE      TMPRESP,VPRANAME
.
PIHED005  CALL      SINVH000                * set up header stationery code
          CALL      PRTPRIHL                * print templated invoice header
.         IF        PRCNLAYT=8
.           ADD       FOUR,VLINENO
.         ENDIF
          RETURN
.
PIHED007
.
.------------------------------------------------------------------------------
.         Standard Layout (St. Andrews War Memorial)
.------------------------------------------------------------------------------
          PRINT     *1                      * 1 line on top
.
. ------- Print address on invoice ? -------
.
          BRANCH    PRCNADDR,PIHED010       * skip if using medical practice 
.                                             name on invoice
          PRINT     *62,PRCNTELE,*N,*N,*N,*N,*62,PRCNNAME,*N
          GOTO      PIHED020
.
.------ we are using the medical practice name on the invoice ------
.
PIHED010  PRINT        *49,PRPRDESC:
                    *N,*49,PRPRADD1:
                    *N,*49,PRPRADD2:
                    *N,*49,PRPRADD3,*76,PRPRPOST:
                    *N,*49,PRPRTELP,*N
.
. ------- Print Person Resp. for Account & Debtor details -------
.
PIHED020  PRINT        *3,VPRANAME,*44,VDEBNAME:
                    *N,*3,TMPRADD1,*44,VDEBADD1:
                    *N,*3,TMPRADD2,*44,VDEBADD2:
                    *N,*3,TMPRADD3,SP1,TMPRPOST:
                      *44,VDEBADD3,SP1,VDEBPOST,*N,*N
.
.         BRANCH    VSCANPMI,PIHED030       * skip if we have a U/R
.         PRINT     *3,"DB:";
.         GOTO      PIHED040
.
.------ we are processing a U/R Number ------
.
PIHED030  PRINT     *3,"UR:";
.
.------ print the header details ------
.
PIHED040  PRINT        VDEBTOR,*71,PRCNINVN:
                    *N,*22,VSVDCNAM,*N:
                    *N,*3,VSVDPROV,*71,XDAY,SLASH,XMON,SLASH,XYEAR:
                    *N,*N,*N,*N
.
          MATCH     SP3,CLAIMTYP            * see if we have claim details
          GOTO      PIHED060 IF EQUAL
.
          PRINT     *N,*3,CLAIMTYP,SP1,"Claim ## : ",CLAIMNUM,SP1;
.
          MATCH     "VA ",CLAIMTYP          * see if we have a veterans affairs
          IF        @EQUAL
            PRINT     *N,*N,*N;
            GOTO      PIHED050                  claim
          ENDIF
.
          PRINT     *38,"Accident Date : ",CLAIMDTE;
.
          MATCH     "WC ",CLAIMTYP          * see if we have a workers 
          IF        !@EQUAL
            PRINT     *N,*N,*N;
            GOTO      PIHED050                  compensation claim
          ENDIF
.
          PRINT     *N,*7,"Employer's Name : ",EMPLNAME,*N,*N;
.
.------ print blank lines after the claim details ------
.
PIHED050  ADD       FOUR,VLINENO
.
.------ increment the line counter ------
.
PIHED060  ADD       ONE,VLINENO
          GOTO      PIHED999
.
.------------------------------------------------------------------------------
.         Warburton Layout
.------------------------------------------------------------------------------
PIHED100 
.
. ------- Print address on invoice ? -------
.
          BRANCH    PRCNADDR,PIHED110       * skip if using medical practice 
.                                             name on invoice
          PRINT     *60,PRCNTELE,*N,*N,*N,*N:
                    *60,PRCNNAME,*N
          GOTO      PIHED120
.
.------ print the medical practice name ------
.
PIHED110  PRINT        *47,PRPRDESC:
                    *N,*47,PRPRADD1:
                    *N,*47,PRPRADD2:
                    *N,*47,PRPRADD3,*74,PRPRPOST:
                    *N,*47,PRPRTELP,*N
.
. ------- Print Person Resp. for Account & Debtor details -------
.
PIHED120  PRINT     *1,VPRANAME,*42,VDEBNAME:
                    *N,TMPRADD1,*42,VDEBADD1:
                    *N,TMPRADD2,*42,VDEBADD2:
                    *N,TMPRADD3,TMPRPOST,*42,VDEBADD3,VDEBPOST,*N,*N
.
.         BRANCH    VSCANPMI,PIHED130       * skip if processing a U/R number
.         PRINT     *1,"DEBTOR NUMBER"
.         GOTO      PIHED140
.
.------ we are processing a U/R Number ------
.
PIHED130  PRINT     *1,"U/R NUMBER"
.
.------ print the debtor number ------
.
PIHED140  PRINT     *1,VDEBTOR;
.
          COMPARE   ZERO,COPINV             * see if we are copying an invoice
          GOTO      PIHED150 IF EQUAL
          PRINT     *56,"COPY";
.
.------ print the rest of the header details ------
.
PIHED150  PRINT     *69,PRCNINVN,*N:
                    *N,"MEDICAL SERVICES PROVIDED BY ",VSVDCNAM:
                       *58," (",VSVDOCT,") ",*69,XDAY,SLASH,XMON,SLASH,XYEAR:
                    *N,*30,PRIMTYPE:
                    *N,*30,"PROVIDER ## ",VSVDPROV:
                    *N,*N,"DATE",*11,"ITEM      DESCRIPTION":
                      *45,"NO.OF SERVICES  COST",*N
.
          MATCH     SP3,CLAIMTYP            * see if we have claim details
          GOTO      PIHED170 IF EQUAL
.
          PRINT     *N,*3,CLAIMTYP,SP1,"Claim ## : ",CLAIMNUM,SP1;
.
          MATCH     "VA ",CLAIMTYP          * see if we have a veterans affairs
          GOTO      PIHED160 IF EQUAL         claim
.
          PRINT     *38,"Accident Date : ",CLAIMDTE;
.
          MATCH     "WC ",CLAIMTYP          * see if we have a workers 
          GOTO      PIHED160 IF NOT EQUAL     compensation claim
.
          PRINT     *N,*7,"Employer's Name : ",EMPLNAME;
          ADD       ONE,VLINENO
.
.------ print blank lines after the claim details ------
.
PIHED160  PRINT     *N,*N;
          ADD       THREE,VLINENO
.
.------ increment the line counter ------
.
PIHED170  ADD       ONE,VLINENO
          GOTO      PIHED999
.
.------------------------------------------------------------------------------
.         HRH Layout
.------------------------------------------------------------------------------
PIHED200  PRINT     *N,*N                * 3 blank lines on top of invoice
.
. ------- Print address on invoice ? -------
.
          BRANCH    PRCNADDR,PIHED210       * skip if using medical practice 
.                                             name on the invoice
          PRINT     *N,*60,PRCNTELE,*N,*N,*N,*N:
                       *60,PRCNNAME,*N,*N,*N,*N
          GOTO      PIHED220
.
.------ print the medical practice details ------
.
PIHED210  PRINT        *47,PRPRDESC:
                    *N,*47,PRPRADD1:
                    *N,*47,PRPRADD2:
                    *N,*47,PRPRADD3,*74,PRPRPOST:
                    *N,*47,PRPRTELP,*N,*N,*N,*N,*N
.
. ------- Print Person Resp. for Account & Debtor details -------
.
PIHED220  PRINT     *1,VPRANAME,*42,VDEBNAME:
                    *N,TMPRADD1,*42,VDEBADD1:
                    *N,TMPRADD2,*42,VDEBADD2:
                    *N,TMPRADD3,TMPRPOST,*42,VDEBADD3,VDEBPOST,*N,*N,*N
.
.         BRANCH    VSCANPMI,PIHED230       * skip if processing a U/R Number
.         PRINT     *1,"DB:";
.         GOTO      PIHED240
.
.------ we are processing a U/R Number ------
.
PIHED230  PRINT     *1,"UR:";
.
.------ print the rest of the header details ------
.
PIHED240  UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPDATE
          PRINT        VDEBTOR,*69,PRCNINVN,*N:
                    *N,"MEDICAL SERVICES PROVIDED BY ",VSVDCNAM:
                       *58," (",VSVDOCT,") ":
                    *N,*30,PRIMTYPE,*70,CPDATE:
                    *N,*30,"PROVIDER ## ",VSVDPROV:
                    *N,*N,"DATE",*11,"ITEM      DESCRIPTION":
                       *45,"NO.OF SERVICES  COST",*N
.
          MATCH     SP3,CLAIMTYP            * see if we have claim details
          GOTO      PIHED270 IF EQUAL
.
          PRINT     *N,*3,CLAIMTYP,SP1,"Claim ## : ",CLAIMNUM,SP1;
.
          MATCH     "VA ",CLAIMTYP          * see if we have a veterans affairs
          GOTO      PIHED250 IF EQUAL         claim
.
          PRINT     *38,"Accident Date : ",CLAIMDTE;
.
          MATCH     "WC ",CLAIMTYP          * see if we have a workers 
          GOTO      PIHED250 IF NOT EQUAL     compensation claim
.
          PRINT     *N,*7,"Employer's Name : ",EMPLNAME;
          ADD       ONE,VLINENO
.
.------ print blank lines after the claim details ------
.
PIHED250  PRINT     *N,*N;
          ADD       THREE,VLINENO
.
.------ increment the line counter ------
.
PIHED270  ADD       ONE,VLINENO
          GOTO      PIHED999
.
.------------------------------------------------------------------------------
.         Melbourne Clinic Layout
.------------------------------------------------------------------------------
PIHED300  PRINT     *N,*N                   * 2 blank lines on top of invoice
.
          BRANCH    PRCNADDR,PIHED310       * skip if we are using the medical
.                                             practice name on the invoice
          PRINT     *N,*N,*62,PRCNTELE,*N,*N,*62,PRCNNAME,*N
          GOTO      PIHED320
.
.------ print the medical practice details ------
.
PIHED310  PRINT     *N,*N,*N,*N,*49,PRPRDESC,*N
.
. ------- Print Person Resp. for Account & Debtor details -------
.
PIHED320  PRINT        *3,VPRANAME,*44,VDEBNAME:
                    *N,*3,TMPRADD1,*44,VDEBADD1:
                    *N,*3,TMPRADD2,*44,VDEBADD2:
                    *N,*3,TMPRADD3,SP1,TMPRPOST,*44,VDEBADD3,SP1,VDEBPOST:
                    *N,*N,*N
.
.         BRANCH    VSCANPMI,PIHED330       * skip if processing a U/R number
.          PRINT     *3,"D ",VDEBTOR,*43,"M",PRDBMEDN;
.         GOTO      PIHED340
.
.------ we are processing a U/R Number ------
.
PIHED330  PRINT     *3,"U ",VDEBTOR,*43,"M",PMEDI;
.
.------ see if we are copying an invoice ------
.
PIHED340  COMPARE   ZERO,COPINV
          GOTO      PIHED350 IF EQUAL
          PRINT     *58,"COPY";
.
.------ print the rest of the header details ------
.
PIHED350  PRINT        *71,PRCNINVN,*N:
                    *N,*16,VSVDCNAM:
                    *N,*16,PRIMTYPE,*71,XDAY,SLASH,XMON,SLASH,XYEAR:
                    *N,*16,"PROVIDER ## ",VSVDPROV,*N,*N,*N
.
          MATCH     SP3,CLAIMTYP            * see if we have claim details
          GOTO      PIHED370 IF EQUAL
.
          PRINT     *N,*3,CLAIMTYP,SP1,"Claim ## : ",CLAIMNUM,SP1;
.
          MATCH     "VA ",CLAIMTYP          * see if we have a veterans affairs
          GOTO      PIHED360 IF EQUAL         claim
.
          PRINT     *38,"Accident Date : ",CLAIMDTE;
.
          MATCH     "WC ",CLAIMTYP          * see if we have a workers 
          GOTO      PIHED360 IF NOT EQUAL     compensation claim
.
          PRINT     *N,*7,"Employer's Name : ",EMPLNAME;
          ADD       ONE,VLINENO
.
.------ print blank lines after the claim details ------
.
PIHED360  PRINT     *N,*N;
          ADD       THREE,VLINENO
.
.------ increment the line counter ------
.
PIHED370  ADD       ONE,VLINENO
          GOTO      PIHED999 
.
.------------------------------------------------------------------------------
.         RCH Layout
.------------------------------------------------------------------------------
PIHED400 
.
. ------- Print address on invoice ? -------
.
          BRANCH    PRCNADDR,PIHED410
          PRINT     ESC,"=",*N,*N,*N,*60,PRCNTELE,*N,*N,*N,*N,*50,PRCNNAME
          GOTO      PIHED420
.
PIHED410  PRINT        *47,PRPRDESC:
                    *N,*47,PRPRADD1:
                    *N,*47,PRPRADD2:
                    *N,*47,PRPRADD3,*74,PRPRPOST:
                    *N,*47,PRPRTELP,*N,*N,ESC,"="
.
. ------- Print U/R or debtor number & doctor details on header -------
.
PIHED420 
.         BRANCH    VSCANPMI,PIHED430
.         PRINT     *1,"DEBTOR NUMBER";
.         GOTO      PIHED440
.
PIHED430  PRINT     *1,"U/R NUMBER";
.
PIHED440  PRINT     *69,PRCNINVN,*N,*1,VDEBTOR;
.
          COMPARE   ZERO,COPINV
          GOTO      PIHED450 IF EQUAL
          PRINT     *56,"COPY";
.
PIHED450  UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*70,CPDATE,*N,*N,*N:
                    *21,"PROVIDER : ",VSVDCNAM,SP3,VSVDPROV
.
. ------- Print Person Resp. for Account & Debtor details -------
.
          MOVE      VDEBNAME,PATNAME
          MOVE      VDEBADD3,PATADD3
          PRINT     *N,*13,VPRANAME,*53,PATNAME:
                    *N,*13,TMPRADD1,*53,VDEBADD1:
                    *N,*13,TMPRADD2,*53,VDEBADD2:
                    *N,*13,TMPRADD3,TMPRPOST,*53,PATADD3,VDEBPOST,*N,*N,*N:
                    "DATE",*11,"ITEM      DESCRIPTION",*45:
                    "NO.OF SERVICES  COST"
          MOVE      ONE,VLINENO
          GOTO      PIHED999                 * Return
.
.------------------------------------------------------------------------------
.         Lingard Layout
.------------------------------------------------------------------------------
PIHED500  REP       " 0",CPDATE
          PRINT     *N:
                    *2,VPRANAME,*43,VDEBNAME,*N:
                    *2,TMPRADD1,*43,VDEBADD1,*N:
                    *2,TMPRADD2,*43,VDEBADD2,*N:
                    *2,TMPRADD3,TMPRPOST,*43,VDEBADD3,VDEBPOST:
                    *N,*N,*N
.
.123456789012345  123456789012345678901234567890 (123456) PROVIDER # 1234567890
.         IF        VSCANPMI=1
            PRINT     *2,VDEBTOR,*16,CDATE,*26,AFUNDH,"/",AFNDMM:
                      *70,PRCNINVN,*N,*N:
                      *19,"MEDICAL SERVICES PROVIDED BY",*N:
                      *2,PMEDI,*19,VSVDCNAM,*50,"(",VSVDOCT,")":
                      *59,"PROVIDER ## ",VSVDPROV,*N
..        ELSE
..          PRINT     *2,VDEBTOR,*16,CDATE,*26,PRDBFUND,"/",PRDBTABL:
..                    *70,PRCNINVN,*N,*N:
..                    *19,"MEDICAL SERVICES PROVIDED BY",*N:
..                    *2,PRDBMEDN,*19,VSVDCNAM,*50,"(",VSVDOCT,")":
..                    *59,"PROVIDER ## ",VSVDPROV,*N
.         ENDIF
.
          MATCH     SP3,CLAIMTYP
          GOTO      PIHED590 IF EQUAL       * No claim details
.
.123 CLAIM # 12345678901234567890 DATE 11/11/1111 EMPLOYER 12345678901234567890
          PRINT     *2,CLAIMTYP," CLAIM ## ",CLAIMNUM;
.
          MATCH     "VA ",CLAIMTYP
          GOTO      PIHED590 IF EQUAL       * Dont print date for vet affairs 
.
          PRINT     *35,"DATE ",CLAIMDTE;
.
          MATCH     "WC ",CLAIMTYP
          GOTO      PIHED590 IF NOT EQUAL   * Print employer for workers comp
.
          SETLPTR   EMPLNAME,20
          PRINT     *51,"EMPLOYER ",*+,EMPLNAME,*-;
          SETLPTR   EMPLNAME
.
PIHED590  PRINT     *N,*N
          ADD       ONE,VLINENO
          GOTO      PIHED999
.
.------------------------------------------------------------------------------
.         Modbury Layout
.------------------------------------------------------------------------------
.
PIHED600  PRINT     *N,*N,*N                 * 3 blank lines on top of invoice
.
. ------- Print address on invoice ? -------
.
          BRANCH    PRCNADDR,PIHED610
.
          PRINT     *N,*60,PRCNTELE,*N,*N,*N,*N:
                    *60,PRCNNAME,*N,*N,*N,*N
          GOTO      PIHED620
.
PIHED610  PRINT     *47,PRPRDESC:
                    *N,*47,PRPRADD1:
                    *N,*47,PRPRADD2:
                    *N,*47,PRPRADD3,*74,PRPRPOST:
                    *N,*47,PRPRTELP,*N,*N,*N,*N,*N
.
. ------- Print Person Resp. for Account & Debtor details -------
.
PIHED620  PRINT     *1,VPRANAME,*42,VDEBNAME:
                    *N,TMPRADD1,*42,VDEBADD1:
                    *N,TMPRADD2,*42,VDEBADD2:
                    *N,TMPRADD3,VPRAPOST,*42,VDEBADD3,VDEBPOST:
                    *N,*N,*N
.
. ------- Print rest of invoice header -------
.
.         BRANCH    VSCANPMI,PIHED630
.         PRINT     *1,"DB:";
.         GOTO      PIHED640
PIHED630  PRINT     *1,"UR:";
PIHED640  PRINT     VDEBTOR,*69,PRCNINVN,*N:
                    *N,"MEDICAL SERVICES PROVIDED BY ",VSVDCNAM:
                       *58," (",VSVDOCT,") ":
                    *N,*30,PRIMTYPE,*70,XDAY,SLASH,XMON,SLASH,XYEAR:
                    *N,*30,"PROVIDER ## ",VSVDPROV:
                    *N,*N,"DATE",*11,"ITEM      DESCRIPTION":
                       *45,"NO.OF SERVICES  COST",*N
          MOVE      ONE,VLINENO
          GOTO      PIHED999
.
.------------------------------------------------------------------------------
.         St.Edmonds Layout
.------------------------------------------------------------------------------
PIHED700  
.
. ------- Print Person Resp. for Account & Debtor details -------
.
          PRINT     *N,*N,*3,VPRANAME,*44,VDEBNAME:
                    *N,*3,TMPRADD1,*44,VDEBADD1:
                    *N,*3,TMPRADD2,*44,VDEBADD2:
                    *N,*3,TMPRADD3,SP1,TMPRPOST,*44,VDEBADD3,SP1,VDEBPOST:
                    *N,*N,*N
.
.         BRANCH    VSCANPMI,PIHED730       * skip if processing a U/R number
..          PRINT     *3,"D ",VDEBTOR,*43,"M",PRDBMEDN;
.         GOTO      PIHED740
.
.------ we are processing a U/R Number ------
.
PIHED730  PRINT     *3,"U ",VDEBTOR,*43,"M",PMEDI;
.
.------ see if we are copying an invoice ------
.
PIHED740  COMPARE   ZERO,COPINV
          GOTO      PIHED750 IF EQUAL
          PRINT     *58,"COPY";
.
.------ print the rest of the header details ------
.
PIHED750  PRINT        *71,PRCNINVN,*N:
                    *N,*16,VSVDCNAM:
                    *N,*16,PRIMTYPE,*71,XDAY,SLASH,XMON,SLASH,XYEAR:
                    *N,*16,"PROVIDER ## ",VSVDPROV,*N,*N,*N
.
          MATCH     SP3,CLAIMTYP            * see if we have claim details
          GOTO      PIHED770 IF EQUAL
.
          PRINT     *N,*3,CLAIMTYP,SP1,"Claim ## : ",CLAIMNUM,SP1;
.
          MATCH     "VA ",CLAIMTYP          * see if we have a veterans affairs
          GOTO      PIHED760 IF EQUAL         claim
.
          PRINT     *38,"Accident Date : ",CLAIMDTE;
.
          MATCH     "WC ",CLAIMTYP          * see if we have a workers 
          GOTO      PIHED760 IF NOT EQUAL     compensation claim
.
          PRINT     *N,*7,"Employer's Name : ",EMPLNAME;
          ADD       ONE,VLINENO
.
.------ print blank lines after the claim details ------
.
PIHED760  PRINT     *N,*N;
          ADD       THREE,VLINENO
.
.------ increment the line counter ------
.
PIHED770  ADD       ONE,VLINENO
          GOTO      PIHED999
.
.------------------------------------------------------------------------------
.         West Wimmera Layout     
.------------------------------------------------------------------------------
PIHED800  PRINT     *N,*N,*52,"         INVOICE         ":
                    *N,*N,*N   * blank lines on top
.
          CALL      IBACLOCK
          PRINT     *53,PRCNINVN,*70,CDD,SLASH,CMM,SLASH,CCC,XYEAR *today's date
.
          PRINT     *N,*N,*N
.
PIHED820  PRINT       *11,VPRANAME,*52,VDEBNAME:
                   *N,*11,TMPRADD1,*52,VDEBADD1:
                   *N,*11,TMPRADD2,*52,VDEBADD2:
                   *N,*11,TMPRADD3,*52,VDEBADD3:
                   *N,*37,TMPRPOST,*75,VDEBPOST:
                   *N,*N,*N
.
.          PRINT     *3,"DEBTOR NO.",*N
          PRINT     *3,"DEBTOR NO."
.         BRANCH    VSCANPMI,PIHED830       * skip if processing a U/R number
.         PRINT     *5,VDEBTOR;
.         GOTO      PIHED840
.
.------ we are processing a U/R Number ------
.
PIHED830  PRINT     *3,"U ",VDEBTOR;
.
.------ see if we are copying an invoice ------
.
PIHED840  COMPARE   ZERO,COPINV
          GOTO      PIHED850 IF EQUAL
          PRINT     *62,"COPY";
.
.------ print the rest of the header details ------
.
PIHED850  PRINT        *71,PRCNINVN,*N,*N,*N,*N:      
                    *N,*3,"Medical Services Provided By :":
                    *N,*5,VSVDPROV,*17,VSVDCNAM,*N
          ADD       THREE,VLINENO
.
          MATCH     SP3,CLAIMTYP            * see if we have claim details
          GOTO      PIHED999 IF EQUAL
.
.          PRINT     *N,*3,CLAIMTYP,SP1,"Claim ## : ",CLAIMNUM,SP1;
          PRINT     *3,CLAIMTYP,SP1,"Claim ## : ",CLAIMNUM,SP1,*N
          ADD       TWO,VLINENO
.
          MATCH     "VA ",CLAIMTYP          * see if we have a veterans affairs
          GOTO      PIHED999 IF EQUAL         claim
.
          PRINT     *38,"Accident Date : ",CLAIMDTE
          ADD       ONE,VLINENO
.
          MATCH     "WC ",CLAIMTYP          * see if we have a workers 
          GOTO      PIHED999 IF NOT EQUAL     compensation claim
.
          PRINT     *3,"Employer's Name : ",EMPLNAME
          ADD       ONE,VLINENO
.
.
PIHED999  ADD       ONE,VLINENO
          RETURN
.
.**********************************************************************
.*                                PRDOC000                            *
.*            Routine to print the referring doctor details           *
.**********************************************************************
PRDOC000  BRANCH    FLAGBULK,PRDOC999       * skip if bulk billing the patient
.
          BRANCH    PRCNLAYT,PRDOC800,PRDOC999,PRDOC300,PRDOC400,PRDOC500:
                             PRDOC600,PRDOC700,PRDOC800,PRDOC400
.
. ------- Standard Layout -------
.
          MATCH     SP20,TMPOPS             * see if the operations exist
          GOTO      PRDOC050 IF EQUAL
.
          PRINT     *N,*3,"SURGEON : ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*3,"OPERATION/S : ",TMPOPS,*N
          ADD       FOUR,VLINENO
          GOTO      PRDOC999
.
.------ print the referral details ------
.
PRDOC050  PRINT     *N,*3,"REFERRED BY ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*3,"REF. DETAILS : ",VREFERD:
                    *N,*3,"REFERRAL DATE : ",REFDATE,*N
          ADD       FIVE,VLINENO
          GOTO      PRDOC999
.
. ------- Warburton Layout -------
.
PRDOC100  MATCH     SP20,TMPOPS             * see if operations exist
          GOTO      PRDOC150 IF EQUAL
.
          PRINT     *N,*1,"SURGEON : ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*1,"OPERATION/S : ",TMPOPS,*N
          ADD       FOUR,VLINENO
          GOTO      PRDOC999
.
.------ print the referral details ------
.
PRDOC150  PRINT     *N,*1,"REFERRED BY ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*1,"REF. DETAILS : ",VREFERD:
                    *N,*1,"REFERRAL DATE : ",REFDATE,*N
          ADD       FIVE,VLINENO
          GOTO      PRDOC999
.
. ------- HRH Layout -------
.
PRDOC200  MATCH     SP20,TMPOPS             * see if the operations exist
          GOTO      PRDOC250 IF EQUAL
.
          PRINT     *N,*1,"SURGEON : ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*1,"OPERATION/S : ",TMPOPS,*N
          ADD       FOUR,VLINENO
          GOTO      PRDOC999
.
.------ print the referral details ------
.
PRDOC250  PRINT     *N,*1,"REFERRED BY ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*1,"REF. DETAILS : ",VREFERD:
                    *N,*1,"REFERRAL DATE : ",REFDATE,*N
          ADD       FIVE,VLINENO
          GOTO      PRDOC999
.
. ------- Melbourne Clinic Layout -------
.
PRDOC300  MATCH     SP20,TMPOPS             * see if the operations exist
          GOTO      PRDOC350 IF EQUAL
.
          PRINT     *N,*3,"SURGEON : ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*3,"OPERATION/S : ",TMPOPS,*N
          ADD       FOUR,VLINENO
          GOTO      PRDOC999
.
.------ print the referral details ------
.
PRDOC350  PRINT     *N,*3,"REFERRED BY ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*3,"REF. DETAILS : ",VREFERD:
                    *N,*3,"REFERRAL DATE : ",REFDATE,*N
          ADD       FIVE,VLINENO
          GOTO      PRDOC999
.
. ------- RCH Layout -------
.
PRDOC400  IF        VLINENO > 24
            WHILE     VLINENO < 29
              PRINT   *C
              ADD     ONE,VLINENO
            DO
            CALL      PCNTI000
            MOVE      ZERO,VLINENO
            CALL      PIHED005
          ENDIF
          PRINT     *N,*1,"REFERRED BY ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*1,"REF. DETAILS : ",VREFERD:
                    *N,*1,"REFERRAL DATE : ",REFDATE,*N
          ADD       FIVE,VLINENO
          GOTO      PRDOC999
.
. ------- Lingard Layout -------
.
PRDOC500  PRINT     *N:
                    *2,"REFERRED BY ",VRFDCNAM:
                    *40,"PROVIDER ## ",VRFDPROV,*N:
                    *2,"REFERRAL DATE : ",REFDATE:
                    *40,"REFERRAL PERIOD : ",RPERIOD,*N
          ADD       FOUR,VLINENO
          GOTO      PRDOC999
.
. ------- The Modbury Layout -------
.
PRDOC600  MATCH     SP20,TMPOPS             * see if operations exist
          GOTO      PRDOC650 IF EQUAL
.
          PRINT     *N,*1,"SURGEON : ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*1,"OPERATION/S : ",TMPOPS,*N
          ADD       FOUR,VLINENO
          GOTO      PRDOC999
.
.------ print the referral details ------
.
PRDOC650  PRINT     *N,*1,"REFERRED BY ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*1,"REF. DETAILS : ",VREFERD:
                    *N,*1,"REFERRAL DATE : ",REFDATE,*N
          ADD       FIVE,VLINENO
          GOTO      PRDOC999
.
. ------- St.Edmonds Layout -------
.
PRDOC700  MATCH     SP20,TMPOPS             * see if the operations exist
          GOTO      PRDOC750 IF EQUAL
.
          PRINT     *N,*3,"SURGEON : ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*3,"OPERATION/S : ",TMPOPS,*N
          ADD       FOUR,VLINENO
          GOTO      PRDOC999
.
.------ print the referral details ------
.
PRDOC750  PRINT     *N,*3,"REFERRED BY ",VRFDCNAM,"(",VRFDOCT:
                          ") - PROVIDER ## ",VRFDPROV:
                    *N,*3,"REF. DETAILS : ",VREFERD:
                    *N,*3,"REFERRAL DATE : ",REFDATE,*N
          ADD       FIVE,VLINENO
          GOTO      PRDOC999
.
. ------- West Wimmera Layout -------
.
PRDOC800  MATCH     SP20,TMPOPS             * see if the operations exist
          GOTO      PRDOC850 IF EQUAL
.
          IF        PRCNLAYT=1
            PRINT     *N,*3,"SURGEON : ",VRFDCNAM,"(",VRFDOCT:
                      ") - PROVIDER ## ",VRFDPROV:
                    *N,*3,"OPERATION/S : ",TMPOPS," LENGTH OF REF: ",VREFRPER,*N
            ADD       THREE,VLINENO
          ELSE
            PRINT     *N,*3,"SURGEON : ",VRFDCNAM,"(",VRFDOCT:
                      ") - PROVIDER ## ",VRFDPROV:
                      *N,*3,"OPERATION/S : ",TMPOPS,*N
            ADD       THREE,VLINENO
          ENDIF
          GOTO      PRDOC999
.
.------ print the referral details ------
.
PRDOC850  IF        PRCNLAYT=1
            PRINT     *N,*3,"Referred By : ",VRFDCNAM," Provider No: ",VRFDPROV:
.                    *N,*17," (",VRFDOCT,") on ",REFDATE,*N
               *N,*17," (",VRFDOCT,") on ",REFDATE,"   Length of Ref: ",VREFRPER
            ADD       THREE,VLINENO
          ELSE
            PRINT     *N,*3,"Referred By : ",VRFDCNAM:
.                    *N,*17," (",VRFDOCT,") on ",REFDATE,*N
                 *N,*17," (",VRFDOCT,") on ",REFDATE
            ADD       THREE,VLINENO
          ENDIF
.
PRDOC999  RETURN
+
.**********************************************************************
.*                              PRINV000                              *
.*            Routine to print the current transaction                *
.**********************************************************************
PRINV000  BRANCH    FLAGBULK,PRINV999       * skip if bulk billing the patient
          MOVE      ZERO,GSTTOTAL
          CALL      CNTIV000                * check for invoice continuation
.
.------ set up the details to be printed ------
.
PRINV050  UNPACK    PRDTSDAT,CCENT,CYEAR,CMON,CDAY 
          MOVE      PRDTAMNT,PLINTOT         
          MOVE      PRDTGSTM,LINGSTA
.
          MOVE      SP1,ITEMCHAR
          MOVE      PRDTDESC,DESCITEM
          MOVE      PRDTITMN,PRITEM
          ENDSET    PRITEM
.
.------ test current character for a space ------
.
PRINV083  CMATCH    SP1,PRITEM
          GOTO      PRINV085 IF NOT EQUAL
          BUMP      PRITEM,-1               * bump backwards
          GOTO      PRINV083 IF NOT EOS
.
.------ see if we have a sub-item ------
.
PRINV085  MATCH     SP3,PRDTSUBN
          GOTO      PRINV090 IF EQUAL
          APPEND    "(",PRITEM
          APPEND    PRDTSUBN,PRITEM
          APPEND    ")",PRITEM
.
.------ see if we have an inpatient or an outpatient ------
.
PRINV090  MATCH     SP3,TMPPIND             * see if the patient indicator
          GOTO      PRINV100 IF EQUAL         exists
.
          PACK      KEY5,CODEGI,TMPPIND
          CALL      RDCODE1                 * read patient codes file
          BRANCH    OVRCD,PRINV100
.
          MATCH     ANSI,TCINDC1            * see if we have an inpatient
          GOTO      PRINV092 IF EQUAL
.
          MATCH     ANSO,TCINDC1
          IF        @EQUAL
            MATCH     ANSI,TCINDC3
            GOTO      PRINV092 IF EQUAL     * Inpatient Other Hospital
          ENDIF
.
          GOTO      PRINV100
.
PRINV092  MOVE      ASK,ITEMCHAR
.
.------ branch on the invoice layout ------
.
PRINV100  APPEND    ITEMCHAR,PRITEM
          APPEND    SP20,PRITEM
          RESET     PRITEM
.
          BRANCH    PRCNLAYT,PRINV900:   * SJOG
                             PRINV200:   * Cabrini
                             PRINV400:   * Melbourne Clinic
                             PRINV500:   * RCH
                             PRINV600:   * Lingard
                             PRINV700:   * Modbury
                             PRINV800:   * St. Edmonds
                             PRINV900:   * West Wimmera
                             PRINV500    * SVHM (as per RCH)
.
.------------------------------------------------------------------------------
.         Standard layout
.------------------------------------------------------------------------------
          BRANCH    PRDTRTYP,PRINV110,PRINV140,PRINV170  * branch on the 
.                                                          transaction type
. ------- Miscellaneous Item -------
.
PRINV110  PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*12,PRITEM,SP1,DESCITEM;
.
          MOVE      PRDTIAMT,FORM82
          COMPARE   ZERO,PLINTOT            * see if the line total is zero
          GOTO      PRINV120 IF EQUAL
.
          IF        IBCNUGST=2
            MOVE      PLINTOT,FORM8P2
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *77,PRDTSERV," X",FORM82,*95,PLINTOT:
                        *106,LINGSTA,*122,FORM8P2;
            ELSE
              PRINT     *N;
              ADD       ONE,VLINENO                
              CALL      CNTIV000        * check for invoice continuation
              PRINT     *12,PRDTSERV," X",FORM82,*36,PLINTOT:
                        *49,LINGSTA,*68,FORM8P2;
            ENDIF
          ELSE
            PRINT     *49,PRDTSERV," X",FORM82,*68,PLINTOT;
          ENDIF
.
          GOTO      PRINV125
.
.------ line total is zero so don't print it ------
.
PRINV120  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *77,PRDTSERV," X",FORM82;
          ELSE
            PRINT     *49,PRDTSERV," X",FORM82;
          ENDIF
.
.------ see if we are printing the service time ------
.
PRINV125  COMPARE   ONE,PRPRTIME            
          GOTO      PRINV190 IF NOT EQUAL  
.
          UNPACK    PRDTSTIM,XHOUR,ANS,XMIN   
          PRINT     *N;
          ADD       ONE,VLINENO                
          CALL      CNTIV000        * check for invoice continuation
          PRINT     *3,"@ ",XHOUR,ANS,XMIN;
          GOTO      PRINV190
.
. ------- Cash Receipt -------
.
PRINV140  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *13,PRDTITMN,SP1,PRDTDESC,*58,PRDTRECN,*122,PLINTOT;
          ELSE
            PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *13,PRDTITMN,SP1,PRDTDESC,*58,PRDTRECN,*68,PLINTOT;
          ENDIF
          ADD       PLINTOT,PINVPAID         
          GOTO      PRINV190
.
. ------- see if we are printing journals on the invoice -------
.
PRINV170  COMPARE   ONE,PRCNJOUR   
          GOTO      PRINV190 IF NOT EQUAL 
.
          MOVE      PLINTOT,FORM8P2
          ADD       PLINTOT,PINVPAID         * Add to paid amount
.
          IF        IBCNUGST=2 
            ADD       LINGSTA,PINVPAID
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT    *3,CDAY,SLASH,CMON,SLASH,CYEAR,*13,PRDTITMN,SP1,PRDTDESC:
                       *122,FORM8P2;
              MATCH     "1",PRCNPJCI
              IF        @EQUAL
                PRINT     *13,ANSJ,ANSN,ANSL,SP1,PRDTTTYP;
                ADD       ONE,VLINENO
              ENDIF
              GOTO     PRINV190
            ENDIF
          ENDIF
          PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*13,PRDTITMN,SP1,PRDTDESC:
                    *68,FORM8P2;
          MATCH     "1",PRCNPJCI
          IF        @EQUAL
            PRINT     *13,ANSJ,ANSN,ANSL,SP1,PRDTTTYP;
            ADD       ONE,VLINENO
          ENDIF
.
.------ we have finished printing this transaction ------
.
PRINV190  PRINT     SP1
          ADD       PLINTOT,PINVTOT
          ADD       LINGSTA,PINVTOT
          ADD       LINGSTA,GSTTOTAL
          ADD       ONE,VLINENO     
          GOTO      PRINV999
.
.------------------------------------------------------------------------------
.         Cabrini layout
.------------------------------------------------------------------------------
PRINV200  PACK      DIM28,PRDTDESC           * Truncate Description
          MOVE      PRITEM,DIM10             * Truncate Description
          BRANCH    PRDTRTYP,PRINV210,PRINV220,PRINV230
.
. ------- Miscellaneous Item -------
.
PRINV210  MOVE      DIM28,DIM25
          PRINT     *1,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR,*12,DIM10,*23,PRDTDESC
.
          ADD       ONE,VLINENO               * One extra line for time
          CALL      CNTIV000                  * check for invoice continuation
          IF        PRPRTIME=1
            UNPACK    PRDTSTIM,XHOUR,ANS,XMIN   * Set up print variables
            PRINT     *1,"@ ",XHOUR,ANS,XMIN;  * Print service time on next line
          ENDIF
.
          MOVE      PRDTIAMT,FORM82
          MOVE      PLINTOT,FORM8P2
          ADD       LINGSTA,FORM8P2
          PRINT     *11,PRDTSERV,*17,"@",*19,FORM82,*36,PLINTOT:
                    *48,LINGSTA,*68,FORM8P2;
          GOTO      PRINV240
.
. ------- Cash Receipt -------
.
PRINV220  MOVE      PRDTDESC,KEY30
          STRIP     KEY30
          ENDSET    KEY30
          APPEND    PRDTRECN,KEY30
          APPEND    SP70,KEY30
          RESET     KEY30
          PRINT     *1,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR:
                    *23,PRDTDESC,PRDTRECN
          ADD       ONE,VLINENO               * One extra line for time
          CALL      CNTIV000                  * check for invoice continuation
          PRINT     *68,PLINTOT;
          ADD       PLINTOT,PINVPAID         * Add to paid amount
          GOTO      PRINV240
.
. ------- Journal -------
.
PRINV230  COMPARE   ONE,PRCNJOUR             * Print journal ?
          GOTO      PRINV240 IF NOT EQUAL    * No - finished
.
          MOVE      PLINTOT,FORM8P2
          ADD       PLINTOT,PINVPAID         * Add to paid amount
.
          ADD       LINGSTA,PINVPAID
          ADD       LINGSTA,FORM8P2
          PRINT     *1,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR:
                    *23,DIM28;
          ADD       ONE,VLINENO               * One extra line for time
          CALL      CNTIV000                  * check for invoice continuation
.
          MATCH     "1",PRCNPJCI
          IF        @EQUAL
            PRINT     *N;
            PRINT     *23,ANSJ,ANSN,ANSL,SP1,PRDTTTYP;
.           ADD       ONE,VLINENO
          ENDIF
          PRINT     *68,FORM8P2;
.
PRINV240  PRINT     SP1                      * Jump down to next line
          ADD       PLINTOT,PINVTOT          * Add line total to invoice total
          ADD       LINGSTA,PINVTOT
          ADD       LINGSTA,GSTTOTAL
          ADD       ONE,VLINENO                * One more line printed
.
          GOTO      PRINV999
.
.------------------------------------------------------------------------------
.         HRH layout
.------------------------------------------------------------------------------
.------ branch on the transaction type ------
.
PRINV300  BRANCH    PRDTRTYP,PRINV310,PRINV340,PRINV370
.
. ------- Miscellaneous Item -------
.
PRINV310  PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR,*10,PRITEM,SP1,DESCITEM;
.
          MOVE      PRDTIAMT,FORM82
          COMPARE   ZERO,PLINTOT             * see if the total is zero
          GOTO      PRINV320 IF EQUAL        
.
          IF        IBCNUGST=2
            MOVE      PLINTOT,FORM8P2
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *77,PRDTSERV," X",FORM82,*95,PLINTOT:
                        *106,LINGSTA,*122,FORM8P2;
            ELSE
              PRINT     *N;
              ADD       ONE,VLINENO                
              CALL      CNTIV000        * check for invoice continuation
              PRINT     *10,PRDTSERV," X",FORM82,*36,PLINTOT:
                        *47,LINGSTA,*68,FORM8P2;
            ENDIF
          ELSE
            PRINT     *47,PRDTSERV," X",FORM82,*66,PLINTOT;
          ENDIF
          GOTO      PRINV325
.
.------ line total is zero so don't print it ------
.
PRINV320  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *77,PRDTSERV," X",FORM82;
          ELSE
            PRINT     *47,PRDTSERV," X",FORM82;
          ENDIF
.
.------ see if we are printing the service time ------
.
PRINV325  COMPARE   ONE,PRPRTIME            
          GOTO      PRINV390 IF NOT EQUAL  
.
          UNPACK    PRDTSTIM,XHOUR,ANS,XMIN  
          PRINT     *N;
          ADD       ONE,VLINENO              
          CALL      CNTIV000        * check for invoice continuation
          PRINT     "@ ",XHOUR,ANS,XMIN; 
          GOTO      PRINV390
.
. ------- Cash Receipt -------
.
PRINV340  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *11,PRDTITMN,SP1,PRDTDESC,*56,PRDTRECN,*122,PLINTOT;
          ELSE
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *11,PRDTITMN,SP1,PRDTDESC,*56,PRDTRECN,*66,PLINTOT;
          ENDIF
          ADD       PLINTOT,PINVPAID         
          GOTO      PRINV390
.
. ------- see if we are printing journals on the invoice -------
.
PRINV370  COMPARE   ONE,PRCNJOUR             
          GOTO      PRINV390 IF NOT EQUAL   
.
          MOVE      PLINTOT,FORM8P2
          ADD       PLINTOT,PINVPAID         * Add to paid amount
.
          IF        IBCNUGST=2 
            ADD       LINGSTA,PINVPAID
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT    *1,CDAY,SLASH,CMON,SLASH,CYEAR,*11,PRDTITMN,SP1,PRDTDESC:
                        *122,FORM8P2;
              GOTO      PRINV390
            ENDIF
          ENDIF
.
          PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR,*11,PRDTITMN,SP1,PRDTDESC:
                    *66,FORM8P2;
.
.------ we have finished printing the current transaction ------
.
PRINV390  PRINT     SP1                   
          ADD       PLINTOT,PINVTOT      
          ADD       LINGSTA,PINVTOT
          ADD       LINGSTA,GSTTOTAL
          ADD       ONE,VLINENO           
          GOTO      PRINV999
.
.------------------------------------------------------------------------------
.         Melbourne Clinic layout
.------------------------------------------------------------------------------
PRINV400  MOVE      PRDTDESC,PDESC18
.
          BRANCH    PRDTRTYP,PRINV410,PRINV440,PRINV470   * branch on the 
.                                                           transaction type
. ------- Miscellaneous Item -------
.
PRINV410  PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *26,PDESC18,*46,"(",PRITEM,")";
.
          MOVE      PRDTIAMT,FORM82
          COMPARE   ZERO,PLINTOT             * see if the total is zero
          GOTO      PRINV420 IF EQUAL        
.
          IF        IBCNUGST=2
            MOVE      PLINTOT,FORM8P2
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *84,FORM82,*95,PLINTOT:
                        *106,LINGSTA,*122,FORM8P2;
            ELSE
              PRINT     *N;
              ADD       ONE,VLINENO                
              CALL      CNTIV000        * check for invoice continuation
              PRINT     *26,FORM82,*38,PLINTOT:
                        *58,LINGSTA,*70,FORM8P2;
            ENDIF
          ELSE
            PRINT     *58,FORM82,*70,PLINTOT;
          ENDIF
          GOTO      PRINV425
.
.------ line total is zero so don't print it ------
.
PRINV420  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *117,FORM82;
          ELSE
            PRINT     *58,FORM82;
          ENDIF
.
.------ see if we are printing the service time ------
.
PRINV425  COMPARE   ONE,PRPRTIME            * see if we are printing the
          GOTO      PRINV490 IF NOT EQUAL     service time on the invoice
.
          UNPACK    PRDTSTIM,XHOUR,ANS,XMIN 
          PRINT     *N;
          ADD       ONE,VLINENO                
          CALL      CNTIV000        * check for invoice continuation
          PRINT     *3,"@ ",XHOUR,ANS,XMIN;
          GOTO      PRINV490
.
. ------- Cash Receipt -------
.
PRINV440  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*26,PDESC18:
                      *46,"(",PRDTITMN,")",*58,PRDTRECN,*122,PLINTOT;
          ELSE
            PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*26,PDESC18:
                      *46,"(",PRDTITMN,")",*58,PRDTRECN,*70,PLINTOT;
          ENDIF
          ADD       PLINTOT,PINVPAID         
          GOTO      PRINV490
.
. ------- see if we are printing journals on the invoice -------
.
PRINV470  COMPARE   ONE,PRCNJOUR  
          GOTO      PRINV490 IF NOT EQUAL
.
          MOVE      PLINTOT,FORM8P2
          ADD       PLINTOT,PINVPAID         * Add to paid amount
.
          IF        IBCNUGST=2 
            ADD       LINGSTA,PINVPAID
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*26,PDESC18,*122,FORM8P2;
              GOTO      PRINV490
            ENDIF
          ENDIF
.
          PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*26,PDESC18,*70,FORM8P2;
.
.------ we have finished printing the current transaction ------
.
PRINV490  PRINT     *N;     
          ADD       PLINTOT,PINVTOT
          ADD       LINGSTA,PINVTOT
          ADD       LINGSTA,GSTTOTAL
          ADD       ONE,VLINENO     
          GOTO      PRINV999
.
.------------------------------------------------------------------------------
.         RCH layout
.------------------------------------------------------------------------------
PRINV500  PACK      DIM28,PRDTDESC           * Truncate Description
          MOVE      PRITEM,DIM10             * Truncate Description
          BRANCH    PRDTRTYP,PRINV510,PRINV520,PRINV530
.
. ------- Miscellaneous Item -------
.
PRINV510  MOVE      DIM28,DIM25
          PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR,*11,DIM10,*21,DIM25;
.
          MOVE      PRDTIAMT,FORM82
          COMPARE   ZERO,PLINTOT             * Is the amount zero ?
          GOTO      PRINV511 IF EQUAL        * Yes - skip print
.
          IF        IBCNUGST=2
            MOVE      PLINTOT,FORM8P2
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *77,PRDTSERV," X",FORM82,*95,PLINTOT:
                        *106,LINGSTA,*122,FORM8P2;
            ELSE
              PRINT     *N;
              ADD       ONE,VLINENO                
              CALL      CNTIV000        * check for invoice continuation
              PRINT     *11,PRDTSERV," X",FORM82,*36,PLINTOT:
                        *47,LINGSTA,*68,FORM8P2;
            ENDIF
          ELSE
            PRINT     *46,PRDTSERV," X ",FORM82,*68,PLINTOT;
          ENDIF
          GOTO      PRINV512
.
PRINV511  IF        IBCNUGST=2 | PTCNINVB=0
            PRINT     *N;
            ADD       ONE,VLINENO                
            CALL      CNTIV000        * check for invoice continuation
          ENDIF
.
PRINV512  COMPARE   ONE,PRPRTIME             * Print service time as well ?
          GOTO      PRINV540 IF NOT EQUAL    * No - skip print
.
          UNPACK    PRDTSTIM,XHOUR,ANS,XMIN   * Set up print variables
          PRINT     *N;
          ADD       ONE,VLINENO               * One extra line for time
          CALL      CNTIV000                  * check for invoice continuation
          PRINT     "@ ",XHOUR,ANS,XMIN;  * Print service time on next line
          GOTO      PRINV540
.
. ------- Cash Receipt -------
.
PRINV520  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *11,DIM10,*21,DIM28,*56,PRDTRECN,*122,PLINTOT;
          ELSE
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *11,DIM10,*21,DIM28,*56,PRDTRECN,*68,PLINTOT;
          ENDIF
          ADD       PLINTOT,PINVPAID         * Add to paid amount
          GOTO      PRINV540
.
. ------- Journal -------
.
PRINV530  COMPARE   ONE,PRCNJOUR             * Print journal ?
          GOTO      PRINV540 IF NOT EQUAL    * No - finished
.
          MOVE      PLINTOT,FORM8P2
          ADD       PLINTOT,PINVPAID         * Add to paid amount
.
          IF        IBCNUGST=2 
            ADD       LINGSTA,PINVPAID
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR,*11,DIM10:
                        *21,DIM28,*122,FORM8P2;
              GOTO      PRINV540
            ENDIF
          ENDIF
          PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR,*11,DIM10:
                    *21,DIM28,*68,FORM8P2;
.
PRINV540  PRINT     SP1                      * Jump down to next line
          ADD       PLINTOT,PINVTOT          * Add line total to invoice total
          ADD       LINGSTA,PINVTOT
          ADD       LINGSTA,GSTTOTAL
          ADD       ONE,VLINENO                * One more line printed
.
          GOTO      PRINV999
.
.------------------------------------------------------------------------------
.         Lingard layout
.------------------------------------------------------------------------------
PRINV600  MOVE      PRITEM,DIM10
          BRANCH    PRDTRTYP,PRINV610,PRINV620,PRINV630
.
. ------- Miscellaneous Item -------
.
.12/34/78 1234567890 1234567890123456789012345 12345 X 12345678.12 12345678.12
.
PRINV610  COMPARE   ZERO,PLINTOT             * Is the amount zero ?
          GOTO      PRINV612 IF EQUAL
.
          COMPARE   TWO,IBCNUGST
          GOTO      PRINV612 IF NOT EQUAL    * not using GST
.
          COMPARE   ONE,PTCNINVB
          GOTO      PRINV612 IF EQUAL        * using landscape
.
          IF        PRPRTIME=1
            IF        VLINENO=27
              PRINT     *N,*N;
              ADD       TWO,VLINENO
              CALL      CNTIV000        * check for invoice continuation
              GOTO      PRINV614
            ENDIF
          ENDIF
.
          GOTO      PRINV613
.
PRINV612  COMPARE   ONE,PRPRTIME             * Print service time as well ?
          GOTO      PRINV614 IF NOT EQUAL
.
PRINV613  IF        VLINENO=28
            PRINT     *N;
            ADD       ONE,VLINENO
            CALL      CNTIV000        * check for invoice continuation
          ENDIF
.
PRINV614  UNPACK    PRDTSDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      PRDTDESC,DIM25
          PRINT     *2,CDAY,SLASH,CMON,SLASH,CYEAR,*11,DIM10,*21,DIM25;
.
          MOVE      PRDTIAMT,FORM82
          COMPARE   ZERO,PLINTOT             * Is the amount zero ?
          GOTO      PRINV616 IF EQUAL        * Yes - skip print
.
          IF        IBCNUGST=2
            MOVE      PLINTOT,FORM8P2
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *77,PRDTSERV," X",FORM82,*95,PLINTOT:
                        *106,LINGSTA,*122,FORM8P2;
            ELSE
              PRINT     *N;
              ADD       ONE,VLINENO                
              CALL      CNTIV000        * check for invoice continuation
              PRINT     *12,PRDTSERV," X",FORM82,*36,PLINTOT:
                        *56,LINGSTA,*68,FORM8P2;
            ENDIF
          ELSE
            PRINT     *48,PRDTSERV," X ",*56,FORM82,*68,PLINTOT;
          ENDIF
.
PRINV616  COMPARE   ONE,PRPRTIME             * Print service time as well ?
          GOTO      PRINV640 IF NOT EQUAL    * No - skip print
.
          UNPACK    PRDTSTIM,XHOUR,ANS,XMIN  * Set up print variables
          PRINT     *N;
          ADD       ONE,VLINENO               * One extra line for time
          CALL      CNTIV000                  * check for invoice continuation
          PRINT     *3,"@ ",XHOUR,ANS,XMIN;   * Print service time
          GOTO      PRINV640
.
. ------- Cash Receipt -------
.
PRINV620  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *2,CDAY,SLASH,CMON,SLASH,CYEAR:
.                     *11,DIM10:
                      *21,PRDTDESC,*56,PRDTRECN,*122,PLINTOT;
          ELSE
            PRINT     *2,CDAY,SLASH,CMON,SLASH,CYEAR:
.                     *11,DIM10:
                      *21,PRDTDESC,*56,PRDTRECN,*68,PLINTOT;
          ENDIF
          ADD       PLINTOT,PINVPAID         * Add to paid amount
          GOTO      PRINV640
.
. ------- Journal -------
.
PRINV630  COMPARE   ONE,PRCNJOUR             * Print journal ?
          GOTO      PRINV640 IF NOT EQUAL    * No - finished
.
          MOVE      PLINTOT,FORM8P2
          ADD       PLINTOT,PINVPAID         * Add to paid amount
.
          IF        IBCNUGST=2 
            ADD       LINGSTA,PINVPAID
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *2,CDAY,SLASH,CMON,SLASH,CYEAR:
.                       *11,DIM10:
                        *21,PRDTDESC,*122,FORM8P2;
              GOTO      PRINV640
            ENDIF
          ENDIF
.
          PRINT     *2,CDAY,SLASH,CMON,SLASH,CYEAR:
.                   *11,DIM10:
                    *21,PRDTDESC,*68,FORM8P2;
.
PRINV640  PRINT     SP1                      * Jump down to next line
          ADD       PLINTOT,PINVTOT          * Add line total to invoice total
          ADD       LINGSTA,PINVTOT
          ADD       LINGSTA,GSTTOTAL
          ADD       ONE,VLINENO                * One more line printed
.
          GOTO      PRINV999
.
.------------------------------------------------------------------------------
.         The Modbury layout
.------------------------------------------------------------------------------
.------ branch on the transaction type ------
.
PRINV700  BRANCH    PRDTRTYP,PRINV710,PRINV740,PRINV770
.
. ------- Miscellaneous Item -------
.
PRINV710  PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR,*10,PRITEM,SP1,DESCITEM;
.
          MOVE      PRDTIAMT,FORM82
          COMPARE   ZERO,PLINTOT            * see if the total is zero
          GOTO      PRINV720 IF EQUAL     
.
          IF        IBCNUGST=2
            MOVE      PLINTOT,FORM8P2
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *77,PRDTSERV," X",FORM82,*95,PLINTOT:
                        *106,LINGSTA,*122,FORM8P2;
            ELSE
              PRINT     *N;
              ADD       ONE,VLINENO                
              CALL      CNTIV000        * check for invoice continuation
              PRINT     *12,PRDTSERV," X",FORM82,*36,PLINTOT:
                        *47,LINGSTA,*68,FORM8P2;
            ENDIF
          ELSE
            PRINT     *47,PRDTSERV," X",FORM82,*66,PLINTOT;
          ENDIF
.
          GOTO      PRINV725
.
.------ line total is zero so don't print it ------
.
PRINV720  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *77,PRDTSERV," X",FORM82;
          ELSE
            PRINT     *47,PRDTSERV," X",FORM82;
          ENDIF
.
.------ see if we are printing the service time ------
.
PRINV725  COMPARE   ONE,PRPRTIME            
          GOTO      PRINV790 IF NOT EQUAL  
.
          UNPACK    PRDTSTIM,XHOUR,ANS,XMIN 
          PRINT     *N;
          ADD       ONE,VLINENO             
          CALL      CNTIV000        * check for invoice continuation
          PRINT     "@ ",XHOUR,ANS,XMIN;
          GOTO      PRINV790
.
. ------- Cash Receipt -------
.
PRINV740  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *11,PRDTITMN,SP1,PRDTDESC,*56,PRDTRECN,*122,PLINTOT;
          ELSE
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *11,PRDTITMN,SP1,PRDTDESC,*56,PRDTRECN,*66,PLINTOT;
          ENDIF
          ADD       PLINTOT,PINVPAID
          GOTO      PRINV790
.
. ------- see if we are printing journals on the invoice -------
.
PRINV770  COMPARE   ONE,PRCNJOUR   
          GOTO      PRINV790 IF NOT EQUAL 
.
          MOVE      PLINTOT,FORM8P2
          ADD       PLINTOT,PINVPAID         * Add to paid amount
.
          IF        IBCNUGST=2 
            ADD       LINGSTA,PINVPAID
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                        *11,PRDTITMN,SP1,PRDTDESC,*122,FORM8P2;
              GOTO      PRINV790
            ENDIF
          ENDIF
          PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                    *11,PRDTITMN,SP1,PRDTDESC,*66,FORM8P2;
.
.------ we have finished printing the current transaction ------
.
PRINV790  PRINT     SP1                
          ADD       PLINTOT,PINVTOT     
          ADD       LINGSTA,PINVTOT
          ADD       LINGSTA,GSTTOTAL
          ADD       ONE,VLINENO        
. 
          GOTO      PRINV999
.
.------------------------------------------------------------------------------
.         St. Edmonds layout
.------------------------------------------------------------------------------
PRINV800  MOVE      PRDTDESC,PDESC18
.
          BRANCH    PRDTRTYP,PRINV810,PRINV840,PRINV870   * branch on the 
.                                                           transaction type
. ------- Miscellaneous Item -------
.
PRINV810  PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR:
                    *26,PDESC18,*46,"(",PRITEM,")";
.
          MOVE      PRDTIAMT,FORM82
          COMPARE   ZERO,PLINTOT             * see if the total is zero
          GOTO      PRINV820 IF EQUAL        
.
          IF        IBCNUGST=2
            MOVE      PLINTOT,FORM8P2
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *85,FORM82,*96,PLINTOT:
                        *107,LINGSTA,*122,FORM8P2;
            ELSE
              PRINT     *N;
              ADD       ONE,VLINENO                
              CALL      CNTIV000        * check for invoice continuation
              PRINT     *26,FORM82,*36,PLINTOT:
                        *58,LINGSTA,*70,FORM8P2;
            ENDIF
          ELSE
            PRINT     *58,FORM82,*70,PLINTOT;
          ENDIF
          GOTO      PRINV825
.
.------ line total is zero so don't print it ------
.
PRINV820  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *84,FORM82;
          ELSE
            PRINT     *58,FORM82;
          ENDIF
.
.------ see if we are printing the service time ------
.
PRINV825  COMPARE   ONE,PRPRTIME            * see if we are printing the
          GOTO      PRINV890 IF NOT EQUAL     service time on the invoice
.
          UNPACK    PRDTSTIM,XHOUR,ANS,XMIN 
          PRINT     *N;
          ADD       ONE,VLINENO                
          CALL      CNTIV000        * check for invoice continuation
          PRINT     *3,"@ ",XHOUR,ANS,XMIN;
          GOTO      PRINV890
.
. ------- Cash Receipt -------
.
PRINV840  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*26,PDESC18:
                      *49,"(",PRDTITMN,")",*61,PRDTRECN,*122,PLINTOT;
          ELSE
            PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*26,PDESC18:
                      *49,"(",PRDTITMN,")",*61,PRDTRECN,*72,PLINTOT;
          ENDIF
          ADD       PLINTOT,PINVPAID         
          GOTO      PRINV890
.
. ------- see if we are printing journals on the invoice -------
.
PRINV870  COMPARE   ONE,PRCNJOUR  
          GOTO      PRINV890 IF NOT EQUAL
.
          MOVE      PLINTOT,FORM8P2
          ADD       PLINTOT,PINVPAID         * Add to paid amount
.
          IF        IBCNUGST=2 
            ADD       LINGSTA,PINVPAID
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*26,PDESC18,*122,FORM8P2;
              GOTO      PRINV890
            ENDIF
          ENDIF
          PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*26,PDESC18,*70,FORM8P2;
.
.------ we have finished printing the current transaction ------
.
PRINV890  PRINT     *N;     
          ADD       PLINTOT,PINVTOT
          ADD       LINGSTA,PINVTOT
          ADD       LINGSTA,GSTTOTAL
          ADD       ONE,VLINENO     
          GOTO      PRINV999
.
.------------------------------------------------------------------------------
.         West Wimmera Layout
.------------------------------------------------------------------------------
.------ branch on the transaction type ------
.
PRINV900  BRANCH    PRDTRTYP,PRINV910,PRINV940,PRINV970
.
. ------- Miscellaneous Item -------
.
PRINV910  MOVE      PRDTDESC,KEY27
          PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*20,PRDTDESC;
.         PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*20,DESCITEM;
.PRINV910  PRINT     CDAY,SLASH,CMON,SLASH,CYEAR,*20,DESCITEM;
.
          MOVE      PRDTIAMT,FORM82
          IF        IBCNUGST=2
            MOVE      PLINTOT,FORM8P2
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *74,PRDTITMN,*85,FORM82,*96,PLINTOT:
                        *107,LINGSTA,*118,FORM8P2
            ELSE
              MOVE      FORM82,FORM7P2
              PRINT     *50,PRDTSERV,"X",FORM7P2;
              PRINT     *N;
              ADD       ONE,VLINENO                
              CALL      CNTIV000        * check for invoice continuation
              PRINT     *20,PRDTITMN,*30,FORM82,*43,PLINTOT:
                        *55,LINGSTA,*67,FORM8P2
            ENDIF
          ELSE
            PRINT     *52,PRDTITMN,*57,FORM82,*69,PLINTOT
          ENDIF
          ADD       ONE,VLINENO
.
.------ see if we are printing the service time ------
.
          COMPARE   ONE,PRPRTIME
          GOTO      PRINV930 IF NOT EQUAL
.
          CALL      CNTIV000
          UNPACK    PRDTSTIM,XHOUR,ANS,XMIN 
          PRINT     *3,"at ",XHOUR,ANS,XMIN
          ADD       ONE,VLINENO             
.
PRINV930  ADD       PLINTOT,PINVTOT
          ADD       LINGSTA,PINVTOT
          ADD       LINGSTA,GSTTOTAL
.
          COMPARE   "23",VLINENO
          GOTO      PRINV9999 IF EQUAL      * no need a blank line on last line
.
          PRINT     SP1
          ADD       ONE,VLINENO
          GOTO      PRINV999
.
. ------- Cash Receipt -------
.
PRINV940  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *11,PRDTITMN,SP1,PRDTDESC,SP1,PRDTRECN,*118,PLINTOT;
          ELSE
            IF        IBCNUGST=2
              PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                        *11,PRDTITMN,SP1,PRDTDESC,SP1,PRDTRECN,*67,PLINTOT;
            ELSE
              PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                        *11,PRDTITMN,SP1,PRDTDESC,SP1,PRDTRECN,*69,PLINTOT;
            ENDIF
          ENDIF
          ADD       PLINTOT,PINVPAID
          GOTO      PRINV990
.
. ------- see if we are printing journals on the invoice -------
.
PRINV970  COMPARE   ONE,PRCNJOUR   
          GOTO      PRINV990 IF NOT EQUAL 
.
          MOVE      PLINTOT,FORM8P2
          ADD       PLINTOT,PINVPAID         * Add to paid amount
.
          IF        IBCNUGST=2 
            ADD       LINGSTA,PINVPAID
            ADD       LINGSTA,FORM8P2
            IF        PTCNINVB=1
              PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                        *11,PRDTITMN,SP1,PRDTDESC,*118,FORM8P2;
              GOTO      PRINV990
            ENDIF
          ENDIF
.
          IF        IBCNUGST=2
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *11,PRDTITMN,SP1,PRDTDESC,*67,FORM8P2;
          ELSE
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *11,PRDTITMN,SP1,PRDTDESC,*69,FORM8P2;
          ENDIF
.
.------ we have finished printing the current transaction ------
.
PRINV990  ADD       PLINTOT,PINVTOT     
          ADD       LINGSTA,PINVTOT
          ADD       LINGSTA,GSTTOTAL
          PRINT     SP1                
          ADD       ONE,VLINENO         
.
PRINV999  RETURN
+
.**********************************************************************
.*                               TACLN000                             *
.*   Check Line before printing Worker/TAC details                    *
.**********************************************************************
TACLN000  MOVE      VLINENO,FORM3             * save current line no
.
          IF       PRCNLAYT=2
            MOVE     "28",F3                  * Cabrini layout
            GOTO     TACLN100
          ENDIF
.
          IF       PRCNLAYT=4 | PRCNLAYT=9
            MOVE     "30",F3
          ELSE
            IF        PRCNLAYT=8 | PRCNLAYT=1
              MOVE      "23",F3
            ELSE
              MOVE      "29",F3
            ENDIF
          ENDIF
.
TACLN100  COMPARE   F3,VLINENO
          GOTO      TACLN400 IF NOT LESS
.
          MATCH     "WC ",CLAIMTYP            * WorkCover claim
          IF        @EQUAL
             ADD      NINE,VLINENO
          ELSE
            MATCH     "TAC",CLAIMTYP            * TAC claim
            IF        @EQUAL
             ADD      TEN,VLINENO
            ENDIF
          ENDIF
          COMPARE   F3,VLINENO
          GOTO      TACLN900 IF LESS
.
          MOVE      FORM3,VLINENO            * restore current line number
.
.         Not enough space to print Workers Comp.details, print blank lines
.         to fill up the page
.
TACLN200  COMPARE   F3,VLINENO
          GOTO      TACLN400 IF EQUAL
.
          PRINT     *N;
          ADD       ONE,VLINENO
          GOTO      TACLN200
.
TACLN400  CALL      PCNTI000
.
          MOVE      ZERO,VLINENO
          CALL      PIHED005                * Print header
          IF        PRCNLAYT = 4|PRCNLAYT = 0|PRCNLAYT = 9
            PRINT     *C
            ADD       ONE,VLINENO
          ENDIF
          GOTO      TACLN999
.
TACLN900  MOVE      FORM3,VLINENO            * restore current line number
TACLN999  RETURN
+
.**********************************************************************
.*                               CNTIV000                             *
.*   Routine to check for invoice continuation                        *
.**********************************************************************
CNTIV000  COMPARE   TWO,PRCNLAYT
          GOTO      CNTIV200 IF EQUAL       * Cabrini
.
          IF        PRCNLAYT=4 | PRCNLAYT=9
            COMPARE   "30",VLINENO            * see if the invoice needs to be
            GOTO      CNTIV999 IF LESS        continued
            CALL      PCNTI000              * print invoice continuation
          ELSE
            IF        PRCNLAYT=8 | PRCNLAYT=1
               COMPARE   "23",VLINENO
               GOTO      CNTIV999 IF LESS
               CALL      PCNTI000
               GOTO      CNTIV100
            ENDIF
            COMPARE   "29",VLINENO            * see if the invoice needs to be
            GOTO      CNTIV999 IF LESS        continued
            CALL      PCNTI000              * print invoice continuation
          ENDIF
.
CNTIV100  MOVE      ZERO,VLINENO
          CALL      PIHED005                * Print header
          IF        PRCNLAYT = 4|PRCNLAYT = 0|PRCNLAYT = 9
            PRINT     *C
            ADD       ONE,VLINENO
          ENDIF
          GOTO      CNTIV999
.
.         Check for Cabrini Invoice continuation
.
CNTIV200  COMPARE   "28",VLINENO            * see if the invoice needs to be
          GOTO      CNTIV999 IF LESS          continued
.
          CALL      PCNTI000                * print invoice continuation
          MOVE      ZERO,VLINENO
          CALL      SINVH000                * set up header stationery code
          CALL      PRTPRIHL                * print templated invoice header
CNTIV999  RETURN
+
.**********************************************************************
.*                               UPINV000                             *
.*   Routine to update the invoice file with the transaction amount   *
.**********************************************************************
UPINV000  MOVE      PRCNINVN,KEY8
          CALL      RDPRIN1                 * read the private practice invoice
          BRANCH    OVRCD,UPINV999            file
          MOVE      PRDTTRAN,PRINTRAN
          MOVE      PRDTAMNT,FORM8P2
.
          ADD       FORM8P2,PRINITOT
          ADD       FORM8P2,PRINPEND
.
          IF        IBCNUGST=2
            MOVE      PRDTGSTM,FORM8P2
            ADD       FORM8P2,PRINGSTA      * Total of GST amount
            ADD       FORM8P2,PRINITOT
            ADD       FORM8P2,PRINPEND
          ENDIF
.
          PACK      PRINUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PRINUDAT           * date updated
          CLOCK     TIME,PRINUTIM           * time updated
          MOVE      USERID,PRINUUID         * web user id
          CALL      UPPRIN1                 * update the private practice 
.                                             invoice file
.                                                                     *I-210835
          IF        PRINSCAN = 1
            PROC      FLAGDEBP                * Flag PMI Outstanding Debt
          ENDIF
.
UPINV999  RETURN
+
.**********************************************************************
.*                                PCNTI000                            *
.*      This routine prints that the invoice is to be continued       *
.*      on the next page                                              *
.**********************************************************************
PCNTI000  CALL      SINVT000                * set up tail stationery code
          MOVE      ONE,MPGEFLAG            * indicate multipage
          CALL      PRTPRITL                * print templated invoice tail
          PRINT     *N;
          RETURN
+
. ------- branch on the invoice layout -------
.
.>>>> PCNTI000  BRANCH    PRCNLAYT,PCNTI100,PCNTI200,PCNTI300,PCNTI400,PCNTI500:
.>>>>                              PCNTI600,PCNTI700,PCNTI800,PCNTI400
.                                                         
. ------- Standard layout -------
.
PCNTI005  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *N,*3,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*118,"************",*N,*N,*N,*N:
                      *N,*118,"************",*N:
                      *N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME:
                      *N,*N,*N,*N,*N,*N,*N
          ELSE
            PRINT     *N,*3,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*70,"************",*N,*N,*N,*N:
                      *N,*70,"************",*N:
                      *N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME:
                      *N,*N,*N,*N,*N,*N,*N
          ENDIF
          GOTO      PCNTI999
.
. ------- Warburton Layout -------
.
PCNTI100  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *N,*N,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*118,"************",*N,*N,*N,*N:
                      *N,*118,"************",*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME:
                      *N,*N,*N,*N,*N
          ELSE
            PRINT     *N,*N,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*68,"************",*N,*N,*N,*N:
                      *N,*68,"************",*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME:
                      *N,*N,*N,*N,*N
          ENDIF
          GOTO      PCNTI999
.
. ------- HRH Layout -------
.
PCNTI200  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *N,*N,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*118,"************",*N,*N,*N,*N:
                      *N,*118,"************",*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME:
                      *N,*N,*N
          ELSE
            PRINT     *N,*N,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*68,"************",*N,*N,*N,*N:
                      *N,*68,"************",*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME:
                      *N,*N,*N
          ENDIF
          GOTO      PCNTI999
.
. ------- Melbourne Clinic Layout -------
.
PCNTI300  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *N,*N,*3,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*118,"************",*N,*N,*N,*N:
                      *N,*118,"************":
                      *N,*N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME:
                      *N,*N,*N,*N,*N,*N,*N
          ELSE
            PRINT     *N,*N,*3,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*70,"************",*N,*N,*N,*N:
                      *N,*70,"************":
                      *N,*N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME:
                      *N,*N,*N,*N,*N,*N,*N
          ENDIF
          GOTO      PCNTI999
.
. ------- RCH Layout -------
.
PCNTI400  COMPARE   "32",VLINENO
          IF        !@EQUAL
            PRINT     *N;
            ADD       ONE,VLINENO
            GOTO      PCNTI400
          ENDIF 
.
          IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     "*** INVOICE CONTINUED ON NEXT PAGE ***",*N,*N:
                      *N,*118,"***********",*N,*N:
                      *N,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*118,"***********",*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME,*N,*N;
          ELSE
            PRINT     "*** INVOICE CONTINUED ON NEXT PAGE ***",*N,*N:
                      *N,*66,"***********",*N,*N:
                      *N,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*66,"***********",*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME,*N,*N;
          ENDIF
.
.         BRANCH    VSCANPMI,PCNTI410
.         PRINT     *3,*N,"DEBTOR";
.         GOTO      PCNTI420
.
PCNTI410  PRINT     *3,*N,"U/R";
.
PCNTI420  PRINT     *11,VDEBTOR,*23,PRCNINVN,*N;
          GOTO      PCNTI999
.
. ------- Lingard Layout -------
.
PCNTI500  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *N:
                      *2,"*** Invoice Continued On Next Page ***",*N,*N:
                      *118,"*********.**",*N,*N,*N,*N:
                      *2,"*** Invoice Continued On Next Page ***",*N:
                      *118,"*********.**",*N,*N:
                      *2,CDATE,*13,VDEBNAME,*N,*N:
                      *118,"*********.**",*N:
                      *25,PRCNINVN,*45,VDEBTOR:
                      *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          ELSE
            PRINT     *N:
                      *2,"*** Invoice Continued On Next Page ***",*N,*N:
                      *67,"*********.**",*N,*N,*N,*N:
                      *2,"*** Invoice Continued On Next Page ***",*N:
                      *67,"*********.**",*N,*N:
                      *2,CDATE,*13,VDEBNAME,*N,*N:
                      *67,"*********.**",*N:
                      *25,PRCNINVN,*45,VDEBTOR:
                      *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          ENDIF
          GOTO      PCNTI999
.
. ------- Modbury Layout -------
.
PCNTI600  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *N,*N,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*118,"************",*N,*N,*N,*N:
                      *N,*118,"************",*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME:
                      *N,*N,*N,*N,*N
          ELSE
            PRINT     *N,*N,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*68,"************",*N,*N,*N,*N:
                      *N,*68,"************",*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME:
                      *N,*N,*N,*N,*N
          ENDIF
          GOTO      PCNTI999
.
. ------- St.Edmonds Layout -------
.
PCNTI700  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *N,*N,*3,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*70,"************",*N,*N,*N,*N:
                      *N,*70,"************":
                      *N,*N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME:
                      *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          ELSE
            PRINT     *N,*N,*3,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*118,"************",*N,*N,*N,*N:
                      *N,*118,"************":
                      *N,*N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME:
                      *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          ENDIF
          GOTO      PCNTI999
.
. ------- West Wimmera layout -------
.
PCNTI800  MATCH     "VA ",CLAIMTYP
          IF    @EQUAL
              PRINT     *N
          ENDIF
          IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *3,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*N,*118,"************",*N,*N,*N,*N,*N,*N,*N,*N
          ELSE
            PRINT     *3,"*** INVOICE CONTINUED ON NEXT PAGE ***":
                      *N,*N,*68,"************",*N,*N,*N,*N,*N,*N,*N,*N
          ENDIF
.
.         BRANCH    VSCANPMI,PCNTI850   * skip if printing UR No.
.
.         PRINT     *52,"DEBTOR NO.",*N
.         GOTO      PCNTI870
.
PCNTI850  PRINT     *52,"UR NUMBER",*N
.
PCNTI870  PRINT     *14,XDAY,SLASH,XMON,SLASH,XYEAR,*53,VDEBTOR,*67,PRCNINVN
          PRINT     *14,VPRANAME
          PRINT     *14,TMPRADD1,*N,*14,TMPRADD2
          IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *14,TMPRADD3,SP1,TMPRPOST:
                      *N,*N,*118,"************"
          ELSE
            PRINT     *14,TMPRADD3,SP1,TMPRPOST:
                      *N,*N,*68,"************"
          ENDIF
.
PCNTI999  RETURN
+
.**********************************************************************
.*                               PRITL000                             *
.*                 Routine to print the invoice tail                  *
.**********************************************************************
PRITL000  BRANCH    FLAGBULK,PRITL999       * skip if bulk billing the patient
.
          CALL      PRCSH000                * routine to print the cash 
          CALL      PRTAC000                * print WorkCover/TAC details
          COMPARE   TWO,PRCNLAYT
          GOTO      PRITL008 IF EQUAL       * Cabrini
.
          IF PRCNLAYT=4|PRCNLAYT=9
            GOTO      PRITL010
          ENDIF
.
          GOTO      PRITL020
.
PRITL008  COMPARE   "28",VLINENO              * see if we are at the correct
          GOTO      PRITL050 IF NOT LESS      position to print the inv. tail
          PRINT     *1
          ADD       ONE,VLINENO
          GOTO      PRITL008
.
PRITL010  COMPARE   "30",VLINENO              * see if we are at the correct
          GOTO      PRITL050 IF NOT LESS      position to print the inv. tail
          PRINT     *1
          ADD       ONE,VLINENO
          GOTO      PRITL010
.                                             deposits for this invoice
PRITL020  IF        PRCNLAYT=8 | PRCNLAYT=1
.            COMPARE   "18",VLINENO
             COMPARE   "23",VLINENO
             GOTO      PRITL050 IF NOT LESS
             PRINT     *1
             ADD       ONE,VLINENO
             GOTO      PRITL020
          ELSE
             COMPARE   "29",VLINENO              * see if we are at the correct
             GOTO      PRITL050 IF NOT LESS      position to print the inv. tail
             PRINT     *1
             ADD       ONE,VLINENO
             GOTO      PRITL020
          ENDIF
.
.------ set up the date for the invoice tail ------
.
PRITL050  MOVE      CDD,XDAY
          MOVE      CMM,XMON
          REP       " 0",XDAY
          REP       " 0",XMON
.
          CALL      SINVT000                * set up tail stationery code
          MOVE      ZERO,MPGEFLAG           * indicate single/last page
          CALL      PRTPRITL                * print templated invoice tail
          PRINT     *N;
          COMPARE   TWO,PRCNLAYT
          RETURN    IF EQUAL
.
.         IF        PRCNLAYT=4 | PRCNLAYT=8 | PRCNLAYT=9
          IF        PRCNLAYT=4 | PRCNLAYT=9 
             IF        PRCNLAYT<>9
               PRINT     *F;
             ENDIF
             DISPLAY   *W;          * DO NOT remove, it's needed for ORACLE
          ENDIF
          RETURN
.
PRITL060
.
.------------------------------------------------------------------------------
.         Standard layout (St. Andrews War Memorial)
.------------------------------------------------------------------------------
          PRINT     *3,PMLINE1,*N,*3,PMLINE2,*N:
                    *N,*67,PINVTOT,*N,*N,*N,*N:
                    *N,*67,PINVTOT,*N:
                    *N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME,*N,*N
.
.         BRANCH    VSCANPMI,PRITL070       * skip if printing a U/R Number
.         PRINT     *13,"DB:",VDEBTOR,*25,PRCNINVN
.         GOTO      PRITL090
.
.------ we are printing a U/R Number ------
.
PRITL070  PRINT     *13,"UR:",VDEBTOR,*25,PRCNINVN
.
.------ we have finished printing the invoice tail ------
.
PRITL090  PRINT     *N,*N
          GOTO      PRITL999
.
.------------------------------------------------------------------------------
.         Warburton layout
.------------------------------------------------------------------------------
PRITL100  PRINT     *1,PMLINE1,*N,PMLINE2:
                    *N,*66,PINVTOT,*N,*N,*N,*N:
                    *N,*35,PRCNNAME,*67,PRINITOT:
                    *N,*N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME,*66,PINVPAID,*N
.
.         BRANCH    VSCANPMI,PRITL120       * skip if printing the U/R Number
.         PRINT     *11,"DEBTOR NUMBER";
.         GOTO      PRITL130
.
.------ we are printing a U/R Number ------
.
PRITL120  PRINT     *11,"U/R NUMBER";
.
.------ print the rest of the invoice tail ------
.
PRITL130  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *118,PINVTOT:
                      *N,*11,VDEBTOR,*23,PRINITOT,*N,*N,*N
          ELSE
            PRINT     *66,PINVTOT:
                      *N,*11,VDEBTOR,*23,PRINITOT,*N,*N,*N
          ENDIF
          GOTO      PRITL999
.
.------------------------------------------------------------------------------
.         HRH Layout
.------------------------------------------------------------------------------
PRITL200  SUB       CURRDEP,PINVTOT
          IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *1,PMLINE1,*N,PMLINE2:
                      *N,*N,*118,PINVTOT,*N,*N,*N,*N:
                      *N,*35,PRCNNAME,*118,PINVTOT,*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME,*N
          ELSE
            PRINT     *1,PMLINE1,*N,PMLINE2:
                      *N,*N,*66,PINVTOT,*N,*N,*N,*N:
                      *N,*35,PRCNNAME,*66,PINVTOT,*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME,*N
          ENDIF
.
.         BRANCH    VSCANPMI,PRITL210       * branch if we are printing a U/R
.         PRINT     *11,"DEBTOR NUMBER"
.         GOTO      PRITL220
.
.------ we are printing a U/R Number ------
.
PRITL210  PRINT     *11,"U/R NUMBER"
.
.------ print the rest of the invoice tail ------
.
PRITL220  PRINT     *11,VDEBTOR,*23,PRCNINVN,*N;
          GOTO      PRITL999
.
.------------------------------------------------------------------------------
.         Melbourne Clinic Layout
.------------------------------------------------------------------------------
PRITL300  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *3,PMLINE1:
                      *N,*3,PMLINE2:
                      *N,*N,*118,PINVTOT,*N,*N:
                      *N,*3,CNAME,SP1,PRCNADD1:
                      *N,*3,PRCNADD2,SP1,PRCNPOST,SLASH,SHORTDOC:
                      *N,*118,PINVTOT:
                      *N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME,*N,*N
          ELSE
            PRINT     *3,PMLINE1:
                      *N,*3,PMLINE2:
                      *N,*N,*69,PINVTOT,*N,*N:
                      *N,*3,CNAME,SP1,PRCNADD1:
                      *N,*3,PRCNADD2,SP1,PRCNPOST,SLASH,SHORTDOC:
                      *N,*69,PINVTOT:
                      *N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME,*N,*N
          ENDIF
.
          PRINT     *13,VDEBTOR,*25,PRCNINVN,*N,*N,*N,*N,*N
          GOTO      PRITL999
.
.------------------------------------------------------------------------------
.         RCH layout
.------------------------------------------------------------------------------
PRITL400  SUB       CURRDEP,PINVTOT                    * removed two *N
          IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *N,*1,PMLINE1,*N,PMLINE2:        
                      *N,*N,*118,PINVTOT,*N,*N,*N:
                      *N,*35,PRCNNAME,*118,PINVTOT:
                      *N,*N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME:
                      *118,PINVPAID,*N,*N,*118,PINVTOT
          ELSE
            PRINT     *N,*1,PMLINE1,*N,PMLINE2:        
                      *N,*N,*66,PINVTOT,*N,*N,*N:
                      *N,*35,PRCNNAME,*66,PINVTOT:
                      *N,*N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME:
                      *66,PINVPAID,*N,*N,*66,PINVTOT
          ENDIF
.
PRITL410  
.         BRANCH    VSCANPMI,PRITL420
.         PRINT     *3,"DEBTOR";
.         GOTO      PRITL430
.
PRITL420  PRINT     *3,"U/R";
.
PRITL430  PRINT     *11,VDEBTOR,*23,PRCNINVN,*F;
          GOTO      PRITL999
.
.------------------------------------------------------------------------------
.         Lingard layout
.------------------------------------------------------------------------------
PRITL500  ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINGSTJ),PINVTOT          * Amount outstanding
          IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *1,PMLINE1,*N,*1,PMLINE2,*N,*N:
                      *118,PINVTOT,*N,*N,*N,*N,*N:
                      *118,PRINITOT,*N,*N:
                      *2,CDATE,*13,VDEBNAME,*118,PINVPAID,*N,*N:
                      *118,PINVTOT,*N:
                      *25,PRCNINVN,*45,VDEBTOR:
                      *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          ELSE
            PRINT     *1,PMLINE1,*N,*1,PMLINE2,*N,*N:
                      *67,PINVTOT,*N,*N,*N,*N,*N:
                      *67,PRINITOT,*N,*N:
                      *2,CDATE,*13,VDEBNAME,*67,PINVPAID,*N,*N:
                      *67,PINVTOT,*N:
                      *25,PRCNINVN,*45,VDEBTOR:
                      *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          ENDIF
          GOTO      PRITL999
.
.------------------------------------------------------------------------------
.         Modbury layout
.------------------------------------------------------------------------------
PRITL600  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *1,PMLINE1,*N,PMLINE2:
                      *N,*N,*118,PINVTOT,*N,*N,*N,*N:
                      *N,*35,PRCNNAME,*118,PINVTOT,*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME,*N
          ELSE
            PRINT     *1,PMLINE1,*N,PMLINE2:
                      *N,*N,*66,PINVTOT,*N,*N,*N,*N:
                      *N,*35,PRCNNAME,*66,PINVTOT,*N:
                      *N,XDAY,SLASH,XMON,SLASH,XYEAR,*12,VDEBNAME,*N
          ENDIF
.
.         BRANCH    VSCANPMI,PRITL620       * skip if printing the U/R Number
.         PRINT     *11,"DEBTOR NUMBER";
.         GOTO      PRITL630
.
.------ we are printing a U/R Number ------
.
PRITL620  PRINT     *11,"U/R NUMBER";
.
.------ print the rest of the invoice tail ------
.
PRITL630  PRINT     *N,*11,VDEBTOR,*23,PRINITOT,*N
          GOTO      PRITL999
.
.------------------------------------------------------------------------------
.         St.Edmonds Layout
.------------------------------------------------------------------------------
PRITL700  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *3,PMLINE1:
                      *N,*3,PMLINE2:
                      *N,*N,*118,PINVTOT,*N,*N:
                      *N,*3,CNAME,SP1,PRCNADD1:
                      *N,*3,PRCNADD2,SP1,PRCNPOST,SLASH,SHORTDOC:
                      *N,*118,PINVTOT:
                      *N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME,*N,*N
          ELSE
            PRINT     *3,PMLINE1:
                      *N,*3,PMLINE2:
                      *N,*N,*69,PINVTOT,*N,*N:
                      *N,*3,CNAME,SP1,PRCNADD1:
                      *N,*3,PRCNADD2,SP1,PRCNPOST,SLASH,SHORTDOC:
                      *N,*69,PINVTOT:
                      *N,*3,XDAY,SLASH,XMON,SLASH,XYEAR,*14,VDEBNAME,*N,*N
          ENDIF
.
          PRINT     *13,VDEBTOR,*25,PRCNINVN,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N 
          GOTO      PRITL999
.
.------------------------------------------------------------------------------
.         West Wimmera Layout                         
.------------------------------------------------------------------------------
PRITL800  PRINT     *2,PMLINE1
          PRINT     *2,PMLINE2,*N
          IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *N,*N,*118,PINVTOT
          ELSE
            PRINT     *N,*N,*68,PINVTOT
          ENDIF
.
          PRINT     *N,*N,*N,*N,*N,*N,*N,*N
.
.         BRANCH    VSCANPMI,PRITL850       * skip if printing a U/R Number
.  
.         PRINT     *52,"DEBTOR NO. ",*N
.         PRINT     *14,XDAY,SLASH,XMON,SLASH,XYEAR,*53,VDEBTOR,*67,PRCNINVN
.         PRINT     *14,VPRANAME
.         PRINT     *14,TMPRADD1,*N,*14,TMPRADD2
.         PRINT     *14,TMPRADD3,SP1,TMPRPOST
.          
          GOTO      PRITL890
.
.------ we are printing a U/R Number ------
.
PRITL850  PRINT     *52,"UR NUMBER",*N
          PRINT     *14,XDAY,SLASH,XMON,SLASH,XYEAR,*53,VDEBTOR,*67,PRCNINVN
          PRINT     *14,VPRANAME
          PRINT     *14,TMPRADD1,*N,*14,TMPRADD2
          PRINT     *14,TMPRADD3,SP1,TMPRPOST;
.
.------ we have finished printing the invoice tail ------
.
PRITL890  IF        IBCNUGST=2 & PTCNINVB=1
            PRINT     *N,*118,PINVTOT,*F;
          ELSE
            PRINT     *N,*68,PINVTOT,*F;
          ENDIF
.
.
PRITL999  RETURN
+
.**********************************************************************
.*                               PRCSH000                             *
.*    Routine to print the cash deposits on the body of the invoice   *
.**********************************************************************
PRCSH000  BRANCH    CRDNFLAG,PRCSH999
          OPEN      RCPDTEA1,"rcpdteaf"
.
          MOVE      ZERO,FRSTFLAG
          COMPARE   ZERO,CURRDEP            * see if we have some deposits 
          GOTO      PRCSH080 IF EQUAL         to print
.
          MOVE      ONE,FRSTFLAG
          MOVE      SP70,KEY1
          READ      TMPCASH,ZERO;;          * position to the start of the
          CALL      CNTIV000                  * check for invoice continuation
.         PRINT     *N;
.         ADD       ONE,VLINENO
.
.------ read through the cash deposits ------
.
PRCSH040  READ      TMPCASH,SEQ;CMDERECN,CMDETCNT,RCDTAMNT
          GOTO      PRCSH080 IF OVER
.
          PACK      KEY17,CMDERECN,CMDETCNT   * make sure correct receipt
          CALL      RDRCDTE1
          BRANCH    OVRCD,PRCSH040
          MATCH     CMDERECN,RCDTRECN
          GOTO      PRCSH040 IF NOT EQUAL
          MATCH     RCDTURNO,VDEBTOR
          GOTO      PRCSH040 IF NOT EQUAL
.
          MULT      SEQ,RCDTAMNT
          UNPACK    RCDTTDAT,CCENT,CYEAR,CMON,CDAY
.
          PACK      KEY12,RCDTRECN
          CALL      RDRCBNK1
          BRANCH    OVRCD,PRCSH040
          GOTO      PRCSH120
.
.         Check for nonbanked
.
PRCSH080  COMPARE   ZERO,NBNKDEPS
          GOTO      PRCSH999 IF EQUAL
.
          MOVE      TWO,FRSTFLAG
          COMPARE   ZERO,CURRDEP            * see if we have some deposits 
          GOTO      PRCSH090 IF NOT EQUAL
.
          CALL      CNTIV000                  * check for invoice continuation
.         PRINT     *N;
.         ADD       ONE,VLINENO
.
PRCSH090  MOVE      "*",KEY1
          OPEN      RCPDTEA3,"rcpdteaf"
          OPEN      RCPREGA1,"rcpregaf" 
          PACK      KEY12,SP4,PRCNINVN,SP70
          PACK      KEY29,KEY12,SP70
          CALL      RSRCDTE3
PRCSH100  CALL      RKRCDTE3
          BRANCH    OVRCD,PRCSH9999
.
          PACK      KEY12,SP4,PRCNINVN,SP70
          MATCH     KEY12,RCDTINVN
          GOTO      PRCSH999 IF NOT EQUAL
.
          MATCH     RCDTURNO,VDEBTOR
          GOTO      PRCSH100 IF NOT EQUAL
.
          MATCH     SP70,RCDTRELD             * has been released?
          GOTO      PRCSH100 IF NOT EQUAL
.
          PACK      KEY3,RCDTREGI,SP70
          CALL      RDREGA1
          BRANCH    OVRCD,PRCSH100
.
          COMPARE   "2",REGIBACD
          GOTO      PRCSH110 IF EQUAL       * Private Practice
          COMPARE   "96",REGIBACD
          GOTO      PRCSH100 IF NOT EQUAL   * not PRI Deposit
.
.------ print the current cash deposit ------
.
PRCSH110  MULT      SEQ,RCDTAMNT
          UNPACK    RCDTTDAT,CCENT,CYEAR,CMON,CDAY
.
          PACK      KEY12,RCDTRECN
          CALL      RDRCBNK1
          BRANCH    OVRCD,PRCSH100
          MATCH     "1",RCBNSTAT            * check if cancelled
          GOTO      PRCSH100 IF EQUAL
.
PRCSH120  CALL      CNTIV000                  * check for invoice continuation
          MOVE      RCDTAMNT,FORM8P2
          UNPACK    RCDTRECN,KEY4,KEY8
.
          MOVE      SP70,PRDTDESC
          CLEAR     PRDTDESC
.
          MATCH     SP70,RCDTDPTY
          GOTO      PRCSH140 IF NOT EQUAL
.
          MOVE      "P",KEY1
          MOVE      RCBNTTYP,F1
          LOAD      KEY1,F1,ANSH,ANSI,ANSG,ANSH
          MATCH     "H",KEY1
          IF        @EQUAL
            APPEND    "FROM HEALTH FUND ",PRDTDESC
          ELSE
            MATCH     "I",KEY1
            IF        @EQUAL
              APPEND    "FROM INSURANCE  ",PRDTDESC
            ELSE
              APPEND    "FROM PATIENT    ",PRDTDESC
            ENDIF
          ENDIF
          APPEND    RCBNRCOD,PRDTDESC
          GOTO      PRCSH160
.
PRCSH140  PACK      KEY5,ANSD,ANSP,RCDTDPTY,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            APPEND    "DEPOSIT - ",PRDTDESC
            APPEND    TDESC,PRDTDESC
          ENDIF
.
PRCSH160  APPEND    SP70,PRDTDESC
          RESET     PRDTDESC
.
          BRANCH    PRCNLAYT,PRCSH200,PRCSH300,PRCSH400,PRCSH500:
                             PRCSH600,PRCSH700,PRCSH800,PRCSH200:
                             PRCSH500
.
          PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR:
                    *23,PRDTDESC,*58,KEY8,KEY1,*68,FORM8P2
          GOTO      PRCSH900
.
PRCSH200  IF        IBCNUGST=2
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *21,PRDTDESC,*52,KEY8,KEY1,*67,FORM8P2
          ELSE
            PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                      *21,PRDTDESC,*52,KEY8,KEY1,*69,FORM8P2
          ENDIF
          GOTO      PRCSH900
.
.         Cabrini
.
PRCSH300  PRINT     *1,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR:
                    *23,PRDTDESC,KEY8,KEY1,*68,FORM8P2
          GOTO      PRCSH900
.
PRCSH400  PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*26,PRDTDESC:
                    *58,KEY8,KEY1,*70,FORM8P2
          GOTO      PRCSH900
.
.         RCH/SVHM
.
PRCSH500  PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                    *21,PRDTDESC,*56,KEY8,KEY1,*68,FORM8P2
          GOTO      PRCSH900
.
PRCSH600  PRINT     *2,CDAY,SLASH,CMON,SLASH,CYEAR:
                    *21,PRDTDESC,*56,KEY8,KEY1,*68,FORM8P2
          GOTO      PRCSH900
.
PRCSH700  PRINT     *1,CDAY,SLASH,CMON,SLASH,CYEAR:
                    *21,PRDTDESC,*56,KEY8,KEY1,*66,FORM8P2
          GOTO      PRCSH900
.
PRCSH800  PRINT     *3,CDAY,SLASH,CMON,SLASH,CYEAR,*26,PRDTDESC:
                    *61,KEY8,KEY1,*72,FORM8P2
          GOTO      PRCSH900
.
PRCSH900  ADD       ONE,VLINENO
          BRANCH    FRSTFLAG,PRCSH040,PRCSH100
PRCSH999  RETURN
+
.**********************************************************************
.*                               PRTAC000                             *
.*    Routine to print the WorkCover and TAC Details on the body of   *
.*    invoice                                                         *
.**********************************************************************
PRTAC000  MATCH     "WC ",CLAIMTYP            * WorkCover claim
          GOTO       PRTAC100 IF EQUAL        * Yes, print WC Details
.
          MATCH     "TAC",CLAIMTYP            * TAC claim
          GOTO       PRTAC300 IF EQUAL        * Yes, print TAC details
.
          GOTO       PRTAC999                 * Exit for all others
.
.------- Print WorkCover details
PRTAC100  OPEN      PATIN1A1,"patin1af"
          PACK      KEY6,PRWCICOD
          CALL      RDINSR1                   * Get insurer details
          IF        OVRCD=1
            MOVE    SP70,INAME
            MOVE    SP70,IADD1
            MOVE    SP70,IADD2
            MOVE    SP70,IADD3
            MOVE    SP70,IPOST
          ENDIF
. 
          CALL      TACLN000        * check for invoice continuation
.
          PRINT     *N;
          PRINT     *N,*3,"Claim Number     : ",PRWCCLMN;
          PRINT     *N,*3,"Date of Accident : ",CLAIMDTE;
          PRINT     *N,*3,"Employer:",*37,"Insurance Company:";
.
          PRINT     *N,*3,PRWCNAME,*37,INAME;
          PRINT     *N,*3,PRWCADD1,*37,IADD1;
          PRINT     *N,*3,PRWCADD2,*37,IADD2;
          PRINT     *N,*3,PRWCADD3,*30,PRWCPOST,*37,IADD3,*72,IPOST;
          PRINT     *N;
.
          ADD       NINE,VLINENO
          GOTO      PRTAC999
.
.------- Print TAC details
.
PRTAC300  CALL      TACLN000        * check for invoice continuation
.
          PRINT     *N;
          PRINT     *N,*3,"TAC Claim Number : ",PRMAREFN;
          PRINT     *N,*3,"Date of Accident : ",CLAIMDTE;
          PRINT     *N,*3,"Solicitor Details:";
          PRINT     *N,*3,PRMASOLN;
          PRINT     *N,*3,PRMASAD1;
          PRINT     *N,*3,PRMASAD2;
          PRINT     *N,*3,PRMASAD3,*32,PRMASPCD;
          PRINT     *N,*3,PRMASOLT;
          PRINT     *N;
.
          ADD       TEN,VLINENO
          GOTO      PRTAC999
.
PRTAC999  RETURN
+

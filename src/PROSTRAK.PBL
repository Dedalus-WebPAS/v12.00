.------------------------------------------------------------
. File       : PROSTRAK.PBL
.
. Functions  : This file contains the routine to
.              write to the Prosthetic Tracking Detail File
.
. Routines   : PROTRK00  - Writes to Prosthetic Tracking Detail File
.            : DELPTH00  - Delete pmspthaf records that don't have 
.                          corresponding pmsptdaf records.
.
. Variables  : Inputs  - DIM1 : Transaction Type (A)Add (C)Change (D)Delete
.------------------------------------------------------------
.  V10.01.01 03/12/2010  Mike Laming     CAR 233046
.            Mods to "patmchgf" - replaced GETMCS00 with PATMCHRD
.  V9.11.02  12/12/2008 Steve Armstrong  CAR 181373
.            Mods to only use current date to populate PMPETRDT & PMPETRTM
.  V9.11.01  20/11/2008 Steve Armstrong  CAR 181373
.            Added population of PMPEDTRN and load PMPEGSTM with zero.
.------------------------------------------------------------
.  V9.09.01  31/01/2008 Peter Vela CAR 155334
.            Created include
.------------------------------------------------------------
PROTRK00  MATCH   "1",PTCNTRPR
          GOTO    PROTRK99 IF NOT EQUAL
.
          MATCH   "3",PMMIRTYP
          GOTO    PROTRK99 IF NOT EQUAL
.
          CALL    GETMSC00
          BRANCH  EXIT,PROTRK99
.
          MATCH   "1",PTMCPRTR
          GOTO    PROTRK99 IF NOT EQUAL
.
          CALL    CLPMSPTD
.
.         MATCH   SP70,PMMIDUPD
.         IF      @EQUAL | @EOS
            CALL    IBACLOCK
            PACK    PMPETRDT,CCC,CYY,CMM,CDD
            REP     " 0",PMPETRDT
            PACK    PMPETRTM,CTIMEIS 
.         ELSE
.181373     MOVE    PMMIDUPD,PMPETRDT
.           MOVE    PMMITUPD,PMPETRTM
.         ENDIF
.
          MOVE    PMMIVISN,PMPEVISN
          MOVE    PMMITRAN,PMPETRAN
          MOVE    PMMIITEM,PMPEITEM
          MOVE    PMMIURNO,PMPEURNO
          MOVE    DIM1,PMPETRTY
          MOVE    PMMIDESC,PMPEIDES
          MOVE    PMMISERV,PMPESERV
          MOVE    PMMITDAT,PMPETDAT
          MOVE    PMMIAMTT,PMPEAMTT
          MOVE    PMMIAMTP,PMPEAMTP
          MOVE    PMMIRBAT,PMPERBAT
          MOVE    PMMIGSTC,PMPEGSTC
          MOVE    ZERO,PMPEGSTM
          MOVE    PMMIWUSR,PMPEWUSR
          MOVE    SP6,PMPEDTRN
.
          PACK    KEY30,PMPETRDT,PMPETRTM,PMPEVISN,PMPETRAN,SP70
          CALL    RAPMPTD1
          IF      OVRCD=1
            CALL    WRPMPTD1
          ENDIF
.
PROTRK99  RETURN
.

.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.04.02  01.07.2005 Peter Vela CAR 65641
.           Fixed I * L MAKSUM00
. V9.04.01  08.04.2005 Peter Vela CAR 59696
.           Changed commodity group from DIM 5 to DIM 6
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.01.02  23.05.2000 Charles Handaya
.           Fix Add Issue Unit to Reports
. VF.01.01  19.04.2000 Charles Handaya
.           Add Issue Unit to Reports  srf 638760
.           Change to standard Range Keyin
.           Add Export File feature for All Options
.-------------------------------------------------------
. VF.00.03  22.12.1999 Charles Handaya
.           Recompiled for Fixing Audit Date (CCYYMMDD)
. VF.00.02  03.11.1999 Sandra Barcham
.           Change locked message to use X
. VF.00.01  23.09.1999 B.G.Ackland
.           Clinical Costing Interface for Arthur Henderson
.-------------------------------------------------------
SP13      DIM       13
COSTTOT   FORM      10.2
COST12P6  FORM      12.6
GRANDTOT  FORM      10.2
GRAN12P6  FORM      12.6
PAGEBRKF  FORM      1
PRTFIRST  FORM      1
TEMPDESC  DIM       30
TEMPMAXQ  FORM      10.2
TEMPUNIT  FORM      10.2
TEMPEXTE  FORM      10.2
DETAILS   FORM      1
DETFOUND  FORM      1
DIM55     DIM       55
DIM51     DIM       51
STRCST    DIM       5
ENDCST    DIM       5
EXPORTF1  FILE      ASCII, FIXED=400
EXPORTF2  FILE      ASCII, FIXED=400
EXPORTFL  FILE      ASCII, FIXED=400
EXPORTFN  DIM       8
TABDELM   EQU       0x09
TEMPFILL  IFILE     SQL, FIXED=200, KEY="U1-5,6-11"                    *C-59696
.
TEMPCST    DIM       5
TEMPCOMM   DIM       6                                                 *C-59696
TEMPAMT    FORM      12.2
.
PRTAVC     DIM       14
PRTSOH     DIM       14
PRTTOT     DIM       14
TOTALCST   FORM      12.2
GRANDCST   FORM      12.2
HEADTYP    FORM      1
F12        FORM      12
F12P4      FORM      12.4
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASIN77
.   Function      :   Imprest File Master Listing             
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       CEAPSCFD/INC
          INC       SINCCAFD/INC
          INC       SINCGAFD/INC
          INC       SINCIAFD/INC
          INC       SINCONFD/INC
          INC       SINIMPFD/INC
          INC       SINNATFD/INC
          INC       SINSUAFD/INC
          INC       SINTMPDF/INC
.=========================
.Local Variable Definition
.-------------------------
FROMCST   DIM      40 * Scr 01 Fld     4
TOCST     DIM      40 * Scr 01 Fld     5
EXPORTYN  FORM      1 * Scr 01 Fld     7
PRTSEQ    FORM      1 * Scr 01 Fld     9
ZEROSOH   FORM      1 * Scr 03 Fld     8
ZEROMAX   FORM      1 * Scr 03 Fld     9
COSTCOMP  FORM      1 * Scr 04 Fld     9
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASIN77"
PRGNAM    INIT      "Imprest File Master Listing             "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      ONAT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   24",AUDTSECT
          MOVE      "201",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudga";
            OPEN      SINAUDGA,"sinaudga"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "219",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudsa";
            OPEN      SINAUDSA,"sinaudsa"
          ENDIF
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA1,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA2,"sinccaaf"
          DISPLAY   *P56:24,"Opening sincgaaf";
          OPEN      SINCGAA1,"sincgaaf"
          DISPLAY   *P56:24,"Opening sincgaaf";
          OPEN      SINCGAA2,"sincgaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA1,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA2,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA3,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA1,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA2,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA3,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA1,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA2,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA3,"sinsuaaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Menu                          
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Print by Cost Centre               
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Print by Cost Centre Detailed      
          ENDIF
          MATCH     "03",SCRID
          IF         @EQUAL
            CALL       PS03L000   * Stock on Hand Report               
          ENDIF
          MATCH     "04",SCRID
          IF         @EQUAL
            CALL       PS04L000   * Costing System Update              
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Menu                          
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Menu                          
.-------------------------------------------------------
CF00L000
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Menu                          
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Menu                          
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Menu                          
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Menu                          
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Menu                          
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Menu                          
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L104,SF00L105
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      SC01L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
          CALL      SC03L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L105
          CALL      SC04L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Print by Cost Centre               
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
          CALL      SETSCR01
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Print by Cost Centre               
.-------------------------------------------------------
CF01L000
          MOVE      SP70,FROMCST 
          MOVE      SP70,TOCST   
          MOVE      ZERO,EXPORTYN
          MOVE      ZERO,PRTSEQ  
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Print by Cost Centre               
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Print by Cost Centre               
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Print by Cost Centre               
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Print by Cost Centre               
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Print by Cost Centre               
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L101:
                            PS01L102,PS01L999,PS01L103,PS01L999:
                           PS01L104
          GOTO     PS01L999
.
PS01L101
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      TOCST,VAR        
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L104
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTSEQ,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Print by Cost Centre               
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L103:
                            SF01L006,SF01L006,SF01L104,SF01L006:
                           SF01L105
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L103:
                            SF01L020,SF01L020,SF01L104,SF01L020:
                           SF01L105
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L102
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      PRNT0000
          MOVE      EXIT,SECTOR
          IF        SECTOR=0
            CALL      FRESCR00
            GOTO      SF01L999
          ENDIF
          IF        SECTOR=1
            CALL      FRESCR00
            MOVE      ZERO,EXIT
            GOTO      SF01L001
          ENDIF
          IF        SECTOR=2
            CALL      FRESCR00
            MOVE      ONE,EXIT
            GOTO      SF01L999
          ENDIF
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          IF        SECTOR=4
            CALL      DF01L000
          ENDIF
          GOTO      SF01L001
.
SF01L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCST   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RCOST000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L103
            ENDIF
            BRANCH    EXIT,SF01L103,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCST,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L104
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L105
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,PRTSEQ  
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTSEQ,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF01L001
SF01L990  MOVE      FOUR,EXIT * Exit Char Exit
SF01L999  RETURN
.--------------------------------
. Screen - Print by Cost Centre Detailed      
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
          CALL      SETSCR02
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Print by Cost Centre Detailed      
.-------------------------------------------------------
CF02L000
          MOVE      SP70,FROMCST 
          MOVE      SP70,TOCST   
          MOVE      ZERO,EXPORTYN
          MOVE      ZERO,PRTSEQ  
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Print by Cost Centre Detailed      
.--------------------------------------------------------
KY02L000
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Print by Cost Centre Detailed      
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Print by Cost Centre Detailed      
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Print by Cost Centre Detailed      
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Print by Cost Centre Detailed      
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L999,PS02L999,PS02L999,PS02L101:
                            PS02L102,PS02L999,PS02L103,PS02L999:
                           PS02L104
          GOTO     PS02L999
.
PS02L101
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      TOCST,VAR        
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTSEQ,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Print by Cost Centre Detailed      
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L101,SF02L102,SF02L103:
                            SF02L006,SF02L006,SF02L104,SF02L006:
                           SF02L105
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L103:
                            SF02L020,SF02L020,SF02L104,SF02L020:
                           SF02L105
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L102
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      PRNT0000
          MOVE      EXIT,SECTOR
          IF        SECTOR=0
            CALL      FRESCR00
            GOTO      SF02L999
          ENDIF
          IF        SECTOR=1
            CALL      FRESCR00
            MOVE      ZERO,EXIT
            GOTO      SF02L001
          ENDIF
          IF        SECTOR=2
            CALL      FRESCR00
            MOVE      ONE,EXIT
            GOTO      SF02L999
          ENDIF
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          IF        SECTOR=4
            CALL      DF02L000
          ENDIF
          GOTO      SF02L001
.
SF02L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCST   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RCOST000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L103
            ENDIF
            BRANCH    EXIT,SF02L103,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCST,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L104
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L105
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,PRTSEQ  
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTSEQ,FORM2     
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF02L001
SF02L990  MOVE      FOUR,EXIT * Exit Char Exit
SF02L999  RETURN
.--------------------------------
. Screen - Stock on Hand Report               
.--------------------------------
SC03L000
SC03L100
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC03L200
          CALL      CF03L000 * Clear Fields
          CALL      MVACCEPT
SC03L300
          CALL      KY03L000 * Enter Key Fields
          BRANCH    EXIT,SC03L999,SC03L999
SC03L400
          CALL      WP03L000 * Load any WP Details
SC03L500
          CALL      LM03L000 * Load any Batch Details
SC03L600
          CALL      DF03L000 * Display Fields
SC03L700
          CALL      SF03L000 * Select Fields
          BRANCH    EXIT,SC03L100,SC03L100,SC03L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC03L800
SC03L900
SC03L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Stock on Hand Report               
.-------------------------------------------------------
CF03L000
          MOVE      SP70,FROMCST 
          MOVE      SP70,TOCST   
          MOVE      ZERO,EXPORTYN
          MOVE      ZERO,ZEROSOH 
          MOVE      ZERO,ZEROMAX 
CF03L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Stock on Hand Report               
.--------------------------------------------------------
KY03L000
          MOVE      ZERO,EXIT
          GOTO      KY03L999
.
KY03L900  MOVE      ONE,EXIT
KY03L999  RETURN
.---------------------------------------------------------
. Load WP files for : Stock on Hand Report               
.---------------------------------------------------------
WP03L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Stock on Hand Report               
.---------------------------------------------------------
LM03L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Stock on Hand Report               
.---------------------------------------------------------
DF03L000
          BRANCH   ACCEPT,DF03L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF03L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF03L900
          MATCH    PRGID,SCPSPID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF03L010 IF NOT EQUAL
.
          CALL     PS03L000 * Display Field
          GOTO     DF03L010
DF03L900
DF03L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Stock on Hand Report               
.---------------------------------------------------------
PS03L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS03L999,PS03L999,PS03L999,PS03L101:
                            PS03L102,PS03L999,PS03L103,PS03L104:
                            PS03L105
          GOTO     PS03L999
.
PS03L101
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L102
          MOVE      TOCST,VAR        
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L103
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L104
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      ZEROSOH,FORM2    
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L105
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      ZEROMAX,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
PS03L999
          RETURN
.---------------------------------------------------------
. Selections for : Stock on Hand Report               
.---------------------------------------------------------
SF03L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF03L001  BRANCH   ACCEPT,SF03L020
.
SF03L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L006,SF03L101,SF03L102,SF03L103:
                            SF03L006,SF03L006,SF03L104,SF03L105:
                            SF03L106
SF03L006  BEEP
          GOTO     SF03L005
SF03L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF03L090
          MATCH    PRGID,SCSLPID
          GOTO     SF03L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF03L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L020,SF03L020,SF03L020,SF03L103:
                            SF03L020,SF03L020,SF03L104,SF03L105:
                            SF03L106
          GOTO     SF03L020
SF03L090  MOVE     ZERO,ACCEPT
          GOTO     SF03L001
.
SF03L101
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L102
          CALL      REPT0000
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCST   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RCOST000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L103
            ENDIF
            BRANCH    EXIT,SF03L103,SF03L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF03L990 IF EQUAL
          ENDIF
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCST,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF03L001
.
SF03L104
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L105
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,ANS
          REP        "0A1B",ANS
          REP        "A1B0",ANS
          MOVE       ANS,ZEROSOH 
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      ZEROSOH,FORM2    
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L106
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,ZEROMAX 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      ZEROMAX,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
SF03L990  MOVE      FOUR,EXIT * Exit Char Exit
SF03L999  RETURN
.--------------------------------
. Screen - Costing System Update              
.--------------------------------
SC04L000
SC04L100
          MOVE      "04",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC04L200
          CALL      CF04L000 * Clear Fields
          CALL      SETSCR02
SC04L300
          CALL      KY04L000 * Enter Key Fields
          BRANCH    EXIT,SC04L999,SC04L999
SC04L400
          CALL      WP04L000 * Load any WP Details
SC04L500
          CALL      LM04L000 * Load any Batch Details
SC04L600
          CALL      DF04L000 * Display Fields
SC04L700
          CALL      SF04L000 * Select Fields
          BRANCH    EXIT,SC04L100,SC04L100,SC04L200
SC04L800
SC04L900
SC04L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Costing System Update              
.-------------------------------------------------------
CF04L000
          MOVE      SP70,FROMCST 
          MOVE      SP70,TOCST   
          MOVE      ZERO,COSTCOMP
CF04L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Costing System Update              
.--------------------------------------------------------
KY04L000
          MOVE      ZERO,EXIT
          GOTO      KY04L999
.
KY04L900  MOVE      ONE,EXIT
KY04L999  RETURN
.---------------------------------------------------------
. Load WP files for : Costing System Update              
.---------------------------------------------------------
WP04L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Costing System Update              
.---------------------------------------------------------
LM04L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Costing System Update              
.---------------------------------------------------------
DF04L000
          BRANCH   ACCEPT,DF04L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF04L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF04L900
          MATCH    PRGID,SCPSPID
          GOTO     DF04L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF04L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF04L010 IF NOT EQUAL
.
          CALL     PS04L000 * Display Field
          GOTO     DF04L010
DF04L900
DF04L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Costing System Update              
.---------------------------------------------------------
PS04L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS04L999,PS04L999,PS04L999,PS04L101:
                            PS04L102,PS04L999,PS04L999,PS04L999:
                           PS04L103
          GOTO     PS04L999
.
PS04L101
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L102
          MOVE      TOCST,VAR        
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L103
          MOVE      COSTCOMP,VAR     
          CALL      DISPITEM
          GOTO     PS04L999
PS04L999
          RETURN
.---------------------------------------------------------
. Selections for : Costing System Update              
.---------------------------------------------------------
SF04L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF04L001  BRANCH   ACCEPT,SF04L020
.
SF04L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF04L006,SF04L101,SF04L102,SF04L103:
                            SF04L006,SF04L006,SF04L006,SF04L006:
                           SF04L104
SF04L006  BEEP
          GOTO     SF04L005
SF04L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF04L090
          MATCH    PRGID,SCSLPID
          GOTO     SF04L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF04L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF04L020,SF04L020,SF04L020,SF04L103:
                            SF04L020,SF04L020,SF04L020,SF04L020:
                           SF04L104
          GOTO     SF04L020
SF04L090  MOVE     ZERO,ACCEPT
          GOTO     SF04L001
.
SF04L101
          MOVE      ZERO,EXIT
          GOTO      SF04L999
.
SF04L102
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      PROC0000
          MOVE      EXIT,SECTOR
          IF        SECTOR=0
            CALL      FRESCR00
            GOTO      SF04L999
          ENDIF
          IF        SECTOR=1
            CALL      FRESCR00
            MOVE      ZERO,EXIT
            GOTO      SF04L001
          ENDIF
          IF        SECTOR=2
            CALL      FRESCR00
            MOVE      ONE,EXIT
            GOTO      SF04L999
          ENDIF
          MOVE      "04",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          IF        SECTOR=4
            CALL      DF04L000
          ENDIF
          GOTO      SF04L001
.
SF04L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCST   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RCOST000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF04L103
            ENDIF
            BRANCH    EXIT,SF04L103,SF04L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF04L990 IF EQUAL
          ENDIF
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCST,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF04L001
.
SF04L104
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,COSTCOMP
          IF        SCPSMAN=1
            COMPARE   ZERO,COSTCOMP
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF04L104
            ENDIF
          ENDIF
          MOVE      COSTCOMP,VAR     
          CALL      DISPITEM
          GOTO     SF04L001
SF04L990  MOVE      ONE,EXIT * Exit Char Restart
SF04L999  RETURN
.@@@@@ Function Restart Point @@@@@
.------------------------------------------------------------------------
. Open Nato X-Ref File if required
.------------------------------------------------------------------------
ONAT0000  OPEN      CONTROLF,"controlf"
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*143,HNONUSAG
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ONE,HNONUSAG
            WRITAB    CONTROLF,SIXTY3;*143,HNONUSAG
          ENDIF
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*141,INCNNATO
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ZERO,INCNNATO
            WRITAB    CONTROLF,SIXTY3;*141,INCNNATO
          ENDIF
.
          IF        INCNNATO=1
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      SINNATA1,"sinnataf"
            TRAPCLR   IO
            IF        OVRCD=1
              DISPLAY   *P1:24,*EL,*B,"Nato file does not exist. Run fixit.  ";
              CALL      HITENTER
              CHAIN     PGM
            ENDIF
.
            OPEN      SINNATA2,"sinnataf"
          ENDIF
.
ONAT9999  RETURN
.********************************************************************
. SETSCR01 - set up for screen 01
.********************************************************************
SETSCR01
          MOVE      ONE,ACCEPT
          MOVE      ONE,OPTIONA
          MOVE      ZERO,DETAILS
.
SETSCR91  RETURN
DEFAULTN    MOVE     ANSN,DEFYESNO
            RETURN
.********************************************************************
. PRNT - print report                               Called by ML
.         Requires : OPTIONA         (report type)
.********************************************************************
PRNT0000  MOVE      ZERO,GRANDTOT
          MOVE      ZERO,GRAN12P6
.
          DISPLAY   *P50:24,"Printing :   ";
          MOVE      ZERO,CPAGENO                 * reset page no.
          CLOCK     TIME,CTIMEIS                 * get current time
          MOVE      "999",CLNO                   * init last line number
.
          CALL      MAKEX000                    * make export file
          CALL      FILE0000                    * go to correct position in file
.
PRNT1000  CALL      NREC0000                     * get next record
          BRANCH    OVRCD,PRNT9000               * end of file ?
.
          IF        OPTIONA=1
            DISPLAY   *P61:24,*V2LON,SICACODE,*EL;
          ELSE
            DISPLAY   *P61:24,*V2LON,SICADESC,*EL;
          ENDIF
.
          CALL      WRIT0000                     * print details
          GOTO      PRNT1000                     * get next record
.
PRNT9000  COMPARE   ZERO,CPAGENO
          CALL      HEAD0000 IF EQUAL          * print header if nothing printed
          CALL      UND132                        * print line
          IF        DETAILS=1
            MOVE      GRAN12P6,GRANDTOT
            PRINT     "|",*106,"Grand Total",*118,"|",GRANDTOT,"|"
            CALL      UND132                        * print line
          ENDIF
          PRINT     "****   End of Report   ****"
          CALL      TRANS000                     * transfer export file
          MOVE      ZERO,EXIT
          GOTO      PRNT9999
.
PRNT9500  MOVE      ONE,EXIT
.
PRNT9999  RETURN
.**********************************************************************
.  FILE - Set file pointer                             Called By PRNT
.**********************************************************************
FILE0000  BRANCH    OPTIONA,FILE0100,FILE0200
.
.---- print by type 1 - by Cost Centre Code ----
.
FILE0100  PACK      KEY5,STRCST,SP70
          CALL      RSSICA1
          CALL      RPSICA1
          GOTO      FILE9999
.
.---- print by type 2 - by Cost Centre Description ----
.
FILE0200  PACK      KEY45,PDESC1,SP70
          CALL      RSSICA2
          CALL      RPSICA2
          GOTO      FILE9999
.
FILE9999  RETURN
.**********************************************************************
.  NREC - Get next record                              Called By PRNT
.**********************************************************************
NREC0000  MOVE      ZERO,COST12P6
          BRANCH    OPTIONA,NREC0100,NREC0200
.
.---- print by type 1 - by Cost Centre Code ----
.
NREC0100  CALL      RKSICA1
          BRANCH    OVRCD,NREC9500
.
          MATCH     SICACODE,ENDCST
          GOTO      NREC9500 IF LESS             * out of range ?
          GOTO      NREC9000
.
.---- print by type 2 - by Cost Centre Description ----
.
NREC0200  CALL      RKSICA2
          BRANCH    OVRCD,NREC9500
.
          MATCH     SICADESC,PDESC2
          GOTO      NREC9500 IF LESS             * out of range ?
          GOTO      NREC9000
.
NREC9000  MOVE      ZERO,OVRCD         * continue
          PACK      KEY12,SICACODE,SP70
          CALL      RSSIIM1
          CALL      RKSIIM1
          BRANCH    OVRCD,NREC0000               * If No Imprest Exists For Them
.
          MATCH     SICACODE,SIIMCST             * If No Imprest Exists For Them
          GOTO      NREC0000 IF NOT EQUAL
.
          GOTO      NREC9999
.
NREC9500  MOVE      ONE,OVRCD          * quit
.
NREC9999  RETURN
.********************************************************************
. HEAD - print report                               Called by PRNT
.********************************************************************
HEAD0000  IF        PRTSEQ=1
            MOVE      "Imprest Sequence    ",CPHDROPT
          ELSE
            MOVE      "Normal Sequence     ",CPHDROPT
          ENDIF
.
          CALL      HEAD132                      * print heading
.
          ADD       "2",CLNO
          PRINT     *40,"From : ",FROMCST:
                     *N,*40,"To   : ",TOCST
          PRINT     *1,"Cost Centre : ",SICACODE,SP2,SICADESC
          CALL      UND132                       * print line
          IF        DETAILS=1
            PRINT     "|SMTWTFS| Catalog                 ":
                      "                                  ":
                      "|Seq.|Issue Unit     |Max Qty      |":
                      "Unit Cost    |Extended Cost":
                      *132,"|"
          ELSE
            PRINT     "|SMTWTFS|  Catalog                      ":
                      "                                        ":
                      "|Sequence No.| Issue Unit      |  Maximum Quantity":
                      *132,"|"
          ENDIF
          ADD       "2",CLNO
          CALL      UND132                       * print line
.
HEAD9999  RETURN
.********************************************************************
. WRIT - print data line                            Called by PRNT
.********************************************************************
.
WRIT0000  MOVE      "90",CLNO
.
          PACK      KEY12,SICACODE,SP70
          CALL      RSSIIM1
          IF        PRTSEQ=1
            PACK      KEY16,SICACODE,SP70
            CALL      RSSIIM3
          ENDIF
.
WRIT1000  IF        PRTSEQ=1
            CALL      RKSIIM3
          ELSE
            CALL      RKSIIM1
          ENDIF
          BRANCH    OVRCD,WRIT2000
          MATCH     SICACODE,SIIMCST
          GOTO      WRIT2000 IF NOT EQUAL
.
          MOVE      SP70,SIIADES
          PACK      KEY7,SIIMCAT,SP70
          CALL      RDSIIA1
.
. ------- Print Cost Centre Again if it goes over a page
          COMPARE   "56",CLNO                    * end of page ?
          IF        !@LESS
            CALL      HEAD0000                   * New Heading
            PRINT     "|",SICAIMPD,"|";
          ELSE
            PRINT     "|       |";
          ENDIF
.
          IF        DETAILS=1
            MOVE      SIIMMAX,TEMPMAXQ
            PACK      KEY7,SIIMCAT,SP70
            CALL      RDSIIA1
            MOVE      SIIAAVC,TEMPUNIT
            ASSIGN    (SIIAAVC*SIIMMAX),TEMPEXTE
            PACK      DIM51,SIIADES
            PRINT     SIIMCAT," ",DIM51,"|",SIIMSEQ,"|",SIIAISS,"|":
                      TEMPMAXQ,"|",TEMPUNIT,"|",TEMPEXTE,*132,"|"
          ELSE
            PRINT     "  ",SIIMCAT," ",SIIADES," |    ",SIIMSEQ:
                      "    | ",SIIAISS," |   ",SIIMMAX,*132,"|"
          ENDIF
          MOVE      ZERO,PRTFIRST
          ASSIGN    SIIAAVC*SIIMMAX+GRAN12P6,GRAN12P6
          ASSIGN    SIIAAVC*SIIMMAX+COST12P6,COST12P6
          ADD       "1",CLNO           * add one to line number
.
          CALL      WRTEX000           * write export file
.
          GOTO      WRIT1000
.
WRIT2000
          IF        DETAILS=1
            CALL      UND132
            MOVE      COST12P6,COSTTOT
            PRINT     "|",*88,"Total for Cost Centre: ",SICACODE:
                      *118,"|",COSTTOT,*132,"|"
          ENDIF
.
WRIT9999  RETURN
.------------------------------------------------------------
. Create Export File
.------------------------------------------------------------
MAKEX000  COMPARE  ONE,EXPORTYN
          GOTO     MAKEX999 IF NOT EQUAL
          MOVE     "EXPORT",KEY6
          PACK     EXPORTFN,KEY6,PORT
          REP      " 0",EXPORTFN
          PREP     EXPORTFL,EXPORTFN
.
          BRANCH   DETAILS,MAKEX100
.
          WRITE    EXPORTFL,SEQ;"Cost Centre",TABDELM:
                                "Cost Centre Description",TABDELM:
                                "SMTWTFS",TABDELM:
                                "Catalog Code",TABDELM:
                                "Catalog Description",TABDELM:
                                "Sequence Number",TABDELM:
                                "Issue Unit",TABDELM:
                                "Maximum Quantity"
          GOTO     MAKEX999
.
MAKEX100  WRITE    EXPORTFL,SEQ;"Cost Centre",TABDELM:
                                "Cost Centre Description",TABDELM:
                                "SMTWTFS",TABDELM:
                                "Catalog Code",TABDELM:
                                "Catalog Description",TABDELM:
                                "Sequence Number",TABDELM:
                                "Issue Unit",TABDELM:
                                "Maximum Quantity",TABDELM:
                                "Unit Cost",TABDELM:
                                "Extended Cost"
MAKEX999  RETURN
.------------------------------------------------------------
. Write to Export File
.------------------------------------------------------------
WRTEX000  COMPARE  ONE,EXPORTYN
          GOTO     WRTEX999 IF NOT EQUAL
          BRANCH   DETAILS,WRTEX100
.
          WRITE    EXPORTFL,SEQ;SICACODE,TABDELM:
                                SICADESC,TABDELM:
                                SICAIMPD,TABDELM:
                                SIIMCAT,TABDELM:
                                SIIADES,TABDELM:
                                SIIMSEQ,TABDELM:
                                SIIAISS,TABDELM:
                                SIIMMAX
          GOTO      WRTEX999
.
WRTEX100  WRITE    EXPORTFL,SEQ;SICACODE,TABDELM:
                                SICADESC,TABDELM:
                                SICAIMPD,TABDELM:
                                SIIMCAT,TABDELM:
                                SIIADES,TABDELM:
                                SIIMSEQ,TABDELM:
                                SIIAISS,TABDELM:
                                SIIMMAX,TABDELM:
                                SIIAAVC,TABDELM:
                                TEMPEXTE
.
WRTEX999  RETURN
.------------------------------------------------------------
. Execute Transfer Script eg softerm
.------------------------------------------------------------
TRANS000  COMPARE  ONE,EXPORTYN
          GOTO     TRANS999 IF NOT EQUAL
          MOVE     YES,DEFYESNO
          CLOSE    EXPORTFL
          DISPLAY  *P1:24,*EL,"Execute Transfer Now (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "30",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRANS999 IF EQUAL   *  No Transfer
.
          MOVE     ZERO,HLEF
          CALL     GETSCR00
.
          CLEAR    KEY80
          APPEND   "keatran ",KEY80
          APPEND   EXPORTFN,KEY80
          APPEND   ".txt",KEY80
          RESET    KEY80
          EXECUTE  KEY80,TASKID
.
          CALL     PUTSCR00
.
          DISPLAY  *P1:24,*EL,"Transfer Completed Ok (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "31",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRANS000 IF EQUAL   *  Not ok
.
          PREP     EXPORTFL,EXPORTFN
          CLOSE    EXPORTFL
.
TRANS999  RETURN
.
.--------------------------------------------------
. Enter Range
.  where SICA    = System & File for Keyin Routines
.        CST     = Field ID
.        RCOST   = Call Routine Label
.        "    1" = Screen Item Number for "from" Variable
.        "    2" = Screen Item Number for "to" Variable
.        yyyyy.. = Description of Variable
.
.  Return Values
.        FROMCST  Code & Description for Start of Range
.        TOCST    Code & Description for End of Range
.        STRCST   Code for Start of Range
.        ENDCST   Code for End of Range
.--------------------------------------------------
RCOST000  MOVE      "    5",FLDID
          CALL      GETPOSIT
          PACK      VAR,SP70,SP70
          CALL      DISPITEM
.
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          PACK      VAR,SP70,SP70
          CALL      DISPITEM
.
          CALL      KSICAA00
          BRANCH    EXIT,RCOST100,RCOST999
          MOVE      SICACODE,STRCST
          PACK      FROMCST,SICACODE,SP1,SICADESC
          GOTO      RCOST140
RCOST100  MOVE      "Start             ",FROMCST
          MOVE      SP70,STRCST
.
RCOST140  MOVE      FROMCST,VAR
          CALL      DISPITEM
.
RCOST150  MOVE      "    5",FLDID
          CALL      GETPOSIT
          CALL      KSICAA00
          BRANCH    EXIT,RCOST200,RCOST999
          MOVE      SICACODE,ENDCST
          PACK      TOCST,SICACODE,SP1,SICADESC
          MATCH     STRCST,ENDCST
          GOTO      RCOST990 IF EQUAL
          GOTO      RCOST990 IF NOT LESS
          BEEP
          MOVE      "To Cost Centre Must Be > From Cost Centre - ",DISPMSG
          CALL      MESSAGE1
          GOTO      RCOST000
.
RCOST200  MOVE      "Finish             ",TOCST
.
RCOST990  MOVE      "    4",FLDID
          CALL      GETPOSIT
          GOTO      RCOST999
.
RCOST999  RETURN
.
.-----------------------------------------------------------------------
. Setup for Detailed Report
.-----------------------------------------------------------------------
SETSCR02  MOVE      ONE,ACCEPT
          MOVE      ONE,OPTIONA
          MOVE      ONE,DETAILS
.
SETSCR92  RETURN
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
.------------------------------------------------------------
. Print Stocktake Report for Imprest
.------------------------------------------------------------
REPT0000  IF        EXPORTYN=1
            CALL      MAKEXP00
          ENDIF
          CALL      MAKSUM00
          CLOCK     TIME,CTIMEIS
          MOVE      ZERO,CPAGENO
          MOVE      ZERO,GRANDCST
          MOVE      "90",CLNO
          DISPLAY   *P1:24,*EL,"Printing ... "
          PACK      KEY5,STRCST
          CALL      RDSICA1
          IF        OVRCD=0
            CALL      RPSICA1
          ENDIF
.
REPT1000  CALL      RKSICA1
          BRANCH    OVRCD,REPT9000
          MATCH     SICACODE,ENDCST
          GOTO      REPT9000 IF LESS
.
          MOVE      ZERO,TOTALCST
          MOVE      ZERO,DETFOUND
          MOVE      "90",CLNO
          MOVE      ONE,HEADTYP
.
          PACK      KEY12,SICACODE,SP70
          CALL      RSSIIM1
.
REPT2000  CALL      RKSIIM1
          BRANCH    OVRCD,REPT3000
          MATCH     SIIMCST,SICACODE
          GOTO      REPT3000 IF NOT EQUAL
          IF        ZEROMAX=1
            COMPARE   ZERO,SIIMMAX
            GOTO      REPT2000 IF EQUAL
          ENDIF
          IF        ZEROSOH=1
            COMPARE   ZERO,SIIMQOH
            GOTO      REPT2000 IF EQUAL
          ENDIF
.
          CALL      PRTLIN00
          MOVE      ONE,DETFOUND
          GOTO      REPT2000
.
REPT3000  IF        DETFOUND=1
            CALL      PRTTOT00
          ENDIF
          GOTO      REPT1000
.
REPT9000  CALL      PRTEND00
.
          CLOSE     TEMPFILL,DELETE
          IF        EXPORTYN=1
            CALL      TRAN0000
          ENDIF
.
REPT9999  RETURN
.------------------------------------------------------------
. Print Page Heading
.------------------------------------------------------------
PRTHED00  MOVE      "Stock on Hand Report",CPHDROPT
          CALL      HEAD132
          PRINT     "Cost Centre Range : ",FROMCST," to ",TOCST
          PRINT     "Cost Centre       : ",SICACODE,SP1,SICADESC
          CALL      UND132
          BRANCH    HEADTYP,PRTHED10,PRTHED20
.
PRTHED10  PRINT     "|Catalog                                            ":
                    "            |Issue Unit     |Comm.| Stock on Hand|  ":
                    "Average Cost|    Total Cost|"
          GOTO      PRTHED90
.
PRTHED20  PRINT     "|Commodity Code                              ":
                    "                                             ":
                    "                          |    Total Cost|"
          GOTO      PRTHED90
.
PRTHED90  CALL      UND132
.
PRTHED99  RETURN
.------------------------------------------------------------
. Print Catalog Line
.------------------------------------------------------------
PRTLIN00  MOVE      SIIMCAT,KEY7
          CALL      RDSIIA1
          IF        OVRCD=1
            MOVE      "Invalid Catalog Code ",SIIADES
          ENDIF
          MOVE      SIIASUB,KEY5
          CALL      RDSISA1
          MOVE      SISACOMM,KEY6                                      *C-59696
          CALL      RDSIGA1
          CALL      UPDSUM00
          MOVE      "999,999,999.99",PRTSOH
          MOVE      "9,999,999.9999",PRTAVC
          MOVE      "999,999,999.99",PRTTOT
          MOVE      SIIAAVC,F12P4
          ASSIGN    SIIAAVC*SIIMQOH,F12P2
          FEDIT     SIIMQOH,PRTSOH
          FEDIT     F12P4,PRTAVC
          FEDIT     F12P2,PRTTOT
          MOVE      SIIADES,DIM55
          ADD       ONE,CLNO
          COMPARE   "55",CLNO
          CALL      PRTHED00 IF NOT LESS
          PRINT     "|",SIIMCAT,SP1,DIM55,"|",SIIAISS,"|",SISACOMM,"|":
                    PRTSOH,"|",PRTAVC,"|",PRTTOT,"|"
          ADD       F12P2,TOTALCST
          ADD       F12P2,GRANDCST
          IF        EXPORTYN=1
            CALL      WREXP100
          ENDIF
PRTLIN99  RETURN
.------------------------------------------------------------
. Update Commodity Summary Table
.------------------------------------------------------------
UPDSUM00  PACK      KEY11,SIIMCST,SISACOMM,SP70                        *C-59696
          CALL      RDTEMP1
          IF        OVRCD=0
            ASSIGN    TEMPAMT+SIIAAVC*SIIMQOH,TEMPAMT
            CALL      UPTEMP1
          ELSE
            UNPACK    KEY11,TEMPCST,TEMPCOMM                           *C-59696
            ASSIGN    SIIAAVC*SIIMQOH,TEMPAMT
            CALL      WRTEMP1
          ENDIF
          RETURN
.------------------------------------------------------------
. Write to Catalog Export File
.------------------------------------------------------------
WREXP100  WRITE     EXPORTF1,SEQ;SICACODE,TABDELM,SICADESC,TABDELM:
                                 SIIMCAT,TABDELM,SIIADES,TABDELM:
                                 SIIASUB,TABDELM,SISADESC,TABDELM:
                                 SISACOMM,TABDELM,SIGADES,TABDELM:
                                 SIIMSEQ,TABDELM,SIIMMAX,TABDELM:
                                 SIIMQOH,TABDELM,SIIAAVC,TABDELM:
                                 F12P2
          RETURN
.------------------------------------------------------------
. Write to Commodity Export File
.------------------------------------------------------------
WREXP200  WRITE     EXPORTF2,SEQ;SICACODE,TABDELM,SICADESC,TABDELM:
                                 TEMPCOMM,TABDELM,SIGADES,TABDELM:
                                 TEMPAMT
          RETURN
.------------------------------------------------------------
. Create Export File
.------------------------------------------------------------
MAKEXP00  MOVE     "EXPRT1",KEY6
          PACK     KEY8,KEY6,PORT
          REP      " 0",KEY8
          PREP     EXPORTF1,KEY8
          WRITE    EXPORTF1,SEQ;"Cost Centre",TABDELM:
                                "Cost Centre Name",TABDELM:
                                "Catalog",TABDELM:
                                "Catalog Name",TABDELM:
                                "Product Group",TABDELM:
                                "Product Group Name",TABDELM:
                                "Commodity Group",TABDELM:
                                "Commodity Group Name",TABDELM:
                                "Imprest Sequence",TABDELM:
                                "Max Stock",TABDELM:
                                "Stock on Hand",TABDELM:
                                "Average Cost",TABDELM:
                                "Total Cost"
          MOVE     "EXPRT2",KEY6
          PACK     KEY8,KEY6,PORT
          REP      " 0",KEY8
          PREP     EXPORTF2,KEY8
          WRITE    EXPORTF2,SEQ;"Cost Centre",TABDELM:
                                "Cost Centre Name",TABDELM:
                                "Commodity Group",TABDELM:
                                "Commodity Group Name",TABDELM:
                                "Total Cost"
          RETURN
.------------------------------------------------------------
. Print Total Cost & Commodity Summary
.------------------------------------------------------------
PRTTOT00  CALL     UND132
          MOVE      "999,999,999.99",PRTTOT
          FEDIT    TOTALCST,PRTTOT
          PRINT    "|Cost Centre Total Stock Value ",*117,"|",PRTTOT,"|"
          MOVE     ZERO,TOTALCST
          MOVE     "2",HEADTYP
          MOVE     "90",CLNO
          PACK     KEY11,SICACODE,SP70                                 *C-59696
          CALL     RSTEMP1
PRTTOT10  CALL     RKTEMP1
          BRANCH   OVRCD,PRTTOT90
          MATCH    TEMPCST,SICACODE
          GOTO     PRTTOT90 IF NOT EQUAL
.
          MOVE     TEMPCOMM,KEY6                                       *C-59696
          CALL     RDSIGA1
          IF        EXPORTYN=1
            CALL      WREXP200
          ENDIF
          MOVE     "999,999,999.99",PRTTOT
          FEDIT    TEMPAMT,PRTTOT
          ADD      TEMPAMT,TOTALCST
          ADD      ONE,CLNO
          COMPARE  "55",CLNO
          CALL     PRTHED00 IF NOT LESS
          PRINT    "|",TEMPCOMM,SP1,SIGADES,*117,"|",PRTTOT,"|"
.
          GOTO     PRTTOT10
.
PRTTOT90  CALL     UND132
          MOVE      "999,999,999.99",PRTTOT
          FEDIT    TOTALCST,PRTTOT
          PRINT    "|Cost Centre Total Stock Value ",*117,"|",PRTTOT,"|"
.
PRTTOT99  RETURN
.------------------------------------------------------------
. Print End of Report
.------------------------------------------------------------
PRTEND00  CALL      UND132
          MOVE      "999,999,999.99",PRTTOT
          FEDIT     GRANDCST,PRTTOT
          PRINT     "|Report Total Stock Value : ",*117,"|",PRTTOT,"|"
          CALL      UND132
          PRINT     *50,"***** End of Report *****"
PRTEND99  RETURN
.------------------------------------------------------------
. Create Temp File
.------------------------------------------------------------
MAKSUM00  MOVE     "TEMPF1",KEY6
          PACK     KEY8,KEY6,PORT
          REP      " 0",KEY8
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     TEMPFILL,KEY8
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    TEMPFILL,DELETE
          ENDIF
          CLEAR    KEY80
          APPEND   "isbuild ",KEY80
          APPEND   KEY8,KEY80
          APPEND   " 200 UC1-5,6-11",KEY80                             *C-65641
          RESET    KEY80
          EXECUTE  KEY80,TASKID
          OPEN     TEMPFILL,KEY8
          RETURN
.--------------------------------------------------------------------------
. Execute Transfer Script eg softerm
.--------------------------------------------------------------------------
TRAN0000  MOVE     YES,DEFYESNO
          CLOSE    EXPORTF1
          CLOSE    EXPORTF2
          DISPLAY  *P1:24,*EL,"Execute Transfer Now (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "30",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN9999 IF EQUAL   *  No Transfer
.
          MOVE     ZERO,HLEF
          CALL     GETSCR00
.
          MOVE     "EXPRT1",KEY6
          PACK     KEY8,KEY6,PORT
          REP      " 0",KEY8
          CLEAR    KEY80
          APPEND   "keatran ",KEY80
          APPEND   KEY8,KEY80
          APPEND   ".txt",KEY80
          RESET    KEY80
          EXECUTE  KEY80,TASKID
.
          MOVE     "EXPRT2",KEY6
          PACK     KEY8,KEY6,PORT
          REP      " 0",KEY8
          CLEAR    KEY80
          APPEND   "keatran ",KEY80
          APPEND   KEY8,KEY80
          APPEND   ".txt",KEY80
          RESET    KEY80
          EXECUTE  KEY80,TASKID
.
          CALL     PUTSCR00
.
          DISPLAY  *P1:24,*EL,"Transfer Completed Ok (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "31",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN0000 IF EQUAL   *  Not ok
.
          MOVE     "EXPRT1",KEY6
          PACK     KEY8,KEY6,PORT
          REP      " 0",KEY8
          PREP     EXPORTF1,KEY8
          CLOSE    EXPORTF1
          MOVE     "EXPRT2",KEY6
          PACK     KEY8,KEY6,PORT
          REP      " 0",KEY8
          PREP     EXPORTF2,KEY8
          CLOSE    EXPORTF2
.
TRAN9999  RETURN
.
RSTEMP1   READ     TEMPFILL,KEY11;;                                    *C-59696
          RETURN
.
RDTEMP1   MOVE     ZERO,OVRCD
          READ     TEMPFILL,KEY11;TEMPCST,TEMPCOMM,TEMPAMT             *C-59696
          GOTO     OVERCOND IF OVER
          RETURN
.
RKTEMP1   MOVE     ZERO,OVRCD
          READKS   TEMPFILL;TEMPCST,TEMPCOMM,TEMPAMT
          GOTO     OVERCOND IF OVER
          RETURN
.
UPTEMP1   UPDATE   TEMPFILL;TEMPCST,TEMPCOMM,TEMPAMT
          RETURN
.
WRTEMP1   WRITE    TEMPFILL,KEY11;TEMPCST,TEMPCOMM,TEMPAMT             *C-59696
          RETURN
.
.********************************************************************
. PROC - print report                               Called by ML
.********************************************************************
PROC0000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      CEAPSCA1,"ceapscaf"
          TRAPCLR   IO
          BRANCH    OVRCD,PROC9100
.
          DISPLAY   *P50:24,"Processing   ";
.
          PACK      KEY5,STRCST,SP70
          CALL      RSSICA1
          CALL      RPSICA1
PROC1000  CALL      RKSICA1
          BRANCH    OVRCD,PROC9000               * end of file ?
          MATCH     SICACODE,ENDCST
          GOTO      PROC9000 IF LESS             * out of range ?
          MATCH     "Y  ",SICAUC1
          GOTO      PROC1000 IF NOT EQUAL
.
          DISPLAY   *P61:24,*V2LON,SICACODE,*EL;
.
          CALL      UCST0000                     * print details
          GOTO      PROC1000                     * get next record
.
PROC9000  MOVE      "Update Complete - ",DISPMSG
          CALL      MESSAGE1
          MOVE      ZERO,EXIT
          GOTO      PROC9999                     * get next record
.
PROC9100  MOVE      "Costing System Not Available",DISPMSG
          CALL      MESSAGE1
          MOVE      ZERO,EXIT
          GOTO      PROC9999                     * get next record
.
PROC9999  RETURN
.********************************************************************
. UCST - Update Cost Centre Total                   Called by PROC
.********************************************************************
UCST0000  MOVE      ZERO,COST12P6
          PACK      KEY12,SICACODE,SP70
          CALL      RSSIIM1
UCST1000  CALL      RKSIIM1
          BRANCH    OVRCD,UCST2000
          MATCH     SICACODE,SIIMCST
          GOTO      UCST2000 IF NOT EQUAL
          MOVE      SP70,SIIADES
          PACK      KEY7,SIIMCAT,SP70
          CALL      RDSIIA1
          BRANCH    OVRCD,UCST1000
          ASSIGN    SIIAAVC*SIIMMAX+COST12P6,COST12P6
          GOTO      UCST1000
.
UCST2000  PACK      KEY7,SICACODE,SP70
          CALL      RDCEPS1
          BRANCH    OVRCD,UCST9999
          STORE     COST12P6,COSTCOMP,CEPSST1,CEPSST2,CEPSST3,CEPSST4,CEPSST5
          CALL      UPCEPS1
.
UCST9999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       CEAPSCIO/INC
          INC       SINCCAIO/INC
          INC       SINCCAKY    
          INC       SINCGAIO/INC
          INC       SINCIAIO/INC
          INC       SINIMPIO/INC
          INC       SINNATIO/INC
          INC       SINSUAIO/INC
.
          INC       STDGENCD
.

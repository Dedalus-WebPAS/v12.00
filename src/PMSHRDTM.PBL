. *----------------------------------------------------------------------
. * Include Name  :   PMSHRDTM.PBL
. *
. * Function      :   CGI variable functions for PMSHRDFD - pmshrdaf.dat
. *----------------------------------------------------------------------
.  Modifications Done :
.
. V10.08.01   17/05/2016  Peter Vela             TSK 0819159
.             Fixed tag for category hw
. V10.06.01   12/09/2015  Peter Vela             CAR 314162
.             Added update functionality to HREQ0000
. V10.02.01   28/06/2011  Peter McMullen         CAR 240725
.             Change ward selection list to sort by name. not code           
.  V9.11.01   03/12/2008  Ebon Clements          CAR 174065
.             Added common function to add housekeeping request - HREQ0000
.  V9.11.00   02/12/2008  Ebon Clements          CAR 174082
.             Created include
. *----------------------------------------------------------------------
.
.------------------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------------------
CPPMHR00  MOVE      Z70,PMHRD001
          MOVE      Z70,PMHRD002
          MOVE      Z70,PMHRD003
          MOVE      Z70,PMHRD004
          MOVE      Z70,PMHRD005
          MOVE      Z70,PMHRD006
          MOVE      Z70,PMHRD007
          MOVE      Z70,PMHRD008
          MOVE      Z70,PMHRD009
          MOVE      Z70,PMHRD010
          MOVE      Z70,PMHRD011
          MOVE      Z70,PMHRD012
          MOVE      Z70,PMHRD013
          MOVE      Z70,PMHRD014
.
CPPMHR99  RETURN
.
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SPPMHR00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPPMHR01,SPPMHR02,SPPMHR03,SPPMHR04,SPPMHR05:
                       SPPMHR06,SPPMHR07,SPPMHR08,SPPMHR09,SPPMHR10:
                       SPPMHR11,SPPMHR12,SPPMHR13,SPPMHR14
          MOVE      ONE,EXIT
          GOTO      SPPMHR99
.
SPPMHR01  PACK      PMHRD001,QRYDATA,SP70
          GOTO      SPPMHR99
.
SPPMHR02  PACK      PMHRD002,QRYDATA,SP70
          GOTO      SPPMHR99
.
SPPMHR03  PACK      PMHRD003,QRYDATA,SP70
          GOTO      SPPMHR99
.
SPPMHR04  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMHRD004,CCENT,CYEAR,CMON,CDAY
          GOTO      SPPMHR99
.
SPPMHR05  PACK      PMHRD005,QRYDATA,SP70
          GOTO      SPPMHR99
.
SPPMHR06  MOVE      QRYDATA,PMHRD006
          GOTO      SPPMHR99
.
SPPMHR07  MOVE      QRYDATA,PMHRD007
          GOTO      SPPMHR99
.
SPPMHR08  MOVE      QRYDATA,PMHRD008
          GOTO      SPPMHR99
.
SPPMHR09  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMHRD009,CCENT,CYEAR,CMON,CDAY
          GOTO      SPPMHR99
.
SPPMHR10  MOVE      QRYDATA,PMHRD010
          GOTO      SPPMHR99
.
SPPMHR11  MOVE      QRYDATA,PMHRD011
          GOTO      SPPMHR99
.
SPPMHR12  MOVE      QRYDATA,PMHRD012
          GOTO      SPPMHR99
.
SPPMHR13  MOVE      QRYDATA,PMHRD013
          GOTO      SPPMHR99
.
SPPMHR14  MOVE      QRYDATA,PMHRD014
          GOTO      SPPMHR99
.
SPPMHR99  RETURN
.
.------------------------------------------------------------
.  Update cgi to file
.------------------------------------------------------------
MVPMHR00  MATCH     PMHRD001,Z70
          IF        !@EQUAL
            MOVE      PMHRD001,PMHRHOSP
          ENDIF
.
          MATCH     PMHRD002,Z70
          IF        !@EQUAL
            MOVE      PMHRD002,PMHRWARD
          ENDIF
.
          MATCH     PMHRD003,Z70
          IF        !@EQUAL
            MOVE      PMHRD003,PMHRBEDD
          ENDIF
.
          MATCH     PMHRD004,Z70
          IF        !@EQUAL
            MOVE      PMHRD004,PMHRRDAT
          ENDIF
.
          MATCH     PMHRD005,Z70
          IF        !@EQUAL
            MOVE      PMHRD005,PMHRRTIM
          ENDIF
.
          MATCH     PMHRD006,Z70
          IF        !@EQUAL
            MOVE      PMHRD006,PMHRRSTA
          ENDIF
.
          MATCH     PMHRD007,Z70
          IF        !@EQUAL
            MOVE      PMHRD007,PMHRCSTA
          ENDIF
.
          MATCH     PMHRD008,Z70
          IF        !@EQUAL
            MOVE      PMHRD008,PMHRCWEB
          ENDIF
.
          MATCH     PMHRD009,Z70
          IF        !@EQUAL
            MOVE      PMHRD009,PMHRCDAT
          ENDIF
.
          MATCH     PMHRD010,Z70
          IF        !@EQUAL
            MOVE      PMHRD010,PMHRCTIM
          ENDIF
.
          MATCH     PMHRD011,Z70
          IF        !@EQUAL
            MOVE      PMHRD011,PMHRSTAT
          ENDIF
.
          MATCH     PMHRD012,Z70
          IF        !@EQUAL
            MOVE      PMHRD012,PMHRCOM1
          ENDIF
.
          MATCH     PMHRD013,Z70
          IF        !@EQUAL
            MOVE      PMHRD013,PMHRCOM2
          ENDIF
.
          MATCH     PMHRD014,Z70
          IF        !@EQUAL
            MOVE      PMHRD014,PMHRCRES
          ENDIF
.
MVPMHR99  RETURN
.
.------------------------------------------------------------
. Output Tags
.------------------------------------------------------------
PMHR0000  BRANCH    FLDITMNO,PMHR0010,PMHR0020,PMHR0030,PMHR0040,PMHR0050:
                             PMHR0060,PMHR0070,PMHR0080,PMHR0090,PMHR0100:
                             PMHR0110,PMHR0120,PMHR0130,PMHR0140,PMHR0150:
                             PMHR0160,PMHR0170
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PMHR9999
.
PMHR0010  WRITE     HTMLFILE;PMHRHOSP;
          GOTO      PMHR9999
.
PMHR0020  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMHR0021,PMHR0022
.
          PACK      KEY6,PMHRWARD,SP70
          CALL      RDWARD1
          IF        OVRCD=1
            PACK      WBDESC,PMHRWARD,SP70
          ENDIF
          WRITE     HTMLFILE;WBDESC;
          GOTO      PMHR9999
.
PMHR0021  WRITE     HTMLFILE;PMHRWARD;
          GOTO      PMHR9999
.
PMHR0022  PACK      KEY29,SP70
          IF        IBCNMHOS = 1
            PACK      KEY29,SP3,WBSEHOSP,SP70
          ENDIF
          CALL      RDSWARD7
PMHR0023  CALL      RDKWARD7
          BRANCH    OVRCD,PMHR9999
.
.                         if we have a bed number we have passed all the ward
.                         master records, so exit
          MATCH     SP70,WBED
          GOTO      PMHR9999 IF NOT EQUAL
.
          COMPARE   WACTIVE,ZERO                 *List only active wards
          GOTO      PMHR0023  IF NOT EQUAL
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        !@EQUAL
              MATCH     WBSEHOSP,PTWDHOSN
              GOTO      PMHR9999 IF NOT EQUAL
            ENDIF
          ENDIF
.
.                       write the select option.
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#"";
          MATCH     DFLTWARD,WWARD
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">",WBDESC;
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;" - ",PTWDHOSN;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      PMHR0023
.
.
PMHR0030  WRITE     HTMLFILE;PMHRBEDD;
          GOTO      PMHR9999
.
PMHR0040  MATCH     PMHRRDAT,SP70
          GOTO      PMHR9999 IF EQUAL
.
          UNPACK    PMHRRDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMHR9999
.
PMHR0050  WRITE     HTMLFILE;PMHRRTIM;
          GOTO      PMHR9999
.
PMHR0060  MOVE      "BV",CATEGORY
          MOVE      PMHRRSTA,CODE
          CALL      CODITM00 
          GOTO      PMHR9999
.
PMHR0070  MOVE      "BV",CATEGORY
          MOVE      PMHRCSTA,CODE
          CALL      CODITM00
          GOTO      PMHR9999
.
PMHR0080  MATCH     SP70,PMHRCWEB
          GOTO      PMHR9999 IF EQUAL
.
          PACK      KEY10,PMHRCWEB,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMHRCWEB,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PMHR9999
.
PMHR0090  MATCH     PMHRCDAT,SP70
          GOTO      PMHR9999 IF EQUAL
.
          UNPACK    PMHRCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMHR9999
.
PMHR0100  WRITE     HTMLFILE;PMHRCTIM;
          GOTO      PMHR9999
.
PMHR0110  MOVE      "hw",CATEGORY
          MOVE      PMHRSTAT,CODE
          CALL      CODITM00
          GOTO      PMHR9999
.
PMHR0120  WRITE     HTMLFILE;PMHRCOM1;
          GOTO      PMHR9999
.
PMHR0130  WRITE     HTMLFILE;PMHRCOM2;
          GOTO      PMHR9999
.
PMHR0140  MOVE      "hx",CATEGORY
          MOVE      PMHRCRES,CODE
          CALL      CODITM00
          GOTO      PMHR9999
.
PMHR0150  MATCH     SP70,PMHRWEBU
          GOTO      PMHR9999 IF EQUAL
.
          PACK      KEY10,PMHRWEBU,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMHRWEBU,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      PMHR9999
.
PMHR0160  MATCH     PMHRDATU,SP70
          GOTO      PMHR9999 IF EQUAL
.
          UNPACK    PMHRDATU,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PMHR9999
.
PMHR0170  WRITE     HTMLFILE;PMHRTIMU;
          GOTO      PMHR9999
.
PMHR9999  RETURN
.
.------------------------------------------------------------
. Common function to add housekeeping request
.------------------------------------------------------------
HREQ0000  MATCH     "1",UPDATHRD
          GOTO      HREQ5000 IF EQUAL
.
          PACK      KEY25,PMHRD001,PMHRD002,PMHRD003,PMHRD004,PMHRD005,SP70
          CALL      RDPMHRD1
          COMPARE   ZERO,OVRCD
          GOTO      HREQ9999 IF EQUAL
.
          CALL      CLPMSHRD
.
          CALL      MVPMHR00                     * Move cgi to file vars
.
          MATCH     SP70,PMHRWARD                * Ward
          GOTO      HREQ9999 IF EQUAL
.
          MATCH     SP70,PMHRBEDD                * Bed
          GOTO      HREQ9999 IF EQUAL
.
          MATCH     SP70,PMHRRDAT                * Request Date
          GOTO      HREQ9999 IF EQUAL
.
          MATCH     SP70,PMHRRTIM                * Request Time
          GOTO      HREQ9999 IF EQUAL
.
          MATCH     SP70,PMHRRSTA                * Request status
          GOTO      HREQ9999 IF EQUAL
.
          MOVE      USERID,PMHRWEBU
          PACK      PMHRDATU,CCC,CYY,CMM,CDD
          REP       " 0",PMHRDATU
          CLOCK     TIME,PMHRTIMU
.
          PACK      KEY25,PMHRHOSP,PMHRWARD,PMHRBEDD,PMHRRDAT,PMHRRTIM,SP70
          CALL      WRPMHRD1
.
          GOTO      HREQ9999
.
HREQ5000  PACK      KEY25,PMHRD001,PMHRD002,PMHRD003,PMHRD004,PMHRD005,SP70
          CALL      RDPMHRD1
          BRANCH    OVRCD,HREQ9999
.
          MOVE      PMHRD006,PMHRRSTA
          MOVE      USERID,PMHRWEBU
          CALL      IBACLOCK
          PACK      PMHRDATU,CCC,CYY,CMM,CDD
          REP       " 0",PMHRDATU
          CLOCK     TIME,PMHRTIMU
.
          CALL      UPPMHRD1
.
          GOTO      HREQ9999
.
HREQ9999  RETURN

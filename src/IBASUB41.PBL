.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.03.01  10.09.2003 Steve Downing (VF.11.01 CAR 9375)
.           Recompiled for SINREBFD & SINREBIO
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.00.03  29.12.1999 Charles Handaya
.           Recompiled for Fixing Audit Date (CCYYMMDD)
. VF.00.02  28.07.1999 Sandra Barcham
.           Fix non-stock catalogs on requisitions
.           srf 631796
. VF.00.01  21.05.1999 Sandra Barcham
.           Fix non-imprest requisitions
.           srf 631796
.-------------------------------------------------------
EXPORTFL  FILE      ASCII, FIXED=400     * Export File (Adjust Length to Suit)
EXPORTFN  DIM       8                    * Export File Name
TABDELM   EQU       0x09                 * Tab Delimiter
.
CDYSDAYS   FORM     6
CDYSFDTE   DIM      8
CDYSTDTE   DIM      8
CDYSYEAR   FORM     2
.
.
FILENAME  DIM       8
STRDAT    DIM       8
ENDDAT    DIM       8
STRCST    DIM       5
ENDCST    DIM       5
POCOUNT   FORM      5
.
SINTMPA1  IFILE     SQL, FIXED=83, KEY="U1-5,6-12"
SINTMPA2  IFILE     SQL, FIXED=83, KEY="U1-5,13-27,6-12"
SINTMPA3  IFILE     SQL, FIXED=83, KEY="U1-5,28-42,6-12"
.
SITMCST   DIM       5      5     1    Cost Centre
SITMCAT   DIM       7      7     6    Catalog Code
SITMVAL   DIM       15     15    13   Value
SITMQTY   DIM       15     15    28   Quantity
SITMSPA   DIM       40     40    43   Spare
.
.End of Record                   83
.
F8P2      FORM      8.2
USEQTY8   FORM      8
CURMAX8   FORM      8
SUGMAX8   FORM      8
CURVAL    FORM      10.2
SUGVAL    FORM      10.2
TOTSOH    FORM      10.2
TOTREC    FORM      10.2
SEQTYPE   DIM       1
F12P2     FORM      12.2
SUGGMAX   FORM      12.2
VALUE     FORM      12.2
QUANTITY  FORM      12.2
PRTQTY    FORM      12
CSTTOTAL  FORM      12.2
TOTAL     FORM      12.2
TOTALVAL  FORM      12.2
TOTALQTY  FORM      12.2
ABCLEV1   FORM      12.2
ABCLEV2   FORM      12.2
TOTALNUM  FORM      12
LEVANUM   FORM      12
LEVBNUM   FORM      12
LEVCNUM   FORM      12
LEVAQTY   FORM      12
LEVBQTY   FORM      12
LEVCQTY   FORM      12
LEVAVAL   FORM      12.2
LEVBVAL   FORM      12.2
LEVCVAL   FORM      12.2
LEVAPER   FORM      12.2
LEVBPER   FORM      12.2
LEVCPER   FORM      12.2
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASUB41
.   Function      :   Imprest ABC Analysis                    
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       SINCCAFD/INC
          INC       SINCIAFD/INC
          INC       SINCONFD/INC
          INC       SINFACFD/INC
          INC       SINIMPFD/INC
          INC       SINPOCFD/INC
          INC       SINPOFFD/INC
          INC       SINREAFD/INC
          INC       SINREBFD/INC
.=========================
.Local Variable Definition
.-------------------------
FROMCST   DIM      40 * Scr 00 Fld     4
TOCST     DIM      40 * Scr 00 Fld     5
FROMDAT   DIM      10 * Scr 00 Fld     6
TODAT     DIM      10 * Scr 00 Fld     7
PERCAB    FORM      3 * Scr 00 Fld     8
PERCBC    FORM      3 * Scr 00 Fld     9
HOLDINGA  FORM      3 * Scr 00 Fld    10
HOLDINGB  FORM      3 * Scr 00 Fld    11
HOLDINGC  FORM      3 * Scr 00 Fld    12
BASEDON   FORM      1 * Scr 00 Fld    13
NODAYS    FORM      3 * Scr 00 Fld    14
EXPORTYN  FORM      1 * Scr 00 Fld    15
IMPRREQ   FORM      1 * Scr 00 Fld    16
INCORDER  FORM      1 * Scr 00 Fld    17
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASUB41"
PRGNAM    INIT      "Imprest ABC Analysis                    "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   24",AUDTSECT
          MOVE      "202",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudca";
            OPEN      SINAUDCA,"sinaudca"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "205",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudfa";
            OPEN      SINAUDFA,"sinaudfa"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "203",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudia";
            OPEN      SINAUDIA,"sinaudia"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "204",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudim";
            OPEN      SINAUDIM,"sinaudim"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "210",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudpc";
            OPEN      SINAUDPC,"sinaudpc"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "218",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudpf";
            OPEN      SINAUDPF,"sinaudpf"
          ENDIF
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA1,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA2,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA1,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA2,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA3,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinfacaf";
          OPEN      SINFACA1,"sinfacaf"
          DISPLAY   *P56:24,"Opening sinfacaf";
          OPEN      SINFACA2,"sinfacaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA1,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA2,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA3,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA1,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA1,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA2,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA3,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA4,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA1,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA2,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA3,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA4,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA1,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA2,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA3,"sinrebaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Report Options                     
          ENDIF
          RETURN
.--------------------------------
. Screen - Report Options                     
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      SETDEF00
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Report Options                     
.-------------------------------------------------------
CF00L000
          MOVE      SP70,FROMCST 
          MOVE      SP70,TOCST   
          MOVE      SP70,FROMDAT 
          MOVE      SP70,TODAT   
          MOVE      ZERO,PERCAB  
          MOVE      ZERO,PERCBC  
          MOVE      ZERO,HOLDINGA
          MOVE      ZERO,HOLDINGB
          MOVE      ZERO,HOLDINGC
          MOVE      ZERO,BASEDON 
          MOVE      ZERO,NODAYS  
          MOVE      ZERO,EXPORTYN
          MOVE      ZERO,IMPRREQ 
          MOVE      ZERO,INCORDER
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Report Options                     
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Report Options                     
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Report Options                     
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Report Options                     
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Report Options                     
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L101:
                            PS00L102,PS00L103,PS00L104,PS00L105:
                            PS00L106,PS00L107,PS00L108,PS00L109:
                            PS00L110,PS00L111,PS00L112,PS00L113:
                            PS00L114
          GOTO     PS00L999
.
PS00L101
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      TOCST,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      TODAT,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      PERCAB,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      PERCBC,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      HOLDINGA,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      HOLDINGB,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L109
          MOVE      HOLDINGC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L110
          MOVE      BASEDON,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L111
          MOVE      NODAYS,VAR       
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L112
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L113
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      IMPRREQ,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L114
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      INCORDER,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Report Options                     
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L006,SF00L104,SF00L006,SF00L105:
                            SF00L106,SF00L107,SF00L108,SF00L109:
                            SF00L110,SF00L111,SF00L112,SF00L113:
                            SF00L114
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L103:
                            SF00L020,SF00L104,SF00L020,SF00L105:
                            SF00L106,SF00L107,SF00L108,SF00L109:
                            SF00L110,SF00L111,SF00L112,SF00L113:
                            SF00L114
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      REPT0000
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCST   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECOST000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCST,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODAT   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDATE000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
            BRANCH    EXIT,SF00L104,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODAT,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L105
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,PERCAB  
          IF        SCPSMAN=1
            COMPARE   ZERO,PERCAB  
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
          ENDIF
          MOVE      PERCAB,VAR       
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L106
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,PERCBC  
          IF        SCPSMAN=1
            COMPARE   ZERO,PERCBC  
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L106
            ENDIF
          ENDIF
          MOVE      PERCBC,VAR       
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L107
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,HOLDINGA
          IF        SCPSMAN=1
            COMPARE   ZERO,HOLDINGA
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L107
            ENDIF
          ENDIF
          MOVE      HOLDINGA,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L108
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,HOLDINGB
          IF        SCPSMAN=1
            COMPARE   ZERO,HOLDINGB
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L108
            ENDIF
          ENDIF
          MOVE      HOLDINGB,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L109
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,HOLDINGC
          IF        SCPSMAN=1
            COMPARE   ZERO,HOLDINGC
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L109
            ENDIF
          ENDIF
          MOVE      HOLDINGC,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L110
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KBAS0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L110
            ENDIF
            BRANCH    EXIT,SF00L110,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      BASEDON,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L111
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,NODAYS  
          IF        SCPSMAN=1
            COMPARE   ZERO,NODAYS  
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L111
            ENDIF
          ENDIF
          MOVE      NODAYS,VAR       
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L112
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L113
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,IMPRREQ 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      IMPRREQ,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L114
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,INCORDER
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      INCORDER,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.------------------------------------------------------------
. Based on 1 = Value, 2 = Quantity
.------------------------------------------------------------
SETDEF00  READ      CONTROLF,TWENTY4;*160,HABCLEV1
          READ      CONTROLF,TWENTY4;*162,HABCLEV2
          MOVE      HABCLEV1,PERCAB
          MOVE      HABCLEV2,PERCBC
          PACK      STRDAT,CCC,CYY,ZERO,ONE,ZERO,ONE
          PACK      ENDDAT,CCC,CYY,CMM,CDD
          REP       " 0",STRDAT
          REP       " 0",ENDDAT
          MOVE      "1",BASEDON
          MOVE      "10",HOLDINGA
          MOVE      "17",HOLDINGB
          MOVE      "30",HOLDINGC
          MOVE      ONE,ACCEPT
          RETURN
.
DEFAULTN    MOVE     ANSN,DEFYESNO
            RETURN
.----------------------------------------------------------------------
. Print Report
.----------------------------------------------------------------------
REPT0000  CLOCK    TIME,CTIMEIS
          MOVE     "999",CLNO
          MOVE     ZERO,CPAGENO
.
          CALL     EXTR0000        * Extract Stock Data
          IF       INCORDER=1
            CALL     EXPO0000        * Extract Non-Stock Data
          ENDIF
.
          CALL     MAKEXP00        * Make Export File
.
          PACK     KEY5,STRCST
          CALL     RDSICA1
          IF       OVRCD=0
            CALL     RPSICA1
          ENDIF
REPT1000  CALL     RKSICA1
          BRANCH   OVRCD,REPT9000
          MATCH    SICACODE,ENDCST
          GOTO     REPT9000 IF LESS
          DISPLAY  *P30:24,*V2LON,SICACODE
.
          BRANCH   BASEDON,REPT1100,REPT1200
.
REPT1100  CALL     PRTVAL00
          GOTO     REPT1900
.
REPT1200  CALL     PRTQTY00
.
REPT1900  CALL     UND132
          PRINT    *98,TOTSOH,*120,TOTREC
          GOTO     REPT1000
.
REPT9000  CALL     UND132
          PRINT    *50,"***** End of Report *****"
          CALL     TRAN0000
          CLOSE    SINTMPA3
          CLOSE    SINTMPA2
          CLOSE    SINTMPA1,DELETE
.
REPT9999  RETURN
.------------------------------------------------------------
. Heading
.------------------------------------------------------------
HEAD0000  CALL      HEAD132
          PRINT     "Cost Centre From : ",FROMCST," to ",TOCST
          PRINT     "Usage Date  From : ",FROMDAT," to ",TODAT
          PRINT     "Cost Centre      : ",SICACODE,SP1,SICADESC
          CALL      UND132
          PRINT     "Catalog                                Unit        Avg":
                    ". Cost     Qty          Value ABC":
                    "  Cur. Max        Value Rec. Max        Value"
          CALL      UND132
          ADD       "5",CLNO
          RETURN
.------------------------------------------------------------
. Print ABC Analysis Based on Value
.------------------------------------------------------------
PRTVAL00  CALL      HEAD0000
          MOVE      ZERO,CSTTOTAL
          MOVE      ZERO,TOTAL
          MOVE      ZERO,TOTSOH
          MOVE      ZERO,TOTREC
          PACK      KEY12,SICACODE,SP70
          CALL      RSSITM1
PRTVAL10  CALL      RKSITM1
          BRANCH    OVRCD,PRTVAL19
          MATCH     SITMCST,SICACODE
          GOTO      PRTVAL19 IF NOT EQUAL
          MOVE      SITMVAL,F12P2
          ADD       F12P2,CSTTOTAL
          GOTO      PRTVAL10
.
PRTVAL19  ASSIGN    PERCAB*CSTTOTAL/100,ABCLEV1
          ASSIGN    (PERCAB+PERCBC)*CSTTOTAL/100,ABCLEV2
          PACK      KEY27,SICACODE,Z70
          CALL      RSSITM2
PRTVAL20  CALL      RPSITM2
          BRANCH    OVRCD,PRTVAL90
          MATCH     SICACODE,SITMCST
          GOTO      PRTVAL90 IF NOT EQUAL
.
          MOVE      SITMVAL,VALUE
          MOVE      SITMQTY,QUANTITY
          ADD       VALUE,TOTAL
          CALL      PLINE000
          GOTO      PRTVAL20
.
PRTVAL90
PRTVAL99  RETURN
.------------------------------------------------------------
. Print ABC Analysis Based on Value
.------------------------------------------------------------
PRTQTY00  CALL      HEAD0000
          MOVE      ZERO,TOTAL
          MOVE      ZERO,CSTTOTAL
          MOVE      ZERO,TOTSOH
          MOVE      ZERO,TOTREC
          PACK      KEY12,SICACODE,SP70
          CALL      RSSITM1
PRTQTY10  CALL      RKSITM1
          BRANCH    OVRCD,PRTQTY19
          MATCH     SITMCST,SICACODE
          GOTO      PRTQTY19 IF NOT EQUAL
          MOVE      SITMQTY,F12P2
          ADD       F12P2,CSTTOTAL
          GOTO      PRTQTY10
.
PRTQTY19  ASSIGN    PERCAB*CSTTOTAL/100,ABCLEV1
          ASSIGN    (PERCAB+PERCBC)*CSTTOTAL/100,ABCLEV2
          PACK      KEY27,SICACODE,Z70
          CALL      RSSITM3
PRTQTY20  CALL      RPSITM3
          BRANCH    OVRCD,PRTQTY90
          MATCH     SICACODE,SITMCST
          GOTO      PRTQTY90 IF NOT EQUAL
.
          MOVE      SITMVAL,VALUE
          MOVE      SITMQTY,QUANTITY
          ADD       QUANTITY,TOTAL
          CALL      PLINE000
          GOTO      PRTQTY20
PRTQTY90
PRTQTY99  RETURN
.------------------------------------------------------------
. Print Line
.------------------------------------------------------------
PLINE000  IF        TOTAL<ABCLEV1
            ADD       VALUE,LEVAVAL
            ADD       QUANTITY,LEVAQTY
            ADD       ONE,LEVANUM
            ASSIGN    QUANTITY/NODAYS*HOLDINGA,SUGGMAX
            MOVE      "A",SEQTYPE
          ELSE
            IF        TOTAL<ABCLEV2
              ADD       VALUE,LEVBVAL
              ADD       QUANTITY,LEVBQTY
              ADD       ONE,LEVBNUM
              ASSIGN    QUANTITY/NODAYS*HOLDINGB,SUGGMAX
              MOVE      "B",SEQTYPE
            ELSE
              ADD       VALUE,LEVCVAL
              ADD       QUANTITY,LEVCQTY
              ADD       ONE,LEVCNUM
              ASSIGN    QUANTITY/NODAYS*HOLDINGC,SUGGMAX
              MOVE      "C",SEQTYPE
            ENDIF
          ENDIF
          MOVE      SP1,D1
          MOVE      SITMCAT,KEY7
          CALL      RDSIIA1
          IF        OVRCD<>1
            IF        SIIASAB=1
              MOVE      "*",D1
            ENDIF
          ENDIF
          PACK      KEY12,SITMCST,SITMCAT
          CALL      RDSIIM1
          IF        OVRCD=1
            MOVE      QUANTITY,CURMAX8
          ELSE
            MOVE      SIIMMAX,CURMAX8
          ENDIF
.
          ADD       ONE,CLNO
          COMPARE   "55",CLNO
          CALL      HEAD0000 IF NOT LESS
          MOVE      SUGGMAX,SUGMAX8
          MOVE      QUANTITY,USEQTY8
          ASSIGN    CURMAX8*SIIAAVC,CURVAL
          ASSIGN    SUGMAX8*SIIAAVC,SUGVAL
          MOVE      SIIADES,KEY30
          MOVE      SIIAISS,KEY10
          MOVE      SIIAAVC,F8P2
          PRINT     SITMCAT,SP1,KEY30,SP1,KEY10,F8P2:
                    USEQTY8,VALUE,SP2,SEQTYPE,SP1,D1,SP1:
                    CURMAX8,CURVAL,SP1,SUGMAX8,SUGVAL
          ADD       CURVAL,TOTSOH
          ADD       SUGVAL,TOTREC
          CALL      WRTEXP00
.
          RETURN
.
.------------------------------------------------------------
. Extract Data
.------------------------------------------------------------
EXTR0000  DISPLAY  *P1:24,*EL,"Extracting :"
          CLEAR    FILENAME
          APPEND   "tsub41",FILENAME
          APPEND   PORT,FILENAME
          RESET    FILENAME
          REP      " 0",FILENAME
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     SINTMPA1,FILENAME
          TRAPCLR  IO
          IF       OVRCD=0
            CLOSE    SINTMPA1,DELETE
          ENDIF
.
          CLEAR    KEY80
          APPEND   "isbuild ",KEY80
          APPEND   FILENAME,KEY80
          APPEND   " 83 UC1-5,6-12 UC1-5,13-27,6-12 UC1-5,28-42,6-12",KEY80
          RESET    KEY80
          EXECUTE  KEY80,TASKID
.
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     SINTMPA1,FILENAME
          TRAPCLR  IO
          BRANCH   OVRCD,EXTR9999
          OPEN     SINTMPA2,FILENAME
          OPEN     SINTMPA3,FILENAME
.
          PACK     KEY5,STRCST
          CALL     RDSICA1
          IF       OVRCD=0
            CALL     RPSICA1
          ENDIF
EXTR1000  CALL     RKSICA1
          BRANCH   OVRCD,EXTR9999
          MATCH    SICACODE,ENDCST
          GOTO     EXTR9999 IF LESS
          DISPLAY  *P30:24,*V2LON,SICACODE
.
          PACK     KEY21,SICACODE,STRDAT,SP70
          CALL     RSSIRA4
EXTR1100  CALL     RKSIRA4
          BRANCH   OVRCD,EXTR1000
          MATCH    SIRACST,SICACODE
          GOTO     EXTR1000 IF NOT EQUAL
          MATCH    SIRADAT,ENDDAT
          GOTO     EXTR1000 IF LESS
          IF       IMPRREQ=1
            MATCH    "I",SIRATYP
            GOTO     EXTR1100 IF NOT EQUAL
          ENDIF
.
          PACK     KEY20,SIRATYP,SIRAREQ,SP70
          CALL     RSSIRB1
EXTR1200  CALL     RKSIRB1
          BRANCH   OVRCD,EXTR1100
          MATCH    SIRATYP,SIRBTYP
          GOTO     EXTR1100 IF NOT EQUAL
          MATCH    SIRAREQ,SIRBREQ
          GOTO     EXTR1100 IF NOT EQUAL
.
          IF       INCORDER=0
            PACK     KEY7,SIRBCAT,SP70
            CALL     RDSIIA1
            BRANCH   OVRCD,EXTR1200
            COMPARE  ONE,SIIANON
            GOTO     EXTR1200 IF EQUAL
          ENDIF
          MATCH    "I",SIRATYP
          IF       @EQUAL
            PACK     KEY12,SIRACST,SIRBCAT
            CALL     RDSIIM1
            BRANCH   OVRCD,EXTR1200
          ENDIF
.
          PACK     KEY12,SIRACST,SIRBCAT
          CALL     RDSITM1
          IF       OVRCD=0
            MOVE     SITMVAL,F12P2
            ADD      SIRBAMT,F12P2
            MOVE     F12P2,SITMVAL
            MOVE     SITMQTY,F12P2
            ADD      SIRBIQT,F12P2
            MOVE     F12P2,SITMQTY
            CALL     UPSITM1
          ELSE
            UNPACK   KEY12,SITMCST,SITMCAT
            MOVE     SIRBAMT,SITMVAL
            MOVE     SIRBIQT,SITMQTY
            CALL     WRSITM1
          ENDIF
          GOTO     EXTR1200
.
EXTR9999  RETURN
.
.------------------------------------------------------------
. Temp file IO Routines
.------------------------------------------------------------
RSSITM1   RESET     KEY12
          READ      SINTMPA1,KEY12;;
          RETURN
.
RASITM1   RESET     KEY12
          MOVE      ZERO,OVRCD
          READ      SINTMPA1,KEY12;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDSITM1   RESET     KEY12
          MOVE      ZERO,OVRCD
          READ      SINTMPA1,KEY12;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
RKSITM1   MOVE      ZERO,OVRCD
          READKS    SINTMPA1;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
RPSITM1   MOVE      ZERO,OVRCD
          READKP    SINTMPA1;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
UPSITM1   UPDATE    SINTMPA1;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          RETURN
.
WRSITM1   RESET     KEY12
          WRITE     SINTMPA1,KEY12;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          RETURN
.
DESITM1   RESET     KEY12
          DELETE    SINTMPA1,KEY12
          RETURN
.
RSSITM2   RESET     KEY27
          READ      SINTMPA2,KEY27;;
          RETURN
.
RASITM2   RESET     KEY27
          MOVE      ZERO,OVRCD
          READ      SINTMPA2,KEY27;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDSITM2   RESET     KEY27
          MOVE      ZERO,OVRCD
          READ      SINTMPA2,KEY27;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
RKSITM2   MOVE      ZERO,OVRCD
          READKS    SINTMPA2;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
RPSITM2   MOVE      ZERO,OVRCD
          READKP    SINTMPA2;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
UPSITM2   UPDATE    SINTMPA2;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          RETURN
.
WRSITM2   RESET     KEY27
          WRITE     SINTMPA2,KEY27;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          RETURN
.
DESITM2   RESET     KEY27
          DELETE    SINTMPA2,KEY27
          RETURN
.
RSSITM3   RESET     KEY27
          READ      SINTMPA3,KEY27;;
          RETURN
.
RASITM3   RESET     KEY27
          MOVE      ZERO,OVRCD
          READ      SINTMPA3,KEY27;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDSITM3   RESET     KEY27
          MOVE      ZERO,OVRCD
          READ      SINTMPA3,KEY27;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
RKSITM3   MOVE      ZERO,OVRCD
          READKS    SINTMPA3;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
RPSITM3   MOVE      ZERO,OVRCD
          READKP    SINTMPA3;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
UPSITM3   UPDATE    SINTMPA3;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          RETURN
.
WRSITM3   RESET     KEY27
          WRITE     SINTMPA3,KEY27;SITMCST,SITMCAT,SITMVAL,SITMQTY,SITMSPA
          RETURN
.
DESITM3   RESET     KEY27
          DELETE    SINTMPA3,KEY27
          RETURN
.
.------------------------------------------------------------
. File       : casetran
.
. Functions  : This file contains standard routines for
.              creating and transfering TAB delimited
.              export files to a PC using the unix script
.              keatran.
.
. Routines   : MAKEXP00  - Create the Export File and Headings
.              WRTEXP00  - Write Export Record to File
.              TRAN0000  - Transfer file to PC using script keatran
.
. Note       : The Variable EXPORTYN is used to determine if a
.              export file is to be created. 0=No, 1=Yes.
.
. Variables to be Declared
. ------------------------
. EXPORTFL  FILE      ASCII, FIXED=400     * Export File (Adjust Length to Suit)
. EXPORTFN  DIM       8                    * Export File Name
. TABDELM   EQU       0x09                 * Tab Delimiter
.------------------------------------------------------------
. Create Export File
.------------------------------------------------------------
MAKEXP00  COMPARE  ONE,EXPORTYN
          GOTO     MAKEXP99 IF NOT EQUAL
          MOVE     "EXPORT",KEY6
          PACK     EXPORTFN,KEY6,PORT
          REP      " 0",EXPORTFN
          PREP     EXPORTFL,EXPORTFN
          WRITE    EXPORTFL,SEQ;"Cost Centre",TABDELM:
                                "Description",TABDELM:
                                "Catalog",TABDELM:
                                "Description",TABDELM:
                                "Issue Unit",TABDELM:
                                "Unit Price",TABDELM:
                                "Usage Quantity",TABDELM:
                                "Usage Value",TABDELM:
                                "ABC",TABDELM:
                                "Current Level",TABDELM:
                                "Current Value",TABDELM:
                                "Recommended Level",TABDELM:
                                "Recommended Value"
MAKEXP99  RETURN
.------------------------------------------------------------
. Write to Export File
.------------------------------------------------------------
WRTEXP00  COMPARE  ONE,EXPORTYN
          GOTO     WRTEXP99 IF NOT EQUAL
          WRITE    EXPORTFL,SEQ;SITMCST,TABDELM:
                                SICADESC,TABDELM:
                                SITMCAT,TABDELM:
                                SIIADES,TABDELM:
                                SIIAISS,TABDELM:
                                SIIAAVC,TABDELM:
                                USEQTY8,TABDELM:
                                SITMVAL,TABDELM:
                                SEQTYPE,TABDELM:
                                CURMAX8,TABDELM:
                                CURVAL,TABDELM:
                                SUGMAX8,TABDELM:
                                SUGVAL
WRTEXP99  RETURN
.------------------------------------------------------------
. Execute Transfer Script eg softerm
.------------------------------------------------------------
TRAN0000  COMPARE  ONE,EXPORTYN
          GOTO     TRAN9999 IF NOT EQUAL
          MOVE     YES,DEFYESNO
          CLOSE    EXPORTFL
          DISPLAY  *P1:24,*EL,"Execute Transfer Now (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "30",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO
          GOTO     TRAN9999 IF EQUAL   *  No Transfer
.
          MOVE     ZERO,HLEF
          CALL     GETSCR00
.
          CLEAR    KEY80
          APPEND   "keatran ",KEY80
          APPEND   EXPORTFN,KEY80
          APPEND   ".txt",KEY80
          RESET    KEY80
          EXECUTE  KEY80,TASKID
.
          CALL     PUTSCR00
.
          DISPLAY  *P1:24,*EL,"Transfer Completed Ok (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "31",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO
          GOTO     TRAN0000 IF EQUAL   *  Not ok
.
          PREP     EXPORTFL,EXPORTFN
          CLOSE    EXPORTFL
.
TRAN9999  RETURN
.------------------------------------------------------------
. Extract Non-Stock Purchase Data
.------------------------------------------------------------
EXPO0000  DISPLAY  *P1:24,*EL,"Scanning Orders Receivals ..."
          MOVE     ZERO,POCOUNT
          PACK     KEY20,STRDAT,SP70
          CALL     RDSIPF4
          IF       OVRCD=0
            CALL     RPSIPF4
          ENDIF
EXPO1000  CALL     RKSIPF4
          BRANCH   OVRCD,EXPO9999
          MATCH    SIPFDAT,ENDDAT
          GOTO     EXPO9999 IF LESS
.
          ADD      ONE,POCOUNT
          IF       POCOUNT%500=0
            DISPLAY   *P40:24,*V2LON,POCOUNT
          ENDIF
.
          PACK     KEY10,SIPFPON,SIPFITM,SP70
          CALL     RDSIPC1
          BRANCH   OVRCD,EXPO1000
.
          MATCH    STRCST,SIPCCST
          GOTO     EXPO1000 IF LESS
          MATCH    SIPCCST,ENDCST
          GOTO     EXPO1000 IF LESS
.
          MATCH    SP70,SIPCCAT
          GOTO     EXPO1000 IF EQUAL
          MOVE     SIPCCAT,KEY7
          CALL     RDSIIA1
          BRANCH   OVRCD,EXPO1000
.
          PACK     KEY30,SIIAISS,SIPFSUT,SP70
          CALL     RDSIFA1
          IF       OVRCD=1
            MOVE     ONE,SIFACTOR
          ENDIF
.
          PACK     KEY12,SIPCCST,SIPCCAT
          CALL     RDSITM1
          IF       OVRCD=0
            MOVE     SITMVAL,F12P2
            ASSIGN   F12P2+(SIPFCST*SIPFQTY),F12P2
            MOVE     F12P2,SITMVAL
            MOVE     SITMQTY,F12P2
            ASSIGN   F12P2+(SIPFQTY*SIFACTOR),F12P2
            MOVE     F12P2,SITMQTY
            CALL     UPSITM1
          ELSE
            UNPACK   KEY12,SITMCST,SITMCAT
            ASSIGN   SIPFCST*SIPFQTY,F12P2
            MOVE     F12P2,SITMVAL
            ASSIGN   SIPFQTY*SIFACTOR,F12P2
            MOVE     F12P2,SITMQTY
            CALL     WRSITM1
          ENDIF
          GOTO     EXPO1000
.
EXPO9999  RETURN
.
.----------------------------------------------------------------------
. Enter Cost Centre Range
.----------------------------------------------------------------------
ECOST000   MOVE     "    4",FLDID
           CALL     GETPOSIT
           CALL     KSICAA00
           BRANCH   EXIT,ECOST100,ECOST980
           MOVE     SICACODE,STRCST
           PACK     FROMCST,SICACODE,SP1,SICADESC
           GOTO     ECOST140
ECOST100   MOVE     "Start             ",FROMCST
           MOVE     SP70,STRCST
.
ECOST140   MOVE     FROMCST,VAR
           CALL     DISPITEM
.
ECOST150   MOVE     "    5",FLDID
           CALL     GETPOSIT
           CALL     KSICAA00
           BRANCH   EXIT,ECOST200,ECOST980
           MOVE     SICACODE,ENDCST
           PACK     TOCST,SICACODE,SP1,SICADESC
           MATCH    STRCST,ENDCST
           GOTO     ECOST950 IF EQUAL
           GOTO     ECOST950 IF NOT LESS
           BEEP
           MOVE     "To Cost Centre Must Be > From Cost Centre - ",DISPMSG
           CALL     MESSAGE1
           GOTO     ECOST000
.
ECOST200   MOVE     "Finish             ",TOCST
           MOVE     "~~~~~~~",ENDCST
.
ECOST950   MOVE     "    4",FLDID
           CALL     GETPOSIT
           GOTO     ECOST999
.
ECOST980   MOVE     TWO,EXIT
.
ECOST999   RETURN
.

.----------------------------------------
. Enter Date Range
.  where DAT     = Field ID
.        RDATE   = Call Routine Label
.        "    1" = Screen Item Number for "from" Variable
.        "    2" = Screen Item Number for "to" Variable
.
.  Return Values
.        FROMDAT  Date for Start of Range Formatted in a DIM 10
.        TODAT    Date for End of Range Formatted in a DIM 10
.        STRDAT   Date for Start of Range Format CCYYMMDD
.        ENDDAT   Date for End of Range Format CCYYMMDD
.----------------------------------------
RDATE000   MOVE     "    6",FLDID
           CALL     GETPOSIT
           UNPACK   STRDAT,CCENT,CYEAR,CMON,CDAY
           CALL     KEYDATE
           BRANCH   OVRCD,RDATE100
           MATCH    SP2,CDAY
           GOTO     RDATE100 IF EQUAL
           PACK     STRDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",STRDAT
           CALL     PACDATE
           MOVE     CPCDATE,FROMDAT
           GOTO     RDATE140
RDATE100   BEEP
           GOTO     RDATE000
.
RDATE140   MOVE     FROMDAT,VAR
           CALL     DISPITEM
.
RDATE150   MOVE     "    7",FLDID
           CALL     GETPOSIT
           UNPACK   ENDDAT,CCENT,CYEAR,CMON,CDAY
           CALL     KEYDATE
           BRANCH   OVRCD,RDATE200
           MATCH    SP2,CDAY
           GOTO     RDATE200 IF EQUAL
           PACK     ENDDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",ENDDAT
           CALL     PACDATE
           MOVE     CPCDATE,TODAT
           MATCH    STRDAT,ENDDAT
           GOTO     RDATE999 IF EQUAL
           GOTO     RDATE999 IF NOT LESS
           BEEP
           MOVE     "To Date Must Be > From Date - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDATE000
.
RDATE200   BEEP
           GOTO     RDATE150
.
RDATE999   PACK     CDYSFDTE,STRDAT
           PACK     CDYSTDTE,ENDDAT
           CALL     CALCDAYS
           MOVE     CDYSDAYS,NODAYS
           MOVE     "   14",FLDID
           CALL     GETPOSIT
           IF       OVRCD=0
             MOVE     NODAYS,VAR
             CALL     DISPITEM
           ENDIF
           MOVE     "    6",FLDID
           CALL     GETPOSIT
           RETURN
.
.------------------------------------------------------------
. Based on 1 = Value, 2 = Quantity
.------------------------------------------------------------
KBAS0000  MOVE      "1",BASEDON
          KEYIN     *PCCOL:CVERT,*V2LON,*RV,BASEDON
.
          COMPARE   "1",BASEDON
          GOTO      KBAS9999 IF EQUAL
          COMPARE   "2",BASEDON
          GOTO      KBAS9999 IF EQUAL
          BEEP
          GOTO      KBAS0000
.
KBAS9999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       CALCDAYS    
          INC       SINCCAIO/INC
          INC       SINCCAKY    
          INC       SINCIAIO/INC
          INC       SINFACIO/INC
          INC       SINIMPIO/INC
          INC       SINPOCIO/INC
          INC       SINPOFIO/INC
          INC       SINREAIO/INC
          INC       SINREBIO/INC
.
          INC       STDGENCD
.

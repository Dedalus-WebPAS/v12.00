.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.00.00"
.-------------------------------------------------------
. V9.04.01  13.04.2005 Peter Vela CAR 59696
.           Recompiled for SINSUAFD
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.09.B01 16.11.2000 Charles Handaya
.           Recompiled (Modification of Warehouse Security)
.-------------------------------------------------------
. VF.01.01  18.07.2000 Charles Handaya
.           Recompiled for SINIPSIO change
.           Related to Quote 9817
.-------------------------------------------------------
. VF.00.02  22.12.1999 Charles Handaya
.           Recompiled for Fixing Audit Date (CCYYMMDD)
. VF.00.01  03.11.1999 Sandra Barcham
.           Change locked message to use X
.-------------------------------------------------------
DEFLTWH   DIM       5 * Scr 00 Fld    54
IMPORTFN  DIM       8
IMPORTFL  FILE      ASCII, FIXED=200
LOWUP     INIT      "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"
QTYEXT    FORM      6
QTYREQ    FORM      6
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASIN42
.   Function      :   Input Imprest Stocktake                 
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       SINCCAFD/INC
          INC       SINCIAFD/INC
          INC       SINCIEFD/INC
          INC       SINCONFD/INC
          INC       SINIMPFD/INC
          INC       SINIPSFD/INC
          INC       SINNATFD/INC
          INC       SINSUAFD/INC
          INC       SINTMPDF/INC
          INC       SINWARFD/INC
.=========================
.Local Variable Definition
.-------------------------
.
.    Multi Item Key Fields Scr 00 Fld    10
.-------------------------------------------------------
SIIM3NAM  INIT      "SIIM3"
SIIM3LEN  FORM      "131"
SIIM3IDX  INIT      "DC1-5 UC6-16"
SIIM3FNM  DIM       8  * Filename
SIIM3AFL  FORM      1  * End Accept Mode
SIIM3END  FORM      1  * End Display
SIIM3SNO  FORM      5  * Number of Items on the Screen
SIIM3NXT  DIM         16
SIIM3FL1  IFILE     SQL, FIXED=131,  KEY="D1-5"
SIIM3FL2  IFILE     SQL, FIXED=131, KEY="U6-16"
SIIM3CNT  FORM      3  * Number of Items on Screen
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASIN42"
PRGNAM    INIT      "Input Imprest Stocktake                 "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC01L000
          CLOSE     SIIM3FL2
          CLOSE     SIIM3FL1,DELETE
.
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA1,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA1,"sinciaaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA1,"sincieaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA2,"sincieaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA1,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA2,"sinimpaf"
          DISPLAY   *P56:24,"Opening sinimpaf";
          OPEN      SINIMPA3,"sinimpaf"
          DISPLAY   *P56:24,"Opening  sinipsaf           ";
          OPEN      SINIPSA1,"sinipsaf"          
          DISPLAY   *P56:24,"Opening sinipsaf";
          OPEN      SINIPSA2,"sinipsaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA1,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA1,"sinwaraf"
.--------------------------------------------------------
. Initialise Batch Screen Catalog Code                       
.--------------------------------------------------------
          MOVE     ZERO,SIIM3SNO
          MOVE     "00   10",KEY7
          PACK     KEY15,PRGID,KEY7,SP70
          PACK     KEY20,PRGID,KEY7,SP70
          CALL     RSSCPS2
          CALL     RKSCPS2
          IF       OVRCD=0
            PACK     KEY20,SCPSPID,SCPSSID,SCPSITM
            MATCH    KEY15,KEY20
            IF       @EQUAL
              MOVE     SCPSNOR,SIIM3SNO
            ENDIF
          ENDIF
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Screen                        
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Menu                               
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Import Barcode Download            
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Screen                        
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Screen                        
.-------------------------------------------------------
CF00L000  COMPARE   ZERO,ACCEPT
              GOTO      CF00L999 IF EQUAL
          MOVE      SP70,SICACODE
          MOVE      SP70,SICADESC
          MOVE      SP70,SIIMCAT 
          MOVE      SP70,SIIADES 
          MOVE      SP70,SIIMSEQ 
          MOVE      SP70,SIIAISS 
          MOVE      ZERO,SIIMQOH 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Screen                        
.--------------------------------------------------------
KY00L000
.
KY00L110
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=1
            MOVE      "Mandatory Field Missing. Fatal - ",DISPMSG
            BEEP
            CALL      MESSAGE1
            GOTO      FATALERR
          ENDIF
          MOVE      "0",CKEYTYP
          CALL      KCOST000
          BRANCH    EXIT,KY00L900,KY00L900
          MOVE      ZERO,ACCEPT
          MOVE      SICACODE,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICADESC,VAR     
            CALL      DISPITEM
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Screen                        
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Screen                        
.---------------------------------------------------------
LM00L000
.---------------------------------------------------------
. Load for :    10 Catalog Code                       
.---------------------------------------------------------
          UNPACK    SP70,SIIMCST,SIIMSEQ,SIIMCAT
          PACK      SIIM3FNM,ANST,SIIM3NAM,PORT
          REP       " 0",SIIM3FNM
          MOVE      ZERO,SIIM3AFL
          CLOSE     SIIM3FL2
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SIIM3FL1,SIIM3FNM
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     SIIM3FL1,DELETE
          ENDIF
          PACK      KEY80,SGENISB,SIIM3FNM,SP1,SIIM3LEN,SP1,SIIM3IDX
          DISPLAY   *P1:3;
          EXECUTE   KEY80,TASKID
          OPEN      SIIM3FL1,SIIM3FNM
          OPEN      SIIM3FL2,SIIM3FNM
          PACK      KEY16,SICACODE,SP70
          MOVE      KEY16,SAVKEY80
          SETLPTR   SAVKEY80,5 
          CALL      RDSIIM3 
          IF        OVRCD=0
            CALL      RPSIIM3 
          ENDIF
LM00L100
          CALL      RKSIIM3 
          BRANCH    OVRCD,LM00L105
          PACK      KEY16,SIIMCST,SIIMSEQ,SIIMCAT
          MATCH     SAVKEY80,KEY16   
          GOTO      LM00L105 IF NOT EQUAL
          RESET     KEY16,6
          MOVE      KEY16,KEY11
          MOVE      SP70,SCTMROW
          MOVE      SP70,SCTMCOL
          CALL      TASIIM32
          IF        OVRCD=0
            CALL      TUSIIM32
          ELSE
            CALL      TWSIIM32
          ENDIF
          GOTO     LM00L100
LM00L105
          MOVE     SP70,KEY11  
          CALL     TSSIIM32
          RETURN
.---------------------------------------------------------
. Batch Item Selected Screen : Main Screen                        
.---------------------------------------------------------
SM00L000
          MOVE      ZERO,STDGSFLG
          MOVE      SCPSITM,FIRSTITM
          MOVE      SCPSROW,SCTMROW
          MOVE      SCPSCOL,SCTMCOL
          PACK      KEY15,PRGID,SCRID,SCPSROW,SCPSCOL
          MOVE      KEY15,SKSCPS15
          CALL      RDSCPS1
          COMPARE   ZERO,ACCEPT
          GOTO      SM00L010 IF EQUAL
SM00L005
          MOVE      SCPSROW,CVERT
          MOVE      SCPSCOL,CCOL
          MOVE      SCPSITM,FIELDNO
          MOVE      ONE,STDGSFLG
          BRANCH    FIELDNO,SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                           SM00L010,SM00L101,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                           SM00L010,SM00L010,SM00L010,SM00L010:
                           SM00L010,SM00L010,SM00L010,SM00L010:
                           SM00L010,SM00L010
SM00L006
          CALL      RKSCPS1
          BRANCH    OVRCD,SM00L007
          MATCH     PRGID,SCPSPID
          GOTO      SM00L007 IF NOT EQUAL
          MATCH     SCRID,SCPSSID
          GOTO      SM00L007 IF NOT EQUAL
          MATCH     FIRSTITM,SCPSITM
          GOTO      SM00L007 IF EQUAL
          MATCH     NAMSSFFI,SCPSMTY
          GOTO      SM00L006 IF NOT EQUAL
          GOTO      SM00L005
SM00L007
          MOVE      ZERO,STDGSFLG
          MOVE      SKSCPS15,KEY15
          CALL      RDSCPS1
SM00L010
          BRANCH    STDGSFLG,SM00L006
          CALL      RKSCPS1
          BRANCH    OVRCD,SM00L900
          MATCH     PRGID,SCPSPID
          GOTO      SM00L900 IF NOT EQUAL
          MATCH     SCRID,SCPSSID
          GOTO      SM00L900 IF NOT EQUAL
          MATCH     FIRSTITM,SCPSITM
          GOTO      SM00L900 IF EQUAL
          MATCH     NAMSSFFI,SCPSMTY
          GOTO      SM00L010 IF NOT EQUAL
          MOVE      SCPSROW,CVERT
          MOVE      SCPSCOL,CCOL
          MOVE      SCPSITM,FIELDNO
          BRANCH    FIELDNO,SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L010,SM00L010,SM00L010:
                           SM00L010,SM00L010,SM00L010,SM00L010:
                            SM00L010,SM00L102,SM00L010,SM00L010:
                           SM00L010,SM00L010,SM00L010,SM00L010:
                           SM00L010,SM00L010,SM00L010,SM00L010:
                           SM00L010,SM00L010
          GOTO      SM00L010
.
SM00L101
          MOVE     ZERO,SIIM3AFL
          STRIP     SIIMCAT 
          SFORMAT   VAR,SCPSLEN
          MOVE      SIIMCAT,VAR
          KEYIN     *PCCOL:CVERT,*V2LON,*MASK,*RV,VAR
          MOVE      VAR,SIIMCAT 
          SFORMAT   VAR,127
          ENDSET    SIIMCAT 
          APPEND    SP70,SIIMCAT 
          RESET     SIIMCAT 
          MATCH     SP70,SIIMCAT 
          GOTO      SM00L990 IF EQUAL
          CMATCH    EXITCHAR,SIIMCAT 
          GOTO      SM00L990 IF EQUAL
          PACK     KEY16,SIIMCST,SIIMSEQ,SIIMCAT                                                   
          RESET    KEY16,6
          MOVE     KEY16,KEY11
          CALL      TASIIM32
          IF        OVRCD=0
            MOVE      "Record Already On File - ",DISPMSG
            CALL      MESSAGE1
            GOTO      SM00L101
          ENDIF
          CALL      GETDET00
          MOVE      SIIMCAT,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   11",FLDID
          CALL      GETMLPOS
          IF        EXIT=0
            MOVE      SIIADES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SM00L010
.
SM00L102
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,SIIMQOH 
          IF        SCPSMAN=1
            COMPARE   ZERO,SIIMQOH 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SM00L102
            ENDIF
          ENDIF
          MOVE      SIIMQOH,VAR      
          CALL      DISPITEM
          GOTO     SM00L010
SM00L900
          MATCH    "SIIM3",NAMSSFFI
          IF       @EQUAL
            PACK     KEY16,SIIMCST,SIIMSEQ,SIIMCAT
            RESET    KEY16,6
            MOVE     KEY16,KEY11
            CALL      TASIIM32
            IF        OVRCD=0
              CALL      TUSIIM32
            ELSE
              CALL      TWSIIM32
            ENDIF
            GOTO      SM00L999
          ENDIF
          GOTO      SM00L999
SM00L990
          MATCH    "SIIM3",NAMSSFFI
          IF       @EQUAL
            MOVE     ONE,SIIM3AFL
          ENDIF
SM00L999
          RETURN
.--------------------------------------------------------
. Display Current Page of Multi Items
.--------------------------------------------------------
DP00L000
          MOVE     ZERO,SIIM3CNT
          MOVE     ZERO,SIIM3END
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DP00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DP00L600
          MATCH    PRGID,SCPSPID
          GOTO     DP00L600 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DP00L600 IF NOT EQUAL
          MATCH    NAMSSFFI,SCPSMTY
          GOTO     DP00L010 IF NOT EQUAL
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,DP00L010,DP00L010,DP00L010,DP00L010:
                            DP00L010,DP00L010,DP00L010,DP00L010:
                           DP00L010,DP00L101,DP00L102,DP00L103:
                            DP00L104,DP00L105,DP00L010,DP00L010:
                           DP00L010,DP00L010,DP00L010,DP00L010:
                           DP00L010,DP00L010,DP00L010,DP00L010:
                           DP00L010,DP00L010
          GOTO      DP00L010
.
DP00L101
          IF        SIIM3END=0
            CALL      TKSIIM32
            IF        OVRCD=1
              MOVE      ONE,SIIM3END
            ELSE
              MOVE      ZERO,SIIM3END
              MOVE      SCPSROW,SCTMROW
              MOVE      SCPSCOL,SCTMCOL
              CALL      TUSIIM32
          CALL      GETDET00
              MOVE      SIIMCAT,VAR      
              CALL      DISPITEM
            ENDIF
          ENDIF
          IF        SIIM3END=1
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L102
          IF        SIIM3END=0
            MOVE      SIIADES,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L103
          IF        SIIM3END=0
            MOVE      SIIMSEQ,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L104
          IF        SIIM3END=0
            MOVE      SIIAISS,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
.
DP00L105
          IF        SIIM3END=0
            MOVE      SIIMQOH,VAR      
            CALL      DISPITEM
          ELSE
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          GOTO      DP00L010
DP00L600
          MATCH    "SIIM3",NAMSSFFI
          GOTO     DP00L605 IF NOT EQUAL
          GOTO     DP00L999
DP00L605
DP00L999
          RETURN
.--------------------------------------------------------
. Display First Page of Multi Items
.--------------------------------------------------------
FP00L000
.
          CALL     CT00L000
          MATCH    "SIIM3",NAMSSFFI
          GOTO     FP00L105 IF NOT EQUAL
          MOVE     SP70,KEY11  
          CALL     TSSIIM32 * Start
          CALL     DP00L000
          GOTO     FP00L999
FP00L105
FP00L999  RETURN
.--------------------------------------------------------
. Display Last Page of Multi Items
.--------------------------------------------------------
LP00L000
.
          CALL     CT00L000
          MATCH    "SIIM3",NAMSSFFI
          GOTO     LP00L105 IF NOT EQUAL
          PACK     KEY11,Z70
          CALL     TSSIIM32
          IF       OVRCD=1
            CALL     TPSIIM32 * End
          ENDIF
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<SIIM3SNO
            CALL     TPSIIM32
            ADD      ONE,SECTOR
          DO
          CALL     DP00L000
          GOTO     LP00L999
LP00L105
LP00L999  RETURN
.--------------------------------------------------------
. Display Previous Page  
.--------------------------------------------------------
PP00L000
.
PP00L100
          MATCH    "SIIM3",NAMSSFFI
          GOTO     PP00L115 IF NOT EQUAL
PP00L105
          MOVE     SP70,SIIM3NXT
          PACK     KEY5,SP1,ONE,SP70
          CALL     TSSIIM31
          CALL     TKSIIM31 * First on Page
          MOVE     KEY11,SIIM3NXT
          CALL     TSSIIM32
          CALL     TPSIIM32 * Get Key
          IF       OVRCD=1
            BEEP
            GOTO      PP00L999
          ENDIF
.
          CALL     CT00L000
.
. Position and Display Page
.--------------------------
PP00L110
          MOVE     SIIM3NXT,KEY11  
          CALL     TSSIIM32
          MOVE     ZERO,SECTOR
          WHILE    SECTOR<=SIIM3SNO
            CALL     TPSIIM32
            ADD      ONE,SECTOR
          DO
          CALL     DP00L000
          GOTO     PP00L999
PP00L115
PP00L999  RETURN
.--------------------------------------------------------
. Display Next Page of Multi Items
.--------------------------------------------------------
NP00L000
          MATCH    "SIIM3",NAMSSFFI
          GOTO     NP00L115 IF NOT EQUAL
NP00L105
          MOVE     SP70,SIIM3NXT
          PACK     KEY5,Z70
          CALL     TSSIIM31
          CALL     TPSIIM31
          MOVE     KEY11,SIIM3NXT
          CALL     TSSIIM32
          CALL     TKSIIM32
          IF       OVRCD=1
            BEEP
            GOTO      NP00L999
          ENDIF
.
          CALL     CT00L000
.
. Position and Display Page
.--------------------------
NP00L110
          MOVE     SIIM3NXT,KEY11  
          CALL     TSSIIM32
          CALL     DP00L000
          GOTO     NP00L999
NP00L115
NP00L999  RETURN
.--------------------------------------------------------
. Clear Page of Multi Items from Temp File
.--------------------------------------------------------
CT00L000
          MATCH    "SIIM3",NAMSSFFI
          GOTO     CT00L115 IF NOT EQUAL
CT00L105
          PACK     KEY5,SP1,ONE,SP70
          CALL     TSSIIM31
          CALL     TKSIIM31
          BRANCH   OVRCD,CT00L110
          CALL     TRSIIM32
          MOVE     SP70,SCTMROW
          MOVE     SP70,SCTMCOL
          CALL     TUSIIM32
          GOTO     CT00L105
CT00L110
          GOTO     CT00L999
CT00L115
CT00L999  RETURN
.----------------------------------
. Clear Pages of Multi Items 
.----------------------------------
CP00L000
          CALL     CT00L000
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
CP00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,CP00L999
          MATCH    PRGID,SCPSPID
          GOTO     CP00L999 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     CP00L999 IF NOT EQUAL
          MATCH    NAMSSFFI,SCPSMTY
          GOTO     CP00L010 IF NOT EQUAL
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,CP00L010,CP00L010,CP00L010,CP00L010:
                            CP00L010,CP00L010,CP00L010,CP00L010:
                           CP00L010,CP00L100,CP00L100,CP00L100:
                            CP00L100,CP00L100,CP00L010,CP00L010:
                           CP00L010,CP00L010,CP00L010,CP00L010:
                           CP00L010,CP00L010,CP00L010,CP00L010:
                           CP00L010,CP00L010
.
CP00L100
          PACK     VAR,SP70,SP70
          CALL     DISPITEM  * Display Blank Item
          GOTO     CP00L010
CP00L999  RETURN
.---------------------------------------------------------
. Add Items
.---------------------------------------------------------
AD00L000
          CALL      CP00L000 * Clear Screen of Items
          PACK      KEY20,PRGID,SCRID,ITMSSFFI,SP70
          CALL      RSSCPS2
AD00L010  CALL      RKSCPS2
          BRANCH    OVRCD,AD00L000
          MATCH     PRGID,SCPSPID
          GOTO      AD00L000 IF NOT EQUAL
          MATCH     SCRID,SCPSSID
          GOTO      AD00L000 IF NOT EQUAL
          MATCH     ITMSSFFI,SCPSITM
          GOTO      AD00L000 IF NOT EQUAL
          PACK      SKSCPS20,SCPSPID,SCPSSID,SCPSITM,SCPSROW,SCPSCOL
          MOVE      ACCEPT,SACCEPT
          MOVE      ONE,ACCEPT
          CALL      SM00L000
          MOVE      SACCEPT,ACCEPT
          MOVE      SKSCPS20,KEY20
          CALL      RDSCPS2
          MATCH     "SIIM3",NAMSSFFI
          IF        @EQUAL
            COMPARE   ZERO,SIIM3AFL
            GOTO      AD00L010 IF EQUAL
            CALL      FP00L000
            GOTO      AD00L999
          ENDIF
AD00L999
          RETURN
.---------------------------------------------------------
. Delete Items
.---------------------------------------------------------
DL00L000  
          MOVE      SCSLDES,DISPMSG
          CALL      MESSAGE2
DL00L005  
          CALL      MDELQ000
          BRANCH    EXIT,DL00L900,DL00L900
          MOVE      SCSLITM,FIELDNO
          MATCH     ITMSSFFI,SCSLITM
          GOTO      DL00L100 IF NOT EQUAL
          CALL      SELECTED
          MATCH     "SIIM3",SCPSMTY
          IF        @EQUAL
            PACK      KEY5,SCSLROW,SCSLCOL
            CALL      TRSIIM31
            IF        OVRCD=0
              CALL      TDSIIM32
            ELSE
              BEEP
              GOTO      DL00L005
            ENDIF
            PACK      KEY5,SP1,ONE,SP70
            CALL      TSSIIM31
            CALL      TKSIIM31
            MOVE     KEY11,SIIM3NXT
            CALL      CT00L000
            MOVE      SIIM3NXT,KEY11  
            CALL      TSSIIM32
            CALL      TPSIIM32
            CALL      DP00L000
            GOTO      DL00L005
          ENDIF
DL00L100  MOVE      "Invalid Selection. - ",DISPMSG
          CALL      MESSAGE1
          GOTO      DL00L005
DL00L900  CALL      MESSAGE3
          RETURN
.---------------------------------------------------------
. Batch IO for Screen : Main Screen                        
.---------------------------------------------------------
.---------------------------------------------------------
. Batch IO for :    10 Catalog Code                       
.---------------------------------------------------------
TSSIIM31  RESET     KEY5
          READ      SIIM3FL1,KEY5;;
          RETURN
.
TSSIIM32  RESET     KEY11  
          READ      SIIM3FL2,KEY11;;
          RETURN
.
TASIIM32  RESET     KEY11  
          MOVE      ZERO,OVRCD
          READ      SIIM3FL2,KEY11;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
TDSIIM31  RESET     KEY5
          DELETE    SIIM3FL1,KEY5
          RETURN
.
TDSIIM32  RESET     KEY11
          DELETE    SIIM3FL2,KEY11
          RETURN
.
TKSIIM31  MOVE      ZERO,OVRCD
          READKS    SIIM3FL1;SCTMROW,SCTMCOL,KEY11:
                        SIIMCST,SIIMCAT,SIIMSEQ,SIIMMAX,SIIMREQ:
                        SIIMQOH,SIIMUR1,SIIMUR2,SIIMUD1,SIIMUD2,SIIMUC1:
                        SIIMUC2,SIIMUY1,SIIMUY2,SIIMWAR,SIIMSPA                 
          GOTO      OVERCOND IF OVER
          RETURN
.
TKSIIM32  MOVE      ZERO,OVRCD
          READKS    SIIM3FL2;SCTMROW,SCTMCOL,KEY11:
                        SIIMCST,SIIMCAT,SIIMSEQ,SIIMMAX,SIIMREQ:
                        SIIMQOH,SIIMUR1,SIIMUR2,SIIMUD1,SIIMUD2,SIIMUC1:
                        SIIMUC2,SIIMUY1,SIIMUY2,SIIMWAR,SIIMSPA                 
          GOTO      OVERCOND IF OVER
          RETURN
.
TPSIIM31  MOVE      ZERO,OVRCD
          READKP    SIIM3FL1;SCTMROW,SCTMCOL,KEY11:
                        SIIMCST,SIIMCAT,SIIMSEQ,SIIMMAX,SIIMREQ:
                        SIIMQOH,SIIMUR1,SIIMUR2,SIIMUD1,SIIMUD2,SIIMUC1:
                        SIIMUC2,SIIMUY1,SIIMUY2,SIIMWAR,SIIMSPA                 
          GOTO      OVERCOND IF OVER
          RETURN
.
TPSIIM32  MOVE      ZERO,OVRCD
          READKP    SIIM3FL2;SCTMROW,SCTMCOL,KEY11:
                        SIIMCST,SIIMCAT,SIIMSEQ,SIIMMAX,SIIMREQ:
                        SIIMQOH,SIIMUR1,SIIMUR2,SIIMUD1,SIIMUD2,SIIMUC1:
                        SIIMUC2,SIIMUY1,SIIMUY2,SIIMWAR,SIIMSPA                 
          GOTO      OVERCOND IF OVER
          RETURN
.
TRSIIM31  RESET     KEY5
          MOVE      ZERO,OVRCD
          READ      SIIM3FL1,KEY5;SCTMROW,SCTMCOL,KEY11:
                        SIIMCST,SIIMCAT,SIIMSEQ,SIIMMAX,SIIMREQ:
                        SIIMQOH,SIIMUR1,SIIMUR2,SIIMUD1,SIIMUD2,SIIMUC1:
                        SIIMUC2,SIIMUY1,SIIMUY2,SIIMWAR,SIIMSPA                 
          GOTO      OVERCOND IF OVER
          RETURN
.
TRSIIM32  RESET     KEY11  
          MOVE      ZERO,OVRCD
          READ      SIIM3FL2,KEY11;SCTMROW,SCTMCOL,KEY11:
                        SIIMCST,SIIMCAT,SIIMSEQ,SIIMMAX,SIIMREQ:
                        SIIMQOH,SIIMUR1,SIIMUR2,SIIMUD1,SIIMUD2,SIIMUC1:
                        SIIMUC2,SIIMUY1,SIIMUY2,SIIMWAR,SIIMSPA                 
          GOTO      OVERCOND IF OVER
          RETURN
.
TUSIIM31  UPDATE    SIIM3FL1;SCTMROW,SCTMCOL,KEY11:
                        SIIMCST,SIIMCAT,SIIMSEQ,SIIMMAX,SIIMREQ:
                        SIIMQOH,SIIMUR1,SIIMUR2,SIIMUD1,SIIMUD2,SIIMUC1:
                        SIIMUC2,SIIMUY1,SIIMUY2,SIIMWAR,SIIMSPA                 
          RETURN
.
TUSIIM32
          UPDATE    SIIM3FL2;SCTMROW,SCTMCOL,KEY11:
                        SIIMCST,SIIMCAT,SIIMSEQ,SIIMMAX,SIIMREQ:
                        SIIMQOH,SIIMUR1,SIIMUR2,SIIMUD1,SIIMUD2,SIIMUC1:
                        SIIMUC2,SIIMUY1,SIIMUY2,SIIMWAR,SIIMSPA                 
          RETURN
.
TWSIIM32  RESET     KEY11  
          WRITE     SIIM3FL2,KEY11;SCTMROW,SCTMCOL,KEY11:
                        SIIMCST,SIIMCAT,SIIMSEQ,SIIMMAX,SIIMREQ:
                        SIIMQOH,SIIMUR1,SIIMUR2,SIIMUD1,SIIMUD2,SIIMUC1:
                        SIIMUC2,SIIMUY1,SIIMUY2,SIIMWAR,SIIMSPA                 
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Screen                        
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
          MOVE      "SIIM3",NAMSSFFI
          MOVE      "   10",ITMSSFFI
          CALL      FP00L000
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Screen                        
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L101,PS00L999,PS00L999,PS00L999:
                           PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L999,PS00L999:
                           PS00L999,PS00L999,PS00L999,PS00L999:
                           PS00L999,PS00L999,PS00L999,PS00L999:
                           PS00L999,PS00L999
          GOTO     PS00L999
.
PS00L101
          MOVE      SICADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Screen                        
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L006:
                            SF00L006,SF00L103,SF00L006,SF00L006:
                           SF00L006,SF00L104,SF00L006,SF00L006:
                            SF00L006,SF00L006,SF00L006,SF00L006:
                           SF00L006,SF00L006,SF00L006,SF00L006:
                           SF00L105,SF00L106,SF00L006,SF00L006:
                           SF00L107,SF00L108
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L020,SF00L104,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L020,SF00L020,SF00L020,SF00L020:
                           SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          MOVE      "SIIM3",NAMSSFFI
          MOVE      "   10",ITMSSFFI
          CALL      FP00L000
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      POST0000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      UMAX0000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
          CALL      SELECTED
          BRANCH    EXIT,SF00L001
          MOVE      "SIIM3",NAMSSFFI
          MOVE      SCPSITM,ITMSSFFI
          IF        ACCEPT=0
            PACK      KEY5,SCPSROW,SCPSCOL
            CALL      TRSIIM31
            BRANCH    OVRCD,SF00L001
            MATCH     SCTMROW,SCSLROW
            GOTO      SF00L001 IF NOT EQUAL
            MATCH     SCTMCOL,SCSLCOL
            GOTO      SF00L001 IF NOT EQUAL
            CALL      SM00L000 * Change Line
          ELSE
            IF        SIIM3AFL=0
              MOVE      "SIIM3",NAMSSFFI
              MOVE     "   10",ITMSSFFI
              CALL      AD00L000 * Add Line
            ENDIF
          ENDIF
          GOTO     SF00L001
.
SF00L105
          MOVE      "SIIM3",NAMSSFFI
          MOVE      "   10",ITMSSFFI
          CALL      NP00L000
          GOTO     SF00L001
.
SF00L106
          MOVE      "SIIM3",NAMSSFFI
          MOVE      "   10",ITMSSFFI
          CALL      PP00L000
          GOTO     SF00L001
.
SF00L107
          MOVE      "SIIM3",NAMSSFFI
          MOVE      "   10",ITMSSFFI
          CALL      FP00L000
          GOTO     SF00L001
.
SF00L108
          MOVE      "SIIM3",NAMSSFFI
          MOVE      "   10",ITMSSFFI
          CALL      LP00L000
          GOTO     SF00L001
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Menu                               
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Menu                               
.-------------------------------------------------------
CF01L000
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Menu                               
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Menu                               
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Menu                               
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Menu                               
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Menu                               
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L999
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Menu                               
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L103
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L020
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          CALL      SC00L000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF01L999
.
SF01L103
          MOVE      ZERO,EXIT
          GOTO      SF01L999
SF01L990  MOVE      ONE,EXIT * Exit Char Restart
SF01L999  RETURN
.--------------------------------
. Screen - Import Barcode Download            
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Import Barcode Download            
.-------------------------------------------------------
CF02L000
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Import Barcode Download            
.--------------------------------------------------------
KY02L000
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Import Barcode Download            
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Import Barcode Download            
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Import Barcode Download            
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Import Barcode Download            
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L999,PS02L999,PS02L999
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Import Barcode Download            
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L101,SF02L102
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L102
          CALL      IMPT0000
          MOVE      ZERO,EXIT
          GOTO      SF02L999
SF02L990  MOVE      FOUR,EXIT * Exit Char Exit
SF02L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------------------------------
. Set up Screen Defaults
.----------------------------------------------------------------
GETDET00  MOVE     SIIMCAT,KEY7
          CALL     RDSIIA1
          RETURN
.
.
.----------------------------------------------------------------
. Save Batch Screen
.----------------------------------------------------------------
POST0000  MOVE      SP70,KEY5
          CALL      TRSIIM31
          COMPARE   ZERO,OVRCD
          GOTO      POST1100 IF EQUAL
POST1000  CALL      TKSIIM31
          BRANCH    OVRCD,POST9999
POST1100  PACK      KEY12,SIIMCST,SIIMCAT ,SP70
          MOVE      SIIMQOH,F12P2         * Save Results Make Sure only Update
          CALL      RDSIIM1               * is to Quantity On Hand
          IF        OVRCD=0
            MOVE      F12P2,SIIMQOH       * Move to Qty On Hand
            CALL      UPSIIM1
          ENDIF
          GOTO      POST1000
POST9999  RETURN
.
.
.-------------------------------------------------------------
. File : /users/bga/std/auditkey
.
. Audit & Locking Standard Routine to Enter Key Field
.
. where   xx = Key Length
.         ss = System 2 Character Code
.         ff = File 2 Character Code
.       yyyy = Key Field IDs
.-------------------------------------------------------------
KCOST000  MOVE      ZERO,CKEYTYP
          CALL      KSICAA00                * Call Standard Keyin Routine with ?
          BRANCH    EXIT,KCOST999,KCOST999  * Exit 1 Null Entry 2 Exitchar
          COMPARE   ONE,OVRCD               * New Record so no Lock
          GOTO      KCOST999 IF EQUAL       * Return
.
KCOST100  PACK      KEY5,SICACODE,SP70      * Setup Key to File
          CALL      RLSICA1                 * Read and Lock Record
          BRANCH    OVRCD,KCOST999,KCOST200 * OVRCD=1 Not on File 2 Locked
          MOVE      ZERO,EXIT               * Setup Exit Field
          MOVE      ZERO,OVRCD              * Setup Ovrcd Field
          GOTO      KCOST999
.
KCOST200  MOVE      SP70,DISPMSG            * Clear Line 24 Message Display
          CALL      MESSAGE2                * Clear Line 24 and Save
          KEYIN     *P1:24,*EL,"Record Locked - (":
                    *V2LON,"R",*HOFF,")etry or e(":
                    *V2LON,"X",*HOFF,")it ? ",ANS
          CALL      MESSAGE3                * Restore Line 24
          REP       UPPLOW,ANS              * Convert to Upper Case
          MATCH     ANSR,ANS                * Re-try
          GOTO      KCOST100 IF EQUAL       * Return to locking
          MATCH     ANSX,ANS                * Exit
          GOTO      KCOST000 IF EQUAL       * Must be a valid response
          MATCH     ANSE,ANS                * Exit
          GOTO      KCOST200 IF NOT EQUAL   * Must be a valid response
          GOTO      KCOST000                * Return to Keyin
.
KCOST999  RETURN                            * End of Routine
.
.------------------------------------------------------------
. Update SOH to Max for Cost Centre
.------------------------------------------------------------
UMAX0000  BEEP
          KEYIN      *P1:24,*EL,"Update All Catalog Stock on Hand to ":
                    "Maximum Level (",*V2LON,"Y",*HOFF,"/":
                      *V2LON,"N",*HOFF,") ? ",*V2LON,ANS
          REP       UPPLOW,ANS
          MATCH     "N",ANS
          GOTO      UMAX9999 IF EQUAL
          MATCH     "Y",ANS
          GOTO      UMAX0000 IF NOT EQUAL
.
          PACK      KEY16,SICACODE,SP70
          CALL      RDSIIM3
          IF        OVRCD=0
            CALL      RPSIIM3
          ENDIF
UMAX1000  CALL      RKSIIM3
          BRANCH    OVRCD,UMAX9000
          MATCH     SIIMCST,SICACODE
          GOTO      UMAX9000 IF NOT EQUAL
          MOVE      SIIMMAX,SIIMQOH
          CALL      UPSIIM3
          GOTO      UMAX1000
.
UMAX9000  MOVE      "Update Complete - ",DISPMSG
          CALL      MESSAGE1
.
UMAX9999  RETURN
.
.----------------------------------------------------------------
. Post All Imprest Data
.----------------------------------------------------------------
IMPT0000  CALL      COPY0000        * Get Download File
          BRANCH    EXIT,IMPT9999
          CALL      VERI0000        * Verify Contents of File
          BRANCH    EXIT,IMPT9999
.
          PACK      DEFTCST,SP70    * new requisition for each C/C ?
          OPEN      IMPORTFL,IMPORTFN
          MOVE      ZERO,SECTOR
          MOVE      ZERO,CPAGENO
          MOVE      "99",CLNO
          CLOCK     TIME,CTIMEIS
.
          DISPLAY   *P1:24,*EL,"Posting Imprest - Current Catalogue : "
.
IMPT1000  READ      IMPORTFL,SEQ;SIIMCST,SIIMCAT,QTYREQ,QTYEXT
          GOTO      IMPT9000 IF OVER
          DISPLAY   *P39:24,*V2LON,SIIMCAT
.
. ------- Read Imprest Details
          PACK      KEY12,SIIMCST,SIIMCAT
          CALL      RDSIIM1
          IF        OVRCD=0
            ASSIGN    SIIMMAX-QTYREQ,SIIMQOH
            CALL      UPSIIM1
          ENDIF
          GOTO      IMPT1000
.
IMPT9000  CLOSE     IMPORTFL,DELETE
IMPT9999  RETURN
.------------------------------------------------------------
. Copy File from DOS to UNIX using script ibasin64.us1
.------------------------------------------------------------
COPY0000  DISPLAY   *P20:15,*EL,"Copying download file from PC ";
          CLEAR     IMPORTFN
          APPEND    "downld",IMPORTFN
          APPEND    PORT,IMPORTFN
          RESET     IMPORTFN
          REP       " 0",IMPORTFN
          REP       LOWUP,IMPORTFN
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IMPORTFL,IMPORTFN
          TRAPCLR   IO
          IF        OVRCD=0
            CLEAR     DISPMSG
            APPEND    "ERROR - ",DISPMSG
            APPEND    IMPORTFN,DISPMSG
            APPEND    " File Exists - ",DISPMSG
            RESET     DISPMSG
            BEEP
            MOVE      NO,DEFYESNO
            CALL      MESSAGE4
            IF        EXIT=1
              CHAIN     PGM
            ENDIF
            CLOSE     IMPORTFL,DELETE
          ENDIF
.
          MOVE      "0",HLEF
          CALL      GETSCR00
          DISPLAY   *P1:24,*EL
          CLEAR     KEY80
          APPEND    "ibasin41.us1 ",KEY80
          APPEND    IMPORTFN,KEY80
          APPEND    ".txt",KEY80
          RESET     KEY80
          EXECUTE   KEY80,TASKID
          CALL      PUTSCR00
.
          MOVE      ZERO,EXIT
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IMPORTFL,IMPORTFN
          TRAPCLR   IO
          IF        OVRCD=1
            CLEAR     DISPMSG
            APPEND    "ERROR - ",DISPMSG
            APPEND    IMPORTFN,DISPMSG
            APPEND    " File Does Not Exist - ",DISPMSG
            RESET     DISPMSG
            BEEP
            MOVE      NO,DEFYESNO
            CALL      MESSAGE1
            MOVE      ONE,EXIT
          ENDIF
          RETURN
.----------------------------------------------------------------------
. VERI0000 - Verify & Load Contents of File
.----------------------------------------------------------------------
VERI0000  MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     IMPORTFL,IMPORTFN
          TRAPCLR  IO
          BRANCH   OVRCD,VERI9100
          MOVE     ZERO,SECTOR
          MOVE     ZERO,CPAGENO
          MOVE     "99",CLNO
          CLOCK    TIME,CTIMEIS
.
VERI1000  ADD      ONE,SECTOR
          MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF FORMAT
          READ     IMPORTFL,SEQ;SICACODE,SIIACAT,QTYREQ,QTYEXT
          GOTO     VERI9900 IF OVER
          TRAPCLR  FORMAT
          BRANCH   OVRCD,VERI9200
.
          COMPARE  ZERO,QTYEXT
          GOTO     VERI1100 IF NOT EQUAL
          COMPARE  ZERO,QTYREQ          * Don't Load if Zero Quantity
          GOTO     VERI1000 IF EQUAL    * Get Next Item
.
VERI1100  MOVE     SICACODE,KEY5
          CALL     RDSICA1              * Cost Centre Details
          BRANCH   OVRCD,VERI9300
.
          MOVE     SIIACAT,KEY7
          CALL     RDSIIA1              * Catalog Details
          BRANCH   OVRCD,VERI9400
.
          COMPARE  ONE,SIIANON          * Stock 1=Yes
          GOTO     VERI3000 IF EQUAL
.
          GOTO     VERI1000
.
. Non - Stock Item
.
VERI3000  COMPARE  "55",CLNO
          CALL     VHEAD000 IF NOT LESS
          ADD      ONE,CLNO
          ADD      QTYEXT,QTYREQ
          PRINT    SICACODE,SP1,SICADESC,SP1,SIIACAT,SP1,SIIADES:
                   "NON-STOCK",*126,QTYREQ
          GOTO     VERI1000
.
VERI9100  MOVE     "ERROR : Can't Open Import File - ",DISPMSG
          BEEP
          CALL     MESSAGE1
          MOVE     ONE,EXIT
          GOTO     VERI9999
.
VERI9200  CLEAR    DISPMSG
          APPEND   "ERROR : Format Error at Line",DISPMSG
          APPEND   SECTOR,DISPMSG
          APPEND   " - ",DISPMSG
          RESET    DISPMSG
          BEEP
          CALL     MESSAGE1
          MOVE     ONE,EXIT
          GOTO     VERI9999
.
VERI9300  CLEAR    DISPMSG
          APPEND   SECTOR,DISPMSG
          APPEND   " ERROR : Cost Centre Invalid ",DISPMSG
          APPEND   KEY5,DISPMSG
          APPEND   " - ",DISPMSG
          RESET    DISPMSG
          BEEP
          CALL     MESSAGE1
          MOVE     ONE,EXIT
          GOTO     VERI9999
.
VERI9400  CLEAR    DISPMSG
          APPEND   SECTOR,DISPMSG
          APPEND   " ERROR : Catalog Code Invalid ",DISPMSG
          APPEND   KEY7,DISPMSG
          APPEND   " - ",DISPMSG
          RESET    DISPMSG
          BEEP
          CALL     MESSAGE1
          MOVE     ONE,EXIT
          GOTO     VERI9999
.
VERI9500  CLEAR    DISPMSG
          APPEND   SECTOR,DISPMSG
          APPEND   " ERROR : Catalog Warehouse Invalid ",DISPMSG
          APPEND   KEY7,DISPMSG
          APPEND   " - ",DISPMSG
          RESET    DISPMSG
          BEEP
          CALL     MESSAGE1
          MOVE     ONE,EXIT
          GOTO     VERI9999
.
VERI9900  MOVE     ZERO,EXIT
.
          COMPARE  ZERO,CPAGENO
          GOTO     VERI9999 IF EQUAL
          CALL     UND132
          PRINT    *50,"*** End of Exceptions Report ***"
.
VERI9999  RETURN
.----------------------------------------------------------------------
. Exceptions Report Heading
.----------------------------------------------------------------------
VHEAD000  CALL     HEAD132
          PRINT    *40,"******** IMPREST VERIFY ERROR REPORT **********"
          CALL     UND132
          PRINT    "Cost Centre                                    ":
                   "Catalog                                        ":
                   "                              Quantity"
          CALL     UND132
          RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       SINCCAIO/INC
          INC       SINCCAKY    
          INC       SINCIAIO/INC
          INC       SINCIEIO/INC
          INC       SINIMPIO/INC
          INC       SINIMPKY    
          INC       SINNATIO/INC
          INC       SINSUAIO/INC
          INC       SINWARIO/INC
.
          INC       STDGENCD
.

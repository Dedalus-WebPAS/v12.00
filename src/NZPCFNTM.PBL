. *----------------------------------------------------------------------
. * Include Name  :   NZPCFNTM.PBL
. *
. * Function      :   Common CGI functions for NZ Private Contract Funding File
. *
. * Modifications :
. *
.------------------------------------------------------------------------
. * V11.04.01 26/06/2024  Thanh T       TSK 0947684
. *           Changed NZCFTB00 and NZDFTB00 to display the number of rows
. *           depending on system parameter
.------------------------------------------------------------------------
. * V10.03.01 01/02/2012 J.Tan         CAR 257597
. *           Fixed updating doctor specific field (NZCFDOCS)
. * V9.09.00  12/06/2007 Ebon Clements CAR 141984
. *           Fixed NEXTNC00 and PREVNC00 cgi for start date
. * V9.08.02  14/02/2007 Ebon Clements CAR 119999
. *           Added Hosp, claim code and contract to contract funding list
. * V9.08.01  11/01/2007 Ebon Clements  CAR 129231
. *           Fixed clear of NZCFSPRI
. * V9.08.00  17/11/2006 Davin          CAR 119999
. *           Created Include
. *----------------------------------------------------------------------
.------------------------------------------------------------------------
.   Clear CGI Parameters for NZPCFNFD
.------------------------------------------------------------------------
CPNZCF00  MOVE      SP70,NZCFN001
          MOVE      SP70,NZCFN002
          MOVE      SP70,NZCFN003
          MOVE      SP70,NZCFN004
          MOVE      SP70,NZCFN005
          MOVE      SP70,NZCFN006
          MOVE      SP70,NZCFN007
          MOVE      SP70,NZCFN008
          MOVE      SP70,NZCFN009
          MOVE      SP70,NZCFN010
          MOVE      SP70,NZCFN011
          MOVE      SP70,NZCFN012
          MOVE      SP70,NZCFN013
          MOVE      SP70,NZCFN014
          MOVE      SP70,NZCFN015
          MOVE      SP70,NZCFN016
          MOVE      SP70,NZCFN017
          MOVE      SP70,NZCFN018
          MOVE      SP70,NZCFN019
          MOVE      SP70,NZCFN020
.
          MOVE      SP70,CPCFN001
          MOVE      SP70,CPCFN002
          MOVE      SP70,CPCFN003
          MOVE      SP70,CPCFN004
          MOVE      SP70,CPCFN005
          MOVE      SP70,CPCFN006
.
          MOVE      SP70,MLCFN001
.
CPNZCF99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for NZPCFNFD
.------------------------------------------------------------
SPNZCF00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPNZCF01,SPNZCF02,SPNZCF03,SPNZCF04,SPNZCF05:
                       SPNZCF06,SPNZCF07,SPNZCF08,SPNZCF09,SPNZCF10:
                       SPNZCF11,SPNZCF12,SPNZCF13,SPNZCF14,SPNZCF15:
                       SPNZCF16,SPNZCF17,SPNZCF18,SPNZCF19,SPNZCF20
.
          MOVE      ONE,EXIT
          GOTO      SPNZCF99
.
SPNZCF01  PACK      NZCFN001,QRYDATA,SP70
          GOTO      SPNZCF99
.
SPNZCF02  PACK      NZCFN002,QRYDATA,SP70
          GOTO      SPNZCF99
.
SPNZCF03  PACK      NZCFN003,QRYDATA,SP70
          GOTO      SPNZCF99
.
SPNZCF04  PACK      NZCFN004,QRYDATA,SP70
          GOTO      SPNZCF99
.
SPNZCF05  PACK      NZCFN005,QRYDATA,SP70
          GOTO      SPNZCF99
.
SPNZCF06  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      NZCFN006,CCENT,CYEAR,CMON,CDAY
          GOTO      SPNZCF99
.
SPNZCF07  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      NZCFN007,CCENT,CYEAR,CMON,CDAY
          GOTO      SPNZCF99
.
SPNZCF08  MOVE      QRYDATA,NZCFN008
          GOTO      SPNZCF99
.
SPNZCF09  MOVE      QRYDATA,NZCFN009
          GOTO      SPNZCF99
.
SPNZCF10  MOVE      QRYDATA,NZCFN010
          GOTO      SPNZCF99
.
SPNZCF11  MOVE      QRYDATA,NZCFN011
          GOTO      SPNZCF99
.
SPNZCF12  MOVE      QRYDATA,NZCFN012
          GOTO      SPNZCF99
.
SPNZCF13  MOVE      QRYDATA,NZCFN013
          GOTO      SPNZCF99
.
SPNZCF14  MOVE      QRYDATA,NZCFN014
          GOTO      SPNZCF99
.
SPNZCF15  MOVE      QRYDATA,NZCFN015
          GOTO      SPNZCF99
.
SPNZCF16  MOVE      QRYDATA,NZCFN016
          GOTO      SPNZCF99
.
SPNZCF17  MOVE      QRYDATA,NZCFN017
          GOTO      SPNZCF99
.
SPNZCF18  MOVE      QRYDATA,NZCFN018
          GOTO      SPNZCF99
.
SPNZCF19  MOVE      QRYDATA,NZCFN019
          GOTO      SPNZCF99
.
SPNZCF20  MOVE      QRYDATA,NZCFN020
          GOTO      SPNZCF99
.
SPNZCF99  RETURN
.
.------------------------------------------------------------
.   Set Parameters for NZPCFNFD copy 
.------------------------------------------------------------
CCNZCF00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,CCNZCF01,CCNZCF02,CCNZCF03,CCNZCF04,CCNZCF05:
                       CCNZCF06
.
          MOVE      ONE,EXIT
          GOTO      CCNZCF99
.
CCNZCF01  PACK      CPCFN001,QRYDATA,SP70
          GOTO      CCNZCF99
.
CCNZCF02  PACK      CPCFN002,QRYDATA,SP70
          GOTO      CCNZCF99
.
CCNZCF03  PACK      CPCFN003,QRYDATA,SP70
          GOTO      CCNZCF99
.
CCNZCF04  PACK      CPCFN004,QRYDATA,SP70
          GOTO      CCNZCF99
.
CCNZCF05  PACK      CPCFN005,QRYDATA,SP70
          GOTO      CCNZCF99
.
CCNZCF06  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      CPCFN006,CCENT,CYEAR,CMON,CDAY
          GOTO      CCNZCF99
.
CCNZCF999  RETURN
+
.--------------------------------------------------------------------------
. NZ Private Contract Funding Maintenance Output
.--------------------------------------------------------------------------
NZCF0000  BRANCH    FLDITMNO,NZCF0100,NZCF0200,NZCF0300,NZCF0400,NZCF0500:
                             NZCF0600,NZCF0700,NZCF0800,NZCF0900,NZCF1000:
                             NZCF1100,NZCF1200,NZCF1300,NZCF1400,NZCF1500:
                             NZCF1600,NZCF1700,NZCF1800,NZCF1900,NZCF2000:
                             NZCF2100,NZCF2200,NZCF2300,NZCF2400,NZCF2500:
                             NZCF2600,NZCF2700,NZCF2800,NZCF2900,NZCF3000:
                             NZCF3100,NZCF3200,NZCF3300,NZCF3400,NZCF3500:
                             NZCF3600,NZCF3700
          GOTO      NZCF9999
.         
NZCF0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          COMPARE   ONE,IBCNMHOS
          GOTO      NZCF9999 IF NOT EQUAL
.         
          BRANCH    F1,NZCF0110,NZCF0120
.
          PACK      KEY3,NZCFHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,NZCF9999 
.
          WRITE     HTMLFILE;PTHSNAME;           * hospital name
          GOTO      NZCF9999 
.
NZCF0110  WRITE     HTMLFILE;NZCFHOSP;           * hospital code
          GOTO      NZCF9999
.
NZCF0120  MOVE      NZCFHOSP,DIM3
          CALL      NZMH0000                     * hospital selectin list
          GOTO      NZCF9999
.
NZCF0200  MOVE      "CL",CATEGORY                * Claim Code
          MOVE      NZCFCLMC,CODE
          CALL      CODITM00
          GOTO      NZCF9999
.
NZCF0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZCF0310
.
          WRITE     HTMLFILE;NZCFCNTR;           * Health Fund
          GOTO      NZCF9999
.
NZCF0310  MATCH     SP70,NZCFCNTR
          GOTO      NZCF9999 IF EQUAL
.
          PACK      KEY14,NZCFCNTR,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,NZCF9999
          WRITE     HTMLFILE;HFNAME;             * Health Fund Name
          GOTO      NZCF9999
.
NZCF0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZCF0410
          WRITE     HTMLFILE;NZCFCPRC;           * Contract Procedure Code
          GOTO      NZCF9999
.
NZCF0410  MATCH     SP70,NZCFCPRC
          GOTO      NZCF9999 IF EQUAL
.
          PACK      KEY9,NZCFCPRC,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,NZCF9999
          WRITE     HTMLFILE;PTCADES1;           * Contract Procedure Code Desc
          GOTO      NZCF9999
.
NZCF0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZCF0510
          WRITE     HTMLFILE;NZCFSTYP;           * Start Type
          GOTO      NZCF9999

NZCF0510  MOVE      ZERO,F1
          MOVE      NZCFSTYP,F1
          BRANCH    F1,NZCF0520,NZCF0530
          WRITE     HTMLFILE;"Not Set!";
.
NZCF0520  WRITE     HTMLFILE;"Admission From";
          GOTO      NZCF9999
NZCF0530  WRITE     HTMLFILE;"Discharge From";
          GOTO      NZCF9999
.
NZCF0600  MATCH     SP70,NZCFSDAT;               * Start Date
          GOTO      NZCF9999 IF EQUAL
.
          UNPACK    NZCFSDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZCF9999
.
NZCF0700  MATCH     SP70,NZCFEDAT;               * End Date
          GOTO      NZCF9999 IF EQUAL
.
          UNPACK    NZCFEDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZCF9999
.
NZCF0800  WRITE     HTMLFILE;NZCFBDET;
          GOTO      NZCF9999
.
NZCF0900  WRITE     HTMLFILE;NZCFHNAM;
          GOTO      NZCF9999
.
NZCF1000  WRITE     HTMLFILE;NZCFHAD1;
          GOTO      NZCF9999
.
NZCF1100  WRITE     HTMLFILE;NZCFHAD2;
          GOTO      NZCF9999
.
NZCF1200  WRITE     HTMLFILE;NZCFHAD3;
          GOTO      NZCF9999
.
NZCF1300  WRITE     HTMLFILE;NZCFHAD4;
          GOTO      NZCF9999
.
NZCF1400  WRITE     HTMLFILE;NZCFSPRI;
          GOTO      NZCF9999
.
NZCF1500  WRITE     HTMLFILE;NZCFDPRI;
          GOTO      NZCF9999
.
NZCF1600  WRITE     HTMLFILE;NZCFRPRO;
          GOTO      NZCF9999
.
NZCF1700  WRITE     HTMLFILE;NZCFREFN;
          GOTO      NZCF9999
.
NZCF1800  WRITE     HTMLFILE;NZCFVNID;
          GOTO      NZCF9999
.
NZCF1900  WRITE     HTMLFILE;NZCFELOS;
          GOTO      NZCF9999
.
NZCF2000  WRITE     HTMLFILE;NZCFDOCS;
          GOTO      NZCF9999
.
NZCF2100  MATCH     NZCFCDAT,SP70
          GOTO      NZCF9999 IF EQUAL
.
          UNPACK    NZCFCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZCF9999
.
NZCF2200  WRITE     HTMLFILE;NZCFCTIM;
          GOTO      NZCF9999
.
NZCF2300  MATCH     SP70,NZCFCUID
          GOTO      NZPF9999 IF EQUAL
.
          PACK      KEY10,NZCFCUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      NZCFCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      NZCF9999
.
NZCF2400  MATCH     NZCFUDAT,SP70
          GOTO      NZCF9999 IF EQUAL
.
          UNPACK    NZCFUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZCF9999
.
NZCF2500  WRITE     HTMLFILE;NZCFUTIM;
          GOTO      NZCF9999
.
NZCF2600  MATCH     SP70,NZCFUUID
          GOTO      NZPF9999 IF EQUAL
.
          PACK      KEY10,NZCFUUID
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      NZCFUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      NZCF9999
.
NZCF2700  CALL      NZCFTB00                * Contract Funding Table
          GOTO      NZCF9999
.
NZCF2800  CALL      NEXTNC00
          GOTO      NZCF9999
.
NZCF2900  CALL      PREVNC00
          GOTO      NZCF9999
.
NZCF3000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          COMPARE   ONE,IBCNMHOS
          GOTO      NZCF9999 IF NOT EQUAL
.
          BRANCH    F1,NZCF3010,NZCF3020
.
          PACK      KEY3,NZCFN001,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,NZCF9999
.
          WRITE     HTMLFILE;PTHSNAME;           * hospital name
          GOTO      NZCF9999
.
NZCF3010  WRITE     HTMLFILE;NZCFN001;           * hospital code
          GOTO      NZCF9999
.
NZCF3020  MOVE      NZCFN001,DIM3
          CALL      NZMH0000                     * hospital selectin list
          GOTO      NZCF9999
.
NZCF3100  MOVE      "CL",CATEGORY                * Claim Code
          MOVE      NZCFN002,CODE
          CALL      CODITM00
          GOTO      NZCF9999
.
NZCF3200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZCF3210
.
          WRITE     HTMLFILE;NZCFN003;           * Health Fund
          GOTO      NZCF9999
.
NZCF3210  MATCH     SP70,NZCFN003
          GOTO      NZCF9999 IF EQUAL
.
          PACK      KEY14,NZCFN003,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,NZCF9999
          WRITE     HTMLFILE;HFNAME;             * Health Fund Name
          GOTO      NZCF9999
.
NZCF3300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZCF3310
          WRITE     HTMLFILE;NZCFN004;           * Contract Procedure Code
          GOTO      NZCF9999
.
NZCF3310  MATCH     SP70,NZCFN004
          GOTO      NZCF9999 IF EQUAL
.
          PACK      KEY9,NZCFN004,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,NZCF9999
          WRITE     HTMLFILE;PTCADES1;           * Contract Procedure Code Desc
          GOTO      NZCF9999
.
NZCF3400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,NZCF3410
          WRITE     HTMLFILE;NZCFN005;           * Start Type
          GOTO      NZCF9999

NZCF3410  MOVE      ZERO,F1
          MOVE      NZCFN005,F1
          BRANCH    F1,NZCF3420,NZCF3430
          WRITE     HTMLFILE;"Not Set!";
.
NZCF3420  WRITE     HTMLFILE;"Admission From";
          GOTO      NZCF9999
NZCF3430  WRITE     HTMLFILE;"Discharge From";
          GOTO      NZCF9999
.
NZCF3500  MATCH     SP70,NZCFN006;               * Start Date
          GOTO      NZCF9999 IF EQUAL
.
          UNPACK    NZCFSDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      NZCF9999
.
NZCF3600  WRITE     HTMLFILE;FILEFLAG;
          GOTO      NZCF9999
.
NZCF3700  CALL      NZDFTB00
          GOTO      NZCF9999
.
NZCF9999  RETURN
.
.------------------------------------------------------------
.  Update NZPCFNFD file
.------------------------------------------------------------
MVNZCF00  MOVE      NZCFN001,NZCFHOSP
          MOVE      NZCFN002,NZCFCLMC
          MOVE      NZCFN003,NZCFCNTR
          MOVE      NZCFN004,NZCFCPRC
          MOVE      NZCFN005,NZCFSTYP
          MOVE      NZCFN006,NZCFSDAT
          MOVE      NZCFN007,NZCFEDAT
          MOVE      NZCFN008,NZCFBDET
          MOVE      NZCFN009,NZCFHNAM
          MOVE      NZCFN010,NZCFHAD1
          MOVE      NZCFN011,NZCFHAD2
          MOVE      NZCFN012,NZCFHAD3
          MOVE      NZCFN013,NZCFHAD4
          SQUEEZE   NZCFN014
          MOVE      NZCFN014,NZCFSPRI
          SQUEEZE   NZCFN015
          MOVE      NZCFN015,NZCFDPRI
          MOVE      NZCFN016,NZCFRPRO
          MOVE      NZCFN017,NZCFREFN
          MOVE      NZCFN018,NZCFVNID
          SQUEEZE   NZCFN019
          MOVE      NZCFN019,NZCFELOS
          MATCH     SP70,NZCFN020
          IF        !@EQUAL
            MOVE      NZCFN020,NZCFDOCS
          ENDIF
.
MVNZCF99  RETURN
.
.------------------------------------------------------------
.  Clear NZPCFNFD file
.------------------------------------------------------------
CLNZCF00  MOVE      SP70,NZCFHOSP
          MOVE      SP70,NZCFCLMC
          MOVE      SP70,NZCFCNTR
          MOVE      SP70,NZCFCPRC
          MOVE      SP70,NZCFSTYP
          MOVE      SP70,NZCFSDAT
          MOVE      SP70,NZCFEDAT
          MOVE      SP70,NZCFBDET
          MOVE      SP70,NZCFHNAM
          MOVE      SP70,NZCFHAD1
          MOVE      SP70,NZCFHAD2
          MOVE      SP70,NZCFHAD3
          MOVE      SP70,NZCFHAD4
          MOVE      ZERO,NZCFSPRI
          MOVE      ZERO,NZCFDPRI
          MOVE      ZERO,NZCFRPRO
          MOVE      SP70,NZCFREFN
          MOVE      SP70,NZCFVNID
          MOVE      ZERO,NZCFELOS
          MOVE      SP70,NZCFDOCS
.
          RETURN
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
NZCH0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
NZCH0100  CALL      RKPTHSP1
          BRANCH    OVRCD,NZCH9999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     DIM3,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      NZCH0100
.
NZCH9999  RETURN
.------------------------------------------------------------
. Table of NZ Contract Funding Details
.------------------------------------------------------------
NZCFTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      NZPCHD00              * Print heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD   * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,NZCFN002
          GOTO      NZCFTB90 IF EQUAL
.
          MATCH     "N",FILEFLAG
          GOTO      NZCFTB10 IF EQUAL
.
          PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,SP70
          CALL      RSNZCFN1
NZCFTB05  CALL      RKNZCFN1
          BRANCH    OVRCD,NZCFTB90
          GOTO      NZCFTB20
.
NZCFTB10  PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,SP70  * New File
          CALL      RSNZCF11
NZCFTB15  CALL      RKNZCF11
          BRANCH    OVRCD,NZCFTB90
.
NZCFTB20  
          MATCH     SP70,NZCFN001
          IF        !@EQUAL
            MATCH     NZCFN001,NZCFHOSP
            GOTO      NZCFTB90 IF NOT EQUAL
          ENDIF
.
          MATCH     NZCFN002,NZCFCLMC
          GOTO      NZCFTB90 IF NOT EQUAL
.
          MATCH     SP70,NZCFN003
          IF        !@EQUAL
            MATCH     NZCFN003,NZCFCNTR
            GOTO      NZCFTB90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,NZCFN004
          IF        !@EQUAL
            MATCH     NZCFN004,NZCFCPRC
            GOTO      NZCFTB90 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            MATCH     "N",FILEFLAG
            GOTO      NZCFTB15 IF EQUAL
            GOTO      NZCFTB05
          ENDIF
.
          CALL      NZCFRW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            MATCH     "N",FILEFLAG
            GOTO      NZCFTB15 IF EQUAL
            GOTO      NZCFTB05
          ENDIF
.
          GOTO      NZCFTB99
.
NZCFTB90  CALL      NOMORE00     * Display No More Records Message
.
NZCFTB99  RETURN
.------------------------------------------------------------
. NZ Contract Funding Table (TABLE ROW)
.------------------------------------------------------------
NZCFRW00  PACK      KEY9,NZCFCPRC,SP70
          CALL      RDPTCMC1
          IF        OVRCD=1
            MOVE      "&nbsp;",PTCADES1  * Casemix Code Description
          ENDIF
.
          MOVE      SP70,PTHSNAME
          MATCH     SP70,NZCFHOSP
          IF        !@EQUAL
            PACK      KEY3,NZCFHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD=1
              MOVE      NZCFHOSP,PTHSNAME        * hospital
            ENDIF
          ENDIF
.
          MOVE     SP70,CLAMDESC
          MATCH    SP70,NZCFCLMC
          IF       !@EQUAL
            PACK     KEY5,ANSC,ANSL,NZCFCLMC,SP70
            CALL     RDCODE1
            IF       OVRCD=1
              MOVE     NZCFCLMC,TDESC            * claim code
            ENDIF
            MOVE    TDESC,CLAMDESC
          ENDIF
.
.         MOVE      "&nbsp;",STARTTYP    * Start Type
.         MOVE      ZERO,F1
.         MOVE      NZCFSTYP,F1
.         LOAD      STARTTYP,F1,ADMISFRM,DISCHFRM
.
          UNPACK    NZCFSDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      SP70,DIM12
          MATCH     SP70,NZCFEDAT
          IF        !@EQUAL
            UNPACK    NZCFEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          REP       " +",NZCFHOSP
          REP       " +",NZCFCLMC
          REP       " +",NZCFCNTR
          REP       " +",NZCFCPRC
          REP       " +",NZCFSTYP
.
          MOVE      SP70,KEY11
          MATCH     SP70,NZCFSDAT
          IF        !@EQUAL
            UNPACK    NZCFSDAT,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&nzcfn001=",NZCFHOSP:
                             "&nzcfn002=",NZCFCLMC:
                             "&nzcfn003=",NZCFCNTR:
                             "&nzcfn004=",NZCFCPRC:
                             "&nzcfn005=",NZCFSTYP:
                             "&nzcfn006=",KEY11:
                             "&fileflag=",FILEFLAG,"#")'>";
.
          REP       "+ ",NZCFHOSP
          REP       "+ ",NZCFCLMC
          REP       "+ ",NZCFCNTR
          REP       "+ ",NZCFCPRC
          REP       "+ ",NZCFSTYP
          REP       "+ ",NZCFSDAT
.
          WRITE     HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>";
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;PTHSNAME,"&nbsp;</td>":
                               "<td>",CLAMDESC,"&nbsp;</td>":
                               "<td>",NZCFCNTR,"&nbsp;</td>":
                               "<td>",NZCFCPRC,"&nbsp;</td>":
                               "<td>",PTCADES1,"&nbsp;</td>":
.......                      "<td>",STARTTYP,"&nbsp;</td>":
                               "<td>",KEY12,"&nbsp;</td>":
                               "<td>",DIM12,"&nbsp;</td>":
                               "<td>",NZCFELOS,"&nbsp;</td>":
                               "</tr>"

          ELSE
            WRITE     HTMLFILE;CLAMDESC,"&nbsp;</td>":
                               "<td>",NZCFCNTR,"&nbsp;</td>":
                               "<td>",NZCFCPRC,"&nbsp;</td>":
                               "<td>",PTCADES1,"&nbsp;</td>":
.......                        "<td>",STARTTYP,"&nbsp;</td>":
                               "<td>",KEY12,"&nbsp;</td>":
                               "<td>",DIM12,"&nbsp;</td>":
                               "<td>",NZCFELOS,"&nbsp;</td>":
                               "</tr>"
          ENDIF
.
NZCFRW99  RETURN
.
.------------------------------------------------------------
. NZ Private Contract Funding Details Table (TABLE HEADING)
.------------------------------------------------------------
NZPCHD00  WRITE     HTMLFILE;"<tr>";
.
          PACK      KEY5,ANSC,ANSL,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      SP70,TDESC
          ENDIF
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell>Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>",TDESC,"</td>":
                           "<td class=HeadingCell>Contract</td>":
                           "<td class=HeadingCell>Contract Procedure Code</td>":
                           "<td class=HeadingCell>Description</td>":
                           "<td class=HeadingCell>Admission Start Date</td>":
                           "<td class=HeadingCell>Admission End Date</td>":
                           "<td class=HeadingCell>Exp Length of Stay</td>":
                           "</tr>"
.
NZPCHD99  RETURN
.-------------------------------------------------------------------------
. Link to Next Contract Funding
.-------------------------------------------------------------------------
NEXTNC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          REP       " +",NZCFN001
          REP       " +",NZCFN002
          REP       " +",NZCFN003
          REP       " +",NZCFN004
          REP       " +",NZCFN005
.
          UNPACK    NZCFN006,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          REP       " +",KEY11
.
          MOVE      REPORTNO,F2
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nzcfn001=",NZCFN001:
                                 "&nzcfn002=",NZCFN002:
                                 "&nzcfn003=",NZCFN003:
                                 "&nzcfn004=",NZCFN004:
                                 "&nzcfn005=",NZCFN005:
                                 "&nzcfn006=",KEY11:
                                 "&fileflag=",FILEFLAG;
.
          REP       "+ ",NZCFN001
          REP       "+ ",NZCFN002
          REP       "+ ",NZCFN003
          REP       "+ ",NZCFN004
          REP       "+ ",NZCFN005
          MOVE      SP70,KEY11
.
NEXTCN99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Contract Funding
.-------------------------------------------------------------
PREVNC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          REP       " +",NZCFN001
          REP       " +",NZCFN002
          REP       " +",NZCFN003
          REP       " +",NZCFN004
          REP       " +",NZCFN005
.
          UNPACK    NZCFN006,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          REP       " +",KEY11
.
          MOVE      REPORTNO,F2
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nzcfn001=",NZCFN001:
                                 "&nzcfn002=",NZCFN002:
                                 "&nzcfn003=",NZCFN003:
                                 "&nzcfn004=",NZCFN004:
                                 "&nzcfn005=",NZCFN005:
                                 "&nzcfn006=",KEY11:
                                 "&fileflag=",FILEFLAG;
.
          REP       "+ ",NZCFN001
          REP       "+ ",NZCFN002
          REP       "+ ",NZCFN003
          REP       "+ ",NZCFN004
          REP       "+ ",NZCFN005
          MOVE      SP70,KEY11
.
PREVNC99  RETURN
.------------------------------------------------------------
. Table of NZ Contract Funding Doctor Details
.------------------------------------------------------------
NZDFTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD   * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,NZCFN002
          GOTO      NZDFTB90 IF EQUAL
.
          MATCH     "N",FILEFLAG
          GOTO      NZDFTB10 IF EQUAL
.
          PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70
          CALL      RDNZCFN1
.
          PACK      KEY40,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70
          CALL      RSMLCFN1
NZDFTB05  CALL      RKMLCFN1
          BRANCH    OVRCD,NZDFTB90
          GOTO      NZDFTB20
.
NZDFTB10  PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70
          CALL      RDNZCF11
.
          PACK      KEY40,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70  * New File
          CALL      RSMLCF11
NZDFTB15  CALL      RKMLCF11
          BRANCH    OVRCD,NZDFTB90
.
NZDFTB20  MATCH     NZCFN001,MLCFHOSP
          GOTO      NZDFTB90 IF NOT EQUAL
.
          MATCH     NZCFN002,MLCFCLMC
          GOTO      NZDFTB90 IF NOT EQUAL
.
          MATCH     NZCFN003,MLCFCNTR
          GOTO      NZDFTB90 IF NOT EQUAL
.
          MATCH     NZCFN004,MLCFPROC
          GOTO      NZDFTB90 IF NOT EQUAL
.
          MATCH     NZCFN005,MLCFSTYP
          GOTO      NZDFTB90 IF NOT EQUAL
.
          MATCH     NZCFN006,MLCFSDAT
          GOTO      NZDFTB90 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            MATCH     "N",FILEFLAG
            GOTO      NZDFTB15 IF EQUAL
            GOTO      NZDFTB05
          ENDIF
.
          CALL      NZDFRW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            MATCH     "N",FILEFLAG
            GOTO      NZDFTB15 IF EQUAL
            GOTO      NZDFTB05
          ENDIF
.
          GOTO      NZDFTB99
.
NZDFTB90  CALL      NOMORE00     * Display No More Records Message
.
NZDFTB99  RETURN
.------------------------------------------------------------
. NZ Contract Funding Table (TABLE ROW)
.------------------------------------------------------------
NZDFRW00  PACK      KEY9,NZCFCPRC,SP70
          CALL      RDPTCMC1
          IF        OVRCD=1
            MOVE      "&nbsp;",PTCADES1  * Casemix Code Description
          ENDIF
.
          MOVE      "Invalid HCP Name",DOCFNAME
          PACK      KEY10,MLCFHCPC,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,NZDFRW10
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
.
          CALL      DOCNM000
.
          REP       " +",NZCFHOSP
          REP       " +",NZCFCLMC
          REP       " +",NZCFCNTR
          REP       " +",NZCFCPRC
          REP       " +",NZCFSTYP
          REP       " +",MLCFHCPC
.
NZDFRW10  MOVE      SP70,KEY11
          MATCH     SP70,NZCFSDAT
          IF        !@EQUAL
            UNPACK    NZCFSDAT,CCENT,CYEAR,CMON,CDAY * effective date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
          REP       " +",KEY11
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&nzcfn001=",NZCFHOSP:
                             "&nzcfn002=",NZCFCLMC:
                             "&nzcfn003=",NZCFCNTR:
                             "&nzcfn004=",NZCFCPRC:
                             "&nzcfn005=",NZCFSTYP:
                             "&nzcfn006=",KEY11:
                             "&mlcfn001=",MLCFHCPC:
                             "&fileflag=",FILEFLAG,"#")'>";
.
          REP       "+ ",NZCFHOSP
          REP       "+ ",NZCFCLMC
          REP       "+ ",NZCFCNTR
          REP       "+ ",NZCFCPRC
          REP       "+ ",NZCFSTYP
          REP       "+ ",NZCFSDAT
          REP       "+ ",MLCFHCPC
.
          WRITE     HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             MLCFHCPC,"</td>":
                             "<td>",DOCFNAME,"&nbsp;</td>":
                             "</tr>"
.
NZDFRW99 RETURN


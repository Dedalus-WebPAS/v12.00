.******************************************************************************
.*  System       :  Inpatient                                                 *
.*  Program      :  IBAINP25                                                  *
.*  Function     :  Print Invoices for ANNE CAUDLE                            *
.******************************************************************************
.*  Date         :  30/03/92                                                  *
.*  Author       :  Whirlpool                                                 *
.*  Modifications :                                                           *
.*                                                                            *
.*----------------------------------------------------------------------------*
.*        V12.00.04 17/07/2025  J.Tan          TSK 0961277                    *
.*                  Recompiled for PATCATBI-Chk if Accom.included in Pat.inv. *
.*                  22/07/2025  J.Tan          TSK 0963587                    *
.*                  Recompiled for PINCATBI-Chk if pat.is disch.& invoiced    *
.*        V12.00.03 25/06/2025  J.Tan          TSK 0961589                    *
.*                  Recompiled for PATCATBI-Fixed inv.rebate with zero MV hour*
.*                  01/07/2025  J.Tan          TSK 0960457                    *
.*                  Recompiled for PATCATBI-print inv.on first date of Findate*
.*        V12.00.02 23/06/2025  J.Tan           TSK 0961623                   *
.*                  Recompiled for PATINVS - added DDRGCODE for GETDRG        *
.*        V12.00.01 22/05/2025  Nikitha        TSK 0955096                    *
.*                  Alphanueric visit number changes                          *
.*                  20/05/2025  Ebon Clements  TSK 0955096                    *
.*                  Alphanueric visit number changes                          *
.*        V11.05.01 14/02/2025 J.Tan           TSK 0946490                    *
.*                  Recompiled for PATCATBI - Changes for MV CWO Payment Model*
.*        V11.04.10 07/11/2024 Thanh T         TSK 0946085                    *
.*                  Recompiled for RCPCONFD changes                           *
.*        V11.04.09 04/10/2024  J.Tan          TSK 0951441                    *
.*                  Recompiled for PATCATBI - Charging AddOn for NoPayDay     *
.*        V11.04.08 23/09/2024  J.Tan          TSK 0949848                    *
.*                  Recompiled for ABFPTINV - DRG List used in for COVID Adjus*
.*        V11.04.07 20/09/2024 J.Tan           TSK 0950577                    *
.*                  Recompiled for PATIPERH - Fixed Hold Invoice audit issue  *
.*        V11.04.06 11/09/2024  J.Tan          TSK 0947315                    *
.*                  Recompiled for ABFPTINV - fixed Total Unqualified         *
.*        V11.04.05 01/08/2024  J.Tan          TSK 0947804                    *
.*                  Recompiled for ABFMHINV - Changes for Disc.after 1/7/2023 *
.*        V11.04.04 17/07/2024  J.Tan          TSK 0947315                    *
.*                  Recompiled for ABFPTINV (LOS ICU adjusted & Newborn)      *
.*        V11.04.03 15/03/2024  J.Tan          TSK 0910994                    *
.*                  Recompiled for CMXMATRX                                   *
.*        V11.04.02 29/01/2024  Jacob Jackson  TSK 0919335                    *
.*                  Add HF History includes                                   *
.*        V11.04.01 29/01/2024  Jacob Jackson  TSK 0919335                    *
.*                  Add new local variable and recompile for GETTFEES         *
.*        V11.03.07 17/11/2023  J.Tan          TSK 0940089                    *
.*                  Recompiled for ABFPTINV - checking for blank Disc.DRG     *
.*        V11.03.06 13/11/2023  J.Tan          TSK 0939019                    *
.*                  Recompiled for ABFPTINV - HAC ICD10 Edition 12            *
.*        V11.03.05 08/11/2023  Nikitha B      TSK 0927699c                   *
.*                  Read CAPPRVNO and PTCNHABN for Hospital Approval          *
.*                  and ABN number.                                           *
.*        V11.03.04 04/10/2023  Nikitha B     TSK 0927699                     *
.*                  Recomplied for PATINVHL, PATINVTL - Stationary variables  *
.*        V11.03.03 29/08/2023  J.Tan          TSK 0916870                    *
.*                  Recompiled for ABFPTINV - Claim code Multiple NEP value   *
.*        V11.03.02 15/06/2023  Bella Turco    TSK 0931756                    *
.*                  Recompiled for PRTINVBD                                   * 
.*        V11.03.01 15/06/2023  J.Tan          TSK 0923703                    *
.*                  Recompiled for ABF new calculations                       *
.*        V11.02.03 10/10/2022  J.Tan            TSK 0908346                  *
.*                  Mod checking Clinical Doc.for printing inv.(CHKCLDCP)     *
.*        V11.02.02 10/10/2022  Peter Vela          0925622                   *
.*                  Recompiled for PATINVS - Removed old Eclipse IHC from     *
.*                  Inpatient Invoicing                                       *
.*        V11.02.01 09/02/2022  Thanh T       TSK 0905641                     *
.*                  Recompiled as OUTMA1FD changes                            *
.*        V11.01.14 17/11/2021  J.Tan          TSK 0913621                    *
.*                  Recompiled for ABFPTINV - Mod for Multiple NEP Values     *
.*        V11.01.13 29/09/2021  J.Tan          TSK 0901515                    *
.*                  Recompiled for CMXMATRX - Added Primary Proc.to Matrix    *
.*        V11.01.12 14/09/2021  J.Tan          TSK 0906222                    *
.*                  Recompiled for ABFPTINV - Mod for Multiple NEP Values     *
.*        V11.01.11 14/09/2021  Davin           TSK 0911277                   *
.*                  Recompiled for PRTINVBD                                   *
.*        V11.01.10 10/09/2021  Davin           TSK 0911277                   *
.*                  Recompiled for PATINVTL - Changed field 20 length to 12.2 *
.*        V11.01.09 31/08/2021  J.Tan           TSK 0910799                   *
.*                  Recompiled for PRTINVBD - printing Referring ADF          *
.*        V11.01.08 25/08/2021  J.Tan           TSK 0903454                   *
.*                  Recompiled for PATCATBI-Claim code to LS/Daily (CACCFEE=4)*
.*                  24/08/2021  Davin           TSK 0897318                   *
.*                  Recompiled for PATINVTL - added field 57(Adjustment Total)*
.*        V11.01.07 03/08/2021  J.Tan           TSK 0909724                   *
.*                  Recompiled for PRTINVBD - SJOG invoice                    *
.*        V11.01.06 07/07/2021  J.Tan          TSK 0908588                    *
.*                  Recompiled for PATCATBI -Exclude Unqualified days for C/P *
.*        V11.01.05 16/06/2021  Peter Vela     TSK 0907637                    *
.*                  Recompiled for PATINVS                                    *
.*        V11.01.04 28/04/2021  Thanh T        TSK 0895165                    *
.*                  Recompiled for OPRARDFD changes                           *
.*                  01/04/2021  Peter Vela     TSK 0902857                    *
.*                  Recompiled for WEBIHCFD - Added Index 8                   *
.*                  07/04/2021  Tracey Nguyen   TSK 0901515                   *
.*                  Recompiled for PMSCMTFD - Added new fields                *
.*                  a) 1 File type for ICD procedure (PMCCIPF)                *
.*                  b) 3 new CMBS Field Type (PMCCFTS4/PMCCFT5C/PMCCFT6C)     *
.*                  c) 3 new CMBS Codes From (PMCCPC4F,PMCCSC5F,PMCCTC6F)     *
.*                  d) 3 new CMBS Codes To   (PMCCPC4T/PMCCSC5T,PMCCTC6T)     *
.*                  27/04/2021  J.Tan           TSK 0863287                   *
.*                  Mod for Patient Invoice new functionality                 *
.*        V11.01.03 23/03/2021  Peter Vela     TSK 0902857                    *
.*                  Recompiled for PATINVS - WebServices IHCW                 *
.*        V11.01.02 10/03/2021  Tracey Nguyen   TSK 0901515                   *
.*                  Recompiled for PMSCMTFD - Added Primary ICD Procedure 1-5 *
.*                  (PMCCICP1-5)                                              *
.*        V11.01.01 17/02/2021  Tracey Nguyen  TSK 0888639                    *
.*                  Recompiled for PATMMBFD changes                           *
.*                  22/02/2021  Peter Vela     TSK 0902857                    *
.*                  Recompiled for PATINVS - WebServices IHCW                 *
.******************************************************************************
.*        V11.00.13 19/01/2021  J.Tan          TSK 0883075                    *
.*                  Recompiled for PRTINVBD - mod to print ADF addr.on invoice*
.*        V11.00.12 10/11/2020  J.Tan           TSK 0899562                   *
.*                  Recompiled for CMXMATRX - setup date for reading MBS item *
.*        V11.00.11 14/10/2020  J.Tan          TSK 0894879                    *
.*                  Recompiled for PRTINVBD - Print 30 item desc.for RCH Inv. *
.*        V11.00.10 29/09/2020  J.Tan          TSK 0896829                    *
.*                  Recompiled for CMXMATRX - use National(PTPGNDRG)DRG       *
.*        V11.00.09 22/09/2020  J.Tan           TSK 0895330                   *
.*                  Recompiled for CMXMATRX - reposition read of Matrix table *
.*        V11.00.08 20/07/2020  J.Tan           TSK 0892319                   *
.*                  Recompiled for ABFPTINV - Additional NEP and Psych.Adjus. *
.*        V11.00.07 14/07/2020  J.Tan          TSK 0892902                    *
.*                  Recompiled for PATCATBI - Mod to initialise CASMXKEY      *
.*        V11.00.06 01/07/2020  J.Tan           TSK 0892765                   *
.*                  Recompiled for PATCATBI-Low outlier exc. unqualified days *
.*                  05/07/2020  J.Tan           TSK 0892746                   *
.*                  Recompiled for ABFPTINV - CALCAGE as at Admission date    *
.*        V11.00.05 29/06/2020  J.Tan           TSK 0893767                   *
.*                  Recompiled for ABFPTINV - Changed CALCFLAG to 01/01/2021  *
.*        V11.00.04 20/04/2020 J.Tan           TSK 0890733                    *
.*                  Recompiled for ABFPTINV - ABF new 2020 calculation        *
.*        V11.00.03 07/05/2020  J.Tan            TSK 0891341                  *
.*                  Recompiled for ABFOTINV - added TRAP to write pmsabfaf    *
.*        V11.00.02 08/04/2020 J.Tan           TSK 0868813                    *
.*                  Recompiled for PATINVHL                                   *
.*                  15/04/2020 Thanh T         TSK 0879163                    *
.*                  Added SEXDSP00                                            *
.*        V11.00.01 13/03/2020  J.Tan          TSK 0838262                    *
.*                  Added PATITMRD                                            *
.*        V10.14.02 09/09/2019  J.Tan           TSK 0857392                   *
.*                  Recompiled for ABF invoice                                *
.*        V10.14.01 05/08/2019  J.Tan           TSK 0857392                   *
.*                  Recompiled for ABF Invoices                               *
.*        V10.12.03 18/07/2018  J.Tan          TSK 0859911                    *
.*                  Recompiled for PATCATBI - Fixed No Payday Add on charge   *
.*        V10.12.02 18/06/2018  Ebon Clements  TSK 0846868                    *
.*                  Recompiled for PATINVS - Eclipse exclude claim type       *
.*        V10.12.01 28/02/2018  J.Tan          TSK 0852351                    *
.*                  Recompiled for PATINVHL-fields 226 227(Program Code/Desc) *
.*        V10.11.04 07/09/2017  J.Tan         TSK 0837479                     *
.*                  Recompiled for CMXMATRX - Consumption typ items           *
.*        V10.11.03 25/08/2017  Thanh T.              TSK 0821710             *
.*                  Removed PATCMNTS                                          *
.*        V10.11.02 10/08/2017  Peter Vela            TSK 0837619             *
.*                  Recompiled for PATINVS                                    *
.*        V10.11.01 27/07/2017  J.Tan                 TSK 0842559             *
.*                  Recompiled for PATCATBI - CHKACCM0 to check for inv.number*
.*----------------------------------------------------------------------------*
.*        V10.10.02 13/06/2017  J.Tan          TSK 0839991                    *
.*                  Recompiled for PATDBTYP (PATCMSTP)                        *
.*        V10.10.01 25/01/2017  J.Tan          TSK 0832407                    *
.*                  Recompiled for PATCATBI- multi bed trans on sameday for MV*
.*                  04/04/2017  J.Tan         TSK 0297904                     *
.*                  Recompiled for PATCMSTP - Non-Accumulative inlier ICU/CCU *
.*        V10.09.02 20/12/2016  J.Tan          TSK 0323541                    *
.*                  Recompiled for PATCATBI - set PMMIAMTT for printing inv.  *
.*        V10.09.01 17/11/2016  J.Tan          TSK 0317714                    *
.*                  Recompiled for PATCATBI - fixed MV Daycse (ptdtepsd)      *
.*        V10.08.10 07/11/2016  Ebon Clements TSK 0827937                     *
.*                  Recompiled for PATINVHL - Hospital approval number        *
.*        V10.08.09 06/10/2016  J.Tan         TSK 0826824                     *
.*                  Recompiled for CALCMVHR - MV Hours                        *
.*        V10.08.08 21/09/2016  J.Tan         TSK 0826370                     *
.*                  Recompiled for CMXMATRX - Chgd MCHGARR MCHGAMT array to F3*
.*        V10.08.07 08/09/2016  J.Tan         TSK 0825719                     *
.*                  Recompiled for PATCATBI - fixed No payday Oper.date=Adate *
.*        V10.08.06 26/08/2016  Don Nguyen    TSK 0312570                     *
.*                  Recompiled for CMXMATRX - Added check for PTCNDGED=1      *
.*                  Added PMSEDGFD/IO and GETEFDRG                            *
.*        V10.08.05 17/08/2016  J.Tan         TSK 0808745                     *
.*                  Recompiled for PATCATBI - for NPDAYFLG=1                  *
.*        V10.08.04 20/07/2016  J.Tan         TSK 0819914                     *
.*                  Recompiled for PATCATBI - Non ICU MV Hours                *
.*        V10.08.03 15/07/2016  J.Tan         TSK 0819914                     *
.*                  Recompiled for PATCATBI - Calculating non ICU MV hours    *
.*        V10.08.02 20/06/2016  J.Tan         TSK 0820816                     *
.*                  Recompiled for PATCATBI - Fixed No payday for Daycase     *
.*        V10.08.01 02/06/2016  J.Tan         TSK 0816651                     *
.*                  Recompiled for PATCATBI-Continuous Bill.to chk for Matrix *
.*        V10.07.03 04/03/2016  J.Tan         CAR 290448                      *
.*                  Recompiled for PATCATBI - Mods for Addon with No Pay DAy  *
.*        V10.07.02 18/11/2015  J.Tan         CAR 303942                      *
.*                  Added new payment types                                   *
.*        V10.07.01 13/10/2015  J.Tan           CAR 322435                    *
.*                  Recompiled for PATCATBI - invoice desc. for bdays >999    *
.*        V10.06.09 11/09/2015  J.Tan         CAR 317216                      *
.*                  Added SINVT000 and SINVH0000                              *
.*        V10.06.08 19/08/2015  J.Tan           CAR 317714                    *
.*                  Recompiled for PATCATBI- MV days greater than Beddays     *
.*        V10.06.07 19/08/2015  J.Tan           CAR 317714                    *
.*                  Recompiled for PATCATBI- MV days greater than Beddays     *
.*        V10.06.06 14/08/2015  J.Tan         CAR 320073                      *
.*                  Recompiled for PATCATAI-reprint invoice for unreleased csh*
.*        V10.06.05 07/08/2015  Davin         CAR 317002                      *
.*                  Recompiled for PRTINVBD - Print pmexname for ADF MO       *
.*        V10.06.04 15/07/2015  J.Tan          CAR 319342                     *
.*                  Recompiled for CMXMATRX - Chg 'Disc.UDF' to 'Care Class'  *
.*        V10.06.03 14/07/2015  Peter Vela     CAR 318700                     *
.*                  Recompiled for PRBILCMN - Validate for deleted VISMDT     *
.*                  record                                                    *
.*        V10.06.02 15/05/2015  Davin         CAR 310155                      *
.*                  Recompiled for PATGBCRN - added MOD10V05 for BPAY         *
.*        V10.06.01 02/04/2015  Ania P         CAR 313236                     *
.*                  Recompiled for PRTINVBD                                   *
.*        V10.05.09 10/02/2015 J.Tan           CAR 311717                     *
.*                  Recompiled for PATINVHL                                   *
.*        V10.05.08 12/01/2014  Peter Vela     CAR 310738                     *
.*                  Recompiled for PRTINVBD                                   *
.*        V10.05.07 10/12/2014 Peter Vela CAR 309840                          *
.*                  Recompiled for PATINVS                                    *
.*        V10.05.06 29/10/2014 J.Tan     CAR 307268                           *
.*                  Recompiled for PATCATBI - print date for Mech.Ventilation *
.*        V10.05.05 28/10/2014 J.Tan           CAR 304455                     *
.*                  Recompiled for PATINVHL -fixed Doctor Name and Provider no*
.*        V10.05.04 06/10/2014 Ebon Clements   CAR 268970                     *
.*                  Change to use OUTCLIFD index 1 instead of index 2         *
.*        V10.05.03 26/09/2014 J.Tan           CAR 291619                     *
.*                  Recompiled for PATCATBI/PRTINVBD -MV NOT to print Quantity*
.*        V10.05.02 04/08/2014 J.Tan           CAR 304397                     *
.*                  Mods to check Suggested classification for to be invoiced *
.*        V10.05.01 31/07/2014 J.Tan           CAR 303625                     *
.*                  Recompiled for PATCATBI - stepdown before end of Contract *
.*        V10.04.08 03/07/2014 J.Tan           CAR 268860                     *
.*                  Recompiled for PATCATBI - ICD10 Suggested Classification  *
.*        V10.04.07 19/06/2014 J.Tan           CAR 302452                     *
.*                  Recompiled for PATDINVS - Changed MCHGARR/MCHGAMT         *
.*        V10.04.06 11/06/2014 Sandra Barcham  CAR 301639                     *
.*                  Moved call to TFILENAM to INIT0000                        *
.*        V10.04.05 27/05/2014  J.Tan          CAR 300784                     *
.*                  Recompiled for STEPDOWN - force stepdown prior inv.fromdat*
.*        V10.04.04 15/04/2014  J.Tan          CAR 261630                     *
.*                  Removed pataub patauc patauf pataui pataum                *
.*        V10.04.03 15/04/2014  J.Tan          CAR 261630                     *
.*                  PATCATBI - Removed port number from temp file name        *
.*        V10.04.02 26/02/2014  J.Tan          CAR 275810                     *
.*                  Recompiled for PRTINVBD - to print Defence Force details  *
.*        V10.04.01 20/01/2014  J.Tan          CAR 273713                     *
.*                  Recompiled for PRTINVBD -Print payment types of a receipt*
.*        V10.03.18 13/12/2013  J.Tan          CAR 294609                     *
.*                  Recompiled for CMXMATRX - mods for Default Grouper Version*
.*        V10.03.17 09/12/2013  Ania P         CAR 294740                     *
.*                  Recompiled for PATINVHL                                   *
.*        V10.03.16 11/10/2013 J.Tan  CAR 283618                              *
.*                  Recompiled for PATCATBI - Mods for Independence Serv.Bill.*
.*        V10.03.15 11/10/2013 J.Tan  CAR 251004                              *
.*                  Recompiled for STEPDOWN - Check Disc. writing to pattranf *
.*        V10.03.14 09/10/2013  J.Tan          CAR 291237                     *
.*                  Mods to display TIME in log file before & after print inv.*
.*        V10.03.13 02/10/2013  J.Tan          CAR 291588                     *
.*                  Recompiled for PATCATBI - fixed stepdown return from leave*
.*        V10.03.12 12/09/2013  Peter Vela     CAR 271911                     *
.*                  Recompiled for PATINVTL                                   * 
.*        V10.03.11 14/08/2013  J.Tan          CAR 288416                     *
.*                  Recompiled for PATCATBI - fixed Days of Hosps.            *
.*        V10.03.10 05/08/2013  J.Tan          CAR 288060                     *
.*                  Recompiled for CMXMATRX - fixed Primary/Secondary/Tertiary*
.*        V10.03.09 20/06/2013  Davin         CAR 287161                      *
.*                  Recompiled for PATGBCRN - right justify ptcnhbpi          *
.*        V10.03.08 10/05/2013  J.Tan          CAR 284289                     *
.*                  Recompiled for PATINVS - fixed ALACDTE for backdated inv. *
.*        V10.03.07 06/05/2013  J.Tan          CAR 284902                     *
.*                  Recompiled for STEPDOWN - force stepdown prior Inv.Fromdat*
.*        V10.03.06 10/04/2013  J.Tan    CAR 283743                           *
.*                  Recompiled for PATCATBI -  reset PTTRESPD for New Stepdown*
.*        V10.03.05 08/03/2013  J.Tan          CAR 236254                     *
.*                  Mods to include discharges for Bulk patient backdate Inv. *
.*        V10.03.04 05/03/2013  Patrick Adair CAR 281898                      *
.*                  Recompiled for PATCATBI PATCATAI                          *
.*        V10.03.03 21/09/2012  J.Tan          CAR 271474                     *
.*                  Recompiled for CMXMATRX - using index 5 of pmscmtaf       *
.*                  04/12/2012  J.Tan          CAR 262673                     *
.*                  Recompiled for PATCATBI - Casepayment perdiem rate        *
.*        V10.03.02 18/07/2012  Don Nguyen     CAR 264561                     *
.*                  Recompiled for PATGBCRN                                   *
.*        V10.03.01 09/07/2012  Mike Laming    CAR 268832                     *
.*                  Added "OPEN" for "patmchgf" and "patfn1af" in INIT0000    *
.*        V10.02.02 07/07/2011  Steve Armstrong  CAR 240722                   *
.*                  Added RDPMPX21 prior to calling PMIHEAD                   *
.*        V10.02.01 04/04/2011  Jill Parkinson CAR 239574                     *
.*                  Removed open of ibaprntf                                  *
.******************************************************************************
.*        V10.01.05 28/02/2011  Peter Vela    CAR 233034                      *
.*                  Recompiled for PATINVS                                    *
.*        V10.01.04 24/02/2011  Peter Vela    CAR 233034                      *
.*                  Removed PATBF2FD and PATBF2IO                             *
.*        V10.01.03 28/01/2011  J.Tan         CAR 233034                      *
.*                  Mods to bed fees file                                     *
.*        V10.01.02 13/01/2011  Mike Laming   CAR 233084                      *
.*                  Added include CLPATINV for PATINVS & Recompiled           *
.*        V10.01.01 21/12/2010  Mike Laming   CAR 233046                      *
.*                  Recompiled for PABXBILL - Mods to Misc.Charges PATMCHFD   *
.******************************************************************************
.*        V10.00.10 26/10/2010  Davin         CAR 231481                      *
.*                  Recompiled for PATINV25 - added ward provider number (hea)*
.*        V10.00.09 17/08/2010 J.Tan         CAR 227873                       *
.*                  Recompiled for CMXMATRX- getting the grouper version      *
.*        V10.00.08 11/08/2010 J.Tan         CAR 227873                       *
.*                  Recompiled for CMXMATRX-searching for next matrix rules   *
.*        V10.00.07 05/08/2010  J.Tan         CAR 227717                      *
.*                  Recompiled for PATCATBI - balance payable on invoice tail *
.*        V10.00.06 04/08/2010  J.Tan         CAR 225492                      *
.*                  Mods to check for hospital id prior calculating tobe inv. *
.*        V10.00.05 03/08/2010  J.Tan         CAR 227319                      *
.*                  Recompiled for PATCATBI - Mechanical Ventilation          *
.*        V10.00.04 14/07/2010  J.Tan         CAR 226158                      *
.*                  Recompiled for STEPDOWN - bed fees update                 *
.*        V10.00.03 16/07/2010 J.Tan         CAR 226322                       *
.*                  Recompiled for CMXMATRX - search for next rule if Contract*
.*                  is not valid                                              *
.*        V10.00.02 12/07/2010  J.Tan         CAR 225932                      *
.*                  Recompiled for PATCATBI - set TDATE to IDATET for per-diem*
.*        V10.00.01 07/06/2010  Mike Laming   CAR 212864                      *
.*                  Recompiled for PATCATBI - mods at GCDE6500                *
.******************************************************************************
.*        V9.12.14  11/03/2010  J.Tan         CAR 216044                      *
.*                  Mods to include Leave days in stepdown count for TAC      *
.*        V9.12.13  16/05/2010  Peter Vela    CAR 215485                      *
.*                  Recompiled for PATCATBI - Ignore Leave if less than 1 day *
.*        V9.12.12  02/05/2010  Peter Vela    CAR 215485                      *
.*                  Recompiled for PATCATBI - Ignore Leave if less than 1 day *
.*        V9.12.11  02/02/2010  Davin         CAR 215234                      *
.*                  Recompiled for CMXMATRX                                   *
.*        V9.12.10  27/01/2010  J.Tan         CAR 214548                      *
.*                  Recompiled for PATCATBI - Stepdown after bed fees update  *
.*                  27/01/2010  J.Tan         CAR 214877                      *
.*                  Recompiled for CMXMATRX - Checking for range of MBS items *
.*        V9.12.09  19/01/2010  J.Tan         CAR 166439                      *
.*                  Recompiled for PATCMSTP - C/P additional charge stepdown  *
.*        V9.12.08  04/12/2009  Peter Vela    CAR 202333                      *
.*                  Recompiled for PATINVHL - Changed variable 88 to          *
.*                  surname only                                              *
.*        V9.12.07  24/11/2009  Davin         CAR 210721                      *
.*                  Recompiled for CHKCMXPT - I*C on patcmxaf file            *
.*        V9.12.06  09/10/2009  J.Tan         CAR 203934                      *
.*                  Recompiled for PATCATBI - display ICD10 Sugg.Class on Inv.*
.*        V9.12.05  21/09/2009  J.Tan         CAR 204390                      *
.*                  Recompiled for STEPDOWN - old bed fees file               *
.*        V9.12.04  24/07/2009  J.Tan         CAR 201132 & 202168             *
.*                  Recompiled for CMXMATRX - checking for zero MBS amount    *
.*        V9.12.03  05/06/2009  J.Tan         CAR 196010                      *
.*                  Recompiled for CMXMATRX - ICD10 Secondary/Tertiary        *
.*        V9.12.02  15/05/2009  WeeLee Koo    CAR 196722                      *
.*                  Recompiled for PATINVS                                    *
.*        V9.12.01  11/05/2009  J.Tan         CAR 125842                      *
.*                  Recompiled for PATCATBI - Recalculate zero amt of Misc.Itm*
.******************************************************************************
.*        V9.11.06  15/04/2009  Steve Armstrong  CAR 194544                   *
.*                  Recompiled for PATINVS                                    *
.*        V9.11.05  01/04/2009  J.Tan         CAR 192704                      *
.*                  Recompiled for PATCATBI - Fixed field PTDTCCU             *
.*        V9.11.04  23/03/2009  Davin         CAR 178015                      *
.*                  Recompiled for PATINVHL - Changed BPAY CRN to use inv. no.*
.*        V9.11.03  22/12/2008  Steve Armstrong   CAR 183976                  *
.*                  Recompiled for changes to PATINVS.                        *
.*        V9.11.02  20/11/2008  Steve Armstrong   CAR 181373                  *
.*                  Recompiled for changes to PATCATBI.                       *
.*        V9.11.01  14/10/2008  Peter Vela    CAR 159227                      *
.*                  Recompiled for PATINVHL - Added Emergency Invoice         *
.*                  Arrival Date and Time                                     *
.******************************************************************************
.*        V9.10.03  25/09/2008  J.Tan         CAR 178209                      *
.*                  Recompiled for PATCATBI - Fixed checking for Doct.chg rec.*
.*                  25/09/2008  J.Tan         CAR 179009                      *
.*                  Recompiled for STEPDOWN - Check 'Exclude Days of Hosp."   *
.*        V9.10.02  05/09/2008  J.Tan         CAR 177126                      *
.*                  Recompiled for PATCATBI - Checking matrix parameter       *
.*        V9.10.01  08/07/2008 Sandra Barcham CAR 173135                      *
.*                  Recompiled for PATCATBI - Remove close of PATDGWA1        *
.******************************************************************************
.*        V9.09.17  29/02/2008  J.Tan         CAR 162893 & 162609             *
.*                  Recompiled for PATCATBI - Inv.breakdown and Lumpsum amt   *
.*        V9.09.16  20/02/2008  Peter Vela    CAR 161535                      *
.*                  Recompiled for PATCATBI                                   *
.*        V9.09.15  03/01/2008  J.Tan         CAR 136785                      *
.*                  Recompiled for STEPDOWN                                   *
.*        V9.09.14  27/12/2007 Peter Vela     CAR 155907                      *
.*                  Recompiled for PATINVTL                                   *
.*        V9.09.13  29/11/2007 J.Tan          CAR 155292 and 155969           *
.*                  Recompiled for PATCATBI/NZPCATBI                          *
.*        V9.09.12  16/11/2007 Peter Vela     CAR 110766                      *
.*                  Recompiled for PATINVHL                                   *
.*        V9.09.11  12/11/2007  Peter Vela CAR 151199                         *
.*                  Added new Emergency Cancellation status                   *
.*        V9.09.10  24/08/2007  Peter Vela CAR 146143                         *
.*                  Recompiled for PATCATBI                                   *
.*        V9.09.09  20/08/2007 J.Tan          CAR 144656                      *
.*                  Recompiled for PATCATBI - for Multiple Procedures Billing *
.*        V9.09.08  10/08/2007 Peter Vela     CAR 146143                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.07  25/07/2007  Peter Vela CAR 144787                         *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.06  17/07/2007  J.Tan     CAR 140282                          *
.*                  Recompiled for NZPCATBI - Revenue breakdown               *
.*        V9.09.05  03/07/2007  Peter Vela CAR 142173                         *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.04  29/06/2007  Peter Vela CAR 142173                         *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.03  25/06/2007 Peter Vela     CAR 142173                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.02  25/06/2007  Ebon Clements CAR 143038                      *
.*                  Changed PMBBAMBS to be the admission type not the         *
.*                  admitting MBS code                                        *
.*        V9.09.01  14/06/07 J.Tan    CAR 142173                              *
.*                  Recompiled for PATCATAI - Emergency events                *
.*                  18/06/2007 Ebon Clements CAR 143038                       *
.*                  Added RA before write to pmsbiiaf to fix I * D            *
.******************************************************************************
.*        V9.08.15  23/05/07 J.Tan    CAR 141409                              *
.*                  Recompiled for PATCATBI - Pendlebury (PTCNINVL=16) lumpsum*
.*                  01/06/07 J.Tan    CAR 141297                              *
.*                  Recompiled for PATCATBI - GST Revenue breakdown
.*        V9.08.14  17/09/2007 Ebon Clements  CAR 133432                      *
.*                  Added regenerate option                                   *
.*        V9.08.13  19/02/2007 Peter Vela     CAR 135241                      *
.*                  Recompiled for PATCATBI - St. John of God invoice layout  *
.*        V9.08.12  22/02/2007 Mike Laming   CAR 119436                       *
.*                  Add PMSOSDTM (PROC FLAGDEBT) for Outstanding Debt Alert ind.
.*        V9.08.11  02/02/2007  Ebon Clements CAR 120001                      *
.*                  Added nz private billing files                            *
.*        V9.08.10  13/12/2006  J.Tan         CAR 127625                      *
.*                  Mods to JH HRN                                            *
.*        V9.08.09  27/11/2006  Steve Armstrong   CAR 126039                  *
.*                  Recompiled for changes to SGCHKDIG                        *
.*        V9.08.08  17/11/2006  Peter Vela    CAR 124538                      *
.*                  Recompiled for PATCATBI                                   *
.*                  Added display of PATITMFD.PTITTCER                        *
.*                  Type of Certificate Type B Type C                         *
.*        V9.08.07  16/11/2006  Steve Armstrong   CAR 124160                  *
.*                  Recompiled for PATINVHL (Singapore HRN)                   *
.*                  Recompiled for PATINVTL (Singapore HRN)                   *
.*        V9.08.06  14/11/2006 Peter Vela     CAR 124547                      *
.*                  Added reads for PTCNDEES PTCNDDES                         *
.*        V9.08.05  10/11/2006  J.Tan         CAR 121178                      *
.*                  Recompiled for PATCATBI - Fixed partial days description  *
.*        V9.08.04  18/10/2006  J.Tan         CAR 120502                      *
.*                  Recompiled for PATCATBI - Ignore Doctor Change record     *
.*        V9.08.03  11/10/2006  J.Tan         CAR 121178                      *
.*                  Recomp.for PATCATBI - Acc.desc for halfday charge on Disch*
.*        V9.08.02  05/10/2006  J.Tan         CAR 120654                      *
.*                  Recompiled for PATCATBI - Split invoices                  *
.*        V9.08.01  29/09/2006  Peter Vela    CAR 120319                      *
.*                  Recompiled for PATINVHL                                   *
.******************************************************************************
.*        V9.07.07  25/09/2006  Peter Vela    CAR 118940                      *
.*                  Recompiled for PATCATBI                                   *
.*        V9.07.06  20/09/2006 J.Tan         CAR 119336                       *
.*                  Added claim code to Suggested classification file         *
.*        V9.07.05  07/09/2006  Jill Habasque CAR 109852                      *
.*                  Added GETALIDS                                            *
.*                  18/08/2006  J.Tan         CAR 115853                      *
.*                  Recompiled for PATINVS - Print claim for Pendlebury       *
.*        V9.07.04  02/08/2006  Peter Vela    CAR 113658                      *
.*                  Recompiled for PATINV21 - Fixed Date and Cash Payment     *
.*                  display                                                   *
.*        V9.07.03  01/08/2006  J.Tan         CAR 103365                      *
.*                  Recompiled for PATCATBI - John Hopkins                    *
.*        V9.07.02  25/07/2006  Peter Vela    CAR 113658                      *
.*                  Recompiled for PATCATAI - Fixed "Journal Total" display   *
.*        V9.07.01  13/07/2006  Mike Laming       CAR 111521                  *
.*                  Change all Bed Fee & Theatre Fee work areas to FORM 8.2   *
.******************************************************************************
.*        V9.06.03  16/05/2006  Peter Vela    CAR 104103                      *
.*                  Recompiled for PATCATBI - PTCNINVL=12                     *
.*        V9.06.02  31/05/2006  J.Tan         CAR 105669                      *
.*                  Recompiled for PATCATBI - STV Invoice                     *
.*        V9.06.01  24/04/2006  J.Tan         CAR 102287                      *
.*                  Recompiled for PATINVHL - fields for multi hospital det.  *
.******************************************************************************
.*        V9.05.03  29/03/2006  Peter Vela    CAR 95780                       *
.*                  Recompiled for PATINVHL - Added emg mobile contact numbers*
.*        V9.05.02  27/03/2006  Peter Vela    CAR 61299                       *
.*                  Increased field no size from DIM3 to DIM5                 *
.*        V9.05.01  10/03/2006  Mike Laming   CAR 79281                       *
.*                  Recompiled for PATINVS/PATFUTRE/PATFACFD                  *
.*        V9.05.B03 06/01/2006  J.Tan             CAR 84567                   *
.*                  Recompiled for PATCATBI - accom.desc.for manual stepdown  *
.*        V9.05.B02 20/12/2005  J.Tan         CAR 89226                       *
.*                  Recompiled for PATCATBI - recalculate theatre fees        *
.******************************************************************************
.*        V9.04.17  17/11/2005  Peter Vela    CAR 84547                       *
.*                  Recompiled for PATINVXX subroutines - Removed CLOSE PATFN1A1
.*        V9.04.16  02/11/2005  Peter Vela        CAR 81394                   *
.*                  Recompiled for PATCATBI                                   *
.*        V9.04.15  25.10.2005 Sandra Barcham CAR 81362                       * 
.*                  Recompiled for PATINVS - Fixed pack of fincode for dep.   *
.*        V9.04.14  27/09/05 J.Tan    CAR 77671                               *
.*                  Recompiled for PATCATAI - GROSSTOT overlapping            *
.*        V9.04.13  04/08/2005  J.Tan        CAR 62750                        *
.*                  Mods not to use the redefined amount variables            *
.*                  31/08/2005  J.Tan         CAR 74153                       *
.*                  Recompiled for CMXMATRX - checking for exclusive          *
.*        V9.04.12  14/07/2005  Peter Vela    CAR 62172                       *
.*                  Recompiled for PATINVTL                                   *
.*        V9.04.11  16/06/2005  Mike Laming   CAR 61746                       *
.*                  Recompiled for CLPATDTR - add clear PTDTTIME & PTDTCRST   *
.*        V9.04.10  01/03/2005  Peter Vela    CAR 57547                       *
.*                  Recompiled for PATVADFD and PATVADIO                      *
.*        V9.04.09  24/02/2005  J.Tan         CAR 58263                       *
.*                  Recompiled for PATCATAI - printing item description       *
.*        V9.04.08  17/02/2005  Mike Laming   CAR 56030                       *
.*                  Re-compile for PATINV25 - fix screen painted tail printing*
.*        V9.04.07  29/11/2004  Mike Laming   CAR 54534                       *
.*                  Re-comple for PATCMSTP - fix Addit.Charge Description     *
.*        V9.04.06  17/11/2004  J.Tan   CAR 54630                             *
.*                  Mods checking for invoice date                            *
.*        V9.04.05  06/10/2004  J.Tan   CAR 53798                             *
.*                  Removed PATMSCDS                                          *
.*        V9.04.04  04/10/2004  Peter Vela CAR 52906                          *
.*                  Recompiled for PATCATAI                                   *
.*                  22/09/2004  Lina Vo  CAR 53660                            *
.*                  Recompiled for PATINVS                                    *
.*        V9.04.03  06/09/2004  J.Tan    CAR 53073                            *
.*                  Mods to keyin hospital id for multi hospital              *
.*        V9.04.02  06/09/2004  Lina Vo  CAR 52998                            *
.*                  Initialise Page Number for PRTINVHL                       *
.*        V9.04.01  27/08/2004  J.Tan    CAR 52835                            *
.*                  Recompiled for PATCATBI - multi hospital                  *
.******************************************************************************
.*        V9.03.20  22/06/2004  Lina Vo  CAR 50811                            *
.*                  Removed use of RCPDEPFD & IO - now obselete.              *
.*        V9.03.19  09/06/2004  J.Tan    CAR 50035                            *
.*                  Re-compile for PATCATBI - Mechanical ventilation          *
.*        V9.03.18  23/04/2004  J.Tan   CAR 45547                             *
.*                  Mods for bulk backdate invoice                            *
.*        V9.03.17  22/04/2004  Mike Laming   CAR 46224                       *
.*                  Re-compile for PATCATBI & PATINVS - Theatre DTR sequences *
.*        V9.03.16  06/04/2004  Peter Vela    CAR 48227                       *
.*                  Added VARGBCRN and PATGBCRN - BPAY Reference Number       * 
.*        V9.03.15  16/03/2004  Steve Armstrong  HosClaims Phase 1 (48280)    *
.*                  Recompiled for PATINVS                                    *
.*        V9.03.14  23/02/2004  Mike Laming   CAR 47440                       *
.*                  Re-compile for PATCATBI - initialise TPATAMTP             *
.*        V9.03.13  12/02/2004  Henry Son        CAR 47385                    *
.*                  Added PTCNMBSF for checking if we allow more than         *
.*                  Six MBS Items.                                            *
.*  V9.03.12  03/02/2004  J.Tan  CAR 45047                                    *
.*            Recompiled for PATCATAI - Non-banked Cash                       *
.*  V9.03.11  19/12/2003 J.Tan   CAR 44093                                    *
.*            Replaced patcashf with comdepaf                                 *
.*  V9.03.10  21/11/2003  J.Tan   CAR  44161                                  *
.*            Recompiled for PATCATAI - print credit note                     *
.*  ........  18/11/2003  Henry Son   CAR 39291                               *
.*            Allow more than 7 Theatre stepdown fees.                        *
.*            Recompile PATINVS, PATCATBI.                                    *
.*  V9.03.09  07/11/2003  Peter Vela   CAR 44849                              *
.*            Recompiled for PATINVTL                                         *
.*  V9.03.08  03/11/2003  Mike Laming  CAR 43911                              *
.*            Recompile for PATCATBI - correct GROSSTOT & ACCMTOT             *
.*  V9.03.07  03/11/2003  Peter Vela CAR 44757                                *
.*            Recompiled for PATINVTL                                         *
.*  V9.03.06  17/10/2003  J.Tan  CAR 44176                                    *
.*            Recompiled for PATCATBI.                                        *
.*            29/10/2003 Sandra Barcham   43783                               *
.*            Recompiled for NZHISIIO and NZHISIUP                            *
.*  V9.03.05  15/09/2003  CAR 40497   Lina Vo                                 *
.*            Recompiled for PATCATBI, PATINVS, PATMCHFD & IO.                *
.*            16/09/2003  J.Tan        CAR 36504                              *
.*            Recompiled for CHNADMTP                                         *
.*  V9.03.04  04/09/2003  CAR 42713   Mike Laming                             *
.*            Recompiled for PATINVTL (correct GST twice in final Total)      *
.*  V9.03.03  12/08/2003  CAR 41072   Mike Laming                             *
.*            Recompile for PATCATBI to correct Lump Sums in BIL19            *
.*  V9.03.02  04/08/2003  CAR 34330/41952   Mike Laming                       *
.*            Recompiled for PATCATBI & PATDINVS - Add second temp            *
.*            file for Misc.Items to change sequence to Date/DTR seq.         *
.*  V9.03.01  13/06/2003  J.Tan  CAR 39525                                    *
.*            Mods to read visit record                                       *
.******************************************************************************
.*        V9.02.28  11/04/2003  Davin  CAR/Quote 23297 (misc. charges keyin)  *
.*                  Recompiled for PATINVS - default patient/rebate amounts   *
.*        V9.02.27  13/02/2003  Dean Cramer  CAR 22238                        *
.*                  Recompiled for rcptrn                                     *
.*        V9.02.26  12/11/2002  J.Tan                                         *
.*                  Recompiled for KYPTBANK                                   *
.*        V9.02.25  30/10/2002  J.Tan                                         *
.*                  Recompiled for CMXMATRX                                   *
.*        V9.02.24  04/10/2002  J.Tan                                         *
.*                  Recompiled for CHNADMTP - updating for public hospital    *
.*        V9.02.23  19/09/2002  J.Tan                                         *
.*                  Recompiled for PATCATBI                                   *
.*        V9.02.22  09/09/2002  J.Tan     SRF 20791                           *
.*                  Recompiled for PATCATBI                                   *
.*       V9.02.21  05/08/2002  J.Tan                                          *
.*                 Recompile for PATCATBI - Fees invoice allocation CACCFEE   *
.*        V9.02.20  29/07/2002  J.Tan                                         *
.*                  Added packing of key 8 before calling INVPRT              *
.*        V9.02.19  24/07/2002  J.Tan  SRF 19425                              *
.*                  Recompiled for CMXMATRX - mods to use health fund grouper *
.*        V9.02.18  23/07/2002  J.Tan                                         *
.*                  Mods to read print miscellaneous charge parameter         *
.*        V9.02.17  21/06/2002  J.Tan                                         *
.*                  Recompiled for PATCATBI,PATINVS I*D on patdtraf           *
.*        V9.02.16  22/04/2002  J.Tan                                         *
.*                  Recompiled for PATCATBI - changes from 6.09               *
.*        V9.02.15  12/04/2002  J.Tan                                         *
.*                  Recompiled for PATCATAI PATANVS                           *
.*        V9.02.14  28/03/2002  J.Tan                                         *
.*                  Recompiled for PATCATBI - STV invoice layout              *
.*        V9.02.13  01/03/2002  J.Tan                                         *
.*                  Recompiled for PATINVS - mods not to use theatre fees     *
.*        V9.02.12  13/02/2002  Dean Cramer                                   *
.*                  Recompiled for PATMSCDS - Fix misc. item search           *
.*        V9.02.11  22/01/2002  Steve Downing  SRF 14240                      *
.*                  Recompiled for PATCATBI - changes to modbury layout       *
.*        V9.02.10  17/01/2002  J.Tan                                         *
.*                  Recompiled for PATINVS - default GST applicable           *
.*        V9.02.09  07/12/2001  Tonii                                         *
.*                  Recompiled for PATCATBI - Casemix changes                 *
.*        V9.02.08  29.11.2001  B.G.Ackland                                   *
.*                  Remove pi's from Program                                  *
.*        V9.02.07  01/11/2001  Greg Horvat                                   *
.*                  Recompiled for ACTCOMN1 - Added xtra option to the        *
.*                  parameter PNSWRACE                                        *
.*        V9.02.06  22/10/2001  Dean Cramer                                   *
.*                  Recompiled for PATANVS. Also make spool and printer       *
.*                  select at end for web.
.*        V9.02.05  17/10/2001  Greg Horvat      SRF 13654                    *
.*                  Recompiled for PATCATBI - Changed to display the patient's*
.*                  admission number when a casemix error occurs              *
.*                  16/10/2001  Greg Horvat      SRF 13636                    *
.*                  Recompield for PATCATBI - Changed to use AADMNO rather    *
.*                  than TADMN when reading pattranf for the 1st time when    *
.*                  calculating the amount to be invoiced                     *
.*                  19/10/2001 J.Tan                                          *
.*                  Add option to use MBS amount instead of theatre fees      *
.*        V9.02.04  13/10/2001  J.Tan                                         *
.*                  Recompiled for PATCATBI                                   *
.*        V9.02.03  06/10/2001  J.Tan                                         *
.*                  Recompiled for CMXMATRX                                   *
.*        V9.02.02  22/09/2001  Tonii  SRF 13075                              *
.*                  Recompiled for PATDINVS                                   *
.*        V9.02.01  07/09/2001  Dean Cramer                                   *
.*                  Copied from Release 5.09                                  *
.*                  Recompiled for PATCATAI                                   *
.******************************************************************************
.*        V5.09.02  01/08/2001  Tonii  SRF 10965                              *
.*                  Recompiled for PATCATAI                                   *
.*        V5.09.01  02/07/2001  Caleb Sharman  SRF 10970                      *
.*                  Recompiled for PATWRDDS                                   *
.*        V5.09.B03 30/05/2001  Glenn Saunders - srf 10215                    *
.*                  Recompile for PATCATBI (casemix - matrix changes)         *
.*        V5.09.B02 29/03/2001  Steve Downing  SRF 8239                       *
.*                  Recompiled for PATCATBI - mods to Wimmera Layout          *
.*        V5.09.B01 04/01/2001  Jill Habasque                                 *
.*                  Casemix mods - Recompiled for PATCATBI                    *
.*        V5.08.18  22/11/2000  Greg Horvat                                   *
.*                  Recompiled for PATCATAI PATCATBI & PATINVS - Commented out*
.*                  any code to do with Hong Kong or Mt Alvernia              *
.*        V5.08.17  13/11/2000  Jill Habasque                                 *
.*                  Fixed tempfile length to allow 8 character HF table       *
.*        V5.08.16  09/11/2000  Ebon Clements SRF 6891                        *
.*                  Recompiled for PATINVS read patmchgf with key26           *
.*        V5.08.15  27/10/2000  Dean Cramer   SRF 6710                        *
.*                  Recomplied for PATMSCDS                                   *
.*                  Changed for health fund table code size increase to       *
.*                  8 characters                                              *
.*                  16/10/2000  Steve Downing                                 *
.*                  Recompiled for PATINVS                                    *
.*        V5.08.14  06/10/2000  Davin                                         *
.*                  Recompiled for Ann Caudle invoices                        *
.*        V5.08.13  29/09/2000  Jill Habasque SRF 3060                        *
.*                  Recompiled for PATINVHL                                   *
.*        V5.08.12  14/09/2000 Caleb Sharman                                  *
.*                  Health fund change mods                                   *
.*        V5.08.11  04/08/2000 J.Tan   SRF 2435                               *
.*                  Recomp.for PATCATBI - no totals for lanscape with RH      *
.*        V5.08.10  16/08/2000  Caleb Sharman                                 *
.*                  Changed Health Fund variables to be 8 chars               *
.*        V5.08.09  27/07/2000  J.Tan                                         *
.*                  Recompiled for PATCATBI - invoice for day case patients   *
.*        V5.08.08  24/07/2000  Davin                                         *
.*                  Recompiled for PATINVTL - template multipage invoice tail *
.*        V5.08.07  06/07/2000  Davin                                         *
.*                  Recompiled for PATINVHL, PATINVTL & PATCATAI              *
.*        V5.08.06  28/06/2000  J.Tan                                         *
.*                  Recompiled for PATCALFN - GST changes                     *
.*                  Recompiled for PATCATBI - Landscape with RH               *
.*        V5.08.05  06/06/2000 J.Tan                                          *
.*                  Recomp.for PATCATBI,PATINVS- extra day for backdating inv.*
.*        V5.08.04  01/06/2000 J Habasque                                     *
.*                  Added packing of key 8 before calling INVPRT              *
.*        V5.08.03  15/05/2000 J.Tan                                          *
.*                  Recompiled for PATCATBI - landscape invoice               *
.*        V5.08.02  01/05/2000  J.Tan                                         *
.*                  Fixed no of days for backdated invoices                   *
.*        V5.08.B07 03/04/2000  Davin                                         *
.*                  Added parameters for invoice templating                   *
.*        V5.08.B07 03/04/2000  Davin                                         *
.*                  Added parameters for invoice templating                   *
.*        V5.08.B06 30/03/2000  Davin                                         *
.*                  Recompiled for invoice templating                         *
.*        V5.08.B05 29/03/2000  Jill Habasque                                 *
.*                  Added open of PATGTUA1                                    *
.*        V5.08.B04 14/03/2000  Greg Horvat                                   *
.*                  Recompiled for PATINVT3 & PATINVT7                        *
.*        V5.08.B03 29/02/2000  Greg Horvat                                   *
.*                  Recompiled for PATINVT3 & PATINVT7 - Moved the getting of *
.*                  the primary disease code to a procedure                   *
.*                  28/02/2000  Greg Horvat                                   *
.*                  Recompiled for PATCATBI - Changed a few routines into     *
.*                  procedures                                                *
.*                  25/02/2000  Greg Horvat                                   *
.*                  Recompiled for PATINVT5                                   *
.*                  25/02/2000  Greg Horvat      SRF 637565                   *
.*                  Recompiled for PATINVS - Changes for 4 character DRGs     *
.*        V5.08.B02 03/02/2000  J.Tan                                         *
.*                  Changes for GST                                           *
.*        V5.07.15  04/01/2000 J.Tan                                          *
.*                  Recompiled for PATREBAT - zero filled for dates           *
.*        V5.07.14  16/12/1999 J.Tan                                          *
.*                  Recompiled for PATCATBI-nursing home & Y2K "tobe invoiced"*
.*        V5.07.13  16/11/1999  J.Tan   SRF 635424                            *
.*                  Changed CURSESS to DIM18                                  *
.*        V5.07.12  15/10/1999  Steve Armstrong                               *
.*                  Removed reference to CSTRTYR (not used)                   *
.*        V5.07.11  13/10/1999  Jill Habasque SRF 634222                      *
.*                  Recompiled for PATINVS                                    *
.*        V5.07.10  24/09/1999  Jill Habasque SRF 646099                      *
.*                  Recompiled for PATAUIFD                                   *
.*        V5.07.09  25/08/1999  Jill Habasque SRF 633206                      *
.*                  Fixed printing of Ward/Bed in PATCATBI                    *
.*        V5.07.08  23/08/1999  J Habasque                                    *
.*                  Recompiled for WCEPOST                                    *
.*        V5.07.07  04/08/1999  J Habasque SRF 633553                         *
.*                  Recompiled for PATANVS                                    * 
.*        V5.07.06  24/06/1999  J Habasque                                    *
.*                  Recompiled for PATINVS                                    *
.*        V5.07.05  21/06/1999  J.Tan  SRF 632459                             *
.*                  Recompiled for PATCATAI - printing accommodation          *
.*        V5.07.04  19/05/1999  J Habasque SRF 631718                         *
.*                  Recompiled for changes to PATCATAI                        *
.*        V5.07.03  06/05/1999  J.Tan                                         *
.*                  Recompiled for PATINVS - for DRG allocation warning       *
.*        V5.07.02  11/03/1999  J.Tan                                         *
.*                  Mods for casemix funding                                  *
.*        V5.07.01  27/04/1999  Steve Armstrong                               *
.*                  Mods to TEMPFILE index for ORACLE and recompiled for      *
.*                  PATINVS.                                                  *
.*        V5.07.B04 28/01/1999  Nicole Harrington 507 rebounds                *
.*                  Mods to fix R*R in PATAUDC1                               *
.*        V5.07.B03 13/01/1999  Jim Stathopoulos                              *
.*                  Fixed Global Compile Errors                               *
.*        V5.07.B02 29/12/1998  Jim Stathopoulos                              *
.*                  Mods for 507                                              *
.*        V5.07.B01 17/11/1998  Davin                                         *
.*                  Mods for 507                                              *
.*                  02/11/1998  Katie Nelson                                  *
.*                  Recompiled for PATCATBI                                   *
.******************************************************************************
.*        V5.05.01  14/10/1997  Steve Armstrong    SRF 643393                 *
.*                  Recompiled for removal of THC invoice message             *
.******************************************************************************
.*        V5.04.05  14/06/1997  Steve Armstrong                               *
.*                  Fixed bugs in global recompile                            *
.*        V5.04.04  02/05/1997  Steve Armstrong   SRF 642857                  *
.*                  Changed temp file name "pstidx" to standard format        *
.*        V5.04.03  16/11/1996  Greg Horvat      SRF 616143 (Rebound)         *
.*                  Recompiled for PATINV17 - Changes to invoice tail         *
.*        V5.04.02  22/07/1996  Steve Armstrong  SRF 641785                   *
.*                  Recompiled for changes to PATINV15                        *
.*        V5.04.01  15/06/1996  Greg Horvat      SRF 616143                   *
.*                  Recompiled for PATCATAI, PATCATBI, PATINV17 & PATINVS -   *
.*                  Added new invoice layout for MBF - layout 17              *
.*                                                                            *
.* ************************************************************************** *
.*                                                                            *
.*                                                                            *
.*                  V5.01.02  26/07/94  Whirlpool    srf 130721               *
.*                            Made use view patient invoice parameter         *
.*                  V5.02.00  17/10/94  Rob Leonard  SRF 132847               *
.*                            Fixed equivalent BIL20 invoicing problem        *
.*        V5.02.01  13/02/1995  Greg Horvat      SRF 134920 134922 134932     *
.*                  Recompiled for IBAPRINT                                   *
.*        V5.02.02  20/02/1995  Greg Horvat      SRF 134879                   *
.*                  Recompiled for PATAUMFD & PATIOAUM - added new variable & *
.*                  changed to write to this new variable                     *
.*        V5.02.03  22/02/1995  Greg Horvat      SRF 135134                   *
.*                  Recompiled for PATCATAI - Changed printing of E.F.R.      *
.*        V5.02.04  23/02/1995  Paul Howells     SRF 134411                   *
.*                  Only add a day for last day of last stepdown (inv date)   *
.*                  not for all stepdowns.                                    *
.*        V5.02.05  02/03/1995  Greg Horvat      SRF 134196  Quote 8277       *
.*                  Recompiled for PATCALFN & PATCATBI                        *
.*        V5.02.06  14/03/1995  Greg Horvat      SRF 134573  Quote 8300       *
.*                  Recompiled for PATBNKFD & PATIOBNK - Added PTBFRDTE       *
.*        V5.02.07  10/04/1995  Greg Horvat      SRF 135653                   *
.*                  Recompiled for PATINVT9 - Changes to Melb Clinic header   *
.*        V5.02.08  19/04/1995  Steve Armstrong                               *
.*                  Recompiled for changes to rcptrn                          *
.*        V5.02.09  28/04/1995  Paul Howells         SRF 134946               *
.*                  Recompiled for changes to PATINVS                         *
.*        V5.02.10  05/05/1995  ROD         SRF 136175                        *
.*                  Recompiled for changes to PATINV10 & PATINV16             *
.*        V5.03.B2  19/05/1995  Greg Horvat      SRF 136535                   *
.*                  Recompiled for PATINV16 - Changed Port Mac. tail over 2   *
.*                  pages                                                     *
.*        V5.03.B3  22/05/1995  Paul Howells     SRF 134644                   *
.*                  Check whether using invoice pending file before writing.  *
.*        V5.03.B4  24/05/1995  Greg Horvat      SRF 136058                   *
.*                  Recompiled for PATINVT9 - Changes to Melb Clinic tail     *
.*        V5.03.B5  02/06/1995  Steve Armstrong                               *
.*                  Recompiled for RCPDEPFD                                   *
.*        V5.03.01  01/08/1995  Greg Horvat      SRF 610897                   *
.*                  Recompiled for PATCATAI - Changed Port Mac. A&E invoice   *
.*                  reprints to print the attending doctor in the body of the *
.*                  invoice                                                   *
.*        V5.03.02  04/08/1995  Greg Horvat      SRF 611050                   *
.*                  Recompiled for PATINV16 - Fixed invoice line ups          *
.*        V5.03.03  17/08/1995  Paul Howells     SRF 611251                   *
.*                  Moved PTCNIPEN                                            *
.*        V5.03.04  04/09/1995  ROD              SRF 611596                   *
.*                  Recompile for PATINV16 & PATANVS                          *
.*        V5.03.05  18/10/1995  Greg Horvat      SRF 640735                   *
.*                  Recompiled for PATINVT4 - Invoice tail going over 2 pages *
.*        V5.03.06  13/12/95  J.Tan      SRF 640744                           *
.*                  Recomp.for PATCATBI- no deposit display for insurance inv.*
.*        V5.03.07  07/02/1996  Greg Horvat      SRF 613911                   *
.*                  Recompiled for PATCATBI & PATINV* - Changes to the        *
.*                  printing of the estimated fund rebate                     *
.*                                                                            *
.******************************************************************************
.
          INC       STD001FD
          INC       STDHLPDF
          INC       STDKWSDF
          INC       RSHWEBDF
          INC       CHKCLDCD/INC
          INC       CHKDIGVR/INC
          INC       PABXVARS/INC
          INC       PATCOMM/INC
          INC       TFILEVAR/INC                 * Generate Temp File Name
          INC       WEBERRFD/INC                 * Web Server Error Logging
.
          INC       PATSTAFD/INC
          INC       PATAA1FD/INC
          INC       AAEDE1FD/INC
          INC       AAEDTRFD/INC
          INC       AAECONFD/INC
          INC       BOKRC1FD/INC
          INC       EMRHISFD/INC
          INC       EMRVISFD/INC
          INC       IBACONFD/INC
          INC       IBAGSTFD/INC
          INC       IBAGEDFD/INC
          INC       IBAPRNFD/INC
          INC       IBATMDFD/INC
          INC       IBATMHFD/INC
          INC       IBAPDFFD/INC
          INC       NZHISIFD/INC       * for NZIBSRCH
.
          INC       COMDEPFD/INC
          INC       OUTBB1FD/INC
          INC       OUTBOAFD/INC
          INC       OUTCLIFD/INC
          INC       OUTDTRFD/INC
          INC       OUTSITFD/INC
          INC       OUTPREFD/INC
          INC       OPRARDFD/INC
          INC       OPRDEAFD/INC
          INC       OPRDECFD/INC
          INC       OPRSRGFD/INC
          INC       MLTCFNFD/INC
          INC       NZPEXTFD/INC
          INC       NZPRDTFD/INC
          INC       NZPBFEFD/INC
          INC       NZPCFNFD/INC
          INC       NZPCMTFD/INC
          INC       NZPFIGFD/INC
          INC       NZPFINFD/INC
          INC       NZPIBRFD/INC
          INC       NZPIRNFD/INC
          INC       NZPMCHFD/INC
          INC       NZPMXCFD/INC
          INC       NZPPFEFD/INC
          INC       NZPRBRFD/INC
          INC       NZPRFNFD/INC
          INC       NZPPICFD/INC
          INC       NZPSPRFD/INC
          INC       NZPTFEFD/INC
          INC       NZPIVBFD/INC
          INC       NZPRVBFD/INC
          INC       OPRSESFD/INC
.
          INC       PATONHFD/INC
          INC       PATELGFD/INC
          INC       PATINMFD/INC
          INC       PATRATFD/INC
          INC       PATREMFD/INC
          INC       PATCALAG/INC
          INC       PATCFAFD/INC
          INC       PMSABFFD/INC
          INC       PMSPWAFD/INC
          INC       PMSCIDFD/INC
          INC       PMSCCDFD/INC
          INC       PMSTLEFD/INC
          INC       PATCRAFD/INC
          INC       PATCURFD/INC
          INC       PATALWFD/INC       * Allowances file
          INC       PATBFEFD/INC
          INC       PATCODFD/INC
          INC       PATCONFD/INC
          INC       PATDINVS/INC
          INC       PATDO1FD/INC
          INC       PATDSCFD/INC
          INC       PATDRGFD/INC
          INC       PATDTRFD/INC
          INC       PATECOFD/INC
          INC       PATECDFD/INC
          INC       PATECHFD/INC
          INC       PATEDSFD/INC
          INC       PATEDTFD/INC
          INC       PATFACFD/INC
          INC       PATFEEFD/INC
          INC       PATFINFD/INC
          INC       PATFMOFD/INC
          INC       PATFN1FD/INC
          INC       PATFN2FD/INC
          INC       PATFIGFD/INC
          INC       PATFX1FD/INC
          INC       PATGTUFD/INC
          INC       PATIBLFD/INC
          INC       PATICDFD/INC
          INC       PATICUFD/INC
          INC       PATINLFD/INC
          INC       PATIN1FD/INC
          INC       PATINVFD/INC
          INC       PATIOVFD/INC
          INC       PATIPEFD/INC
          INC       PATIPRFD/INC
          INC       PATIRNFD/INC
          INC       PATITMFD/INC       * Item file
          INC       PATJRNFD/INC
          INC       PATMA1FD/INC
          INC       PMSEVTFD/INC
          INC       PMSHATFD/INC
          INC       PMSHCPFD/INC
          INC       PMSPX2FD/INC
          INC       PATMMBFD/INC
          INC       PATMCHFD/INC
          INC       PATMI1FD/INC
          INC       PATNOBFD/INC
          INC       PATOVBFD/INC
          INC       PATPGRFD/INC
          INC       NHIMASFD/INC       * for PATSRCH
          INC       PATPR1FD/INC
          INC       PATRBLFD/INC
          INC       PATRCAUD/INC
          INC       PATRE1FD/INC
          INC       PATRFNFD/INC
          INC       PATRFGFD/INC
          INC       PATSGCFD/INC
          INC       PATSRBFD/INC
          INC       PATGSRFD/INC
          INC       PATTFEFD/INC
          INC       PATTRDAT/INC
          INC       PATTRNFD/INC
          INC       PATVENFD/INC
          INC       PATVISFD/INC
          INC       PATWC1FD/INC
          INC       PATWMAFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       PMSSINFD/INC
          INC       PATCMTFD/INC
          INC       PMSCMTFD/INC
          INC       PMSECTFD/INC
          INC       PMSVX1FD/INC
          INC       PMSPRGFD/INC
          INC       PMSCNOFD/INC
          INC       PMSFCIFD/INC
          INC       PMSSGAFD/INC
          INC       PMSMTIFD/INC
          INC       PMSMPRFD/INC
          INC       PMSBBIFD/INC
          INC       PMSBISFD/INC
          INC       VISPAYFD/INC
.
          INC       PATAFEFD/INC
          INC       PATASDFD/INC
          INC       PATCMXFD/INC         * casemix files
          INC       PATCTFFD/INC
          INC       PATDGWFD/INC
          INC       PATHDFFD/INC
          INC       PATHLFFD/INC
          INC       PATHSPFD/INC
          INC       PATHTRFD/INC
          INC       PATLDFFD/INC
          INC       PATLSDFD/INC
          INC       PMSEXTFD/INC
.
          INC       RCPCONFD/INC
.
          INC       PATDNRFD/INC
          INC       PATSDNFD/INC
          INC       PATSMWFD/INC
          INC       PATNIDFD/INC
          INC       PATALRFD/INC
          INC       PMSPYRFD/INC
          INC       PMSPBRFD/INC
          INC       PMSIDEFD/INC
          INC       PMSIVBFD/INC
.
          INC       RCPBNKFD/INC
          INC       RCPDTEFD/INC
          INC       RCPBDTFD/INC
          INC       RCPCRSFD/INC
          INC       PATDHEAD/INC
          INC       SCRPSTFD/INC
          INC       VARGBCRN/INC           * I-48227
          INC       WEBCONFD/INC
          INC       WEBSCHFD/INC
          INC       WEBIHCFD/INC
          INC       PMSEDGFD/INC       * Effective DRG Dates
          INC       PATDDHFD/INC
+
.
.******************************************************************************
.
ACTION    DIM       1                       * Action for PATAA1FD
ADD       DIM       2                       * Day for PATAA1FD
AMM       DIM       2                       * Month for PATAA1FD
AYY       DIM       2                       * Year for PATAA1FD
ACC       DIM       2                       * Century for PATAA1FD
ADMNDATE  DIM      10
AADMNOX   DIM       8
ADIAG     DIM       50
ADMISSNO  DIM       8[13]
XDESC     DIM       30
BFAMT     FORM      8.2                                               *C-111521
.
CSTRTYR   DIM       8
CDYSDAYS  FORM      6                       * CALCDAYS number of days
CDYSFDTE  DIM       8                       * CALCDAYS from date
CDYSTDTE  DIM       8                       * CALCDAYS to date
CDYSYEAR  FORM      2                       * CALCDAYS year
CERTINDC  FORM      1
CHGFLAG   FORM      1
CALDAYS   FORM      3
CHOICE    FORM      2
CMDLINE   DIM       80
CN        INIT      "CN"
CODE      DIM       2
CATCR     INIT      "cr"
CODEA     INIT      "A "
CODEBT    INIT      "BT"
CODECL    INIT      "CL"
CODEDP    INIT      "DP"
CODEFA    INIT      "FA"
CODEPY    INIT      "Py"
COUNTER   FORM      2
CURPAGE   FORM      2                  * used by comments maintenance
CURSESS   DIM       18
CURRDATE  DIM       8
.
DOWNCASE  INIT      "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"
DISPNAME  DIM       60
DAYSDIFF  FORM      2
DISCDATE  DIM       10
DIM1A     DIM       1
DIM2A     DIM       2
.DIM3      DIM       3
DIM4      DIM       4
DIM9      DIM       9
DIM12     DIM       12
DIM12A    DIM       12
DIM14     DIM       14
DIM14A    DIM       14
DIM18     DIM       18
DIM18A    DIM       18
DIM24A    DIM       24
DIM30     DIM       30
DIMC01    DIM       8
DIMC02    DIM       8
DIMC03    DIM       8
DIMC04    DIM       8
DIMC05    DIM       8
DIMC06    DIM       8
DIMC07    DIM       8
DIMC08    DIM       8
DIMC09    DIM       8
DIMC10    DIM       8
DIMC11    DIM       8
DIMC12    DIM       8
DIMC13    DIM       8
DIMC14    DIM       8
DIM5A     DIM       5
DNAME     DIM       20
DOCTCODE  DIM       6
DOCFNAME  DIM       50
DDRGCODE  DIM       4
.
EMCNGINV  DIM       1
ENDDAT    DIM       6
ENDNAM    DIM       6
ENDSEC    FORM      5
EXPCHCNT  FORM      2
EFTADMIN  DIM       8
EFTATYPE  DIM       3
EFTTIME   DIM       8
EFTDATE   DIM       8
.
FMTGNAME  DIM       35
FMTTITLE  DIM       10
FMTSNAME  DIM       35
FHDUDT1   DIM       8
FHDUDT2   DIM       8
FNAMER    DIM       8
FNAMET    DIM       8
FNAMEW    DIM       8
FORM3A    FORM      3
FORM5     FORM      5
FRSTGNAM  DIM       40
FULLGNAM  DIM       80
.
HOSPID    DIM       3
HDUDAY1   FORM      3                  * High Dependency
HDUDAY2   FORM      3
HDUFLG    FORM      "0"
HFHIFUND  FORM      2
.
IWARD     DIM       3
IDTYP     DIM       20
ITEMCD    FORM      1
JYEAR     FORM      2
.
KEY12A    DIM       12
KEY13A    DIM       13
KEYFLAG   FORM      1
.
LASTREC   FORM      "0"
LINECNT   FORM      2
LINVDATE  DIM       10
LNO       FORM      2
LWCHG     FORM      6.2                * Labour Ward Fee
LWCODE    INIT      "LW"
LWDT      DIM       8
.
MAXSEPDY  FORM      "35"
MBSLOP    FORM      2
MBSFLAG   FORM      1
MBS1      DIM       9
MBS2      DIM       9
MBS3      DIM       9
MBSDT1    DIM       8
MBSDT2    DIM       8
MBSDT3    DIM       8
MBSCH1    DIM       9
MBSCH2    DIM       9
MBSCH3    DIM       9
MBSNUM    FORM      "0"
MENUTYPE  DIM       2
MINOWE    FORM      6.2
MULTAMT   FORM      6.2
MULTNUM   FORM      2
MINFLD    FORM      2
MAXSCRN   FORM      2
MODE1     DIM       1
.NEXTFLAG  FORM      1
NMPNUMB   DIM       2                  * required by PATSRCH
NAME35    DIM       35
.
ONAME     DIM       30
OPERCODE  DIM       4
OTCHG1    FORM      6.2
OTCHG2    FORM      6.2
OTCODE    INIT      "OT"
OTCNOTIH  DIM       6
OTCNOTIT  DIM       6
OTDESC1   DIM       15
OTDESC2   DIM       15
OTDT1     DIM       8                  * Other Items
OTDT2     DIM       8
OTFLG     FORM      "0"
OPNFLAG   FORM      "0"                * used in stepdown
OPCNCONS  DIM       1
.
PCENFLG   FORM      1
PAGECNT   FORM      3
PSTROL    FILE      ASCII, FIXED=256
PREVTRID  DIM       24
.
RACLINDC  DIM       1
REGIST8   DIM       2
REPLY     FORM      1
REPORTNO  FORM      2
.
SELECTID  DIM       4
SERVDOCT  DIM       10
PMSBI001  DIM       4
SAVKEY12  DIM       12
SCDJULDY  FORM      4
SCDJULYR  FORM      2
SCNDGNAM  DIM       40
SAVADM    DIM       8
SAVBEND   FORM      3
SAVALLW   FORM      6.2
SAVDISC   FORM      6.2
SAVEXTRA  FORM      6.2
SMCHARGE  DIM       9
SMITMTYP  FORM      1
SMMSCGRP  DIM       3
SAVCENT   DIM       2
SAVFLAG   FORM      1
SAVDAT    DIM       6
SAVDAY    DIM       2
SAVITEM   DIM       4
SAVMAMT   FORM      6.2
SAVMON    DIM       2
SAVTYP    FORM      1
SAVYEAR   DIM       2
SDATE     DIM       8
SEC       FORM      5
SELFLG    FORM      "0"
SP14      INIT      "              "
SP22      INIT      "                      "
SP27      INIT      "                           "
SPECCODE  FORM      1
SPECDATE  DIM       8
SPLING    FORM      2
STRTDAT   DIM       6
STRTNAM   DIM       6
SURGFLG   FORM      "0"
.
TFFSAMNT  FORM      12.2
TAMTT     FORM      6.2
TAMTP     FORM      6.2
TEMPAMT   FORM      6.2
TFEEIND   FORM      1
THCFLG    FORM      2
THDUDT1   DIM       8
THDUDT2   DIM       8
THEACHG   FORM      6.2                * Theatre Fee
THEADTE   DIM       8
THFUND    FORM      6.2
TODAY     DIM       8
.
UPADMTYP  DIM       1
UNIQUE    FORM      8
UNIQUEX   DIM       8
USERID    DIM       10
VAR       DIM       127
WBSEUID   DIM       10
WARNINGL  DIM       20
WDATE1    DIM       8
WDATE2    DIM       8
WORK      FILE      ASCII, FIXED=256
.
XXADM     DIM       8
XXCENT    DIM       2
XXDAY     DIM       2
XXMON     DIM       2
XXMULT    FORM      2
XXNAM     DIM       22
XXYEAR    DIM       2
XAMT      FORM      4.2
XMBS      FORM      5
XAMTX     DIM       7
XMBSX     DIM       5
.
Z15       INIT      "zzzzzzzzzzzzzzz"
Z30       INIT      "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"
ZERO4     INIT      "0000"
ZTWO      FORM      "00"
.
SELECT    FORM       1  
PRINTED   INIT       "Discharge Invoice Printed    "
NOTPRINT  INIT       "Discharge Invoice Not Printed"
.
.         Web Variables (only the include files use these variables)
.
DAYFORMT  DIM       4
NJAN      INIT      "January"
NFEB      INIT      "February"
NMAR      INIT      "March"
NAPR      INIT      "April"
NMAY      INIT      "May"
NJUN      INIT      "June"
NJUL      INIT      "July"
NAUG      INIT      "August"
NSEP      INIT      "September"
NOCT      INIT      "October"
NNOV      INIT      "November"
NDEC      INIT      "December"
.
HTMLFILE  FIFO      ASCII, FIXED=250
MTHNAM3   DIM       3
MTHNAM3A  DIM       3
.
CFPAYCOD  DIM       3        * 3M Codefinder PAY Code
.
.
.         end web variables
.
PRGID     INIT      "IBAINP25"
PRGNAM    INIT      "Print Patient Invoices"
VERSION   INIT      "V12.00.04"
+
.******************************************************************************
.*                               ML0000                                       *
.*                          Mainline for Program                              *
.******************************************************************************
.
ML0000    CALL      INIT0000                * Initialisation
          BRANCH    EXIT,ML9999
.
ML0500    CALL      MENU0000                * Handle the Menu
REPEAT    BRANCH    OPTION,ML0500,ML2000,ML5000,ML8000,ML5000
          GOTO      ML9000
.
.>>>>>    Print Single Invoices by Admission or U/R Number <<<<<<    
.
ML2000    CALL      MAOU0000                * By admission or U/R ?
          BRANCH    SELECT,ML2100,ML2500
          GOTO      ML0500
.
.----- Single Invoice By Admission Number ------
.
ML2100    CALL      KADM0000                * Keyin the admission number
          BRANCH    EXIT,ML2000
.
          CALL      DSTA0000                * Display invoice status
.
          CALL      KDAT0000                * Keyin the date to invoice to
          BRANCH    EXIT,ML2100
.
          MOVE      AADMNO,KEY8
          MOVE      ZERO,DISPROG
          MOVE      ONE,NUMINVS
          MOVE      ZERO,PAGENO
          PACK      KEY8,AADMNO,SP8
          CALL      INVPRT
.
          GOTO      ML2000
.
.----- Single Invoice By U/R Number ------
.
ML2500    CALL      KURR0000
          BRANCH    EXIT,ML2000
.
ML2600    CALL      GADM0000                * Get the admission number to inv
          BRANCH    EXIT,ML2500
.
          CALL      KDAT0000
          BRANCH    EXIT,ML2600
.
          MOVE      AADMNO,KEY8
          CALL      RDVISA1
          MOVE      ZERO,DISPROG
          MOVE      ONE,NUMINVS
          MOVE      ZERO,PAGENO
          CALL      INVPRT
.
          GOTO      ML2600
.
.>>>>>    Print All Invoices   >>>>>>>
.
ML5000    MATCH     "IBARSH",PGM
          GOTO      ML6000 IF NOT EQUAL
          CALL      SELN0000                * Select id
.
ML6000    CALL      KDAT0000
          BRANCH    EXIT,ML0500
.
          IF        IBCNMHOS=1
            CALL      KHOS0000              * Keyin hospital id
          ENDIF
.
          CALL      DELO0000                * Delete Options
.
          CALL      AINV0000                * Extract all Invoices
.
          GOTO      ML0500
.
ML8000    MATCH     "IBARSH",PGM
          GOTO      ML0500 IF NOT EQUAL
.
          CALL      SELN0000                * Select id
          MOVE      SELECTID,PMSBI001
.
          CALL      PINV0000                * Print all Invoices
          GOTO      ML0500
.
ML9000    
.
ML9999    CHAIN     PGM
.
.******************************************************************************
.*                              INIT0000                                      *
.*                          Initialisation                                    *
.******************************************************************************
.
INIT0000  CALL      DISPHEAD
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          MOVE      ZERO,EXIT
          MOVE      ONE,BDTEFLAG            * Yes we are backdating Invoices
.
          CALL      IBACLOCK
          PACK      TODAY,CCENT,CYEAR,CMON,CDAY
          REP       " 0",TODAY
.
          DISPLAY   *P56:24,"Opening patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patmmbsf";
          OPEN      PATMMBS1,"patmmbsf"
.
          DISPLAY   *P64:24,"patdo1af";
          OPEN      PATDO1A1,"patdo1af"
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATDSCH2,"patdschf"
.
          DISPLAY   *P64:24,"patdtraf";
          OPEN      PATDTRA1,"patdtraf"
.
          DISPLAY   *P64:24,"pmsmtiaf";
          OPEN      PMSMTIA1,"pmsmtiaf"
.
          DISPLAY   *P64:24,"pmsbbiaf";
          OPEN      PMSBBIA1,"pmsbbiaf"
.
          DISPLAY   *P64:24,"pmsbisaf";
          OPEN      PMSBISA1,"pmsbisaf"
.
          DISPLAY   *P64:24,"patgtuaf"; 
          OPEN      PATGTUA1,"patgtuaf"
.
          DISPLAY   *P64:24,"patfinsf";
          OPEN      PATFINS1,"patfinsf"
.
          DISPLAY   *P64:24,"patgsrnf";
          OPEN      PATGSRN2,"patgsrnf"
          OPEN      PATGSRN3,"patgsrnf"
          OPEN      PATGSRN4,"patgsrnf"
.
          DISPLAY   *P64:24,"patinmaf";
          OPEN      PATINMA1,"patinmaf"
.
          DISPLAY   *P64:24,"patirnge";
          OPEN      PATIRNG1,"patirnge"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
          DISPLAY   *P64:24,"patmx1af";
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY   *P64:24,"pmspx2af";
          OPEN      PMSPX2A1,"pmspx2af"
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMI1A2,"patmi1af"
.
          OPEN      PATMCHG1,"patmchgf"                 * MLMLML      *I-268832
          OPEN      PATFN1A1,"patfn1af"                 * MLMLML      *I-268832
.
          DISPLAY   *P64:24,"patnobef";
          OPEN      PATNOBE1,"patnobef"
.
          DISPLAY   *P64:24,"patpramf";
          OPEN      PATPR1A1,"patpr1af"
          OPEN      PATPX1A1,"patpx1af"
.
          DISPLAY   *P64:24,"pattranf";
          OPEN      PATTRAN1,"pattranf"
          OPEN      PATTRAN2,"pattranf"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
.
          DISPLAY   *P64:24,"patwr1af";
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PATWR1A4,"patwr1af"
.
          DISPLAY   *P64:24,"pmsvx1af";
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"nzpirnaf";
          OPEN      NZPIRNA1,"nzpirnaf"
          OPEN      NZPIRNA2,"nzpirnaf"
.
          DISPLAY   *P64:24,"nzpbfeaf";
          OPEN      NZPBFEA1,"nzpbfeaf"
.         
          DISPLAY   *P64:24,"nzpcfnaf"
          OPEN      NZPCFNA1,"nzpcfnaf"
.         
          DISPLAY   *P64:24,"nzpcmtaf"
          OPEN      NZPCMTA1,"nzpcmtaf"
          OPEN      NZPCMTA2,"nzpcmtaf"
          OPEN      NZPCMTA3,"nzpcmtaf"
.         
          DISPLAY   *P64:24,"nzpfigaf"
          OPEN      NZPFIGA1,"nzpfigaf"
          OPEN      NZPFIGA2,"nzpfigaf"
.         
          DISPLAY   *P64:24,"nzpfinaf"
          OPEN      NZPFINA1,"nzpfinaf"
          OPEN      NZPFINA2,"nzpfinaf"
.
          DISPLAY   *P64:24,"nzpibraf"
          OPEN      NZPIBRA1,"nzpibraf"
.
          DISPLAY   *P64:24,"nzpmchaf"
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      NZPMCHA2,"nzpmchaf"
.
          DISPLAY   *P64:24,"nzppicaf"
          OPEN      NZPPICA1,"nzppicaf"
          OPEN      NZPPICA2,"nzppicaf"
.
          DISPLAY   *P64:24,"nzprbraf"
          OPEN      NZPRBRA1,"nzprbraf"
.
          DISPLAY   *P64:24,"nzprfnaf"
          OPEN      NZPRFNA1,"nzprfnaf"
          OPEN      NZPRFNA2,"nzprfnaf"
.
          DISPLAY   *P64:24,"nzppfeaf"
          OPEN      NZPPFEA1,"nzppfeaf"
.
          DISPLAY   *P64:24,"nzpspraf"
          OPEN      NZPSPRA1,"nzpspraf"
          OPEN      NZPSPRA2,"nzpspraf"
.
          DISPLAY   *P64:24,"nzptfeaf"
          OPEN      NZPTFEA1,"nzptfeaf"
          OPEN      NZPTFEA2,"nzptfeaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA1,"oprdetaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA2,"oprdetaf"
.
          DISPLAY   *P64:24,"oprsesaf"
          OPEN      OPRSESA1,"oprsesaf"
.
          DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"
.
          OPEN      PATRE1A1,"patre1af"
.
          DISPLAY   *P64:24,"oprardaf";
          OPEN      OPRARDA1,"oprardaf"
.
          CALL      DISPHEAD
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMER
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMET
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEW
.
...  used in PATCATBI CRMV0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEX
.
...  used in PATCATBI PTMP0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEZ
.
...  used in PATCATBI PT2P0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEY
.
...  used in PABXBILL
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAME
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAM2
.
.         Read in parameters
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS:
                                  *85,IBCNUGST
          READ      CONTROLF,TEN;*32,PTCNUBRD,*66,CINVLAY,*79,CAPPRVNO:
                                 *94,CAGECOFF,*104,PTCNMBSF:           *C-47385
                                 *166,CMEMB:
                                *183,CVIEWIP,*188,CCHKRAT,*192,CACCFEE:
                                *217,CAUDQ
          READ      CONTROLF,TEN3;CHADD1,CHADD2,CHPOST,CHPADD1,CHPADD2,CHPPOST:
                                  CHTELEB,*154,CUSEMBS,*163,BEDTYP:
                             *211,CINV1ST,*245,CHOSTYP
          READ      CONTROLF,TEN4;CNOCLMS,CINMES1,CINMES2:
                             *228,CINVFF,*245,CMAXINV
          READ      CONTROLF,TEN5;*247,CSTDOWN
          READ      CONTROLF,TEN8;*206,CFINAN
          READ      CONTROLF,TEN9;*212,CFEETYP,*216,CINVRIP
          READ      CONTROLF,TWENTY;*193,PTCNDCLM:
                                    *198,PTCNPIOP,PTCNBCUT,PTCNBDOM:
                                    *211,PTCNCNDY,*239,PTCNMXCH
          READ      CONTROLF,TWENTY1;*51,PTCNINVL,*60,PTCNCCRR,PTCNCLOR:
                                    *120,PTCNADDC,*136,PTCNMITM,*138,PTCNNHII:
                                    *174,PTCNDONR,*178,PTCNMPTR:
                                    *190,PTCNPCON,*200,PTCNICRA,*235,PTCNDPL8:
                                    *237,PTCNPAOF
          READ      CONTROLF,THIRTY;*132,HSTANDM,HINVDES
          READ      CONTROLF,TWENTY;*164,PTRESDAY
          READ      CONTROLF,FIFTY9;*1,CDLSTEP,*23,CFUTINV,*25,CFUTCOM:
                                   *66,CGSTPERC,CGSTITEM
          READ      CONTROLF,SEVENTY9;*248,PTCNIPEN
          READ      CONTROLF,SEVENTY9;*68,PTCNMFEE,PTCNJFEE
          READ      CONTROLF,EIGHTY;*248,PTCNPEFR
          READ      CONTROLF,EIGHTY8;*86,CC,YY,MM,DD
          READ      CONTROLF,NINTY8;*127,PTCNPMIS,*136,PTCNPAIH:
                                    *142,PTCNPAIT,*148,PTCNINVB
          READ      CONTROLF,HUND03;*220,PTCNDEES,*221,PTCNDDES
          READ      CONTROLF,HUND05;*130,PTCNAUAT:    * auto update adm.type
                                         PTCNWSPC:    * Warning for sub-seq item
                                    *177,PTCNTFEE:    * Using theatre fees
                                    *190,PTSGCOPT:    * Using suggested class.
                                    *195,PTCNLASR
          READ      CONTROLF,HUND30;*1,PTCNHABN
          CLOSE     CONTROLF
.
          MATCH     SP3,PTCNDCLM
          GOTO      INIT0200 IF NOT EQUAL
          MOVE      "0  ",PTCNDCLM
          MOVE      ONE,NUMINVS
.
INIT0200  MOVE      ZERO TO DISPROG
          MOVE      ZERO TO BEQPROG        * Not the billing enquiry program
          MATCH     "IBARSH",PGM
          GOTO      INIT0210 IF EQUAL
. 
          CALL      SELPRINT
          MOVE      CPRTFLG,SPLING          * Save the spooling flag
.
INIT0210  
.         Check for the Rate Change Audit file if the system parameter is
.         switched on (0)
.
          BRANCH    CAUDQ,INIT9000
.
          OPEN      PATRCAUD,"patrcaud"
          CALL      RDSRCA
          CLOSE     PATRCAUD
.
          COMPARE   ZERO,OVRCD
          GOTO      INIT9000 IF EQUAL
.
          KEYIN     *P1:24,*EL,*B,*V2LON:
                    "Sector ZERO in Rate Change Audit file is not set up.  ":
                    *V2LON," CALL I.B.A. NOW ",ANS;
          GOTO      INIT9500
.
INIT9000  MOVE      ZERO,EXIT
          GOTO      INIT9999
.
INIT9500  MOVE      ONE,EXIT
INIT9999  RETURN                
.
.******************************************************************************
.*                               MENU0000                                     *
.*                          Main Program Menu                                 *
.******************************************************************************
.
MENU0000  HLINE     *G37,2,51,80
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,ONE,*HOFF," = Line-up Print":
                    *P1:6,*V2LON,TWO,*HOFF," = Print a single Invoice":         
                    *P1:7,*V2LON,THREE,*HOFF," = Generate all Invoices":
                    *P1:8,*V2LON,FOUR,*HOFF," = Print all Invoices":
                    *P1:10,"Select Option : ";
.
MENU1000  KEYIN     *P17:10,*EL,*V2LON,OPTION;
.
          COMPARE   ZERO,OPTION
          GOTO      MENU9999 IF EQUAL
.
          BRANCH    OPTION,MENU1100,MENU1200,MENU1300,MENU1400
          BEEP
          GOTO      MENU1000
.
MENU1100  DISPLAY   *P51:2,*V2LON,"- Line-up Print "
          GOTO      MENU9999
MENU1200  DISPLAY   *P51:2,*V2LON,"- Single Invoice "
          GOTO      MENU9999
MENU1300  DISPLAY   *P51:2,*V2LON,"- Print All Invoices "
          GOTO      MENU9999
MENU1400  DISPLAY   *P51:2,*V2LON,"- Print All Invoices "
.
MENU9999  RETURN
.
.******************************************************************************
.*                               MAOU0000                                     *
.*                          Menu by admission or U/R                          *
.******************************************************************************
.
MAOU0000  HLINE     *G37,2,72,80
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,ONE,*HOFF," = By Admission Number":
                    *P1:6,*V2LON,TWO,*HOFF," = By U/R Number ":                 
                    *P1:8,"Select Option : " 
.
MAOU1000  KEYIN     *P17:8,*EL,*V2LON,SELECT 
.
          COMPARE   ZERO,SELECT
          GOTO      MENU9999 IF EQUAL
.
          BRANCH    SELECT,MAOU1100,MAOU1200
          BEEP
          GOTO      MAOU1000
.
MAOU1100  DISPLAY   *P69:2,*V2LON," by Adm no"
          GOTO      MAOU9999

MAOU1200  DISPLAY   *P69:2,*V2LON," by U/R No"
MAOU9999  RETURN
.
.
.*****************************************************************************
.*                              DSTA0000                                     *
.*                     Display invoice status                                *
.*****************************************************************************
.
DSTA0000
          MOVE      SP30,DIM30
          UNPACK    ALACDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          DISPLAY   *P1:8,"Invoiced To : ",*V2LON,CPCDATE,*HOFF,SP5,DIM30
          
DSTA9999  RETURN
.
.*****************************************************************************
.*                              KADM0000                                     *
.*                     Keyin the Admission Number                            *
.*****************************************************************************
KADM0000  MOVE      ZERO,SPECCODE
          MOVE      ZERO,EXIT
.
          KEYIN     *P1:4,*EF,"Admission  : ",*EL,*V2LON,AADMNO;
          MATCH     ZEROVISN,AADMNO
          GOTO      KADM9000 IF EQUAL
.
          MOVE      AADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF KADM8000
          CALL      RDVISA1
          BRANCH    OVRCD OF KADM8000
.
          PACK      DIM8,ADATE
          REP       " 0",DIM8
          MATCH     DIM8,TODAY
          IF        @EQUAL
            DISPLAY   *P1:24,*EL,*B,"Patient was admitted today. ";
            CALL      HITENTER
            GOTO      KADM0000
          ENDIF
.
          MOVE      SP8,DDATE
          MOVE      AADMNO,KEY8
          CALL      RDDSCH1
          MOVE      OVRCD,DISFLG
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          IF        OVRCD = 1
            DISPLAY   *P1:24,*B,*EL,"Patient PMI details missing. ";
            CALL      HITENTER
            GOTO      KADM0000
          ENDIF
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD = 1
            DISPLAY   *P1:24,*B,*EL,"Patient PMI details missing. ";
            CALL      HITENTER
            GOTO      KADM0000
          ENDIF
.
. If Using the Invoice Pending File
.
          IF        PTCNIPEN = 0
            OPEN      PATIPEN1,"patipenf"
            MOVE      AADMNO,KEY8
            CALL      RDIPEN1
            IF        OVRCD = 1
           DISPLAY   *P1:24,*B,*EL,"Patient does not have an Invoice pending. ";
              CALL      HITENTER
              GOTO      KADM0000
            ENDIF
          ENDIF
.
          CALL      PATHEAD
          GOTO      KADM9999
.
KADM8000  DISPLAY   *P1:24,*EL,*B:
                    "Admission Number does not exist. ";
          CALL      HITENTER
          GOTO      KADM0000
.
KADM9000  MOVE      ONE,EXIT
.
KADM9999  RETURN
.
.*****************************************************************************
.*                                 KURR0000                                  *
.*                        Keyin the U/R Number                               *
.*****************************************************************************
.
KURR0000  MOVE      TWENTY3,COL
          MOVE      ZERO TO SPECCODE
.
KURR1000  DISPLAY   *P1:4,*EF,"U/R Number : ";
.
          MOVE      TEN4,CCOL
          MOVE      FOUR,CVERT
          MOVE      TWO,SRCHOPT
          MOVE      ZERO,SRCHSYS
          MOVE      ZERO,EXIT
.
          OPEN      CONTROLF,"controlf"
          CALL      KURN
          CLOSE     CONTROLF
.
          BRANCH    EXIT,KURR9000
          BRANCH    OVRCD,KURR8500
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          BRANCH    OVRCD,KURR8500
.
          CALL      PMIHEAD
          GOTO      KURR9999
.
KURR8500  DISPLAY   *P1:24,*EL,*B,*V2LON:
                    "** U/R Number does not exist **    ";
          CALL      HITENTER
          GOTO      KURR1000
.
KURR9000  MOVE      ONE,EXIT
.
KURR9999  RETURN
.
.*****************************************************************************
.*                              KDAT0000                                     *
.*                        Keyin the date to invoice to                       *
.*****************************************************************************
.
KDAT0000  MOVE      ZERO,EXIT 
          IF        OPTION = 2
            IF        SELECT = 1
              MOVE      TEN,CVERT
            ELSE
              MOVE      EIGHT,CVERT
            ENDIF
          ELSE
            MOVE      FOUR,CVERT
          ENDIF
          DISPLAY   *P1:CVERT,*EF,"Invoice Date :"
          MOVE      CURRDATE,TODAY
.
KDAT1000  MOVE      TEN6,CCOL
          MOVE      CCC,CCENT
          UNPACK    SP6,CYEAR,CMON,CDAY
.
          MOVE      ONE,CCANLDTE
          MOVE      ZERO,CHIGHLT
.
          CALL      KEYDATE
          BRANCH    OVRCD,KDAT9000
.
          PACK     SPECDATE,CCENT,CYEAR,CMON,CDAY
          REP      " 0",SPECDATE
.
          MATCH    TODAY,SPECDATE
          IF       !@LESS
            DISPLAY  *P1:24,*B,*EL,"Date must be less than the current date. ";
            CALL     HITENTER
            GOTO     KDAT9000
          ENDIF
.
          IF       OPTION = 2
            PACK     DIM8,ADATE
            REP      " 0",DIM8
            MATCH    DIM8,SPECDATE
            IF       @LESS
              DISPLAY  *P1:24,*B,*EL,"Patient was admitted after this":
                       " date. ";
              CALL     HITENTER
              GOTO     KDAT9000
            ENDIF
            UNPACK   SPECDATE,DIM8
            MATCH    ALACDTE,DIM8
            IF       @LESS
              DISPLAY  *P1:24,*B,*EL,"Patient has already been invoiced for":
                                     " this date. ";
              CALL     HITENTER
              GOTO     KDAT9000
            ENDIF
          ENDIF
.
          UNPACK    SPECDATE,BACKDATE
          GOTO      KDAT9999
.
KDAT9000  MOVE      ONE,EXIT
KDAT9999  RETURN
.
.******************************************************************************
.*                           GADM0000                                         *
.*                   Get the patient admission                                *
.******************************************************************************
.
GADM0000  MOVE      ZERO,EXIT
          MOVE      EIGHT,CVERT
          
          DISPLAY   *P1:5,SP20,SP5
          DISPLAY   *P1:6,*EF:
                    *P4:7,*V2LON,*ULON,"Admission":
                    *P14:7,"Adm. Date",*P25:7,"Disch. Date":
                    *P37:7,"Invoiced To"
.
          MOVE      PURNO,PVIURNO
          MOVE      ZERO,COUNTER
          MOVE      ZERO,NEXTFLAG
          PACK      KEY24 WITH PVIURNO,Z30 
          CALL      RDSVISA2

GADM1000  CALL      RDPVISA2
          BRANCH    OVRCD,GADM5000
.
          MATCH     PURNO,PVIURNO
          GOTO      GADM5000 IF NOT EQUAL
.
          COMPARE   THREE,PVITYPE
          GOTO      GADM1000 IF NOT EQUAL
.
          MOVE      PVIBILL,AADMNO
          MOVE      AADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,GADM1000      
.
          BRANCH    ASTAT OF GADM1000,GADM2000,GADM2000,GADM2000,GADM1000
.
GADM2000
.
          UNPACK    SP30,ADMNDATE,DISCDATE,LINVDATE
          MOVE      SP8,DDATE
          MOVE      AADMNO,KEY8
          CALL      RDDSCH1
          BRANCH    OVRCD,GADM3000
.
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,DISCDATE
.
GADM3000  UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,ADMNDATE
.
          MOVE      SP30,DIM30
          PACK      ALACDTE,ALACDTE,SP8
          MATCH     SP8,ALACDTE
          GOTO      GADM3100 IF EQUAL
.
          UNPACK    ALACDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,LINVDATE
.
          MOVE      SP30,DIM30
.
GADM3100  ADD       ONE,COUNTER
          IF        COUNTER = 14
            MOVE      ONE,NEXTFLAG
            GOTO      GADM5000
          ENDIF
          DISPLAY   *P1:CVERT,*V2LON,COUNTER,*HOFF,DOT:
                    *P4:CVERT,AADMNO,*P14:CVERT,ADMNDATE,*P25:CVERT,DISCDATE:
                    *P38:CVERT,LINVDATE,*P49:CVERT,DIM30
.
          MOVE      AADMNO,ADMISSNO[COUNTER]
          ADD       ONE,CVERT
          GOTO      GADM1000
.
GADM5000  BRANCH    NEXTFLAG,GADM6000
          DISPLAY   *P1:24,"Select Item, (",*V2LON,ANSE,*HOFF,")xit ? ";
          MOVE      TWENTY3,CCOL
          GOTO      GADM7000
.
GADM6000  DISPLAY   *P1:24,"Select Item, (",*V2LON,ANSN,*HOFF,")ext, (":
                    *V2LON,ANSE,*HOFF,")xit ? ";
          MOVE      THIRTY1,CCOL

GADM7000  KEYIN     *PCCOL:24,*V2LON,*JR,DIM2
.
          TYPE      DIM2
          GOTO      GADM8000 IF EQUAL
.
          REP       UPPLOW,DIM2
          IF        NEXTFLAG = 0
            REP       "E2",DIM2
          ELSE
            REP       "N1E2",DIM2
          ENDIF
.
          TYPE      DIM2
          GOTO      GADM7500 IF EQUAL
          BEEP
          GOTO      GADM7000
.
GADM7500  MOVE      DIM2,FORM2
          IF        FORM2 = 1
            MOVE      ZERO,NEXTFLAG
            MOVE      ZERO,COUNTER
            MOVE      EIGHT,CVERT
            DISPLAY   *P1:8,*EF
          ENDIF
          BRANCH    FORM2,GADM3100,GADM9000
          GOTO      GADM7000
GADM8000  
          MOVE      DIM2,FORM2
          IF        FORM2 > COUNTER | FORM2 < 1
            BEEP
            GOTO      GADM7000
          ENDIF

          MOVE      ADMISSNO[FORM2],KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF GADM7000
.
          MOVE      SP8,DDATE
          CALL      RDDSCH1
          MOVE      OVRCD,DISFLG
.
. If Using the Invoice Pending File
.
          IF        PTCNIPEN = 0
            OPEN      PATIPEN1,"patipenf"
            MOVE      AADMNO,KEY8
            CALL      RDIPEN1
            IF        OVRCD = 1
           DISPLAY   *P1:24,*B,*EL,"Patient does not have an Invoice pending. ";
              CALL      HITENTER
              GOTO      GADM5000
            ENDIF
          ENDIF
.
          MOVE      AADMNO,SAVKEY8
.
          CALL      PATHEAD                          
          GOTO      GADM9999
.
GADM9000  MOVE      ONE,EXIT
.
GADM9999  RETURN
.
.*****************************************************************************
.*                            AINV0000                                       *
.*                  Print all invoices as specified date                     *
.*****************************************************************************
.
AINV0000  MATCH     "IBARSH",PGM
          GOTO      AINV0500 IF EQUAL
.
          DISPLAY   *P51:2,*V2LON,"- Print all Invoices ",*P1:3,*EF;
.
          CALL      OPNPRINT
          MOVE      THREE,CPRTFLG    * Allow all receipts to be spooled together
.
AINV0500  MOVE      SP8,DDATE
          MOVE      ONE,DISFLG
          PACK      KEY9 WITH TWO,SP8
          CALL      RDSMISS2
.
AINV1000  CALL      RDKMISS2
          BRANCH    OVRCD OF AINV9000
.
          BRANCH    ASTAT OF AINV1000,AINV2000,AINV2000,AINV2000,AINV9000
.
AINV2000  DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ",*V2LON,AADMNO;
.         
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,AINV1000
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          BRANCH    OVRCD,AINV1000
.
          MOVE      SP10,PMVXPICD
          MOVE      SP10,PMVXMHOS
          MOVE      AADMNO,KEY8
          CALL      RDPMVX11
.
          IF        IBCNMHOS=1
            MATCH     SP10,HOSPID  
            IF        !@EQUAL
              MATCH     PMVXMHOS,HOSPID  
              GOTO      AINV1000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MOVE      ZERO,IPASS
          MOVE      AADMNO,KEY8
          MOVE      SP8,DDATE
          MOVE      ZERO,DISFLG
          CALL      RDDSCH1
          MOVE      OVRCD,DISFLG
.
          IF        OVRCD=0
            MOVE      DDATE,DIM8
            REP       " 0",DIM8
            MATCH     DIM8,SPECDATE
            GOTO      AINV1000 IF LESS      * Discharged after the date
          ENDIF
.
. If Using the Invoice Pending File
.
          IF        PTCNIPEN = 0
            OPEN      PATIPEN1,"patipenf"
            MOVE      AADMNO,KEY8
            CALL      RDIPEN1
            BRANCH    OVRCD,AINV1000
          ENDIF
.
          PACK     DIM8,ADATE
          REP      " 0",DIM8
          MATCH    DIM8,SPECDATE
          GOTO     AINV1000 IF LESS         * Patient was not admitted on date. 
.
          UNPACK   SPECDATE,DIM8
          MATCH    ALACDTE,DIM8
          GOTO     AINV1000 IF LESS         * Patient has already been invoiced
.
AINV5000  MOVE      AADMNO,KEY8
          MOVE      ZERO,DISPROG
          MOVE      ONE,NUMINVS
.
          MATCH     "IBARSH",PGM
          GOTO      AINV6000 IF NOT EQUAL
          MOVE      ONE,WEBFLAG
          MOVE      ONE,PROGFLAG
          CALL      CALCTBI
          COMPARE   ZERO,GROSSTOT
          GOTO      AINV1000 IF EQUAL
.
          MOVE      SELECTID,PMBBSEID
          MOVE      AADMNO,PMBBVISN
          MOVE      AURNO,PMBBURNO
          MOVE      ADATE,PMBBADDT
          MOVE      ALACDTE,PMBBIFDT
          MOVE      BACKDATE,PMBBITDT
          MOVE      NETTOT,PMBBAMNT
          MOVE      PMVXPICD,PMBBPDRG
.
          MOVE      ZERO,PMBBCFLG
          MATCH     ACODDTE,SP8
          IF        !@EQUAL
            MOVE      ONE,PMBBCFLG
          ENDIF
          MOVE      ZERO,PMBBPRNT
          MOVE      AWARD,PMBBWARD
....      MOVE      AMBS,PMBBAMBS
          MOVE      ATYPE,PMBBAMBS
          MOVE      ACARE,PMBBCARE
          PACK      PMBBSPAR,SP70
          MOVE      ZERO,PMBBSTAT          * delete status indicator
.
          PACK      KEY12,SELECTID,AADMNO,SP70
          CALL      RAPMBBI1
          IF        OVRCD=1
            CALL      WRPMBBI1
          ENDIF
.
          GOTO      AINV1000
.
AINV6000  IF        CVIEWIP = 2
            MOVE      ONE,PROGFLAG
            CALL      CALCTBI
            COMPARE   ZERO,GROSSTOT
            GOTO      AINV1000 IF EQUAL
            CALL      PATHEAD
            CALL      PRNTINV0 
            GOTO      AINV1000
          ENDIF 
          IF        CVIEWIP = 3
            MOVE      ONE,PROGFLAG          * check the outstanding amount
            CALL      CALCTBI
            COMPARE   ZERO,GROSSTOT
            GOTO      AINV1000 IF EQUAL     * zero outstanding amount
          ENDIF
          CALL      PATHEAD
          MOVE      ZERO,PAGENO
          MOVE      AADMNO,KEY8
          CALL      INVPRT
          BRANCH    CEXIT,AINV1000,AINV1000,AINV9000
          GOTO      AINV1000
.
AINV8000  PACK      KEY9 WITH FOUR,SP8
          CALL      RDSMISS2
          GOTO      AINV1000
.
AINV9000  MATCH     "IBARSH",PGM
          GOTO      AINV9999 IF EQUAL
.
          DISPLAY   *P1:24,*EL,*V2LON,"***  Generation Completed  ***";
          MOVE      SPLING,CPRTFLG       * Restore the original setting
          CALL      CLSPRINT
.
AINV9999  RETURN            
.
.*****************************************************************************
.*                            PINV0000                                       *
.*                  Print all invoices as specified date                     *
.*****************************************************************************
.
PINV0000  DISPLAY   *P51:2,*V2LON,"- Print all Invoices ",*P1:3,*EF;
.
          CALL      OPNPRINT
          MOVE      THREE,CPRTFLG    * Allow all invoices to be spooled together
          MOVE      ONE,BDTEFLAG
          MOVE      ONE,WEBFLAG
.
          PACK      KEY12,PMSBI001,SP70
          CALL      RSPMBBI1
PINV2000  CALL      RKPMBBI1                  * read invoice from temporary list
          BRANCH    OVRCD,PINV9000
.
          MATCH     PMSBI001,PMBBSEID
          GOTO      PINV9000 IF NOT EQUAL
.
          MATCH     "1",PMBBSTAT              * Exclude invoice
          GOTO      PINV2000 IF EQUAL
.
          MATCH     "1",PMBBPRNT              * Printed invoice
          GOTO      PINV2000 IF EQUAL
.
          MOVE      ONE,DISFLG
          PACK      KEY8,PMBBVISN,SP8
          CALL      RDMISS1
          BRANCH    OVRCD,PINV2000
          MATCH     ANSY,PTMICMXP
          GOTO      PINV3000 IF NOT EQUAL         * not Casepayment
          COMPARE   THREE,ASTAT
          GOTO      PINV2000 IF NOT EQUAL         * not discharge
.
PINV3000  MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,PINV2000
.
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ",*V2LON,AADMNO;
.
          MOVE      AADMNO,KEY8
          CALL      RDPMVX11
          BRANCH    OVRCD,PINV2000
.
.         Check clinical document if invoice can be raised ?
.
          CALL      CHKDCI00  
          BRANCH    EXIT,PINV2000
.
          MOVE      AADMNO,KEY8
          MOVE      SP8,DDATE
          MOVE      ZERO,DISFLG
          CALL      RDDSCH1
          MOVE      OVRCD,DISFLG
.
          MOVE      ZERO,DISPROG
          MOVE      ONE,NUMINVS
          MOVE      PMBBITDT,BACKDATE         * 'Invoice to' Date
          MOVE      THREE,PROGFLAG
.
      DISPLAY    *N;
      DISPLAY    *N;
      CLOCK     TIME,CTIMEIS
      DISPLAY    *R,"XXXXXXX PRINT INV.FOR ",AADMNO," TIME ",CTIMEIS," XXXXXXXXXXX"
      DISPLAY    *N;
      DISPLAY    *N;
.
          CALL      PRNTINV0 
.
      DISPLAY    *N;
      DISPLAY    *N;
      CLOCK     TIME,CTIMEIS
      DISPLAY    *R,"ZZZZZZZ FINISHED  FOR ",AADMNO," TIME ",CTIMEIS," ZZZZZZZZZZZ"
      DISPLAY    *N;
      DISPLAY    *N;
.
          MOVE      ONE,PMBBPRNT
          CALL      UPPMBBI1
          GOTO      PINV2000
.
PINV9000  DISPLAY   *P1:24,*EL,*V2LON,"***  Generation Completed  ***";
          CALL      CLSPRINT
.
PINV9999  RETURN            
+
.------------------------------------------------------------------------------
. Check Claim Type/Clinical Document Mapping table to determine if the
. Invoice can be raised for Inpatient
.------------------------------------------------------------------------------
CHKDCI00  MOVE      AURNO,INDMURNO
          MOVE      AADMNO,INDMADNO
.
          MOVE      SP70,INDMHOSP
          IF        IBCNMHOS=1
            MOVE      PMVXMHOS,INDMHOSP
          ENDIF
          MOVE      ACLAIM,INDMCLAM
          MOVE      "I",INDMSYST
          MOVE      ACARE,INDMCTYP
          MOVE      PMVXIDUS,INDMILOS
.
          PROC      CHKCLDCP
CHKDCI99  RETURN
+
.**********************************************************************
.*                            SELN0000                                *
.*                 Get Selection ID for printing                      *
.**********************************************************************
.
SELN0000  DISPLAY   *P1:3,*EF:
                    *P1:7,*V2LON,"Enter Selection ID :"
.
SELN1000  KEYIN     *P22:7,*DV,UNDLN1,*P22:7,*V2LON,SELECTID;
.
          MATCH     SP70,SELECTID
          GOTO      SELN9000 IF EQUAL
.
          PACK      KEY4,SELECTID,SP70
          CALL      RDPMBIS1
          COMPARE   ZERO,OVRCD
          GOTO      SELN2000 IF EQUAL
          BEEP
          GOTO      SELN1000
.
SELN2000  MOVE      ZERO,EXIT
          GOTO      SELN9999
.
SELN9000  MOVE      ONE,EXIT
.
SELN9999  RETURN
+
.==============================================================================
.         Keyin hospital ID
.==============================================================================
KHOS0000  MOVE       SP10,PTHSHOSP
          MOVE       SP10,HOSPID
          DISPLAY    *P1:20,*EL,"Hospital Id : ";
          MOVE       TEN5,ECOL
          MOVE       "20",EVERT
          MOVE       SP3,CKYIDEF3
          MOVE       ZERO,CKYIMAND           * Not Mandatory
          OPEN       PATHSPA1,"pathspaf"
.
          CALL       PATHSPKY
          BRANCH     EXIT,KHOS2000,KHOS9999
          MOVE       PTHSHOSP,HOSPID
          GOTO       KHOS3000
.
KHOS2000  MOVE       "All Hospitals",PTHSNAME
          MOVE       SP10,HOSPID
.
KHOS3000  DISPLAY    *P23:23,*V2LON,PTHSNAME;
KHOS9999  RETURN
+
.**********************************************************************
.*                            DELO0000                                *
.*  Remove all selected patients from selection file for web          *
.**********************************************************************
DELO0000  PACK      KEY12,SELECTID,SP70
          CALL      RSPMBBI1
          CALL      RKPMBBI1
          BRANCH    OVRCD,DELO9999
.
          MATCH     SELECTID,PMBBSEID
          GOTO      DELO9999 IF NOT EQUAL
.
          PACK      KEY12,PMBBSEID,PMBBVISN,SP70
          CALL      DEPMBBI1
          GOTO      DELO0000
.
DELO9999  RETURN
.
.**********************************************************************
.       Display the top screen after the question mark option
.**********************************************************************
DISPB     DISPLAY   *P1:4,*EF,"U/R Number: ",*V2LON,PURNO,*HOFF:
                    *P20:4,"   Name : ",*V2LON,PNAME,*HOFF:
                    *P1:5,"Admission : ",*V2LON,AADMNO,*HOFF;
.
SBDY0000
.
ADDWRN00
OPEN0000
CLOS0000
WEBERR00
GETSVAR   RETURN
.
REDISPS   DISPLAY   *P1:4,*EF,"U/R Number : ";
          RETURN
+
.
RDADMB1   RETURN    *** NEEDED IN INVT5      *** SAVE SPACE
+
.-------------------------------------------------
. Format Doctors Given Name
.-------------------------------------------------
DOCGIV00  CMATCH    SP1,NAME35               * Remove Leading Blanks
          IF        @EQUAL
            BUMP      NAME35
            GOTO      DOCGIV00 IF NOT EOS
            GOTO      DOCGIV99               * entire name if blank
          ENDIF
          PACK      KEY35,NAME35,SP30        * reset form pointer
          MOVE      KEY35,NAME35
.
          SCAN      SP1,NAME35             * Locate the blank
          GOTO      DOCGIV20 IF NOT EQUAL
          BUMP      NAME35,-1              * go back 1 to end of name
          MOVEFPTR  NAME35,CCITEM          * another handly form field
          RESET     NAME35                 * reset the form pointer
          SETLPTR   NAME35,CCITEM          * set logical length to end of name
.
.         Save this name
.
          UNPACK    NAME35,KEY1,KEY50
          REP       DOWNCASE,KEY50
          APPEND    KEY1,DISPNAME
          STRIP     KEY50
          APPEND    KEY50,DISPNAME
          APPEND    SP1,DISPNAME
.
.         Check for any more names
.
          SETLPTR   NAME35,35              * reset logical length
          ADD       ONE,CCITEM             * position of 1st blank
          RESET     NAME35,CCITEM          * reset to this point
          PACK      KEY35,NAME35,SP70      * reset form pointer
          MOVE      KEY35,NAME35

DOCGIV10  CMATCH    SP1,NAME35               * Remove Leading Blanks
          IF        @EQUAL
            BUMP      NAME35
            GOTO      DOCGIV10 IF NOT EOS
            GOTO      DOCGIV99               * entire name if blank
          ENDIF
          PACK      KEY35,NAME35,SP30        * reset form pointer
          MOVE      KEY35,NAME35
.
          SCAN      SP1,NAME35             * Locate the blank
          GOTO      DOCGIV20 IF NOT EQUAL
          BUMP      NAME35,-1              * go back 1 to end of name
          MOVEFPTR  NAME35,CCITEM          * another handly form field
          RESET     NAME35                 * reset the form pointer
          SETLPTR   NAME35,CCITEM          * set logical length to end of name
.
.         Save this Initial
.
          UNPACK    NAME35,KEY1,KEY50
          APPEND    KEY1,DISPNAME
          APPEND    SP1,DISPNAME
.
          GOTO      DOCGIV99
.
.         Rest of the string is one name
.
DOCGIV20  UNPACK    NAME35,KEY1,KEY50
          REP       DOWNCASE,KEY50
          APPEND    KEY1,DISPNAME
          STRIP     KEY50
          APPEND    KEY50,DISPNAME
          APPEND    SP1,DISPNAME
.
DOCGIV99  RETURN
+
.------------------------------------------------------------
. Procedure to get Doctor Code from Outpatient Clinic ID
. COPTION - 1 Return DOCTCODE
.           2 Output Location
.           3 (N/A)
.           4 Output Menu Type
.           5 Output Unit
.------------------------------------------------------------
          DEFPROC  OUTDET00
.
          INC      OUTPREFD/INC
          INC      OUTCLIFD/INC
          INC      OUTBOAFD/INC
          INC      OUTMA1FD/INC
          INC      OUTBB1FD/INC
.
KEYBOA    DIM      28
KEYCLI    DIM      20
TESTSITE  DIM      6
TESTCLIN  DIM      6
.
          MOVE     SP70,DOCTCODE
          COMPARE  ZERO,PVITYPE
          GOTO     OUTDET50 IF EQUAL
.
          PACK     KEY6,PVISITE,SP70
          CALL     RDSITA1
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYCLI,PVISITE,PVIDOCT,PVIDATE,SP70
          BRANCH   COPTION,OUTDET60
.
          PACK     KEY8,OSTFILE,FILBOKA1 * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTBOKA1,KEY8         * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYBOA,PVISITE,PVIDOCT,PVIDATE,SP70
          PACK     KEY28,PVISITE,PVIDOCT,PVIDATE,SP70
          PACK     KEY20,PVISITE,PVIDOCT,PVIDATE,SP70
          CALL     RDSBOKA1
OUTDET10  CALL     RDKBOKA1
          BRANCH   OVRCD,OUTDET95
          PACK     KEYBOA,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          MATCH    KEY20,KEYBOA
          GOTO     OUTDET95 IF NOT EQUAL
          MATCH    OBAOUTNO,PVIBILL         * Set up billing number
          GOTO     OUTDET10 IF NOT EQUAL
          GOTO     OUTDET80
.
OUTDET50  MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     OUTPREA1,"outpreaf"   * Pre Attendance File
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
          MOVE     ADMISSNO[FORM2],KEY8
          CALL     RDPREA1               * Check for Pre-Attendance
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEY6,OPRSITE,SP70
          CALL     RDSITA1
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYCLI,OPRSITE,OPRCLIN,OPRDATE,SP70
          PACK     KEYBOA,OPRSITE,OPRCLIN,OPRDATE,OPRSTRT,OPRSLOT
.
          BRANCH   COPTION,OUTDET60,OUTDET70,OUTDET70,OUTDET70
.
OUTDET60  MOVE     ZERO,OVRCD
          PACK     KEY8,OSTFILE,FILCLIA1 * Determine Doctor from Clinic ID
          TRAP     OVERCOND IF IO
          OPEN     OUTCLIA1,KEY8         * Clinic Details
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK      KEY20,KEYCLI,SP70
          CALL      RDCLIA1
          IF        OVRCD=1
            PACK      KEY20,KEYCLI,Z70
            CALL      RDSCLIA1          * Read Clinic Record
            CALL      RDPCLIA1          * Read Clinic Record
            BRANCH    OVRCD,OUTDET95
.
            UNPACK    KEYCLI,TESTSITE,TESTCLIN
.
            MATCH     TESTSITE,OCASITE
            GOTO      OUTDET95 IF NOT EQUAL
.
            MATCH     TESTCLIN,OCACLIN
            GOTO      OUTDET95 IF NOT EQUAL
          ENDIF
.
          MOVE     OCADOCT,DOCTCODE
          MATCH    SP70,DOCTCODE
          IF       @EQUAL
            MOVE     OCACCONS,DOCTCODE
          ENDIF
          MOVE     ZERO,EXIT
          GOTO     OUTDET99
.
OUTDET70  PACK     KEY8,OSTFILE,FILBOKA1 * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTBOKA1,KEY8         * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          MOVE     KEYBOA,KEY28
          CALL     RDBOKA1
          BRANCH   OVRCD,OUTDET95
.
OUTDET80  IF       COPTION=4
            PACK     MENUTYPE,TWO,OBASTAT * Outpatient Booking
            MOVE     ZERO,EXIT
            GOTO     OUTDET99
          ENDIF
.
          IF       COPTION=5
            PACK     CFNAME,OSTFILE,FILBB1A1
            CALL     OPOTBB11
            MOVE     ADMISSNO[FORM2],KEY8
            CALL     RDBOKB1
            IF       OVRCD=0
              MATCH    SP6,OTBBDEPT
              GOTO     OUTDET95 IF EQUAL
              MOVE     OTBBDEPT,CODE       * Unit code
              MOVE     ZERO,EXIT
            ENDIF
            GOTO     OUTDET99
          ENDIF
.
          MOVE     ZERO,OVRCD
          PACK     KEY8,OSTFILE,FILMA1A1  * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTMA1A1,KEY8          * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEY18,OBASITE,OBACLIN,OBADAY,OBASTRT
          CALL     RDMASA1
          BRANCH   OVRCD,OUTDET95
.
          WRITE    HTMLFILE;OTMACLOC;
          MOVE     ZERO,EXIT
          GOTO     OUTDET99
.
OUTDET95  MOVE     ONE,EXIT
          GOTO     OUTDET99
.
          INC       OUTCLIIO/INC
          INC      OUTPREIO/INC
          INC       OUTBOAIO/INC
          INC       OUTMA1IO/INC
          INC       IBAOVRIO/INC
          INC       OUTBB1IO/INC
.
OUTDET99  ENDPROC
.------------------------------------------------------------
. Procedure to get Emergency Details
.   COPTION = 1 Return Consultant DOCTCODE
.             2 Output Location
.             3 Output Triage Status
.             4 Output Menu Type
.------------------------------------------------------------
          DEFPROC  EMRCHK00
.
          INC      EMRVISFD/INC
          INC      EMRLOCFD/INC
.
EMRCHK10  MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     EMRVISA1,"emrvisaf"
          TRAPCLR  IO
          BRANCH   OVRCD,EMRCHK90
.
          MOVE     ADMISSNO[FORM2],KEY8
          CALL     RDEMVIS1
          BRANCH   OVRCD,EMRCHK90
.
          COMPARE  FOUR,EMVISTAT
          GOTO     EMRCHK90 IF EQUAL
.
          MOVE     EMVIDOCT,DOCTCODE
          IF       COPTION=4
            PACK     MENUTYPE,ONE,EMVISTAT
            GOTO     EMRCHK99
          ENDIF
          IF       COPTION=2
            IF       EMVISTAT=1
              OPEN     EMRLOCA1,"emrlocaf"
              MOVE     "Other Departments",EMLODESC
              MOVE     EMVILOCN,KEY3
              CALL     RDEMLOC1
              WRITE    HTMLFILE;"Emergency - ",EMLODESC;
            ELSE
              WRITE    HTMLFILE;"Discharged";
            ENDIF
          ENDIF
          IF       COPTION=3
            WRITE    HTMLFILE;EMVITRIG;
          ENDIF
          GOTO     EMRCHK99
.
EMRCHK90  MOVE     PVIDOCT,DOCTCODE
          IF       COPTION=2
            WRITE    HTMLFILE;"Emergency";
          ENDIF
          GOTO     EMRCHK99
.
          INC      EMRVISIO/INC
          INC      EMRLOCIO/INC
          INC       IBAOVRIO/INC
.
EMRCHK99  ENDPROC
.*****************************************************************************
.*  GETALTID
.*  Procedure to get an alternate ID
.*  Exit=0  No alternate ID
.*       1  Alternate ID's exist
.*****************************************************************************
          DEFPROC   GETALIDS
.
          INC       PMSAIDFD/INC
.
          MOVE      ZERO,EXIT
          PACK      KEY20,SP70
          OPEN      PMSAIDA1,"pmsaidaf"
.
          PACK      KEY31,PURNO,SP70
          CALL      RSPMAID1           * Read alternate id Table
GETALI10  CALL      RKPMAID1
          BRANCH    OVRCD,GETALI99
.
          MATCH     PURNO,PMAIURNO     * Check same UR
          GOTO      GETALI99 IF NOT EQUAL
.
          MATCH     "1",PMAIDISU
          GOTO      GETALI10 IF NOT EQUAL
.
          PACK      KEY20,PMAIALID,SP70
          MOVE      ONE,EXIT
          GOTO      GETALI99
.
          INC       PMSAIDIO/INC
          INC       IBAOVRIO/INC
.
GETALI99  CLOSE     PMSAIDA1
.
          ENDPROC

.**********************************************************************
.         Update Default Printer File for User
.**********************************************************************
UPDFPT00  MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          PACK      KEY20,PRGID,KEY2,WBSEUID,SP70
          UNPACK    KEY20,IBPDPID,IBPDREP,IBPDUID
          MOVE      SELPRINT,IBPDPRT
          MOVE      SP70,IBPDSPA
          CALL      RAIBPD1
          IF        OVRCD=0
            CALL      UPIBPD1
          ELSE
            CALL      WRIBPD1
          ENDIF
UPDFPT99  RETURN
.==============================================================================
.
.****************************************************************************
.  SINVH000 - Set up invoice header for stationery templating
.****************************************************************************
SINVH000  OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
.
          MOVE      PTCNPAIH,KEY6
          CALL      RDIBTH1                   * read header detail file
          BRANCH    OVRCD,SINVH900
.
          PACK      KEY12,PTCNPAIH,SP6        * position on details file
          CALL      RSIBDET1
          CALL      RKIBDET1
          BRANCH    OVRCD,SINVH900
.
          MATCH     PTCNPAIH,IBDTSCOD         * match stationery codes
          GOTO      SINVH950 IF EQUAL
.
.------ stationery code not on file ------
.
SINVH900  DISPLAY   *P1:24,*EL,*B:
                    "User Defined Stationery Code not on File. ";
          CALL      HITENTER
          MOVE      ONE,EXIT
          GOTO      SINVH999
.
SINVH950  MOVE      ZERO,EXIT
SINVH999  RETURN
+
.****************************************************************************
.  SINVT000 - Set up invoice tail for stationery templating
.****************************************************************************
SINVT000  OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
.
          READ      CONTROLF,NINTY8;*136,PTCNPAIH,*142,PTCNPAIT
          MOVE      PTCNPAIT,KEY6
          CALL      RDIBTH1                   * read header detail file
          BRANCH    OVRCD,SINVT900
.
          PACK      KEY12,PTCNPAIT,SP6        * position on details file
          CALL      RSIBDET1
          CALL      RKIBDET1
          BRANCH    OVRCD,SINVT900
.
          MATCH     PTCNPAIT,IBDTSCOD         * match stationery codes
          GOTO      SINVT950 IF EQUAL
.
.------ stationery code not on file ------
.
SINVT900  DISPLAY   *P1:24,*EL,*B:
                    "User Defined Stationery Code not on File. ";
          CALL      HITENTER
          MOVE      ONE,EXIT
          GOTO      SINVT999
.
SINVT950  MOVE      ZERO,EXIT
SINVT999  RETURN
+
.******************************************************************************
.
PRTIPROV  RETURN
.
          INC       STD001IO
          INC       STDHLPCD
          INC       STDKWSCD
          INC       CLPATMAS           * for PATSRCH
          INC       CLPATINV
          INC       CLPMSABF
          INC       CLNZPPIC
          INC       CMXMATRX
          INC       IBAPRINT
          INC       IBAGSTKY
          INC       IBAGKIKY
          INC       NHOSPDAY
          INC       NZHISIIO           * for NZIBSRCH
          INC       NZIBSRCH           * for PATSRCH
          INC       PATCALFN
          INC       PATCATAI
          INC       PATCATBI
          INC       PATCOMN1
          INC       PATCOMN3
          INC       PATGBCRN           * I-48227
          INC       PATGNCMX
          INC       PATINVS
          INC       CMGETTHR
          INC       PATIVMES
          INC       PABXBILL
          INC       CLPATDTR
          INC       KYPTBANK                 * Banking has started message
.
          INC       PATRECAL
          INC       PATSNDX
          INC       PATSNX2
          INC       PATTRRAT
          INC       STEPDOWN
          INC       PATCMSTP
          INC       CHKCMXPT
          INC       CALCDAYS
          INC       CHNADMTP
          INC       GETBFEES
          INC       PATMCHRD
          INC       PATITMRD
.
          INC       PATHSPKY
          INC       PATALWDS
          INC       PATCODDS
          INC       PATWRDDS
          INC       PATDOCCD
          INC       NAMSTRCD
          INC       SEXDSP00
          INC       CHKCLDCP
.
          INC       AAEDE1IO/INC
          INC       AAEDTRIO/INC
          INC       BOKRC1IO/INC
          INC       OUTCLIIO/INC
          INC       EMRHISIO/INC
          INC       EMRVISIO/INC
          INC       IBAGSTIO/INC
          INC       IBAGEDIO/INC
          INC       IBAPRNIO/INC
          INC       IBAPDFIO/INC
          INC       IBATMDIO/INC
          INC       IBATMHIO/INC
          INC       COMDEPIO/INC
          INC       MLTCFNIO/INC
          INC       NZPEXTIO/INC
          INC       NZPRDTIO/INC
          INC       NZPBFEIO/INC
          INC       NZPCFNIO/INC
          INC       NZPCMTIO/INC
          INC       NZPFIGIO/INC
          INC       NZPIBRIO/INC
          INC       NZPIRNIO/INC
          INC       NZPMCHIO/INC
          INC       NZPMXCIO/INC
          INC       NZPPFEIO/INC
          INC       NZPPICIO/INC
          INC       NZPRBRIO/INC
          INC       NZPRFNIO/INC
          INC       NZPFINIO/INC
          INC       NZPSPRIO/INC
          INC       NZPTFEIO/INC
          INC       NZPIVBIO/INC
          INC       NZPRVBIO/INC
          INC       OPRSESIO/INC
.
          INC       OUTBB1IO/INC
          INC       OUTBOAIO/INC
          INC       OUTDTRIO/INC
          INC       OUTPREIO/INC
          INC       OUTSITIO/INC
.
          INC       PATINMIO/INC
          INC       PATCFAIO/INC
          INC       PMSABFIO/INC
          INC       PMSPWAIO/INC
          INC       PMSCIDIO/INC
          INC       PMSCCDIO/INC
          INC       PMSTLEIO/INC
          INC       PATCRAIO/INC
          INC       PATCURIO/INC
          INC       PATDRGIO/INC
          INC       PATECOIO/INC
          INC       PATECDIO/INC
          INC       PATECHIO/INC
          INC       PATFEEIO/INC
          INC       PATINLIO/INC
          INC       PATALWIO/INC
          INC       PATBFEIO/INC
          INC       PATCODIO/INC
          INC       PATDO1IO/INC
          INC       PATDSCIO/INC
          INC       PATDTRIO/INC
          INC       PATEDSIO/INC
          INC       PATEDTIO/INC
          INC       PATFACIO/INC
          INC       PATFINIO/INC
          INC       PATFMOIO/INC
          INC       PATFN1IO/INC
          INC       PATFN2IO/INC
          INC       PATFIGIO/INC
          INC       PATFX1IO/INC
          INC       PATGTUIO/INC
          INC       PATIBLIO/INC
          INC       PATICUIO/INC
          INC       PATIN1IO/INC
          INC       PATINVIO/INC
          INC       PATIOVIO/INC
          INC       PATIPEIO/INC
          INC       PATIRNIO/INC
          INC       PATITMIO/INC
          INC       PATJRNIO/INC
          INC       PATMA1IO/INC
          INC       PMSPX2IO/INC
          INC       PATMCHIO/INC
          INC       PATMI1IO/INC
          INC       PATMMBIO/INC
          INC       PATOVBIO/INC
          INC       PATPGRIO/INC
          INC       PATPR1IO/INC
          INC       PATRBLIO/INC
          INC       PATRE1IO/INC
          INC       PATRCAIO/INC
          INC       PATSRBIO/INC
          INC       PATGSRIO/INC                 * Surname / Given Name File
          INC       PATTFEIO/INC
          INC       PATTRNIO/INC
          INC       PATVENIO/INC
          INC       PATVISIO/INC
          INC       PATWC1IO/INC
          INC       PATWMAIO/INC
          INC       PATWR1IO/INC
          INC       PATWVEIO/INC
          INC       NHIMASIO/INC       * for PATSRCH
          INC       PATDNRIO/INC
          INC       PATSDNIO/INC
          INC       PATSMWIO/INC
          INC       PATNIDIO/INC
          INC       PATALRIO/INC
          INC       PATNOBIO/INC
          INC       PMSEVTIO/INC
          INC       PMSHATIO/INC
          INC       PMSHCPIO/INC
          INC       PMSSINIO/INC
          INC       PATCMTIO/INC
          INC       PMSCMTIO/INC
          INC       PMSECTIO/INC
          INC       PMSVX1IO/INC
          INC       PMSPRGIO/INC
          INC       PMSCNOIO/INC
          INC       PMSFCIIO/INC
          INC       PMSSGAIO/INC
          INC       PMSMTIIO/INC
          INC       PMSMPRIO/INC
          INC       PMSBISIO/INC
          INC       PMSBBIIO/INC
          INC       VISPAYIO/INC
.
          INC       PATONHIO/INC
          INC       PATELGIO/INC
          INC       PATRATIO/INC
          INC       PATREMIO/INC
          INC       PATRFNIO/INC
          INC       PATRFGIO/INC
          INC       PATSGCIO/INC
          INC       PATAFEIO/INC       * for casemix
          INC       PATASDIO/INC
          INC       PATCMXIO/INC
          INC       PATCTFIO/INC
          INC       PATDGWIO/INC
          INC       PATHDFIO/INC
          INC       PATHLFIO/INC
          INC       PATHSPIO/INC
          INC       PATHTRIO/INC
          INC       PATICDIO/INC
          INC       PATIPRIO/INC
          INC       PATINVTL
          INC       PATINVHL
          INC       PRTINVBD
          INC       PATLDFIO/INC
          INC       PATLSDIO/INC
          INC       PMSEXTIO/INC
          INC       PATAA1IO/INC
          INC       PATSTAIO/INC
.
          INC       OPRDEAIO/INC
          INC       OPRDECIO/INC
          INC       OPRSRGIO/INC
.
          INC       OPRARDIO/INC
.
          INC       RCPBNKIO/INC
          INC       RCPDTEIO/INC
          INC       RCPBDTIO/INC
          INC       RCPCRSIO/INC
          INC       WEBSCHIO/INC
          INC       WEBIHCIO/INC
          INC       PMSPYRIO/INC
          INC       PMSPBRIO/INC
          INC       PMSIDEIO/INC
          INC       PMSIVBIO/INC
          INC       WEBERRIO/INC            * Web Server Error Logging
          INC       PMSEDGIO/INC       * Effective DRG Dates
          INC       PATDDHIO/INC
          INC       CLPMSIDE
          INC       TFILENAM                * Generate Temp File Name
.
          INC       PMIHEAD
          INC       PATALERT
          INC       PATHEAD
          INC       GETALTID
          INC       GETTFEES
          INC       GETCNEFF
          INC       ICDSCLAS
.
          INC       GETDRG
          INC       PATITMDS
          INC       CALCAGE
          INC       CHKSUGCL
          INC       PATSTRYR
          INC       PATCKEXC
          INC       RSHWEBCD
          INC       SGCHKDIG
          INC       PMSOSDTM              * Outstanding Debt alert routine
          INC       VALCMXFN
          INC       GETEFDRG
.
AGECHK    RETURN
+

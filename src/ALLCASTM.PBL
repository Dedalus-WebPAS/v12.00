. *----------------------------------------------------------------------
. * Include Name  :   ALLCASTM.PBL
. *
. * Function      :   CGI variables for ALLCASFD - allcasaf.dat
. *
. * Includes Needed :
. *
. *----------------------------------------------------------------------
.  Modifications Done :
.
.  V10.01.01 23/03/2011  Mike Laming   CAR 228416
.            Added ALCAORID (Organisation ID) - ALCAS010
.  V9.04.00  18/11/2004  Ebon Clements CAR 54855
.            Created include
.------------------------------------------------------------------------
.   Clear parameters for case team details file
.------------------------------------------------------------------------
.
CPALCA00  MOVE      Z70,ALCAS001
          MOVE      Z70,ALCAS002
          MOVE      Z70,ALCAS003
          MOVE      Z70,ALCAS004
          MOVE      Z70,ALCAS005
          MOVE      Z70,ALCAS006 
          MOVE      Z70,ALCAS007 
          MOVE      Z70,ALCAS008
          MOVE      Z70,ALCAS009
          MOVE      Z70,ALCAS010
.
CPALCA99  RETURN
.------------------------------------------------------------
. Add case team table
.------------------------------------------------------------
ALCA0000  BRANCH    FLDITMNO,ALCA0010,ALCA0020,ALCA0030,ALCA0040,ALCA0050:
                             ALCA0060,ALCA0070,ALCA0080,ALCA0090,ALCA0100:
                             ALCA0110,ALCA0120,ALCA0130,ALCA0140,ALCA0150:
                             ALCA0160
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALCA9999
.
ALCA0010  WRITE     HTMLFILE;ALCATEAM;
          GOTO      ALCA9999
.
ALCA0020  WRITE     HTMLFILE;ALCADESC;
          GOTO      ALCA9999
.
ALCA0030  WRITE     HTMLFILE;ALCALPAT;
          GOTO      ALCA9999
.
ALCA0040  WRITE     HTMLFILE;ALCALREF;
          GOTO      ALCA9999
.
ALCA0050  WRITE     HTMLFILE;ALCACDEP;
          GOTO      ALCA9999
.
ALCA0060  WRITE     HTMLFILE;ALCALCOD;
          GOTO      ALCA9999
.
ALCA0070  WRITE     HTMLFILE;ALCAACOD;
          GOTO      ALCA9999
.
ALCA0080  WRITE     HTMLFILE;ALCAACTV;
          GOTO      ALCA9999
.
ALCA0090  MATCH     ALCACDAT,SP70
          GOTO      ALCA9999 IF EQUAL
.
          UNPACK    ALCACDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALCA9999
.
ALCA0100  WRITE     HTMLFILE;ALCACTIM;
          GOTO      ALCA9999
.
ALCA0110  MATCH     SP70,ALCACUID
          GOTO      ALCA9999 IF EQUAL
.
          PACK      KEY10,ALCACUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALCACUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALCA9999
.
ALCA0120  MATCH     ALCAUDAT,SP70
          GOTO      ALCA9999 IF EQUAL
.
          UNPACK    ALCAUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALCA9999
.
ALCA0130  WRITE     HTMLFILE;ALCAUTIM;
          GOTO      ALCA9999
.
ALCA0140  MATCH     SP70,ALCAUUID
          GOTO      ALCA9999 IF EQUAL
.
          PACK      KEY10,ALCAUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALCAUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALCA9999
.
ALCA0150  CALL      CASHSL00                * Hospital code selection list
          GOTO      ALCA9999
.
ALCA0160  WRITE     HTMLFILE;ALCAORID;      * Organisation ID
          GOTO      ALCA9999
.
ALCA9999  RETURN
.
.------------------------------------------------------------
.   Set Parameters for case team details
.------------------------------------------------------------
SPALC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPALC001,SPALC002,SPALC003,SPALC004,SPALC005:
                       SPALC006,SPALC007,SPALC008,SPALC009,SPALC010
.
          MOVE      ONE,EXIT
          GOTO      SPALC999
.
SPALC001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,ALCAS001
          PACK      ALCAS001,ALCAS001,SP70
          GOTO      SPALC999
.
SPALC002  MOVE      QRYDATA,ALCAS002
          GOTO      SPALC999
.
SPALC003  MOVE      QRYDATA,ALCAS003
          GOTO      SPALC999
.
SPALC004  MOVE      QRYDATA,ALCAS004
          GOTO      SPALC999
.
SPALC005  MOVE      QRYDATA,ALCAS005
          GOTO      SPALC999
.
SPALC006  MOVE      QRYDATA,ALCAS006
          GOTO      SPALC999
.
SPALC007  MOVE      QRYDATA,ALCAS007
          GOTO      SPALC999
.
SPALC008  MOVE      QRYDATA,ALCAS008
          GOTO      SPALC999
.
SPALC009  MOVE      QRYDATA,ALCAS009
          GOTO      SPALC999
.
SPALC010  MOVE      QRYDATA,ALCAS010
          GOTO      SPALC999
.
SPALC999  RETURN
.
.------------------------------------------------------------
.  Update case team details
.------------------------------------------------------------
MVALCA00  MATCH     ALCAS001,Z70
          IF        !@EQUAL
            MOVE      ALCAS001,ALCATEAM
          ENDIF
.
          MATCH     ALCAS002,Z70
          IF        !@EQUAL
            MOVE      ALCAS002,ALCADESC
          ENDIF
.
          MATCH     ALCAS003,Z70
          IF        !@EQUAL
            MOVE      ALCAS003,ALCALPAT
          ENDIF
.
          MATCH     ALCAS004,Z70
          IF        !@EQUAL
            MOVE      ALCAS004,ALCALREF
          ENDIF
.
          MATCH     ALCAS005,Z70
          IF        !@EQUAL
            MOVE      ALCAS005,ALCACDEP
          ENDIF
.
          MATCH     ALCAS006,Z70
          IF        !@EQUAL
            MOVE      ALCAS006,ALCALCOD
          ENDIF
.
          MATCH     ALCAS007,Z70
          IF        !@EQUAL
            MOVE      ALCAS007,ALCAACOD
          ENDIF
.
          MATCH     ALCAS008,Z70
          IF        !@EQUAL
            MOVE      ALCAS008,ALCAACTV
          ENDIF
.
          MATCH     ALCAS009,Z70
          IF        !@EQUAL
            MOVE      ALCAS009,ALCAHOSP
          ENDIF
.
          MATCH     ALCAS010,Z70
          IF        !@EQUAL
            MOVE      ALCAS010,ALCAORID     * Organisation ID
          ENDIF
.
MVALCA99  RETURN
.
.------------------------------------------------------------
.  Clear case team details
.------------------------------------------------------------
CLALCA00  MOVE      SP70,ALCATEAM
          MOVE      SP70,ALCADESC
          MOVE      SP70,ALCALPAT
          MOVE      SP70,ALCALREF
          MOVE      SP70,ALCACDEP
          MOVE      SP70,ALCALCOD
          MOVE      SP70,ALCAACOD
          MOVE      SP70,ALCAACTV
          MOVE      SP70,ALCAHOSP
          MOVE      SP70,ALCACDAT
          MOVE      SP70,ALCACTIM
          MOVE      SP70,ALCACUID
          MOVE      SP70,ALCAUDAT
          MOVE      SP70,ALCAUTIM
          MOVE      SP70,ALCAUUID
          MOVE      SP70,ALCAORID           * Organisation ID
          MOVE      SP70,ALCASPAR
.
CLALCA99  RETURN 
.------------------------------------------------------------
. Hospital Selection List
.------------------------------------------------------------
CASHSL00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,ALCAHOSP
          GOTO      CASHSL20 IF EQUAL
.
          PACK      KEY3,ALCAHOSP
          CALL      RDPTHSP1
          BRANCH    OVRCD,CASHSL20
.
          BRANCH    F1,CASHSL10,CASHSL20
          WRITE     HTMLFILE;PTHSHOSP;
          GOTO      CASHSL99
.
CASHSL10  WRITE     HTMLFILE;PTHSNAME;
          GOTO      CASHSL99
.
CASHSL20  CALL      CASH0000
.
CASHSL99  RETURN
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
CASH0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
CASH0100  CALL      RKPTHSP1
          BRANCH    OVRCD,CASH9999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     ALCAHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      CASH0100
.
CASH9999  RETURN

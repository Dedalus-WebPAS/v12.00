.******************************************************************************
.* LABELINP - This is a proc to display the variables painted for Inpatients  *
.*            Labels.                                                         *
.* PARAMETERS  : This procedure requires that the Admission and master        *
.*               records have been read.                                      *
.*               KEY8 = Admission Number                                      *
.*               USINGELT - Using Eltron printer for labels                   *
.*                    0 = No                                                  *
.*                    1 = Yes                                                 *
.*                                                                            *
.* RETURNS     : EXIT 0 = Labels Printed / Zero Labels Selected               *
.*                    1 = Not Screen Painted                                  *
.*               NOLABEL = Number of labels to print                          *
.* Mods        :                                                              *
.*        V12.00.01 21/05/2025  Ebon Clements  TSK 0955096                    *
.*                  Alphanueric visit number changes                          *
.*        V10.13.01 21/08/2018  Nicole Torrisi TSK 0859684                    *
.*                  Recompiled for DADMDETS                                   *
.*        V10.10.01 12/04/2017  Ebon Clements  TSK 0836756                    *
.*                  Removed NHIMASFD include                                  *
.*        V9.09.01  12/07/2007  Peter Vela CAR 142913                         *
.*                  Added call to GCCSJG00                                    *
.*        V9.08.01  08/12/2006  Jill Habasque CAR 127698                      *
.*                  Added read of NZPSPRAF                                    *
.*        V9.04.02  15/06/2005  Peter Vela CAR 63549                          *
.*                  Added read of PMSVX1                                      *
.*        V9.04.01  21/09/2004  J.Tan                                         *
.*                  Mods to read PMI extension file                           *
.*        V5.08.03  28/09/2000  Dean Cramer                                   *
.*                  Recomplied for DXPATMAS                                   *
.*                  Changed for SLA code in PATMX1FD                          *
.*        V5.07.02  24/08/1999  Greg Horvat                                   *
.*                  Recompiled for DADMDETS - Fixed I*C                       *
.*        V5.07.01  07/07/1999  Greg Horvat      99/00 PRS2 Mods              *
.*                  Recompiled for DADMDETS - Changed to display contract vars*
.*               09/10/1997  Steve Armstrong                                  *
.*               Mods for Wrist Band Labels                                   *
.*               19/05/1997  Steve Armstrong       WHL                        *
.*               Mods for Eltron Printer.                                     *
.******************************************************************************
          DEFPROC   LABELINP
.
          INC       NHIETHFD/INC
.
.         Program Variables
.
.
DIM3      DIM       3
DIM80     DIM       80
FIELDNO   FORM      5
.
NMPNUMB   DIM       20
NOTSCPT   FORM      1          * no screen painted flag
PAGELIMT  FORM      "55"
PTCNIELT  FORM      1
.
CYRSFDTE  DIM       8
CYRSTDTE  DIM       8
CYRSYEAR  FORM      3
.
SPCARD    DIM       20
SPCEXP    DIM       8
SPCXMP    DIM       3
SPFMLY    DIM       12
.
WRSTFLAG  FORM      1
.
.         Program Constants
.
.
CODEA     INIT      "A "
CODEAC    INIT      "AC"
CODEBT    INIT      "BT"
CODECL    INIT      "CL"
CODEC     INIT      "C "
CODECC    INIT      "CC"
CODEDA    INIT      "DA"
CODEDC    INIT      "DC"
CODEH1    INIT      "H1"
CODEH2    INIT      "H2"
CODEH3    INIT      "H3"
CODELT    INIT      "LT"
CODEM     INIT      "M "
CODEP     INIT      "P "
CODEP1    INIT      "P1"
CODEP2    INIT      "P2"
CODEP3    INIT      "P3"
CODEP4    INIT      "P4"
CODEP5    INIT      "P5"
CODEP6    INIT      "P6"
CODER     INIT      "R "
CODERS    INIT      "RS"
CODET     INIT      "T "
CODETY    INIT      "TY"
CODEU1    INIT      "U1"
CODEU2    INIT      "U2"
CODEU3    INIT      "U3"
CODEU4    INIT      "U4"
CODEU5    INIT      "U5"
CODEU6    INIT      "U6"
CODEU7    INIT      "U7"
CODEUNK   INIT      "UNK"
CODEV6    INIT      "V6"
CODEV7    INIT      "V7"
CODEV8    INIT      "V8"
CODEXM    INIT      "XM"
.
                    "                "
SP80      INIT      "                                                      ":
                    "                          "
SP100     INIT      "                                                      ":
                    "                                              "
.
ZERO4     INIT      "04"
.
. -----------------------------------------------------------------------
.
MAIN0000  CALL      INIT0000
          BRANCH    CEXIT,MAIN9999          * invalid details
.
          MOVE      CLABPG,LABCOS
          MOVE      CTYPLAB,LABTYPE
          MOVE      CSIZLAB,LABSIZE
.
MAIN0500  CALL      LABELCOM                * process screen painted labels
.
MAIN9000  MOVE      ZERO,EXIT               * reset exit flag to label printed
.
MAIN9999  GOTO      LABINP99
+
.******************************************************************************
.*        INIT0000 - Open some files.                                         *
.******************************************************************************
.
INIT0000  UNPACK    LABELTYP,PRGID,SCRID
          MOVE      ZERO,WRSTFLAG
.
.-------  Open Patient Files  -------
.
          PACK      KEY8,ADMISSNO,SP10
          CALL      RDMISS1
          BRANCH    OVRCD,INIT9000
.
          PACK      KEY8,ADMISSNO,SP10
          CALL      RDVISA1
          BRANCH    OVRCD,INIT9050
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,INIT9050
.
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          CALL      GASF0000                * Get admin SFA file stuff
          READ      CONTROLF,TEN9;*212,CFEETYP
          CALL      GETNZP00                * Get NZ private billing details
.
          OPEN      PMSPX2A1,"pmspx2af"
          PACK      KEY8,PVIURNO,SP10
          CALL      RDMAST1
          BRANCH    OVRCD,INIT9100
          CALL      RDPMPX21
.
          CALL      GCCSJG00
.
          MOVE      PTMXCARD,SPCARD
          MOVE      PTMXCEXP,SPCEXP
          MOVE      PTMXCXMP,SPCXMP
          MOVE      PTMXFMLY,SPFMLY
.
.         get the PMI GP details
.
          MOVE      SP30,PMHCSNAM
          PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1
.
          MOVE      SP70,PMHGADD1
          PACK      KEY10,PMPXRH1G,SP70  * GP Practice code
          PACK      KEY12,KEY10,PMPXR1GC,SP70  * GP Practice code
          CALL      RDPMHCG1
.
          READ      CONTROLF,TWENTY;*196,PTCNUCRD
.
          UNPACK    SP100,PKNAME
          UNPACK    SP100,PKADD1,PKADD2 
          UNPACK    SP100,PKADD4,PKSUBR,PKPOST,PKTELEP 
          UNPACK    SP100,PKTELEB,PKRELP
          PACK      KEY8,ADMISSNO,SP10
          CALL      RDPTRES1
.
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
.
          IF        PTCNNHII = 1
            MOVE      SP10,NHMARES
            MOVE      SP10,NHMAETH
            MOVE      SP30,NMPNUMB 
            MOVE      PVIURNO,KEY8
            CALL      RDNHMAS2
          ELSE
            MOVE      SP20,NMPNUMB
            PACK      KEY10,CHOSINDX,PVIURNO,SP10 
            CALL      RDPTNID1
            MOVE      PTNINMPI,NMPNUMB
          ENDIF 
.
.         See if using Eltron printer
.
          READ      CONTROLF,EIGHTY8;*2,PTCNIELT
          MOVE      PTCNIELT,USINGELT       * save parameter
.
          COMPARE   ONE,ZEBRAFLG            * Flage for ZEBRA printer
          GOTO      INIT9996 IF EQUAL
          MOVE      ZERO,CEXIT
          GOTO      INIT9999
.
INIT9000  MOVE      "Invalid Admission Details.  ",WEBTITLE
          GOTO      INIT9995
INIT9050  MOVE      "Invalid Visit Details.  ",WEBTITLE
          GOTO      INIT9995
INIT9100  MOVE      "Invalid PMI Details.  ",WEBTITLE
          GOTO      INIT9995
INIT9995  CALL      WEBERR00
INIT9996  MOVE      TWO,EXIT
          MOVE      ONE,CEXIT
INIT9999  RETURN
.
.*****************************************************************
.* VCOM0000 - Read Visit Based community Card Details
.*****************************************************************
VCOM0000  COMPARE   ONE,PTCNUCRD
          GOTO      VCOM9999 IF NOT EQUAL
.
          MOVE      SP20,PTVKCARD
          MOVE      SP10,PTVKCEXP
          MOVE      SP10,PTVKCXMP
          MOVE      SP10,PTVKCOMP
          MOVE      SP10,PTVKFMLY
          PACK      KEY8,ADMISSNO,SP10
          CALL      RDPTVKC1
.
          MOVE      PTVKCARD,PTMXCARD
          MOVE      PTVKCEXP,PTMXCEXP
          MOVE      PTVKCXMP,PTMXCXMP
          MOVE      PTVKFMLY,PTMXFMLY
.
VCOM9999  RETURN
.*****************************************************************
.* MCOM0000 - Read Master File Based community Card Details
.*****************************************************************
MCOM0000  COMPARE   ONE,PTCNUCRD
          GOTO      MCOM9999 IF NOT EQUAL
.
          MOVE      SPCARD,PTMXCARD
          MOVE      SPCEXP,PTMXCEXP
          MOVE      SPCXMP,PTMXCXMP
          MOVE      SPFMLY,PTMXFMLY
.
MCOM9999  RETURN
+
.*****************************************************************
.*        DISPVARS  Display Items            Called By :         *
.*****************************************************************
.
DISPVARS  MOVE      SCPSITM,FIELDNO
          MOVE      SCPSLEN,LLCNT
.
          COMPARE   "500",FIELDNO
          GOTO      DVARS100 IF LESS
          SUB       "500",FIELDNO
.
          MOVE      FIELDNO,SCPSITM
          CALL      VCOM0000                * Visit Community Card Details
          CALL      DADMDETS
          GOTO      DVARS999
.
DVARS100  CALL      MCOM0000                * Master Community Card Details 
          CALL      DXPATMAS
.
DVARS999  RETURN
+
.******************************************************************************
.*                                  GASF0000                                  *
.*                        Get admission SFA file stuff                        *
.******************************************************************************
GASF0000  COMPARE   THREE,PTCNHDPS
          GOTO      GASF9000 IF NOT EQUAL   * Not in Victoria
.
          PACK      KEY25,AADMNO,ANSA,SP30
          CALL      RDPTASF1                * Read an admin SFA file record
          BRANCH    OVRCD,GASF1000
.
          MATCH     AADMNO,PTAFADMN
          GOTO      GASF1000 IF NOT EQUAL   * Different admin no
.
          MATCH     ANSA,PTAFTYPE
          GOTO      GASF8000 IF EQUAL       * An admin SFA type
.
GASF1000  MOVE      ZEROVISN,PTAFADMN
          UNPACK    SP30,PTAFTYPE,PTAFDATE,PTAFTIME,PTAFCODE,PTAFCTYP
          UNPACK    SP30,PTAFCROL,PTAFCSID,PTAFSPAR
.
GASF8000  MOVE      ZERO,ASFFLG             * Admin SFA flag - no
GASF9000  MOVE      ZERO,EXIT
GASF9999  RETURN
.
.******************************************************************************
.*  Get NZ Procedure details if required                                      *
.******************************************************************************
GETNZP00  COMPARE   FIVE,CFEETYP            * NZ Private only
          GOTO      GETNZP90 IF NOT EQUAL
.
          PACK      KEY11,ADMISSNO,SP70
          CALL      RSNZSPR1
GETNZP10  CALL      RKNZSPR1
          BRANCH    OVRCD,GETNZP90
.
          MATCH     ADMISSNO,NZSPADMN
          GOTO      GETNZP90 IF NOT EQUAL
.
          COMPARE   "1",NZSPPRIM
          GOTO      GETNZP10 IF NOT EQUAL
          GOTO      GETNZP999
.
GETNZP90  CALL      CLNZSP00
.
GETNZP99  RETURN
+
.------------------------------------------------------------
. Clear file variables for NZPSPRFD
.------------------------------------------------------------
CLNZSP00  MOVE      SP70,NZSPADMN
          MOVE      SP70,NZSPCLMN
          MOVE      SP70,NZSPSURG
          MOVE      SP70,NZSPPROC
          MOVE      SP70,NZSPUNIQ
          MOVE      SP70,NZSPCNTR
          MOVE      SP70,NZSPCPRC
          MOVE      ZERO,NZSPPRIM
          MOVE      SP70,NZSPANAE
          MOVE      SP70,NZSPPDES
          MOVE      ZERO,NZSPICAP
          MOVE      ZERO,NZSPPIND
          MOVE      ZERO,NZSPPINS
          MOVE      SP70,NZSPINSR
          MOVE      SP70,NZSPAPRV
          MOVE      ZERO,NZSPAPSI
          MOVE      SP70,NZSPCLNO
          MOVE      SP70,NZSPAPNT
          MOVE      SP70,NZSPCMNT
          MOVE      ZERO,NZSPTDUR
          MOVE      ZERO,NZSPTFEE
          MOVE      SP70,NZSPUDF1
          MOVE      SP70,NZSPUDF2
          MOVE      SP70,NZSPCDAT
          MOVE      SP70,NZSPCTIM
          MOVE      SP70,NZSPCUID
          MOVE      SP70,NZSPUDAT
          MOVE      SP70,NZSPUTIM
          MOVE      SP70,NZSPUUID
          MOVE      SP70,NZSPADTE
          MOVE      ZERO,NZSPHPAY
          MOVE      ZERO,NZSPCPAY
          MOVE      ZERO,NZSPINVD
          MOVE      SP70,NZSPSPAR
.
CLNZSP99  RETURN
.
.
          INC       AGECHK
          INC       CALCYRS
          INC       DADMDETS
..          INC       DISPITEM
..          INC       DSPBGRND
          INC       DSPFIELD
          INC       DXPATCOD
          INC       DXPATDOC
          INC       DXPATMAS
          INC       IBAOVRIO/INC
          INC       IBAPASIO/INC
          INC       NHIETHIO/INC
..          INC       PATAXEIO/INC
..          INC       PATDADIO/INC
..          INC       PATDGWIO/INC
          INC       WEBLBCOM     
          INC       PMIGTNID
.
LABINP99  ENDPROC
................................................................................

.---------------------------------------------------------------------------
. Program       : PATWEB90
.
. Function      : Patient Search Server
.
. Modifications :
.---------------------------------------------------------------------------
.  V12.00.02 15/10/2025  Thanh T       TSK 0968285 
.            Added autosrch flag to determine if automatic searching is
.            required 
.  V12.00.01 12/06/2025  Don Nguyen    TSK 0961844
.            Increased size of SRCHCL01 to 127 to cater for Paediatric icon.
.            Recompiled for PATNAMCD - resized VAR accordingly for Paediatric.
.  V11.05.01 01/05/2025  Nikitha B        TSK 0960102
.            Recompiled for PATWSRCH -  Current Patient Search
.  V11.04.02 15/07/2024  Peter Vela       TSK WEBPAS / ORBIS UI R&D
.            Recompiled for FHRDATCD
.  V11.04.01 14/05/2024  Ebon Clements  TSK 0946706
.            Recompiled for PATWSRCH - Waiting list search
.  V11.03.06 05/10/2023  Ebon Clements    TSK 0937602
.            Allow both partial surname and given name search - CURPAT10
.  V11.03.05 11/09/2023  Ebon Clements    TSK 0935498
.            Recompiled for PATWSRCH - Alias display for DOB search (Gender)
.  V11.03.04 09/08/2023  Thanh T          TSK 0865060
.            Recompiled for PATWSRCH changes                   
.  V11.03.03 01/08/2023  Peter Vela       TSK 0927262
.            Recompiled for FHRDATCD
.            Added dxc-hc-hcp and dxc-hc-speciality extensions
.  V11.03.02 18/07/2023  Thanh T          TSK 0865060 
.            Added Extended Theatre Search parameter
.  V11.03.01 23/05/2023  Peter Vela     TSK 0927399
.            Recompiled for FHRDATCD - Changed gender validation to 
.            Indicator 7
.  V11.02.02 17/06/2022  Davin          TSK 0913831
.            Recompiled for PATWSRCH - Display all alias records in DOB search
.  V11.02.01 10/02/2022  Thanh T          TSK 0905641
.            Recompiled as OUTHEDFD/OUTMA1FD/WATTR1FD changes
.  V11.01.04 08/06/2021  Jill Parkinson Task 0906768
.           Removed setting of norecord to 10 if blank to stop search on display
.  V11.01.03 02/06/2021  Ebon Clements  TSK 0906781
.            Removed scndtime test from CURPAT00 to allow records to display
.  V11.01.02 21/05/2021  Don Nguyen     TSK 0900780
.            Recompiled for PATWSRCH; Modified PRNLIN00 to make Ward & Hospital
.            description text not overlap other columns for Inpatient search.
.  V11.01.01 27/04/2021  Thanh T        TSK 0895165
.            Recompiled for OPRARDFD changes
.---------------------------------------------------------------------------
.  V11.00.06 20/01/2021  Thanh T        TSK 0849000
.            Changed CURPAT00 to caters for no ED visits functionality 
.  V11.00.05 09/12/2020  Thanh T        TSK 0872840
.            Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
.  V11.00.04 01/12/2020  Thanh T        TSK 0849000
.            Changed CURPAT00 to caters for no ED visits functionality
.  V11.00.03 05/05/2020  Jill Parkinson Task 0879163
.            Increased length for sex description
.  V11.00.02 29/04/2020  Ebon Clements  TSK 0850105
.            Added theatre location display to current patient search OPCNTHED
.  V11.00.01 02/04/2020  Don Nguyen     TSK 0881876
.            Added ADDRTYPE (Address Type) for Addressify validation
.  V10.13.04 25.01.2019  B.G.Ackland    TSK 0835482
.            FHIR Recompile for change to FHRDATCD
.  V10.13.03 12.11.2017  B.G.Ackland    TSK 0835482
.            FHIR Recompile for change to FHRDATCD
. V10.13.02 06.11.2017  B.G.Ackland    TSK 0835482
.           FHIR Output Change for Boolean values to not have quotes
. V10.13.01  01.11.2018  B.G.Ackland    TSK 0835482
.            Added deceased section to patient FHR resource in FHRDATCD
.  V10.12.01 09/03/2018  Don Nguyen     TSK 0844685
.            Added PATS3500 - External PMI Search Button Text (PTCNESBT)
.            Added PATS3600 - Show LHD Search button (SHOWBLHD)
.            09.03.2017  Ebon Clements  TSK 0852062
.            Recompiled for PATWSRCH - DOB search
.  V10.11.06 03.10.2017  B.G.Ackland    TSK 0835482
.            FHIR Dummy include for Extra Details
.  V10.11.05 03.10.2017  B.G.Ackland    TSK 0835482
.            FHIR Dummy include for Contact Details (Not included in List Functions)
.  V10.11.04 21/09/2017  Thanh T.       TSK 0821710   
.            Removed PATCMNFD/IO since it is not used      
.  V10.11.03 13.09.2017  B.G.Ackland    TSK 0835482 
.            Fix FHIR Output Not Showing Patient ID
.  V10.11.02 08/09/2017  Thanh T.       TSK 0821710
.            Removed PATCOMFD/IO
.  V10.11.01 28.08.2017  B.G.Ackland    TSK 0835482 
.            FHIR Output Change to Patient Reference ID to strip spaces
.            FHIR Change Extension Naming
.---------------------------------------------------------------------------
.  V10.10.11 11.07.2017  B.G.Ackland    TSK 0835482 
.            FHIR Output Testing for ClinicalAide
.  V10.10.10 28.06.2017  B.G.Ackland    TSK 0835482
.            FHIR Interface Change Patient Resource for family name
.  V10.10.09 07/07/2017  Don Nguyen     TSK 0841807
.            Recompiled for PATWSRCH - Restored cell width and added 'padding'
.  V10.10.08 01/07/2017  Jill Parkinson TSK 0841438 
.            Corrected match at CURPAT12 to be > not >=              
.  V10.10.07 08.06.2017  B.G.Ackland    TSK 0835482 
.            FHIR Output Resolve Testing Issue with End of Search
.  V10.10.06 06/06/2017  Nicole Torrisi TSK 0838281
.            Fixed filtering of records
.  V10.10.05 29/05/2017  Peter Vela     TSK 0838833
.            Added merged patients to URNUM000
.  V10.10.04 08.05.2017  B.G.Ackland    TSK 0835482 
.            FHIR Output Resolve Testing Issues Incorporate Version Control
.  V10.10.03 27/04/2017  Peter Vela     TSK 0813019
.            Recompiled for PATWSRCH
.            27/01/2017  B.G.Ackland    TSK 0835482 
.            FHIR Patient Resource Extension Changed to be Compliant
.  V10.10.02 26/04/2017  Thanh T.       TSK 0837189
.            Fixed Local search error when the deceased patient not in 
.            the specified age range          
.  V10.10.01 21/01/2017  B.G.Ackland    TSK 0835482 
.            FHIR API Patient Search
.  V10.08.02 20/09/2016 Jill Parkinson TSK 0826142
.            Recompiled for PATWSRCH - moved clear of ADMISSNO before deceased
.  V10.08.01 21/07/2016 Jill Parkinson TSK 0814591
.            Recompiled for PATWSRCH - output alias DOB and current DOB
.  V10.07.04 10/03/2016 Peter McMullem CAR 0815423
.            Use mandatory env var QISNAME to detect Oracle 
.  V10.07.03 19/10/2015  Ebon Clements  CAR 295175
.            Added PTCNCHRT - Display OP chart only appointments on
.            the current patient search
.  V10.07.02 08/10/2015  Peter Vela     CAR 322459
.            Added functionality to get unknown patient sex in
.            EMRDET00
.  V10.07.01 08/10/2015  Peter Vela     CAR 322459
.            Added functionality to get unknown patient date of birth in
.            EMRDET00
.  V10.06.05 11/09/2015  Peter Vela     CAR 321502
.            Added new tag for wahealth current patient search
.  V10.06.04 23/06/2015  Peter Vela     CAR 305156
.            Recompiled for PATWSRCH
.  V10.06.03 10/06/2015  Peter Vela     CAR 316707
.            Recompiled for PATWSRCH
.  V10.06.02 20/05/2015  Ania P         CAR 315557
.            Added Hospital Column to Patient Search
.  V10.06.01 04/05/2015  Ebon Clements  CAR 314075
.            Added clinical cgi to patient search next and rev url
.  V10.05.02 20/10/2014  Ebon Clements  CAR 268970
.            Recompiled for PATWSRCH - Change to use OUTCLIFD index 1
.            instead of index 2
.  V10.05.01 21/08/2014  Don Nguyen     CAR 303878
.            Added FADDRES3. Recompiled for changes to PATWSRCH.
.  V10.04.02 04/07/2014  Ebon Clements  CAR 302496
.            Changed ORACLEDB flag in INIT0000 to be set by the GETENV 
.            command instead of a ps -ef and a temp file
.  V10.04.01 21/01/2014  Ebon Clements  CAR 295847
.            Recompiled for PATWSRCH - Current patient list OP visit display
.  V10.03.19 12/12/2013  Don Nguyen     CAR 244776
.            Recompiled for PATWSRCH - Fixed bug where patient records were 
.            missing from subsequent results page (i.e. page 2 onwards) when
.            Alternate ID display turned on.
.  V10.03.18 24/10/2013  Don Nguyen     CAR 285649
.            Recompiled for PATWSRCH - Fixed DISALI00 looping
.  V10.03.17 24/10/2013  Ebon Clements  CAR 291974
.            Added SRCHEBST to exclude EBS created temp U/R numbers PSTAT=4
.            from the standard patient search
.  V10.03.16 17/10/2013  Ebon Clements  CAR 230883
.            Recompiled for PATWSRCH - WL search 
.  V10.03.15 08/10/2013  Don Nguyen     CAR 285649
.            Redefined SRCHPDOB to be a DIM 8 (instead of DIM 11)
.            Recompiled for PATWSRCH - Packed SRCHGNAM into KEY98 in RSSTR000
.  V10.03.14 26/09/2013  Ebon Clements  CAR 275205
.            Added clinical cgi
.  V10.03.13 03/07/2013  Davin          CAR 287520
.            Recompiled for PATWSRCH - fixed display of doc.typ
.  V10.03.12 11/06/2013  Patrick Adair  CAR 286419
.            Corrected colum width fields for display
.  V10.03.11 30/04/2013  Peter Vela     CAR 281511
.            Recompiled for PATWSRCH
.  V10.03.10 23/04/2013  Peter Vela     CAR 281511
.            Recompiled for PATWSRCH
.  V10.03.09 01/02/2013  Patrick Adair  CAR 263963
.            Added second formatted address line variable
.            Recompiled for changes to PATWSRCH (multi Line Address Display)
.  V10.03.08 10/10/2012  Peter Vela     CAR 274325
.            Assign 1 to DISDOCTY @ PATS1100 so Doc Type column 
.            does not display in patweb9001060.html
.  V10.03.07 15/02/2012  Ebon Clements  CAR 259881
.            Recompiled for PATWSRCH -  DOB for strict test in soundex
.  V10.03.06 13/02/2012  Ebon Clements  CAR 259881
.            Recompiled for PATWSRCH - Sound-ex given name 2 
.  V10.03.05 27/01/2012  Ebon Clements  CAR 258826
.            Fixed current patient search display count for cancelled ED visits
.  V10.03.04 27/01/2012  Ebon Clements  CAR 259018
.            Recompiled for PATWSRCH - Condition display
.  V10.03.03 27/01/2012  Ebon Clements  CAR 259024
.            Recompiled for PATWSRCH - Created by display
.  V10.03.02 20/12/2011  Mike Laming    CAR 257255
.            Recompiled for PATWSRCH - fix PTMASNAM in GETCON00               
.  V10.03.01 who knows!
.  V10.02.10 11/11/2011  Jill Parkinson CAR 253901
.            recompiled for PATWSRCH - don't select admissno if other hospital
.  V10.02.09 18/10/2011  Peter McMullen CAR 253341
.            recompiled for PATWSRCH - (added formatting for expected or
.            admit point ward)
.  V10.02.08 10/10/2011  Saroeun Soeur  CAR 252775
.            added space PTMASNAM
.  V10.02.07 07/10/2011  Saroeun Soeur  CAR 252775
.            PATNAM00 - STRIP PTMASNAM
.  V10.02.06 22/09/2011  Jill Parkinson CAR 248486
.            Recompiled for PATWSRCH - added hospital to status
.  V10.02.05 26/08/2011  Jill Parkinson CAR 249295
.            Recompiled for PATWSRCH
.  V10.02.04 18/08/2011  Jill Parkinson CAR 247732
.            Mods to replace % and & in surname and given name search fields
.  V10.02.03 12/08/2011  Peter McMullen    CAR 24O725
.            Change column widths to support wider ward/bed      
.  V10.02.02 14/07/2011  Peter McMullen    CAR 241813
.            Added tag for PTCNSRCT (number of recs to return) 
.  V10.02.01 22/06/2011  Steve Armstrong   CAR 240722
.            Recompiled for changes to PATLOCFD.
.            Mods to cater for changes to PMSCURFD:
.                 - PMCUSURN & PMCUGNAM extended to 40 chars.
.                 - PMCUGNM2 added.
.            Mods to cater for changes to PATGSRFD.
.---------------------------------------------------------------------------
.  V10.01.02 23/02/2011  Jill Parkinson CAR 222655
.            Recompiled for PATWSRCH 
.  V10.01.01 13/01/2011  Jill Parkinson CAR 236279
.            Changed to use PTMASNAM
.---------------------------------------------------------------------------
.  V10.00.01 22/09/2010  Jill Parkinson CAR 222489
.            Added bookings to current patient search
.---------------------------------------------------------------------------
.  V9.12.08 08/02/2010  Ebon Clements  CAR 215500
.           Recompiled for PATWSRCH - ED discharge date display
.  V9.12.07 07/01/2010  Saroeun Soeur  CAR 213676
.           PTCNHDPS - check if nz, output admission status
.  V9.12.06 17/12/2009  Peter McMullen CAR 210130
.            Convert to newer Dr name format routine DOCNM000 (in PATWSRCH.PBL)
.  V9.12.05 16/12/2009  Ebon Clements CAR 212398
.           Recompiled for PATWSRCH - Don't display phone extn if discharged
.  V9.12.04 11/12/2009  Saroeun Soeur  CAR 164863
.           added PATTYPEF - patient type search filter 
.  V9.12.03 27/11/2009  Saroeun Soeur  CAR 209940
.           added check for PTCNDRSM to use discharge stats or discharge
.           destination
.           recomplied for PATWSRCH
.  V9.12.02 17/11/2009  Jill Parkinson CAR 199108
.           Changed numtloop from 999 to 998
.  V9.12.01 23/07/2009  Jill Habasque CAR 202104
.           Changed numtloop from 250 to 999
.---------------------------------------------------------------------------
.  V9.11.01 22/04/2009  Jill Habasque CAR 145706
.           Added gpaccess flag
.---------------------------------------------------------------------------
.  V9.10.02 26/08/2008  Peter Vela    CAR 176904
.           Moved CWEBPSAR to Sector 101 Pos 54 DIM 2
.  V9.10.01 10/07/2008  Ebon Clements CAR 171268
.           Recompiled for PATWSRCH - Ignore cancelled ED visits
.---------------------------------------------------------------------------
.  V9.09.07 18/12/2007  Ebon Clements CAR 155246
.           Recompiled for PATWSRCH - Bold phone extn if currently admitted
.  V9.09.06 14/12/2007  Ebon Clements CAR 157600
.           Added PTCNDUNT - Don't Display unit column on current patient search
.  V9.09.05 06/12/2007  Ebon Clements CAR 142954
.           Added cordless telephone extn to current patient search
.  V9.09.04 13/11/2007  Peter Vela    CAR 151199
.           Added new Emergency Cancellation status
.           14/11/2007  Jill Habasque CAR 129420
.           Recompiled for PATWSRCH
.  V9.09.03 12/10/2007  Davin         CAR 151896
.           Recompiled for PATWSRCH
.  V9.09.02 05/09/2007  Jill Habasque CAR 139874
.           Recompiled for PATWSRCH
.           05/09/2007  Jill Habasque CAR 142963
.           Added search by given name if no surname entered
.  V9.09.01 19/09/2007  Jill Habasque CAR 90670 and 101699           
.           Recompiled for PATWSRCH
.           Uncommented call to CHDOB000 to allow age range searches
.   *****Note*****  Add patweb90 to RUN macro if internal server errors occur
.---------------------------------------------------------------------------
. V9.08.03  05/06/2007  Ebon Clements  CAR 121272
.           Added hospital access test to current patient search
. V9.08.02  31/01/2007  Peter Vela     CAR 127930
.           Recompiled for MRTMASFD
. V9.08.01  08/12/2006  Ebon Clements CAR 123752
.           Recompiled for PATWSRCH - Emergency triage date display
.---------------------------------------------------------------------------
. V9.05.04  03/04/2006  Ebon Clements CAR 78527
.           Added hospital to current patients
. V9.05.03  39/03/2006  Jill Habasque CAR 98583
.           Added output of WBSEHOSP - User's hospital                
. V9.05.02  27/03/2006  Jill Habasque CAR 78520
.           Recompiled for PATWSRCH - added created by                
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B02 20/02/2006  Ebon Clements     CAR 76341
.           Added referral and encounter file audit  
. V9.05.B01 20/12/2005  Ebon Clements CAR 76341
.           Key length changes for encounter number
.---------------------------------------------------------------------------
. V9.04.13  11/10/2005  Ebon Clements CAR 77367
.           Recompiled for PATWSRCH - removed call to CHDOB000
. V9.04.12  16/08/2005  Ebon Clements CAR 57203
.           Added current patient search by system - CURPTT00
. V9.04.11  15/07/2005  Ebon Clements CAR 66418
.           Removed duplicate display of discharge time from EMR
.           current patient search. PRLIN020
. V9.04.10  07/06/2005  Jill Habasque 
.           Added upplow of GSRSNAM
. V9.04.09  11/05/2005  Jill Habasque CAR 61705
.           Added check for merged alternate ID's when entering in UR
. V9.04.08  03/05/2005  Jill Habasque CAR 59276
.           Recompiled for PATWSRCH - use pbdate if surname and given name are
.           from patma1af
. V9.04.07  01/03/2005  Peter Vela    CAR 57547
.           Recompiled for PATVADFD and PATVADIO
. V9.04.06  28/01/2005 Davin          CAR 56361
.           Added reltflag. Check 'release to' fields (show alert icon if 
.           necessary).
. V9.04.05  20/01/2005 Peter Vela     CAR 54756
.           Fixed PACK to SRCHCL11 and SRCHCL17 (PRLIN00)
.           13/01/2005 Jill Habsasque CAR 55502
.           Added move of zero to all PATSxxxx routines
. V9.04.04  06/01/2005 Jill Habsasque CAR 55502
.           Added move of zero to F1 in PATS1000
. V9.04.03  10/12/2004 Jill Habasque CAR 52833
.           Added use of PTCNDISA - display alternate id in search
. V9.04.02  25/10/2004 Steve Armstrong  CAR 52359
.           Recompiled for changes to PATSNDX & PATGSRFD
. V9.04.01  07/09/2004 Jill Habasque 
.           Recompiled for PATWSRCH       
.---------------------------------------------------------------------------
. V9.03.11  29/06/2004 Jill Habasque CAR 44641
.           Mods for Alternate ID search
. V9.03.10  17/06/2004 Jill Habasque CAR 44641
.           Added Alternate ID search
.           07/06/2004 Peter Vela CAR 49016
.           2004 Statutory Changes - recompiled for PMSPX2TM
. V9.03.09  04/04/2004 Ebon Clements CAR 49726
.           Added patient location to current patient search for events
. V9.03.08  27/05/2004 Jill Habasque CAR 50210
.           Added status WAITST09 - Cancelled booking
.           26/05/2004 Jill Habasque CAR 48414
.           Recompiled for PATWSRCH - new soundex output order by given name
. V9.03.07  12/03/2004 Jill Habasque
.           Recompiled for PATWSRCH
. V9.03.06  02/03/2004 Henry Son         CAR 44200
.           Fix script error when entering a quote
.           in given name search.
. V9.03.05  04/02/2004 Jill Habasque
.           Restored ORACLEDB flag 
. V9.03.04  11/12/2003 Peter Vela     CAR 40355
.           Recompiled for PATNAMCD
.           15/12/2003 Ebon Clements  CAR 45481
.           Mods for PMSCURFD file change - added outpatient site
. V9.03.03  29/09/2003 Sylvek Litewka CAR 43302
.           Recompiled for PATWSRCH.
. V9.03.02  12/09/2003 Sandra Barcham     43010
.           Removed file prefix from opens of outphaf & outpreaf
. V9.03.01  21/03/2003 Sylvek Litewka CAR 38345
.           Recompiled for PATWSRCH - display "Estimated Discharge Time".
.---------------------------------------------------------------------------
. V9.02.35  17/03/2003 Tracey Nguyen SRF 36898
.           Stopped Doctor Name displaying for OP visit type
.           Replaced SRCHCL04 with NBSP at label PRLIN010
.           18/03/2003 Jill Habasque SRF 36585
.           Recompiled for PATWSRCH, event ambulatory status 
. V9.02.34  06/03/2003 Jill Habasque SRF 36585
.           Recompiled for PATWSRCH, event visitors and phone
. V9.02.33  27/02/2003 Jill Habasque SRF 17841      
.           Recompiled for PATWSRCH, pack of GSRSNAM before calling soundex
. V9.02.32  05/12/2002 Lina Vo       SRF 22709      
.           Add OPNOUT00 to open outpatient files
. V9.02.31  03/12/2002 Jill Habasque SRF 23732 33655
.           Recompiled for PATWSRCH - display clinic type desc - use tward,tbed
. V9.02.30  09/11/2002 Ebon Clements SRF 23307 
.           Recompiled for PATWSRCH - read visit extension for current events
.           08/11/2002 Jill Habasque SRF 23810 
.           Added NUMTLOOP to stop errors when not enough records are found
. V9.02.29  17/10/2002 Ebon Clements SRF 23307 
.           Added phone number and condition to the current patient search
. V9.02.28  03/10/2002 Jill Habasque SRF 22308 
.           Recompiled for PATWSRCH - display the exp ward or adm point  
. V9.02.27  24.09.2002 Ebon Clements SRF 20258 
.           Recompiled for PATWSRCH - display the clinic type in the unit
.           field for outpatient bookings
. V9.02.26  11/09/2002 Pat Dirito                SRF 18840         
.           Edited out div=HeadingDivision in CPHEAD00
. V9.02.25  27/08/2002 Jill Habasque SRF 18875, 18580 and 17625
.           Recompiled for PATWSRCH 
. V9.02.24  03/07/2002 Jill Habasque SRF 19723
.           Recompiled for PATWSRCH     
.           04/07/2002 Bronko Sosic     
.           Passed a new cgi through for not defulting patient information
.           through for EMR 
. V9.02.23  29/06/2002 Ebon Clements SRF 19105
.           Recompiled for sigpipe trap 
. V9.02.22  27/05/2002 Jill Habasque 3693
.           Added trap if sigpipe
. V9.02.21  05/04/2002 Pat Dirito 2724
.           Recompiled for PATWSRCH
. V9.02.20  03/04/2002 Pat Dirito 2724
.           Recompiled for PATWSRCH
. V9.02.19  15/03/2002 Jill Habasque 2419
.           Recompiled for PATWSRCH
. V9.02.18  12/03/2002 Jill Habasque 3398
.           Fixed output of condition details     
. V9.02.17  05/03/2002 Jill Habasque 
.           Changed layout for patient event rows 
. V9.02.16  27/02/2002 Jill Habasque 
.           Mods for current patient search layout
. V9.02.15  15/02/2002 Jill Habasque 
.           Mods for current patient search layout
. V9.02.14  27.12.2001 Jill Habasque 
.           Added new current patient search
. V9.02.13  27.11.2001 Glenn Saunders
.           Support separate views for RCH and standard for template 14.
. V9.02.12  18.11.2001 B.G.Ackland
.           Oracle Performance
. V9.02.11  17.11.2001 B.G.Ackland
.           Comment Options for Current Patient Search
. V9.02.10  16.11.2001 B.G.Ackland
.           Structure Code for Performance
. V9.02.09  15.11.2001 B.G.Ackland
.           Waiting List Only Search Option
. V9.02.08  22/10/2001 J Habasque
.           Recompiled for PATWSRCH   
. V9.02.07  19/10/2001 B.G.Ackland
.           Chnage New Soundex Surname for Exact Match on Surname Soundes Key
. V9.02.06  10/10/2001 B.G.Ackland
.           New Soundex Surname Strict Given Name Search Option 6
.           Fix Exit from Strict Match Option
. V9.02.05  05/10/2001 Glenn Saunders
.           Recompiled for PATWSRCH - Change privacy and patient folder changes 
.           Include PMSPX2TD and PMSPX2TM.                                      
.           05/10/2001 B.G.Ackland
.           Recompiled for PATWSRCH - Trap Open in Theatre Files Not Req for RCH
. V9.02.04  02/10/2001 J.Tan
.           Recompiled for PATWSRCH - mods to getting current routine (GCUR0000)
. V9.02.03  09/09/2001 B.G.Ackland   
.           Recompiled for PATWSRCH - DOB & Sex
. V9.02.02  28/08/2001 J.Tan
.           Recompiled for PATWSRCH - added theatre status
. V9.02.01  14/08/2001 J.Tan
.           A new layout for Current Patient Search (PATWSRCH)
.---------------------------------------------------------------------------
. V9.00.01  02/08/2001 HPS
.           Modified for Patient Search Screen
. V9.00.B03 27/06/2001 
.           Modified for Search Logic
. V9.00.B02 19/06/2001 Ebon Clements 
.           Added on leave status description if patient is on leave            
. V9.00.B01 10/05/2001 Ebon Clements 
.           Added new output for current patient strict surname search(PATS1700)
.---------------------------------------------------------------------------
. V5.10.B06 04/05/2001 Ebon Clements 
.           Added privacy indicator to status column in patient search
. V5.10.B05 23/04/2001 Ebon Clements 
.           Recompiled for PATWSRCH for the second index key size
. V5.10.B04 05/04/2001 B.G.Ackland
.           Increase Duplicate Array to 200
. V5.10.B03 05/04/2001 Glenn Saunders                                 
.           Remove access to PTCNSNDX and associated processing.      
.           Remove all references to PATSUR file (old surname file). 
. V5.10.B02 04/04/2001 Ebon Clements                                  
.           Changed table output of deceased patients to be bold
. V5.10.B01 06/03/2001 Ebon Clements                                  
.           Changed table output of u/r number to be bold
. V5.08.B02 20/12/2000 B.G.Ackland                                    
.           Fix Search Type Default Value
. V5.08.03 04/12/2000 Katie                                          
.          Recompiled for PATWSRCH CHANGE : Initialise status variables when 
.          there is a zero U/R. 
. V5.08.02 16/08/2000  Caleb Sharman
.          Changed Health Fund variables to be 8 chars
. V5.08.01 19.05.2000 Pat Driito    
.          Recompliled for PATWSRCH                          
.------------------------------------------------------------------------
. V5.07.07 03.03.2000 B.G.Ackland   
.          Added Complete Address Details for Search Results
. V5.07.06 03.02.2000 Katie Nelson  
.          Removed PopUpMenu code and replaced with Link 
.          to server passing only U/R number
. V5.07.05 28.01.2000 B.G.Ackland        
.          Recompiled for New Standards
. V5.07.04 20.12.1999 Katie Nelson        
.          Recompiled for IBAWEBDF/IBAWEBCD                                  
. V5.07.03 16.12.1999 Katie Nelson        
.          Fixed the default setting for the search type value               
. V5.07.02 25.11.1999 Nicole Harrington
.          Fixed another bit of the Sound-ex search and added DOB Search
. V5.07.01 15.10.1999 Nicole Harrington
.          Fixed Sound-ex search
. V5.07.00 11.10.1999 B.G.Ackland
.          Change Update Parent for Result Errors (Pass Admission & UR)
. V5.06.01 20.01.1999 B.G.Ackland
.          Release 5.06 Search
.
.------------------------------------------------------------
          INC       IBAWEBDF    
          INC       FHRDATDF    
.
          INC       ALLCONFD/INC
          INC       BOKRC1FD/INC
          INC       OPRCONFD/INC
          INC       OUTSITFD/INC
          INC       OUTPREFD/INC
          INC       OUTRF1FD/INC
          INC       PATCALAG/INC
          INC       PATCONFD/INC
          INC       PATDO1FD/INC
          INC       PMSAIDFD/INC
          INC       PATDSCFD/INC
          INC       PATGSRFD/INC
          INC       PMSCURFD/INC
          INC       PATMI1FD/INC
          INC       PATMRGFD/INC
          INC       PATTRNFD/INC
          INC       PATMA1FD/INC
          INC       PATVADFD/INC
          INC       PATDADFD/INC
          INC       PATPR1FD/INC
          INC       PATRE1FD/INC
          INC       PATHSPFD/INC
          INC       PATNOBFD/INC
          INC       PATONLFD/INC
          INC       PATVISFD/INC
          INC       PATVENFD/INC
          INC       MRTMASFD/INC
          INC       PATBRDFD/INC
          INC       PATBRDTD/INC
          INC       OUTCLIFD/INC
          INC       SCRMASFD/INC
.
          INC       PMSCCDFD/INC   * Concession Card Details
          INC       PMSHCPFD/INC
          INC       PMSHCLFD/INC
          INC       PMSPX2FD/INC
          INC       PMSPX2TD/INC
          INC       EMRUNKFD/INC
          INC       EMRVISFD/INC
          INC       MLTSECFD/INC
          INC       PMSHCGFD/INC
          INC       PMSVX1FD/INC
          INC       PATWR1FD/INC
          INC       PATLOCFD/INC
          INC       PATNURFD/INC
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       OUTCTYFD/INC
          INC       OUTMA1FD/INC
          INC       OUTSESFD/INC
          INC       OUTHEDFD/INC
          INC       PMSEVTFD/INC 
          INC       PMSWORFD/INC
          INC       PMSWORTD/INC
          INC       ALLREFFD/INC
          INC       ALLENCFD/INC  
          INC       WATTR1FD/INC   
.
AISEARCH  FORM      5
ADDRTYPE  DIM       1
ALTIDFLG  FORM      1
ALTERNID  DIM       20
BOOKED    INIT      "Booked"
CREATBY   INIT      "Created by: "
NOFCOL    FORM      1
EXTNSRCH  DIM       1
NUMLOOP   FORM      3
NUMTLOOP  FORM      3
NODETAIL  DIM       1
AUTOSRCH  DIM       1
ORACLEDB  FORM      1
HOUR      DIM       2
MIN       DIM       2
CFILEPRE  DIM       3
CLINICAL  DIM       1
CURRDATE  DIM       8
CONDESC   DIM       25
DIM8      DIM       8 
DIM12     DIM       12
DIM70     DIM       70                                                 *I-54756 
DISPDATE  DIM       13        * display variable for patient condition date
DASH      INIT      "-"
GPCODE    DIM       10
PRACTICE  DIM       10
IMGSRC    DIM       20
PATTYPEF  DIM       1
LSQBRKT   INIT      "["
RSQBRKT   INIT      "]"
LBRACKT   INIT      "("
RBRACKT   INIT      ")"
CODECO    INIT      "CO"
CODEAM    INIT      "AM"
NBSP      INIT      "&nbsp;"
DAYDIFF   FORM      8
HOURSDIF  FORM      3
OPNFILE   DIM       3         * Opened outpatient file
FONTCOL   DIM       20 
FOLDERSF  DIM       1    * Folder Icon Suffix
FNAMFLAG  FORM      1
ENDNAME   DIM       70
JAVFNAME  DIM       70
JAVGNAME  DIM       40
JAVSNAME  DIM       40
KIDSONLY  FORM      1         * Flag to indicate RCH or standard
DADATE    DIM       12
FADATE    DIM       12
FILTFLAG  FORM      1
LOCATION  DIM       20
DESTDESC  DIM       20
STRTNAME  DIM       70
CHKID     DIM       9
UROUTPUT  DIM       9[200]
UROUTEND  FORM      3
RELTFLAG  FORM      1
STARTFLG  FORM      1
MENTITID  DIM       16
MENTITLE  INIT      "idMenuTitle"
MENUID    DIM       11
IDMENU    INIT      "idMenu"
REMOTENO  FORM      1
VISTYPE   DIM       3
.
TOTALREC  FORM      4
MAXREC    FORM      3
DISDOCTY  FORM      1
HTMLSBLD  INIT      "<b>"
HTMLEBLD  INIT      "</b>"
STAT1     INIT      "Patient is pre-admitted "
STAT2     INIT      "Patient is admitted     "
STAT3     INIT      "Patient is discharged   "
STAT4     INIT      "Patient is on-leave     "
STAT5     INIT      "Patient is cancelled    "
STAT6     INIT      "In Hospital             "
STAT7     INIT      "On Short Term Leave     "
STAT8     INIT      "On Trial Leave          "
STAT9     INIT      "On Holiday Leave        "
STAT10    INIT      "A.W.O.L.                "
STAT11    INIT      "Discharged              "
STATA     INIT      "Pre-admission for "
STATB     INIT      "Admitted on "
STATC     INIT      "Discharged"
STATD     INIT      "On-Leave  "
STATCD    INIT      "Last Discharge on "
STATDD    INIT      "Deceased  "
EMRVIS    INIT      "EMG"
OUTVIS    INIT      "OP"
INPVIS    INIT      "IP"
EVTVIS    INIT      "EV"
ALLVIS    INIT      "AH"
BOKVIS    INIT      "BOK"
INVVIS    INIT      "   "
.
DCRPSTAT  DIM       20
_PREADMN  INIT      "- Pre Admission"
_CURADMN  INIT      "- Current Admission"
_DISCHRG  INIT      "- Discharge"
_ONLEAVE  INIT      "- On Leave"
_CANCELL  INIT      "- Cancel"
.
DLINKPRG  DIM       8
DLINKREP  DIM       2
DLINKTEM  DIM       3
DOCTCODE  DIM       6
DSCHFLAG  FORM      1
CODEBK    INIT      "BK"
.
ALEXIST   FORM      1
AIEXIST   FORM      1
ALIAFLAG  FORM      1
PATALIAS  DIM       50
DISPWACL  DIM       1
DISPNMLG  DIM       80                                              * CAR 263963
FADDRES1  DIM       71                                              * CAR 263963
FADDRES2  DIM       71                                              * CAR 263963
FADDRES3  DIM       71
FORM8     FORM      8 
WAITST01  INIT      "Unscheduled  "
WAITST02  INIT      "Scheduled    "
WAITST03  INIT      "Pre-Admitted "
WAITST04  INIT      "Admitted     "
WAITST05  INIT      "Discharged   "
WAITST06  INIT      "Removed      "
WAITST07  INIT      "Performed    "
WAITST08  INIT      "Not Performed"
WAITST09  INIT      "Canc. Booking"
WBEDDESC  FORM      1
WLSTATUS  FORM      1
.
BORDICIN  FORM      1
FILETYPE  FORM      1
MVFLAG    FORM      1
NOEDVIST  DIM       1 
SCNDTIME  DIM       1 
NURSTCOD  DIM       3       * Nursing Station code
NURSTNUM  DIM       20      * Nursing Station extension number
SAVCLASS  DIM       3
TODAYDAT  DIM       8
WORKDESC  DIM       280
.
SRCHEBST  FORM      1
SRCHADMN  DIM       8 
SRCHHOSP  DIM       3
SRCHSNAM  DIM       40
SRCHGNAM  DIM       40
SRCHMEDI  DIM       10
SRCHWAIT  FORM      1 
SRCHTYPE  DIM       1 
SRCHPSEX  DIM       1 
SRCHPAGE  DIM       3 
SRCHARAN  DIM       3 
SRCHPDOB  DIM       8
SRCHSYST  DIM       1
SRCHSTA1  DIM       70
SRCHSTA2  DIM       70
SRCHSTA3  DIM       70
SRCHSTA4  DIM       70
SRCHSTA5  DIM       70
SRCHSTA6  DIM       70
SRCHSTA7  DIM       70
SRCHSTA8  DIM       70
SRCHSTA9  DIM       70                      * HPS CODE ADDED
SRCHCL01  DIM       127
SRCHCL02  DIM       70
SRCHCL03  DIM       70
SRCHCL04  DIM       70
SRCHCL05  DIM       70
SRCHCL06  DIM       70
SRCHCL07  DIM       70
SRCHCL08  DIM       70
SRCHCL09  DIM       70
SRCHCL10  DIM       70
SRCHCL11  DIM       70
SRCHCL12  DIM       70
SRCHCL13  DIM       70
SRCHCL14  DIM       70
SRCHCL15  DIM       70
SRCHCL16  DIM       70
SRCHCL17  DIM       70
SRCHCL18  DIM       70
SRCHCL19  DIM       70
SRCHCL20  DIM       70
SRCHCL21  DIM       70
SRCHCL22  DIM       50
SRCHCL23  DIM       70                      * Patient condition
REFSTAT   DIM       20                      * HPS CODE ADDED
SRCHSDAY  FORM      4
LINKNUMB  FORM      1
LINKCNT   FORM      1
COLSPAN   FORM      1
SRCHFMT   FORM      2     * 1=Link to Server
.                         * 2=Link to Parent
.                         * 3=Link to Window
.                         * 5=Current patients
.
...PSAGEWKS  FORM      5
PSAGECON  DIM       3
PSAGETYP  DIM       3
.
SRAGEFR   FORM      3
SRAGETO   FORM      3
.
SHOWBLHD  DIM       1        * Show LHD Search button
.
.-----------------------------------------------------------------------
PRGID     INIT      "PATWEB90"
VERSION   INIT      "V12.00.02"
PRGNAM    INIT      "Patient Search Server"
.-----------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          CALL      OUTFIL00       * Check Correct Site Files Are Open
          BRANCH    EXIT,MAIN1000
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "INVALID OPTION",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      SRHPAT00
          GOTO      MAIN1000
.
MAIN1200  CALL      REMOTE00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      IHAPASS1,"ihapassf"        * For Printer Selection
          OPEN      OUTSITA1,"outsitaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PATVENA1,"patvenaf"
          OPEN      PATCODE1,"patcodes" 
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMA1A2,"patma1af"
          OPEN      PATMA1A3,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PATBRDA3,"patbrdaf"
          OPEN      PATMRGG1,"patmrgaf"
          OPEN      PMSAIDA1,"pmsaidaf"
          OPEN      PMSAIDA2,"pmsaidaf"
          OPEN      BOKRC1A6,"bokrc1af"
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      MRTMASA3,"mrtmasaf"
          OPEN      PATPR1A1,"patpr1af"
          OPEN      PATPX1A1,"patpx1af"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      EMRUNKA1,"emrunkaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PATWR1A2,"patwr1af"
          OPEN      PATLOCA1,"patlocaf"
          OPEN      PATVADA1,"patvadaf"
          OPEN      PATDADA1,"patdadaf"
          OPEN      MLTSECA1,"mltsecaf"
          OPEN      WATTR1A1,"wattr1af"
          OPEN      WATTR1A2,"wattr1af"
          OPEN      OUTPREA1,"outpreaf"
          OPEN      OUTRF1A1,"outrf1af"
          OPEN      PMSHCLA1,"pmshclaf"
          OPEN      PMSHCGA1,"pmshcgaf"
.
          OPEN      ALLREFA1,"allrefaf"     * HPS CODE Starts Here
          OPEN      ALLENCA1,"allencaf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PMSEVTA1,"pmsevtaf"     * HPS CODE Ends Here
          OPEN      PATNURS1,"patnursm"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATNOBE1,"patnobef"
          OPEN      PATONLV2,"patonlvf"
.
          READ      CONTROLF,TEN9;*75,CCNOTES
          READ      CONTROLF,FIFTY9;*132,CALRDESC,*231,PTCNRGNS
          OPEN      PATGSRN1,"patgsrnf"     * surname & given name
          OPEN      PATGSRN2,"patgsrnf"
          OPEN      PATGSRN3,"patgsrnf"
          OPEN      PATGSRN4,"patgsrnf"
          OPEN      PATGSRN5,"patgsrnf"
          OPEN      PATGSRN6,"patgsrnf"
          OPEN      PATGSRN7,"patgsrnf"
          OPEN      PATGSRN8,"patgsrnf"
          OPEN      PMSCURA2,"pmscuraf"
          OPEN      PMSCURA5,"pmscuraf"
          OPEN      PMSCURA6,"pmscuraf"
          OPEN      PMSCURA7,"pmscuraf"
          OPEN      PMSWORA1,"pmsworaf"
.
          MOVE      "out",CFILEPRE
          CALL      OPNOUT00                 * open outpatient files
.
          READ      CONTROLF,TEN;*246,SRCHDRNG,SRCHYRNG
          READ      CONTROLF,TWENTY1;*53,SRCHRSGS:         * Reverse Surn/Giv
                                     *54,SRCHPCKL          * Picking List
          READ      CONTROLF,SEVENTY7;*243,PTCNCMSX      
          READ      CONTROLF,EIGHTY;*229,PTCNDATE
          READ      CONTROLF,HUND01;*49,SRCHSDAY
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND12;*111,PTCNDUNT
          READ      CONTROLF,HUND13;*67,OPCNTHED
          READ      CONTROLF,TWENTY1;*45,PTCNDRSM
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,HUND23;*208,PTCNCHRT
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          MOVE      ZERO,ORACLEDB      * Not Oracle
.
          MOVE      SP70,DIM19
          GETENV    "QISNAME",DIM19
          PACK      DIM19,DIM19,SP70
          MATCH     SP70,DIM19
          IF        !@EQUAL
            MOVE      ONE,ORACLEDB     * Yes oracle
          ENDIF
.
          MOVE      "998",NUMTLOOP
.
          CALL      IBACLOCK
          PACK      TODAYDAT,CCC,CYY,CMM,CDD
.
          RETURN
.------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  CLOSE     OUTBOKA6
          PACK      CFNAME,CFILEPRE,FILBOKA6  * Get the name of the BOKA6 file
          OPEN      OUTBOKA6,CFNAME    
.
          RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,NODETAIL
          MOVE      SP70,AUTOSRCH
          MOVE      SP70,TEMPLATE
          MOVE      SP70,SRCHSNAM
          MOVE      SP70,SRCHMEDI
          MOVE      SP70,SRCHGNAM
          MOVE      SP70,SRCHPSEX
          MOVE      SP70,SRCHPAGE
          MOVE      SP70,SRCHARAN
          MOVE      SP70,SRCHPDOB
          MOVE      "0",SRCHSYST
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,LINKNUMB
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,TOTALREC
          MOVE      ZERO,REMOTENO
          MOVE      SP70,CLINICAL
          MOVE      SP70,NOEDVIST 
          MOVE      SP70,SCNDTIME 
.
          MOVE      ZERO,SRCHEBST
          MOVE      ZERO,SRCHWAIT
          MOVE      SP70,SRCHTYPE
          MOVE      SP70,SRCHADMN
          MOVE      SP70,SRCHFDAT
          MOVE      SP70,SRCHTDAT
          MOVE      SP70,SRCHFSYR
          MOVE      SP70,SRCHTSYR
          MOVE      SP70,SRCHFEYR
          MOVE      SP70,SRCHTEYR
          MOVE      ZERO,UROUTEND   
          MOVE      ZERO,KIDSONLY   
          MOVE      SP70,ALTERNID   
          MOVE      SP70,PATTYPEF
          MOVE      SP70,SRCHHOSP
          MOVE      ZERO,FILTFLAG
          MOVE      SP70,ADMISSNO
          MOVE      SP70,URNUMBER
          MOVE      SP70,SHOWBLHD
          MOVE      SP70,ADDRTYPE
          MOVE      SP70,EXTNSRCH
.
CLRPAR99  RETURN
+
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nodetail=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NODETAIL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "autosrch=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,AUTOSRCH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchadmn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHADMN
            PACK      SRCHADMN,SRCHADMN,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtflag=",QRYNAME
          IF        @EQUAL
            STRIP     QRYDATA
            MOVE      QRYDATA,FILTFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchwait=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHWAIT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchebst=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHEBST
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchhosp=",QRYNAME
          IF        @EQUAL
            PACK      SRCHHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchsnam=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHSNAM
            PACK      SRCHSNAM,SRCHSNAM,SP70
            REP       "~'& % ",SRCHSNAM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchgnam=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHGNAM
            PACK      SRCHGNAM,SRCHGNAM,SP70
            REP       "~'& % ",SRCHGNAM                            *I-44200
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchmedi=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHMEDI
            PACK      SRCHMEDI,SRCHMEDI,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchpsex=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHPSEX
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchsyst=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHSYST
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchpdob=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
            PACK      KEY11,KEY11,SP70
            UNPACK    KEY11,KEY8,KEY3
            MATCH     SP70,KEY3
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      SRCHPDOB,CCENT,CYEAR,CMON,CDAY
              REP       " 0",SRCHPDOB
            ELSE
              PACK      SRCHPDOB,QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHPAGE
            PACK      SRCHPAGE,SRCHPAGE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srcharan=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHARAN
            PACK      SRCHARAN,SRCHARAN,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "noedvist=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NOEDVIST
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "scndtime=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCNDTIME
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "remoteno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REMOTENO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alternid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ALTERNID
            PACK      ALTERNID,ALTERNID,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pattypef=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PATTYPEF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clinical=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLINICAL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showblhd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWBLHD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "addrtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADDRTYPE  * Address Type used for Addressify
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "extnsrch=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXTNSRCH  * Extended Search
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------
. Output Patient Enquiry Page
.------------------------------------------------------------
SRHPAT00  MOVE      "Patient Search",WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SRHPAT99
.
          CALL      WEBBOD00   * Output Templated Body of HTML 
.
          CALL      WEBEND00   * Output End of Web Page
.
SRHPAT99  RETURN
.------------------------------------------------------------
. Process Fields in Body of HTML Template
.------------------------------------------------------------
PROFLD00  BRANCH    FLDSETNO,PROFLD10
          GOTO      PROFLD99
.
PROFLD10  CALL      PATS0000
          GOTO      PROFLD99
.
PROFLD99  RETURN
.------------------------------------------------------------
. Patient Search
.------------------------------------------------------------
PATS0000  MOVE      ZERO,STARTFLG    * Flag if Search Output has Started
          MOVE      "101",AUDTSECT
          READ      CONTROLF,AUDTSECT;*41,CWEBPSTY,CWEBPSAG,*54,CWEBPSAR
          BRANCH    FLDITMNO,PATS0100,PATS0200,PATS0300,PATS0400,PATS0500:
                             PATS0600,PATS0700,PATS0800,PATS0900,PATS1000:
                             PATS1100,PATS1200,PATS1300,PATS1400,PATS1500:
                             PATS1600,PATS1700,PATS1800,PATS1900,PATS2000:
                             PATS2100,PATS2200,PATS2300,PATS2400,PATS2500:
                             PATS2600,PATS2700,PATS2800,PATS2900,PATS3000:
                             PATS3100,PATS3200,PATS3300,PATS3400,PATS3500:
                             PATS3600,PATS3700,PATS3800,PATS3900,PATS4000
          GOTO      PATS9999
.
PATS0100  CALL      NEXT0000
          GOTO      PATS9999
.
PATS0200  CALL      LAST0000
          GOTO      PATS9999
.
PATS0300  MATCH     SP70,SRCHSNAM
          GOTO      PATS9999 IF EQUAL
          STRIP     SRCHSNAM
          MOVELPTR  SRCHSNAM,LENGTH
          COMPARE   ZERO,LENGTH
          GOTO      PATS9999 IF EQUAL
          SFORMAT   VAR,LENGTH
          MOVE      SRCHSNAM,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      PATS9999
.
PATS0400  MATCH     SP70,SRCHGNAM
          GOTO      PATS9999 IF EQUAL
          STRIP     SRCHGNAM
          MOVELPTR  SRCHGNAM,LENGTH
          COMPARE   ZERO,LENGTH
          GOTO      PATS9999 IF EQUAL
          SFORMAT   VAR,LENGTH
          MOVE      SRCHGNAM,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      PATS9999
.
PATS0500  MATCH     SP70,SRCHPSEX
          GOTO      PATS9999 IF EQUAL
          WRITE     HTMLFILE;SRCHPSEX;
          GOTO      PATS9999
.
PATS0600  MATCH     SP70,SRCHPAGE
          IF        @EQUAL
            WRITE     HTMLFILE;CWEBPSAG;
          ELSE
            WRITE     HTMLFILE;SRCHPAGE;
          ENDIF 
          GOTO      PATS9999
.
PATS0700  MATCH     SP70,SRCHPDOB
          GOTO      PATS9999 IF EQUAL
          GOTO      PATS9999 IF EOS
          UNPACK    SRCHPDOB,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PATS9999
.
PATS0800  MATCH     SP70,SRCHARAN
          IF        @EQUAL
            WRITE     HTMLFILE;CWEBPSAR;
          ELSE
            STRIP     SRCHARAN
            MOVELPTR  SRCHARAN,LENGTH
            SFORMAT   VAR,LENGTH
            MOVE      SRCHARAN,VAR
            WRITE     HTMLFILE;VAR;
            SFORMAT   VAR,127
          ENDIF
          GOTO      PATS9999
.
PATS0900  UNPACK    DIM127,DIM1,ANS,DIM127 
          MATCH     SP70,SRCHTYPE
          IF        @EQUAL
            WRITE     HTMLFILE;CWEBPSTY;
          ELSE
            WRITE     HTMLFILE;SRCHTYPE;
          ENDIF
          GOTO      PATS9999
.
. Link to Server
.
PATS1000  UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,MAXREC
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,LINKNUMB
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,DISDOCTY
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,F1
          MOVE      SRCHTYPE,F1
          MOVE      ONE,SRCHFMT
          PERFORM   F1,STRCT000,SOUND000,DBRTH000,URNUM000,MEDIC000,SDXAA000
          GOTO      PATS9999
.
. Link to Parent
.
PATS1100  UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,MAXREC
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,LINKNUMB
          MOVE      ONE,DISDOCTY
          MOVE      ZERO,F1
          MOVE      SRCHTYPE,F1
          MOVE      TWO,SRCHFMT
          PERFORM   F1,STRCT000,SOUND000,DBRTH000,URNUM000,MEDIC000,SDXAA000
          GOTO      PATS9999
.
. Link to Window
.
PATS1200  UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,MAXREC
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,LINKNUMB
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,MAXREC
          MOVE      ZERO,F1
          MOVE      SRCHTYPE,F1
          MOVE      THREE,SRCHFMT
          PERFORM   F1,STRCT000,SOUND000,DBRTH000,URNUM000,MEDIC000,SDXAA000
          GOTO      PATS9999
.
PATS1300  MATCH     SP70,SRCHADMN
          GOTO      PATS9999 IF EQUAL
          WRITE     HTMLFILE;SRCHADMN;
          GOTO      PATS9999
.
. Link to Server with only U/R number
.
PATS1400  UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,MAXREC
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,LINKNUMB
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,F1
          MOVE      SRCHTYPE,F1
          MOVE      FOUR,SRCHFMT
          PERFORM   F1,STRCT000,SOUND000,DBRTH000,URNUM000,MEDIC000,SDXAA000
          GOTO      PATS9999
.
PATS1500  WRITE     HTMLFILE;SRCHTYPE;
          GOTO      PATS9999
.
PATS1600  MATCH     SP70,SRCHMEDI
          GOTO      PATS9999 IF EQUAL
          STRIP     SRCHMEDI
          MOVELPTR  SRCHMEDI,LENGTH
          COMPARE   ZERO,LENGTH
          GOTO      PATS9999 IF EQUAL
          SFORMAT   VAR,LENGTH
          MOVE      SRCHMEDI,VAR
          WRITE     HTMLFILE;VAR;
          SFORMAT   VAR,127
          GOTO      PATS9999
.
PATS1700  UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,MAXREC
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,LINKNUMB
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,DISDOCTY
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,F1
          MOVE      SRCHTYPE,F1
          MOVE      FIVE,SRCHFMT
.         WRITE     HTMLFILE;"Search Not Available";
          CALL      STRCT000
          GOTO      PATS9999
.
.         Current Patient Search (standard)
.
PATS1800  MOVE      ZERO,KIDSONLY          
          UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,MAXREC
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,LINKNUMB
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,DISDOCTY
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      SIX,SRCHFMT         * Inpatients and recent discharges
          MOVE      ZERO,FORM1
.         WRITE     HTMLFILE;"Search Not Available";
.
          CALL      STRCT000
          GOTO      PATS9999
.
PATS1900  WRITE     HTMLFILE;SRCHSYST;
          GOTO      PATS9999
.
.
.         Current Patient Search (RCH)      
.
PATS2000  MOVE      ONE,KIDSONLY          
          UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,MAXREC
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,LINKNUMB
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,DISDOCTY
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.         
          MOVE      SIX,SRCHFMT         * Inpatients and recent discharges
          MOVE      ZERO,FORM1
.         WRITE     HTMLFILE;"Search Not Available";
.         
          CALL      STRCT000
          GOTO      PATS9999
.
PATS2100  MOVE      ZERO,KIDSONLY
          MOVE      SP70,DISPWACL
          UNPACK    DIM127,DIM127
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CURPAT00
          GOTO      PATS9999
.
PATS2200  WRITE     HTMLFILE;NODETAIL;
          GOTO      PATS9999
.
PATS2300  READ      CONTROLF,HUND10;*240,PTCNUALT,*241,PTCNDISA
          WRITE     HTMLFILE;PTCNUALT;
          GOTO      PATS9999
.
PATS2400  MOVE      ZERO,KIDSONLY
          MOVE      SP70,DISPWACL
          UNPACK    DIM127,DIM127
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CURPTT00
          GOTO      PATS9999
.
PATS2500  WRITE     HTMLFILE;WBSEHOSP;
          GOTO      PATS9999
.
PATS2600  WRITE     HTMLFILE;SRCHHOSP;
          GOTO      PATS9999
.
PATS2700  MATCH     SP70,SRCHHOSP
          IF        @EQUAL
            IF        FILTFLAG=0
              MOVE      WBSEHOSP,SRCHHOSP
            ENDIF
          ENDIF
          CALL      HSEL0000
          GOTO      PATS9999
.
PATS2800  WRITE     HTMLFILE;FILTFLAG;
          GOTO      PATS9999
.
PATS2900  WRITE     HTMLFILE;ADMISSNO;
          GOTO      PATS9999
.
PATS3000  WRITE     HTMLFILE;URNUMBER;
          GOTO      PATS9999
.
PATS3100  WRITE     HTMLFILE;PATTYPEF;
          GOTO      PATS9999
.
PATS3200  READ      CONTROLF,HUND18;*151,PTCNSRCT
          MOVE      ZERO,F2
          STRIP     PTCNSRCT
          MOVE      PTCNSRCT,F2
          IF        F2 = 0
            MOVE      FIVE,F2
          ENDIF
          WRITE     HTMLFILE;*+,F2;
          GOTO      PATS9999
.
PATS3300  WRITE     HTMLFILE;CLINICAL;
          GOTO      PATS9999
.
PATS3400  MOVE      ZERO,KIDSONLY
          MOVE      ONE,DISPWACL
          UNPACK    DIM127,DIM127
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CURPAT00
          GOTO      PATS9999
.
PATS3500  READ      CONTROLF,HUND25;*156,PTCNESBT
          STRIP     PTCNESBT
          WRITE     HTMLFILE;*+,PTCNESBT,*-;
          GOTO      PATS9999
.
PATS3600  WRITE     HTMLFILE;SHOWBLHD;
          GOTO      PATS9999
.
PATS3700  WRITE     HTMLFILE;ADDRTYPE;
          GOTO      PATS9999
.
PATS3800  WRITE     HTMLFILE;NOEDVIST;
          GOTO      PATS9999
.
PATS3900  WRITE     HTMLFILE;SCNDTIME;
          GOTO      PATS9999
.
PATS4000  WRITE     HTMLFILE;AUTOSRCH;
          GOTO      PATS9999
.
PATS9999  RETURN
+
.------------------------------------------------------------
. New Current Patient Search
.------------------------------------------------------------
CURPAT00  MOVE      ZERO,DISNUMB 
          PACK      SRCHSNAM,SRCHSNAM,SP70
. 
.         IF        NORECORD = 0
.           MOVE      10,NORECORD
.         ENDIF   
.
          MATCH     "1",NOEDVIST
          IF        @EQUAL
            CALL      CPHEAD10
          ELSE
            CALL      CPHEAD00
          ENDIF
.
CURPAT02  MATCH     SP70,SRCHSNAM
          IF        @EQUAL
            PACK      KEY88,SRCHGNAM,SP70,SP70
            CALL      RSPMCUR7
            GOTO      CURPAT10
          ENDIF
.
          MATCH     SP70,SRCHHOSP
          IF        @EQUAL
            PACK      KEY96,SRCHSNAM,SP70,SP70
            CALL      RSPMCUR2
          ELSE
            PACK      KEY99,SRCHHOSP,SRCHSNAM,SP70,SP70
            CALL      RSPMCUR6
          ENDIF
.
CURPAT10  MATCH     SP70,SRCHSNAM
          IF        @EQUAL
            CALL      RKPMCUR7
          ELSE
            MATCH     SP70,SRCHHOSP
            IF        @EQUAL
              CALL      RKPMCUR2
            ELSE
              CALL      RKPMCUR6
            ENDIF
          ENDIF
          BRANCH    OVRCD,CURPAT99
.
          IF        IBCNMHOS=1
            MATCH     SP70,SRCHHOSP
            IF        !@EQUAL
              MATCH     SRCHHOSP,PMCUHOSP
              IF        !@EQUAL
                MATCH     SP70,SRCHSNAM
                GOTO      CURPAT10 IF EQUAL
                GOTO      CURPAT99
              ENDIF
            ELSE
              PACK      KEY13,USERID,SP70              * All hospital access
              CALL      RDMLSEC1
              IF        OVRCD=1
                PACK      KEY13,USERID,PMCUHOSP,SP70   * This hospital access
                CALL      RDMLSEC1
                BRANCH    OVRCD,CURPAT10
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,SRCHSNAM
          IF        !@EQUAL
            CMATCH    PMCUSURN,SRCHSNAM
            GOTO      CURPAT99 IF NOT EQUAL
.
. Partial given name test as well as same first character
.
            MATCH     SP70,SRCHGNAM
            IF        !@EQUAL
              MATCH     SP70,PMCUGNAM       * Skip if no given name
              GOTO      CURPAT10 IF EQUAL
.
              MOVE      SRCHGNAM,KEY40      * Search given name
              REP       UPPLOW,PMCUGNAM     * Upper case given name
.
              STRIP     KEY40               * Remove trailing spaces
              MOVELPTR  KEY40,F2            * Length of search given name
              SETLPTR   PMCUGNAM,F2         * Set legnth to same as search
.
              MATCH     KEY40,PMCUGNAM      * Skip if less than search
              GOTO      CURPAT10 IF LESS
. 
              CMATCH    PMCUGNAM,SRCHGNAM   * Same first character
              GOTO      CURPAT10 IF NOT EQUAL
.
              GOTO      CURPAT11
            ENDIF
          ENDIF
.
          MATCH     SP70,SRCHGNAM
          IF        !@EQUAL
            CMATCH    PMCUGNAM,SRCHGNAM
            GOTO      CURPAT99 IF NOT EQUAL
          ENDIF
.
CURPAT11  RESET     PMCUGNAM
.
          MATCH     "1",PMCUSYST            * ED visit
          IF        @EQUAL
            MATCH     "1",NOEDVIST          * Do not show ED visit
            IF        @EQUAL
              GOTO      CURPAT10       
            ENDIF
.
            PACK      KEY8,PMCUVISN,SP70
            CALL      RDEMVIS1
            BRANCH    OVRCD,CURPAT10
.
            COMPARE   FOUR,EMVISTAT         * Skip cancelled ED visits
            GOTO      CURPAT10 IF EQUAL
          ENDIF
.
          MATCH     "1",PTCNCHRT            * Display chart only OP visits
          GOTO      CURPAT12 IF NOT EQUAL
.
          MATCH     "2",PMCUSYST            * OP Visit
          GOTO      CURPAT12 IF NOT EQUAL
.
          CALL      COTFIL00                * Check outpatient file prefix
.
          PACK      KEY36,PMCUVISN,SP70
          CALL      RDSBOKA6                * Read OP booking
          CALL      RDKBOKA6
          BRANCH    OVRCD,CURPAT10
.
          MATCH     DOBAOUTN,PMCUVISN       * Correct visit number
          GOTO      CURPAT10 IF NOT EQUAL
.
          MOVE      "CV",CATEGORY
          MOVE      OBAVISIT,CODE           * Get slot type
          CALL      GETCOD00
.
          MATCH     ANSC,TCINDC8            * Skip chart only
          GOTO      CURPAT10 IF EQUAL
.
CURPAT12  IF        STARTNUM>RECNUMB
            ADD       ONE,RECNUMB
            GOTO      CURPAT10
          ENDIF
.
          IF        DISNUMB>=NORECORD
            GOTO      CURPAT99
          ENDIF

          MATCH     SP70,PATTYPEF
          IF        @EQUAL
            GOTO      CURPAT15
          ENDIF

          MATCH     PMCUSYST,PATTYPEF
          IF        !@EQUAL
            GOTO      CURPAT10
          ENDIF
.
CURPAT15  MOVE      PMCUSYST,F1
          LOAD      VISTYPE,F1,EMRVIS,OUTVIS,INPVIS,BOKVIS,INVVIS:
                       INVVIS,INVVIS,EVTVIS,ALLVIS
.
          BRANCH    F1,CURPAT20,CURPAT30,CURPAT40,CURPAT70,CURPAT10:
                       CURPAT10,CURPAT10,CURPAT50,CURPAT60
.
CURPAT20  CALL      EMRDET00
          GOTO      CURPAT10
.
CURPAT30  CALL      OUTDET00
          GOTO      CURPAT10
.
CURPAT40  CALL      INPDET00
          GOTO      CURPAT10
.
CURPAT50  CALL      EVTDET00
          GOTO      CURPAT10
.
CURPAT60  CALL      ALLDET00
          GOTO      CURPAT10
.
CURPAT70  CALL      BOKDET00
          GOTO      CURPAT10
.
CURPAT99  RETURN
+
.*************************************************************************
.* Current Patient Heading                                               *
.*************************************************************************
CPHEAD00  BRANCH     STARTFLG,CPHEAD09
          MOVE       ONE,STARTFLG
          WRITE      HTMLFILE;"<table width=100% border=1 cellspacing=0 ":
                            "cellpadding=1 style=#"table-layout: fixed;#">"
.
          MOVE       ZERO,FORM1
.
          WRITE      HTMLFILE;"<tr>":  
                              "<td class=HeadingCell width=200>Patient</td>":
                              "<td class=HeadingCell width=35>Type</td>";
.
          MATCH      SP70,DISPWACL
          IF         @EQUAL
            WRITE      HTMLFILE;"<td class=HeadingCell width=260>Ward</td>";
            COMPARE   "1",IBCNMHOS  
            IF        @EQUAL
              WRITE    HTMLFILE;"<td class=HeadingCell width=160>Hospital</td>";
            ENDIF
          ELSE
            WRITE      HTMLFILE;"<td class=HeadingCell width=100>Ward</td>"; 
          ENDIF
.
          MATCH     "1",PTCNDUNT    * do not display unit?
          IF        !@EQUAL
            WRITE      HTMLFILE;"<td class=HeadingCell width=160>Unit</td>";
          ENDIF
.
          WRITE      HTMLFILE;"<td class=HeadingCell width=70>Adms.Date<br>": 
                                                             "Adms.Time</td>":
                              "<td class=HeadingCell width=70>Disc.Date<br>":
                                                             "Disc.Time</td>":
                              "<td class=HeadingCell width=60>Ext.</td>":
                              "<td class=HeadingCell id=disTitle":
                                   " name=disTitle width=140>":
                                   "Disc.Dest.<br />/Condition</td>":
                              "<td class=HeadingCell width=60>U/R<br />Number</td>":
                              "</tr>"
CPHEAD09  RETURN
+
.--------------------------------------------------------------------------
.* Current Patient Heading for no ED visits
.--------------------------------------------------------------------------
CPHEAD10  BRANCH     STARTFLG,CPHEAD19
          MOVE       ONE,STARTFLG
          WRITE      HTMLFILE;"<table width=100% border=1 cellspacing=0 ":
                            "cellpadding=1 style=#"table-layout: fixed;#">"
.
          MOVE       ZERO,FORM1
.
          WRITE      HTMLFILE;"<tr>":
                              "<td class=HeadingCell width=200>Patient</td>":
                              "<td class=HeadingCell width=35>Type</td>";
.
          MATCH      SP70,DISPWACL
          IF         @EQUAL
            WRITE      HTMLFILE;"<td class=HeadingCell width=120>Ward</td>";
            COMPARE   "1",IBCNMHOS
            IF        @EQUAL
              WRITE    HTMLFILE;"<td class=HeadingCell width=120>Hospital</td>";
            ENDIF
          ELSE
            WRITE      HTMLFILE;"<td class=HeadingCell width=120>Ward</td>";
          ENDIF
.
          MATCH     "1",PTCNDUNT    * do not display unit?
          IF        !@EQUAL
            WRITE      HTMLFILE;"<td class=HeadingCell width=100>Unit</td>";
          ENDIF
.
          WRITE      HTMLFILE;"<td class=HeadingCell width=150>Patient Condition</td>";
.
          WRITE      HTMLFILE;"<td class=HeadingCell width=70>Adms.Date<br>":
                                                             "Adms.Time</td>":
                              "<td class=HeadingCell width=70>Disc.Date<br>":
                                                             "Disc.Time</td>":
                              "<td class=HeadingCell width=60>Ext.</td>":
                              "<td class=HeadingCell id=disTitle":
                                   " name=disTitle width=140>":
                                   "Disc.Dest.<br />/Condition</td>":
                              "<td class=HeadingCell width=60>U/R<br />Number</td>":
                              "</tr>"
CPHEAD19  RETURN
+
.------------------------------------------------------------
. Print line
.------------------------------------------------------------
PRLIN000  REP       " +",URNUMBER
          REP       " +",ADMISSNO
          WRITE      HTMLFILE;"<tr valign=top><td>":
                              "<table><tr valign=top><td>";
.
          WRITE     HTMLFILE;"<a href=",LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO,">";
.
          CALL      PATFLD00
          WRITE     HTMLFILE;"<img src=../images/PatientFolder",KEY3,".gif":
                             " class=Icon></a>":
                             "</td>";
.
          WRITE     HTMLFILE;"<td>",SRCHCL01,"</td></tr></table></td>"
.
          MATCH     SP70,SRCHCL02
          IF        @EQUAL
             MOVE     NBSP,SRCHCL02
          ENDIF
.
          MATCH     SP70,SRCHCL03
          IF        @EQUAL
             MOVE     NBSP,SRCHCL03
          ENDIF
.
          MATCH     SP70,SRCHCL04
          IF        @EQUAL
             MOVE     NBSP,SRCHCL04
          ENDIF
.
          MATCH     SP70,SRCHCL05
          IF        @EQUAL
             MOVE     NBSP,SRCHCL05
          ENDIF
.
          MATCH     SP70,SRCHCL06
          IF        @EQUAL
             MOVE     NBSP,SRCHCL06
          ENDIF
.
          MATCH     SP70,SRCHCL07
          IF        @EQUAL
             MOVE     NBSP,SRCHCL07
          ENDIF
.
          MATCH     SP70,SRCHCL08
          IF        @EQUAL
             MOVE     NBSP,SRCHCL08
          ENDIF
.
          MATCH     SP70,SRCHCL09
          IF        @EQUAL
             MOVE     NBSP,SRCHCL09
          ENDIF
.
          MATCH     SP70,SRCHCL10
          IF        @EQUAL
             MOVE     NBSP,SRCHCL10
          ENDIF
.
          MATCH     SP70,SRCHCL11
          IF        @EQUAL
             MOVE     NBSP,SRCHCL11
          ENDIF
.
          MATCH     SP70,SRCHCL12
          IF        @EQUAL
             MOVE     NBSP,SRCHCL12
          ENDIF
.
          MATCH     SP70,SRCHCL19
          IF        @EQUAL
             MOVE     NBSP,SRCHCL19
          ENDIF
.
          MATCH     SP70,SRCHCL20
          IF        @EQUAL
             MOVE     NBSP,SRCHCL20
          ENDIF
.
          MATCH     SP70,SRCHCL22
          IF        @EQUAL
             MOVE     NBSP,SRCHCL22
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      PMCUSYST,FORM1
          BRANCH    FORM1,PRLIN020,PRLIN010,PRLIN050,PRLIN080,PRLIN999:
                          PRLIN999,PRLIN999,PRLIN030,PRLIN040
.
.         Outpatient
.
PRLIN010  WRITE     HTMLFILE;"<td>",VISTYPE,"</td>";
          WRITE     HTMLFILE;"<td>",SRCHCL02,"</td>";
.
          MATCH     SP70,DISPWACL
          IF        @EQUAL
            COMPARE   ONE,IBCNMHOS
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>",SRCHCL22,"</td>";
            ENDIF
          ENDIF
.
          MATCH     "1",PTCNDUNT
          IF        !@EQUAL
            WRITE     HTMLFILE;"<td>",SRCHCL03,"</td>";
          ENDIF
.
          MATCH     "1",NOEDVIST
          IF        @EQUAL
            CALL      PTCOND00
          ENDIF
. 
          WRITE     HTMLFILE;"<td width=70>",SRCHCL05,SP1,SRCHCL06,"</td>":
                             "<td width=70>",SRCHCL09,SP1,SRCHCL10,"</td>";
.
. Check 'release to' fields (show alert icon if necessary)
.
          IF        RELTFLAG=1
              WRITE     HTMLFILE;"<td><img src=../images/release.gif":
                           " class=Icon alt='Check Consent Information'></td>";
          ELSE
              WRITE     HTMLFILE;"<td>",NBSP,"</td>";
          ENDIF
          WRITE     HTMLFILE;"<td>",SRCHCL08,"</td>":
                             "<td>",SRCHCL07,"</td>";
.
          WRITE     HTMLFILE;"</tr>"           * end of row 
.>>>>
          GOTO      PRLIN999
.
.         Emergency
.
PRLIN020  WRITE     HTMLFILE;"<td>",VISTYPE,"</td>";
          WRITE     HTMLFILE;"<td>",SRCHCL02,"</td>";
.
          MATCH     SP70,DISPWACL
          IF        @EQUAL
            COMPARE   ONE,IBCNMHOS
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>",SRCHCL22,"</td>";
            ENDIF
          ENDIF
.
          MATCH     "1",PTCNDUNT   * do not display unit?
          IF        !@EQUAL
            WRITE     HTMLFILE;"<td>",SRCHCL09,"</td>";
          ENDIF
.
          MATCH     "1",NOEDVIST
          IF        @EQUAL
            WRITE     HTMLFILE;"<td></td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",SRCHCL03,SP1,SRCHCL04,"</td>":
                             "<td>",SRCHCL05,SP1,SRCHCL06,"</td>";
.
. Check 'release to' fields (show alert icon if necessary)
.
          WRITE     HTMLFILE;"<td>",NBSP;
          IF        RELTFLAG=1
            WRITE     HTMLFILE;"<img src=../images/release.gif":
                           " class=Icon alt='Check Consent Information'>";
          ENDIF
          WRITE     HTMLFILE;"</td>";
.
          WRITE     HTMLFILE;"<td>",SRCHCL07,"</td>":
                             "<td>",SRCHCL08,"</td>";

          WRITE     HTMLFILE;"</tr>"           * end of row 
.>>>>
          GOTO      PRLIN999
.
.         Event
.
PRLIN030  WRITE     HTMLFILE;"<td>",VISTYPE,"</td>";
.
          MATCH     NBSP,SRCHCL02
          IF        @EQUAL
            WRITE     HTMLFILE;"<td>",SRCHCL03,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>",SRCHCL02,"<br />",SRCHCL03,"</td>";
          ENDIF
.
          MATCH     SP70,DISPWACL
          IF        @EQUAL
            COMPARE   ONE,IBCNMHOS
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>",SRCHCL22,"</td>";
            ENDIF
          ENDIF
.
          MATCH     "1",PTCNDUNT
          IF        !@EQUAL
            WRITE     HTMLFILE;"<td>",SRCHCL04,"</td>";
          ENDIF
.
          MATCH     "1",NOEDVIST
          IF        @EQUAL
            CALL      PTCOND00
          ENDIF
.
          WRITE     HTMLFILE;"<td>",SRCHCL06,"<br />",SRCHCL07,"</td>":
                             "<td>",SRCHCL09,"<br />",SRCHCL10,"</td>";
.
. Check 'release to' fields (show alert icon if necessary)
.
          WRITE     HTMLFILE;"<td>",SRCHCL12;
          IF        RELTFLAG=1
            WRITE     HTMLFILE;"<img src=../images/release.gif":
                           " class=Icon alt='Check Consent Information'>";
          ENDIF
          WRITE     HTMLFILE;"</td>";
.
.>>>>
          WRITE     HTMLFILE;"<td>";
          MATCH     NBSP,SRCHCL11
          IF        !@EQUAL
            WRITE     HTMLFILE;SRCHCL11,"<br />";
          ENDIF
.
          MATCH     SP70,SRCHCL13                * Condition
          IF        !@EQUAL
            WRITE     HTMLFILE;SRCHCL13,"<br />";
          ENDIF
.
          MATCH     SP70,SRCHCL14                * Condition Comments
          IF        !@EQUAL
            WRITE     HTMLFILE;SRCHCL14,"<br />";
          ENDIF
.
          STRIP     SRCHCL16                    * Compress Phone/Visitor
          STRIP     SRCHCL17                    * Output with Last Update
          MOVE      SRCHCL17,DIM70                                     *I-54756
          PACK      SRCHCL17,LSQBRKT,DIM70,COMMA,NBSP,SRCHCL16,RSQBRKT *C-54756
          WRITE     HTMLFILE;SRCHCL17
          WRITE     HTMLFILE;SRCHCL18,"<br />"
          MATCH     SP70,SRCHCL13               * Only print date and time
          GOTO      PRLIN032 IF NOT EQUAL       * if some comments are displayed
.
          MATCH     SP70,SRCHCL14
          GOTO      PRLIN032 IF NOT EQUAL

          GOTO      PRLIN035
.
PRLIN032  MATCH     SP70,SRCHCL15                * Date Time Stamp
          IF        !@EQUAL
            WRITE     HTMLFILE;SRCHCL15;
          ENDIF
.
PRLIN035  WRITE     HTMLFILE;"&nbsp;</td>";
.
          WRITE     HTMLFILE;"<td>",SRCHCL08,"</td>"; 
          WRITE     HTMLFILE;"</tr>"           * end of row 
          GOTO      PRLIN999
.
.         Allied Health
.
PRLIN040  WRITE     HTMLFILE;"<td>",VISTYPE,"</td>";
.
          WRITE     HTMLFILE;"<td>",SRCHCL02,"</td>";
          MATCH     "1",PTCNDUNT
          IF        !@EQUAL
            WRITE     HTMLFILE;"<td>",SRCHCL03,"</td>";
          ENDIF
.
          MATCH     SP70,DISPWACL
          IF        @EQUAL
            COMPARE   ONE,IBCNMHOS
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>",SRCHCL22,"</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<td>",SRCHCL04,"</td>":
                             "<td>",NBSP,"</td>";
.
          MATCH     "1",NOEDVIST
          IF        @EQUAL
            CALL      PTCOND00
          ENDIF
.
. Check 'release to' fields (show alert icon if necessary)
.
          WRITE     HTMLFILE;"<td>",SRCHCL05;
          IF        RELTFLAG=1
            WRITE     HTMLFILE;"<img src=../images/release.gif":
                           " class=Icon alt='Check Consent Information'>";
          ENDIF
          WRITE     HTMLFILE;"</td>";
.

          WRITE     HTMLFILE;"<td>",SRCHCL06,"</td>";
          WRITE     HTMLFILE;"<td>",SRCHCL07,"</td>";
          WRITE     HTMLFILE;"</tr>"           * end of row 
.>>>>
          GOTO      PRLIN999
.
.
.         Inpatient
.
PRLIN050  PACK      DCRPSTAT,SP70
          IF        PTCNHDPS=1
.                     * nz only 
            LOAD      DCRPSTAT,ASTAT,_PREADMN:  * pre admission
                                     _CURADMN:  * current admission
                                     _DISCHRG:  * discharge
                                     _ONLEAVE:  * on leave
                                     _CANCELL   * cancel
          ENDIF
.
          WRITE     HTMLFILE;*+,"<td>",SRCHCL19,DCRPSTAT,"</td>";
          WRITE     HTMLFILE;"<td>",SRCHCL02,"</td>";
.
          MATCH     SP70,DISPWACL
          IF        @EQUAL
            COMPARE   ONE,IBCNMHOS
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>",SRCHCL22,"</td>";
            ENDIF
          ENDIF
. 
          MATCH     "1",PTCNDUNT  * do not display unit? 
          IF        !@EQUAL
            WRITE     HTMLFILE;"<td>",SRCHCL03,"</td>";
          ENDIF
.
          MATCH     "1",NOEDVIST
          IF        @EQUAL
            CALL      PTCOND00
          ENDIF
.
          IF        KIDSONLY=ONE
            WRITE     HTMLFILE;"<td>",SRCHCL04,"</td>":
                               "<td>",SRCHCL05,"</td>":
                               "<td>",SRCHCL06,"</td>":
                               "<td>",SRCHCL07,"</td>":
                               "<td>",SRCHCL08,"<br />",SRCHCL18,"</td>";
            WRITE     HTMLFILE;"<td>";
            MATCH     NBSP,SRCHCL09
            IF        !@EQUAL
              WRITE     HTMLFILE;SRCHCL09,"<br />"; 
            ENDIF
            WRITE     HTMLFILE;SRCHCL11,"<br />",SRCHCL12;
            MATCH     SP70,SRCHCL13
            IF        !@EQUAL
              WRITE    HTMLFILE;"<br />",SRCHCL13;
            ENDIF
            WRITE     HTMLFILE;"</td>";
            GOTO      PRLIN055
          ENDIF 
.
. Anyone but kids: 
.     

          WRITE     HTMLFILE;"<td>",SRCHCL04,"<br />":
                                    SRCHCL05,"</td>":
                             "<td>",SRCHCL06,"<br />":
                                    SRCHCL07,"</td>";
 
.
.           Check 'release to' fields (show alert icon if necessary)
.
          WRITE     HTMLFILE;"<td>",SRCHCL08,SRCHCL21,"<br />",SRCHCL18;
          MATCH     SP70,PTMXDEAF
          IF        !@EQUAL
            PACK      TCINDC1,SP70
            PACK      KEY5,ANSD,ANSK,PTMXDEAF,SP70
            CALL      RDCODE1
            MATCH     ANSD,TCINDC1
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src=../images/deaf.gif":
                           " class=Icon alt='Hearing Status'>";
            ENDIF
          ENDIF
          IF        RELTFLAG=1
            WRITE     HTMLFILE;"<img src=../images/release.gif":
                        " class=Icon alt='Check Consent Information'>";
          ENDIF
          WRITE     HTMLFILE;"</td>";
.
          WRITE     HTMLFILE;"<td>";
          MATCH     NBSP,SRCHCL09               * Discharge Destination
          IF        !@EQUAL
            WRITE     HTMLFILE;SRCHCL09;
          ELSE
            MATCH     SP70,SRCHCL14             * OR ( Patient Condition (CO)
            IF        !@EQUAL
              WRITE     HTMLFILE;SRCHCL14,"<br />";
            ENDIF
            MATCH     SP70,SRCHCL15             *      AND Pat.Cond (desc)
            IF        !@EQUAL
              WRITE     HTMLFILE;SRCHCL15,"<br />";
            ENDIF
            MATCH     SP70,SRCHCL17             *      AND Last Updt tstamp)
            IF        !@EQUAL
              WRITE     HTMLFILE;SRCHCL17,"<br />";
            ENDIF
            STRIP     SRCHCL12                    * Compress Phone/Visitor
            STRIP     SRCHCL11                    * Output with Last Update
            MOVE      SRCHCL11,DIM70                                 *I-54756
            PACK      SRCHCL11,LSQBRKT,SRCHCL12,COMMA,NBSP,DIM70,RSQBRKT
            WRITE     HTMLFILE;SRCHCL11,NBSP,NBSP,SRCHCL16;
            MATCH     SP70,SRCHCL13
            IF        !@EQUAL
              WRITE    HTMLFILE;"<br />",SRCHCL13;
            ENDIF
          ENDIF
          WRITE     HTMLFILE;"</td>";
.
.
PRLIN055  MATCH     NBSP,SRCHCL10
          IF        @EQUAL
            MOVE      "&nbsp;",SRCHCL10
          ENDIF
          WRITE     HTMLFILE;"<td>",SRCHCL10,"</td>";
.
          WRITE     HTMLFILE;"</tr>"           * end of row 
          GOTO      PRLIN999
.
.         Booking  
.
PRLIN080  WRITE     HTMLFILE;"<td>",VISTYPE,"</td>";
          WRITE     HTMLFILE;"<td>",SRCHCL02,"<br />",SRCHCL03,"</td>";
.
          MATCH     SP70,DISPWACL
          IF        @EQUAL
            COMPARE   ONE,IBCNMHOS
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>",SRCHCL22,"</td>";
            ENDIF
          ENDIF
.
          MATCH     "1",NOEDVIST
          IF        @EQUAL
            CALL      PTCOND00
          ENDIF
.
          WRITE     HTMLFILE;"<td>",SRCHCL04,SRCHCL05,"&nbsp;</td>";
          WRITE     HTMLFILE;"<td>",SRCHCL06,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;</td>";
          WRITE     HTMLFILE;"<td>&nbsp;</td>";
          WRITE     HTMLFILE;"<td>",SRCHCL10,"</td>";
.
          GOTO      PRLIN999
.
PRLIN999  RETURN
.
.--------------------------------------------------------------------------
. Create a patient condition column  
.--------------------------------------------------------------------------
PTCOND00  WRITE     HTMLFILE;"<td>";
.
          PACK      KEY6,AWARD,SP70
          CALL      RDWARD1
          MOVE      WCLASS,SAVCLASS
.
. No Bed
.
PTCOND01  MOVE      1,FILETYPE
          PACK      KEY13,AWARD,PMCUVISN,SP70
          CALL      RDSNOBE1
PTCOND02  CALL      RDKNOBE1                * read next record
          BRANCH    OVRCD,PTCOND03
.
          MATCH     AWARD,NBWARD         * same ward?
          GOTO      PTCOND03 IF NOT EQUAL
.
          MATCH     PMCUVISN,DNBADMNO
          GOTO      PTCOND03 IF NOT EQUAL
.
          MOVE      PMCUVISN,ADMISSNO
          MOVE      NBROOM,WBED
          GOTO      PTCOND30
.
. Ward/Bed Details
.
PTCOND03  MOVE      2,FILETYPE
          PACK      KEY14,PMCUVISN,AWARD,SP70
          CALL      RDSWARD2
PTCOND04  CALL      RDKWARD2
          BRANCH    OVRCD,PTCOND09
.
          MATCH     AWARD,WWARD
          GOTO      PTCOND09 IF NOT EQUAL
.
          MATCH     PMCUVISN,DWADMNO
          GOTO      PTCOND09 IF NOT EQUAL
.
          MATCH     SP70,WBED
          GOTO      PTCOND04 IF EQUAL
.
PTCOND08  BRANCH    WACTIVE,PTCOND04       * Do not display Inactive Beds
          MOVE      PMCUVISN,ADMISSNO 
          GOTO      PTCOND30 
.
. On Leave Patients
.
PTCOND09  MOVE      3,FILETYPE
          PACK      KEY14,PMCUVISN,AWARD,SP70
          CALL      RDSONLV2
PTCOND10  CALL      RDKONLV2
          BRANCH    OVRCD,PTCOND12
.
          MATCH     AWARD,OWARD
          GOTO      PTCOND12 IF NOT EQUAL
.
          MATCH     PMCUVISN,DOADMNO
          GOTO      PTCOND12 IF NOT EQUAL
.
          MOVE      PMCUVISN,ADMISSNO
          MOVE      OBED,WBED
.
          PACK      KEY6,AWARD,WBED,SP70      * Read Ward/Bed file
          CALL      RDWARD1
          GOTO      PTCOND30
.
PTCOND12  MOVE      0,FILETYPE
.
PTCOND30  CALL      GTCOND00
.
          MATCH     SP70,CONDESC
          IF        !@EQUAL
            UNPACK    LPCDATE,CCENT,CYEAR,CMON,CDAY
            PACK      DISPDATE,LBRACKT,CDAY,SLASH,CMON,SP1,LPCTIME,RBRACKT
          ELSE
            CLEAR     DISPDATE
          ENDIF
.
          MOVE      ZERO,EXIT
          PROC      DISPALRT                * check for Disability Alerts
.
PTCOND32  MATCH     "1",PMPXSIN7
          IF        @EQUAL
            WRITE     HTMLFILE;"<img src='../images/AlertIconM.gif'>"
          ENDIF
.
          MATCH     "1",PMPXSIN8
          IF        @EQUAL
            WRITE     HTMLFILE;"<img src='../images/AlertIconB.gif'>"
          ENDIF
.
          MATCH     "1",PMPXSIN9
          IF        @EQUAL
            WRITE     HTMLFILE;"<img src='../images/AlertIconR.gif'>"
          ENDIF
.
          MATCH     "1",PMPXSN11
          IF        @EQUAL
            WRITE     HTMLFILE;"<img src='../images/AlertIconC.gif'>"
          ENDIF
.
          IF        EXIT=0 | EXIT=2
            MATCH     "1",PTMXSIN1
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIcon.gif'>"
              GOTO      PTCOND40
            ENDIF
.
            MATCH     "2",PTMXSIN1
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIconBlack.gif'>"
              GOTO      PTCOND40
            ENDIF
.
            MATCH     "3",PTMXSIN1
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIconDelete.gif'>"
              GOTO      PTCOND40
            ENDIF
.
            MATCH     SP70,PTMXSIN1
            IF        !@EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIcon":
                                 PTMXSIN1,".gif'>"
            ENDIF
          ENDIF
.
PTCOND40  IF        EXIT=1 | EXIT=2
            WRITE     HTMLFILE;"<img src='../images/AlertIconDIS.gif'>"
          ENDIF
.
          CALL      CMHL0000              * Check for MH legal status icon
.
          MATCH     SP70,PTMXSIN3
          IF        !@EQUAL
            WRITE     HTMLFILE;"<img src='../images/NotesIcon.gif'>"
          ENDIF
.
          MATCH     SP70,LPCONDD
          IF        @EQUAL
            MATCH     SP70,PMVXUDF2
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/",IMGSRC:
                                 "'>":
                                 CONDESC,DISPDATE;
            ELSE
              WRITE     HTMLFILE;"<img src='../images/",IMGSRC:
                                 "'>":
                                 CONDESC,DISPDATE,"<br>",PMVXUDF2;
            ENDIF
          ELSE
            MATCH     SP70,PMVXUDF2
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/",IMGSRC:
                                 "'>":
                                 CONDESC,DISPDATE,"<br>",LPCONDD;
            ELSE
              WRITE     HTMLFILE;"<img src='../images/",IMGSRC:
                                 "'>":
                                 CONDESC,DISPDATE,"<br>",LPCONDD:
                                 "<br>",PMVXUDF2;
            ENDIF
          ENDIF
.
PTCOND50  MOVE      ANSR,DIM1
          MATCH     "1",PMVXVALW
          IF        @EQUAL
            MOVE      ANSV,DIM1
          ENDIF
          WRITE     HTMLFILE;"<br>[",DIM1,COMMA,NBSP;
.
          MOVE      ANSN,DIM1
          MATCH     "1",PMVXPALW
          IF        @EQUAL
            MOVE      ANSP,DIM1
          ENDIF
          WRITE     HTMLFILE;DIM1;
.
PTCOND51  MATCH     "1",PMVXPALW            * Phone Calls Allowed?
          GOTO      PTCOND54 IF NOT EQUAL   * no; close off output
.
. No Bed...
.
          IF        FILETYPE=1
            PACK      KEY6,NBWARD,NBROOM,SP20
            CALL      RDWARD1
            BRANCH    OVRCD,PTCOND54
          ENDIF
.
. No Bed/On Leave
.
          IF        FILETYPE=1 | FILETYPE=3
            MATCH     SP70,PTWDNSTA
            IF        !@EQUAL
              MOVE      PTWDNSTA,NURSTCOD   * Has a linked Nursing Station
              CALL      WNURN000            * get Nursing Station number
              MATCH     SP70,NURSTNUM
              IF        !@EQUAL
                STRIP     NURSTNUM
                WRITE     HTMLFILE;" - ",*+,NURSTNUM,*-;
              ELSE
                MATCH     SP70,WEXTN
                IF        !@EQUAL
                  STRIP     WEXTN
                  WRITE     HTMLFILE;" - ",*+,WEXTN,*-;
                ENDIF
              ENDIF
            ELSE
              MATCH     SP70,WEXTN
              IF        !@EQUAL
                STRIP     WEXTN
                WRITE     HTMLFILE;" - ",*+,WEXTN,*-;
              ENDIF
            ENDIF
          ENDIF
.
. Bed/Ward          
.
          IF        FILETYPE=2
            MATCH     SP70,WEXTN
            IF        !@EQUAL
              STRIP     WEXTN
              WRITE     HTMLFILE;" - ",*+,WEXTN,*-;   * default ward/bed ext. no
            ELSE
              MOVE      PTWDNSTA,NURSTCOD
              CALL      WNURN000            * get Nursing Station number
              MATCH     SP70,NURSTNUM
              IF        !@EQUAL
                STRIP     NURSTNUM
                WRITE     HTMLFILE;" - ",*+,NURSTNUM,*-;
              ENDIF
            ENDIF
          ENDIF
.
PTCOND54  WRITE     HTMLFILE;"]"
.
          MATCH     SP3,LPCONAM
          IF        !@EQUAL
            MOVE      "AM",CATEGORY
            MOVE      LPCONAM,CODE
            CALL      GETCOD00
            WRITE     HTMLFILE;NBSP,NBSP,TDESC;
          ENDIF
.
PTCOND60  MATCH     SP3,PMWODPST
          IF        !@EQUAL
            MOVE      "vi",CATEGORY
            MOVE      PMWODPST,CODE
            CALL      GETCOD00
            WRITE     HTMLFILE;NBSP,TDESC;
          ENDIF
.
          WRITE     HTMLFILE;"<img src='../images/mv_",MVFLAG:
                             ".png'>"
.
          CALL      PTLNK000 
.
PTCOND80  WRITE     HTMLFILE;"</td>";
.
PTCOND99  RETURN
.
.------------------------------------------------------------
. Get Patient Condition Details
.------------------------------------------------------------
GTCOND00  PACK      KEY88,PTMASNAM,PMPXFNAM,AADMNO
          CALL      RDLOCA1
          BRANCH    OVRCD,GTCOND10
.
          MATCH     SP70,LPCONDC
          GOTO      GTCOND15 IF EQUAL
.
          PACK      KEY5,CODECO,LPCONDC
          CALL      RDCODE1
          BRANCH    OVRCD,GTCOND15
          MOVE      TDESC,CONDESC
          MATCH     SP70,TCINDC1
          IF        @EQUAL
            MOVE      ZERO,TCINDC1
          ENDIF
          GOTO      GTCOND20
.
GTCOND10  MOVE      SP70,LPCONDD
          MOVE      SP70,LPCONDC
          MOVE      SP70,LPCDATE
          MOVE      SP70,LPCTIME
          MOVE      SP70,LPCONAM
GTCOND15  MOVE      SP70,CONDESC
          MOVE      ZERO,TCINDC1
.
GTCOND20  CLEAR     IMGSRC
          APPEND    "ConditionIcon_",IMGSRC
          IF        PCEASE=1
            APPEND    "D",IMGSRC
            MOVE      "Deceased",CONDESC
          ELSE
            APPEND    TCINDC1,IMGSRC
          ENDIF
          APPEND    ".gif",IMGSRC
          RESET     IMGSRC
.
GETCON50  PACK      KEY8,AADMNO,SP70
          CALL      RDPMWOR1
          IF        OVRCD=1
            CALL      CLPMWO00
            PACK      WORKDESC,SP70,SP70,SP70,SP70
            GOTO      GETCON80
          ENDIF
.
          PACK      WORKDESC,SP70,SP70,SP70,SP70
          CLEAR     WORKDESC
.
          MATCH     SP70,PMWOWDI1
          IF        !@EQUAL
            APPEND    "<br>",WORKDESC
            APPEND    PMWOWDI1,WORKDESC
          ENDIF
.
          MATCH     SP70,PMWOWDI2
          IF        !@EQUAL
            APPEND    "<br>",WORKDESC
            APPEND    PMWOWDI2,WORKDESC
          ENDIF
.
          MATCH     SP70,PMWOWDI3
          IF        !@EQUAL
            APPEND    "<br>",WORKDESC
            APPEND    PMWOWDI3,WORKDESC
          ENDIF
.
          APPEND    "&nbsp;",WORKDESC
          RESET     WORKDESC
.
GETCON80  MOVE      ZERO,MVFLAG
.
          PACK      KEY27,DAADMNO,SP70
          CALL      RSPTVEN1
GETCON82  CALL      RKPTVEN1
          BRANCH    OVRCD,GETCON99
.
          MATCH     DAADMNO,PTVEVISN
          GOTO      GETCON99 IF NOT EQUAL
.
          MATCH     SP70,PTVEEDAT
          GOTO      GETCON88 IF EQUAL
.
          MATCH     SP70,PTVEETIM
          GOTO      GETCON82 IF NOT EQUAL    * completed
.
GETCON88  MOVE      ONE,MVFLAG
.
GTCOND99  RETURN
.
.------------------------------------------------------------------------------
. Check if MH Legal status icon to be displayed
.------------------------------------------------------------------------------
CMHL0000  MATCH     SP70,SAVCLASS
          GOTO      CMHL9999 IF EQUAL         * blank ward classification
.
          PACK      KEY5,ANSC,ANSG,SAVCLASS
          CALL      RDCODE1
          BRANCH    OVRCD,CMHL9999
.
          MATCH     "M",TCINDC2
          GOTO      CMHL9999 IF NOT EQUAL
.
          REP       "+ ",URNUMBER
          PROC      CHKLEGST
          REP       " +",URNUMBER
          IF        EXIT=1
            WRITE     HTMLFILE;"<img src='../images/target1.gif'>"
          ENDIF
.
CMHL9999  RETURN
.
.------------------------------------------------------------------------------
. Get the Nursing Station extension number (for a Nursing Station code)
. Parameters:
.   NURSTCOD - Nursing Station code
. Returns:
.   NURSTNUM - Nursing Station extension number
.------------------------------------------------------------------------------
WNURN000  MOVE      SP70,NURSTNUM

          MATCH     SP70,NURSTCOD         * Nursing Station code specified?
          GOTO      WNURN999 IF EQUAL
.
          PACK      KEY6,NURSTCOD,SP70    * we don't use the ward number
                                          * therefore just pack with space
          CALL      RDNURS1
          IF        OVRCD=0
            MATCH     NSTAT,NURSTCOD
            IF        @EQUAL
              MATCH     SP70,NSEXTN
              IF        !@EQUAL
                MOVE      NSEXTN,NURSTNUM
              ENDIF
            ENDIF
          ENDIF
.
WNURN999  RETURN
.

..------------------------------------------------------------------------------
. Check if Patient link icon to be displayed
.------------------------------------------------------------------------------
PTLNK000  MOVE      ZERO,BORDICIN
          PACK      KEY26,ADMISSNO,SP70
          CALL      RSPTBRD3
PTLNK020  CALL      RKPTBRD3
          IF        OVRCD=0
            MATCH     ADMISSNO,PTBRVISN
            IF        @EQUAL
              MATCH     SP70,PTBREDAT
              IF        !@EQUAL & !@EOS
                MATCH     TODAYDAT,PTBREDAT
                GOTO      PTLNK020 IF LESS            
                GOTO      PTLNK030 IF NOT EQUAL      
.
                MATCH     SP70,PTBRETIM
                IF        !@EQUAL & !@EOS
                  MATCH     CTIMEIS,PTBRETIM
                  GOTO      PTLNK020 IF LESS     
                ENDIF
              ENDIF
PTLNK030      ADD       ONE,BORDICIN
              COMPARE   TWO,BORDICIN
              GOTO      PTLNK040 IF EQUAL
              GOTO      PTLNK020
            ENDIF
          ENDIF
.
PTLNK040  PACK      KEY26,ADMISSNO,SP70
          CALL      RSPTBRD3
PTLNK050  CALL      RKPTBRD3
          BRANCH    OVRCD,PTLNK999
. 
          MATCH     ADMISSNO,PTBRVISN
          GOTO      PTLNK999 IF NOT EQUAL
.
          MATCH     SP70,PTBREDAT
          IF        !@EQUAL & !@EOS
            MATCH     TODAYDAT,PTBREDAT
            GOTO      PTLNK050 IF LESS      
            GOTO      PTLNK060 IF NOT EQUAL 
.
            MATCH     SP70,PTBRETIM
            IF        !@EQUAL & !@EOS
              MATCH     CTIMEIS,PTBRETIM
              GOTO      PTLNK050 IF LESS   
            ENDIF
          ENDIF
.
PTLNK060  IF        BORDICIN=2
            WRITE     HTMLFILE;"<img src='../images/PatientLink4.gif'>"
          ELSE
            WRITE     HTMLFILE;"<img src='../images/PatientLink1.gif'>"
          ENDIF
.
PTLNK999  RETURN
+
.*************************************************************************
.*  EMRDET00  :  Output EMR visit details                                *
.*************************************************************************
EMRDET00  MOVE      ZERO,EXIT
          PACK      KEY8,PMCUVISN,SP70
          CALL      RDEMVIS1
          BRANCH    OVRCD,EMRDET90
.
          MOVE      ZERO,FNAMFLAG
          PACK      KEY8,EMVIURNO,SP70
          CALL      RDMAST1
          CALL      RDPMPX21
          PACK      KEY8,EMVIADMN
          CALL      RDEMUNK1
          IF        OVRCD=0
            CALL      RDPRAM1
            MOVE      "       0",PURNO
            MOVE      SP70,PTITL
            MOVE      EMUNDET2,PGNAME
            MOVE      EMUNDET1,PSNAME
.
            MATCH     SP70,EMUNBDAT
            IF        @EQUAL
              CALL      IBACLOCK
              PACK      PBDATE,CCC,CYY,CMM,CDD
              REP       " 0",PBDATE
            ELSE
              MOVE      EMUNBDAT,PBDATE
            ENDIF
.
            MOVE      EMUNSEX,PSEX
.
          ENDIF
.
          BRANCH    FNAMFLAG,EMRDET10
          CALL      PATNAM00
.
EMRDET10  MOVE      PMCUVISN,PVIBILL
          MOVE      PURNO,PVIURNO
          MOVE      PURNO,URNUMBER
          MOVE      PMCUSYST,PVITYPE
          CALL      GDET0000
          CALL      PRLIN000
          ADD       ONE,DISNUMB
          ADD       ONE,RECNUMB
          GOTO      EMRDET99
.
EMRDET90  MOVE      ONE,EXIT
.
EMRDET99  RETURN
+
.*************************************************************************
.*  OUTDET00  :  Output Outpatient visit details                         *
.*************************************************************************
OUTDET00  MOVE      ZERO,EXIT
.
          CALL      COTFIL00                     * Check outpatient file prefix
.
          PACK      KEY36,PMCUVISN,SP70
          CALL      RDSBOKA6
          CALL      RDKBOKA6
          BRANCH    OVRCD,OUTDET90
.
          MATCH     DOBAOUTN,PMCUVISN
          GOTO      OUTDET90 IF NOT EQUAL
.
          PACK      KEY8,OBAURNO,SP70
          CALL      RDMAST1
          CALL      RDPMPX21
          CALL      PATNAM00
.
          MOVE      PMCUVISN,PVIBILL
          MOVE      PURNO,PVIURNO
          MOVE      PURNO,URNUMBER
          MOVE      PMCUSYST,PVITYPE
          MOVE      OBASITE,PVISITE
          CALL      GDET0000
          CALL      PRLIN000
          ADD       ONE,DISNUMB
          ADD       ONE,RECNUMB
          GOTO      OUTDET99
.
OUTDET90  MOVE      ONE,EXIT
.
OUTDET99  RETURN
+
.*************************************************************************
.*  INPDET00  :  Output Inpatient visit details                          *
.*************************************************************************
INPDET00  MOVE      ZERO,EXIT
          PACK      SRCHCL19,VISTYPE,SP70
          PACK      KEY8,PMCUVISN,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,INPDET90
.
          COMPARE   TWO,ASTAT
          IF        @EQUAL
            PACK      SRCHCL19,HTMLSBLD,VISTYPE,HTMLEBLD
          ENDIF
          PACK      KEY8,AURNO,SP70
          CALL      RDMAST1
          CALL      RDPMPX21
          CALL      PATNAM00
.
          MOVE      PMCUVISN,PVIBILL
          MOVE      PURNO,PVIURNO
          MOVE      PURNO,URNUMBER
          MOVE      PMCUSYST,PVITYPE
          CALL      GDET0000
          CALL      PRLIN000
          ADD       ONE,DISNUMB
          ADD       ONE,RECNUMB
          GOTO      INPDET99
.
INPDET90  MOVE      ONE,EXIT
.
INPDET99  RETURN
+
.*************************************************************************
.*  BOKDET00  :  Booking visit details                                   *
.*************************************************************************
BOKDET00  MOVE      ZERO,EXIT
          PACK      SRCHCL19,VISTYPE,SP70
          PACK      KEY8,PMCUVISN,SP70
          CALL      RDBKREC1
          BRANCH    OVRCD,BOKDET90
.
          PACK      KEY8,BKREURNO,SP70
          CALL      RDMAST1
          CALL      RDPMPX21
          CALL      PATNAM00
.
          MOVE      PMCUVISN,PVIBILL
          MOVE      PURNO,PVIURNO
          MOVE      PURNO,URNUMBER
          MOVE      PMCUSYST,PVITYPE
          CALL      GDET0000
          CALL      PRLIN000
          ADD       ONE,DISNUMB
          ADD       ONE,RECNUMB
          GOTO      BOKDET99
.
BOKDET90  MOVE      ONE,EXIT
.
BOKDET99  RETURN
+
.*************************************************************************
.*  EVTDET00  :  Output Event visit details                              *
.*************************************************************************
EVTDET00  MOVE      ZERO,EXIT
          PACK      KEY8,PMCUVISN,SP70
          CALL      RDPMEVT1
          BRANCH    OVRCD,EVTDET90
.
          PACK      KEY8,PMCUVISN,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,EVTDET90
.
          PACK      KEY8,PVIURNO,SP70
          CALL      RDMAST1
          CALL      RDPMPX21
          CALL      PATNAM00
.
          MOVE      PMCUVISN,PVIBILL
          MOVE      PURNO,PVIURNO
          MOVE      PURNO,URNUMBER
          MOVE      "9",PVITYPE
          MOVE      " 1",PVISYST
          MOVE      PMEVEVNT,VISTYPE
          CALL      GDET0000
          CALL      PRLIN000
          ADD       ONE,DISNUMB
          ADD       ONE,RECNUMB
          GOTO      EVTDET99
.
EVTDET90  MOVE      ONE,EXIT
.
EVTDET99  RETURN
+
.*************************************************************************
.*  ALLDET00  :  Output Allied Health visit details                      *
.*************************************************************************
ALLDET00  MOVE      ZERO,EXIT
          PACK      KEY16,PMCUVISN,SP70
          CALL      RSALENC1
          CALL      RKALENC1
          BRANCH    OVRCD,ALLDET90
.
          MATCH     PMCUVISN,ALENVISN
          GOTO      ALLDET90 IF NOT EQUAL
.
          PACK      KEY8,ALENVISN,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,ALLDET90
.
          PACK      KEY8,ALREURNO,SP70
          CALL      RDMAST1
          CALL      RDPMPX21
          CALL      PATNAM00
.
          MOVE      PMCUVISN,PVIBILL
          MOVE      PURNO,PVIURNO
          MOVE      PURNO,URNUMBER
          MOVE      PMCUSYST,PVITYPE
          MOVE      " 2",PVISYST
          CALL      GDET0000
          CALL      PRLIN000
          ADD       ONE,DISNUMB
          ADD       ONE,RECNUMB
          GOTO      ALLDET99
.
ALLDET90  MOVE      ONE,EXIT
.
ALLDET99  RETURN
+
.------------------------------------------------------------
. U/R Search 
.------------------------------------------------------------
URNUM000  READ      CONTROLF,HUND10;*240,PTCNUALT
          COMPARE   ONE,PTCNUALT
          GOTO      URNUM999 IF NOT EQUAL
          CALL      SHEAD000
.
          UNPACK    ALTERNID,DIM12,KEY8
          CALL      RDMAST1
          IF        OVRCD<>1
            MOVE      PURNO,KEY8
            CALL      RDPMPX21
            IF        PSTAT=0
              MOVE      PURNO,GSRURNO
              MOVE      PBDATE,GSRDOB
              MOVE      PTMASNAM,GSRSNAM
              MOVE      PMPXFNAM,GSRGNAM
              MOVE      PMPXSNAM,PTGSGNM2
              MOVE      PSEX,GSRSEX
              CALL      DISPR000
            ENDIF
.
            IF        PSTAT=1
              PACK      KEY17,THREE,PURNO,SP70
              CALL      RSPTMRG1
              CALL      RKPTMRG1
              BRANCH    OVRCD,URNUM050
.
              COMPARE   THREE,PTMRSTAT
              GOTO      URNUM050 IF NOT EQUAL
.
              MATCH     PURNO,PTMROLUR
              GOTO      URNUM050 IF NOT EQUAL
.
              MOVE      PURNO,GSRURNO
              MOVE      PBDATE,GSRDOB
              MOVE      PTMASNAM,GSRSNAM
              MOVE      PMPXFNAM,GSRGNAM
              MOVE      PMPXSNAM,PTGSGNM2
              MOVE      PSEX,GSRSEX
              CALL      DISPR000    
            ENDIF
.
          ENDIF
.
URNUM050  PACK      KEY31,ALTERNID,SP70
          CALL      RSPMAID2
URNUM100  CALL      RKPMAID2
          BRANCH    OVRCD,URNUM999
.
          MATCH     PMAIALID,ALTERNID
          GOTO      URNUM999 IF NOT EQUAL
.
          PACK      KEY8,PMAIURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,URNUM100
.
          PACK      KEY8,PMAIURNO,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,URNUM100
.
          MOVE      PURNO,GSRURNO
          MOVE      PBDATE,GSRDOB
          MOVE      PTMASNAM,GSRSNAM
          MOVE      PMPXFNAM,GSRGNAM
          MOVE      PMPXSNAM,PTGSGNM2
          MOVE      PSEX,GSRSEX
          CALL      DISPR000
          GOTO      URNUM100
.
URNUM999  RETURN
.------------------------------------------------------------
. Link to Next Group
.------------------------------------------------------------
NEXT0000  IF        NORECORD = 0
            MOVE      10,NORECORD
          ENDIF
. 
          CALL      SETLNK00  * Set up Link
          BRANCH    FHIRTYPE,NEXT1000
.
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          WRITE     HTMLFILE;"patweb90.pbl?reportno=1":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&noedvist=",NOEDVIST:
                                 "&scndtime=",SCNDTIME:
                                 "&extnsrch=",EXTNSRCH:
                                 HTMLLINK;
          WRITE     HTMLFILE;"&showblhd=",SHOWBLHD;
          GOTO      NEXT9999
NEXT1000  IF        DISNUMB=NORECORD
            ASSIGN    STARTNUM+NORECORD,F6
            MOVE      F6,KEY6
            SQUEEZE   KEY6
            WRITE     HTMLFILE;*+,"nextpage=&startnum=",KEY6
          ENDIF
NEXT9999  RETURN
+
.------------------------------------------------------------
. Link to Last Group
.------------------------------------------------------------
LAST0000  IF        NORECORD = 0
            MOVE      10,NORECORD
          ENDIF
.
          CALL      SETLNK00  * Set up Link
          BRANCH    FHIRTYPE,LAST1000
.
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          WRITE     HTMLFILE;"patweb90.pbl?reportno=1":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&noedvist=",NOEDVIST:
                                 "&scndtime=",SCNDTIME:
                                 "&extnsrch=",EXTNSRCH:
                                 HTMLLINK;
          WRITE     HTMLFILE;"&showblhd=",SHOWBLHD;
          GOTO      LAST9999
.
LAST1000  ASSIGN    STARTNUM-NORECORD,F6
          IF        F6>=0
            MOVE      F6,KEY6
            SQUEEZE   KEY6
            WRITE     HTMLFILE;*+,"prevpage=&startnum=",KEY6
          ENDIF
LAST9999  RETURN
+
.------------------------------------------------------------
. Setup Link Detail
.------------------------------------------------------------
SETLNK00  CLEAR     HTMLLINK
          MATCH     SP70,SRCHADMN
          IF        !@EQUAL
            APPEND    "&srchadmn=",HTMLLINK
            APPEND    SRCHADMN,HTMLLINK
          ENDIF
          MATCH     SP70,SRCHSNAM
          IF        !@EQUAL
            APPEND    "&srchsnam=",HTMLLINK
            REP       "'~",SRCHSNAM
            STRIP     SRCHSNAM
            APPEND    SRCHSNAM,HTMLLINK
            REP       "~'",SRCHSNAM
          ENDIF
          MATCH     SP70,SRCHGNAM
          IF        !@EQUAL
            APPEND    "&srchgnam=",HTMLLINK
            REP       "'~",SRCHGNAM                                    *I-44200
            STRIP     SRCHGNAM
            APPEND    SRCHGNAM,HTMLLINK
            REP       "~'",SRCHGNAM                                    *I-44200
          ENDIF
          MATCH     SP70,SRCHPAGE
          IF        !@EQUAL
            APPEND    "&srchpage=",HTMLLINK
            STRIP     SRCHPAGE
            APPEND    SRCHPAGE,HTMLLINK
          ENDIF
          MATCH     SP70,SRCHPSEX
          IF        !@EQUAL
            APPEND    "&srchpsex=",HTMLLINK
            STRIP     SRCHPSEX
            APPEND    SRCHPSEX,HTMLLINK
          ENDIF
          MATCH     SP70,SRCHPDOB
          IF        !@EQUAL
            APPEND    "&srchpdob=",HTMLLINK
            UNPACK    SRCHPDOB,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY14,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
            REP       " +",KEY14
            APPEND    KEY14,HTMLLINK
          ENDIF
          MATCH     SP70,SRCHTYPE
          IF        !@EQUAL
            APPEND    "&srchtype=",HTMLLINK
            STRIP     SRCHTYPE
            APPEND    SRCHTYPE,HTMLLINK
          ENDIF
.
          IF        SRCHWAIT=1
            APPEND    "&srchwait=1",HTMLLINK
          ENDIF
.
          IF        SRCHEBST=1
            APPEND    "&srchebst=1",HTMLLINK
          ENDIF
.
          MATCH     SP70,SRCHARAN
          IF        !@EQUAL
            APPEND    "&srcharan=",HTMLLINK
            STRIP     SRCHARAN
            APPEND    SRCHARAN,HTMLLINK
          ENDIF
.
          MATCH     SP70,SRCHMEDI
          IF        !@EQUAL
            APPEND    "&srchmedi=",HTMLLINK
            STRIP     SRCHMEDI
            APPEND    SRCHMEDI,HTMLLINK
          ENDIF
.
          MATCH     SP70,SRCHSYST
          IF        !@EQUAL
            APPEND    "&srchsyst=",HTMLLINK
            STRIP     SRCHSYST
            APPEND    SRCHSYST,HTMLLINK
          ENDIF
.
          MATCH     SP70,SRCHHOSP
          IF        !@EQUAL
            APPEND    "&srchhosp=",HTMLLINK
            STRIP     SRCHHOSP
            APPEND    SRCHHOSP,HTMLLINK
          ENDIF
.
          COMPARE   ZERO,FILTFLAG
          IF        !@EQUAL
            APPEND    "&filtflag=",HTMLLINK
            APPEND    FILTFLAG,HTMLLINK
          ENDIF
.
          MATCH     SP70,CLINICAL
          IF        !@EQUAL
            APPEND    "&clinical=",HTMLLINK
            STRIP     CLINICAL
            APPEND    CLINICAL,HTMLLINK
          ENDIF
.
          RESET     HTMLLINK
          RETURN
.------------------------------------------------------------
. Format Patient Name in Title Text
.------------------------------------------------------------
PATNAA00  CLEAR     DISPNAME
          MOVE      SP70,PATFNAME
          PACK      NAME35,PTITL,SP70
          CALL      NAMSTR00
          PACK      NAME35,PGNAME,SP70
          CALL      NAMSTR00
          PACK      NAME35,PSNAME,SP70
          REP       UPPLOW,PSNAME
          APPEND    PSNAME,DISPNAME
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,PATFNAME
          STRIP     PATFNAME
          RETURN             
.------------------------------------------------------------
. Format Patient Name in Title Text
.------------------------------------------------------------
PATNAB00  CLEAR     DISPNAME
          MOVE      SP70,PATFNAME
          PACK      NAME35,PTITL,SP70
          CALL      NAMSTR00
          PACK      NAME35,PGNAME,SP70
          CALL      NAMSTR00
          PACK      NAME35,PSNAME,SP70
          CALL      NAMSTR00
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,PATFNAME
          STRIP     PATFNAME
          RETURN
.------------------------------------------------------------
. Format Patient Name <b>SURNAME</b>Title Given Names
.------------------------------------------------------------
PATNAM00  CLEAR     DISPNAME
          REP       "#" ",PSNAME
          REP       "#" ",PTMASNAM
          REP       "#" ",PGNAME
          MOVE      SP70,PATFNAME
          REP       UPPLOW,PSNAME
          REP       UPPLOW,PTMASNAM
          APPEND    "<b> ",DISPNAME
          MATCH     SP70,PTMASNAM
          IF        !@EQUAL
            STRIP     PTMASNAM
            APPEND    PTMASNAM,DISPNAME
          ELSE
            APPEND    PSNAME,DISPNAME
          ENDIF
          APPEND    " </b>",DISPNAME
          PACK      NAME35,PTITL,SP70
          CALL      NAMSTR00
          PACK      NAME35,PGNAME,SP70
          CALL      NAMSTR00
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,PATFNAME
          STRIP     PATFNAME
.
          RETURN
.
.*******************************************************************************
. OUTFIL00 - Check if the user id has an outpatienty site. If they do open
.            the correct outpatient files according to the site. If they do not
.            have a site make sure the default prefix of out is is used to
.            open the files.
.*******************************************************************************
OUTFIL00  MATCH     SP70,WBSESIT             * Does the user have a site
          GOTO      OUTFIL50 IF NOT EQUAL
.
OUTFIL10  MATCH     "out",CFILEPRE           * Is out currently open
          IF        !@EQUAL
            MOVE      "out",OSTFILE          * open default prefix of out
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open out Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL50  MOVE      WBSESIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,OUTFIL90           * error invalid site code
.
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL90  MOVE      "Outpatient Site Invalid",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
OUTFIL99  RETURN
.
.*******************************************************************************
. COTFIL00 - Check that the correct outpatient site prefix files are open
.            according to the visits site code. If the site is invalid
.            or blank just open the default site of out.

.*******************************************************************************
COTFIL00  MATCH     SP70,PMCUOSIT            * Does the visit have a site
          GOTO      COTFIL50 IF NOT EQUAL
.
COTFIL10  MATCH     "out",CFILEPRE           * Is out currently open
          IF        !@EQUAL
            MOVE      "out",OSTFILE          * open default prefix of out
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open out Outpatient Files
          ENDIF
.
          GOTO      COTFIL99
.
COTFIL50  MOVE      PMCUOSIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,COTFIL10           * error invalid site code
.
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          GOTO      COTFIL99
.
COTFIL99  RETURN
.
.------------------------------------------------------------------------------
. Remote Scripting for patient search
.------------------------------------------------------------------------------
REMOTE00  CALL      XMLHED00
          BRANCH    EXIT,REMOTE99
.
          BRANCH    REMOTENO,REMOTE10
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                    " INVALID UPDATE TYPE ":
                    "</RETURN_VALUE>"
          GOTO      REMOTE90
.
REMOTE10  CALL      CHID0000
          GOTO      REMOTE90
.
REMOTE90  CALL      XMLEND00
.
REMOTE99  RETURN
.
.-----------------------------------------------------------
. Check if more than one match exists for one ID
.-----------------------------------------------------------
CHID0000  MOVE      ZERO,AISEARCH
          MOVE      SP70,PURNO
          READ      CONTROLF,HUND10;*240,PTCNUALT
          COMPARE   ONE,PTCNUALT
          GOTO      CHID9999 IF NOT EQUAL
.
          UNPACK    ALTERNID,DIM12,KEY8
          CALL      RDMAST1
          IF        OVRCD<>1
            ADD       ONE,AISEARCH
          ENDIF
.
          PACK      KEY31,ALTERNID,SP70
          CALL      RSPMAID2
CHID1000  CALL      RKPMAID2
          BRANCH    OVRCD,CHID9999
.
          MATCH     PMAIALID,ALTERNID
          GOTO      CHID9999 IF NOT EQUAL
.
          MATCH     PURNO,PMAIURNO
          GOTO      CHID1000 IF EQUAL
.
          PACK      KEY8,PMAIURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,CHID1000
.
          ADD       ONE,AISEARCH
          GOTO      CHID1000
.
.
CHID9999  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                    AISEARCH,"|",PURNO:
                    "</RETURN_VALUE>"
          RETURN
.
.------------------------------------------------------------
. New Current Patient Search by system.
.------------------------------------------------------------
CURPTT00  MOVE      ZERO,DISNUMB
          PACK      SRCHSNAM,SRCHSNAM,SP70
.
          PACK      KEY97,SRCHSYST,SRCHSNAM,SRCHGNAM,SP70,SP70
          CALL      RSPMCUR5
CURPTT10  CALL      RKPMCUR5
          BRANCH    OVRCD,CURPTT99
.
          CMATCH    SRCHSYST,PMCUSYST       * System
          GOTO      CURPTT99 IF NOT EQUAL
.
          CMATCH    PMCUSURN,SRCHSNAM       * Surname
          GOTO      CURPTT99 IF NOT EQUAL
.
          IF        IBCNMHOS=1
            MATCH     SP70,SRCHHOSP
            IF        !@EQUAL
              MATCH     SRCHHOSP,PMCUHOSP     * Check hospital
              GOTO      CURPTT10 IF NOT EQUAL
            ELSE
              PACK      KEY13,USERID,SP70              * All hospital access
              CALL      RDMLSEC1
              IF        OVRCD=1
                PACK      KEY13,USERID,PMCUHOSP,SP70   * This hospital access
                CALL      RDMLSEC1
                BRANCH    OVRCD,CURPTT10
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     "1",PMCUSYST            * ED visit
          IF        @EQUAL
            PACK      KEY8,PMCUVISN,SP70
            CALL      RDEMVIS1
            BRANCH    OVRCD,CURPTT10
.
            COMPARE   FOUR,EMVISTAT         * Skip cancelled ED visits
            GOTO      CURPTT10 IF EQUAL
          ENDIF
.
          MATCH     "1",PTCNCHRT            * Display chart only OP visits
          GOTO      CURPTT12 IF NOT EQUAL
.
          MATCH     "2",PMCUSYST            * OP Visit
          GOTO      CURPTT12 IF NOT EQUAL
.
          CALL      COTFIL00                * Check outpatient file prefix
.
          PACK      KEY36,PMCUVISN,SP70
          CALL      RDSBOKA6                * Read OP booking
          CALL      RDKBOKA6
          BRANCH    OVRCD,CURPTT10
.
          MATCH     DOBAOUTN,PMCUVISN       * Correct visit number
          GOTO      CURPTT10 IF NOT EQUAL
.
          MOVE      "CV",CATEGORY
          MOVE      OBAVISIT,CODE           * Get slot type
          CALL      GETCOD00
.
          MATCH     ANSC,TCINDC8            * Skip chart only
          GOTO      CURPTT10 IF EQUAL
.
CURPTT12  CALL      CPHEAD00
.
          IF        STARTNUM>RECNUMB
            ADD       ONE,RECNUMB
            GOTO      CURPTT10
          ENDIF
.
          IF        DISNUMB>=NORECORD
            GOTO      CURPTT99
          ENDIF
.
          MOVE      PMCUSYST,F1
          LOAD      VISTYPE,F1,EMRVIS,OUTVIS,INPVIS,INVVIS,INVVIS:
                       INVVIS,INVVIS,EVTVIS,ALLVIS
.
          BRANCH    F1,CURPTT20,CURPTT30,CURPTT40,CURPTT10,CURPTT10:
                       CURPTT10,CURPTT10,CURPTT50,CURPTT60
.
CURPTT20  CALL      EMRDET00
          GOTO      CURPTT10
.
CURPTT30  CALL      OUTDET00
          GOTO      CURPTT10
.
CURPTT40  CALL      INPDET00
          GOTO      CURPTT10
.
CURPTT50  CALL      EVTDET00
          GOTO      CURPTT10
.
CURPTT60  CALL      ALLDET00
          GOTO      CURPTT10
.
CURPTT99  RETURN
.
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
HSEL0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSEL0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSEL9999
.
          PACK      KEY13,USERID,SP70                * All hospital access
          CALL      RDMLSEC1
          IF        OVRCD=1
            PACK      KEY13,USERID,PTHSHOSP,SP70     * This hospital access
            CALL      RDMLSEC1
            BRANCH    OVRCD,HSEL0100
          ENDIF
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
.
          MATCH     SRCHHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
.
          GOTO      HSEL0100
.
HSEL9999  RETURN
+
.--------------------------------------------------------------------------------
. Add Diagnosis Coding to Encounter (NOT REQUIRED FOR PATWEB90 Patient Seach)
. Function included to enable PATWEB90 to compile with FHRDATCD.
.--------------------------------------------------------------------------------
RESDIA00  
. 
RESDIA99  RETURN
.--------------------------------------------------------------------------------
. FHIR Encounter Resource Extra Type Related Data
.--------------------------------------------------------------------------------
RESEXT00
RESEXT99  RETURN
.--------------------------------------------------------------------------------
. Add Patient Contacts to FHIR Resource (NOT REQUIRED FOR PATWEB90 Patient Search)
. Function included to enable PATWEB90 to compile with FHRDATCD.
.--------------------------------------------------------------------------------
FHRCON00  
. 
FHRCON99  RETURN
.
.--------------------------------------------------------------------------
. DISPALRT - disability alert string
.--------------------------------------------------------------------------
          DEFPROC   DISPALRT
.
          INC       PATALRFD/INC
.
CURRDATE  DIM       8
.
          OPEN      PATALRT1,"patalrtf";
          OPEN      PATMWSA1,"patmwsaf";
.
          READ      CONTROLF,HUND14;*250,PTCNCUDA
.
          MATCH     SP70,PTCNCUDA
          GOTO      DSAL9000 IF EQUAL
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          PACK      KEY16,PURNO,ANSH,PTCNCUDA,SP70
          CALL      RSPTALR1
DSAL0500  CALL      RKPTALR1
          BRANCH    OVRCD,DSAL9000
.
          MATCH     PURNO,PTALURNO
          GOTO      DSAL9000 IF NOT EQUAL
.
          PACK      DIM2,ANSH,PTCNCUDA
          MATCH     PTALCATG,DIM2
          GOTO      DSAL9000 IF NOT EQUAL        * disability alert ?
.
          MATCH     SP70,PTALEDAT
          GOTO      DSAL0800 IF EQUAL            * no alert end date
.
          MATCH     PTALEDAT,CURRDATE
          GOTO      DSAL0500 IF NOT LESS         * alert end date passed ?
.
DSAL0800  MATCH     SP70,PTALDTIN
          GOTO      DSAL0900 IF EQUAL            * no alert inactive date
.
          MATCH     PTALDTIN,CURRDATE
          GOTO      DSAL0500 IF NOT LESS         * alert inactive date passed ?
.
DSAL0900  MOVE      ZERO,FORM1
.
DSAL1000  PACK      KEY16,PURNO,SP70
          CALL      RSPTALR1
DSAL2000  CALL      RKPTALR1
          BRANCH    OVRCD,DSAL3000
.
          MATCH     PTALURNO,PURNO
          GOTO      DSAL3000 IF NOT EQUAL
.
. CAR 320331 - ignore micro, risk and medical alerts as these already have an
.              icon appearing in the banner elsewhere.
          PACK      KEY5,PTALCATG,PTALCODE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,DSAL2000
.
          MATCH     "M",TCINDC5
          GOTO      DSAL2000 IF EQUAL
.
          MATCH     "B",TCINDC5
          GOTO      DSAL2000 IF EQUAL
.
          MATCH     "R",TCINDC5
          GOTO      DSAL2000 IF EQUAL
.
          ADD       ONE,FORM1
          COMPARE   TWO,FORM1
          GOTO      DSAL9200 IF EQUAL
          GOTO      DSAL2000
.
DSAL3000  COMPARE   ONE,FORM1
          GOTO      DSAL9100 IF EQUAL
.
          GOTO      DSAL9000
.
DSAL9000  MOVE      ZERO,EXIT                      * zero
          GOTO      DSAL9999
.
DSAL9100  MOVE      ONE,EXIT                       * one
          PACK      KEY14,PURNO,SP70
          CALL      RSPTMWS1
          CALL      RKPTMWS1
          BRANCH    OVRCD,DSAL9999
.
          MATCH     PURNO,PTMWURNO
          GOTO      DSAL9200 IF EQUAL
.
          GOTO      DSAL9999
.
DSAL9200  MOVE      TWO,EXIT                      * two
          GOTO      DSAL9999
.
          INC       PATALRIO/INC
          INC       IBAOVRIO/INC
.
DSAL9999  CLOSE     PATALRT1
          CLOSE     PATMWSA1
          ENDPROC
.
.
.--------------------------------------------------------------------------
. CHKLEGST
. Procedure to check for Legal Status
. Exit=0  No Legal Status
.      1  With Legal Status
.      2  With Historical data
.--------------------------------------------------------------------------
          DEFPROC   CHKLEGST
.
          INC       MEHHLSFD/INC
          INC       MEHDLSFD/INC
.
          MOVE      ZERO,EXIT
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      MEHHLSA2,"mehhlsaf"
          TRAPCLR   IO
          BRANCH    OVRCD,CHKLEG99
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      MEHDLSA1,"mehdlsaf"
          TRAPCLR   IO
          BRANCH    OVRCD,CHKLEG99
.
          MOVE      ZERO,EXIT
          PACK      KEY32,URNUMBER,Z70
.
          CALL      RSMHHLS2
CHKLEG10  CALL      RPMHHLS2
          BRANCH    OVRCD,CHKLEG99
.
          MATCH     URNUMBER,MHHLURNO       * Check for same ur number
          GOTO      CHKLEG99 IF NOT EQUAL
.
          MATCH     "1",MHHLSTAT
          GOTO      CHKLEG10 IF EQUAL       * status "Inactive"
          MATCH     SP70,MHHLEDAT
          GOTO      CHKLEG10 IF NOT EQUAL   * End date not blank
          MATCH     SP70,MHHLETIM
          GOTO      CHKLEG10 IF NOT EQUAL   * End time not blank
.
.                                           * Header stil active - check Details
          PACK      KEY32,URNUMBER,MHHLUNIQ,Z70
          CALL      RSMHDLS1
CHKLEG20  CALL      RPMHDLS1
          BRANCH    OVRCD,CHKLEG10
.
          MATCH     URNUMBER,MHDLURNO       * Same U/R Number?
          GOTO      CHKLEG10 IF NOT EQUAL
          MATCH     MHHLUNIQ,MHDLUNIQ       * Same Uniq number?
          GOTO      CHKLEG10 IF NOT EQUAL
.
.                                           * now check each Detail record
          MATCH     "1",MHDLACTV            * In-Active?
          GOTO      CHKLEG20 IF EQUAL
.
          MATCH     SP70,MHDLEDAT
          GOTO      CHKLEG20 IF NOT EQUAL   * End date not blank
          MATCH     SP70,MHDLETIM
          GOTO      CHKLEG20 IF NOT EQUAL   * End time not blank
.
.
.                                           * read Details to check Cat "LS"
          PACK      KEY5,ANSL,ANSS,MHDLSCOD,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CHKLEG20
.
.         If Indicator 3 = N, do not display Legal status icon
          MATCH     "N",TCINDC3
          GOTO      CHKLEG90 IF EQUAL
.
.                                         * found an Active LS Detail
          MOVE      ONE,EXIT              * set to "Legal status" Icon
          GOTO      CHKLEG99
.
CHKLEG90  MOVE      ZERO,EXIT             * set to no LS Icon
          GOTO      CHKLEG99
.
          INC       MEHHLSIO/INC
          INC       MEHDLSIO/INC
          INC       IBAOVRIO/INC
.
CHKLEG99  CLOSE     MEHHLSA2
          CLOSE     MEHDLSA1
.
          ENDPROC
.
.
          INC       BOKRC1IO/INC
          INC       MLTSECIO/INC
          INC       OUTPREIO/INC
          INC       PATDO1IO/INC
          INC       PMSAIDIO/INC
          INC       PATDSCIO/INC
          INC       PATGSRIO/INC
          INC       PMSCURIO/INC
          INC       PATPR1IO/INC
          INC       PATMA1IO/INC
          INC       PATBRDIO/INC
          INC       PATMRGIO/INC
          INC       PATVADIO/INC
          INC       PATDADIO/INC
          INC       PATMI1IO/INC
          INC       PATTRNIO/INC
          INC       PATRE1IO/INC
          INC       PATVISIO/INC
          INC       PATVENIO/INC
          INC       PATHSPIO/INC
          INC       SCRMASIO/INC
          INC       PATNAMCD
          INC       PATNOBIO/INC
          INC       PATONLIO/INC
          INC       NAMSTRCD
          INC       NAMST1CD                                        * CAR 263963
          INC       IBAWEBCD    
          INC       FHRDATCD    
          INC       CALCAGE 
          INC       PATSNDX
          INC       PATSNX2
          INC       PATWSRCH
          INC       PMSWORTM
          INC       PATDOCTM
          INC       PATDOCCD
          INC       PMSPX2TM
. 
          INC       OUTCLIIO/INC
          INC       OUTRF1IO/INC
          INC       OUTSITIO/INC
          INC       MRTMASIO/INC
          INC       PMSPX2IO/INC
          INC       EMRUNKIO/INC
          INC       EMRVISIO/INC
          INC       PMSVX1IO/INC
          INC       PATWR1IO/INC
          INC       PATLOCIO/INC
.
          INC       PMSCCDIO/INC   * Concession Card Details
          INC       PMSHCPIO/INC
          INC       PMSHCLIO/INC
          INC       PATNURIO/INC
          INC       OUTBOAIO/INC
          INC       OUTBB1IO/INC
          INC       OUTCTYIO/INC
          INC       OUTMA1IO/INC
          INC       OUTSESIO/INC
          INC       OUTHEDIO/INC
.
          INC       PMSEVTIO/INC            * HPS Code Starts Here
          INC       PMSWORIO/INC
          INC       ALLREFIO/INC
          INC       ALLENCIO/INC            * HPS Code Ends Here
          INC       WATTR1IO/INC   
.
.

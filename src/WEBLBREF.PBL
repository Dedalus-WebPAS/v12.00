.******************************************************************************
.* WEBLBREF - This is a proc to display the variables painted for Outpatient  *
.*            Referral Labels.                                                *
.* PARAMETERS  : This procedure requires that the outrflaf record has         *
.*               been read.                                                   *
.*                                                                            *
.*               FORM1 = Label Type                                           *
.*                       1 = Refrral Label                                    *
.*                       2 = Mailing Label                                    *
.*                                                                            *
.* RETURNS     : EXIT = 0       screen painted label and was printed          *
.*               EXIT = 1       not screen painted label (CCITEM=no labels)   *
.*               EXIT = 2       dont print the labels                         *
.*                                                                            *
.* Modifications :                                                            *
.******************************************************************************
.* V10.11.01 23/08/2017  Thanh T.       TSK 0821710                           *
.*           Audit Amission/outpatient visit comments                         *
.******************************************************************************
.*  V9.09.01 12/07/2007  Peter Vela     CAR 142913                            *
.*           Added call to GCCSJG00                                           *
.*  V9.08.00 02/03/2007  Jill Habasque  CAR 124699                            *
.*           Added read of pmspx2af                                           *
.*  V9.03.00 09/02/2004  Sylvek Litewka  CAR 47000                            *
.*           Created from LABELREF                                            *
.******************************************************************************
          DEFPROC   LABELREF
.
          INC       WEBBOOKV/INC
          INC       IBAPASFD/INC
          INC       NHIETHFD/INC
.
. ------- variables required -------
.
DONTASK   FORM      1
CODEDC    INIT      "DC"
CODEDA    INIT      "DC"
CODEEP    INIT      "EP"
CODEH1    INIT      "H1"
CODEH2    INIT      "H2"
CODEH3    INIT      "H3"
CODEO1    INIT      "O1"
CODEO2    INIT      "O2"
CODEO3    INIT      "O3"
CODEO4    INIT      "O4"
CODEM     INIT      "M "
CODEP     INIT      "P "
CODEP2    INIT      "P2"
CODEP3    INIT      "P3"
CODEP4    INIT      "P4"
CODEP5    INIT      "P5"
CODEP6    INIT      "P6"
CODER     INIT      "R "
CODEU2    INIT      "U2"
CODEU3    INIT      "U3"
CODEV6    INIT      "V6"
CODEV7    INIT      "V7"
CODEV8    INIT      "V8"
CYRSFDTE  DIM       8
CYRSTDTE  DIM       8
CYRSYEAR  FORM      3
DIM3A     DIM       3
PROCONUM  DIM       8
SAVKEY28  DIM       28
SAVLBTYP  FORM      1
NOTSCPT   FORM      1         * 1 = not screen painted
SITE      DIM       6
SP100     INIT      "                                                      ":
                    "                                              "
SP80      INIT      "                                  ":
                    "                                              "
+
.*********************************************************************
MAIN0000  CALL      INIT0000                     * Initialise proc
          BRANCH    EXIT,MAIN9999
.
          MOVE      ZERO,EXIT
.
          CALL      LABELCOM              * process screen painted labels
.
MAIN9999  GOTO      LABREF99
+
.*****************************************************************
.*        Initilisation                                          *
.*****************************************************************
INIT0000  UNPACK    LABELTYP,PRGID,SCRID
          MOVE      ZERO,EXIT
.
          READ      CONTROLF,THIRTY1;*89,HOLPAGE,HOLPRNT,HOLSIZE
          MOVE      HOLPAGE,LABCOS        * no of labels across page
          MOVE      HOLSIZE,LABSIZE       * label Size
.
          PACK      KEY8,OTRLURNO,SP10
          CALL      RDMAST1
          BRANCH    OVRCD,INIT9350
          CALL      RDPMPX21
          BRANCH    OVRCD,INIT9350
.
          CALL      GCCSJG00
.
          GOTO      INIT9999
.
INIT9350  CLEAR     WEBTITLE
          APPEND    "Invalid PMI Details - ",WEBTITLE
          APPEND    KEY8,WEBTITLE
          RESET     WEBTITLE
          GOTO      INIT9995
.
INIT9995  CALL      WEBERR00
          MOVE      ONE,EXIT
.
INIT9999  RETURN
.
+
.*****************************************************************
.*        GCLI0000  Get Label Screen ID      Called By :         *
.*****************************************************************
GCLI0000  MOVE      "02",SCRID
.
GCLI9999  RETURN
. ****************************************************************************
. * HCMN0000 : Test if there any visit comments in the comments file         *
. ****************************************************************************
HCMN0000  MOVE      ONE,EXIT                 * Assume we don't have comments
          MOVE      ZERO,OVRCD               * Assume file will exist
.
          MOVE      PVIBILL,KEY8             * Key for start of comment
          PACK      KEY17,KEY8,VSCMTTYP,Z70
.
          CALL      RSVSMDT1
HCMN0200  CALL      RPVSMDT1
          BRANCH    OVRCD,HCMN9999
.
          MATCH     KEY8,VSMDVISN
          GOTO      HCMN9999 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMDTYPE
          GOTO      HCMN9999 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT          * is comment deleted
          GOTO      HCMN0200 IF EQUAL
.
          MOVE      ZERO,EXIT                * We have comments
.
HCMN9999  RETURN
.
+
.*****************************************************************
.*        DISPVARS  Display Items            Called By :         *
.*****************************************************************
DISPVARS  MOVE      SCPSITM,FIELDNO
          MOVE      SCPSLEN,LLCNT
.
          COMPARE   "500",FIELDNO         * If item more than 500 use 
          GOTO      DVARS100 IF LESS      * Outpatient Referral Details else use
          SUB       "500",FIELDNO         * PMI
.
          MOVE      FIELDNO,SCPSITM
          CALL      DXOUTREF
          GOTO      DVARS999
.
DVARS100  CALL      DXPATMAS
.
DVARS999  RETURN
+
          INC       AGECHK
          INC       CALCYRS
          INC       DSPFIELD
          INC       DXOUTREF
          INC       DXPATCOD
          INC       DXPATDOC
          INC       DXPATMAS
          INC       IBAOVRIO/INC
          INC       IBAPASIO/INC
          INC       NHIETHIO/INC
          INC       OUTCTYIO/INC
          INC       WEBLBCOM
          INC       PMIGTNID
.
LABREF99  ENDPROC

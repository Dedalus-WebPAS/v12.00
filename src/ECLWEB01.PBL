.---------------------------------------------------------------------- 
. Program       : ECLWEB01 
.
. Function      : Eclipse Server 1                  
.
. Modifications :
.----------------------------------------------------------------------
. V12.00.01 11/06/2025  Ebon Clements   TSK 0961623
.           Alphanueric visit number changes
. V11.05.01 24/03/2025  Davin           TSK 0956210
.           Add ICD10 Ed.13 - Go-live Date PTCNGDX3 (Sect.130 Pos.86)
. V11.02.03 31/03/2022  Davin           TSK 0917793
.           Add ICD10 Ed.12 - Go-live Date PTCNGDX2 (Sect.128 Pos.231)
. V11.02.02 09/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTHEDFD/OUTMA1FD/WATTR1FD changes
. V11.02.01 07/02/2022  Thanh T       TSK 0896905
.           Recompiled for ALLDEPFD changes
. V11.01.01 02/07/2021  Peter Vela      TSK 0906538
.           Fixed PCS Viewed assignment at MINS1000
. V11.00.09 10/09/2020  Thanh T         TSK 0881752
.           Recompiled for OBSCNAPR changes
. V11.00.08 27/07/2020  Tracey Nguyen    TSK 0892433
.           Recompiled for PRIHRETM
. V11.00.07 25/05/2020  Peter Vela       TSK 0892408
.           Added WebServices PRODA Management
. V11.00.06 27/04/2020  Peter Vela       TSK 0870469
.           Modified Eclipse DBS payment report for outerhaf/outerdaf
. V11.00.05 24/04/2020  Peter Vela       TSK 0874025
.           Populate PRECPRAC before write to priectaf
. V11.00.04 22/04/2020  Peter Vela       TSK 0874025
.           Recompiled for PRIECTFD
. V11.00.03 20/04/2020  Peter Vela      TSK 0874495
.           Recompiled for OUTERHFD
. V11.00.02 17/04/2020  Peter Vela      TSK 0874025
.           Recompiled for PRIECTFD
. V11.00.01 16/03/2020  Tracey Nguyen   TSK 0889496
.           Recompiled for MRTAUCFD/IO - Added MRACDDNR,MRACOHCP,MRACOCOF,
.           MRACODAT
.----------------------------------------------------------------------
. V10.15.01 20/02/2020  Peter Vela      TSK 0887845
.           Recompiled for NZHISWIO
. V10.14.12 16/07/2019  Peter Vela      TSK 0878344
.           Added date range validation for ECOT0000
. V10.14.11 30/05/2019  Thanh T.        TSK 0872539
.           Recompiled for NZHISWIO changes
. V10.14.10 04/04/2019  Peter Vela      TSK 0872589
.           Added tag for PRIDTRFD.PRDTLVIS for IMC details
. V10.14.09 26/06/2019  Peter Vela       Task 0859743
.           Added outpatient validation to RSEB2500
. V10.14.08 14/03/2019  Don Nguyen     TSK 0869412
.           Added read of ICD10 Ed.11 Go-live Date parameter (PTCNGDX1)
. V10.14.07 12/03/2019  Tracey Nguyen   TSK 0863060
.           Recompiled for PATVISTM - Added VISS6400 & VISS6500
. V10.14.06 05/03/2019  Peter Vela       Task 0860826
.           Removed Health Fund only option from ECCT0000, ECCP0000, ECOT0000
. V10.14.05 27/02/2019  Ken Bell         TSK 0869548
.           Recompiled for PATCLMTM - Added Diagnosis Codes for NZ template
.           20/02/2019  Peter Vela       TSK 0863035
.           Changed DFUP0000 to FUE0000 in ESTF5000
. V10.14.04 18/02/2019  Ebon Clements    TSK 0829856
.           Recompiled for GETEFDRG - Contract from effective date
. V10.14.03 08/02/2019  Peter Vela       TSK 0867807
.           Added medicare care flag back into EBARRW00
. V10.14.02 07/02/2019  Peter Vela       TSK 0867807
.           Added "No Payment Report" message in EBARRW00 if Claim Benefit
.           Amount is zero
. V10.14.01 05/02/2019  Peter Vela       TSK 0867807
.           Added explanation code/description validation in EBSDRW00
. V10.13.09 31/01/2019  Peter Vela       TSK 0867807
.           Commented out Explanation Desc in DBS Processing report display
.           Added all columns in EBAR0000
. V10.13.08 20/12/2018  Peter Vela       TSK 0859743
.           Fixed DBBE0000
. V10.13.07 20/12/2018  Tracey Nguyen    TSK 0859743
.           1) Added reportno=8 for Eclipse Bulk Billing Claim Details
.           2) Added reportno=9 for Eclipse Bulk Billing Claim Enquiries
.           3) Added missing EMEAMODL to write to emrecaaf in ESTF6000
.           4) Removed HOSPCODE in read to emrectaf table for Private
.              Practice - ECPP0000
. V10.13.06 16/11/2018  Peter Vela       TSK 0863035
.           Added validation for Resubmit Eclipse PCS
.           Removed hospital initialise in ECCP0000
. V10.13.05 15/11/2018  Peter Vela       TSK 0863035
.           Added MAVMODUL to ESTF6000
. V10.13.04 12/11/2018  Peter Vela       TSK 0863035
.           Added write to claimant table in BSBAU000
. V10.13.03 03/08/2018  Peter Vela       TSK 0859742
.           Added Eclipse Store and Forward NOI Claimant functionality
. V10.13.02 23/08/2018  Peter Vela       TSK 0859742
.           Added Eclipse Store and Forward functionality
. V10.13.01 26/07/2018  J.Tan            TSK 0848506
.           Changed PP Doctor from DIM6 to DIM10
. V10.12.03 18/05/2018  Thanh T.         TSK 0851528
.           Recompiled for PATVISTM changed
. V10.12.02 06/04/2018  Peter Vela       TSK 0854953
.           Added flags for open table pmsovraf pmsovvaf
. V10.12.01 15/02/2018  Peter Vela       TSK 0852560
.           Added tag for PMOVVENC description
.----------------------------------------------------------------------
. V10.11.05 27/12/2017  Steve Armstrong  TSK 0850165
.           Recompiled for changes to DGCLICAC.
. V10.11.04 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.03 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
. V10.11.02 26/07/2017  Thanh T.        TSK 0821710
.           Recompiled PASMISTM
. V10.11.01 14/07/2017  Thanh T.        TSK 0821710
.           Audit Amission/outpatient visit comments. PATMISTM changed.
.----------------------------------------------------------------------
. V10.10.02 22/03/2017 Richa Phogat     TSK 0832066                   
.           Changed DVA Card Number to be collected from PMCDCNUM.PMSCCDFD 
.           instead of PREPAT.PMIMA1FD 
. V10.10.01 17/03/2017  Davin          TSK 0833093     HDP 2017/2018
.           Add ICD10 Ed.10 - Go-live Date PTCNGDVX (Sect.110 Pos.85)
. V10.09.01 13/12/2016  Jill Parkinson TSK 0822329
.           Added definition of ACCPORD
. V10.08.02 26/08/2016  Don Nguyen     TSK 0312570
.           Recompiled for GETDRG (GTDRG000) - Call GTEDRG00 when PTCNDGED=1
.           Added PMSEDGFD/IO and GETEFDRG
.           08/07/2016  Peter Vela     TSK 0294177
.           Added IMC functionality
. V10.08.01 02/11/2016  Ebon Clements  TSK 0305048
.           Recompiled for OBSCNAPR - Clinical notes enquiry
. V10.07.03 30/10/2015  Don Nguyen     CAR 320394
.           Recompiled for changes to WATTX1FD/IO
. V10.07.02 29/10/2015  Ebon Clements  CAR 268970 
.           Removed open of OUTCLIA2
. V10.07.01 19/10/2015  Don Nguyen     CAR 316625
.           Added ALLCASFD/IO and opened file
.----------------------------------------------------------------------
. V10.06.07 26/08/2015  Jill Parkinson CAR 318680
.           Recompiled for changes to NZHISWIO
. V10.06.06 25/08/2015  Jill Parkinson CAR 320905
.           Recompiled for changes to NZHISWIO
. V10.06.05 13/08/2015  Don Nguyen    CAR 308621
.           Recompiled for PATVISTM - Added VISS6100
.           15/05/2015  Davin         CAR 310155
.           Recompiled for PATGBCRN - added MOD10V05 for BPAY
. V10.06.04 19/03/2015  Ebon Clements CAR 268970 
.           Removed open of OUTCLIA2
. V10.06.03 17/03/2015  Davin         CAR 311669      HDP 2015/16
.           ADD PTCNGDV9 for ICD10 Ed.9 Go-live Date (Sect.110 Pos.77)
. V10.06.02 18/03/2015  Ania P          CAR 306161
.           Recompiled for OBSMED
. V10.06.01 12/03/2015  Steve Armstrong  CAR 314108
.           Removed definition of PTCGDATE as PATCGPFD is no longer
.           in use.
.----------------------------------------------------------------------
. V10.05.01 08/07/2014  Peter Vela      CAR 294157
.           Added OVV functionality
.           18/09/2014  Davin         CAR 304204
.           Recompiled for GETDRG - get drg vers based on disch date
. V10.04.03 07/04/2014  Peter Vela      CAR 286258
.           Recompiled for PATMASTM
. V10.04.02 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.01 24/03/2014  Steve Armstrong  CAR 298483
.           Recompiled for changes to DGCLICOB.
.----------------------------------------------------------------------
. V10.03.10 10/09/2013  Steve Armstrong  CAR 291089
.           Recompiled for changes to PMSQVIFD.
. V10.03.09 18/07/2013  Steve Armstrong  CAR 268961
.           Recompiled for changes to PMSQVIFD.
. V10.03.08 20/06/2013  Davin         CAR 287161
.           Recompiled for PATGBCRN - right justify ptcnhbpi
. V10.03.07 06/05/2013  Ebon Clements    CAR 261630
.           Removed temp file name with port number that was not used
. V10.03.06 01/05/2013  Steve Armstrong  CAR 284376
.           Recompiled for changes to DGCLICUP.
. V10.03.05 23/04/2013  Davin         CAR 284420      HDP 2013/14
.           ADD PTCNGDV8 for ICD10 Ed.8 Go-live Date (Sect.110 Pos.69)
. V10.03.04 03/04/2013  Davin          CAR 270648
.           Recompiled for changes to HL7 messaging includes
. V10.03.03 18/07/2012  Don Nguyen       CAR 264561
.           Removed PATGBCRN include
. V10.03.02 16/05/2012  Steve Armstrong  CAR 256322
.           Recompiled for changes to NZHISWIO.
. V10.03.01 16/01/2012  Sandra Barcham  CAR 256563
.           Recompiled for PATMASTM
.----------------------------------------------------------------------
. V10.02.05 27/10/2011  Steve Armstrong CAR 251323
.           Recompiled for PMSQVIFD changes
. V10.02.04 25/08/2011  Mike Laming      CAR 241939
.           Mod to SELEPS00 to correct selection list of Episodes
. V10.02.03 20/07/2011  J.Tan             CAR 239592
.           Mods to pmsresaf file
. V10.02.02 10/05/2011  J.Tan          CAR 239588
.           Created CLPMSRES - clear patient Residency file
. V10.02.01 28/03/2011  Mike Laming   CAR 240107                      
.           Mods to PATECDaf & PATECOaf variables & Keys - file change
. V10.01.01 19/11/2010  Steve Armstrong   CAR 234061
.           Recompiled for changes to PMSNUTFD.
.           Changed CALL's to PMSNUTIO.
.----------------------------------------------------------------------
. V10.00.02 07/09/2010 Peter Vela        CAR 226974
.           Fixed display issues with opv list screen
. V10.00.01 03/08/2010 Peter Vela        CAR OPV Eclipse
.           Added Eclipse OPV PVM functionality
.           Created Eclipse Server 1
.------------------------------------------------------------
          INC       IBAWEBDF    
.
          INC       TMPALIFD/INC
          INC       NZHISIFD/INC
.
          INC       OBSDIATD
          INC       ACCDIAFD/INC                 * AE Diagnosis
          INC       ARCVX1FD/INC                 * archive visit table
          INC       EMRECTFD/INC
          INC       EMRECAFD/INC
          INC       EMRIBHFD/INC
          INC       EMRICDFD/INC                 * AE Diagnosis Codes
          INC       HICEMSFD/INC
          INC       OUTEADFD/INC
          INC       OUTEAHFD/INC
          INC       OUTECAFD/INC
          INC       OUTECTFD/INC
          INC       OUTERHFD/INC
          INC       OUTERDFD/INC
          INC       OUTIBHFD/INC
          INC       PRIALSFD/INC
          INC       PRIECTFD/INC
          INC       PRIECAFD/INC
          INC       PRIEAHFD/INC
          INC       PRIEADFD/INC
          INC       PRIESHFD/INC
          INC       PRIESDFD/INC
          INC       PMSETRFD/INC
          INC       PRIIBHFD/INC
          INC       PRIHDBFD/INC                 * holding header file
          INC       PRIPRAFD/INC
          INC       PRIHREFD/INC                 * referral file
          INC       PRIDTRFD/INC
          INC       PRICONFD/INC
          INC       PRIHRETD/INC
          INC       APSMASFD/INC
          INC       BOKRC1FD/INC
          INC       BOKRX1FD/INC
          INC       BOKDIAFD/INC
          INC       EMRCONFD/INC
          INC       EMRUNKFD/INC
          INC       EMRVISFD/INC
          INC       IBADLABS/INC
          INC       OPLBVARS/INC
          INC       PATALRFD/INC
          INC       PATCALAG/INC
          INC       PATCONFD/INC
.         INC       PMSCDNFD/INC
          INC       PMSECOFD/INC
          INC       MEHCONFD/INC
.         INC       MEHLEGFD/INC
          INC       MLTSECFD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       VISMDTFD/INC
          INC       VISMTXFD/INC
          INC       PATCFAFD/INC
          INC       PATCHCFD/INC
..        INC       PATCURFD/INC
          INC       PATDHEAD/INC
          INC       PATDGWFD/INC
          INC       PATDO1FD/INC
          INC       PATDSCFD/INC
          INC       PATFLTFD/INC
          INC       PATFX1FD/INC
          INC       PATPEIFD/INC
          INC       PATUNAFD/INC
          INC       PATMESFD/INC
          INC       PMSCTCFD/INC
          INC       PMSOVRFD/INC
          INC       PMSOVVFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPFD/INC
          INC       PMSTLEFD/INC            * Patient Titles table
          INC       PATGSRFD/INC
          INC       PATFACFD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       PATICUFD/INC
          INC       PATITMFD/INC
          INC       PATIN1FD/INC
          INC       PATINVFD/INC
          INC       PATMI1FD/INC
          INC       PATMA1FD/INC
...          INC       HL7BMTFD/INC
          INC       PATMMBFD/INC
          INC       PATNIDFD/INC
          INC       PATONLFD/INC
          INC       PATPA1FD/INC
          INC       PATPR1FD/INC
          INC       PATRE1FD/INC
          INC       PATRE1TD/INC            * Person Responsible for Acct Cgi's
          INC       PATRGMFD/INC
          INC       PATPGRFD/INC
          INC       PATTRNFD/INC
          INC       PATVADFD/INC
          INC       PATVISFD/INC
          INC       NZPSPRFD/INC
          INC       MEHLERFD/INC
.         INC       MEHVI1FD/INC
          INC       PATWC1FD/INC
          INC       PATCLMTD/INC   * Claim cgi variables
          INC       PMSBRQFD/INC
          INC       PMSCCDFD/INC   * Concession Card Details
          INC       PMSWX1FD/INC
          INC       ACCCMTFD/INC   * ACC (nz) Comments File
          INC       ACCLODFD/INC   * ACC Claim Lodgements
          INC       PMSWORFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       PATEORFD/INC
          INC       PATFN1FD/INC
          INC       PATWMAFD/INC
          INC       PMSEVTFD/INC
          INC       MRTAUCFD/INC
          INC       MRTLOCFD/INC
          INC       MRTMASFD/INC
          INC       MRTHISFD/INC
          INC       MRTSTFFD/INC
          INC       MRTPDSFD/INC
          INC       MRTVISFD/INC
          INC       OUTCONFD/INC
          INC       OUTSITFD/INC
          INC       OUTCLIFD/INC
          INC       OUTBOAFD/INC
          INC       OUTCANFD/INC
          INC       OUTRF1FD/INC
          INC       OUTRSHFD/INC
          INC       OUTBB1FD/INC
          INC       OUTMA1FD/INC
          INC       OUTHEDFD/INC
          INC       OUTCTYFD/INC
          INC       OUTSESFD/INC
.
          INC       PATECDFD/INC
          INC       PATECOFD/INC
          INC       RESLNKFD/INC
          INC       PMSCLTFD/INC
          INC       PMSCLTTD/INC
          INC       PMSPX2FD/INC
          INC       PMSPX2TD/INC
          INC       NZPSPRTD/INC
          INC       SAVPX2FD/INC
..          INC       WATSUSFD/INC
          INC       PATW11FD/INC                                       *I-43498
          INC       PATW12FD/INC            * WIES12                   *I-51504
          INC       PTW12BFD/INC            * WIES12B
          INC       PATW13FD/INC            * WIES13
          INC       PATW14FD/INC            * WIES14                  *I-145161
          INC       PATW15FD/INC            * WIES15
          INC       PATW16FD/INC            * WIES16
          INC       PATW17FD/INC            * WIES17
.
.    ****** HPS BLR INCLUDE  STARTS HERE    **********
.
          INC       PATASFFD/INC
          INC       PATSFAFD/INC
          INC       PATDADFD/INC
          INC       PMSVX1FD/INC
          INC       OPRDEAFD/INC
          INC       AAEDI1FD/INC
          INC       AAEDE1FD/INC
          INC       PATHSPFD/INC
          INC       OUTDIAFD/INC
          INC       WATTR1FD/INC
          INC       WATTX1FD/INC
          INC       ALLCONFD/INC
          INC       ALLREFFD/INC
          INC       ALLRLNFD/INC
          INC       ALLENCFD/INC
          INC       ALLDEPFD/INC
.
.   ****** HPS BLR CODE ENDS HERE           **********
.
          INC       PRISECFD/INC
          INC       PRIINVFD/INC
          INC       PMSAIDFD/INC
          INC       PMSHCLFD/INC
          INC       PMSHCGTD/INC
          INC       PMSHCPTD/INC
          INC       PMSRESFD/INC
          INC       WEBDATDF
          INC       PMSNUTFD/INC
          INC       PMSNUTTD/INC
          INC       NHIDNRFD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       PATCMCFD/INC
          INC       OBSRESFD/INC
          INC       OBSPHYFD/INC
          INC       OBSCALFD/INC
          INC       OBSDITFD/INC
          INC       OBSMEDFD/INC
          INC       OBSPINFD/INC
          INC       OBSCNCFD/INC
          INC       OBSCNAFD/INC
          INC       OBSCNBFD/INC
          INC       OBSDIAFD/INC
          INC       OBSPROFD/INC
          INC       OBSBHIFD/INC
          INC       OBSBPHFD/INC
          INC       OBSREAFD/INC
          INC       OBSLABFD/INC
          INC       TFILEVAR/INC
          INC       VARGBCRN/INC            * I-48227
          INC       VISPAYFD/INC
          INC       ALLCASFD/INC
          INC       PMSEDGFD/INC       * Effective DRG Dates
          INC       PATMISTD/INC
          INC       WEBB2BFD/INC
          INC       WEBB2BTD/INC
.
ACCPORDN  DIM       20
AAEVFLAG  FORM      1                       * AAE visit flag 0=No 1=Yes
ALLHFLAG  FORM      1       * 'All' hospital flag
BATCHNUM  DIM       8
CMDLINE   DIM       200
VALDTYPE  FORM      1
EVNTFLAG  FORM      1
EMREVENT  FORM      1
ASESDESC  DIM       7
ASESDES1  INIT      "Accept."
ASESDES2  INIT      "Reject."
ASESDES3  INIT      "Warning"
ASESDES4  INIT      "Compl. "
MEDSDESC  DIM       70
MEDSDES1  INIT      "Patient identification amended"
MEDSDES2  INIT      "Patient Medicare Issue number changed"
MEDSDES3  INIT      "Patient Medicare Number changed"
MEDSDES4  INIT      "Patient card used will expire shortly"
MEDSDES5  INIT      "Patient card expired. Future services may be rejected"
MEDSDES6  INIT      "Old Medicare issue number for patient. Future services may be rejected"
PRCSDESC  DIM       25
PRCSDES1  INIT      "RECEIVED"
PRCSDES2  INIT      "MEDICARE_UNVERIFIED"
PRCSDES3  INIT      "MEDICARE_VERIFIED"
PRCSDES4  INIT      "HEALTH_FUND_UNVERIFIED"
PRCSDES5  INIT      "HEALTH_FUND_VERIFIED"
PRCSDES6  INIT      "MEDICARE_ASSESSING"
PRCSDES7  INIT      "HEALTH_FUND_ASSESSING"
PRCSDES8  INIT      "MEDICARE_REJECTED"
PRCSDES9  INIT      "HEALTH_FUND_REJECTED"
PRCSDE10  INIT      "REQUEST_DELETE"
PRCSDE11  INIT      "COMPLETE"
SFACDESC  DIM       7
SFACDES1  INIT      "Accept."
SFACDES2  INIT      "Reject."
SFACDES3  INIT      "Warning"
ARCFLAG   FORM      1
OVRFLAG   FORM      1
OVVFLAG   FORM      1
AUDITDTE  DIM       12
BEDTDESC  DIM       15
BLNKFLAG  FORM      1
CPPURNO   DIM       8
DISPDATE  DIM       11
NZHISMOD  FORM      1         * NZHIS change mode indicator
FILNHIAF  FILE      ASCII, FIXED=256       * tmp save file for forking
FILTDEPT  DIM       3
DEFTFLAG  FORM      1
TOTALALI  FORM      3
NEXTPAGE  DIM       1                       * Nextpage parameter CGI parameter
UPDTTYPE  DIM       1                       * Update Type
UPDATETY  FORM      1
UPDATTYP  DIM       1
URCOMFLG  FORM      1
UROUTPUT  DIM       20[50]
UROUTEND  FORM      3
PATALTID  DIM       20
PMSALTID  DIM       20
PMSOVRKY  DIM       26
PMSOVVKY  DIM       26
.
ATCHAR    INIT    "@"
ACCIDATE  DIM       11                      * Accident Date
PDCDATE   DIM       11                      * Patient Declaration Date
DECDATE   DIM       11                      * ACC Decline Date 
ACDNTFLG  FORM      1
BTSCHOSP  DIM       3
..NRCDAYS   FORM      5
..LSTDAYS   FORM      5
WARNFLAG  FORM      1
WIESFILE  DIM       8
WARDBED   DIM       7
COUNT     FORM      3
TACCOUNT     FORM      3
WCOCOUNT     FORM      3
CLAIMSTA  DIM       2
DEFAULTA  DIM       1    * default to all on visit list by type 0=no 1=yes
DIM5      DIM       5
DIM7      DIM       7
DIM8      DIM       8
DIM10     DIM       10
DIM11     DIM       11
DIM16     DIM       16
DIM18     DIM       18
DIM20     DIM       20
DIM22     DIM       22
DIM27     DIM       27
DIM30     DIM       30
DIM100    DIM       100
DIM100A   DIM       100
DIM100B   DIM       100
DIM100C   DIM       100
DIM100D   DIM       100
DIM100E   DIM       100
DIM100F   DIM       100
DIM100G   DIM       100
DIM100H   DIM       100
DIM100I   DIM       100
DIM100J   DIM       100
DIM100K   DIM       100
DISWARD   DIM       3
DISUNIT   DIM       3
DISBED    DIM       3
DISPUSER  DIM       30
DISPDATT  DIM       25
DISPFLAG  FORM      1 
DRG041    INIT      "041"
DRG042    INIT      "042"
DRG050    INIT      "050"
DRG051    INIT      "051"
DRG052    INIT      "052"                                             *I-137125
DRG060    INIT      "060"                                             *I-197814
.
EXDTBLNK  FORM      1
ECOTFUND  DIM       6
ECOTTYPE  DIM       1
ECOTTRID  DIM       24
ECCLFBID  DIM       3
ECCLARID  DIM       20
ECCLCLID  DIM       6 
ECCLRPTC  DIM       3
ECCLITMN  DIM       5
ECCLSRVC  DIM       3
ECCLRKEY  DIM       24                    *Report Retrieve Key
.
FORM6P2   FORM      6.2
FORM6P2A  FORM      6.2
FORM7P2C  FORM      7.2
FORM7P2O  FORM      7.2
FILTFDAT  DIM       8
FILTTDAT  DIM       8
FILTURNO  DIM       8
FILTADMN  DIM       8
.
HOSPCODE  DIM       3
HOUR      FORM      2
HTMLLNK2  DIM       127
.
LASTWBED  DIM       6
LASTDOCT  DIM       6
LASTTYPE  DIM       3
LOOPCNTR  FORM      1
.
MIN       DIM       2
MINTIME   FORM      2
MINUTES   FORM      3
NMPNUMB   DIM       20
.
TIME      FORM      3
.
CLAIMFLG  FORM      1
CLMUPDFL  FORM      1
CODERNAM  DIM       35                       * Coder Name
CODEDFLG  FORM      1
CLNOT001  DIM       3                        * Type of Note
CLNOTEID  DIM       4                        * Clinical Note ID
CATct     INIT      "ct"
CATCL     INIT      "CL"
CATD1     INIT      "D1"
CATD2     INIT      "D2"
CATD3     INIT      "D3"
CATD4     INIT      "D4"
CATD5     INIT      "D5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATUC1    INIT      "wa"                    * Category User Def Code 1
CATUC2    INIT      "wb"                    * Category User Def Code 2
CATUC3    INIT      "wc"                    * Category User Def Code 3
CATUC4    INIT      "wd"                    * Category User Def Code 4
CATUC5    INIT      "we"                    * Category User Def Code 5
CATUC6    INIT      "wf"                    * Category User Def Code 6
CATUC7    INIT      "wg"                    * Category User Def Code 7
CATUC8    INIT      "wh"                    * Category User Def Code 8
NOTESKEY  DIM       12                      * Noteskey
.DIM2A     DIM       2                       * Time in Hours
DIM2B     DIM       2                       * Time in Minutes
LINKTYP   DIM       1                       * 0=Desc 1=Code 2=Select List
CATHLV    INIT      "w2"                    * Category Highlight Level
SEVRDESC  DIM      20
SELECTIO  DIM       1                       * Select IO Template No.
SHOWCDMI  DIM       1                       * Show Event Level CDM Icons
TXTLEN    FORM      3                       * Text Length
VISITNUM  DIM       4                       * Visit Number
VISCMFLG  FORM      1
FILENAMA  DIM       8                       * FileName of OBCAxxxx
FILENAMB  DIM       8                       * FileName of OBCBxxxx
OBCA      INIT      "obca"
OBCB      INIT      "obcb"
FAOPEN    DIM       8                       * OBCA File that is Open
FBOPEN    DIM       8                       * OBCB File that is Open
WBSEC008  DIM       3                        * Occupational Group
ALRTFLTR  DIM       2
CASEKEYS  DIM       28
CTYPDESC  DIM       25
CCRDTYPE  DIM       20
CCRDNUMB  DIM       20
CCRDEXDT  DIM       12
DELFLAG   FORM      1
EXCLWAIT  FORM      1
EXCLCLOS  FORM      1
FAILCNT   FORM      1
FILTFLAG  FORM      1
FILTHOSP  DIM       3
FILTVTYP  FORM      2
INFORMGP  DIM       1
OUTCDESC  DIM       25
UNKNFLAG  FORM      1                                                  *I-51223
VISTRCOD  DIM       20
VISTDESC  DIM       25
VTYPDESC  DIM       25
VISTDATE  DIM       11
VISTFLAG  FORM      1
VISTTIME  DIM       10
CODDFLAG  FORM      1
DISCFLAG  FORM      1
DDRGCODE  DIM       4
DMDCCODE  DIM       4
DRGVER    DIM       3
PUBLFLAG  FORM      1
HDPEQUIV  DIM       2
HISTDATE  DIM       8
HISTTIME  DIM       5
HISTREQB  DIM       35
HISTLOCN  DIM       30
DESCSNAG  DIM       20
DESCHOME  DIM       30
DESCCLOC  DIM       30
DESCDOCM  DIM       30
DTYPDESC  DIM       25
HWDSOUR   DIM       3                          * S37/P137 - WATCONFD
DISPSUR   DIM       8                          * Display Saved U/R Number
DISPMUR   DIM       8                          * Display Merged U/R Number
.
CHARCR    INIT      0x0D
ERRFLAG   FORM      1
EMRFLAG   FORM      1
INVNUMBR  DIM       8
HOSPNAME  DIM       50
CODEFA    INIT      "FA"
IPEVENT   INIT      "EV-IP"
OPEVENT   INIT      "EV-OP"
EMEVENT   INIT      "EV-EM"
SAVDATE   DIM       8
SAVTIME   DIM       8
SAVCHDT   DIM       8
SAVCHTM   DIM       8
SAVCHUD   DIM       4
SAVCLMNO  DIM       20
SAVETRID  DIM       24
SHOWMAP   FORM      1
SHOWSJOG  FORM      1
SUPERECL  FORM      1         * Eclipse Supervisor flag (1=yes/0=no)
VIEWINDI  FORM      1
PATLINK   DIM       127                     * Link to the next patient info
UPDLINK   DIM       400
CODTYP    FORM      2
DISNAM70  DIM       70
NAME70    DIM       70
STARTNOT  FORM      4
ZEROTWO   INIT      "02"
FORM3     FORM      3
FORM8     FORM      8
FORM8A    FORM      8
CATDESC   DIM       25
CODDESC   DIM       25
CODESTAT  FORM      1
EPISODNO  FORM      2                       * Episode No
EPSCD001  FORM      2                       * Episode No (CGI Parameter)
EPSSLIST  FORM      1[99]                   * Episode Select List
.
FINFLAG   FORM      1
NMDSLIST  DIM       1                       * Show Update Medical Record        
RECCNT    FORM      3
DRECCNT   DIM       3
CHECKCNT  FORM      1
VISCOUNT  FORM      5
NOURSELC  DIM       1
OUTVISTT  DIM       1
OUTPSITE  DIM       6                       
OUTADMIS  DIM       8
OUTORDER  DIM       1                       * 0 = bookings the visit
.                                           * 1 = visits then bookings
REFTDESC  DIM       20
SHOWFRMT  DIM       1                       * Display format for visit list     
.                                           * 0 = Standars 1 = kids
SAVADMNO  DIM       8
SHOWMEDL  DIM       1                       * Show Update Medical Record        
.                                           * 0 = No 1 = Yes
SRCHVIEW  FORM      1                       * Show format for visit search
.                                           * 1 = Allied Health Visit Search
.
.         HPS BLR Comment Ends Here
MAVBATCH  DIM       8
MAVINVCE  DIM       8
MAVMODUL  DIM       1
MBSDESC   DIM       40
MOVEDESC  DIM       25
MRGEFLAG  FORM      1
MOVEADM   INIT      "Admission "
MOVECHG   INIT      "Change    "
MOVEDIS   INIT      "Discharged"
MOVELVE   INIT      "On Leave  "
MOVERET   INIT      "Return    "
MEH01     INIT      "MEHWEB01"
.
ALIASIND  DIM       1
ADMISSF8  FORM      8
ATYPDESC  DIM       25
BEDTRKEY  DIM       30
BTYPDESC  DIM       25
WARDNAME  DIM       25
TODAY     DIM       8
TRANDATE  DIM       12
ADMNDATE  DIM       12
DISCDATE  DIM       12
DATOFBIR  DIM       11
.
DLINKPRG  DIM       8
DLINKREP  DIM       2
DLINKTEM  DIM       3
.
EMPLNAME  DIM       30
EMPLADD1  DIM       35
EMPLADD2  DIM       35
EMPLADD3  DIM       35
EMPLADD4  DIM       35
.
LINKNUM   DIM       2
EPISODE   DIM       2
DOCTCODE  DIM       6
DSCHFLAG  FORM      1
PMVXFLAG  FORM      1
PMSVX044  DIM       3     * Coder Snags
PRIDISCD  DIM       9     * Primary Disease Code - I CAR 18122
PDIADESC  DIM       70    * Primary Disease Code Description - I CAR 18122
PRIOPRCD  DIM       9     * Primary Operation Code
POPRDESC  DIM       70    * Primary Operation Code Description
.PTVIS067  DIM       50    * Diet Comment - I SRF 22685
BRECFLAG  FORM      1
BOOKFLAG  FORM      1     * Book Referral Letter Flag
.
DOWNLD01  FORM      1
DOWNLD02  FORM      1
DOWNLD03  FORM      1
DOWNLD04  FORM      1
DOWNLD05  FORM      1
DOWNLD06  FORM      1
DOWNLD07  FORM      1
DOWNLD08  FORM      1
.
KEY1A     DIM       1
KEY4A     DIM       4
.DIM4      DIM       4
DIM6      DIM       6
DIM9      DIM       9
DRGFLAG   FORM      1
HLFDCLTY  DIM       1
HLTHFUND  DIM       6
TEMPINVN  DIM       8         * Invoice Number
TEMPBATN  DIM       8         * Batch Number
TEMPADMN  DIM       8         * Admission Number
TEMPURNO  DIM       8         * U/R Number
TEMPHFND  DIM       6         * Health Fund
TEMPPBAT  DIM       8         * Previous Batch Number
TEMPHOSP  DIM       3         * Hospital Code
TEMPMODL  DIM       1
TTYPEARG  DIM       2
TOTOUTS   FORM      12.2
TOTPAID   FORM      12.2
SLOTNUMB  DIM       3
SAVEURNO  DIM       8
SRCHTYPE  FORM      1
PROCSTAT  DIM       1
NEXTVKEY  DIM       26
PREVVKEY  DIM       26
SKEY31    DIM       31
PREVFLAG  FORM      1  
SAVKEY26  DIM       26
SAVKEY44  DIM       44
INPATVIS  INIT      " 3"
OUTPVIS   INIT      " 2"
EMERGVIS  INIT      " 1"
ALLIVIS   INIT      "10"
EVENVIS   INIT      " 9"
SITEDONE  FORM      1
SUMOUTS   FORM      12.2
SUMPAID   FORM      12.2
SUMINV    FORM      12.2
SUMJR     FORM      12.2
SHOWFLAG  FORM      1
.
UNIQNUMB  DIM       8
.PRHRE001  DIM       6
.PRHRE002  DIM       10
.PRHRE003  DIM       3
.
CFILEPRE  DIM       3
WAITSTAT  FORM      1
STATDESC  DIM       20
STATCODE  DIM       1
CLAIMCOD  DIM       6
CLAIMTYP  DIM       1
UNITCODE  DIM       6
UNITDESC  DIM       20
PRIODESC  DIM       25
SRCRDESC  DIM       25
PRIOSTAT  DIM       25
PRIOOVER  DIM       8
OVERSTAT  DIM       1
RSUBINDI  FORM      1
.
PATPA001  DIM       8     * Patient U/R Number
PATPA002  DIM       8     * Date this add was changed (CCYYMMDD)
.PATPA003  DIM       35    * Previous Address Line 1
.PATPA004  DIM       35    * Previous Address Line 2
.PATPA005  DIM       35    * Previous Suburb
.PATPA006  DIM       35    * Previous Address Line 4
.PATPA007  DIM       8     * Previous Postcode
.PATPA008  DIM       20    * Previous Private Telephone
.PATPA009  DIM       20    * Previous Business Telephone
.PATPA010  DIM       3     * District of Residence
.PATPA011  DIM       20    * Previous Mobile Phone Number
.PATPA012  DIM       10    * Web User ID
.
SMPOLIC    DIM      20   * POLICE STAT. ACCT REPORTED TO
SMACDAT    DIM       8   * DATE OF ACCIDENT (YYMMDD)
SMSNAME    DIM      30   * SOLICITOR NAME
SMSTELE    DIM      12   * SOLICITOR TELEPHONE
SMCREGO    DIM      36   * CAR REGO NUMBERS INVOLVED
SMACLOC    DIM      40   * ACCIDENT LOCATION
SMDPINDI   FORM      1   * 1= DRIVER, 2= PASSENGER
SMENGAGE   DIM      20   * WHILE ENG IN-FREE FORMAT ENTRY
SMPINJUR   DIM      30   * PATIENT INJURED WHEN
SMMDTRAN   DIM      10   * MODE OF TRANSPORT
SMMECHSE   DIM      30   * MECHANISM OF SEVERIST INJURY
SMREGNSE   DIM      20   * REGION OF SEVERIST INJURY
SMOTHDE1   DIM      30   * OTHER DRIVER DETAILS LINE 1
SMOTHDE2   DIM      30   * "     "      "     LINE 2
SMOTHDE3   DIM      30   * "     "      "     LINE 3
SPTWMTAC   FORM      1   * TAC CLAIM FORM COMPLETED ?
SPTWMTYP   DIM       3   * Role in Accident (CAT RA)
.
SUPERLEV  DIM       1
SWCENAME  DIM      30    * EMPLOYER NAME
SWCEADD1  DIM      35    * EMPLOYER ADDRESS LINE 1
SWCEADD2  DIM      35    * EMPLOYER ADDRESS LINE 2
SWCEADD3  DIM      35    * EMPLOYER ADDRESS LINE 3
SWCEADD4  DIM      35    * EMPLOYER ADDRESS LINE 4
SWCEPOST  DIM       8    * EMPLOYER POSTCODE
SWCETELE  DIM      20    * EMPLOYER TELEPHONE
SWCACDAT  DIM       8    * DATE OF ACCIDENT (YYMMDD)
SWCACCPT  FORM      1    * ACCEPTED BY INSURANCE COMPANY
SWCICODE  DIM       6    * INSURANCE COMPANY CODE
SWCCLMNO  DIM      20    * INSURANCE CLAIM NUMBER 
SWCCOMN1  DIM      40    * COMMENTS
SWCCOMN2  DIM      40    * COMMENTS
SPMWXALO  DIM      50    * Accident Location                  
SPMWXCIN  DIM      3     * Cause of Injury (Cat IK)           
SPMWXICO  DIM      3     * Injury Code (Cat IJ)               
SPMWXCNA  DIM      40    * Contact Name                       
.
COMMTYPE  DIM       3    * Comment Type
COMMLINO  DIM       3    * Comment Line No
COMMCONT  FORM      3    * Comment Count
SAVDATA1  DIM       65 
SAVDATA2  DIM       100 
.
TYPEDESC  DIM       20
TYPOFREQ  FORM      2             * Eclipse type of request
.
NULL      EQU      000
.
.
PTMMB001  DIM        9             * MBS Code
PTMMB002  DIM        8             * Admission Number
PTMMB003  FORM       2             * Record number for admission
PTMMB004  DIM        8             * Operation Date
PTMMB005  DIM        5             * Operation Start Time
PTMMB006  DIM        5             * Operaton End Time
PTMMB007  DIM       70             * Free Format description
DIM40     DIM       40
.
DASH      INIT      "-"
PFFUND    DIM       1     * Program Funding Source
CBOOK     FORM      1     
HBWAIT    FORM      1 
.
CFPAYCOD  DIM       3        * 3M Codefinder PAY Code
.
.
WAITST01  INIT      "Unscheduled  "
WAITST02  INIT      "Scheduled    "
WAITST03  INIT      "Pre-Admitted "
WAITST04  INIT      "Admitted     "
WAITST05  INIT      "Discharged   "
WAITST06  INIT      "Removed      "
WAITST07  INIT      "Performed    "
WAITST08  INIT      "Not Performed"
ENDDAT    DIM       8
ENDDTIME  DIM       5
TACRECKY  DIM       8[50]
WCORECKY  DIM       8[50]
ERRORCNT  FORM      3                 * Count of Errors
ERRORLST  DIM       90[50]            * Error Array
.
.   ****** MEDICARE WEBSERVICES PRODA MANAGEMENT VARIABLES ***********
.
WBSPROID  DIM       60                * Product ID
WBSJKSLO  DIM       60                * JKS/Certificate File Location
WBSPRORG  DIM       60                * PRODA Organisation ID
WBSDVNAM  DIM       60                * Device Name
WBSCLIID  DIM       60                * Client ID
WBSACTAU  DIM       60                * Access Token Audience
WBSACTVC  DIM       60                * Activation Code
WBSDACUR  DIM       60                * Device Activation URL
WBSDAUUR  DIM       60                * Device Authentication URL
WBSRDKUR  DIM       60                * Refresh Device Key URL
.
WBSPILAB  DIM       17                * Product ID Label
WBSJKLAB  DIM       20                * JKS File Location Label
WBSPOLAB  DIM       18                * Proda Org Id Label
WBSDNLAB  DIM       18                * Device Name Label
WBSCILAB  DIM       16                * Client ID Label
WBSATLAB  DIM       27                * Access Token Audience Label
WBSACLAB  DIM       22                * Activation Code Label
WBSDALAB  DIM       27                * Device Activation URL Label
WBSDULAB  DIM       31                * Device Authentication URL Label
WBSRDLAB  DIM       27                * Refresh Device Key URL Label
.
WBSRV001  DIM       60                * Product ID
WBSRV002  DIM       60                * JKS/Certificate File Location
WBSRV003  DIM       60                * PRODA Organisation ID
WBSRV004  DIM       60                * Device Name
WBSRV005  DIM       60                * Client ID
WBSRV006  DIM       60                * Access Token Audience
WBSRV007  DIM       60                * Activation Code
WBSRV008  DIM       60                * Device Activation URL
WBSRV009  DIM       60                * Device Authentication URL
WBSRV010  DIM       60                * Refresh Device Key URL
.
WBSPROPF  FILE      ASCII,FIXED=256
WBSACTVF  FILE      ASCII,FIXED=256
WBSTOKNF  FILE      ASCII,FIXED=256
WBSACTOF  FILE      ASCII,FIXED=256
WBSTOKOF  FILE      ASCII,FIXED=256
PRODAIND  DIM       1
PRDAPATH  DIM       120
ACTVPATH  DIM       120
TOKNPATH  DIM       120
ACTOPATH  DIM       120
TOKOPATH  DIM       120
PRDAFILE  INIT      "webPAS_PRODA.properties"
ACTVFILE  INIT      "webPAS_PRODA_ActivateDevice_curl_response"
TOKNFILE  INIT      "webPAS_PRODA_GetAccessToken_curl_response"
ACTOFILE  INIT      "webPAS_PRODA_ActivateDevice_curl_errors"
TOKOFILE  INIT      "webPAS_PRODA_GetAccessToken_curl_errors"
.
.   ****** HPS BLR DECLARATION STARTS HERE    ***********
.
.         HPS BLR Code Starts Here
VISADIAG  DIM       12                *Diagnosis Code
ADIADESC  DIM       25
DDIADESC  DIM       25
VISTLOC   DIM       7
VISHOSID  INIT      "01"
SECOPT    DIM       1
VISTDAY   DIM       5
PVISYSN   FORM      2
VISTCOMH  INIT      "COM"
VISTEMER  INIT      "EMG"
VISTOUTP  INIT      "OP"
VISTINPT  INIT      "IP"
VISTALLH  INIT      "RF"
VISTEVNT  INIT      "EV"
VISTTYPE  DIM       5
VSTATUS   DIM       35
VIEWFLAG  FORM      1
VOLNDESC  DIM       16
.
EMGSTAT1  INIT      "Current"
.
INPSTAT1  INIT      "Pre-adm"
INPSTAT2  INIT      "Current IP"
INPSTAT3  INIT      "Discharged"
INPSTA3A  INIT      "Disc-"
INPSTA3B  INIT      "Cancelled"
INPSTAT4  INIT      "Leave"
INPSTAT5  INIT      "Cancel"
.
ALLSTAT0  INIT      "Waiting"
ALLSTAT1  INIT      "Active"
ALLSTAT2  INIT      "Closed"
ALLSTAT3  INIT      "Inactive"
ALLSTAT4  INIT      "Cancelled"
ALLSTAT5  INIT      "Rejected"
.
WLSTAT1   INIT      "Unscheduled"
WLSTAT2   INIT      "Scheduled"
WLSTAT3   INIT      "Pre-Admitted"
WLSTAT4   INIT      "Admitted"
WLSTAT5   INIT      "Discharged"
WLSTAT6   INIT      "Removed from W/L"
WLSTAT7   INIT      "Performed"
WLSTAT8   INIT      "Not Performed"
WLSTAT9   INIT      "Cancelled Booking"
.
OEVSTA0   INIT      "Outpatient-ATTENDED"
OEVSTA1   INIT      "Outpatient-NO ATTENDANCE"
OEVSTA2   INIT      "Outpatient-CANCELLED"
OBRACKET  INIT      "("
CBRACKET  INIT      ")"
.
STATUS00  INIT      "Waiting    "
STATUS01  INIT      "Ext. Error "
STATUS02  INIT      "Extracted  "
STATUS03  INIT      "SA Error   "
STATUS04  INIT      "Received   "
STATUS05  INIT      "Medicare Unverified "
STATUS06  INIT      "Medicare Verified   "
STATUS07  INIT      "Health Fund Unverified"
STATUS08  INIT      "Health Fund Verified  "
STATUS09  INIT      "Medicare Assessing    "
STATUS10  INIT      "Health Fund Assessing "
STATUS11  INIT      "Medicare Rejected     "
STATUS12  INIT      "Health Fund Rejected  "
STATUS13  INIT      "Requested Delete      "
STATUS14  INIT      "Assessing Complete    "
STATUS15  INIT      "MC - Rejected  - Reported"
STATUS16  INIT      "HF - Rejected  - Reported"
STATUS17  INIT      "Complete - Reported"
STATUS18  INIT      "Remittance Reported"
STATUS19  INIT      "Closed"
.
STATSF00  INIT      "Waiting    "
STATSF01  INIT      "Ext. Error "
STATSF02  INIT      "Extracted  "
STATSF03  INIT      "SA Error   "
STATSF04  INIT      "Received   "
STATSF05  INIT      "Closed     "
.
.------ Eclipse Bulk Billing transaction statuses OUTECTFD.DOTECFLG *T0859743
STATBB01  INIT      "Error PAS validation"
STATBB02  INIT      "Extracted           "
STATBB03  INIT      "Error SA validation "
STATBB04  INIT      "Received            "
STATBB05  INIT      "Complete - Reported "
STATBB06  INIT      "Reported            "
STATBB07  INIT      "Closed              "
.-----------------------------------------------------------------------------
.
TYPEDES1  INIT      "Status Request      "
TYPEDES2  INIT      "Status Req. Response"
TYPEDES3  INIT      "Report Request      "
TYPEDES4  INIT      "Report Req. Response"
TYPEDES5  INIT      "Viewed              "
TYPEDES6  INIT      "Data Error          "
TYPEDES7  INIT      "Trans. Error        "
.
TYPEDSF1  INIT      "Viewed              "
TYPEDSF2  INIT      "Data Error          "
TYPEDSF3  INIT      "Trans. Error        "
.
.------- Eclipse Bulk Billing - Type OUTECAFD.OTEATYPE               *T0859743
TYPEDBB1  INIT      "Report Request      "
TYPEDBB2  INIT      "Report Request Resp "
TYPEDBB3  INIT      "Viewed              "
TYPEDBB4  INIT      "Data Error Response "
TYPEDBB5  INIT      "Trans. Error Resp   "
.-----------------------------------------------------------------------------
.
SUBMITED  INIT      "Submitted"
SENT      INIT      "Sent"
RECEIPTD  INIT      "Receipted"
FAILED    INIT      "Failed"
SLSH      INIT      "/"
TILDA30   INIT      "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
.
.------------------------------------------------------------------------
PRGID     INIT      "ECLWEB01"
VERSION   INIT      "V12.00.01"
PRGNAM    INIT      "Eclipse Server 1"
.------------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          IF        PTCNNHII=1
            CALL      CONNECT      * Basic Patient Details
          ENDIF
.
          CALL      OUTFIL00       * Check Correct Site Files Are Open
          BRANCH    EXIT,MAIN1000
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "INVALID OPTION ECLWEB01",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      GETPAT00
          GOTO      MAIN1000
.
MAIN1200  CALL      EIMC0000   * Eclipse IMC Claim Full Details
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      EMCE0000   * Eclipse IMC Claim Enquiries
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      REMOTE00        * Various Remote Scripting Functions
          GOTO      MAIN1000
.
MAIN1500  CALL      ESTF0000   * Eclipse Store and Forward Claim Full Details
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      EMSE0000   * Eclipse STF Claim Enquiries
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      CLMT0000   * Eclipse Claimaint NOI Functionality
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
.--------------------------------------------------------- *T0859743-Start
MAIN1800  CALL      ECBB0000   * Eclipse Bulk Billing Claim Full Details
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1900  CALL      EBBQ0000   * Eclipse Bulk Billing Claim Enquiries
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000                              
.--------------------------------------------------------- *T0859743-End
.
MAIN2000  CALL      PRDA0000   * Medicare WebServices PRODA Management
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50:
                       NXTPAG60
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  CALL      PREDIR00
          GOTO      NXTPAG99
.
NXTPAG60  CALL      RELOAD00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                             " alert(#"",WEBTITLE,"#");":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  CALL      INTMAS00   * Open Files Required for PATMASTM
          OPEN      ACCDIAA1,"accdiaaf"
          OPEN      AAEDE1A1,"aaede1af"
          OPEN      AAEDI1A1,"aaedi1af"
          OPEN      EMRICDA1,"emricdaf"
          OPEN      HICEMSA1,"hicemsaf"
          OPEN      IBAPRTA1,"ibaprtaf"        * For Printer Selection
          OPEN      IBACODE1,"ibacodef"        * For Printer Selection
          OPEN      IHAPASS1,"ihapassf"        * For Printer Selection
          OPEN      IBAPDFA1,"ibapdfaf"        * For default printer selection
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      MRTAUCA2,"mrtaucaf"
          OPEN      MRTMASA1,"mrtmasaf"
          OPEN      MRTMASA2,"mrtmasaf"
          OPEN      MRTHISA1,"mrthisaf"
          OPEN      MRTSTFA1,"mrtstfaf"
          OPEN      MRTLOCA1,"mrtlocaf"
          OPEN      MRTPDSA1,"mrtpdsaf"
          OPEN      MRTVISA1,"mrtvisaf"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATDADA1,"patdadaf" 
          OPEN      PATCHCO1,"patchcof"
          OPEN      PATFACT1,"patfactf"
          OPEN      PATINVR1,"patinvrf"
          OPEN      PATINVR3,"patinvrf"
          OPEN      PATINVR5,"patinvrf"
          OPEN      PATIN1A1,"patin1af"
          OPEN      PATUNAA1,"patunaaf"
          OPEN      PMSAIDA2,"pmsaidaf"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSCTCA1,"pmsctcaf"
          OPEN      PMSCLTA1,"pmscltaf"
.
          MOVE      ZERO,OVRFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSOVRA1,"pmsovraf"
          TRAPCLR   IO
          IF        OVRCD=0
            MOVE      ONE,OVRFLAG
          ENDIF
.
          MOVE      ZERO,OVVFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSOVVA1,"pmsovvaf"
          TRAPCLR   IO
          IF        OVRCD=0
            MOVE      ONE,OVVFLAG
          ENDIF
.
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PMSEVTA1,"pmsevtaf"
          OPEN      PMSTLEA1,"pmstleaf"          * open Patient Titles table
          OPEN      PMSTLEA2,"pmstleaf"          *
          OPEN      PATPA1A1,"patpa1af"
          OPEN      PATPGRA1,"patpgraf" 
          OPEN      PATGSRN1,"patgsrnf" 
          OPEN      PATICDO1,"paticdof"
          OPEN      PATICUA1,"paticuaf"
          OPEN      PATI10O1,"pati10of"
          OPEN      PATICDD1,"paticddf"
          OPEN      PATI10D1,"pati10df"
          OPEN      PATFLET2,"patfltrf"
          OPEN      PATMESG1,"patmesgf"
.         OPEN      PMSCDNA1,"pmscdnaf"
.
          MOVE      ZERO,ARCFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      ARCVX1A1,"arcvx1af"
          TRAPCLR   IO
          IF        OVRCD=0
            MOVE      ONE,ARCFLAG
          ENDIF
.
          OPEN      PMSVX1A1,"pmsvx1af" 
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATRGMA1,"patrgmaf"
          OPEN      BOKDIAA1,"bokdiaaf"
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      BOKRX1A1,"bokrx1af"
          OPEN      BOKRC1A6,"bokrc1af"
          OPEN      WATTR1A1,"wattr1af"
          OPEN      WATTX1A1,"wattx1af"
          OPEN      WEBSECA3,"websecaf"
          OPEN      PATEORA1,"pateoraf"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      VISPAYA1,"vispayaf"
.
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATPEIO1,"patpeiaf"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PATVADA1,"patvadaf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PATVISA4,"patvisaf"
          OPEN      NZPSPRA1,"nzpspraf"
.         OPEN      MEHVI1A1,"mehvi1af"
.         OPEN      MEHVI1A4,"mehvi1af"           * I SRF 22727
.         OPEN      MEHLEGA1,"mehlegaf"           * I SRF 22727
          OPEN      PATMMBS1,"patmmbsf"
          OPEN      PATMMBS2,"patmmbsf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PATHSPA1,"pathspaf"
.
          OPEN      ALLREFA1,"allrefaf"
          OPEN      ALLRLNA2,"allrlnaf"
          OPEN      ALLDEPA1,"alldepaf"
          OPEN      ALLENCA1,"allencaf"
          OPEN      PATDADA1,"patdadaf"
          OPEN      PATNIDA2,"patnidaf"
          OPEN      PATASFA1,"patasfaf"
          OPEN      PATSFAA1,"patsfaaf"
          OPEN      PATWVET1,"patwvetf"
          OPEN      PATWMAB1,"patwmabf"
          OPEN      PATWMAB2,"patwmabf"
          OPEN      PATWMAB3,"patwmabf"
          OPEN      PATWC1A1,"patwc1af"
          OPEN      PATWC1A2,"patwc1af"
          OPEN      PATWC1A3,"patwc1af"
          OPEN      PMSWX1A1,"pmswx1af"
          OPEN      ACCCMTA1,"acccmtaf"
          OPEN      PMSRESA1,"pmsresaf"
          OPEN      PMSWORA1,"pmsworaf"
          OPEN      PATW11A1,"patw11af"                                *I-43498
          OPEN      PATW12A1,"patw12af"                                *I-51504
          OPEN      PATW12B1,"patw12bf"
          OPEN      PATW13A1,"patw13af"
          OPEN      PATW14A1,"patw14af"                               *I-145161
          OPEN      PATW15A1,"patw15af"
          OPEN      PATW16A1,"patw16af"
          OPEN      PATW17A1,"patw17af"
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EMRUNKA1,"emrunkaf"
          OPEN      EMRVISA1,"emrvisaf"
          TRAPCLR   IO
          MOVE      OVRCD,EMRFLAG
.
          OPEN      PATECDA1,"patecdaf"
          OPEN      PATECOA1,"patecoaf"
          OPEN      PATECDA2,"patecdaf"
          OPEN      PATECOA2,"patecoaf"
.
          CALL      OPICD1                      * Open ICD Disease files
          CALL      OPICO1                      * Open ICD Operation files
.
          OPEN      MLTSECA1,"mltsecaf"
          OPEN      VISMDTA1,"vismdtaf"
          OPEN      VISMTXA1,"vismtxaf"
          OPEN      PMSNUTA1,"pmsnutaf"         * new nutrition file v9.02.17
          OPEN      OBSPINA1,"obspinaf"
          OPEN      OBSCNAA1,"obscnaaf"
          OPEN      OBSCNBA1,"obscnbaf"
          OPEN      OBSCNCA1,"obscncaf"
          OPEN      OBSCNCA2,"obscncaf"
          OPEN      OBSDIAA1,"obsdiaaf"
          OPEN      OBSBPHA1,"obsbphaf"
          OPEN      OBSPROA1,"obsproaf"
          OPEN      OBSREAA1,"obsreaaf"
          OPEN      OBSBHIA1,"obsbhiaf"
          OPEN      OBSLABA1,"obslabaf"
          OPEN      OBSMEDA1,"obsmedaf"
          OPEN      OBSRESA1,"obsresaf"
          OPEN      OBSPHYA1,"obsphyaf"
          OPEN      OBSDITA1,"obsditaf"
          OPEN      OBSCALA1,"obscalaf"
          OPEN      OBSCALA1,"obscalaf"
          OPEN      PATMI1A8,"patmi1af"
          OPEN      IBASPOL1,"ibaspolf"         * For spool file       
          OPEN      CONTROLF,"controlf"         * For spool file       
          READ      CONTROLF,ZERO;*43,IBCNMHOS,*85,IBCNUGST
          READ      CONTROLF,TEN;*250,CAUDA1
          READ      CONTROLF,HUND12;*101,PTCNUFFR
          READ      CONTROLF,HUND10;*240,PTCNUALT
          READ      CONTROLF,HUND16;*214,PTCNDCDM
          READ      CONTROLF,HUND06;*203,ALCNMDES
          READ      CONTROLF,FIFTY9;*193,PTCNRQCF
          READ      CONTROLF,HUND06;*217,ALCNCLNF
          COMPARE   ONE,PTCNRQCF       * Using Free Format Requester
          IF        !@EQUAL
            OPEN      MRTSTFA1,"mrtstfaf"
          ENDIF
.
          IF        CAUDA1<>1
            OPEN      PATAUDAL,"pataudal"
            OPEN      PATAUDA2,"pataudal"
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
           
.
.  Katie - have a look into what this if statement is doing 01/02/200 - Comments at Taranaki
.
..          READ      CONTROLF,TWENTY;*164,PTCNUPCM
..          IF        PTCNUPCM=1
..            OPEN      PATCMNT1,"patxcmaf"     * new extra comments file
..          ELSE
.
..            OPEN      PATCMNT1,"patcmntf"
.
..          ENDIF
...........

          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,TEN;*126,CLABPG,CLABPRT,*235,CMDISP
          READ      CONTROLF,TEN3;*188,CMABINS,CVETINS
          READ      CONTROLF,TWENTY;*223,PTCNLNFF,*224,PTCNCHFF
          READ      CONTROLF,THIRTY7;*137,HWDSOUR
          READ      CONTROLF,FIFTY9;*35,CTYPLAB,*220,PTCNUADT
          READ      CONTROLF,EIGHTY;*249,PTCNEDTE
          READ      CONTROLF,EIGHTY8;*59,PTCNI10D
          READ      CONTROLF,EIGHTY9;*180,EMCNLDAT
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          READ      CONTROLF,TWENTY1;*45,PTCNDRSM 
          READ      CONTROLF,SIXTY9;*43,MHCNAUDA,*69,MHCNUSE,*82,MHCNDVIS
          READ      CONTROLF,HUND09;*177,PTCNNHTM
          READ      CONTROLF,TWENTY;*52,PTPCLRES
          READ      CONTROLF,TWENTY1;*237,PTCNPAOF,*238,PTCNAGEC
          READ      CONTROLF,THIRTY3;*200,PRCNRDOC
          READ      CONTROLF,HUND05;*158,PTCNDGPV,*211,PTCNBPAY: *I-43526I-48227
                                    *217,PTCNGDV4,*227,PTCNGDV5       *C-105244
          READ      CONTROLF,HUND09;*151,PTCNGDV3                      *I-51504
          READ      CONTROLF,HUND12;*96,PTCNH7AC,*239,PTCNGDV6        *C-163918
          READ      CONTROLF,HUND10;*61,PTCNGDV7:                     *I-219246
                                    *69,PTCNGDV8:                     *I-284420
                                    *77,PTCNGDV9:                     *I-311669
                                    *85,PTCNGDVX                      *I-0833093
          READ      CONTROLF,HUND17;*220,PTCNGDX1
          READ      CONTROLF,HUND24;*111,PTCNUIMC,*222,PTCNUESF
          READ      CONTROLF,HUND27;*122,PTCNUEBB                     *T0859743
          READ      CONTROLF,HUND28;*231,PTCNGDX2                     *I-0917793
          READ      CONTROLF,HUND30;*86,PTCNGDX3                      *I-0956210
          READ      CONTROLF,HUND29;*1,PTCNWSDR,*61,PTCNWSIN
.
          OPEN      OUTSITA1,"outsitaf"     * Open the site file
          OPEN      OUTSITA3,"outsitaf"     * Open the site file
          MOVE      "out",CFILEPRE          * Save Current File Prefix
          CALL      OPNOUT00                * Open Outpatient Files 
          OPEN      OUTRF1A1,"outrf1af"
          IF        PTCNNHII=1
            OPEN      PATMWSA1,"patmwsaf"
          ENDIF
.
          OPEN      ALLCASA1,"allcasaf"
.
          OPEN      PRISECA1,"prisecaf"
          OPEN      PRIALSA1,"prialsaf"
          OPEN      PRIPRAC1,"pripracf"
          OPEN      PMSETRA1,"pmsetraf"
          OPEN      PMSECOA1,"pmsecoaf"
          OPEN      PMSECOA2,"pmsecoaf"
          OPEN      PRIHDBT2,"prihdbtf"
          OPEN      PRIHREF1,"prihreff"
          OPEN      PRIDTRA1,"pridtraf"
          OPEN      PRIINVO1,"priinvof"
.
          MATCH     "1",PTCNUIMC
          IF        @EQUAL
            OPEN      PRIECTA1,"priectaf"
            OPEN      PRIECTA2,"priectaf"
            OPEN      PRIECTA3,"priectaf"
            OPEN      PRIECTA5,"priectaf"
            OPEN      PRIECTA6,"priectaf"
            OPEN      PRIECAA1,"priecaaf"
            OPEN      PRIECAA2,"priecaaf"
            OPEN      PRIECAA3,"priecaaf"
            OPEN      PRIEAHA1,"prieahaf"
            OPEN      PRIEAHA2,"prieahaf"
            OPEN      PRIEADA1,"prieadaf"
            OPEN      PRIESHA1,"prieshaf"
            OPEN      PRIESDA1,"priesdaf"
            OPEN      PRIIBHA1,"priibhaf"
            OPEN      PRIIBHA2,"priibhaf"
          ENDIF
.
          MATCH     "1",PTCNUESF
          IF        @EQUAL
            OPEN      EMRECTA1,"emrectaf"
            OPEN      EMRECTA2,"emrectaf"
            OPEN      EMRECTA3,"emrectaf"
            OPEN      EMRECTA5,"emrectaf"
            OPEN      EMRECTA6,"emrectaf"
            OPEN      EMRECAA1,"emrecaaf"
            OPEN      EMRECAA2,"emrecaaf"
            OPEN      EMRECAA3,"emrecaaf"
            OPEN      EMRIBHA1,"emribhaf"
            OPEN      EMRIBHA2,"emribhaf"
          ENDIF
.
.-------- Eclipse Bulk Billing                             *T0859743
          MATCH     "1",PTCNUEBB
          IF        @EQUAL
            OPEN      OUTECTA1,"outectaf"
            OPEN      OUTECTA2,"outectaf"
            OPEN      OUTECTA3,"outectaf"
            OPEN      OUTECTA5,"outectaf"
            OPEN      OUTECTA6,"outectaf"
            OPEN      OUTECAA1,"outecaaf"
            OPEN      OUTECAA2,"outecaaf"
            OPEN      OUTECAA3,"outecaaf"
            OPEN      OUTEAHA1,"outeahaf"
            OPEN      OUTEAHA2,"outeahaf"
            OPEN      OUTERHA1,"outerhaf"
            OPEN      OUTERHA2,"outerhaf"
            OPEN      OUTERHA3,"outerhaf"
            OPEN      OUTERHA4,"outerhaf"
            OPEN      OUTERDA1,"outerdaf"
            OPEN      OUTERDA2,"outerdaf"
            OPEN      OUTERDA3,"outerdaf"
            OPEN      OUTEADA1,"outeadaf"
            OPEN      OUTEADA2,"outeadaf"
            OPEN      OUTIBHA1,"outibhaf"
            OPEN      OUTIBHA2,"outibhaf"
          ENDIF
.
INIT9999  RETURN
.*******************************************************************************
. OUTFIL00 - Check if the user id has an outpatienty site. If they do open
.            the correct outpatient files according to the site. If they do not
.            have a site make sure the default prefix of out is is used to 
.            open the files.
.*******************************************************************************
OUTFIL00  MATCH     SP70,WBSESIT             * Does the user have a site
          GOTO      OUTFIL50 IF NOT EQUAL
.
OUTFIL10  MATCH     "out",CFILEPRE           * Is out currently open
          IF        !@EQUAL
            MOVE      "out",OSTFILE          * open default prefix of out
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open out Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL50  MOVE      WBSESIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,OUTFIL90           * error invalid site code
.
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL90  MOVE      "Outpatient Site Invalid",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
OUTFIL99  RETURN
.------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILBOKA3  * Get the name of the BOKA3 file
          CLOSE     OUTBOKA3
          OPEN      OUTBOKA3,CFNAME           * Open the file
          CLOSE     OUTBOKA2
          OPEN      OUTBOKA2,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILRSHA1
          CLOSE     OUTRSHA1
          OPEN      OUTRSHA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILCANA2
          CLOSE     OUTCANA2
          OPEN      OUTCANA2,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILBB1A1  * Get the name of the BOKA3 file
          CLOSE     OUTBB1A1
          OPEN      OUTBB1A1,CFNAME     
.
          PACK      CFNAME,CFILEPRE,FILSESA1  * Get the name of the SESA1 file
          CLOSE     OUTSESA1
          OPEN      OUTSESA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCTYA1  * Get the name of the CTYA1 file
          CLOSE     OUTCTYA1
          OPEN      OUTCTYA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILMA1A1
          CLOSE     OUTMA1A1
          OPEN      OUTMA1A1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILHEDA1
          CLOSE     OUTHEDA1
          OPEN      OUTHEDA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILDIAG1
          CLOSE     OUTDIAG1
          OPEN      OUTDIAG1,CFNAME    
.
OPNOUT99  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,URNUMBER
          MOVE      SP70,PATALTID
          MOVE      SP70,PMSALTID
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,EPSCD001
          MOVE      SP70,SAVEURNO
          MOVE      SP70,ADMISSNO
          MOVE      ZERO,STARTNOT
          MOVE      SP70,NEXTPAGE
          MOVE      SP70,NOURSELC
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,MRGEFLAG
          MOVE      ZERO,SRCHTYPE
          MOVE      ZERO,DOWNLD01
          MOVE      ZERO,DOWNLD02
          MOVE      ZERO,DOWNLD03
          MOVE      ZERO,DOWNLD04
          MOVE      ZERO,DOWNLD05
          MOVE      ZERO,DOWNLD06
          MOVE      ZERO,DOWNLD07
          MOVE      ZERO,DOWNLD08
          MOVE      SP70,PATPA001
          MOVE      SP70,PATPA002
          MOVE      SP70,PMSVX044      * Coder Snags
          MOVE      ZERO,CODEDFLG
          MOVE      ZERO,VIEWTYPE
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,FILTFDAT
          MOVE      SP70,FILTTDAT
          MOVE      SP70,VYEARMTH
          MOVE      ZERO,CHECKCNT
          MOVE      SP70,CLNOT001
          MOVE      SP70,WBSEC008
          MOVE      SP70,ALRTFLTR
          MOVE      ZERO,BOOKFLAG
.          MOVE      Z70,PTVIS067       * I SRF 22685
          MOVE      SP70,ECOTFUND
          MOVE      SP70,ECOTTYPE
          MOVE      SP70,ECOTTRID
          MOVE      ZERO,FILTVTYP
          MOVE      ZERO,FILTFLAG
          MOVE      SP70,FILTHOSP
          MOVE      ZERO,STARTNUM
          MOVE      SP70,MAVBATCH
          MOVE      SP70,MAVINVCE
          MOVE      SP70,MAVMODUL
          MOVE      ZERO,NORECORD
          MOVE      SP70,NEXTVKEY
          MOVE      SP70,PREVVKEY
          MOVE      ZERO,PREVFLAG
          MOVE      ZERO,UPDATETY
          MOVE      SP70,UPDATTYP
          MOVE      ZERO,EMREVENT
          MOVE      SP70,SUPERLEV
.
          MOVE     SP70,PTCLM001
          MOVE     SP70,PTCLM002
          MOVE     SP70,PTCLM003
          MOVE     SP70,PTCLM004
          MOVE     SP70,PTCLM005
          MOVE     SP70,PTCLM006
          MOVE     SP70,PTCLM007
          MOVE     SP70,PTCLM008
          MOVE     SP70,PTCLM010
          MOVE     SP70,PTCLM011
          MOVE     SP70,PTCLM012
          MOVE     SP70,PTCLM013
          MOVE     SP70,PTCLM014
          MOVE     SP70,PTCLM015
          MOVE     SP70,PTCLM016
          MOVE     SP70,PTCLM017
          MOVE     SP70,PTCLM018
          MOVE     SP70,PTCLM019
          MOVE     SP70,PTCLM020
          MOVE     SP70,PTCLM021
          MOVE     SP70,PTCLM022
          MOVE     SP70,PTCLM023
          MOVE     SP70,PTCLM024
          MOVE     SP70,PTCLM025
          MOVE     SP70,PTCLM026
          MOVE     SP70,PTCLM027
          MOVE     SP70,PTCLM028
          MOVE     SP70,PTCLM029
          MOVE     SP70,PTCLM030
          MOVE     SP70,PTCLM031
          MOVE     SP70,PTCLM032
          MOVE     SP70,PTCLM033
          MOVE     SP70,PTCLM034
          MOVE     SP70,PTCLM035
          MOVE     SP70,PTCLM036
          MOVE     SP70,PTCLM037
          MOVE     SP70,PTCLM038
          MOVE     SP70,PTCLM039
          MOVE     SP70,PTCLM040
          MOVE     SP70,PTCLM041
          MOVE     SP70,PTCLM042
          MOVE     SP70,PTCLM043
          MOVE     SP70,PTCLM044
          MOVE     SP70,PTCLM045
          MOVE     SP70,FILTDEPT
          MOVE     ZERO,DEFTFLAG
          MOVE     SP70,PMSOVRKY
          MOVE     SP70,PMSOVVKY
.
          CALL      CLPTPRA0                * clear P.R.A cgi variables
.
          MOVE      ONE,TACCOUNT
          WHILE     TACCOUNT <= 50
            MOVE      SP70,TACRECKY[TACCOUNT]
            ADD       ONE,TACCOUNT
          DO
.
          MOVE      ONE,WCOCOUNT
          WHILE     WCOCOUNT <= 50
            MOVE      SP70,WCORECKY[WCOCOUNT]
            ADD       ONE,WCOCOUNT
          DO
.
          MOVE      ZERO,TACCOUNT
          MOVE      ZERO,WCOCOUNT
          MOVE      ZERO,ERRORCNT
          MOVE      ZERO,SRCHVIEW
.
          PACK      WLINE1A,SP30,SP30            
          PACK      WLINE2A,SP30,SP30 
          PACK      WLINE3A,SP30,SP30            
          PACK      WLINE4A,SP30,SP30
          PACK      WLINE5A,SP30,SP30
          PACK      WLINE6A,SP30,SP30
          PACK      WLINE7A,SP30,SP30
          PACK      WLINE8A,SP30,SP30
.
.---end *I-903005 ---
.
          MOVE      SP70,PTMMB001
          MOVE      ZEROVISN,PTMMB002
          MOVE      ZERO,PTMMB003
          MOVE      SP70,PTMMB004
          MOVE      SP70,PTMMB005
          MOVE      SP70,PTMMB006
          MOVE      SP70,PTMMB007
.
          MOVE      SP70,UNIQNUMB
.          MOVE      SP70,PRHRE001
.          MOVE      SP70,PRHRE002
.          MOVE      SP70,PRHRE003
          CALL      CPPRHR00
.
          MOVE      ZERO,EXDTBLNK
          MOVE      ZERO,ALLHFLAG
          MOVE      SP70,FILTURNO
          MOVE      SP70,HLFDCLTY
          MOVE      SP70,HLTHFUND
          MOVE      ZERO,EXCLWAIT
          MOVE      SP70,FILTADMN
          MOVE      SP70,BATCHNUM
          MOVE      ZERO,VALDTYPE
          MOVE      SP70,CLAIMSTA
          MOVE      SP70,INVNUMBR
          MOVE      SP70,PROCSTAT
          MOVE      ZERO,EXCLCLOS
          MOVE      SP70,HOSPCODE
          MOVE      SP70,BTSCHOSP
          MOVE      SP70,ECCLFBID
          MOVE      SP70,ECCLARID
          MOVE      SP70,ECCLCLID
          MOVE      SP70,ECCLRPTC
          MOVE      SP70,ECCLITMN
          MOVE      SP70,ECCLSRVC
          MOVE      SP70,ECCLRKEY
.
          CALL      CLPMCL00
.
          MOVE      SP70,WBSRV001
          MOVE      SP70,WBSRV002
          MOVE      SP70,WBSRV003
          MOVE      SP70,WBSRV004
          MOVE      SP70,WBSRV005
          MOVE      SP70,WBSRV006
          MOVE      SP70,WBSRV007
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nourselc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NOURSELC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updatety=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,UPDATETY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updattyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pataltid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PATALTID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsaltid=",QRYNAME
          IF        @EQUAL
            PACK      PMSALTID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claimtyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLAIMTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmnut",QRYNAME
          IF        @EQUAL
            CALL      SPNUT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnot=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,STARTNOT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bookflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BOOKFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "epscd001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EPSCD001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchtype=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,SRCHTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchview=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHVIEW
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsvx044=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSVX044
            PACK      PMSVX044,PMSVX044,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "codedflg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CODEDFLG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lfstdate=",QRYNAME
          IF        @EQUAL
            MOVE      "00000000",FRSTDATE
            MATCH     SP20,QRYDATA
            IF        !@EOS
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      FRSTDATE,CCENT,CYEAR,CMON,CDAY
              REP       " 0",FRSTDATE
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "llstdate=",QRYNAME
          IF        @EQUAL
            MOVE      "99999999",LASTDATE
            MATCH     SP20,QRYDATA
            IF        !@EOS
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      LASTDATE,CCENT,CYEAR,CMON,CDAY
              REP       " 0",LASTDATE
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clnot001",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLNOT001
            PACK      CLNOT001,CLNOT001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbsec008",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WBSEC008
            PACK      WBSEC008,WBSEC008,SP70
            GOTO      SETPAR99
          ENDIF
.
.          MATCH     "ptvis067=",QRYNAME            * I SRF 22685
.          IF        @EQUAL
.            MOVE      QRYDATA,PTVIS067             * Populate CGI parameter
.            GOTO      SETPAR99                     * with diet comment
.          ENDIF
.                                                  * end I SRF 22685
          MATCH     "filtvtyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTVTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filthosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alrtfltr=",QRYNAME
          IF        @EQUAL
            MOVE       QRYDATA,ALRTFLTR
            GOTO       SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextvkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTVKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevvkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVVKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH      "updtacno",QRYNAME
          IF         @EQUAL
            COMPARE   "99",TACCOUNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,TACCOUNT
            PACK      TACRECKY[TACCOUNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH      "updwcono",QRYNAME
          IF         @EQUAL
            COMPARE   "99",WCOCOUNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,WCOCOUNT
            PACK      WCORECKY[WCOCOUNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
. *I-903005 ---- start
.
          MATCH     "selprint=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,SELPRINT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdcopy=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,NOLABEL
            GOTO      SETPAR99
          ENDIF
.
. *I-903005 ---- end
.
          CALL       SPPRA000          * Set parameters for PRFA
.
          MATCH     "ptmmb",QRYNAME
          IF        @EQUAL
            CALL      STMMB000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtfdat=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00                *Set CMON from MTHNAM3
            PACK      FILTFDAT,CCENT,CYEAR,CMON,CDAY
          ENDIF
.
          MATCH     "filttdat=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00                *Set CMON from MTHNAM3
            PACK      FILTTDAT,CCENT,CYEAR,CMON,CDAY
          ENDIF
.
          MATCH     "superlev=",QRYNAME
          IF        @EQUAL
            PACK      SUPERLEV,QRYDATA,SP70
          ENDIF
.
          MATCH     "filtdept=",QRYNAME
          IF        @EQUAL
            PACK      FILTDEPT,QRYDATA,SP70
          ENDIF
.
          MATCH     "deftflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DEFTFLAG
          ENDIF
.
          MATCH     "pmsovrky=",QRYNAME
          IF        @EQUAL
            PACK      PMSOVRKY,QRYDATA,SP70
          ENDIF
.
          MATCH     "pmsovvky=",QRYNAME
          IF        @EQUAL
            PACK      PMSOVVKY,QRYDATA,SP70
          ENDIF
.
          MATCH     "uniqnumb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UNIQNUMB
            GOTO      SETPAR99
          ENDIF
.
.          MATCH     "prhre001=",QRYNAME
.          IF        @EQUAL
.            MOVE      QRYDATA,PRHRE001
.            GOTO      SETPAR99
.          ENDIF
.
.          MATCH     "prhre002=",QRYNAME
.          IF        @EQUAL
.            MOVE      QRYDATA,PRHRE002
.            GOTO      SETPAR99
.          ENDIF
.
.          MATCH     "prhre003=",QRYNAME
.          IF        @EQUAL
.            MOVE      QRYDATA,PRHRE003
.            GOTO      SETPAR99
.          ENDIF
.
          MATCH     "prhre",QRYNAME
          IF        @EQUAL
            CALL      SPPRHR00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mavbatch=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MAVBATCH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mavinvce=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MAVINVCE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mavmodul=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MAVMODUL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exdtblnk=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXDTBLNK
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "allhflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ALLHFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filturno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTURNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecotfund=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECOTFUND
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecottype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECOTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecottrid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECOTTRID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hlfdclty=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HLFDCLTY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hlthfund=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HLTHFUND
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exclwait=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXCLWAIT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtadmn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTADMN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "batchnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BATCHNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claimsta=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLAIMSTA
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "invnumbr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INVNUMBR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PROCSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exclclos=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXCLCLOS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HOSPCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "btschosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BTSCHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclfbid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLFBID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclarid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLARID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclclid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLCLID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclrptc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLRPTC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclitmn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLITMN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclsrvc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLSRVC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclrkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLRKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmclt",QRYNAME
          IF        @EQUAL
            CALL      SPMCL000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbsrv",QRYNAME
          IF        @EQUAL
            CALL      SWBSR000
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------
.   Set Parameters for Medical Records MBS
.------------------------------------------------------------
STMMB000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STMMB010,STMMB020,STMMB030,STMMB040,STMMB050:
                       STMMB060,STMMB070
.
          MOVE      ONE,EXIT
          GOTO      STMMB999

STMMB010  PACK      PTMMB001,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB020  MOVE      QRYDATA,PTMMB002
          GOTO      STMMB999
.
STMMB030  MOVE      QRYDATA,PTMMB003
          GOTO      STMMB999
.
STMMB040  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PTMMB004,CCENT,CYEAR,CMON,CDAY
          GOTO      STMMB999
.
STMMB050  PACK      PTMMB005,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB060  PACK      PTMMB006,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB070  PACK      PTMMB007,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB999  RETURN
+
.------------------------------------------------------------
. Output Patient Enquiry Page
.------------------------------------------------------------
GETPAT00  
          MOVE      ZERO,MASTFLAG
          MOVE      ZERO,MISSFLAG
          MOVE      ZERO,RESPFLAG
          MOVE      ZERO,DSCHFLAG
          MOVE      ZERO,PMVXFLAG
          MOVE      SP70,DOCTCODE
          CALL      IBACLOCK
          CALL      CLPATMAS
          CALL      CLPATMIS
          CALL      CLPATDSC
          CALL      CLPMSPX2
          CALL      CLPMSNUT
          CALL      CLRPDS00
          CALL      CLRICU00
          CALL      CLNZSP00
          CALL      CLPATHSP
          CALL      CLPMSVX1
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
          MATCH     "1",NOURSELC
          IF        @EQUAL
            GOTO      GETPAT20
          ENDIF
.
          MATCH     SP70,PATALTID
          IF        !@EQUAL
            CALL      GETALT00
            BRANCH    EXIT,GETPAT99
          ENDIF
.
          MATCH     SP70,PMSALTID
          IF        !@EQUAL
            CALL      GETAID00
            BRANCH    EXIT,GETPAT99
          ENDIF
.
          MATCH     "       0",URNUMBER
          IF        @EQUAL
            CALL      FINVIS00
            MOVE      EXIT,MASTFLAG
          ELSE
            MOVE      URNUMBER,KEY8
            CALL      RDMAST1
            MOVE      OVRCD,MASTFLAG
            MOVE      PURNO,KEY8
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
          ENDIF
.
          IF        PSTAT=1 | PSTAT=2
            MOVE      PURNO,SAVEURNO
            MOVE      PPSNAME,URNUMBER
            MOVE      ONE,MRGEFLAG
            GOTO      GETPAT00
          ENDIF
.
          IF        MASTFLAG=1
            MOVE      "Can't find patient master details",WEBTITLE
            CALL      WEBERR00
            GOTO      GETPAT99
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMRES1
          IF        OVRCD=1
            CALL      CLPMSRES
          ENDIF
.
          MOVE      ADMISSNO,KEY8
          MATCH     SP70,KEY8
          IF        @EQUAL | @EOS
            MOVE      ONE,MISSFLAG
            MOVE      ONE,RESPFLAG
            MOVE      ONE,DSCHFLAG
            MOVE      ONE,PMVXFLAG
            COMPARE   FOUR,SRCHTYPE         * U/R passed in from pat search
            CALL      FNDCUR00 IF EQUAL     * Find Current Admissin details
          ELSE
            CALL      RDMISS1
            MOVE      OVRCD,MISSFLAG
            CALL      RDPTDAD1
            IF        OVRCD=1
              MOVE      SP70,PTDAADTS
              MOVE      SP70,PTDADCTS
            ENDIF
.
            CALL      RDPTVIS1
            IF        OVRCD=1
              CALL      CLPATVIS
            ENDIF
            CALL      GETNZP00
          ENDIF
.
          MATCH     "035",TEMPLATE
          IF        !@EQUAL|@LESS
            MATCH     "35",TEMPLATE
            IF        !@EQUAL|@LESS
              GOTO      GETPAT02
            ENDIF
          ENDIF
          COMPARE   ONE,MISSFLAG
          IF        @EQUAL
            MOVE      "Invalid admission record",WEBTITLE
            CALL      WEBERR00
            GOTO      GETPAT99
          ENDIF
          COMPARE   ONE,ASTAT
          IF        @EQUAL
            MOVE      "Patient has not been admitted",WEBTITLE
            CALL      WEBERR00
            GOTO      GETPAT99
          ENDIF
.
GETPAT02  MATCH     "070",TEMPLATE
          IF        @EQUAL
            MOVE      ADMISSNO,KEY8
            CALL      RDDETA1
            IF        OVRCD=1
              CALL      CLAAEDET
            ENDIF
.
            MOVE      ADMISSNO,KEY8
            CALL      RDDISA1
            IF        OVRCD=1
              CALL      CLAAEDIS
            ENDIF
          ENDIF
.
          MOVE      ADMISSNO,KEY8
          CALL      RDPMVX11
          IF        OVRCD=1
            IF        ARCFLAG=1
              MOVE      ADMISSNO,KEY8
              CALL      RDARVX11
              IF        OVRCD<>1
                CALL      MVPMAR00
              ENDIF
            ENDIF
          ENDIF
          MOVE      OVRCD,PMVXFLAG
          COMPARE   ONE,PMVXFLAG
          IF        !@EQUAL
            MATCH     SP70,PMVXMHOS
            IF        !@EQUAL
              PACK      KEY3,PMVXMHOS,SP70
              CALL      RDPTHSP1
              IF        OVRCD=1
                CALL      CLPATHSP
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      ADMISSNO,KEY8
          CALL      RDDSCH1
          MOVE      OVRCD,DSCHFLAG
          IF        OVRCD=0
            MOVE      DDATE,ICDRDDTE   * Needed for RDPTICD1 & RDPTICO1 reads
          ENDIF
.
          MOVE      ADMISSNO,KEY8
          CALL      RDRESP1
          MOVE      OVRCD,RESPFLAG
.
          MOVE      ADMISSNO,KEY8
          CALL      RDBKREC1
          MOVE      OVRCD,BRECFLAG
.
          MOVE      SP70,PMEVEVNT
          MOVE      ADMISSNO,KEY8
          CALL      RDPMEVT1
.
GETPAT05  CALL      PATNAA00                * format name without bold tags
.
          MATCH     "034",TEMPLATE          * pre-adm from prev.detail option ?
          IF        @EQUAL
            IF        PCEASE=1
              MOVE      "Patient is Deceased",WEBTITLE
              CALL      WEBERR00
              GOTO      GETPAT99
            ENDIF
          ENDIF
.
.                                                 * read nutrition file
          PACK      KEY16,ADMISSNO,LASTDATE       * set key to read nutrition
          CALL      RDPMNUT1                      * if no rec found, vals blank
.                                                 * out already (CLPMSNUT)
.
          CALL      GETCCD00                      * get concession card details
.
          PACK      KEY8,ADMISSNO,SP70            * read pds file
          CALL      RDMRPDS1
.
          PACK      KEY8,ADMISSNO,SP70            * read icu file
          CALL      RDPTICU1
.
          MOVE      SP70,PRIDISCD
          MOVE      SP70,PDIADESC
          PACK      KEY13,ADMISSNO,SP70                               *C-240107
          CALL      RSPTECD1
          CALL      RKPTECD1
          BRANCH    OVRCD,GETPAT10
          MATCH     DPTEDADM,ADMISSNO
          GOTO      GETPAT10 IF NOT EQUAL
.
          MATCH     PTEDTYPE,CMDISP
          GOTO      GETPAT10 IF NOT EQUAL
.
          MATCH     "  1",DPTEDCNT                                    *C-240107
          GOTO      GETPAT10 IF NOT EQUAL
.
          MOVE      PTEDCODE,PRIDISCD
          MOVE      PTEDDESC,PDIADESC
.
GETPAT10  MOVE      SP70,PRIOPRCD
          MOVE      SP70,POPRDESC
          PACK      KEY13,ADMISSNO,SP70                               *C-240107
          CALL      RSPTECO1
          CALL      RKPTECO1
          BRANCH    OVRCD,GETPAT20
          MATCH     DPTEOADM,ADMISSNO
          GOTO      GETPAT20 IF NOT EQUAL
.
          MATCH     "  1",DPTEOCNT                                    *C-240107
          GOTO      GETPAT20 IF NOT EQUAL
.
          MOVE      PTEOCODE,PRIOPRCD
          MOVE      PTEODESC,POPRDESC
.
.    Webtplaf must be read here to get correct description for WEBTITLE
.
GETPAT20  IF        PTCNNHII=1
            MATCH     "001",TEMPLATE
            IF        @EQUAL
              MOVE      "30",TMOTFRST
              MOVE      "30",TMOTFRST
            ENDIF
            MATCH     "1",TEMPLATE
            IF        @EQUAL
              MOVE      "30",TMOTFRST
              MOVE      "30",TMOTFRST
            ENDIF
          ENDIF
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          PACK      KEY13,PRGID,KEY2,TEMPLATE,SP70
          CALL      RDWBTP1
          CLEAR     WEBTITLE
          APPEND    WBTPDES,WEBTITLE
          APPEND    PATFNAME,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GETPAT99
.
          MATCH     "1",NOURSELC
          IF        @EQUAL
            GOTO      GETPAT90
          ENDIF
          IF        PTCNNHII=1
            MOVE      URNUMBER,KEY8
            CALL      RDNHMAS2
            IF        OVRCD=1
              MOVE      "Missing nhimasaf record",WEBTITLE
              CALL      WEBERR00
              GOTO      GETPAT99
            ENDIF
          ENDIF
.
GETPAT90  IF        PTCNNHII=1
            MATCH     "1",NOURSELC
            IF        @EQUAL
              GOTO      GETPAT92
            ENDIF
            MOVE      URNUMBER,KEY8
            CALL      RDNHMAS2
            IF        OVRCD=1
              MOVE      "Missing nhimasaf record",WEBTITLE
              CALL      WEBERR00
              GOTO      GETPAT99
            ENDIF
            MATCH     "001",TEMPLATE
            IF        !@EQUAL
              MATCH     "1",TEMPLATE
              IF        !@EQUAL
                GOTO      GETPAT92
              ENDIF
            ENDIF
            MOVE      URNUMBER,DIM20                                *I-131266
            SQUEEZE   DIM20
            UNPACK    DIM20,DIM1
            TYPE      DIM1
            GOTO      GETPAT92 IF EQUAL        * numeric prefix on URNUMBER
.
            SCAN      "T-",URNUMBER             * check if temporary number
            IF  !@EQUAL
              RESET     URNUMBER 
              CALL      CONNECT
              BRANCH    EXIT,GETPAT99
              MOVE      SP1,NZIBMWST      * prevent call to SETMED if we miss
              CALL      CHKHCU00
              MATCH     SP70,NZIBMWST
              IF        !@EQUAL
                PROC      SETMED00
              ENDIF
              CALL      DISCNNCT
              BRANCH    EXIT,GETPAT99
            ENDIF
            RESET     URNUMBER 
          ENDIF
.
GETPAT92  CALL      WEBBOD00   * Output Templated Body of HTML 
          IF        MRGEFLAG=1
            CALL      MRGALT00
          ENDIF
          CALL      WEBEND00   * Output End of Web Page
.
.
GETPAT99  RETURN
.------------------------------------------------------------
. Get Concession Card Details if they exist
.------------------------------------------------------------
GETCCD00  UNPACK    SP70,CCRDTYPE,CCRDNUMB,CCRDEXDT
          PACK      KEY19,URNUMBER,SP70
          CALL      RSPMCCD1
          CALL      RKPMCCD1
          BRANCH    OVRCD,GETCCD99
.
          MATCH     URNUMBER,PMCDURNO
          GOTO      GETCCD99 IF NOT EQUAL
.
          MOVE      PMCDCNUM,CCRDNUMB            * card number
.
          PACK      KEY5,CATct,PMCDCTYP,SP70
          CALL      RDCODE1
          IF        OVRCD<>1
            MOVE      TDESC,CCRDTYPE             * card type
          ENDIF
.
          PACK      CCRDEXDT,PMCDEXDT,SP70       * card expiry date
.
GETCCD99  RETURN
.
.------------------------------------------------------------
. Get Alternate ID
.------------------------------------------------------------
GETALT00  
          PACK      KEY30,PATALTID,SP70
          CALL      RSPTNID2
          CALL      RKPTNID2
          BRANCH    OVRCD,GETALT90          * no record on file
          MATCH     PATALTID,PTNINMPI
          GOTO      GETALT90 IF NOT EQUAL   * different National UR
          MOVE      PTNILNUM,URNUMBER
          MOVE      ZERO,EXIT
          GOTO      GETALT99
GETALT90  MOVE      "Can't find patient master details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
GETALT99  RETURN
.
.------------------------------------------------------------
. Get Alternate ID from PMSAIDFD
.------------------------------------------------------------
GETAID00  COMPARE   ONE,PTCNUALT            * Using Alternate ID
          GOTO      GETAID99 IF NOT EQUAL
.
          MATCH     SP70,URNUMBER           * Exit if there is a urnumber
          GOTO      GETAID99 IF NOT EQUAL
.
          PACK      KEY31,PMSALTID,SP70
          CALL      RSPMAID2
          CALL      RKPMAID2
          BRANCH    OVRCD,GETAID90          * no record on file
.
          MATCH     PMSALTID,PMAIALID
          GOTO      GETAID90 IF NOT EQUAL   * different alternate ID
.
          MOVE      PMAIURNO,URNUMBER
          MOVE      ZERO,EXIT
          GOTO      GETAID99
.
GETAID90  MOVE      "Can't find patient master details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
GETAID99  RETURN
+
.------------------------------------------------------------
. Alert that this is a merged U/R
.------------------------------------------------------------
MRGALT00  MATCH     SP70,URNUMBER
          GOTO      MRGALT99 IF EQUAL
.
          MATCH     SP70,SAVEURNO
          GOTO      MRGALT99 IF EQUAL
.
          MOVE      SAVEURNO,DISPSUR
          SQUEEZE   DISPSUR
          MOVE      URNUMBER,DISPMUR
          SQUEEZE   DISPMUR 
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " alert('U/R Number ",DISPSUR," is merged with ":
                             DISPMUR," \n Using ",DISPMUR,"');":
                             "}":
                             "</script>"
          GOTO      MRGALT99
.
MRGALT99  RETURN
.------------------------------------------------------------
. Get Name from Visit Based Tables
.------------------------------------------------------------
FINVIS00  MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,FINVIS80
.
          BRANCH    PVITYPE,FINVIS10,FINVIS20,FINVIS20
          MOVE      ONE,EXIT
          GOTO      FINVIS99
.
FINVIS10  BRANCH    EMRFLAG,FINVIS90
          MOVE      PVIBILL,KEY8
          CALL      RDEMUNK1
          BRANCH    OVRCD,FINVIS90
          MOVE      SP70,PTITL
          MOVE      EMUNSNAM,PSNAME
          MOVE      EMUNGNAM,PGNAME
          MOVE      EMUNBDAT,PBDATE
          MOVE      EMUNSEX,PSEX
          MOVE      EMUNAGE,PSAGE
          MATCH     SP70,PSNAME
          IF        @EQUAL
            MOVE     EMUNDET1,PSNAME
          ENDIF
          MATCH     SP70,PGNAME
          IF        @EQUAL
            MOVE     EMUNDET2,PGNAME
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS20  MOVE      PVIBILL,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,FINVIS90
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS30  MOVE      PVIBILL,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,FINVIS90
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS80  MOVE      ADMISSNO,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,FINVIS85
          MOVE      URNUMBER,PURNO
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS85  BRANCH    EMRFLAG,FINVIS90
          MOVE      ADMISSNO,KEY8
          CALL      RDEMUNK1
          BRANCH    OVRCD,FINVIS90
          MOVE      SP70,PTITL
          MOVE      EMUNSNAM,PSNAME
          MOVE      EMUNGNAM,PGNAME
          MOVE      EMUNBDAT,PBDATE
          MOVE      EMUNSEX,PSEX
          MOVE      EMUNAGE,PSAGE
          MATCH     SP70,PSNAME
          IF        @EQUAL
            MOVE     EMUNDET1,PSNAME
          ENDIF
          MATCH     SP70,PGNAME
          IF        @EQUAL
            MOVE     EMUNDET2,PGNAME
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS90  MOVE      ONE,EXIT
.
FINVIS99  RETURN
+
.------------------------------------------------------------
. Process Fields in Body of HTML Template
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD99,PROFLD50:
                             PROFLD60,PROFLD99,PROFLD80,PROFLD90,PROFL100
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13,PROFLD14,PROFLD15:
                             PROFLD16,PROFLD17,PROFLD18,PROFLD19,PROFL191
          GOTO      PROFLD99
.
.         ********* PROFLD19 ADDED BY HPS BLR
.
PROFLD11  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD12  CALL      MISF0000
          GOTO      PROFLD99
.
PROFLD13  CALL      DSCF0000
          GOTO      PROFLD99
.
PROFLD14  CALL      TABL0000     * Table Displays
          GOTO      PROFLD99
.
PROFLD15  CALL      BREC0000     * Patient Bookings Details
          GOTO      PROFLD99
.
PROFLD16  CALL      MSXF0000     * Master Extension Details
          GOTO      PROFLD99
.
PROFLD17  CALL      DRGS0000     * DRG Information 
          GOTO      PROFLD99
.
PROFLD18  CALL      PMIX0000     * Master Extension Details Two
          GOTO      PROFLD99
.
PROFLD19  CALL      ECLP0000
          GOTO      PROFLD99
.
PROFL191  CALL      VISF0000
          GOTO      PROFLD99
.
PROFLD20  BRANCH  FLDSETNO,PROFLD21,PROFLD22,PROFLD23
          GOTO    PROFLD99
.
PROFLD21  CALL    MASF0000
          GOTO    PROFLD99
.
PROFLD22  CALL    PRHR0000
          GOTO    PROFLD99
.
PROFLD23  CALL    ECFL0000
          GOTO    PROFLD99
.
PROFLD30  BRANCH  FLDSETNO,PROFLD31,PROFLD32
          GOTO    PROFLD99
.
PROFLD31  CALL    ECCL0000
          GOTO    PROFLD99
.
PROFLD32  CALL    MASF0000
          GOTO    PROFLD99
.
PROFLD50  BRANCH  FLDSETNO,PROFLD51,PROFLD52,PROFLD53
          GOTO    PROFLD99
.
PROFLD51  CALL    MASF0000
          GOTO    PROFLD99
.
PROFLD52  CALL    PRHR0000
          GOTO    PROFLD99
.
PROFLD53  CALL    ECFS0000
          GOTO    PROFLD99
.
PROFLD60  BRANCH  FLDSETNO,PROFLD61,PROFLD62
          GOTO    PROFLD99
.
PROFLD61  CALL    ECCS0000
          GOTO    PROFLD99
.
PROFLD62  CALL    MASF0000
          GOTO    PROFLD99
.
.-------------------------------------------------------- *T0859743-Start
PROFLD80  BRANCH    FLDSETNO,PROFLD81,PROFLD82,PROFLD83
          GOTO      PROFLD99
.
PROFLD81  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD82  CALL      PRHR0000
          GOTO      PROFLD99
.
PROFLD83  CALL      EBBF0000                  * Bulk Billing fields
          GOTO      PROFLD99                                 
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91,PROFLD92
          GOTO      PROFLD99
.
PROFLD91  CALL      EBQF0000
          GOTO      PROFLD99
.
PROFLD92  CALL      MASF0000
          GOTO      PROFLD99                             
.-------------------------------------------------------- *T0859743-End
.
PROFL100  BRANCH    FLDSETNO,PROFL110
.
PROFL110  CALL      PRTG0000
          GOTO      PROFLD99
.
PROFLD99  RETURN
+
.------------------------------------------------------------
. Date selection from Admission Date to Current Date
.------------------------------------------------------------
DATSEL00  MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,DATSEL99
.
          CALL      IBACLOCK
          PACK      TODAY,CCC,CYY,CMM,CDD
          REP       " 0",TODAY
.
          UNPACK    TODAY,CCENT,CYEAR,CMON,CDAY
          MOVE      ZERO,FAILCNT
.
DATSEL10  PACK      KEY8,CCENT,CYEAR,CMON,CDAY
          REP       " 0",KEY8
          MATCH     ADATE,KEY8
          GOTO      DATSEL99 IF LESS
.
          ADD       ONE,FAILCNT
          MATCH     TODAY,KEY8
          IF        @EQUAL
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;"<option value=#"",KEY8,"#" selected>",CDAY,SP1:
                                MTHNAM3,SP1,CCENT,CYEAR,"</option>";
          ELSE
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;"<option value=#"",KEY8,"#">",CDAY,SP1:
                                 MTHNAM3,SP1,CCENT,CYEAR,"</option>";
          ENDIF
.
          MOVE      "-1",ADJDAYS
          CALL      ADJDAT00
          IF        FAILCNT<150
            GOTO      DATSEL10
          ENDIF
DATSEL99  RETURN
.---------------------------------------------------------------------
.         ********    HPS BLR  CODE STARTS HERE   ********* 
.         Display of the Following Fields                   
.                   Special Funding Arrangement
.                   Program Funding Source
.                   Hospital Transferred From
.---------------------------------------------------------------------
ECLP0000  BRANCH    FLDITMNO,ECLP0010,ECLP0020,ECLP0030,ECLP0040,ECLP0050:
                             ECLP0060,ECLP0070,ECLP0080,ECLP0090,ECLP0100:
                             ECLP0110,ECLP0120,ECLP0130,ECLP0140,ECLP0150:
                             ECLP0160,ECLP0170,ECLP0180,ECLP0190
          GOTO      ECLP9999
.
ECLP0010  MOVE      ONE,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0020  MOVE      TWO,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0030  MOVE      THREE,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0040  MOVE      FOUR,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0050  MOVE      FIVE,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0060  MOVE      SIX,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0070  MOVE      SEVEN,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0080  MOVE      EIGHT,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0090  MOVE      ONE,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0100  MOVE      TWO,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0110  MOVE      THREE,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0120  MOVE      FOUR,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0130  MOVE      FIVE,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0140  MOVE      SIX,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0150  MOVE      SEVEN,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0160  MOVE      EIGHT,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0170  MOVE      NINE,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0180  MOVE      TEN,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0190  MOVE      TEN1,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP9999  RETURN
+
.------------------------------------------------------------------------
.
.         ***************        HPS CODE ENDS HERE    ***************
.
.------------------------------------------------------------
. Table Outputs (Visit, Transfers, etc)
.------------------------------------------------------------
TABL0000  BRANCH    FLDITMNO,TABL0100,TABL0200
          GOTO      TABL9999
.
TABL0100  CALL      OVRTAB00
          GOTO      TABL9999
.
TABL0200  CALL      OVVTAB00
          GOTO      TABL9999
.
TABL9999  RETURN
.-----------------------------------------------------------
. Option 1 - DRG Information and Medical Record Options
. First up read DRG File if OVRCD set flag and continue
. This is done here as not to disrupt the Main Routine
.-----------------------------------------------------------
DRGS0000  MOVE      SP70,KEY3
          CALL      GTDRG000       * Get Grouper Version - returns it in KEY3
          COMPARE   ZERO,EPSCD001
          IF        @EQUAL
            MOVE      ONE,EPSCD001   * Set to default to 1 if blank
          ENDIF
          PACK      KEY13,ADMISSNO,EPSCD001,KEY3,SP70 
          CALL      RDPTPGR1   * Read Grouper Details
          IF        OVRCD=1
            PACK      KEY10,ADMISSNO,EPSCD001
            PACK      KEY13,KEY10,SP70 
            CALL      RSPTPGR1   * Read Grouper Details
            CALL      RKPTPGR1
            IF        OVRCD=0
              PACK      DIM10,PTPGADMN,PTPGEPNO
              MATCH     KEY10,DIM10
              GOTO      DRGS0010 IF EQUAL
            ENDIF
            CALL      CLRGRP00
          ENDIF
.
.  Now start normal branch on flditmno section
.
DRGS0010  BRANCH    FLDITMNO,DRGS0100,DRGS0200,DRGS0300,DRGS0400,DRGS0500:
                             DRGS0600,DRGS0700,DRGS0800,DRGS0900,DRGS1000:
                             DRGS1100,DRGS1200,DRGS1300,DRGS1400,DRGS1500:
                             DRGS1600,DRGS1700,DRGS1800,DRGS1900,DRGS2000:
                             DRGS2100,DRGS2200,DRGS2300,DRGS2400,DRGS2500:
                             DRGS2600,DRGS2700,DRGS2800,DRGS2900,DRGS3000:
                             DRGS3100,DRGS3200,DRGS3300,DRGS3400
          GOTO      DRGS9999
.
DRGS0100  CALL      SELEPS00           * Selection List of Episodes
          GOTO      DRGS9999
.
DRGS0200                               * EMPTY!!!!!!!! 
          GOTO      DRGS9999
.
DRGS0300  MATCH     SP70,ACODDTE
          IF        @EQUAL
            WRITE     HTMLFILE;"0";    * Coding Incomplete
          ELSE
            WRITE     HTMLFILE;"1";    * Coding Complete
          ENDIF
          GOTO      DRGS9999
.
DRGS0400  CALL      SHWMAP00   * Set URL Routine           
          GOTO      DRGS9999
.
DRGS0500  WRITE     HTMLFILE;DPTPGADM;  * Admissno No            
          GOTO      DRGS9999
.
DRGS0600  WRITE     HTMLFILE;DPTPGEPN;  * Episode No                    
          GOTO      DRGS9999
.
DRGS0700  WRITE     HTMLFILE;PTPGGPVR;  * Grouper Version               
          GOTO      DRGS9999
.
DRGS0800  MOVE      PTPGNDRG,DDRGCODE   * National DRG                  
          CALL      DISDRG00            * DRG Details
          GOTO      DRGS9999
.
DRGS0900  WRITE     HTMLFILE;PTPGNMDC;  * National MDC                  
          GOTO      DRGS9999
.
DRGS1000  WRITE     HTMLFILE;PTPGNWGT;  * National Weight               
          GOTO      DRGS9999
.
DRGS1100  WRITE     HTMLFILE;PTPGNALS;  * National average LOS              
          GOTO      DRGS9999
.
DRGS1200  MOVE      PTPGSDRG,DDRGCODE   * State DRG                     
          CALL      DISDRG00            * DRG Details
          GOTO      DRGS9999
.
DRGS1300  WRITE     HTMLFILE;PTPGSMDC;  * State MDC                     
          GOTO      DRGS9999
.
DRGS1400  WRITE     HTMLFILE;PTPGSWGT;  * State Weight               
          GOTO      DRGS9999
.
DRGS1500  WRITE     HTMLFILE;PTPGSALS;  * State average LOS               
          GOTO      DRGS9999
.
DRGS1600  MOVE      PTPGLDRG,DDRGCODE   * Local DRG                     
          CALL      DISDRG00            * DRG Details
          GOTO      DRGS9999
.
DRGS1700  WRITE     HTMLFILE;PTPGLMDC;  * Local MDC                     
          GOTO      DRGS9999
.
DRGS1800  WRITE     HTMLFILE;PTPGLWGT;  * Local Weight               
          GOTO      DRGS9999
.
DRGS1900  WRITE     HTMLFILE;PTPGLALS;  * Local average LOS             
          GOTO      DRGS9999
.
DRGS2000  WRITE     HTMLFILE;PTPGPCCL;  * Patient CC class level        
          GOTO      DRGS9999
.
DRGS2100  WRITE     HTMLFILE;PTPGWFIX;  * WIES value fixed              
          GOTO      DRGS9999
.
DRGS2200  WRITE     HTMLFILE;PTPGWVAR;  * WIES value variable           
          GOTO      DRGS9999
.
DRGS2300  WRITE     HTMLFILE;PTPGWTOL;  * WIES value total              
          GOTO      DRGS9999
.
DRGS2400  WRITE     HTMLFILE;PTPGWWTU;  * WIES weight used              
          GOTO      DRGS9999
.
DRGS2500  WRITE     HTMLFILE;PTPGWWTD;  * WIES weight description       
          GOTO      DRGS9999
.
DRGS2600  CALL      WRDDIS00      * Output Discharge Ward Description   
          GOTO      DRGS9999
.
DRGS2700  WRITE     HTMLFILE;PTPGNDRG;  * National DRG
          GOTO      DRGS9999
.
DRGS2800  WRITE     HTMLFILE;PTPGSDRG;  * State DRG
          GOTO      DRGS9999
.
DRGS2900  WRITE     HTMLFILE;PTPGLDRG;  * Local DRG
          GOTO      DRGS9999
.
DRGS3000  MOVE      PTPGNDRG,DDRGCODE   * National DRG
          CALL      WIESVL00            * Display Wies Information
          GOTO      DRGS9999
.
DRGS3100  MOVE      PTPGSDRG,DDRGCODE   * State DRG
          CALL      WIESVL00            * Display Wies Information
          GOTO      DRGS9999
.
DRGS3200  MOVE      PTPGLDRG,DDRGCODE   * Local DRG
          CALL      WIESVL00            * Display Wies Information
          GOTO      DRGS9999
.
DRGS3300  CALL      CODUSR00            * Output Coder User ID
          GOTO      DRGS9999
.
DRGS3400  CALL      CODDAT00            * Output Coding Date and Time
          GOTO      DRGS9999
.
DRGS9999  RETURN
.------------------------------------------------------------
. Codding Date & Time      
. 0.Date 1.Time  
.------------------------------------------------------------
CODDAT00  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
          MOVE      ZERO,ECDFLAG   * Diagnosis Episode Flag
.
          PACK      KEY13,ADMISSNO,EPSCD001,Z70
          CALL      RSPTECD1
          CALL      RPPTECD1
          IF        OVRCD=1
            MOVE      ONE,ECDFLAG
            GOTO      CODDAT10
          ENDIF
.
          MATCH     ADMISSNO,DPTEDADM
          IF        !@EQUAL
            MOVE      ONE,ECDFLAG
            GOTO      CODDAT10
          ENDIF
.
.         Check episode operation coding
.
CODDAT10  PACK      KEY13,ADMISSNO,EPSCD001,Z70                       *C-240107
          CALL      RSPTECO1
          CALL      RPPTECO1
          IF        OVRCD=1
            IF        ECDFLAG=1  
              GOTO      CODDAT40
            ENDIF
          ENDIF
.
          MATCH     ADMISSNO,DPTEOADM
          IF        !@EQUAL
            IF        ECDFLAG=1  
              GOTO      CODDAT40
            ENDIF
          ENDIF
.
CODDAT20  MATCH     PTEDDTCD,PTEODTCD
          IF        @EQUAL
            MATCH     PTEDTIME,PTEOTIME
            IF        @LESS          
              MOVE      PTEDDTCD,F8       * Set Disease Date
              MOVE      PTEDTIME,KEY5     * Set Disease Time
              GOTO      CODDAT21
            ELSE
              MOVE      PTEODTCD,F8       * Set Procedure Date
              MOVE      PTEOTIME,KEY5     * Set Procedure Time
              GOTO      CODDAT21
            ENDIF
          ENDIF
.
          MATCH     PTEDDTCD,PTEODTCD
          IF        @LESS          
            MOVE      PTEDDTCD,F8       * Set Disease Date
            MOVE      PTEDTIME,KEY5     * Set Disease Time
          ELSE         
            MOVE      PTEODTCD,F8       * Set Procedure Date
            MOVE      PTEOTIME,KEY5     * Set Procedure Time
          ENDIF
.
CODDAT21  COMPARE   ZERO,F8       * Check if F8 has anything init?
          GOTO      CODDAT40 IF EQUAL  
.
          MOVE      F8,KEY8      * Set Date as Dim variable
.
          BRANCH    F1,CODDAT30
.
          REP       " 0",KEY8    
          UNPACK    KEY8,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CODDAT99
.
CODDAT30  WRITE     HTMLFILE;KEY5;
          GOTO      CODDAT99

.       if operation/disease coding record doesn't exist, use current date/time
.
CODDAT40  BRANCH    F1,CODDAT50
          MOVE      CMM,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY4,CCC,CYY
          REP       " 0",KEY4
          MOVE      CDD,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;KEY2,SP1,MTHNAM3,SP1,KEY4;
          GOTO      CODDAT99
.
CODDAT50  WRITE     HTMLFILE;CTIMEIS;
          GOTO      CODDAT99
.
CODDAT99  RETURN
.*************************************************************************
.  Out put Coder ID:  0.Desc 1.Code
.*************************************************************************
CODUSR00  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
.
          MOVE      ONE,PTEDEPNO
          MOVE      ONE,PTEDCNT
          PACK      KEY13,ADMISSNO,PTEDEPNO,PTEDCNT,SP70              *C-240107
          CALL      RDPTECD1
          BRANCH    OVRCD,CODUSR20
.
          MATCH     SP70,PTEDUSID         * Web user id
          GOTO      CODUSR05 IF NOT EQUAL 
.         
          MATCH     SP70,PTEDOPER         * user passcode
          GOTO      CODUSR20 IF EQUAL     
.         
          PACK      KEY14,PTEDOPER,SP70
          CALL      RSWBSE3
          CALL      RKWBSE3
          BRANCH    OVRCD,CODUSR20
.         
          MATCH     PTEDOPER,WBSEPCD
          GOTO      CODUSR20 IF NOT EQUAL
.         
          MOVE      WBSEUID,PTEDUSID
.
CODUSR05  PACK      KEY10,PTEDUSID,SP70   * Read Security File
          CALL      RDWBSE1
          BRANCH    OVRCD,CODUSR20
.
          BRANCH    F1,CODUSR10
.
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CODUSR99
.
CODUSR10  WRITE     HTMLFILE;WBSEUID;
          GOTO      CODUSR99
.
.         Check episode operation coding
.
CODUSR20  CALL      RDPTECO1
          BRANCH    OVRCD,CODUSR40
.
          MATCH     SP70,PTEOUSID         * Web user id
          GOTO      CODUSR25 IF NOT EQUAL
.
          MATCH     SP70,PTEOOPER         * user passcode
          GOTO      CODUSR40 IF EQUAL
.         
          PACK      KEY14,PTEOOPER,SP70
          CALL      RSWBSE3
          CALL      RKWBSE3
          BRANCH    OVRCD,CODUSR40
.         
          MATCH     PTEOOPER,WBSEPCD
          GOTO      CODUSR40 IF NOT EQUAL
.
          MOVE      WBSEUID,PTEOUSID
.
CODUSR25  PACK      KEY10,PTEOUSID,SP70  * Read Security File
          CALL      RDWBSE1
          BRANCH    OVRCD,CODUSR40
.
          BRANCH    F1,CODUSR30
.
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CODUSR99
.
CODUSR30  WRITE     HTMLFILE;WBSEUID;
          GOTO      CODUSR99
.
.   if operation/disease coding record doesn't exist, use current Web User 
.
CODUSR40  PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    F1,CODUSR50
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CODUSR99
.
CODUSR50  WRITE     HTMLFILE;WBSEUID;
          GOTO      CODUSR99
.
CODUSR99  RETURN
.--------------------------------------------------------------------
...         **** WIES Details by discharge date ****
...
...       If using 6.0 Grouper then:
...          If Discharge date >= 2010/07/01 use WIES17
...          If Discharge date >= 2009/07/01 use WIES16
...          If Discharge date >= 2008/07/01 use WIES15
...       If using 5.2 Grouper then:
...          If Discharge date >= 2008/07/01 use WIES15
...          If Discharge date >= 2007/07/01 use WIES14
...       If using 5.1 Grouper then:
...          If Discharge date >= 2006/07/01 use WIES13.
...       If using 5.0 Grouper then:
...          If Discharge date >= 2004/07/01 use WIES12.
...          else If Discharge date >= ICD10v4 Cutover use WIES12
...                                    ( go-live earlier than 2004/07/01)
...            else use WIES11.
...
...       If using 4.2 Grouper then:
...            use WIES11.
...
...       Anything other use WIES12
...
... 0.LOS, 1.Low Trim, 2.High Trim, 3.Description, 4.Multiday Weight
... 5.Same Day Weight
... INPUT PARAMETER : DDRGCODE
.------------------------------------------------------------
WIESVL00  UNPACK    DIM127,DIM1,KEY1,DIM127   
          MOVE      ZERO,VIEWFLAG 
          MOVE      KEY1,VIEWFLAG
.
          PACK      KEY8,ADMISSNO,SP70  * Patient must be discharged!
          CALL      RDDSCH1
          BRANCH    OVRCD,WIESVL90
.
.
          MATCH     SP70,DDRGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"&nbsp;";
            GOTO      WIESVL99
          ENDIF
.
.******************************************** start of addition       *I-197814
.         * Check DRG version. For 6.0      support WIES 17,16,15,14,13,12,11,10
.
          MATCH     DRG060,PTCNDGPV         * 6.0 DRG
          IF        @EQUAL
            MATCH     "20100701",DDATE      * 10/11 Fin year
            IF        !@LESS
              GOTO      WIESVL30            * using WIES17 (6.0 DRG)
            ENDIF
            MATCH     "20090701",DDATE      * 09/10 Fin year
            IF        !@LESS
              GOTO      WIESVL20            * using WIES16 (6.0 DRG)
            ENDIF
            MATCH     "20080701",DDATE      * 08/09 Fin year
            IF        !@LESS
              GOTO      WIESVL10            * using WIES15 (6.0 DRG)
            ENDIF
            MATCH     "20070701",DDATE      * 07/08 Fin year
            IF        !@LESS
              GOTO      WIESVL80            * using WIES14 (6.0 DRG)
            ENDIF
            MATCH     "20060701",DDATE      * 06/07 Fin year
            IF        !@LESS
              GOTO      WIESVL70            * using WIES13 (6.0 DRG)
            ENDIF
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (6.0 DRG)
            ENDIF
            MATCH     PTCNGDV5,DDATE        * 05/06 ICD10 Ed.5
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (6.0 DRG)
            ENDIF
.
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 Ed.4 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (6.0 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (6.0 DRG)
          ENDIF
.********************************************   end of addition       *I-197814
.
.******************************************** start of addition       *I-137125
.         * Check DRG version. For 5.2      support WIES 15,14,13,12,11,10   
.
          MATCH     DRG052,PTCNDGPV         * 5.2 DRG
          IF        @EQUAL
            MATCH     "20080701",DDATE      * 08/09 Fin year
            IF        !@LESS
              GOTO      WIESVL10            * using WIES15 (5.2 DRG)
            ENDIF
            MATCH     "20070701",DDATE      * 07/08 Fin year          *I-145161
            IF        !@LESS
              GOTO      WIESVL80            * using WIES14 (5.2 DRG)
            ENDIF
            MATCH     "20060701",DDATE      * 06/07 Fin year
            IF        !@LESS
              GOTO      WIESVL70            * using WIES13 (5.2 DRG)
            ENDIF
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.2 DRG)
            ENDIF
            MATCH     PTCNGDV5,DDATE        * 05/06 ICD10 Ed.5
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.2 DRG)
            ENDIF
.
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 Ed.4 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.2 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (5.2 DRG)
          ENDIF
.********************************************   end of addition       *I-137125
.
.******************************************** start of addition       *I-105244
.         * Check DRG version. For 5.1 only support WIES 13,12,11,10    *I-51504
.
          MATCH     DRG051,PTCNDGPV         * 5.1 DRG
          IF        @EQUAL
            MATCH     "20060701",DDATE      * 06/07 Fin year
            IF        !@LESS
              GOTO      WIESVL70            * using WIES13 (5.1 DRG)
            ENDIF
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.1 DRG)
            ENDIF
            MATCH     PTCNGDV5,DDATE        * 05/06 ICD10 Ed.5          
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.1 DRG)
            ENDIF
.
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 Ed.4 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.1 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (5.1 DRG)
          ENDIF
.********************************************   end of addition       *I-105244
.
.         * Check DRG version. For 5.0 only support WIES 12,11,10      *I-51504
          MATCH     DRG050,PTCNDGPV         * 5.0 DRG
          IF        @EQUAL
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.0 DRG)
            ENDIF
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.0 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (5.0 DRG)
          ENDIF
.
.         * Check DRG version. For 4.2 only support WIES 11,10.9       *I-51504
          MATCH     DRG042,PTCNDGPV         * 4.2 DRG
          IF        @EQUAL
            MATCH     "20030701",DDATE      * 03/04 Fin year
            IF        !@LESS
              GOTO      WIESVL50            * using WIES11 (4.2 DRG)
            ENDIF
          ENDIF
.
          GOTO      WIESVL60                * default to WIES 12
.
.     ***** WIES 15 *****
.         
WIESVL10  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw15af",WIESFILE 
          CALL      RDPT151
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL11,WIESVL12,WIESVL13,WIESVL14,WIESVL15
.
          WRITE     HTMLFILE;PT15ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL11  WRITE     HTMLFILE;PT15LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL12  WRITE     HTMLFILE;PT15HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL13  WRITE     HTMLFILE;PT15DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL14  WRITE     HTMLFILE;PT15TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL15  WRITE     HTMLFILE;PT15TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 16 *****
.
WIESVL20  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw16af",WIESFILE
          CALL      RDPT161
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL21,WIESVL22,WIESVL23,WIESVL24,WIESVL25
.
          WRITE     HTMLFILE;PT16ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL21  WRITE     HTMLFILE;PT16LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL22  WRITE     HTMLFILE;PT16HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL23  WRITE     HTMLFILE;PT16DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL24  WRITE     HTMLFILE;PT16TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL25  WRITE     HTMLFILE;PT16TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 17 *****
.
WIESVL30  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw17af",WIESFILE
          CALL      RDPT171
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL31,WIESVL32,WIESVL33,WIESVL34,WIESVL35
.
          WRITE     HTMLFILE;PT17ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL31  WRITE     HTMLFILE;PT17LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL32  WRITE     HTMLFILE;PT17HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL33  WRITE     HTMLFILE;PT17DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL34  WRITE     HTMLFILE;PT17TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL35  WRITE     HTMLFILE;PT17TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 11 *****                                              *I-43498
.
WIESVL50  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw11af",WIESFILE
          CALL      RDPT111
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL51,WIESVL52,WIESVL53
.
          WRITE     HTMLFILE;PT11ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL51  WRITE     HTMLFILE;PT11LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL52  WRITE     HTMLFILE;PT11HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL53  WRITE     HTMLFILE;PT11DRGD;  * DRG Description
          GOTO      WIESVL99
.
.     ***** WIES 12 *****                                              *I-51504
.
WIESVL60  PACK      KEY4,DDRGCODE,SP70
          MATCH     "20050701",DDATE
          IF        !@LESS
            MOVE      "patw12bf",WIESFILE
            CALL      RDPT12B1
            BRANCH    OVRCD,WIESVL92
          ELSE
            MOVE      "patw12af",WIESFILE
            CALL      RDPT121
            BRANCH    OVRCD,WIESVL92
          ENDIF
.
          BRANCH    VIEWFLAG,WIESVL61,WIESVL62,WIESVL63,WIESVL64,WIESVL65
.
          WRITE     HTMLFILE;PT12ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL61  WRITE     HTMLFILE;PT12LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL62  WRITE     HTMLFILE;PT12HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL63  WRITE     HTMLFILE;PT12DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL64  WRITE     HTMLFILE;PT12TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL65  WRITE     HTMLFILE;PT12TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 13 *****
.
WIESVL70  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw13af",WIESFILE
          CALL      RDPT131
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL71,WIESVL72,WIESVL73,WIESVL74,WIESVL75
.
          WRITE     HTMLFILE;PT13ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL71  WRITE     HTMLFILE;PT13LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL72  WRITE     HTMLFILE;PT13HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL73  WRITE     HTMLFILE;PT13DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL74  WRITE     HTMLFILE;PT13TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL75  WRITE     HTMLFILE;PT13TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 14 *****                                             *I-145161
.
WIESVL80  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw14af",WIESFILE
          CALL      RDPT141
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL81,WIESVL82,WIESVL83,WIESVL84,WIESVL85
.
          WRITE     HTMLFILE;PT14ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL81  WRITE     HTMLFILE;PT14LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL82  WRITE     HTMLFILE;PT14HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL83  WRITE     HTMLFILE;PT14DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL84  WRITE     HTMLFILE;PT14TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL85  WRITE     HTMLFILE;PT14TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
WIESVL90  WRITE     HTMLFILE;"Patient is not Discharged!";
          GOTO      WIESVL99
.
WIESVL91  WRITE     HTMLFILE;"Discharge Date out of WIES Range!";
          GOTO      WIESVL99
.
WIESVL92  MOVE      "DRG Code not found on ",DIM22
          PACK      DIM30,DIM22,WIESFILE
          WRITE     HTMLFILE;DIM30;
          GOTO      WIESVL99
.
.
WIESVL99  RETURN
.-------------------------------------------------------------------------------
.                        ****** CLRGRP00 ******
.-------------------------------------------------------------------------------
CLRGRP00  MOVE      SP70,DPTPGADM   * Admission no
          MOVE      SP70,DPTPGEPN   * Episode no
          MOVE      SP70,PTPGGPVR   * Grouper version
          MOVE      SP70,PTPGNDRG   * National DRG
          MOVE      SP70,PTPGNMDC   * National MDC
          MOVE      ZERO,PTPGNWGT   * National weight
          MOVE      ZERO,PTPGNALS   * National average LOS
          MOVE      SP70,PTPGSDRG   * State DRG
          MOVE      SP70,PTPGSMDC   * State MDC
          MOVE      ZERO,PTPGSWGT   * State weight
          MOVE      ZERO,PTPGSALS   * State average LOS
          MOVE      SP70,PTPGLDRG   * Local DRG
          MOVE      SP70,PTPGLMDC   * Local MDC
          MOVE      ZERO,PTPGLWGT   * Local weight
          MOVE      ZERO,PTPGLALS   * Local average LOS
          MOVE      SP70,PTPGPCCL   * Patient CC class level
          MOVE      ZERO,PTPGWFIX   * WIES value fixed
          MOVE      ZERO,PTPGWVAR   * WIES value variable
          MOVE      ZERO,PTPGWTOL   * WIES value total
          MOVE      ZERO,PTPGWWTU   * WIES weight used
          MOVE      SP70,PTPGWWTD   * WIES weight description
          MOVE      SP70,PTPGSPAR   * Spare variable
.
CLRGRP99  RETURN
.**********************************************************************
.                 ****** WRDDIS00 ******
. Output Ward description
.**********************************************************************
WRDDIS00  PACK      KEY6,PTDSDWRD,SP70
          CALL      RDWARD1
          BRANCH    OVRCD,WRDDIS90
.
          WRITE     HTMLFILE;WBDESC;    * description
          GOTO      WRDDIS99
.
WRDDIS90  WRITE     HTMLFILE;"Invalid Ward Code";
WRDDIS99  RETURN
.----------------------------------------------------------------
.                      SHWMAP00
.  Set url with its associated Episode No.
.----------------------------------------------------------------
SHWMAP00  REP       " +",URNUMBER
          REP       " +",ADMISSNO
          MOVE      EPSCD001,EPISODE
          REP       " +",EPISODE 
          UNPACK    DIM127,D1,KEY8,DIM127
          UNPACK    DIM127,D1,KEY2,DIM127
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;KEY8,".pbl?reportno=",KEY2:
                                 "&template=",FLDPARA:
                                 "&urnumber=",URNUMBER:
                                 "&admissno=",ADMISSNO:
                                 "&epscd001=",EPISODE;
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
SHWMAP99  RETURN
.----------------------------------------------------------------
.  Outputs a selection list of Episode numbers for a given Admission
.                   ******** SELEPS00 ********
.----------------------------------------------------------------
SELEPS00  MOVE      ZERO,F2
          REPEAT
            ADD       ONE,F2
            MOVE      ZERO,EPSSLIST[F2]
          UNTIL     F2 = 99
.
          MOVE      " 1",DIM2               * Check Disease Coding file
          PACK      KEY13,ADMISSNO,DIM2,SP70
          CALL      RSPTECD1
SELEPS10  CALL      RKPTECD1
          BRANCH    OVRCD,SELEPS20
.
          MATCH     ADMISSNO,DPTEDADM       * Check for Admission No
          GOTO      SELEPS20 IF NOT EQUAL
.
          MATCH     SP70,PTEDCODE
          IF        !@EQUAL
            MOVE      ONE,EPSSLIST[PTEDEPNO]
          ENDIF
          GOTO      SELEPS10
.
.
SELEPS20  MOVE      " 1",DIM2               * Check Oper Coding File  *C-240107
          PACK      KEY13,ADMISSNO,DIM2,SP70
          CALL      RSPTECO1
SELEPS30  CALL      RKPTECO1
          BRANCH    OVRCD,SELEPS50
.
          MATCH     ADMISSNO,DPTEOADM    * Check for Admission No
          GOTO      SELEPS50 IF NOT EQUAL
.
          MATCH     SP70,PTEOCODE
          IF        !@EQUAL
            MOVE      ONE,EPSSLIST[PTEOEPNO]
          ENDIF
          GOTO      SELEPS30
.
.
SELEPS50  MOVE      ZERO,F2
          REPEAT
            ADD       ONE,F2
            IF        EPSSLIST[F2] = 1
              MOVE      F2,KEY2
              IF        F2 = EPSCD001
                WRITE     HTMLFILE;"<option value=#"",KEY2,"#" selected>":
                                    KEY2,"</option>"
              ELSE
                WRITE     HTMLFILE;"<option value=#"",KEY2,"#">":
                                    KEY2,"</option>"
              ENDIF
            ENDIF
          UNTIL     F2 = 99
.
SELEPS99  RETURN
.------------------------------------------------------------
.                     DRG Details
.      0.Description, 1.Code, 2.Low Trim, 3.High Trim
.      INPUT PARAMETER : DDRGCODE - DRG Code 
.------------------------------------------------------------
DISDRG00  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
.
          MATCH     SP70,DDRGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"&nbsp;";
            GOTO      DISDRG99
          ENDIF
.
          MOVE      DDRGCODE,KEY4
          MOVE      "999",KEY3
          PACK      KEY7,KEY4,KEY3,SP10   * last DRG version          *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          BRANCH    OVRCD,DISDRG90
          MATCH     PTDWDRGC,KEY4           * same DRG code ?         *I-137125
          GOTO      DISDRG90 IF NOT EQUAL                             *I-137125
.
          BRANCH    F1,DISDRG10,DISDRG20,DISDRG30
          WRITE     HTMLFILE;PTDWDESC; * Description
          GOTO      DISDRG99
.
DISDRG10  WRITE     HTMLFILE;PTDWDRGC;  * Code
          GOTO      DISDRG99
.
DISDRG20  WRITE     HTMLFILE;PTDWLOWT;  * Low Trim
          GOTO      DISDRG99
.
DISDRG30  WRITE     HTMLFILE;PTDWHIGH;  * High Trim
          GOTO      DISDRG99
.
DISDRG90  IF        F1 = ZERO
            WRITE     HTMLFILE;"DRG description not found";
          ENDIF
          IF        F1 = ONE
            WRITE     HTMLFILE;"DRG code not found";
          ENDIF
          IF        F1 > ONE
            WRITE     HTMLFILE;"DRG weightings record not found";
          ENDIF    
          GOTO      DISDRG99
.
DISDRG99  RETURN
.
.-----------------------------------------------------------------
. Find the Current visit details when doing a patient search by ur
.-----------------------------------------------------------------
FNDCUR00  BRANCH    PCEASE,FNDCUR90
.
          PACK      KEY24,URNUMBER,Z70
          CALL      RDSVISA2
FNDCUR10  CALL      RDPVISA2
          BRANCH    OVRCD,FNDCUR90
.         
          MATCH     URNUMBER,PVIURNO
          GOTO      FNDCUR90 IF NOT EQUAL
.         
          BRANCH    PVITYPE,FNDCUR40,FNDCUR50,FNDCUR50
.
          GOTO      FNDCUR10
.
FNDCUR40  PACK      KEY8,PVIBILL,SP70
          CALL      RDEMVIS1
          BRANCH    OVRCD,FNDCUR10
.
          COMPARE   FOUR,EMVISTAT                * Cancelled visit
          GOTO      FNDCUR10 IF EQUAL
.
          MOVE      PVIBILL,ADMISSNO
          GOTO      FNDCUR99
.
FNDCUR50  MOVE      PVIBILL,ADMISSNO
          GOTO      FNDCUR99

FNDCUR90  MOVE      SP70,ADMISSNO
.
FNDCUR99  RETURN
+
.******************************************************************************
.*  Get NZ Procedure details if required                                      *
.******************************************************************************
GETNZP00  COMPARE   FIVE,CFEETYP            * NZ Private only
          GOTO      GETNZP90 IF NOT EQUAL
.
          CALL      CLNZSP00
          PACK      KEY11,ADMISSNO,SP70
          CALL      RSNZSPR1
GETNZP10  CALL      RKNZSPR1
          BRANCH    OVRCD,GETNZP90
.
          MATCH     ADMISSNO,NZSPADMN
          GOTO      GETNZP90 IF NOT EQUAL
.
          COMPARE   "1",NZSPPRIM
          GOTO      GETNZP10 IF NOT EQUAL
          GOTO      GETNZP999
.
GETNZP90  CALL      CLNZSP00
.
GETNZP99  RETURN
+
.**********************************************************************
.  Clear PDS DATA
.**********************************************************************
CLRPDS00  MOVE      SP70,MRPDSTAT
          RETURN
.         
.**********************************************************************
.  Clear ICU DATA   
.**********************************************************************
CLRICU00  MOVE      ZERO,PTICUINT
          MOVE      ZERO,PTICUMEC
          MOVE      ZERO,PTICUCCU
          MOVE      SP70,PTICAMBN
          MOVE      ZERO,PTICCPAP
          MOVE      ZERO,PTICHNCU
.
CLRICU99  RETURN
+
.******************************************************************************
MVPMAR00  PACK      PMVXVISN,ARVXVISN,SP70
          PACK      PMVXVSDT,ARVXVSDT,SP70
          PACK      PMVXDOCA,ARVXDOCA,SP70
          PACK      PMVXDOCT,ARVXDOCT,SP70
          PACK      PMVXCSNR,ARVXCSNR,SP70
          PACK      PMVXPOST,ARVXPOST,SP70
          PACK      PMVXPIND,ARVXPIND,SP70
          PACK      PMVXVLOC,ARVXVLOC,SP70
          PACK      PMVXCFSG,ARVXCFSG,SP70
          PACK      PMVXINGP,ARVXINGP,SP70
          PACK      PMVXCPTH,ARVXCPTH,SP70
          PACK      PMVXHCP1,ARVXHCP1,SP70
          PACK      PMVXHCP2,ARVXHCP2,SP70
          PACK      PMVXHCP3,ARVXHCP3,SP70
          PACK      PMVXHCP4,ARVXHCP4,SP70
          PACK      PMVXRHC1,ARVXRHC1,SP70
          PACK      PMVXRH1G,ARVXRH1G,SP70
          PACK      PMVXRH1C,ARVXRH1G,SP70
          PACK      PMVXRHC2,ARVXRHC2,SP70
          PACK      PMVXRH2G,ARVXRH2G,SP70
          PACK      PMVXRH2C,ARVXRH2C,SP70
          PACK      PMVXRHC3,ARVXRHC2,SP70
          PACK      PMVXRH3G,ARVXRH3G,SP70
          PACK      PMVXRH3C,ARVXRH3C,SP70
          PACK      PMVXRHC4,ARVXRHC4,SP70
          PACK      PMVXRH4G,ARVXRH4G,SP70
          PACK      PMVXRH4C,ARVXRH4C,SP70
          PACK      PMVXABRG,ARVXABRG,SP70
          PACK      PMVXCADM,ARVXCADM,SP70
          PACK      PMVXIRAD,ARVXIRAD,SP70
          PACK      PMVXIDUS,ARVXIDUS,SP70
          PACK      PMVXCRAV,ARVXCRAV,SP70
          PACK      PMVXRCCT,ARVXRCCT,SP70
          PACK      PMVXAPWD,ARVXAPWD,SP70
          PACK      PMVXAPBD,ARVXAPBD,SP70
          PACK      PMVXPOWD,ARVXPOWD,SP70
          PACK      PMVXPOBD,ARVXPOBD,SP70
          PACK      PMVXPSTY,ARVXPSTY,SP70
          PACK      PMVXVALW,ARVXVALW,SP70
          PACK      PMVXPALW,ARVXPALW,SP70
          PACK      PMVXINDC,ARVXINDC,SP70
          PACK      PMVXMDAV,ARVXMDAV,SP70
          PACK      PMVXFRMS,ARVXFRMS,SP70
          PACK      PMVXCSNG,ARVXCSNG,SP70
          MOVE      PMVXPWGT,ARVXPWGT
          MOVE      PMVXPHGT,ARVXPHGT
          PACK      PMVXDHWR,ARVXDHWR,SP70
          PACK      PMVXEDC1,ARVXEDC1,SP70
          PACK      PMVXEDC2,ARVXEDC2,SP70
          PACK      PMVXEDC3,ARVXEDC3,SP70
          PACK      PMVXHOME,ARVXHOME,SP70
          PACK      PMVXUDF1,ARVXUDF1,SP70
          PACK      PMVXUDF2,ARVXUDF2,SP70
          PACK      PMVXUDF3,ARVXUDF3,SP70
          PACK      PMVXUDF4,ARVXUDF4,SP70
          PACK      PMVXUDT1,ARVXUDT1,SP70
          PACK      PMVXUDT2,ARVXUDT2,SP70
          PACK      PMVXUDT3,ARVXUDT3,SP70
          PACK      PMVXUDT4,ARVXUDT4,SP70
          PACK      PMVXUDT5,ARVXUDT5,SP70
          PACK      PMVXUDT6,ARVXUDT6,SP70
          PACK      PMVXCDTE,ARVXCDTE,SP70
          PACK      PMVXCTIM,ARVXCTIM,SP70
          PACK      PMVXWEBC,ARVXWEBC,SP70
          PACK      PMVXLUPD,ARVXLUPD,SP70
          PACK      PMVXLUPT,ARVXLUPT,SP70
          PACK      PMVXWEBU,ARVXWEBU,SP70
          PACK      PMVXMHLS,ARVXMHLS,SP70
          PACK      PMVXPICD,ARVXPICD,SP70
          PACK      PMVXRMOR,ARVXRMOR,SP70
          PACK      PMVXASUT,ARVXASUT,SP70
          PACK      PMVXELPS,ARVXELPS,SP70
          PACK      PMVXEMPL,ARVXEMPL,SP70
          PACK      PMVXFINP,ARVXFINP,SP70
          PACK      PMVXOCCP,ARVXOCCP,SP70
          PACK      PMVXPALC,ARVXPALC,SP70
          PACK      PMVXPPAL,ARVXPPAL,SP70
          PACK      PMVXPPPT,ARVXPPPT,SP70
          PACK      PMVXPSOS,ARVXPSOS,SP70
          PACK      PMVXPYSP,ARVXPYSP,SP70
          PACK      PMVXQLDB,ARVXQLDB,SP70
          PACK      PMVXREAD,ARVXREAD,SP70
          PACK      PMVXUDIN,ARVXUDIN,SP70
          PACK      PMVXUREA,ARVXUREA,SP70
          PACK      PMVXUSAC,ARVXUSAC,SP70
          PACK      PMVXUVTH,ARVXUVTH,SP70
          PACK      PMVXINTR,ARVXINTR,SP70
          PACK      PMVXLNG1,ARVXLNG1,SP70
          PACK      PMVXASGC,ARVXASGC,SP70
          PACK      PMVXMHOS,ARVXMHOS,SP70
          PACK      PMVXDSPD,ARVXDSPD,SP70
          PACK      PMVXDSIF,ARVXDSIF,SP70
          PACK      PMVXPRMI,ARVXPRMI,SP70
          PACK      PMVXPRAI,ARVXPRAI,SP70
          PACK      PMVXPRES,ARVXPRES,SP70
          PACK      PMVXUITR,ARVXUITR,SP70
          PACK      PMVXRPOA,ARVXRPOA,SP70
          PACK      PMVXRCN1,ARVXRCN1,SP70
          PACK      PMVXRCN2,ARVXRCN2,SP70
          PACK      PMVXRHFU,ARVXRHFU,SP70
          PACK      PMVXRDVA,ARVXRDVA,SP70
          PACK      PMVXRSLO,ARVXRSLO,SP70
          PACK      PMVXMLOC,ARVXMLOC,SP70
          PACK      PMVXPACC,ARVXPACC,SP70
          PACK      PMVXEDU1,ARVXEDU1,SP70
          PACK      PMVXEDU2,ARVXEDU2,SP70
          PACK      PMVXEDU3,ARVXEDU3,SP70
          PACK      PMVXPRGM,ARVXPRGM,SP70
          PACK      PMVXCONF,ARVXCONF,SP70
          PACK      PMVXEOCL,ARVXEOCL,SP70
          PACK      PMVXSLOC,ARVXSLOC,SP70
          PACK      PMVXSCLI,ARVXSCLI,SP70
          PACK      PMVXSTRA,ARVXSTRA,SP70
          PACK      PMVXQASN,ARVXQASN,SP70
          PACK      PMVXATCP,ARVXATCP,SP70
          PACK      PMVXATIM,ARVXATIM,SP70
          PACK      PMVXITIM,ARVXITIM,SP70
          PACK      PMVXHFGN,ARVXHFGN,SP70
          PACK      PMVXHFSN,ARVXHFSN,SP70
          PACK      PMVXFUPI,ARVXFUPI,SP70
          PACK      PMVXPOEC,ARVXPOEC,SP70
          PACK      PMVXSPAR,ARVXSPAR,SP70
.
          RETURN
+
CLPATHSP  PACK      PTHSHOSP,SP70
          PACK      PTHSNAME,SP70
          PACK      PTHSADD1,SP70
          PACK      PTHSADD2,SP70
          PACK      PTHSADD3,SP70
          PACK      PTHSADD4,SP70
          PACK      PTHSPCOD,SP70
          PACK      PTHSTELE,SP70
          PACK      PTHSFAXN,SP70
          PACK      PTHSUNIT,SP70
          PACK      PTHSHDPC,SP70
          PACK      PTHSMRPR,SP70
          PACK      PTHSPACT,SP70
          PACK      PTHSHSNO,SP70
          PACK      PTHSPMBS,SP70
          PACK      PTHSTFEE,SP70
          PACK      PTHSHLOC,SP70
          PACK      PTHSRCTY,SP70
          PACK      PTHSVOLM,SP70
          PACK      PTHSSTAT,SP70
          PACK      PTHSDCLM,SP70
          PACK      PTHSAPPR,SP70
          PACK      PTHSUFMS,SP70
          PACK      PTHSABNN,SP70
          PACK      PTHSHSID,SP70
          PACK      PTHSHCEN,SP70
          PACK      PTHSPTIN,SP70
          PACK      PTHSSPID,SP70
          PACK      PTHSEDIP,SP70
          PACK      PTHSORID,SP70
.
          RETURN
+
.------------------------------------------------------------
. Output Eclipse OPV PVM Table Details
.------------------------------------------------------------
OVRTAB00  COMPARE   ONE,OVRFLAG
          GOTO      OVRTAB99 IF NOT EQUAL
.
          PACK      KEY26,URNUMBER,SP70
          CALL      RSPMOVR1
OVRTAB10  CALL      RKPMOVR1
          BRANCH    OVRCD,OVRTAB99
.           
          MATCH     URNUMBER,PMORURNO         * Match UR numbers
          GOTO      OVRTAB99 IF NOT EQUAL
.
          PACK      DISPDATE,SP70
          MATCH     SP70,PMORDATE
          IF        !@EQUAL
            UNPACK    PMORDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:displayOVR('",HTMLLINK
          APPEND    PMORURNO,HTMLLINK
          APPEND    PMORDATE,HTMLLINK
          APPEND    PMORTIME,HTMLLINK
          APPEND    DPMORCNT,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          PACK      SAVKEY26,PMORURNO,PMORDATE,PMORTIME,DPMORCNT,SP70
          MOVE      PMORTRID,SAVETRID
.
          PACK      KEY26,URNUMBER,Z70
          CALL      RSPMOVR1
          CALL      RPPMOVR1
          BRANCH    OVRCD,OVRTAB50 
.
          MATCH     URNUMBER,PMORURNO
          GOTO      OVRTAB50 IF NOT EQUAL
.
          MATCH     "0   ",PMORSTAT
          GOTO      OVRTAB30 IF EQUAL
.
          MATCH     "8005",PMORSTAT
          GOTO      OVRTAB30 IF EQUAL
.
          GOTO      OVRTAB50
.
OVRTAB30  MATCH     PMORTRID,SAVETRID
          GOTO      OVRTAB50 IF NOT EQUAL
.
          PACK      DIM40,PGNAME,SP70
          REP       UPPLOW,DIM40
          PACK      PMORFNAM,PMORFNAM,SP70
          MATCH     SP70,PMORFNAM
          GOTO      OVRTAB31 IF EQUAL
          REP       UPPLOW,PMORFNAM
          MATCH     DIM40,PMORFNAM
          GOTO      OVRTAB40 IF NOT EQUAL
.
OVRTAB31  PACK      PMEDI,PMEDI,SP70
          PACK      PMORMEDN,PMORMEDN,SP70
          MATCH     SP70,PMORMEDN
          GOTO      OVRTAB32 IF EQUAL
          MATCH     PMEDI,PMORMEDN
          GOTO      OVRTAB40 IF NOT EQUAL
.
OVRTAB32  PACK      PTMXMCCD,PTMXMCCD,SP70
          PACK      DIM2,PMORMEDR,SP70
          RJUSTIFY  DIM2
          MATCH     SP70,PMORMEDR
          GOTO      OVRTAB50 IF EQUAL
          MATCH     PTMXMCCD,DIM2
          GOTO      OVRTAB40 IF NOT EQUAL
.
          GOTO      OVRTAB50
.
OVRTAB40  MOVE      SAVKEY26,KEY26
          CALL      RDPMOVR1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                        "#"",PMORDATE,PMORTIME,"#",":
                        "#"",PMORSTAT,"#",":
                        "#"",PMOREROR,"#",":
                        "#"<font color=red>",PMORTRID,"</font>#",":
                        "#"",SP1,"#")"
.
          GOTO      OVRTAB10
.
OVRTAB50  MOVE      SAVKEY26,KEY26
          CALL      RDPMOVR1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                      "#"",PMORDATE,PMORTIME,"#",":
                                      "#"",PMORSTAT,"#",":
                                      "#"",PMOREROR,"#",":
                                      "#"",PMORTRID,"#",":
                                      "#"",SP1,"#")"
.
          GOTO      OVRTAB10
.
OVRTAB99  RETURN
+
.------------------------------------------------------------
. Output Eclipse OPV PVM Tag Details       Parameter: FORM1
.------------------------------------------------------------
PMSOVR00  COMPARE   ONE,OVRFLAG
          GOTO      PMSOVR99 IF NOT EQUAL
.
          PACK      KEY26,PMSOVRKY,SP70
          CALL      RDPMOVR1
          BRANCH    OVRCD,PMSOVR99
.
          BRANCH    FORM1,PMSOVR10,PMSOVR20,PMSOVR30,PMSOVR40,PMSOVR50:
                          PMSOVR60,PMSOVR70,PMSOVR80
.
          GOTO      PMSOVR99
.
PMSOVR10  PACK      DISPDATE,SP70
          MATCH     SP70,PMORDATE
          IF        !@EQUAL
            UNPACK    PMORDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PMSOVR99
.
PMSOVR20  WRITE     HTMLFILE;PMORTIME;
          GOTO      PMSOVR99
.
PMSOVR30  WRITE     HTMLFILE;PMORTRID;
          GOTO      PMSOVR99
.
PMSOVR40  WRITE     HTMLFILE;PMORFNAM;
          GOTO      PMSOVR99
.
PMSOVR50  WRITE     HTMLFILE;PMORMEDN;
          GOTO      PMSOVR99
.
PMSOVR60  WRITE     HTMLFILE;PMORMEDR;
          GOTO      PMSOVR99
.
PMSOVR70  WRITE     HTMLFILE;PMORSTAT;
          GOTO      PMSOVR99
.
PMSOVR80  WRITE     HTMLFILE;PMOREROR;
          GOTO      PMSOVR99
.
PMSOVR99  RETURN
.
.------------------------------------------------------------
. Output Eclipse OVV PVP/PVV Table Details
.------------------------------------------------------------
OVVTAB00  COMPARE   ONE,OVVFLAG
          GOTO      OVVTAB99 IF NOT EQUAL
.
          PACK      KEY26,URNUMBER,SP70
          CALL      RSPMOVV1
OVVTAB10  CALL      RKPMOVV1
          BRANCH    OVRCD,OVVTAB99
.
          MATCH     URNUMBER,PMOVURNO         * Match UR numbers
          GOTO      OVVTAB99 IF NOT EQUAL
.
          PACK      DISPDATE,SP70
          MATCH     SP70,PMOVDATE
          IF        !@EQUAL
            UNPACK    PMOVDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:displayOVV('",HTMLLINK
          APPEND    PMOVURNO,HTMLLINK
          APPEND    PMOVDATE,HTMLLINK
          APPEND    PMOVTIME,HTMLLINK
          APPEND    DPMOVCNT,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          PACK      SAVKEY26,PMOVURNO,PMOVDATE,PMOVTIME,DPMOVCNT,SP70
          MOVE      PMOVTRID,SAVETRID
.
          PACK      KEY26,URNUMBER,Z70
          CALL      RSPMOVV1
          CALL      RPPMOVV1
          BRANCH    OVRCD,OVVTAB50
.
          MATCH     URNUMBER,PMOVURNO
          GOTO      OVVTAB50 IF NOT EQUAL
.
          MATCH     "0   ",PMOVSTAT
          GOTO      OVVTAB30 IF EQUAL
.
          MATCH     "8005",PMOVSTAT
          GOTO      OVVTAB30 IF EQUAL
.
          GOTO      OVVTAB50
.
OVVTAB30  MATCH     PMOVTRID,SAVETRID
          GOTO      OVVTAB50 IF NOT EQUAL
.
          PACK      DIM40,PGNAME,SP70
          REP       UPPLOW,DIM40
          PACK      PMOVFNAM,PMOVFNAM,SP70
          MATCH     SP70,PMOVFNAM
          GOTO      OVVTAB31 IF EQUAL
          REP       UPPLOW,PMOVFNAM
          MATCH     DIM40,PMOVFNAM
          GOTO      OVVTAB40 IF NOT EQUAL
.
OVVTAB31  PACK      DIM40,PSNAME,SP70
          REP       UPPLOW,DIM40
          PACK      PMOVSNAM,PMOVSNAM,SP70
          MATCH     SP70,PMOVSNAM
          GOTO      OVVTAB32 IF EQUAL
          REP       UPPLOW,PMOVSNAM
          MATCH     DIM40,PMOVSNAM
          GOTO      OVVTAB40 IF NOT EQUAL
.
OVVTAB32  MOVE      THREE,DIM1              * Get DVA Card Number
          CALL      GCCARD00
.
          PACK      PMCDCNUM,PMCDCNUM,SP70
          PACK      DIM10,PMOVVETN,SP70
          LJUSTIFY  DIM10
          MATCH     SP70,PMOVVETN
          GOTO      OVVTAB50 IF EQUAL
          MATCH     PMCDCNUM,DIM10
          GOTO      OVVTAB40 IF NOT EQUAL
.
          GOTO      OVVTAB50
.
OVVTAB40  MOVE      SAVKEY26,KEY26
          CALL      RDPMOVV1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                        "#"",PMOVDATE,PMOVTIME,"#",":
                        "#"",PMOVSTAT,"#",":
                        "#"",PMOVEROR,"#",":
                        "#"<font color=red>",PMOVTRID,"</font>#",":
                        "#"",SP1,"#")"
.
          GOTO      OVVTAB10
.
OVVTAB50  MOVE      SAVKEY26,KEY26
          CALL      RDPMOVV1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                      "#"",PMOVDATE,PMOVTIME,"#",":
                                      "#"",PMOVSTAT,"#",":
                                      "#"",PMOVEROR,"#",":
                                      "#"",PMOVTRID,"#",":
                                      "#"",SP1,"#")"
.
          GOTO      OVVTAB10
.
OVVTAB99  RETURN
+
.------------------------------------------------------------
. Output Eclipse OVV Tag Details       Parameter: FORM1
.------------------------------------------------------------
PMSOVV00  COMPARE   ONE,OVVFLAG
          GOTO      PMSOVV99 IF NOT EQUAL
.
          PACK      KEY26,PMSOVVKY,SP70
          CALL      RDPMOVV1
          BRANCH    OVRCD,PMSOVV99
.
          BRANCH    FORM2,PMSOVV10,PMSOVV20,PMSOVV30,PMSOVV40,PMSOVV50:
                          PMSOVV60,PMSOVV70,PMSOVV80,PMSOVV90,PMSOVV91:
                          PMSOVV92
.
          GOTO      PMSOVV99
.
PMSOVV10  PACK      DISPDATE,SP70
          MATCH     SP70,PMOVDATE
          IF        !@EQUAL
            UNPACK    PMOVDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PMSOVV99
.
PMSOVV20  WRITE     HTMLFILE;PMOVTIME;
          GOTO      PMSOVV99
.
PMSOVV30  WRITE     HTMLFILE;PMOVTRID;
          GOTO      PMSOVV99
.
PMSOVV40  WRITE     HTMLFILE;PMOVSNAM;
          GOTO      PMSOVV99
.
PMSOVV50  WRITE     HTMLFILE;PMOVFNAM;
          GOTO      PMSOVV99
.
PMSOVV60  WRITE     HTMLFILE;PMOVVETN;
          GOTO      PMSOVV99
.
PMSOVV70  PACK      DISPDATE,SP70
          MATCH     SP70,PMOVPRDT
          IF        !@EQUAL
            UNPACK    PMOVPRDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PMSOVV99
.
PMSOVV80  WRITE     HTMLFILE;PMOVSTAT;
          GOTO      PMSOVV99
.
PMSOVV90  WRITE     HTMLFILE;PMOVEROR;
          GOTO      PMSOVV99
.
PMSOVV91  WRITE     HTMLFILE;PMOVVENC;
          GOTO      PMSOVV99
.
PMSOVV92  MOVE      "Unknown                                 ",DIM40
.
          MATCH     "PTEC",PMOVVENC
          IF        @EQUAL
            MOVE      "Gold Card                               ",DIM40
          ENDIF
.
          MATCH     "STEC",PMOVVENC
          IF        @EQUAL
            MOVE      "White Card                              ",DIM40
          ENDIF
.
          MATCH     "RPBC",PMOVVENC
          IF        @EQUAL
            MOVE      "Orange Card                             ",DIM40
          ENDIF
.
          MATCH     "PCC ",PMOVVENC
          IF        @EQUAL
            MOVE      "Pensioner Concession Card               ",DIM40
          ENDIF
.
          MATCH     "CSHC",PMOVVENC
          IF        @EQUAL
            MOVE      "Commonwealth Seniors Healthcare Card    ",DIM40
          ENDIF
.
          MATCH     "NIL ",PMOVVENC
          IF        @EQUAL
            MOVE      "Card type cannot be determined          ",DIM40
          ENDIF
.
          WRITE     HTMLFILE;DIM40;
          GOTO      PMSOVV99
.
PMSOVV99  RETURN
.
.------------------------------------------------------------
. Eclipse IMC Claim Full Details
.------------------------------------------------------------
EIMC0000  MATCH     "1",PTCNUIMC
          GOTO      EIMC9500 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      EIMC5000 IF EQUAL
.
          MATCH     ANSC,UPDATTYP
          GOTO      EIMC6000 IF EQUAL
.
          GOTO      EIMC9000
.
EIMC5000  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,EIMC9100
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,EIMC9100
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          CALL      PATFLD00                * Use standard Patient Folder sub
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDPRECT2
          BRANCH    OVRCD,EIMC9200
.
          CALL      DFUL0000
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,EIMC9300
.
          PACK      KEY27,PRHDUNIQ,PRHRE001,PRHRE002,PRHRE003,SP70
          CALL      RDPRHR1
          BRANCH    OVRCD,EIMC9300
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,EIMC9400
.
EIMC5500  CLEAR     WEBTITLE
          MOVE      "Eclipse Claim Full Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,EIMC9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      EIMC9999
.
EIMC6000  PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDPRECT2
          BRANCH    OVRCD,EIMC9200
.
          MOVE      TEN9,PRECFLAG
          CALL      UPPRECT2
.
.         Write a new history (priecaaf) record
.
          MOVE      PRECINVN,PREAINVN
          MOVE      PRECBATN,PREABATN
          MOVE      TEN9,PREASTAT
          MOVE      " 5",PREATYPE
          MOVE      WBSEUID,PREAOPER
          MOVE      PRECTRID,PREATRID
          MOVE      SP70,PREAEROR
          MOVE      SP70,PREAEROT
          MOVE      SP70,PREASPAR
.
          CALL      IBACLOCK                     * get current date/time
          PACK      PREADATE,CCC,CYY,CMM,CDD
          REP       " 0",PREADATE
          MOVE      CTIMEIS,PREATIME
          REP       " 0",PREATIME
.
          PACK      KEY26,PREAINVN,PREADATE,PREATIME,PREATYPE,SP70
          CALL      RAPRECA1
          IF        OVRCD = 1
            CALL      WRPRECA1
          ENDIF
.
          MOVE      SP70,TTYPEARG
          MOVE      " 9",TTYPEARG
          CALL      DELETR00
.
          MOVE      "10",TTYPEARG
          CALL      DELETR00
.
          MOVE      " 4",TTYPEARG
          CALL      DELETR00
.
          MOVE      " 5",TTYPEARG
          CALL      DELETR00
.
          CALL      DELECO00
.
          MOVE      ZERO,EXIT
          GOTO      EIMC9999
.
EIMC9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EIMC9999
.
EIMC9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EIMC9999
.
EIMC9200  MOVE      "Can't find Eclipse IMC Claim details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EIMC9999
.
EIMC9300  MOVE      "Doctor Referral details has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EIMC9999
.
EIMC9400  MOVE      "Can't Find Invoice Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EIMC9999
.
EIMC9500  MOVE      "Not using Eclipse IMC Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EIMC9999
.
EIMC9999  RETURN
.
.*****************************************************************************
.*                          DFUL0000                                         *
.*****************************************************************************
.
DFUL0000  CALL      GBAL0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,PRECFLAG,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19
.
DFUL9999  RETURN
+
.*****************************************************************************
.*                          GBAL0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on priectaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBAL0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      PRECINVN,KEY8
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      GBAL9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PRINGSTJ,FORM7P2O
          ENDIF
.
GBAL9999  RETURN
+
.*****************************************************************************
.*                          DFUP0000                                         *
.*****************************************************************************
.
DFUP0000  CALL      GBAP0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19
.
DFUP9999  RETURN
+
.*****************************************************************************
.*                          GBAP0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on priectaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBAP0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      EMECINVN,KEY8
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      GBAP9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PRINGSTJ,FORM7P2O
          ENDIF
.
GBAP9999  RETURN
+
.------------------------------------------------------------------------------
. Close pmsecoaf records
.------------------------------------------------------------------------------
DELECO00  PACK      KEY31,PRECHFND,ZERO,PRECTRID,SP70
          CALL      RDPMECO1
          BRANCH    OVRCD,DELECO99
.
.         We should only have one record with flag either 'Open' or 'Closed'
.
          PACK      SKEY31,PMEOHFND,PMEODFLG,PMEOTRID,SP70
.
          MOVE      ONE,PMEODFLG
          PACK      KEY31,PMEOHFND,PMEODFLG,PMEOTRID,SP70
          CALL      RAPMECO1
          IF        OVRCD=1
            MOVE      SKEY31,KEY31
            CALL      RDPMECO1                     * reposition
            IF        OVRCD=0
              MOVE      ONE,PMEODFLG
              CALL      UPPMECO1                   * update record
            ENDIF
          ELSE
            MOVE      "0",PMEODFLG                 * set to Open
            PACK      KEY31,PMEOHFND,PMEODFLG,PMEOTRID,SP70
            CALL      DEPMECO1
          ENDIF
.
DELECO99  RETURN
.
.------------------------------------------------------------------------------
. Close pmsetraf records
.------------------------------------------------------------------------------
DELETR00  PACK      KEY51,SP1,TTYPEARG,SP70
          CALL      RSPMETR1
DELETR10  CALL      RKPMETR1
          BRANCH    OVRCD,DELETR99
.
          MATCH     SP70,PMETSTAT
          GOTO      DELETR99 IF NOT EQUAL
.
          MATCH     TTYPEARG,PMETTYPE
          GOTO      DELETR99 IF NOT EQUAL
.
          MATCH     PRECTRID,PMETTRID
          GOTO      DELETR10 IF NOT EQUAL
.
          MOVE      "1",PMETSTAT
.
          CALL       UPPMETR1
.
DELETR99  RETURN
.
.------------------------------------------------------------
. Eclipse IMC Claim Full Details tags
.------------------------------------------------------------
ECFL0000  BRANCH    FLDITMNO,ECFL0100,ECFL0200,ECFL0300,ECFL0400,ECFL0500:
                             ECFL0600,ECFL0700,ECFL0800,ECFL0900,ECFL1000:
                             ECFL1100,ECFL1200,ECFL1300,ECFL1400,ECFL1500:
                             ECFL1600,ECFL1700,ECFL1800,ECFL1900,ECFL2000:
                             ECFL2100,ECFL2200,ECFL2300,ECFL2400,ECFL2500:
                             ECFL2600,ECFL2700,ECFL2800,ECFL2900,ECFL3000:
                             ECFL3100,ECFL3200,ECFL3300,ECFL3400,ECFL3500
.
          GOTO      ECFL9999
.
ECFL0100  WRITE     HTMLFILE;FORM7P2O;
          GOTO      ECFL9999
.
ECFL0200  WRITE     HTMLFILE;STATDESC;
          GOTO      ECFL9999
.
ECFL0300  
.         WRITE     HTMLFILE;CONTDESC;
          GOTO      ECFL9999
.
ECFL0400  MATCH     SP70,PRECPDAT
          GOTO      ECFL9999 IF EQUAL
          UNPACK    PRECPDAT,CCENT,CYEAR,CMON,CDAY  * Payment Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ECFL9999
.
ECFL0500  WRITE     HTMLFILE;PRECEETP;
          GOTO      ECFL9999
.
ECFL0600  MATCH     "2",PRECEETP
          IF        @EQUAL
            WRITE     HTMLFILE;"Medicare Only";
          ELSE
            PACK      KEY14,PRECHFND,ZERO,ZERO,ZERO,ZERO,SP70
            CALL      RDFUND1
            IF        OVRCD=0
              WRITE     HTMLFILE;HFNAME;
            ENDIF
          ENDIF
          GOTO      ECFL9999
.
ECFL0700  WRITE     HTMLFILE;PRECINVN;
          GOTO      ECFL9999
.
ECFL0800  WRITE     HTMLFILE;PRECBATN;
          GOTO      ECFL9999
.
ECFL0900  WRITE     HTMLFILE;PRECPBAT;
          GOTO      ECFL9999
.
ECFL1000  WRITE     HTMLFILE;PRECNBAT;
          GOTO      ECFL9999
.
ECFL1100  WRITE     HTMLFILE;PRECTRID;
          GOTO      ECFL9999
.
ECFL1200  WRITE     HTMLFILE;PRECFTID;
          GOTO      ECFL9999
.
ECFL1300  WRITE     HTMLFILE;PRECAMTC;
          GOTO      ECFL9999
.
ECFL1400  WRITE     HTMLFILE;PRINITOT;
          GOTO      ECFL9999
.
ECFL1500  WRITE     HTMLFILE;PRINPAMT;
          GOTO      ECFL9999
.
ECFL1600  WRITE     HTMLFILE;PRINHAMT;
          GOTO      ECFL9999
.
ECFL1700  WRITE     HTMLFILE;PRINOTHA;
          GOTO      ECFL9999
.
ECFL1800  WRITE     HTMLFILE;PRINJAMT;
          GOTO      ECFL9999
.
ECFL1900  WRITE     HTMLFILE;PRECAMFP;
          GOTO      ECFL9999
.
ECFL2000  MATCH     SP70,PRECSTAT                * blank status ?
          GOTO      ECFL9999 IF EQUAL            * yes - don't display anything
          GOTO      ECFL9999 IF EOS
.
          MATCH     " 0",PRECSTAT                * closed without pymt or w/o
          IF        @EQUAL
            WRITE     HTMLFILE;"No Payment or Write-Off";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     " 1",PRECSTAT                * closed with write-off only
          IF        @EQUAL
            WRITE     HTMLFILE;"Write-Off Only";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     " 2",PRECSTAT                * closed with payment only
          IF        @EQUAL
            WRITE     HTMLFILE;"Payment Only";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     " 3",PRECSTAT                * closed with payment & w/o
          IF        @EQUAL
            WRITE     HTMLFILE;"Payment & Write-Off";
            GOTO      ECFL9999
          ENDIF
.
          GOTO      ECFL9999
.
ECFL2100  CALL      EDIH0000
          GOTO      ECFL9999
.
ECFL2200  CALL      EDIP0000
          GOTO      ECFL9999
.
ECFL2300  CALL      EDCE0000
          GOTO      ECFL9999
.
ECFL2400  CALL      EDSD0000
          GOTO      ECFL9999
.
ECFL2500  CALL      EDSE0000
          GOTO      ECFL9999
.
ECFL2600  WRITE     HTMLFILE;PRINCNTT;
          GOTO      ECFL9999
.
ECFL2700  
.         WRITE     HTMLFILE;CFEETYP;
          GOTO      ECFL9999
.
ECFL2800  WRITE     HTMLFILE;PRECAMMP;
          GOTO      ECFL9999
.
ECFL2900  MOVE      "CL",CATEGORY         * claim code
          MOVE      PRHDCLAM,CODE
          CALL      CODITM00
          GOTO      ECFL9999
.
ECFL3000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ECFL3010
.
          WRITE     HTMLFILE;PRHDHFND;
.
          GOTO      ECFL9999
.
ECFL3010  MATCH     SP70,PRHDHFND
          GOTO      ECFL9999 IF EQUAL
          GOTO      ECFL9999 IF EOS
.
          PACK      KEY14,PRHDHFND,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,ECFL9999
.
          WRITE     HTMLFILE;HFNAME;
.
          GOTO      ECFL9999
.
ECFL3100  WRITE     HTMLFILE;UNIQNUMB;
          GOTO      ECFL9999
.
ECFL3200  WRITE     HTMLFILE;PRHRE001;
          GOTO      ECFL9999
.
ECFL3300  WRITE     HTMLFILE;PRHRE002;
          GOTO      ECFL9999
.
ECFL3400  WRITE     HTMLFILE;PRHRE003;
          GOTO      ECFL9999
.
ECFL3500  PACK      KEY22,PRECUNIQ,PRECINVN,SP70
          CALL      RSPRDT1
ECFL3510  CALL      RKPRDT1
          BRANCH    OVRCD,ECFL9999
.
          MATCH     PRECUNIQ,DPRDTUNQ
          GOTO      ECFL9999 IF NOT EQUAL
.
          MATCH     PRECINVN,PRDTINVN
          GOTO      ECFL9999 IF NOT EQUAL
.
          COMPARE   TWO,PRDTIFLG
          GOTO      ECFL3510 IF NOT EQUAL
.
          WRITE     HTMLFILE;PRDTLVIS;
          GOTO      ECFL9999
.
ECFL9999  RETURN
+
.------------------------------------------------------------
. Table of EDI History
.------------------------------------------------------------
EDIH0000  MATCH     "1",PTCNUIMC 
          GOTO      EDIH9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          CALL      EDIHD000      * Output Table Heading
.
          PACK      KEY34,MAVINVCE,Z70
          CALL      RSPRECA3
EDIH1000  CALL      RPPRECA3
          BRANCH    OVRCD,EDIH9999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     MAVINVCE,PREAINVN
          GOTO      EDIH9999 IF NOT EQUAL
.
          CALL      EDIRW000
.
          GOTO      EDIH1000
.
EDIH9999  RETURN
.------------------------------------------------------------
. EDI History (TABLE HEADING)
.------------------------------------------------------------
EDIHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Time</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Status</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Transaction Type</td>":
                             "<td class=HeadingCell width=10%>":
                             "Batch</td>":
                             "<td class=HeadingCell width=10%>":
                             "Reviewed By</td>":
                             "<td class=HeadingCell width=35%>":
                             "Error Code Description</td>":
                             "</tr>"
.
EDIHD999  RETURN
.------------------------------------------------------------
. EDI History (Detail Row)
.------------------------------------------------------------
EDIRW000  MOVE      SP70,DIM11
          MATCH     SP70,PREADATE
          IF        !@EQUAL & !@EOS
            UNPACK    PREADATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,PREASTAT,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19
.
          MOVE      SP30,TYPEDESC
          MOVE      PREATYPE,TYPOFREQ
          LOAD      TYPEDESC,TYPOFREQ,TYPEDES1,TYPEDES2,TYPEDES3,TYPEDES4:
                                      TYPEDES5,TYPEDES6,TYPEDES7
          IF        TYPOFREQ = 6 | TYPOFREQ = 7
            STRIP     TYPEDESC
            ENDSET    TYPEDESC
            APPEND    SP1,TYPEDESC
            APPEND    PREAEROR,TYPEDESC
            APPEND    SP20,TYPEDESC
            RESET     TYPEDESC
          ENDIF
.
          MOVE      SP70,DIM30
          PACK      KEY10,PREAOPER,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PREAOPER,DIM30
          ELSE
            MATCH     PREAOPER,WBSEUID
            IF        @EQUAL
              MOVE      WBSENAM,DIM30
            ELSE
              MOVE      PREAOPER,DIM30
            ENDIF
          ENDIF
.
          CMATCH    NULL,PREAEROT
          IF        @EQUAL
            PACK      PREAEROT,SP70,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",DIM11 ,"</td>";
          WRITE     HTMLFILE;"<td>",PREATIME,"</td>";
          WRITE     HTMLFILE;"<td>",STATDESC,"</td>":
                             "<td>",TYPEDESC,"</td>":
                             "<td>",PREABATN,"</td>":
                             "<td>",DIM30,"</td>":
                             "<td>",PREAEROT,"</td>":
                             "</tr>";
.
EDIRW999  RETURN
.
.------------------------------------------------------------
. Eclipse IMC Claim Enquiries
.------------------------------------------------------------
EMCE0000  MATCH     "1",PTCNUIMC
          GOTO      EMCE9200 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      EMCE6000 IF EQUAL

          MATCH     "V",UPDATTYP
          GOTO      EMCE1000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      EMCE2000 IF EQUAL
.
          MATCH     "D",UPDATTYP
          GOTO      EMCE3000 IF EQUAL
.
          MATCH     "P",UPDATTYP
          GOTO      EMCE4000 IF EQUAL
.
          MATCH     "S",UPDATTYP
          GOTO      EMCE5000 IF EQUAL
.
          GOTO      EMCE9000
.
EMCE1000  CALL      MINV0000
          GOTO      EMCE9999
.
EMCE2000  CALL      RSUB0000
          GOTO      EMCE9999
.
EMCE3000  CALL      WDEL0000
          GOTO      EMCE9999
.
EMCE4000  CALL      OTPC0000
          GOTO      EMCE9999
.
EMCE5000  CALL      RSET0000
          GOTO      EMCE9999
.
EMCE6000  MOVE      TEMPLATE,FORM3
          IF        THREE=FORM3
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,EMCE9100
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDPMPX21
            BRANCH    OVRCD,EMCE9100
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE                   * CALCAGE uses PBDATE
.
            CALL      PATLN000
            CALL      PATFLD00                * Use standard Patient Folder sub
.
            MOVE      URNUMBER,FILTURNO
.           MOVE      UNIQNUMB,FILTADMN
.
            IF        ALLHFLAG=0
              COMPARE   ONE,IBCNMHOS
              IF        @EQUAL
                MOVE      TWO,VIEWTYPE
                MOVE      ZERO,EXDTBLNK
              ELSE
                MOVE      ZERO,VIEWTYPE
                MOVE      ONE,EXDTBLNK
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
.
          MATCH     "4",TEMPLATE
          IF        @EQUAL
            MOVE      "Eclipse IMC Outstanding Assessment Reports Enquiry",WEBTITLE
          ELSE 
            MOVE      "Eclipse IMC Claim Enquiry",WEBTITLE
          ENDIF
.
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,EMCE9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      EMCE9999
.
EMCE9000  MOVE      "Invalid Form Action.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      EMCE9999
.
EMCE9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMCE9999
.
EMCE9200  MOVE      "Not using Eclipse IMC Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMCE9999
.
EMCE9999  RETURN
.*****************************************************************************
.*                          MINV0000                                         *
.*****************************************************************************
.
.         First, get the last EDI History record for this invoice
.
MINV0000  PACK      KEY26,MAVINVCE,Z70
          CALL      RSPRECA1                     * position on last history rec
          CALL      RPPRECA1                     * read previous record
          BRANCH    OVRCD,MINV3000               * eof - finished
.
          MATCH     MAVINVCE,PREAINVN            * same invoice still ?
          GOTO      MINV3000 IF NOT EQUAL        * no - finished
.
.         Read priectaf
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDPRECT2
          BRANCH    OVRCD,MINV3000
.
.         The last EDI history record has been found for the invoice, so
.         write a new record, defaulting some of the values from the read
.         record.
.
          MOVE      MAVBATCH,PREABATN
          MOVE      MAVINVCE,PREAINVN
.
MINV1000  CALL      IBACLOCK                     * get current date/time
          PACK      PREADATE,CCC,CYY,CMM,CDD
          REP       " 0",PREADATE
          MOVE      CTIMEIS,PREATIME
          REP       " 0",PREATIME
.
          MOVE      " 5",PREATYPE
          MOVE      WBSEUID,PREAOPER
          MOVE      SP70,PREASPAR
.
          PACK      KEY26,PREAINVN,PREADATE,PREATIME,PREATYPE,SP70
          CALL      RAPRECA1
          IF        OVRCD = 0
            GOTO      MINV1000
          ENDIF
.
          CALL      WRPRECA1                     * write EDI History record
.
.         If the record has a status of "Medicare Unverified", 
.         "Health Fund Unverified",
.         "Error (SA validation)" or "Health Fund Rejected - Reported"
.         then update the status to "Closed", as the claim cannot go any
.         further (unless resubmitted after closing).
.
          IF        PRECFLAG = 3 | PRECFLAG = 5 | PRECFLAG = 7  | PRECFLAG = 15 | PRECFLAG = 16
            PACK      KEY35,PRECHOSP,PRECFLAG,PRECHFND,PRECUNIQ,PRECINVN:
                            PRECBATN,SP70
            CALL      RDPRECT1                   * read selected record
            BRANCH    OVRCD,MINV3000             * shouldn't happen
.
            MOVE      TEN9,PRECFLAG              * update to "closed"
            CALL      UPPRECT1
.
.           Also write an EDI History record (priecaaf) for the close
.
            MOVE      PRECINVN,PREAINVN
            MOVE      PRECBATN,PREABATN
            MOVE      TEN9,PREASTAT
            MOVE      " 5",PREATYPE
            MOVE      WBSEUID,PREAOPER
            MOVE      PRECTRID,PREATRID
            MOVE      SP30,PREASPAR
.
MINV2000    CALL      IBACLOCK                   * get current time
            PACK      PREADATE,CCC,CYY,CMM,CDD
            REP       " 0",PREADATE
            MOVE      CTIMEIS,PREATIME
            REP       " 0",PREATIME
.
            PACK      KEY26,PREAINVN,PREADATE,PREATIME,PREATYPE,SP70
            CALL      RAPRECA1
            IF        OVRCD = 1
              CALL      WRPRECA1
            ELSE
              GOTO      MINV2000
            ENDIF
.
            GOTO      MINV9000
          ELSE
            GOTO      MINV9000
          ENDIF
.
MINV3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      MINV9100
.
MINV9000  MOVE      ZERO,EXIT
          GOTO      MINV9999
.
MINV9100  MOVE      ONE,EXIT
.
MINV9999  RETURN
+
.*****************************************************************************
.*                               RSUB0000                                    *
.*                  Process resubmission selection                           *
.*****************************************************************************
RSUB0000  MOVE      ZERO,EXIT
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDPRECT2
          BRANCH    OVRCD,RSUB7000
.
.         Check if the record has already been resubmitted
.
          MATCH     SP8,PRECNBAT                 * next batch blank ?
          IF        !@EQUAL
            GOTO      RSUB8000
          ENDIF
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
.         IF        PRECFLAG <> 19 & PRECFLAG <> 3
.           GOTO      RSUB7000
.         ENDIF
.
          IF        PRECFLAG = 19 | PRECFLAG = 3
.
            PACK      KEY26,PRECINVN,Z70
            CALL      RSPRECA1
RSUB2100    CALL      RPPRECA1
            BRANCH    OVRCD,RSUB2500
.
            MATCH     PRECINVN,PREAINVN
            GOTO      RSUB2500 IF NOT EQUAL
.
            MATCH     PRECTRID,PREATRID
            GOTO      RSUB2100 IF NOT EQUAL
.
            COMPARE   THREE,PREASTAT
            GOTO      RSUB2100 IF NOT EQUAL
.
            MATCH     " 6",PREATYPE
            GOTO      RSUB2100 IF NOT EQUAL
.
            MATCH     "3002",PREAEROR
            GOTO      RSUB2100 IF NOT EQUAL
.
            MOVE      ZERO,FORM8A
.
            CALL      IBACLOCK
.
            PACK      CURRDATE,CCC,CYY,CMM,CDD
            REP       " 0",CURRDATE
.
            DAYSEP    PREADATE,CURRDATE,FORM8A
.
            COMPARE   FORM8A,ONE
            GOTO      RSUB2500 IF EQUAL
            GOTO      RSUB2500 IF LESS
.
            GOTO      RSUB7500
.
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RSUB2500  PACK      KEY8,PRECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      RSUB6000
          ENDIF
.
          CALL      GBAL0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission (CAR 181439)
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSUB5000
          ENDIF
.
          PACK      KEY16,PRECINVN,SP8
          CALL      RAPRECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSUB4000
          ENDIF
.
          MOVE      ZERO,PRECFLAG
          MOVE      SP70,PRECBATN
          MOVE      MAVBATCH,PRECPBAT
          MOVE      SP70,PRECNBAT
.         MOVE      SP70,PRECCCFL
          MOVE      SP70,PRECTRID
          MOVE      ZERO,PRECAMTC
          MOVE      ZERO,PRECAMFP
          MOVE      ZERO,PRECAMMP
          MOVE      SP70,PRECPDAT
          MOVE      SP70,PRECSTAT
          MOVE      SP70,PRECFTID
          MOVE      PRINPRAC,PRECPRAC
          MOVE      SP70,PRECSPAR
.
          PACK      KEY16,PRECINVN,PRECBATN,SP70
          CALL      RAPRECT2
          IF        OVRCD = 1
            CALL      WRPRECT1                   * write record
          ELSE
            GOTO      RSUB4000
          ENDIF
.
.         Update the selected record with the next batch no. of "00000000".
.         The record will either have a status of "closed" already, or
.         "SA Validation Error".  If it's the latter, then update the status to
.         "closed" as well"
.
.         PACK      KEY35,PRECHOSP,TEN9,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.         CALL      RDPRECT1
.         IF        OVRCD = 1
.    PACK      KEY35,PRECHOSP,SP1,THREE,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.           CALL      RDPRECT1
.           IF        OVRCD = 1
.             GOTO      RSUB3000
.           ELSE
.             MOVE      TEN9,PRECFLAG            * set status to closed
.           ENDIF
.         ENDIF
.
          PACK      KEY16,PRECINVN,MAVBATCH,SP70
          CALL      RDPRECT2
          IF        OVRCD = 1
            CALL      RSUB3000                   * write record
          ELSE
            MOVE      TEN9,PRECFLAG            * set status to closed
          ENDIF
.
          MOVE      "00000000",PRECNBAT
          CALL      UPPRECT2
.
          GOTO      RSUB9999
.
RSUB3000  CLEAR     WEBTITLE
          APPEND    "Error updating Invoice ",WEBTITLE
          APPEND    PRECINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    PRECBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB4000  MOVE      "Invoice already waiting for extraction.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB5000  MOVE      "Claim fully paid.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB6000  CLEAR     WEBTITLE
          APPEND    "Invoice ",WEBTITLE
          APPEND    PRECINVN,WEBTITLE
          APPEND    " not found.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB7000  MOVE      "Claim not not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB7500  MOVE      "Error 3002. Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB8000  MOVE      "Invoice already resubmitted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB9000  MOVE      ONE,EXIT
RSUB9999  RETURN
.*****************************************************************************
.*                               WDEL0000                                    *
.*                  Process delete records waiting                           *
.*****************************************************************************
WDEL0000  MOVE      ZERO,EXIT
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDPRECT2
          BRANCH    OVRCD,WDEL8000
.
          MOVE      PRECINVN,TEMPINVN
          MOVE      PRECBATN,TEMPBATN
          MOVE      PRECUNIQ,TEMPADMN
          MOVE      PRECURNO,TEMPURNO
          MOVE      PRECHFND,TEMPHFND
          MOVE      PRECPBAT,TEMPPBAT
          MOVE      PRECHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      WDEL1000 IF EQUAL
          GOTO      WDEL1000 IF EOS
.
          PACK      KEY35,TEMPHOSP,TEN5,TEMPHFND,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDPRECT1
          IF        OVRCD = 1
            GOTO      WDEL7000
          ELSE
            MOVE      SP70,PRECNBAT
            CALL      UPPRECT1
          ENDIF
.
.         Delete the selected record
.
WDEL1000  PACK      KEY35,TEMPHOSP,SP1,ZERO,TEMPHFND,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEPRECT1
.
          GOTO      WDEL9999
.
WDEL7000  CLEAR     WEBTITLE
          APPEND    "Error updating previous claim ",WEBTITLE
          APPEND    PRECINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    PRECBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      WDEL9000
.
WDEL8000  MOVE      "Record cannot be deleted.",WEBTITLE
          CALL      WEBERR00
          GOTO      WDEL9000
.
WDEL9000  MOVE      ONE,EXIT
WDEL9999  RETURN
+
.*****************************************************************************
.*                          RSET0000                                         *
.*****************************************************************************
.
.         First, get the last EDI History record for this invoice
.
RSET0000  PACK      KEY26,MAVINVCE,Z70
          CALL      RSPRECA1                     * position on last history rec
          CALL      RPPRECA1                     * read previous record
          BRANCH    OVRCD,RSET3000               * eof - finished
.
          MATCH     MAVINVCE,PREAINVN            * same invoice still ?
          GOTO      RSET3000 IF NOT EQUAL        * no - finished
.
.         Read priectaf
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDPRECT2
          BRANCH    OVRCD,RSET3000
.
.         If the record has a status of "Health Fund Unverified", "Medicare 
.         Unverified", then allow the status to be set to "Health Fund 
.         Verified", "Medicare Verified" so it can be processed.
.         If the record has a status of "Health Fund Assessing" or "Medicare
.         Assessing", then allow the status to be set to "Closed".
.
          IF        PRECFLAG = 5 | PRECFLAG = 7 | PRECFLAG = 9 | PRECFLAG = 10
            PACK      KEY35,PRECHOSP,PRECFLAG,PRECHFND,PRECUNIQ,PRECINVN:
                            PRECBATN,SP70
            CALL      RDPRECT1                   * read selected record
            BRANCH    OVRCD,RSET3000             * shouldn't happen
.
            IF        PRECFLAG = 5
              MOVE      SIX,PRECFLAG           * reset to "Medicare Verified"
            ENDIF
.
            IF        PRECFLAG = 7
              MOVE      EIGHT,PRECFLAG         * reset to "Health Fund Verified"
            ENDIF
.
            IF        PRECFLAG = 9
              MOVE      TEN9,PRECFLAG          * reset to "Closed"
            ENDIF
.
            IF        PRECFLAG = 10
              MOVE      TEN9,PRECFLAG          * reset to "Closed"
            ENDIF
.
            CALL      UPPRECT1
.
.           Also write an EDI History record (priecaaf) for the reset
.
            MOVE      PRECINVN,PREAINVN
            MOVE      PRECBATN,PREABATN
            IF        PRECFLAG = 6
              MOVE      SIX,PREASTAT
            ENDIF
.
            IF        PRECFLAG = 8
              MOVE      EIGHT,PREASTAT
            ENDIF
.
            IF        PRECFLAG = 19
              MOVE      TEN9,PREASTAT
            ENDIF
.
            MOVE      " 0",PREATYPE
            MOVE      WBSEUID,PREAOPER
            MOVE      PRECTRID,PREATRID
            MOVE      SP70,PREAEROR
            IF        PRECFLAG = 6 | PRECFLAG = 8
              MOVE      "Claim reset manually",PREAEROT
            ELSE
              MOVE      "Claim closed manually",PREAEROT
            ENDIF
            MOVE      SP30,PREASPAR
.
RSET2000    CALL      IBACLOCK                   * get current time
            PACK      PREADATE,CCC,CYY,CMM,CDD
            REP       " 0",PREADATE
            MOVE      CTIMEIS,PREATIME
            REP       " 0",PREATIME
.
            PACK      KEY26,PREAINVN,PREADATE,PREATIME,PREATYPE,SP70
            CALL      RAPRECA1
            IF        OVRCD = 1
              CALL      WRPRECA1
            ELSE
              GOTO      RSET2000
            ENDIF
.
            GOTO      RSET9000
          ELSE
            GOTO      RSET9000
          ENDIF
.
RSET3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSET9100
.
RSET9000  MOVE      ZERO,EXIT
          GOTO      RSET9999
.
RSET9100  MOVE      ONE,EXIT
.
RSET9999  RETURN
+
.*****************************************************************************
.*                               OTPC0000                                    *
.*                  Process delete outstanding processing reports            *
.*****************************************************************************
OTPC0000  MOVE      ZERO,EXIT
.
          PACK      KEY31,ECOTFUND,ECOTTYPE,ECOTTRID,SP70
          CALL      RDPMECO1
          BRANCH    OVRCD,OTPC8000
.
          PACK      KEY16,PMEOINVN,PMEOBATN,SP70
          CALL      RDPRECT2
          BRANCH    OVRCD,OTPC7000
.
.         MATCH     PMEOTRID,PRECTRID            * same transaction id still ?
.         GOTO      OTPC7000 IF NOT EQUAL        * no
.
          CALL      CLOS0000
.
          GOTO      OTPC9999
.
OTPC7000  MOVE      "Unable to locate claim record.  ",WEBTITLE
          CALL      WEBERR00
          GOTO      OTPC9000
.
OTPC8000  MOVE      "Unable to locate record to close.  ",WEBTITLE
          CALL      WEBERR00
          GOTO      OTPC9000
.
OTPC9000  MOVE      ONE,EXIT
OTPC9999  RETURN
.
.*****************************************************************************
.*                              CLOS0000           Called by: DOUT0000       *
.*             Close a claim that is still waiting for an outstanding        *
.*             report and for which a remittance report has been received.   *
.*****************************************************************************
.
.         Update the outstanding processing report (pmsecoaf) record
.
CLOS0000  PACK      SKEY31,PMEOHFND,PMEODFLG,PMEOTRID,SP70
.
.         We should only have one record with flag of Open or Closed
.
          MOVE      "1",PMEODFLG                 * set status to "Closed"
          PACK      KEY31,PMEOHFND,PMEODFLG,PMEOTRID,SP70
          CALL      RAPMECO1
          IF        OVRCD=1
            MOVE      SKEY31,KEY31
            CALL      RDPMECO1                    * reposition
            IF        OVRCD=0
              MOVE      "1",PMEODFLG              * set status to "Closed"
              CALL      UPPMECO1                  * update record
            ENDIF
          ELSE
            MOVE      "0",PMEODFLG                * set status to "Open"
            PACK      KEY31,PMEOHFND,PMEODFLG,PMEOTRID,SP70
            CALL      DEPMECO1
          ENDIF
.
.         Update the priectaf record
.
          MOVE      TEN9,PRECFLAG                * set status to closed
          PACK      PRECSTAT,SP1,TWO             * set closed with payment
          CALL      UPPRECT2                     * update claim
.
.         Write a new history (priecaaf) record
.
          MOVE      PRECINVN,PREAINVN
          MOVE      PRECBATN,PREABATN
          MOVE      TEN9,PREASTAT
          MOVE      " 5",PREATYPE
          MOVE      WBSEUID,PREAOPER
          MOVE      PRECTRID,PREATRID
          MOVE      SP70,PREAEROR
          MOVE      SP70,PREAEROT
          MOVE      SP70,PREASPAR
.
CLOS5000  CALL      IBACLOCK                     * get current date/time
          PACK      PREADATE,CCC,CYY,CMM,CDD
          REP       " 0",PREADATE
          MOVE      CTIMEIS,PREATIME
          REP       " 0",PREATIME
.
          PACK      KEY26,PREAINVN,PREADATE,PREATIME,PREATYPE,SP70
          CALL      RAPRECA1
          IF        OVRCD = 1
            CALL      WRPRECA1
          ELSE
            GOTO      CLOS5000
          ENDIF
.
CLOS9999 RETURN
.
.------------------------------------------------------------
. Eclipse IHC Claim Enquiries tags
.------------------------------------------------------------
ECCL0000  BRANCH    FLDITMNO,ECCL0100,ECCL0200,ECCL0300,ECCL0400,ECCL0500:
                             ECCL0600,ECCL0700,ECCL0800,ECCL0900,ECCL1000:
                             ECCL1100,ECCL1200,ECCL1300,ECCL1400,ECCL1500:
                             ECCL1600,ECCL1700,ECCL1800,ECCL1900,ECCL2000:
                             ECCL2100,ECCL2200,ECCL2300,ECCL2400,ECCL2500:
                             ECCL2600,ECCL2700,ECCL2800
.
          GOTO      ECCL9999
.
ECCL0100  CALL      ECCT0000
          GOTO      ECCL9999
.
ECCL0200  WRITE     HTMLFILE;IBCNMHOS;    * Multihospital Indicator
          GOTO      ECCL9999
.
ECCL0300  CALL      HOSPID00              * Hospital ID option field
          GOTO      ECCL9999
.
ECCL0400  CALL      SELHFN00              * Health Fund option field
          GOTO      ECCL9999
.
ECCL0500  WRITE     HTMLFILE;HLFDCLTY;
          GOTO      ECCL9999
.
ECCL0600  MOVE      CATCL,CATEGORY
          MOVE      HLTHFUND,CODE
          CALL      CODITM00
          GOTO      ECCL9999
.
ECCL0700  WRITE     HTMLFILE;EXCLWAIT;
          GOTO      ECCL9999
.
ECCL0800  WRITE     HTMLFILE;FILTURNO;
          GOTO      ECCL9999
.
ECCL0900  WRITE     HTMLFILE;FILTADMN;
          GOTO      ECCL9999
.
ECCL1000  WRITE     HTMLFILE;BATCHNUM;
          GOTO      ECCL9999
.
ECCL1100  WRITE     HTMLFILE;CLAIMSTA;
          GOTO      ECCL9999
.
ECCL1200  WRITE     HTMLFILE;INVNUMBR;
          GOTO      ECCL9999
.
ECCL1300  CALL      SELP0000
          GOTO      ECCL9999
.
ECCL1400  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      ECCL9999
.
ECCL1500  WRITE     HTMLFILE;EXDTBLNK;
          GOTO      ECCL9999
.
ECCL1600  WRITE     HTMLFILE;HLTHFUND;
          GOTO      ECCL9999
.
ECCL1700  CALL      PRVE0000
          GOTO      ECCL9999
.
ECCL1800  CALL      NXTE0000
          GOTO      ECCL9999
.
ECCL1900  CALL      BATTB000
          GOTO      ECCL9999
.
ECCL2000  CALL      PREVBT00
          GOTO      ECCL9999
.
ECCL2100  CALL      NEXTBT00
          GOTO      ECCL9999
.
ECCL2200  CALL      ECOT0000
          GOTO      ECCL9999
.
ECCL2300  WRITE     HTMLFILE;PROCSTAT;
          GOTO      ECCL9999
.
ECCL2400  CALL      ECCP0000
          GOTO      ECCL9999
.
ECCL2500  WRITE     HTMLFILE;EXCLCLOS;
          GOTO      ECCL9999
.
ECCL2600  CALL      NEXT0000
          GOTO      ECCL9999
.
ECCL2700  CALL      PREV0000
          GOTO      ECCL9999
.
ECCL2800  CALL      SELV0000
          GOTO      ECCL9999
.
ECCL9999  RETURN
+
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries
.------------------------------------------------------------
ECCT0000  MATCH     "1",PTCNUIMC
          GOTO      ECCT9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      ECCT9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      ECCT9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSPRIBH2
ECCT0500  CALL      RKPRIBH2
          BRANCH    OVRCD,ECCT2000
          MATCH     PRIBDTBC,LASTDATE
          GOTO      ECCT2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,PRIBBTHN,SP70
          CALL      RSPRECT3
ECCT1000  CALL      RKPRECT3
          BRANCH    OVRCD,ECCT0500
          MATCH     PRIBBTHN,PRECBATN
          GOTO      ECCT0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,PRECHOSP
              GOTO      ECCT1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,PRECHOSP
                GOTO      ECCT1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     "1",HLFDCLTY
            IF        @EQUAL
              MATCH     "0",PRECEETP
              IF        !@EQUAL
                MATCH     "1",PRECEETP
                GOTO      ECCT1000 IF NOT EQUAL
              ENDIF
            ELSE
              MATCH     HLFDCLTY,PRECEETP
              GOTO      ECCT1000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,PRECHFND
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   TEN9,PRECFLAG
            GOTO      ECCT1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        PRECFLAG=ZERO
.             GOTO      ECCT1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,PRECURNO
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,PRECUNIQ
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,PRECBATN
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DPRECFLG
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,PRECINVN
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,ECCT1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      ECCT1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      ECCT1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY34,PRECINVN,Z70
          CALL      RSPRECA3
          CALL      RPPRECA3
          IF        OVRCD=0
            MATCH     PRECINVN,PREAINVN
            IF        @EQUAL
              MATCH     " 5",PREATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,PRECFLAG,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19

.
          CALL      RSBI0000
.
          CALL      GBAL0000
.
          MOVE      PRECURNO,URNUMBER
.         MOVE      PRECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,PRECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,PRECUNIQ,PRECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECCT1500
.
          MATCH     PRECUNIQ,DPRDTUNQ
          GOTO      ECCT1500 IF NOT EQUAL
.
          MATCH     PRECINVN,PRDTINVN
          GOTO      ECCT1500 IF NOT EQUAL
.
          GOTO      ECCT1600
.
ECCT1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECCT1600  REP       " +",PRECURNO
          REP       " +",PRECUNIQ
          REP       " +",PRECBATN
          REP       " +",PRECINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "2",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    PRECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    PRECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    PRECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    PRECINVN,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    PRECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",PRECURNO
          REP       "+ ",PRECUNIQ
          REP       "+ ",PRECBATN
          REP       "+ ",PRECINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",PRECBATN,"#",":
                             "#"",PRECUNIQ,"#",":
                             "#"",PRECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",PRECHFND,"#",";
.
          IF        PRECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",PRECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",PRECPBAT,"#",":
                             "#"",PRECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,PRECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,PRECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",PRECBATN,PRECINVN:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",PRECBATN,PRECINVN:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",PRECBATN,PRECINVN:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        PRECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",PRECBATN,PRECINVN:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      PRECBATN,DIM8
          REP       " +",PRECURNO
          REP       " +",PRECUNIQ
          REP       " +",PRECBATN
          REP       " +",PRECINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
             PRECBATN,"','",PRECUNIQ,"','",PRECURNO,"','",PRECINVN,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",PRECURNO
          REP       "+ ",PRECUNIQ
          REP       "+ ",PRECBATN
          REP       "+ ",PRECINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
 IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
            WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
                               " value='",PRECBATN,PRECINVN:
                               "' onclick=resetStatus(this);>":
                               "#");"
          ELSE
            WRITE     HTMLFILE;"#"#");"
          ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECCT1000
.
ECCT2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      ECCT9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSPRECT3
ECCT3000  CALL      RKPRECT3
          BRANCH    OVRCD,ECCT9000
          MATCH     SP70,PRECBATN
          GOTO      ECCT9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,PRECHOSP
              GOTO      ECCT3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,PRECHOSP
                GOTO      ECCT3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     "1",HLFDCLTY
            IF        @EQUAL
              MATCH     "0",PRECEETP
              IF        !@EQUAL
                MATCH     "1",PRECEETP
                GOTO      ECCT3000 IF NOT EQUAL
              ENDIF
            ELSE
              MATCH     HLFDCLTY,PRECEETP
              GOTO      ECCT3000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,PRECHFND
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
          IF        EXCLCLOS=ONE
            IF        PRECFLAG=TEN9
              GOTO      ECCT3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        PRECFLAG=ZERO
              GOTO      ECCT3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,PRECURNO
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,PRECUNIQ
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,PRECBATN
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DPRECFLG
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,PRECINVN
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,ECCT1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      ECCT1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      ECCT1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY34,PRECINVN,Z70
          CALL      RSPRECA3
          CALL      RPPRECA3
          IF        OVRCD=0
            MATCH     PRECINVN,PREAINVN
            IF        @EQUAL
              MATCH     " 5",PREATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,PRECFLAG,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19
.
          CALL      RSBI0000
.
          CALL      GBAL0000
.
          MOVE      PRECURNO,URNUMBER
.         MOVE      PRECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,PRECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,PRECUNIQ,PRECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECCT3500
.
          MATCH     PRECUNIQ,DPRDTUNQ
          GOTO      ECCT3500 IF NOT EQUAL
.
          MATCH     PRECINVN,PRDTINVN
          GOTO      ECCT3500 IF NOT EQUAL
.
          GOTO      ECCT3600
.
ECCT3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECCT3600  REP       " +",PRECURNO
          REP       " +",PRECUNIQ
          REP       " +",PRECBATN
          REP       " +",PRECINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "2",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    PRECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    PRECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    PRECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    PRECINVN,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    PRECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",PRECURNO
          REP       "+ ",PRECUNIQ
          REP       "+ ",PRECBATN
          REP       "+ ",PRECINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",PRECBATN,"#",":
                             "#"",PRECUNIQ,"#",":
                             "#"",PRECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",PRECHFND,"#",";
.
          IF        PRECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",PRECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",PRECPBAT,"#",":
                             "#"",PRECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,PRECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,PRECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",PRECBATN,PRECINVN:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",PRECBATN,PRECINVN:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",PRECBATN,PRECINVN:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        PRECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",PRECBATN,PRECINVN:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      PRECBATN,DIM8
          REP       " +",PRECURNO
          REP       " +",PRECUNIQ
          REP       " +",PRECBATN
          REP       " +",PRECINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
             PRECBATN,"','",PRECUNIQ,"','",PRECURNO,"','",PRECINVN,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",PRECURNO
          REP       "+ ",PRECUNIQ
          REP       "+ ",PRECBATN
          REP       "+ ",PRECINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
 IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
            WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
                               " value='",PRECBATN,PRECINVN:
                               "' onclick=resetStatus(this);>":
                               "#");"
          ELSE
            WRITE     HTMLFILE;"#"#");"
          ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECCT3000
.
ECCT9000
ECCT9999  RETURN
+
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries
.------------------------------------------------------------
ECCP0000  MATCH     "1",PTCNUIMC
          GOTO      ECCP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.         MATCH     SP70,HOSPCODE
.         IF        @EQUAL
.           MOVE      WBSEHOSP,HOSPCODE
.         ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSPRECT5
ECCP1000  CALL      RKPRECT5
          BRANCH    OVRCD,ECCP9999
          MATCH     FILTURNO,PRECURNO
          GOTO      ECCP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,PRECHOSP
              GOTO      ECCP9999 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,PRECHOSP
                GOTO      ECCP9999 IF NOT EQUAL
              ENDIF
            ENDIF
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,PRECURNO
              GOTO      ECCP1000 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,PRECURNO
              GOTO      ECCP9999 IF NOT EQUAL
            ENDIF
.
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     "1",HLFDCLTY
            IF        @EQUAL
              MATCH     "0",PRECEETP
              IF        !@EQUAL
                MATCH     "1",PRECEETP
                GOTO      ECCP1000 IF NOT EQUAL
              ENDIF
            ELSE
              MATCH     HLFDCLTY,PRECEETP
              GOTO      ECCP1000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,PRECHFND
            GOTO      ECCP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        PRECFLAG=ZERO
              GOTO      ECCP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,PRECUNIQ
            GOTO      ECCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,PRECBATN
            GOTO      ECCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DPRECFLG
            GOTO      ECCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,PRECINVN
            GOTO      ECCP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,PRECBATN,SP70
            CALL      RDPRIBH1
            BRANCH    OVRCD,ECCP1000
.
            MATCH     FRSTDATE,PRIBDTBC
            GOTO      ECCP1000 IF LESS
.
            MATCH     PRIBDTBC,LASTDATE
            GOTO      ECCP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY34,PRECINVN,Z70
          CALL      RSPRECA3
          CALL      RPPRECA3
          IF        OVRCD=0
            MATCH     PRECINVN,PREAINVN
            IF        @EQUAL
              MATCH     " 5",PREATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,PRECFLAG,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19
.
          CALL      RSBI0000
.
          CALL      GBAL0000
.
          MOVE      PRECURNO,URNUMBER
.         MOVE      PRECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
. 
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,PRECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,PRECUNIQ,PRECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECCP1500
.
          MATCH     PRECUNIQ,DPRDTUNQ
          GOTO      ECCP1500 IF NOT EQUAL
.
          MATCH     PRECINVN,PRDTINVN
          GOTO      ECCP1500 IF NOT EQUAL
.
          GOTO      ECCP1600
.
ECCP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECCP1600  REP       " +",PRECURNO
          REP       " +",PRECUNIQ
          REP       " +",PRECBATN
          REP       " +",PRECINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "2",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    PRECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    PRECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    PRECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    PRECINVN,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    PRECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",PRECURNO
          REP       "+ ",PRECUNIQ
          REP       "+ ",PRECBATN
          REP       "+ ",PRECINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",PRECBATN,"#",":
                             "#"",PRECUNIQ,"#",":
                             "#"",PRECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",PRECHFND,"#",";
.
          IF        PRECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",PRECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",PRECPBAT,"#",":
                             "#"",PRECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,PRECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,PRECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",PRECBATN,PRECINVN:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",PRECBATN,PRECINVN:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",PRECBATN,PRECINVN:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        PRECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",PRECBATN,PRECINVN:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      PRECBATN,DIM8
          REP       " +",PRECURNO
          REP       " +",PRECUNIQ
          REP       " +",PRECBATN
          REP       " +",PRECINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
             PRECBATN,"','",PRECUNIQ,"','",PRECURNO,"','",PRECINVN,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",PRECURNO
          REP       "+ ",PRECUNIQ
          REP       "+ ",PRECBATN
          REP       "+ ",PRECINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
 IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
            WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
                               " value='",PRECBATN,PRECINVN:
                               "' onclick=resetStatus(this);>":
                               "#");"
          ELSE
            WRITE     HTMLFILE;"#"#");"
          ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECCP1000
.
ECCP9999  RETURN
+
.------------------------------------------------------------
. Hospital ID
.------------------------------------------------------------
HOSPID00  PACK      KEY3,SP10
          CALL      RSPTHSP1
HOSPID10  CALL      RKPTHSP1
          BRANCH    OVRCD,HOSPID90
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          BRANCH    IBCNMHOS,HOSPID20
          WRITE     HTMLFILE;"<option value=",KEY5,">":
                             PTHSNAME,"</option>"
          GOTO      HOSPID10
.
.         Mult-Hospital
.
HOSPID20  BRANCH    ALLHFLAG,HOSPID30            * don't default to user's hosp
          MATCH     SP70,HOSPCODE                                      *C-125462
          IF        @EQUAL
            MOVE      WBSEHOSP,HOSPCODE          * default to user's Hosp code
          ENDIF
HOSPID30  MATCH     HOSPCODE,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               PTHSNAME,"</option>"
          ENDIF
          GOTO      HOSPID10
.
HOSPID90
HOSPID99  RETURN
+
.------------------------------------------------------------
. Health fund Selection
.------------------------------------------------------------
SELHFN00  PACK      KEY14,SP70
          CALL      RDSFUND1
SELHFN10  CALL      RDKFUND1
          BRANCH    OVRCD,SELHFN99
.
          MATCH     SP8,HFTABL           * Check health fund table
          GOTO      SELHFN10 IF EQUAL
.
          MATCH     "0000    ",HFTABL
          GOTO      SELHFN10 IF NOT EQUAL
.
          BRANCH    PHFTACT,SELHFN10     * ignore inactive HF
.
          PACK      KEY8,QUOTE,HCODE,QUOTE
          MATCH     HLTHFUND,HCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                               HFNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY8,">":
                               HFNAME,"</option>"
          ENDIF
          GOTO      SELHFN10
.
SELHFN99  RETURN
+
.------------------------------------------------------------
. Selects Day, Week or Month from Viewtype
.------------------------------------------------------------
SELP0000  MATCH     "1",VIEWTYPE
          GOTO      SELP2000 IF EQUAL
          MATCH     "2",VIEWTYPE
          GOTO      SELP4000 IF EQUAL
.
.Defaults to Daily Viewtype
.--------------------------
.
          WRITE     HTMLFILE;"<select name=lastdate class=DaySelect":
                             " onchange='exdtblankchange();FilterSubmit();'>";
          UNPACK    FRSTDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      "8",ADJDAYS
          CALL      ADJDAT00
          PACK      ENDDATE,CCENT,CYEAR,CMON,CDAY
.
          MOVE      "-7",ADJDAYS
          UNPACK    FRSTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      ADJDAT00
          PACK      STRTDATE,CCENT,CYEAR,CMON,CDAY
.
          IF        EXDTBLNK=1
            WRITE     HTMLFILE;"<option value='",SP8,"' selected>":
                               "</option>";
          ELSE
            WRITE     HTMLFILE;"<option value='",SP8,"'>":
                               "</option>";
          ENDIF
.
SELP1000  UNPACK    STRTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      DAYOFWEK
          LOAD      DAYNAM3,WEEKDAY,MON,TUE,WED,THU,FRI,SAT,SUN
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          IF        EXDTBLNK=1
              WRITE     HTMLFILE;"<option value=",STRTDATE,">":
                                 DAYNAM3,SP1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                                 "</option>";
          ELSE
            MATCH     STRTDATE,FRSTDATE
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",STRTDATE," selected>":
                                 DAYNAM3,SP1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                                 "</option>";
            ELSE
              WRITE     HTMLFILE;"<option value=",STRTDATE,">":
                                 DAYNAM3,SP1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                                 "</option>";
            ENDIF
          ENDIF
.
          MOVE      "1",ADJDAYS
          CALL      ADJDAT00
          PACK      STRTDATE,CCENT,CYEAR,CMON,CDAY
          MATCH     ENDDATE,STRTDATE
          GOTO      SELP1000 IF NOT EQUAL
          GOTO      SELP9000
.
.Select Weekly Viewtype
.--------------------------
SELP2000  WRITE     HTMLFILE;"<select name=lastdate class=WeekSelect":
                             " onchange='exdtblankchange();FilterSubmit();'>";
          UNPACK    FRSTDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      "42",ADJDAYS
          CALL      ADJDAT00
          PACK      ENDDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ENDDATE
.
          UNPACK    FRSTDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      "-42",ADJDAYS
          CALL      ADJDAT00
          PACK      STRTDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRTDATE
          REP       " 0",FRSTDATE
.
          IF        EXDTBLNK=1
            WRITE     HTMLFILE;"<option value='",SP8,"' selected>":
                               "</option>";
          ELSE
            WRITE     HTMLFILE;"<option value='",SP8,"'>":
                               "</option>";
          ENDIF
.
SELP3000  UNPACK    STRTDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          IF        EXDTBLNK=1
            WRITE     HTMLFILE;"<option value=",STRTDATE,">Week of ":
                               CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>";
          ELSE
            MATCH     STRTDATE,FRSTDATE
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",STRTDATE," selected>Week of ":
                                 CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>";
            ELSE
              WRITE     HTMLFILE;"<option value=",STRTDATE,">Week of ":
                                 CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>";
            ENDIF
          ENDIF
.
          MOVE      "7",ADJDAYS
          CALL      ADJDAT00
          PACK      STRTDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRTDATE
          MATCH     ENDDATE,STRTDATE
          GOTO      SELP3000 IF NOT EQUAL
          GOTO      SELP9000
.
.
.Select Monthly Viewtype
.------------------------
.
SELP4000  WRITE     HTMLFILE;"<select name=vyearmth class=MonthSelect":
                             " onchange='exdtblankchange();FilterSubmit();'>";
          UNPACK    FRSTDATE,KEY4,CMON,CDAY
          MOVE      KEY4,F4
          MOVE      CMON,F2
          MOVE      CMON,ENDMTH
          ADD       SIX,ENDMTH
          IF        ENDMTH>12
            SUB       "12",ENDMTH
          ENDIF
          SUB       SIX,F2
          IF        F2<0
            SUB       ONE,F4
            ADD       "12",F2
          ENDIF
.
          IF        EXDTBLNK=1
            WRITE     HTMLFILE;"<option value='",SP6,"' selected>":
                               "</option>";
          ELSE
            WRITE     HTMLFILE;"<option value='",SP6,"'>":
                               "</option>";
          ENDIF
.
SELP5000  LOAD      MTHNAM,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY6,F4,F2
          REP       " 0",KEY6
.
          IF        EXDTBLNK=1
            WRITE     HTMLFILE;"<option value=",KEY6,">":
                               MTHNAM,SP1,F4,"</option>";
          ELSE
            MATCH     KEY6,FRSTDATE
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY6," selected>":
                                 MTHNAM,SP1,F4,"</option>";
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY6,">":
                                 MTHNAM,SP1,F4,"</option>";
            ENDIF
          ENDIF
.
          ADD       ONE,F2
          IF        F2>12
            ADD      ONE,F4
            SUB      "12",F2
          ENDIF
          COMPARE   ENDMTH,F2
          GOTO      SELP5000 IF NOT EQUAL
.
SELP9000  WRITE     HTMLFILE;"</select>"
          RETURN
.******************************************************************************
.------------------------------------------------------------
. Next Day, Week, Month
.------------------------------------------------------------
NXTE0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          REP       " +",HLTHFUND
          REP       " +",HLFDCLTY
          REP       " +",BATCHNUM
          REP       " +",INVNUMBR
          REP       " +",CLAIMSTA
          REP       " +",HOSPCODE
          REP       " +",URNUMBER
          REP       " +",UNIQNUMB
.
          WRITE     HTMLFILE;"eclweb01.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&viewtype=",VIEWTYPE:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&allhflag=",ALLHFLAG:
                             "&hlthfund=",HLTHFUND:
                             "&exclwait=",EXCLWAIT:
                             "&exdtblnk=",EXDTBLNK:
                             "&hlfdclty=",HLFDCLTY:
                             "&batchnum=",BATCHNUM:
                             "&invnumbr=",INVNUMBR:
                             "&claimsta=",CLAIMSTA:
                             "&hospcode=",HOSPCODE:
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&exclclos=",EXCLCLOS;
.
          REP       "+ ",HLTHFUND
          REP       "+ ",HLFDCLTY
          REP       "+ ",BATCHNUM
          REP       "+ ",INVNUMBR
          REP       "+ ",CLAIMSTA
          REP       "+ ",HOSPCODE
          REP       "+ ",URNUMBER
          REP       "+ ",UNIQNUMB
.
NXTE9999  RETURN
.
.--------------------------------------------------------
.
PRVE0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          REP       " +",HLTHFUND
          REP       " +",HLFDCLTY
          REP       " +",BATCHNUM
          REP       " +",INVNUMBR
          REP       " +",CLAIMSTA
          REP       " +",HOSPCODE
          REP       " +",URNUMBER
          REP       " +",UNIQNUMB
.
          WRITE     HTMLFILE;"eclweb01.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&viewtype=",VIEWTYPE:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&allhflag=",ALLHFLAG:
                             "&hlthfund=",HLTHFUND:
                             "&exclwait=",EXCLWAIT:
                             "&exdtblnk=",EXDTBLNK:
                             "&hlfdclty=",HLFDCLTY:
                             "&batchnum=",BATCHNUM:
                             "&invnumbr=",INVNUMBR:
                             "&claimsta=",CLAIMSTA:
                             "&hospcode=",HOSPCODE:
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&exclclos=",EXCLCLOS;
.
          REP       "+ ",HLTHFUND
          REP       "+ ",HLFDCLTY
          REP       "+ ",BATCHNUM
          REP       "+ ",INVNUMBR
          REP       "+ ",CLAIMSTA
          REP       "+ ",HOSPCODE
          REP       "+ ",URNUMBER
          REP       "+ ",UNIQNUMB
.
PRVE9999  RETURN
+
.------------------------------------------------------------
. Table of Batch Numbers
.------------------------------------------------------------
BATTB000  MATCH     "1",PTCNUIMC
          GOTO      BATTB999 IF NOT EQUAL
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BATHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70
          CALL      RSPRIBH1                     * position in file
BATTB100  CALL      RPPRIBH1                     * read previous record
          BRANCH    OVRCD,BATTB999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BATTB100
          ENDIF
.
          CALL      BATRW000      * Display Row
          BRANCH    EXIT,BATTB100
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BATTB100 IF NOT EQUAL
.
BATTB999  RETURN
+
.------------------------------------------------------------
. Batch Numbers by Code (TABLE HEADING)
.------------------------------------------------------------
BATHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Batch Number</td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=25%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Health Fund</td>":
                             "<td class=HeadingCell width=15%>":
                             "Date</td>":
                             "<td class=HeadingCell width=15%>":
                             "Time</td>":
.                            "<td class=HeadingCell width=15%>":
.                            "Status</td>":
                             "</tr>"
.
BATHD999  RETURN
.------------------------------------------------------------
. Batch Numbers (TABLE ROW)
.------------------------------------------------------------
BATRW000  MOVE      ZERO,EXIT
          PACK      BTSCHOSP,BTSCHOSP,SP70
.
          UNPACK    PRIBDTBC,CCENT,CYEAR,CMON,CDAY  * Batch Created Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    PRIBTMBC,DIM5,ANS,ANS,ANS
.
          MOVE      SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      BATRW500 IF NOT EQUAL
.
          PACK      KEY24,PRIBBTHN,SP30         * get Hospital for given Batch
          CALL      RSPRECT3
          CALL      RKPRECT3
          IF        OVRCD=1
            MOVE      ONE,EXIT
            GOTO      BATRW999
          ENDIF
.
          MATCH     PRIBBTHN,PRECBATN
          IF        @EQUAL
            MOVE      PRECHOSP,KEY3
            CALL      RDPTHSP1            * read Hospital name for visit
            IF        OVRCD=1
              MOVE      PRECHOSP,HOSPNAME
            ELSE
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
.
            MATCH     SP70,BTSCHOSP
            IF        !@EQUAL&!@EOS
              MATCH     BTSCHOSP,PRECHOSP
              IF        !@EQUAL
                MOVE      ONE,EXIT
                GOTO      BATRW999
              ENDIF
            ENDIF
          ELSE
            MOVE      ONE,EXIT
            GOTO      BATRW999
          ENDIF
.
BATRW500  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",PRIBBTHN,"#")'>":
                             PRIBBTHN,"</a></td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",PRIBHFND,"&nbsp;</td>":
                             "<td>",KEY11,"</td>":
                             "<td>",DIM5,"</td>":
                             "</tr>";
.
BATRW999  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVBT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"eclweb01.pbl":
                             "?reportno=",F2:
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&btschosp=",BTSCHOSP;
.
PREVBT99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTBT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"eclweb01.pbl":
                             "?reportno=",F2:
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&btschosp=",BTSCHOSP;
.
NEXTBT99  RETURN
+
.*****************************************************************************
.*                          RSBI0000                                         *
.*****************************************************************************
RSBI0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,PRECNBAT                 * next batch blank ?
          GOTO      RSBI9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        PRECFLAG <> 19 & PRECFLAG <> 3
            GOTO      RSBI9000
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
          PACK      KEY8,PRECINVN,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,RSBI9000
.
          CALL      GBAL0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSBI9000
          ENDIF
.
          PACK      KEY16,PRECINVN,SP70
          CALL      RAPRECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBI9000
          ENDIF
.
          GOTO      RSBI9999
.
RSBI9000  MOVE      ONE,RSUBINDI
RSBI9999  RETURN
.
.*******************************************************************************
.                         Goes back 1 page
.*******************************************************************************
RELOAD00  CALL      OPENHTML
          BRANCH    EXIT,RELOAD99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                            "    alert(#"",WEBTITLE,"#");":
                             "    history.go(-1);":
.                            "    location.reload();":
                             "}":
                             "</script>"
          CALL      CLOSHTML
RELOAD99  RETURN
.
.--------------------------------------------------------------------------
. Remote Scripting
.               1. Validate IMC Batch Number
.--------------------------------------------------------------------------
REMOTE00  BRANCH    VALDTYPE,REMOTE01,REMOTE02,REMOTE03,REMOTE04
          GOTO      REMOTE90
.
REMOTE01  CALL      VALBAT00     * Validate Batch Number IMC
          GOTO      REMOTE99
.
REMOTE02  CALL      VALUNQ00     * Validate Batch Number IMC
          GOTO      REMOTE99
.
REMOTE03  CALL      VALBAS00     * Validate Batch Number STF
          GOTO      REMOTE99
.
REMOTE04  CALL      VALUNS00     * Validate Batch Number STF
          GOTO      REMOTE99
.
REMOTE90  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTE99
.
REMOTE99  RETURN
+
.------------------------------------------------------------
. Validate Batch Number
. INPUTS: BATCHNUM - Batch Number
.------------------------------------------------------------
VALBAT00  CALL      XMLHED00
          BRANCH    EXIT,VALBAT99
.
          MATCH     "1",PTCNUIMC
          GOTO      VALBAT91 IF NOT EQUAL
.
          PACK      KEY24,BATCHNUM,SP70
          CALL      RSPRECT3
          CALL      RKPRECT3
          BRANCH    OVRCD,VALBAT90
.
          MATCH     PRECBATN,BATCHNUM
          GOTO      VALBAT90 IF NOT EQUAL
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALBAT98
.
VALBAT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Batch number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAT98
.
VALBAT91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Not using Eclipse IMC Module. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAT98
.
VALBAT98  CALL      XMLEND00
VALBAT99  RETURN
+
.------------------------------------------------------------
. Validate Unique Number
. INPUTS: UNIQNUMB - Batch Number
.------------------------------------------------------------
VALUNQ00  CALL      XMLHED00
          BRANCH    EXIT,VALUNQ99
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,VALUNQ90
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALUNQ98
.
VALUNQ90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Unique number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALUNQ98
.
VALUNQ98  CALL      XMLEND00
VALUNQ99  RETURN
+
.------------------------------------------------------------
. Table of Outstanding Assessment Reports
.------------------------------------------------------------
ECOT0000  MATCH     "1",PTCNUIMC
          GOTO      ECOT9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          MATCH     FRSTDATE,SP70
          GOTO      ECOT9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      ECOT9999 IF EQUAL
.
          MATCH     SP70,PROCSTAT
          IF        @EQUAL
            MOVE      "0",PROCSTAT
          ENDIF 
.
          PACK      KEY39,FRSTDATE,PROCSTAT,SP70
          CALL      RSPMECO2                     * position in file
ECOT1000  CALL      RKPMECO2                     * read next record
          BRANCH    OVRCD,ECOT9999               * end of file
.
          MATCH     PMEOCDAT,LASTDATE
          GOTO      ECOT9999 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          RJUSTIFY  PMEOINVN
          RJUSTIFY  PMEOBATN
          MOVE      SP70,FORMATNM
          MOVE      SP70,KEY3
          MOVE      SP70,URNUMBER
          MOVE      SP70,UNIQNUMB
          PACK      KEY16,PMEOINVN,PMEOBATN,SP70
          CALL      RDPRECT2
          IF        OVRCD=0
            MOVE      PRECURNO,URNUMBER
            MOVE      PRECUNIQ,UNIQNUMB
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            IF        OVRCD=ONE
              CALL      CLPATMAS
            ENDIF
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDPMPX21
            IF        OVRCD=ONE
              CALL      CLPMSPX2
            ENDIF
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE                   * CALCAGE uses PBDATE
.
            CALL      PATLN000
            CALL      PATFLD00
          ELSE
            GOTO      ECOT1000
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     "1",HLFDCLTY
            IF        @EQUAL
              MATCH     "0",PMEOCTYP
              IF        !@EQUAL
                MATCH     "1",PMEOCTYP
                GOTO      ECOT1000 IF NOT EQUAL
              ENDIF
            ELSE
              MATCH     HLFDCLTY,PMEOCTYP
              GOTO      ECOT1000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,PMEOHFND
            GOTO      ECOT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PROCSTAT
          IF        !@EQUAL & !@EOS
            MATCH     PROCSTAT,PMEODFLG
            GOTO      ECOT1000 IF NOT EQUAL
          ENDIF
.
          CALL      ECOTRW00
.
          GOTO      ECOT1000
.
ECOT9999  RETURN
.------------------------------------------------------------
. Table of Outstanding Assessment Reports (Detail Row)
.------------------------------------------------------------
ECOTRW00  REP       " +",URNUMBER
          REP       " +",UNIQNUMB
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    URNUMBER,PATLINK
          APPEND    "&uniqnumb=",PATLINK
          APPEND    UNIQNUMB,PATLINK
          RESET     PATLINK
.
          REP       "+ ",URNUMBER
          REP       "+ ",UNIQNUMB
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          WRITE     HTMLFILE;"t.addRow(#"",PMEOHFND,"#",":
                             "#"",UNIQNUMB,"#",":
                             "#"",URNUMBER,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",PMEOINVN,"#",";
.
          MATCH     "1",PMEODFLG
          IF        @EQUAL
            WRITE     HTMLFILE;"#"<font color=red>closed</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"<input type=checkbox name=otp",DRECCNT:
                               " value='",PMEOHFND,PMEODFLG,PMEOTRID:
                               "' onclick=outprocr(this);>":
                               "#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",PATLINK,"#",";
          WRITE     HTMLFILE;"#"",PMEOTRID,"#",";
          WRITE     HTMLFILE;"#"",KEY3,"#");";
.
ECOTRW99  RETURN
+
.------------------------------------------------------------
. Table of IMC Assessment Report
.------------------------------------------------------------
EDIP0000  MATCH     "1",PTCNUIMC
          GOTO      EDIP9999 IF NOT EQUAL
.
          CALL      EDIPHD00      * Output Table Heading
.
          PACK      KEY56,PRECTRID,Z70
          CALL      RSPREAH2
EDIP1000  CALL      RPPREAH2
          BRANCH    OVRCD,EDIP9999
.
          MATCH     PRECTRID,PRAHFTID
          GOTO      EDIP9999 IF NOT EQUAL
.
          CALL      EDIPRW00
.
          GOTO      EDIP1000
.
EDIP9999  RETURN
.------------------------------------------------------------
. EDI Assessment Report (TABLE HEADING)
.------------------------------------------------------------
EDIPHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Status&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Current First Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Current Medicare Num&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Current Reference Num&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Flag Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Status Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Family Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "First Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Num&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Reference Num&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Process Status Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanations&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Details&nbsp;</td>":
                             "</tr>"
.
EDIPHD99  RETURN
.
.------------------------------------------------------------
. EDI Assessment Report (Detail Row)
.------------------------------------------------------------
EDIPRW00  MOVE      ZERO,FORM1
          MOVE      "Unknown",ASESDESC
          MOVE      PRAHCFAC,ANS
          REP       "A1R2W3C4",ANS
          MOVE      ANS,FORM1
          LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4
.
          MOVE      ZERO,FORM1
          MOVE      "No Change",MEDSDESC
          MOVE      PRAHMCFC,ANS
          REP       "A1I2C3W4S5X6",ANS
          MOVE      ANS,FORM1
          LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
                                   MEDSDES5,MEDSDES6
.
          MOVE      ZERO,FORM2
          MOVE      "UNKNOWN",PRCSDESC 
          MOVE      PRAHSTAT,FORM2 
          LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
                                   PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
                                   PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
                                   PRCSDE10,PRCSDE11
.
          WRITE     HTMLFILE;"<tr><td valign=top>",PRAHFSCD,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",ASESDESC,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PRAHCLID,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PRAHCPFN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PRAHCPMN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PRAHCPRN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",MEDSDESC,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PRAHMSCD,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PRAHPSNM,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PRAHPFNM,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PRAHPMCN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PRAHPRFN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PRCSDESC,"</td>";
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb01.pbl":
                             "?reportno=02":
                             "&template=004":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:                             
                             "&prhre003=",PRHRE003:
                             "&ecclfbid=",PRAHFBID:
                             "&ecclarid=",PRAHARID:
                             "&ecclclid=",PRAHCLID:
                             "&ecclrptc=",PRAHRPTC,"#";'>":
                             "</td>";
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb01.pbl":
                             "?reportno=02":
                             "&template=005":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclfbid=",PRAHFBID:
                             "&ecclarid=",PRAHARID:
                             "&ecclclid=",PRAHCLID:
                             "&ecclrptc=",PRAHRPTC,"#";'>":
                             "</td>":
                             "</tr>";
.
EDIPRW99  RETURN
.
.------------------------------------------------------------
. Table of EDI Claim Explanation
.------------------------------------------------------------
EDCE0000  MATCH     "1",PTCNUIMC
          GOTO      EDCE9999 IF NOT EQUAL
.
          CALL      EDCEHD00      * Output Table Heading
.
          PACK      KEY39,ECCLFBID,ECCLARID,ECCLCLID,ECCLRPTC,SP70
          CALL      RSPREAD1                     * position in file
EDCE1000  CALL      RKPREAD1                     * read next record
          BRANCH    OVRCD,EDCE9999               * end of file
.
          MATCH     ECCLFBID,PREDFBID            * same fund brand id ?
          GOTO      EDCE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,PREDARID            * same account ref. id ?
          GOTO      EDCE9999 IF NOT EQUAL        * no - finished listing
.
          PACK      PREDCLID,PREDCLID,SP70
.
          MATCH     ECCLCLID,PREDCLID            * same fund ref. id ?
          GOTO      EDCE1000 IF NOT EQUAL        * no - finished listing
.
          PACK      PREDRPTC,PREDRPTC,SP70
.
          MATCH     ECCLRPTC,PREDRPTC            * same report counter ?
          GOTO      EDCE1000 IF NOT EQUAL        * no - finished listing
.
          CALL      EDCERW00
.
          GOTO      EDCE1000
.
EDCE9999  RETURN
.
.------------------------------------------------------------
. EDI Claim Explanation (TABLE HEADING)
.------------------------------------------------------------
EDCEHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Description&nbsp;</td>":
                             "</tr>"
.
EDCEHD99  RETURN
.------------------------------------------------------------
. EDI Assessment Report (Detail Row)
.------------------------------------------------------------
EDCERW00  WRITE     HTMLFILE;"<tr><td valign=top>",PREDCFEC,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",PREDCFET,"</td>":
                             "</tr>";
.
EDCERW99  RETURN
+
.------------------------------------------------------------
. Table of EDI Service Details
.------------------------------------------------------------
EDSD0000  MATCH     "1",PTCNUIMC
          GOTO      EDSD9999 IF NOT EQUAL
.
          CALL      EDSDHD00      * Output Table Heading
.
          PACK      KEY40,ECCLFBID,ECCLARID,ECCLCLID,ECCLRPTC,SP70
          CALL      RSPRESH1                     * position in file
EDSD1000  CALL      RKPRESH1                     * read next record
          BRANCH    OVRCD,EDSD9999               * end of file
.
          MATCH     ECCLFBID,PRSHFBID            * same fund brand id ?
          GOTO      EDSD9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,PRSHARID            * same account ref. id ?
          GOTO      EDSD9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLCLID,PRSHCLID            * same fund ref. id ?
          GOTO      EDSD9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLRPTC,PRSHRPTC            * same report counter ?
          GOTO      EDSD9999 IF NOT EQUAL        * no - finished listing
.
          CALL      EDSDRW00
.
          GOTO      EDSD1000
.
EDSD9999  RETURN
.------------------------------------------------------------
. EDI Service Details (TABLE HEADING)
.------------------------------------------------------------
EDSDHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Fund Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Date&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Explanation Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Schedule Fee&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Assessment Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation&nbsp;</td>":
                             "</tr>"
.
EDSDHD99  RETURN
.------------------------------------------------------------
. EDI Service Details (Detail Row)
.------------------------------------------------------------
EDSDRW00  WRITE     HTMLFILE;"<tr><td>",PRSHITMN,"</td>";
.
          MOVE      ZERO,FORM7P2C
          UNPACK    PRSHCAMT,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      ZERO,FORM7P2C
          UNPACK    PRSHFBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,PRSHSDTE
          IF        !@EQUAL & !@EOS
            UNPACK    PRSHSDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          MOVE      ZERO,FORM7P2C
          UNPACK    PRSHMBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          WRITE     HTMLFILE;"<td>",PRSHMEXC,"</td>";
.
          MOVE      ZERO,FORM7P2C
          UNPACK    PRSHSCHF,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      ZERO,FORM1
          MOVE      "Unknown",SFACDESC
          MOVE      PRSHSFAC,ANS
          REP       "A1R2W3",ANS
          MOVE      ANS,FORM1
          LOAD      SFACDESC,FORM1,SFACDES1,SFACDES2,SFACDES3
          WRITE     HTMLFILE;"<td>",SFACDESC,"</td>";
.
          WRITE     HTMLFILE;"<td>",PRSHSVID,"</td>";
.
          WRITE     HTMLFILE;"<td align=center>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb01.pbl":
                             "?reportno=02":
                             "&template=006":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclfbid=",PRSHFBID:
                             "&ecclarid=",PRSHARID:
                             "&ecclclid=",PRSHCLID:
                             "&ecclrptc=",PRSHRPTC:
                             "&ecclitmn=",PRSHITMN:
                             "&ecclsrvc=",PRSHSRVC,"#";'>":
                             "</td>":
                             "</tr>";
.
EDSDRW99  RETURN
+
.------------------------------------------------------------
. Table of EDI Services Explanations
.------------------------------------------------------------
EDSE0000  CALL      EDSEHD00      * Output Table Heading
.
          PACK      KEY47,ECCLFBID,ECCLARID,ECCLCLID,ECCLRPTC,ECCLITMN,ECCLSRVC:
                          SP70
          CALL      RSPRESD1                     * position in file
EDSE1000  CALL      RKPRESD1                     * read next record
          BRANCH    OVRCD,EDSE9999               * end of file
.
          MATCH     ECCLFBID,PRSDFBID            * same fund brand id ?
          GOTO      EDSE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,PRSDARID            * same account ref. id ?
          GOTO      EDSE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLCLID,PRSDCLID            * same fund ref. id ?
          GOTO      EDSE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLRPTC,PRSDRPTC            * same report counter ?
          GOTO      EDSE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLITMN,PRSDITMN            * same service code ?
          GOTO      EDSE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLSRVC,PRSDSRVC            * same service counter ?
          GOTO      EDSE9999 IF NOT EQUAL        * no - finished listing
.
          CALL      EDSERW00
.
          GOTO      EDSE1000
.
EDSE9999  RETURN
.------------------------------------------------------------
. EDI Service Explanation (TABLE HEADING)
.------------------------------------------------------------
EDSEHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Description&nbsp;</td>":
                             "</tr>"
.
EDSEHD99  RETURN
.------------------------------------------------------------
. EDI Services Explanations (Detail Row)
.------------------------------------------------------------
EDSERW00  WRITE     HTMLFILE;"<tr><td>",PRSDITMN,"</td>";
          WRITE     HTMLFILE;"<td>",PRSDSFEC,"</td>";
          WRITE     HTMLFILE;"<td>",PRSDSFET,"</td>":
                             "</tr>";
.
EDSERW99  RETURN
+
.------------------------------------------------------------
. Eclipse Store and Forward Claim Full Details
.------------------------------------------------------------
ESTF0000  MATCH     "1",PTCNUESF
          GOTO      ESTF9500 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      ESTF5000 IF EQUAL
.
          MATCH     ANSC,UPDATTYP
          GOTO      ESTF6000 IF EQUAL
.
          GOTO      ESTF9000
.
ESTF5000  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,ESTF9100
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,ESTF9100
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          CALL      PATFLD00                * Use standard Patient Folder sub
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDEMECT2
          BRANCH    OVRCD,ESTF9200
.
          MATCH     "1",MAVMODUL
          IF        @EQUAL
.
            CALL      DFUE0000
.
            PACK      KEY8,MAVINVCE,SP70
            CALL      RDINV1 
            BRANCH    OVRCD,ESTF9400 
.
            PACK      KEY8,PINVADM,SP70
            CALL      RDEMVIS1                    
            BRANCH    OVRCD,ESTF9700
.
            GOTO      ESTF5500
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL 
            CALL      DFUE0000
.
            PACK      KEY8,UNIQNUMB,SP70
            CALL      RDPRHD2
            BRANCH    OVRCD,ESTF9300
.
            PACK      KEY27,PRHDUNIQ,PRHRE001,PRHRE002,PRHRE003,SP70
            CALL      RDPRHR1
            BRANCH    OVRCD,ESTF9300
.
            PACK      KEY8,MAVINVCE,SP70
            CALL      RDPRIN1
            BRANCH    OVRCD,ESTF9400
.            
            GOTO      ESTF5500 
          ENDIF
.
          GOTO      ESTF9600     
.
ESTF5500  CLEAR     WEBTITLE
          MOVE      "Eclipse Claim Full Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,ESTF9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      ESTF9999
.
ESTF6000  PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDEMECT2
          BRANCH    OVRCD,ESTF9200
.
          MOVE      FIVE,EMECFLAG
          CALL      UPEMECT2
.
.         Write a new history (emrecaaf) record
.
          MOVE      EMECINVN,EMEAINVN
          MOVE      EMECBATN,EMEABATN
          MOVE      FIVE,EMEASTAT
          MOVE      " 1",EMEATYPE
          MOVE      WBSEUID,EMEAOPER
          MOVE      EMECTRID,EMEATRID
          MOVE      SP70,EMEAEROR
          MOVE      SP70,EMEAEROT
          MOVE      SP70,EMEASPAR
          MOVE      EMECMODL,EMEAMODL
.
          CALL      IBACLOCK                     * get current date/time
          PACK      EMEADATE,CCC,CYY,CMM,CDD
          REP       " 0",EMEADATE
          MOVE      CTIMEIS,EMEATIME
          REP       " 0",EMEATIME
.
          PACK      KEY27,EMEAINVN,EMEADATE,EMEATIME,EMEATYPE,EMEAMODL,SP70
          CALL      RAEMECA1
          IF        OVRCD = 1
            CALL      WREMECA1
          ENDIF
.
.         MOVE      SP70,TTYPEARG
.         MOVE      " 9",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      "10",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      " 4",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      " 5",TTYPEARG
.         CALL      DELETR00
.
.         CALL      DELECO00
.
          MOVE      ZERO,EXIT
          GOTO      ESTF9999
.
ESTF9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ESTF9999
.
ESTF9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ESTF9999
.
ESTF9200  MOVE      "Can't find Eclipse Store and Forward Claim details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ESTF9999
.
ESTF9300  MOVE      "Doctor Referral details has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ESTF9999
.
ESTF9400  MOVE      "Can't Find Invoice Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ESTF9999
.
ESTF9500  MOVE      "Not using Eclipse Store and Forward Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ESTF9999
.
ESTF9600  MOVE      "Invalid Store and Forward webPAS Module",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ESTF9999
.
ESTF9700  MOVE      "Emergency Visit has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ESTF9999
.
ESTF9999  RETURN
+
.--------------------------------------------------------------------
. Eclipse Bulk Billing Claim Full Details                  *T0859743
.--------------------------------------------------------------------
ECBB0000  MATCH     "1",PTCNUEBB
          GOTO      ECBB9500 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      ECBB5000 IF EQUAL
.
          MATCH     ANSC,UPDATTYP           * Close Eclipse claim
          GOTO      ECBB6000 IF EQUAL
.
          GOTO      ECBB9000
.
ECBB5000  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,ECBB9100
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,ECBB9100
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          CALL      PATFLD00                * Use standard Patient Folder sub
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDOTECT2            * Get transaction details - outectaf
          BRANCH    OVRCD,ECBB9200
.
          CALL      CLOUTERH
          IF        OTECFLAG > 5
            CALL      EBBP0000          * Get payment details - outerhaf
          ENDIF
.
.-------- Emergency Module
          MATCH     "1",MAVMODUL                 
          GOTO      ECBB5200 IF NOT EQUAL
.
          CALL      DBBE0000            * Get OS Invoice balance from patinvrf
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDINV1 
          BRANCH    OVRCD,ECBB9400 
.
          PACK      KEY8,PINVADM,SP70
          CALL      RDEMVIS1                    
          BRANCH    OVRCD,ECBB9700
.
          GOTO      ECBB5500
.
.-------- Private Practice Module
ECBB5200  MATCH     "2",MAVMODUL                 
          GOTO      ECBB5300 IF NOT EQUAL
.
          CALL      DBBP0000            * Get OS Invoice balance from priinvof
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,ECBB9300
.
          PACK      KEY27,PRHDUNIQ,PRHRE001,PRHRE002,PRHRE003,SP70
          CALL      RDPRHR1
          BRANCH    OVRCD,ECBB9300
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,ECBB9400
.            
          GOTO      ECBB5500 
.
.-------- Outpatient Module
ECBB5300  MATCH     "3",MAVMODUL                 
          GOTO      ECBB9600 IF NOT EQUAL
.
          CALL      DBBE0000            * Get OS Invoice balance from patinvrf
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDINV1
          BRANCH    OVRCD,ECBB9400
.
          PACK      KEY8,PINVADM,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,ECBB9800
.
          COMPARE   TWO,PVITYPE         * Outpatient visit type
          GOTO      ECBB9800 IF NOT EQUAL
.
          MOVE      "out",OSTFILE
          MOVE      PVISITE,KEY6
          CALL      RDSITA1             * Get the file header for this site
.
          PACK      CFNAME WITH OSTFILE,FILBB1A1
          CALL      OPOTBB11
.
          MOVE      PVIBILL,KEY8
          CALL      RDBOKB1             * Get outbb1af.obacomp - claim code
          BRANCH    OVRCD,ECBB9810
          
          GOTO      ECBB5500
.
ECBB5500  CLEAR     WEBTITLE
          MOVE      "Eclipse Claim Full Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,ECBB9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB6000  PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDOTECT2
          BRANCH    OVRCD,ECBB9200
.
          MOVE      SEVEN,OTECFLAG             * Eclipse status = closed
          CALL      UPOTECT2
.
.         Write a new history (outecaaf) record
.
          MOVE      OTECINVN,OTEAINVN
          MOVE      OTECBATN,OTEABATN
          MOVE      SEVEN,OTEASTAT             * Status - Closed
          MOVE      " 3",OTEATYPE              * Type - Viewed
          MOVE      WBSEUID,OTEAOPER
          MOVE      OTECTRID,OTEATRID
          MOVE      SP70,OTEAEROR
          MOVE      SP70,OTEAEROT
          MOVE      SP70,OTEASPAR
          MOVE      OTECMODL,OTEAMODL
.
          CALL      IBACLOCK                     * get current date/time
          PACK      OTEADATE,CCC,CYY,CMM,CDD
          REP       " 0",OTEADATE
          MOVE      CTIMEIS,OTEATIME
          REP       " 0",OTEATIME
.
          PACK      KEY27,OTEAINVN,OTEADATE,OTEATIME,OTEATYPE,OTEAMODL,SP70
          CALL      RAOTECA1
          IF        OVRCD = 1
            CALL      WROTECA1
          ENDIF
.
.         MOVE      SP70,TTYPEARG
.         MOVE      " 9",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      "10",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      " 4",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      " 5",TTYPEARG
.         CALL      DELETR00
.
.         CALL      DELECO00
.
          MOVE      ZERO,EXIT
          GOTO      ECBB9999
.
ECBB9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB9200  MOVE      "Can't find Eclipse Bulk Billing Claim details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB9300  MOVE      "Doctor Referral details has not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB9400  MOVE      "Can't Find Invoice Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB9500  MOVE      "Not using Eclipse Bulk Billing Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB9600  MOVE      "Invalid Bulk Billing webPAS Module",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB9700  MOVE      "Emergency Visit has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB9800  MOVE      "Outpatient Visit has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB9810  MOVE      "OP Visit Compensation Eligibility Not Found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECBB9999
.
ECBB9999  RETURN
+
.*****************************************************************************
.*                          GBAE0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on pmsectaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBAE0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      EMECINVN,KEY8
          CALL      RDINV1
          IF        OVRCD = 1
            GOTO      GBAE9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR+PTINCRTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PTINGSTJ,FORM7P2O
          ENDIF
.
GBAE9999  RETURN
+
.*****************************************************************************
.*                          DFUE0000                                         *
.*****************************************************************************
.
DFUE0000  CALL      GBAE0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
DFUE9999  RETURN
+
.------------------------------------------------------------
. Eclipse Store and Forward Claim Full Details tags
.------------------------------------------------------------
ECFS0000  BRANCH    FLDITMNO,ECFS0100,ECFS0200,ECFS0300,ECFS0400,ECFS0500:
                             ECFS0600,ECFS0700,ECFS0800,ECFS0900,ECFS1000:
                             ECFS1100,ECFS1200,ECFS1300,ECFS1400,ECFS1500:
                             ECFS1600,ECFS1700,ECFS1800,ECFS1900,ECFS2000:
                             ECFS2100,ECFS2200,ECFS2300,ECFS2400,ECFS2500:
                             ECFS2600,ECFS2700,ECFS2800,ECFS2900,ECFS3000:
                             ECFS3100,ECFS3200,ECFS3300,ECFS3400,ECFS3500:
                             ECFS3600,ECFS3700
.
          GOTO      ECFS9999
.
ECFS0100  WRITE     HTMLFILE;FORM7P2O;
          GOTO      ECFS9999
.
ECFS0200  WRITE     HTMLFILE;STATDESC;
          GOTO      ECFS9999
.
ECFS0300
.         WRITE     HTMLFILE;CONTDESC;
          GOTO      ECFS9999
.
ECFS0400  
.         MATCH     SP70,PRECPDAT
.         GOTO      ECFS9999 IF EQUAL
.         UNPACK    PRECPDAT,CCENT,CYEAR,CMON,CDAY  * Payment Date
.         MOVE      CMON,F2
.         LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.         WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ECFS9999
.
ECFS0500  
.         WRITE     HTMLFILE;PRECEETP;
          GOTO      ECFS9999
.
ECFS0600  
.         MATCH     "2",PRECEETP
.         IF        @EQUAL
.           WRITE     HTMLFILE;"Medicare Only";
.         ELSE
.           PACK      KEY14,PRECHFND,ZERO,ZERO,ZERO,ZERO,SP70
.           CALL      RDFUND1
.           IF        OVRCD=0
.             WRITE     HTMLFILE;HFNAME;
.           ENDIF
.         ENDIF
          GOTO      ECFS9999
.
ECFS0700  WRITE     HTMLFILE;EMECINVN;
          GOTO      ECFS9999
.
ECFS0800  WRITE     HTMLFILE;EMECBATN;
          GOTO      ECFS9999
.
ECFS0900  WRITE     HTMLFILE;EMECPBAT;
          GOTO      ECFS9999
.
ECFS1000  WRITE     HTMLFILE;EMECNBAT;
          GOTO      ECFS9999
.
ECFS1100  WRITE     HTMLFILE;EMECTRID;
          GOTO      ECFS9999
.
ECFS1200  
.         WRITE     HTMLFILE;PRECFTID;
          GOTO      ECFS9999
.
ECFS1300  WRITE     HTMLFILE;EMECAMTC;
          GOTO      ECFS9999
.
ECFS1400  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVAMT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINITOT;
          ENDIF
          GOTO      ECFS9999
.
ECFS1500  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVPATA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINPAMT;
          ENDIF
          GOTO      ECFS9999
.
ECFS1600  
.         WRITE     HTMLFILE;PRINHAMT;
          GOTO      ECFS9999
.
ECFS1700  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVOTHA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINOTHA;
          ENDIF
          GOTO      ECFS9999
.
ECFS1800  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVJOUR;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINJAMT;
          ENDIF
          GOTO      ECFS9999
.
ECFS1900  WRITE     HTMLFILE;PRECAMFP;
          GOTO      ECFS9999
.
ECFS2000  MATCH     SP70,EMECSTAT                * blank status ?
          GOTO      ECFS9999 IF EQUAL            * yes - don't display anything
          GOTO      ECFS9999 IF EOS
.
          MATCH     " 0",EMECSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed";
            GOTO      ECFS9999
          ENDIF
.
          GOTO      ECFS9999
.
ECFS2100  CALL      EDIS0000
          GOTO      ECFS9999
.
ECFS2200  
.         CALL      EDIP0000
          GOTO      ECFS9999
.
ECFS2300  
.         CALL      EDCE0000
          GOTO      ECFS9999
.
ECFS2400  
.         CALL      EDSD0000
          GOTO      ECFS9999
.
ECFS2500  
.         CALL      EDSE0000
          GOTO      ECFS9999
.
ECFS2600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PTINCRTT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINCNTT;
          ENDIF
          GOTO      ECFS9999
.
ECFS2700
.         WRITE     HTMLFILE;CFEETYP;
          GOTO      ECFS9999
.
ECFS2800  
.         WRITE     HTMLFILE;PRECAMMP;
          GOTO      ECFS9999
.
ECFS2900  MATCH     "1",MAVMODUL
          IF        @EQUAL
            MOVE      "CL",CATEGORY
            MOVE      EMVICOMP,CODE
            CALL      CODITM00
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL          
            MOVE      "CL",CATEGORY         * claim code
            MOVE      PRHDCLAM,CODE
            CALL      CODITM00
          ENDIF
.
          GOTO      ECFS9999
.
ECFS3000  
.          UNPACK    DIM127,D1,KEY1,DIM127
.          MOVE      ZERO,F1
.          MOVE      KEY1,F1
.          BRANCH    F1,ECFS3010
. 
.          WRITE     HTMLFILE;PRHDHFND;
. 
.          GOTO      ECFS9999
.
.ECFS3010  MATCH     SP70,PRHDHFND
.          GOTO      ECFS9999 IF EQUAL
.          GOTO      ECFS9999 IF EOS
.
.          PACK      KEY14,PRHDHFND,ZERO,ZERO,ZERO,ZERO,SP70
.          CALL      RDFUND1
.          BRANCH    OVRCD,ECFS9999
.
.          WRITE     HTMLFILE;HFNAME;
.
          GOTO      ECFS9999
.
ECFS3100  WRITE     HTMLFILE;UNIQNUMB;
          GOTO      ECFS9999
.
ECFS3200  WRITE     HTMLFILE;PRHRE001;
          GOTO      ECFS9999
.
ECFS3300  WRITE     HTMLFILE;PRHRE002;
          GOTO      ECFS9999
.
ECFS3400  WRITE     HTMLFILE;PRHRE003;
          GOTO      ECFS9999
.
ECFS3500  WRITE     HTMLFILE;MAVMODUL;
          GOTO      ECFS9999
.
ECFS3600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;FOUR;
          ENDIF
          GOTO      ECFS9999
.
ECFS3700  MATCH     SP70,PRHRPIND
          GOTO      ECFS9999 IF EQUAL
          GOTO      ECFS9999 IF EOS
.
          MOVE      "GI",CATEGORY
          MOVE      PRHRPIND,CODE
.
          PACK      KEY5,CATEGORY,CODE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;TDESC;
          ENDIF
.
ECFS9999  RETURN
+
.------------------------------------------------------------
. Table of EDI History
.------------------------------------------------------------
EDIS0000  MATCH     "1",PTCNUESF
          GOTO      EDIS9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          CALL      EDISD000      * Output Table Heading
.
          PACK      KEY35,MAVINVCE,Z70
          CALL      RSEMECA3
EDIS1000  CALL      RPEMECA3
          BRANCH    OVRCD,EDIS9999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     MAVINVCE,EMEAINVN
          GOTO      EDIS9999 IF NOT EQUAL
.
          MATCH     MAVMODUL,EMEAMODL
          GOTO      EDIS1000 IF NOT EQUAL
.
          CALL      EDSRW000
.
          GOTO      EDIS1000
.
EDIS9999  RETURN
.------------------------------------------------------------
. EDI History (TABLE HEADING)
.------------------------------------------------------------
EDISD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Time</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Status</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Transaction Type</td>":
                             "<td class=HeadingCell width=10%>":
                             "Batch</td>":
                             "<td class=HeadingCell width=10%>":
                             "Reviewed By</td>":
                             "<td class=HeadingCell width=35%>":
                             "Error Code Description</td>":
                             "</tr>"
.
EDISD999  RETURN
.------------------------------------------------------------
. EDI History (Detail Row)
.------------------------------------------------------------
EDSRW000  MOVE      SP70,DIM11
          MATCH     SP70,EMEADATE
          IF        !@EQUAL & !@EOS
            UNPACK    EMEADATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMEASTAT,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          MOVE      SP30,TYPEDESC
          MOVE      EMEATYPE,TYPOFREQ
          LOAD      TYPEDESC,TYPOFREQ,TYPEDSF1,TYPEDSF2,TYPEDSF3
          IF        TYPOFREQ = 2 | TYPOFREQ = 3
            STRIP     TYPEDESC
            ENDSET    TYPEDESC
            APPEND    SP1,TYPEDESC
            APPEND    EMEAEROR,TYPEDESC
            APPEND    SP20,TYPEDESC
            RESET     TYPEDESC
          ENDIF
.
          MOVE      SP70,DIM30
          PACK      KEY10,EMEAOPER,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      EMEAOPER,DIM30
          ELSE
            MATCH     EMEAOPER,WBSEUID
            IF        @EQUAL
              MOVE      WBSENAM,DIM30
            ELSE
              MOVE      EMEAOPER,DIM30
            ENDIF
          ENDIF
.
          CMATCH    NULL,EMEAEROT
          IF        @EQUAL
            PACK      PREAEROT,SP70,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",DIM11 ,"</td>";
          WRITE     HTMLFILE;"<td>",EMEATIME,"</td>";
          WRITE     HTMLFILE;"<td>",STATDESC,"</td>":
                             "<td>",TYPEDESC,"</td>":
                             "<td>",EMEABATN,"</td>":
                             "<td>",DIM30,"</td>":
                             "<td>",EMEAEROT,"</td>":
                             "</tr>";
.
EDSRW999  RETURN
.
.------------------------------------------------------------
. Eclipse STF Claim Enquiries
.------------------------------------------------------------
EMSE0000  MATCH     "1",PTCNUESF
          GOTO      EMSE9200 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      EMSE6000 IF EQUAL

          MATCH     "V",UPDATTYP
          GOTO      EMSE1000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      EMSE2000 IF EQUAL
.
          MATCH     "D",UPDATTYP
          GOTO      EMSE3000 IF EQUAL
.
          MATCH     "P",UPDATTYP
          GOTO      EMSE4000 IF EQUAL
.
          MATCH     "S",UPDATTYP
          GOTO      EMSE5000 IF EQUAL
.
          GOTO      EMSE9000
.
EMSE1000  CALL      MINS0000
          GOTO      EMSE9999
.
EMSE2000  CALL      RSUS0000
          GOTO      EMSE9999
.
EMSE3000  CALL      WDES0000
          GOTO      EMSE9999
.
EMSE4000  CALL      OTPC0000
          GOTO      EMSE9999
.
EMSE5000  
.         CALL      RSET0000
          GOTO      EMSE9999
.
EMSE6000  MOVE      TEMPLATE,FORM3
          IF        THREE=FORM3
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,EMSE9100
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDPMPX21
            BRANCH    OVRCD,EMSE9100
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE                   * CALCAGE uses PBDATE
.
            CALL      PATLN000
            CALL      PATFLD00                * Use standard Patient Folder sub
.
            MOVE      URNUMBER,FILTURNO
.           MOVE      UNIQNUMB,FILTADMN
.
            IF        ALLHFLAG=0
              COMPARE   ONE,IBCNMHOS
              IF        @EQUAL
                MOVE      TWO,VIEWTYPE
                MOVE      ZERO,EXDTBLNK
              ELSE
                MOVE      ZERO,VIEWTYPE
                MOVE      ONE,EXDTBLNK
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
.
          MOVE      "Eclipse PCS Claim Enquiry",WEBTITLE
.
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,EMSE9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      EMSE9999
.
EMSE9000  MOVE      "Invalid Form Action.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      EMSE9999
.
EMSE9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMSE9999
.
EMSE9200  MOVE      "Not using Eclipse Store and Forward Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMSE9999
.
EMSE9999  RETURN
+
.------------------------------------------------------------
. Eclipse STF Claim Enquiries tags
.------------------------------------------------------------
ECCS0000  BRANCH    FLDITMNO,ECCS0100,ECCS0200,ECCS0300,ECCS0400,ECCS0500:
                             ECCS0600,ECCS0700,ECCS0800,ECCS0900,ECCS1000:
                             ECCS1100,ECCS1200,ECCS1300,ECCS1400,ECCS1500:
                             ECCS1600,ECCS1700,ECCS1800,ECCS1900,ECCS2000:
                             ECCS2100,ECCS2200,ECCS2300,ECCS2400,ECCS2500:
                             ECCS2600,ECCS2700
.
          GOTO      ECCS9999
.
ECCS0100  CALL      ECSP0000
          GOTO      ECCS9999
.
ECCS0200  WRITE     HTMLFILE;IBCNMHOS;    * Multihospital Indicator
          GOTO      ECCS9999
.
ECCS0300  CALL      HOSPID00              * Hospital ID option field
          GOTO      ECCS9999
.
ECCS0400  CALL      SELHFN00              * Health Fund option field
          GOTO      ECCS9999
.
ECCS0500  WRITE     HTMLFILE;HLFDCLTY;
          GOTO      ECCS9999
.
ECCS0600  MOVE      CATCL,CATEGORY
          MOVE      HLTHFUND,CODE
          CALL      CODITM00
          GOTO      ECCS9999
.
ECCS0700  WRITE     HTMLFILE;EXCLWAIT;
          GOTO      ECCS9999
.
ECCS0800  WRITE     HTMLFILE;FILTURNO;
          GOTO      ECCS9999
.
ECCS0900  WRITE     HTMLFILE;FILTADMN;
          GOTO      ECCS9999
.
ECCS1000  WRITE     HTMLFILE;BATCHNUM;
          GOTO      ECCS9999
.
ECCS1100  WRITE     HTMLFILE;CLAIMSTA;
          GOTO      ECCS9999
.
ECCS1200  WRITE     HTMLFILE;INVNUMBR;
          GOTO      ECCS9999
.
ECCS1300  CALL      SELP0000
          GOTO      ECCS9999
.
ECCS1400  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      ECCS9999
.
ECCS1500  WRITE     HTMLFILE;EXDTBLNK;
          GOTO      ECCS9999
.
ECCS1600  WRITE     HTMLFILE;HLTHFUND;
          GOTO      ECCS9999
.
ECCS1700  CALL      PRVE0000
          GOTO      ECCS9999
.
ECCS1800  CALL      NXTE0000
          GOTO      ECCS9999
.
ECCS1900  CALL      BATTS000
          GOTO      ECCS9999
.
ECCS2000  CALL      PREVBT00
          GOTO      ECCS9999
.
ECCS2100  CALL      NEXTBT00
          GOTO      ECCS9999
.
ECCS2200  
.         CALL      ECOT0000
          GOTO      ECCS9999
.
ECCS2300  WRITE     HTMLFILE;PROCSTAT;
          GOTO      ECCS9999
.
ECCS2400  CALL      ECPP0000
          GOTO      ECCS9999
.
ECCS2500  WRITE     HTMLFILE;EXCLCLOS;
          GOTO      ECCS9999
.
ECCS2600  CALL      ECSE0000
          GOTO      ECCS9999
.
ECCS2700  CALL      ECEP0000
          GOTO      ECCS9999
.
ECCS9999  RETURN
+
.------------------------------------------------------------
. Table of Eclipse STF Claim Enquiries Private Practice
.------------------------------------------------------------
ECSP0000  MATCH     "1",PTCNUESF
          GOTO      ECSP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      ECSP9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      ECSP9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSEMIBH2
ECSP0500  CALL      RKEMIBH2
          BRANCH    OVRCD,ECSP2000
          MATCH     EMIBDTBC,LASTDATE
          GOTO      ECSP2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,EMIBBTHN,SP70
          CALL      RSEMECT3
ECSP1000  CALL      RKEMECT3
          BRANCH    OVRCD,ECSP0500
          MATCH     EMIBBTHN,EMECBATN
          GOTO      ECSP0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",EMECMODL
          GOTO      ECSP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,EMECHOSP
              GOTO      ECSP1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,EMECHOSP
                GOTO      ECSP1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      ECSP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      ECSP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   FIVE,EMECFLAG
            GOTO      ECSP1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        PRECFLAG=ZERO
.             GOTO      ECSP1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,EMECURNO
            GOTO      ECSP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECSP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECSP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECSP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECSP1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,ECSP1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      ECSP1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      ECSP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBS0000
.
          CALL      GBAP0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,EMECUNIQ,EMECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECSP1500
.
          MATCH     EMECUNIQ,DPRDTUNQ
          GOTO      ECSP1500 IF NOT EQUAL
.
          MATCH     EMECINVN,PRDTINVN
          GOTO      ECSP1500 IF NOT EQUAL
.
          GOTO      ECSP1600
.
ECSP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECSP1600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        EMECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECSP1000
.
ECSP2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      ECSP9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSEMECT3
ECSP3000  CALL      RKEMECT3
          BRANCH    OVRCD,ECSP9000
          MATCH     SP70,EMECBATN
          GOTO      ECSP9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",EMECMODL
          GOTO      ECSP3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,EMECHOSP
              GOTO      ECSP3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,EMECHOSP
                GOTO      ECSP3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      ECSP3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      ECSP3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        EMECFLAG=FIVE
              GOTO      ECSP3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        EMECFLAG=ZERO
              GOTO      ECSP3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,EMECURNO
            GOTO      ECSP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECSP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECSP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECSP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECSP3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,ECSP1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      ECSP1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      ECSP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBS0000
.
          CALL      GBAP0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,EMECUNIQ,EMECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECSP3500
.
          MATCH     EMECUNIQ,DPRDTUNQ
          GOTO      ECSP3500 IF NOT EQUAL
.
          MATCH     EMECINVN,PRDTINVN
          GOTO      ECSP3500 IF NOT EQUAL
.
          GOTO      ECSP3600
.
ECSP3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECSP3600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        EMECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECSP3000
.
ECSP9000
ECSP9999  RETURN
+
.*****************************************************************************
.*                          RSBS0000                                         *
.*****************************************************************************
RSBS0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,EMECNBAT                 * next batch blank ?
          GOTO      RSBS9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        EMECFLAG <> 5 & EMECFLAG <> 3
            GOTO      RSBS9000
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,RSBS9000
.
          CALL      GBAP0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSBS9000
          ENDIF
.
          PACK      KEY17,EMECINVN,SP8,TWO,SP70
          CALL      RAEMECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBS9000
          ENDIF
.
          GOTO      RSBS9999
.
RSBS9000  MOVE      ONE,RSUBINDI
RSBS9999  RETURN
.
.------------------------------------------------------------
. Table of Eclipse STF Claim Enquiries Emergency
.------------------------------------------------------------
ECSE0000  MATCH     "1",PTCNUESF
          GOTO      ECSE9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      ECSE9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      ECSE9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSEMIBH2
ECSE0500  CALL      RKEMIBH2
          BRANCH    OVRCD,ECSE2000
          MATCH     EMIBDTBC,LASTDATE
          GOTO      ECSE2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,EMIBBTHN,SP70
          CALL      RSEMECT3
ECSE1000  CALL      RKEMECT3
          BRANCH    OVRCD,ECSE0500
          MATCH     EMIBBTHN,EMECBATN
          GOTO      ECSE0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "1",EMECMODL
          GOTO      ECSE1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,EMECHOSP
              GOTO      ECSE1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,EMECHOSP
                GOTO      ECSE1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      ECSE1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      ECSE1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   FIVE,EMECFLAG
            GOTO      ECSE1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        PRECFLAG=ZERO
.             GOTO      ECSE1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,EMECURNO
            GOTO      ECSE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECSE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECSE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECSE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECSE1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,ECSE1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      ECSE1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      ECSE1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBE0000
.
          CALL      GBAE0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,EMECINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,EMECUNIQ,EMECINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,ECSE1500
.
.         MATCH     EMECUNIQ,DPRDTUNQ
.         GOTO      ECSE1500 IF NOT EQUAL
.
.         MATCH     EMECINVN,PRDTINVN
.         GOTO      ECSE1500 IF NOT EQUAL
.
.         GOTO      ECSE1600
.
ECSE1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECSE1600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.              
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        EMECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECSE1000
.
ECSE2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      ECSE9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSEMECT3
ECSE3000  CALL      RKEMECT3
          BRANCH    OVRCD,ECSE9000
          MATCH     SP70,EMECBATN
          GOTO      ECSE9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "1",EMECMODL
          GOTO      ECSE3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,EMECHOSP
              GOTO      ECSE3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,EMECHOSP
                GOTO      ECSE3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      ECSE3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      ECSE3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        EMECFLAG=FIVE
              GOTO      ECSE3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        EMECFLAG=ZERO
              GOTO      ECSE3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,EMECURNO
            GOTO      ECSE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECSE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECSE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECSE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECSE3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,ECSE1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      ECSE1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      ECSE1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBE0000
.
          CALL      GBAE0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,EMECINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,EMECUNIQ,EMECINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,ECSE3500
.
.         MATCH     EMECUNIQ,DPRDTUNQ
.         GOTO      ECSE3500 IF NOT EQUAL
.
.         MATCH     EMECINVN,PRDTINVN
.         GOTO      ECSE3500 IF NOT EQUAL
.
.         GOTO      ECSE3600
.
ECSE3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECSE3600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        EMECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECSE3000
.
ECSE9000
ECSE9999  RETURN
+
.*****************************************************************************
.*                          RSBE0000                                         *
.*****************************************************************************
RSBE0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,EMECNBAT                 * next batch blank ?
          GOTO      RSBE9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        EMECFLAG <> 5 & EMECFLAG <> 3
            GOTO      RSBE9000
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDINV1
          BRANCH    OVRCD,RSBE9000
.
          CALL      GBAE0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PINVAMT > 0)
            GOTO      RSBE9000
          ENDIF
.
          PACK      KEY17,EMECINVN,SP8,ONE,SP70
          CALL      RAEMECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBE9000
          ENDIF
.
          GOTO      RSBE9999
.
RSBE9000  MOVE      ONE,RSUBINDI
RSBE9999  RETURN
+
.------------------------------------------------------------
. Validate Batch Number STF
. INPUTS: BATCHNUM - Batch Number
.------------------------------------------------------------
VALBAS00  CALL      XMLHED00
          BRANCH    EXIT,VALBAS99
.
          MATCH     "1",PTCNUESF
          GOTO      VALBAS91 IF NOT EQUAL
.
          PACK      KEY24,BATCHNUM,SP70
          CALL      RSEMECT3
          CALL      RKEMECT3
          BRANCH    OVRCD,VALBAS90
.
          MATCH     EMECBATN,BATCHNUM
          GOTO      VALBAS90 IF NOT EQUAL
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALBAS98
.
VALBAS90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Batch number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAS98
.
VALBAS91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Not using Eclipse IMC Module. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAS98
.
VALBAS98  CALL      XMLEND00
VALBAS99  RETURN
+
.------------------------------------------------------------
. Validate Unique/Admission Number STF
. INPUTS: UNIQNUMB - Batch Number
.------------------------------------------------------------
VALUNS00  CALL      XMLHED00
          BRANCH    EXIT,VALUNS99
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,VALUNS20
.
          GOTO      VALUNS50  
.
VALUNS20  PACK      KEY8,UNIQNUMB,SP70
          CALL      RDEMVIS1
          BRANCH    OVRCD,VALUNS90
.
          GOTO      VALUNS50
.
.  Dummy ouput for valid Code
.
VALUNS50  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALUNS98
.
VALUNS90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Unique number / Admission Number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALUNS98
.
VALUNS98  CALL      XMLEND00
VALUNS99  RETURN
+
.*****************************************************************************
.*                          MINS0000                                         *
.*****************************************************************************
.
.         First, get the last EDI History record for this invoice
.
MINS0000  PACK      KEY27,MAVINVCE,Z70
          CALL      RSEMECA1                     * position on last history rec
MINS0010  CALL      RPEMECA1                     * read previous record
          BRANCH    OVRCD,MINS3000               * eof - finished
.
          MATCH     MAVINVCE,EMEAINVN            * same invoice still ?
          GOTO      MINS3000 IF NOT EQUAL        * no - finished
.
          MATCH     MAVMODUL,EMECMODUL
          GOTO      MINS0010 IF NOT EQUAL
.
.         Read emrectaf
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDEMECT2
          BRANCH    OVRCD,MINS3000
.
.         The last EDI history record has been found for the invoice, so
.         write a new record, defaulting some of the values from the read
.         record.
.
          MOVE      MAVBATCH,EMEABATN
          MOVE      MAVINVCE,EMEAINVN
          MOVE      MAVMODUL,EMEAMODL
.
MINS1000  CALL      IBACLOCK                     * get current date/time
          PACK      EMEADATE,CCC,CYY,CMM,CDD
          REP       " 0",EMEADATE
          MOVE      CTIMEIS,EMEATIME
          REP       " 0",EMEATIME
.
          MOVE      " 1",EMEATYPE
          MOVE      WBSEUID,EMEAOPER
          MOVE      SP70,EMEASPAR
.
          PACK      KEY27,EMEAINVN,EMEADATE,EMEATIME,EMEATYPE,EMEAMODL,SP70
          CALL      RAEMECA1
          IF        OVRCD = 0
            GOTO      MINS1000
          ENDIF
.
          CALL      WREMECA1                     * write EDI History record
.
.         If the record has a status of 
.         "Error (SA validation)"
.         then update the status to "Closed", as the claim cannot go any
.         further (unless resubmitted after closing).
.
          IF        EMECFLAG = 3
            PACK      KEY30,EMECHOSP,EMECFLAG,EMECMODL,EMECUNIQ,EMECINVN:
                            EMECBATN,SP70
            CALL      RDEMECT1                   * read selected record
            BRANCH    OVRCD,MINS3000             * shouldn't happen
.
            MOVE      FIVE,EMECFLAG              * update to "closed"
            CALL      UPEMECT1
.
.           Also write an EDI History record (emrecaaf) for the close
.
            MOVE      EMECINVN,EMEAINVN
            MOVE      EMECBATN,EMEABATN
            MOVE      FIVE,EMEASTAT
            MOVE      " 1",EMEATYPE
            MOVE      WBSEUID,EMEAOPER
            MOVE      EMECTRID,EMEATRID
            MOVE      SP30,EMEASPAR
.
MINS2000    CALL      IBACLOCK                   * get current time
            PACK      EMEADATE,CCC,CYY,CMM,CDD
            REP       " 0",EMEADATE
            MOVE      CTIMEIS,EMEATIME
            REP       " 0",EMEATIME
.
            PACK      KEY27,EMEAINVN,EMEADATE,EMEATIME,EMEATYPE,EMEAMODL,SP70
            CALL      RAEMECA1
            IF        OVRCD = 1
              CALL      WREMECA1
            ELSE
              GOTO      MINS2000
            ENDIF
.
            GOTO      MINS9000
          ELSE
            GOTO      MINS9000
          ENDIF
.
MINS3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      MINS9100
.
MINS9000  MOVE      ZERO,EXIT
          GOTO      MINS9999
.
MINS9100  MOVE      ONE,EXIT
.
MINS9999  RETURN
+
.*****************************************************************************
.*                               RSUS0000                                    *
.*                  Process resubmission selection                           *
.*****************************************************************************
RSUS0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDEMECT2
          BRANCH    OVRCD,RSUS7000
.
.         Check if the record has already been resubmitted
.
          MATCH     SP8,EMECNBAT                 * next batch blank ?
          IF        !@EQUAL
            GOTO      RSUS8000
          ENDIF
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
.         IF        EMECFLAG <> 19 & EMECFLAG <> 3
.           GOTO      RSUS7000
.         ENDIF
.
          IF        EMECFLAG = 5 | EMECFLAG = 3
.
            PACK      KEY27,EMECINVN,Z70
            CALL      RSEMECA1
RSUS2100    CALL      RPEMECA1
            BRANCH    OVRCD,RSUS2500
.
            MATCH     EMECINVN,EMEAINVN
            GOTO      RSUS2500 IF NOT EQUAL
.
            MATCH     EMECMODL,EMEAMODL
            GOTO      RSUS2100 IF NOT EQUAL
.
            MATCH     EMECTRID,EMEATRID
            GOTO      RSUS2100 IF NOT EQUAL
.
            COMPARE   THREE,EMEASTAT
            GOTO      RSUS2100 IF NOT EQUAL
.
            MATCH     " 2",EMEATYPE
            GOTO      RSUS2100 IF NOT EQUAL
.
            MATCH     "3002",EMEAEROR
            GOTO      RSUS2100 IF NOT EQUAL
.
            MOVE      ZERO,FORM8A
.
            CALL      IBACLOCK
.
            PACK      CURRDATE,CCC,CYY,CMM,CDD
            REP       " 0",CURRDATE
.
            DAYSEP    EMEADATE,CURRDATE,FORM8A
.
            COMPARE   FORM8A,ONE
            GOTO      RSUS2500 IF EQUAL
            GOTO      RSUS2500 IF LESS
.
            GOTO      RSUS7500
.
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RSUS2500  MATCH     "1",EMECMODL
          IF        @EQUAL
.
            PACK      KEY8,EMECINVN,SP70
            CALL      RDINV1
            IF        OVRCD = 1
              GOTO      RSUS6000
            ENDIF
.
            CALL      GBAE0000                    * get outstanding inv. balance
.
          ELSE
.
            PACK      KEY8,EMECINVN,SP70
            CALL      RDPRIN1
            IF        OVRCD = 1
              GOTO      RSUS6000
            ENDIF
.
            CALL      GBAP0000                    * get outstanding inv. balance
.
          ENDIF
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission (CAR 181439)
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSUS5000
          ENDIF
.
          PACK      KEY17,EMECINVN,SP8,EMECMODL,SP70
          CALL      RAEMECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSUS4000
          ENDIF
.
          MOVE      ZERO,EMECFLAG
          MOVE      SP70,EMECBATN
          MOVE      MAVBATCH,EMECPBAT
          MOVE      SP70,EMECNBAT
.         MOVE      SP70,EMECCCFL
          MOVE      SP70,EMECTRID
          MOVE      ZERO,EMECAMTC
.         MOVE      ZERO,EMECAMFP
.         MOVE      ZERO,EMECAMMP
.         MOVE      SP70,EMECPDAT
          MOVE      SP70,EMECSTAT
.         MOVE      SP70,EMECFTID
          MOVE      SP70,EMECSPAR
.
          PACK      KEY17,EMECINVN,EMECBATN,EMECMODL,SP70
          CALL      RAEMECT2
          IF        OVRCD = 1
            CALL      WREMECT1                   * write record
          ELSE
            GOTO      RSUS4000
          ENDIF
.
.         Update the selected record with the next batch no. of "00000000".
.         The record will either have a status of "closed" already, or
.         "SA Validation Error".  If it's the latter, then update the status to
.         "closed" as well"
.
.         PACK      KEY35,PRECHOSP,TEN9,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.         CALL      RDPRECT1
.         IF        OVRCD = 1
.    PACK      KEY35,PRECHOSP,SP1,THREE,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.           CALL      RDPRECT1
.           IF        OVRCD = 1
.             GOTO      RSUS3000
.           ELSE
.             MOVE      TEN9,PRECFLAG            * set status to closed
.           ENDIF
.         ENDIF
.
          PACK      KEY17,EMECINVN,MAVBATCH,MAVMODUL,SP70
          CALL      RDEMECT2
          IF        OVRCD = 1
            CALL      RSUS3000                   * write record
          ELSE
            MOVE      FIVE,EMECFLAG            * set status to closed
          ENDIF
.
          MOVE      "00000000",EMECNBAT
          CALL      UPEMECT2
.
          GOTO      RSUS9999
.
RSUS3000  CLEAR     WEBTITLE
          APPEND    "Error updating Invoice ",WEBTITLE
          APPEND    EMECINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    EMECBATN,WEBTITLE
          APPEND    " Module ",WEBTITLE
          APPEND    EMECMODL,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS4000  MOVE      "Invoice already waiting for extraction.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS5000  MOVE      "Claim fully paid.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS6000  CLEAR     WEBTITLE
          APPEND    "Invoice ",WEBTITLE
          APPEND    EMECINVN,WEBTITLE
          APPEND    " not found.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS7000  MOVE      "Claim not not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS7500  MOVE      "Error 3002. Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS8000  MOVE      "Invoice already resubmitted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS9000  MOVE      ONE,EXIT
RSUS9999  RETURN
+
.*****************************************************************************
.*                               WDES0000                                    *
.*                  Process delete records waiting                           *
.*****************************************************************************
WDES0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDEMECT2
          BRANCH    OVRCD,WDES8000
.
          MOVE      EMECINVN,TEMPINVN
          MOVE      EMECBATN,TEMPBATN
          MOVE      EMECUNIQ,TEMPADMN
          MOVE      EMECURNO,TEMPURNO
          MOVE      EMECMODL,TEMPMODL
          MOVE      EMECPBAT,TEMPPBAT
          MOVE      EMECHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      WDES1000 IF EQUAL
          GOTO      WDES1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,SP1,FIVE,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDEMECT1
          IF        OVRCD = 1
            GOTO      WDES7000
          ELSE
            MOVE      SP70,EMECNBAT
            CALL      UPEMECT1
          ENDIF
.
.         Delete the selected record
.
WDES1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEEMECT1
.
          GOTO      WDES9999
.
WDES7000  CLEAR     WEBTITLE
          APPEND    "Error updating previous claim ",WEBTITLE
          APPEND    EMECINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    EMECBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      WDES9000
.
WDES8000  MOVE      "Record cannot be deleted.",WEBTITLE
          CALL      WEBERR00
          GOTO      WDES9000
.
WDES9000  MOVE      ONE,EXIT
WDES9999  RETURN
+
.------------------------------------------------------------
. Table of Batch Numbers STF
.------------------------------------------------------------
BATTS000  MATCH     "1",PTCNUESF
          GOTO      BATTS999 IF NOT EQUAL
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BATHS000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70
          CALL      RSEMIBH1                     * position in file
BATTS100  CALL      RPEMIBH1                     * read previous record
          BRANCH    OVRCD,BATTS999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BATTS100
          ENDIF
.
          CALL      BASRW000      * Display Row
          BRANCH    EXIT,BATTS100
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BATTS100 IF NOT EQUAL
.
BATTS999  RETURN
+
.------------------------------------------------------------
. Batch Numbers by Code (TABLE HEADING) STF
.------------------------------------------------------------
BATHS000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Batch Number</td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=25%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Date</td>":
                             "<td class=HeadingCell width=15%>":
                             "Time</td>":
.                            "<td class=HeadingCell width=15%>":
.                            "Status</td>":
                             "</tr>"
.
BATHS999  RETURN
+
.------------------------------------------------------------
. Batch Numbers (TABLE ROW) STF
.------------------------------------------------------------
BASRW000  MOVE      ZERO,EXIT
          PACK      BTSCHOSP,BTSCHOSP,SP70
.
          UNPACK    EMIBDTBC,CCENT,CYEAR,CMON,CDAY  * Batch Created Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    EMIBTMBC,DIM5,ANS,ANS,ANS
.
          MOVE      SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      BASRW500 IF NOT EQUAL
.
          PACK      KEY24,EMIBBTHN,SP30         * get Hospital for given Batch
          CALL      RSEMECT3
          CALL      RKEMECT3
          IF        OVRCD=1
            MOVE      ONE,EXIT
            GOTO      BASRW999
          ENDIF
.
          MATCH     EMIBBTHN,EMECBATN
          IF        @EQUAL
            MOVE      EMECHOSP,KEY3
            CALL      RDPTHSP1            * read Hospital name for visit
            IF        OVRCD=1
              MOVE      EMECHOSP,HOSPNAME
            ELSE
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
.
            MATCH     SP70,BTSCHOSP
            IF        !@EQUAL&!@EOS
              MATCH     BTSCHOSP,EMECHOSP
              IF        !@EQUAL
                MOVE      ONE,EXIT
                GOTO      BASRW999
              ENDIF
            ENDIF
          ELSE
            MOVE      ONE,EXIT
            GOTO      BASRW999
          ENDIF
.
BASRW500  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",EMIBBTHN,"#")'>":
                             EMIBBTHN,"</a></td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",KEY11,"</td>":
                             "<td>",DIM5,"</td>":
                             "</tr>";
.
BASRW999  RETURN
+
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries STF Patient Level Priv Prac
.------------------------------------------------------------
ECPP0000  MATCH     "1",PTCNUESF
          GOTO      ECPP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.         MATCH     SP70,HOSPCODE
.         IF        @EQUAL
.           MOVE      WBSEHOSP,HOSPCODE
.         ENDIF
.
.         PACK      KEY35,HOSPCODE,FILTURNO,SP70
          PACK      KEY35,SP3,FILTURNO,SP70
          CALL      RSEMECT5
ECPP1000  CALL      RKEMECT5
          BRANCH    OVRCD,ECPP9999
          MATCH     FILTURNO,EMECURNO
          GOTO      ECPP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",EMECMODL
          GOTO      ECPP1000 IF NOT EQUAL
.
.         IF        IBCNMHOS=ONE
.           MATCH     SP70,HOSPCODE
.           IF        !@EQUAL & !@EOS
.             MATCH     HOSPCODE,EMECHOSP
.             GOTO      ECPP9999 IF NOT EQUAL
.           ELSE
.             IF        ALLHFLAG<>ONE
.               MATCH     WBSEHOSP,EMECHOSP
.               GOTO      ECPP9999 IF NOT EQUAL
.             ENDIF
.           ENDIF
..
.           MATCH     SP70,FILTURNO
.           IF        !@EQUAL & !@EOS
.             MATCH     FILTURNO,EMECURNO
.             GOTO      ECPP1000 IF NOT EQUAL
.           ENDIF
.
.         ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,EMECURNO
              GOTO      ECPP9999 IF NOT EQUAL
            ENDIF
.
.         ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      ECPP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      ECPP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        EMECFLAG=ZERO
              GOTO      ECPP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECPP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,EMECBATN,SP70
            CALL      RDEMIBH1
            BRANCH    OVRCD,ECPP1000
.
            MATCH     FRSTDATE,EMIBDTBC
            GOTO      ECPP1000 IF LESS
.
            MATCH     EMIBDTBC,LASTDATE
            GOTO      ECPP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBS0000
.
          CALL      GBAP0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,EMECUNIQ,EMECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECPP1500
.
          MATCH     EMECUNIQ,DPRDTUNQ
          GOTO      ECPP1500 IF NOT EQUAL
.
          MATCH     EMECINVN,PRDTINVN
          GOTO      ECPP1500 IF NOT EQUAL
.
          GOTO      ECPP1600
.
ECPP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECPP1600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECPP1000
.
ECPP9999  RETURN
+
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries STF Patient Level Emergency
.------------------------------------------------------------
ECEP0000  MATCH     "1",PTCNUESF
          GOTO      ECEP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     SP70,HOSPCODE
          IF        @EQUAL
            MOVE      WBSEHOSP,HOSPCODE
          ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSEMECT5
ECEP1000  CALL      RKEMECT5
          BRANCH    OVRCD,ECEP9999
          MATCH     FILTURNO,EMECURNO
          GOTO      ECEP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "1",EMECMODL
          GOTO      ECEP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,EMECHOSP
              GOTO      ECEP9999 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,EMECHOSP
                GOTO      ECEP9999 IF NOT EQUAL
              ENDIF
            ENDIF
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,EMECURNO
              GOTO      ECEP1000 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,EMECURNO
              GOTO      ECEP9999 IF NOT EQUAL
            ENDIF
.
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      ECEP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      ECEP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        EMECFLAG=ZERO
              GOTO      ECEP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECEP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECEP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECEP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECEP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,EMECBATN,SP70
            CALL      RDEMIBH1
            BRANCH    OVRCD,ECEP1000
.
            MATCH     FRSTDATE,EMIBDTBC
            GOTO      ECEP1000 IF LESS
.
            MATCH     EMIBDTBC,LASTDATE
            GOTO      ECEP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBE0000
.
          CALL      GBAE0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,EMECINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,EMECUNIQ,EMECINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,ECEP1500
.
.         MATCH     EMECUNIQ,DPRDTUNQ
.         GOTO      ECEP1500 IF NOT EQUAL
.
.         MATCH     EMECINVN,PRDTINVN
.         GOTO      ECEP1500 IF NOT EQUAL
.
.         GOTO      ECEP1600
.
ECEP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECEP1600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECEP1000
.
ECEP9999  RETURN
+
.------------------------------------------------------------
. Eclipse Claimant NOI Functionality
.------------------------------------------------------------
CLMT0000  MATCH     "1",PTCNUESF
          GOTO      CLMT9200 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      CLMT6000 IF EQUAL

          MATCH     "E",UPDATTYP
          GOTO      CLMT1000 IF EQUAL
.
          GOTO      CLMT9000
.
CLMT1000  CALL      BSBAU000
          GOTO      CLMT9999
.
CLMT6000 CLEAR     WEBTITLE
.
          MOVE      "Eclipse BSB Collection",WEBTITLE
.
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,CLMT9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
CLMT9000  MOVE      "Invalid Form Action.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      CLMT9999
.
CLMT9200  MOVE      "Not using Eclipse Store and Forward Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
CLMT9999  RETURN
+
.------------------------------------------------------------
. Write/Update Eclipse BSB Claiment Details
.------------------------------------------------------------
BSBAU000  MATCH     Z70,PMCLT001
          GOTO      BSBAU999 IF EQUAL
.
          MATCH     Z70,PMCLT002
          GOTO      BSBAU999 IF EQUAL
.
          RJUSTIFY  PMCLT002
.
          PACK      KEY9,PMCLT001,PMCLT002,SP70
          CALL      RDPMCLT1
          IF        OVRCD=0
            MOVE      PMCLT013,PMCLBNAM
            MOVE      PMCLT014,PMCLBACN
            MOVE      PMCLT015,PMCLBBSB
            CALL      UPPMCLT1
          ELSE
            CALL      CLPMSCLT
            CALL      MVPMCL00
            CALL      WRPMCLT1
.           GOTO      BSBAU900
          ENDIF
.
          GOTO      BSBAU999
.
BSBAU900  MOVE      "Invalid Claimant Record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BSBAU999
.
BSBAU999  RETURN
+
.*****************************************************************************
.*                          DBBE0000                                         *
.*****************************************************************************
.
DBBE0000  CALL      GBBE0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,OTECFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07
.
DBBE9999  RETURN
+
.*****************************************************************************
.*                          GBBE0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on outectaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBBE0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      OTECINVN,KEY8
          CALL      RDINV1
          IF        OVRCD = 1
            GOTO      GBBE9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR+PTINCRTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PTINGSTJ,FORM7P2O
          ENDIF
.
GBBE9999  RETURN
+
.*****************************************************************************
.*                          DBBP0000                                         *
.*****************************************************************************
.
DBBP0000  CALL      GBBP0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,OTECFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07          
.
DBBP9999  RETURN
+
.*****************************************************************************
.*                          GBBP0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on outectaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBBP0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      OTECINVN,KEY8
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      GBBP9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PRINGSTJ,FORM7P2O
          ENDIF
.
GBBP9999  RETURN
+

.------------------------------------------------------------
. Eclipse Bulk Billing Claim Full Details tags
.------------------------------------------------------------
EBBF0000  BRANCH    FLDITMNO,EBBF0100,EBBF0200,EBBF0300,EBBF0400,EBBF0500:
                             EBBF0600,EBBF0700,EBBF0800,EBBF0900,EBBF1000:
                             EBBF1100,EBBF1200,EBBF1300,EBBF1400,EBBF1500:
                             EBBF1600,EBBF1700,EBBF1800,EBBF1900,EBBF2000:
                             EBBF2100,EBBF2200,EBBF2300,EBBF2400,EBBF2500:
                             EBBF2600,EBBF2700,EBBF2800,EBBF2900,EBBF3000:
                             EBBF3100,EBBF3200,EBBF3300,EBBF3400,EBBF3500:
                             EBBF3600,EBBF3700
.
          GOTO      EBBF9999
.
EBBF0100  WRITE     HTMLFILE;FORM7P2O;
          GOTO      EBBF9999
.
EBBF0200  WRITE     HTMLFILE;STATDESC;
          GOTO      EBBF9999
.
EBBF0300
.         WRITE     HTMLFILE;CONTDESC;
          GOTO      EBBF9999
.
EBBF0400  MATCH     SP70,OTECPDAT
          GOTO      EBBF9999 IF EQUAL
          UNPACK    OTECPDAT,CCENT,CYEAR,CMON,CDAY  * Payment Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EBBF9999
.
EBBF0500  MOVE      ZERO,FORM7P2C
          UNPACK    OTESCLCA,DIM7,DIM2              * Claim Charge Amount
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      EBBF9999
.
EBBF0600  MOVE      ZERO,FORM7P2C
          UNPACK    OTERDAMN,DIM7,DIM2              * Deposit Amount
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      EBBF9999
.
EBBF0700  WRITE     HTMLFILE;OTECINVN;
          GOTO      EBBF9999
.
EBBF0800  WRITE     HTMLFILE;OTECBATN;
          GOTO      EBBF9999
.
EBBF0900  WRITE     HTMLFILE;OTECPBAT;
          GOTO      EBBF9999
.
EBBF1000  WRITE     HTMLFILE;OTECNBAT;
          GOTO      EBBF9999
.
EBBF1100  WRITE     HTMLFILE;OTECTRID;
          GOTO      EBBF9999
.
EBBF1200  
.         WRITE     HTMLFILE;PRECFTID;
          GOTO      EBBF9999
.
EBBF1300  WRITE     HTMLFILE;OTECAMTC;
          GOTO      EBBF9999
.
EBBF1400  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVAMT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINITOT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVAMT;
          ENDIF
.
          GOTO      EBBF9999
.
EBBF1500  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVPATA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINPAMT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVPATA;
          ENDIF
.
          GOTO      EBBF9999
.
EBBF1600  
.         WRITE     HTMLFILE;PRINHAMT;
          GOTO      EBBF9999
.
EBBF1700  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVOTHA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINOTHA;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVOTHA;
          ENDIF
.
          GOTO      EBBF9999
.
EBBF1800  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVJOUR;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINJAMT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVJOUR;
          ENDIF
.
          GOTO      EBBF9999
.
EBBF1900  MOVE      ZERO,FORM7P2C
          UNPACK    OTESCLBP,DIM7,DIM2          * Claim Benefit Paid
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      EBBF9999
.
EBBF2000  MATCH     SP70,OTECSTAT                * blank status ?
          GOTO      EBBF9999 IF EQUAL            * yes - don't display anything
          GOTO      EBBF9999 IF EOS
.
          MATCH     " 0",OTECSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed";
            GOTO      EBBF9999
          ENDIF
.
          MATCH     " 1",OTECSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed with Write Off";
            GOTO      EBBF9999
          ENDIF
.
          MATCH     " 2",OTECSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed with Payment";
            GOTO      EBBF9999
          ENDIF
.
          MATCH     " 3",OTECSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed with WO & Pymt";
            GOTO      EBBF9999
          ENDIF
.
          GOTO      EBBF9999
.
EBBF2100  CALL      EDIB0000
          GOTO      EBBF9999
.
EBBF2200  CALL      EBAR0000  * Eclipse Bulk Billing Assessment Report Fields
          GOTO      EBBF9999
.
EBBF2300  CALL      EBSD0000   * Service Details and Explanation
          GOTO      EBBF9999
.
EBBF2400  
.-------- CALL      EDSD0000   * Service Details
          GOTO      EBBF9999
.
EBBF2500  
.-------- CALL      EDSE0000
          GOTO      EBBF9999
.
EBBF2600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PTINCRTT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINCNTT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PTINCRTT;
          ENDIF
.
          GOTO      EBBF9999
.
EBBF2700
.-------- WRITE     HTMLFILE;CFEETYP;
          GOTO      EBBF9999
.
EBBF2800  WRITE     HTMLFILE;OTECAMTP       * Amount Paid by Medicare
.-------- MOVE      ZERO,FORM7P2C
.-------- UNPACK    OTERCLBP,DIM7,DIM2      * Claim Benefit Paid
.-------- PACK      DIM10,DIM7,DOT,DIM2
.-------- MOVE      DIM10,FORM7P2C
.-------- WRITE     HTMLFILE;FORM7P2C;
          GOTO      EBBF9999
.
EBBF2900  MATCH     "1",MAVMODUL            * Emergency Module
          IF        @EQUAL
            MOVE      "CL",CATEGORY
            MOVE      EMVICOMP,CODE
            CALL      CODITM00
          ENDIF
.
          MATCH     "2",MAVMODUL            * Private Practice Module
          IF        @EQUAL          
            MOVE      "CL",CATEGORY         * claim code
            MOVE      PRHDCLAM,CODE
            CALL      CODITM00
          ENDIF
.
          MATCH     "3",MAVMODUL            * Outpatient Module
          IF        @EQUAL          
            MOVE      "CL",CATEGORY         
            MOVE      OBACOMP,CODE          * Compensation Eligibility
            CALL      CODITM00
          ENDIF
.
          GOTO      EBBF9999
.
EBBF3000  
.--------- UNPACK    DIM127,D1,KEY1,DIM127
.          MOVE      ZERO,F1
.          MOVE      KEY1,F1
.          BRANCH    F1,EBBF3010
. 
.          WRITE     HTMLFILE;PRHDHFND;
. 
.          GOTO      EBBF9999
.
.EBBF3010  MATCH     SP70,PRHDHFND
.          GOTO      EBBF9999 IF EQUAL
.          GOTO      EBBF9999 IF EOS
.
.          PACK      KEY14,PRHDHFND,ZERO,ZERO,ZERO,ZERO,SP70
.          CALL      RDFUND1
.          BRANCH    OVRCD,EBBF9999
.
.--------- WRITE     HTMLFILE;HFNAME;
.
          GOTO      EBBF9999
.
EBBF3100  WRITE     HTMLFILE;UNIQNUMB;
          GOTO      EBBF9999
.
EBBF3200  WRITE     HTMLFILE;PRHRE001;
          GOTO      EBBF9999
.
EBBF3300  WRITE     HTMLFILE;PRHRE002;
          GOTO      EBBF9999
.
EBBF3400  WRITE     HTMLFILE;PRHRE003;
          GOTO      EBBF9999
.
EBBF3500  WRITE     HTMLFILE;MAVMODUL;
          GOTO      EBBF9999
.
EBBF3600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;FOUR;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;TWO;
          ENDIF
.
          GOTO      EBBF9999
.
EBBF3700  MATCH     SP70,PRHRPIND
          GOTO      EBBF9999 IF EQUAL
          GOTO      EBBF9999 IF EOS
.
          MOVE      "GI",CATEGORY
          MOVE      PRHRPIND,CODE
.
          PACK      KEY5,CATEGORY,CODE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;TDESC;
          ENDIF
.
EBBF9999  RETURN
+
.------------------------------------------------------------
. Table of EDI History for Eclipse Bulk Billing 
.------------------------------------------------------------
EDIB0000  MATCH     "1",PTCNUEBB
          GOTO      EDIB9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          CALL      EDISD000      * Output Table Heading
.
          PACK      KEY35,MAVINVCE,Z70
          CALL      RSOTECA3
EDIB1000  CALL      RPOTECA3
          BRANCH    OVRCD,EDIB9999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     MAVINVCE,OTEAINVN
          GOTO      EDIB9999 IF NOT EQUAL
.
          MATCH     MAVMODUL,OTEAMODL
          GOTO      EDIB1000 IF NOT EQUAL
.
          CALL      EDBRW000
.
          GOTO      EDIB1000
.
EDIB9999  RETURN
.------------------------------------------------------------
. EDI History (Detail Row) - For Eclipse Bulk Billing
.------------------------------------------------------------
EDBRW000  MOVE      SP70,DIM11
          MATCH     SP70,OTEADATE
          IF        !@EQUAL & !@EOS
            UNPACK    OTEADATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,OTEASTAT,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07
.
          MOVE      SP30,TYPEDESC
          MOVE      OTEATYPE,TYPOFREQ
          LOAD      TYPEDESC,TYPOFREQ,TYPEDBB1,TYPEDBB2,TYPEDBB3,TYPEDBB4:
                                      TYPEDBB5
.
.-------- Type - Data error response (4) OR Transmission Error Response (5)
          IF        TYPOFREQ = 4 | TYPOFREQ = 5
            STRIP     TYPEDESC
            ENDSET    TYPEDESC
            APPEND    SP1,TYPEDESC
            APPEND    OTEAEROR,TYPEDESC
            APPEND    SP20,TYPEDESC
            RESET     TYPEDESC
          ENDIF
.
          MOVE      SP70,DIM30
          PACK      KEY10,OTEAOPER,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      OTEAOPER,DIM30
          ELSE
            MATCH     OTEAOPER,WBSEUID
            IF        @EQUAL
              MOVE      WBSENAM,DIM30
            ELSE
              MOVE      OTEAOPER,DIM30
            ENDIF
          ENDIF
.
          CMATCH    NULL,OTEAEROT
          IF        @EQUAL
            PACK      PREAEROT,SP70,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",DIM11 ,"</td>";
          WRITE     HTMLFILE;"<td>",OTEATIME,"</td>";
          WRITE     HTMLFILE;"<td>",STATDESC,"</td>":
                             "<td>",TYPEDESC,"</td>":
                             "<td>",OTEABATN,"</td>":
                             "<td>",DIM30,"</td>":
                             "<td>",OTEAEROT,"</td>":
                             "</tr>";
.
EDBRW999  RETURN
.
.------------------------------------------------------------
. Table of Eclipse Bulk Billing  Assessment Report
.------------------------------------------------------------
EBAR0000  MATCH     "1",PTCNUEBB
          GOTO      EBAR9999 IF NOT EQUAL
.
          CALL      EBARHD00      * Output Table Heading
.
          PACK      KEY57,OTECTRID,Z70
          CALL      RSOTEAH2
EBAR1000  CALL      RPOTEAH2      * Get Assessment Header - outeahaf
          BRANCH    OVRCD,EBAR9999
.
          MATCH     OTECTRID,OTEHCTID
          GOTO      EBAR9999 IF NOT EQUAL
.
          CALL      EBARRW00
.
          GOTO      EBAR1000
.
EBAR9999  RETURN
.------------------------------------------------------------
. Eclipse Bulk Billing Assessment Report (TABLE HEADING)
.------------------------------------------------------------
EBARHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim Benefit Paid&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Date of Service&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Patient Family Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Patient First Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Card Flag&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Card Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Reference Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Servicing Provider Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Details&nbsp;</td>":
                             "</tr>"
.
EBARHD99  RETURN
.
.------------------------------------------------------------
. Eclipse Bulk Billing Assessment Report (Detail Row)
.------------------------------------------------------------
EBARRW00  MOVE      ZERO,FORM1
.-------- MOVE      "Unknown",ASESDESC
.-------- MOVE      OTEHCFAC,ANS
.-------- REP       "A1R2W3C4",ANS
.-------- MOVE      ANS,FORM1
.------- -LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4
.
          MOVE      ZERO,FORM1
          MOVE      "No Change",MEDSDESC
          MOVE      OTEHMECF,ANS
          REP       "A1I2C3W4S5X6",ANS
          MOVE      ANS,FORM1
          LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
                                   MEDSDES5,MEDSDES6
.
.-------- MOVE      ZERO,FORM2
.-------- MOVE      "UNKNOWN",PRCSDESC 
.-------- MOVE      OTEHSTAT,FORM2 
.-------- LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
.--------                          PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
.--------                          PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
.--------                          PRCSDE10,PRCSDE11
.
          MOVE      ZERO,FORM6P2
          UNPACK    OTEHCLBP,DIM6,DIM2
          PACK      DIM9,DIM6,DOT,DIM2
          MOVE      DIM9,FORM6P2
.
          MOVE      SP70,DIM30
          IF        FORM6P2 = ZERO
            MOVE      "<br>[No Payment Report]",DIM30
          ENDIF
.
          MOVE      ZERO,FORM6P2A
          UNPACK    OTEHCLCA,DIM6,DIM2
          PACK      DIM9,DIM6,DOT,DIM2
          MOVE      DIM9,FORM6P2A
.
          MOVE      SP70,DIM11
          MATCH     SP70,OTEHSDAT
          IF        !@EQUAL & !@EOS
            UNPACK    OTEHSDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td valign=top>",OTEHCLID,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",FORM6P2,DIM30,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",FORM6P2A,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",DIM11,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",OTEHSNAM,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",OTEHFNAM,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",MEDSDESC,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",OTEHMNUM,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",OTEHRNUM,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",OTEHSRVP,"</td>";
.         WRITE     HTMLFILE;"<td valign=top>",OTEHCTID,"</td>";
.
.-------- Service Details
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb01.pbl":
                             "?reportno=08":
                             "&template=004":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&mavmodul=",MAVMODUL:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclclid=",OTEHCLID:
                             "&ecclrptc=",OTEHRPTC:
                             "&ecclrkey=",OTEHRKEY,"#";'>":
                             "</td>":
                             "</tr>";
.
EBARRW99  RETURN
.
.------------------------------------------------------------
. Eclipse Bulk Billing Payment Details (outerhaf)
.------------------------------------------------------------
EBBP0000  PACK      KEY47,OTECHOSP,OTECRKEY,SP70
          CALL      RSOTERH4
EBBP1000  CALL      RKOTERH4
          BRANCH    OVRCD,EBBP4000
.
          MATCH     OTECHOSP,OTERHOSP
          GOTO      EBBP4000 IF NOT EQUAL
.
          MATCH     OTECRKEY,OTERRKEY
          GOTO      EBBP4000 IF NOT EQUAL
.
          GOTO      EBBP5000
.
EBBP4000  CALL      CLOUTERH
.
EBBP5000  PACK      KEY53,OTECTRID,SP70
          CALL      RSOTERD2
          CALL      RKOTERD2
          BRANCH    OVRCD,EBBP9000
.
          MATCH     OTECTRID,OTESTRID
          GOTO      EBBP9000 IF NOT EQUAL 
.
          GOTO      EBBP9999 
.
EBBP9000  CALL      CLOUTERD
.
EBBP9999  RETURN
+
.----------------------------------------------------------------------
. Table of Eclipse Bulk Billing Claim Service and explanation details
.----------------------------------------------------------------------
EBSD0000  MATCH     "1",PTCNUEBB
          GOTO      EBSD9999 IF NOT EQUAL
.
          CALL      EBSDHD00                     * Output Table Heading
.
          PACK      KEY40,ECCLCLID,ECCLRPTC,SP70
          CALL      RSOTEAD1                     * position in file outeadaf
EBSD1000  CALL      RKOTEAD1                     * read next record
          BRANCH    OVRCD,EBSD9999               * end of file
.
          PACK      OTEDCLID,OTEDCLID,SP70
.
          MATCH     ECCLCLID,OTEDCLID            * same claim id ?
          GOTO      EBSD1000 IF NOT EQUAL        * no - finished listing
.
          PACK      OTEDRPTC,OTEDRPTC,SP70
.
          MATCH     ECCLRPTC,OTEDRPTC            * same report counter ?
          GOTO      EBSD1000 IF NOT EQUAL        * no - finished listing
.
          PACK      OTEDRKEY,OTEDRKEY,SP70
.
          MATCH     ECCLRKEY,OTEDRKEY            * same report retrieve key?
          GOTO      EBSD1000 IF NOT EQUAL        * no - finished listing
.
          CALL      EBSDRW00
.
          GOTO      EBSD1000
.
EBSD9999  RETURN
.
.------------------------------------------------------------
. Eclipse Bulk Billing Claim Service Details (TABLE HEADING)
.------------------------------------------------------------
EBSDHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Number of Patients Seen&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Code&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Explanation&nbsp;</td>":
                             "</tr>"

EBSDHD99  RETURN
.------------------------------------------------------------
. Eclipse Bulk Billing Service Details (Detail Row)
.------------------------------------------------------------
EBSDRW00  MOVE      ZERO,FORM7P2C
          UNPACK    OTEDSERB,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
.
          MOVE      SP70,HCEMDESC
.
          MATCH     SP70,OTEDEXPC
          IF        !@EQUAL & !@EOS
            PACK      KEY3,OTEDEXPC,SP70
            CALL      RDHCEMS1
            IF        OVRCD=ONE
              MOVE      "No Description in hicemsaf",HCEMDESC
              PACK      HCEMDESC,HCEMDESC,SP70
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                             "<td valign=top>",OTEDITMN,"</td>":
                             "<td valign=top>",FORM7P2C,"</td>":
                             "<td valign=top>",OTEDNOPA,"</td>":
                             "<td valign=top>",OTEDSRVI,"</td>":
                             "<td valign=top>",OTEDEXPC,"</td>":
                             "<td valign=top>",HCEMDESC,"</td>":
                             "</tr>";
.
EBSDRW99  RETURN
+
.------------------------------------------------------------
. Eclipse Bulk Billing Claim Enquiries
.------------------------------------------------------------
EBBQ0000  MATCH     "1",PTCNUEBB
          GOTO      EBBQ9200 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      EBBQ6000 IF EQUAL

          MATCH     "V",UPDATTYP
          GOTO      EBBQ1000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      EBBQ2000 IF EQUAL
.
          MATCH     "D",UPDATTYP
          GOTO      EBBQ3000 IF EQUAL
.
          MATCH     "P",UPDATTYP
          GOTO      EBBQ4000 IF EQUAL
.
          MATCH     "S",UPDATTYP
          GOTO      EBBQ5000 IF EQUAL
.
          GOTO      EBBQ9000
.
EBBQ1000  CALL      MAVB0000          * Mark as Viewed
          GOTO      EBBQ9999
.
EBBQ2000  CALL      RSEB0000          * Resubmit
          GOTO      EBBQ9999
.
EBBQ3000  CALL      WDEB0000          * Delete waiting
          GOTO      EBBQ9999
.
EBBQ4000  
.         CALL      OTPC0000
          GOTO      EBBQ9999
.
EBBQ5000  
.         CALL      RSET0000
          GOTO      EBBQ9999
.
EBBQ6000  MOVE      TEMPLATE,FORM3
          IF        THREE=FORM3
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,EBBQ9100
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDPMPX21
            BRANCH    OVRCD,EBBQ9100
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE                   * CALCAGE uses PBDATE
.
            CALL      PATLN000
            CALL      PATFLD00                * Use standard Patient Folder sub
.
            MOVE      URNUMBER,FILTURNO
.           MOVE      UNIQNUMB,FILTADMN
.
            IF        ALLHFLAG=0
              COMPARE   ONE,IBCNMHOS
              IF        @EQUAL
                MOVE      TWO,VIEWTYPE
                MOVE      ZERO,EXDTBLNK
              ELSE
                MOVE      ZERO,VIEWTYPE
                MOVE      ONE,EXDTBLNK
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
.
          MOVE      "Eclipse Bulk Billing Claim Enquiry",WEBTITLE
.
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,EBBQ9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      EBBQ9999
.
EBBQ9000  MOVE      "Invalid Form Action.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      EBBQ9999
.
EBBQ9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EBBQ9999
.
EBBQ9200  MOVE      "Not using Eclipse Bulk Billing Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EBBQ9999
.
EBBQ9999  RETURN
+
.------------------------------------------------------------
. Eclipse Bulk Billing Claim Enquiries tags
.------------------------------------------------------------
EBQF0000  BRANCH    FLDITMNO,EBQF0100,EBQF0200,EBQF0300,EBQF0400,EBQF0500:
                             EBQF0600,EBQF0700,EBQF0800,EBQF0900,EBQF1000:
                             EBQF1100,EBQF1200,EBQF1300,EBQF1400,EBQF1500:
                             EBQF1600,EBQF1700,EBQF1800,EBQF1900,EBQF2000:
                             EBQF2100,EBQF2200,EBQF2300,EBQF2400,EBQF2500:
                             EBQF2600,EBQF2700,EBQF2800,EBQF2900
.
          GOTO      EBQF9999
.
EBQF0100  CALL      EBQP0000    * Private Practice - Hospital level enquiry
          GOTO      EBQF9999
.
EBQF0200  WRITE     HTMLFILE;IBCNMHOS;    * Multihospital Indicator
          GOTO      EBQF9999
.
EBQF0300  CALL      HOSPID00              * Hospital ID option field
          GOTO      EBQF9999
.
EBQF0400  CALL      SELHFN00              * Health Fund option field
          GOTO      EBQF9999
.
EBQF0500  WRITE     HTMLFILE;HLFDCLTY;
          GOTO      EBQF9999
.
EBQF0600  MOVE      CATCL,CATEGORY
          MOVE      HLTHFUND,CODE
          CALL      CODITM00
          GOTO      EBQF9999
.
EBQF0700  WRITE     HTMLFILE;EXCLWAIT;
          GOTO      EBQF9999
.
EBQF0800  WRITE     HTMLFILE;FILTURNO;
          GOTO      EBQF9999
.
EBQF0900  WRITE     HTMLFILE;FILTADMN;
          GOTO      EBQF9999
.
EBQF1000  WRITE     HTMLFILE;BATCHNUM;
          GOTO      EBQF9999
.
EBQF1100  WRITE     HTMLFILE;CLAIMSTA;
          GOTO      EBQF9999
.
EBQF1200  WRITE     HTMLFILE;INVNUMBR;
          GOTO      EBQF9999
.
EBQF1300  CALL      SELP0000    * Selects Day, Week or Month from Viewtype
          GOTO      EBQF9999
.
EBQF1400  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      EBQF9999
.
EBQF1500  WRITE     HTMLFILE;EXDTBLNK;
          GOTO      EBQF9999
.
EBQF1600  WRITE     HTMLFILE;HLTHFUND;
          GOTO      EBQF9999
.
EBQF1700  CALL      PRVE0000
          GOTO      EBQF9999
.
EBQF1800  CALL      NXTE0000
          GOTO      EBQF9999
.
EBQF1900  CALL      BATBB000    * Batch header code search
          GOTO      EBQF9999
.
EBQF2000  CALL      PREVBT00
          GOTO      EBQF9999
.
EBQF2100  CALL      NEXTBT00
          GOTO      EBQF9999
.
EBQF2200  
.-------- CALL      ECOT0000
          GOTO      EBQF9999
.
EBQF2300  WRITE     HTMLFILE;PROCSTAT;
          GOTO      EBQF9999
.
EBQF2400  CALL      EBPP0000    * Private Practice - Patient level enquiry
          GOTO      EBQF9999
.
EBQF2500  WRITE     HTMLFILE;EXCLCLOS;
          GOTO      EBQF9999
.
EBQF2600  
.---------CALL      ECSE0000    * Emergency Module - Hosp Level enquiry  
          GOTO      EBQF9999
.
EBQF2700
.---------CALL      ECEP0000    * Emergency Module - Patient level enquiry
          GOTO      EBQF9999
.
EBQF2800  CALL      EBOH0000    * Outpatient Module - Hospital Level enquiry
          GOTO      EBQF9999
.
EBQF2900  CALL      EBOP0000    * Outpatient Module - Patient Level enquiry
          GOTO      EBQF9999
.
EBQF9999  RETURN
+
.----------------------------------------------------------------
. Table of Eclipse Bulk Billing Claim Enquiries Private Practice
.----------------------------------------------------------------
EBQP0000  MATCH     "1",PTCNUEBB
          GOTO      EBQP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      EBQP9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      EBQP9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSOTIBH2                * Eclipse Bulk Billing Batch Header
EBQP0500  CALL      RKOTIBH2
          BRANCH    OVRCD,EBQP2000
          MATCH     OTIBDTBC,LASTDATE
          GOTO      EBQP2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,OTIBBTHN,SP70
          CALL      RSOTECT3
EBQP1000  CALL      RKOTECT3
          BRANCH    OVRCD,EBQP0500
          MATCH     OTIBBTHN,OTECBATN
          GOTO      EBQP0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",OTECMODL
          GOTO      EBQP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,OTECHOSP
              GOTO      EBQP1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,OTECHOSP
                GOTO      EBQP1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      EBQP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      EBQP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   SEVEN,OTECFLAG
            GOTO      EBQP1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        PRECFLAG=ZERO
.             GOTO      EBQP1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,OTECURNO
            GOTO      EBQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,OTECUNIQ
            GOTO      EBQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,OTECBATN
            GOTO      EBQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DOTECFLG
            GOTO      EBQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,OTECINVN
            GOTO      EBQP1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,EBQP1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      EBQP1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      EBQP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY27,OTECINVN,Z70
          CALL      RSOTECA2
          CALL      RPOTECA2
          IF        OVRCD=0
            MATCH     OTECINVN,OTEAINVN
            IF        @EQUAL
              MATCH     " 3",OTEATYPE           * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,OTECFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07
.
          CALL      RSBB0000    * Resubmission BB
.
          CALL      GBBP0000    * Get current invoice outstanding balance
.
          MOVE      OTECURNO,URNUMBER
.         MOVE      OTECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,OTECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,OTECUNIQ,OTECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,EBQP1500
.
          MATCH     OTECUNIQ,DPRDTUNQ
          GOTO      EBQP1500 IF NOT EQUAL
.
          MATCH     OTECINVN,PRDTINVN
          GOTO      EBQP1500 IF NOT EQUAL
.
          GOTO      EBQP1600
.
EBQP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
EBQP1600  REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "8",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    OTECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    OTECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    OTECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    OTECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    OTECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    OTECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",OTECBATN,"#",":
                             "#"",OTECUNIQ,"#",":
                             "#"",OTECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",OTECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",OTECPBAT,"#",":
                             "#"",OTECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,OTECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,OTECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        OTECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      OTECBATN,DIM8
          REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
OTECBATN,"','",OTECUNIQ,"','",OTECURNO,"','",OTECINVN,"','",OTECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      EBQP1000
.
EBQP2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      EBQP9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSOTECT3
EBQP3000  CALL      RKOTECT3
          BRANCH    OVRCD,EBQP9000
          MATCH     SP70,OTECBATN
          GOTO      EBQP9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",OTECMODL
          GOTO      EBQP3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,OTECHOSP
              GOTO      EBQP3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,OTECHOSP
                GOTO      EBQP3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      EBQP3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      EBQP3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        OTECFLAG=SEVEN 
              GOTO      EBQP3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        OTECFLAG=ZERO
              GOTO      EBQP3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,OTECURNO
            GOTO      EBQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,OTECUNIQ
            GOTO      EBQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,OTECBATN
            GOTO      EBQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DOTECFLG
            GOTO      EBQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,OTECINVN
            GOTO      EBQP3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,EBQP1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      EBQP1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      EBQP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY27,OTECINVN,Z70
          CALL      RSOTECA2
          CALL      RPOTECA2
          IF        OVRCD=0
            MATCH     OTECINVN,OTEAINVN
            IF        @EQUAL
              MATCH     " 3",OTEATYPE         * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,OTECFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07

          CALL      RSBB0000       * Resubmission BB claim
.
          CALL      GBBP0000       * Get current invoice Oustanding balance
.
          MOVE      OTECURNO,URNUMBER
.         MOVE      OTECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,OTECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,OTECUNIQ,OTECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,EBQP3500
.
          MATCH     OTECUNIQ,DPRDTUNQ
          GOTO      EBQP3500 IF NOT EQUAL
.
          MATCH     OTECINVN,PRDTINVN
          GOTO      EBQP3500 IF NOT EQUAL
.
          GOTO      EBQP3600
.
EBQP3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
EBQP3600  REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "8",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    OTECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    OTECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    OTECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    OTECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    OTECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    OTECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",OTECBATN,"#",":
                             "#"",OTECUNIQ,"#",":
                             "#"",OTECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",OTECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",OTECPBAT,"#",":
                             "#"",OTECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,OTECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,OTECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        OTECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      OTECBATN,DIM8
          REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
OTECBATN,"','",OTECUNIQ,"','",OTECURNO,"','",OTECINVN,"','",OTECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      EBQP3000
.
EBQP9000
EBQP9999  RETURN
+
.*****************************************************************************
.* Resubmission of Eclipse Bulk Billing claims                               *
.*****************************************************************************
RSBB0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,OTECNBAT                 * next batch blank ?
          GOTO      RSBB9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        OTECFLAG = 7 |OTECFLAG = 3
            GOTO      RSBB1000            * Check OS amount owing
          ELSE
            GOTO      RSBB9000            * Exit
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RSBB1000  PACK      KEY8,OTECINVN,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,RSBB9000
.
          CALL      GBBP0000                 * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSBB9000
          ENDIF
.
          PACK      KEY17,OTECINVN,SP8,TWO,SP70
          CALL      RAOTECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBB9000
          ENDIF
.
          GOTO      RSBB9999
.
RSBB9000  MOVE      ONE,RSUBINDI
RSBB9999  RETURN
.
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries Bulk Billing Patient Level Priv Prac
.------------------------------------------------------------
EBPP0000  MATCH     "1",PTCNUEBB
          GOTO      EBPP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.-------- No Hospital code for Private Practice
          PACK      KEY35,SP3,FILTURNO,SP70
          CALL      RSOTECT5
EBPP1000  CALL      RKOTECT5
          BRANCH    OVRCD,EBPP9999
          MATCH     FILTURNO,OTECURNO
          GOTO      EBPP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",OTECMODL
          GOTO      EBPP1000 IF NOT EQUAL
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,OTECURNO
            GOTO      EBPP9999 IF NOT EQUAL
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      EBPP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      EBPP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        OTECFLAG=ZERO
              GOTO      EBPP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,OTECUNIQ
            GOTO      EBPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,OTECBATN
            GOTO      EBPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DOTECFLG
            GOTO      EBPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,OTECINVN
            GOTO      EBPP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,OTECBATN,SP70
            CALL      RDOTIBH1
            BRANCH    OVRCD,EBPP1000
.
            MATCH     FRSTDATE,OTIBDTBC
            GOTO      EBPP1000 IF LESS
.
            MATCH     OTIBDTBC,LASTDATE
            GOTO      EBPP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,OTECINVN,Z70
          CALL      RSOTECA3
          CALL      RPOTECA3
          IF        OVRCD=0
            MATCH     OTECINVN,OTEAINVN
            IF        @EQUAL
              MATCH     " 3",OTEATYPE        * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,OTECFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07
.
          CALL      RSBB0000    * Resubmission claim
.
          CALL      GBBP0000    * Get current invoice outstanding balance
.
          MOVE      OTECURNO,URNUMBER
.         MOVE      OTECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,OTECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,OTECUNIQ,OTECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,EBPP1500
.
          MATCH     OTECUNIQ,DPRDTUNQ
          GOTO      EBPP1500 IF NOT EQUAL
.
          MATCH     OTECINVN,PRDTINVN
          GOTO      EBPP1500 IF NOT EQUAL
.
          GOTO      EBPP1600
.
EBPP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
EBPP1600  REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "8",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    OTECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    OTECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    OTECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    OTECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    OTECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    OTECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",OTECBATN,"#",":
                             "#"",OTECUNIQ,"#",":
                             "#"",OTECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",OTECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",OTECPBAT,"#",":
                             "#"",OTECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,OTECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,OTECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      OTECBATN,DIM8
          REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
OTECBATN,"','",OTECUNIQ,"','",OTECURNO,"','",OTECINVN,"','",OTECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      EBPP1000
.
EBPP9999  RETURN
+
.------------------------------------------------------------
. Eclipse Bulk Billing Outpatient - Hospital Level Enquiries  
.------------------------------------------------------------
EBOH0000  MATCH     "1",PTCNUEBB
          GOTO      EBOH9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      EBOH9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      EBOH9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSOTIBH2
EBOH0500  CALL      RKOTIBH2
          BRANCH    OVRCD,EBOH2000
          MATCH     OTIBDTBC,LASTDATE
          GOTO      EBOH2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,OTIBBTHN,SP70
          CALL      RSOTECT3
EBOH1000  CALL      RKOTECT3
          BRANCH    OVRCD,EBOH0500
          MATCH     OTIBBTHN,OTECBATN
          GOTO      EBOH0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "3",OTECMODL
          GOTO      EBOH1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,OTECHOSP
              GOTO      EBOH1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,OTECHOSP
                GOTO      EBOH1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      EBOH1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      EBOH1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   SEVEN,OTECFLAG               * Closed status
            GOTO      EBOH1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        PRECFLAG=ZERO
.             GOTO      EBOH1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,OTECURNO
            GOTO      EBOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,OTECUNIQ
            GOTO      EBOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,OTECBATN
            GOTO      EBOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DOTECFLG
            GOTO      EBOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,OTECINVN
            GOTO      EBOH1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,EBOH1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      EBOH1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      EBOH1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,OTECINVN,Z70
          CALL      RSOTECA3
          CALL      RPOTECA3
          IF        OVRCD=0
            MATCH     OTECINVN,OTEAINVN
            IF        @EQUAL
              MATCH     " 3",OTEATYPE       *  Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,OTECFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07
.
          CALL      RBBE0000             * Resubmission Bulk Billing claims  
.
          CALL      GBBE0000             * Get current invoice outstanding balance  
.
          MOVE      OTECURNO,URNUMBER
.         MOVE      OTECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,OTECINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,OTECUNIQ,OTECINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,EBOH1500
.
.         MATCH     OTECUNIQ,DPRDTUNQ
.         GOTO      EBOH1500 IF NOT EQUAL
.
.         MATCH     OTECINVN,PRDTINVN
.         GOTO      EBOH1500 IF NOT EQUAL
.
.         GOTO      EBOH1600
.
EBOH1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
EBOH1600  REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "8",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    OTECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    OTECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    OTECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    OTECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    OTECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    OTECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",OTECBATN,"#",":
                             "#"",OTECUNIQ,"#",":
                             "#"",OTECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.              
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",OTECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",OTECPBAT,"#",":
                             "#"",OTECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,OTECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,OTECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        OTECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      OTECBATN,DIM8
          REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
OTECBATN,"','",OTECUNIQ,"','",OTECURNO,"','",OTECINVN,"','",OTECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      EBOH1000
.
EBOH2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      EBOH9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSOTECT3
EBOH3000  CALL      RKOTECT3
          BRANCH    OVRCD,EBOH9000
          MATCH     SP70,OTECBATN
          GOTO      EBOH9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "3",OTECMODL
          GOTO      EBOH3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,OTECHOSP
              GOTO      EBOH3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,OTECHOSP
                GOTO      EBOH3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      EBOH3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      EBOH3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        OTECFLAG=SEVEN
              GOTO      EBOH3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        OTECFLAG=ZERO
              GOTO      EBOH3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,OTECURNO
            GOTO      EBOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,OTECUNIQ
            GOTO      EBOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,OTECBATN
            GOTO      EBOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DOTECFLG
            GOTO      EBOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,OTECINVN
            GOTO      EBOH3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,EBOH1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      EBOH1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      EBOH1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,OTECINVN,Z70
          CALL      RSOTECA3
          CALL      RPOTECA3
          IF        OVRCD=0
            MATCH     OTECINVN,OTEAINVN
            IF        @EQUAL
              MATCH     " 3",OTEATYPE      * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,OTECFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07
.
          CALL      RBBE0000     * Resubmission Bulk Billing claims
.
          CALL      GBBE0000     * Get current invoice outstanding balance
.
          MOVE      OTECURNO,URNUMBER
.         MOVE      OTECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,OTECINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,OTECUNIQ,OTECINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,EBOH3500
.
.         MATCH     OTECUNIQ,DPRDTUNQ
.         GOTO      EBOH3500 IF NOT EQUAL
.
.         MATCH     OTECINVN,PRDTINVN
.         GOTO      EBOH3500 IF NOT EQUAL
.
.         GOTO      EBOH3600
.
EBOH3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
EBOH3600  REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "8",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    OTECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    OTECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    OTECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    OTECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    OTECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    OTECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",OTECBATN,"#",":
                             "#"",OTECUNIQ,"#",":
                             "#"",OTECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",OTECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",OTECPBAT,"#",":
                             "#"",OTECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,OTECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,OTECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        OTECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      OTECBATN,DIM8
          REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
OTECBATN,"','",OTECUNIQ,"','",OTECURNO,"','",OTECINVN,"','",OTECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      EBOH3000
.
EBOH9000
EBOH9999  RETURN
+
.*****************************************************************************
.* Check resubmission of Eclipe Bulk Billing claim
.*****************************************************************************
RBBE0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,OTECNBAT                 * next batch blank ?
          GOTO      RBBE9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        OTECFLAG = 7 | OTECFLAG = 3
            GOTO      RBBE1000                   * Check OS amount
          ELSE
            GOTO      RBBE9000                   * Exit
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RBBE1000  PACK      KEY8,OTECINVN,SP70
          CALL      RDINV1
          BRANCH    OVRCD,RBBE9000
.
          CALL      GBBE0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PINVAMT > 0)
            GOTO      RBBE9000
          ENDIF
.
          PACK      KEY17,OTECINVN,SP8,ONE,SP70
          CALL      RAOTECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RBBE9000
          ENDIF
.
          GOTO      RBBE9999
.
RBBE9000  MOVE      ONE,RSUBINDI
RBBE9999  RETURN
+
.------------------------------------------------------------
. Eclipse Bulk Billing Outpatient - Patient Level Enquiries  
.------------------------------------------------------------
EBOP0000  MATCH     "1",PTCNUEBB
          GOTO      EBOP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     SP70,HOSPCODE
          IF        @EQUAL
            MOVE      WBSEHOSP,HOSPCODE
          ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSOTECT5
EBOP1000  CALL      RKOTECT5
          BRANCH    OVRCD,EBOP9999
          MATCH     FILTURNO,OTECURNO
          GOTO      EBOP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "3",OTECMODL
          GOTO      EBOP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,OTECHOSP
              GOTO      EBOP9999 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,OTECHOSP
                GOTO      EBOP9999 IF NOT EQUAL
              ENDIF
            ENDIF
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,OTECURNO
              GOTO      EBOP1000 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,OTECURNO
              GOTO      EBOP9999 IF NOT EQUAL
            ENDIF
.
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      EBOP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      EBOP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        OTECFLAG=ZERO
              GOTO      EBOP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,OTECUNIQ
            GOTO      EBOP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,OTECBATN
            GOTO      EBOP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DOTECFLG
            GOTO      EBOP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,OTECINVN
            GOTO      EBOP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,OTECBATN,SP70
            CALL      RDOTIBH1
            BRANCH    OVRCD,EBOP1000
.
            MATCH     FRSTDATE,OTIBDTBC
            GOTO      EBOP1000 IF LESS
.
            MATCH     OTIBDTBC,LASTDATE
            GOTO      EBOP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,OTECINVN,Z70
          CALL      RSOTECA3
          CALL      RPOTECA3
          IF        OVRCD=0
            MATCH     OTECINVN,OTEAINVN
            IF        @EQUAL
              MATCH     " 3",OTEATYPE      *Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,OTECFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07
.
          CALL      RBBE0000          * Resubmission BB claims
.
          CALL      GBBE0000          * Get current invoice outstanding balance
.
          MOVE      OTECURNO,URNUMBER
.         MOVE      OTECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,OTECINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,OTECUNIQ,OTECINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,EBOP1500
.
.         MATCH     OTECUNIQ,DPRDTUNQ
.         GOTO      EBOP1500 IF NOT EQUAL
.
.         MATCH     OTECINVN,PRDTINVN
.         GOTO      EBOP1500 IF NOT EQUAL
.
.         GOTO      EBOP1600
.
EBOP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
EBOP1600  REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb01",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "8",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    OTECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    OTECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    OTECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    OTECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    OTECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    OTECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",OTECBATN,"#",":
                             "#"",OTECUNIQ,"#",":
                             "#"",OTECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",OTECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",OTECPBAT,"#",":
                             "#"",OTECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,OTECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,OTECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",OTECBATN,OTECINVN,OTECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        OTECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",OTECBATN,OTECINVN,OTECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      OTECBATN,DIM8
          REP       " +",OTECURNO
          REP       " +",OTECUNIQ
          REP       " +",OTECBATN
          REP       " +",OTECINVN
          REP       " +",OTECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
OTECBATN,"','",OTECUNIQ,"','",OTECURNO,"','",OTECINVN,"','",OTECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",OTECURNO
          REP       "+ ",OTECUNIQ
          REP       "+ ",OTECBATN
          REP       "+ ",OTECINVN
          REP       "+ ",OTECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      EBOP1000
.
EBOP9999  RETURN
+
.------------------------------------------------------------
. Table of Batch Numbers Bulk Billing
.------------------------------------------------------------
BATBB000  MATCH     "1",PTCNUEBB
          GOTO      BATBB999 IF NOT EQUAL
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BATHB000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70
          CALL      RSOTIBH1                     * position in file
BATBB100  CALL      RPOTIBH1                     * read previous record
          BRANCH    OVRCD,BATBB999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BATBB100
          ENDIF
.
          CALL      BABRW000      * Display Row
          BRANCH    EXIT,BATBB100
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BATBB100 IF NOT EQUAL
.
BATBB999  RETURN
+
.------------------------------------------------------------
. Batch Numbers by Code (TABLE HEADING) Bulk Billing
.------------------------------------------------------------
BATHB000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Batch Number</td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=25%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Date</td>":
                             "<td class=HeadingCell width=15%>":
                             "Time</td>":
.                            "<td class=HeadingCell width=15%>":
.                            "Status</td>":
                             "</tr>"
.
BATHB999  RETURN
+
.------------------------------------------------------------
. Batch Numbers (TABLE ROW) Bulk Billing
.------------------------------------------------------------
BABRW000  MOVE      ZERO,EXIT
          PACK      BTSCHOSP,BTSCHOSP,SP70
.
          UNPACK    OTIBDTBC,CCENT,CYEAR,CMON,CDAY  * Batch Created Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR

          UNPACK    OTIBTMBC,DIM5,ANS,ANS,ANS
.
          MOVE      SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      BABRW500 IF NOT EQUAL
.
          PACK      KEY24,OTIBBTHN,SP30         * get Hospital for given Batch
          CALL      RSOTECT3
          CALL      RKOTECT3
          IF        OVRCD=1
            MOVE      ONE,EXIT
            GOTO      BABRW999
          ENDIF
.
          MATCH     OTIBBTHN,OTECBATN
          IF        @EQUAL
            MOVE      OTECHOSP,KEY3
            CALL      RDPTHSP1            * read Hospital name for visit
            IF        OVRCD=1
              MOVE      OTECHOSP,HOSPNAME
            ELSE
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
.
            MATCH     SP70,BTSCHOSP
            IF        !@EQUAL&!@EOS
              MATCH     BTSCHOSP,OTECHOSP
              IF        !@EQUAL
                MOVE      ONE,EXIT
                GOTO      BABRW999
              ENDIF
            ENDIF
          ELSE
            MOVE      ONE,EXIT
            GOTO      BABRW999
          ENDIF
.
BABRW500  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",OTIBBTHN,"#")'>":
                             OTIBBTHN,"</a></td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",KEY11,"</td>":
                             "<td>",DIM5,"</td>":
                             "</tr>";
.
BABRW999  RETURN
+
.*****************************************************************************
.* Eclipse Bulk Billing - Marked As Viewed                                   *
.*****************************************************************************
.
.         First, get the last EDI History record for this invoice
.
MAVB0000  PACK      KEY27,MAVINVCE,Z70
          CALL      RSOTECA1                     * position on last history rec
MAVB0010  CALL      RPOTECA1                     * read previous record
          BRANCH    OVRCD,MAVB3000               * eof - finished
.
          MATCH     MAVINVCE,OTEAINVN            * same invoice still ?
          GOTO      MAVB3000 IF NOT EQUAL        * no - finished
.
          MATCH     MAVMODUL,OTECMODUL
          GOTO      MAVB0010 IF NOT EQUAL
.
.         Read otectaf
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDOTECT2
          BRANCH    OVRCD,MAVB3000
.
.         The last EDI history record has been found for the invoice, so
.         write a new record, defaulting some of the values from the read
.         record.
.
          MOVE      MAVBATCH,OTEABATN
          MOVE      MAVINVCE,OTEAINVN
          MOVE      MAVMODUL,OTEAMODL
.
MAVB1000  CALL      IBACLOCK                     * get current date/time
          PACK      OTEADATE,CCC,CYY,CMM,CDD
          REP       " 0",OTEADATE
          MOVE      CTIMEIS,OTEATIME
          REP       " 0",OTEATIME
.
          MOVE      " 7",OTEATYPE                * Type - Closed
          MOVE      WBSEUID,OTEAOPER
          MOVE      SP70,OTEASPAR
.
          PACK      KEY27,OTEAINVN,OTEADATE,OTEATIME,OTEATYPE,OTEAMODL,SP70
          CALL      RAOTECA1
          IF        OVRCD = 0
            GOTO      MAVB1000
          ENDIF
.
          CALL      WROTECA1                     * write EDI History record
.
.         If the record has a status of 
.         "Error (SA validation)"
.         then update the status to "Closed", as the claim cannot go any
.         further (unless resubmitted after closing).
.
          IF        OTECFLAG = 3
            PACK      KEY30,OTECHOSP,OTECFLAG,OTECMODL,OTECUNIQ,OTECINVN:
                            OTECBATN,SP70
            CALL      RDOTECT1                   * read selected record
            BRANCH    OVRCD,MAVB3000             * shouldn't happen
.
            MOVE      SEVEN,OTECFLAG             * update to "closed"
            CALL      UPOTECT1
.
.           Also write an EDI History record (outecaaf) for the close
.
            MOVE      OTECINVN,OTEAINVN
            MOVE      OTECBATN,OTEABATN
            MOVE      SEVEN,OTEASTAT            * Status - Closed
            MOVE      " 3",OTEATYPE             * Type - Viewed
            MOVE      WBSEUID,OTEAOPER
            MOVE      OTECTRID,OTEATRID
            MOVE      SP30,OTEASPAR
.
MAVB2000    CALL      IBACLOCK                   * get current time
            PACK      OTEADATE,CCC,CYY,CMM,CDD
            REP       " 0",OTEADATE
            MOVE      CTIMEIS,OTEATIME
            REP       " 0",OTEATIME
.
            PACK      KEY27,OTEAINVN,OTEADATE,OTEATIME,OTEATYPE,OTEAMODL,SP70
            CALL      RAOTECA1
            IF        OVRCD = 1
              CALL      WROTECA1
            ELSE
              GOTO      MAVB2000
            ENDIF
.
            GOTO      MAVB9000
          ELSE
            GOTO      MAVB9000
          ENDIF
.
MAVB3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      MAVB9100
.
MAVB9000  MOVE      ZERO,EXIT
          GOTO      MAVB9999
.
MAVB9100  MOVE      ONE,EXIT
.
MAVB9999  RETURN
+
.*****************************************************************************
.*                               RSEB0000                                    *
.* Eclipse Bulk Billing - Process resubmission selection                     *
.*****************************************************************************
RSEB0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDOTECT2
          BRANCH    OVRCD,RSEB7000
.
.         Check if the record has already been resubmitted
.
          MATCH     SP8,OTECNBAT                 * next batch blank ?
          IF        !@EQUAL
            GOTO      RSEB8000
          ENDIF
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        OTECFLAG = 7 | OTECFLAG = 3
.
            PACK      KEY27,OTECINVN,Z70
            CALL      RSOTECA1
RSEB2100    CALL      RPOTECA1
            BRANCH    OVRCD,RSEB2500
.
            MATCH     OTECINVN,OTEAINVN
            GOTO      RSEB2500 IF NOT EQUAL
.
            MATCH     OTECMODL,OTEAMODL
            GOTO      RSEB2100 IF NOT EQUAL
.
            MATCH     OTECTRID,OTEATRID
            GOTO      RSEB2100 IF NOT EQUAL
.
            COMPARE   THREE,OTEASTAT           * Status - Error SA valdidation
            GOTO      RSEB2100 IF NOT EQUAL
.
            MATCH     " 4",OTEATYPE            * Type - Data Error response
            GOTO      RSEB2100 IF NOT EQUAL
.
            MATCH     "3002",OTEAEROR
            GOTO      RSEB2100 IF NOT EQUAL
.
            MOVE      ZERO,FORM8A
.
            CALL      IBACLOCK
.
            PACK      CURRDATE,CCC,CYY,CMM,CDD
            REP       " 0",CURRDATE
.
            DAYSEP    OTEADATE,CURRDATE,FORM8A
.
            COMPARE   FORM8A,ONE
            GOTO      RSEB2500 IF EQUAL
            GOTO      RSEB2500 IF LESS
.
            GOTO      RSEB7500
.
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RSEB2500  MATCH     "1",OTECMODL
          IF        @EQUAL
.
            PACK      KEY8,OTECINVN,SP70
            CALL      RDINV1
            IF        OVRCD = 1
              GOTO      RSEB6000
            ENDIF
.
            CALL      GBBE0000               * get outstanding inv. balance
.
          ELSE
.
            MATCH     "3",OTECMODL
            IF        @EQUAL
.
              PACK      KEY8,OTECINVN,SP70
              CALL      RDINV1
              IF        OVRCD = 1
                GOTO      RSEB6000
              ENDIF
.
              CALL      GBBE0000               * get outstanding inv. balance
.
            ELSE
.
              PACK      KEY8,OTECINVN,SP70
              CALL      RDPRIN1
              IF        OVRCD = 1
                GOTO      RSEB6000
              ENDIF
.
              CALL      GBBP0000               * get outstanding inv. balance
            ENDIF
.
          ENDIF
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission (CAR 181439)
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSEB5000
          ENDIF
.
          PACK      KEY17,OTECINVN,SP8,OTECMODL,SP70
          CALL      RAOTECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSEB4000
          ENDIF
.
          MOVE      ZERO,OTECFLAG
          MOVE      SP70,OTECBATN
          MOVE      MAVBATCH,OTECPBAT
          MOVE      SP70,OTECNBAT
.         MOVE      SP70,OTECCCFL
          MOVE      SP70,OTECTRID
          MOVE      ZERO,OTECAMTC
.         MOVE      ZERO,OTECAMFP
          MOVE      ZERO,OTECAMTP
          MOVE      SP70,OTECPDAT
          MOVE      SP70,OTECSTAT
.         MOVE      SP70,OTECFTID
          MOVE      SP70,OTECSPAR
.
          PACK      KEY17,OTECINVN,OTECBATN,OTECMODL,SP70
          CALL      RAOTECT2
          IF        OVRCD = 1
            CALL      WROTECT1                   * write record
          ELSE
            GOTO      RSEB4000
          ENDIF
.
.         Update the selected record with the next batch no. of "00000000".
.         The record will either have a status of "closed" already, or
.         "SA Validation Error".  If it's the latter, then update the status to
.         "closed" as well"
.
.         PACK      KEY35,PRECHOSP,TEN9,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.         CALL      RDPRECT1
.         IF        OVRCD = 1
.    PACK      KEY35,PRECHOSP,SP1,THREE,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.           CALL      RDPRECT1
.           IF        OVRCD = 1
.             GOTO      RSEB3000
.           ELSE
.             MOVE      TEN9,PRECFLAG            * set status to closed
.           ENDIF
.         ENDIF
.
          PACK      KEY17,OTECINVN,MAVBATCH,MAVMODUL,SP70
          CALL      RDOTECT2
          IF        OVRCD = 1
            CALL      RSEB3000                   * write record
          ELSE
            MOVE      SEVEN,OTECFLAG             * set status to closed
          ENDIF
.
          MOVE      "00000000",OTECNBAT
          CALL      UPOTECT2
.
          GOTO      RSEB9999
.
RSEB3000  CLEAR     WEBTITLE
          APPEND    "Error updating Invoice ",WEBTITLE
          APPEND    OTECINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    OTECBATN,WEBTITLE
          APPEND    " Module ",WEBTITLE
          APPEND    OTECMODL,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSEB9000
.
RSEB4000  MOVE      "Invoice already waiting for extraction.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSEB9000
.
RSEB5000  MOVE      "Claim fully paid.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSEB9000
.
RSEB6000  CLEAR     WEBTITLE
          APPEND    "Invoice ",WEBTITLE
          APPEND    OTECINVN,WEBTITLE
          APPEND    " not found.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSEB9000
.
RSEB7000  MOVE      "Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSEB9000
.
RSEB7500  MOVE      "Error 3002. Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSEB9000
.
RSEB8000  MOVE      "Invoice already resubmitted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSEB9000
.
RSEB9000  MOVE      ONE,EXIT
RSEB9999  RETURN
+
.*****************************************************************************
.*                               WDEB0000                                    *
.* Eclipse Bulk Billing - Delete waiting claims                              *
.*****************************************************************************
WDEB0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDOTECT2
          BRANCH    OVRCD,WDEB8000
.
          MOVE      OTECINVN,TEMPINVN
          MOVE      OTECBATN,TEMPBATN
          MOVE      OTECUNIQ,TEMPADMN
          MOVE      OTECURNO,TEMPURNO
          MOVE      OTECMODL,TEMPMODL
          MOVE      OTECPBAT,TEMPPBAT
          MOVE      OTECHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      WDEB1000 IF EQUAL
          GOTO      WDEB1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,SP1,FIVE,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDOTECT1
          IF        OVRCD = 1
            GOTO      WDEB7000
          ELSE
            MOVE      SP70,OTECNBAT
            CALL      UPOTECT1
          ENDIF
.
.         Delete the selected record
.
WDEB1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEOTECT1
.
          GOTO      WDEB9999
.
WDEB7000  CLEAR     WEBTITLE
          APPEND    "Error updating previous claim ",WEBTITLE
          APPEND    OTECINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    OTECBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      WDEB9000
.
WDEB8000  MOVE      "Record cannot be deleted.",WEBTITLE
          CALL      WEBERR00
          GOTO      WDEB9000
.
WDEB9000  MOVE      ONE,EXIT
WDEB9999  RETURN
+
.------------------------------------------------------------
. Next Day, Week, Month
.------------------------------------------------------------
NEXT0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          WRITE     HTMLFILE;"eclweb01.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&viewtype=",VIEWTYPE:
                             "&hlthfund=",HLTHFUND:
                             "&hlfdclty=",HLFDCLTY:
                             "&procstat=",PROCSTAT;
.
NEXT9999  RETURN
+
.------------------------------------------------------------
. Previous Day, Week, Month
.------------------------------------------------------------
PREV0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          WRITE     HTMLFILE;"eclweb01.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&viewtype=",VIEWTYPE:
                             "&hlthfund=",HLTHFUND:
                             "&hlfdclty=",HLFDCLTY:
                             "&procstat=",PROCSTAT;
.
PREV9999  RETURN
+
.------------------------------------------------------------
. Medicare WebServices PRODA Management
.------------------------------------------------------------
PRDA0000  MATCH     "1",PTCNWSIN
          GOTO      PRDA9160 IF NOT EQUAL
.
          CALL      PROPN000
.
          MATCH     "1",PRODAIND
          GOTO      PRDA9100 IF EQUAL
.
          MATCH     "2",PRODAIND
          GOTO      PRDA9120 IF EQUAL
.
          MATCH     "3",PRODAIND
          GOTO      PRDA9130 IF EQUAL
.
          MATCH     "4",PRODAIND
          GOTO      PRDA9140 IF EQUAL
.
          MATCH     "5",PRODAIND
          GOTO      PRDA9150 IF EQUAL
.
          OPEN      WBSPROPF,PRDAPATH
          OPEN      WBSACTVF,ACTVPATH
          OPEN      WBSTOKNF,TOKNPATH
          OPEN      WBSACTOF,ACTOPATH
          OPEN      WBSTOKOF,TOKNPATH
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      PRDA6000 IF EQUAL

          MATCH     "U",UPDATTYP
          GOTO      PRDA1000 IF EQUAL
.
          MATCH     "A",UPDATTYP
          GOTO      PRDA2000 IF EQUAL
.
          MATCH     "G",UPDATTYP
          GOTO      PRDA3000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      PRDA4000 IF EQUAL
.
          GOTO      PRDA9000
.
PRDA1000  CALL      CLWBSR00
          CALL      MVWBSR00           
.
          CALL      WRWBSR00     
.
          GOTO      PRDA9999
.
PRDA2000  CLEAR     CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_PRODA_run ActivateDevice ",CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          GOTO      PRDA9999
.
PRDA3000  CLEAR     CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_PRODA_run GetAccessToken ",CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          GOTO      PRDA9999
.
PRDA4000  CLEAR     CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_PRODA_run RefreshKeyDevice ",CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          GOTO      PRDA9999
.
PRDA6000  CALL      RDWBSR00
.
          CLEAR     WEBTITLE
          MOVE      "Medicare WebServices PRODA Management",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,PRDA9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      PRDA9999
.
PRDA9000  MOVE      "Invalid Form Action.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      CLMT9999
.
PRDA9100  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    PRDAPATH,WEBTITLE 
          RESET     WEBTITLE      
.
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      CLMT9999
.
PRDA9120  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    ACTVPATH,WEBTITLE
          RESET     WEBTITLE
.
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      CLMT9999
.
PRDA9130  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    TOKNPATH,WEBTITLE
          RESET     WEBTITLE
.
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      CLMT9999
.
PRDA9140  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    ACTOPATH,WEBTITLE
          RESET     WEBTITLE
.
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      CLMT9999
.
PRDA9150  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    TOKOPATH,WEBTITLE
          RESET     WEBTITLE
.
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      CLMT9999
.
PRDA9160  MOVE      "Not Using Medicare WebServices.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      CLMT9999
.
PRDA9999  CLOSE      WBSPROPF
          CLOSE      WBSACTVF
          CLOSE      WBSTOKNF
          CLOSE      WBSACTOF
          CLOSE      WBSTOKOF
          RETURN
+
.------------------------------------------------------------
. Read WebServices PRODA properties file
.------------------------------------------------------------
RDWBSR00  READ      WBSPROPF,SEQ;WBSPILAB,WBSPROID
          READ      WBSPROPF,SEQ;WBSJKLAB,WBSJKSLO
          READ      WBSPROPF,SEQ;WBSPOLAB,WBSPRORG
          READ      WBSPROPF,SEQ;WBSDNLAB,WBSDVNAM
          READ      WBSPROPF,SEQ;WBSCILAB,WBSCLIID
          READ      WBSPROPF,SEQ;WBSATLAB,WBSACTAU
          READ      WBSPROPF,SEQ;WBSACLAB,WBSACTVC
          READ      WBSPROPF,SEQ;WBSDALAB,WBSDACUR
          READ      WBSPROPF,SEQ;WBSDULAB,WBSDAUUR
          READ      WBSPROPF,SEQ;WBSRDLAB,WBSRDKUR
.
RDWBSR99  RETURN
+
.------------------------------------------------------------
. Write WebServices PRODA properties file
.------------------------------------------------------------
WRWBSR00  STRIP     WBSPROID
          STRIP     WBSJKSLO
          STRIP     WBSPRORG
          STRIP     WBSDVNAM
          STRIP     WBSCLIID
          STRIP     WBSACTAU
          STRIP     WBSACTVC
          STRIP     WBSDACUR
          STRIP     WBSDAUUR
          STRIP     WBSRDKUR
.
          WRITE     WBSPROPF,SEQ;WBSPILAB,WBSPROID
          WRITE     WBSPROPF,SEQ;WBSJKLAB,WBSJKSLO
          WRITE     WBSPROPF,SEQ;WBSPOLAB,WBSPRORG
          WRITE     WBSPROPF,SEQ;WBSDNLAB,WBSDVNAM
          WRITE     WBSPROPF,SEQ;WBSCILAB,WBSCLIID
          WRITE     WBSPROPF,SEQ;WBSATLAB,WBSACTAU
          WRITE     WBSPROPF,SEQ;WBSACLAB,WBSACTVC
          WRITE     WBSPROPF,SEQ;WBSDALAB,WBSDACUR
          WRITE     WBSPROPF,SEQ;WBSDULAB,WBSDAUUR
          WRITE     WBSPROPF,SEQ;WBSRDLAB,WBSRDKUR
.
WRWBSR99  RETURN
+
.------------------------------------------------------------
.  WebServices PRODA Tags
.------------------------------------------------------------
PRTG0000  BRANCH    FLDITMNO,PRTG0100,PRTG0200,PRTG0300,PRTG0400,PRTG0500:
                             PRTG0600,PRTG0700,PRTG0800,PRTG0900,PRTG1000:
                             PRTG1100,PRTG1200,PRTG1300,PRTG1400,PRTG1500:
                             PRTG1600,PRTG1700,PRTG1800,PRTG1900
.
          GOTO      PRTG9999
.
PRTG0100  WRITE     HTMLFILE;WBSPROID;
          GOTO      PRTG9999
.
PRTG0200  WRITE     HTMLFILE;WBSJKSLO;
          GOTO      PRTG9999
.
PRTG0300  WRITE     HTMLFILE;WBSPRORG;
          GOTO      PRTG9999
.
PRTG0400  WRITE     HTMLFILE;WBSDVNAM;
          GOTO      PRTG9999
.
PRTG0500  WRITE     HTMLFILE;WBSCLIID;
          GOTO      PRTG9999
.
PRTG0600  WRITE     HTMLFILE;WBSACTAU;
          GOTO      PRTG9999
.
PRTG0700  WRITE     HTMLFILE;WBSACTVC;
          GOTO      PRTG9999
.
PRTG0800  CALL      PRDACT00
          GOTO      PRTG9999
.
PRTG0900  CALL      PRDTKN00
          GOTO      PRTG9999
.
PRTG1000  CALL      PRDACO00
          GOTO      PRTG9999
.
PRTG1100  CALL      PRDTKO00
          GOTO      PRTG9999
.
PRTG1200  WRITE     HTMLFILE;WBSDACUR;
          GOTO      PRTG9999
.
PRTG1300  WRITE     HTMLFILE;WBSDAUUR;
          GOTO      PRTG9999
.
PRTG1400  WRITE     HTMLFILE;WBSRDKUR;
          GOTO      PRTG9999
.
PRTG1500  WRITE     HTMLFILE;PRDAPATH;
          GOTO      PRTG9999
.
PRTG1600  WRITE     HTMLFILE;ACTVPATH;
          GOTO      PRTG9999
.
PRTG1700  WRITE     HTMLFILE;TOKNPATH;
          GOTO      PRTG9999
.
PRTG1800  WRITE     HTMLFILE;ACTOPATH;
          GOTO      PRTG9999
.
PRTG1900  WRITE     HTMLFILE;TOKOPATH;
          GOTO      PRTG9999
.
PRTG9999  RETURN
+
.------------------------------------------------------------
.  Move spaces to WebServices variables
.------------------------------------------------------------
CLWBSR00  MOVE      SP70,WBSPROID
          MOVE      SP70,WBSJKSLO
          MOVE      SP70,WBSPRORG
          MOVE      SP70,WBSDVNAM
          MOVE      SP70,WBSCLIID
          MOVE      SP70,WBSACTAU
          MOVE      SP70,WBSACTVC
          MOVE      SP70,WBSDACUR 
          MOVE      SP70,WBSDAUUR 
          MOVE      SP70,WBSRDKUR 
.
CLWBSR99  RETURN
+
.------------------------------------------------------------
.   Set Parameters for WebServices PRODA variables
.------------------------------------------------------------
SWBSR000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SWBSR010,SWBSR020,SWBSR030,SWBSR040,SWBSR050:
                       SWBSR060,SWBSR070,SWBSR080,SWBSR090,SWBSR100
.
          MOVE      ONE,EXIT
          GOTO      SWBSR999

SWBSR010  PACK      WBSRV001,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR020  PACK      WBSRV002,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR030  PACK      WBSRV003,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR040  PACK      WBSRV004,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR050  PACK      WBSRV005,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR060  PACK      WBSRV006,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR070  PACK      WBSRV007,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR080  PACK      WBSRV008,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR090  PACK      WBSRV009,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR100  PACK      WBSRV010,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR999  RETURN
+
.------------------------------------------------------------
.  Move WebServices cgi variables to text file variables
.------------------------------------------------------------
MVWBSR00  MOVE      WBSRV001,WBSPROID
          MOVE      WBSRV002,WBSJKSLO
          MOVE      WBSRV003,WBSPRORG
          MOVE      WBSRV004,WBSDVNAM
          MOVE      WBSRV005,WBSCLIID
          MOVE      WBSRV006,WBSACTAU
          MOVE      WBSRV007,WBSACTVC
          MOVE      WBSRV008,WBSDACUR
          MOVE      WBSRV009,WBSDAUUR
          MOVE      WBSRV010,WBSRDKUR
.
MVWBSR99  RETURN
+
.------------------------------------------------------------
.  Display Activate Device Response from Medicarwe PRODA
.------------------------------------------------------------
PRDACT00  OPEN      WBSACTVF,ACTVPATH
.
PRDACT10  PACK      VAR,SP70,SP70
          READ      WBSACTVF,SEQ;VAR
          GOTO      PRDACT99 IF OVER
.
          WRITE     HTMLFILE;VAR                    
.
          GOTO      PRDACT10
.
PRDACT99  CLOSE     WBSACTVF
          RETURN
+
.------------------------------------------------------------
.  Display Activate Device Standard Out from Medicare PRODA
.------------------------------------------------------------
PRDACO00  OPEN      WBSACTOF,ACTOPATH
.
PRDACO10  READ      WBSACTOF,SEQ;DIM100,DIM100A
          GOTO      PRDACO99 IF OVER
.
          WRITE     HTMLFILE;DIM100,DIM100A
.
          GOTO      PRDACO10
.
PRDACO99  CLOSE     WBSACTOF
          RETURN
+
.------------------------------------------------------------
.  Display Get Access Token Standard Out from Medicare PRODA
.------------------------------------------------------------
PRDTKO00  OPEN      WBSTOKOF,TOKOPATH
.
PRDTKO10  READ      WBSTOKOF,SEQ;DIM100,DIM100A
          GOTO      PRDTKO99 IF OVER
.
          WRITE     HTMLFILE;DIM100,DIM100A
.
          GOTO      PRDTKO10
.
PRDTKO99  CLOSE     WBSTOKOF
          RETURN
+
.------------------------------------------------------------
.  Display Access Token Response from Medicarwe PRODA
.------------------------------------------------------------
PRDTKN00  OPEN      WBSTOKNF,TOKNPATH
.
PRDTKN10  READ      WBSTOKNF,SEQ;VAR
          GOTO      PRDTKN99 IF OVER
.
          SCAN      "access_token",VAR
          GOTO      PRDTKN50 IF EQUAL
.
          WRITE     HTMLFILE;VAR
.
          GOTO      PRDTKN10
.
PRDTKN50  CLOSE     WBSTOKNF
          OPEN      WBSTOKNF,TOKNPATH
.
          READ      WBSTOKNF,SEQ;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                                 DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
          GOTO      PRDTKN99 IF OVER
.
          WRITE     HTMLFILE;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                             DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
.
PRDTKN99  CLOSE     WBSTOKNF
          RETURN
+
.------------------------------------------------------------
.  Open PRODA Text Files
.------------------------------------------------------------
PROPN000  CLEAR     PRDAPATH
          APPEND    PTCNWSDR,PRDAPATH
          RESET     PRDAPATH
          STRIP     PRDAPATH
          ENDSET    PRDAPATH
          APPEND    SLASH,PRDAPATH
          APPEND    PRDAFILE,PRDAPATH
          RESET     PRDAPATH
.
          MOVE      ZERO,PRODAIND
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSPROPF,PRDAPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,PRODAIND
            GOTO      PROPN500
          ENDIF
          CLOSE     WBSPROPF
.
          CLEAR     ACTVPATH
          APPEND    PTCNWSDR,ACTVPATH
          RESET     ACTVPATH
          STRIP     ACTVPATH
          ENDSET    ACTVPATH
          APPEND    SLASH,ACTVPATH
          APPEND    ACTVFILE,ACTVPATH
          RESET     ACTVPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSACTVF,ACTVPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      TWO,PRODAIND
            GOTO      PROPN500
          ENDIF
          CLOSE     WBSACTVF
.
          CLEAR     TOKNPATH
          APPEND    PTCNWSDR,TOKNPATH
          RESET     TOKNPATH
          STRIP     TOKNPATH
          ENDSET    TOKNPATH
          APPEND    SLASH,TOKNPATH
          APPEND    TOKNFILE,TOKNPATH
          RESET     TOKNPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSTOKNF,TOKNPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      THREE,PRODAIND
            GOTO      PROPN500
          ENDIF
          CLOSE     WBSTOKNF
.
          CLEAR     ACTOPATH
          APPEND    PTCNWSDR,ACTOPATH
          RESET     ACTOPATH
          STRIP     ACTOPATH
          ENDSET    ACTOPATH
          APPEND    SLASH,ACTOPATH
          APPEND    ACTOFILE,ACTOPATH
          RESET     ACTOPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSACTOF,ACTOPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      FOUR,PRODAIND
            GOTO      PROPN500
          ENDIF
          CLOSE     WBSACTOF
.
          CLEAR     TOKOPATH
          APPEND    PTCNWSDR,TOKOPATH
          RESET     TOKOPATH
          STRIP     TOKOPATH
          ENDSET    TOKOPATH
          APPEND    SLASH,TOKOPATH
          APPEND    TOKOFILE,TOKOPATH
          RESET     TOKOPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSTOKOF,TOKOPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      FIVE,PRODAIND
            GOTO      PROPN500
          ENDIF
          CLOSE     WBSTOKOF
.
PROPN500
.
PROPN999  RETURN
.*****************************************************************************
          INC       ACCDIAIO/INC
          INC       APSMASIO/INC
          INC       ARCVX1IO/INC
          INC       BOKDIAIO/INC
          INC       BOKRC1IO/INC
          INC       BOKRX1IO/INC
          INC       EMRICDIO/INC
          INC       EMRUNKIO/INC
          INC       EMRVISIO/INC
          INC       EMRECTIO/INC
          INC       EMRECAIO/INC
          INC       EMRIBHIO/INC
          INC       HICEMSIO/INC
          INC       MLTSECIO/INC
          INC       OUTEADIO/INC
          INC       OUTEAHIO/INC
          INC       OUTECAIO/INC
          INC       OUTECTIO/INC
          INC       OUTERHIO/INC
          INC       OUTERDIO/INC
          INC       OUTIBHIO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PATDGWIO/INC
          INC       PATCHCIO/INC
          INC       VISMDTIO/INC
          INC       VISMTXIO/INC
          INC       PATDO1IO/INC
          INC       PATFACIO/INC
          INC       PATDSCIO/INC
          INC       PATFLTIO/INC
          INC       PATPEIIO/INC
          INC       PATIN1IO/INC
          INC       PATITMIO/INC
          INC       PATMA1IO/INC
          INC       PATMMBIO/INC
          INC       PATPA1IO/INC
          INC       PATPR1IO/INC
          INC       PATMI1IO/INC
          INC       PATRE1IO/INC
          INC       PATRGMIO/INC
          INC       PATTRNIO/INC
          INC       PATVISIO/INC
          INC       NZPSPRIO/INC
.         INC       MEHVI1IO/INC
.         INC       MEHLEGIO/INC
          INC       PATWR1IO/INC
          INC       PATWC1IO/INC
          INC       PMSCLTIO/INC
          INC       PMSWX1IO/INC
          INC       ACCCMTIO/INC   * ACC Comments File
          INC       ACCLODIO/INC   * ACC Claim Lodgements
          INC       PMSTLEIO/INC            * Patient Titles table
          INC       PMSWORIO/INC
          INC       PATWVEIO/INC
          INC       PMSEVTIO/INC
          INC       PATEORIO/INC
          INC       PATFN1IO/INC
          INC       OUTBOAIO/INC
          INC       OUTCANIO/INC
          INC       OUTRSHIO/INC
          INC       OUTBB1IO/INC
          INC       OUTMA1IO/INC
          INC       OUTHEDIO/INC
          INC       OUTSITIO/INC
          INC       OUTSESIO/INC
          INC       OUTCLIIO/INC
          INC       OUTCTYIO/INC
          INC       MRTAUCIO/INC
          INC       MRTLOCIO/INC
          INC       MRTMASIO/INC
          INC       MRTHISIO/INC
          INC       MRTSTFIO/INC
          INC       MRTPDSIO/INC
          INC       MRTVISIO/INC 
          INC       PATECOIO/INC
          INC       PATECDIO/INC
          INC       PATGSRIO/INC
          INC       PATICDIO/INC
          INC       PATICOIO/INC
          INC       PATICUIO/INC
          INC       PATINVIO/INC
          INC       PATNIDIO/INC
          INC       PATALRIO/INC
          INC       PATPGRIO/INC
          INC       PATVADIO/INC
          INC       RESLNKIO/INC
          INC       PATW11IO/INC                                       *I-43498
          INC       PATW12IO/INC            * WIES12                   *I-51504
          INC       PTW12BIO/INC            * WIES12B
          INC       PATW13IO/INC            * WIES13
          INC       PATW14IO/INC            * WIES14                  *I-145161
          INC       PATW15IO/INC            * WIES15
          INC       PATW16IO/INC            * WIES16
          INC       PATW17IO/INC            * WIES17
          INC       PATWMAIO/INC
.         INC       PMSCDNIO/INC
          INC       PMSCTCIO/INC
          INC       PMSOVRIO/INC
          INC       PMSOVVIO/INC
.
..          INC       PMSHCGIO/INC
..          INC       PMSHCPIO/INC
.
          INC       PMSPX2IO/INC
..          INC       WATSUSIO/INC
          INC       BOKRECTM
          INC       CLPMSVX1
          INC       DGCLICAC
          INC       DGCLICEC
          INC       DGCLICOB
          INC       GCCARD00
          INC       NZPSPRTM
          INC       PATDOCTM
..          INC       PATDOCCD
          INC       PATNAMCD
          INC       PMIGTNID
          INC       PMSHCGTM
          INC       PMSHCPTM
          INC       PATMASTM
          INC       CLPMSPX2
          INC       CLPMSRES
          INC       PMSPX2TM
          INC       PATMSXTM
          INC       PATMISTM
          INC       PATCLMTM
          INC       PATRE1TM                * Person Responsible for Account
          INC       PATVISTM
          INC       PATDSCTM
          INC       PRIHRETM
          INC       PMSCLTTM
          INC       OBSCNATM
          INC       OBSDIATM
          INC       NAMSTRCD
          INC       IBAWEBCD
          INC       GETDRG
          INC       CALCAGE
          INC       OBSCNAPR
          INC       CLPATMAS
          INC       CLPATMIS
          INC       CLPATDSC
          INC       CLPATDOC
          INC       CLPATVIS
          INC       CLOUTERH
          INC       CLOUTERD
          INC       CLWEBB2B
          INC       DAYOFWEK
          INC       DGCLICUP
.         INC       PMSCDNDS
          INC       WEBB2BTM
.
          INC       PATASFIO/INC
          INC       PATSFAIO/INC
          INC       PATDADIO/INC
          INC       PMSAIDIO/INC
          INC       PMSCCDIO/INC   * Concession Card Details
          INC       PMSVX1IO/INC
          INC       AAEDI1IO/INC
          INC       AAEDE1IO/INC
          INC       PATHSPIO/INC
          INC       OUTDIAIO/INC
          INC       OUTRF1IO/INC
          INC       ALLREFIO/INC
          INC       ALLRLNIO/INC
          INC       ALLENCIO/INC
          INC       WATTR1IO/INC
          INC       WATTX1IO/INC
          INC       ALLDEPIO/INC
          INC       OPRDEAIO/INC
          INC       PATCMCIO/INC
          INC       PATCFAIO/INC
          INC       PATUNAIO/INC
          INC       PATMESIO/INC
          INC       PATFX1IO/INC
          INC       PRIPRAIO/INC
          INC       PRISECIO/INC
          INC       PRIALSIO/INC
          INC       PRIECTIO/INC
          INC       PRIECAIO/INC
          INC       PRIEAHIO/INC
          INC       PRIEADIO/INC
          INC       PRIESHIO/INC
          INC       PRIESDIO/INC
          INC       PRIINVIO/INC
          INC       PMSECOIO/INC
          INC       PMSETRIO/INC
          INC       PRIIBHIO/INC
          INC       PRIHDBIO/INC                 * holding header file
          INC       PRIHREIO/INC                 * holding referral file
          INC       PRIDTRIO/INC
.
.        ******* HPS BLR INCLUDE ENDS HERE          ************
.
          INC       WEBDATCD
          INC       CLPMSNUT
          INC       CLPMSCLT
          INC       PATFFLAB
          INC       PMSNUTIO/INC
          INC       PMSRESIO/INC
          INC       PMSNUTTM     
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       CLNHIMAS
          INC       OBSRESIO/INC
          INC       OBSPHYIO/INC
          INC       OBSCALIO/INC
          INC       OBSDITIO/INC
          INC       OBSMEDIO/INC
          INC       OBSPINIO/INC
          INC       OBSCNCIO/INC
          INC       OBSCNAIO/INC
          INC       OBSCNBIO/INC
          INC       OBSDIAIO/INC
          INC       OBSBPHIO/INC
          INC       OBSBHIIO/INC
          INC       OBSLABIO/INC
          INC       OBSPROIO/INC
          INC       OBSREAIO/INC
          INC       VISPAYIO/INC
          INC       ALLCASIO/INC
          INC       WEBB2BIO/INC
.
          INC       TMPALIIO/INC
          INC       PMSEDGIO/INC       * Effective DRG Dates
          INC       NZHISWIO
          INC       AAEMASTM
          INC       CLOUTHED
          INC       GETEFDRG

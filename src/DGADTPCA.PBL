.**************************************************************************
.*  DGADTPCA  :  Cancel a Pre-Admission from a Datagate request           *
.*               ~~~~~~~~~~~~~~~~~~~~~~                                   *
.*                                                                        *
.*  Author    :  Davin Sloan  (16/04/2002)                                *
.*                                                                        *
.*  Mods      :                                                           *
.*                                                                        *
.*  V12.00.01 30/05/2025  Ebon Clements    TSK 0955096                    *
.*            Alphanueric visit number changes                            *
.*  V11.03.01 20/03/2023  Ebon Clements    TSK 0909393                    *
.*            Added SESNHOSP and SAVKEY23                                 *
.*  V10.06.01 10/06/2015  Steve Armstrong  CAR 313856                     *
.*            Included CLVISIAU for PATCHPRE                              *
.**************************************************************************
.*   V9.03.01 19/12/03 J.Tan   CAR 44093                                  *
.*            Removed patcashf file                                       *
.**************************************************************************
          DEFPROC   DGADTPCA
.
          INC       BOKDIAFD/INC
          INC       BOKRX1FD/INC
          INC       BOKSTAFD/INC
          INC       EOCLNKFD/INC
          INC       OPRDEAFD/INC
          INC       OPRDEBFD/INC
          INC       OPRDECFD/INC
          INC       OPRSESFD/INC
          INC       PATPNIFD/INC
          INC       PATWC1FD/INC
          INC       PATWMAFD/INC
          INC       PATWVEFD/INC
          INC       VISIAUFD/INC
          INC       VISINTFD/INC
          INC       WATCATFD/INC
.
ADJSTART  FORM     "1"
CANADMIS  DIM       1
.
CASE01    FORM      3
CASE02    FORM      3
CASE03    FORM      3
CASE04    FORM      3
CASE05    FORM      3
CASE06    FORM      3
CASE07    FORM      3
CASE08    FORM      3
CASE09    FORM      3
CASE10    FORM      3
CASE11    FORM      3
CASE12    FORM      3
CASE13    FORM      3
CASE14    FORM      3
.
CASETO    DIM       3
CASEFROM  DIM       3
CENDTME   DIM       5
CPADM001  DIM       3
CPADM002  DIM       1
CPADM003  DIM       3
CPADM004  DIM       3
CPADM006  DIM       3
CPADM007  DIM       3
CURBKTYP  DIM       3
CURCASE   FORM      3
CURPOS    FORM      2
CURSESS   DIM       22
DURATION  FORM      7
EXPDURA   FORM      5
EXPSTART  DIM       5
.
FORM6P2   FORM      6.2
FORM8     FORM      8
INTAUDTY  DIM       1
PATCANAD  DIM       3
PTMIS003  DIM       3
REPLY     DIM       3
SAVANAE   DIM       3
SAVASTA   DIM       1
SAVBOOK   DIM       8
SAVCANC   DIM       3
SAVCASE   FORM      1
SAVCLIN   DIM       6
SAVCOMM   DIM       40
SAVDES3   DIM       55
SAVEF10   FORM      10
SAVEXPD   FORM      4
SAVEXPS   DIM       5
SAVKEY20  DIM       20
SAVKEY23  DIM       23
SAVPRV1   DIM       1
SAVPRV2   DIM       1
SAVPRV3   DIM       1
SAVTHET   DIM       6
SAVPRE1   DIM       5
SAVPRE2   DIM       5
SAVPRE3   DIM       5
SAVPRE4   DIM       5
SAVPRE5   DIM       5
SAVPOS1   DIM       5
SAVPOS2   DIM       5
SAVPOS3   DIM       5
SAVPOS4   DIM       5
SAVTDUR   FORM      4
SAVKNOW   DIM       3
SAVSTAT   FORM      1
SAVEQR1   DIM       3
SAVEQR2   DIM       3
SAVEQR3   DIM       3
SAVLEQR   DIM       3
SAVTRAN   DIM       3
SAVTYPE   DIM       3
SAVUNIQ   DIM       10
SAVUSR1   DIM       3
SAVUSR2   DIM       3
SAVUSR3   DIM       3
SAVUSR4   DIM       3
SAVWAIT   DIM       1
SESNCODE  DIM       6
SESNHOSP  DIM       3
SESNDATE  DIM       8
SESNTIME  DIM       5
STARTIME  DIM       5
WTCNUSBC  FORM      1
.
.*************************************************************************
.*  DGPCA000  :  Process datagate Admission message                      *
.*************************************************************************
DGPCA000  MOVE      "PCA",RPLYHEAD
.         CALL      INIT0000                * open some files
.         CALL      CLEAR000                * clear some fields
.
          MOVE      ZERO,OVRCD
          READ      DGATEOUT;AURNO,AADMNO,ACANCEL,DATETIME
.
. Get ready for call to cancel pre-admission code
.
          MOVE      AADMNO,ADMISSNO
          MOVE      ACANCEL,PTMIS003
.
. cancel pre-admission
.
          CALL      CPADM000                * (validation included here)
          BRANCH    EXIT,DGPCA900           * errors detected
.
. send reply message as successful
.
          MOVE      "00000",RPLYCODE        * successful message
          MOVE      SP50,RPLYDESC           * clear error description
          PACK      CCENCODE,CCDATE,CCDST,CCSRC,CCNAME,REPLYRPL
          WRITE     DGATEIN;CCENCODE:
                            RPLYHEAD,RPLYCODE,RPLYDESC:
                            DGMISC1,DGMISC2,DGMISC3
.
          ADD       ONE,SUCCPROC            * increm # success transactns
          GOTO      DGPCA999
.
. --- send back an Error response ---
.
DGPCA900  MOVE      WEBTITLE,RPLYDESC       * RPLYCODE set up in PATCHPRE
.
          PACK      CCENCODE,CCDATE,CCDST,CCSRC,CCNAME,REPLYRPL
          WRITE     DGATEIN;CCENCODE:
                            RPLYHEAD,RPLYCODE,RPLYDESC:
                            DGMISC1,DGMISC2,DGMISC3
          ADD       ONE,ERRRPROC            * increm # error transactions
.
DGPCA999  CALL      CLOS0000
          GOTO      ENDPRPCA
+
.***************************************************************************
.*                      Internal routines                                  *
.***************************************************************************
+
.***************************************************************************
.*  INIT0000  :  initialise / open a few files                             *
.***************************************************************************
INIT0000  OPEN      BOKRX1A1,"bokrx1af"
          OPEN      BOKBSTA1,"bokstaaf"
          OPEN      EOCLNKA1,"eoclnkaf"
          OPEN      OPRAUDDA,"opraudda"
          OPEN      OPRDETA1,"oprdetaf"
          OPEN      OPRDETA2,"oprdetaf"
          OPEN      OPRDETB1,"oprdetbf"
          OPEN      OPRDETC1,"oprdetcf"
          OPEN      OPRSESA1,"oprsesaf"
          OPEN      PATPNIA1,"patpniaf"
          OPEN      PATWC1A1,"patwc1af"
          OPEN      PATWMAB1,"patwmabf"
          OPEN      PATWVET1,"patwvetf"
          OPEN      VISIAUA1,"visiauaf"
          OPEN      VISINTA1,"visintaf"
          OPEN      WATCATA1,"watcataf"
          OPEN      COMDEPA2,"comdepaf"
INIT0999  RETURN
+
.***************************************************************************
.*  CLEAR000  :  clear some fields                                         *
.***************************************************************************
CLEAR000
CLEAR999  RETURN
+
.***************************************************************************
.*  CLOS0000  :  close some files                                          *
.***************************************************************************
CLOS0000
CLOS9999  RETURN
+
.===========================================================================
.
          INC       CLVISIAU
          INC       OPADDTIM
          INC       OPMAKBOK
          INC       OPMVSBOK
          INC       OPWEBCAN
          INC       PATCHPRE                * Code to cancel pre-admission
          INC       GENANVIS
.
          INC       BOKRX1IO/INC
          INC       BOKSTAIO/INC
          INC       EOCLNKIO/INC
          INC       IBAOVRIO/INC
          INC       OPRDEAIO/INC
          INC       OPRDEBIO/INC
          INC       OPRDECIO/INC
          INC       OPRSESIO/INC
          INC       PATPNIIO/INC
          INC       PATWC1IO/INC
          INC       PATWMAIO/INC
          INC       PATWVEIO/INC
          INC       VISIAUIO/INC
          INC       VISINTIO/INC
          INC       WATCATIO/INC
.
ENDPRPCA  ENDPROC
+

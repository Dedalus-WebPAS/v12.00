.******************************************************************************
.* System         : Patient Management                                        *
.* Include        : WIESCALC.PBL                                              *
.* Description    : Calculate WIES value for an individual admission          *
.******************************************************************************
.* Date           : 10/04/2015                                                *
.* Author         : J.Tan                                                     *
.*                                                                            *
.* Vars Required  : VARWISCM - Variables required for WIES                    *
.*                                                                            *
.* Files Required Open :                                                      *
.*        PATASFFD  PATASFA1 - Admission special funding arrangement file     *
.*        PATCODFD  PATCODE1 - Codes file                                     *
.*        PATECDFD  PATECDA2 - Episode disease coding file                    *
.*        PATECOFD  PATECOA2 - Episode operation coding file                  *
.*        PAT10OFD  PATI10O1 - ICD10 operations file                          *
.*        PATICUFD  PATICUA1 - ICU file                                       *
.*        PATTRNFD  PATTRAN2 - Transfer file                                  *
.*        PATWIEFD  PATWEIA1 - Victorian cost weights (for WIES27) file       *
.*                                                                            *
.* Parameters Req : Successful read on admission file                         *
.*                  Successful read on discharge file                         *
.*                  HIHLOS   - for Hospital in Home LOS (from RHIHDAYS)       *
.*                  NBRDAYS  - for LOS calculation (from NHOSPDAY)            *
.*                  PNSWRACE - User defined field for race                    *
.*                  WIS27DRG - DRG to calculate WIES27 for                    *
.*                                                                            *
.* Returns        : TOTWIS27 - Total WIES27 value                             *
.*                  WIS27DRG - DRG used to calculate WIES27                   *
.*                  WIS27LOS - LOS used to calculate WIES27                   *
.*                  WIS27WGT - Weight used to calculate WIES27                *
.*                  WIS27DSC - Description of DRG weight used                 *
.*                                                                            *
.* Modifications  :                                                           *
.******************************************************************************
.* V12.00.01 16/05/2025 Thanh T         TSK 0955096                           *
.*           Changed for alphanumeric visit number                            *
.******************************************************************************
.*       V11.01.01  05/05/2021  Ebon Clements    TSK 0902615                  *
.*                  Don't calculate WIES if using NWAU                        *
.*       V11.00.03  08/10/2020  Ebon Clements    TSK 0893634                  *
.*                  Changed WIES27 Aboriginal and Torres Strait Islander      *
.*                  loading from 30% to 4% - C27AB000                         *
.*       V11.00.02  23/09/2020  Ebon Clements    TSK 0893634                  *
.*                  Added WIES27 functionality for 2020/2021 - (PATWIS27)     *
.*                  New rule L27TH000 - Lithotripsy                           *
.*       V11.00.01  20/05/2020  Davin            TSK 0890603                  *
.*                  Added C26PW000 to calculate WIES for public patients in a *
.*                  private facility                                          *
.*       V10.14.01  26/08/2019  Davin            TSK 0880255                  *
.*                  Added WIES26 functionality for 2019/2020 (PATWIS26)       *
.*                  Modified ICD10 code checks for WIES26 (E26CR000/C26PD000) *
.*       V10.13.01  17/08/2018  Davin            TSK 0860935                  *
.*                  Added WIES25 functionality for 2018/2019 (PATWIS25)       *
.*       V10.11.01  01/08/2017  Davin            TSK 0842626                  *
.*                  Added WIES24 functionality for 2017/2018                  *
.*       V10.10.02  07/06/2017  Jill Parkinson   TSK 0832750                  *
.*                  Changed to check for R62 instead of R62B in R23I000       *
.*                  Removed check for Procedure date time in R23IO000         *
.*       V10.10.01  25/05/2017  Jill Parkinson   TSK 0832750                  *
.*                  Changed to use DRG position 2-3 to decide if surgical     *
.*       V10.08.03  24/11/2016  Jill Parkinson   TSK 0817492                  *
.*                  Added check for Procedure date time in R23IO000 to        *
.*                  determine if this is a surgical procedure                 *
.*       V10.08.02  02/09/2016  Davin            TSK 0825157                  *
.*                  Removed check for electroconvulsive therapy code(C23ET000)*
.*       V10.08.01  18/07/2016  Davin            TSK 0822753                  *
.*                  Added WIES23 functionality for 2016/2017                  *
.*                  Check for electroconvulsive therapy code (C23ET000)       *
.*       V10.05.00  10/04/2015  J.Tan            CAR 304813                   *
.*                  Created to use new WIES table with Version number         *
.******************************************************************************
.
WIESCALC
WISC0000  MATCH     "1",MRCNUNWA       * Grouping Products to return NWAU
          IF        @EQUAL
            MATCH     MRCNENWA,DDATE   * Use NWAU for discharges after date
            IF        !@LESS
              MOVE      ZERO,PTPGWFIX  * WIES value fixed
              MOVE      ZERO,PTPGWVAR  * WIES value variable
              MOVE      ZERO,PTPGWTOL  * WIES value total
              MOVE      ZERO,PTPGWWTU  * WIES weight used
              MOVE      SP70,PTPGWWTD  * WIES weight description
              GOTO      WISC9000
            ENDIF
          ENDIF
.
. * Check DRG version. For 10.0:WIES 27,26,25,24,23,22,21,20,19,18,17,16,15,14
          MATCH     DRG100,PTPGGPVR
          GOTO      WISC0035 IF EQUAL
.
.      * Check DRG version. For 9.0: WIES 25,24,23,22,21,20,19,18,17,16,15,14,13
          MATCH     DRG090,PTPGGPVR
          GOTO      WISC0035 IF EQUAL
.
.      * Check DRG version. For 8.0: WIES 24,23,22,21,20,19,18,17,16,15,14,13,12
          MATCH     DRG080,PTPGGPVR
          GOTO      WISC0040 IF EQUAL
.
.      * Check DRG version. For 7.0: WIES 22,21,20,19,18,17,16,15,14,13,12,11,10
          MATCH     DRG070,PTPGGPVR
          GOTO      WISC0050 IF EQUAL
.                                                                     *I-267797
.         * Check DRG version. For 6.2 only WIES 19,18,17,16,15,14,13,12,11,10
          MATCH     DRG062,PTPGGPVR
          GOTO      WISC0050 IF EQUAL
.                                                                     *I-197814
.         * Check DRG version. For 6.0 only WIES 19,18,17,16,15,14,13,12,11,10
          MATCH     DRG060,PTPGGPVR
          GOTO      WISC0050 IF EQUAL
.
.         * Check DRG version. For 5.2 only support WIES 15,14,13,12,11,10
          MATCH     DRG052,PTPGGPVR
          GOTO      WISC0060 IF EQUAL
.
.         * Check DRG version. For 5.1 only support WIES 13,12,11,10
          MATCH     DRG051,PTPGGPVR
          GOTO      WISC0070 IF EQUAL
.
.         * Check DRG version. For 5.0 only support WIES 12,11,10      *I-51504
          MATCH     DRG050,PTPGGPVR                                    *I-51504
          GOTO      WISC0080 IF EQUAL
.
.         * Check DRG version. For 4.2 only support WIES 11,10.9       *I-51504
          MATCH     DRG042,PTPGGPVR
          GOTO      WISC0090 IF EQUAL

.
WISC0035  MATCH     "20200701",DDATE      * 20/21 Fin year (DRG 10.0)
          IF        !@LESS
            GOTO      WISC8100            * using WIES27
          ENDIF
.
          MATCH     "20190701",DDATE      * 19/20 Fin year (DRG 10.0 9.0)
          IF        !@LESS
            GOTO      WISC8090            * using WIES26
          ENDIF
.
          MATCH     "20180701",DDATE      * 18/19 Fin year (DRG 9.0)
          IF        !@LESS
            GOTO      WISC8080            * using WIES25
          ENDIF
.
WISC0040  MATCH     "20170701",DDATE      * 17/18 Fin year (DRG 8.0)
          IF        !@LESS
            GOTO      WISC8070            * using WIES24
          ENDIF
.
          MATCH     "20160701",DDATE      * 16/17 Fin year (DRG 8.0)
          IF        !@LESS
            GOTO      WISC8060            * using WIES23
          ENDIF
.
WISC0050  MATCH     "20150701",DDATE      * 15/16 Fin year (DRG 7.0)
          IF        !@LESS
            GOTO      WISC8050            * using WIES22
          ENDIF
          MATCH     "20140701",DDATE      * 14/15 Fin year (DRG 7.0)
          IF        !@LESS
            GOTO      WISC8040            * using WIES21
          ENDIF
          MATCH     "20130701",DDATE      * 13/14 Fin year (DRG 7.0)
          IF        !@LESS
            GOTO      WISC8030            * using WIES20
          ENDIF
          MATCH     "20120701",DDATE      * 12/13 Fin year (DRG 6.0 6.2)
          IF        !@LESS
            GOTO      WISC8020            * using WIES19
          ENDIF
          MATCH     "20110701",DDATE      * 11/12 Fin year (DRG 6.0 6.2)
          IF        !@LESS
            GOTO      WISC8010            * using WIES18
          ENDIF
          MATCH     "20100701",DDATE      * 10/11 Fin year
          IF        !@LESS
            GOTO      WISC8000            * using WIES17
          ENDIF
          MATCH     "20090701",DDATE      * 09/10 Fin year
          IF        !@LESS
            GOTO      WISC7000            * using WIES16
          ENDIF
.
WISC0060  MATCH     "20080701",DDATE      * 08/09 Fin year (DRG 5.2 6.0 6.2)
          IF        !@LESS
            GOTO      WISC6000            * using WIES15
          ENDIF
          MATCH     "20070701",DDATE      * 07/08 Fin year
          IF        !@LESS
            GOTO      WISC5000            * using WIES14
          ENDIF
.
WISC0070  MATCH     "20060701",DDATE      * 06/07 Fin year (DRG 5.1 5.2 6.0 etc)
          IF        !@LESS
            GOTO      WISC4000            * using WIES13
          ENDIF
          MATCH     "20040701",DDATE      * 04/05 Fin year
          IF        !@LESS
            GOTO      WISC3000            * using WIES12
          ENDIF
          MATCH     PTCNGDV5,DDATE        * 05/06 ICD10 Ed.5 go-live date
          IF        !@LESS
            GOTO      WISC3000            * using WIES12
          ENDIF
          MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 cutover early
          IF        !@LESS
            GOTO      WISC3000            * using WIES12
          ENDIF
          GOTO      WISC2000              * default to WIES11
.
.                                                     ** Older stuff
WISC0080  MATCH     "20040701",DDATE      * 04/05 Fin year
          IF        !@LESS
            GOTO      WISC3000            * using WIES12 (5.0 DRG)
          ENDIF
          MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 cutover early
          IF        !@LESS
            GOTO      WISC3000            * using WIES12 (5.0 DRG)
          ENDIF
          GOTO      WISC2000              * default to WIES11 (5.0 DRG)
.
.         * Check DRG version. For 4.2 only support WIES 11,10.9       *I-51504
WISC0090  MATCH     "20030701",DDATE      * 03/04 Fin year             *I-90216
          IF        !@LESS
            GOTO      WISC2000            * using WIES11 (4.2 DRG)     *I-90216
          ENDIF
.
          GOTO      WISC3000                * default to WIES12
.
.
.
WISC2000  MOVE      PTPGSDRG,WIS11DRG       * WIES11                   *I-42039
          CALL      PATWIS11                * Calculate WIES11 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS11,PTPGWTOL
          MOVE      WIS11DRG,PTPGSDRG
          MOVE      WIS11WGT,PTPGSWGT
          MOVE      WIS11WGT,PTPGWWTU
          MOVE      WIS11DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC3000  MOVE      PTPGSDRG,WIS12DRG       * WIES12
          CALL      PATWIS12                * Calculate WIES12 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS12,PTPGWTOL
          MOVE      WIS12DRG,PTPGSDRG
          MOVE      WIS12WGT,PTPGSWGT
          MOVE      WIS12WGT,PTPGWWTU
          MOVE      WIS12DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC4000  MOVE      PTPGSDRG,WIS13DRG       * WIES13
          CALL      PATWIS13                * Calculate WIES13 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS13,PTPGWTOL
          MOVE      WIS13DRG,PTPGSDRG
          MOVE      WIS13WGT,PTPGSWGT
          MOVE      WIS13WGT,PTPGWWTU
          MOVE      WIS13DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC5000  MOVE      PTPGSDRG,WIS14DRG       * WIES14
          CALL      PATWIS14                * Calculate WIES14 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS14,PTPGWTOL
          MOVE      WIS14DRG,PTPGSDRG
          MOVE      WIS14WGT,PTPGSWGT
          MOVE      WIS14WGT,PTPGWWTU
          MOVE      WIS14DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC6000  MOVE      PTPGSDRG,WIS15DRG       * WIES15
          CALL      PATWIS15                * Calculate WIES15 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS15,PTPGWTOL
          MOVE      WIS15DRG,PTPGSDRG
          MOVE      WIS15WGT,PTPGSWGT
          MOVE      WIS15WGT,PTPGWWTU
          MOVE      WIS15DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC7000  MOVE      PTPGSDRG,WIS16DRG       * WIES16
          CALL      PATWIS16                * Calculate WIES16 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS16,PTPGWTOL
          MOVE      WIS16DRG,PTPGSDRG
          MOVE      WIS16WGT,PTPGSWGT
          MOVE      WIS16WGT,PTPGWWTU
          MOVE      WIS16DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC8000  MOVE      PTPGSDRG,WIS17DRG       * WIES17
          CALL      PATWIS17                * Calculate WIES17 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS17,PTPGWTOL
          MOVE      WIS17DRG,PTPGSDRG
          MOVE      WIS17WGT,PTPGSWGT
          MOVE      WIS17WGT,PTPGWWTU
          MOVE      WIS17DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC8010  MOVE      PTPGSDRG,WIS18DRG       * WIES18
          CALL      PATWIS18                * Calculate WIES18 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS18,PTPGWTOL
          MOVE      WIS18DRG,PTPGSDRG
          MOVE      WIS18WGT,PTPGSWGT
          MOVE      WIS18WGT,PTPGWWTU
          MOVE      WIS18DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC8020  MOVE      PTPGSDRG,WIS19DRG       * WIES19
          CALL      PATWIS19                * Calculate WIES19 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS19,PTPGWTOL
          MOVE      WIS19DRG,PTPGSDRG
          MOVE      WIS19WGT,PTPGSWGT
          MOVE      WIS19WGT,PTPGWWTU
          MOVE      WIS19DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC8030  MOVE      PTPGSDRG,WIS20DRG       * WIES20
          CALL      PATWIS20                * Calculate WIES20 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS20,PTPGWTOL
          MOVE      WIS20DRG,PTPGSDRG
          MOVE      WIS20WGT,PTPGSWGT
          MOVE      WIS20WGT,PTPGWWTU
          MOVE      WIS20DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC8040  MOVE      PTPGSDRG,WIS21DRG       * WIES21
          CALL      PATWIS21                * Calculate WIES21 values
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS21,PTPGWTOL
          MOVE      WIS21DRG,PTPGSDRG
          MOVE      WIS21WGT,PTPGSWGT
          MOVE      WIS21WGT,PTPGWWTU
          MOVE      WIS21DSC,PTPGWWTD
          GOTO      WISC9000
.
.         Check the WIES wights file with Version number
.
WISC8050  MOVE      "022",WIESVERN             * WIES Version 022
          MOVE      PTPGSDRG,WIS22DRG
          CALL      PATWIS22
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS22,PTPGWTOL
          MOVE      WIS22DRG,PTPGSDRG
          MOVE      WIS22WGT,PTPGSWGT
          MOVE      WIS22WGT,PTPGWWTU
          MOVE      WIS22DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC8060  MOVE      "023",WIESVERN             * WIES Version 023
          MOVE      PTPGSDRG,WIS23DRG
          CALL      PATWIS23
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS23,PTPGWTOL
          MOVE      WIS23DRG,PTPGSDRG
          MOVE      WIS23WGT,PTPGSWGT
          MOVE      WIS23WGT,PTPGWWTU
          MOVE      WIS23DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC8070  MOVE      "024",WIESVERN             * WIES Version 024
          MOVE      PTPGSDRG,WIS24DRG
          CALL      PATWIS24
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS24,PTPGWTOL
          MOVE      WIS24DRG,PTPGSDRG
          MOVE      WIS24WGT,PTPGSWGT
          MOVE      WIS24WGT,PTPGWWTU
          MOVE      WIS24DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC8080  MOVE      "025",WIESVERN             * WIES Version 025
          MOVE      PTPGSDRG,WIS25DRG
          CALL      PATWIS25
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS25,PTPGWTOL
          MOVE      WIS25DRG,PTPGSDRG
          MOVE      WIS25WGT,PTPGSWGT
          MOVE      WIS25WGT,PTPGWWTU
          MOVE      WIS25DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC8090  MOVE      "026",WIESVERN             * WIES Version 026
          MOVE      PTPGSDRG,WIS26DRG
          CALL      PATWIS26
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS26,PTPGWTOL
          MOVE      WIS26DRG,PTPGSDRG
          MOVE      WIS26WGT,PTPGSWGT
          MOVE      WIS26WGT,PTPGWWTU
          MOVE      WIS26DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC8100  MOVE      "027",WIESVERN             * WIES Version 027
          MOVE      PTPGSDRG,WIS27DRG
          CALL      PATWIS27
          BRANCH    EXIT,WISC9000
.
          MOVE      ZERO,PTPGWFIX
          MOVE      ZERO,PTPGWVAR
          MOVE      TOTWIS27,PTPGWTOL
          MOVE      WIS27DRG,PTPGSDRG
          MOVE      WIS27WGT,PTPGSWGT
          MOVE      WIS27WGT,PTPGWWTU
          MOVE      WIS27DSC,PTPGWWTD
          GOTO      WISC9000
.
WISC9000  MOVE      SP70,PTPGSPAR
.
WISC9500  MOVE      ZERO,EXIT
WISC9999  RETURN
+
.******************************************************************************
.         Calculate WIES Values based on Version number
.******************************************************************************
.******************************************************************************
.         WIES 27
.******************************************************************************
PATWIS27  CALL      IN27W000                * Initialise variables
          BRANCH    EXIT,WIS27950
.
          CALL      C27TY000                * Determine and Check Care Type
          BRANCH    EXIT,WIS27950
.
          CALL      C27PW000                * Validate for Private WIES
          IF        EXIT = 1
            CALL      C27TR000              * Check for Contracted Patient
            BRANCH    EXIT,WIS27950
.
            CALL      C27PI000              * Check Specified Program Identifier
            BRANCH    EXIT,WIS27950
          ENDIF
.
          CALL      M27RG000                * Modify DRG if necessary
.
          CALL      C27RG000                * Check for problem DRG
          BRANCH    EXIT,WIS27950
.
          CALL      M27CH000                * Check for Mechanical Ventilation
.
          CALL      T27AL000                * Check for Thalessaemia
.
          CALL      A27AA000                * Check for AAA
.
          CALL      A27SD000                * Check for ASD
.
          CALL      C27PD000                * Check for Cochlear Prosthetic
.
          CALL      B27SW000                * Calculate Base WIES27
.
          CALL      C27AB000                * Check for aboriginality
.
. ---- Calculate WIES27 value ----
.
          MOVE      TOTBWIES,TOTWIS27       * base WIES
          ADD       MVCOPAY,TOTWIS27        * mechv copayment
          ADD       NIVCOPAY,TOTWIS27       * ninv  copayment
          ADD       THCOPAY,TOTWIS27        * thal  copayment
          ADD       AAACOPAY,TOTWIS27       * AAA   copayment
          ADD       ASDCOPAY,TOTWIS27       * ASD   copayment
          ADD       CPDCOPAY,TOTWIS27       * CPD   copayment
          ADD       ATSIWIES,TOTWIS27       * ATSI  copayment
.
          MOVE      ZERO,EXIT
          GOTO      WIS27999
.
WIS27950  MOVE      ONE,EXIT
WIS27999  RETURN
+
.******************************************************************************
.*                                  IN27W000              Called by: PATWIS27 *
.*                         Initialise WIES variables                          *
.******************************************************************************
IN27W000  MOVE      ZERO,TOTWIS27
          MOVE      ZERO,WIS27LOS
          MOVE      ZERO,WIS27WGT
          MOVE      SP20,WIS27DSC
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATWIEA1,"patwieaf"
          TRAPCLR   IO
          BRANCH    OVRCD,IN27W950
.
IN27W900  MOVE      ZERO,EXIT
          GOTO      IN27W999
.
IN27W950  MOVE      ONE,EXIT
IN27W999  RETURN
+
.******************************************************************************
.*                                  C27TY000              Called by: PATWIS27 *
.*                 Check for valid Care Type (must be acute)                  *
.******************************************************************************
C27TY000  PACK     KEY5,ANSC,ANSC,ACARE     * use admission care type
          CALL     RDCODE1
          BRANCH   OVRCD,C27TY900
.
          MATCH    "6",TCINDC4              * Check Program Funding Source
          GOTO     C27TY900 IF NOT EQUAL
.
          MATCH    "4   ",THCSCOD           * check care type
          GOTO     C27TY900 IF NOT EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C27TY999
.
C27TY900  MOVE     ONE,EXIT                 * Not valid
C27TY999  RETURN
+
.******************************************************************************
.*                                  C27PW000              Called by: PATWIS27 *
.*                        Check for Private hospital WIES                     *
.******************************************************************************
C27PW000  READ      CONTROLF,TEN3;*245,CHOSTYP
          COMPARE   ZERO,CHOSTYP
          GOTO      C27PW900 IF NOT EQUAL        * private facility ?
.
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          COMPARE   THREE,PTCNHDPS
          GOTO      C27PW900 IF NOT EQUAL        * victoria ?
.
          PACK      KEY5,ANSC,ANSL,ACLAIM        * use admission claim type
          CALL      RDCODE1
          BRANCH    OVRCD,C27PW900
.
          MATCH     "P",TCINDC1
          GOTO      C27PW900 IF NOT EQUAL        * public claim type ?
.
C27PW800  MOVE      ZERO,EXIT                    * valid private hospital WIES
          GOTO      C27PW999
.
C27PW900  MOVE      ONE,EXIT                     * not valid
C27PW999  RETURN
+
.******************************************************************************
.*                                  C27TR000              Called by: PATWIS27 *
.*                        Check for Contracted Patient                        *
.******************************************************************************
C27TR000  PACK     KEY25,AADMNO,SP70
          CALL     RSPTASF1
C27TR100  CALL     RKPTASF1                 * Read adm. special funding file
          BRANCH   OVRCD,C27TR800           * still process
.
          MATCH    AADMNO,PTAFADMN
          GOTO     C27TR800 IF NOT EQUAL    * still process
.
          MATCH    ANSA,PTAFTYPE            * special fund. arrang. type = adm
          GOTO     C27TR100 IF NOT EQUAL
.
          MATCH    ANSB,PTAFCROL            * Ignore if contract role = 'B'
          GOTO     C27TR900 IF EQUAL
.
C27TR800  MOVE     ZERO,EXIT                * valid
          GOTO     C27TR999
.
C27TR900  MOVE     ONE,EXIT                 * invalid
C27TR999  RETURN
+
.******************************************************************************
.*                                  C27PI000              Called by: PATWIS27 *
.*                        Check Specified Program Identifier                  *
.******************************************************************************
C27PI000  PACK     KEY5,ANSP,ANSK,PMVXPGID  * Program Identifier (Cat PK)
          CALL     RDCODE1
          BRANCH   OVRCD,C27PI800
.
          MATCH    "06",THCSCOD             * competitive elective surgery
          GOTO     C27PI900 IF EQUAL
.
C27PI800  MOVE     ZERO,EXIT                * valid
          GOTO     C27PI999
.
C27PI900  MOVE     ONE,EXIT                 * invalid
C27PI999  RETURN
+
.******************************************************************************
.*                                  M27RG000              Called by: PATWIS27 *
.*                      Modify DRG if necessary for WIES27                    *
.******************************************************************************
M27RG000  CALL      R27IO000           * Radiotherapy
          CALL      E27CR000           * Endovascular clot retrieval
          CALL      L27TH000           * Lithotripsy
M27RG999  RETURN
+
.******************************************************************************
.*                                  R27IO000              Called by: M27RG000 *
.*                         Modify DRG if Radiotherapy                         *
.******************************************************************************
.>>>>     Don't modify these DRGs:
.
R27IO000  MATCH     "A40",WIS27DRG
          GOTO      R27IO999 IF EQUAL
.
          MATCH     "B82",WIS27DRG
          GOTO      R27IO999 IF EQUAL
.
          MATCH     "B83",WIS27DRG
          GOTO      R27IO999 IF EQUAL
.
          MATCH     "W60",WIS27DRG
          GOTO      R27IO999 IF EQUAL
.
          MATCH     "W61",WIS27DRG
          GOTO      R27IO999 IF EQUAL
.
.>>>>     Check for sameday radiotherapy session:
.
          MATCH     ADATE,DDATE
          GOTO      R27IO040 IF NOT EQUAL
.
          UNPACK    WIS27DRG,DIM3
          MATCH     "R62",DIM3
          GOTO      R27IO999 IF NOT EQUAL
.
          PACK      ICDRDDTE,DDATE,SP10
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R27IO030  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R27IO040
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R27IO040 IF NOT EQUAL
.
          MATCH     "Z51.0",PTEDCODE        * radiotherapy?
          GOTO      R27IO030 IF NOT EQUAL
.
          GOTO      R27IO900                * modify drg for WIES27
.
.>>>>     Check if operation code exists (non-sameday):
.
R27IO040  MATCH     ADATE,DDATE
          GOTO      R27IO999 IF EQUAL       * don't modify sameday
.
.>>> Check if this is a surgical DRG - drg code position 2-3 between 01-39
.>>> if so do not change drg
          CALL      S27RG000
          BRANCH    EXIT,R27IO999
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
R27IO050  CALL      RKPTECO2                  episode operation file record
          BRANCH    OVRCD,R27IO999
.
          MATCH     AADMNO,PTEOADMN         * same admission?
          GOTO      R27IO999 IF NOT EQUAL
.
.>>>>     Check if block number is in range 1786-1792, 1794 or 1795:
.
          PACK      KEY9,PTEOCODE,SP9
          CALL      RDPTICO1
          BRANCH    OVRCD,R27IO050
.
          MATCH     "1786",PT0OBLKN         * block code >= 1786?
          GOTO      R27IO050 IF LESS
.
          MATCH     "1796",PT0OBLKN         * block code <=1795?
          GOTO      R27IO050 IF NOT LESS
.
          MATCH     "1793",PT0OBLKN         * block code = 1793?
          GOTO      R27IO050 IF EQUAL
.
.>>>>     Check if disease code exists in range C00-D48:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R27IO100  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R27IO999
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R27IO999 IF NOT EQUAL
.
          MATCH     "C00",PTEDCODE          * neoplasm code >= C00?
          GOTO      R27IO100 IF LESS
.
          MATCH     "D49",PTEDCODE          * neoplasm code <= D48.9?
          GOTO      R27IO100 IF NOT LESS
.
R27IO900  MOVE      "R64Z",WIS27DRG         * modified for WIES27
R27IO999  RETURN
+
.******************************************************************************
.*                                  E27CR000              Called by: M27RG000 *
.*                  Modify DRG if Endovascular clot retrieval                 *
.******************************************************************************
E27CR000  MATCH     "B02",WIS27DRG          * cranial procedures?
          GOTO      E27CR999 IF NOT EQUAL
.
.>>>>     Check if applicable operation code exists:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
E27CR100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,E27CR999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      E27CR999 IF NOT EQUAL
.
          MATCH     "35414-00",PTEOCODE     * check operation code exists
          GOTO      E27CR100 IF NOT EQUAL
.
.>>>>     Check if applicable disease code exists:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
E27CR200  CALL      RKPTECD2                * episode disease file record
          BRANCH    OVRCD,E27CR999
.
          MATCH     AADMNO,PTEDADMN
          GOTO      E27CR999 IF NOT EQUAL
.
          MATCH     "I63",PTEDCODE          * check if code is >= I63
          GOTO      E27CR200 IF LESS
.
          MATCH     "I67",PTEDCODE          * check if code is <= I66.9
          GOTO      E27CR200 IF NOT LESS
.
E27CR900  MOVE      "B02Y",WIS27DRG         * modified for WIES27
E27CR999  RETURN
+
.******************************************************************************
.*                                  L27TH000              Called by: M27RG000 *
.*                  Modify DRG if Lithotripsy                                 *
.******************************************************************************
.>>>>     Don't modify these DRGs:
.
L27TH000  MATCH     "L02",WIS27DRG          
          GOTO      L27TH999 IF EQUAL
.
          MATCH     "L03",WIS27DRG          
          GOTO      L27TH999 IF EQUAL
.
          MATCH     "L04",WIS27DRG          
          GOTO      L27TH999 IF EQUAL
.
          MATCH     "L05",WIS27DRG          
          GOTO      L27TH999 IF EQUAL
.
          MATCH     "L06",WIS27DRG          
          GOTO      L27TH999 IF EQUAL
.
          MATCH     "L07",WIS27DRG          
          GOTO      L27TH999 IF EQUAL
.
          MATCH     "L08",WIS27DRG          
          GOTO      L27TH999 IF EQUAL
.
          MATCH     "L09",WIS27DRG          
          GOTO      L27TH999 IF EQUAL
.
          MATCH     "L10",WIS27DRG          
          GOTO      L27TH999 IF EQUAL
.
          MATCH     "801",WIS27DRG          
          GOTO      L27TH999 IF EQUAL
.
.>>>>     Check if applicable operation code exists:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
L27TH100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,L27TH999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      L27TH999 IF NOT EQUAL
.
          MATCH     "36546-00",PTEOCODE     * check operation code exists
          GOTO      L27TH100 IF NOT EQUAL
.
.>>>>     Check if applicable principal (first record) disease code exists:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
L27TH200  CALL      RKPTECD2                * episode disease file record
          BRANCH    OVRCD,L27TH999
.
          MATCH     AADMNO,PTEDADMN
          GOTO      L27TH999 IF NOT EQUAL
.
          MATCH     "N13.0",PTEDCODE         
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N13.1",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N13.2",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N13.3",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N13.4",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N20.0",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N20.1",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N20.2",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N20.9",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N21.0",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N21.1",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N21.8",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N21.9",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          MATCH     "N23",PTEDCODE        
          GOTO      L27TH900 IF EQUAL
.
          GOTO      L27TH999
.
L27TH900  MOVE      "L42Z",WIS27DRG         * modified for WIES27
L27TH999  RETURN
+
.******************************************************************************
.*                                  C27RG000              Called by: PATWIS27 *
.*                            Check for Problem DRG                           *
.******************************************************************************
C27RG000  PACK     KEY7,WIS27DRG,WIESVERN
          CALL     RDPTWIE1
          BRANCH   OVRCD,C27RG900
.
          MATCH    "960Z",PTWIDRGC
          GOTO     C27RG900 IF EQUAL
.
          MATCH    "961Z",PTWIDRGC
          GOTO     C27RG900 IF EQUAL
.
          MATCH    "962Z",PTWIDRGC
          GOTO     C27RG900 IF EQUAL
.
          MATCH    "963Z",PTWIDRGC
          GOTO     C27RG900 IF EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C27RG999
.
C27RG900  MOVE     ONE,EXIT
C27RG999  RETURN
+
.******************************************************************************
.*                                  S27RG000              Called by: R27IO000 *
.*                Check if this is a surgical DRG                             *
.******************************************************************************
S27RG000  MOVE      ZERO,EXIT
          MOVE      ZERO,F2
.
. Use the second and third character of the DRG to determine if surgical
. Surgical (01 - 39) Other (40 - 59) Medical (60 - 99)
.
          UNPACK    WIS27DRG,DIM1,DIM2
          MOVE      DIM2,F2
          IF        F2<40
            GOTO      S27RG900
          ENDIF
          GOTO      S27RG999
.
S27RG900  MOVE      ONE,EXIT
.
S27RG999  RETURN
+
.******************************************************************************
.*                                  M27CH000              Called by: PATWIS27 *
.*                Calculate Mechanical Ventilation Co-payment                 *
.******************************************************************************
M27CH000  MOVE      ZERO,ADJMVDAY
          MOVE      ZERO,MVCOPAY
          MOVE      ZERO,ADJNVDAY
          MOVE      ZERO,NIVCOPAY
.
          PACK      KEY8,AADMNO
          CALL      RDPTICU1                * get mech. vent. hours
          BRANCH    OVRCD,M27CH999
.
          MATCH     "D",PTWIMVEL            * check mech. vent. eligibility
          IF        @EQUAL
            IF        PTICUMEC > 6
              ASSIGN    ((PTICUMEC+12)/24),FORM12P4    * days receiving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
            GOTO      M27CH900
          ENDIF
.
          MATCH     "4",PTWIMVEL
          IF        @EQUAL
            IF        PTICUMEC > 96
              ASSIGN    (((PTICUMEC+12)/24)-4),FORM12P4   * days recving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
          ENDIF
.
M27CH900  COMPARE   ZERO,MVCOPAY
          GOTO      M27CH999 IF NOT EQUAL   * not eligible if mechv copay exists
.
          CALL      N27CH000                * Check for Non-Invasive Ventilation
.
M27CH999  RETURN
+
.******************************************************************************
.*                                  N27CH000              Called by: M27CH000 *
.*                Calculate Non-Invasive Ventilation Co-payment               *
.******************************************************************************
N27CH000  MATCH     "D",PTWISDMT            * check ninv. vent. eligibility
          IF        @EQUAL
            IF        PTICCPAP > 6
              ASSIGN    ((PTICCPAP+12)/24),FORM12P4    * days receiving copay.
              MOVE      FORM12P4,ADJNVDAY
              ASSIGN    (ADJNVDAY*0.7659),NIVCOPAY * ninv. vent. copay.
            ENDIF
            GOTO      N27CH999
          ENDIF
.
          MATCH     "1",PTWISDMT
          IF        @EQUAL
            IF        PTICCPAP > 24
              ASSIGN    (((PTICCPAP+12)/24)-1),FORM12P4   * days recving copay.
              MOVE      FORM12P4,ADJNVDAY
              ASSIGN    (ADJNVDAY*0.7659),NIVCOPAY * ninv. vent. copay.
            ENDIF
          ENDIF
.
N27CH999  RETURN
+
.******************************************************************************
.*                                  T27AL000              Called by: PATWIS27 *
.*                      Calculate Thalessaemia Co-payment                     *
.******************************************************************************
T27AL000  MOVE      ZERO,THCOPAY
          MATCH     "T",PTWICPAY            * check WIES27 weights file
          IF        @EQUAL
            PACK      KEY16,AADMNO,SP20
            CALL      RSPTECD2              * Position on & read a patient
T27AL100    CALL      RKPTECD2                episode disease file record
            BRANCH    OVRCD,T27AL999
.
            MATCH     AADMNO,PTEDADMN
            GOTO      T27AL999 IF NOT EQUAL
.
            MATCH     "D56",PTEDCODE        * check ICD-10 code
            IF        !@EQUAL
              MATCH     "D57.2",PTEDCODE    * check ICD-10 code
              GOTO      T27AL100 IF NOT EQUAL
            ENDIF
            MOVE      "0.1089",THCOPAY      * eligible for thal. copayment
          ENDIF
T27AL999  RETURN
+
.******************************************************************************
.*                                  A27AA000              Called by: PATWIS27 *
.*                          Calculate AAA Co-payment                          *
.******************************************************************************
A27AA000  MOVE      ZERO,AAACOPAY
          MATCH     "AAA",PTWICPAY          * check WIES27 weights file
          GOTO      A27AA999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A27AA100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A27AA999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A27AA999 IF NOT EQUAL
.
          MATCH     "33116-00",PTEOCODE     * check ICD-10 code
          GOTO      A27AA100 IF NOT EQUAL
.
          MOVE      "3.1421",AAACOPAY       * eligible for AAA copayment
A27AA999  RETURN
+
.******************************************************************************
.*                                  A27SD000              Called by: PATWIS27 *
.*                          Calculate ASD Co-payment                          *
.******************************************************************************
A27SD000  MOVE      ZERO,ASDCOPAY
          MATCH     "ASD",PTWICPAY          * check WIES27 weights file
          GOTO      A27SD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A27SD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A27SD999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A27SD999 IF NOT EQUAL
.
          MATCH     "38742-00",PTEOCODE     * check ICD-10 code
          GOTO      A27SD100 IF NOT EQUAL
.
          MOVE      "2.4713",ASDCOPAY       * eligible for ASD copayment
A27SD999  RETURN
+
.******************************************************************************
.*                                  C27PD000              Called by: PATWIS27 *
.*                 Calculate Cochlear Prosthetic Device Co-payment            *
.******************************************************************************
C27PD000  MOVE      ZERO,CPDCOPAY
          MATCH     "B",PTWICPAY            * check WIES27 weights file
          GOTO      C27PD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
C27PD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,C27PD900
.
          MATCH     AADMNO,PTEOADMN
          GOTO      C27PD900 IF NOT EQUAL
.
          MATCH     "41617-05",PTEOCODE     * check for implant (bilateral)
          IF        @EQUAL
            ADD       ONE,CPDCOPAY
          ENDIF
          MATCH     "41617-06",PTEOCODE     * check for implant removal
          IF        @EQUAL
            SUB       ONE,CPDCOPAY
          ENDIF
          GOTO      C27PD100
.
C27PD900  IF        CPDCOPAY >= 1
            MOVE      "5.0544",CPDCOPAY     * eligible for CPD copayment
          ELSE
            MOVE      ZERO,CPDCOPAY         * not eligible for CPD copayment
          ENDIF
C27PD999  RETURN
+
.******************************************************************************
.*                                  B27SW000              Called by: PATWIS27 *
.*                            Calculate Base WIES27                           *
.******************************************************************************
B27SW000  MOVE      ZERO,TOTBWIES           * initialise base WIES27
          MOVE      TOTBWIES,WIS27WGT       * for display
          MOVE      SP70,WIS27DSC           * description
.
          CALL      C27SS000                * short stay unit?
          BRANCH    EXIT,B27SW999           * yes
.
          CALL      D27SC000                * length of stay category
          CALL      C27ST000                * calculate inlier status
.
          MATCH     "L",W27NLIER            * low outlier
          CALL      BW27L000 IF EQUAL       * calculate base WIES27
.
          MATCH     "I",W27NLIER            * inlier
          CALL      BW27N000 IF EQUAL       * calculate base WIES27
.
          MATCH     "H",W27NLIER            * high outlier
          CALL      BW27H000 IF EQUAL       * calculate base WIES27
.
B27SW999  RETURN
+
.******************************************************************************
.*                                  D27SC000              Called by: B27SW000 *
.*                      Determine Length Of Stay Category                     *
.******************************************************************************
D27SC000  MOVE      NBRDAYS,WIS27LOS        * length of stay from NHOSPDAY
          MOVE      "M",LOSCAT              * set LOS category to multiday
          MATCH     ADATE,DDATE             * check for sameday
          IF        @EQUAL
            MOVE      ONE,SAMEDAY           * sameday
            MOVE      ONE,WIS27LOS          * LOS = 1
            MOVE      "S",LOSCAT            * set LOS category to sameday
            GOTO      D27SC999
          ELSE
            MOVE      ZERO,SAMEDAY          * not sameday
          ENDIF
.
          IF        SAMEDAY = 0 & WIS27LOS = 1
            MOVE      "O",LOSCAT            * set LOS category to oneday
            GOTO      D27SC999
          ENDIF
.
          IF        WIS27LOS > 1825
            MOVE      "1825",WIS27LOS       * maximum LOS is 5 years
          ENDIF
.
D27SC999  RETURN
+
.******************************************************************************
.*                                  C27SS000              Called by: B27SW000 *
.*                            Check for short stay                            *
.******************************************************************************
C27SS000  MATCH     "S",PTWISSDR
          GOTO      C27SS900 IF NOT EQUAL      * is this a short stay drg?
.
          PACK      KEY30,AADMNO,SP70
          CALL      RDSTRAN2
C27SS100  CALL      RDKTRAN2
          BRANCH    OVRCD,C27SS999             * check visit is all short stay
.
          MATCH     AADMNO,TADMN
          GOTO      C27SS999 IF NOT EQUAL
.
          PACK      KEY5,ANSB,ANST,TRBTYP      * check bed type
          CALL      RDCODE1
          BRANCH    OVRCD,C27SS900
.
          MATCH     "S",THCSCOD                * short stay unit?
          GOTO      C27SS900 IF NOT EQUAL
.
          MOVE      PTWISSWT,TOTBWIES          * Set wies to short stay weight
          MOVE      TOTBWIES,WIS27WGT          * for display
          MOVE      "Shrt Stay Wgt",WIS27DSC   * description
          MOVE      ONE,EXIT                   * short stay = yes
          GOTO      C27SS100
.
C27SS900  MOVE      ZERO,TOTBWIES              * Set wies zero
          MOVE      TOTBWIES,WIS27WGT          * for display
          MOVE      SP70,WIS27DSC              * description
          MOVE      ZERO,EXIT                  * short stay = no
C27SS999  RETURN
+
.******************************************************************************
.*                                  C27ST000              Called by: B27SW000 *
.*                           Calculate Inlier Status                          *
.******************************************************************************
C27ST000  MOVE      "I",W27NLIER            * set status to inlier
          IF        WIS27LOS < PTWILIBP
            MOVE      "L",W27NLIER          * set status to low outlier
            GOTO      C27ST999
          ENDIF
.
          ASSIGN    (PTWIHIBP+ADJMVDAY+ADJNVDAY),FORM12P4  * HIBP + mv + ninv
          IF        WIS27LOS > FORM12P4
            MOVE      "H",W27NLIER          * set status to high outlier
          ENDIF
C27ST999  RETURN
+
.******************************************************************************
.*                                  BW27L000              Called by: B27SW000 *
.*                     Calculate Base WIES27 for Low Outlier                  *
.******************************************************************************
BW27L000  MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES             * base WIES27
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES27  * IES27
.
            MOVE      PTWITDSW,WIS27WGT             * for display
            MOVE      "Same Day Wgt ",WIS27DSC
            GOTO      BW27L999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES             * base WIES27
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES27  * IES27
.
            MOVE      PTWITODW,WIS27WGT             * for display
            MOVE      "One Day Wgt  ",WIS27DSC
            GOTO      BW27L999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            ASSIGN    (PTWITODW+((WIS27LOS-1)*PTWITLOM)),TOTBWIES
.                                                    * base WIES27
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES27   * IES27
.
            MOVE      PTWITLOM,WIS27WGT             * for display
            MOVE      "Low Outlr Wgt",WIS27DSC
            GOTO      BW27L999
          ENDIF
BW27L999  RETURN
+
.******************************************************************************
.*                                  BW27N000              Called by: B27SW000 *
.*                      Calculate Base WIES27 for Inlier                      *
.******************************************************************************
BW27N000  MOVE      ONE,TOTIES27          * IES27 = 1
          MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES   * base WIES27
.
            MOVE      PTWITDSW,WIS27WGT             * for display
            MOVE      "Same Day Wgt ",WIS27DSC
            GOTO      BW27N999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES   * base WIES27
.
            MOVE      PTWITODW,WIS27WGT             * for display
            MOVE      "One Day Wgt  ",WIS27DSC
            GOTO      BW27N999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            MOVE      PTWITIMW,TOTBWIES   * base WIES27
.
            MOVE      PTWITIMW,WIS27WGT             * for display
            MOVE      "Inlier Wgt   ",WIS27DSC
            GOTO      BW27N999
          ENDIF
BW27N999  RETURN
+
.******************************************************************************
.*                                  BW27H000              Called by: B27SW000 *
.*                    Calculate Base WIES27 for High Outlier                  *
.******************************************************************************
BW27H000  ASSIGN    ((WIS27LOS-PTWIHIBP)-ADJMVDAY-ADJNVDAY),HIGHDAYS * high outl
          COMPARE   ZERO,HIGHDAYS
          IF        @LESS
            MOVE      ZERO,HIGHDAYS         * highdays must be >= zero
          ENDIF
.
          COMPARE   HIGHDAYS,HIHLOS
          IF        @LESS
            MOVE      HIHLOS,HITHDAYS       * get lesser of highdays and
          ELSE                              *  HIHLOS
            MOVE      HIGHDAYS,HITHDAYS
          ENDIF
.
          ASSIGN    (HIGHDAYS-HITHDAYS)*PTWITHOM,TOTBWIES    *high WIES
          ASSIGN    (HITHDAYS*PTWITHIH)+TOTBWIES,TOTBWIES    *HITH WIES
          ASSIGN    (PTWITIMW+TOTBWIES),TOTBWIES             *base WIES27
          ASSIGN    (TOTBWIES/PTWITIMW),TOTIES27             * IES27
.
          MOVE      PTWITHOM,WIS27WGT                        * for display
          MOVE      "High Outl Wgt",WIS27DSC
BW27H999  RETURN
+
.******************************************************************************
.*                                  C27AB000              Called by: PATWIS27 *
.*                          Check for Aboriginality                           *
.******************************************************************************
C27AB000  MOVE      ZERO,ATSIWIES                * set ATSI WIES to zero
          IF        PNSWRACE<1 | PNSWRACE>14
            GOTO      C27AB999              * Invalid parameter
          ENDIF
.
          LOAD      TCODE,PNSWRACE,CATP1,CATP2,CATP3,CATP4,CATP5:
                                   CATP6,CATA1,CATA2,CATA3,CATA4:
                                   CATA5,CATA6,CATA7,CATVA
          LOAD      ACODE,PNSWRACE,PUSR1,PUSR2,PUSR3,PUSR4,PUSR5:
                                   PUSR6,AUSR1,AUSR2,AUSR3,AUSR4:
                                   AUSR5,AUSR6,AUSR7,PMPXABRG
.
          MATCH     ACODE,SP3
          GOTO      C27AB999 IF EQUAL
.
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1                 * Read a code file record
          BRANCH    OVRCD,C27AB999
.
          UNPACK    THCSCOD,DIM1,KEY1       * use 2nd char of HDP Equiv
.>>>>     MOVE      THCSCOD,KEY1
          TYPE      KEY1
          GOTO      C27AB999 IF NOT EQUAL   * Non numeric, error
.
          MOVE      KEY1,FORM1
.
. ---- Calculate ATSI Loading if aboriginality = 1, 2, or 3 ----
.
          IF        FORM1=1 | FORM1=2 | FORM1=3
            MOVE      TOTBWIES,FORM12P4       * base WIES
            ADD       MVCOPAY,FORM12P4        * mechv copayment
            ADD       NIVCOPAY,FORM12P4       * ninv  copayment
            ADD       THCOPAY,FORM12P4        * thal  copayment
            ADD       AAACOPAY,FORM12P4       * AAA   copayment
            ADD       ASDCOPAY,FORM12P4       * ASD   copayment
            ADD       CPDCOPAY,FORM12P4       * CPD   copayment
            ASSIGN    (0.04*FORM12P4),ATSIWIES
          ENDIF
.
C27AB999  RETURN
.
.******************************************************************************
.         WIES 26
.******************************************************************************
PATWIS26  CALL      IN26W000                * Initialise variables
          BRANCH    EXIT,WIS26950
.
          CALL      C26TY000                * Determine and Check Care Type
          BRANCH    EXIT,WIS26950
.
          CALL      C26PW000                * Validate for Private WIES
          IF        EXIT = 1
            CALL      C26TR000              * Check for Contracted Patient
            BRANCH    EXIT,WIS26950
.
            CALL      C26PI000              * Check Specified Program Identifier
            BRANCH    EXIT,WIS26950
          ENDIF
.
          CALL      M26RG000                * Modify DRG if necessary
.
          CALL      C26RG000                * Check for problem DRG
          BRANCH    EXIT,WIS26950
.
          CALL      M26CH000                * Check for Mechanical Ventilation
.
          CALL      T26AL000                * Check for Thalessaemia
.
          CALL      A26AA000                * Check for AAA
.
          CALL      A26SD000                * Check for ASD
.
          CALL      C26PD000                * Check for Cochlear Prosthetic
.
          CALL      B26SW000                * Calculate Base WIES26
.
          CALL      C26AB000                * Check for aboriginality
.
. ---- Calculate WIES26 value ----
.
          MOVE      TOTBWIES,TOTWIS26       * base WIES
          ADD       MVCOPAY,TOTWIS26        * mechv copayment
          ADD       NIVCOPAY,TOTWIS26       * ninv  copayment
          ADD       THCOPAY,TOTWIS26        * thal  copayment
          ADD       AAACOPAY,TOTWIS26       * AAA   copayment
          ADD       ASDCOPAY,TOTWIS26       * ASD   copayment
          ADD       CPDCOPAY,TOTWIS26       * CPD   copayment
          ADD       ATSIWIES,TOTWIS26       * ATSI  copayment
.
          MOVE      ZERO,EXIT
          GOTO      WIS26999
.
WIS26950  MOVE      ONE,EXIT
WIS26999  RETURN
+
.******************************************************************************
.*                                  IN26W000              Called by: PATWIS26 *
.*                         Initialise WIES variables                          *
.******************************************************************************
IN26W000  MOVE      ZERO,TOTWIS26
          MOVE      ZERO,WIS26LOS
          MOVE      ZERO,WIS26WGT
          MOVE      SP20,WIS26DSC
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATWIEA1,"patwieaf"
          TRAPCLR   IO
          BRANCH    OVRCD,IN26W950
.
IN26W900  MOVE      ZERO,EXIT
          GOTO      IN26W999
.
IN26W950  MOVE      ONE,EXIT
IN26W999  RETURN
+
.******************************************************************************
.*                                  C26TY000              Called by: PATWIS26 *
.*                 Check for valid Care Type (must be acute)                  *
.******************************************************************************
C26TY000  PACK     KEY5,ANSC,ANSC,ACARE     * use admission care type
          CALL     RDCODE1
          BRANCH   OVRCD,C26TY900
.
          MATCH    "6",TCINDC4              * Check Program Funding Source
          GOTO     C26TY900 IF NOT EQUAL
.
          MATCH    "4   ",THCSCOD           * check care type
          GOTO     C26TY900 IF NOT EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C26TY999
.
C26TY900  MOVE     ONE,EXIT                 * Not valid
C26TY999  RETURN
+
.******************************************************************************
.*                                  C26PW000              Called by: PATWIS26 *
.*                        Check for Private hospital WIES                     *
.******************************************************************************
C26PW000  READ      CONTROLF,TEN3;*245,CHOSTYP
          COMPARE   ZERO,CHOSTYP
          GOTO      C26PW900 IF NOT EQUAL        * private facility ?
.
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          COMPARE   THREE,PTCNHDPS
          GOTO      C26PW900 IF NOT EQUAL        * victoria ?
.
          PACK      KEY5,ANSC,ANSL,ACLAIM        * use admission claim type
          CALL      RDCODE1
          BRANCH    OVRCD,C26PW900
.
          MATCH     "P",TCINDC1
          GOTO      C26PW900 IF NOT EQUAL        * public claim type ?
.
C26PW800  MOVE      ZERO,EXIT                    * valid private hospital WIES
          GOTO      C26PW999
.
C26PW900  MOVE      ONE,EXIT                     * not valid
C26PW999  RETURN
+
.******************************************************************************
.*                                  C26TR000              Called by: PATWIS26 *
.*                        Check for Contracted Patient                        *
.******************************************************************************
C26TR000  PACK     KEY25,AADMNO,SP70
          CALL     RSPTASF1
C26TR100  CALL     RKPTASF1                 * Read adm. special funding file
          BRANCH   OVRCD,C26TR800           * still process
.
          MATCH    AADMNO,PTAFADMN
          GOTO     C26TR800 IF NOT EQUAL    * still process
.
          MATCH    ANSA,PTAFTYPE            * special fund. arrang. type = adm
          GOTO     C26TR100 IF NOT EQUAL
.
          MATCH    ANSB,PTAFCROL            * Ignore if contract role = 'B'
          GOTO     C26TR900 IF EQUAL
.
C26TR800  MOVE     ZERO,EXIT                * valid
          GOTO     C26TR999
.
C26TR900  MOVE     ONE,EXIT                 * invalid
C26TR999  RETURN
+
.******************************************************************************
.*                                  C26PI000              Called by: PATWIS26 *
.*                        Check Specified Program Identifier                  *
.******************************************************************************
C26PI000  PACK     KEY5,ANSP,ANSK,PMVXPGID  * Program Identifier (Cat PK)
          CALL     RDCODE1
          BRANCH   OVRCD,C26PI800
.
          MATCH    "06",THCSCOD             * competitive elective surgery
          GOTO     C26PI900 IF EQUAL
.
C26PI800  MOVE     ZERO,EXIT                * valid
          GOTO     C26PI999
.
C26PI900  MOVE     ONE,EXIT                 * invalid
C26PI999  RETURN
+
.******************************************************************************
.*                                  M26RG000              Called by: PATWIS26 *
.*                      Modify DRG if necessary for WIES26                    *
.******************************************************************************
M26RG000  CALL      R26IO000           * Radiotherapy
          CALL      E26CR000           * Endovascular clot retrieval
M26RG999  RETURN
+
.******************************************************************************
.*                                  R26IO000              Called by: M26RG000 *
.*                         Modify DRG if Radiotherapy                         *
.******************************************************************************
.>>>>     Don't modify these DRGs:
.
R26IO000  MATCH     "A40",WIS26DRG
          GOTO      R26IO999 IF EQUAL
.
          MATCH     "B82",WIS26DRG
          GOTO      R26IO999 IF EQUAL
.
          MATCH     "B83",WIS26DRG
          GOTO      R26IO999 IF EQUAL
.
          MATCH     "W60",WIS26DRG
          GOTO      R26IO999 IF EQUAL
.
          MATCH     "W61",WIS26DRG
          GOTO      R26IO999 IF EQUAL
.
.>>>>     Check for sameday radiotherapy session:
.
          MATCH     ADATE,DDATE
          GOTO      R26IO040 IF NOT EQUAL
.
          UNPACK    WIS26DRG,DIM3
          MATCH     "R62",DIM3
          GOTO      R26IO999 IF NOT EQUAL
.
          PACK      ICDRDDTE,DDATE,SP10
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R26IO030  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R26IO040
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R26IO040 IF NOT EQUAL
.
          MATCH     "Z51.0",PTEDCODE        * radiotherapy?
          GOTO      R26IO030 IF NOT EQUAL
.
          GOTO      R26IO900                * modify drg for WIES26
.
.>>>>     Check if operation code exists (non-sameday):
.
R26IO040  MATCH     ADATE,DDATE
          GOTO      R26IO999 IF EQUAL       * don't modify sameday
.
.>>> Check if this is a surgical DRG - drg code position 2-3 between 01-39
.>>> if so do not change drg
          CALL      S26RG000
          BRANCH    EXIT,R26IO999
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
R26IO050  CALL      RKPTECO2                  episode operation file record
          BRANCH    OVRCD,R26IO999
.
          MATCH     AADMNO,PTEOADMN         * same admission?
          GOTO      R26IO999 IF NOT EQUAL
.
.>>>>     Check if block number is in range 1786-1792, 1794 or 1795:
.
          PACK      KEY9,PTEOCODE,SP9
          CALL      RDPTICO1
          BRANCH    OVRCD,R26IO050
.
          MATCH     "1786",PT0OBLKN         * block code >= 1786?
          GOTO      R26IO050 IF LESS
.
          MATCH     "1796",PT0OBLKN         * block code <=1795?
          GOTO      R26IO050 IF NOT LESS
.
          MATCH     "1793",PT0OBLKN         * block code = 1793?
          GOTO      R26IO050 IF EQUAL
.
.>>>>     Check if disease code exists in range C00-D48:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R26IO100  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R26IO999
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R26IO999 IF NOT EQUAL
.
          MATCH     "C00",PTEDCODE          * neoplasm code >= C00?
          GOTO      R26IO100 IF LESS
.
          MATCH     "D49",PTEDCODE          * neoplasm code <= D48.9?
          GOTO      R26IO100 IF NOT LESS
.
R26IO900  MOVE      "R64Z",WIS26DRG         * modified for WIES26
R26IO999  RETURN
+
.******************************************************************************
.*                                  E26CR000              Called by: M26RG000 *
.*                  Modify DRG if Endovascular clot retrieval                 *
.******************************************************************************
E26CR000  MATCH     "B02",WIS26DRG          * cranial procedures?
          GOTO      E26CR999 IF NOT EQUAL
.
.>>>>     Check if applicable operation code exists:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
E26CR100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,E26CR999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      E26CR999 IF NOT EQUAL
.
          MATCH     "35414-00",PTEOCODE     * check operation code exists
          GOTO      E26CR100 IF NOT EQUAL
.
.>>>>     Check if applicable disease code exists:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
E26CR200  CALL      RKPTECD2                * episode disease file record
          BRANCH    OVRCD,E26CR999
.
          MATCH     AADMNO,PTEDADMN
          GOTO      E26CR999 IF NOT EQUAL
.
          MATCH     "I63",PTEDCODE          * check if code is >= I63
          GOTO      E26CR200 IF LESS
.
          MATCH     "I67",PTEDCODE          * check if code is <= I66.9
          GOTO      E26CR200 IF NOT LESS
.
E26CR900  MOVE      "B02Y",WIS26DRG         * modified for WIES26
E26CR999  RETURN
+
.******************************************************************************
.*                                  C26RG000              Called by: PATWIS26 *
.*                            Check for Problem DRG                           *
.******************************************************************************
C26RG000  PACK     KEY7,WIS26DRG,WIESVERN
          CALL     RDPTWIE1
          BRANCH   OVRCD,C26RG900
.
          MATCH    "960Z",PTWIDRGC
          GOTO     C26RG900 IF EQUAL
.
          MATCH    "961Z",PTWIDRGC
          GOTO     C26RG900 IF EQUAL
.
          MATCH    "962Z",PTWIDRGC
          GOTO     C26RG900 IF EQUAL
.
          MATCH    "963Z",PTWIDRGC
          GOTO     C26RG900 IF EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C26RG999
.
C26RG900  MOVE     ONE,EXIT
C26RG999  RETURN
+
.******************************************************************************
.*                                  S26RG000              Called by: R26IO000 *
.*                Check if this is a surgical DRG                             *
.******************************************************************************
S26RG000  MOVE      ZERO,EXIT
          MOVE      ZERO,F2
.
. Use the second and third character of the DRG to determine if surgical
. Surgical (01 - 39) Other (40 - 59) Medical (60 - 99)
.
          UNPACK    WIS26DRG,DIM1,DIM2
          MOVE      DIM2,F2
          IF        F2<40
            GOTO      S26RG900
          ENDIF
          GOTO      S26RG999
.
S26RG900  MOVE      ONE,EXIT
.
S26RG999  RETURN
+
.******************************************************************************
.*                                  M26CH000              Called by: PATWIS26 *
.*                Calculate Mechanical Ventilation Co-payment                 *
.******************************************************************************
M26CH000  MOVE      ZERO,ADJMVDAY
          MOVE      ZERO,MVCOPAY
          MOVE      ZERO,ADJNVDAY
          MOVE      ZERO,NIVCOPAY
.
          PACK      KEY8,AADMNO
          CALL      RDPTICU1                * get mech. vent. hours
          BRANCH    OVRCD,M26CH999
.
          MATCH     "D",PTWIMVEL            * check mech. vent. eligibility
          IF        @EQUAL
            IF        PTICUMEC > 6
              ASSIGN    ((PTICUMEC+12)/24),FORM12P4    * days receiving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
            GOTO      M26CH900
          ENDIF
.
          MATCH     "4",PTWIMVEL
          IF        @EQUAL
            IF        PTICUMEC > 96
              ASSIGN    (((PTICUMEC+12)/24)-4),FORM12P4   * days recving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
          ENDIF
.
M26CH900  COMPARE   ZERO,MVCOPAY
          GOTO      M26CH999 IF NOT EQUAL   * not eligible if mechv copay exists
.
          CALL      N26CH000                * Check for Non-Invasive Ventilation
.
M26CH999  RETURN
+
.******************************************************************************
.*                                  N26CH000              Called by: M26CH000 *
.*                Calculate Non-Invasive Ventilation Co-payment               *
.******************************************************************************
N26CH000  MATCH     "D",PTWISDMT            * check ninv. vent. eligibility
          IF        @EQUAL
            IF        PTICCPAP > 6
              ASSIGN    ((PTICCPAP+12)/24),FORM12P4    * days receiving copay.
              MOVE      FORM12P4,ADJNVDAY
              ASSIGN    (ADJNVDAY*0.7659),NIVCOPAY * ninv. vent. copay.
            ENDIF
            GOTO      N26CH999
          ENDIF
.
          MATCH     "1",PTWISDMT
          IF        @EQUAL
            IF        PTICCPAP > 24
              ASSIGN    (((PTICCPAP+12)/24)-1),FORM12P4   * days recving copay.
              MOVE      FORM12P4,ADJNVDAY
              ASSIGN    (ADJNVDAY*0.7659),NIVCOPAY * ninv. vent. copay.
            ENDIF
          ENDIF
.
N26CH999  RETURN
+
.******************************************************************************
.*                                  T26AL000              Called by: PATWIS26 *
.*                      Calculate Thalessaemia Co-payment                     *
.******************************************************************************
T26AL000  MOVE      ZERO,THCOPAY
          MATCH     "T",PTWICPAY            * check WIES26 weights file
          IF        @EQUAL
            PACK      KEY16,AADMNO,SP20
            CALL      RSPTECD2              * Position on & read a patient
T26AL100    CALL      RKPTECD2                episode disease file record
            BRANCH    OVRCD,T26AL999
.
            MATCH     AADMNO,PTEDADMN
            GOTO      T26AL999 IF NOT EQUAL
.
            MATCH     "D56",PTEDCODE        * check ICD-10 code
            IF        !@EQUAL
              MATCH     "D57.2",PTEDCODE    * check ICD-10 code
              GOTO      T26AL100 IF NOT EQUAL
            ENDIF
            MOVE      "0.1089",THCOPAY      * eligible for thal. copayment
          ENDIF
T26AL999  RETURN
+
.******************************************************************************
.*                                  A26AA000              Called by: PATWIS26 *
.*                          Calculate AAA Co-payment                          *
.******************************************************************************
A26AA000  MOVE      ZERO,AAACOPAY
          MATCH     "AAA",PTWICPAY          * check WIES26 weights file
          GOTO      A26AA999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A26AA100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A26AA999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A26AA999 IF NOT EQUAL
.
          MATCH     "33116-00",PTEOCODE     * check ICD-10 code
          GOTO      A26AA100 IF NOT EQUAL
.
          MOVE      "3.1421",AAACOPAY       * eligible for AAA copayment
A26AA999  RETURN
+
.******************************************************************************
.*                                  A26SD000              Called by: PATWIS26 *
.*                          Calculate ASD Co-payment                          *
.******************************************************************************
A26SD000  MOVE      ZERO,ASDCOPAY
          MATCH     "ASD",PTWICPAY          * check WIES26 weights file
          GOTO      A26SD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A26SD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A26SD999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A26SD999 IF NOT EQUAL
.
          MATCH     "38742-00",PTEOCODE     * check ICD-10 code
          GOTO      A26SD100 IF NOT EQUAL
.
          MOVE      "2.4713",ASDCOPAY       * eligible for ASD copayment
A26SD999  RETURN
+
.******************************************************************************
.*                                  C26PD000              Called by: PATWIS26 *
.*                 Calculate Cochlear Prosthetic Device Co-payment            *
.******************************************************************************
C26PD000  MOVE      ZERO,CPDCOPAY
          MATCH     "B",PTWICPAY            * check WIES26 weights file
          GOTO      C26PD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
C26PD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,C26PD900
.
          MATCH     AADMNO,PTEOADMN
          GOTO      C26PD900 IF NOT EQUAL
.
          MATCH     "41617-05",PTEOCODE     * check for implant (bilateral)
          IF        @EQUAL
            ADD       ONE,CPDCOPAY
          ENDIF
          MATCH     "41617-06",PTEOCODE     * check for implant removal
          IF        @EQUAL
            SUB       ONE,CPDCOPAY
          ENDIF
          GOTO      C26PD100
.
C26PD900  IF        CPDCOPAY >= 1
            MOVE      "5.0544",CPDCOPAY     * eligible for CPD copayment
          ELSE
            MOVE      ZERO,CPDCOPAY         * not eligible for CPD copayment
          ENDIF
C26PD999  RETURN
+
.******************************************************************************
.*                                  B26SW000              Called by: PATWIS26 *
.*                            Calculate Base WIES26                           *
.******************************************************************************
B26SW000  MOVE      ZERO,TOTBWIES           * initialise base WIES26
          MOVE      TOTBWIES,WIS26WGT       * for display
          MOVE      SP70,WIS26DSC           * description
.
          CALL      C26SS000                * short stay unit?
          BRANCH    EXIT,B26SW999           * yes
.
          CALL      D26SC000                * length of stay category
          CALL      C26ST000                * calculate inlier status
.
          MATCH     "L",W26NLIER            * low outlier
          CALL      BW26L000 IF EQUAL       * calculate base WIES26
.
          MATCH     "I",W26NLIER            * inlier
          CALL      BW26N000 IF EQUAL       * calculate base WIES26
.
          MATCH     "H",W26NLIER            * high outlier
          CALL      BW26H000 IF EQUAL       * calculate base WIES26
.
B26SW999  RETURN
+
.******************************************************************************
.*                                  D26SC000              Called by: B26SW000 *
.*                      Determine Length Of Stay Category                     *
.******************************************************************************
D26SC000  MOVE      NBRDAYS,WIS26LOS        * length of stay from NHOSPDAY
          MOVE      "M",LOSCAT              * set LOS category to multiday
          MATCH     ADATE,DDATE             * check for sameday
          IF        @EQUAL
            MOVE      ONE,SAMEDAY           * sameday
            MOVE      ONE,WIS26LOS          * LOS = 1
            MOVE      "S",LOSCAT            * set LOS category to sameday
            GOTO      D26SC999
          ELSE
            MOVE      ZERO,SAMEDAY          * not sameday
          ENDIF
.
          IF        SAMEDAY = 0 & WIS26LOS = 1
            MOVE      "O",LOSCAT            * set LOS category to oneday
            GOTO      D26SC999
          ENDIF
.
          IF        WIS26LOS > 1825
            MOVE      "1825",WIS26LOS       * maximum LOS is 5 years
          ENDIF
.
D26SC999  RETURN
+
.******************************************************************************
.*                                  C26SS000              Called by: B26SW000 *
.*                            Check for short stay                            *
.******************************************************************************
C26SS000  MATCH     "S",PTWISSDR
          GOTO      C26SS900 IF NOT EQUAL      * is this a short stay drg?
.
          PACK      KEY30,AADMNO,SP70
          CALL      RDSTRAN2
C26SS100  CALL      RDKTRAN2
          BRANCH    OVRCD,C26SS999             * check visit is all short stay
.
          MATCH     AADMNO,TADMN
          GOTO      C26SS999 IF NOT EQUAL
.
          PACK      KEY5,ANSB,ANST,TRBTYP      * check bed type
          CALL      RDCODE1
          BRANCH    OVRCD,C26SS900
.
          MATCH     "S",THCSCOD                * short stay unit?
          GOTO      C26SS900 IF NOT EQUAL
.
          MOVE      PTWISSWT,TOTBWIES          * Set wies to short stay weight
          MOVE      TOTBWIES,WIS26WGT          * for display
          MOVE      "Shrt Stay Wgt",WIS26DSC   * description
          MOVE      ONE,EXIT                   * short stay = yes
          GOTO      C26SS100
.
C26SS900  MOVE      ZERO,TOTBWIES              * Set wies zero
          MOVE      TOTBWIES,WIS26WGT          * for display
          MOVE      SP70,WIS26DSC              * description
          MOVE      ZERO,EXIT                  * short stay = no
C26SS999  RETURN
+
.******************************************************************************
.*                                  C26ST000              Called by: B26SW000 *
.*                           Calculate Inlier Status                          *
.******************************************************************************
C26ST000  MOVE      "I",W26NLIER            * set status to inlier
          IF        WIS26LOS < PTWILIBP
            MOVE      "L",W26NLIER          * set status to low outlier
            GOTO      C26ST999
          ENDIF
.
          ASSIGN    (PTWIHIBP+ADJMVDAY+ADJNVDAY),FORM12P4  * HIBP + mv + ninv
          IF        WIS26LOS > FORM12P4
            MOVE      "H",W26NLIER          * set status to high outlier
          ENDIF
C26ST999  RETURN
+
.******************************************************************************
.*                                  BW26L000              Called by: B26SW000 *
.*                     Calculate Base WIES26 for Low Outlier                  *
.******************************************************************************
BW26L000  MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES             * base WIES26
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES26  * IES26
.
            MOVE      PTWITDSW,WIS26WGT             * for display
            MOVE      "Same Day Wgt ",WIS26DSC
            GOTO      BW26L999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES             * base WIES26
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES26  * IES26
.
            MOVE      PTWITODW,WIS26WGT             * for display
            MOVE      "One Day Wgt  ",WIS26DSC
            GOTO      BW26L999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            ASSIGN    (PTWITODW+((WIS26LOS-1)*PTWITLOM)),TOTBWIES
.                                                    * base WIES26
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES26   * IES26
.
            MOVE      PTWITLOM,WIS26WGT             * for display
            MOVE      "Low Outlr Wgt",WIS26DSC
            GOTO      BW26L999
          ENDIF
BW26L999  RETURN
+
.******************************************************************************
.*                                  BW26N000              Called by: B26SW000 *
.*                      Calculate Base WIES26 for Inlier                      *
.******************************************************************************
BW26N000  MOVE      ONE,TOTIES26          * IES26 = 1
          MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES   * base WIES26
.
            MOVE      PTWITDSW,WIS26WGT             * for display
            MOVE      "Same Day Wgt ",WIS26DSC
            GOTO      BW26N999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES   * base WIES26
.
            MOVE      PTWITODW,WIS26WGT             * for display
            MOVE      "One Day Wgt  ",WIS26DSC
            GOTO      BW26N999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            MOVE      PTWITIMW,TOTBWIES   * base WIES26
.
            MOVE      PTWITIMW,WIS26WGT             * for display
            MOVE      "Inlier Wgt   ",WIS26DSC
            GOTO      BW26N999
          ENDIF
BW26N999  RETURN
+
.******************************************************************************
.*                                  BW26H000              Called by: B26SW000 *
.*                    Calculate Base WIES26 for High Outlier                  *
.******************************************************************************
BW26H000  ASSIGN    ((WIS26LOS-PTWIHIBP)-ADJMVDAY-ADJNVDAY),HIGHDAYS * high outl
          COMPARE   ZERO,HIGHDAYS
          IF        @LESS
            MOVE      ZERO,HIGHDAYS         * highdays must be >= zero
          ENDIF
.
          COMPARE   HIGHDAYS,HIHLOS
          IF        @LESS
            MOVE      HIHLOS,HITHDAYS       * get lesser of highdays and
          ELSE                              *  HIHLOS
            MOVE      HIGHDAYS,HITHDAYS
          ENDIF
.
          ASSIGN    (HIGHDAYS-HITHDAYS)*PTWITHOM,TOTBWIES    *high WIES
          ASSIGN    (HITHDAYS*PTWITHIH)+TOTBWIES,TOTBWIES    *HITH WIES
          ASSIGN    (PTWITIMW+TOTBWIES),TOTBWIES             *base WIES26
          ASSIGN    (TOTBWIES/PTWITIMW),TOTIES26             * IES26
.
          MOVE      PTWITHOM,WIS26WGT                        * for display
          MOVE      "High Outl Wgt",WIS26DSC
BW26H999  RETURN
+
.******************************************************************************
.*                                  C26AB000              Called by: PATWIS26 *
.*                          Check for Aboriginality                           *
.******************************************************************************
C26AB000  MOVE      ZERO,ATSIWIES                * set ATSI WIES to zero
          IF        PNSWRACE<1 | PNSWRACE>14
            GOTO      C26AB999              * Invalid parameter
          ENDIF
.
          LOAD      TCODE,PNSWRACE,CATP1,CATP2,CATP3,CATP4,CATP5:
                                   CATP6,CATA1,CATA2,CATA3,CATA4:
                                   CATA5,CATA6,CATA7,CATVA
          LOAD      ACODE,PNSWRACE,PUSR1,PUSR2,PUSR3,PUSR4,PUSR5:
                                   PUSR6,AUSR1,AUSR2,AUSR3,AUSR4:
                                   AUSR5,AUSR6,AUSR7,PMPXABRG
.
          MATCH     ACODE,SP3
          GOTO      C26AB999 IF EQUAL
.
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1                 * Read a code file record
          BRANCH    OVRCD,C26AB999
.
          UNPACK    THCSCOD,DIM1,KEY1       * use 2nd char of HDP Equiv
.>>>>     MOVE      THCSCOD,KEY1
          TYPE      KEY1
          GOTO      C26AB999 IF NOT EQUAL   * Non numeric, error
.
          MOVE      KEY1,FORM1
.
. ---- Calculate ATSI Loading if aboriginality = 1, 2, or 3 ----
.
          IF        FORM1=1 | FORM1=2 | FORM1=3
            MOVE      TOTBWIES,FORM12P4       * base WIES
            ADD       MVCOPAY,FORM12P4        * mechv copayment
            ADD       NIVCOPAY,FORM12P4       * ninv  copayment
            ADD       THCOPAY,FORM12P4        * thal  copayment
            ADD       AAACOPAY,FORM12P4       * AAA   copayment
            ADD       ASDCOPAY,FORM12P4       * ASD   copayment
            ADD       CPDCOPAY,FORM12P4       * CPD   copayment
            ASSIGN    (0.3*FORM12P4),ATSIWIES
          ENDIF
.
C26AB999  RETURN
+
.******************************************************************************
.         WIES 25
.******************************************************************************
PATWIS25  CALL      IN25W000                * Initialise variables
          BRANCH    EXIT,WIS25950
.
          CALL      C25TY000                * Determine and Check Care Type
          BRANCH    EXIT,WIS25950
.
          CALL      C25TR000                * Check for Contracted Patient
          BRANCH    EXIT,WIS25950
.
          CALL      C25PI000                * Check Specified Program Identifier
          BRANCH    EXIT,WIS25950
.
          CALL      M25RG000                * Modify DRG if necessary
.
          CALL      C25RG000                * Check for problem DRG
          BRANCH    EXIT,WIS25950
.
          CALL      M25CH000                * Check for Mechanical Ventilation
.
          CALL      T25AL000                * Check for Thalessaemia
.
          CALL      A25AA000                * Check for AAA
.
          CALL      A25SD000                * Check for ASD
.
          CALL      C25PD000                * Check for Cochlear Prosthetic
.
          CALL      B25SW000                * Calculate Base WIES25
.
          CALL      C25AB000                * Check for aboriginality
.
. ---- Calculate WIES25 value ----
.
          MOVE      TOTBWIES,TOTWIS25       * base WIES
          ADD       MVCOPAY,TOTWIS25        * mechv copayment
          ADD       NIVCOPAY,TOTWIS25       * ninv  copayment
          ADD       THCOPAY,TOTWIS25        * thal  copayment
          ADD       AAACOPAY,TOTWIS25       * AAA   copayment
          ADD       ASDCOPAY,TOTWIS25       * ASD   copayment
          ADD       CPDCOPAY,TOTWIS25       * CPD   copayment
          ADD       ATSIWIES,TOTWIS25       * ATSI  copayment
.
          MOVE      ZERO,EXIT
          GOTO      WIS25999
.
WIS25950  MOVE      ONE,EXIT
WIS25999  RETURN
+
.******************************************************************************
.*                                  IN25W000              Called by: PATWIS25 *
.*                         Initialise WIES variables                          *
.******************************************************************************
IN25W000  MOVE      ZERO,TOTWIS25
          MOVE      ZERO,WIS25LOS
          MOVE      ZERO,WIS25WGT
          MOVE      SP20,WIS25DSC
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATWIEA1,"patwieaf"
          TRAPCLR   IO
          BRANCH    OVRCD,IN25W950
.
IN25W900  MOVE      ZERO,EXIT
          GOTO      IN25W999
.
IN25W950  MOVE      ONE,EXIT
IN25W999  RETURN
+
.******************************************************************************
.*                                  C25TY000              Called by: PATWIS25 *
.*                 Check for valid Care Type (must be acute)                  *
.******************************************************************************
C25TY000  PACK     KEY5,ANSC,ANSC,ACARE     * use admission care type
          CALL     RDCODE1
          BRANCH   OVRCD,C25TY900
.
          MATCH    "6",TCINDC4              * Check Program Funding Source
          GOTO     C25TY900 IF NOT EQUAL
.
          MATCH    "4   ",THCSCOD           * check care type
          GOTO     C25TY900 IF NOT EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C25TY999
.
C25TY900  MOVE     ONE,EXIT                 * Not valid
C25TY999  RETURN
+
.******************************************************************************
.*                                  C25TR000              Called by: PATWIS25 *
.*                        Check for Contracted Patient                        *
.******************************************************************************
C25TR000  PACK     KEY25,AADMNO,SP70
          CALL     RSPTASF1
C25TR100  CALL     RKPTASF1                 * Read adm. special funding file
          BRANCH   OVRCD,C25TR800           * still process
.
          MATCH    AADMNO,PTAFADMN
          GOTO     C25TR800 IF NOT EQUAL    * still process
.
          MATCH    ANSA,PTAFTYPE            * special fund. arrang. type = adm
          GOTO     C25TR100 IF NOT EQUAL
.
          MATCH    ANSB,PTAFCROL            * Ignore if contract role = 'B'
          GOTO     C25TR900 IF EQUAL
.
C25TR800  MOVE     ZERO,EXIT                * valid
          GOTO     C25TR999
.
C25TR900  MOVE     ONE,EXIT                 * invalid
C25TR999  RETURN
+
.******************************************************************************
.*                                  C25PI000              Called by: PATWIS25 *
.*                        Check Specified Program Identifier                  *
.******************************************************************************
C25PI000  PACK     KEY5,ANSP,ANSK,PMVXPGID  * Program Identifier (Cat PK)
          CALL     RDCODE1
          BRANCH   OVRCD,C25PI800
.
          MATCH    "06",THCSCOD             * competitive elective surgery
          GOTO     C25PI900 IF EQUAL
.
C25PI800  MOVE     ZERO,EXIT                * valid
          GOTO     C25PI999
.
C25PI900  MOVE     ONE,EXIT                 * invalid
C25PI999  RETURN
+
.******************************************************************************
.*                                  M25RG000              Called by: PATWIS25 *
.*                      Modify DRG if necessary for WIES25                    *
.******************************************************************************
M25RG000  CALL      R25IO000           * Radiotherapy
          CALL      E25CR000           * Endovascular clot retrieval
M25RG999  RETURN
+
.******************************************************************************
.*                                  R25IO000              Called by: M25RG000 *
.*                         Modify DRG if Radiotherapy                         *
.******************************************************************************
.>>>>     Don't modify these DRGs:
.
R25IO000  MATCH     "A40",WIS25DRG
          GOTO      R25IO999 IF EQUAL
.
          MATCH     "B82",WIS25DRG
          GOTO      R25IO999 IF EQUAL
.
          MATCH     "B83",WIS25DRG
          GOTO      R25IO999 IF EQUAL
.
          MATCH     "W60",WIS25DRG
          GOTO      R25IO999 IF EQUAL
.
          MATCH     "W61",WIS25DRG
          GOTO      R25IO999 IF EQUAL
.
.>>>>     Check for sameday radiotherapy session:
.
          MATCH     ADATE,DDATE
          GOTO      R25IO040 IF NOT EQUAL
.
          UNPACK    WIS25DRG,DIM3
          MATCH     "R62",DIM3
          GOTO      R25IO999 IF NOT EQUAL
.
          PACK      ICDRDDTE,DDATE,SP10
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R25IO030  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R25IO040
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R25IO040 IF NOT EQUAL
.
          MATCH     "Z51.0",PTEDCODE        * radiotherapy?
          GOTO      R25IO030 IF NOT EQUAL
.
          GOTO      R25IO900                * modify drg for WIES25
.
.>>>>     Check if operation code exists (non-sameday):
.
R25IO040  MATCH     ADATE,DDATE
          GOTO      R25IO999 IF EQUAL       * don't modify sameday
.
.>>> Check if this is a surgical DRG - drg code position 2-3 between 01-39
.>>> if so do not change drg
          CALL      S25RG000
          BRANCH    EXIT,R25IO999
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
R25IO050  CALL      RKPTECO2                  episode operation file record
          BRANCH    OVRCD,R25IO999
.
          MATCH     AADMNO,PTEOADMN         * same admission?
          GOTO      R25IO999 IF NOT EQUAL
.
.>>>>     Check if block number is in range 1786-1792, 1794 or 1795:
.
          PACK      KEY9,PTEOCODE,SP9
          CALL      RDPTICO1
          BRANCH    OVRCD,R25IO050
.
          MATCH     "1786",PT0OBLKN         * block code >= 1786?
          GOTO      R25IO050 IF LESS
.
          MATCH     "1796",PT0OBLKN         * block code <=1795?
          GOTO      R25IO050 IF NOT LESS
.
          MATCH     "1793",PT0OBLKN         * block code = 1793?
          GOTO      R25IO050 IF EQUAL
.
.>>>>     Check if disease code exists in range C00-D48:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R25IO100  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R25IO999
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R25IO999 IF NOT EQUAL
.
          MATCH     "C00",PTEDCODE          * neoplasm code >= C00?
          GOTO      R25IO100 IF LESS
.
          MATCH     "D49",PTEDCODE          * neoplasm code <= D48.9?
          GOTO      R25IO100 IF NOT LESS
.
R25IO900  MOVE      "R64Z",WIS25DRG         * modified for WIES25
R25IO999  RETURN
+
.******************************************************************************
.*                                  E25CR000              Called by: M25RG000 *
.*                  Modify DRG if Endovascular clot retrieval                 *
.******************************************************************************
E25CR000  MATCH     "B02",WIS25DRG          * cranial procedures?
          GOTO      E25CR999 IF NOT EQUAL
.
.>>>>     Check if applicable operation code exists:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
E25CR100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,E25CR999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      E25CR999 IF NOT EQUAL
.
          MATCH     "90235-00",PTEOCODE     * check operation code exists
          GOTO      E25CR100 IF NOT EQUAL
.
.>>>>     Check if applicable disease code exists:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
E25CR200  CALL      RKPTECD2                * episode disease file record
          BRANCH    OVRCD,E25CR999
.
          MATCH     AADMNO,PTEDADMN
          GOTO      E25CR999 IF NOT EQUAL
.
          MATCH     "I63",PTEDCODE          * check if code is >= I63
          GOTO      E25CR200 IF LESS
.
          MATCH     "I67",PTEDCODE          * check if code is <= I66.9
          GOTO      E25CR200 IF NOT LESS
.
E25CR900  MOVE      "B02Y",WIS25DRG         * modified for WIES25
E25CR999  RETURN
+
.******************************************************************************
.*                                  C25RG000              Called by: PATWIS25 *
.*                            Check for Problem DRG                           *
.******************************************************************************
C25RG000  PACK     KEY7,WIS25DRG,WIESVERN
          CALL     RDPTWIE1
          BRANCH   OVRCD,C25RG900
.
          MATCH    "960Z",PTWIDRGC
          GOTO     C25RG900 IF EQUAL
.
          MATCH    "961Z",PTWIDRGC
          GOTO     C25RG900 IF EQUAL
.
          MATCH    "962Z",PTWIDRGC
          GOTO     C25RG900 IF EQUAL
.
          MATCH    "963Z",PTWIDRGC
          GOTO     C25RG900 IF EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C25RG999
.
C25RG900  MOVE     ONE,EXIT
C25RG999  RETURN
+
.******************************************************************************
.*                                  S25RG000              Called by: R25IO000 *
.*                Check if this is a surgical DRG                             *
.******************************************************************************
S25RG000  MOVE      ZERO,EXIT
          MOVE      ZERO,F2
.
. Use the second and third character of the DRG to determine if surgical
. Surgical (01 - 39) Other (40 - 59) Medical ( 60 - 99)
.
          UNPACK    WIS25DRG,DIM1,DIM2
          MOVE      DIM2,F2
          IF        F2<40
            GOTO      S25RG900
          ENDIF
          GOTO      S25RG999
.
S25RG900  MOVE      ONE,EXIT
.
S25RG999  RETURN
+
.******************************************************************************
.*                                  M25CH000              Called by: PATWIS25 *
.*                Calculate Mechanical Ventilation Co-payment                 *
.******************************************************************************
M25CH000  MOVE      ZERO,ADJMVDAY
          MOVE      ZERO,MVCOPAY
          MOVE      ZERO,ADJNVDAY
          MOVE      ZERO,NIVCOPAY
.
          PACK      KEY8,AADMNO
          CALL      RDPTICU1                * get mech. vent. hours
          BRANCH    OVRCD,M25CH999
.
          MATCH     "D",PTWIMVEL            * check mech. vent. eligibility
          IF        @EQUAL
            IF        PTICUMEC > 6
              ASSIGN    ((PTICUMEC+12)/24),FORM12P4    * days receiving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
            GOTO      M25CH900
          ENDIF
.
          MATCH     "4",PTWIMVEL
          IF        @EQUAL
            IF        PTICUMEC > 96
              ASSIGN    (((PTICUMEC+12)/24)-4),FORM12P4   * days recving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
          ENDIF
.
M25CH900  COMPARE   ZERO,MVCOPAY
          GOTO      M25CH999 IF NOT EQUAL   * not eligible if mechv copay exists
.
          CALL      N25CH000                * Check for Non-Invasive Ventilation
.
M25CH999  RETURN
+
.******************************************************************************
.*                                  N25CH000              Called by: M25CH000 *
.*                Calculate Non-Invasive Ventilation Co-payment               *
.******************************************************************************
N25CH000  MATCH     "D",PTWISDMT            * check ninv. vent. eligibility
          IF        @EQUAL
            IF        PTICCPAP > 6
              ASSIGN    ((PTICCPAP+12)/24),FORM12P4    * days receiving copay.
              MOVE      FORM12P4,ADJNVDAY
              ASSIGN    (ADJNVDAY*0.7659),NIVCOPAY * ninv. vent. copay.
            ENDIF
            GOTO      N25CH999
          ENDIF
.
          MATCH     "1",PTWISDMT
          IF        @EQUAL
            IF        PTICCPAP > 24
              ASSIGN    (((PTICCPAP+12)/24)-1),FORM12P4   * days recving copay.
              MOVE      FORM12P4,ADJNVDAY
              ASSIGN    (ADJNVDAY*0.7659),NIVCOPAY * ninv. vent. copay.
            ENDIF
          ENDIF
.
N25CH999  RETURN
+
.******************************************************************************
.*                                  T25AL000              Called by: PATWIS25 *
.*                      Calculate Thalessaemia Co-payment                     *
.******************************************************************************
T25AL000  MOVE      ZERO,THCOPAY
          MATCH     "T",PTWICPAY            * check WIES25 weights file
          IF        @EQUAL
            PACK      KEY16,AADMNO,SP20
            CALL      RSPTECD2              * Position on & read a patient
T25AL100    CALL      RKPTECD2                episode disease file record
            BRANCH    OVRCD,T25AL999
.
            MATCH     AADMNO,PTEDADMN
            GOTO      T25AL999 IF NOT EQUAL
.
            MATCH     "D56",PTEDCODE        * check ICD-10 code
            IF        !@EQUAL
              MATCH     "D57.2",PTEDCODE    * check ICD-10 code
              GOTO      T25AL100 IF NOT EQUAL
            ENDIF
            MOVE      "0.1089",THCOPAY      * eligible for thal. copayment
          ENDIF
T25AL999  RETURN
+
.******************************************************************************
.*                                  A25AA000              Called by: PATWIS25 *
.*                          Calculate AAA Co-payment                          *
.******************************************************************************
A25AA000  MOVE      ZERO,AAACOPAY
          MATCH     "AAA",PTWICPAY          * check WIES25 weights file
          GOTO      A25AA999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A25AA100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A25AA999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A25AA999 IF NOT EQUAL
.
          MATCH     "33116-00",PTEOCODE     * check ICD-10 code
          GOTO      A25AA100 IF NOT EQUAL
.
          MOVE      "3.1421",AAACOPAY       * eligible for AAA copayment
A25AA999  RETURN
+
.******************************************************************************
.*                                  A25SD000              Called by: PATWIS25 *
.*                          Calculate ASD Co-payment                          *
.******************************************************************************
A25SD000  MOVE      ZERO,ASDCOPAY
          MATCH     "ASD",PTWICPAY          * check WIES25 weights file
          GOTO      A25SD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A25SD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A25SD999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A25SD999 IF NOT EQUAL
.
          MATCH     "38742-00",PTEOCODE     * check ICD-10 code
          GOTO      A25SD100 IF NOT EQUAL
.
          MOVE      "2.4713",ASDCOPAY       * eligible for ASD copayment
A25SD999  RETURN
+
.******************************************************************************
.*                                  C25PD000              Called by: PATWIS25 *
.*                 Calculate Cochlear Prosthetic Device Co-payment            *
.******************************************************************************
C25PD000  MOVE      ZERO,CPDCOPAY
          MATCH     "B",PTWICPAY            * check WIES25 weights file
          GOTO      C25PD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
C25PD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,C25PD900
.
          MATCH     AADMNO,PTEOADMN
          GOTO      C25PD900 IF NOT EQUAL
.
          MATCH     "41617-00",PTEOCODE     * check for implant
          IF        @EQUAL
            ADD       ONE,CPDCOPAY
          ENDIF
          MATCH     "41617-01",PTEOCODE     * check for implant removal
          IF        @EQUAL
            SUB       ONE,CPDCOPAY
          ENDIF
          GOTO      C25PD100
.
C25PD900  IF        CPDCOPAY >= 2
            MOVE      "5.0544",CPDCOPAY     * eligible for CPD copayment
          ELSE
            MOVE      ZERO,CPDCOPAY         * not eligible for CPD copayment
          ENDIF
C25PD999  RETURN
+
.******************************************************************************
.*                                  B25SW000              Called by: PATWIS25 *
.*                            Calculate Base WIES25                           *
.******************************************************************************
B25SW000  MOVE      ZERO,TOTBWIES           * initialise base WIES25
          MOVE      TOTBWIES,WIS25WGT       * for display
          MOVE      SP70,WIS25DSC           * description
.
          CALL      C25SS000                * short stay unit?
          BRANCH    EXIT,B25SW999           * yes
.
          CALL      D25SC000                * length of stay category
          CALL      C25ST000                * calculate inlier status
.
          MATCH     "L",W25NLIER            * low outlier
          CALL      BW25L000 IF EQUAL       * calculate base WIES25
.
          MATCH     "I",W25NLIER            * inlier
          CALL      BW25N000 IF EQUAL       * calculate base WIES25
.
          MATCH     "H",W25NLIER            * high outlier
          CALL      BW25H000 IF EQUAL       * calculate base WIES25
.
B25SW999  RETURN
+
.******************************************************************************
.*                                  D25SC000              Called by: B25SW000 *
.*                      Determine Length Of Stay Category                     *
.******************************************************************************
D25SC000  MOVE      NBRDAYS,WIS25LOS        * length of stay from NHOSPDAY
          MOVE      "M",LOSCAT              * set LOS category to multiday
          MATCH     ADATE,DDATE             * check for sameday
          IF        @EQUAL
            MOVE      ONE,SAMEDAY           * sameday
            MOVE      ONE,WIS25LOS          * LOS = 1
            MOVE      "S",LOSCAT            * set LOS category to sameday
            GOTO      D25SC999
          ELSE
            MOVE      ZERO,SAMEDAY          * not sameday
          ENDIF
.
          IF        SAMEDAY = 0 & WIS25LOS = 1
            MOVE      "O",LOSCAT            * set LOS category to oneday
            GOTO      D25SC999
          ENDIF
.
          IF        WIS25LOS > 1825
            MOVE      "1825",WIS25LOS       * maximum LOS is 5 years
          ENDIF
.
D25SC999  RETURN
+
.******************************************************************************
.*                                  C25SS000              Called by: B25SW000 *
.*                            Check for short stay                            *
.******************************************************************************
C25SS000  MATCH     "S",PTWISSDR
          GOTO      C25SS900 IF NOT EQUAL      * is this a short stay drg?
.
          PACK      KEY30,AADMNO,SP70
          CALL      RDSTRAN2
C25SS100  CALL      RDKTRAN2
          BRANCH    OVRCD,C25SS999             * check visit is all short stay
.
          MATCH     AADMNO,TADMN
          GOTO      C25SS999 IF NOT EQUAL
.
          PACK      KEY5,ANSB,ANST,TRBTYP      * check bed type
          CALL      RDCODE1
          BRANCH    OVRCD,C25SS900
.
          MATCH     "S",THCSCOD                * short stay unit?
          GOTO      C25SS900 IF NOT EQUAL
.
          MOVE      PTWISSWT,TOTBWIES          * Set wies to short stay weight
          MOVE      TOTBWIES,WIS25WGT          * for display
          MOVE      "Shrt Stay Wgt",WIS25DSC   * description
          MOVE      ONE,EXIT                   * short stay = yes
          GOTO      C25SS100
.
C25SS900  MOVE      ZERO,TOTBWIES              * Set wies zero
          MOVE      TOTBWIES,WIS25WGT          * for display
          MOVE      SP70,WIS25DSC              * description
          MOVE      ZERO,EXIT                  * short stay = no
C25SS999  RETURN
+
.******************************************************************************
.*                                  C25ST000              Called by: B25SW000 *
.*                           Calculate Inlier Status                          *
.******************************************************************************
C25ST000  MOVE      "I",W25NLIER            * set status to inlier
          IF        WIS25LOS < PTWILIBP
            MOVE      "L",W25NLIER          * set status to low outlier
            GOTO      C25ST999
          ENDIF
.
          ASSIGN    (PTWIHIBP+ADJMVDAY+ADJNVDAY),FORM12P4  * HIBP + mv + ninv
          IF        WIS25LOS > FORM12P4
            MOVE      "H",W25NLIER          * set status to high outlier
          ENDIF
C25ST999  RETURN
+
.******************************************************************************
.*                                  BW25L000              Called by: B25SW000 *
.*                     Calculate Base WIES25 for Low Outlier                  *
.******************************************************************************
BW25L000  MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES             * base WIES25
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES25  * IES25
.
            MOVE      PTWITDSW,WIS25WGT             * for display
            MOVE      "Same Day Wgt ",WIS25DSC
            GOTO      BW25L999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES             * base WIES25
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES25  * IES25
.
            MOVE      PTWITODW,WIS25WGT             * for display
            MOVE      "One Day Wgt  ",WIS25DSC
            GOTO      BW25L999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            ASSIGN    (PTWITODW+((WIS25LOS-1)*PTWITLOM)),TOTBWIES
.                                                    * base WIES25
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES25   * IES25
.
            MOVE      PTWITLOM,WIS25WGT             * for display
            MOVE      "Low Outlr Wgt",WIS25DSC
            GOTO      BW25L999
          ENDIF
BW25L999  RETURN
+
.******************************************************************************
.*                                  BW25N000              Called by: B25SW000 *
.*                      Calculate Base WIES25 for Inlier                      *
.******************************************************************************
BW25N000  MOVE      ONE,TOTIES25          * IES25 = 1
          MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES   * base WIES25
.
            MOVE      PTWITDSW,WIS25WGT             * for display
            MOVE      "Same Day Wgt ",WIS25DSC
            GOTO      BW25N999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES   * base WIES25
.
            MOVE      PTWITODW,WIS25WGT             * for display
            MOVE      "One Day Wgt  ",WIS25DSC
            GOTO      BW25N999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            MOVE      PTWITIMW,TOTBWIES   * base WIES25
.
            MOVE      PTWITIMW,WIS25WGT             * for display
            MOVE      "Inlier Wgt   ",WIS25DSC
            GOTO      BW25N999
          ENDIF
BW25N999  RETURN
+
.******************************************************************************
.*                                  BW25H000              Called by: B25SW000 *
.*                    Calculate Base WIES25 for High Outlier                  *
.******************************************************************************
BW25H000  ASSIGN    ((WIS25LOS-PTWIHIBP)-ADJMVDAY-ADJNVDAY),HIGHDAYS * high outl
          COMPARE   ZERO,HIGHDAYS
          IF        @LESS
            MOVE      ZERO,HIGHDAYS         * highdays must be >= zero
          ENDIF
.
          COMPARE   HIGHDAYS,HIHLOS
          IF        @LESS
            MOVE      HIHLOS,HITHDAYS       * get lesser of highdays and
          ELSE                              *  HIHLOS
            MOVE      HIGHDAYS,HITHDAYS
          ENDIF
.
          ASSIGN    (HIGHDAYS-HITHDAYS)*PTWITHOM,TOTBWIES    *high WIES
          ASSIGN    (HITHDAYS*PTWITHIH)+TOTBWIES,TOTBWIES    *HITH WIES
          ASSIGN    (PTWITIMW+TOTBWIES),TOTBWIES             *base WIES25
          ASSIGN    (TOTBWIES/PTWITIMW),TOTIES25             * IES25
.
          MOVE      PTWITHOM,WIS25WGT                        * for display
          MOVE      "High Outl Wgt",WIS25DSC
BW25H999  RETURN
+
.******************************************************************************
.*                                  C25AB000              Called by: PATWIS25 *
.*                          Check for Aboriginality                           *
.******************************************************************************
C25AB000  MOVE      ZERO,ATSIWIES                * set ATSI WIES to zero
          IF        PNSWRACE<1 | PNSWRACE>14
            GOTO      C25AB999              * Invalid parameter
          ENDIF
.
          LOAD      TCODE,PNSWRACE,CATP1,CATP2,CATP3,CATP4,CATP5:
                                   CATP6,CATA1,CATA2,CATA3,CATA4:
                                   CATA5,CATA6,CATA7,CATVA
          LOAD      ACODE,PNSWRACE,PUSR1,PUSR2,PUSR3,PUSR4,PUSR5:
                                   PUSR6,AUSR1,AUSR2,AUSR3,AUSR4:
                                   AUSR5,AUSR6,AUSR7,PMPXABRG
.
          MATCH     ACODE,SP3
          GOTO      C25AB999 IF EQUAL
.
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1                 * Read a code file record
          BRANCH    OVRCD,C25AB999
.
          UNPACK    THCSCOD,DIM1,KEY1       * use 2nd char of HDP Equiv
.>>>>     MOVE      THCSCOD,KEY1
          TYPE      KEY1
          GOTO      C25AB999 IF NOT EQUAL   * Non numeric, error
.
          MOVE      KEY1,FORM1
.
. ---- Calculate ATSI Loading if aboriginality = 1, 2, or 3 ----
.
          IF        FORM1=1 | FORM1=2 | FORM1=3
            MOVE      TOTBWIES,FORM12P4       * base WIES
            ADD       MVCOPAY,FORM12P4        * mechv copayment
            ADD       NIVCOPAY,FORM12P4       * ninv  copayment
            ADD       THCOPAY,FORM12P4        * thal  copayment
            ADD       AAACOPAY,FORM12P4       * AAA   copayment
            ADD       ASDCOPAY,FORM12P4       * ASD   copayment
            ADD       CPDCOPAY,FORM12P4       * CPD   copayment
            ASSIGN    (0.3*FORM12P4),ATSIWIES
          ENDIF
.
C25AB999  RETURN
+
.******************************************************************************
.         WIES 24
.******************************************************************************
PATWIS24  CALL      IN24W000                * Initialise variables
          BRANCH    EXIT,WIS24950
.
          CALL      C24TY000                * Determine and Check Care Type
          BRANCH    EXIT,WIS24950
.
          CALL      C24TR000                * Check for Contracted Patient
          BRANCH    EXIT,WIS24950
.
          CALL      C24PI000                * Check Specified Program Identifier
          BRANCH    EXIT,WIS24950
.
          CALL      M24RG000                * Modify DRG if necessary
.
          CALL      C24RG000                * Check for problem DRG
          BRANCH    EXIT,WIS24950
.
          CALL      M24CH000                * Check for Mechanical Ventilation
.
          CALL      T24AL000                * Check for Thalessaemia
.
          CALL      A24AA000                * Check for AAA
.
          CALL      A24SD000                * Check for ASD
.
          CALL      C24PD000                * Check for Cochlear Prosthetic
.
          CALL      B24SW000                * Calculate Base WIES24
.
          CALL      C24AB000                * Check for aboriginality
.
. ---- Calculate WIES24 value ----
.
          MOVE      TOTBWIES,TOTWIS24       * base WIES
          ADD       MVCOPAY,TOTWIS24        * mechv copayment
          ADD       THCOPAY,TOTWIS24        * thal  copayment
          ADD       AAACOPAY,TOTWIS24       * AAA   copayment
          ADD       ASDCOPAY,TOTWIS24       * ASD   copayment
          ADD       CPDCOPAY,TOTWIS24       * CPD   copayment
          ADD       ATSIWIES,TOTWIS24       * ATSI  copayment
.
          MOVE      ZERO,EXIT
          GOTO      WIS24999
.
WIS24950  MOVE      ONE,EXIT
WIS24999  RETURN
+
.******************************************************************************
.*                                  IN24W000              Called by: PATWIS24 *
.*                         Initialise WIES variables                          *
.******************************************************************************
IN24W000  MOVE      ZERO,TOTWIS24
          MOVE      ZERO,WIS24LOS
          MOVE      ZERO,WIS24WGT
          MOVE      SP20,WIS24DSC
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATWIEA1,"patwieaf"
          TRAPCLR   IO
          BRANCH    OVRCD,IN24W950
.
IN24W900  MOVE      ZERO,EXIT
          GOTO      IN24W999
.
IN24W950  MOVE      ONE,EXIT
IN24W999  RETURN
+
.******************************************************************************
.*                                  C24TY000              Called by: PATWIS24 *
.*                 Check for valid Care Type (must be acute)                  *
.******************************************************************************
C24TY000  PACK     KEY5,ANSC,ANSC,ACARE     * use admission care type
          CALL     RDCODE1
          BRANCH   OVRCD,C24TY900
.
          MATCH    "6",TCINDC4              * Check Program Funding Source
          GOTO     C24TY900 IF NOT EQUAL
.
          MATCH    "4   ",THCSCOD           * check care type
          GOTO     C24TY900 IF NOT EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C24TY999
.
C24TY900  MOVE     ONE,EXIT                 * Not valid
C24TY999  RETURN
+
.******************************************************************************
.*                                  C24TR000              Called by: PATWIS24 *
.*                        Check for Contracted Patient                        *
.******************************************************************************
C24TR000  PACK     KEY25,AADMNO,SP70
          CALL     RSPTASF1
C24TR100  CALL     RKPTASF1                 * Read adm. special funding file
          BRANCH   OVRCD,C24TR800           * still process
.
          MATCH    AADMNO,PTAFADMN
          GOTO     C24TR800 IF NOT EQUAL    * still process
.
          MATCH    ANSA,PTAFTYPE            * special fund. arrang. type = adm
          GOTO     C24TR100 IF NOT EQUAL
.
          MATCH    ANSB,PTAFCROL            * Ignore if contract role = 'B'
          GOTO     C24TR900 IF EQUAL
.
C24TR800  MOVE     ZERO,EXIT                * valid
          GOTO     C24TR999
.
C24TR900  MOVE     ONE,EXIT                 * invalid
C24TR999  RETURN
+
.******************************************************************************
.*                                  C24PI000              Called by: PATWIS24 *
.*                        Check Specified Program Identifier                  *
.******************************************************************************
C24PI000  PACK     KEY5,ANSP,ANSK,PMVXPGID  * Program Identifier (Cat PK)
          CALL     RDCODE1
          BRANCH   OVRCD,C24PI800
.
          MATCH    "06",THCSCOD             * competitive elective surgery
          GOTO     C24PI900 IF EQUAL
.
C24PI800  MOVE     ZERO,EXIT                * valid
          GOTO     C24PI999
.
C24PI900  MOVE     ONE,EXIT                 * invalid
C24PI999  RETURN
+
.******************************************************************************
.*                                  M24RG000              Called by: PATWIS24 *
.*                      Modify DRG if necessary for WIES24                    *
.******************************************************************************
M24RG000  CALL      R24IO000           * Radiotherapy
          CALL      E24CR000           * Endovascular clot retrieval
M24RG999  RETURN
+
.******************************************************************************
.*                                  R24IO000              Called by: M24RG000 *
.*                         Modify DRG if Radiotherapy                         *
.******************************************************************************
.>>>>     Don't modify these DRGs:
.
R24IO000  MATCH     "B61",WIS24DRG
          GOTO      R24IO999 IF EQUAL
.
          MATCH     "A40",WIS24DRG
          GOTO      R24IO999 IF EQUAL
.
          MATCH     "B60",WIS24DRG
          GOTO      R24IO999 IF EQUAL
.
          MATCH     "B82",WIS24DRG
          GOTO      R24IO999 IF EQUAL
.
          MATCH     "S65",WIS24DRG
          GOTO      R24IO999 IF EQUAL
.
          MATCH     "W60",WIS24DRG
          GOTO      R24IO999 IF EQUAL
.
          MATCH     "W61",WIS24DRG
          GOTO      R24IO999 IF EQUAL
.
.>>>>     Check for sameday radiotherapy session:
.
          MATCH     ADATE,DDATE
          GOTO      R24IO040 IF NOT EQUAL
.
          UNPACK    WIS24DRG,DIM3
          MATCH     "R62",DIM3
          GOTO      R24IO999 IF NOT EQUAL
.
          PACK      ICDRDDTE,DDATE,SP10
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R24IO030  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R24IO040
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R24IO040 IF NOT EQUAL
.
          MATCH     "Z51.0",PTEDCODE        * radiotherapy?
          GOTO      R24IO030 IF NOT EQUAL
.
          GOTO      R24IO900                * modify drg for WIES24
.
.>>>>     Check if operation code exists (non-sameday):
.
R24IO040  MATCH     ADATE,DDATE
          GOTO      R24IO999 IF EQUAL       * don't modify sameday
.
.>>> Check if this is a surgical DRG - drg code position 2-3 between 01-39
.>>> if so do not change drg
          CALL      S24RG000
          BRANCH    EXIT,R24IO999
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
R24IO050  CALL      RKPTECO2                  episode operation file record
          BRANCH    OVRCD,R24IO999
.
          MATCH     AADMNO,PTEOADMN         * same admission?
          GOTO      R24IO999 IF NOT EQUAL
.
.>>>>     Check if block number is in range 1786-1792, 1794 or 1795:
.
          PACK      KEY9,PTEOCODE,SP9
          CALL      RDPTICO1
          BRANCH    OVRCD,R24IO050
.
          MATCH     "1786",PT0OBLKN         * block code >= 1786?
          GOTO      R24IO050 IF LESS
.
          MATCH     "1796",PT0OBLKN         * block code <=1795?
          GOTO      R24IO050 IF NOT LESS
.
          MATCH     "1793",PT0OBLKN         * block code = 1793?
          GOTO      R24IO050 IF EQUAL
.
.>>>>     Check if disease code exists in range C00-D48:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R24IO100  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R24IO999
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R24IO999 IF NOT EQUAL
.
          MATCH     "C00",PTEDCODE          * neoplasm code >= C00?
          GOTO      R24IO100 IF LESS
.
          MATCH     "D49",PTEDCODE          * neoplasm code <= D48.9?
          GOTO      R24IO100 IF NOT LESS
.
R24IO900  MOVE      "R64Z",WIS24DRG         * modified for WIES24
R24IO999  RETURN
+
.******************************************************************************
.*                                  E24CR000              Called by: M24RG000 *
.*                  Modify DRG if Endovascular clot retrieval                 *
.******************************************************************************
E24CR000  MATCH     "B02",WIS24DRG          * cranial procedures?
          GOTO      E24CR999 IF NOT EQUAL
.
.>>>>     Check if applicable operation code exists:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
E24CR100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,E24CR999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      E24CR999 IF NOT EQUAL
.
          MATCH     "90235-00",PTEOCODE     * check operation code exists
          GOTO      E24CR100 IF NOT EQUAL
.
.>>>>     Check if applicable disease code exists:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
E24CR200  CALL      RKPTECD2                * episode disease file record
          BRANCH    OVRCD,E24CR999
.
          MATCH     AADMNO,PTEDADMN
          GOTO      E24CR999 IF NOT EQUAL
.
          MATCH     "I63",PTEDCODE          * check if code is >= I63
          GOTO      E24CR200 IF LESS
.
          MATCH     "I67",PTEDCODE          * check if code is <= I66.9
          GOTO      E24CR200 IF NOT LESS
.
E24CR900  MOVE      "B02Y",WIS24DRG         * modified for WIES24
E24CR999  RETURN
+
.******************************************************************************
.*                                  C24RG000              Called by: PATWIS24 *
.*                            Check for Problem DRG                           *
.******************************************************************************
C24RG000  PACK     KEY7,WIS24DRG,WIESVERN
          CALL     RDPTWIE1
          BRANCH   OVRCD,C24RG900
.
          MATCH    "960Z",PTWIDRGC
          GOTO     C24RG900 IF EQUAL
.
          MATCH    "961Z",PTWIDRGC
          GOTO     C24RG900 IF EQUAL
.
          MATCH    "962Z",PTWIDRGC
          GOTO     C24RG900 IF EQUAL
.
          MATCH    "963Z",PTWIDRGC
          GOTO     C24RG900 IF EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C24RG999
.
C24RG900  MOVE     ONE,EXIT
C24RG999  RETURN
+
.******************************************************************************
.*                                  S24RG000              Called by: R24IO000 *
.*                Check if this is a surgical DRG                             *
.******************************************************************************
S24RG000  MOVE      ZERO,EXIT
          MOVE      ZERO,F2
.
. Use the second and third character of the DRG to determine if surgical
. Surgical (01 - 39) Other (40 - 59) Medical ( 60 - 99)
.
          UNPACK    WIS24DRG,DIM1,DIM2
          MOVE      DIM2,F2
          IF        F2<40
            GOTO      S24RG900
          ENDIF
          GOTO      S24RG999
.
S24RG900  MOVE      ONE,EXIT
.
S24RG999  RETURN
+
.******************************************************************************
.*                                  M24CH000              Called by: PATWIS24 *
.*                Calculate Mechanical Ventialtion Co-payment                 *
.******************************************************************************
M24CH000  MOVE      ZERO,ADJMVDAY
          MOVE      ZERO,MVCOPAY
.
          PACK      KEY8,AADMNO
          CALL      RDPTICU1                * get mech. vent. hours
          BRANCH    OVRCD,M24CH999
.
          MATCH     "D",PTWIMVEL            * check mech. vent. eligibility
          IF        @EQUAL
            IF        PTICUMEC > 6
              ASSIGN    ((PTICUMEC+12)/24),FORM12P4    * days receiving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
            GOTO      M24CH999
          ENDIF
.
          MATCH     "4",PTWIMVEL
          IF        @EQUAL
            IF        PTICUMEC > 96
              ASSIGN    (((PTICUMEC+12)/24)-4),FORM12P4   * days recving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
          ENDIF
.
M24CH999  RETURN
+
.******************************************************************************
.*                                  T24AL000              Called by: PATWIS24 *
.*                      Calculate Thalessaemia Co-payment                     *
.******************************************************************************
T24AL000  MOVE      ZERO,THCOPAY
          MATCH     "T",PTWICPAY            * check WIES24 weights file
          IF        @EQUAL
            PACK      KEY16,AADMNO,SP20
            CALL      RSPTECD2              * Position on & read a patient
T24AL100    CALL      RKPTECD2                episode disease file record
            BRANCH    OVRCD,T24AL999
.
            MATCH     AADMNO,PTEDADMN
            GOTO      T24AL999 IF NOT EQUAL
.
            MATCH     "D56",PTEDCODE        * check ICD-10 code
            IF        !@EQUAL
              MATCH     "D57.2",PTEDCODE    * check ICD-10 code
              GOTO      T24AL100 IF NOT EQUAL
            ENDIF
            MOVE      "0.1089",THCOPAY      * eligible for thal. copayment
          ENDIF
T24AL999  RETURN
+
.******************************************************************************
.*                                  A24AA000              Called by: PATWIS24 *
.*                          Calculate AAA Co-payment                          *
.******************************************************************************
A24AA000  MOVE      ZERO,AAACOPAY
          MATCH     "AAA",PTWICPAY          * check WIES24 weights file
          GOTO      A24AA999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A24AA100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A24AA999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A24AA999 IF NOT EQUAL
.
          MATCH     "33116-00",PTEOCODE     * check ICD-10 code
          GOTO      A24AA100 IF NOT EQUAL
.
          MOVE      "3.1421",AAACOPAY       * eligible for AAA copayment
A24AA999  RETURN
+
.******************************************************************************
.*                                  A24SD000              Called by: PATWIS24 *
.*                          Calculate ASD Co-payment                          *
.******************************************************************************
A24SD000  MOVE      ZERO,ASDCOPAY
          MATCH     "ASD",PTWICPAY          * check WIES24 weights file
          GOTO      A24SD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A24SD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A24SD999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A24SD999 IF NOT EQUAL
.
          MATCH     "38742-00",PTEOCODE     * check ICD-10 code
          GOTO      A24SD100 IF NOT EQUAL
.
          MOVE      "2.4713",ASDCOPAY       * eligible for ASD copayment
A24SD999  RETURN
+
.******************************************************************************
.*                                  C24PD000              Called by: PATWIS24 *
.*                 Calculate Cochlear Prosthetic Device Co-payment            *
.******************************************************************************
C24PD000  MOVE      ZERO,CPDCOPAY
          MATCH     "B",PTWICPAY            * check WIES24 weights file
          GOTO      C24PD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
C24PD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,C24PD900
.
          MATCH     AADMNO,PTEOADMN
          GOTO      C24PD900 IF NOT EQUAL
.
          MATCH     "41617-00",PTEOCODE     * check for implant
          IF        @EQUAL
            ADD       ONE,CPDCOPAY
          ENDIF
          MATCH     "41617-01",PTEOCODE     * check for implant removal
          IF        @EQUAL
            SUB       ONE,CPDCOPAY
          ENDIF
          GOTO      C24PD100
.
C24PD900  IF        CPDCOPAY >= 2
            MOVE      "5.0544",CPDCOPAY     * eligible for CPD copayment
          ELSE
            MOVE      ZERO,CPDCOPAY         * not eligible for CPD copayment
          ENDIF
C24PD999  RETURN
+
.******************************************************************************
.*                                  B24SW000              Called by: PATWIS24 *
.*                            Calculate Base WIES24                           *
.******************************************************************************
B24SW000  MOVE      ZERO,TOTBWIES           * initialise base WIES24
          MOVE      TOTBWIES,WIS24WGT       * for display
          MOVE      SP70,WIS24DSC           * description
.
          CALL      C24SS000                * short stay unit?
          BRANCH    EXIT,B24SW999           * yes
.
          CALL      D24SC000                * length of stay category
          CALL      C24ST000                * calculate inlier status
.
          MATCH     "L",W24NLIER            * low outlier
          CALL      BW24L000 IF EQUAL       * calculate base WIES24
.
          MATCH     "I",W24NLIER            * inlier
          CALL      BW24N000 IF EQUAL       * calculate base WIES24
.
          MATCH     "H",W24NLIER            * high outlier
          CALL      BW24H000 IF EQUAL       * calculate base WIES24
.
B24SW999  RETURN
+
.******************************************************************************
.*                                  D24SC000              Called by: B24SW000 *
.*                      Determine Length Of Stay Category                     *
.******************************************************************************
D24SC000  MOVE      NBRDAYS,WIS24LOS        * length of stay from NHOSPDAY
          MOVE      "M",LOSCAT              * set LOS category to multiday
          MATCH     ADATE,DDATE             * check for sameday
          IF        @EQUAL
            MOVE      ONE,SAMEDAY           * sameday
            MOVE      ONE,WIS24LOS          * LOS = 1
            MOVE      "S",LOSCAT            * set LOS category to sameday
            GOTO      D24SC999
          ELSE
            MOVE      ZERO,SAMEDAY          * not sameday
          ENDIF
.
          IF        SAMEDAY = 0 & WIS24LOS = 1
            MOVE      "O",LOSCAT            * set LOS category to oneday
            GOTO      D24SC999
          ENDIF
.
          IF        WIS24LOS > 1825
            MOVE      "1825",WIS24LOS       * maximum LOS is 5 years
          ENDIF
.
D24SC999  RETURN
+
.******************************************************************************
.*                                  C24SS000              Called by: B24SW000 *
.*                            Check for short stay                            *
.******************************************************************************
C24SS000  MATCH     "S",PTWISSDR
          GOTO      C24SS900 IF NOT EQUAL      * is this a short stay drg?
.
          PACK      KEY30,AADMNO,SP70
          CALL      RDSTRAN2
C24SS100  CALL      RDKTRAN2
          BRANCH    OVRCD,C24SS999             * check visit is all short stay
.
          MATCH     AADMNO,TADMN
          GOTO      C24SS999 IF NOT EQUAL
.
          PACK      KEY5,ANSB,ANST,TRBTYP      * check bed type
          CALL      RDCODE1
          BRANCH    OVRCD,C24SS900
.
          MATCH     "S",THCSCOD                * short stay unit?
          GOTO      C24SS900 IF NOT EQUAL
.
          MOVE      PTWISSWT,TOTBWIES          * Set wies to short stay weight
          MOVE      TOTBWIES,WIS24WGT          * for display
          MOVE      "Shrt Stay Wgt",WIS24DSC   * description
          MOVE      ONE,EXIT                   * short stay = yes
          GOTO      C24SS100
.
C24SS900  MOVE      ZERO,TOTBWIES              * Set wies zero
          MOVE      TOTBWIES,WIS24WGT          * for display
          MOVE      SP70,WIS24DSC              * description
          MOVE      ZERO,EXIT                  * short stay = no
C24SS999  RETURN
+
.******************************************************************************
.*                                  C24ST000              Called by: B24SW000 *
.*                           Calculate Inlier Status                          *
.******************************************************************************
C24ST000  MOVE      "I",W24NLIER            * set status to inlier
          IF        WIS24LOS < PTWILIBP
            MOVE      "L",W24NLIER          * set status to low outlier
            GOTO      C24ST999
          ENDIF
.
          ASSIGN    (PTWIHIBP+ADJMVDAY),FORM12P4   * high bound. + mech.v days
          IF        WIS24LOS > FORM12P4
            MOVE      "H",W24NLIER          * set status to high outlier
          ENDIF
C24ST999  RETURN
+
.******************************************************************************
.*                                  BW24L000              Called by: B24SW000 *
.*                     Calculate Base WIES24 for Low Outlier                  *
.******************************************************************************
BW24L000  MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES             * base WIES24
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES24  * IES24
.
            MOVE      PTWITDSW,WIS24WGT             * for display
            MOVE      "Same Day Wgt ",WIS24DSC
            GOTO      BW24L999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES             * base WIES24
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES24  * IES24
.
            MOVE      PTWITODW,WIS24WGT             * for display
            MOVE      "One Day Wgt  ",WIS24DSC
            GOTO      BW24L999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            ASSIGN    (PTWITODW+((WIS24LOS-1)*PTWITLOM)),TOTBWIES
.                                                    * base WIES24
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES24   * IES24
.
            MOVE      PTWITLOM,WIS24WGT             * for display
            MOVE      "Low Outlr Wgt",WIS24DSC
            GOTO      BW24L999
          ENDIF
BW24L999  RETURN
+
.******************************************************************************
.*                                  BW24N000              Called by: B24SW000 *
.*                      Calculate Base WIES24 for Inlier                      *
.******************************************************************************
BW24N000  MOVE      ONE,TOTIES24          * IES24 = 1
          MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES   * base WIES24
.
            MOVE      PTWITDSW,WIS24WGT             * for display
            MOVE      "Same Day Wgt ",WIS24DSC
            GOTO      BW24N999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES   * base WIES24
.
            MOVE      PTWITODW,WIS24WGT             * for display
            MOVE      "One Day Wgt  ",WIS24DSC
            GOTO      BW24N999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            MOVE      PTWITIMW,TOTBWIES   * base WIES24
.
            MOVE      PTWITIMW,WIS24WGT             * for display
            MOVE      "Inlier Wgt   ",WIS24DSC
            GOTO      BW24N999
          ENDIF
BW24N999  RETURN
+
.******************************************************************************
.*                                  BW24H000              Called by: B24SW000 *
.*                    Calculate Base WIES24 for High Outlier                  *
.******************************************************************************
BW24H000  ASSIGN    ((WIS24LOS-PTWIHIBP)-ADJMVDAY),HIGHDAYS  * high outlr days
          COMPARE   ZERO,HIGHDAYS
          IF        @LESS
            MOVE      ZERO,HIGHDAYS         * highdays must be >= zero
          ENDIF
.
          COMPARE   HIGHDAYS,HIHLOS
          IF        @LESS
            MOVE      HIHLOS,HITHDAYS       * get lesser of highdays and
          ELSE                              *  HIHLOS
            MOVE      HIGHDAYS,HITHDAYS
          ENDIF
.
          ASSIGN    (HIGHDAYS-HITHDAYS)*PTWITHOM,TOTBWIES    *high WIES
          ASSIGN    (HITHDAYS*PTWITHIH)+TOTBWIES,TOTBWIES    *HITH WIES
          ASSIGN    (PTWITIMW+TOTBWIES),TOTBWIES             *base WIES24
          ASSIGN    (TOTBWIES/PTWITIMW),TOTIES24             * IES24
.
          MOVE      PTWITHOM,WIS24WGT                        * for display
          MOVE      "High Outl Wgt",WIS24DSC
BW24H999  RETURN
+
.******************************************************************************
.*                                  C24AB000              Called by: PATWIS24 *
.*                          Check for Aboriginality                           *
.******************************************************************************
C24AB000  MOVE      ZERO,ATSIWIES                * set ATSI WIES to zero
          IF        PNSWRACE<1 | PNSWRACE>14
            GOTO      C24AB999              * Invalid parameter
          ENDIF
.
          LOAD      TCODE,PNSWRACE,CATP1,CATP2,CATP3,CATP4,CATP5:
                                   CATP6,CATA1,CATA2,CATA3,CATA4:
                                   CATA5,CATA6,CATA7,CATVA
          LOAD      ACODE,PNSWRACE,PUSR1,PUSR2,PUSR3,PUSR4,PUSR5:
                                   PUSR6,AUSR1,AUSR2,AUSR3,AUSR4:
                                   AUSR5,AUSR6,AUSR7,PMPXABRG
.
          MATCH     ACODE,SP3
          GOTO      C24AB999 IF EQUAL
.
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1                 * Read a code file record
          BRANCH    OVRCD,C24AB999
.
          UNPACK    THCSCOD,DIM1,KEY1       * use 2nd char of HDP Equiv
.>>>>     MOVE      THCSCOD,KEY1
          TYPE      KEY1
          GOTO      C24AB999 IF NOT EQUAL   * Non numeric, error
.
          MOVE      KEY1,FORM1
.
. ---- Calculate ATSI Loading if aboriginality = 1, 2, or 3 ----
.
          IF        FORM1=1 | FORM1=2 | FORM1=3
            MOVE      TOTBWIES,FORM12P4       * base WIES
            ADD       MVCOPAY,FORM12P4        * mechv copayment
            ADD       THCOPAY,FORM12P4        * thal  copayment
            ADD       AAACOPAY,FORM12P4       * AAA   copayment
            ADD       ASDCOPAY,FORM12P4       * ASD   copayment
            ADD       CPDCOPAY,FORM12P4       * CPD   copayment
            ASSIGN    (0.3*FORM12P4),ATSIWIES
          ENDIF
.
C24AB999  RETURN
+
.******************************************************************************
.         WIES 23
.******************************************************************************
PATWIS23  CALL      IN23W000                * Initialise variables
          BRANCH    EXIT,WIS23950
.
          CALL      C23TY000                * Determine and Check Care Type
          BRANCH    EXIT,WIS23950
.
          CALL      C23TR000                * Check for Contracted Patient
          BRANCH    EXIT,WIS23950
.
          CALL      C23PI000                * Check Specified Program Identifier
          BRANCH    EXIT,WIS23950
.
.0825157  CALL      C23ET000                * Check electroconvulsive therapy
.0825157  BRANCH    EXIT,WIS23950
.
          CALL      M23RG000                * Modify DRG if necessary
.
          CALL      C23RG000                * Check for problem DRG
          BRANCH    EXIT,WIS23950
.
          CALL      M23CH000                * Check for Mechanical Ventilation
.
          CALL      T23AL000                * Check for Thalessaemia
.
          CALL      A23AA000                * Check for AAA
.
          CALL      A23SD000                * Check for ASD
.
          CALL      C23PD000                * Check for Cochlear Prosthetic
.
          CALL      B23SW000                * Calculate Base WIES23
.
          CALL      C23AB000                * Check for aboriginality
.
. ---- Calculate WIES23 value ----
.
          MOVE      TOTBWIES,TOTWIS23       * base WIES
          ADD       MVCOPAY,TOTWIS23        * mechv copayment
          ADD       THCOPAY,TOTWIS23        * thal  copayment
          ADD       AAACOPAY,TOTWIS23       * AAA   copayment
          ADD       ASDCOPAY,TOTWIS23       * ASD   copayment
          ADD       CPDCOPAY,TOTWIS23       * CPD   copayment
          ADD       ATSIWIES,TOTWIS23       * ATSI  copayment
.
          MOVE      ZERO,EXIT
          GOTO      WIS23999
.
WIS23950  MOVE      ONE,EXIT
WIS23999  RETURN
+
.******************************************************************************
.*                                  IN23W000              Called by: PATWIS23 *
.*                         Initialise WIES variables                          *
.******************************************************************************
IN23W000  MOVE      ZERO,TOTWIS23
          MOVE      ZERO,WIS23LOS
          MOVE      ZERO,WIS23WGT
          MOVE      SP20,WIS23DSC
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATWIEA1,"patwieaf"
          TRAPCLR   IO
          BRANCH    OVRCD,IN23W950
.
IN23W900  MOVE      ZERO,EXIT
          GOTO      IN23W999
.
IN23W950  MOVE      ONE,EXIT
IN23W999  RETURN
+
.******************************************************************************
.*                                  C23TY000              Called by: PATWIS23 *
.*                 Check for valid Care Type & Incomplete Coding              *
.******************************************************************************
C23TY000  PACK     KEY5,ANSC,ANSC,ACARE     * use admission care type
          CALL     RDCODE1
          BRANCH   OVRCD,C23TY900
.
          MATCH    "6",TCINDC4              * Check Program Funding Source
          GOTO     C23TY900 IF NOT EQUAL
.
          MATCH    "0   ",THCSCOD           * check care types
          GOTO     C23TY900 IF EQUAL
          MATCH    "1   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "2   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "6   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "7   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "8   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "9   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "5   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "3   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "E   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "F   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "J   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "K   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
          MATCH    "U   ",THCSCOD
          GOTO     C23TY900 IF EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C23TY999
.
C23TY900  MOVE     ONE,EXIT                 * Not valid
C23TY999  RETURN
+
.******************************************************************************
.*                                  C23TR000              Called by: PATWIS23 *
.*                        Check for Contracted Patient                        *
.******************************************************************************
C23TR000  PACK     KEY25,AADMNO,SP70
          CALL     RSPTASF1
C23TR100  CALL     RKPTASF1                 * Read adm. special funding file
          BRANCH   OVRCD,C23TR800           * still process
.
          MATCH    AADMNO,PTAFADMN
          GOTO     C23TR800 IF NOT EQUAL    * still process
.
          MATCH    ANSA,PTAFTYPE            * special fund. arrang. type = adm
          GOTO     C23TR100 IF NOT EQUAL
.
          MATCH    ANSB,PTAFCROL            * Ignore if contract role = 'B'
          GOTO     C23TR900 IF EQUAL
.
C23TR800  MOVE     ZERO,EXIT                * valid
          GOTO     C23TR999
.
C23TR900  MOVE     ONE,EXIT                 * invalid
C23TR999  RETURN
+
.******************************************************************************
.*                                  C23PI000              Called by: PATWIS23 *
.*                        Check Specified Program Identifier                  *
.******************************************************************************
C23PI000  PACK     KEY5,ANSP,ANSK,PMVXPGID  * Program Identifier (Cat PK)
          CALL     RDCODE1
          BRANCH   OVRCD,C23PI800
.
          MATCH    "06",THCSCOD             * competitive elective surgery
          GOTO     C23PI900 IF EQUAL
.
C23PI800  MOVE     ZERO,EXIT                * valid
          GOTO     C23PI999
.
C23PI900  MOVE     ONE,EXIT                 * invalid
C23PI999  RETURN
+
.******************************************************************************
.*                                  C23ET000              Called by: PATWIS23 *
.*                   Check for electroconvulsive therapy code                 *
.******************************************************************************
C23ET000  PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
C23ET100  CALL      RKPTECO2                  episode operation file record
          BRANCH    OVRCD,C23ET800
.
          MATCH     AADMNO,PTEOADMN         * same admission?
          GOTO      C23ET800 IF NOT EQUAL
.
.>>>>     Check if block number is 1907
.
          PACK      KEY9,PTEOCODE,SP9
          CALL      RDPTICO1
          BRANCH    OVRCD,C23ET100
.
          MATCH     "1907",PT0OBLKN
          IF        @EQUAL
            GOTO      C23ET900
          ELSE
            GOTO      C23ET100
          ENDIF
.
C23ET800  MOVE     ZERO,EXIT                * valid
          GOTO     C23ET999
.
C23ET900  MOVE     ONE,EXIT                 * invalid
C23ET999  RETURN
+
.******************************************************************************
.*                                  M23RG000              Called by: PATWIS23 *
.*                      Modify DRG if necessary for WIES23                    *
.******************************************************************************
M23RG000  CALL      R23IO000           * Radiotherapy
M23RG999  RETURN
+
.******************************************************************************
.*                                  R23IO000              Called by: M23RG000 *
.*                         Modify DRG if Radiotherapy                         *
.******************************************************************************
.>>>>     Don't modify these DRGs:
.
R23IO000  MATCH     "B61",WIS23DRG
          GOTO      R23IO999 IF EQUAL
.
          MATCH     "A40",WIS23DRG
          GOTO      R23IO999 IF EQUAL
.
          MATCH     "B60",WIS23DRG
          GOTO      R23IO999 IF EQUAL
.
          MATCH     "B82",WIS23DRG
          GOTO      R23IO999 IF EQUAL
.
          MATCH     "S65",WIS23DRG
          GOTO      R23IO999 IF EQUAL
.
          MATCH     "W60",WIS23DRG
          GOTO      R23IO999 IF EQUAL
.
          MATCH     "W61",WIS23DRG
          GOTO      R23IO999 IF EQUAL
.
.>>>>     Check for sameday radiotherapy session:
.
          MATCH     ADATE,DDATE
          GOTO      R23IO040 IF NOT EQUAL
.
          UNPACK    WIS23DRG,DIM3
          MATCH     "R62",DIM3
          GOTO      R23IO999 IF NOT EQUAL
.
          PACK      ICDRDDTE,DDATE,SP10
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R23IO030  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R23IO040
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R23IO040 IF NOT EQUAL
.
          MATCH     "Z51.0",PTEDCODE        * radiotherapy?
          GOTO      R23IO030 IF NOT EQUAL
.
          GOTO      R23IO900                * modify drg for WIES23
.
.>>>>     Check if operation code exists (non-sameday):
.
R23IO040  MATCH     ADATE,DDATE
          GOTO      R23IO999 IF EQUAL       * don't modify sameday
.
.>>> Check if this is a surgical DRG - drg code position 2-3 between 01-39
.>>> if so do not change drg
          CALL      S23RG000
          BRANCH    EXIT,R23IO999
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
R23IO050  CALL      RKPTECO2                  episode operation file record
          BRANCH    OVRCD,R23IO999
.
          MATCH     AADMNO,PTEOADMN         * same admission?
          GOTO      R23IO999 IF NOT EQUAL
.
.>>>>     Check if block number is in range 1786-1792, 1794 or 1795:
.
          PACK      KEY9,PTEOCODE,SP9
          CALL      RDPTICO1
          BRANCH    OVRCD,R23IO050
.
          MATCH     "1786",PT0OBLKN         * block code >= 1786?
          GOTO      R23IO050 IF LESS
.
          MATCH     "1796",PT0OBLKN         * block code <=1795?
          GOTO      R23IO050 IF NOT LESS
.
          MATCH     "1793",PT0OBLKN         * block code = 1793?
          GOTO      R23IO050 IF EQUAL
.
.>>>>     Check if disease code exists in range C00-D48:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R23IO100  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R23IO999
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R23IO999 IF NOT EQUAL
.
          MATCH     "C00",PTEDCODE          * neoplasm code >= C00?
          GOTO      R23IO100 IF LESS
.
          MATCH     "D49",PTEDCODE          * neoplasm code <= D48.9?
          GOTO      R23IO100 IF NOT LESS
.
R23IO900  MOVE      "R64Z",WIS23DRG         * modified for WIES23
R23IO999  RETURN
+
.******************************************************************************
.*                                  C23RG000              Called by: PATWIS23 *
.*                            Check for Problem DRG                           *
.******************************************************************************
C23RG000  PACK     KEY7,WIS23DRG,WIESVERN
          CALL     RDPTWIE1
          BRANCH   OVRCD,C23RG900
.
          MATCH    "960Z",PTWIDRGC
          GOTO     C23RG900 IF EQUAL
.
          MATCH    "961Z",PTWIDRGC
          GOTO     C23RG900 IF EQUAL
.
          MATCH    "962Z",PTWIDRGC
          GOTO     C23RG900 IF EQUAL
.
          MATCH    "963Z",PTWIDRGC
          GOTO     C23RG900 IF EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C23RG999
.
C23RG900  MOVE     ONE,EXIT
C23RG999  RETURN
+
.******************************************************************************
.*                                  S23RG000              Called by: R23IO000 *
.*                Check if this is a surgical DRG                             *
.******************************************************************************
S23RG000  MOVE      ZERO,EXIT
          MOVE      ZERO,F2
.
. Use the second and third character of the DRG to determine if surgical
. Surgical (01 - 39) Other (40 - 59) Medical ( 60 - 99)
.
          UNPACK    WIS23DRG,DIM1,DIM2
          MOVE      DIM2,F2
          IF        F2<40
            GOTO      S23RG900
          ENDIF
          GOTO      S23RG999
.
S23RG900  MOVE      ONE,EXIT
.
S23RG999  RETURN
+
.******************************************************************************
.*                                  M23CH000              Called by: PATWIS23 *
.*                Calculate Mechanical Ventialtion Co-payment                 *
.******************************************************************************
M23CH000  MOVE      ZERO,ADJMVDAY
          MOVE      ZERO,MVCOPAY
.
          PACK      KEY8,AADMNO
          CALL      RDPTICU1                * get mech. vent. hours
          BRANCH    OVRCD,M23CH999
.
          MATCH     "D",PTWIMVEL            * check mech. vent. eligibility
          IF        @EQUAL
            IF        PTICUMEC > 6
              ASSIGN    ((PTICUMEC+12)/24),FORM12P4    * days receiving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
            GOTO      M23CH999
          ENDIF
.
          MATCH     "4",PTWIMVEL
          IF        @EQUAL
            IF        PTICUMEC > 96
              ASSIGN    (((PTICUMEC+12)/24)-4),FORM12P4   * days recving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
          ENDIF
.
M23CH999  RETURN
+
.******************************************************************************
.*                                  T23AL000              Called by: PATWIS23 *
.*                      Calculate Thalessaemia Co-payment                     *
.******************************************************************************
T23AL000  MOVE      ZERO,THCOPAY
          MATCH     "T",PTWICPAY            * check WIES23 weights file
          IF        @EQUAL
            PACK      KEY16,AADMNO,SP20
            CALL      RSPTECD2              * Position on & read a patient
T23AL100    CALL      RKPTECD2                episode disease file record
            BRANCH    OVRCD,T23AL999
.
            MATCH     AADMNO,PTEDADMN
            GOTO      T23AL999 IF NOT EQUAL
.
            MATCH     "D56",PTEDCODE        * check ICD-10 code
            IF        !@EQUAL
              MATCH     "D57.2",PTEDCODE    * check ICD-10 code
              GOTO      T23AL100 IF NOT EQUAL
            ENDIF
            MOVE      "0.2648",THCOPAY      * eligible for thal. copayment
          ENDIF
T23AL999  RETURN
+
.******************************************************************************
.*                                  A23AA000              Called by: PATWIS23 *
.*                          Calculate AAA Co-payment                          *
.******************************************************************************
A23AA000  MOVE      ZERO,AAACOPAY
          MATCH     "AAA",PTWICPAY          * check WIES23 weights file
          GOTO      A23AA999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A23AA100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A23AA999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A23AA999 IF NOT EQUAL
.
          MATCH     "33116-00",PTEOCODE     * check ICD-10 code
          GOTO      A23AA100 IF NOT EQUAL
.
          MOVE      "3.1421",AAACOPAY       * eligible for AAA copayment
A23AA999  RETURN
+
.******************************************************************************
.*                                  A23SD000              Called by: PATWIS23 *
.*                          Calculate ASD Co-payment                          *
.******************************************************************************
A23SD000  MOVE      ZERO,ASDCOPAY
          MATCH     "ASD",PTWICPAY          * check WIES23 weights file
          GOTO      A23SD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A23SD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A23SD999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A23SD999 IF NOT EQUAL
.
          MATCH     "38742-00",PTEOCODE     * check ICD-10 code
          GOTO      A23SD100 IF NOT EQUAL
.
          MOVE      "2.4713",ASDCOPAY       * eligible for ASD copayment
A23SD999  RETURN
+
.******************************************************************************
.*                                  C23PD000              Called by: PATWIS23 *
.*                 Calculate Cochlear Prosthetic Device Co-payment            *
.******************************************************************************
C23PD000  MOVE      ZERO,CPDCOPAY
          MATCH     "B",PTWICPAY            * check WIES23 weights file
          GOTO      C23PD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
C23PD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,C23PD900
.
          MATCH     AADMNO,PTEOADMN
          GOTO      C23PD900 IF NOT EQUAL
.
          MATCH     "41617-00",PTEOCODE     * check for implant
          IF        @EQUAL
            ADD       ONE,CPDCOPAY
          ENDIF
          MATCH     "41617-01",PTEOCODE     * check for implant removal
          IF        @EQUAL
            SUB       ONE,CPDCOPAY
          ENDIF
          GOTO      C23PD100
.
C23PD900  IF        CPDCOPAY >= 2
            MOVE      "5.0544",CPDCOPAY     * eligible for CPD copayment
          ELSE
            MOVE      ZERO,CPDCOPAY         * not eligible for CPD copayment
          ENDIF
C23PD999  RETURN
+
.******************************************************************************
.*                                  B23SW000              Called by: PATWIS23 *
.*                            Calculate Base WIES23                           *
.******************************************************************************
B23SW000  CALL      D23SC000                * length of stay category
          CALL      C23ST000                * calculate inlier status
.
          MATCH     "L",W23NLIER            * low outlier
          CALL      BW23L000 IF EQUAL       * calculate base WIES23
.
          MATCH     "I",W23NLIER            * inlier
          CALL      BW23N000 IF EQUAL       * calculate base WIES23
.
          MATCH     "H",W23NLIER            * high outlier
          CALL      BW23H000 IF EQUAL       * calculate base WIES23
.
B23SW999  RETURN
+
.******************************************************************************
.*                                  D23SC000              Called by: B23SW000 *
.*                      Determine Length Of Stay Category                     *
.******************************************************************************
D23SC000  MOVE      NBRDAYS,WIS23LOS        * length of stay from NHOSPDAY
          MOVE      "M",LOSCAT              * set LOS category to multiday
          MATCH     ADATE,DDATE             * check for sameday
          IF        @EQUAL
            MOVE      ONE,SAMEDAY           * sameday
            MOVE      ONE,WIS23LOS          * LOS = 1
            MOVE      "S",LOSCAT            * set LOS category to sameday
            GOTO      D23SC999
          ELSE
            MOVE      ZERO,SAMEDAY          * not sameday
          ENDIF
.
          IF        SAMEDAY = 0 & WIS23LOS = 1
            MOVE      "O",LOSCAT            * set LOS category to oneday
            GOTO      D23SC999
          ENDIF
.
          IF        WIS23LOS > 1825
            MOVE      "1825",WIS23LOS       * maximum LOS is 5 years
          ENDIF
.
D23SC999  RETURN
+
.******************************************************************************
.*                                  C23ST000              Called by: B23SW000 *
.*                           Calculate Inlier Status                          *
.******************************************************************************
C23ST000  MOVE      "I",W23NLIER            * set status to inlier
          IF        WIS23LOS < PTWILIBP
            MOVE      "L",W23NLIER          * set status to low outlier
            GOTO      C23ST999
          ENDIF
.
          ASSIGN    (PTWIHIBP+ADJMVDAY),FORM12P4   * high bound. + mech.v days
          IF        WIS23LOS > FORM12P4
            MOVE      "H",W23NLIER          * set status to high outlier
          ENDIF
C23ST999  RETURN
+
.******************************************************************************
.*                                  BW23L000              Called by: B23SW000 *
.*                     Calculate Base WIES23 for Low Outlier                  *
.******************************************************************************
BW23L000  MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES             * base WIES23
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES23  * IES23
.
            MOVE      PTWITDSW,WIS23WGT             * for display
            MOVE      "Same Day Wgt ",WIS23DSC
            GOTO      BW23L999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES             * base WIES23
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES23  * IES23
.
            MOVE      PTWITODW,WIS23WGT             * for display
            MOVE      "One Day Wgt  ",WIS23DSC
            GOTO      BW23L999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            ASSIGN    (PTWITODW+((WIS23LOS-1)*PTWITLOM)),TOTBWIES
.                                                    * base WIES23
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES23   * IES23
.
            MOVE      PTWITLOM,WIS23WGT             * for display
            MOVE      "Low Outlr Wgt",WIS23DSC
            GOTO      BW23L999
          ENDIF
BW23L999  RETURN
+
.******************************************************************************
.*                                  BW23N000              Called by: B23SW000 *
.*                      Calculate Base WIES23 for Inlier                      *
.******************************************************************************
BW23N000  MOVE      ONE,TOTIES23          * IES23 = 1
          MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES   * base WIES23
.
            MOVE      PTWITDSW,WIS23WGT             * for display
            MOVE      "Same Day Wgt ",WIS23DSC
            GOTO      BW23N999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES   * base WIES23
.
            MOVE      PTWITODW,WIS23WGT             * for display
            MOVE      "One Day Wgt  ",WIS23DSC
            GOTO      BW23N999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            MOVE      PTWITIMW,TOTBWIES   * base WIES23
.
            MOVE      PTWITIMW,WIS23WGT             * for display
            MOVE      "Inlier Wgt   ",WIS23DSC
            GOTO      BW23N999
          ENDIF
BW23N999  RETURN
+
.******************************************************************************
.*                                  BW23H000              Called by: B23SW000 *
.*                    Calculate Base WIES23 for High Outlier                  *
.******************************************************************************
BW23H000  ASSIGN    ((WIS23LOS-PTWIHIBP)-ADJMVDAY),HIGHDAYS  * high outlr days
          COMPARE   ZERO,HIGHDAYS
          IF        @LESS
            MOVE      ZERO,HIGHDAYS         * highdays must be >= zero
          ENDIF
.
          COMPARE   HIGHDAYS,HIHLOS
          IF        @LESS
            MOVE      HIHLOS,HITHDAYS       * get lesser of highdays and
          ELSE                              *  HIHLOS
            MOVE      HIGHDAYS,HITHDAYS
          ENDIF
.
          ASSIGN    (HIGHDAYS-HITHDAYS)*PTWITHOM,TOTBWIES    *high WIES
          ASSIGN    (HITHDAYS*PTWITHIH)+TOTBWIES,TOTBWIES    *HITH WIES
          ASSIGN    (PTWITIMW+TOTBWIES),TOTBWIES             *base WIES23
          ASSIGN    (TOTBWIES/PTWITIMW),TOTIES23             * IES23
.
          MOVE      PTWITHOM,WIS23WGT                        * for display
          MOVE      "High Outl Wgt",WIS23DSC
BW23H999  RETURN
+
.******************************************************************************
.*                                  C23AB000              Called by: PATWIS23 *
.*                          Check for Aboriginality                           *
.******************************************************************************
C23AB000  MOVE      ZERO,ATSIWIES                * set ATSI WIES to zero
          IF        PNSWRACE<1 | PNSWRACE>14
            GOTO      C23AB999              * Invalid parameter
          ENDIF
.
          LOAD      TCODE,PNSWRACE,CATP1,CATP2,CATP3,CATP4,CATP5:
                                   CATP6,CATA1,CATA2,CATA3,CATA4:
                                   CATA5,CATA6,CATA7,CATVA
          LOAD      ACODE,PNSWRACE,PUSR1,PUSR2,PUSR3,PUSR4,PUSR5:
                                   PUSR6,AUSR1,AUSR2,AUSR3,AUSR4:
                                   AUSR5,AUSR6,AUSR7,PMPXABRG
.
          MATCH     ACODE,SP3
          GOTO      C23AB999 IF EQUAL
.
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1                 * Read a code file record
          BRANCH    OVRCD,C23AB999
.
          UNPACK    THCSCOD,DIM1,KEY1       * use 2nd char of HDP Equiv
.>>>>     MOVE      THCSCOD,KEY1
          TYPE      KEY1
          GOTO      C23AB999 IF NOT EQUAL   * Non numeric, error
.
          MOVE      KEY1,FORM1
.
. ---- Calculate ATSI Loading if aboriginality = 1, 2, or 3 ----
.
          IF        FORM1=1 | FORM1=2 | FORM1=3
            MOVE      TOTBWIES,FORM12P4       * base WIES
            ADD       MVCOPAY,FORM12P4        * mechv copayment
            ADD       THCOPAY,FORM12P4        * thal  copayment
            ADD       AAACOPAY,FORM12P4       * AAA   copayment
            ADD       ASDCOPAY,FORM12P4       * ASD   copayment
            ADD       CPDCOPAY,FORM12P4       * CPD   copayment
            ASSIGN    (0.3*FORM12P4),ATSIWIES
          ENDIF
.
C23AB999  RETURN
+
.******************************************************************************
.         WIES 22
.******************************************************************************
PATWIS22  CALL      IN22W000                * Initialise variables
          BRANCH    EXIT,WIS22950
.
          CALL      C22TY000                * Determine and Check Care Type
          BRANCH    EXIT,WIS22950
.
          CALL      C22TR000                * Check for Contracted Patient
          BRANCH    EXIT,WIS22950
.
          CALL      C22PI000                * Check Specified Program Identifier
          BRANCH    EXIT,WIS22950
.
          CALL      M22RG000                * Modify DRG if necessary
.
          CALL      C22RG000                * Check for problem DRG
          BRANCH    EXIT,WIS22950
.
          CALL      M22CH000                * Check for Mechanical Ventilation
.
          CALL      T22AL000                * Check for Thalessaemia
.
          CALL      A22AA000                * Check for AAA
.
          CALL      A22SD000                * Check for ASD
.
          CALL      C22PD000                * Check for Cochlear Prosthetic
.
          CALL      B22SW000                * Calculate Base WIES22
.
          CALL      C22AB000                * Check for aboriginality
.
. ---- Calculate WIES22 value ----
.
          MOVE      TOTBWIES,TOTWIS22       * base WIES
          ADD       MVCOPAY,TOTWIS22        * mechv copayment
          ADD       THCOPAY,TOTWIS22        * thal  copayment
          ADD       AAACOPAY,TOTWIS22       * AAA   copayment
          ADD       ASDCOPAY,TOTWIS22       * ASD   copayment
          ADD       CPDCOPAY,TOTWIS22       * CPD   copayment
          ADD       ATSIWIES,TOTWIS22       * ATSI  copayment
.
          MOVE      ZERO,EXIT
          GOTO      WIS22999
.
WIS22950  MOVE      ONE,EXIT
WIS22999  RETURN
+
.******************************************************************************
.*                                  IN22W000              Called by: PATWIS22 *
.*                         Initialise WIES variables                          *
.******************************************************************************
IN22W000  MOVE      ZERO,TOTWIS22
          MOVE      ZERO,WIS22LOS
          MOVE      ZERO,WIS22WGT
          MOVE      SP20,WIS22DSC
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATWIEA1,"patwieaf"
          TRAPCLR   IO
          BRANCH    OVRCD,IN22W950
.
IN22W900  MOVE      ZERO,EXIT
          GOTO      IN22W999
.
IN22W950  MOVE      ONE,EXIT
IN22W999  RETURN
+
.******************************************************************************
.*                                  C22TY000              Called by: PATWIS22 *
.*                 Check for valid Care Type & Incomplete Coding              *
.******************************************************************************
C22TY000  PACK     KEY5,ANSC,ANSC,ACARE     * use admission care type
          CALL     RDCODE1
          BRANCH   OVRCD,C22TY900
.
          MATCH    "6",TCINDC4              * Check Program Funding Source
          GOTO     C22TY900 IF NOT EQUAL
.
          MATCH    "0   ",THCSCOD           * check care types
          GOTO     C22TY900 IF EQUAL
          MATCH    "1   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "2   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "6   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "7   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "8   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "9   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "5   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "3   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "E   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "F   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "J   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "K   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
          MATCH    "U   ",THCSCOD
          GOTO     C22TY900 IF EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C22TY999
.
C22TY900  MOVE     ONE,EXIT                 * Not valid
C22TY999  RETURN
+
.******************************************************************************
.*                                  C22TR000              Called by: PATWIS22 *
.*                        Check for Contracted Patient                        *
.******************************************************************************
C22TR000  PACK     KEY25,AADMNO,SP70
          CALL     RSPTASF1
C22TR100  CALL     RKPTASF1                 * Read adm. special funding file
          BRANCH   OVRCD,C22TR800           * still process
.
          MATCH    AADMNO,PTAFADMN
          GOTO     C22TR800 IF NOT EQUAL    * still process
.
          MATCH    ANSA,PTAFTYPE            * special fund. arrang. type = adm
          GOTO     C22TR100 IF NOT EQUAL
.
          MATCH    ANSB,PTAFCROL            * Ignore if contract role = 'B'
          GOTO     C22TR900 IF EQUAL
.
C22TR800  MOVE     ZERO,EXIT                * valid
          GOTO     C22TR999
.
C22TR900  MOVE     ONE,EXIT                 * invalid
C22TR999  RETURN
+
.******************************************************************************
.*                                  C22PI000              Called by: PATWIS22 *
.*                        Check Specified Program Identifier                  *
.******************************************************************************
C22PI000  PACK     KEY5,ANSP,ANSK,PMVXPGID  * Program Identifier (Cat PK)
          CALL     RDCODE1
          BRANCH   OVRCD,C22PI800
.
          MATCH    "06",THCSCOD             * competitive elective surgery
          GOTO     C22PI900 IF EQUAL
.
C22PI800  MOVE     ZERO,EXIT                * valid
          GOTO     C22PI999
.
C22PI900  MOVE     ONE,EXIT                 * invalid
C22PI999  RETURN
+
.******************************************************************************
.*                                  M22RG000              Called by: PATWIS22 *
.*                      Modify DRG if necessary for WIES22                    *
.******************************************************************************
M22RG000  CALL      R22IO000           * Radiotherapy
M22RG999  RETURN
+
.******************************************************************************
.*                                  R22IO000              Called by: M22RG000 *
.*                         Modify DRG if Radiotherapy                         *
.******************************************************************************
.>>>>     Don't modify these DRGs:
.
R22IO000  MATCH     "B61",WIS22DRG
          GOTO      R22IO999 IF EQUAL
.
          MATCH     "A40",WIS22DRG
          GOTO      R22IO999 IF EQUAL
.
          MATCH     "B60",WIS22DRG
          GOTO      R22IO999 IF EQUAL
.
          MATCH     "B82",WIS22DRG
          GOTO      R22IO999 IF EQUAL
.
          MATCH     "S65",WIS22DRG
          GOTO      R22IO999 IF EQUAL
.
          MATCH     "W60",WIS22DRG
          GOTO      R22IO999 IF EQUAL
.
          MATCH     "W61",WIS22DRG
          GOTO      R22IO999 IF EQUAL
.
.>>>>     Check for sameday radiotherapy session:
.
          MATCH     ADATE,DDATE
          GOTO      R22IO040 IF NOT EQUAL
.
          MATCH     "R62B",WIS22DRG
          GOTO      R22IO999 IF NOT EQUAL
.
          PACK      ICDRDDTE,DDATE,SP10
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R22IO030  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R22IO040
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R22IO040 IF NOT EQUAL
.
          MATCH     "Z51.0",PTEDCODE        * radiotherapy?
          GOTO      R22IO030 IF NOT EQUAL
.
          GOTO      R22IO900                * modify drg for WIES22
.
.>>>>     Check if operation code exists (non-sameday):
.
R22IO040  MATCH     ADATE,DDATE
          GOTO      R22IO999 IF EQUAL       * don't modify sameday
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
R22IO050  CALL      RKPTECO2                  episode operation file record
          BRANCH    OVRCD,R22IO999
.
          MATCH     AADMNO,PTEOADMN         * same admission?
          GOTO      R22IO999 IF NOT EQUAL
.
.>>>>     Check if block number is in range 1786-1792, 1794 or 1795:
.
          PACK      KEY9,PTEOCODE,SP9
          CALL      RDPTICO1
          BRANCH    OVRCD,R22IO050
.
          MATCH     "1786",PT0OBLKN         * block code >= 1786?
          GOTO      R22IO050 IF LESS
.
          MATCH     "1796",PT0OBLKN         * block code <=1795?
          GOTO      R22IO050 IF NOT LESS
.
          MATCH     "1793",PT0OBLKN         * block code = 1793?
          GOTO      R22IO050 IF EQUAL
.
.>>>>     Check if disease code exists in range C00-D48:
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECD2                * Position on & read a patient
R22IO100  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,R22IO999
.
          MATCH     AADMNO,PTEDADMN         * same admission?
          GOTO      R22IO999 IF NOT EQUAL
.
          MATCH     "C00",PTEDCODE          * neoplasm code >= C00?
          GOTO      R22IO100 IF LESS
.
          MATCH     "D49",PTEDCODE          * neoplasm code <= D48.9?
          GOTO      R22IO100 IF NOT LESS
.
R22IO900  MOVE      "R64Z",WIS22DRG         * modified for WIES22
R22IO999  RETURN
+
.******************************************************************************
.*                                  C22RG000              Called by: PATWIS22 *
.*                            Check for Problem DRG                           *
.******************************************************************************
C22RG000  PACK     KEY7,WIS22DRG,WIESVERN
          CALL     RDPTWIE1
          BRANCH   OVRCD,C22RG900
.
          MATCH    "960Z",PTWIDRGC
          GOTO     C22RG900 IF EQUAL
.
          MATCH    "961Z",PTWIDRGC
          GOTO     C22RG900 IF EQUAL
.
          MATCH    "962Z",PTWIDRGC
          GOTO     C22RG900 IF EQUAL
.
          MATCH    "963Z",PTWIDRGC
          GOTO     C22RG900 IF EQUAL
.
          MOVE     ZERO,EXIT
          GOTO     C22RG999
.
C22RG900  MOVE     ONE,EXIT
C22RG999  RETURN
+
.******************************************************************************
.*                                  M22CH000              Called by: PATWIS22 *
.*                Calculate Mechanical Ventialtion Co-payment                 *
.******************************************************************************
M22CH000  MOVE      ZERO,ADJMVDAY
          MOVE      ZERO,MVCOPAY
.
          PACK      KEY8,AADMNO
          CALL      RDPTICU1                * get mech. vent. hours
          BRANCH    OVRCD,M22CH999
.
          MATCH     "D",PTWIMVEL            * check mech. vent. eligibility
          IF        @EQUAL
            IF        PTICUMEC > 6
              ASSIGN    ((PTICUMEC+12)/24),FORM12P4    * days receiving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
            GOTO      M22CH999
          ENDIF
.
          MATCH     "4",PTWIMVEL
          IF        @EQUAL
            IF        PTICUMEC > 96
              ASSIGN    (((PTICUMEC+12)/24)-4),FORM12P4   * days recving copay.
              MOVE      FORM12P4,ADJMVDAY
              ASSIGN    ((ADJMVDAY*0.7659)+0.6980),MVCOPAY  * mech. vent. copay.
            ENDIF
          ENDIF
.
M22CH999  RETURN
+
.******************************************************************************
.*                                  T22AL000              Called by: PATWIS22 *
.*                      Calculate Thalessaemia Co-payment                     *
.******************************************************************************
T22AL000  MOVE      ZERO,THCOPAY
          MATCH     "T",PTWICPAY            * check WIES22 weights file
          IF        @EQUAL
            PACK      KEY16,AADMNO,SP20
            CALL      RSPTECD2              * Position on & read a patient
T22AL100    CALL      RKPTECD2                episode disease file record
            BRANCH    OVRCD,T22AL999
.
            MATCH     AADMNO,PTEDADMN
            GOTO      T22AL999 IF NOT EQUAL
.
            MATCH     "D56",PTEDCODE        * check ICD-10 code
            IF        !@EQUAL
              MATCH     "D57.2",PTEDCODE    * check ICD-10 code
              GOTO      T22AL100 IF NOT EQUAL
            ENDIF
            MOVE      "0.2648",THCOPAY      * eligible for thal. copayment
          ENDIF
T22AL999  RETURN
+
.******************************************************************************
.*                                  A22AA000              Called by: PATWIS22 *
.*                          Calculate AAA Co-payment                          *
.******************************************************************************
A22AA000  MOVE      ZERO,AAACOPAY
          MATCH     "AAA",PTWICPAY          * check WIES22 weights file
          GOTO      A22AA999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A22AA100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A22AA999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A22AA999 IF NOT EQUAL
.
          MATCH     "33116-00",PTEOCODE     * check ICD-10 code
          GOTO      A22AA100 IF NOT EQUAL
.
          MOVE      "3.1421",AAACOPAY       * eligible for AAA copayment
A22AA999  RETURN
+
.******************************************************************************
.*                                  A22SD000              Called by: PATWIS22 *
.*                          Calculate ASD Co-payment                          *
.******************************************************************************
A22SD000  MOVE      ZERO,ASDCOPAY
          MATCH     "ASD",PTWICPAY          * check WIES22 weights file
          GOTO      A22SD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
A22SD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,A22SD999
.
          MATCH     AADMNO,PTEOADMN
          GOTO      A22SD999 IF NOT EQUAL
.
          MATCH     "38742-00",PTEOCODE     * check ICD-10 code
          GOTO      A22SD100 IF NOT EQUAL
.
          MOVE      "2.4713",ASDCOPAY       * eligible for ASD copayment
A22SD999  RETURN
+
.******************************************************************************
.*                                  C22PD000              Called by: PATWIS22 *
.*                 Calculate Cochlear Prosthetic Device Co-payment            *
.******************************************************************************
C22PD000  MOVE      ZERO,CPDCOPAY
          MATCH     "B",PTWICPAY            * check WIES22 weights file
          GOTO      C22PD999 IF NOT EQUAL
.
          PACK      KEY16,AADMNO,SP20
          CALL      RSPTECO2                * Position on & read a patient
C22PD100  CALL      RKPTECO2                * episode operation file record
          BRANCH    OVRCD,C22PD900
.
          MATCH     AADMNO,PTEOADMN
          GOTO      C22PD900 IF NOT EQUAL
.
          MATCH     "41617-00",PTEOCODE     * check for implant
          IF        @EQUAL
            ADD       ONE,CPDCOPAY
          ENDIF
          MATCH     "41617-01",PTEOCODE     * check for implant removal
          IF        @EQUAL
            SUB       ONE,CPDCOPAY
          ENDIF
          GOTO      C22PD100
.
C22PD900  IF        CPDCOPAY >= 2
            MOVE      "5.0544",CPDCOPAY     * eligible for CPD copayment
          ELSE
            MOVE      ZERO,CPDCOPAY         * not eligible for CPD copayment
          ENDIF
C22PD999  RETURN
+
.******************************************************************************
.*                                  B22SW000              Called by: PATWIS22 *
.*                            Calculate Base WIES22                           *
.******************************************************************************
B22SW000  CALL      D22SC000                * length of stay category
          CALL      C22ST000                * calculate inlier status
.
          MATCH     "L",W22NLIER            * low outlier
          CALL      BW22L000 IF EQUAL       * calculate base WIES22
.
          MATCH     "I",W22NLIER            * inlier
          CALL      BW22N000 IF EQUAL       * calculate base WIES22
.
          MATCH     "H",W22NLIER            * high outlier
          CALL      BW22H000 IF EQUAL       * calculate base WIES22
.
B22SW999  RETURN
+
.******************************************************************************
.*                                  D22SC000              Called by: B22SW000 *
.*                      Determine Length Of Stay Category                     *
.******************************************************************************
D22SC000  MOVE      NBRDAYS,WIS22LOS        * length of stay from NHOSPDAY
          MOVE      "M",LOSCAT              * set LOS category to multiday
          MATCH     ADATE,DDATE             * check for sameday
          IF        @EQUAL
            MOVE      ONE,SAMEDAY           * sameday
            MOVE      ONE,WIS22LOS          * LOS = 1
            MOVE      "S",LOSCAT            * set LOS category to sameday
            GOTO      D22SC999
          ELSE
            MOVE      ZERO,SAMEDAY          * not sameday
          ENDIF
.
          IF        SAMEDAY = 0 & WIS22LOS = 1
            MOVE      "O",LOSCAT            * set LOS category to oneday
            GOTO      D22SC999
          ENDIF
.
          IF        WIS22LOS > 1825
            MOVE      "1825",WIS22LOS       * maximum LOS is 5 years
          ENDIF
.
D22SC999  RETURN
+
.******************************************************************************
.*                                  C22ST000              Called by: B22SW000 *
.*                           Calculate Inlier Status                          *
.******************************************************************************
C22ST000  MOVE      "I",W22NLIER            * set status to inlier
          IF        WIS22LOS < PTWILIBP
            MOVE      "L",W22NLIER          * set status to low outlier
            GOTO      C22ST999
          ENDIF
.
          ASSIGN    (PTWIHIBP+ADJMVDAY),FORM12P4   * high bound. + mech.v days
          IF        WIS22LOS > FORM12P4
            MOVE      "H",W22NLIER          * set status to high outlier
          ENDIF
C22ST999  RETURN
+
.******************************************************************************
.*                                  BW22L000              Called by: B22SW000 *
.*                     Calculate Base WIES22 for Low Outlier                  *
.******************************************************************************
BW22L000  MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES             * base WIES22
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES22  * IES22
.
            MOVE      PTWITDSW,WIS22WGT             * for display
            MOVE      "Same Day Wgt ",WIS22DSC
            GOTO      BW22L999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES             * base WIES22
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES22  * IES22
.
            MOVE      PTWITODW,WIS22WGT             * for display
            MOVE      "One Day Wgt  ",WIS22DSC
            GOTO      BW22L999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            ASSIGN    (PTWITODW+((WIS22LOS-1)*PTWITLOM)),TOTBWIES
.                                                    * base WIES22
            ASSIGN    (TOTBWIES/PTWITIMW),TOTIES22   * IES22
.
            MOVE      PTWITLOM,WIS22WGT             * for display
            MOVE      "Low Outlr Wgt",WIS22DSC
            GOTO      BW22L999
          ENDIF
BW22L999  RETURN
+
.******************************************************************************
.*                                  BW22N000              Called by: B22SW000 *
.*                      Calculate Base WIES22 for Inlier                      *
.******************************************************************************
BW22N000  MOVE      ONE,TOTIES22          * IES22 = 1
          MATCH     "S",LOSCAT            * sameday
          IF        @EQUAL
            MOVE      PTWITDSW,TOTBWIES   * base WIES22
.
            MOVE      PTWITDSW,WIS22WGT             * for display
            MOVE      "Same Day Wgt ",WIS22DSC
            GOTO      BW22N999
          ENDIF
.
          MATCH     "O",LOSCAT            * oneday
          IF        @EQUAL
            MOVE      PTWITODW,TOTBWIES   * base WIES22
.
            MOVE      PTWITODW,WIS22WGT             * for display
            MOVE      "One Day Wgt  ",WIS22DSC
            GOTO      BW22N999
          ENDIF
.
          MATCH     "M",LOSCAT            * multiday
          IF        @EQUAL
            MOVE      PTWITIMW,TOTBWIES   * base WIES22
.
            MOVE      PTWITIMW,WIS22WGT             * for display
            MOVE      "Inlier Wgt   ",WIS22DSC
            GOTO      BW22N999
          ENDIF
BW22N999  RETURN
+
.******************************************************************************
.*                                  BW22H000              Called by: B22SW000 *
.*                    Calculate Base WIES22 for High Outlier                  *
.******************************************************************************
BW22H000  ASSIGN    ((WIS22LOS-PTWIHIBP)-ADJMVDAY),HIGHDAYS  * high outlr days
          COMPARE   ZERO,HIGHDAYS
          IF        @LESS
            MOVE      ZERO,HIGHDAYS         * highdays must be >= zero
          ENDIF
.
          COMPARE   HIGHDAYS,HIHLOS
          IF        @LESS
            MOVE      HIHLOS,HITHDAYS       * get lesser of highdays and
          ELSE                              *  HIHLOS
            MOVE      HIGHDAYS,HITHDAYS
          ENDIF
.
          ASSIGN    (HIGHDAYS-HITHDAYS)*PTWITHOM,TOTBWIES    *high WIES
          ASSIGN    (HITHDAYS*PTWITHIH)+TOTBWIES,TOTBWIES    *HITH WIES
          ASSIGN    (PTWITIMW+TOTBWIES),TOTBWIES             *base WIES22
          ASSIGN    (TOTBWIES/PTWITIMW),TOTIES22             * IES22
.
          MOVE      PTWITHOM,WIS22WGT                        * for display
          MOVE      "High Outl Wgt",WIS22DSC
BW22H999  RETURN
+
.******************************************************************************
.*                                  C22AB000              Called by: PATWIS22 *
.*                          Check for Aboriginality                           *
.******************************************************************************
C22AB000  MOVE      ZERO,ATSIWIES                * set ATSI WIES to zero
          IF        PNSWRACE<1 | PNSWRACE>14
            GOTO      C22AB999              * Invalid parameter
          ENDIF
.
          LOAD      TCODE,PNSWRACE,CATP1,CATP2,CATP3,CATP4,CATP5:
                                   CATP6,CATA1,CATA2,CATA3,CATA4:
                                   CATA5,CATA6,CATA7,CATVA
          LOAD      ACODE,PNSWRACE,PUSR1,PUSR2,PUSR3,PUSR4,PUSR5:
                                   PUSR6,AUSR1,AUSR2,AUSR3,AUSR4:
                                   AUSR5,AUSR6,AUSR7,PMPXABRG
.
          MATCH     ACODE,SP3
          GOTO      C22AB999 IF EQUAL
.
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1                 * Read a code file record
          BRANCH    OVRCD,C22AB999
.
          UNPACK    THCSCOD,DIM1,KEY1       * use 2nd char of HDP Equiv
.>>>>     MOVE      THCSCOD,KEY1
          TYPE      KEY1
          GOTO      C22AB999 IF NOT EQUAL   * Non numeric, error
.
          MOVE      KEY1,FORM1
.
. ---- Calculate ATSI Loading if aboriginality = 1, 2, or 3 ----
.
          IF        FORM1=1 | FORM1=2 | FORM1=3
            MOVE      TOTBWIES,FORM12P4       * base WIES
            ADD       MVCOPAY,FORM12P4        * mechv copayment
            ADD       THCOPAY,FORM12P4        * thal  copayment
            ADD       AAACOPAY,FORM12P4       * AAA   copayment
            ADD       ASDCOPAY,FORM12P4       * ASD   copayment
            ADD       CPDCOPAY,FORM12P4       * CPD   copayment
            ASSIGN    (0.3*FORM12P4),ATSIWIES
          ENDIF
.
C22AB999  RETURN
+

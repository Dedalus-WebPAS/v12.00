.-------------------------------------------------------------------------------
. Program       : OPRWEB04 
.
. Function      : Theatre Maintenance
.
. Modifications : 
.-------------------------------------------------------------------------------
. V11.04.08 26/04/2023  Nikitha B      TSK 0945196
.           Added SESSCH15 & SESSCH91 and updated SESSCH00 & SESSCH10to check if.           a schedule or ad-hoc session exists under a different hospital.
. V11.04.07 23/04/2024  Thanh T            TSK 0923560
.           Fixed issue with equipment description not showing.
.           Changed PRBF0510 and TBPRB120.
. V11.04.06 01/03/2024  Thanh T            TSK 0923560
.           Added Hospital ID
. V11.04.05 01/03/2024  Thanh T            TSK 0923560
.           Added Hospital ID
. V11.04.04 28/02/2024  Thanh T            TSK 0923560
.           Added Hospital ID
. V11.04.03 25/01/2024  Thanh T            TSK 0923560
.           Added Hospital ID  
. V11.04.02 24/11/2023  Nikitha B          TSK 0940194
.           Added tags OPRP2400 and OPRP2500  to display red color for 
.           Date Statistics and Unavail. Dates buttons.
. V11.04.01 22/11/2023  Nikitha B          TSK 0940181
.           Added tag OPRR0900 to display red color for Tray Contents button.
. V11.03.06 14/11/2023  Nikitha B          TSK 0939865
.           Added tag PRAF0800 to display red color for details button.
. V11.03.05 03/11/2023  Nikitha B          TSK 0939875
.           Added if block to check empty for OPEQTYPE and TDESC at EQROW000. 
. V11.03.04 07/03/2023  Ebon Clements      TSK 0909393
.           Added hospital to oprsesaf(1-6) and oprdetfa(1&5) indexes
. V11.03.03 23/01/2023  Thanh T.           TSK 0919770
.           Changed OPRTRA00, OPRTRB00, OPREQP00, GPREQP00, STRAY000, GPRTRA00,
.           OPRPRA00, OPRPRB00, OPRTPS00, GPRTPS00, GNXTPS00, OPRPRC00 to  
.           cater for adding Hospital field changes
. V11.03.02 10/01/2023  Bella Turco   TSK 0921957
.           Continued adding PTCNNRTD & NOMORE00 to maintenance lists
. V11.03.01 05/12/2022  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.03 15.09.2022  DA Sarkies     TSK 0922762
.           Fixed some formatting for consistency
. V11.02.02 14.09.2022  DA Sarkies     TSK 0909756
.           Increased size of ITEMDESC to 90. Changed KEY40 to KEY90 to hold NZ
.           Description
. V11.02.01 01.09.2022  DA Sarkies     TSK 0922762
.           Added check to see if there are active sessions, and prevent delete
.           if one exists
. V11.01.02 01.09.2022  DA Sarkies     TSK 0922762
.           Added check to see if there are active sessions, and prevent delete
.           if one exists
. V11.01.01 02/03/2021  Ebon Clements  TSK 0886820
.           Added report 17 - Theatre week cycle number maintenance
. V11.00.05 08/10/2020  Peter Vela     TSK 0895209
.           Added delete of OPRPCMFD to OPRPRA38
. V11.00.04 05/10/2020  Peter Vela     TSK 0895209
.           Added delete of OPRDPFFD to OPRPRA30 
. V11.00.03 24/09/2020  Peter Vela     TSK 0893202
.           Added temp file sorting in LSPRB000 
.           Added temp file sorting in TBPRB000
.           Added functionality to update Class in OPRPRB20
. V11.00.02 21/05/2020  Peter Vela     TSK 0871644
.           Fixed lengths of OLDDH001, OLDDH002
. V11.00.01 11/03/2020  J.Tan          TSK 0838262
.           Added Effective from and to date to MBS Item file
. V10.15.01 29/11/2019  Peter Vela     Task 0871644
.           Added Theatre Doctor's Preference Comments
. V10.14.02 19/07/2019  Ebon Clements  Task 0878493
.           Changed global session update list OCLRW000 Schedule07() to test
.           using clinic or surgeon - OPCNCLSU
. V10.14.01 27/03/2019  Jill Parkinson Task 0863524
.           Mods to use key21 for oprsemaf reads                          
. V10.13.02 08.01.2019  K.Bell         TSK 0867210 
.           Sort by Available Time Statistic by descending Available Date
.           Sort by Unavailable Time by descending Available Date
. V10.13.01 11.12.2018  B.G.Ackland    TSK 0835482 
.           FHIR Location Resource Output
.-------------------------------------------------------------------------------
. V10.04.02 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.01 15/01/2014 Ania P         CAR 267230
.           Added OPEQACTV check to TBEQP000
.-------------------------------------------------------------------------------
. V10.03.04 03/10/2013 Patrick Adair  CAR 284134
.           Add Active flag to Theatre Session Maintenance
. V10.03.03 04/10/2012 Sandra Barcham CAR 274077
.           Remove Operating Theatre from WEBTITLE for Nurse Maintenance
. V10.03.02 13/07/2012  Don Nguyen    CAR 264668
.           Made Doctor Code optional for Operation Average Add/Edit (CHKOPA00)
. V10.03.01 30/05/2012  Don Nguyen    CAR 264668
.           Added routines for Operation Average Maintenance
. V10.01.01 15/12/2010  Mike Laming   CAR 233046
.           Mods for PATMCHFD using H/F Table Type (replacing H/F Table)
. V10.00.01 30/04/2010  J.Tan         CAR 220887
.           Mods checking for Active/Inactive of Misc.charge
. V9.12.01  07/12/2009  Peter McMullen CAR 210130
.           replace calls to DOCNAM00 with DOCNM000 (parm driven version) 
. V9.10.01  29/08/2008  Ebon Clements CAR 173816
.           Added surname and qualifications to nurse table view
. V9.09.03  11/10/2007  Peter Vela    CAR 138153
.           Added Global Update functionality
. V9.09.02  20/07/2007  Ebon Clements CAR 145544
.           Changed HOSSEL00 to only call selection list if using .2 tag
. V9.09.01  14/07/2007  Ebon Clements CAR 142317
.           Added my hospital operating room list to ORCLI000          
. V9.08.01  26/09/2006  Ebon Clements CAR 119988
.           Added multi hospital functionality to theatre maintenance 
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.07 13/09/2005 Ebon Clements CAR 51515
.          Added active/inactive status to expensive items
.          Added active/inactive test to expensive item search - SREXP000 
. V9.04.06 16/05/2005 Jill Habasque CAR 61176
.          Removed check for doctor code when adding a session
. V9.04.05 16/03/2004 Lina Vo  CAR 56404     
.          Changed Item Maintenance - default 1st Current Location/Tray
.          and reset Date Status Changed.                                
. V9.04.04 15/03/2004 Lina Vo  CAR 56404     
.          Added Report 14 - Equipment Maintenance
. V9.04.03 17/02/2004 Lina Vo  CAR 56404     
.          Changed the Maintenance program of following files; opriteaf, 
.          oprdprbf, oprtryaf & oprtrybf. New file layout.
.          Added Report 13 - Specialty Tray Preference
.          Changed OPRDPAFD to OPRDPHFD.
.          Added Tag to show Tray content in a dframe (ORTRB000)
. V9.04.02 07/10/2004 Lina Vo  CAR 53798     
.          Multi hospital mods for default claim code
. V9.04.01 05/08/2004 Peter Vela   CAR 52107
.          Fixed search for ' in Nurse Search
.          Added JAVNUR00
.-------------------------------------------------------------------------------
.                 V9.03.02 29/09/2003 Sylvek Litewka  CAR 43302
.                          Modified procedure SPTNKA00 to exclude Inactive 
.                          nurses from the nurse search list.
.                 V9.03.01 01/09/2003 Lina Vo  CAR 40497
.                          Changed index and read for patmchgf.
.                 V9.02.04 17/12/2002 J.Tan
.                          Fixed Expensive items search
.                 V9.02.03 21.11.2002  Peter Vela      SRF 33349
.                          Added tags to display Misc. Charge code and Misc.
.                          Charge Description
.                 V9.02.02 28.03.2002  Ashwin
.                          Use parameter for Misc.Charge code in Expensive Item
.                 V9.02.01 19/10/2001  J.Tan
.                          Mods to use default claim code for misc.charge
.                 V9.01.01 ??????????  ?????????????
.                          Modified the output of number of records
.                 V9.00.01 31/07/2001  Jill Habasque
.                          Fixed Miscellaneous charge code selection list
.                 V9.00.B02 11/07/2001  Jill Habasque
.                          Created Nurse keyword search
.                 V5.10.01 04.05.2001 B.G.Ackland
.                          Fix I * D Error
.                 V5.08.02 07/12/2000 J.Tan
.                          Mods to read RUS interface parameter
.                 V5.07.06 16.03.2000 Bronko Sosic
.                          Added a choise of two variables when OPRWEB05
.                          is called.
.                 V5.07.05 29.02.2000 Pat Dirito 
.                          Update javascript ShowDetail with Report instance
.                 V5.07.04 20.01.2000 B.G.Ackland
.                          New Standards
.                 V5.07.03 25.11.1999 Pat Dirito
.                          Added time verification for option 9 
.                          20.12.1999 Katie Nelson 
.                          Recompiled for IBAWEBCD/IBAWEBDF          
.                 V5.07.02 23.11.1999 Pat Dirito
.                          Changed Delete formaction in OPRCLI00
.                 V5.07.00 06.10.1999 Pat Dirito
.                          Created Program                                      
.                    
.-------------------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
.
          INC       MLTSECFD/INC   * Hospital access
          INC       MLTHCPFD/INC
          INC       NZPMCHFD/INC
          INC       OPRAVEFD/INC   * Operation Average
          INC       OPRDPHFD/INC   * doctors preference header
          INC       OPRDPFFD/INC   * doctors preference detail
          INC       OPROPRFD/INC   * Operating Room File
          INC       OPRORAFD/INC   * Operating Room - Available File
          INC       OPRCONFD/INC   * Operating Room - Control File
          INC       OPREXPFD/INC   * Operating Room - Expensive Item File
          INC       OPREQPFD/INC   * Operating Room - Equipment File
          INC       OPREQPTD/INC   
          INC       OPRNKIFD/INC   * Operating Room - Nurses Keyword
          INC       OPRNURFD/INC   * Operating Room - Nurses File
          INC       OPRITEFD/INC   * Operating Room - Item File
          INC       OPRITETD/INC                                     
          INC       OPRPCMFD/INC   * Doctors Preference Comments
          INC       OPRPCMTD/INC
          INC       OPRTRAFD/INC   * Operating Room - Tray File
          INC       OPRTRBFD/INC   * Operating Room - Tray Detail File
          INC       OPRTPSFD/INC   * Operating Room - Specialty Tray Preference
          INC       OPRCLIFD/INC   * Operating Room - Clinic File
          INC       OPRSEMFD/INC   * Operating Room - Session Master(Schedule) 
          INC       OPRSESFD/INC   * Operating Room - Session 
          INC       OPRUAVFD/INC   * Operating Room - Unavailable Theatre file
          INC       OPRWCNFD/INC   * Theatre week cycle number
          INC       OPRWCNTD/INC  
          INC       PATCONFD/INC   * Control File 
          INC       PATDO1FD/INC   * Doctor File
          INC       PATHSPFD/INC   * Hospital File
          INC       PATITMFD/INC   * Patient Item Details
          INC       PATMCHFD/INC   * Miscellaneous Charges File 
          INC       TFILEVAR/INC
          INC       OPR001FD/INC
.---------------------------------------------------------------------------
.  CGI Variables
.
ACTIDESC  DIM       8   * Active or Inactive Description
FNAMEB    DIM       8
ITEMDESC  DIM       90
MISCCODE  DIM       9
MISCHOSP  DIM       3
MISCDESC  DIM       90
DESCTYPE  DIM       20
DIM100    DIM       100
DISPDATE  DIM       11
DISPDAT1  DIM       11
PREFCODE  DIM       9
MYHOSPIT  FORM      1
NEXTPAGE  DIM       1       * Nextpage parameter CGI parameter
UPDTTYPE  DIM       1       * Update Type
STARTKEY  DIM       18      * Starting Key
.
DEFTHOSP  DIM       3 
.
OLDDD001  DIM       3
.
OPRDD001  DIM       3       * Class
OPRDD002  DIM       1       * Type
OPRDD003  DIM       15      * Item
OPRDD004  FORM      3       * Quantity
.
OPRDH001  DIM       9       * Preference Code
OPRDH002  DIM       50      * Description
.
OLDDH001  DIM       6       * Old Doctor Code
OLDDH002  DIM       9       * Old Preference Code
.
OPROP001  DIM       6       * Operating Room Code
OPROP002  DIM       40      * Description
OPROP003  DIM       20      * Location           
OPROP004  DIM       3       * User Defined 1 (Category Y1)
OPROP005  DIM       3       *              2 (Category Y2)
OPROP006  DIM       3       *              3 (Category Y3)
OPROP007  DIM       3       *              4 (Category Y4)
OPROP008  DIM       3       *              5 (Category Y5)
OPROP009  FORM      1       * Status 1=Inactive 0=Active            
OPROP010  FORM      4       * Time Available Sunday (mins) 
OPROP011  FORM      4       * Time Available Monday (mins) 
OPROP012  FORM      4       * Time Available Tuesday (mins)  
OPROP013  FORM      4       * Time Available Wednesday (mins)  
OPROP014  FORM      4       * Time Available Thursday (mins)  
OPROP015  FORM      4       * Time Available Friday (mins)  
OPROP016  FORM      4       * Time Available Saturday (mins)  
OPROP017  DIM       14      * G/L Code and Cost Centre
OPROP018  DIM       3       * Hospital                  
.
OPROR001  DIM       8       * Date                
OPROR002  DIM       6       * Operating Room        
OPROR003  FORM      4       * Time Operating room available (mins)
.
OPRNR001  DIM       6       * Nurse Code
OPRNR002  DIM       30      * Surname
OPRNR003  DIM       30      * Given Name
OPRNR004  DIM       3       * User Defined 1 (Category Q1)
OPRNR005  DIM       3       *              2 (Category Q2)
OPRNR006  DIM       3       *              3 (Category Q3)      
OPRNR007  DIM       3       *              4 (Category Q4)      
OPRNR008  DIM       3       *              5 (Category Q5)      
OPRNR009  FORM      4       * Status 0=Active 1=Non Active   
.
OPRTR001  DIM       15      * Tray Code
OPRTR002  DIM       30      * Description
.
OPRTB001  DIM       15      * Tray Code
OPRTB002  DIM       15      * Item Code
OPRTB003  FORM      3       * Quantity 
.
OPRCL001  DIM       6       * Clinic Code
OPRCL002  DIM       30      * Description
OPRCL003  DIM       6       * Doctor Code
OPRCL004  DIM       3       * Group Code (Category YG)
OPRCL005  DIM       1       * Active/Inactive Flag
.
OPREX001  DIM       6       * Expensive Item Code
OPREX002  DIM       30      * Description
OPREX003  DIM       3       * RUS Equivalent Code
OPREX004  DIM       9       * Miscellaneous Charge Code 
OPREX005  DIM       1       * Active/Inactive             
.
OPRUA001  DIM       6       * Theatre Code
OPRUA002  DIM       8       * Date Unavailable
OPRUA003  DIM       5       * Time Unavailable from start
OPRUA004  DIM       5       * Time Unavailable to end
.
OPTPS001  DIM       3       * Specialty
OPTPS002  DIM       15      * Preference
.
.  Operation Average
.
OPAVE001  DIM       6       * Doctor Code
OPAVE002  DIM       9       * Operation Code (MBS or ICD9-CM)
OPAVE003  FORM      4       * Average Time (minutes)
OPRNCODE  DIM       9
.
.
. Variable Declarations  
.
AVAITIME  DIM       4       * Available Time 
ACTVFILT  DIM       1       * Active/Inactive Filter
CURRDATE  DIM       8
.
ENDTIME   FORM      4       * End Time
ENDNAME   DIM       70                                                 *I-52107
.
.DOCTCODE  DIM       6       * Doctor Code
DOCTOR    DIM       30      * Doctor formatted name
DISPLAY8  DIM       8       * Display Field
DIM3      DIM       3
DIM9      DIM       9
.
GLOBINDC  DIM       1
.
HOSPCODE  DIM       3
HOSPNAME  DIM       50
CURRHOSP  DIM       3
UPDTHOSP  DIM       3
.
JAVFNAME  DIM       70                                                 *I-52107
JAVGNAME  DIM       35                                                 *I-52107
JAVSNAME  DIM       35                                                 *I-52107
.
KEY21A    DIM       21
KEY26A    DIM       26
.
LNK2PRT   FORM      1
MIN       DIM       2       * Minutes Variable
.
MULHOSAR  DIM       3[100]
MULHOSCT  FORM      3
.
NURSNAME  DIM       30
NEXTIKEY  DIM       18
.
PREVIKEY  DIM       18
PRVIFLAG  FORM      1
.
SAVKEY6   DIM       6
SAVKEY15  DIM       15
SAVKEY18  DIM       18
SAVKEY21  DIM       21
SAVKEY24  DIM       24
SAVKEY33  DIM       33
SAVKEY37  DIM       37
.
SAVEGNAM  DIM       35                                                 *I-52107
SAVESNAM  DIM       35                                                 *I-52107
SHOWALL   DIM       1       * Show active & Inactive Equipment?
STARTIME  FORM      4       * Start Time
STRTNAME  DIM       70                                                 *I-52107
.
XOPRAVEG  DIM       4       * Average time
XOPRCODE  DIM       9       * Operation Code
XOPRDESC  DIM       40      * Operation Description
XOPRDOCT  DIM       6       * Operation Doctor
.
TMPPRFR1  IFILE SQL, FIXED=44, KEY="U1-6,7-43"
.
. NAME    TYPE   LENGTH  PHYSICAL START LOC.   DESCRIPTION
. ----    ----   ------  -------- ----------   -----------
TEMPASS1  DIM       6        6        1        Cat OG Assoc No.
TEMPKY37  DIM       37       37       7        Save Key 37
.
.End of record                        44
.
.---------------------------------------------------------------------------
PRGID     INIT      "OPRWEB04"
VERSION   INIT      "V12.00.00"
PRGNAM    INIT      "Theatre Maintenance"
.---------------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200,MAIN2300,MAIN2400,MAIN2500:
                             MAIN2600,MAIN2700
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      OPROPR00        * Operating Room (Theatre Maintenance)
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      OPRORA00        * Operating Room Available Times/Statistics 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      OPRNUR00        * Operating Room Nurses Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      OPRITE00        * Operating Room Item File Maintenance 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      OPRTRA00        * Operating Room Tray Maintenance 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      OPRTRB00        * Operating Room Tray Detail Maintenance 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      OPRCLI00        * Operating Room Clinic/Session Maintenance 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      OPREXP00        * Operating Room Expensive Item Maintenance 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1900  CALL      OPRUAV00        * Operating Room Unavailable Theatre Maint- 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2000  CALL      OPRPRA00        * Doctors Preferences
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2100  CALL      OPRPRB00        * Doctors Preferences Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
. 
MAIN2200  CALL      SRHNUR00        * Nurse code Search
          GOTO      MAIN1000
.
MAIN2300  CALL      OPRTPS00        * Tray Preference for Each Specialty Maint.
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2400  CALL      OPREQP00        * Equipment File Maintenance 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2500  CALL      OPRAVE00        * Operation Average Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2600  CALL      OPRPRC00        * Doctors Preferences Comments
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2700  CALL      OPRWCN00        * Theatre Week Cycle Number Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages 
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  CALL      WINAL100
          CALL      WINCLS00 
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);": 
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.-------------------------------------------------------------------------------
. Open Files and Initialize Variables
.-------------------------------------------------------------------------------
INIT0000  OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATITEM1,"patitemn"      * Patient Item Details
          OPEN      OPRDPHA1,"oprdphaf"
          OPEN      OPRDPHA2,"oprdphaf"
          OPEN      OPRDPFA1,"oprdpfaf"
          OPEN      OPROPRA1,"opropraf"
          OPEN      OPRORAA1,"oproraaf"
          OPEN      OPRORAA2,"oproraaf"
          OPEN      OPRAUDRM,"opraudrm"
          OPEN      OPRAUDRA,"opraudra"
          OPEN      OPRNURA1,"oprnuraf"
          OPEN      OPRNKIA1,"oprnkiaf"
          OPEN      OPRNKIA2,"oprnkiaf"
          OPEN      OPREXPA1,"oprexpaf"
          OPEN      OPREXPA2,"oprexpaf"
          OPEN      OPREQPA1,"opreqpaf"
          OPEN      OPRITEA1,"opriteaf"
          OPEN      OPRPCMA1,"oprpcmaf"
          OPEN      OPRTRYA1,"oprtryaf" 
          OPEN      OPRTRYB1,"oprtrybf" 
          OPEN      OPRTPSA1,"oprtpsaf" 
          OPEN      OPRCLIA1,"oprcliaf"
          OPEN      OPRUAVA1,"opruavaf"
          OPEN      OPRSEMA1,"oprsemaf"
          OPEN      OPRSEMA2,"oprsemaf"
          OPEN      OPRSESA2,"oprsesaf"
          OPEN      OPRWCNA1,"oprwcnaf"
          OPEN      OPRWCNA2,"oprwcnaf"
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATDO1A1,"patdo1af"      * Doctor File
          OPEN      PATHSPA1,"pathspaf"     
          OPEN      OPRITEA2,"opriteaf"      * HPS Added
          OPEN      OPRAVEA2,"opraveaf"      * Operation Average
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      NZPMCHA3,"nzpmchaf"
          OPEN      MLTHCPA2,"mlthcpaf"
.
          OPEN      CONTROLF,"controlf"      * Control File
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,FORTY;*60,OPCNAUDR,*62,OPCNAUDT,*111,OPCNCLSU
          READ      CONTROLF,TWENTY;*193,PTCNDCLM
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,HUND13;*66,OPCNPTMC
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          OPEN      MLTCODA1,"mltcodaf"
          OPEN      MLTCODA2,"mltcodaf"
          OPEN      MLTSECA1,"mltsecaf"
.
          CALL      TFILENAM
          MOVE      TFILNAME,FNAMEB
.
INIT9999  RETURN
.-------------------------------------------------------------------------------
. Clear Parameters
.-------------------------------------------------------------------------------
CLRPAR00  MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,DOCTCODE
          MOVE      SP70,HOSPCODE
          MOVE      SP70,CURRHOSP
          MOVE      SP70,UPDTHOSP
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,ADMISSNO
          MOVE      SP70,URNUMBER 
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,STARTKEY
          MOVE      SP70,PREFCODE
          MOVE      SP70,SHOWALL
.
          MOVE      SP70,NEXTIKEY
          MOVE      SP70,PREVIKEY
          MOVE      ZERO,PRVIFLAG
.
          MOVE      SP70,OLDDD001
.
          MOVE      SP70,OPRDD001 
          MOVE      SP70,OPRDD002 
          MOVE      SP70,OPRDD003 
          MOVE      ZERO,OPRDD004 
.
          MOVE      SP70,OPRDH001 
          MOVE      SP70,OPRDH002 
.
          MOVE      SP70,OLDDH001
          MOVE      SP70,OLDDH002
.
          MOVE      SP70,OPROP001 
          MOVE      SP70,OPROP002 
          MOVE      SP70,OPROP003 
          MOVE      SP70,OPROP004 
          MOVE      SP70,OPROP005 
          MOVE      SP70,OPROP006 
          MOVE      SP70,OPROP007 
          MOVE      SP70,OPROP008 
          MOVE      ZERO,OPROP009 
          MOVE      ZERO,OPROP010 
          MOVE      ZERO,OPROP011 
          MOVE      ZERO,OPROP012 
          MOVE      ZERO,OPROP013 
          MOVE      ZERO,OPROP014 
          MOVE      ZERO,OPROP015 
          MOVE      ZERO,OPROP016 
          MOVE      SP70,OPROP017 
          MOVE      SP70,OPROP018 
.
          MOVE      SP70,OPROR001  
          MOVE      SP70,OPROR002  
          MOVE      ZERO,OPROR003  
.
          MOVE      SP70,OPRNR001 
          MOVE      SP70,OPRNR002 
          MOVE      SP70,OPRNR003  
          MOVE      SP70,OPRNR004  
          MOVE      SP70,OPRNR005  
          MOVE      SP70,OPRNR006  
          MOVE      SP70,OPRNR007  
          MOVE      SP70,OPRNR008  
          MOVE      ZERO,OPRNR009  
.
          CALL      CPOPIT00       * Clear opriteaf cgi
.
          MOVE      SP70,OPRTR001
          MOVE      SP70,OPRTR002
.
          MOVE      SP70,OPRTB001
          MOVE      SP70,OPRTB002
          MOVE      ZERO,OPRTB003
.
          MOVE      SP70,OPRCL001  
          MOVE      SP70,OPRCL002  
          MOVE      SP70,OPRCL003  
          MOVE      SP70,OPRCL004  
          MOVE      SP70,OPRCL005  
          MOVE      ZERO,ACTVFILT
.
          MOVE      SP70,OPREX001 
          MOVE      SP70,OPREX002 
          MOVE      SP70,OPREX003 
          MOVE      SP70,OPREX004 
          MOVE      ONE,OPREX005 
.
          MOVE      SP70,OPRUA001 
          MOVE      SP70,OPRUA002 
          MOVE      SP70,OPRUA003  
          MOVE      SP70,OPRUA004  
.
          MOVE      ZERO,OPCNRUSI
.
          MOVE      SP70,OPTPS001 
          MOVE      SP70,OPTPS002 
.
          MOVE      SP70,OPAVE001
          MOVE      SP70,OPAVE002
          MOVE      ZERO,OPAVE003
          MOVE      SP70,OPRNCODE
.
          CALL      CPOPEQ00
          CALL      CLOPPC00
          CALL      CPOPWC00
.
CLRPAR99  RETURN
.-------------------------------------------------------------------------------
. Set Parameters
.-------------------------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "doctcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DOCTCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospcode=",QRYNAME
          IF        @EQUAL
            PACK      HOSPCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "currhosp=",QRYNAME
          IF        @EQUAL
            PACK      CURRHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updthosp=",QRYNAME
          IF        @EQUAL
            PACK      UPDTHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prefcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREFCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.   
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF  
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
. 
          MATCH     "keywords=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYWORDS
            REP       "~'",KEYWORDS                                    *I-52107
            GOTO      SETPAR99
          ENDIF
. 
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextikey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTIKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "previkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVIKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prviflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRVIFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "olddd001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OLDDD001
            PACK      OLDDD001,OLDDD001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "oprdh001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OPRDH001
            PACK      OPRDH001,OPRDH001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "oprdh002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OPRDH002
            PACK      OPRDH002,OPRDH002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "olddh001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OLDDH001
            PACK      OLDDH001,OLDDH001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "olddh002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OLDDH002
            PACK      OLDDH002,OLDDH002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "oprdd001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OPRDD001
            PACK      OPRDD001,OPRDD001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "oprdd002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OPRDD002
            PACK      OPRDD002,OPRDD002,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "oprdd003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OPRDD003
            PACK      OPRDD003,OPRDD003,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "oprdd004=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,OPRDD004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "oprop",QRYNAME
          IF        @EQUAL
            CALL      STOPR000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "opror",QRYNAME
          IF        @EQUAL
            CALL      STORA000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "oprnr",QRYNAME
          IF        @EQUAL
            CALL      STNUR000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "oprit",QRYNAME
          IF        @EQUAL
            CALL      SPITE000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "oprtr",QRYNAME
          IF        @EQUAL
            CALL      STTRA000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "oprtb",QRYNAME
          IF        @EQUAL
            CALL      STTRB000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "oprcl",QRYNAME
          IF        @EQUAL
            CALL      STCLI000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "oprex",QRYNAME
          IF        @EQUAL
            CALL      STEXP000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "oprua",QRYNAME
          IF        @EQUAL
            CALL      STUAV000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "opcnrusi=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OPCNRUSI
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "optps",QRYNAME
          IF        @EQUAL
            CALL      STTPS000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "opeqp",QRYNAME
          IF        @EQUAL
            CALL      SPEQP000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "opave",QRYNAME
          IF        @EQUAL
            CALL      SPOPA000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "opercode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OPRNCODE
            PACK      OPRNCODE,OPRNCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "actvfilt=",QRYNAME
          IF        @EQUAL
            PACK      ACTVFILT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "oppcm",QRYNAME
          IF        @EQUAL
            CALL      SOPPC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "opwcn",QRYNAME
          IF        @EQUAL
            CALL      SOPWC000
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 1 - Operating Room
.-------------------------------------------------------------------------------
STOPR000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STOPR001,STOPR002,STOPR003,STOPR004,STOPR005,STOPR006:
                       STOPR007,STOPR008,STOPR009,STOPR010,STOPR011,STOPR012:
                       STOPR013,STOPR014,STOPR015,STOPR016,STOPR017,STOPR018
.
          GOTO      STOPR999
.
STOPR001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,OPROP001
          PACK      OPROP001,OPROP001,SP70
          GOTO      STOPR999
.
STOPR002  MOVE      QRYDATA,OPROP002
          GOTO      STOPR999
STOPR003  MOVE      QRYDATA,OPROP003
          GOTO      STOPR999
STOPR004  MOVE      QRYDATA,OPROP004
          GOTO      STOPR999
STOPR005  MOVE      QRYDATA,OPROP005
          GOTO      STOPR999
STOPR006  MOVE      QRYDATA,OPROP006
          GOTO      STOPR999
STOPR007  MOVE      QRYDATA,OPROP007
          GOTO      STOPR999
STOPR008  MOVE      QRYDATA,OPROP008
          GOTO      STOPR999
STOPR009  MOVE      QRYDATA,OPROP009
          GOTO      STOPR999
STOPR010  MOVE      QRYDATA,OPROP010
          GOTO      STOPR999
STOPR011  MOVE      QRYDATA,OPROP011
          GOTO      STOPR999
STOPR012  MOVE      QRYDATA,OPROP012
          GOTO      STOPR999
STOPR013  MOVE      QRYDATA,OPROP013
          GOTO      STOPR999
STOPR014  MOVE      QRYDATA,OPROP014
          GOTO      STOPR999
STOPR015  MOVE      QRYDATA,OPROP015
          GOTO      STOPR999
STOPR016  MOVE      QRYDATA,OPROP016
          GOTO      STOPR999
STOPR017  MOVE      QRYDATA,OPROP017
          GOTO      STOPR999
STOPR018  MOVE      QRYDATA,OPROP018
          GOTO      STOPR999
.
STOPR999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 2 - Operating Room Available
.-------------------------------------------------------------------------------
STORA000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STORA001,STORA002,STORA003
          GOTO      STORA999
.
STORA001  PACK      QRYDATA,QRYDATA,SP30
          UNPACK    QRYDATA,KEY8,KEY3 * Check for formatted or unformatted date 
          MATCH     SP70,KEY3         * Date in the correct format CCYYMMDD
          IF        @EQUAL 
            MOVE      QRYDATA,OPROR001    
          ELSE
            MOVE      QRYDATA,KEY11
            PACK      KEY11,KEY11,SP70 * Date in format...eg: (10 Jun 1999) 
            MATCH     SP70,KEY11
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      OPROR001,CCENT,CYEAR,CMON,CDAY
              REP       " 0",OPROR001 * Date format changed back to 0000,00,00
            ENDIF 
          ENDIF
          GOTO      STORA999
.
STORA002  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,OPROR002
          PACK      OPROR002,OPROR002,SP70
          GOTO      STORA999
.
STORA003  MOVE      QRYDATA,OPROR003
          GOTO      STORA999
.
STORA999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 3 - Operating Room Nurses 
.-------------------------------------------------------------------------------
STNUR000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STNUR001,STNUR002,STNUR003,STNUR004,STNUR005,STNUR006:
                       STNUR007,STNUR008,STNUR009
          GOTO      STNUR999
.
STNUR001  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,OPRNR001
          PACK      OPRNR001,OPRNR001,SP70
          GOTO      STNUR999
.
STNUR002  MOVE      QRYDATA,OPRNR002
          GOTO      STNUR999
.
STNUR003  MOVE      QRYDATA,OPRNR003
          GOTO      STNUR999
.
STNUR004  MOVE      QRYDATA,OPRNR004
          GOTO      STNUR999
.
STNUR005  MOVE      QRYDATA,OPRNR005
          GOTO      STNUR999
.
STNUR006  MOVE      QRYDATA,OPRNR006
          GOTO      STNUR999
.
STNUR007  MOVE      QRYDATA,OPRNR007
          GOTO      STNUR999
.
STNUR008  MOVE      QRYDATA,OPRNR008
          GOTO      STNUR999
.
STNUR009  MOVE      QRYDATA,OPRNR009
          GOTO      STNUR999
.
STNUR999  RETURN
+
.-------------------------------------------------------------------------------
.   Set Parameters for Option 5 - Operating Room Tray Maintenance 
.-------------------------------------------------------------------------------
STTRA000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STTRA001,STTRA002
          GOTO      STTRA999
.
STTRA001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,OPRTR001
          PACK      OPRTR001,OPRTR001,SP70
          GOTO      STTRA999
.
STTRA002  MOVE      QRYDATA,OPRTR002
          GOTO      STTRA999
.
STTRA999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 6 - Operating Room Tray Detail Maintenance
.-------------------------------------------------------------------------------
STTRB000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STTRB001,STTRB002,STTRB003
          GOTO      STTRB999
.
STTRB001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,OPRTB001
          PACK      OPRTB001,OPRTB001,SP70
          GOTO      STTRB999
.
STTRB002  PACK      OPRTB002,QRYDATA,SP70
          GOTO      STTRB999
.
STTRB003  MOVE      QRYDATA,OPRTB003
          GOTO      STTRB999
.
STTRB999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 7 - Operating Room Clinic/Session Maintenance
.-------------------------------------------------------------------------------
STCLI000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STCLI001,STCLI002,STCLI003,STCLI004,STCLI005
          GOTO      STCLI999
.
STCLI001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,OPRCL001
          PACK      OPRCL001,OPRCL001,SP70
          GOTO      STCLI999
.
STCLI002  MOVE      QRYDATA,OPRCL002
          GOTO      STCLI999
.
STCLI003  MOVE      QRYDATA,OPRCL003
          GOTO      STCLI999
.
STCLI004  MOVE      QRYDATA,OPRCL004
          GOTO      STCLI999
.
STCLI005  MOVE      QRYDATA,OPRCL005
          GOTO      STCLI999
.
STCLI999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 8 - Operating Room Expensive Item Maintenance
.-------------------------------------------------------------------------------
STEXP000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STEXP001,STEXP002,STEXP003,STEXP004,STEXP005
          GOTO      STEXP999
.
STEXP001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,OPREX001
          PACK      OPREX001,OPREX001,SP70
          GOTO      STEXP999
.
STEXP002  MOVE      QRYDATA,OPREX002
          GOTO      STEXP999
.
STEXP003  MOVE      QRYDATA,OPREX003
          GOTO      STEXP999
.
STEXP004  MOVE      QRYDATA,OPREX004
          GOTO      STEXP999
.
STEXP005  MOVE      QRYDATA,OPREX005
          GOTO      STEXP999
.
STEXP999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 9 - Operating Room Unavailable Theatre Maintenance
.-------------------------------------------------------------------------------
STUAV000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STUAV001,STUAV002,STUAV003,STUAV004
          GOTO      STUAV999
.
STUAV001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,OPRUA001
          PACK      OPRUA001,OPRUA001,SP70
          GOTO      STUAV999
.
STUAV002  PACK      QRYDATA,QRYDATA,SP30
          UNPACK    QRYDATA,KEY8,KEY3 * Check for formatted or unformatted date
          MATCH     SP70,KEY3         * Date in the correct format CCYYMMDD
          IF        @EQUAL
            MOVE      QRYDATA,OPRUA002
          ELSE
            MOVE      QRYDATA,KEY11
            PACK      KEY11,KEY11,SP70 * Date in format...eg: (10 Jun 1999)
            MATCH     SP70,KEY11
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      OPRUA002,CCENT,CYEAR,CMON,CDAY
              REP       " 0",OPRUA002 * Date format changed back to 0000,00,00
            ENDIF
          ENDIF  
          GOTO      STUAV999
.
STUAV003  MOVE      QRYDATA,OPRUA003
          GOTO      STUAV999
.
STUAV004  MOVE      QRYDATA,OPRUA004
          GOTO      STUAV999
.
STUAV999  RETURN
+
.-------------------------------------------------------------------------------
.   Set Parameters for Option 13 
.-------------------------------------------------------------------------------
STTPS000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STTPS001,STTPS002
          GOTO      STTPS999
.
STTPS001  MOVE      QRYDATA,OPTPS001
          GOTO      STTPS999
.
STTPS002  MOVE      QRYDATA,OPTPS002
          GOTO      STTPS999
.
STTPS999  RETURN
.------------------------------------------------------------
. Operating Room: Display,Add,Update,Delete
.------------------------------------------------------------
OPROPR00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPROPR40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPROPR10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPROPR20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPROPR30 IF EQUAL
.
          GOTO      OPROPR93
.
.         ************ ADD FORMACTION ***********
.
OPROPR10  CALL      CHKOPR00      * Checks mandatory fields
          BRANCH    EXIT,OPROPR99
          PACK      KEY6,OPROP001,SP70
          CALL      RDOPOPR1
          COMPARE   ZERO,OVRCD
          GOTO      OPROPR92 IF EQUAL
.
          CALL      OPRSAV00      * Moves input variables to file variables
          PACK      KEY6,OPROP001,SP70
          CALL      WROPOPR1       * Writes away the data
.
          MOVE      "A",KEY1      * Set Add Parameter for OPRAUD00    
          CALL      OPRAUD00      * Write Audit File if Needed    
.
          MOVE      ZERO,EXIT
          GOTO      OPROPR99
.
.         ************ UPDATE FORMACTION **********
.
OPROPR20  PACK      KEY6,OPROP001,SP70   
          CALL      RDOPOPR1
          BRANCH    OVRCD,OPROPR91
          CALL      CHKOPR00      * Checks mandatory fields
          BRANCH    EXIT,OPROPR99
.
          MOVE      "B",KEY1      * Set Before Changes Parameter for OPRAUD00 
          CALL      OPRAUD00      * Write Audit File if Needed  
.
          CALL      OPRSAV00      * Moves input variables to file variables
          PACK      KEY6,OPROP001,SP70  
          CALL      UPOPOPR1      * Writes away the data
.
          MOVE      "C",KEY1      * Set After Changes Parameter for OPRAUD00    
          CALL      OPRAUD00      * Write Audit File if Needed  
.
          MOVE      ZERO,EXIT
          GOTO      OPROPR99
.
.         ************ DELETE FORMACTION **********
.
OPROPR30  PACK      KEY6,OPROP001,SP70   
          CALL      RDOPOPR1
          BRANCH    OVRCD,OPROPR91
          CALL      DEOPOPR1
.
          MOVE      "D",KEY1      * Set Delete Parameter for OPRAUD00    
          CALL      OPRAUD00      * Write Audit File if Needed   
.
          MOVE      ZERO,EXIT
          GOTO      OPROPR99
.
.         ************ DISPLAY FORMACTION **********
.
OPROPR40  PACK      KEY6,OPROP001,SP70
          CALL      RDOPOPR1
          IF        OVRCD=1
            CALL      CLROPR00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Theatre Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPROPR99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPROPR99
.
OPROPR91  MOVE      "Operating Room Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPROPR99
.
OPROPR92  MOVE      "Operating Room Code record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPROPR99
.
OPROPR93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPROPR99
.
OPROPR99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLROPR00  MOVE      SP70,OPRMROOM   * Operating Room
          MOVE      SP70,OPRMDESC   * Description
          MOVE      SP70,OPRMLOC    * Location
          MOVE      SP70,OPRMUSR1   * User Defined 1 (Category Y1)
          MOVE      SP70,OPRMUSR2   *              2 (Category Y2)
          MOVE      SP70,OPRMUSR3   *              3 (Category Y3)
          MOVE      SP70,OPRMUSR4   *              4 (Category Y4)
          MOVE      SP70,OPRMUSR5   *              5 (Category Y5)
          MOVE      ZERO,OPRMSTAT   * Status 0 = Active 1 = Non-Active
          MOVE      ZERO,OPRMSUN    * Time available Sunday  (mins)
          MOVE      ZERO,OPRMMON    * Time available Monday  (mins)
          MOVE      ZERO,OPRMTUE    * Time available Tuesday (mins)
          MOVE      ZERO,OPRMWED    * Time available Wednesday  (mins)
          MOVE      ZERO,OPRMTHU    * Time available Thursday  (mins)
          MOVE      ZERO,OPRMFRI    * Time available Friday  (mins)
          MOVE      ZERO,OPRMSAT    * Time available Saturday (mins)
          MOVE      SP70,OPRMGLDG   * G/L code and Cost Centre
          MOVE      SP70,OPRMHOSP   * Hospital
          MOVE      SP70,OPRMSPAR   * Spare
.
CLROPR99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
OPRSAV00  MOVE      OPROP001,OPRMROOM   * Operating Room
          MOVE      OPROP002,OPRMDESC   * Description
          MOVE      OPROP003,OPRMLOC    * Location
          MOVE      OPROP004,OPRMUSR1   * User Defined 1 (Category Y1)
          MOVE      OPROP005,OPRMUSR2   *              2 (Category Y2)
          MOVE      OPROP006,OPRMUSR3   *              3 (Category Y3)
          MOVE      OPROP007,OPRMUSR4   *              4 (Category Y4)
          MOVE      OPROP008,OPRMUSR5   *              5 (Category Y5)
.
          COMPARE   TWO,OPROP009     * Status 0 = Active 1 = Non-Active
          IF        @EQUAL
            MOVE      ZERO,OPRMSTAT   
          ELSE 
            MOVE      ONE,OPRMSTAT
          ENDIF
.
          MOVE      OPROP010,OPRMSUN    * Time available Sunday  (mins)
          MOVE      OPROP011,OPRMMON    * Time available Monday  (mins)
          MOVE      OPROP012,OPRMTUE    * Time available Tuesday (mins)
          MOVE      OPROP013,OPRMWED    * Time available Wednesday  (mins)
          MOVE      OPROP014,OPRMTHU    * Time available Thursday  (mins)
          MOVE      OPROP015,OPRMFRI    * Time available Friday  (mins)
          MOVE      OPROP016,OPRMSAT    * Time available Saturday (mins)
          MOVE      OPROP017,OPRMGLDG   * G/L code and Cost Centre
          MOVE      OPROP018,OPRMHOSP   * Hospital
          MOVE      SP70,OPRMSPAR       * Spare
.
OPRSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKOPR00  RESET     OPROP001
          MATCH     SP70,OPROP001
          GOTO      CHKOPR90 IF EQUAL
.
          RESET     OPROP002
          MATCH     SP70,OPROP002
          GOTO      CHKOPR91 IF EQUAL
.
          GOTO      CHKOPR98
.
CHKOPR90  MOVE      "Operating Room Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPR99
.
CHKOPR91  MOVE      "Operating Room Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPR99
.
CHKOPR98  MOVE      ZERO,EXIT
CHKOPR99  RETURN
.---------------------------------------------------------------------
. Writes Operating Room Audit
.    Parameters :   KEY1 - Set Record Type
.---------------------------------------------------------------------
OPRAUD00  BRANCH    OPCNAUDT,OPRAUD99  * Check if audit needs to be written
.
          CALL      IBACLOCK
          PACK      OPRMAUDD,CCC,CYY,CMM,CDD     * Date
          REP       " 0",OPRMAUDD
          MOVE      CTIMEIS,OPRMAUDT
.
          MOVE      PORT,OPRMAUDP                * Port
          MOVE      KEY1,OPRMAUDR                * Record Type
          MOVE      ONE,OPRMAUDS                 * Not Printed
          MOVE      PASSCODE,OPRMAUDO            * Operator
.
          PACK      KEY19,OPRMAUDD,OPRMAUDT,OPRMAUDP,OPRMAUDR
          CALL      AWOPOPR                       * Write Audit File
.
OPRAUD99  RETURN
.------------------------------------------------------------
. Operating Room Available Times: Display,Add,Update,Delete
.------------------------------------------------------------
OPRORA00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRORA40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRORA10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRORA20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRORA30 IF EQUAL
.
          GOTO      OPRORA93
.
.         ************ ADD FORMACTION ***********
.
OPRORA10  CALL      CHKORA00      * Checks mandatory fields
          BRANCH    EXIT,OPRORA99
.
          PACK      KEY14,OPROR001,OPROR002,SP70
          CALL      RDOPORA1
          COMPARE   ZERO,OVRCD
          GOTO      OPRORA92 IF EQUAL
.
          CALL      ORASAV00      * Moves input variables to file variables
          PACK      KEY14,OPROR001,OPROR002,SP70
          CALL      WROPORA1       * Writes away the data
.
          MOVE      "A",KEY1      * Set Add Parameter for ORAAUD00    
          CALL      ORAAUD00      * Write Audit File if Needed    
.
          MOVE      ZERO,EXIT
          GOTO      OPRORA99
.
.         ************ UPDATE FORMACTION **********
.
OPRORA20  PACK      KEY14,OPROR001,OPROR002,SP70   
          CALL      RDOPORA1
          BRANCH    OVRCD,OPRORA91
          CALL      CHKORA00      * Checks mandatory fields
          BRANCH    EXIT,OPRORA99
.
          MOVE      "B",KEY1      * Set Before Changes Parameter for ORAAUD00 
          CALL      ORAAUD00      * Write Audit File if Needed  
.
          CALL      ORASAV00      * Moves input variables to file variables
          PACK      KEY14,OPROR001,OPROR002,SP70
          CALL      UPOPORA1      * Writes away the data
.
          MOVE      "C",KEY1      * Set After Changes Parameter for ORAAUD00    
          CALL      ORAAUD00      * Write Audit File if Needed  
.
          MOVE      ZERO,EXIT
          GOTO      OPRORA99
.
.         ************ DELETE FORMACTION **********
.
OPRORA30  PACK      KEY14,OPROR001,OPROR002,SP70   
          CALL      RDOPORA1
          BRANCH    OVRCD,OPRORA91
          CALL      DEOPORA1
.
          MOVE      "D",KEY1      * Set Delete Parameter for ORAAUD00    
          CALL      ORAAUD00      * Write Audit File if Needed   
.
          MOVE      ZERO,EXIT
          GOTO      OPRORA99
.
.         ************ DISPLAY FORMACTION **********
.
OPRORA40  PACK      KEY6,OPROR002,SP70    * Operating Rooms File
          CALL      RDOPOPR1
          BRANCH    OVRCD,OPRORA94

          PACK      KEY14,OPROR001,OPROR002,SP70  * Time Available File  
          CALL      RDOPORA1
          IF        OVRCD=1
            CALL      CLRORA00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Operating Rooms - Available Times",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRORA99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRORA99
.
OPRORA91  MOVE      "Available Time record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRORA99
.
OPRORA92  MOVE      "Available Time record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRORA99
.
OPRORA93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRORA99
.
OPRORA94  MOVE      "Invalid Theatre Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRORA99
.
OPRORA99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRORA00  MOVE      SP70,OPRADATE   * Date             
          MOVE      SP70,OPRAROOM   * Operating Room
          MOVE      ZERO,OPRAVAIL   * Time Operating Room Available
          MOVE      SP70,OPRASPAR   * Spare 
.
CLRORA99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
ORASAV00  MOVE      OPROR001,OPRADATE   * Date             
          MOVE      OPROR002,OPRAROOM   * Operating Room
          MOVE      OPROR003,OPRAVAIL   * Time Operating Room Available
          MOVE      SP70,OPRASPAR       * Spare 
.
ORASAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKORA00  RESET     OPROR001  
          MATCH     SP70,OPROR001
          GOTO      CHKORA90 IF EQUAL
.
          RESET     OPROR002
          MATCH     SP70,OPROR002
          GOTO      CHKORA91 IF EQUAL
.
          GOTO      CHKORA98
.
CHKORA90  MOVE      "Date cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKORA99
.
CHKORA91  MOVE      "Time Available is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKORA99
.
CHKORA98  MOVE      ZERO,EXIT
CHKORA99  RETURN
.---------------------------------------------------------------------
. Writes Operating Room Available Times Audit
.    Parameters :   KEY1 - Set Record Type
.---------------------------------------------------------------------
ORAAUD00  BRANCH    OPCNAUDT,ORAAUD99  * Check if audit needs to be written
.
          CALL      IBACLOCK
          PACK      OPRAAUDD,CCC,CYY,CMM,CDD     * Date
          REP       " 0",OPRAAUDD
          MOVE      CTIMEIS,OPRAAUDT
.
          MOVE      PORT,OPRAAUDP                * Port
          MOVE      KEY1,OPRAAUDR                * Record Type
          MOVE      ONE,OPRAAUDS                 * Not Printed
          MOVE      PASSCODE,OPRAAUDO            * Operator
.
          PACK      KEY19,OPRAAUDD,OPRAAUDT,OPRAAUDP,OPRAAUDR
          CALL      AWOPORA                       * Write Audit File
.
ORAAUD99  RETURN
.------------------------------------------------------------
. Operating Room Nurses: Display,Add,Update,Delete
.------------------------------------------------------------
OPRNUR00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRNUR40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRNUR10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRNUR20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRNUR30 IF EQUAL
.
          GOTO      OPRNUR93
.
.         ************ ADD FORMACTION ***********
.
OPRNUR10  CALL      CHKNUR00      * Checks mandatory fields
          BRANCH    EXIT,OPRNUR99
.
          PACK      KEY6,OPRNR001,SP70
          CALL      RDOPNUR1
          COMPARE   ZERO,OVRCD
          GOTO      OPRNUR92 IF EQUAL
.
          CALL      NURSAV00      * Moves input variables to file variables
          PACK      KEY6,OPRNR001,SP70
          CALL      WROPNUR1       * Writes away the data
          PROC      OPRNKIUP
.
          MOVE      ZERO,EXIT
          GOTO      OPRNUR99
.
.         ************ UPDATE FORMACTION **********
.
OPRNUR20  PACK      KEY6,OPRNR001,SP70   
          CALL      RDOPNUR1
          BRANCH    OVRCD,OPRNUR91
          CALL      CHKNUR00      * Checks mandatory fields
          BRANCH    EXIT,OPRNUR99
.
          CALL      NURSAV00      * Moves input variables to file variables
          PACK      KEY6,OPRNR001,SP70
          CALL      UPOPNUR1      * Writes away the data
          PROC      OPRNKIUP
.
          MOVE      ZERO,EXIT
          GOTO      OPRNUR99
.
.         ************ DELETE FORMACTION **********
.
OPRNUR30  PACK      KEY6,OPRNR001,SP70   
          CALL      RDOPNUR1
          BRANCH    OVRCD,OPRNUR91
          CALL      DEOPNUR1
          PROC      OPRNKIUP
.
          MOVE      ZERO,EXIT
          GOTO      OPRNUR99
.
.         ************ DISPLAY FORMACTION **********
.
OPRNUR40  PACK      KEY6,OPRNR001,SP70    * Operating Rooms Nurses File
          CALL      RDOPNUR1
          IF        OVRCD=1
            CALL      CLRNUR00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Nurse Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRNUR99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRNUR99
.
OPRNUR91  MOVE      "Nurses record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRNUR99
.
OPRNUR92  MOVE      "Nurses record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRNUR99
.
OPRNUR93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRNUR99
.
OPRNUR99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRNUR00  MOVE      SP70,OPNRCODE   * Nurse Code
          MOVE      SP70,OPNRSNAM   * Surname
          MOVE      SP70,OPNRGNAM   * Given Name
          MOVE      SP70,OPNRUSR1   * User Defined 1 (Category Q1)
          MOVE      SP70,OPNRUSR2   *              2 (Category Q2)
          MOVE      SP70,OPNRUSR3   *              3 (Category Q3)
          MOVE      SP70,OPNRUSR4   *              4 (Category Q4)
          MOVE      SP70,OPNRUSR5   *              5 (Category Q5)
          MOVE      ZERO,OPNRSTAT   * Status 0=Active 1=Non-Active
          MOVE      SP70,OPNRSPAR   * Spare
.
CLRNUR99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
NURSAV00  MOVE      OPRNR001,OPNRCODE   * Nurse Code
          MOVE      OPRNR002,OPNRSNAM   * Surname
          MOVE      OPRNR003,OPNRGNAM   * Given Name
          MOVE      OPRNR004,OPNRUSR1   * User Defined 1 (Category Q1)
          MOVE      OPRNR005,OPNRUSR2   *              2 (Category Q2)
          MOVE      OPRNR006,OPNRUSR3   *              3 (Category Q3)
          MOVE      OPRNR007,OPNRUSR4   *              4 (Category Q4)
          MOVE      OPRNR008,OPNRUSR5   *              5 (Category Q5)
.
          COMPARE   TWO,OPRNR009     * Status 0 = Active 1 = Non-Active
          IF        @EQUAL
            MOVE      ZERO,OPNRSTAT
          ELSE
            MOVE      ONE,OPNRSTAT
          ENDIF
.
          MOVE      SP70,OPNRSPAR   * Spare
.
NURSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKNUR00  RESET     OPRNR001  
          MATCH     SP70,OPRNR001
          GOTO      CHKNUR90 IF EQUAL
.
          RESET     OPRNR002
          MATCH     SP70,OPRNR002
          GOTO      CHKNUR91 IF EQUAL
.
          GOTO      CHKNUR98
.
CHKNUR90  MOVE      "Nurse code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKNUR99
.
CHKNUR91  MOVE      "Nurses Surname is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKNUR99
.
CHKNUR98  MOVE      ZERO,EXIT
CHKNUR99  RETURN
.------------------------------------------------------------
. Operating Room Item File: Display,Add,Update,Delete
.------------------------------------------------------------
OPRITE00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRITE40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRITE10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRITE20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRITE30 IF EQUAL
.
          GOTO      OPRITE93
.
.         ************ ADD FORMACTION ***********
.
OPRITE10  CALL      CHKITE00      * Checks mandatory fields
          BRANCH    EXIT,OPRITE99
.
          PACK      KEY15,OPRIT001,SP70
          CALL      RDOPITE1
          COMPARE   ZERO,OVRCD
          GOTO      OPRITE92 IF EQUAL
.
          CALL      MVOPIT00      * Moves input variables to file variables
          MOVE      OPITUSLO,OPITCULO  * set Current location/tray
          PACK      KEY15,OPRIT001,SP70
          CALL      WROPITE1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRITE99
.
.         ************ UPDATE FORMACTION **********
.
OPRITE20  PACK      KEY15,OPRIT001,SP70   
          CALL      RDOPITE1
          BRANCH    OVRCD,OPRITE91
          CALL      CHKITE00      * Checks mandatory fields
          BRANCH    EXIT,OPRITE99
.
          MATCH     OPITCRST,OPRIT012
          IF        !@EQUAL
            PACK      KEY8,CCC,CYY,CMM,CDD
            REP       " 0",KEY8
            MOVE      KEY8,OPRIT013       * Status has changed
          ENDIF
.
          CALL      MVOPIT00      * Moves input variables to file variables
          PACK      KEY15,OPRIT001,SP70
          CALL      UPOPITE1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRITE99
.
.         ************ DELETE FORMACTION **********
.
OPRITE30  PACK      KEY15,OPRIT001,SP70   
          CALL      RDOPITE1
          BRANCH    OVRCD,OPRITE91
          CALL      DEOPITE1
.
          MOVE      ZERO,EXIT
          GOTO      OPRITE99
.
.         ************ DISPLAY FORMACTION **********
.
OPRITE40  PACK      KEY15,OPRIT001,SP70    * Operating Rooms Item File
          CALL      RDOPITE1
          IF        OVRCD=1
            CALL      CLRITE00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Operating Rooms - Item File Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRITE99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRITE99
.
OPRITE91  MOVE      "Item record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRITE99
.
OPRITE92  MOVE      "Item record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRITE99
.
OPRITE93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRITE99
.
OPRITE99  RETURN
+
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKITE00  RESET     OPRIT001  
          MATCH     SP70,OPRIT001
          GOTO      CHKITE90 IF EQUAL
.
          GOTO      CHKITE98
.
CHKITE90  MOVE      "Item code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKITE99
.
CHKITE98  MOVE      ZERO,EXIT
CHKITE99  RETURN
.------------------------------------------------------------
. Operating Room Tray Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
OPRTRA00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRTRA40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRTRA10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRTRA20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRTRA30 IF EQUAL
.
          GOTO      OPRTRA93
.
.         ************ ADD FORMACTION ***********
.
OPRTRA10  CALL      CHKTRA00      * Checks mandatory fields
          BRANCH    EXIT,OPRTRA99
.
          IF        IBCNMHOS = 0
            MOVE      SP70,HOSPCODE
          ENDIF
.
          PACK      KEY18,OPRTR001,HOSPCODE,SP70
          CALL      RDOPTRA1
          COMPARE   ZERO,OVRCD
          GOTO      OPRTRA92 IF EQUAL
.
          CALL      TRASAV00      * Moves input variables to file variables
          PACK      KEY18,OPRTR001,HOSPCODE,SP70
          CALL      WROPTRA1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRTRA99
.
.         ************ UPDATE FORMACTION **********
.
OPRTRA20  IF        IBCNMHOS = 1
            MOVE      UPDTHOSP,HOSPCODE
            MATCH     CURRHOSP,HOSPCODE
            IF        !@EQUAL 
              PACK      KEY18,OPRTR001,HOSPCODE,SP70
              CALL      RDOPTRA1
              COMPARE   ZERO,OVRCD
              GOTO      OPRTRA92 IF EQUAL
            ENDIF
          ELSE
            MOVE      SP70,HOSPCODE
          ENDIF
.
          PACK      KEY18,OPRTR001,CURRHOSP,SP70   
          CALL      RDOPTRA1
          BRANCH    OVRCD,OPRTRA91
.
          CALL      CHKTRA00      * Checks mandatory fields
          BRANCH    EXIT,OPRTRA99
.
          CALL      TRASAV00      * Moves input variables to file variables
          PACK      KEY18,OPRTR001,CURRHOSP,SP70
          CALL      UPOPTRA1      * Writes away the data
.
          IF        IBCNMHOS = 0
            GOTO      OPRTRA29
          ENDIF
.
          MATCH     SP70,CURRHOSP
          GOTO      OPRTRA29 IF NOT EQUAL
.
. Update hospital id for oprtrybf
.
          PACK      KEY33,OPRTR001,SP70
          CALL      RSOPTRB1
OPRTRA22  CALL      RKOPTRB1
          BRANCH    OVRCD,OPRTRA29
.
          MATCH     OPRTR001,OPTDCODE
          GOTO      OPRTRA29 IF NOT EQUAL
.
          MATCH     CURRHOSP,OPTDHOSP
          GOTO      OPRTRA22 IF NOT EQUAL
.
          PACK      SAVKEY33,OPTDCODE,OPTDITEM,OPTDHOSP,SP70
.
          PACK      KEY33,OPTDCODE,OPTDITEM,HOSPCODE,SP70
          CALL      RDOPTRB1
          IF        OVRCD = 1
            MOVE      SAVKEY33,KEY33
            CALL      RDOPTRB1
            IF        OVRCD = 0
              MOVE      HOSPCODE,OPTDHOSP
              CALL      UPOPTRB1
            ENDIF
          ENDIF
.
          MOVE      SAVKEY33,KEY33
          CALL      RDOPDPF1
.
          GOTO      OPRTRA22
.
OPRTRA29  MOVE      ZERO,EXIT
          GOTO      OPRTRA99
.
.         ************ DELETE FORMACTION **********
.
OPRTRA30  PACK      KEY18,OPRTR001,CURRHOSP,SP70   
          CALL      RDOPTRA1
          BRANCH    OVRCD,OPRTRA91
.
          CALL      DEOPTRA1
.
          PACK      KEY33,OPRTR001,SP70
          CALL      RSOPTRB1
OPRTRA32  CALL      RKOPTRB1
          BRANCH    OVRCD,OPRTRA39
.
          MATCH     OPRTR001,OPTDCODE
          GOTO      OPRTRA39 IF NOT EQUAL 
.
          MATCH     CURRHOSP,OPTDHOSP
          GOTO      OPRTRA32 IF NOT EQUAL
.
          PACK      KEY33,OPTDCODE,OPTDITEM,OPTDHOSP,SP70
          CALL      DEOPTRB1
          GOTO      OPRTRA32 
.
OPRTRA39  MOVE      ZERO,EXIT
          GOTO      OPRTRA99
.
.         ************ DISPLAY FORMACTION **********
.
OPRTRA40  PACK      KEY18,OPRTR001,HOSPCODE,SP70   * Operating Rooms Tray File
          CALL      RDOPTRA1
          IF        OVRCD=1
            CALL      CLRTRA00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Operating Rooms - Tray Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRTRA99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRTRA99
.
OPRTRA91  MOVE      "Tray record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTRA99
.
OPRTRA92  MOVE      "Tray record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTRA99
.
OPRTRA93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTRA99
.
OPRTRA99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRTRA00  MOVE      SP70,OPTHCODE  * Tray Code  
          MOVE      SP70,OPTHDESC  * Tray Description
          MOVE      SP70,OPTHSPAR  * Spare variable
.
CLRTRA99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
TRASAV00  MOVE      OPRTR001,OPTHCODE  * Tray Code  
          MOVE      OPRTR002,OPTHDESC  * Tray Description
          MOVE      HOSPCODE,OPTHHOSP  * Hospital Id
          MOVE      SP70,OPTHSPAR      * Spare variable
.
TRASAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKTRA00  RESET     OPRTR001  
          MATCH     SP70,OPRTR001
          GOTO      CHKTRA90 IF EQUAL
.
          RESET     OPRTR002  
          MATCH     SP70,OPRTR002
          GOTO      CHKTRA91 IF EQUAL
.
          GOTO      CHKTRA98
.
CHKTRA90  MOVE      "Tray code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTRA99
.
CHKTRA91  MOVE      "Tray description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTRA99
.
CHKTRA98  MOVE      ZERO,EXIT
CHKTRA99  RETURN
.-------------------------------------------------------------------
. Operating Room Tray Detail Maintenance: Display,Add,Update,Delete
.-------------------------------------------------------------------
OPRTRB00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRTRB40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRTRB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRTRB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRTRB30 IF EQUAL
.
          GOTO      OPRTRB93
.
.         ************ ADD FORMACTION ***********
.
OPRTRB10  CALL      CHKTRB00      * Checks mandatory fields
          BRANCH    EXIT,OPRTRB99
.
          MATCH     "1",OPCNPTMC
          GOTO      OPRTRB13 IF NOT EQUAL
.
          COMPARE   FIVE,CFEETYP
          GOTO      OPRTRB12 IF EQUAL
.
          PACK      KEY9,OPRTB002,SP70
          IF        IBCNMHOS = 1
            PACK      KEY3,WBSEHOSP,SP70
            CALL      RDPTHSP1
            BRANCH    OVRCD,OPRTRB11
            PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
          ELSE
OPRTRB11    PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
          ENDIF
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      OPRTRB15 IF EQUAL
.
          GOTO      OPRTRB95
.
OPRTRB12  PACK      KEY37,OPRTB002,SP70
          CALL      RSNZMCH3
OPTRB12A  CALL      RKNZMCH3
          BRANCH    OVRCD,OPRTRB95
.
          MOVE      OPRTB002,DIM9
.
          MATCH     DIM9,NZMCMCHG
          GOTO      OPRTRB95 IF NOT EQUAL
.
          MATCH     "1",NZMCACFL      
          GOTO      OPTRB12A IF EQUAL 
.
          GOTO      OPRTRB15
.
OPRTRB13  PACK      KEY15,OPRTB002,SP70
          CALL      RDOPITE1
          BRANCH    OVRCD,OPRTRB95
.
OPRTRB15  PACK      KEY33,OPRTB001,OPRTB002,HOSPCODE,SP70
          CALL      RDOPTRB1
          COMPARE   ZERO,OVRCD
          GOTO      OPRTRB92 IF EQUAL
.
          CALL      TRBSAV00      * Moves input variables to file variables
          PACK      KEY33,OPRTB001,OPRTB002,HOSPCODE,SP70
          CALL      WROPTRB1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRTRB99
.
.         ************ UPDATE FORMACTION **********
.
OPRTRB20  PACK      KEY33,OPRTB001,OPRTB002,HOSPCODE,SP70
          CALL      RDOPTRB1
          BRANCH    OVRCD,OPRTRB91
          CALL      CHKTRB00      * Checks mandatory fields
          BRANCH    EXIT,OPRTRB99
.
          CALL      TRBSAV00      * Moves input variables to file variables
          PACK      KEY33,OPRTB001,OPRTB002,SP70
          CALL      UPOPTRB1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRTRB99
.
.         ************ DELETE FORMACTION **********
.
OPRTRB30  PACK      KEY33,OPRTB001,OPRTB002,HOSPCODE,SP70
          CALL      RDOPTRB1
          BRANCH    OVRCD,OPRTRB91
          CALL      DEOPTRB1
.
          MOVE      ZERO,EXIT
          GOTO      OPRTRB99
.
.         ************ DISPLAY FORMACTION **********
.
OPRTRB40  PACK      KEY18,OPRTB001,HOSPCODE,SP70   * Operating Rooms Tray File
          CALL      RDOPTRA1
          BRANCH    OVRCD,OPRTRB94
.
          PACK      KEY33,OPRTB001,OPRTB002,HOSPCODE,SP70
          CALL      RDOPTRB1
          IF        OVRCD=1
            CALL      CLRTRB00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Operating Rooms - Tray Detail Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRTRB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRTRB99
.
OPRTRB91  MOVE      "Tray Detail record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTRB99
.
OPRTRB92  MOVE      "Tray Detail record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTRB99
.
OPRTRB93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTRB99
.
OPRTRB94  MOVE      "Invalid Tray Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTRB99
.
OPRTRB95  MOVE      "Invalid Item entered",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTRB99
.
OPRTRB99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRTRB00  MOVE      SP70,OPTDCODE  * Tray Code  
          MOVE      SP70,OPTDITEM  * Item Code       
          MOVE      ZERO,OPTDQTY   * Quantity
          MOVE      SP70,OPTDHOSP  * Hospital Id 
          MOVE      SP70,OPTDSPAR  * Spare variable
.
CLRTRB99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
TRBSAV00  MOVE      OPRTB001,OPTDCODE  * Tray Code  
          MOVE      OPRTB002,OPTDITEM  * Item Code       
          MOVE      OPRTB003,OPTDQTY   * Quantity
          MOVE      HOSPCODE,OPTDHOSP  * Hospital Id
          MOVE      SP70,OPTDSPAR      * Spare variable
.
TRBSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKTRB00  RESET     OPRTB002  
          MATCH     SP70,OPRTB002
          GOTO      CHKTRB90 IF EQUAL
.
          COMPARE   ZERO,OPRTB003
          GOTO      CHKTRB91 IF EQUAL
.
          GOTO      CHKTRB98
.
CHKTRB90  MOVE      "Item code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTRB99
.
CHKTRB91  MOVE      "Item Quantity is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTRB99
.
CHKTRB98  MOVE      ZERO,EXIT
CHKTRB99  RETURN
.-------------------------------------------------------------------
. Operating Room Clinic/Session Maintenance: Display,Add,Update,Delete
.-------------------------------------------------------------------
OPRCLI00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRCLI40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRCLI10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRCLI20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRCLI30 IF EQUAL
.
          GOTO      OPRCLI93
.
.         ************ ADD FORMACTION ***********
.
OPRCLI10  CALL      CHKCLI00      * Checks mandatory fields
          BRANCH    EXIT,OPRCLI99
.
          PACK      KEY6,OPRCL001,SP70
          CALL      RDOPCLI1
          COMPARE   ZERO,OVRCD
          GOTO      OPRCLI92 IF EQUAL
.
          CALL      CLISAV00      * Moves input variables to file variables
          PACK      KEY6,OPRCL001,SP70
          CALL      WROPCLI1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRCLI99
.
.         ************ UPDATE FORMACTION **********
.
OPRCLI20  PACK      KEY6,OPRCL001,SP70
          CALL      RDOPCLI1
          BRANCH    OVRCD,OPRCLI91
          CALL      CHKCLI00      * Checks mandatory fields
          BRANCH    EXIT,OPRCLI99
.
          CALL      CLISAV00      * Moves input variables to file variables
          PACK      KEY6,OPRCL001,SP70
          CALL      UPOPCLI1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRCLI99
.
.         ************ DELETE FORMACTION **********
.
OPRCLI30  PACK      KEY6,OPRCL001,SP70
          CALL      RDOPCLI1
          BRANCH    OVRCD,OPRCLI91
.
          CALL      SESSCH00      * Checks if any Session Schedules exist? 
          BRANCH    EXIT,OPRCLI99
.
          CALL      DEOPCLI1
.
          MOVE      ZERO,EXIT
          GOTO      OPRCLI99
.
.         ************ DISPLAY FORMACTION **********
.
OPRCLI40  PACK      KEY6,OPRCL001,SP70    * Operating Rooms Clinic File
          CALL      RDOPCLI1
          IF        OVRCD=1
            CALL      CLRCLI00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Operating Rooms - Clinic Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRCLI99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRCLI99
.
OPRCLI91  MOVE      "Session record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRCLI99
.
OPRCLI92  MOVE      "Session record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRCLI99
.
OPRCLI93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRCLI99
.
OPRCLI99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRCLI00  MOVE      SP70,OPCLCLIN  * Clinic Code
          MOVE      SP70,OPCLDESC  * Description     
          MOVE      SP70,OPCLDOCT  * Doctor Code
          MOVE      SP70,OPCLCAT   * Group Code
          MOVE      SP70,OPCLSPAR  * Spare variable
.
CLRCLI99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
CLISAV00  MOVE      OPRCL001,OPCLCLIN  * Clinic Code
          MOVE      OPRCL002,OPCLDESC  * Description     
          MOVE      OPRCL003,OPCLDOCT  * Doctor Code
          MOVE      OPRCL004,OPCLCAT   * Group Code
          MOVE      OPRCL005,OPCLACTV  * Active Flag
          MOVE      SP70,OPCLSPAR      * Spare variable
.
CLISAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKCLI00  RESET     OPRCL001  
          MATCH     SP70,OPRCL001
          GOTO      CHKCLI90 IF EQUAL
.
          RESET     OPRCL003
.
          RESET     OPRCL004
          MATCH     SP70,OPRCL004
          GOTO      CHKCLI92 IF EQUAL
.
          GOTO      CHKCLI98
.
CHKCLI90  MOVE      "Session Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCLI99
.
CHKCLI92  MOVE      "Doctor Type is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCLI99
.
CHKCLI98  MOVE      ZERO,EXIT
CHKCLI99  RETURN
.----------------------------------------------------------------------
.                            SESSCH00
.    Checks whether a session schedules exist for the Session.
.    IF yes the moves 1 to EXIT else move ZERO to EXIT                          
.----------------------------------------------------------------------
SESSCH00  IF        OPCNCLSU = 0
            PACK      KEY21,WBSEHOSP,OPRCL001,SP70
          ELSE
            PACK      KEY21,WBSEHOSP,OPRCL003,SP70
          ENDIF
.
SESSCH10  CALL      RSOPSEM1
          CALL      RKOPSEM1
          BRANCH    OVRCD,SESSCH15
.
          MATCH     WBSEHOSP,OPSMHOSP
          GOTO      SESSCH15 IF NOT EQUAL      
.
          IF        OPCNCLSU = 0
            MATCH     OPRCL001,OPSMCLIN
          ELSE
            MATCH     OPRCL003,OPSMCLIN
          ENDIF
          GOTO      SESSCH90 IF EQUAL         
.
SESSCH15  IF        OPCNCLSU = 0
            PACK      KEY21,OPRCL001,SP70
          ELSE
            PACK      KEY21,OPRCL003,SP70
          ENDIF
.
          CALL      RSOPSEM2
          CALL      RKOPSEM2
          BRANCH    OVRCD,SESSCH20
.
          IF        OPCNCLSU = 0
            MATCH     OPRCL001,OPSMCLIN
          ELSE
            MATCH     OPRCL003,OPSMCLIN
          ENDIF
          GOTO      SESSCH91 IF EQUAL
.
.         Checks to see if stored by Dr or by Clinic
.
SESSCH20  IF        OPCNCLSU = 0
            PACK      KEY22,OPRCL001,WBSEHOSP,SP70
          ELSE
            PACK      KEY22,OPRCL003,WBSEHOSP,SP70
          ENDIF
          CALL      RSOPSES2
SESSCH30  CALL      RKOPSES2
.
.         Checks if booked section exists. If so, displays error message, 
.         otherwise deletes
.
          BRANCH    OVRCD,SESSCH98
.
          IF        OPCNCLSU = 0
            MATCH     OPRCL001,OPSECLIN
          ELSE
            MATCH     OPRCL003,OPSECLIN
          ENDIF
          GOTO      SESSCH98 IF NOT EQUAL
.
          MATCH     WBSEHOSP,OPSEHOSP
          GOTO      SESSCH95 IF EQUAL
.
          GOTO      SESSCH98 
.
SESSCH90  MOVE      "Cannot Perform Delete as a Schedule Exists!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESSCH99
.
.         Error Message if an open session exists
.
SESSCH91  CLEAR     WEBTITLE
          APPEND    "Cannot Perform Delete as a Schedule Exists in a",WEBTITLE
          APPEND    " Different Hospital!",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESSCH99
.
.         Error Message if an open session exists in different hospital
.
SESSCH95  MOVE      "Cannot Perform Delete as an open session exists!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESSCH99
.
SESSCH98  MOVE      ZERO,EXIT
SESSCH99  RETURN
.-----------------------------------------------------------------------
. Operating Room Expensive Item Maintenance: Display,Add,Update,Delete
.-----------------------------------------------------------------------
OPREXP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPREXP40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPREXP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPREXP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPREXP30 IF EQUAL
.
          GOTO      OPREXP93
.
.         ************ ADD FORMACTION ***********
.
OPREXP10  CALL      CHKEXP00      * Checks mandatory fields
          BRANCH    EXIT,OPREXP99
.
          PACK      KEY6,OPREX001,SP70
          CALL      RDOPEXP1
          COMPARE   ZERO,OVRCD
          GOTO      OPREXP92 IF EQUAL
.
          CALL      EXPSAV00      * Moves input variables to file variables
          PACK      KEY6,OPREX001,SP70
          CALL      WROPEXP1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPREXP99
.
.         ************ UPDATE FORMACTION **********
.
OPREXP20  PACK      KEY6,OPREX001,SP70
          CALL      RDOPEXP1
          BRANCH    OVRCD,OPREXP91
          CALL      CHKEXP00      * Checks mandatory fields
          BRANCH    EXIT,OPREXP99
.
          CALL      EXPSAV00      * Moves input variables to file variables
          PACK      KEY6,OPREX001,SP70
          CALL      UPOPEXP1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPREXP99
.
.         ************ DELETE FORMACTION **********
.
OPREXP30  PACK      KEY6,OPREX001,SP70
          CALL      RDOPEXP1
          BRANCH    OVRCD,OPREXP91
          CALL      DEOPEXP1
.
          MOVE      ZERO,EXIT
          GOTO      OPREXP99
.
.         ************ DISPLAY FORMACTION **********
.
OPREXP40  PACK      KEY6,OPREX001,SP70    * Operating Rooms Expensive Item File
          CALL      RDOPEXP1
          IF        OVRCD=1
            CALL      CLREXP00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Operating Rooms - Expensive Item Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPREXP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPREXP99
.
OPREXP91  MOVE      "Expensive Item record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPREXP99
.
OPREXP92  MOVE      "Expensive Item record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPREXP99
.
OPREXP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPREXP99
.
OPREXP99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLREXP00  MOVE      SP70,OPEXCODE  * Expensive Item Code
          MOVE      SP70,OPEXDESC  * Description     
          MOVE      SP70,OPEXRUS   * RUS Equivalent Code
          MOVE      SP70,OPEXMCHG  * Miscellaneous
          MOVE      ZERO,OPEXACTV  * Active/Inactive
          MOVE      SP70,OPEXSPAR  * Spare variable
.
CLREXP99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
EXPSAV00  MOVE      OPREX001,OPEXCODE  * Expensive Item Code
          MOVE      OPREX002,OPEXDESC  * Description     
          MOVE      OPREX003,OPEXRUS   * RUS Equivalent Code
          MOVE      OPREX004,OPEXMCHG  * Miscellaneous
          MOVE      OPREX005,OPEXACTV  * Active/Inactive  
          MOVE      SP7,OPEXSICD       * IBA Supply & Inventory Code
          MOVE      SP70,OPEXSPAR      * Spare variable
.
EXPSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKEXP00  RESET     OPREX001  
          MATCH     SP70,OPREX001
          GOTO      CHKEXP90 IF EQUAL
.
          RESET     OPREX002
          MATCH     SP70,OPREX002
          GOTO      CHKEXP91 IF EQUAL
.
          GOTO      CHKEXP98
.
CHKEXP90  MOVE      "Expensive Item Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKEXP99
.
CHKEXP91  MOVE      "Expensive Item Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKEXP99
.
CHKEXP98  MOVE      ZERO,EXIT
CHKEXP99  RETURN
.---------------------------------------------------------------------------
. Operating Room Unavailable Theatre Maintenance: Display,Add,Update,Delete
.---------------------------------------------------------------------------
OPRUAV00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRUAV40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRUAV10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRUAV20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRUAV30 IF EQUAL
.
          GOTO      OPRUAV93
.
.         ************ ADD FORMACTION ***********
.
OPRUAV10  CALL      CHKUAV00      * Checks mandatory fields
          BRANCH    EXIT,OPRUAV99
.
          CALL      UAVTME00      * Check Unavailable Theatre Times
          BRANCH    EXIT,OPRUAV99
.
          PACK      KEY19,OPRUA001,OPRUA002,OPRUA003,SP70
          CALL      RDOPUAV1
          COMPARE   ZERO,OVRCD
          GOTO      OPRUAV92 IF EQUAL
.
          CALL      UAVSAV00      * Moves input variables to file variables
          PACK      KEY19,OPRUA001,OPRUA002,OPRUA003,SP70
          CALL      WROPUAV1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRUAV99
.
.         ************ UPDATE FORMACTION **********
.
OPRUAV20  PACK      KEY19,OPRUA001,OPRUA002,OPRUA003,SP70
          CALL      RDOPUAV1
          BRANCH    OVRCD,OPRUAV91
          CALL      CHKUAV00      * Checks mandatory fields
          BRANCH    EXIT,OPRUAV99
.
          CALL      UAVTME00      * Check Unavailable Theatre Times
          BRANCH    EXIT,OPRUAV99
.
          CALL      UAVSAV00      * Moves input variables to file variables
          PACK      KEY19,OPRUA001,OPRUA002,OPRUA003,SP70
          CALL      UPOPUAV1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRUAV99
.
.         ************ DELETE FORMACTION **********
.
OPRUAV30  PACK      KEY19,OPRUA001,OPRUA002,OPRUA003,SP70 
          CALL      RDOPUAV1
          BRANCH    OVRCD,OPRUAV91
          CALL      DEOPUAV1
.
          MOVE      ZERO,EXIT
          GOTO      OPRUAV99
.
.         ************ DISPLAY FORMACTION **********
.
OPRUAV40  PACK      KEY6,OPRUA001,SP70    * Operating Rooms Code File
          CALL      RDOPOPR1
          BRANCH    OVRCD,OPRUAV94
.
          PACK      KEY19,OPRUA001,OPRUA002,OPRUA003,SP70 
          CALL      RDOPUAV1
          IF        OVRCD=1
            CALL      CLRUAV00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Operating Rooms - Unavailable Theatre Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRUAV99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRUAV99
.
OPRUAV91  MOVE      "Unavailable Theatre record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRUAV99
.
OPRUAV92  MOVE      "Unavailable Theatre record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRUAV99
.
OPRUAV93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRUAV99
.
OPRUAV94  MOVE      "Invalid Theatre Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRUAV99
.
OPRUAV99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRUAV00  MOVE      SP70,OPUATHET  * Theatre Code       
          MOVE      SP70,OPUADATE  * Date Unavailable
          MOVE      SP70,OPUASTIM  * Time Unavalable From Start
          MOVE      SP70,OPUAETIM  * Time Unavailable To End
          MOVE      SP70,OPAUSPAR  * Spare variable
.
CLRUAV99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
UAVSAV00  MOVE      OPRUA001,OPUATHET  * Theatre Code       
          MOVE      OPRUA002,OPUADATE  * Date Unavailable
          MOVE      OPRUA003,OPUASTIM  * Time Unavalable From Start
          MOVE      OPRUA004,OPUAETIM  * Time Unavailable To End
          MOVE      SP70,OPAUSPAR      * Spare variable
.
UAVSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKUAV00  RESET     OPRUA002  
          MATCH     SP70,OPRUA002
          GOTO      CHKUAV90 IF EQUAL
.
          RESET     OPRUA003
          MATCH     SP70,OPRUA003
          GOTO      CHKUAV91 IF EQUAL
.
          RESET     OPRUA004
          MATCH     SP70,OPRUA004
          GOTO      CHKUAV92 IF EQUAL
.
          GOTO      CHKUAV98
.
CHKUAV90  MOVE      "Date Unavailable is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKUAV99
.
CHKUAV91  MOVE      "From Time is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKUAV99
.
CHKUAV92  MOVE      "End Time is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKUAV99
.
CHKUAV98  MOVE      ZERO,EXIT
CHKUAV99  RETURN
.--------------------------------------------------------------------
.                         UAVTME00
.     Make Sure End Time > Start time 
.                                                called by: OPRUAV00
.--------------------------------------------------------------------
UAVTME00  UNPACK    OPRUA003,KEY2,KEY1,MIN   * Start Time (HH:MM)
          PACK      KEY4,KEY2,MIN
          MOVE      KEY4,STARTIME            * Change to a form (HHMM for loop)
.
          UNPACK    OPRUA004,KEY2,KEY1,MIN   * End Time (HH:MM)
          PACK      KEY4,KEY2,MIN
          MOVE      KEY4,ENDTIME             * Change to a form (HHMM for loop)
.
          IF        ENDTIME < STARTIME
            GOTO      UAVTME90
          ENDIF
.
          GOTO      UAVTME98
.
UAVTME90  MOVE      "End Time must be > Start Time!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UAVTME99
.
UAVTME98  MOVE      ZERO,EXIT
UAVTME99  RETURN
+
.------------------------------------------------------------
. Operating Room Equipment File: Display,Add,Update,Delete
.------------------------------------------------------------
OPREQP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPREQP40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPREQP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPREQP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPREQP30 IF EQUAL
.
          GOTO      OPREQP93
.
.         ************ ADD FORMACTION ***********
.
OPREQP10  IF        IBCNMHOS = 0
            MOVE      SP70,HOSPCODE
          ENDIF
.
          PACK      KEY18,OPEQP001,HOSPCODE,SP70
          CALL      RDOPEQP1
          COMPARE   ZERO,OVRCD
          GOTO      OPREQP92 IF EQUAL
.
          CALL      MVOPEQ00           * Moves input variables to file variables
          MOVE      OPEQUSLO,OPEQCULO  * set Current location/tray
          MOVE      HOSPCODE,OPEQHOSP
          PACK      KEY18,OPEQP001,HOSPCODE,SP70
          CALL      WROPEQP1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPREQP99
.
.         ************ UPDATE FORMACTION **********
.
OPREQP20  IF        IBCNMHOS = 1
            MOVE      UPDTHOSP,HOSPCODE
            MATCH     CURRHOSP,HOSPCODE
            IF        !@EQUAL
              PACK      KEY18,OPEQP001,HOSPCODE,SP70
              CALL      RDOPEQP1
              COMPARE   ZERO,OVRCD
              GOTO      OPREQP92 IF EQUAL
            ENDIF
          ELSE
            MOVE      SP70,HOSPCODE
          ENDIF
.
          PACK      KEY18,OPEQP001,CURRHOSP,SP70
          CALL      RDOPEQP1
          BRANCH    OVRCD,OPREQP91
.
          MATCH     OPEQSTAT,OPEQP006
          IF        !@EQUAL
            PACK      KEY8,CCC,CYY,CMM,CDD
            REP       " 0",KEY8
            MOVE      KEY8,OPEQP007       * Status has changed
          ENDIF
.
          CALL      MVOPEQ00      * Moves input variables to file variables
          MOVE      HOSPCODE,OPEQHOSP
          PACK      KEY18,OPEQP001,HOSPCODE,SP70
          CALL      UPOPEQP1      * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      OPREQP99
.
.         ************ DELETE FORMACTION **********
.
OPREQP30  PACK      KEY18,OPEQP001,CURRHOSP,SP70
          CALL      RDOPEQP1
          BRANCH    OVRCD,OPREQP91
.
          CALL      DEOPEQP1
.
          MOVE      ZERO,EXIT
          GOTO      OPREQP99
.
.         ************ DISPLAY FORMACTION **********
.
OPREQP40  PACK      KEY18,OPEQP001,HOSPCODE,SP70    * Operating Rooms Equip
          CALL      RDOPEQP1
          IF        OVRCD=1
            CALL      CLREQP00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Operating Rooms - Equipment File Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPREQP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPREQP99
.
OPREQP91  MOVE      "Equipment record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPREQP99
.
OPREQP92  MOVE      "Equipment record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPREQP99
.
OPREQP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPREQP99
.
OPREQP99  RETURN
+
.-------------------------------------------------------------------------------
. Process Fields called from WEBBOD00 
.-------------------------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110,PROFL120,PROFL130,PROFL140,PROFL150:
                             PROFL160,PROFL170
          GOTO      PROFLD99
.
.      Operating Room
.
PROFLD10  CALL      OPRP0000       * Operating Room
          GOTO      PROFLD99
.
.      Operating Room Available Times
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22
          GOTO      PROFLD99
.
PROFLD21  CALL      OPRP0000       * Operating Room 
          GOTO      PROFLD99
.
PROFLD22  CALL      OPRA0000       * Operating Room Available Times
          GOTO      PROFLD99
.
.      Operating Room Nurses Maintenance 
.
PROFLD30  CALL      OPRN0000       * Operating Room Nurses
          GOTO      PROFLD99
.
.      Operating Room Item Maitenance  
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41,PROFLD42
.
PROFLD41  CALL      OPRI0000       * Item Miscellaneous Item tags 
          GOTO      PROFLD99
.
PROFLD42  CALL      OPIT0000       * Operating Room Item Maintenance 
          GOTO      PROFLD99
.
.      Operating Room Tray Maitenance  
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51
          GOTO      PROFLD99
.
PROFLD51  CALL      OPRR0000       * Operating Room Tray Maintenance 
          GOTO      PROFLD99
.
.      Operating Room Tray Details 
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62
          GOTO      PROFLD99
.
PROFLD61  CALL      OPRR0000       * Operating Room Tray Maintenance 
          GOTO      PROFLD99
.
PROFLD62  CALL      OPRB0000       * Operating Room Tray Details
          GOTO      PROFLD99
.
.      Operating Room Clinic/Session Maintenance
.
PROFLD70  CALL      OPRC0000       * Operating Room Clinic/Session Maintenance 
          GOTO      PROFLD99
.
.      Operating Room Expensive Item Maintenance
.
PROFLD80  CALL      OPRE0000       * Operating Room Expensive Item Maintenance 
          GOTO      PROFLD99
.
.      Operating Room Unavailable Theatre Maintenance
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91,PROFLD92
          GOTO      PROFLD99
.
PROFLD91  CALL      OPRP0000       * Operating Room 
          GOTO      PROFLD99
.
PROFLD92  CALL      OPRU0000       * Operating Room Unavailable Theatre Maint- 
          GOTO      PROFLD99
.
PROFL100  BRANCH    FLDSETNO,PROFL101,PROFL102
          GOTO      PROFLD99
.
PROFL101  CALL      DOCF0000       * Doctor Details
          GOTO      PROFLD99
.
PROFL102  CALL      PRAF0000       * Preference Header Details
          GOTO      PROFLD99
.
PROFL110  BRANCH    FLDSETNO,PROFL111,PROFL112,PROFL113
          GOTO      PROFLD99
.
PROFL111  CALL      DOCF0000       * Doctor Details
          GOTO      PROFLD99
.
PROFL112  CALL      PRAF0000       * Preference Header Details
          GOTO      PROFLD99
.
PROFL113  CALL      PRBF0000       * Preference Details
          GOTO      PROFLD99
.
PROFL120  CALL      SNUR0000       * Nurse Search
          GOTO      PROFLD99
.
PROFL130  BRANCH    FLDSETNO,PROFL131
          GOTO      PROFLD99
.
PROFL131  CALL      OPTP0000       * Specialty Tray Preference 
          GOTO      PROFLD99
.
PROFL140  BRANCH    FLDSETNO,PROFL141,PROFL142
.
PROFL141  CALL      OPEQ0000       * Operating Room Equipment Maintenance
          GOTO      PROFLD99
.
PROFL142  CALL      EMSC0000       * Equipment Miscellaneous Item tags
          GOTO      PROFLD99
.
PROFL150  BRANCH    FLDSETNO,PROFL151,PROFL152
.
PROFL151  CALL      OPAV0000       * Operation Average Maintenance
          GOTO      PROFLD99
.
PROFL152  CALL      OPMI0000       * Operation Average Miscellaneous Tags
          GOTO      PROFLD99
.
PROFL160  BRANCH    FLDSETNO,PROFL161,PROFL162,PROFL163,PROFL164
          GOTO      PROFLD99
.
PROFL161  CALL      DOCF0000       * Doctor Details
          GOTO      PROFLD99
.
PROFL162  CALL      OPPC0000       * Preference Comments Tags
          GOTO      PROFLD99
.
PROFL163  CALL      PRCF0000
          GOTO      PROFLD99
.
PROFL164  CALL      PRAF0000
          GOTO      PROFLD99
.
PROFL170  BRANCH    FLDSETNO,PROFL171,PROFL172
          GOTO      PROFLD99
.
PROFL171  CALL      OPWC0000           * week cycle number tags
          GOTO      PROFLD99
.
PROFL172  CALL      GTAG0000           * Misc general tags
          GOTO      PROFLD99
.
PROFLD99  RETURN
+
.-----------------------------------------------------------
. Operation Average Maintenace - Tags
.-----------------------------------------------------------
OPAV0000  PACK      OPAVE001,OPAVE001,SP70
          PACK      OPAVE002,OPAVE002,SP70
.
          BRANCH    FLDITMNO,OPAV0001,OPAV0002,OPAV0003,OPAV0004,OPAV0005
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      OPAV9999
.
OPAV0001  PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      RDOPAVE2
          BRANCH    OVRCD,OPAV9100
.
          WRITE     HTMLFILE;OPAVE001;            * Doctor Code
          GOTO      OPAV9999
.
OPAV0002  PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      RDOPAVE2
          BRANCH    OVRCD,OPAV9100
.
          WRITE     HTMLFILE;OPAVE002;            * MBS Code
          GOTO      OPAV9999
.
OPAV0003  PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      RDOPAVE2
          BRANCH    OVRCD,OPAV9100
.
          MOVE      OPAVAVER,XOPRAVEG
          SQUEEZE   XOPRAVEG
          LJUSTIFY  XOPRAVEG
          WRITE     HTMLFILE;XOPRAVEG;
          GOTO      OPAV9999
.
OPAV0004  PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      RDOPAVE2
          BRANCH    OVRCD,OPAV9100
.
          MOVE      "Unknown Doctor",PACFNAME
          PACK      KEY6,OPAVE001,SP70
          CALL      RDDOCT1
          BRANCH    OVRCD,OPAV9100
.
          MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,PACGNAME
          MOVE      DTITL,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME
          WRITE     HTMLFILE;PACFNAME;
          GOTO      OPAV9999
.
OPAV0005  PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      RDOPAVE2
          BRANCH    OVRCD,OPAV9100
.
          MOVE      "Unknown Operation",XOPRDESC
          PACK      KEY17,OPAVE002,SP70
          CALL      PATITMRD
          IF        OVRCD=0
            MOVE      IDESC,XOPRDESC
          ENDIF
          WRITE     HTMLFILE;XOPRDESC;
          GOTO      OPAV9999
.
OPAV9100  WRITE     HTMLFILE;"";
.
OPAV9999  RETURN
+
.-----------------------------------------------------------
. Operation Average Maintenace - Misc tags
.-----------------------------------------------------------
OPMI0000  BRANCH    FLDITMNO,OPMI0001,OPMI0002,OPMI0003,OPMI0004,OPMI0005
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      OPMI9999
.
OPMI0001  WRITE     HTMLFILE;STARTKEY;
          GOTO      OPMI9999
.
OPMI0002  WRITE     HTMLFILE;OPRNCODE;
          GOTO      OPMI9999
.
OPMI0003  CALL      OPTABL00
          GOTO      OPMI9999
.
OPMI0004  CALL      OPPREV00
          GOTO      OPMI9999
.
OPMI0005  CALL      OPNEXT00
          GOTO      OPMI9999
.
OPMI9999  RETURN
+
.------------------------------------------------------------
. Table of Operation Averages
.------------------------------------------------------------
OPTABL00  IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      XOPRDOCT,STARTKEY,SP70
          PACK      XOPRCODE,OPRNCODE,SP70
.
          MATCH     XOPRCODE,SP70
          GOTO      OPTABL05 IF EQUAL
.
          PACK      KEY15,XOPRDOCT,XOPRCODE,SP70
          CALL      RDOPAVE2
          BRANCH    OVRCD,OPTABL05
.
          CALL      RPOPAVE2
          GOTO      OPTABL10
.
OPTABL05  PACK      KEY15,STARTKEY,SP70
          CALL      RSOPAVE2            * Position on Startkey
          CALL      RPOPAVE2            * Read one back from position        
.
OPTABL10  CALL      RKOPAVE2            * Read on first Startkey found
          BRANCH    OVRCD,OPTABL90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      OPTABL10
          ENDIF
.
          CALL      OPDROW00            * Output table row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      OPTABL10 IF NOT EQUAL
.
          GOTO      OPTABL99
.
OPTABL90  CALL      NOMORE00     * Dipslay No More Records Message
.
OPTABL99  RETURN
+
.------------------------------------------------------------
. Draw Operation Average Maintenance table row
.------------------------------------------------------------
OPDROW00  MOVE      "&nbsp;",XOPRCODE
          MATCH     SP9,OPAVCODE
          IF        !@EQUAL
            MOVE      OPAVCODE,XOPRCODE
          ENDIF
.
          MOVE      "Unknown Operation",XOPRDESC
          PACK      KEY17,OPAVCODE,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,OPDROW01
.
          MOVE      IDESC,XOPRDESC
.
OPDROW01  MOVE      "Unknown Doctor",PACFNAME
          PACK      KEY6,OPAVDOCT,SP70
          CALL      RDDOCT1
          IF        OVRCD = 0
            MOVE      DSNAME,PACSNAME
            MOVE      DGNAME,PACGNAME
            MOVE      DTITL,PACTITLE
            MOVE      TWO,PACFRMT
            CALL      PACNAME
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<img src=../images/MaintenanceIcon.gif ":
                             "class=ListIcon ":
                             "onclick=#"EditOprAvg('",OPAVDOCT,"','":
                               OPAVCODE,"');#"> ":
                             OPAVDOCT,"</td>":
                             "<td align=center nowrap>",PACFNAME,"</td>":
                             "<td align=center>",XOPRCODE,"</td>":
                             "<td align=center>",XOPRDESC,"</td>":
                             "<td align=center>",OPAVAVER,"</td>":
                             "</tr>"
          GOTO      OPDROW99
.
OPDROW99  RETURN
+
.------------------------------------------------------------
. Link for Previous button (Operation Average)
.------------------------------------------------------------
OPPREV00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"oprweb04.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&opercode=",OPRNCODE;
.
OPPREV99  RETURN
+
.------------------------------------------------------------
. Link for Next button (Operation Average)
.------------------------------------------------------------
OPNEXT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"oprweb04.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&opercode=",OPRNCODE;
.
OPNEXT99  RETURN
+
.------------------------------------------------------------
. Operation Average Maintenance: Add, Update, Delete, Display
.------------------------------------------------------------
OPRAVE00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRAVE40 IF EQUAL
.
          MATCH     "A",UPDTTYPE        * Add formaction
          GOTO      OPRAVE10 IF EQUAL
.
          MATCH     "U",UPDTTYPE        * Update formaction
          GOTO      OPRAVE20 IF EQUAL
.
          MATCH     "D",UPDTTYPE        * Delete formaction
          GOTO      OPRAVE30 IF EQUAL
.
          GOTO      OPRAVE93
.
.         ************ ADD FORMACTION ***********
.
OPRAVE10  CALL      CHKOPA00            * Checks mandatory fields
          BRANCH    EXIT,OPRAVE99
          PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      RDOPAVE2
          COMPARE   ZERO,OVRCD
          GOTO      OPRAVE92 IF EQUAL
.
          CALL      OPASAV00           * Move input variables to file variables
          PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      WROPAVE2            * Writes away the data
.
          MOVE      "A",KEY1            * Set Add Parameter for OPRAUD00    
          CALL      OPRAUD00            * Write Audit File if Needed    
.
          MOVE      ZERO,EXIT
          GOTO      OPRAVE99
.
.         ************ UPDATE FORMACTION **********
.
OPRAVE20  PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      RDOPAVE2
          BRANCH    OVRCD,OPRAVE91
          CALL      CHKOPA00            * Checks mandatory fields
          BRANCH    EXIT,OPRAVE99
.
          CALL      OPASAV00           * Move input variables to file variables
          PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      UPOPAVE2            * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRAVE99
.
.         ************ DELETE FORMACTION **********
.
OPRAVE30  PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      RDOPAVE2
          BRANCH    OVRCD,OPRAVE91
          CALL      DEOPAVE2
.
          MOVE      ZERO,EXIT
          GOTO      OPRAVE99
.
.         ************ DISPLAY FORMACTION **********
.
OPRAVE40  PACK      KEY15,OPAVE001,OPAVE002,SP70
          CALL      RDOPAVE2
          IF        OVRCD=1
            CALL      CLROPA00          * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Operation Average Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRAVE99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRAVE99
.
OPRAVE91  MOVE      "Operation Average record does not exist!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRAVE99
.
OPRAVE92  MOVE      "Operation Average record already exists!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRAVE99
.
OPRAVE93  MOVE      "Invalid Form Action!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRAVE99
.
OPRAVE99  RETURN
+
.------------------------------------------------------------
.  Checks Operation Average mandatory fields
.------------------------------------------------------------
CHKOPA00  RESET     OPAVE001
.         MATCH     SP70,OPAVE001
.         GOTO      CHKOPA90 IF EQUAL
.
          RESET     OPAVE002
          MATCH     SP70,OPAVE002
          GOTO      CHKOPA91 IF EQUAL
.
          GOTO      CHKOPA98
.
CHKOPA90  MOVE      "Doctor Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPA99
.
CHKOPA91  MOVE      "MBS Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPA99
.
CHKOPA98  MOVE      ZERO,EXIT
CHKOPA99  RETURN
+
.-------------------------------------------------------------------------------
.   Set Parameters for Operation Average file
.-------------------------------------------------------------------------------
SPOPA000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPOPA001,SPOPA002,SPOPA003
          GOTO      SPOPA999
.
SPOPA001  MOVE      QRYDATA,OPAVE001
          PACK      OPAVE001,OPAVE001,SP70
          GOTO      SPOPA999
.
SPOPA002  MOVE      QRYDATA,OPAVE002
          PACK      OPAVE002,OPAVE002,SP70
          GOTO      SPOPA999
.
SPOPA003  MOVE      QRYDATA,OPAVE003
          GOTO      SPOPA999
.
SPOPA999  RETURN
+
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
OPASAV00  MOVE      OPAVE001,OPAVDOCT   * Doctor Code
          MOVE      OPAVE002,OPAVCODE   * Operation Code
          MOVE      OPAVE003,OPAVAVER   * Operation Average
.
OPASAV99  RETURN
+
.-------------------------------------------------------------------------------
. Clear File Variables
.-------------------------------------------------------------------------------
CLROPA00  MOVE      SP70,OPAVDOCT
          MOVE      SP70,OPAVCODE
          MOVE      ZERO,OPAVAVER
          MOVE      SP70,OPAVSPAR
.
CLROPA99  RETURN
+
.-----------------------------------------------------------
. Operating Room - Equipment Misc Tags
.-----------------------------------------------------------
EMSC0000  BRANCH    FLDITMNO,EMSC0100,EMSC0200,EMSC0300,EMSC0400,EMSC0500:
                             EMSC0600,EMSC0700
.
          WRITE     HTMLFILE;"Invalid Tag";
.
EMSC0100  WRITE     HTMLFILE;STARTKEY;
          GOTO      EMSC9999
.
EMSC0200  MOVE      ZERO,LNK2PRT
          CALL      TBEQP000
          GOTO      EMSC9999
.
EMSC0300  CALL      PREVPR00
          GOTO      EMSC9999
.
EMSC0400  CALL      NEXTPR00
          GOTO      EMSC9999
.
EMSC0500  MOVE      ONE,LNK2PRT
          CALL      TBEQS000
          GOTO      EMSC9999
.
EMSC0600  CALL      PREVSR00
          GOTO      EMSC9999
.
EMSC0700  CALL      NEXTSR00
          GOTO      EMSC9999
.
EMSC9999  RETURN
+
.------------------------------------------------------------
. Table of Operating Rooms - Equipment Codes
.------------------------------------------------------------
TBEQP000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          UNPACK    DIM127,D1,SHOWALL,DIM127
.
          CALL      EQHED000      * Output Table Heading
.
          IF        NORECORD=0
           MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button
.
.          IF        PRVIFLAG = 1
.            MATCH     SP70,PREVIKEY
.            IF        !@EQUAL
.              CALL      GPREQP00            * Get previous records key
.              MOVE      ZERO,STARTNUM       * Reset counters to zero
.              MOVE      ZERO,RECNUMB
.              MOVE      ZERO,DISNUMB
.              PACK      PREVIKEY,STARTKEY,SP70
.              GOTO      TBEQP050
.            ENDIF
.            PACK      KEY18,STARTKEY,SP70   * Go back to start if at
.            MOVE      ZERO,STARTNUM         * the end of the list
.            MOVE      ZERO,RECNUMB
.            MOVE      ZERO,DISNUMB
.            GOTO      TBEQP050
.          ENDIF
.
.         * Next button
.
.          MATCH     SP70,NEXTIKEY
.          IF        !@EQUAL
.            CALL      GNXEQP00              * Check to see if at the last rec
.            PACK      KEY18,NEXTIKEY,SP70
.            MOVE      ZERO,STARTNUM         * Reset counters
.            MOVE      ZERO,RECNUMB
.            MOVE      ZERO,DISNUMB
.            PACK      NEXTIKEY,STARTKEY,SP70
.            MATCH     KEY18,STARTKEY        * start again
.            GOTO      TBEQP050 IF EQUAL
.            CALL      RDOPEQP1              * skip this record
.            COMPARE   ZERO,OVRCD
.            GOTO      TBEQP100 IF EQUAL
.          ENDIF
.
          PACK      KEY18,STARTKEY,SP70
TBEQP050  CALL      RDOPEQP1
          COMPARE   ZERO,OVRCD
          GOTO      TBEQP150 IF EQUAL
.
          CALL      RSOPEQP1
TBEQP100  CALL      RKOPEQP1
          BRANCH    OVRCD,TBEQP900
.
TBEQP150  MATCH     "1",SHOWALL           * Show active and inactive?
          IF        !@EQUAL
            MATCH     "1",OPEQACTV        * Hide inactive equipment
            GOTO      TBEQP100 IF EQUAL
          ENDIF
.
          PACK      NEXTIKEY,OPEQCODE,OPEQHOSP,SP70
          MATCH     SP70,PREVIKEY
          IF        @EQUAL
            PACK      PREVIKEY,OPEQCODE,OPEQHOSP,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TBEQP100
          ENDIF
.
          CALL      EQROW000      * Equipment Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TBEQP100 IF NOT EQUAL
          GOTO      TBEQP999
.
TBEQP900  CALL      NOMORE00      * Display No More Records Message
.
TBEQP999  RETURN
+
.------------------------------------------------------------
. Table of Operating Rooms - Equipment Codes for search
.------------------------------------------------------------
TBEQS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          UNPACK    DIM127,D1,SHOWALL,DIM127
.
          WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Equipment Code</td>":
                             "<td class=HeadingCell width=35%>":
                             "Description</td>":
                             "<td class=HeadingCell width=20%>":
                             "Equipment Type</td>":
                             "<td class=HeadingCell width=20%>":
                             "Current Status</td>":
                             "<td class=HeadingCell width=10%>":
                             "Active</td>":
                           "</tr>"
.
TBEQS020  IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button
.
.          IF        PRVIFLAG = 1
.            MATCH     SP70,PREVIKEY
.            IF        !@EQUAL
.              CALL      GPREQP00            * Get previous records key
.              MOVE      ZERO,STARTNUM       * Reset counters to zero
.              MOVE      ZERO,RECNUMB
.              MOVE      ZERO,DISNUMB
.              PACK      PREVIKEY,STARTKEY,SP70
.              GOTO      TBEQS050
.            ENDIF
.            PACK      KEY18,STARTKEY,SP70   * Go back to start if at
.            MOVE      ZERO,STARTNUM         * the end of the list
.            MOVE      ZERO,RECNUMB
.            MOVE      ZERO,DISNUMB
.            GOTO      TBEQS050
.          ENDIF
.
.         * Next button
.
.          MATCH     SP70,NEXTIKEY
.          IF        !@EQUAL
.            CALL      GNXEQP00              * Check to see if at the last rec
.            PACK      KEY18,NEXTIKEY,SP70
.            MOVE      ZERO,STARTNUM         * Reset counters
.            MOVE      ZERO,RECNUMB
.            MOVE      ZERO,DISNUMB
.            PACK      NEXTIKEY,STARTKEY,SP70
.            MATCH     KEY18,STARTKEY        * start again
.            GOTO      TBEQS050 IF EQUAL
.            CALL      RDOPEQP1              * skip this record
.            COMPARE   ZERO,OVRCD
.            GOTO      TBEQS100 IF EQUAL
.          ENDIF
.
          PACK      KEY18,STARTKEY,SP70
TBEQS050  CALL      RDOPEQP1
          COMPARE   ZERO,OVRCD
          GOTO      TBEQS150 IF EQUAL
.
          CALL      RSOPEQP1
TBEQS100  CALL      RKOPEQP1
          BRANCH    OVRCD,TBEQS900
.
TBEQS150  MATCH     "1",SHOWALL           * Show active and inactive?
          IF        !@EQUAL
            MATCH     "1",OPEQACTV        * Hide inactive equipment
            GOTO      TBEQS100 IF EQUAL
          ENDIF
.
          MATCH     HOSPCODE,OPEQHOSP
          IF        !@EQUAL
            GOTO      TBEQS100
          ENDIF
.
          PACK      NEXTIKEY,OPEQCODE,OPEQHOSP,SP70
          MATCH     SP70,PREVIKEY
          IF        @EQUAL
            PACK      PREVIKEY,OPEQCODE,OPEQHOSP,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TBEQS100
          ENDIF
.
          CALL      EQROW000      * Equipment Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TBEQS100 IF NOT EQUAL
          GOTO      TBEQS999
.
TBEQS900  CALL      NOMORE00      * Display No More Records Message
.
TBEQS999  RETURN
+
.--------------------------------------------------------------------------
. GPREQP00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
GPREQP00  PACK      SAVKEY18,STARTKEY,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          PACK      KEY18,PREVIKEY,Z70
          CALL      RDOPEQP1                    * Position for batch #
          COMPARE   ZERO,OVRCD
          GOTO      GPREQP15 IF EQUAL
.
GPREQP10  CALL      RPOPEQP1                    * read next record
          BRANCH    OVRCD,GPREQP91              * end of file
.
GPREQP15  PACK      SAVKEY18,OPEQCODE,OPEQHOSP,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      GPREQP90 IF EQUAL
.
          GOTO      GPREQP10
.
GPREQP90  MOVE      SAVKEY18,KEY18          * New start key for display
          SUB       ONE,NORECORD
          GOTO      GPREQP99
.
GPREQP91  PACK      KEY18,STARTKEY,SP70
          SUB       ONE,NORECORD
          GOTO      GPREQP99
.
GPREQP99  RETURN
+
.------------------------------------------------------------
. GNXEQP00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
GNXEQP00  PACK      KEY18,NEXTIKEY,SP70
          CALL      RSOPEQP1                    * Position for batch #
          CALL      RKOPEQP1                    * read next record
          BRANCH    OVRCD,GNXEQP90               * end of file
.
          GOTO      GNXEQP99
.
GNXEQP90  PACK      NEXTIKEY,STARTKEY,SP70
          GOTO      GNXEQP99                * No more record goto first record
.
GNXEQP99  RETURN
.------------------------------------------------------------
. Item Table Details (TABLE HEADING)
.------------------------------------------------------------
EQHED000  IF        IBCNMHOS = 1
            WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Equipment Code</td>":
                               "<td class=HeadingCell width=30%>":
                               "Description</td>":
                               "<td class=HeadingCell width=15%>":
                               "Equipment Type</td>":
                               "<td class=HeadingCell width=15%>":
                               "Current Status</td>":
                               "<td class=HeadingCell width=10%>":
                               "Active</td>": 
                               "<td class=HeadingCell width=15%>":
                               "Hospital</td>":
                               "</tr>"
          ELSE
            WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Equipment Code</td>":
                               "<td class=HeadingCell width=35%>":
                               "Description</td>":
                               "<td class=HeadingCell width=20%>":
                               "Equipment Type</td>":
                               "<td class=HeadingCell width=20%>":
                               "Current Status</td>":
                               "<td class=HeadingCell width=10%>":
                               "Active</td>":
                             "</tr>"
          ENDIF
.
EQHED999  RETURN
.------------------------------------------------------------
. Item Table (TABLE ROW)
.------------------------------------------------------------
EQROW000  MATCH     SP70,OPEQDESC
          IF        @EQUAL
            MOVE      "&nbsp;",KEY40
          ELSE
            MOVE      OPEQDESC,KEY40
          ENDIF
.
          MOVE      SP70,KEY30
          MATCH     SP70,OPEQTYPE
          IF        !@EQUAL
            PACK      KEY5,ANSO,ANSE,OPEQTYPE
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,KEY30
            ELSE
              MOVE      "Invalid Type",KEY30
            ENDIF
          ENDIF
.
          MOVE      SP70,TDESC
          MATCH     SP70,OPEQSTAT
          IF        !@EQUAL
            PACK      KEY5,ANSE,ANSR,OPEQSTAT
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid Status",TDESC
            ENDIF
          ENDIF
.
          MATCH     "1",OPEQACTV
          IF        @EQUAL
            MOVE      "No ",DIM3
          ELSE
            MOVE      "Yes",DIM3
          ENDIF
.
          MOVE      SP70,HOSPNAME
          MATCH     SP70,OPEQHOSP
          IF        !@EQUAL
            PACK      KEY3,OPEQHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD = 0
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
          ENDIF
.
          BRANCH    LNK2PRT,EQROW100
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail14":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&opeqp001=",OPEQCODE:
                             "&hospcode=",OPEQHOSP,"#")'>":
                             "<img src='../images/MaintenanceIcon.gif'":
                             " class=Icon></a>":
                             OPEQCODE,"</td><td>",KEY40,"</td>":
                             "<td>",KEY30,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",DIM3,"</td>";
.
          IF        IBCNMHOS = 1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"</td>";
          ENDIF
          WRITE     HTMLFILE;"</tr>"
.
          GOTO      EQROW999
.
EQROW100  WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"#" ":
                              "onclick=#"UpdateParent('",OPEQCODE:
                              "','",KEY40,"')#">":
                              "<img src='../images/MaintenanceIcon.gif'":
                              " class=Icon></a>":
                              OPEQCODE,"</td><td>",KEY40,"</td>":
                             "<td>",KEY30,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",DIM3,"</td>";
.
          WRITE     HTMLFILE;"</tr>"
.
EQROW999 RETURN
+
.-----------------------------------------------------------
. Option 1 - Operating Room
.-----------------------------------------------------------
OPRP0000  BRANCH    FLDITMNO,OPRP0100,OPRP0200,OPRP0300,OPRP0400,OPRP0500:
                             OPRP0600,OPRP0700,OPRP0800,OPRP0900,OPRP1000:
                             OPRP1100,OPRP1200,OPRP1300,OPRP1400,OPRP1500:
                             OPRP1600,OPRP1700,OPRP1800,OPRP1900,OPRP2000:
                             OPRP2100,OPRP2200,OPRP2300,OPRP2400,OPRP2500
          GOTO      OPRP9999
.
OPRP0100  WRITE     HTMLFILE;OPRMROOM;  * Operating Room Code
          GOTO      OPRP9999
.
OPRP0200  WRITE     HTMLFILE;OPRMDESC;  * Description
          GOTO      OPRP9999
.
OPRP0300  MATCH     SP70,OPRMLOC
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMLOC;   * Location 
          GOTO      OPRP9999
.
OPRP0400  MATCH     SP70,OPRMUSR1
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMUSR1;  * User Defined 1 (Category Y1) 
          GOTO      OPRP9999
.
OPRP0500  MATCH     SP70,OPRMUSR2
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMUSR2;  * User Defined 2 (Category Y2)
          GOTO      OPRP9999
.
OPRP0600  MATCH     SP70,OPRMUSR3
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMUSR3;  * User Defined 3 (Category Y3)
          GOTO      OPRP9999
.
OPRP0700  MATCH     SP70,OPRMUSR4
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMUSR4;  * User Defined 4 (Category Y4)
          GOTO      OPRP9999
.
OPRP0800  MATCH     SP70,OPRMUSR5
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMUSR5;  * User Defined 4 (Category Y4)
          GOTO      OPRP9999
.
OPRP0900  COMPARE   ZERO,OPRMSTAT
          IF        @EQUAL 
            WRITE     HTMLFILE;OPRMSTAT;  * Status               
          ELSE
            WRITE     HTMLFILE;"1";
          ENDIF
          GOTO      OPRP9999
.
OPRP1000  COMPARE   ZERO,OPRMSUN 
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMSUN;  * Time Available Sunday (mins) 
          GOTO      OPRP9999
.
OPRP1100  COMPARE   ZERO,OPRMMON 
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMMON;  * Time Available Monday (mins) 
          GOTO      OPRP9999
.
OPRP1200  COMPARE   ZERO,OPRMTUE 
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMTUE;  * Time Available Tuesday (mins) 
          GOTO      OPRP9999
.
OPRP1300  COMPARE   ZERO,OPRMWED 
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMWED;  * Time Available Wednesday (mins) 
          GOTO      OPRP9999
.
OPRP1400  COMPARE   ZERO,OPRMTHU 
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMTHU;  * Time Available Thursday (mins) 
          GOTO      OPRP9999
.
OPRP1500  COMPARE   ZERO,OPRMFRI 
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMFRI;  * Time Available Friday (mins) 
          GOTO      OPRP9999
.
OPRP1600  COMPARE   ZERO,OPRMSAT 
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMSAT;  * Time Available Saturday (mins) 
          GOTO      OPRP9999
.
OPRP1700  MATCH     SP70,OPRMGLDG
          GOTO      OPRP9999 IF EQUAL
          WRITE     HTMLFILE;OPRMGLDG;  * GL Code and Cost Centre  
          GOTO      OPRP9999
.
OPRP1800  CALL      OPRTB000     * Table of Operating Rooms
          GOTO      OPRP9999
.
OPRP1900  CALL      NEXTPR00     * Link to Next Set of Codes 
          GOTO      OPRP9999
.
OPRP2000  CALL      PREVPR00     * Link to Prev Set of Codes 
          GOTO      OPRP9999
.
OPRP2100  CALL      LNKSER00     * Link to another program 
          GOTO      OPRP9999
.
OPRP2200  CALL      HOSSEL00     * Operating room hospital
          GOTO      OPRP9999
.
OPRP2300  CALL      RESLOC00     * Theatre Location Resource
          GOTO      OPRP9999
.
OPRP2400  PACK      KEY14,OPROP001,SP70
          CALL      RSOPORA2
          CALL      RKOPORA2
          BRANCH    OVRCD,OPRP9999
.
          MATCH     OPROP001,OPRAROOM
          GOTO      OPRP9999 IF NOT EQUAL          
.
          WRITE     HTMLFILE;ONE; * to display red for Date Statistics button 
          GOTO      OPRP9999
.
OPRP2500  PACK      KEY19,OPROP001,SP70
          CALL      RSOPUAV1
          CALL      RKOPUAV1
          BRANCH    OVRCD,OPRP9999
.
          MATCH     OPROP001,OPUATHET
          GOTO      OPRP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE; * to display red for Unavail Dates button
          GOTO      OPRP9999
.
OPRP9999  RETURN
+
.
. FHIR Location Resource
.
RESLOC00  STRIP     OPRMDESC
          CLEAR     KEY16
          APPEND    "Theatre-",KEY16
          APPEND    OPRMROOM,KEY16
          APPEND    SP70,KEY16
          RESET     KEY16
          STRIP     KEY16
          STRIP     WBTPFIL  *  Template
          WRITE     HTMLFILE;*+," { #"resourceType#": #"Location#",":
                    "   #"id#": #"",KEY16,"#",":
                    " #"extension#": [":
                    " { #"url#":#"%BASEURL/extension/webPASService#"":
                        " ,#"valueString#":#"",PRGID,SP1,PRGNAM,SP1,VERSION,"#"},":
                    " { #"url#":#"%BASEURL/extension/webPASTemplate#"":
                        " ,#"valueString#":#"%TEMPLATEHOME/",WBTPFIL," %TEMPLATEVERSION#"}":
                    " ],":
                    " #"identifier#": {":
                    "   #"value#": #"",KEY16,"#"":
                    " },";
          WRITE     HTMLFILE;*+," #"name#": #"",OPRMDESC,"#"":
                    " } "
          RETURN
.-----------------------------------------------------------
. Option 2 - Operating Room Available Times
.-----------------------------------------------------------
OPRA0000  BRANCH    FLDITMNO,OPRA0100,OPRA0200,OPRA0300,OPRA0400,OPRA0500:
                             OPRA0600,OPRA0700
          GOTO      OPRA9999
.
OPRA0100  MATCH     SP70,OPRADATE
          GOTO      OPRA9999 IF EQUAL
          UNPACK    OPRADATE,CCENT,CYEAR,CMON,CDAY  * Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11; 
          GOTO      OPRA9999
.
OPRA0200  WRITE     HTMLFILE;OPRAROOM;  * Operating Room
          GOTO      OPRA9999
.
OPRA0300  COMPARE   ZERO,OPRAVAIL
          GOTO      OPRA9999 IF EQUAL
          WRITE     HTMLFILE;OPRAVAIL;  * Time Operating Room Available
          GOTO      OPRA9999
.
OPRA0400  CALL      ORATB000     * Table of Operating Rooms Available Times
          GOTO      OPRA9999
.
OPRA0500  CALL      NEXTPR00     * Link to Next Set of Codes
          GOTO      OPRA9999
.
OPRA0600  CALL      PREVPR00     * Link to Prev Set of Codes
          GOTO      OPRA9999
.
OPRA0700  CALL      LNKSER00     * Link to another program 
          GOTO      OPRA9999
.
OPRA9999  RETURN
.-----------------------------------------------------------
. Option 3 - Operating Room Nurses 
.-----------------------------------------------------------
OPRN0000  BRANCH    FLDITMNO,OPRN0100,OPRN0200,OPRN0300,OPRN0400,OPRN0500:
                             OPRN0600,OPRN0700,OPRN0800,OPRN0900,OPRN1000:
                             OPRN1100,OPRN1200,OPRN1300
          GOTO      OPRN9999
.
OPRN0100  WRITE     HTMLFILE;OPNRCODE;  * Nurse Code  
          GOTO      OPRN9999
.
OPRN0200  WRITE     HTMLFILE;OPNRSNAM;  * Surname    
          GOTO      OPRN9999
.
OPRN0300  MATCH     SP70,OPNRGNAM
          GOTO      OPRN9999 IF EQUAL
          WRITE     HTMLFILE;OPNRGNAM;  * Given Name                    
          GOTO      OPRN9999
.
OPRN0400  MOVE      "Q1",CATEGORY       * User Defined Cat 1
          MOVE      OPNRUSR1,CODE
          CALL      CODITM00  
          GOTO      OPRN9999
.
OPRN0500  MOVE      "Q2",CATEGORY       * User Defined Cat 2
          MOVE      OPNRUSR2,CODE
          CALL      CODITM00  
          GOTO      OPRN9999
.
OPRN0600  MOVE      "Q3",CATEGORY       * User Defined Cat 3
          MOVE      OPNRUSR3,CODE
          CALL      CODITM00  
          GOTO      OPRN9999
.
OPRN0700  MOVE      "Q4",CATEGORY       * User Defined Cat 4
          MOVE      OPNRUSR4,CODE
          CALL      CODITM00  
          GOTO      OPRN9999
.
OPRN0800  MOVE      "Q5",CATEGORY       * User Defined Cat 5
          MOVE      OPNRUSR5,CODE
          CALL      CODITM00  
          GOTO      OPRN9999
.
OPRN0900  COMPARE   ZERO,OPNRSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;OPNRSTAT;  * Status
          ELSE
            WRITE     HTMLFILE;"1";
          ENDIF        
          GOTO      OPRN9999
.
OPRN1000  CALL      ORNTB000     * Table of Operating Rooms Nurses 
          GOTO      OPRN9999
.
OPRN1100  CALL      NEXTPR00     * Link to Next Set of Codes
          GOTO      OPRN9999
.
OPRN1200  CALL      PREVPR00     * Link to Prev Set of Codes
          GOTO      OPRN9999
.
OPRN1300  CALL      LNKSER00     * Link to another program 
          GOTO      OPRN9999
.
OPRN9999  RETURN
.-----------------------------------------------------------
. Option 4 - Operating Room Item File
.-----------------------------------------------------------
OPRI0000  BRANCH    FLDITMNO,OPRI0100,OPRI0200,OPRI0300,OPRI0400,OPRI0500:
                             OPRI0600,OPRI0700,OPRI0800,OPRI0900,OPRI1000
          GOTO      OPRI9999
.
OPRI0100  WRITE     HTMLFILE;STARTKEY;   
          GOTO      OPRI9999
.
OPRI0200  * Not Used          
          GOTO      OPRI9999
.
OPRI0300  * Not Used                       
          GOTO      OPRI9999
.
OPRI0400  * Not Used
          GOTO      OPRI9999
.
OPRI0500  MOVE      ZERO,LNK2PRT * Display with Link
          CALL      ORITB000     * Table of Operating Rooms Items 
          GOTO      OPRI9999
.
OPRI0600  CALL      NEXTPR00     * Link to Next Set of Codes
          GOTO      OPRI9999
.
OPRI0700  CALL      PREVPR00     * Link to Prev Set of Codes
          GOTO      OPRI9999
.
OPRI0800  CALL      LNKSER00     * Link to another program 
          GOTO      OPRI9999
.
OPRI0900  MOVE      ONE,LNK2PRT  * Display with Link with UpdateParent
          CALL      ORITB000     * Table of Operating Rooms Items 
          GOTO      OPRI9999
.
OPRI1000  CALL      SRITB000     * Search of Operating Rooms Items 
          GOTO      OPRI9999
.
OPRI9999  RETURN
.-----------------------------------------------------------
. Option 5 - Operating Room Tray Maintenance
.-----------------------------------------------------------
OPRR0000  BRANCH    FLDITMNO,OPRR0100,OPRR0200,OPRR0300,OPRR0400,OPRR0500:
                             OPRR0600,OPRR0700,OPRR0800,OPRR0900,OPRR1000: 
                             OPRR1100,OPRR1200,OPRR1300,OPRR1400
          GOTO      OPRR9999
.
OPRR0100  WRITE     HTMLFILE;OPTHCODE;  * Tray Code  
          GOTO      OPRR9999
.
OPRR0200  WRITE     HTMLFILE;OPTHDESC;  * Tray Description
          GOTO      OPRR9999
.
OPRR0300  MOVE      ZERO,LNK2PRT * Maintenance List                   
          CALL      ORITR000     * Table of Operating Rooms Tray Codes 
          GOTO      OPRR9999
.
OPRR0400  CALL      NEXTPR00     * Link to Next Set of Codes
          GOTO      OPRR9999
.
OPRR0500  CALL      PREVPR00     * Link to Prev Set of Codes
          GOTO      OPRR9999
.
OPRR0600  MOVE      ONE,LNK2PRT * Search List with updateParent
          CALL      ORITS000     * Table of Operating Rooms Tray Codes 
          GOTO      OPRR9999
.
OPRR0700  WRITE     HTMLFILE;STARTKEY;
          GOTO      OPRR9999
.
OPRR0800  WRITE     HTMLFILE;NORECORD;
          GOTO      OPRR9999
.
OPRR0900  PACK      KEY33,OPRTR001,SP70
          CALL      RSOPTRB1
OPRR0920  CALL      RKOPTRB1
          BRANCH    OVRCD,OPRR9999
.
          MATCH     OPRTR001,OPTDCODE
          GOTO      OPRR9999 IF NOT EQUAL
.
          MATCH     OPTHHOSP,OPTDHOSP
          GOTO      OPRR0920 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;  * to display red for Tray Contents button
          GOTO      OPRR9999
.
OPRR1000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OPRR1010,OPRR1020
.
          MATCH     SP70,OPTHHOSP
          GOTO      OPRR9999 IF EQUAL
.
          PACK      KEY3,OPTHHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,OPRR1010
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      OPRR9999
.
OPRR1010  WRITE     HTMLFILE;OPTHHOSP;
          GOTO      OPRR9999
.
OPRR1020  MOVE      OPTHHOSP,DEFTHOSP
          CALL      HSPSEL00
          GOTO      OPRR9999
.
OPRR1100  MOVE      WBSEHOSP,DEFTHOSP
          CALL      HSPSEL00
          GOTO      OPRR9999
.
OPRR1200  WRITE     HTMLFILE;HOSPCODE;
          GOTO      OPRR9999
.
OPRR1300  CALL      PREVSR00     * Link to Prev Set of Codes
          GOTO      OPRR9999
.
OPRR1400  CALL      NEXTSR00     * Link to Next Set of Codes
          GOTO      OPRR9999
.
OPRR9999  RETURN
.------------------------------------------------------------
. Tray selection list
.------------------------------------------------------------
STRAY000  PACK      KEY18,SP70
          CALL      RSOPTRA1
STRAY100  CALL      RKOPTRA1
          BRANCH    OVRCD,STRAY999
.
          IF        IBCNMHOS = 1 
            MATCH     HOSPCODE,OPTHHOSP
            GOTO      STRAY100 IF NOT EQUAL
          ELSE
            MATCH     SP70,OPTHHOSP
            GOTO      STRAY100 IF NOT EQUAL
          ENDIF
.
          WRITE     HTMLFILE;"<option value=",OPTHCODE,">",OPTHDESC:
                               "</option>"
          GOTO      STRAY100
.
STRAY999  RETURN
.-----------------------------------------------------------
. Option 6 - Operating Room Tray Detail/Contents Maintenance
.-----------------------------------------------------------
OPRB0000  BRANCH    FLDITMNO,OPRB0100,OPRB0200,OPRB0300,OPRB0400,OPRB0500:
                             OPRB0600,OPRB0700,OPRB0800
          GOTO      OPRB9999
.
OPRB0100  WRITE     HTMLFILE;OPTDCODE;  * Tray Code
          GOTO      OPRB9999
.
OPRB0200  WRITE     HTMLFILE;OPTDITEM;  * Item Code      
          GOTO      OPRB9999
.
OPRB0300  WRITE     HTMLFILE;OPTDQTY;   * Quantity       
          GOTO      OPRB9999
.
OPRB0400  MOVE      ZERO,LNK2PRT
          CALL      ORTRB000     * Table of Operating Rooms Tray Contents
          GOTO      OPRB9999
.
OPRB0500  CALL      NEXTTB00     * Link to Next Set of Tray Contents
          GOTO      OPRB9999
.
OPRB0600  CALL      PREVTB00     * Link to Prev Set of Tray Contents
          GOTO      OPRB9999
.
OPRB0700  MATCH     "1",OPCNPTMC
          GOTO      OPRB0720 IF NOT EQUAL
.
          IF        CFEETYP=FIVE
            MOVE      OPTDITEM,MISCCODE
            MOVE      OPTDHOSP,MISCHOSP
            CALL      GNZMDS00
            WRITE     HTMLFILE;MISCDESC;
            GOTO      OPRB9999
          ELSE
            PACK      KEY9,OPTDITEM,SP70
            IF        IBCNMHOS = 1
              PACK      KEY3,WBSEHOSP,SP70
              CALL      RDPTHSP1
              BRANCH    OVRCD,OPRB0715
              PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
            ELSE
OPRB0715      PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
            ENDIF
            CALL      PATMCHRD
.
            IF        EXIT=ZERO
              WRITE     HTMLFILE;MDESC;
              GOTO      OPRB9999
            ENDIF
.
            GOTO      OPRB0720
.
          ENDIF
.
OPRB0720  PACK      KEY15,OPTDITEM,SP70  * Item Description
          CALL      RDOPITE1
          BRANCH    OVRCD,OPRB9999
          WRITE     HTMLFILE;OPITDESC;        
          GOTO      OPRB9999
.
OPRB0800  MOVE      ONE,LNK2PRT  * Dframe with no link
          CALL      ORTRB000     * Table of Operating Rooms Tray Contents
          GOTO      OPRB9999
.
OPRB9999  RETURN
.-----------------------------------------------------------
. Option 7 - Operating Room Clinic/Session Maintenance
.-----------------------------------------------------------
OPRC0000  BRANCH    FLDITMNO,OPRC0100,OPRC0200,OPRC0300,OPRC0400,OPRC0500:
                             OPRC0600,OPRC0700,OPRC0800,OPRC0900,OPRC1000:
                             OPRC1100
          GOTO      OPRC9999
.
OPRC0100  WRITE     HTMLFILE;OPCLCLIN;  * Clinic Code
          GOTO      OPRC9999
.
OPRC0200  MATCH     SP70,OPCLDESC
          GOTO      OPRC9999 IF EQUAL
          WRITE     HTMLFILE;OPCLDESC;  * Description    
          GOTO      OPRC9999
.
OPRC0300  MOVE      OPCLDOCT,DOCTCODE   * Doctor Code    
          CALL      DOCDET00
          GOTO      OPRC9999
.
OPRC0400  MOVE      "YG",CATEGORY       * Group Code     
          MOVE      OPCLCAT,CODE      
          CALL      CODITM00
          GOTO      OPRC9999
.
OPRC0500  MOVE      ZERO,MYHOSPIT
          CALL      ORCLI000     * Table of Operating Rooms
          GOTO      OPRC9999
.
OPRC0600  CALL      NEXTPR00     * Link to Next Set of Codes
          GOTO      OPRC9999
.
OPRC0700  CALL      PREVPR00     * Link to Prev Set of Codes
          GOTO      OPRC9999
.
OPRC0800
.
.  ****  Used when OPRWEB05 is called needs either depending on parameter ****
.
          IF        OPCNCLSU = 1
            WRITE     HTMLFILE;OPCLDOCT;     * Using Doctor Code
          ELSE
            WRITE     HTMLFILE;OPCLCLIN;     * Using Session Clinic Code
          ENDIF
          GOTO      OPRC9999
.
OPRC0900  MOVE      ONE,MYHOSPIT * My Hospital
          CALL      ORCLI000     * Table of Operating Rooms
          GOTO      OPRC9999
.
OPRC1000  MATCH     SP70,OPCLACTV
          GOTO      OPRC9999 IF EQUAL
.
          WRITE     HTMLFILE;OPCLACTV;  * Active Flag
          GOTO      OPRC9999
.
OPRC1100  WRITE     HTMLFILE;ACTVFILT;
          GOTO      OPRC9999
.
OPRC9999  RETURN
.-----------------------------------------------------------
. Option 8 - Operating Room Expensive Item Maintenance
.-----------------------------------------------------------
OPRE0000  BRANCH    FLDITMNO,OPRE0100,OPRE0200,OPRE0300,OPRE0400,OPRE0500:
                             OPRE0600,OPRE0700,OPRE0800,OPRE0900,OPRE1000:
                             OPRE1100,OPRE1200
          GOTO      OPRE9999
.
OPRE0100  WRITE     HTMLFILE;OPEXCODE;  * Expensive Item Code
          GOTO      OPRE9999
.
OPRE0200  MATCH     SP70,OPEXDESC
          GOTO      OPRE9999 IF EQUAL
          WRITE     HTMLFILE;OPEXDESC;  * Description    
          GOTO      OPRE9999
.
OPRE0300  COMPARE   ONE,OPCNRUSI
          GOTO      OPRE9999 IF NOT EQUAL
.
          MATCH     SP70,OPEXRUS        * RUS Equivalent
          GOTO      OPRE9999 IF EQUAL
          WRITE     HTMLFILE;OPEXRUS; 
          GOTO      OPRE9999
.
OPRE0400  
          GOTO      OPRE9999
.
OPRE0500  CALL      OREXP000     * Table of Operating Rooms Expensive Items 
          GOTO      OPRE9999
.
OPRE0600  CALL      PREVPR00     * Link to Prev Set of Codes 
          GOTO      OPRE9999
.
OPRE0700  CALL      NEXTPR00     * Link to Next Set of Codes
          GOTO      OPRE9999
.
OPRE0800  READ      CONTROLF,FORTY;*113,OPCNRUSI
          WRITE     HTMLFILE;OPCNRUSI; 
          GOTO      OPRE9999
.
OPRE0900  CALL      SREXP000     * Search of Operating Rooms Expensive Items
          GOTO      OPRE9999
.
OPRE1000  WRITE     HTMLFILE;OPEXMCHG;                  * I SRF 33349
          GOTO      OPRE9999                            * Misc Charge Code
.
OPRE1100  IF        IBCNMHOS=1
            MOVE      SP10,KEY3
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            BRANCH    OVRCD,OPRE9999
            PACK      KEY29,PTHSDCLM,SP6,SP3,OPEXMCHG,CURRDATE,SP10
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,OPEXMCHG,CURRDATE,SP10
          ENDIF
OPRE1120  CALL      PATMCHRD                * read Misc.Charges file 
          COMPARE   ZERO,EXIT
          GOTO      OPRE1150 IF EQUAL
.
          IF        IBCNMHOS=1
            CALL      RKPTHSP1
            BRANCH    OVRCD,OPRE9999
            PACK      KEY29,PTHSDCLM,SP6,SP3,OPEXMCHG,CURRDATE,SP10
            GOTO      OPRE1120
          ENDIF
          GOTO      OPRE9999
.
OPRE1150  WRITE     HTMLFILE;MDESC;                     * Misc Charge Desc
          GOTO      OPRE9999                            * end I SRF 33349
.
OPRE1200  WRITE     HTMLFILE;OPEXACTV;                  * Active/Inactive   
          GOTO      OPRE9999
.
OPRE9999  RETURN
.-----------------------------------------------------------
. Option 9 - Operating Room Unavailable Theatre Maintenance
.-----------------------------------------------------------
OPRU0000  BRANCH    FLDITMNO,OPRU0100,OPRU0200,OPRU0300,OPRU0400,OPRU0500:
                             OPRU0600,OPRU0700
          GOTO      OPRU9999
.
OPRU0100  WRITE     HTMLFILE;OPUATHET;  * Theatre Code        
          GOTO      OPRU9999
.
OPRU0200  MATCH     SP70,OPUADATE       * Date Unavailable
          GOTO      OPRU9999 IF EQUAL
          UNPACK    OPUADATE,CCENT,CYEAR,CMON,CDAY  * Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;  
          GOTO      OPRU9999
.
OPRU0300  MATCH     SP70,OPUASTIM       * Time Unavailable From Start
          GOTO      OPRU9999 IF EQUAL
          WRITE     HTMLFILE;OPUASTIM; 
          GOTO      OPRU9999
.
OPRU0400  MATCH     SP70,OPUAETIM       * Time Unavailable To End
          GOTO      OPRU9999 IF EQUAL
          WRITE     HTMLFILE;OPUAETIM; 
          GOTO      OPRU9999
.
OPRU0500  CALL      ORUAV000    * Table of Operating Rooms Unavailable Thaetres 
          GOTO      OPRU9999
.
OPRU0600  CALL      PREVPR00    * Link to Prev Set of Codes 
          GOTO      OPRU9999
.
OPRU0700  CALL      NEXTPR00    * Link to Next Set of Codes
          GOTO      OPRU9999
.
OPRU9999  RETURN
.
.-----------------------------------------------------------
. Link to for Redirect 
.-----------------------------------------------------------
LNKSER00  UNPACK    DIM127,D1,KEY8,DIM127
          UNPACK    DIM127,D1,KEY2,DIM127
          UNPACK    DIM127,D1,FLDPARA,DIM127
          REP       " +",OPRMROOM
          REP       " +",OPRADATE
.
          WRITE     HTMLFILE;KEY8,".pbl?reportno=",KEY2:
                                   "&template=",FLDPARA:
                                   "&opror002=",OPRMROOM:  
                                   "&opror001=",OPRADATE;  
.
          REP       "+ ",OPRMROOM
          REP       "+ ",OPRADATE
.
LNKSER99  RETURN
.-----------------------------------------------------------
. Link to Next Group Codes           
.-----------------------------------------------------------
NEXTPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",OPRMROOM
          REP       " +",STARTKEY
          REP       " +",NEXTIKEY
.
          WRITE     HTMLFILE;"oprweb04.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prvcflag=",ONE:
                                 "&nextikey=",NEXTIKEY:
                                 "&startkey=",STARTKEY:
                                 "&oprua001=",OPRMROOM:  
                                 "&opror002=",OPRMROOM:  
                                 "&actvfilt=",ACTVFILT;  
.
          REP       "+ ",OPRMROOM
          REP       "+ ",STARTKEY
          REP       "+ ",NEXTIKEY
.
NEXTPR99  RETURN
.
.-----------------------------------------------------------
. Link to Next Group Codes for Search
.-----------------------------------------------------------
NEXTSR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",OPRMROOM
          REP       " +",STARTKEY
          REP       " +",NEXTIKEY
.
          WRITE     HTMLFILE;"oprweb04.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prvcflag=",ONE:
                                 "&nextikey=",NEXTIKEY:
                                 "&startkey=",STARTKEY:
                                 "&oprua001=",OPRMROOM:
                                 "&opror002=",OPRMROOM:
                                 "&actvfilt=",ACTVFILT:
                                 "&hospcode=",HOSPCODE;
.
          REP       "+ ",OPRMROOM
          REP       "+ ",STARTKEY
          REP       "+ ",NEXTIKEY
.
NEXTSR99  RETURN
.
.-----------------------------------------------------------
. Link to Next Group Tray Codes
.-----------------------------------------------------------
NEXTTB00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",OPTHCODE
          REP       " +",HOSPCODE
.
          WRITE     HTMLFILE;"oprweb04.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&oprtb001=",OPTHCODE:
                                 "&hospcode=",HOSPCODE;
.
          REP       "+ ",OPTHCODE
          REP       "+ ",HOSPCODE
.
NEXTTB99  RETURN
.
.-----------------------------------------------------------
. Link to Prev Group Codes           
.-----------------------------------------------------------
PREVPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",OPRMROOM
          REP       " +",STARTKEY
          REP       " +",PREVIKEY
.
          WRITE     HTMLFILE;"oprweb04.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2: 
                                 "&prvcflag=",ONE:
                                 "&previkey=",PREVIKEY:
                                 "&startkey=",STARTKEY:
                                 "&oprua001=",OPRMROOM:  
                                 "&opror002=",OPRMROOM:  
                                 "&actvfilt=",ACTVFILT;
.
          REP       "+ ",OPRMROOM
          REP       "+ ",STARTKEY
          REP       "+ ",PREVIKEY
.
PREVPR99  RETURN
.
.-----------------------------------------------------------
. Link to Prev Group Codes for Search
.-----------------------------------------------------------
PREVSR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",OPRMROOM
          REP       " +",STARTKEY
          REP       " +",PREVIKEY
.
          WRITE     HTMLFILE;"oprweb04.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prvcflag=",ONE:
                                 "&previkey=",PREVIKEY:
                                 "&startkey=",STARTKEY:
                                 "&oprua001=",OPRMROOM:
                                 "&opror002=",OPRMROOM:
                                 "&actvfilt=",ACTVFILT:
                                 "&hospcode=",HOSPCODE;
.
          REP       "+ ",OPRMROOM
          REP       "+ ",STARTKEY
          REP       "+ ",PREVIKEY
.
PREVSR99  RETURN
.
.-----------------------------------------------------------
. Link to Prev Group Tray Codes           
.-----------------------------------------------------------
PREVTB00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",OPTHCODE
          REP       " +",HOSPCODE
.
          WRITE     HTMLFILE;"oprweb04.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&oprtb001=",OPTHCODE:
                                 "&hospcode=",HOSPCODE;
.
          REP       "+ ",OPTHCODE
          REP       "+ ",HOSPCODE
.
PREVTB99  RETURN
.------------------------------------------------------------
. Table of Operating Rooms  
.------------------------------------------------------------
OPRTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      OPHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP70
          CALL      RSOPOPR1
          IF        OVRCD=0
            CALL      RPOPOPR1
          ENDIF
OPRTB100  CALL      RKOPOPR1
          BRANCH    OVRCD,OPRTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      OPRTB100
          ENDIF
.
          CALL      OPRRW000      * Display Operating Room Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      OPRTB100 IF NOT EQUAL
          GOTO      OPRTB999
.
OPRTB900  CALL      NOMORE00      * Display No More Records Message
.
OPRTB999  RETURN
.------------------------------------------------------------
. Operating Room Table Details (TABLE HEADING)
.------------------------------------------------------------
OPHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Theatre</td>":
                               "<td class=HeadingCell width=35%>":
                               "Description</td>":
                               "<td class=HeadingCell width=35%>":
                               "Location</td>";
.
          IF        IBCNMHOS = 1
            WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Status</td>":
                             "</tr>"
.
OPHED999  RETURN
.------------------------------------------------------------
. Operating Room Table (TABLE ROW)
.------------------------------------------------------------
OPRRW000  MATCH     SP70,OPRMLOC
          IF        @EQUAL
            MOVE      "&nbsp;",KEY30 
          ELSE
            MOVE      OPRMLOC,KEY30 
          ENDIF
.
          COMPARE   ZERO,OPRMSTAT
          IF        @EQUAL
            MOVE      "Active",KEY8
          ELSE
            MOVE      "Inactive",KEY8
          ENDIF
.
          IF        IBCNMHOS = 1
            MOVE      SP70,PTHSNAME
            MATCH     SP70,OPRMHOSP
            IF        !@EQUAL
              PACK      KEY3,OPRMHOSP,SP10        * Multi Hospital
              CALL      RDPTHSP1
              IF        OVRCD=1
                MOVE      OPRMHOSP,PTHSNAME
              ENDIF
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&oprop001=",OPRMROOM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             OPRMROOM,"</td>":
                             "<td>",OPRMDESC,"</td><td>",KEY30,"</td>";
.
         IF         IBCNMHOS = 1
           WRITE      HTMLFILE;"<td>",PTHSNAME,"&nbsp;</td>";
         ENDIF
.
         WRITE      HTMLFILE;"<td>",KEY8,"</td>":
                             "</tr>"
.
OPRRW999 RETURN
.------------------------------------------------------------
. Table of Operating Rooms Available Times (Descending) 
.------------------------------------------------------------
ORATB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      ORHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY14,OPROR002,Z70
          CALL      RSOPORA2
ORATB100  CALL      RPOPORA2
          BRANCH    OVRCD,ORATB999
.
          MATCH     OPRAROOM,OPROR002
          GOTO      ORATB100 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ORATB100
          ENDIF
.
          CALL      ORARW000      * Time Available Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ORATB100 IF NOT EQUAL
.
ORATB999  RETURN
.------------------------------------------------------------
. Time Available Table Details (TABLE HEADING)
.------------------------------------------------------------
ORHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Date</td>":
                               "<td class=HeadingCell width=35%>":
                               "Time Available</td>":
                             "</tr>"
.
ORHED999  RETURN
.------------------------------------------------------------
. Time Available Table (TABLE ROW)
.------------------------------------------------------------
ORARW000  UNPACK    OPRADATE,CCENT,CYEAR,CMON,CDAY  * Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          COMPARE   ZERO,OPRAVAIL
          IF        @EQUAL
            MOVE      "&nbsp;",KEY5
          ELSE
            MOVE      OPRAVAIL,KEY5
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail02":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&opror001=",OPRADATE:
                             "&opror002=",OPRAROOM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY11,"</td><td>",KEY5,"</td>":
                             "</tr>"
.
ORARW999 RETURN
.------------------------------------------------------------
. Table of Operating Rooms Nurses           
.------------------------------------------------------------
ORNTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      ONHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP70
          CALL      RSOPNUR1
          IF        OVRCD=0
            CALL      RPOPNUR1
          ENDIF
ORNTB100  CALL      RKOPNUR1
          BRANCH    OVRCD,ORNTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ORNTB100
          ENDIF
.
          CALL      ORNRW000      * Nurses Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ORNTB100 IF NOT EQUAL
          GOTO      ORNTB999
.
ORNTB900  CALL      NOMORE00      * Display No More Records Message
.
ORNTB999  RETURN
.------------------------------------------------------------
. Nurses Table Details (TABLE HEADING)
.------------------------------------------------------------
ONHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Code</td>":
                               "<td class=HeadingCell width=25%>":
                               "Surname</td>":
                               "<td class=HeadingCell width=25%>":
                               "Given Name</td>":
                               "<td class=HeadingCell width=25%>":
                               "Qualifications</td>":
                               "<td class=HeadingCell width=10%>":
                               "Status</td>":
                             "</tr>"
.
ONHED999  RETURN
.------------------------------------------------------------
. Nurses Table (TABLE ROW)
.------------------------------------------------------------
ORNRW000  COMPARE   ZERO,OPNRSTAT
          IF        @EQUAL
            MOVE      "Active",KEY8
          ELSE
            MOVE      "Inactive",KEY8
          ENDIF
.
          MOVE      SP70,TDESC
          MATCH     SP70,OPNRUSR1
          IF        !@EQUAL
            PACK      KEY5,ANSQ,ONE,OPNRUSR1,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      OPNRUSR1,TDESC
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail03":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&oprnr001=",OPNRCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             OPNRCODE,"</td><td>",OPNRSNAM,"</td>":
                             "<td>",OPNRGNAM,"</td>":
                             "<td>",TDESC,"&nbsp;</td>":
                             "<td>",KEY8,"</td>":
                             "</tr>"
.
ORNRW999 RETURN
.------------------------------------------------------------
. Search of Operating Rooms - Item Codes           
.------------------------------------------------------------
SRITB000  IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          PACK      KEY65,STARTKEY,SP70
          CALL      RSOPITE2
SRITB100  CALL      RKOPITE2
          BRANCH    OVRCD,SRITB999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SRITB100
          ENDIF
.
          WRITE     HTMLFILE;"<tr valign=top><td>":
                              "<img src=../images/MaintenanceIcon.gif ":
                              " class=Icon ":
                              "onclick=#"updateParent('",OPITCODE:
                              "','",OPITDESC,"');#"> ":
                              OPITCODE,"</td><td>",OPITDESC,"</td>":
                             "</tr>"  
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SRITB100 IF NOT EQUAL
.
SRITB999  RETURN
.------------------------------------------------------------
. Table of Operating Rooms - Item Codes           
.------------------------------------------------------------
ORITB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      OIHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button
.
          IF        PRVIFLAG = 1
            MATCH     SP70,PREVIKEY
            IF        !@EQUAL
              CALL      GPRITE00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              PACK      PREVIKEY,STARTKEY,SP70
              GOTO      ORITB050
            ENDIF
            PACK      KEY15,STARTKEY,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      ORITB050
          ENDIF
.
.         * Next button
.
          MATCH     SP70,NEXTIKEY
          IF        !@EQUAL
            CALL      GNXITE00              * Check to see if at the last rec
            PACK      KEY15,NEXTIKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            PACK      NEXTIKEY,STARTKEY,SP70
            MATCH     KEY15,STARTKEY        * start again
            GOTO      ORITB050 IF EQUAL     
            CALL      RDOPITE1              * skip this record
            COMPARE   ZERO,OVRCD
            GOTO      ORITB100 IF EQUAL
          ENDIF
.
          PACK      KEY15,STARTKEY,SP70
ORITB050  CALL      RDOPITE1
          COMPARE   ZERO,OVRCD
          GOTO      ORITB150 IF EQUAL
.
          CALL      RSOPITE1
ORITB100  CALL      RKOPITE1
          BRANCH    OVRCD,ORITB900
.
ORITB150  PACK      NEXTIKEY,OPITCODE,SP70
          MATCH     SP70,PREVIKEY
          IF        @EQUAL
            PACK      PREVIKEY,OPITCODE,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ORITB100
          ENDIF
.
          CALL      ORIRW000      * Item Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ORITB100 IF NOT EQUAL
          GOTO      ORITB999
.
ORITB900  CALL      NOMORE00      * Display No More Records Message
.
ORITB999  RETURN
+
.--------------------------------------------------------------------------
. GPRITE00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
GPRITE00  PACK      SAVKEY15,STARTKEY,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          PACK      KEY15,PREVIKEY,Z70
          CALL      RDOPITE1                    * Position for batch #
          COMPARE   ZERO,OVRCD
          GOTO      GPRITE15 IF EQUAL
.
GPRITE10  CALL      RPOPITE1                    * read next record
          BRANCH    OVRCD,GPRITE91              * end of file
.
GPRITE15  PACK      SAVKEY15,OPITCODE,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      GPRITE90 IF EQUAL
.
          GOTO      GPRITE10
.
GPRITE90  MOVE      SAVKEY15,KEY15          * New start key for display
          SUB       ONE,NORECORD
          GOTO      GPRITE99
.
GPRITE91  PACK      KEY15,STARTKEY,SP70
          SUB       ONE,NORECORD
          GOTO      GPRITE99
.
GPRITE99  RETURN
+
.------------------------------------------------------------
. GNXITE00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
GNXITE00  PACK      KEY15,NEXTIKEY,SP70
          CALL      RSOPITE1                    * Position for batch #
          CALL      RKOPITE1                    * read next record
          BRANCH    OVRCD,GNXITE90               * end of file
.
          GOTO      GNXITE99
.
GNXITE90  PACK      NEXTIKEY,STARTKEY,SP70
          GOTO      GNXITE99                * No more record goto first record
.
GNXITE99  RETURN
.------------------------------------------------------------
. Item Table Details (TABLE HEADING)
.------------------------------------------------------------
OIHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Item Code</td>":
                               "<td class=HeadingCell width=35%>":
                               "Description</td>":
                             "</tr>"
.
OIHED999  RETURN
.------------------------------------------------------------
. Item Table (TABLE ROW)
.------------------------------------------------------------
ORIRW000  MATCH     SP70,OPITDESC
          IF        @EQUAL
            MOVE      "&nbsp;",KEY40
          ELSE
            MOVE      OPITDESC,KEY40
          ENDIF    
.
          BRANCH    LNK2PRT,ORIRW100
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail04":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&oprit001=",OPITCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             OPITCODE,"</td><td>",KEY40,"</td>":
                             "</tr>"
.
          GOTO      ORIRW999
.
ORIRW100  WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"#" ":
                              "OnClick=#"UpdateParent04('",OPITCODE:
                              "','",KEY40,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              OPITCODE,"</td><td>",KEY40,"</td>":
                             "</tr>"  
.
ORIRW999 RETURN
.------------------------------------------------------------
. Table of Operating Rooms - Trays           
.------------------------------------------------------------
ORITR000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      OTHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button
.
.          IF        PRVIFLAG = 1
.            MATCH     SP70,PREVIKEY
.            IF        !@EQUAL
.              CALL      GPRTRA00            * Get previous records key
.              MOVE      ZERO,STARTNUM       * Reset counters to zero
.              MOVE      ZERO,RECNUMB
.              MOVE      ZERO,DISNUMB
.              PACK      PREVIKEY,STARTKEY,SP70
.              GOTO      ORITR050
.            ENDIF
.            PACK      KEY18,STARTKEY,SP70   * Go back to start if at
.            MOVE      ZERO,STARTNUM         * the end of the list
.            MOVE      ZERO,RECNUMB
.            MOVE      ZERO,DISNUMB
.            GOTO      ORITR050
.          ENDIF
.
.         * Next button
.
.          MATCH     SP70,NEXTIKEY
.          IF        !@EQUAL
.            CALL      GNXTRA00              * Check to see if at the last rec
.            PACK      KEY18,NEXTIKEY,SP70
.            MOVE      ZERO,STARTNUM         * Reset counters
.            MOVE      ZERO,RECNUMB
.            MOVE      ZERO,DISNUMB
.            PACK      NEXTIKEY,STARTKEY,SP70
.            MATCH     KEY18,STARTKEY        * start again
.            GOTO      ORITR050 IF EQUAL                   
.            CALL      RDOPTRA1              * skip this key
.            COMPARE   ZERO,OVRCD
.            GOTO      ORITR100 IF EQUAL
.          ENDIF
.
          PACK      KEY18,STARTKEY,SP70
ORITR050  CALL      RDOPTRA1
          COMPARE   ZERO,OVRCD
          GOTO      ORITR150 IF EQUAL
.
          CALL      RSOPTRA1
ORITR100  CALL      RKOPTRA1
          BRANCH    OVRCD,ORITR900
.
ORITR150  IF        IBCNMHOS = 0
            MATCH     SP70,OPTHHOSP
            GOTO      ORITR100 IF NOT EQUAL
          ENDIF 
.
          PACK      NEXTIKEY,OPTHCODE,OPTHHOSP,SP70
          MATCH     SP70,PREVIKEY
          IF        @EQUAL
            PACK      PREVIKEY,OPTHCODE,OPTHHOSP,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ORITR100
          ENDIF
.
          CALL      ORTRW000      * Tray Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ORITR100 IF NOT EQUAL
          GOTO      ORITR999
.
ORITR900  CALL      NOMORE00      * Display No More Records Message
.
ORITR999  RETURN
.
.------------------------------------------------------------
. Table of Operating Rooms - Trays search
.------------------------------------------------------------
ORITS000  
          WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=20%>":
                             "Tray Code</td>":
                             "<td class=HeadingCell width=40%>":
                             "Description</td>":
                             "</tr>"
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button
.
.          IF        PRVIFLAG = 1
.            MATCH     SP70,PREVIKEY
.            IF        !@EQUAL
.              CALL      GPRTRA00            * Get previous records key
.              MOVE      ZERO,STARTNUM       * Reset counters to zero
.              MOVE      ZERO,RECNUMB
.              MOVE      ZERO,DISNUMB
.              PACK      PREVIKEY,STARTKEY,SP70
.              GOTO      ORITS050
.            ENDIF
.            PACK      KEY18,STARTKEY,SP70   * Go back to start if at
.            MOVE      ZERO,STARTNUM         * the end of the list
.            MOVE      ZERO,RECNUMB
.            MOVE      ZERO,DISNUMB
.            GOTO      ORITS050
.          ENDIF
.
.         * Next button
.
.          MATCH     SP70,NEXTIKEY
.          IF        !@EQUAL
.            CALL      GNXTRA00              * Check to see if at the last rec
.            PACK      KEY18,NEXTIKEY,SP70
.            MOVE      ZERO,STARTNUM         * Reset counters
.            MOVE      ZERO,RECNUMB
.            MOVE      ZERO,DISNUMB
.            PACK      NEXTIKEY,STARTKEY,SP70
.            MATCH     KEY18,STARTKEY        * start again
.            GOTO      ORITS050 IF EQUAL
.            CALL      RDOPTRA1              * skip this key
.            COMPARE   ZERO,OVRCD
.            GOTO      ORITS100 IF EQUAL
.          ENDIF
.
          PACK      KEY18,STARTKEY,SP70
ORITS050  CALL      RDOPTRA1
          COMPARE   ZERO,OVRCD
          GOTO      ORITS150 IF EQUAL
.
          CALL      RSOPTRA1
ORITS100  CALL      RKOPTRA1
          BRANCH    OVRCD,ORITS900
.
ORITS150  IF        IBCNMHOS = 1
            MATCH     OPTHHOSP,HOSPCODE
            GOTO      ORITS100 IF NOT EQUAL
          ELSE
            MATCH     SP70,OPTHHOSP
            GOTO      ORITS100 IF NOT EQUAL
          ENDIF
.
          PACK      NEXTIKEY,OPTHCODE,OPTHHOSP,SP70
          MATCH     SP70,PREVIKEY
          IF        @EQUAL
            PACK      PREVIKEY,OPTHCODE,OPTHHOSP,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ORITS100
          ENDIF
.
          REP       "#" #' ",OPTHCODE
          REP       "#" #' ",OPTHDESC
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:updateParent":
                             "(#"",OPTHCODE,"#",":
                             "#"",OPTHDESC,"#",":
                             "#"",OPTHHOSP,"#")'>":
                             "<img src='../images/MaintenanceIcon.gif'":
                             " class=icon></a>":
                             OPTHCODE,"</td>":
                             "<td>",OPTHDESC,"</td>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ORITS100 IF NOT EQUAL
          GOTO      ORITS999
.
ORITS900  CALL      NOMORE00      * Display No More Records Message
.
ORITS999  RETURN
+
.--------------------------------------------------------------------------
. GPRTRA00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
GPRTRA00  PACK      SAVKEY18,STARTKEY,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          PACK      KEY18,PREVIKEY,Z70
          CALL      RDOPTRA1                     * Position for batch #
          COMPARE   ZERO,OVRCD
          GOTO      GPRTRA15 IF EQUAL
.
GPRTRA10  CALL      RPOPTRA1                     * read next record
          BRANCH    OVRCD,GPRTRA91              * end of file
.
GPRTRA15  PACK      SAVKEY18,OPTHCODE,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      GPRTRA90 IF EQUAL
.
          GOTO      GPRTRA10
.
GPRTRA90  MOVE      SAVKEY18,KEY18          * New start key for display
          SUB       ONE,NORECORD
          GOTO      GPRTRA99
.
GPRTRA91  PACK      KEY18,STARTKEY,SP70
          SUB       ONE,NORECORD
          GOTO      GPRTRA99
.
GPRTRA99  RETURN
+
.------------------------------------------------------------
. GNXTRA00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
GNXTRA00  PACK      KEY18,NEXTIKEY,SP70
          CALL      RSOPTRA1                     * Position for batch #
          CALL      RKOPTRA1                     * read next record
          BRANCH    OVRCD,GNXTRA90               * end of file
.
          GOTO      GNXTRA99
.
GNXTRA90  PACK      NEXTIKEY,STARTKEY,SP70
          GOTO      GNXTRA99                * No more record goto first record
.
GNXTRA99  RETURN
.------------------------------------------------------------
. Tray Table Details (TABLE HEADING)
.------------------------------------------------------------
OTHED000  IF        IBCNMHOS = 1
            WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "Tray Code</td>":
                               "<td class=HeadingCell width=40%>":
                               "Description</td>":
                               "<td class=HeadingCell width=40%>":
                               "Hospital</td>":
                               "</tr>"
          ELSE
            WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "Tray Code</td>":
                               "<td class=HeadingCell width=40%>":
                               "Description</td>":
                               "</tr>"
          ENDIF
.
OTHED999  RETURN
.------------------------------------------------------------
. Tray Table (TABLE ROW)
.------------------------------------------------------------
ORTRW000  MOVE      SP70,HOSPNAME
          MATCH     SP70,OPTHHOSP
          IF        !@EQUAL
            PACK      KEY3,OPTHHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD = 0
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail05":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&oprtr001=",OPTHCODE:
                             "&hospcode=",OPTHHOSP,"#")'>":
                             "<img src='../images/MaintenanceIcon.gif' ":
                             " class=icon></a>":
                             OPTHCODE,"</td>":
                             "<td>",OPTHDESC,"</td>";
.
          IF        IBCNMHOS = 1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"</td>";
          ENDIF
          WRITE     HTMLFILE;"</tr>"
.
ORTRW999  RETURN
.------------------------------------------------------------
. Table of Operating Rooms - Tray Details        
.------------------------------------------------------------
ORTRB000  IF        LNK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          CALL      OBHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY33,OPRTB001,SP70
          CALL      RSOPTRB1
ORTRB100  CALL      RKOPTRB1
          BRANCH    OVRCD,ORTRB900
.
          MATCH     OPRTB001,OPTDCODE
          GOTO      ORTRB900 IF NOT EQUAL
.
          MATCH     HOSPCODE,OPTDHOSP
          GOTO      ORTRB100 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ORTRB100
          ENDIF
.
          CALL      ORBRW000      * Tray Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ORTRB100 IF NOT EQUAL
          GOTO      ORTRB999
.
ORTRB900  CALL      NOMORE00      * Display No More Records Message
.
ORTRB999  RETURN
.------------------------------------------------------------
. Tray Details  (TABLE HEADING)
.------------------------------------------------------------
OBHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Item Code</td>":
                               "<td class=HeadingCell width=35%>":
                               "Description</td>":
                               "<td class=HeadingCell width=15%>":
                               "Quantity</td>":
                             "</tr>"
.
OBHED999  RETURN
.------------------------------------------------------------
. Tray Details (TABLE ROW)
.------------------------------------------------------------
ORBRW000  MATCH     "1",OPCNPTMC
          IF        @EQUAL
.
            MOVE      "&nbsp;",KEY90
.
            IF        CFEETYP=FIVE
              MOVE      OPTDITEM,MISCCODE
              MOVE      OPTDHOSP,MISCHOSP
              CALL      GNZMDS00
              MOVE      MISCDESC,KEY90 
              GOTO      ORBRW030
            ELSE
.
              PACK      KEY9,OPTDITEM,SP70
              IF        IBCNMHOS=1
                PACK      KEY3,WBSEHOSP,SP70
                CALL      RDPTHSP1
                BRANCH    OVRCD,ORBRW015
                PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
              ELSE
ORBRW015        PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
              ENDIF
              CALL      PATMCHRD
.
              IF        EXIT=ZERO
                PACK      KEY90,MDESC,SP70,SP70
                GOTO      ORBRW030 
              ENDIF 
.
              GOTO      ORBRW020
.
            ENDIF
.
          ELSE
.
ORBRW020    PACK      KEY15,OPTDITEM,SP70
            CALL      RDOPITE1
            IF        OVRCD=1 
              MOVE      "&nbsp;",KEY90
            ELSE
              MOVE      OPITDESC,KEY90
            ENDIF 
.
          ENDIF
.
ORBRW030  BRANCH    LNK2PRT,ORBRW100
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail06":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&oprtb001=",OPTDCODE:
                             "&oprtb002=",OPTDITEM:
                             "&hospcode=",HOSPCODE,"#")'>":
                             "<img src='../images/MaintenanceIcon.gif'":
                             " class=icon></a>":
                             OPTDITEM,"</td><td>",KEY90,"</td>":
                             "<td>",OPTDQTY,"</td>":
                             "</tr>"
.
          GOTO      ORBRW999
.
ORBRW100  WRITE     HTMLFILE;"<tr><td>",OPTDITEM,"</td><td>",KEY90,"</td>":
                             "<td>",OPTDQTY,"</td>":
                             "</tr>"
.
          GOTO      ORBRW999
.
ORBRW999 RETURN
.
.------------------------------------------------------------
. Return nzmcdesc from nzpmchaf for an item code
. Input:  MISCCODE
. Output: MISCDESC  
.------------------------------------------------------------
GNZMDS00  MOVE      SP70,MISCDESC   
          PACK      KEY37,MISCCODE,SP70
          CALL      RSNZMCH3
GNZMDS20  CALL      RKNZMCH3
          BRANCH    OVRCD,GNZMDS99
.
          MATCH     MISCCODE,NZMCMCHG
          GOTO      GNZMDS99 IF NOT EQUAL
.
          MATCH     "1",NZMCACFL
          GOTO      GNZMDS20 IF EQUAL
.
          MATCH     SP70,MISCHOSP
          IF        @EQUAL
            MOVE      NZMCDESC,MISCDESC
            GOTO      GNZMDS99
          ENDIF
.
          MATCH     NZMCHOSP,MISCHOSP
          IF        @EQUAL
            MOVE      NZMCDESC,MISCDESC
            GOTO      GNZMDS99
          ENDIF
.
          MATCH     SP70,NZMCHOSP
          IF        @EQUAL
            MOVE      NZMCDESC,MISCDESC
            GOTO      GNZMDS20
          ENDIF
.
          GOTO      GNZMDS20
.
GNZMDS99  RETURN
.
.------------------------------------------------------------
. Table of Operating Rooms - Clinic/Session Details        
.------------------------------------------------------------
ORCLI000  MOVE      SP70,GLOBINDC
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          UNPACK    DIM127,D1,GLOBINDC,DIM127
.
          CALL      OCHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP70
          CALL      RSOPCLI1
          IF        OVRCD=0
            CALL      RPOPCLI1
          ENDIF
ORCLI100  CALL      RKOPCLI1
          BRANCH    OVRCD,ORCLI900
.
          CALL      CHOS0000              * Check user hospital access
          BRANCH    EXIT,ORCLI100
.
          MATCH     SP70,ACTVFILT              * Show all Sessions  
          GOTO      ORCLI200 IF EQUAL
.
          MATCH     "1",ACTVFILT
          IF        @EQUAL
            MATCH     "1",OPCLACTV
            GOTO      ORCLI100 IF NOT EQUAL    * Only show InActive Sessions
          ENDIF
.
          MATCH     "0",ACTVFILT
          IF        @EQUAL
            MATCH     "1",OPCLACTV
            GOTO      ORCLI100 IF EQUAL        * Only show Active Sessions
          ENDIF
.
ORCLI200  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ORCLI100
          ENDIF
.
          CALL      OCLRW000      * Clinic Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ORCLI100 IF NOT EQUAL
          GOTO      ORCLI999
.
ORCLI900  CALL      NOMORE00      * Display No More Records Message
.
ORCLI999  RETURN
.
.------------------------------------------------------------
. Check session hospital
.------------------------------------------------------------
CHOS0000  COMPARE   ONE,MYHOSPIT                   * My hospital view
          GOTO      CHOS8000 IF NOT EQUAL
.
          COMPARE   ONE,IBCNMHOS                   * Multi hospital
          GOTO      CHOS8000 IF NOT EQUAL
.
          MOVE      ZERO,SESCOUNT    
.
          IF        OPCNCLSU = 1
            PACK      KEY21,WBSEHOSP,OPCLDOCT,SP70   * Using Doctor Code
          ELSE
            PACK      KEY21,WBSEHOSP,OPCLCLIN,SP70   * Using Session Clinic Code
          ENDIF
.
          CALL      RSOPSEM1
CHOS1000  CALL      RKOPSEM1
          BRANCH    OVRCD,CHOS9000
.         
          IF        OPCNCLSU = 1
            MATCH     OPCLDOCT,OPSMCLIN
            GOTO      CHOS9000 IF NOT EQUAL
          ELSE
            MATCH     OPCLCLIN,OPSMCLIN
            GOTO      CHOS9000 IF NOT EQUAL
          ENDIF
.  
          ADD       ONE,SESCOUNT                   * Session count        
.
          MATCH     WBSEHOSP,OPSMHOSP
          GOTO      CHOS1000 IF NOT EQUAL
. 
CHOS8000  MOVE      ZERO,EXIT
          GOTO      CHOS9999
.
CHOS9000  IF        SESCOUNT=0
            MOVE      ZERO,EXIT                    * Display records with
          ELSE                                     * no sessions as they don't
            MOVE      ONE,EXIT                     * have a hospital
          ENDIF
          GOTO      CHOS9999
.
CHOS9999  RETURN
.------------------------------------------------------------
. Clinic/Session Maintenance  (TABLE HEADING)
.------------------------------------------------------------
OCHED000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Session</td>":
                             "<td class=HeadingCell width=35%>":
                             "Description</td>":
                             "<td class=HeadingCell width=19%>":
                             "Doctor</td>":
                             "<td class=HeadingCell width=19%>":
                             "Status</td>":
                           "</tr>"
.
OCHED999  RETURN
.------------------------------------------------------------
. Clinic/Session Maintenance (TABLE ROW)
.------------------------------------------------------------
OCLRW000  MATCH     SP70,OPCLDESC
          IF        @EQUAL
            MOVE      "&nbsp;",KEY30
          ELSE
            MOVE      OPCLDESC,KEY30
          ENDIF 
.
          MOVE      SP70,DOCTOR
          MATCH     SP70,OPCLDOCT
          GOTO      OCLRW100 IF EQUAL
.        
          PACK      KEY6,OPCLDOCT,SP70
          CALL      RDDOCT1
          IF        OVRCD=1
            MOVE      OPCLDOCT,DOCTOR
          ENDIF
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          CLEAR     DOCTOR
          APPEND    DOCFNAME,DOCTOR
.
OCLRW100  MATCH     "1",OPCLACTV
          IF        @EQUAL
            MOVE      "Inactive",DISPLAY8
          ELSE
            MOVE      "Active",DISPLAY8
          ENDIF
.
          MATCH     "1",GLOBINDC
          IF        @EQUAL
             WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:Schedule07";
             IF        OPCNCLSU = 1
               WRITE     HTMLFILE;"(#"",OPCLDOCT,"#")'>";   * Doctor Code
             ELSE
               WRITE     HTMLFILE;"(#"",OPCLCLIN,"#")'>";   * Session Code
             ENDIF
          ELSE
           WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail07":
                               "(#"",LINKPRG,"#.pbl":
                               "?reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&oprcl001=",OPCLCLIN,"#")'>";
          ENDIF
.
          WRITE     HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             OPCLCLIN,"</td><td>",KEY30,"</td>":
                             "<td>",DOCTOR,"&nbsp;</td>":
                             "<td>",DISPLAY8,"&nbsp;</td>":
                             "</tr>"
.
OCLRW999 RETURN
.
.------------------------------------------------------------
. Search of Operating Rooms - Expensive Items
.------------------------------------------------------------
SREXP000  IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          PACK      KEY36,STARTKEY,SP70
          CALL      RSOPEXP2
SREXP100  CALL      RKOPEXP2
          BRANCH    OVRCD,SREXP999
.
          MATCH     "1",OPEXACTV          * Inactive
          GOTO      SREXP100 IF EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SREXP100
          ENDIF
.
.         WRITE     HTMLFILE;"<tr><td>":
.                            "<img src=../images/MaintenanceIcon.gif ":
.                            " class=ListIcon onclick='updateParent(#"":
.                            OPEXCODE,"#",#"",OPEXDESC,"#");'> ":
.                            OPEXCODE,"</td><td>",OPEXDESC,"</td>":
.                            "</tr>"
.
          MATCH     SP70,OPEXDESC
          IF        @EQUAL
            MOVE      "&nbsp;",OPEXDESC
          ENDIF
.
          REP       "#', ",OPEXDESC 
          REP       "#", ",OPEXDESC 
          RESET     OPEXDESC
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",OPEXCODE:  
                              "','",OPEXDESC,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>": 
                              OPEXCODE,"</td><td>",OPEXDESC,"</td>":
                              "</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SREXP100 IF NOT EQUAL
SREXP999  RETURN
.
.------------------------------------------------------------
. Table of Operating Rooms - Expensive Items           
.------------------------------------------------------------
OREXP000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      ECHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP70
          CALL      RSOPEXP1
          IF        OVRCD=0
            CALL      RPOPEXP1
          ENDIF
OREXP100  CALL      RKOPEXP1
          BRANCH    OVRCD,OREXP900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      OREXP100
          ENDIF
.
          CALL      EXPRW000      * Expensive Items Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      OREXP100 IF NOT EQUAL
          GOTO      OREXP999
.
OREXP900  CALL      NOMORE00      * Display No More Records Message
.
OREXP999  RETURN
.------------------------------------------------------------
. Expensive Items Maintenance  (TABLE HEADING)
.------------------------------------------------------------
ECHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Item Code</td>":
                               "<td class=HeadingCell width=70%>":
                               "Description</td>":
                               "<td class=HeadingCell width=15%>":
                               "Active</td>":
                             "</tr>"
.
ECHED999  RETURN
.------------------------------------------------------------
. Expensive Items Maintenance (TABLE ROW)
.------------------------------------------------------------
EXPRW000  MATCH     SP70,OPEXDESC
          IF        @EQUAL
            MOVE      "&nbsp;",KEY30
          ELSE
            MOVE      OPEXDESC,KEY30
          ENDIF 
.
          MATCH     "1",OPEXACTV
          IF        @EQUAL
            MOVE    "INACTIVE  ",ACTIDESC
          ELSE
            MOVE    "ACTIVE",ACTIDESC
          ENDIF 
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail08":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&oprex001=",OPEXCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             OPEXCODE,"</td><td>",KEY30,"</td>":
                             "<td>",ACTIDESC,"</td>":
                             "</tr>"
.
EXPRW999 RETURN
.------------------------------------------------------------
. Table of Operating Rooms Unavailable Theatres (Descending)
.------------------------------------------------------------
ORUAV000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      UAHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY19,OPRUA001,Z70
          CALL      RSOPUAV1
ORUAV100  CALL      RPOPUAV1
          BRANCH    OVRCD,ORUAV900
.
          MATCH     OPUATHET,OPRUA001
          GOTO      ORUAV100 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ORUAV100
          ENDIF
.
          CALL      UAVRW000      * Time Unavailable Theatre Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ORUAV100 IF NOT EQUAL
          GOTO      ORUAV999
.
ORUAV900  CALL      NOMORE00      * Display No More Records Message
.
ORUAV999  RETURN
.------------------------------------------------------------
. Unavailable Theatre Details (TABLE HEADING)
.------------------------------------------------------------
UAHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=35%>":
                               "Date Unavailable</td>":
                               "<td class=HeadingCell width=25%>":
                               "From</td>":
                               "<td class=HeadingCell width=25%>":
                               "To</td>":
                             "</tr>"
.
UAHED999  RETURN
.------------------------------------------------------------
. Unavailable Theatre (TABLE ROW)
.------------------------------------------------------------
UAVRW000  UNPACK    OPUADATE,CCENT,CYEAR,CMON,CDAY  * Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail09":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&oprua001=",OPUATHET:
                             "&oprua002=",OPUADATE:
                             "&oprua003=",OPUASTIM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY11,"</td><td>",OPUASTIM,"</td>":
                             "<td>",OPUAETIM,"</td>":
                             "</tr>"
.
UAVRW999 RETURN
.-------------------------------------------------------------------
. Doctors Prefences
.-------------------------------------------------------------------
OPRPRA00  MATCH     SP70,DOCTCODE
          GOTO      OPRPRA94 IF EQUAL
          MOVE      DOCTCODE,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,OPRPRA94
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRPRA50 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRPRA10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRPRA20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRPRA30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy All formaction
          GOTO      OPRPRA40 IF EQUAL 
.
          GOTO      OPRPRA93
.
.         ************ ADD FORMACTION ***********
.
OPRPRA10  IF        IBCNMHOS = 0
            MOVE      SP70,HOSPCODE
          ENDIF
.
          PACK      KEY18,DOCTCODE,OPRDH001,HOSPCODE,SP70
          CALL      RDOPDPH1
          COMPARE   ZERO,OVRCD
          GOTO      OPRPRA92 IF EQUAL
.
          MOVE      DOCTCODE,OPDHCODE
          MOVE      OPRDH001,OPDHPREF
          MOVE      OPRDH002,OPDHDESC
          MOVE      HOSPCODE,OPDHHOSP
          MOVE      SP70,OPDHSPAR
          PACK      KEY18,DOCTCODE,OPRDH001,HOSPCODE,SP70
          CALL      WROPDPH1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      OPRPRA99
.
.         ************ UPDATE FORMACTION **********
.
OPRPRA20  IF        IBCNMHOS = 1
            MOVE      UPDTHOSP,HOSPCODE
            MATCH     CURRHOSP,HOSPCODE
            IF        !@EQUAL
              PACK      KEY18,DOCTCODE,OPRDH001,HOSPCODE,SP70
              CALL      RDOPDPH1
              COMPARE   ZERO,OVRCD
              GOTO      OPRPRA92 IF EQUAL
            ENDIF
          ELSE
            MOVE      SP70,HOSPCODE
          ENDIF
.
          PACK      KEY18,DOCTCODE,OPRDH001,CURRHOSP,SP70
          CALL      RDOPDPH1
          BRANCH    OVRCD,OPRPRA91
.
          MOVE      OPRDH002,OPDHDESC
          MOVE      HOSPCODE,OPDHHOSP 
          CALL      UPOPDPH1      * Writes away the data
.
          IF        IBCNMHOS = 0
            GOTO      OPRPRA29  
          ENDIF
.
          MATCH     SP70,CURRHOSP
          GOTO      OPRPRA29 IF NOT EQUAL
.         
. Update hospital id for oprdpfaf and oprpcmaf
.
          PACK      KEY37,DOCTCODE,OPRDH001,SP70
          CALL      RSOPDPF1
OPRPRA22  CALL      RKOPDPF1
          BRANCH    OVRCD,OPRPRA25
.
          MATCH     DOCTCODE,OPDFCODE
          GOTO      OPRPRA25 IF NOT EQUAL
.
          MATCH     OPRDH001,OPDFPREF
          GOTO      OPRPRA25 IF NOT EQUAL
.
          MATCH     CURRHOSP,OPDFHOSP
          GOTO      OPRPRA22 IF NOT EQUAL
.
          PACK      SAVKEY37,OPDFCODE,OPDFPREF,OPDFCLSS,OPDFTYPE,OPDFITEM:
                             OPDFHOSP,SP70
.
          PACK      KEY37,OPDFCODE,OPDFPREF,OPDFCLSS,OPDFTYPE,OPDFITEM:
                          HOSPCODE,SP70
          CALL      RDOPDPF1
          IF        OVRCD = 1
            MOVE      SAVKEY37,KEY37
            CALL      RDOPDPF1
            IF        OVRCD = 0
              MOVE      HOSPCODE,OPDFHOSP
              CALL      UPOPDPF1
            ENDIF
          ENDIF
.
          MOVE      SAVKEY37,KEY37
          CALL      RDOPDPF1
.
          GOTO      OPRPRA22
.
OPRPRA25  PACK      KEY24,DOCTCODE,OPRDH001,SP70
          CALL      RSOPPCM1
OPRPRA26  CALL      RKOPPCM1
          BRANCH    OVRCD,OPRPRA29
.
          MATCH     DOCTCODE,OPPCCODE
          GOTO      OPRPRA29 IF NOT EQUAL
.
          MATCH     OPRDH001,OPPCPREF
          GOTO      OPRPRA29 IF NOT EQUAL
.
          MATCH     CURRHOSP,OPPCHOSP
          GOTO      OPRPRA26 IF NOT EQUAL
.
          PACK      SAVKEY24,OPPCCODE,OPPCPREF,OPPCCLSS,OPPCLINE,OPPCHOSP,SP70
.
          PACK      KEY24,OPPCCODE,OPPCPREF,OPPCCLSS,OPPCLINE,HOSPCODE,SP70
          CALL      RDOPPCM1
          IF        OVRCD = 1
            MOVE      SAVKEY24,KEY24
            CALL      RDOPPCM1
            IF        OVRCD = 0
              MOVE      HOSPCODE,OPPCHOSP
              CALL      UPOPPCM1
            ENDIF
          ENDIF
.
          MOVE      SAVKEY24,KEY24
          CALL      RDOPPCM1
.
          GOTO      OPRPRA26
.
OPRPRA29  MOVE      ZERO,EXIT
          GOTO      OPRPRA99
.
.         ************ DELETE FORMACTION **********
.
OPRPRA30  PACK      KEY18,DOCTCODE,OPRDH001,CURRHOSP,SP70
          CALL      RDOPDPH1
          BRANCH    OVRCD,OPRPRA91
.
          CALL      DEOPDPH1      
.
          PACK      KEY37,DOCTCODE,OPRDH001,SP70
          CALL      RSOPDPF1
OPRPRA32  CALL      RKOPDPF1
          BRANCH    OVRCD,OPRPRA35
.
          MATCH     DOCTCODE,OPDFCODE
          GOTO      OPRPRA35 IF NOT EQUAL
.
          MATCH     OPRDH001,OPDFPREF
          GOTO      OPRPRA35 IF NOT EQUAL
.
          MATCH     CURRHOSP,OPDFHOSP
          GOTO      OPRPRA32 IF NOT EQUAL
.
          PACK      KEY37,OPDFCODE,OPDFPREF,OPDFCLSS,OPDFTYPE,OPDFITEM:
                          OPDFHOSP,SP70
          CALL      DEOPDPF1
.
          GOTO      OPRPRA32    
.
OPRPRA35  PACK      KEY24,DOCTCODE,OPRDH001,SP70
          CALL      RSOPPCM1
OPRPRA36  CALL      RKOPPCM1
          BRANCH    OVRCD,OPRPRA39
.
          MATCH     DOCTCODE,OPPCCODE
          GOTO      OPRPRA39 IF NOT EQUAL
.
          MATCH     OPRDH001,OPPCPREF
          GOTO      OPRPRA39 IF NOT EQUAL
.
          MATCH     CURRHOSP,OPPCHOSP
          GOTO      OPRPRA36 IF NOT EQUAL
.
          PACK      KEY24,OPPCCODE,OPPCPREF,OPPCCLSS,OPPCLINE,OPPCHOSP,SP70
          CALL      DEOPPCM1
.
          GOTO      OPRPRA36
.
OPRPRA39  MOVE      ZERO,EXIT
          GOTO      OPRPRA99
.
.         ************ COPY ALL FORMACTION ***********
.
OPRPRA40  PACK      DOCTCODE,DOCTCODE,SP70
          PACK      OPRDH001,OPRDH001,SP70
.
          PACK      KEY18,DOCTCODE,OPRDH001,HOSPCODE,SP70
          CALL      RDOPDPH1
          COMPARE   ZERO,OVRCD
          GOTO      OPRPRA92 IF EQUAL
.
          MOVE      DOCTCODE,OPDHCODE
          MOVE      OPRDH001,OPDHPREF
          MOVE      OPRDH002,OPDHDESC
          MOVE      HOSPCODE,OPDHHOSP
          MOVE      SP70,OPDHSPAR
          PACK      KEY18,DOCTCODE,OPRDH001,HOSPCODE,SP70
          CALL      WROPDPH1      * Writes away the data
.
. Copy All oprdphaf records
.
          PACK      KEY37,OLDDH001,OLDDH002,SP70
          CALL      RSOPDPF1
OPRPRA41  CALL      RKOPDPF1
          BRANCH    OVRCD,OPRPRA42
.
          MATCH     OLDDH001,OPDFCODE
          GOTO      OPRPRA42 IF NOT EQUAL
.
          MATCH     OLDDH002,OPDFPREF
          GOTO      OPRPRA42 IF NOT EQUAL                    
.
          MATCH     CURRHOSP,OPDFHOSP
          GOTO      OPRPRA41 IF NOT EQUAL
.
          PACK      SAVKEY37,OPDFCODE,OPDFPREF,OPDFCLSS,OPDFTYPE,OPDFITEM:
                             OPDFHOSP,SP70
.
          PACK      KEY37,DOCTCODE,OPRDH001,OPDFCLSS,OPDFTYPE,OPDFITEM:
                          HOSPCODE,SP70
          CALL      RAOPDPF1
          IF        OVRCD = 1
            MOVE      DOCTCODE,OPDFCODE
            MOVE      OPRDH001,OPDFPREF
            MOVE      HOSPCODE,OPDFHOSP
            CALL      WROPDPF1
          ENDIF
.
          MOVE      SAVKEY37,KEY37
          CALL      RDOPDPF1
.
          GOTO      OPRPRA41
.
. Copy all oprpcmaf records 
.
OPRPRA42  PACK      KEY24,OLDDH001,OLDDH002,SP70
          CALL      RSOPPCM1
OPRPRA43  CALL      RKOPPCM1
          BRANCH    OVRCD,OPRPRA45
.
          MATCH     OLDDH001,OPPCCODE
          GOTO      OPRPRA45 IF NOT EQUAL
.
          MATCH     OLDDH002,OPPCPREF
          GOTO      OPRPRA45 IF NOT EQUAL
.
          MATCH     CURRHOSP,OPPCHOSP
          GOTO      OPRPRA43 IF NOT EQUAL
.
          PACK      SAVKEY24,OPPCCODE,OPPCPREF,OPPCCLSS,OPPCLINE,OPPCHOSP,SP70
.
          PACK      KEY24,DOCTCODE,OPRDH001,OPPCCLSS,OPPCLINE,HOSPCODE,SP70
          CALL      RAOPPCM1 
          IF        OVRCD = 1
            MOVE      DOCTCODE,OPPCCODE
            MOVE      OPRDH001,OPPCPREF
            MOVE      HOSPCODE,OPPCHOSP
            CALL      WROPPCM1
          ENDIF
.
          MOVE      SAVKEY24,KEY24
          CALL      RDOPPCM1
.
          GOTO      OPRPRA43
.
OPRPRA45  CLEAR     WEBTITLE
          MOVE      "Copy Created",WEBTITLE
          RESET     WEBTITLE
.
          MOVE      ZERO,EXIT
          GOTO      OPRPRA99
.   
OPRPRA50  PACK      KEY18,DOCTCODE,OPRDH001,HOSPCODE,SP70
          CALL      RDOPDPH1
          IF        OVRCD=1
            CALL      CLRPRA00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Doctors Preference Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRPRA99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRPRA99
.
OPRPRA91  MOVE      "Doctor Preference record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRA99
.
OPRPRA92  MOVE      "Doctor Preference record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRA99
.
OPRPRA93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRA99
.
OPRPRA94  MOVE      "Invalid Doctors Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRA99
.
OPRPRA99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRPRA00  MOVE      SP70,OPDHCODE  * Doctor
          MOVE      SP70,OPDHPREF  * Preference
          MOVE      SP70,OPDHDESC  * Description
          MOVE      SP70,OPDHSPAR  * Spare variable
CLRPRA99  RETURN
.
.-----------------------------------------------------------
. Doctors Preferences
.-----------------------------------------------------------
PRAF0000  BRANCH    FLDITMNO,PRAF0100,PRAF0200,PRAF0300,PRAF0400,PRAF0500:
                             PRAF0600,PRAF0700,PRAF0800,PRAF0900,PRAF1000
          GOTO      PRAF9999
.
PRAF0100  WRITE     HTMLFILE;OPDHCODE;  * Doctor Code
          GOTO      PRAF9999
.
PRAF0200  WRITE     HTMLFILE;OPDHPREF;  * Preference Code      
          GOTO      PRAF9999
.
PRAF0300  WRITE     HTMLFILE;OPDHDESC;  * Description
          GOTO      PRAF9999
.
PRAF0400  CALL      TBPRA000            * Table of Doctors Preferences
          GOTO      PRAF9999
.
PRAF0500  PACK      KEY24,DOCTCODE,OPRDH001,SP70
          CALL      RSOPPCM1
PRAF0520  CALL      RKOPPCM1
          BRANCH    OVRCD,PRAF9999
.
          MATCH     DOCTCODE,OPPCCODE
          GOTO      PRAF9999 IF NOT EQUAL
.
          MATCH     OPRDH001,OPPCPREF
          GOTO      PRAF9999 IF NOT EQUAL
.
          MATCH     OPDHHOSP,OPPCHOSP
          GOTO      PRAF0520 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE; 
          GOTO      PRAF9999
.
PRAF0600  WRITE     HTMLFILE;OLDDH001;
          GOTO      PRAF9999
.
PRAF0700  WRITE     HTMLFILE;OLDDH002;
          GOTO      PRAF9999
.
PRAF0800  PACK      KEY37,DOCTCODE,OPRDH001,SP70
          CALL      RSOPDPF1
PRAF0820  CALL      RKOPDPF1
          BRANCH    OVRCD,PRAF9999
.
          MATCH     DOCTCODE,OPDFCODE
          GOTO      PRAF9999 IF NOT EQUAL
.
          MATCH     OPRDH001,OPDFPREF
          GOTO      PRAF9999 IF NOT EQUAL
.
          MATCH     OPDHHOSP,OPDFHOSP
          GOTO      PRAF0820 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;         * to display red for details button 
          GOTO      PRAF9999
.
PRAF0900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PRAF0910,PRAF0920
.
          MATCH     SP70,OPDHHOSP
          GOTO      PRAF9999 IF EQUAL
.
          PACK      KEY3,OPDHHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,PRAF0910
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      PRAF9999
.
PRAF0910  WRITE     HTMLFILE;OPDHHOSP;
          GOTO      PRAF9999
.
PRAF0920  MOVE      OPDHHOSP,DEFTHOSP
          CALL      HSPSEL00
          GOTO      PRAF9999
.
PRAF1000  MOVE      WBSEHOSP,DEFTHOSP
          CALL      HSPSEL00
          GOTO      PRAF9999
.
PRAF9999  RETURN
.----------------------------------------------------------------------
. Table of Preference Codes
.----------------------------------------------------------------------
TBPRA000  PACK      KEY18,DOCTCODE,SP70
          CALL      RSOPDPH1
TBPRA100  CALL      RKOPDPH1
          BRANCH    OVRCD,TBPRA999
          MATCH     DOCTCODE,OPDHCODE
          GOTO      TBPRA999 IF NOT EQUAL
.
          MOVE      SP70,HOSPNAME  
          MATCH     SP70,OPDHHOSP
          IF        !@EQUAL
            PACK      KEY3,OPDHHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD = 0
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
          ENDIF
.
          IF        IBCNMHOS = 0
            MATCH     SP70,OPDHHOSP
            GOTO      TBPRA100 IF NOT EQUAL
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdatePreference('",HTMLLINK
          APPEND    OPDHCODE,HTMLLINK
          APPEND    OPDHPREF,HTMLLINK
          APPEND    OPDHHOSP,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",OPDHPREF,"#",":
                             "#"",OPDHDESC,"#",":
                             "#"",HOSPNAME,"#");"
          GOTO      TBPRA100
.
TBPRA999  RETURN
.
.-------------------------------------------------------------------
. Doctors Prefences Details
.-------------------------------------------------------------------
OPRPRB00  MATCH     SP70,DOCTCODE
          GOTO      OPRPRB94 IF EQUAL
          MOVE      DOCTCODE,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,OPRPRB94
.
          MATCH     SP70,PREFCODE
          GOTO      OPRPRB95 IF EQUAL
.
          PACK      KEY18,DOCTCODE,PREFCODE,HOSPCODE,SP70
          CALL      RDOPDPH1
          BRANCH    OVRCD,OPRPRB95
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRPRB40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRPRB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRPRB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRPRB30 IF EQUAL
.
          GOTO      OPRPRB93
.
.         ************ ADD FORMACTION ***********
.
OPRPRB10  MOVE      OPRTB002,OPRDD003 
          PACK      KEY37,DOCTCODE,PREFCODE,OPRDD001,OPRDD002,OPRDD003:
                          HOSPCODE,SP70
          CALL      RDOPDPF1
          COMPARE   ZERO,OVRCD
          GOTO      OPRPRB92 IF EQUAL
.
          MATCH     "0",OPRDD002
          IF        @EQUAL
            IF        IBCNMHOS = 1
              PACK      KEY18,OPRDD003,HOSPCODE,SP70
            ELSE
              PACK      KEY18,OPRDD003,SP70
            ENDIF
            CALL      RDOPTRA1
            BRANCH    OVRCD,OPRPRB97
            GOTO      OPRPRB18
          ENDIF
.
          MATCH     "2",OPRDD002
          IF        @EQUAL
            IF        IBCNMHOS = 1
              PACK      KEY18,OPRDD003,HOSPCODE,SP70
            ELSE
              PACK      KEY18,OPRDD003,SP70
            ENDIF
            CALL      RDOPEQP1
            BRANCH    OVRCD,OPRPRB98
            GOTO      OPRPRB18
          ENDIF
.
          MATCH     "1",OPCNPTMC
          GOTO      OPRPRB17 IF NOT EQUAL    
.
          COMPARE   FIVE,CFEETYP
          GOTO      OPRPRB12 IF EQUAL
.
          PACK      KEY9,OPRDD003,SP70
          IF        IBCNMHOS = 1
            PACK      KEY3,WBSEHOSP,SP70
            CALL      RDPTHSP1
            BRANCH    OVRCD,OPRPRB11
            PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
          ELSE
OPRPRB11    PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
          ENDIF
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      OPRPRB18 IF EQUAL
.
          GOTO      OPRPRB96
.
OPRPRB12  PACK      KEY37,OPRDD003,SP70
          CALL      RSNZMCH3
OPRPRB13  CALL      RKNZMCH3
          BRANCH    OVRCD,OPRPRB96
.
          MOVE      OPRDD003,DIM9
.
          MATCH     DIM9,NZMCMCHG
          GOTO      OPRPRB96 IF NOT EQUAL
.
          MATCH     "1",NZMCACFL
          GOTO      OPRPRB13 IF EQUAL
.
          IF        IBCNMHOS = 1
            MATCH     SP70,NZMCHOSP
            IF        !@EQUAL
              MATCH     HOSPCODE,NZMCHOSP
              GOTO      OPRPRB96 IF NOT EQUAL
            ENDIF  
          ENDIF
.
          GOTO      OPRPRB18
.
OPRPRB17  PACK      KEY15,OPRDD003,SP70
          CALL      RDOPITE1
          BRANCH    OVRCD,OPRPRB96
.
OPRPRB18  MOVE      DOCTCODE,OPDFCODE
          MOVE      PREFCODE,OPDFPREF
          MOVE      OPRDD001,OPDFCLSS
          MOVE      OPRDD002,OPDFTYPE
          MOVE      OPRDD003,OPDFITEM
          MOVE      OPRDD004,OPDFQTY
          MOVE      HOSPCODE,OPDFHOSP 
          MOVE      SP70,OPDFSPAR
          PACK      KEY37,DOCTCODE,PREFCODE,OPRDD001,OPRDD002,OPRDD003,HOSPCODE,SP70
          CALL      WROPDPF1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      OPRPRB99
.
.         ************ UPDATE FORMACTION **********
.
OPRPRB20  MATCH     OLDDD001,OPRDD001
          IF        !@EQUAL
            PACK      KEY37,DOCTCODE,PREFCODE,OPRDD001,OPRDD002,OPRDD003,HOSPCODE,SP70
            CALL      RAOPDPF1
            IF        OVRCD=0
              GOTO      OPRPRB92
            ENDIF
          ENDIF
.
          PACK      KEY37,DOCTCODE,PREFCODE,OLDDD001,OPRDD002,OPRDD003,HOSPCODE,SP70
          CALL      RDOPDPF1
          BRANCH    OVRCD,OPRPRB91
.
          MOVE      OPRDD001,OPDFCLSS
          MOVE      OPRDD004,OPDFQTY
          CALL      UPOPDPF1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      OPRPRB99
.
.         ************ DELETE FORMACTION **********
.
OPRPRB30  PACK      KEY37,DOCTCODE,PREFCODE,OPRDD001,OPRDD002,OPRDD003,HOSPCODE,SP70
          CALL      RDOPDPF1
          BRANCH    OVRCD,OPRPRB91
          CALL      DEOPDPF1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      OPRPRB99
.   
OPRPRB40  PACK      KEY37,DOCTCODE,PREFCODE,OPRDD001,OPRDD002,OPRDD003,HOSPCODE,SP70
          CALL      RDOPDPF1
          IF        OVRCD=1
            CALL      CLRPRB00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Doctors Preference Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRPRB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRPRB99
.
OPRPRB91  MOVE      "Doctor Preference Details Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRB99
.
OPRPRB92  MOVE      "Doctor Preference Details Record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRB99
.
OPRPRB93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRB99
.
OPRPRB94  MOVE      "Invalid Doctors Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRB99
.
OPRPRB95  MOVE      "Invalid Preference Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRB99
.
OPRPRB96  MOVE      "Invalid Item Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRB99
.
OPRPRB97  MOVE      "Invalid Tray",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRB99
.
OPRPRB98  MOVE      "Invalid Equipment",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRB99
.
OPRPRB99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRPRB00  MOVE      SP70,OPDFCODE  * Doctor
          MOVE      SP70,OPDFPREF  * Preference
          MOVE      SP70,OPDFCLSS  * Class
          MOVE      SP70,OPDFTYPE  * Type
          MOVE      SP70,OPDFITEM  * Item
          MOVE      ZERO,OPDFQTY   * Quantity
          MOVE      SP70,OPDFSPAR  * Spare variable
CLRPRB99  RETURN
.
.------------------------------------------------------------
. Tray Preference for each Specialty: Display,Add,Update,Delete
.------------------------------------------------------------
OPRTPS00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRTPS40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRTPS10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRTPS20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRTPS30 IF EQUAL
.
          GOTO      OPRTPS93
.
.         ************ ADD FORMACTION ***********
.
OPRTPS10  IF        IBCNMHOS = 0
            MOVE      SP70,HOSPCODE
          ENDIF
.
          PACK      KEY6,OPTPS001,HOSPCODE,SP70
          CALL      RDOPTPS1
          COMPARE   ZERO,OVRCD
          GOTO      OPRTPS92 IF EQUAL
.
          CALL      MVOPTP00      * Moves input variables to file variables
          PACK      KEY6,OPTPS001,HOSPCODE,SP70
          CALL      WROPTPS1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRTPS99
.
.         ************ UPDATE FORMACTION **********
.
OPRTPS20  IF        IBCNMHOS = 1
            MOVE      UPDTHOSP,HOSPCODE
            MATCH     CURRHOSP,HOSPCODE
            IF        !@EQUAL
              PACK      KEY6,OPTPS001,HOSPCODE,SP70
              CALL      RDOPTPS1
              COMPARE   ZERO,OVRCD
              GOTO      OPRTPS92 IF EQUAL
            ENDIF
          ELSE
            MOVE      SP70,HOSPCODE
          ENDIF
.
          PACK      KEY6,OPTPS001,CURRHOSP,SP70
          CALL      RDOPTPS1
          BRANCH    OVRCD,OPRTPS91
.
          CALL      MVOPTP00      * Moves input variables to file variables
          PACK      KEY6,OPTPS001,HOSPCODE,SP70
          CALL      UPOPTPS1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRTPS99
.
.         ************ DELETE FORMACTION **********
.
OPRTPS30  PACK      KEY6,OPTPS001,CURRHOSP,SP70
          CALL      RDOPTPS1
          BRANCH    OVRCD,OPRTPS91
          CALL      DEOPTPS1
.
          MOVE      ZERO,EXIT
          GOTO      OPRTPS99
.
.         ************ DISPLAY FORMACTION **********
.
OPRTPS40  PACK      KEY6,OPTPS001,HOSPCODE,SP70    * Operating Rooms Item File
          CALL      RDOPTPS1
          IF        OVRCD=1
            CALL      CLRTPS00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Specialty Tray Preference Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRTPS99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRTPS99
.
OPRTPS91  MOVE      "Specialty Tray Preference record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTPS99
.
OPRTPS92  MOVE      "Specialty Tray Preference record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTPS99
.
OPRTPS93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRTPS99
.
OPRTPS99  RETURN
+
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRTPS00  MOVE      SP70,OPTPSPEC  * Specialty
          MOVE      SP70,OPTPTRPR  * Tray Preference
          MOVE      SP70,OPTPHOSP  * Hospital Id 
          MOVE      SP70,OPTPSPAR  * Spare variable
.
CLRTPS99  RETURN
+
.-----------------------------------------------------------
. Move cgi variables     
.-----------------------------------------------------------
MVOPTP00  MOVE      OPTPS001,OPTPSPEC  * Specialty
          MOVE      OPTPS002,OPTPTRPR  * Tray Preference
          MOVE      HOSPCODE,OPTPHOSP  * Hospital Id
.
MVOPTP99  RETURN
+
.-----------------------------------------------------------
. Doctors Preferences Details
.-----------------------------------------------------------
PRBF0000  BRANCH    FLDITMNO,PRBF0100,PRBF0200,PRBF0300,PRBF0400,PRBF0500:
                             PRBF0600,PRBF0700,PRBF0800,PRBF0900,PRBF1000:
                             PRBF1100
          GOTO      PRBF9999
.
PRBF0100  WRITE     HTMLFILE;OPDFCODE;  * Doctor Code
          GOTO      PRBF9999
.
PRBF0200  WRITE     HTMLFILE;OPDFPREF;  * Preference Code      
          GOTO      PRBF9999
.
PRBF0300  MOVE      "OG",CATEGORY
          MOVE      OPDFCLSS,CODE
          CALL      CODITM00
          GOTO      PRBF9999
.
PRBF0400  UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          BRANCH    F1,PRBF0410
          WRITE     HTMLFILE;OPDFTYPE; 
          GOTO      PRBF9999
.
PRBF0410  MOVE      "Tray",DESCTYPE
          MATCH     "1",OPDFTYPE
          IF        @EQUAL
            MOVE      "Item",DESCTYPE
          ENDIF
          MATCH     "2",OPDFTYPE
          IF        @EQUAL
.           MOVE      "Disposable Item",DESCTYPE
            MOVE      "Equipment",DESCTYPE
          ENDIF
          WRITE     HTMLFILE;DESCTYPE; 
          GOTO      PRBF9999
.
PRBF0500  UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          BRANCH    F1,PRBF0510
          WRITE     HTMLFILE;OPDFITEM; 
          GOTO      PRBF9999
.
PRBF0510  PACK      KEY15,OPDFITEM,SP70
          MOVE      SP70,ITEMDESC
.
          MOVE      OPDFTYPE,DIM1
          REP       "1~2~",DIM1
.
          MATCH     "~",DIM1
          IF        @EQUAL
.
            MATCH     "2",OPDFTYPE
            IF        @EQUAL
              PACK      KEY18,OPDFITEM,OPDFHOSP,SP70
              CALL      RDOPEQP1
              IF        OVRCD=0
                MOVE      OPEQDESC,ITEMDESC
              ENDIF
              GOTO      PRBF0550
            ENDIF
.
            MATCH     "1",OPCNPTMC
            GOTO      PRBF0520 IF NOT EQUAL
.
            IF        CFEETYP=FIVE
              MOVE      OPDFITEM,MISCCODE
              MOVE      OPDFHOSP,MISCHOSP
              CALL      GNZMDS00
              MOVE      MISCDESC,ITEMDESC
              GOTO      PRBF0550
            ELSE
              PACK      KEY9,OPDFITEM,SP70
              IF        IBCNMHOS = 1
                PACK      KEY3,WBSEHOSP,SP70
                CALL      RDPTHSP1
                BRANCH    OVRCD,PRBF0517
                PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
             ELSE
PRBF0517        PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
             ENDIF
             CALL      PATMCHRD
.
              IF        EXIT=ZERO
                MOVE      MDESC,ITEMDESC
                GOTO      PRBF0550
              ENDIF
.
            GOTO      PRBF0520
.
            ENDIF
.
PRBF0520    PACK      KEY15,OPDFITEM,SP70
            CALL      RDOPITE1
            IF        OVRCD=0
              MOVE      OPITDESC,ITEMDESC
.
            ENDIF
          ELSE
            PACK      KEY18,OPDFITEM,HOSPCODE,SP70
            CALL      RDOPTRA1
            IF        OVRCD=0
              MOVE      OPTHDESC,ITEMDESC
            ENDIF
          ENDIF
.
PRBF0550  WRITE     HTMLFILE;ITEMDESC; 
          GOTO      PRBF9999
.
PRBF0600  WRITE     HTMLFILE;OPDFQTY; 
          GOTO      PRBF9999
.
PRBF0700  CALL      TBPRB000            * Table of Doctors Preferences
          GOTO      PRBF9999
.
PRBF0800  CALL      STRAY000            * selection list of trays
          GOTO      PRBF9999
.
PRBF0900  CALL      LSPRB000            * List of Doctors Preferences
          GOTO      PRBF9999
.
PRBF1000  CALL      PREVDP00            
          GOTO      PRBF9999
.
PRBF1100  CALL      NEXTDP00           
          GOTO      PRBF9999
.
PRBF9999  RETURN
.----------------------------------------------------------------------
. Table of Preference Codes
.----------------------------------------------------------------------
TBPRB000  CALL      CRTM1000
.
          PACK      KEY37,DOCTCODE,PREFCODE,SP70
          CALL      RSOPDPF1
TBPRB100  CALL      RKOPDPF1
          BRANCH    OVRCD,TBPRB110
.
          MATCH     DOCTCODE,OPDFCODE
          GOTO      TBPRB110 IF NOT EQUAL
.
          MATCH     PREFCODE,OPDFPREF
          GOTO      TBPRB110 IF NOT EQUAL
.
          MATCH     HOSPCODE,OPDFHOSP
          GOTO      TBPRB100 IF NOT EQUAL
.
          MOVE      "OG",CATEGORY           * Type Of Implant
          MOVE      OPDFCLSS,CODE
          CALL      GETCOD00
.
          MOVE      TCFORM6,TEMPASS1
.
          PACK      TEMPKY37,OPDFCODE,OPDFPREF,OPDFCLSS,OPDFTYPE,OPDFITEM,OPDFHOSP,SP70
.
          PACK      KEY43,TEMPASS1,TEMPKY37,SP70
          CALL      RATMPPR1
          IF        OVRCD=1
            CALL      WRTMPPR1
          ENDIF
.
          GOTO      TBPRB100
.
TBPRB110  PACK      KEY43,SP70
          CALL      RSTMPPR1
TBPRB120  CALL      RKTMPPR1
          BRANCH    OVRCD,TBPRB999
.
          PACK      KEY37,TEMPKY37,SP70
          CALL      RDOPDPF1
          BRANCH    OVRCD,TBPRB120
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdatePrefItem('",HTMLLINK
          APPEND    OPDFCODE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    OPDFPREF,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    OPDFCLSS,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    OPDFTYPE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    OPDFITEM,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    OPDFHOSP,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          MOVE      SP70,ITEMDESC
          PACK      KEY18,OPDFITEM,OPDFHOSP,SP70
          CALL      RDOPTRA1
          IF        OVRCD=0
            MOVE      OPTHDESC,ITEMDESC
          ENDIF
.
          MOVE      "Tray",DESCTYPE
.
          MOVE      OPDFTYPE,DIM1
          REP       "1~2~",DIM1
.
          MATCH     "~",DIM1
          IF        @EQUAL
            MOVE      SP70,ITEMDESC
            MOVE      "Item",DESCTYPE
.
            MATCH     "2",OPDFTYPE
            IF        @EQUAL
              PACK      KEY18,OPDFITEM,OPDFHOSP,SP70
              CALL      RDOPEQP1
              IF        OVRCD=0
                MOVE      OPEQDESC,ITEMDESC
              ENDIF  
              GOTO      TBPRB300
            ENDIF
.
            MATCH     "1",OPCNPTMC
            IF        @EQUAL     
              IF        CFEETYP=FIVE
                MOVE      OPDFITEM,MISCCODE
                MOVE      OPDFHOSP,MISCHOSP
                CALL      GNZMDS00
                MOVE      MISCDESC,ITEMDESC
                GOTO      TBPRB300
              ELSE
                PACK      KEY9,OPDFITEM,SP70
                IF        IBCNMHOS = 1
                  PACK      KEY3,WBSEHOSP,SP70
                  CALL      RDPTHSP1
                  BRANCH    OVRCD,TBPRB170
                  PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
                ELSE
TBPRB170          PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
                ENDIF
                CALL      PATMCHRD
.
                IF        EXIT=ZERO
                  MOVE      MDESC,ITEMDESC
                  GOTO      TBPRB300
                ENDIF
.
                GOTO      TBPRB200
.
              ENDIF
.
            ENDIF
.
TBPRB200    PACK      KEY15,OPDFITEM,SP70
            CALL      RDOPITE1
            IF        OVRCD=0
              MOVE      OPITDESC,ITEMDESC
            ENDIF
.
          ENDIF
.
TBPRB300  MATCH     "2",OPDFTYPE
          IF        @EQUAL
.            MOVE      "Disposable Item",DESCTYPE
            MOVE      "Equipment",DESCTYPE
          ENDIF
          MOVE      "OG",CATEGORY
          MOVE      OPDFCLSS,CODE
          CALL      GETCOD00
.
          REP       " +",TEMPASS1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"<input type=hidden value='",TEMPASS1,"' >":
                             TDESC,"#",":
                             "#"",DESCTYPE,"#",":
                             "#"",ITEMDESC,"#",":
                             "#"",OPDFQTY,"#");"
          GOTO      TBPRB120
.
TBPRB999  CALL      KTM10000
.
          RETURN
+
.-----------------------------------------------------------
. Link to Prev Group Doctor Preferences Codes
.-----------------------------------------------------------
PREVDP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",DOCTCODE
          REP       " +",PREFCODE
          REP       " +",HOSPCODE
.
          WRITE     HTMLFILE;"oprweb04.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&doctcode=",DOCTCODE:
                                 "&prefcode=",PREFCODE:
                                 "&hospcode=",HOSPCODE;
.
          REP       "+ ",DOCTCODE
          REP       "+ ",PREFCODE
          REP       "+ ",HOSPCODE
.
PREVDP99  RETURN
+
.-----------------------------------------------------------
. Link to Next Group Doctor Preferences Codes
.-----------------------------------------------------------
NEXTDP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",DOCTCODE
          REP       " +",PREFCODE
          REP       " +",HOSPCODE
.
          WRITE     HTMLFILE;"oprweb04.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&doctcode=",DOCTCODE:
                                 "&prefcode=",PREFCODE:
                                 "&hospcode=",HOSPCODE;
.
          REP       "+ ",DOCTCODE
          REP       "+ ",PREFCODE
          REP       "+ ",HOSPCODE
.
NEXTDP99  RETURN
.----------------------------------------------------------------------
. Search List of Preference Codes
.----------------------------------------------------------------------
LSPRB000  CALL      CRTM1000
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY37,DOCTCODE,PREFCODE,SP70
          CALL      RSOPDPF1
LSPRB100  CALL      RKOPDPF1
          BRANCH    OVRCD,LSPRB110
.
          MATCH     DOCTCODE,OPDFCODE
          GOTO      LSPRB110 IF NOT EQUAL
.
          MATCH     PREFCODE,OPDFPREF
          GOTO      LSPRB110 IF NOT EQUAL
.
          MATCH     HOSPCODE,OPDFHOSP
          GOTO      LSPRB100 IF NOT EQUAL
.
          MOVE      "OG",CATEGORY           * Type Of Implant
          MOVE      OPDFCLSS,CODE
          CALL      GETCOD00
.
          MOVE      TCFORM6,TEMPASS1
.
          PACK      TEMPKY37,OPDFCODE,OPDFPREF,OPDFCLSS,OPDFTYPE,OPDFITEM:
                             OPDFHOSP,SP70
.
          PACK      KEY43,TEMPASS1,TEMPKY37,SP70
          CALL      RATMPPR1
          IF        OVRCD=1
            CALL      WRTMPPR1
          ENDIF
.
          GOTO      LSPRB100
.
LSPRB110  PACK      KEY43,SP70
          CALL      RSTMPPR1
LSPRB120  CALL      RKTMPPR1
          BRANCH    OVRCD,LSPRB999
.
          PACK      KEY37,TEMPKY37,SP70
          CALL      RDOPDPF1
          BRANCH    OVRCD,LSPRB120
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LSPRB120
          ENDIF
.
          MOVE      SP70,ITEMDESC
.
          MATCH     "0",OPDFTYPE
          GOTO      LSPRB130 IF EQUAL
.
          MATCH     "2",OPDFTYPE
          GOTO      LSPRB140 IF EQUAL
.
          MATCH     "1",OPDFTYPE
          GOTO      LSPRB200 IF EQUAL
.
          MOVE      OPDFTYPE,DESCTYPE
          MOVE      "Invalid Item Type",ITEMDESC
          GOTO      LSPRB600
. 
LSPRB130  MOVE      "Tray",DESCTYPE
.
          PACK      KEY18,OPDFITEM,OPDFHOSP,SP70
          CALL      RDOPTRA1
          IF        OVRCD=0
            MOVE      OPTHDESC,ITEMDESC
          ENDIF
.
          GOTO      LSPRB600
.
LSPRB140  MOVE      "Equipment",DESCTYPE
.
          PACK      KEY18,OPDFITEM,OPDFHOSP,SP70
          CALL      RDOPEQP1
          IF        OVRCD=0
            MOVE      OPEQDESC,ITEMDESC
            ENDIF
.
          GOTO      LSPRB600
.
LSPRB200  MOVE      "Item",DESCTYPE 
.
          MATCH     "1",OPCNPTMC
          GOTO      LSPRB400 IF NOT EQUAL
. 
          IF        CFEETYP=FIVE
            GOTO      LSPRB400
          ENDIF     
.
          PACK      KEY9,OPDFITEM,SP70
          IF        IBCNMHOS = 1
            PACK      KEY3,WBSEHOSP,SP70
            CALL      RDPTHSP1
            BRANCH    OVRCD,LSPRB170
            PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
          ELSE
LSPRB170    PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
          ENDIF
          CALL      PATMCHRD
.
          IF        EXIT=ZERO
            MOVE      MDESC,ITEMDESC
            GOTO      LSPRB600
          ENDIF
.
          GOTO      LSPRB450
.
LSPRB400  PACK      KEY37,OPDFITEM,SP70
          CALL      RSNZMCH3
LSPRB420  CALL      RKNZMCH3
          BRANCH    OVRCD,LSPRB450
.
          MOVE      OPDFITEM,DIM9
.
          MATCH     DIM9,NZMCMCHG
          GOTO      LSPRB450 IF NOT EQUAL
.
          MATCH     "1",NZMCACFL
          GOTO      LSPRB420 IF EQUAL
.
          MOVE      NZMCDESC,ITEMDESC
          GOTO      LSPRB600
.
LSPRB450  MOVE      "Invalid Item",ITEMDESC
          GOTO      LSPRB600 
.
LSPRB500  PACK      KEY15,OPDFITEM,SP70
          CALL      RDOPITE1
          IF        OVRCD=0
            MOVE      OPITDESC,ITEMDESC
          ENDIF
.
          GOTO      LSPRB600
.
LSPRB600  MOVE      "OG",CATEGORY
          MOVE      OPDFCLSS,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr><td>",TDESC,"</td>":
                             "<td>",DESCTYPE,"</td>":
                             "<td>",ITEMDESC,"</td>":
                             "<td align=center>",OPDFQTY,"</td>"
.
          MATCH     "0",OPDFTYPE
          IF        @EQUAL
            WRITE     HTMLFILE;"<td align=center>":
                               "<a href='javascript:showTray(#"",OPDFITEM:
                               "#",#"",HOSPCODE:
                               "#");'><img src='../images/MaintenanceIcon.gif'":
                               " class=Icon>":
                               "</a></td>":
                               "</tr>"
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp;</td>":
                               "</tr>"
          ENDIF
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      LSPRB120 IF NOT EQUAL
.
LSPRB999  CALL      KTM10000
.
          RETURN
.
.------------------------------------------------------------
.Nurse Search Routine
.------------------------------------------------------------
SRHNUR00  MOVE      "Nurse Search Engine",WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SRHNUR99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
SRHNUR99  RETURN
.
.------------------------------------------------------------
. Nurse Search
.------------------------------------------------------------
SNUR0000  BRANCH    FLDITMNO,SNUR0100,SNUR0200,SNUR0300,SNUR0400,SNUR0500:
                             SNUR0600
          GOTO      SNUR9999
.
SNUR0100  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          REP       "'~",KEYWORDS                                      *I-52107
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;"oprweb04.pbl?reportno=12":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&keywords=",KEYWORDS;
          REP       "~'",KEYWORDS                                      *I-52107
          GOTO      SNUR9999
.
SNUR0200  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          REP       "'~",KEYWORDS                                      *I-52107
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;"oprweb04.pbl?reportno=12":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&keywords=",KEYWORDS;
          REP       "~'",KEYWORDS                                      *I-52107
          GOTO      SNUR9999
.
SNUR0300  MOVE      ZERO,LNK2PRT    * Link to alternate Program
          CALL      SPTNKA00
          GOTO      SNUR9999
.
SNUR0400  MOVE      ONE,LNK2PRT    * Link to Parent
          CALL      SPTNKA00
          GOTO      SNUR9999
.
SNUR0500  WRITE     HTMLFILE;SP10;
          GOTO      SNUR9999
.
SNUR0600  MOVE      TWO,LNK2PRT    * Link to Window
          CALL      SPTNKA00
          GOTO      SNUR9999
.
SNUR9999  RETURN
.
.------------------------------------------------------------
. Display Nurse Results
.------------------------------------------------------------
.
SPTNKA00  WRITE     HTMLFILE;"<tr align=center>":
                             "<td class=HeadingCell colspan=4><b>":
                             "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                             "<td class=HeadingCell><b>Nurse Code</b></td>":
                             "<td class=HeadingCell><b>Name</b></td>":
                             "<td class=HeadingCell><b>Status</b>":
                             "</td></tr>"
.
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
.
          IF        LNK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY21,KEYWRD01,SP70
          CALL      RSOPNK2
SPTNKA10  CALL      RKOPNK2
          BRANCH    OVRCD,SPTNKA90
.
          MOVE      OPNKITM,KEY6
          CALL      RDOPNUR1
          BRANCH    OVRCD,SPTNKA10
.
          COMPARE   ONE,OPNRSTAT            * Inactive nurse?
          GOTO      SPTNKA10 IF EQUAL       * Yes, do not display
.
          CALL      SOPNKB00
          BRANCH    OVRCD,SPTNKA10,SPTNKA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTNKA10
          ENDIF
.
          MATCH     SP70,OPNRSNAM
          IF        @EQUAL
            MOVE      "&nbsp;",OPNRSNAM
          ENDIF
.
          MATCH     SP70,TDESC
          IF        @EQUAL
            MOVE      "&nbsp;",TDESC
          ENDIF
.
          SQUEEZE   OPNRGNAM
          PACK      NURSNAME,OPNRGNAM,SP1,OPNRSNAM
.
          CALL      JAVNUR00                                           *I-52107
.
          COMPARE   ZERO,OPNRSTAT
          IF        @EQUAL
            MOVE      "Active",KEY8
          ELSE
            MOVE      "Inactive",KEY8
          ENDIF
.
          BRANCH    LNK2PRT,SPTNKA20,SPTNKA30
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&itemkeys=",KEY9,">":
                               OPNRCODE,"</a></td>":
                               "<td>",NURSNAME,"</td></font>":
                               "<td>",KEY8,"</td>":
                             "</tr>"
.
          GOTO      SPTNKA80
.
SPTNKA20  REP       "#', ",OPNRSNAM
          REP       "#", ",OPNRGNAM
          RESET     OPNRSNAM
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",JAVFNAME:    *I-52107
                              "','",OPNRCODE,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              OPNRCODE,"</td>":
                              "<td>",NURSNAME,"</td>":
                              "<td>",KEY8,"</td>":
                             "</tr>"
.
          GOTO      SPTNKA80
.
SPTNKA30  WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><a href='":
                             "javascript:showMbs01(#"":
                              LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&mbsitemn=",KEY9,"#");'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              OPNRCODE,"</td>":
                              "<td>",NURSNAME,"</td>":
                              "<td>",KEY8,"</td>":
                             "</tr>"
.
SPTNKA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTNKA10 IF NOT EQUAL
SPTNKA90
SPTNKA99  RETURN
.
.------------------------------------------------------------
. Check Nurse Record
.------------------------------------------------------------
SOPNKB00  MATCH     KEYWRD01,OPNKKWD
          GOTO      SOPNKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY21,OPNKKWD,OPNKITM
            CALL      SOPNKC00
            BRANCH    EXIT,SOPNKB91
            MOVE      SAVKEY21,KEY21
            CALL      RDOPNK2
          ENDIF
.
SOPNKB90  MOVE      ZERO,OVRCD
          GOTO      SOPNKB99
SOPNKB91  MOVE      ONE,OVRCD
          GOTO      SOPNKB99
SOPNKB92  MOVE      TWO,OVRCD
SOPNKB99  RETURN
.
.------------------------------------------------------------
. Check for Matching Nurse Codes
.------------------------------------------------------------
SOPNKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY6,OPNKITM,SP70
.
SOPNKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SOPNKC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY21,OPNKITM,KEYWRDXX
          CALL      RDOPNK1               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SOPNKC10 IF EQUAL
.
          CALL      RKOPNK1               * Not Exact so Read Next Record
          BRANCH    OVRCD,SOPNKC90        * No Match So Exit No Match
          PACK      KEY6,OPNKITM,SP70
          MATCH     SAVKEY6,KEY6          * Match Key Fields
          GOTO      SOPNKC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     OPNKKWD,KEYWRDXX         * Check Key Word
          GOTO      SOPNKC90 IF NOT EQUAL * No Match So Exit
          GOTO      SOPNKC10              * Check Next Search Word
.
SOPNKC90  MOVE      ONE,EXIT
SOPNKC99  RETURN
.------------------------------------------------------------
. Format Nurse's Name (for Javascript)                                 *I-52107
.*** format the surname and given name by changing any ' to %60
.---------------------------------------------------------------
JAVNUR00  MOVE      OPNRGNAM,SAVEGNAM
          MOVE      OPNRSNAM,SAVESNAM
          CLEAR     DISPNAME
          MOVE      SP70,JAVFNAME
.
          MOVE      OPNRSNAM,JAVSNAME        * surname
          SCAN      "'",JAVSNAME             * find any apostrophies
          GOTO      JAVNUR10 IF NOT EQUAL
.
          MOVE      JAVSNAME,ENDNAME
          REP       "' ",ENDNAME             * remove the apostrophy
.
          LENSET    JAVSNAME
          RESET     JAVSNAME                 * get all characters before '
          MOVE      JAVSNAME,STRTNAME
.
          REP       "'%",STRTNAME
          STRIP     STRTNAME
          PACK      JAVSNAME,STRTNAME,SIXTY,ENDNAME,SP70 * formatted surname
.
JAVNUR10  MOVE      SP70,STRTNAME
          MOVE      SP70,ENDNAME
.
          MOVE      OPNRGNAM,JAVGNAME   * given name
          SCAN      "'",JAVGNAME        * find any apostrophies
          GOTO      JAVNUR20 IF NOT EQUAL
.
          MOVE      JAVGNAME,ENDNAME    * store all chars after apostrophy
          REP       "' ",ENDNAME        * remove the apostrophy
.
          LENSET    JAVGNAME
          RESET     JAVGNAME
          MOVE      JAVGNAME,STRTNAME   * store all chars before the '
.
          REP       "'%",STRTNAME
          STRIP     STRTNAME
          PACK      JAVGNAME,STRTNAME,SIXTY,ENDNAME,SP70  * formatted given name
.
JAVNUR20  PACK      JAVFNAME,JAVGNAME,SP1,JAVSNAME
.
JAVNUR99  RETURN
+
.-----------------------------------------------------------
. Option 1 - Operating Room
.-----------------------------------------------------------
OPTP0000  BRANCH    FLDITMNO,OPTP0100,OPTP0200,OPTP0300,OPTP0400,OPTP0500:
                             OPTP0600,OPTP0700
          GOTO      OPTP9999
.
OPTP0100  MOVE      "ST",CATEGORY       * Specialty           
          MOVE      OPTPSPEC,CODE
          CALL      CODITM00
          GOTO      OPTP9999
.
OPTP0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OPTP0210
          
          WRITE     HTMLFILE;OPTPTRPR;  * Tray Preference
          GOTO      OPTP9999
.
OPTP0210  PACK      KEY18,OPTPTRPR,OPTPHOSP,SP70
          CALL      RDOPTRA1
          BRANCH    OVRCD,OPTP9999
.
          WRITE     HTMLFILE;OPTHDESC;
          GOTO      OPTP9999
.
OPTP0300  MOVE      ZERO,LNK2PRT * Display with Link
          CALL      ORTPS000     * Table of Operating Rooms Specialty Tray Pref
          GOTO      OPTP9999
.
OPTP0400  CALL      NEXTPR00     * Link to Next Set of Codes
          GOTO      OPTP9999
.
OPTP0500  CALL      PREVPR00     * Link to Prev Set of Codes
          GOTO      OPTP9999
.
OPTP0600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OPTP0610,OPTP0620
.
          MATCH     SP70,OPTPHOSP
          GOTO      OPTP9999 IF EQUAL
.
          PACK      KEY3,OPTPHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,OPTP0610
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      OPTP9999
.
OPTP0610  WRITE     HTMLFILE;OPTPHOSP;
          GOTO      OPTP9999
.
OPTP0620  MOVE      OPTPHOSP,DEFTHOSP
          CALL      HSPSEL00
          GOTO      OPTP9999
.
OPTP0700  MOVE      WBSEHOSP,DEFTHOSP
          CALL      HSPSEL00
          GOTO      OPTP9999
.
OPTP9999  RETURN
+
.------------------------------------------------------------
. Table of Operating Rooms - Specialty Tray Preference
.------------------------------------------------------------
ORTPS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      TPHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button
.
.          IF        PRVIFLAG = 1
.            MATCH     SP70,PREVIKEY
.            IF        !@EQUAL
.              CALL      GPRTPS00            * Get previous records key
.              MOVE      ZERO,STARTNUM       * Reset counters to zero
.              MOVE      ZERO,RECNUMB
.              MOVE      ZERO,DISNUMB
.              PACK      PREVIKEY,SP70
.              GOTO      ORTPS050
.            ENDIF
.            PACK      KEY3,SP70   * Go back to start if at
.            MOVE      ZERO,STARTNUM         * the end of the list
.            MOVE      ZERO,RECNUMB
.            MOVE      ZERO,DISNUMB
.            GOTO      ORTPS050
.          ENDIF
.
.         * Next button
.
.          MATCH     SP70,NEXTIKEY
.          IF        !@EQUAL
.            CALL      GNXTPS00              * Check to see if at the last rec
.            PACK      KEY3,NEXTIKEY,SP70
.            MOVE      ZERO,STARTNUM         * Reset counters
.            MOVE      ZERO,RECNUMB
.            MOVE      ZERO,DISNUMB
.            PACK      NEXTIKEY,SP70
.            GOTO      ORTPS050
.          ENDIF
.
          PACK      KEY6,SP70
ORTPS050  CALL      RSOPTPS1
ORTPS100  CALL      RKOPTPS1
          BRANCH    OVRCD,ORTPS900
.
          PACK      NEXTIKEY,OPTPSPEC,SP70
          MATCH     SP70,PREVIKEY
          IF        @EQUAL
            PACK      PREVIKEY,OPTPSPEC,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ORTPS100
          ENDIF
.
          CALL      TPROW000      *  Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ORTPS100 IF NOT EQUAL
          GOTO      ORTPS999
.
ORTPS900  CALL      NOMORE00      * Display No More Records Message
.
ORTPS999  RETURN
+
.--------------------------------------------------------------------------
. GPRTPS00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
GPRTPS00  PACK      SAVKEY6,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          PACK      KEY6,PREVIKEY,Z70
          CALL      RSOPTPS1                    * Position for batch #
GPRTPS10  CALL      RPOPTPS1                    * read next record
          BRANCH    OVRCD,GPRTPS91              * end of file
.
GPRTPS15  PACK      SAVKEY6,OPTPSPEC,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      GPRTPS90 IF EQUAL
.
          GOTO      GPRTPS10
.
GPRTPS90  MOVE      SAVKEY6,KEY6          * New start key for display
          SUB       ONE,NORECORD
          GOTO      GPRTPS99
.
GPRTPS91  PACK      KEY3,SP70
          SUB       ONE,NORECORD
          GOTO      GPRTPS99
.
GPRTPS99  RETURN
+
.------------------------------------------------------------
. GNXTPS00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
GNXTPS00  PACK      KEY6,NEXTIKEY,SP70
          CALL      RSOPTPS1                    * Position for batch #
          CALL      RKOPTPS1                    * read next record
          BRANCH    OVRCD,GNXTPS90               * end of file
.
          GOTO      GNXTPS99
.
GNXTPS90  PACK      NEXTIKEY,SP70
          GOTO      GNXTPS99                * No more record goto first record
.
GNXTPS99  RETURN
+
.------------------------------------------------------------
. Specialty Tray Preference Table Details (TABLE HEADING)
.------------------------------------------------------------
TPHED000  IF        IBCNMHOS = 1
            WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "Specialty</td>":
                               "<td class=HeadingCell width=30%>":
                               "Description</td>":
                               "<td class=HeadingCell width=30%>":
                               "Tray Preference</td>":
                               "<td class=HeadingCell width=20%>":
                               "Hospital</td>":
                               "</tr>"
          ELSE
            WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "Specialty</td>":
                               "<td class=HeadingCell width=40%>":
                               "Description</td>":
                               "<td class=HeadingCell width=40%>":
                               "Tray Preference</td>":
                               "</tr>"
          ENDIF
.
TPHED999  RETURN
.------------------------------------------------------------
. Specialty Tray Preference Table (TABLE ROW)
.------------------------------------------------------------
TPROW000  PACK      KEY5,ANSS,ANST,OPTPSPEC,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      "Invalid Specialty",TDESC
          ENDIF
.
          PACK      KEY18,OPTPTRPR,OPTPHOSP,SP70
          CALL      RDOPTRA1
          IF        OVRCD=1
            MOVE      "Invalid Tray",OPTHDESC
          ENDIF
.
          MOVE      SP70,HOSPNAME
          MATCH     SP70,OPTPHOSP
          IF        !@EQUAL
            PACK      KEY3,OPTPHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD = 0
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail13":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&optps001=",OPTPSPEC:
                             "&hospcode=",OPTPHOSP,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             OPTPSPEC,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",OPTHDESC,"</td>";
.
          IF        IBCNMHOS = 1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"</td>":
                               "</tr>"
          ELSE
            WRITE     HTMLFILE;"</tr>"
          ENDIF
.
          GOTO       TPROW999
.
TPROW999  RETURN
.
.------------------------------------------------------------
. Hospital Selection List
.------------------------------------------------------------
HOSSEL00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          BRANCH    F1,HOSSEL10,HOSSEL20
.
          PACK      KEY3,OPRMHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,HOSSEL99
.
          WRITE     HTMLFILE;PTHSHOSP;
          GOTO      HOSSEL99
.
HOSSEL10  PACK      KEY3,OPRMHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,HOSSEL99
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      HOSSEL99
.
HOSSEL20  CALL      HSEL0000
.
HOSSEL99  RETURN
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
HSEL0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSEL0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSEL9999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     OPRMHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSEL0100
.
HSEL9999  RETURN
+
.-------------------------------------------------------------------
. Doctors Preference Comments
.-------------------------------------------------------------------
OPRPRC00  MATCH     SP70,DOCTCODE
          GOTO      OPRPRC94 IF EQUAL
.
          MOVE      DOCTCODE,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,OPRPRC94
.
          MATCH     SP70,PREFCODE
          GOTO      OPRPRC95 IF EQUAL
          PACK      KEY18,DOCTCODE,PREFCODE,HOSPCODE,SP70
          CALL      RDOPDPH1
          BRANCH    OVRCD,OPRPRC95
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRPRC40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      OPRPRC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      OPRPRC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      OPRPRC30 IF EQUAL
.
          GOTO      OPRPRC93
.
.         ************ ADD FORMACTION ***********
.
OPRPRC10  RJUSTIFY  OPPCM004
          MOVE      OPPCM004,OPPCLINE
.
          PACK      KEY24,OPPCM001,OPPCM002,OPPCM003,OPPCLINE,HOSPCODE,SP70
          CALL      RDOPPCM1
          COMPARE   ZERO,OVRCD
          GOTO      OPRPRC92 IF EQUAL
.
          CALL      CLOPRPCM
          CALL      MVOPPC00
.
          MOVE      SP70,OPPCSPAR
.
          PACK      KEY24,OPPCM001,OPPCM002,OPPCM003,OPPCM004,HOSPCODE,SP70
          CALL      WROPPCM1
          MOVE      ZERO,EXIT
          GOTO      OPRPRC99
.
.         ************ UPDATE FORMACTION **********
.
OPRPRC20  PACK      KEY24,OPPCM001,OPPCM002,OPPCM003,OPPCM004,HOSPCODE,SP70
          CALL      RDOPPCM1
          BRANCH    OVRCD,OPRPRC91
.
          MOVE      OPPCM005,OPPCDESC
.
          CALL      UPOPPCM1
          MOVE      ZERO,EXIT
          GOTO      OPRPRC99
.
.         ************ DELETE FORMACTION **********
.
OPRPRC30  PACK      KEY24,OPPCM001,OPPCM002,OPPCM003,OPPCM004,HOSPCODE,SP70
          CALL      RDOPPCM1
          BRANCH    OVRCD,OPRPRC91
.
          CALL      DEOPPCM1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      OPRPRC99
.
OPRPRC40  PACK      KEY24,DOCTCODE,PREFCODE,OPPCM003,OPPCM004,HOSPCODE,SP70
          CALL      RDOPPCM1
          IF        OVRCD=1
            CALL      CLOPRPCM
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Doctors Preference Comments Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRPRC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRPRC99
.
OPRPRC91  MOVE      "Doctor Preference Comments Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRC99
.
OPRPRC92  MOVE      "Doctor Preference Comments Record exists. Check Line Number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRC99
.
OPRPRC93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRC99
.
OPRPRC94  MOVE      "Invalid Doctors Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRC99
.
OPRPRC95  MOVE      "Invalid Preference Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRPRB99
.
OPRPRC99  RETURN
.
.-----------------------------------------------------------
. Doctors Preferences Comments Tags
.-----------------------------------------------------------
PRCF0000  BRANCH    FLDITMNO,PRCF0100,PRCF0200,PRCF0300,PRCF0400,PRCF0500
          GOTO      PRCF9999
.
PRCF0100  CALL      TBPRC000            * Table of Doctors Preferences
          GOTO      PRCF9999            * Comments
.
PRCF0200  WRITE     HTMLFILE;DOCTCODE;  
          GOTO      PRCF9999
.
PRCF0300  WRITE     HTMLFILE;PREFCODE;
          GOTO      PRCF9999 
.
PRCF0400  WRITE     HTMLFILE;HOSPCODE;
          GOTO      PRCF9999
.
PRCF0500  MATCH     SP70,HOSPCODE
          GOTO      PRCF9999 IF EQUAL
.
          PACK      KEY3,HOSPCODE,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,PRCF9999
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      PRCF9999
.
PRCF9999  RETURN
.----------------------------------------------------------------------
. Table of Preference Comments
.----------------------------------------------------------------------
TBPRC000  PACK      KEY24,DOCTCODE,PREFCODE,SP70
          CALL      RSOPPCM1
TBPRC100  CALL      RKOPPCM1
          BRANCH    OVRCD,TBPRC999
.
          MATCH     DOCTCODE,OPPCCODE
          GOTO      TBPRC999 IF NOT EQUAL
.
          MATCH     PREFCODE,OPPCPREF
          GOTO      TBPRC999 IF NOT EQUAL
.
          MATCH     HOSPCODE,OPPCHOSP
          GOTO      TBPRC100 IF NOT EQUAL
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdatePrefComment('",HTMLLINK
          APPEND    OPPCCODE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    OPPCPREF,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    OPPCCLSS,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    OPPCLINE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    OPPCHOSP,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          MOVE      "OG",CATEGORY
          MOVE      OPPCCLSS,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",TDESC,"#",":
                             "#"",TCFORM6,"#",":
                             "#"",OPPCLINE,"#",":
                             "#"",OPPCDESC,"#");"
          GOTO      TBPRC100
.
TBPRC999  RETURN
+
.
.
.
MISC9999  RETURN
.
.--------------------------------------------------------------------
. Display Alert & Close Window  (no refresh) for Copy All Doctor Pref
.--------------------------------------------------------------------
WINAL100  CALL      OPENHTML
          BRANCH    EXIT,WINAL199
          MOVE      "Copy Created",WEBTITLE
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " alert(#"",WEBTITLE,"#");":
                             " if (self.name.match(/PopUpFrame/)) {":
  "  parent.document.getElementById('PopUpScreen').style.display=#"none#"; ":
                             "} else { self.close() }":
                             "}":
                             "</script>"
          CALL      CLOSHTML     * End of Document
WINAL199  RETURN
+
.*****************************************************************************
.*        Create Tempfile B                                                  *
.*****************************************************************************
CRTM1000  CALL      KTM10000
.
          CLEAR     DIM100
          APPEND    "isbuild ",DIM100
          APPEND    FNAMEB,DIM100
          APPEND    " 44 U1-6,7-43",DIM100
          RESET     DIM100
          EXECUTE   DIM100,TASKID
          OPEN      TMPPRFR1,FNAMEB
.
          PACK      KEY43,SP70
          CALL      RSTMPPR1
CRTM1100  CALL      RKTMPPR1
          BRANCH    OVRCD,CRTM1999
.
          CALL      DETMPPR1
          GOTO      CRTM1100
.
CRTM1999  RETURN
.
.*****************************************************************************
.*        Kill Tempfile                                                      *
.*****************************************************************************
KTM10000  CLOSE     TMPPRFR1
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEB,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
KTM19999  RETURN
+
.------------------------------------------------------------
. Theatre Week Cycle Number Maintenance: Add, Update, Delete, Display
.------------------------------------------------------------
OPRWCN00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      OPRWCN40 IF EQUAL
.
          MATCH     "A",UPDTTYPE        * Add formaction
          GOTO      OPRWCN10 IF EQUAL
.
          MATCH     "U",UPDTTYPE        * Update formaction
          GOTO      OPRWCN20 IF EQUAL
.
          MATCH     "D",UPDTTYPE        * Delete formaction
          GOTO      OPRWCN30 IF EQUAL
.
          GOTO      OPRWCN93
.
.         ************ ADD FORMACTION ***********
.
OPRWCN10  CALL      CLOPRWCN            * Clear file vars
.
          PACK      KEY11,OPWCN001,OPWCN002,SP70
          CALL      RDOPWCN1
          COMPARE   ZERO,OVRCD
          GOTO      OPRWCN92 IF EQUAL
.
          CALL      MVOPWC00            * Move input variables to file variables
.
          CALL      IBACLOCK
          PACK      OPWCCDAT,CCC,CYY,CMM,CDD     * Set created by fields
          REP       " 0",OPWCCDAT
          MOVE      CTIMEIS,OPWCCTIM
          MOVE      USERID,OPWCCUID
.
          CALL      WROPWCN1            * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRWCN99
.
.         ************ UPDATE FORMACTION **********
.
OPRWCN20  PACK      KEY11,OPWCN001,OPWCN002,SP70
          CALL      RDOPWCN1
          BRANCH    OVRCD,OPRWCN91
.
          CALL      MVOPWC00            * Move input variables to file variables
.
          CALL      UPOPWCN1            * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      OPRWCN99
.
.         ************ DELETE FORMACTION **********
.
OPRWCN30  PACK      KEY11,OPWCN001,OPWCN002,SP70
          CALL      RDOPWCN1
          BRANCH    OVRCD,OPRWCN91
.
          CALL      DEOPWCN1
.
          MOVE      ZERO,EXIT
          GOTO      OPRWCN99
.
.         ************ DISPLAY FORMACTION **********
.
OPRWCN40  PACK      KEY11,OPWCN001,OPWCN002,SP70
          CALL      RDOPWCN1
          IF        OVRCD=1
            CALL      CLOPRWCN          * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Theatre Week Cycle Number Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRWCN99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OPRWCN99
.
OPRWCN91  MOVE      "Theatre Week Cycle Number record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRWCN99
.
OPRWCN92  MOVE      "Theatre Week Cycle Number record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRWCN99
.
OPRWCN93  MOVE      "Theatre Invalid Form Action",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRWCN99
.
OPRWCN99  RETURN
+
.-----------------------------------------------------------
. General Tags
.-----------------------------------------------------------
GTAG0000  BRANCH    FLDITMNO,GTAG0100,GTAG0200,GTAG0300,GTAG0400
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      GTAG9999
.
GTAG0100  MOVE      "ST",CATEGORY
          MOVE      STARTKEY,CODE
          CALL      CODITM00
          GOTO      GTAG9999
.
GTAG0200  CALL      TWCTAB00      * Theatre week cycle list
          GOTO      GTAG9999
.
GTAG0300  CALL      PREVPR00
          GOTO      GTAG9999
.
GTAG0400  CALL      NEXTPR00
          GOTO      GTAG9999
.
GTAG9999  RETURN
+
.------------------------------------------------------------
. Table of theatre week cycle numbers
.------------------------------------------------------------
TWCTAB00  IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,STARTKEY
          IF        @EQUAL
            PACK      KEY11,Z70
          ELSE
            PACK      KEY11,STARTKEY,Z70
          ENDIF
          CALL      RSOPWCN2            * Position on Startkey
TWCTAB10  CALL      RPOPWCN2            * Read on first Startkey found
          BRANCH    OVRCD,TWCTAB90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TWCTAB10
          ENDIF
.
          CALL      TWCROW00            * Output table row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TWCTAB10 IF NOT EQUAL
.
          GOTO      TWCTAB99
.
TWCTAB90  CALL      NOMORE00      * Display No More Records Message
.
TWCTAB99  RETURN
+
.------------------------------------------------------------
. Draw theatre week cycle number row               
.------------------------------------------------------------
TWCROW00  UNPACK    OPWCEFFD,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      "ST",CATEGORY
          MOVE      OPWCUNIT,CODE
          CALL      GETCOD00
.
          UNPACK    OPWCCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          PACK      KEY10,OPWCCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      OPWCCUID,WBSENAM
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<img src=../images/MaintenanceIcon.gif ":
                             "class=ListIcon ":
                             "onclick=#"EditWeekCycle('",DISPDATE,"','":
                               OPWCUNIT,"');#"> ":
                             DISPDATE,"</td>":
                             "<td align=left nowrap>",TDESC,"</td>":
                             "<td align=left>",OPWCWEEK,"</td>":
                             "<td align=left>",WBSENAM,SP1:
                             DISPDAT1,SP1,OPWCCTIM,"</td>":
                             "</tr>"
          GOTO      TWCROW99
.
TWCROW99  RETURN
+
.*****************************************************************************
.*        Tempfile B I/O Subroutines                                         *
.*****************************************************************************
RATMPPR1  MOVE      ZERO,OVRCD
          RESET     KEY43
          READ      TMPPRFR1,KEY43;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RSTMPPR1  RESET     KEY43
          READ      TMPPRFR1,KEY43;;
          RETURN
.
RDTMPPR1  MOVE      ZERO,OVRCD
          RESET     KEY43
          READ      TMPPRFR1,KEY43;TEMPASS1,TEMPKY37
          GOTO      OVERCOND IF OVER
          RETURN
.
RKTMPPR1  MOVE      ZERO,OVRCD
          READKS    TMPPRFR1;TEMPASS1,TEMPKY37
          GOTO      OVERCOND IF OVER
          RETURN
.
RPTMPPR1  MOVE      ZERO,OVRCD
          READKP    TMPPRFR1;TEMPASS1,TEMPKY37
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTMPPR1  RESET     KEY43
          WRITE     TMPPRFR1,KEY43;TEMPASS1,TEMPKY37
          RETURN
.
DETMPPR1  RESET     KEY43
          DELETE    TMPPRFR1,KEY43
          RETURN
+
.------------------------------------------------------------
PSEL00
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.------------------------------------------------------------------------------
. Hospital Selection for Doctor code
. DEFTHOSP - Defaulted hospital for hospital selection list 
. DOCTCODE - Doctor code
. USERID   - User id
.------------------------------------------------------------------------------
HSPSEL00  CALL      SMULTA00
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HSPSEL20  CALL      RKPTHSP1
          BRANCH    OVRCD,HSPSEL99
.
          IF        MULHOSCT = 0
            GOTO      HSPSEL40
          ENDIF
.
          MOVE      ZERO,F3
          WHILE     F3 < MULHOSCT
            ADD       ONE,F3
            MATCH     PTHSHOSP,MULHOSAR[F3]
            GOTO      HSPSEL40 IF EQUAL 
          DO
.          
          GOTO      HSPSEL20 
.
HSPSEL40  PACK      KEY13,USERID,SP70                * All hospital access
          CALL      RDMLSEC1
          IF        OVRCD=1
            PACK      KEY13,USERID,PTHSHOSP,SP70     * This hospital access
            CALL      RDMLSEC1
            BRANCH    OVRCD,HSPSEL20
          ENDIF
. 
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     DEFTHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
.
          GOTO      HSPSEL20
.
HSPSEL99  RETURN
.
.------------------------------------------------------------------------------
. Setup multi hospital array for HCP
.------------------------------------------------------------------------------
SMULTA00  MOVE      ZERO,MULHOSCT
.
          WHILE     MULHOSCT < 100
            ADD       ONE,MULHOSCT
            MOVE      SP70,MULHOSAR[MULHOSCT]
          DO
.
          MOVE      ZERO,MULHOSCT 
          PACK      KEY13,DOCTCODE,SP70
          CALL      RSMLHCP2
SMULTA20  CALL      RKMLHCP2 
          BRANCH    OVRCD,SMULTA99
.
          MATCH     DOCTCODE,MLHCHCPC
          GOTO      SMULTA99 IF NOT EQUAL
.
          ADD       ONE,MULHOSCT
          MOVE      MLHCHOSP,MULHOSAR[MULHOSCT]
.
          GOTO      SMULTA20
.
SMULTA99  RETURN
.
.------------------------------------------------------------------------------
. Hospital Selection
. DEFTHOSP - Defaulted hospital for hospital selection list
. USERID   - User id
.------------------------------------------------------------------------------
HSPSEN00  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSPSEN20  CALL      RKPTHSP1
          BRANCH    OVRCD,HSPSEN99
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     DEFTHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
.
          GOTO      HSPSEN20
.
HSPSEN99  RETURN
+
.------------------------------------------------------------------------------
          INC       IBAWEBCD
.
          INC       MLTSECIO/INC   * Hospital access
          INC       MLTHCPIO/INC
          INC       NZPMCHIO/INC
          INC       OPRAVEIO/INC   * Operation Average
          INC       OPRNKIPR       * Operating Room - Nurses Keyword 
          INC       OPRDPHIO/INC       * doctors preference header
          INC       OPRDPFIO/INC       * doctors preference detail
          INC       OPROPRIO/INC   * Operating Room I/O
          INC       OPRORAIO/INC   * Operating Room Available 
          INC       OPRNKIIO/INC   * Operating Room - Nurses Keyword IO File
          INC       OPRNURIO/INC   * Operating Room - Nurses IO File
          INC       OPREXPIO/INC   * Operating Room - Expensive Item IO File
          INC       OPREQPIO/INC   * Operating Room - Equipment IO File
          INC       OPRITEIO/INC   * Operating Room - Item IO File
          INC       OPRPCMIO/INC
          INC       OPRTRAIO/INC   * Operating Room - Tray File IO
          INC       OPRTRBIO/INC   * Operating Room - Tray Detail File IO
          INC       OPRTPSIO/INC   * Operating Room - Specialty Tray Preference
          INC       OPRSEMIO/INC   * Operating Room - Session Master(Schedule)
          INC       OPRSESIO/INC   * Operating Room - Session 
          INC       OPRCLIIO/INC   * Operating Room - Clinic File
          INC       OPRUAVIO/INC   * Operating Room - Unavailable Theatre file
          INC       OPRWCNIO/INC   * Theatre week cycle number
          INC       PATMCHIO/INC   * Miscellaneous Charges File IO 
          INC       PATDO1IO/INC   * Doctor File
          INC       PATHSPIO/INC   * Hospital File
          INC       PATITMIO/INC   * Patient Item Details
.
          INC       PATITMRD
          INC       CLOPRPCM
          INC       CLOPRWCN
          INC       OPRPCMTM
          INC       OPREQPTM
          INC       OPRITETM
          INC       OPRWCNTM
          INC       PATDOCTM
          INC       PATDOCCD
          INC       PATMCHRD                * Miscellaneous Charges read routine
          INC       DAYOFWEK
          INC       NAMSTRCD
          INC       WEBDATCD
          INC       TFILENAM
.

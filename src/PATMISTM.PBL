.----------------------------------------------------------------------
. Modifications
.
.----------------------------------------------------------------------
. V12.00.01 21/05/2025  Ebon Clements   TSK 0955096
.           Alphanueric visit number changes
. V11.05.01 07/05/2025  Nikitha B      TSK 0959601
.           Added a call with USERID at VICMNT99 to restore logged in userid.
. V11.01.04 09/09/2021  Davin          TSK 0910121
.           Only display admission status if astat = 1,2,3,4,5 (misf0400)
. V11.01.03 28/05/2021  Thanh T        TSK 0901851
.           Added MISB2500 to return admission type HCP default
. V11.00.02 24/11/2020  Tracey Nguyen  TSK 0888079
.           Added MISB2400 tag for reason for admission tag of
.           ADIAG1/Desc from pmsvscaf table
. V11.00.01 28/02/2020  J.Tan          TSK 0838262
.           Added Effective from and to date to MBS Item file
. V10.15.01 14/10/2019  Thanh T.       TSK 0878880
.           Added MISB2300
.----------------------------------------------------------------------
. V10.13.01 20/08/2018  Ebon Clements  TSK 0861535
.           Added APLUR - Pluratily of baby tag
. V10.12.01 05/07/2018  Thanh T        TSK 0857684
.           Changed to display Occupational Group Desc instead of code in
.           Comments field
. V10.11.04 23/11/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments.
. V10.11.03 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments.
. V10.11.02 20/07/2017  Thanh T.       TSK 0821710
.           Audit Amission/outpatient visit comments
. V10.11.01 18/07/2017  Thanh T.       TSK 0821710
.           Audit Amission/outpatient visit comments
.----------------------------------------------------------------------
. V10.10.02  03/07/2017  Thanh T.       TSK 0821710
.            Admission/Outpatient Visit Comments enhancement
. V10.10.01  28/03/2017  B.G.Ackland    TSK 0835482 
.            FHIR Enable Fields for inclusion in FHIR response templates
. V10.06.01  12/03/2015  J.Tan          CAR 291492
.            Mods to display Leave type description
. V10.03.03  20/11/2013  Don Nguyen      CAR 293200
.            Added MISB2000 - Admission Status (numerical value)
. V10.03.02  12/12/2011  Mike Laming     CAR 255302
.            Added test for Pre-admission "Expected Bed" in MISB1700 (& MISF0600
. V10.03.01  12/12/2011  Mike Laming     CAR 255302
.            Added test for blank ABED in MISB1700
. V10.02.03  19/09/2011  Ebon Clements   CAR 250102
.            Added new tag for bed description short or code - MISB1700
. V10.02.02  08/09/2011  Nicole Torrisi  CAR 240560
.            Changed PTMSMGIN to use CODITM00
. V10.02.01  04/08/2011  Jill Parkinson  CAR 247832
.            Change output of current ward to allow short description
. V10.01.03  30/06/2011  Peter McMullen  CAR 240725
.            Change ward - list routine HSWA to now standard format 
. V10.01.02  03/02/2011  Jill Parkinson  CAR 233154
.            Added tag for PTMICONB
. V10.01.01  06/01/2011  Jill Parkinson  CAR 233088
.            Changed from afndmm to pmvxfndm
. V9.12.02   20/10/2009  Jill Parkinson  CAR 206624
.            Fixed tag for PTMIUSR9
. V9.12.01   20/08/2009  Davin           CAR 202101
.            Allow for option 3 (Unknown) in religious visit tag (misf1800)
. V9.10.04   02/07/2008  Mike Laming     CAR 155083
.            Changed read of PATVADaf to use index 2 Alpha sequence at ATRS0000
. V9.10.03   27/06/2008  Ebon Clements   CAR 171757
.            Added admission comment available tag
. V9.10.02   19/06/2008  Mike Laming     CAR 151025
.            Added tag for PTREMOBL (Person Responsible for Acct. Mobile)
. V9.10.01   19/05/2008  Ebon Clements   CAR 162057
.            Changed PTMIDOFR to use CODITM00
. V9.09.02   07/03/2008  J.Tan           CAR 156964
.            Default Casemix payment from system parameter
. V9.09.01   27/11/2007  Peter McMullen  CAR 154849
.            Bypass write of ATIME if it's blank
. V9.08.03   08/05/2007  Mike Laming  CAR 137125 HDP 2007 DRG 5.2
.            Mods to PATDGWFD - Add field PTDWDRGV (add to Keys)
. V9.08.02   28/11/2006  Ebon Clements CAR 120011
.            Added PTMIFINV - follow-up for implant invoicing
. V9.08.01   04/10/2006  Jill Habasque CAR 120004
.            Added PTMICRCD - Credit card details on file
. V9.05.01   05/04/2006  Ebon Clements CAR 100159
.            Added multi hospital test to ward/bed selection lists
. V9.05.B01  28/02/2006  Ebon Clements CAR 96001
.            Added semi colon to html file write in MISF8600
. V9.04.02   27/01/2005  Ebon Clements CAR 56340
.            Added semi colon to html file write in MISF0200
. V9.04.01   27/09/2004  Jill Habasque CAR 53783
.            Fixed output of ptmioper
. V9.03.01   06/07/2004  Jill Habasque CAR 51060
.            Added output of PTMIDFAS
. V9.02.17   29/09/2003  Jill Habasque CAR 43296
.            Added use of PTCNGEST
. V9.02.16   02/04/2003 J.Tan
.            Set up the default of Pre-admission ward
. V9.02.15   11/03/2003 J.Tan
.            Default ward to the HDP equivalent of Admitting point
. V9.02.14   07/02/2003 Tonii CAR 35992
.            Mods in MISF1420 (Health fund) to check for inactive codes before
.            displaying in selection list
. V9.02.13   06/11/2002 Peter Vela     SRF 22829
.            Improved Mods to functionality for Contract Type and Role in 
.            patweb8901030
. V9.02.12   01/11/2002 Peter Vela     SRF 22829
.            Mods to functionality for Contract Type and Role in patweb8901030
. V9.02.11   08/10/2002 Peter Vela     SRF 17693
.            Mods to implement selection list for ward field in patweb8904002
. V9.02.10   01/08/2002 J.Tan      
.            Fixed contract details from patasfaf file
. V9.02.09   24/07/2002 J.Tan      
.            Added contract details from patasfaf file
. V9.02.08   14/06/2002 J.Tan      
.            Mods to GST applicable field
. V9.02.07   27/05/2002 J.Tan      
.            Changes for casemix billing
. V9.02.06   13/05/2002 J.Tan      
.            Added Casemix code
. V9.02.05   15.01.2002 Pat Dirito 
.            Added ACODDTE - Date Coding Complete  
. V9.02.04   07.11.2001 Ebon Clements 
.            Changed Referring HCP tag to display name and code
. V9.02.03   18.10.2001 Jill Habasque 
.            Added expected bed
. V9.02.02   27.09.2001 Ebon Clements 
.            Added new tag for display of transer source and description
. 15.08.2001 Jill Habasque
.            Added "selected" for ATRS0000       
.------------------------------------------------------------
. Add Admission Field
.------------------------------------------------------------
MISF0000  BRANCH    FLDITMNO,MISF0100,MISF0200,MISF0300,MISF0400,MISF0500:
                             MISF0600,MISF0700,MISF0800,MISF0900,MISF1000:
                             MISF1100,MISF1200,MISF1300,MISF1400,MISF1500:
                             MISF1600,MISF1700,MISF1800,MISF1900,MISF2000:
                             MISF2100,MISF2200,MISF2300,MISF2400,MISF2500:
                             MISF2600,MISF2700,MISF2800,MISF2900,MISF3000:
                             MISF3100,MISF3200,MISF3300,MISF3400,MISF3500:
                             MISF3600,MISF3700,MISF3800,MISF3900,MISF4000:
                             MISF4100,MISF4200,MISF4300,MISF4400,MISF4500:
                             MISF4600,MISF4700,MISF4800,MISF4900,MISF5000:
                             MISF5100,MISF5200,MISF5300,MISF5400,MISF5500:
                             MISF5600,MISF5700,MISF5800,MISF5900,MISF6000:
                             MISF6100,MISF6200,MISF6300,MISF6400,MISF6500:
                             MISF6600,MISF6700,MISF6800,MISF6900,MISF7000:
                             MISF7100,MISF7200,MISF7300,MISF7400,MISF7500:
                             MISF7600,MISF7700,MISF7800,MISF7900,MISF8000:
                             MISF8100,MISF8200,MISF8300,MISF8400,MISF8500:
                             MISF8600,MISF8700,MISF8800,MISF8900,MISF9000:
                             MISF9100,MISF9200,MISF9300,MISF9400,MISF9500:
                             MISF9600,MISF9700,MISF9800,MISF9900
. *CODE ADDED BY HPS 
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MISF9999
.
MISF0100  WRITE     HTMLFILE;AADMNO;
          GOTO      MISF9999
MISF0200  MATCH     ADATE,SP70 
          GOTO      MISF9999 IF EQUAL   
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          IF        FHIRTYPE=0
            WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          ELSE
            WRITE     HTMLFILE;CCENT,CYEAR,"-",CMON,"-",CDAY;
          ENDIF
          GOTO      MISF9999
MISF0300  MATCH     ATIME,SP70 
          GOTO      MISF9999 IF EQUAL   
          WRITE     HTMLFILE;ATIME;
          GOTO      MISF9999
MISF0400  BRANCH    ASTAT,MISF0410,MISF0420,MISF0430,MISF0440,MISF0450
          GOTO      MISF9999                     * TSK 0910121
MISF0410  MOVE      "Pre-Admission   ",TDESC
          IF        FHIRTYPE=1
            WRITE     HTMLFILE;"planned";
            GOTO      MISF9999
          ENDIF
          GOTO      MISF0490
MISF0420  MOVE      "Current         ",TDESC
          IF        FHIRTYPE=1
            WRITE     HTMLFILE;"arrived";
            GOTO      MISF9999
          ENDIF
          GOTO      MISF0490
MISF0430  MOVE      "Discharged      ",TDESC
          IF        FHIRTYPE=1
            WRITE     HTMLFILE;"finished";
            GOTO      MISF9999
          ENDIF
          GOTO      MISF0490
MISF0440  MOVE      "On-Leave        ",TDESC
          IF        FHIRTYPE=1
            WRITE     HTMLFILE;"onleave";
            GOTO      MISF9999
          ENDIF
          GOTO      MISF0490
MISF0450  MOVE      "Cancelled       ",TDESC
          IF        FHIRTYPE=1
            WRITE     HTMLFILE;"cancelled";
            GOTO      MISF9999
          ENDIF
          GOTO      MISF0490
MISF0490  WRITE     HTMLFILE;TDESC;
          GOTO      MISF9999
.
MISF0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,ADMISSNO
          GOTO      MISF9999 IF EQUAL
.
          MATCH     ZEROVISN,AADMNO
          GOTO      MISF9999 IF EQUAL
.
.         BRANCH    MISSFLAG,MISF9999             * D SRF 33646
          MATCH     SP70,AWARD
          IF        @EQUAL
            PACK      KEY14,AADMNO,SP70
            CALL      RDSWARD4
            CALL      RDKWARD4
            IF        OVRCD=0
              MATCH     WSTBY,AADMNO
              IF        @EQUAL
                PACK      KEY6,WWARD,SP70
                GOTO      MISF0505
              ENDIF
            ENDIF
            IF        ASTAT=1
              MOVE      PTMIXWRD,AWARD            * use exp.ward for pre-adm.
            ENDIF
.           OPEN      PMSVX1A1,"pmsvx1af"
.           MOVE      AADMNO,KEY8
.           CALL      RDPMVX11
.           BRANCH    OVRCD,MISF9999
.           MOVE      "ap",KEY2                   * default to admitting point
.           PACK      KEY5,KEY2,PMVXAPWD
.           CALL      RDCODE1
.           BRANCH    OVRCD,MISF9999
.           PACK      AWARD,THCSCOD,SP10
            PACK      KEY6,AWARD,SP70
          ELSE
            PACK      KEY6,AWARD,SP70
          ENDIF
.
MISF0505  CALL      RDWARD1
          BRANCH    OVRCD,MISF9999
          BRANCH    F1,MISF0510,MISF0520,MISF0507
.
MISF0507  COMPARE   FOUR,ASTAT
          IF        @EQUAL
            IF        F1=3
              READ      CONTROLF,HUND20;*172,PTCNHLEA
              MATCH     "1",PTCNHLEA
              IF        @EQUAL
                PROC      TLEA0000
                MOVE      "TL",CATEGORY            * Output Type of Leave
                CALL      GETCOD00
                MOVE      "On Leave - ",KEY11
                PACK      KEY31,KEY11,TDESC,SP70
                WRITE     HTMLFILE;KEY31;
                GOTO      MISF9999
              ENDIF
            ENDIF
            WRITE     HTMLFILE;"On Leave";
          ELSE
            WRITE     HTMLFILE;WBDESC;
          ENDIF
          GOTO      MISF9999
.
MISF0510  WRITE     HTMLFILE;WWARD;
          GOTO      MISF9999
.
MISF0520  READ      CONTROLF,HUND12;*104,PTCNWBDS 
          MOVE      ZERO,F1
          MOVE      PTCNWBDS,F1
          IF        F1=1
            WRITE     HTMLFILE;WBDESC;
            GOTO      MISF9999
          ENDIF
          IF        F1=2
            WRITE     HTMLFILE;PTWDSDES;
            GOTO      MISF9999
          ENDIF
          WRITE     HTMLFILE;WWARD;
          GOTO      MISF9999
.
MISF0600  PACK      KEY6,ABED,SP70
          MATCH     SP70,ADMISSNO
          GOTO      MISF9999 IF EQUAL
.
          MATCH     ZEROVISN,AADMNO
          GOTO      MISF9999 IF EQUAL
.
          BRANCH    MISSFLAG,MISF9999
          MATCH     SP70,AWARD
          IF        @EQUAL
            PACK      KEY14,AADMNO,SP70
            CALL      RDSWARD4
            CALL      RDKWARD4
            BRANCH    OVRCD,MISF9999
            MATCH     WSTBY,AADMNO
            GOTO      MISF9999 IF NOT EQUAL
            MOVE      "(S)",KEY3
            PACK      KEY6,WBED,KEY3
          ENDIF
          COMPARE   FOUR,ASTAT
          IF        !@EQUAL
            WRITE     HTMLFILE;KEY6;
          ENDIF
          GOTO      MISF9999
.
MISF0700  MOVE      ADOCTR,DOCTCODE
          CALL      DOCDET00
          GOTO      MISF9999
.
MISF0800  MOVE      ADOCTA,DOCTCODE
          CALL      DOCDET00
          GOTO      MISF9999
.
MISF0900  WRITE     HTMLFILE;ADOCTL;
          GOTO      MISF9999
.
MISF1000  MOVE      "S ",CATEGORY
          PACK      CODE,ASRCE,SP70
          CALL      CODITM00 
          GOTO      MISF9999
.
MISF1100  MOVE      "A ",CATEGORY
          MOVE      ATYPE,CODE
          CALL      CODITM00 
          GOTO      MISF9999
.
MISF1200  MOVE      "P ",CATEGORY
          MOVE      ACLSS,CODE
          CALL      CODITM00 
          GOTO      MISF9999
.
MISF1300  MOVE      "CC",CATEGORY
          MOVE      ACARE,CODE
          CALL      CODITM00 
          GOTO      MISF9999
.
MISF1400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISF1410,MISF1420
          WRITE     HTMLFILE;AFUNDH;
          GOTO      MISF9999
.
MISF1410  PACK      KEY14,AFUNDH,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
          ELSE
            WRITE     HTMLFILE;AFUNDH;
          ENDIF
          GOTO      MISF9999
.
.   Display Selection List for health fund
.
MISF1420  PACK      KEY14,SP70
          CALL      RDSFUND1
MISF1425  CALL      RDKFUND1
          BRANCH    OVRCD,MISF9999
.
          BRANCH    PHFTACT,MISF1425   * if code is inactive,ignore (CAR 35992)
.
          MATCH     HCODE,AFUNDH
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",HCODE,"#" selected> ":
                               HCODE,": ",HFNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",HCODE,"#"> ":
                               HCODE,": ",HFNAME,"</option>"
          ENDIF
          GOTO      MISF1425
.
MISF1500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISF1510
          WRITE     HTMLFILE;AFNDTB;
          GOTO      MISF9999
.
MISF1510  PACK      KEY14 WITH AFUNDH,AFNDTB,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;      * Description of Table
          ELSE
            WRITE     HTMLFILE;AFNDTB;      * Table code
          ENDIF
          GOTO      MISF9999
.
MISF1600  WRITE     HTMLFILE;PMVXFNDM;     * moved from afndmm to pmvxfndm
.....     WRITE     HTMLFILE;AFNDMM;
          GOTO      MISF9999
.
MISF1700  MOVE      NO,YESNO
          IF        AELIG=1
            MOVE      YES,YESNO
          ENDIF
          WRITE     HTMLFILE;YESNO;
          GOTO      MISF9999
.
MISF1800  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Religious visit
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISF1810
          WRITE     HTMLFILE;AVISIT;
          GOTO      MISF9999
MISF1810  COMPARE   "3",AVISIT                * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Unk";
            GOTO      MISF9999
          ENDIF
          COMPARE   "1",AVISIT
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MISF9999
.
MISF1900  COMPARE   "1",AALERG
          GOTO      MISF1910 IF EQUAL 
.
          COMPARE   "2",AALERG
          GOTO      MISF1920 IF EQUAL 
.
          MOVE      UNK,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      MISF9999
.
MISF1910  MOVE      YES,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      MISF9999
.
MISF1920  MOVE      NO,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      MISF9999
.
MISF2000  COMPARE   "1",AILLN
          GOTO      MISF2010 IF EQUAL 
.
          COMPARE   "2",AILLN
          GOTO      MISF2020 IF EQUAL 
.
          MOVE      UNK,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      MISF9999
.
MISF2010  MOVE      YES,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      MISF9999
.
MISF2020  MOVE      NO,YESNO
          WRITE     HTMLFILE;YESNO;
          GOTO      MISF9999
.
MISF2100  MATCH     SP70,ADIAG1
          IF        !@EQUAL
            WRITE     HTMLFILE;ADIAG1;
          ENDIF
          GOTO      MISF9999

MISF2200  MATCH     SP70,ADIAG2
          IF        !@EQUAL
            WRITE     HTMLFILE;ADIAG2;
          ENDIF
          GOTO      MISF9999
.
MISF2300  MOVE      ADOCTT,DOCTCODE
          CALL      DOCDET00
          GOTO      MISF9999
.
MISF2400  MOVE      "AC",CATEGORY
          MOVE      ACLSSFT,CODE
          CALL      CODITM00 
          GOTO      MISF9999
.
MISF2500  WRITE     HTMLFILE;AMBS;
          GOTO      MISF9999
.
MISF2600  MOVE      "CL",CATEGORY
          MOVE      ACLAIM,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF2700  MOVE      "DC",CATEGORY
          MOVE      ADIET,CODE
          CALL      CODITM00 
          GOTO      MISF9999
.
MISF2800  MOVE      "PO",CATEGORY
          MOVE      APLOCCR,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF2900  WRITE     HTMLFILE;ASTAY;           
          GOTO      MISF9999
.
MISF3000  WRITE     HTMLFILE;ADYHOSP;
          GOTO      MISF9999
.
MISF3100  WRITE     HTMLFILE;ACOMM1;
          GOTO      MISF9999
.
MISF3200  WRITE     HTMLFILE;ACOMM2;
          GOTO      MISF9999
.
MISF3300  MOVE      "U1",CATEGORY
          MOVE      AUSR1,CODE
          CALL      CODITM00 
          GOTO      MISF9999
.
MISF3400  MOVE      "U2",CATEGORY
          MOVE      AUSR2,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF3500  MOVE      "U3",CATEGORY
          MOVE      AUSR3,CODE
          CALL      CODITM00 
          GOTO      MISF9999
.
MISF3600  MOVE      "U4",CATEGORY
          MOVE      AUSR4,CODE
          CALL      CODITM00 
          GOTO      MISF9999
.
MISF3700 MOVE      "U5",CATEGORY
          MOVE      AUSR5,CODE
          CALL      CODITM00 
          GOTO      MISF9999
.
MISF3800  MOVE      "U6",CATEGORY
          MOVE      AUSR6,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF3900  MOVE      "U7",CATEGORY
          MOVE      AUSR7,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF4000  UNPACK    DIM127,DIM1,KEY1,DIM127 
          MOVE      KEY1,F1
          BRANCH    F1,MISF4010
          WRITE     HTMLFILE;PTMIPDRG;
          GOTO      MISF9999
.
MISF4010  PACK      KEY4,PTMIPDRG,SP70
          MOVE      "999",KEY3
          PACK      KEY7,KEY4,KEY3,SP10     * last DRG version        *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          BRANCH    OVRCD,MISF9999
          MATCH     PTDWDRGC,KEY4                                     *I-137125
          GOTO      MISF9999 IF NOT EQUAL                             *I-137125
          WRITE     HTMLFILE;PTDWDESC;
          GOTO      MISF9999
.
MISF4100  WRITE     HTMLFILE;PTMIPVIS;
          GOTO      MISF9999
.
MISF4200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISF4210
          PACK      KEY10,PTMSRFGP,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,MISF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      MISF9999
.
MISF4210  WRITE     HTMLFILE;PTMSRFGP;
          GOTO      MISF9999
.
MISF4300  WRITE     HTMLFILE;PTMSGPPC;
          GOTO      MISF9999
MISF4400  WRITE     HTMLFILE;PTMSFHAN;
          GOTO      MISF9999
MISF4500  WRITE     HTMLFILE;PTMSECRA;
          GOTO      MISF9999
MISF4600  MOVE      "MI",CATEGORY
          MOVE      PTMSMGIN,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF4700  WRITE     HTMLFILE;PTMIGPPT;
          GOTO      MISF9999
.
MISF4800  MOVE      "DA",CATEGORY
          MOVE      PTMIDOFR,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF4900  WRITE     HTMLFILE;PTMIREFD;
          GOTO      MISF9999
MISF5000  WRITE     HTMLFILE;PTMIDFCN;
          GOTO      MISF9999
.
MISF5100  MOVE      "HP",CATEGORY
          MOVE      PTMIPHPU,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF5200  MOVE      "HA",CATEGORY
          MOVE      PTMIAGNC,CODE
          CALL      CODITM00
          GOTO      MISF9999
MISF5300  WRITE     HTMLFILE;PTMIESSF;
          GOTO      MISF9999
MISF5400  WRITE     HTMLFILE;PTMIUSR8;
          GOTO      MISF9999
MISF5500  MOVE      "U9",CATEGORY
          MOVE      PTMIUSR9,CODE
          CALL      CODITM00
          GOTO      MISF9999
MISF5600  WRITE     HTMLFILE;PTMIUSR0;
          GOTO      MISF9999
MISF5700  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Web User ID rec. creator
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISF5710
          WRITE     HTMLFILE;PTMIOPER;
          GOTO      MISF9999
MISF5710  PACK      KEY14,PTMIOPER,SP70       * .1
          CALL      RSWBSE3
          CALL      RKWBSE3
          BRANCH    OVRCD,MISF9999
          MATCH     PTMIOPER,WBSEPCD
          GOTO      MISF9999 IF NOT EQUAL
          WRITE     HTMLFILE;WBSENAM;
          GOTO      MISF9999
.
MISF5800  WRITE     HTMLFILE;PTMIXWRD;
          GOTO      MISF9999
MISF5900  WRITE     HTMLFILE;PTMIADOC;
          GOTO      MISF9999
MISF6000  WRITE     HTMLFILE;PTMIREGS;
          GOTO      MISF9999
MISF6100  WRITE     HTMLFILE;PTMIUYN1;
          GOTO      MISF9999
MISF6200  WRITE     HTMLFILE;PTMIUYN2;
          GOTO      MISF9999
MISF6300  WRITE     HTMLFILE;PTMIPANO;
          GOTO      MISF9999
MISF6400  WRITE     HTMLFILE;PTMIPADT;
          GOTO      MISF9999
MISF6500  WRITE     HTMLFILE;PTMIDDIG;
          GOTO      MISF9999
MISF6600  BRANCH    RESPFLAG,MISF9999
          WRITE     HTMLFILE;PKNAME;
          GOTO      MISF9999
MISF6700  BRANCH    RESPFLAG,MISF9999
          WRITE     HTMLFILE;PKADD1;
          GOTO      MISF9999
MISF6800  BRANCH    RESPFLAG,MISF9999
          WRITE     HTMLFILE;PKADD2;
          GOTO      MISF9999
MISF6900  BRANCH    RESPFLAG,MISF9999
          WRITE     HTMLFILE;PKSUBR;
          GOTO      MISF9999
MISF7000  BRANCH    RESPFLAG,MISF9999
          WRITE     HTMLFILE;PKPOST;
          GOTO      MISF9999
MISF7100  BRANCH    RESPFLAG,MISF9999
          WRITE     HTMLFILE;PKTELEP;
          GOTO      MISF9999
MISF7200  BRANCH    RESPFLAG,MISF9999
          WRITE     HTMLFILE;PKTELEB;
          GOTO      MISF9999
MISF7300  BRANCH    RESPFLAG,MISF9999
          WRITE     HTMLFILE;PKRELP;
          GOTO      MISF9999
.
MISF7400  CALL      VISCMA00
          GOTO      MISF9999
.
MISF7500  WRITE     HTMLFILE;CLABPRT;
          GOTO      MISF9999
.
MISF7600  WRITE     HTMLFILE;AMEMB;
          GOTO      MISF9999
.
MISF7700  WRITE     HTMLFILE;AMEMBNO;
          GOTO      MISF9999
.
MISF7800  WRITE     HTMLFILE;AFNDYY;
          GOTO      MISF9999
.
MISF7900  WRITE     HTMLFILE;AFNDCG;
          GOTO      MISF9999
.
MISF8000  PACK      KEY17,AMBS,ADATE
          MATCH     SP70,AMBS
          GOTO      MISF9999 IF EQUAL
          CALL      PATITMRD
          BRANCH    OVRCD,MISF9999
          WRITE     HTMLFILE;IDESC;
          GOTO      MISF9999
.
MISF8100  UNPACK    PTMIPDRG,KEY4,KEY5
          MATCH     SP70,PTMIPDRG
          GOTO      MISF9999 IF EQUAL
          MATCH     SP5,KEY5
          GOTO      MISF8150 IF EQUAL
          GOTO      MISF8150 IF EOS   
.
          PACK      KEY17,PTMIPDRG,ADATE
          CALL      PATITMRD
          BRANCH    OVRCD,MISF9999
          MOVE      IDESC,MBSDESC
          MOVE      SP70,IDESC
          WRITE     HTMLFILE;MBSDESC;
          GOTO      MISF9999
.
MISF8150  MOVE      "999",KEY3                                        *I-137125
          PACK      KEY7,KEY4,KEY3,SP10     * last DRG version        *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          BRANCH    OVRCD,MISF9999
          MATCH     PTDWDRGC,KEY4                                     *I-137125
          GOTO      MISF9999 IF NOT EQUAL                             *I-137125
          WRITE     HTMLFILE;PTDWDESC;
          GOTO      MISF9999
.
MISF8200  MATCH     SP70,PKADD4
          GOTO      MISF9999 IF EQUAL
          WRITE     HTMLFILE;PKADD4;
          GOTO      MISF9999
.
MISF8300  MOVE      "U8",CATEGORY
          MOVE      PTMIUSR8,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF8400  MOVE      "U9",CATEGORY
          MOVE      PTMIUSR9,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF8500  MOVE      "U0",CATEGORY
          MOVE      PTMIUSR0,CODE
          CALL      CODITM00
          GOTO      MISF9999
.
MISF8600  WRITE     HTMLFILE;ABWGHT;
          GOTO      MISF9999
.
MISF8700  WRITE     HTMLFILE;PTMIPANO;            * Previous Admission Number
          GOTO      MISF9999
.
MISF8800  WRITE     HTMLFILE;PTMIPADT;           * Previous Admission Date
          GOTO      MISF9999
.
MISF8900  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Religious visit
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISF8910,MISF8920
          WRITE     HTMLFILE;PTMIGSTA;
          GOTO      MISF9999
MISF8910  MATCH     "Y",PTMIGSTA                * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            MATCH     "N",PTMIGSTA
            IF        @EQUAL
              WRITE     HTMLFILE;"No";
            ELSE
              WRITE     HTMLFILE;"Unknown";
            ENDIF
          ENDIF
          GOTO      MISF9999
.
MISF8920  MOVE      PTMIGSTA,KEY1
          REP       "YXNXUX",KEY1
          MATCH     ANSX,KEY1
          IF        !@EQUAL
            MOVE      PTCNDGST,PTMIGSTA     * use default GST applicable
          ENDIF
.
          MATCH     "Y",PTMIGSTA
          IF        @EQUAL
            WRITE    HTMLFILE;"<option value=",ANSY," selected>":
                              "Yes</option>":
                              "<option value=",ANSN,">":
                              "No</option>":
                              "<option value=",ANSU,">":
                              "Unknown</option>";
          ELSE
            MATCH    "N",PTMIGSTA
            IF       @EQUAL
              WRITE    HTMLFILE;"<option value=",ANSN," selected>":
                                "No</option>":
                                "<option value=",ANSY,">":
                                "Yes</option>":
                                "<option value=",ANSU,">":
                                "Unknown</option>";
            ELSE
              WRITE    HTMLFILE;"<option value=",ANSU," selected>":
                                "Unknown</option>":
                                "<option value=",ANSY,">":
                                "Yes</option>":
                                "<option value=",ANSN,">":
                                "No</option>";
            ENDIF
          ENDIF
          GOTO      MISF9999
.
.   ****  HPS BLR(SAC) CODE STARTS HERE  ****
. 
MISF9000  MOVE      "SD",CATEGORY
          CALL      CODITM00
          GOTO      MISF9999
.
.   ****  HPS CODE ENDS  HERE  ****
.
MISF9100  MOVE      FLDITEM,F3    * Check for Link to Doctor Template Page
          IF        F3=1
            UNPACK    DIM127,D1,FLDPARA,DIM127    * Remove Parameter
          ENDIF
.
MISF9200  PACK      KEY6,PTDAADTS,SP10
          CALL      ATRS0000
          GOTO      MISF9999
.
MISF9300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     SP70,PTDAADTS
          GOTO      MISF9999 IF EQUAL
          BRANCH    F1,MISF9310
.
          WRITE     HTMLFILE;PTDAADTS;
          GOTO      MISF9999
.
MISF9310  PACK      KEY5,PTDAADTS,SP70
          CALL      RDPTVAD1
          BRANCH    OVRCD,MISF9999
.
          WRITE     HTMLFILE;PTVADESC;
          GOTO      MISF9999
.
MISF9400  WRITE     HTMLFILE;PTMIEBED;             * expected bed
          GOTO      MISF9999
.
.MISF9500  PACK      KEY6,PTMIXWRD,SP70            * D SRF 17693
.          CALL      RDWARD1
.          BRANCH    OVRCD,MISF9999
.
.          MATCH     PTMIXWRD,WWARD
.          GOTO      MISF9999 IF NOT EQUAL
.
.          WRITE     HTMLFILE;WBDESC;              * expected ward description
.          GOTO      MISF9999                      * end D SRF 17693
.
MISF9500  UNPACK    DIM127,D1,KEY1,DIM127          * I SRF 18693
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISF9510,MISF9520,MISF9530
.
          PACK      KEY6,PTMIXWRD,SP70
          CALL      RDWARD1
          BRANCH    OVRCD,MISF9999

          MATCH     PTMIXWRD,WWARD
          GOTO      MISF9999 IF NOT EQUAL

          WRITE     HTMLFILE;WBDESC;              * expected ward description
          GOTO      MISF9999 
.
MISF9510  WRITE     HTMLFILE;PTMIXWRD;            * ward
          GOTO      MISF9999
.
MISF9520  CALL      HSWA0000               * ward selection list 
          GOTO      MISF9999
.
MISF9530  CALL      HSWA0000               * Hospital ward select list
          GOTO      MISF9999
.
MISF9600  WRITE     HTMLFILE;ACODDTE;      * Date Coding Complete
          GOTO      MISF9999
.
MISF9700  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Religious visit
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,PTMICMXP
          IF        @EQUAL
            LOAD      PTMICMXP,PTCNCMYN,ANSY   * Default for C/P from parameter
          ENDIF
          BRANCH    F1,MISF9710,MISF9720
          WRITE     HTMLFILE;PTMICMXP;
          GOTO      MISF9999
MISF9710  MATCH     "Y",PTMICMXP                * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MISF9999
.
MISF9720  MATCH     "Y",PTMICMXP
          IF        @EQUAL
            WRITE    HTMLFILE;"<option value=",ANSY," selected>":
                              "Yes</option>":
                              "<option value=",ANSN,">":
                              "No</option>";
          ELSE
            WRITE    HTMLFILE;"<option value=",ANSN," selected>":
                              "No</option>":
                              "<option value=",ANSY,">":
                              "Yes</option>";
          ENDIF
          GOTO      MISF9999
.
MISF9800  UNPACK    DIM127,DIM1,KEY1,DIM127 
          MOVE      KEY1,F1
          BRANCH    F1,MISF9810
          WRITE     HTMLFILE;PTMIPCMX;
          GOTO      MISF9999
.
MISF9810  OPEN      PATCMCA1,"patcmcaf"
          PACK      KEY9,PTMIPCMX,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,MISF9999
          WRITE     HTMLFILE;PTCADES1;
          GOTO      MISF9999
.
.         If the field item no is 99 then the next numbers after the dot will
.         be the extension field number
.         eg: %PATWEB89.04.a99.xxx.y
.         xxx will be the extension field number and 'y' will be the indicator
.         for displaying selection, code or description
.
MISF9900  UNPACK    DIM127,DIM1,KEY3,DIM127 
          MOVE      KEY3,FLDITMNO
          CALL      MISB0000
          GOTO      MISF9999
.
MISF9999  RETURN
.------------------------------------------------------------
. Extra Admission Fields
.------------------------------------------------------------
MISB0000  BRANCH    FLDITMNO,MISB0100,MISB0200,MISB0300,MISB0400,MISB0500:
                             MISB0600,MISB0700,MISB0800,MISB0900,MISB1000:
                             MISB1100,MISB1200,MISB1300,MISB1400,MISB1500:
                             MISB1600,MISB1700,MISB1800,MISB1900,MISB2000:
                             MISB2100,MISB2200,MISB2300,MISB2400,MISB2500
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MISF9999
.
.
MISB0100  CALL      PTCT0000                         * I SRF 22829
          GOTO      MISB9999
.
MISB0200  CALL      PTCR0000                         * I SRF 22829
          GOTO      MISB9999
.
MISB0300  CALL      PTCS0000                         * I SRF 22829
          GOTO      MISB9999
.
MISB0400  MATCH     SP70,PTAFCTYP
          GOTO      MISB9999 IF EQUAL
          WRITE     HTMLFILE;PTAFCTYP;
          GOTO      MISB9999
.
MISB0500  WRITE     HTMLFILE;PTAFCROL;
          GOTO      MISB9999
.
MISB0600  READ      CONTROLF,SEVENTY9;*81,PTCNGEST
          MOVE      ZERO,DIM1
          LOAD      DIM1,PTCNGEST,ONE,TWO,THREE,FOUR,FIVE,SIX,SEVEN,EIGHT,NINE
          PACK      CATEGORY,ANSU,DIM1,SP70
          MOVE      PTMIUSR0,CODE
          LOAD      CODE,PTCNGEST,AUSR1,AUSR2,AUSR3,AUSR4,AUSR5:
                            AUSR6,AUSR7,PTMIUSR8,PTMIUSR9
.
          CALL      CODITM00
          GOTO      MISB9999
.
MISB0700  MATCH     PTMIDFAS,SP70
          GOTO      MISB9999 IF EQUAL
          UNPACK    PTMIDFAS,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          IF        FHIRTYPE=0
            WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            WRITE     HTMLFILE;CCENT,CYEAR,"-",CMON,"-",CDAY;
          ENDIF
          GOTO      MISB9999
.
MISB0800  READ      CONTROLF,ZERO;*43,IBCNMHOS
          WRITE     HTMLFILE;IBCNMHOS;
          GOTO      MISB9999
.
MISB0900  MATCH     SP70,PTMICRCD
          GOTO      MISB9999 IF EQUAL
          WRITE     HTMLFILE;PTMICRCD;
          GOTO      MISB9999
.
MISB1000  MATCH     "1",PTMIFINV
          IF        @EQUAL
            WRITE     HTMLFILE;DYES;
          ELSE 
            WRITE     HTMLFILE;DNO;
          ENDIF
          GOTO      MISB9999
.
MISB1100  MATCH     "1",PTMICRCD
          IF        @EQUAL
            WRITE     HTMLFILE;DYES;
          ELSE
            WRITE     HTMLFILE;DNO;
          ENDIF
          GOTO      MISB9999
.
MISB1200  BRANCH    RESPFLAG,MISF9999                                 *I-151025
          WRITE     HTMLFILE;PTREMOBL;
          GOTO      MISB9999
.
MISB1300  PACK      KEY20,ADMISSNO,VSCMTTYP,SP70
          CALL      RSVSMTX1
MISB1310  CALL      RKVSMTX1
          BRANCH    OVRCD,MISB1320
.
          MATCH     ADMISSNO,VSMTVISN
          GOTO      MISB1320 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMTTYPE
          GOTO      MISB1320 IF NOT EQUAL
.
          MATCH     SP70,VSMTCMNT             * Skip if first line blank
          GOTO      MISB1310 IF EQUAL
          WRITE     HTMLFILE;ONE; 
          GOTO      MISB9999
.
MISB1320  WRITE     HTMLFILE;ZERO;
          GOTO      MISB9999
.
MISB1400  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Continuous billing
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISB1410,MISB1420
          WRITE     HTMLFILE;PTMICONB;
          GOTO      MISF9999
MISB1410  MATCH     "1",PTMICONB                * .1
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MISF9999
.
MISB1420  MATCH     "1",PTMICONB
          IF        @EQUAL
            WRITE    HTMLFILE;"<option value=1 selected>":
                              "Yes</option>":
                              "<option value=0>":
                              "No</option>";
          ELSE
            WRITE    HTMLFILE;"<option value=0 selected>":
                              "No</option>":
                              "<option value=1>":
                              "Yes</option>";
          ENDIF
          GOTO      MISB9999
.
MISB1500  WRITE     HTMLFILE;PTMI3BDY;
          GOTO      MISB9999
.
MISB1600  MATCH     PTMI3BAD,SP70
          GOTO      MISB9999 IF EQUAL
          UNPACK    PTMI3BAD,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          IF        FHIRTYPE=0
            WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            WRITE     HTMLFILE;CCENT,CYEAR,"-",CMON,"-",CDAY;
          ENDIF
          GOTO      MISB9999
.
MISB1700  IF        ASTAT=1
            MOVE      PTMIEBED,ABED         * use Expexted Bed for pre-adm.
          ENDIF
          PACK      KEY13,ABED,SP70
          MATCH     SP70,ADMISSNO
          GOTO      MISF9999 IF EQUAL
.
          MATCH     ZEROVISN,AADMNO
          GOTO      MISF9999 IF EQUAL
.
          BRANCH    MISSFLAG,MISF9999
          MATCH     SP70,AWARD
          IF        @EQUAL
            PACK      KEY14,AADMNO,SP70
            CALL      RDSWARD4
            CALL      RDKWARD4
            BRANCH    OVRCD,MISF9999
            MATCH     WSTBY,AADMNO
            GOTO      MISF9999 IF NOT EQUAL
            MOVE      "(S)",KEY3
            MATCH     "2",PTCNWBDS
            IF        @EQUAL
              PACK      KEY13,PTWDSDES,KEY3
            ELSE
              PACK      KEY13,WBED,KEY3
            ENDIF
          ELSE
            MATCH     SP3,ABED
            GOTO      MISB9999 IF EQUAL          * no bed, no description !
            MATCH     "2",PTCNWBDS
            IF        @EQUAL
              PACK      KEY6,AWARD,ABED,SP70
              CALL      RDWARD1
              IF        OVRCD<>1
                PACK      KEY13,PTWDSDES,SP70    * short Bed description
              ENDIF
            ENDIF
          ENDIF
          COMPARE   FOUR,ASTAT
          IF        !@EQUAL
            WRITE     HTMLFILE;KEY13;
          ENDIF
          GOTO      MISB9999
.
MISB1800  WRITE     HTMLFILE;PTMILSDN;
          GOTO      MISB9999

MISB1900  WRITE     HTMLFILE;PTMIOGNO;
          GOTO      MISB9999
.
MISB2000  WRITE     HTMLFILE;ASTAT;
          GOTO      MISB9999
.
MISB2100  CALL      VICMNT00
          GOTO      MISB9999
.
MISB2200  WRITE     HTMLFILE;APLUR;
          GOTO      MISB9999
.
MISB2300  WRITE     HTMLFILE;ADMISSNO;
          GOTO      MISB9999
.
MISB2400  UNPACK    DIM127,D1,KEY1,DIM127     * .0   ADIAG1
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MISB2410
          MATCH     SP70,ADIAG1
          IF        !@EQUAL
            WRITE     HTMLFILE;ADIAG1;
          ENDIF
          GOTO      MISB9999
MISB2410  MATCH     SP70,ADIAG1
          GOTO      MISB9999 IF EQUAL
          PROC      REFADM00                  * Read pmsvscaf
          BRANCH    EXIT,MISB9999
          WRITE     HTMLFILE;KEY80;           * .1  Description
          GOTO      MISB9999
.
MISB2500  PACK      KEY5,ANSA,SP1,ATYPE
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      SP70,THCSCOD
          ENDIF
          WRITE     HTMLFILE;THCSCOD; 
          GOTO      MISF9999
.
MISB9999  RETURN
.
.-----------------------------------------------------------------------
. Retrieve the last number of visit comment details
.-----------------------------------------------------------------------
VICMNT00  MOVE      SP70,KEY3
          UNPACK    DIM127,DIM1,KEY3,DIM127
          MATCH     SP70,KEY3
          IF        @EQUAL
            MOVE      5,VSCMNOFS
          ELSE
            MOVE      KEY3,VSCMNOFS
          ENDIF
.  
          MOVE      ZERO,F3
          PACK      KEY17,ADMISSNO,VSCMTTYP,Z70
.
          CALL      RSVSMDT1
VICMNT10  CALL      RPVSMDT1
          BRANCH    OVRCD,VICMNT99
.   
          IF        F3 = VSCMNOFS
            GOTO      VICMNT99
          ENDIF
.
          MATCH     ADMISSNO,VSMDVISN
          GOTO      VICMNT99 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMDTYPE
          GOTO      VICMNT99 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT          * is comment deleted
          GOTO      VICMNT10 IF EQUAL
.
. Retrieve comment header
.
          MATCH     VSMDDATE,SP70
          IF        @EQUAL
            MOVE     SP70,VSCMDATE
            GOTO     VICMNT20
          ENDIF
.
          UNPACK    VSMDDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN:
                               JUL,AUG,SEP,OCT,NOV,DEC
          PACK      VSCMDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
VICMNT20  PACK      KEY10,VSMDUSER,SP70
          CALL      RDWBSE1
          IF        OVRCD = 0
            MOVE      WBSENAM,VSCMUSRN
          ELSE
            MOVE      VSMDUSER,VSCMUSRN
          ENDIF
          STRIP     VSCMUSRN  
.
VICMNT30  PACK      KEY20,SP70
          MATCH     VSMDOCCG,SP70
          IF        !@EQUAL
            MOVE      "w0",KEY2
            PACK      KEY5,KEY2,VSMDOCCG,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      KEY20,VSMDOCCG,SP70
            ELSE
              PACK      KEY20,TDESC,SP70
            ENDIF
          ENDIF
.
VICMNT40  PACK      VSCMLINE,VSCMDATE,SP1,VSMDTIME,SP1,VSCMUSRN,SP1,KEY20
          WRITE     HTMLFILE;VSCMLINE
          ADD       ONE,F3
.
          CALL      VICMTX00
.
          GOTO      VICMNT10
.
VICMNT99 PACK      KEY10,USERID,SP70
         CALL      RDWBSE1 
         RETURN
.
.---------------------------------------------------------------------
. Retrieve comment text details
.---------------------------------------------------------------------
.
VICMTX00  PACK      KEY20,VSMDVISN,VSMDTYPE,VSMDNOTE,SP70
          CALL      RSVSMTX1
VICMTX20  CALL      RKVSMTX1
          BRANCH    OVRCD,VICMTX99
.
          MATCH     VSMDVISN,VSMTVISN
          GOTO      VICMTX99 IF NOT EQUAL
.
          MATCH     VSMDTYPE,VSMTTYPE
          GOTO      VICMTX99 IF NOT EQUAL
.
          MATCH     VSMDNOTE,VSMTNOTE
          GOTO      VICMTX99 IF NOT EQUAL
.
          STRIP     VSMTCMNT
          MOVELPTR  VSMTCMNT,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      VSMTCMNT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,70
.
          GOTO      VICMTX20
.
VICMTX99  RETURN
.
.-----------------------------------------------------------------------
. Retrieve all visit comment details (vismdtaf only)
.-----------------------------------------------------------------------
VISCMA00  PACK      KEY20,ADMISSNO,VSCMTTYP,SP70
          CALL      RSVSMTX1
VISCMA10  CALL      RKVSMTX1
          BRANCH    OVRCD,VISCMA99
.
          MATCH     ADMISSNO,VSMTVISN          
          GOTO      VISCMA99 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMTTYPE          
          GOTO      VISCMA99 IF NOT EQUAL
.
          STRIP     VSMTCMNT
          MOVELPTR  VSMTCMNT,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      VSMTCMNT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,70
.
          GOTO      VISCMA10
.
VISCMA99  RETURN
.
.------------------------------------------------------------
.     PTCT0000             Contract Type       I SRF 22829
.------------------------------------------------------------
PTCT0000  MATCH     SP1,PTAFCTYP
          GOTO      PTCT0010 IF NOT EQUAL
.
          READ      CONTROLF,HUND05;*204,PTCNCTYP
          MATCH     SP1,PTCNCTYP
          GOTO      PTCT9999 IF EQUAL
          MOVE      PTCNCTYP,PTAFCTYP
.
PTCT0010  MATCH     SP70,PTAFCTYP
          GOTO      PTCT9999 IF EQUAL
          WRITE     HTMLFILE;PTAFCTYP;
          GOTO      PTCT9999
.
PTCT9999  RETURN
.------------------------------------------------------------
.     PTCR0000             Contract Role      I SRF 22829
.------------------------------------------------------------
PTCR0000  MATCH     SP1,PTAFCROL
          GOTO      PTCR0010 IF NOT EQUAL
.
          READ      CONTROLF,HUND05;*203,PTCNCROL
          MATCH     SP1,PTCNCROL
          GOTO      PTCR9999 IF EQUAL
          MOVE      PTCNCROL,PTAFCROL
.
PTCR0010  WRITE     HTMLFILE;PTAFCROL;
          GOTO      PTCR9999
.
PTCR9999  RETURN
.------------------------------------------------------------
.     PTCS0000             Contract Spoke Id  I SRF 22829
.------------------------------------------------------------
PTCS0000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PTCS0010,PTCS0020
.
          PACK      KEY6,PTAFCSID,SP10
          CALL      ATRS0000
          GOTO      PTCS9999
.
PTCS0010  MATCH     SP70,PTAFCSID
          GOTO      PTCS9999 IF EQUAL
          WRITE     HTMLFILE;PTAFCSID;
          GOTO      PTCS9999
.
PTCS0020  MATCH     SP70,PTAFCSID
          GOTO      PTCS9999 IF EQUAL
          PACK      KEY5,PTAFCSID
          CALL      RDPTVAD1
          BRANCH    OVRCD,PTCS9999
.
          WRITE     HTMLFILE;PTVADESC;
          GOTO      PTCS9999
.
PTCS9999  RETURN
.------------------------------------------------------------
.        Admission Transfer Source Select List 
.     transfere to file from PATWEB89.PBL on 08/05/01 HPS
.------------------------------------------------------------
ATRS0000  MOVE      SP5,KEY5
          OPEN      PATVADA2,"patvadaf"
          PACK      KEY35,SP70
          CALL      RSPTVAD2
ATRS0100  CALL      RKPTVAD2
          BRANCH    OVRCD,ATRS9999
.
          MATCH     ANSA,PTVAACTV
          GOTO      ATRS0100 IF NOT EQUAL
.
          MATCH     KEY6,PTVACODE
          IF        @EQUAL
            WRITE    HTMLFILE;"<option value=",PTVACODE," selected>":
                              PTVADESC,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=",PTVACODE,">":
                              PTVADESC,"</option>";
          ENDIF
          GOTO      ATRS0100
.
ATRS9999  RETURN
.------------------------------------------------------------
. Ward selection
.------------------------------------------------------------
HSWA0000  READ      CONTROLF,ZERO;*43,IBCNMHOS
          OPEN      PATWR1A7,"patwr1af"  
          PACK      KEY29,SP70
          IF        IBCNMHOS = 1
            PACK      KEY29,SP3,WBSEHOSP,SP70
          ENDIF
          CALL      RDSWARD7
HSWA0100  CALL      RDKWARD7
          BRANCH    OVRCD,HSWA9999
.
.                         if we have a bed number we have passed all the ward
.                         master records, so exit
          MATCH     SP70,WBED
          GOTO      HSWA9999 IF NOT EQUAL
.
          COMPARE   WACTIVE,ZERO                 *List only active wards
          GOTO      HSWA0100 IF NOT EQUAL
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        !@EQUAL
              MATCH     WBSEHOSP,PTWDHOSN
              GOTO      HSWA9999 IF NOT EQUAL
            ENDIF
          ENDIF
.
.                       write the select option.
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#"";
          MATCH     PTMIXWRD,WWARD
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">",WBDESC;
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;" - ",PTWDHOSN;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      HSWA0100
.
HSWA9999  RETURN
+
.******************************************************************************
.*  TLEA0000
.*  Get Type of Leave from transfer file
.*****************************************************************************
.
          DEFPROC   TLEA0000
.
          INC       PATTRNFD/INC
.
          MOVE      ZERO,EXIT
          OPEN      PATTRAN2,"pattranf"
.
          MOVE      SP10,CODE
          PACK      KEY30,PVIBILL,Z70
          CALL      RDSTRAN2
          CALL      RDPTRAN2
          BRANCH    OVRCD,TLEA9500
.
          MATCH     PVIBILL,TADMN          * Same visit number ?
          GOTO      TLEA9500 IF NOT EQUAL  * No
.
          MATCH     SP3,PTTRLTYP
          GOTO      TLEA9500 IF EQUAL
          MOVE      PTTRLTYP,CODE          * Type of Leave
          MOVE      ZERO,EXIT
          GOTO      TLEA9999
.
TLEA9500  MOVE      ONE,EXIT
          GOTO      TLEA9999
.
          INC       IBAOVRIO/INC
          INC       PATTRNIO/INC
.
TLEA9999  CLOSE     PATTRAN2
          ENDPROC
+
.
.******************************************************************************
.*  REFADM00
.*  Get reason for admission description using ADIAG1 as the code to
.   read pmsvscaf file
.*****************************************************************************
.
          DEFPROC   REFADM00
.
          INC       PMSVSCFD/INC       * Clinical Coding Value Set Codes

.
          MOVE      ZERO,EXIT
          OPEN      PMSVSCA1,"pmsvscaf"
.
          PACK      KEY80,SP70,SP70      
          PACK      KEY33,ANSB,ANSR,ANSA,ADIAG1,SP70
          CALL      RDPMVSC1
          BRANCH    OVRCD,REFADM95
.
          MOVE      PMVCPTRM,KEY80
          MOVE      ZERO,EXIT
          GOTO      REFADM99
.
REFADM95  MOVE      ONE,EXIT
          GOTO      REFADM99
.
          INC       IBAOVRIO/INC
          INC       PMSVSCIO/INC
.
REFADM99  CLOSE     PMSVSCA1
          ENDPROC
+

          INC       PATITMRD

. *-----------------------------------------------------------------------------
. * Include Name  :  PMSRUGTM.PBL
. *
. * Function      :  CGI Variables for PMSRUGFD - pmsrugaf
. *
. * Mods          :
. * V10.08.02 09/06/2016   Peter Vela        TSK 0820521
. *                        Added unpack of DIM127 in PRUG3000
. * V10.08.01 19/04/2016   Ania P            CAR 319862
. *                        Further business rules for Assessments
. * V10.07.02 03/03/2016   Ania P            CAR 319862
. *                        Further business rules for Assessments
. * V10.07.01 03/02/2016   Ania P            CAR 319862
. *                        Additional business rules for Assessments
. * V10.06.02 29/07/2015   Peter Vela        CAR 320048
. *                        Fixed tag for PMRUASSO
. * V10.06.01 17/03/2012   Patrick Adair     CAR 271541
. *                        Created include
. *-----------------------------------------------------------------------------
.-------------------------------------------------------------------------------
. Clear RUG-ADL Scores Parameters
.-------------------------------------------------------------------------------
CPPRUG00  MOVE      Z70,PMRUG001
          MOVE      Z70,PMRUG002
          MOVE      Z70,PMRUG003
          MOVE      Z70,PMRUG004
          MOVE      Z70,PMRUG005
          MOVE      Z70,PMRUG006
          MOVE      Z70,PMRUG007
          MOVE      Z70,PMRUG008
          MOVE      Z70,PMRUG009
          MOVE      Z70,PMRUG010
          MOVE      Z70,PMRUG011
          MOVE      Z70,PMRUG012
          MOVE      Z70,PMRUG013
          MOVE      Z70,PMRUG014
          MOVE      Z70,PMRUG015
          MOVE      Z70,PMRUG016
          MOVE      Z70,PMRUG017
          MOVE      Z70,PMRUG018
          MOVE      Z70,PMRUG019
          MOVE      Z70,PMRUG020
          MOVE      Z70,PMRUG021
          MOVE      Z70,PMRUG022
          MOVE      Z70,PMRUG023
          MOVE      Z70,PMRUG024
          MOVE      Z70,PMRUG025
          MOVE      Z70,PMRUG026
          MOVE      Z70,PMRUG027
          MOVE      Z70,PMRUG028
.
CPPRUG99  RETURN
.
.-------------------------------------------------------------------------------
. Set RUG-ADL Scores Parameters
.-------------------------------------------------------------------------------
SPPRUG00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPPRUG01,SPPRUG02,SPPRUG03,SPPRUG04,SPPRUG05:
                       SPPRUG06,SPPRUG07,SPPRUG08,SPPRUG09,SPPRUG10:
                       SPPRUG11,SPPRUG12,SPPRUG13,SPPRUG14,SPPRUG15:
                       SPPRUG16,SPPRUG17,SPPRUG18,SPPRUG19,SPPRUG20:
                       SPPRUG21,SPPRUG22,SPPRUG23,SPPRUG24,SPPRUG25:
                       SPPRUG26,SPPRUG27,SPPRUG28
          GOTO      SPPRUG99
.
SPPRUG01  PACK      PMRUG001,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG02  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMRUG002,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      SPPRUG99
.
SPPRUG03  PACK      PMRUG003,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG04  PACK      PMRUG004,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG05  PACK      PMRUG005,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG06  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMRUG006,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      SPPRUG99
.
SPPRUG07  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMRUG007,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      SPPRUG99
.
SPPRUG08  PACK      PMRUG008,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG09  PACK      PMRUG009,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG10  PACK      PMRUG010,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG11  PACK      PMRUG011,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG12  PACK      PMRUG012,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG13  PACK      PMRUG013,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG14  PACK      PMRUG014,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG15  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMRUG015,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      SPPRUG99
.
SPPRUG16  PACK      PMRUG016,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG17  PACK      PMRUG017,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG18  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMRUG018,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      SPPRUG99
.
SPPRUG19  PACK      PMRUG019,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG20  PACK      PMRUG020,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG21  PACK      PMRUG021,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG22  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMRUG022,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      SPPRUG99
.
SPPRUG23  PACK      PMRUG023,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG24  PACK      PMRUG024,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG25  PACK      PMRUG025,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG26  PACK      PMRUG026,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG27  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PMRUG027,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      SPPRUG99
.
SPPRUG28  PACK      PMRUG028,QRYDATA,SP70
          GOTO      SPPRUG99
.
SPPRUG99  RETURN
.
.-------------------------------------------------------------------------------
. Output RUG-ADL Scores tags
.-------------------------------------------------------------------------------
PRUG0000  BRANCH    FLDITMNO,PRUG0100,PRUG0200,PRUG0300,PRUG0400,PRUG0500:
                             PRUG0600,PRUG0700,PRUG0800,PRUG0900,PRUG1000:
                             PRUG1100,PRUG1200,PRUG1300,PRUG1400,PRUG1500:
                             PRUG1600,PRUG1700,PRUG1800,PRUG1900,PRUG2000:
                             PRUG2100,PRUG2200,PRUG2300,PRUG2400,PRUG2500:
                             PRUG2600,PRUG2700,PRUG2800,PRUG2900,PRUG3000
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PRUG9999
.
PRUG0100  WRITE     HTMLFILE;PMRUVISN;
          GOTO      PRUG9999
.
PRUG0200  MATCH     PMRUADAT,SP70
          GOTO      PRUG9999 IF EQUAL
          UNPACK    PMRUADAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDACT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;DISPDACT;
          GOTO      PRUG9999
.
PRUG0300  WRITE     HTMLFILE;PMRUATIM;
          GOTO      PRUG9999
.
PRUG0400  WRITE     HTMLFILE;PMRUATYP;
          GOTO      PRUG9999
.
PRUG0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PRUG0510
.
          MATCH     "1",PMRUASSO
          IF        @EQUAL
            WRITE     HTMLFILE;YES;
          ELSE
            MATCH     "2",PMRUASSO
            IF        @EQUAL
              WRITE     HTMLFILE;NO;
            ENDIF
          ENDIF
          GOTO      PRUG9999
.
PRUG0510  WRITE     HTMLFILE;PMRUASSO;
          GOTO      PRUG9999
.
PRUG0600  MATCH     PMRUPSDT,SP70
          GOTO      PRUG9999 IF EQUAL
          UNPACK    PMRUPSDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDACT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;DISPDACT;
          GOTO      PRUG9999
.
PRUG0700  MATCH     PMRUPEDT,SP70
          GOTO      PRUG9999 IF EQUAL
          UNPACK    PMRUPEDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDACT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;DISPDACT;
          GOTO      PRUG9999
.
PRUG0800  WRITE     HTMLFILE;PMRUPTYP;
          GOTO      PRUG9999
.
PRUG0900  WRITE     HTMLFILE;PMRUMTYP;
          GOTO      PRUG9999
.
PRUG1000  WRITE     HTMLFILE;PMRUBMOB;
          GOTO      PRUG9999
.
PRUG1100  WRITE     HTMLFILE;PMRUTOIL;
          GOTO      PRUG9999
.
PRUG1200  WRITE     HTMLFILE;PMRUTRAN;
          GOTO      PRUG9999
.
PRUG1300  WRITE     HTMLFILE;PMRUEATG;
          GOTO      PRUG9999
.
PRUG1400  WRITE     HTMLFILE;PMRUCUID;
          GOTO      PRUG9999
.
PRUG1500  MATCH     PMRUCDAT,SP70
          GOTO      PRUG9999 IF EQUAL
          UNPACK    PMRUCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDACT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;DISPDACT;
          GOTO      PRUG9999
.
PRUG1600  WRITE     HTMLFILE;PMRUCTIM;
          GOTO      PRUG9999
.
PRUG1700  WRITE     HTMLFILE;PMRUUUID;
          GOTO      PRUG9999
.
PRUG1800  MATCH     PMRUUDTE,SP70
          GOTO      PRUG9999 IF EQUAL
          UNPACK    PMRUUDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDACT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;DISPDACT;
          GOTO      PRUG9999
.
PRUG1900  WRITE     HTMLFILE;PMRUCTIM;
          GOTO      PRUG9999
.
PRUG2000  WRITE     HTMLFILE;PMRUDELF;
          GOTO      PRUG9999
.
PRUG2100  WRITE     HTMLFILE;PMRUDUID;
          GOTO      PRUG9999
.
PRUG2200  MATCH     PMRUDDAT,SP70
          GOTO      PRUG9999 IF EQUAL
          UNPACK    PMRUDDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDACT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;DISPDACT;
          GOTO      PRUG9999
.
PRUG2300  WRITE     HTMLFILE;PMRUDTIM;
          GOTO      PRUG9999
.
PRUG2400  MOVE      "AW",CATEGORY
          MOVE      PMRUDRES,CODE
          CALL      CODITM00
          GOTO      PRUG9999
.
PRUG2500  WRITE     HTMLFILE;PMRUCPLT;
          GOTO      PRUG9999
.
PRUG2600  WRITE     HTMLFILE;PMRUFUID;
          GOTO      PRUG9999
.
PRUG2700  MATCH     PMRUFDAT,SP70
          GOTO      PRUG9999 IF EQUAL
          UNPACK    PMRUFDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDACT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;DISPDACT;
          GOTO      PRUG9999
.
PRUG2800  WRITE     HTMLFILE;PMRUFTIM;
          GOTO      PRUG9999
. 
PRUG2900  PACK      KEY24,ADMISSNO,Z70
          CALL      RSPMRUG1
PRUG2901  CALL      RPPMRUG1
          BRANCH    OVRCD,PRUG2999
.
          MATCH     ADMISSNO,PMRUVISN
          GOTO      PRUG2999 IF NOT EQUAL
.
          MATCH     "1",PMRUDELF
          GOTO      PRUG2901 IF EQUAL
.
          MATCH     "0",PMRUATYP
          GOTO      PRUG2901 IF NOT EQUAL
.
          MATCH     SP8,PMRUPSDT
          IF        @EQUAL
            MOVE      "00000000",PMRUPSDT
          ENDIF
.
          MATCH     SP8,PMRUPEDT
          IF        @EQUAL
            MOVE      "99999999",PMRUPEDT
          ENDIF
.
          IF        F1=1
            WRITE     HTMLFILE;"#"",PMRUPSDT,PMRUPEDT,PMRUADAT:
                                PMRUATIM,PMRUPTYP,PMRUASSO,"#",";
          ELSE
            WRITE     HTMLFILE;"#"",PMRUPEDT,PMRUPSDT,PMRUADAT:
                                PMRUATIM,PMRUPTYP,PMRUASSO,"#",";
          ENDIF
.
          GOTO      PRUG2901
.
PRUG2999  WRITE     HTMLFILE;"#"#"";        . Print the terminator so array doesnt error
          GOTO      PRUG9999
.
PRUG3000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          PACK      KEY24,ADMISSNO,SP70
          CALL      RSPMRUG1
PRUG3001  CALL      RKPMRUG1
          BRANCH    OVRCD,PRUG3099
.
          MATCH     ADMISSNO,PMRUVISN
          GOTO      PRUG3099 IF NOT EQUAL
.
          MATCH     "1",PMRUDELF
          GOTO      PRUG3001 IF EQUAL
.
          MATCH     "0",PMRUATYP
          GOTO       PRUG3001 IF NOT EQUAL
.
          MATCH     SP8,PMRUPSDT
          IF        @EQUAL
            MOVE      "00000000",PMRUPSDT
          ENDIF
.
          MATCH     SP8,PMRUPEDT
          IF        @EQUAL
            MOVE      "99999999",PMRUPEDT
          ENDIF
.
          IF        F1=1
            WRITE     HTMLFILE;"#"",PMRUPSDT,PMRUPEDT,PMRUADAT:
                                PMRUATIM,PMRUPTYP,PMRUASSO,"#",";
          ELSE
            WRITE     HTMLFILE;"#"",PMRUPEDT,PMRUPSDT,PMRUADAT:
                                PMRUATIM,PMRUPTYP,PMRUASSO,"#",";
          ENDIF
.            
          GOTO      PRUG3001
.
PRUG3099  WRITE     HTMLFILE;"#"#"";        . Print the terminator so array doesnt error
          GOTO      PRUG9999
.
PRUG9999  RETURN
.
.-------------------------------------------------------------------------------
. Move RUG-ADL Scores cgi variables to file variables
.-------------------------------------------------------------------------------
MVPRUG00  MATCH     Z70,ADMISSNO
          IF        !@EQUAL
            MOVE      ADMISSNO,PMRUVISN
          ENDIF
.
          MATCH     Z70,PMRUG002
          IF        !@EQUAL
            MOVE      PMRUG002,PMRUADAT
          ENDIF
.
          MATCH     Z70,PMRUG003
          IF        !@EQUAL
            MOVE      PMRUG003,PMRUATIM
          ENDIF
.
          MATCH     Z70,PMRUG004
          IF        !@EQUAL
            MOVE      PMRUG004,PMRUATYP
          ENDIF
.
          MATCH     Z70,PMRUG005
          IF        !@EQUAL
            MOVE      PMRUG005,PMRUASSO
          ENDIF
.
          MATCH     Z70,PMRUG006
          IF        !@EQUAL
            MOVE      PMRUG006,PMRUPSDT
          ENDIF
.
          MATCH     Z70,PMRUG007
          IF        !@EQUAL
            MOVE      PMRUG007,PMRUPEDT
          ENDIF
.
          MATCH     Z70,PMRUG008
          IF        !@EQUAL
            MOVE      PMRUG008,PMRUPTYP
          ENDIF
.
          MATCH     Z70,PMRUG009
          IF        !@EQUAL
            MOVE      PMRUG009,PMRUMTYP
          ENDIF
.
          MATCH     Z70,PMRUG010
          IF        !@EQUAL
            MOVE      PMRUG010,PMRUBMOB
          ENDIF
.
          MATCH     Z70,PMRUG011
          IF        !@EQUAL
            MOVE      PMRUG011,PMRUTOIL
          ENDIF
.
          MATCH     Z70,PMRUG012
          IF        !@EQUAL
            MOVE      PMRUG012,PMRUTRAN
          ENDIF
.
          MATCH     Z70,PMRUG013
          IF        !@EQUAL
            MOVE      PMRUG013,PMRUEATG
          ENDIF
.
          MATCH     Z70,PMRUG014
          IF        !@EQUAL
            MOVE      PMRUG014,PMRUCUID
          ENDIF
.
          MATCH     Z70,PMRUG015
          IF        !@EQUAL
            MOVE      PMRUG015,PMRUCDAT
          ENDIF
.
          MATCH     Z70,PMRUG016
          IF        !@EQUAL
            MOVE      PMRUG016,PMRUCTIM
          ENDIF
.
          MATCH     Z70,PMRUG017
          IF        !@EQUAL
            MOVE      PMRUG017,PMRUUUID
          ENDIF
.
          MATCH     Z70,PMRUG018
          IF        !@EQUAL
            MOVE      PMRUG018,PMRUUDTE
          ENDIF
.
          MATCH     Z70,PMRUG019
          IF        !@EQUAL
            MOVE      PMRUG019,PMRUUTIM
          ENDIF
.
          MATCH     Z70,PMRUG020
          IF        !@EQUAL
            MOVE      PMRUG020,PMRUDELF
          ENDIF
.
          MATCH     Z70,PMRUG021
          IF        !@EQUAL
            MOVE      PMRUG021,PMRUDUID
          ENDIF
.
          MATCH     Z70,PMRUG022
          IF        !@EQUAL
            MOVE      PMRUG022,PMRUDDAT
          ENDIF
.
          MATCH     Z70,PMRUG023
          IF        !@EQUAL
            MOVE      PMRUG023,PMRUDTIM
          ENDIF
.
          MATCH     Z70,PMRUG024
          IF        !@EQUAL
            MOVE      PMRUG024,PMRUDRES
          ENDIF
.
          MATCH     Z70,PMRUG025
          IF        !@EQUAL
            MOVE      PMRUG025,PMRUCPLT
          ENDIF
.
          MATCH     Z70,PMRUG026
          IF        !@EQUAL
            MOVE      PMRUG026,PMRUFUID
          ENDIF
.
          MATCH     Z70,PMRUG027
          IF        !@EQUAL
            MOVE      PMRUG027,PMRUFDAT
          ENDIF
.
          MATCH     Z70,PMRUG028
          IF        !@EQUAL
            MOVE      PMRUG028,PMRUFTIM
          ENDIF
.
MVPRUG99  RETURN
.
.-------------------------------------------------------------------------------
. Clear RUG-ADL Scores file variables
.-------------------------------------------------------------------------------
CLPRUG00  MOVE      SP70,PMRUVISN
          MOVE      SP70,PMRUADAT
          MOVE      SP70,PMRUATIM
          MOVE      SP70,PMRUATYP
          MOVE      SP70,PMRUASSO
          MOVE      SP70,PMRUPSDT
          MOVE      SP70,PMRUPEDT
          MOVE      SP70,PMRUPTYP
          MOVE      SP70,PMRUMTYP
          MOVE      SP70,PMRUBMOB
          MOVE      SP70,PMRUTOIL
          MOVE      SP70,PMRUTRAN
          MOVE      SP70,PMRUEATG
          MOVE      SP70,PMRUCUID
          MOVE      SP70,PMRUCDAT
          MOVE      SP70,PMRUCTIM
          MOVE      SP70,PMRUUUID
          MOVE      SP70,PMRUUDTE
          MOVE      SP70,PMRUUTIM
          MOVE      SP70,PMRUDELF
          MOVE      SP70,PMRUDUID
          MOVE      SP70,PMRUDDAT
          MOVE      SP70,PMRUDTIM
          MOVE      SP70,PMRUDRES
          MOVE      SP70,PMRUCPLT
          MOVE      SP70,PMRUFUID
          MOVE      SP70,PMRUFDAT
          MOVE      SP70,PMRUFTIM
.
CLPRUG99  RETURN

.*****************************************************************************
.*                                AUDOTBOA                                   *
.*  Write an audit record to outaudba for an O/P Booking A record (outbokaf) *
.* Requires: Read of HOAUDA (Sector 31, Posn 51)                             *
.*           AUDIFLAG - audit type record flag                               *
.*                      1 = add record                                       *
.*                      2 = before change record                             *
.*                      3 = after change record                              *
.*                      4 = delete record                                    *
.*           Relevant READ or setting of the outbokaf variables.             *
.*****************************************************************************
.
AUDOTBOA  BRANCH    HOAUDA,OTBOA999              * outbokaf audits turned off
.
          COMPARE   THREE,AUDIFLAG               * after change ?
          GOTO      OTBOA200 IF EQUAL            * yes
.
          CALL      IBACLOCK                     * get current date
          PACK      OTBAAUDD,CCC,CYY,CMM,CDD     * load current date
          REP       " 0",OTBAAUDD
          MOVE      CTIMEIS,OTBAAUDT             * load current time
          MOVE      ONE,OTBAAUDS                 * load print status
          MOVE      PASSCODE,OTBAAUDO            * load user ID
          MOVE      PORT,OTBAAUDP                * load port number
.
OTBOA200  MOVE      AUDIFLAG,OTBAAUDR
          REP       "1A2B3C4D",OTBAAUDR
          PACK      KEY19,OTBAAUDD,OTBAAUDT,OTBAAUDP,OTBAAUDR
          CALL      AWOTBOA                      * write audit record
.
OTBOA999  RETURN
+

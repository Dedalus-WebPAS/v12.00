.******************************************************************************
.* Include Name   : OUTMR3N2.PBL                                              *
.* Name           : Print User Defined MR3 details                            *
.* Date           : many years ago                                            *
.* Function       : To print the details on ID Sheets                         *
.* Requires       : OUTBOK, OUTXSC, PATCODES, PATDOC, PATMAS & PATRESP vars   *
.* NOTE           : make sure the ibavaraf file is updated !!!!!              *
.* Modifications  :                                                           *
.*                                                                            *
.******************************************************************************
.* V12.00.01 08/09/2025  Thanh T          TSK 0949457                         *
.*           Added PR2M3E70 to PR2M3H40 fields                                *
.******************************************************************************
.* V11.04.02 03/09/2024  Thanh T        TSK 0911388                           *
.*           Added GCCARF00 for retrieving concession card details. Fixed     *
.*           issue with DVA card details and pension expiry date not          *
.*           returning correctly                                              *
.* V11.04.01 27/11/2023  Peter Vela     TSK 0935874                           *
.*           Added validation for PTCNUNET = 3                                *
.* V11.02.02 13/04/2022  Thanh T          TSK 0903453                         *
.*           Added PR2M3E10 to PR2M3E60 for Identifying gender/pronoun and    *
.*           free text fields                                                 * 
.* V11.02.01 21/01/2022  Jacob Jackson    TSK 0864505                         *
.*           Added PR2M3D20-PR2M3D60 for preferred name details               *
.* V11.00.04 16/11/2020  Thanh T          TSK 0878747                         *
.*           Added PR2M3D10 for multiple birth details                        *
.* V11.00.03 03/04/2020  Thanh T          TSK 0879163                         *
.*           Changed PR2M3455, PR2M3460 for sex category changes              * 
.*           Added PR2M3D00 to get sex long description                       *
.* V11.00.02 02/04/2020  J.Tan            TSK 0868813                         *
.*           Changed PKNAME to DIM80                                          *
.* V11.00.01 23/03/2020  Peter Vela       TSK 0889143                         *
.*           Fixed OUTLET IO calls                                            *
.* V10.15.01 17/10/2019  Ken Bell         TSK 0875392                         *
.*           Exclude Claim data if Claim is Cancelled                         *
.* V10.14.01 19/02/2019  Ebon Clements  TSK 0867703                           *
.*           Changed NHI ethnicity file reads to use KEY5                     *
.******************************************************************************
.* V10.13.01 31/10/2018  Ebon Clements  TSK 0865864                           *
.*           Added save and restore of outlpcaf fields instead                *
.*           re reads - SOTL0000 and ROTL0000                                 *
.******************************************************************************
.* V10.11.01 23/08/2017  Thanh T.       TSK 0821710                           *
.*           Audit Amission/outpatient visit comments                         *
.******************************************************************************
.*        V10.10.01 20/03/2017  Thanh T.         TSK 0832066                  *
.*                  Changed DVA PREPAT/PMPXDVAC fields to use the new         *
.*                  concession card PMCDCNUM/PMCDDVAC fields                  * 
.*        V10.08.01 10/08/2016  Davin            TSK 0321234                  *
.*                  Added vars 391 - 420 (PR2M3C96)                           *
.*                  Added PRTALCPW for Alert Care Pathway Fields              *
.*        V10.07.01 16/11/2015 Peter Vela     CAR 323632                      *
.*                  Fixed last line validation in PR2M3980                    *
.*        V10.06.02 11/05/2015 Ebon Clements  CAR 298921                      *
.*                  Changes to use OUTCLIFD index 1 instead of index 2        *
.*        V10.06.01 31/03/2015  Peter Vela     CAR 298921                     *
.*                  Changed OTBBADCS read to pmshcpaf                         *
.*        V10.05.01 13/10/2014  Ania P         CAR 303879                     *
.*                  Added HP code output                                      *
.*        V10.04.02 16/04/2014  Davin          CAR 297815                     *
.*                  Added PR2M3C85 to PR2M3C93 (fields 380 - 388)             *
.*        V10.04.01 17/02/2014  Don Nguyen     CAR 291879                     *
.*                  Added PR2M3C84 - field 379 (IHI Number)                   *
.*        V10.03.07 18/07/2013  Don Nguyen     CAR 288603                     *
.*                  Added PR2M3C82 & PR2M3C83 - Patient Type/Description      *
.*        V10.03.06 08/03/2013  Jill Parkinson CAR 276982                     *
.*                  ChangedPR2M3A65 to output PMHCPOST instead of PMHCADR6    *
.*        V10.03.05 14/01/2013  Saroeun Soeur  CAR 276985                     *
.*                  added Date of Death and Death? PR2M3C80 & PR2M3C81        *
.*        V10.03.04 04/12/2012  Jill Parkinson CAR 276982                     *
.*                  Fixed PR2M3A65 to subtract 257 instead of 256             *
.*        V10.03.03 09/02/2012  J.Tan         CAR 259311                      *
.*                  Fixed printing patient Age                                *
.*        V10.03.02 31/01/2012  J.Tan         CAR 247090                      *
.*                  Added new variables for Multiple Card Type                *
.*        V10.03.01 13/01/2012  J.Tan         CAR 256936                      *
.*                  Mods to recalculate patient Age                           *
.*        V10.02.03 01/07/2011  Ebon Clements  CAR 242246                     *
.*                  Added clinic location phone number                        *
.*        V10.02.02 07/06/2011  Ebon Clements  CAR 239530                     *
.*                  Added print extra contact functionality                   *
.*        V10.02.01 04/04/2011  Jill Parkinson CAR 239574                     *
.*                  Removed open of ibaprntf                                  *
.*        V10.01.01 20/12/2010  Ebon Clements CAR 222021                      *
.*                  Fixed print of DVA card colour if blank var 233           *
.*        V10.00.01 27/04/2010  Peter Vela        CAR 218333                  *
.*                  - Added vars 340-368                                      *
.*        V9.12.01  12/11/2009  Peter Vela        CAR 199757                  *
.*                  Added Next Stationery Code Type 1                         *
.*        V9.11.02  04/03/2009  Jill Habasque     CAR 134681                  *
.*                  - Added vars 323-337                                      *
.*        V9.11.01  05/11/2008  Steve Armstrong   CAR 182320                  *
.*                  - Added vars 319-322.                                     *
.*                  - Fixed vars 187 to 193:                                  *
.*                    Var 187 (PRA Address Line 4) was never available and was*
.*                    actually loading Cat P2.  The remainder were therefore  *
.*                    out (reduced) by one in their variable numbers.         *
.*                  - Added GOTO  PR2M3880 after formatting care full name    *
.*                    (variable 278).                                         *
.*                  - Removed PRINT *N; at start of PRTMR3N2 routine.         *
.*                  - Fixed looping to get to next line for printing.         *
.*                  - Fixed VARIABLE length setting for text fields prior to  *
.*                    printing (code was missing).                            *
.******************************************************************************
.*        V9.10.01  09/09/2008 Ebon Clements    CAR 175728                    *
.*                  Added vars 316 to 318 - Compensable vars and pmi address  *
.******************************************************************************
.*        V9.09.01  12/12/2007 Ebon Clements    CAR 157081                    *
.*                  Added patient e-mail address                              *
.******************************************************************************
.*        V9.08.04  16/03/2007  Ebon Clements      CAR 135648                 *
.*                  Removed close of clinic type file from PR2M3622           *
.*        V9.08.03  06/02/2007  Neelkamal Pyla     CAR 120594                 *
.*                  Added NOK Relation Desc and Title Desc                    *
.*        V9.08.02  13/12/2006  J.Tan              CAR 127625                 *
.*                  Mods to Singapore HRN                                     *
.*        V9.08.01  15/11/2006  Steve Armstrong    CAR 124160                 *
.*                  Added Singapore HRN                                       *
.******************************************************************************
.*        V9.07.01  25/07/2006  Ebon Clements      CAR 99899                  *
.*                  Added extra screen cat codes                              *
.******************************************************************************
.*        V9.05.01  27/03/2006  Peter Vela         CAR 61299                  *
.*                  Increased field no size from DIM3 to DIM5                 *
.*        V9.05.00  24/03/2006  Ebon Clements      CAR 79277                  *
.*                  Added carer contact details                               *
.******************************************************************************
.*        V9.04.09  03/11/2005  Peter Vela         CAR 79842                  *
.*                  Added Next of Kin Mobile number                           *
.*                  Added Next of Kin Email Address                           *
.*                  Added Emergency Contact Mobile number                     *
.*                  Added Emergency Contact Email Address                     *
.*                  Added Nearest Relative Mobile Number                      *
.*                  Added Nearest Relative Email Address                      *
.*        V9.04.08  18/08/2005  Peter Vela         CAR 69456                  *
.*                  Added Local GP Formatted full name                        *
.*        V9.04.07  08/08/2005  Peter Vela         CAR 67204                  *
.*                  Added Local GP Practice Code                              *
.*                  Added Ref. GP Practice Name                               *
.*                  Added Ref. GP Address Line 2 - 6                          *
.*                  Added Ref. GP Telephone Number                            *
.*                  Added Ref. GP Fax Number                                  *
.*                  Added Ref. GP Mobile Number                               *
.*                  Added Ref. GP Pager Telephone Number                      *
.*                  Added Ref. GP Pager Number                                *
.*                  Provider Number                                           *
.*        V9.04.06  27/07/2005  Steve Armstrong    CAR 66545                  *
.*                  Added Local GP Preferred Contact Code (255) and           *
.*                  Description (256).                                        *
.*        V9.04.05  20/07/2005  Peter Vela    CAR 63023                       *
.*                  Added Local GP Practice Fax Number (pmspx2af)             *
.*                  Added Local GP Practice Email Address (pmspx2af)          *
.*        V9.04.04  13/05/2005  Peter Vela    CAR 61796                       *
.*                  Added Booking Slot Time          (outbokaf)               *
.*                  Added Booking Slot Date          (outbokaf)               *
.*                  Added Visit Type Code (CAT CV)   (outbokaf)               *
.*                  Added Visit Type Desc (CAT CV)   (outbokaf)               *
.*                  Added Presenting Complaint       (pmsvx1af)               *
.*                  Added Source of Referral Code    (outbokaf)               *
.*                  Added Source of Referral Desc    (outbokaf)               *
.*        V9.04.03  01/03/2005  Peter Vela    CAR 57244                       *
.*                  Added Claim Code code (outbb1af)                          *
.*        V9.04.02  04/10/2004  Jill Habasque CAR 53798                       *
.*                  Mods to print approval number for pathspaf                *
.*        V9.04.01  23/09/2004  Peter Vela    CAR 53708                       *
.*                  Added GP/HCP Fax Number (Outpatient based)                *
.*        V9.03.01  11/06/2004  Mike Laming   CAR 49016  July 2004 PRS/2      *
.*                  - Add Sex Description routine SEXDSC00 with Code "R" -    *
.*                  "Intersex" added                                          *
.*        V9.00.B02 08.10.2001  Bronko Sosic                                  *
.*                  Added var from PMSPX2FD PMSVX1FD OUTBB1FD OUTMA1FD        *
.*        V9.00.B01 14.07.2001  Sandra Barcham                                *
.*                  Replace GP with HCP                                       *
.*        V5.08.03  01/09/2000  Tonii                                         *
.*                  Mods to accept Unknown and Indeterminate as valid patient *
.*                  sex description                                           *
.*        V5.08.02  06/06/2000  Jill Habasque                                 *
.*                  Changed from key10 to key14 for the health fund file      *
.*        V5.08.01  16/03/2000  Steve Armstrong   5.08 Mods                   *
.*                  Mods for changes to OUTCLIFD (effective date)             *
.******************************************************************************
.*        V5.07.02  14/11/1999  Steve Downing  SRF 632517                     *
.*                  Added Health fund desc, Claim code desc, U1 desc,         *
.*                  P2 code & desc                                            *
.*        V5.07.01  09/11/1998  Katie Nelson                                  *
.*                  Removed the include PATPAOFS                              *
.*        V5.07.00  15/10/1998  Jim Stathopoulos                              *
.*                  507 Changes                                               *
.******************************************************************************
.*        V5.05.05  13/01/1998  Nick     SRF 643695                           *
.*                  Added PNKADD4,PKADD4,PADD4,PTMXECA4,PTMXNRA4              *
.******************************************************************************
.*        V5.04.04  23/05/1997  Steve Armstrong   SRF 642902                  *
.*                  Added open on IBAPRNT1                                    *
.*        V5.04.03  08/04/1997  Howellsy                                      *
.*                  Added PTMXCELL,PTMXADD1-4,PTMXPOST,NHMAETH1-3,NHMARES,PSMOK
.*        V5.04.01  25/03/1997  Greg Horvat      SRF 619251                   *
.*                  Added outxscaf doctor code 1 details & date 1             *
.*        V5.03.01  27/10/1995    Justin Coates  (SUHT mods)                  *
.*                  added alerts (1-10) and variables (155-157)               *
.******************************************************************************
.
.------- Perform the line-up print ------
.
LINMR3N2  CALL      OPNPRINT                   * open the spool file
.
          PRINT     *N;
          MOVE      ONE,CURRROW
          PACK      KEY12,HOMR3COD,SP6         * position on details file
          CALL      RSIBDET1
          CALL      RKIBDET1
          BRANCH    OVRCD,LN2M3990
.
          MATCH     HOMR3COD,IBDTSCOD          * match stationary codes
          GOTO      LN2M3990 IF NOT EQUAL
.
          MOVE      IBDTROW,LASTROW
.
          COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      LN2M3200 IF EQUAL
.
.------ print new-lines until current row equals the one read in ------
.
LN2M3000  PRINT     *N;
          ADD       ONE,CURRROW
.
          COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      LN2M3200 IF EQUAL
.
          GOTO      LN2M3000
.
.------ read through the details file ------
.
LN2M3100  CALL      RKIBDET1
          BRANCH    OVRCD,LN2M3900
.
          MATCH     HOMR3COD,IBDTSCOD          * match stationary codes
          GOTO      LN2M3900 IF NOT EQUAL
.
          MOVE      IBDTROW,LASTROW
.
          COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      LN2M3200 IF EQUAL
.
.------ print new-lines until current row equals the one read in ------
.
LN2M3110  PRINT     *N;
          ADD       ONE,CURRROW
.
          COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      LN2M3200 IF EQUAL
.
          GOTO      LN2M3110
.
.------ branch on field indicator ------
.
LN2M3200  BRANCH    IBDTINDC,LN2M3300,LN2M3400
.
.------ field is a text field ------
.
LN2M3300  PRINT     *IBDTCOL,IBDTTXFL;
          GOTO      LN2M3100
.
.------ field is a data field ------
.
LN2M3400  MOVE      IBDTTXFL,DIM5
          MOVE      DIM5,FORM5
.
          BRANCH    FORM5,LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: *  10
                          LN2M3450,LN2M3480,LN2M3450,LN2M3430,LN2M3470:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: *  20
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: *  30
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: *  40
                          LN2M3530,LN2M3450,LN2M3450,LN2M3500,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3540,LN2M3450: *  50
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: *  60
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3470,LN2M3450,LN2M3450,LN2M3450,LN2M3450: *  70
                          LN2M3450,LN2M3480,LN2M3450,LN2M3430,LN2M3470:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: *  80
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: *  90
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: * 100
                          LN2M3450,LN2M3450,LN2M3450,LN2M3540,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: * 110
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: * 120
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: * 130
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: * 140
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: * 150
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: * 160
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3470: * 170
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: * 180
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:      
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: * 190
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450:
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450: * 200
                          LN2M3450,LN2M3450,LN2M3450,LN2M3450,LN2M3450 * 205
.
.------ format patients age ------
.
LN2M3430  MOVE      "999",VARIABLE
          GOTO      LN2M3600
.
.------ format all other Dim fields ------
.
LN2M3450  PACK      VARIABLE,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10
          GOTO      LN2M3600
.
.------ format date variables ------
.
LN2M3470  MOVE      "99/99/9999",VARIABLE
          GOTO      LN2M3600
.
.------ format indicators ------
.
LN2M3480  MOVE      "9",VARIABLE
          GOTO      LN2M3600
.
.------ format admission number ------
.
LN2M3500  MOVE      "99999999",VARIABLE
          GOTO      LN2M3600
.
.------ format pension number expiry date ------
.
LN2M3530  MOVE      "99/99",VARIABLE
          GOTO      LN2M3600
.
.------ format years resident ------
.
LN2M3540  MOVE      "99",VARIABLE
          GOTO      LN2M3600
.
.------ only print amount of variable specified ------
.
LN2M3600  RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      LN2M3100
.
.------ line-up completed ------
.
LN2M3900  MOVE      FALSE,EXIT
.
.------ print new-lines until we reach the end of the page ------
.
LN2M3910  PRINT     *N;
          ADD       ONE,LASTROW
.
          COMPARE   LASTROW,IBTHLENG            * compare rows
          GOTO      LN2M3999 IF EQUAL
.
          GOTO      LN2M3910
.
.------ no data on the details file ------
.
LN2M3990  MOVE      TRUE,EXIT
.
LN2M3999  CALL      CLSPRINT                    * close the spool file
          RETURN
.
.---------------------------------------------------------------------
.         Print the MR3
.---------------------------------------------------------------------
.
PRTMR3N2  CALL      OPNPRINT                   * open the spool file
          MOVE      ONE,CURRROW
.
          PACK      KEY12,HOMR3COD,SP6
          CALL      RSIBDET1                   * position on the details file
          CALL      RKIBDET1
          BRANCH    OVRCD,PR2M3990
.
          MATCH     HOMR3COD,IBDTSCOD          * match stationary codes
          GOTO      PR2M3990 IF NOT EQUAL
.
          MOVE      IBDTROW,LASTROW
.
.------ print new-lines until current row equals the one read in ------
.
PR2M3000  COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      PR2M3200 IF EQUAL
.
          PRINT     *N;
          ADD       ONE,CURRROW
          GOTO      PR2M3000
.
.------ read through the details file ------
.
PR2M3100  CALL      RKIBDET1
          BRANCH    OVRCD,PR2M3970
.
          MATCH     HOMR3COD,IBDTSCOD          * match stationary codes
          GOTO      PR2M3970 IF NOT EQUAL
.
          MOVE      IBDTROW,LASTROW
.
.------ print new-lines until current row equals the one read in ------
.
PR2M3110  COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      PR2M3200 IF EQUAL
.
          PRINT     *N;
          ADD       ONE,CURRROW
          GOTO      PR2M3110
.
.------ branch on the field type ------
.
PR2M3200  BRANCH    IBDTINDC,PR2M3300,PR2M3400
.
.------ the field is a text field ------
.
PR2M3300  RESET     IBDTTXFL,IBDTPLEN
          LENSET    IBDTTXFL
          RESET     IBDTTXFL             
          PRINT     *IBDTCOL,*+,IBDTTXFL;    * Print data
          MOVE      IBDTROW,CURRROW          * Row printed is current row
          GOTO      PR2M3100
.
.------ the field is a data field ------
.
PR2M3400  MOVE      IBDTTXFL,DIM5
          MOVE      DIM5,FORM5
          PACK      VARIABLE,SP30,SP30,SP30,SP30,SP10
          BRANCH    FORM5,PR2M3405,PR2M3410,PR2M3415,PR2M3420,PR2M3425:
                          PR2M3430,PR2M3435,PR2M3440,PR2M3445,PR2M3450: *  10
                          PR2M3455,PR2M3460,PR2M3465,PR2M3470,PR2M3475:
                          PR2M3480,PR2M3485,PR2M3490,PR2M3495,PR2M3500: *  20
                          PR2M3505,PR2M3510,PR2M3515,PR2M3520,PR2M3525:
                          PR2M3530,PR2M3535,PR2M3540,PR2M3545,PR2M3550: *  30
                          PR2M3555,PR2M3560,PR2M3565,PR2M3570,PR2M3575:
                          PR2M3580,PR2M3585,PR2M3590,PR2M3595,PR2M3600: *  40
                          PR2M3605,PR2M3610,PR2M3615,PR2M3620,PR2M3622:
                          PR2M3624,PR2M3626,PR2M3628,PR2M3630,PR2M3632: *  50
                          PR2M3634,PR2M3636,PR2M3638,PR2M3640,PR2M3642:
                          PR2M3644,PR2M3646,PR2M3648,PR2M3650,PR2M3652: *  60
                          PR2M3654,PR2M3656,PR2M3658,PR2M3660,PR2M3662:
                          PR2M3664,PR2M3666,PR2M3668,PR2M3670,PR2M3672: *  70
                          PR2M3674,PR2M3676,PR2M3678,PR2M3680,PR2M3682:
                          PR2M3684,PR2M3686,PR2M3688,PR2M3690,PR2M3692: *  80
                          PR2M3694,PR2M3696,PR2M3698,PR2M3700,PR2M3702:
                          PR2M3704,PR2M3706,PR2M3708,PR2M3710,PR2M3712: *  90
                          PR2M3714,PR2M3716,PR2M3718,PR2M3720,PR2M3722:
                          PR2M3724,PR2M3726,PR2M3728,PR2M3730,PR2M3732: * 100
                          PR2M3734,PR2M3736,PR2M3738,PR2M3740,PR2M3742:
                          PR2M3744,PR2M3746,PR2M3748,PR2M3750,PR2M3750: * 110
                          PR2M3750,PR2M3750,PR2M3750,PR2M3750,PR2M3751:
                          PR2M3751,PR2M3751,PR2M3751,PR2M3751,PR2M3751: * 120
                          PR2M3757,PR2M3760,PR2M3762,PR2M3764,PR2M3768:
                          PR2M3768,PR2M3768,PR2M3768,PR2M3768,PR2M3768: * 130
                          PR2M3768,PR2M3768,PR2M3768,PR2M3768,PR2M3768:
                          PR2M3768,PR2M3768,PR2M3768,PR2M3768,PR2M3768: * 140
                          PR2M3768,PR2M3768,PR2M3768,PR2M3768,PR2M3768:
                          PR2M3768,PR2M3768,PR2M3768,PR2M3768,PR2M3768: * 150
                          PR2M3768,PR2M3768,PR2M3768,PR2M3768,PR2M3770:
                          PR2M3772,PR2M3774,PR2M3776,PR2M3778,PR2M3780: * 160
                          PR2M3782,PR2M3784,PR2M3786,PR2M3788,PR2M3790:
                          PR2M3792,PR2M3794,PR2M3796,PR2M3798,PR2M3800: * 170
                          PR2M3801,PR2M3802,PR2M3803,PR2M3804,PR2M3805:
                          PR2M3806,PR2M3807,PR2M3808,PR2M3809,PR2M3810: * 180
                          PR2M3811,PR2M3812,PR2M3813,PR2M3814,PR2M3815:
                          PR2M3816,PR2M3880,PR2M3818,PR2M3820,PR2M3822: * 190
                          PR2M3824,PR2M3826,PR2M3880,PR2M3829,PR2M3830:
                          PR2M3831,PR2M3832,PR2M3833,PR2M3834,PR2M3835: * 200
                          PR2M3836,PR2M3837,PR2M3838,PR2M3839,PR2M3840: 
                          PR2M3841,PR2M3842,PR2M3843,PR2M3844,PR2M3845: * 210 
                          PR2M3846,PR2M3847,PR2M3848,PR2M3849,PR2M3850: 
                          PR2M3851,PR2M3852,PR2M3853,PR2M3854,PR2M3855: * 220 
                          PR2M3856,PR2M3857,PR2M3858,PR2M3859,PR2M3860: 
                          PR2M3861,PR2M3862,PR2M3863,PR2M3864,PR2M3865: * 230 
                          PR2M3866,PR2M3867,PR2M3868,PR2M3869,PR2M3870: 
                          PR2M3871,PR2M3872,PR2M3873,PR2M3874,PR2M3875: * 240 
                          PR2M3876,PR2M3877,PR2M3878,PR2M3879,PR2M3A00:
                          PR2M3A05,PR2M3A10,PR2M3A15,PR2M3A20,PR2M3A25: * 250
                          PR2M3A30,PR2M3A35,PR2M3A40,PR2M3A45,PR2M3A50:
                          PR2M3A55,PR2M3A60,PR2M3A65,PR2M3A65,PR2M3A65: * 260
                          PR2M3A65,PR2M3A65,PR2M3A65,PR2M3A65,PR2M3A65:
                          PR2M3A65,PR2M3A65,PR2M3A65,PR2M3A70,PR2M3A75: * 270
                          PR2M3A80,PR2M3A85,PR2M3A90,PR2M3A95,PR2M3B00:
                          PR2M3B05,PR2M3B10,PR2M3B15,PR2M3B20,PR2M3B25: * 280
                          PR2M3B30,PR2M3B35,PR2M3B40,PR2M3B45,PR2M3B50:
                          PR2M3B55,PR2M3B60,PR2M3B65,PR2M3B70,PR2M3B75: * 290
                          PR2M3B80,PR2M3B81,PR2M3B82,PR2M3B83,PR2M3B84:
                          PR2M3B85,PR2M3B86,PR2M3B87,PR2M3B88,PR2M3B89: * 300
                          PR2M3B90,PR2M3B91,PR2M3B92,PR2M3B93,PR2M3B94:
                          PR2M3B95,PR2M3B96,PR2M3B97,PR2M3B98,PR2M3B99: * 310
                          PR2M3C00,PR2M3C01,PR2M3C10,PR2M3C15,PR2M3C20:
                          PR2M3C21,PR2M3C22,PR2M3C23,PR2M3C24,PR2M3C25: * 320
                          PR2M3C26,PR2M3C27,PR2M3C28,PR2M3C29,PR2M3C30:
                          PR2M3C31,PR2M3C32,PR2M3C33,PR2M3C34,PR2M3C35: * 330
                          PR2M3C36,PR2M3C37,PR2M3C38,PR2M3C39,PR2M3C40:
                          PR2M3C41,PR2M3C42,PR2M3C43,PR2M3C44,PR2M3C45: * 340
                          PR2M3C46,PR2M3C47,PR2M3C48,PR2M3C49,PR2M3C50:
                          PR2M3C51,PR2M3C52,PR2M3C53,PR2M3C54,PR2M3C55: * 350
                          PR2M3C56,PR2M3C57,PR2M3C58,PR2M3C59,PR2M3C60:
                          PR2M3C61,PR2M3C62,PR2M3C63,PR2M3C64,PR2M3C65: * 360
                          PR2M3C66,PR2M3C67,PR2M3C68,PR2M3C69,PR2M3C70:
                          PR2M3C71,PR2M3C72,PR2M3C73,PR2M3C74,PR2M3C75: * 370
                          PR2M3C76,PR2M3C77,PR2M3C78,PR2M3C79,PR2M3C80:
                          PR2M3C81,PR2M3C82,PR2M3C83,PR2M3C84,PR2M3C85: * 380
                          PR2M3C86,PR2M3C87,PR2M3C88,PR2M3C89,PR2M3C90:
                          PR2M3C91,PR2M3C92,PR2M3C93,PR2M3C94,PR2M3C95: * 390
                          PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96:
                          PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96: * 400
                          PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96:
                          PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96: * 410
                          PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96:
                          PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96,PR2M3C96: * 420
                          PR2M3C97,PR2M3880,PR2M3880,PR2M3D00,PR2M3D10:
                          PR2M3D20,PR2M3D30,PR2M3D40,PR2M3D50,PR2M3D60: * 430
                          PR2M3E10,PR2M3E20,PR2M3E30,PR2M3E40,PR2M3E50:   
                          PR2M3E60,PR2M3E70,PR2M3E80,PR2M3E90,PR2M3F00: * 440
                          PR2M3F10,PR2M3F20,PR2M3F30,PR2M3F40,PR2M3F50:
                          PR2M3F60,PR2M3F70,PR2M3F80,PR2M3F90,PR2M3G00: * 450
                          PR2M3G10,PR2M3G20,PR2M3G30,PR2M3G40,PR2M3G50:
                          PR2M3G60,PR2M3G70,PR2M3G80,PR2M3G90,PR2M3H00: * 460
                          PR2M3H10,PR2M3H20,PR2M3H30,PR2M3H40

.                                                                     
.------ format the patients surname ------
.
PR2M3405  MOVE      PSNAME,VARIABLE
          GOTO      PR2M3880
.
.------ format the patients title ------
.
PR2M3410  MOVE      PTITL,VARIABLE
          GOTO      PR2M3880
.
.------ format the patients given name ------
.
PR2M3415  MOVE      PGNAME,VARIABLE
          GOTO      PR2M3880
.
.------ format the U/R number ------
.
PR2M3420  MOVE      OBAURNO,VARIABLE
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PR2M3950
.
.------ format the case notes indicator ------
.
PR2M3425  MOVE      SP1,ANS
          LOAD      ANS,PCASE,CCNOTES
          MOVE      ANS,VARIABLE
          GOTO      PR2M3880
.
.------ format the patients address line 1 ------
.
PR2M3430  MOVE      PADD1,VARIABLE
          GOTO      PR2M3880
.
.------ format the patients address line 2 ------
.
PR2M3435  MOVE      PADD2,VARIABLE
          GOTO      PR2M3880
.
.------ format the post code ------
.
PR2M3440  MOVE      PPOST,VARIABLE
          GOTO      PR2M3880
.
.------ format the private telephone number ------
.
PR2M3445  MOVE      PTELEP,VARIABLE
          GOTO      PR2M3880
.
.------ format the suburb ------
.
PR2M3450  MOVE      PSUBRB,VARIABLE
          GOTO      PR2M3880
.
.------ format the patients sex description ------
.
PR2M3455  MOVE      SP70,VARIABLE
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSP00      
          MOVE      DSEXASC1,VARIABLE
          GOTO      PR2M3880
.
.------ format the sex indicator ------
.
PR2M3460  MOVE      ZERO,HDPSEX
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSP00                
          MOVE      DSEXIND1,VARIABLE
          GOTO      PR2M3880
.
.------ format the country of birth description ------
.
PR2M3465  MOVE      SP20,TDESC
          MATCH     SP3,PCONT
          GOTO      PR2M3468 IF EQUAL
.
          PACK      KEY5,CODEC,PCONT
          CALL      RDCODE1                * read the patient codes file
          BRANCH    OVRCD,PR2M3468
.
PR2M3468  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format patients age ------
.
PR2M3470  PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
          IF        PCEASE=1
            MATCH     SP70,PDECDTE
            IF        !@EQUAL
              MOVE      PDECDTE,AGEDATE            * Date of Death
            ENDIF
          ENDIF
          REP       " 0",AGEDATE
          CALL      CALCAGE
.
          PACK      VARIABLE,PSAGEYRS,SP70,SP10
          MOVE      THREE,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PR2M3880
.
.------ format the patients birth date ------
.
PR2M3475  UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          PACK      VARIABLE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          GOTO      PR2M3880
.
.------ format the patient pension number ------
.
PR2M3480  MOVE      PPENNO,VARIABLE
          GOTO      PR2M3880
.
.------ format the religion description ------
.
PR2M3485  MOVE      SP20,TDESC
          MATCH     SP3,PREG
          GOTO      PR2M3488 IF EQUAL
.
          PACK      KEY5,CODER,PREG
          CALL      RDCODE1                * read the patient codes file
          BRANCH    OVRCD,PR2M3488
.
PR2M3488  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the patient religion HDP Eq. ------
.
PR2M3490  MOVE      SP4,HDPRELG
          MATCH     SP3,PREG
          GOTO      PR2M3493 IF EQUAL
.
          PACK      KEY5,CODER,PREG
          CALL      RDCODE1                * read the patient codes file
          BRANCH    OVRCD,PR2M3493
.
          MOVE      THCSCOD,HDPRELG
.
PR2M3493  MOVE      HDPRELG,VARIABLE
          GOTO      PR2M3880
.
.------ format the patients occupation ------
.
PR2M3495  MOVE      POCCUP,VARIABLE
          GOTO      PR2M3880
.
.------ format the marital status description ------
.
PR2M3500  MOVE      SP20,TDESC
          MATCH     SP3,PMSTAT
          GOTO      PR2M3503 IF EQUAL
.
          PACK      KEY5,CODEM,PMSTAT
          CALL      RDCODE1                * read the patient codes file
          BRANCH    OVRCD,PR2M3503
.
PR2M3503  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the marital status HDP Eq. ------
.
PR2M3505  MOVE      SP10,HDPMSTA
          MATCH     SP3,PMSTAT
          GOTO      PR2M3508 IF EQUAL
.
          PACK      KEY5,CODEM,PMSTAT
          CALL      RDCODE1                * read the patient codes file
          BRANCH    OVRCD,PR2M3508
.
          MOVE      THCSCOD,HDPMSTA
.
PR2M3508  MOVE      HDPMSTA,VARIABLE
          GOTO      PR2M3880
.
.------ format the next of kin name ------
.
PR2M3510  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCESNAM,PACSNAME
            MOVE      PMCEGNAM,PACGNAME
            MOVE      PMCETITL,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,VARIABLE
          ELSE
            MOVE      PNKNAME,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the next of kin relationship ------
.
PR2M3515  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCERELP,VARIABLE
          ELSE
            MOVE      PNKRELP,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the next of kin private telephone number ------
.
PR2M3520  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELP,VARIABLE
          ELSE
            MOVE      PNKTELP,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the next of kin address line 1------
.
PR2M3525  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD1,VARIABLE
          ELSE
            MOVE      PNKADD1,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the next of kin address line 2------
.
PR2M3530  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD2,VARIABLE
          ELSE
            MOVE      PNKADD2,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the next of kin post code ------
.
PR2M3535  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEPOST,VARIABLE
          ELSE
            MOVE      PNKPOST,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the next of kin suburb ------
.
PR2M3540  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD3,VARIABLE
          ELSE
            MOVE      PNKSUBR,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the person financially responsible name ------
.
PR2M3545  PACK      PKNAME,SP70,SP10
          MOVE      OBAOUTNO,KEY8
          CALL      RDRESP1
          MOVE      PKNAME,VARIABLE
          GOTO      PR2M3880
.
.------ format the financially responsible relationship ------
.
PR2M3550  MOVE      "SELF",PKRELP
          MOVE      OBAOUTNO,KEY8
          CALL      RDRESP1
          MOVE      PKRELP,VARIABLE
          GOTO      PR2M3880
.
.------ format the person financially responsible private telephone no. ------
.
PR2M3555  MOVE      SP20,PKTELEP
          MOVE      OBAOUTNO,KEY8
          CALL      RDRESP1
          MOVE      PKTELEP,VARIABLE
          GOTO      PR2M3880
.
.------ format the person financially responsible address line 1 ------
.
PR2M3560  MOVE      SP30,PKADD1
          MOVE      OBAOUTNO,KEY8
          CALL      RDRESP1
          MOVE      PKADD1,VARIABLE
          GOTO      PR2M3880
.
.------ format the person financially responsible address line 2 ------
.
PR2M3565  MOVE      SP30,PKADD2
          MOVE      OBAOUTNO,KEY8
          CALL      RDRESP1
          MOVE      PKADD2,VARIABLE
          GOTO      PR2M3880
.
.------ format the person financially responsible post code ------
.
PR2M3570  MOVE      SP4,PKPOST
          MOVE      OBAOUTNO,KEY8
          CALL      RDRESP1
          MOVE      PKPOST,VARIABLE
          GOTO      PR2M3880
.
.------ format the person financially responsible suburb ------
.
PR2M3575  MOVE      SP20,PKSUBR
          MOVE      OBAOUTNO,KEY8
          CALL      RDRESP1
          MOVE      PKSUBR,VARIABLE
          GOTO      PR2M3880
.
.------ format the insurance status description ------
.
PR2M3580  MOVE      SP20,TDESC
          MATCH     SP3,OBAINS
          GOTO      PR2M3583 IF EQUAL
.
          PACK      KEY5,ANSU,ONE,OBAINS
          CALL      RDCODE1
          BRANCH    OVRCD TO PR2M3583
.
PR2M3583  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the insurance status HDP Eq. ------
.
PR2M3585  MOVE      SP10,HDPINSU
.
          MATCH     SP3,OBAINS
          GOTO      PR2M3588 IF EQUAL
.
          PACK      KEY5,ANSU,ONE,OBAINS
          CALL      RDCODE1
          BRANCH    OVRCD TO PR2M3588
.
          MOVE      THCSCOD,HDPINSU
.
PR2M3588  MOVE      HDPINSU,VARIABLE
          GOTO      PR2M3880
.
.------ format the local doctor ------
.
PR2M3590  MOVE      PLOCDOC,VARIABLE
          GOTO      PR2M3880
.
.------ format the health fund description ------
.
PR2M3595  MOVE      SP30,HFNAME
          MATCH     SP6,PFUNDH
          GOTO      PR2M3598 IF EQUAL
.
          PACK      KEY14,PFUNDH,PFNDTB,SP10
          CALL      RDFUND1
          BRANCH    OVRCD,PR2M3598
.
PR2M3598  MOVE      HFNAME,VARIABLE
          GOTO      PR2M3880
.
.------ format the patient fund membership number ------
.
PR2M3600  MOVE      PFNDMM,VARIABLE
          GOTO      PR2M3880
.
.------ format the pension number expiry date ------
.
PR2M3605  MOVE      FOUR,DIM1
          CALL      GCCARF00
          MATCH     SP70,PMCDEXDT
          IF        @EQUAL
            MOVE      SP70,VARIABLE
          ELSE 
            UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
            PACK      KEY7,CMON,SLASH,CCENT,CYEAR
            MOVE      KEY7,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the medicare number ------
.
PR2M3610  MOVE      PMEDI,VARIABLE
          GOTO      PR2M3880
.
.------ format the source of referral HDP Eq.------
.
PR2M3615  MOVE      SP10,SRCR4
.
          MATCH     SP3,OBASRCR
          GOTO      PR2M3618 IF EQUAL
.
          PACK      KEY5,OSTCATG,OBASRCR
          CALL      RDCODE1
          BRANCH    OVRCD OF PR2M3618
          MOVE      THCSCOD,SRCR4
.
PR2M3618  MOVE      SRCR4,VARIABLE
          GOTO      PR2M3880
.
.------ format the admission number ------
.
PR2M3620  MOVE      OBAOUTNO,VARIABLE
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PR2M3950
.
.------ format the Clinic Type description ------
.
PR2M3622  PACK      OCTDESC,SP20,SP10
          PACK      CFNAME,UID,FILCTYA1       * Name of clinic type file
          OPEN      OUTCTYA1,CFNAME
.
          PACK      KEY12,OBASITE,OBACTYP
          CALL      RDCTYA1
.
          MOVE      OCTDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the Clinic Type code ------
.
PR2M3624  MOVE      OBACTYP,VARIABLE
          GOTO      PR2M3880
.
.------ format the Clinic ID description ------
.
PR2M3626  PACK      KEY20,OBASITE,OBACLIN,OBADATE
          CALL      RDCLIA1
          IF        OVRCD = 1
            CALL      RDPCLIA1
            IF        OVRCD = 0
              MATCH     OBASITE,OCASITE
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ELSE
                MATCH     OBACLIN,OCACLIN
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          IF        OVRCD = 1
            MOVE      "Unknown clinic",OCADESC
            PACK      OCADESC,OCADESC,SP30
            GOTO      PR2M3627
          ENDIF
.
          MATCH     SP6,OCADOCT
          GOTO      PR2M3627 IF EQUAL
.
          MOVE      OCADOCT,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,PR2M3627
.
.         Pack up the doctors name into a "nice" format
.
          CALL      CONCATDR            * Routine found in OUTDSCLN
          MOVE      DIM40,OCADESC       * Move doctors name into OCADESC
.
PR2M3627  MOVE      OCADESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the Clinic ID code ------
.
PR2M3628  MOVE      OBACLIN,VARIABLE
          GOTO      PR2M3880
.
.------ format the Year resident ------
.
PR2M3630  MOVE      PYRRES,VARIABLE
          MOVE      TWO,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PR2M3950
.
.------ format the User defined field 1 code (O1) ------
.
PR2M3632  MOVE      OBOUSR1,VARIABLE
          GOTO      PR2M3880
.
.------ format the User defined field 1 description (O1) ------
.
PR2M3634  MOVE      SP20,TDESC
          MATCH     SP3,OBOUSR1
          GOTO      PR2M3635 IF EQUAL
.
          PACK      KEY5,ANSO,ONE,OBOUSR1
          CALL      RDCODE1
.
PR2M3635  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the User defined field 2 code (O2) ------
.
PR2M3636  MOVE      OBOUSR2,VARIABLE
          GOTO      PR2M3880
.
.------ format the User defined field 2 description (O2) ------
.
PR2M3638  MOVE      SP20,TDESC
          MATCH     SP3,OBOUSR2
          GOTO      PR2M3639 IF EQUAL
.
          PACK      KEY5,ANSO,TWO,OBOUSR2
          CALL      RDCODE1
.
PR2M3639  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the User defined field 3 code (O3) ------
.
PR2M3640  MOVE      OBOUSR3,VARIABLE
          GOTO      PR2M3880
.
.------ format the User defined field 3 description (O3) ------
.
PR2M3642  MOVE      SP20,TDESC
          MATCH     SP3,OBOUSR3
          GOTO      PR2M3643 IF EQUAL
.
          PACK      KEY5,ANSO,THREE,OBOUSR3
          CALL      RDCODE1
.
PR2M3643  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the User defined field 4 code (O4) ------
.
PR2M3644  MOVE      OBOUSR4,VARIABLE
          GOTO      PR2M3880
.
.------ format the User defined field 4 description (O4) ------
.
PR2M3646  MOVE      SP20,TDESC
          MATCH     SP3,OBOUSR4
          GOTO      PR2M3647 IF EQUAL
.
          PACK      KEY5,ANSO,FOUR,OBOUSR4
          CALL      RDCODE1
.
PR2M3647  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the User defined field (U1) ------
.
PR2M3648  MOVE      OBAINS,VARIABLE
          GOTO      PR2M3880
.
.------- Retrieve the 1st comment text line of the latest active visit
.        comment details
.
PR2M3650  MOVE      OBAOUTNO,KEY8       * Key for start of patients comment
          PACK      KEY17,KEY8,VSCMTTYP,Z70
.
          CALL      RSVSMDT1
PR2M3651  CALL      RPVSMDT1
          BRANCH    OVRCD,PR2M3880
.
          MATCH     KEY8,VSMDVISN
          GOTO      PR2M3880 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMDTYPE
          GOTO      PR2M3880 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT          * is comment deleted
          GOTO      PR2M3651 IF EQUAL
.
. Retrieve the 1st comment text line details 
.
          PACK      KEY20,VSMDVISN,VSMDTYPE,VSMDNOTE,SP70
          CALL      RSVSMTX1
          CALL      RKVSMTX1
          BRANCH    OVRCD,PR2M3880
.
          MATCH     VSMDVISN,VSMTVISN
          GOTO      PR2M3880 IF NOT EQUAL
.
          MATCH     VSMDTYPE,VSMTTYPE
          GOTO      PR2M3880 IF NOT EQUAL
.
          MATCH     VSMDNOTE,VSMTNOTE
          GOTO      PR2M3880 IF NOT EQUAL
.
          MOVE      VSMTCMNT,VARIABLE     * Only the first line of comment file
          GOTO      PR2M3880
.
.------ format the User defined (P1) ------
.
PR2M3652  MOVE      PUSR1,VARIABLE
          GOTO      PR2M3880
.
.------ format the User defined P1 description ------
.
PR2M3654  MOVE      SP20,TDESC
          MATCH     SP3,PUSR1
          GOTO      PR2M3655 IF EQUAL
.
          PACK      KEY5,CODEP1,PUSR1
          CALL      RDCODE1
.
PR2M3655  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the diagnosis description ------
.
PR2M3656  PACK      OPDIDESC,SP30,SP20
          MOVE      OBAOUTNO,KEY8            * Key for diagnosis data
          CALL      RDDIAG1                  * Read in the diagnosis data
          MOVE      OPDIDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the business telephone number ------
.
PR2M3658  MOVE      PTELEB,VARIABLE
          GOTO      PR2M3880
.
.------ format Comp.elig. from visit card -----
.
PR2M3660  MOVE      PTVKCOMP,VARIABLE
          GOTO      PR2M3880
.
.------ format Card number from visit card -----
.
PR2M3662  MOVE      PTVKCARD,VARIABLE 
          GOTO      PR2M3880
.
.------ format Exp. date from visit card -----
.
PR2M3664  UNPACK    PTVKCEXP,CCENT,CYEAR,CMON
          PACK      VARIABLE,CMON,SLASH,CCENT,CYEAR
          GOTO      PR2M3880
.
.------ format Exemp. Type from visit card -----
.
PR2M3666  MOVE      PTVKCXMP,VARIABLE
          GOTO      PR2M3880
.
.------ format Exemp. Type description from visit card -----
.
PR2M3668  MOVE      SP20,TDESC
          MATCH     SP3,PTVKCXMP
          GOTO      PR2M3669 IF EQUAL
.
          PACK      KEY5,ANSX,ANSM,PTVKCXMP
          CALL      RDCODE1
          BRANCH    OVRCD OF PR2M3669
.
PR2M3669  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format Comp.elig.description from visit card -----
.
PR2M3670  MOVE      SP20,TDESC
          MATCH     SP3,PTVKCOMP
          GOTO      PR2M3671 IF EQUAL
.
          PACK      KEY5,ANSC,ANSL,PTVKCOMP
          CALL      RDCODE1
          BRANCH    OVRCD OF PR2M3671
.
PR2M3671  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format Transport Allocation -----
.
PR2M3672  MOVE      OTBBTRAN,VARIABLE
          GOTO      PR2M3880
.
.------ format Tranpost allocation description ------
.
PR2M3674  MOVE      SP20,TDESC
          MATCH     SP3,OTBBTRAN
          GOTO      PR2M3675 IF EQUAL
.
          PACK      KEY5,ANSO,ANSB,OTBBTRAN
          CALL      RDCODE1
          BRANCH    OVRCD OF PR2M3675
.
PR2M3675  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format Language of Interpreter -----
.
PR2M3676  MOVE      OTBBLNGI,VARIABLE
          GOTO      PR2M3880
.
.------ Language of Interpreter desc ------
.
PR2M3678  MOVE      SP20,TDESC
          MATCH     SP3,OTBBLNGI
          GOTO      PR2M3679 IF EQUAL
.
          PACK      KEY5,ANSO,ANSL,OTBBLNGI
          CALL      RDCODE1
          BRANCH    OVRCD OF PR2M3679
.
PR2M3679  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.----- Time First Seen -----
.
PR2M3680  MOVE      OTBBTMFS,VARIABLE
          GOTO      PR2M3880
.
.----- Time Booked Out -----
.
PR2M3682  MOVE      OTBBTMBO,VARIABLE
          GOTO      PR2M3880
.
.----- GPFH Approval No.  -----
.
PR2M3684  MOVE      OTBBGPFA,VARIABLE
          GOTO      PR2M3880
.
.----- GPFH Approval No.  -----
.
PR2M3686  MOVE      OTBBECRA,VARIABLE
          GOTO      PR2M3880
.
.------ format Registered GP. code -----
.
PR2M3688  MOVE      OTBBRFGP,VARIABLE
          GOTO      PR2M3880
.
.------ format Registered HCP. description ------
.
PR2M3690  PACK      PACFNAME,SP30,SP30,SP20
          PACK      KEY10,OTBBRFGP,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCSNAM,PACSNAME
            MOVE      PMHCGNAM,PACGNAME
            MOVE      PMHCTITL,PACTITLE
            MOVE      TWO,PACFRMT
            CALL      PACNAME
          ENDIF
          MOVE      PACFNAME,VARIABLE
          GOTO      PR2M3880
.
.------ format VISIT HCP practice code ------
.
PR2M3692  MOVE      "-",ANS
          MATCH     SP2,OTBBGPPT
          IF        @EQUAL
            MOVE      SP1,ANS
          ENDIF
          PACK      VARIABLE,OTBBGPPC,ANS,OTBBGPPT,SP30,SP30
          GOTO      PR2M3880
.
.------ format HCP practice description * O/P based ------
.
PR2M3694  PACK      PMHGPNAM,SP30
          PACK      KEY10,OTBBGPPC,SP70
          PACK      KEY12,KEY10,OTBBGPPT,SP70
          CALL      RDPMHCG1
          MOVE      PMHGPNAM,VARIABLE
          GOTO      PR2M3880
.
.------ format Actual Doctor Seen ------
.
PR2M3696  MOVE      OTBBADCS,VARIABLE
          GOTO      PR2M3880
.
.------ format Actual Doctor Seen desc ------
.
PR2M3698  PACK      PACFNAME,SP30,SP30,SP20
          PACK      KEY10,OTBBADCS,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCSNAM,PACSNAME
            MOVE      PMHCGNAM,PACGNAME
            MOVE      PMHCTITL,PACTITLE
            MOVE      TWO,PACFRMT
            CALL      PACNAME
          ENDIF
          MOVE      PACFNAME,VARIABLE
          GOTO      PR2M3880
.
.------ format Check in Time ------
.
PR2M3700  MOVE      OTBBCITM,VARIABLE
          GOTO      PR2M3880
.
.------ format Time actually seen ------
.
PR2M3702  MOVE      OTBBASTM,VARIABLE
          GOTO      PR2M3880
.
.------ format Time of Departure ------
.
PR2M3704  MOVE      OTBBDPTM,VARIABLE
          GOTO      PR2M3880
.
.------ format Outcome -----
.
PR2M3706  MOVE      OTBBOUTC,VARIABLE
          GOTO      PR2M3880
.
.------ format Outcome desc ------
.
PR2M3708  MOVE      SP20,TDESC
          MATCH     SP3,OTBBOUTC
          GOTO      PR2M3709 IF EQUAL
.
          PACK      KEY5,ANSO,ANSZ,OTBBOUTC
          CALL      RDCODE1
          BRANCH    OVRCD OF PR2M3709
.
PR2M3709  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.----- format Send Letter (Y/N) ------
.
PR2M3710  MATCH     ANSY,OTBBSNDL
          IF        @EQUAL
            MOVE      "Yes ",VARIABLE
          ELSE
            MOVE      "No  ",VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Discharge pat. after x days -----
.
PR2M3712  MOVE      OTMADDNA,VARIABLE
          GOTO      PR2M3880
.
.------ format NO. of days for reappointment -----
.
PR2M3714  MOVE      OTMANDRP,VARIABLE
          GOTO      PR2M3880
.
.------ format Letter to patient on re-appointment -----
.
PR2M3716  MOVE      OTMALPTR,VARIABLE
          GOTO      PR2M3880
.
.------ format Letter to patient on re-appointment desc -----
.
PR2M3718  PACK      VARIABLE,SP30,SP30,SP30
          PACK      KEY6,OTMALPTR,SP1,SP1,ZERO
          CALL      RDOTLET1
          IF        OVRCD=0
            MOVE      OTLTTEXT,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Letter to GP on discharge-----
.
PR2M3720  MOVE      OTMALGPD,VARIABLE
          GOTO      PR2M3880
.
.------ format Letter to GP on discharge desc -----
.
PR2M3722  PACK      VARIABLE,SP30,SP30,SP30
          PACK      KEY6,OTMALGPD,SP1,SP1,ZERO
          CALL      RDOTLET1
          IF        OVRCD=0
            MOVE      OTLTTEXT,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Letter to Patient on discharge-----
.
PR2M3724  MOVE      OTMALPTD,VARIABLE
          GOTO      PR2M3880
.
.------ format Letter to Patient on discharge desc -----
.
PR2M3726  PACK      VARIABLE,SP30,SP30,SP30
          PACK      KEY6,OTMALPTD,SP1,SP1,ZERO
          CALL      RDOTLET1
          IF        OVRCD=0
            MOVE      OTLTTEXT,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Standard Booking Letter -----
.
PR2M3728  MOVE      OTMABKLT,VARIABLE
          GOTO      PR2M3880
.
.------ format Standard Booking Letter desc -----
.
PR2M3730  PACK      VARIABLE,SP30,SP30,SP30
          PACK      KEY6,OTMABKLT,SP1,SP1,ZERO
          CALL      RDOTLET1
          IF        OVRCD=0
            MOVE      OTLTTEXT,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Standard Reappointment Letter -----
.
PR2M3732  MOVE      OTMARALT,VARIABLE
          GOTO      PR2M3880
.
.------ format Standard Reappointment Letter desc -----
.
PR2M3734  PACK      VARIABLE,SP30,SP30,SP30
          PACK      KEY6,OTMARALT,SP1,SP1,ZERO
          CALL      RDOTLET1
          IF        OVRCD=0
            MOVE      OTLTTEXT,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Standard Reschedule Letter -----
.
PR2M3736  MOVE      OTMARSLT,VARIABLE
          GOTO      PR2M3880
.
.------ format Standard Reschedule Letter desc -----
.
PR2M3738  PACK      VARIABLE,SP30,SP30,SP30
          PACK      KEY6,OTMARSLT,SP1,SP1,ZERO
          CALL      RDOTLET1
          IF        OVRCD=0
            MOVE      OTLTTEXT,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format clinic session -------
.
PR2M3740  MOVE      OTMACLSE,VARIABLE
          GOTO      PR2M3880
.
.------ format clinic session description -------
.
PR2M3742  PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          PACK      KEY20,OMASITE,OTMACLSE,KEY8
          CALL      RDCLIA1
          IF        OVRCD = 1
            CALL      RDPCLIA1
            IF        OVRCD = 0
              MATCH     OMASITE,OCASITE
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ELSE
                MATCH     OTMACLSE,OCACLIN
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          IF        OVRCD = 1
            MOVE      "Unknown clinic",OCADESC
            PACK      OCADESC,OCADESC,SP30
          ENDIF
          BRANCH    OVRCD,PR2M3743
.
          MATCH     SP6,OCADOCT
          GOTO      PR2M3743 IF EQUAL       * valid code
.
.         have a doctor code for the clinic so use this for description
.
          MOVE      OCADOCT,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,PR2M3743          * invalid doctor code
.
          MOVE      DSNAME,PACSNAME
          MOVE      DGNAME,PACGNAME
          MOVE      DTITL,PACTITLE
          MOVE      TWO,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAME,OCADESC
.
PR2M3743  MOVE      OCADESC,VARIABLE
          GOTO      PR2M3880
.
.------ format Hospital code -------
.
PR2M3744  MOVE      OTMAHOSP,VARIABLE
          GOTO      PR2M3880
.
.------ format hospital description -------
.
PR2M3746  MOVE      SP30,PTHSNAME
          MOVE      OTMAHOSP,KEY3
          CALL      RDPTHSP1
          MOVE      PTHSNAME,VARIABLE
          GOTO      PR2M3880
.
.------ format Clinic Location -------
.
PR2M3748  MOVE      OTMACLOC,VARIABLE
          GOTO      PR2M3880
.
. ------- format HCP Practice Address details * PMI based -------
.
PR2M3750  PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          BRANCH    OVRCD,PR2M3880
.
          SUB       "108",FORM5
          LOAD      VARIABLE,FORM5,PMHGADD1,PMHGADD2,PMHGADD3:
                                   PMHGADD4,PMHGPOST,PMHGPTEL
          GOTO      PR2M3880
.
. ------- format HCP Practice Address details * Outpatient based -------
.
PR2M3751  PACK      KEY10,OTBBGPPC,SP70
          PACK      KEY12,KEY10,OTBBGPPT,SP70
          CALL      RDPMHCG1
          BRANCH    OVRCD,PR2M3880
.
          SUB       "114",FORM5
          LOAD      VARIABLE,FORM5,PMHGADD1,PMHGADD2,PMHGADD3:
                                   PMHGADD4,PMHGPOST,PMHGPTEL
          GOTO      PR2M3880
.
. ------- format HCP Practice Surgery * PMI based -------
.
PR2M3757  PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          BRANCH    OVRCD,PR2M3880
          PACK      VARIABLE,PMHGPNAM,SP30,SP30,SP30
          GOTO      PR2M3880
.
.-------- National Number --------------- 
.
PR2M3760  PACK      KEY10,CHOSINDX,PURNO,SP10 
          OPEN      PATNIDA1,"patnidaf"
          CALL      RDPTNID1
          IF        OVRCD = 1
            MOVE      SP20,VARIABLE
          ELSE
            MOVE      PTNINMPI,VARIABLE
          ENDIF
          MOVE      TWENTY,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PR2M3950
.
. ----- Hospital Approval Number -----
.
PR2M3762  MOVE      CAPPRVNO,VARIABLE
          COMPARE   ONE,IBCNMHOS
          GOTO      PR2M3880 IF NOT EQUAL
.
          PACK      VARIABLE,PTHSAPPR,SP70
          GOTO      PR2M3880
.
. ----- Hospital File Number -----
.
PR2M3764  MOVE      CFILENO,VARIABLE
          GOTO      PR2M3880
.
. ------- Alerts -------
.
PR2M3768  SUB       "124",FORM5             * get so first alert is item 1
          PROC      PATPAOFS
          GOTO      PR2M3880
.
. ------- District of Residence -------
.
PR2M3770  MOVE      PTMXDOFR,VARIABLE
          GOTO      PR2M3880
.
. ------- NOK Business Telephone -------
.
PR2M3772  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELB,VARIABLE
          ELSE
            MOVE      PNKTELB,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
. ------- PMI GP Practice Code/Count -------
.
PR2M3774  MOVE      "-",ANS
          MATCH     SP2,PMPXR1GC
          IF        @EQUAL
            MOVE      SP1,ANS
          ENDIF
          PACK      VARIABLE,PMPXRH1G,ANS,PMPXR1GC,SP30,SP30
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 code -----
.
PR2M3776  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      OTXSDOC1,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 title -----
.
PR2M3778  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DTITL,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 given name -----
.
PR2M3780  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DGNAME,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 surname -----
.
PR2M3782  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DSNAME,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 formatted name -----
.
PR2M3784  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DTITL,PACTITLE
          MOVE      DGNAME,PACGNAME
          MOVE      DSNAME,PACSNAME
          MOVE      TWO,PACFRMT
          CALL      PACNAME                 * Format the doctors name
          MOVE      PACFNAME,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 address line 1 -----
.
PR2M3786  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DSADD1,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 address line 2 -----
.
PR2M3788  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DSADD2,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 address line 3 -----
.
PR2M3790  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DSADD3,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 address line 4 -----
.
PR2M3792  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DSADD4,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 postcode -----
.
PR2M3794  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DSPOST,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 surgery telephone -----
.
PR2M3796  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DTELES,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen doctor 1 surgery telephone -----
.
PR2M3798  CALL      GXSDD000                * Get xtra screen doctor details
          BRANCH    EXIT,PR2M3880
.
          MOVE      DTELEP,VARIABLE
          GOTO      PR2M3880
.
. ----- Xtra screen date 1 -----
.
PR2M3800  PACK      KEY8,OBAOUTNO
          CALL      RDOTXSC1                * Read an xtra screen file record
          BRANCH    OVRCD,PR2M3880
.
          UNPACK    OTXSDTE1,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format the xtra screen date 1
          REP       " 0",CPCDATE
          MOVE      CPCDATE,VARIABLE
          GOTO      PR2M3880
.
PR2M3801  MOVE      PTMXCELL,VARIABLE          * cellular telephone
          GOTO      PR2M3880
.
PR2M3802  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD1,VARIABLE
          ELSE
            MOVE      PTMXADD1,VARIABLE          * Postal Address line 1
          ENDIF
          GOTO      PR2M3880
.
PR2M3803  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD2,VARIABLE
          ELSE
            MOVE      PTMXADD2,VARIABLE          * Postal Address line 2
          ENDIF
          GOTO      PR2M3880
.
PR2M3804  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD3,VARIABLE
          ELSE
            MOVE      PTMXADD3,VARIABLE          * Postal Address line 3
          ENDIF
          GOTO      PR2M3880
.
PR2M3805  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD4,VARIABLE
          ELSE
            MOVE      PTMXADD4,VARIABLE          * Postal Address line 4
          ENDIF
          GOTO      PR2M3880
.
PR2M3806  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEPOST,VARIABLE
          ELSE
            MOVE      PTMXPOST,VARIABLE             * Postcode
          ENDIF
          GOTO      PR2M3880
.
PR2M3807  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M3100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
          PACK      VARIABLE,NHMAETH,SP70,SP70     * Ethnicity code (NHI only)
          GOTO      PR2M3880
.
PR2M3808  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M3100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          MATCH     SP5,NHMAETH                   * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PR2M3880
          ENDIF
.
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH
          CALL      RDNHETH1
          PACK      VARIABLE,NHETDES,SP70,SP70
          GOTO      PR2M3880
.
PR2M3809  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M3100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH2
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
          PACK      VARIABLE,NHMAETH2,SP70,SP70     * Ethnicity code (NHI only)
          GOTO      PR2M3880
.
PR2M3810  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M3100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH2
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          MATCH     SP5,NHMAETH2                  * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PR2M3880
          ENDIF
.
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH2
          CALL      RDNHETH1
          PACK      VARIABLE,NHETDES,SP70,SP70
          GOTO      PR2M3880
.
PR2M3811  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M3100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH3
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
          PACK      VARIABLE,NHMAETH3,SP70,SP70     * Ethnicity code (NHI only)
          GOTO      PR2M3880
.
PR2M3812  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M3100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH3
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          MATCH     SP5,NHMAETH3                  * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PR2M3880
          ENDIF
.
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH3
          CALL      RDNHETH1
          PACK      VARIABLE,NHETDES,SP70,SP70
          GOTO      PR2M3880
.
PR2M3813  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M3100 IF NOT EQUAL
.
          MOVE      SP1,NHMARES
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          PACK      VARIABLE,SP70,SP70            * Resident Status (NHI only)
          MATCH     "Y",NHMARES
          IF        @EQUAL
            PACK      VARIABLE,DYES,SP70,SP70
          ENDIF
.
          MATCH     "N",NHMARES
          IF        @EQUAL
            PACK      VARIABLE,DNO,SP70,SP70
          ENDIF
          GOTO      PR2M3880
.
.------ format the smoker indicator ------
.
PR2M3814  MOVE      "UNK",DIM3  
          LOAD      DIM3,PSMOK,DYES,DNO
          PACK      VARIABLE,DIM3,SP70,SP70
          GOTO      PR2M3880
.
. ------  format NOK Address Line 4 ------
.
PR2M3815  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD4,VARIABLE
          ELSE
            PACK      VARIABLE,DIM3,SP70,SP70
            MOVE      PNKADD4,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the patients address line 4 ------
.
PR2M3816  PACK      VARIABLE,SP70,SP70
          MOVE      PADD4,VARIABLE
          GOTO      PR2M3880
.
.------ format the emergency contact address line 4 ------
.
PR2M3818  PACK      VARIABLE,SP70,SP70
          MOVE      PTMXECA4,VARIABLE
          GOTO      PR2M3880
.
.------ format the nearest relative address line 4 ------
.
PR2M3820  PACK      VARIABLE,SP70,SP70
          MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD4,VARIABLE
          ELSE
            MOVE      PTMXNRA4,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the health fund description ------
.
PR2M3822  MOVE      SP30,HFNAME
          MATCH     SP6,PFUNDH
          GOTO      PR2M3823 IF EQUAL
.
          PACK      KEY14,PFUNDH,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          BRANCH    OVRCD,PR2M3823
.
PR2M3823  MOVE      HFNAME,VARIABLE
          GOTO      PR2M3880
.
.------ format the claim code description ------
.
PR2M3824  PACK      KEY5,ANSC,ANSL,OBACOMP,SP5
          CALL      RDCODE1
          MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format the User defined field (U1) description ------
.
PR2M3826  PACK      KEY5,ANSU,ONE,OBAINS,SP5
          CALL      RDCODE1
          MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ format Instruction 1 ---------
.
PR2M3829  MOVE      OTMAINS1,VARIABLE
          GOTO      PR2M3880
.
.------ format Instruction 2 ---------
.
PR2M3830  MOVE      OTMAINS2,VARIABLE
          GOTO      PR2M3880
.
.------ format Instruction 3 ---------
.
PR2M3831  MOVE      OTMAINS3,VARIABLE
          GOTO      PR2M3880
.
.------ format User defined Feild 1 (01) ---------
.
PR2M3832  MOVE      TEMPOUTN,KEY8
          CALL      RDBOKB1
          IF        OVRCD = 0
            PACK      KEY5,CODEO1,OBOUSR1
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF 
          GOTO      PR2M3880
.
.------ format Special Arrangements (SA) ---------
.
PR2M3833  MOVE      TEMPOUTN,KEY8
          CALL      RDBOKB1
          IF        OVRCD = 0
            PACK      KEY5,CODESA,OTBBSPCA
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF 
          GOTO      PR2M3880
.
.------ format Mothers FULL Name ---------
.
PR2M3834  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCESNAM,PACSNAME              * Mothers Details
            MOVE      PMCEGNAM,PACGNAME
            MOVE      PMCETITL,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,VARIABLE
          ELSE
            MOVE      PMPXMSNA,PACSNAME              * Mothers Details
            MOVE      PMPXMGNA,PACGNAME
            MOVE      PMPXMTLE,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Surname  ---------
.
PR2M3835  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCESNAM,VARIABLE             
          ELSE 
            MOVE      PMPXMSNA,VARIABLE             
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers First name  ---------
.
PR2M3836  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEGNAM,VARIABLE             
          ELSE
            MOVE      PMPXMGNA,VARIABLE             
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Title  ---------
.
PR2M3837  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETITL,VARIABLE
          ELSE
            MOVE      PMPXMTLE,VARIABLE             
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Address Line 1 ---------
.
PR2M3838  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD1,VARIABLE
          ELSE
            MOVE      PMPXMAD1,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Address Line 2 ---------
.
PR2M3839  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD2,VARIABLE
          ELSE
            MOVE      PMPXMAD2,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Address Line 3 ---------
.
PR2M3840  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD3,VARIABLE
          ELSE
            MOVE      PMPXMAD3,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Address Line 4 ---------
.
PR2M3841  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD4,VARIABLE
          ELSE
            MOVE      PMPXMAD4,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Post Code ---------
.
PR2M3842   MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEPOST,VARIABLE
          ELSE
            MOVE      PMPXMPOS,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Privite Number ---------
.
PR2M3843  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELP,VARIABLE
          ELSE
            MOVE      PMPXMPNO,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Business Number ---------
.
PR2M3844  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELB,VARIABLE
          ELSE
            MOVE      PMPXMBNO,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Mobile Number ---------
.
PR2M3845  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELM,VARIABLE
          ELSE
            MOVE      PMPXMMNO,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers E-Mail ---------
.
PR2M3846  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEEMAI,VARIABLE
          ELSE
            MOVE      PMPXMEML,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Country of Birth ---------
.
PR2M3847   MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            PACK      KEY5,CODEC,PMCECONT
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE    TDESC,VARIABLE
            ELSE
              MOVE    SP30,VARIABLE
            ENDIF
          ELSE
            PACK      KEY5,CODEC,PMPXMCNT
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE    TDESC,VARIABLE
            ELSE
              MOVE    SP30,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Correspondence ---------
.
PR2M3848  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MATCH     "1",PMCESLET
            IF        @EQUAL
              MOVE     DYES,VARIABLE
            ELSE
              MOVE     DNO,VARIABLE
            ENDIF
          ELSE
            MATCH     "1",PMPXMCRP
            IF        @EQUAL
              MOVE     DYES,VARIABLE
            ELSE
              MOVE     DNO,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ format Mothers Name on Labels ---------
.
PR2M3849  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      SP70,VARIABLE
          ELSE
            MATCH     "1",PMPXMLAB
            IF        @EQUAL
              MOVE     DYES,VARIABLE
            ELSE
              MOVE     DNO,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ format Relationship to Patient  --------
.
PR2M3850  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "4",CONTTYPE          * Mother
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCERELP,VARIABLE
          ELSE
            MOVE      PMPXMREL,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers FULL Name  --------
.
PR2M3851  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father 
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCESNAM,PACSNAME              * Fathers Details
            MOVE      PMCEGNAM,PACGNAME
            MOVE      PMCETITL,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,VARIABLE
          ELSE
            MOVE      PMPXFSNA,PACSNAME              * Fathers Details
            MOVE      PMPXFGNA,PACGNAME
            MOVE      PMPXFTLE,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Surname  --------
.
PR2M3852  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCESNAM,VARIABLE
          ELSE
            MOVE      PMPXFSNA,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers First Name  --------
.
PR2M3853  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEGNAM,VARIABLE
          ELSE
            MOVE      PMPXFGNA,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Title  --------
.
PR2M3854  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETITL,VARIABLE
          ELSE
            MOVE      PMPXFTLE,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Adress Line 1  --------
.
PR2M3855  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD1,VARIABLE
          ELSE
            MOVE      PMPXFAD1,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Adress Line 2  --------
.
PR2M3856  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD2,VARIABLE
          ELSE
            MOVE      PMPXFAD2,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Adress Line 3  --------
.
PR2M3857  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD3,VARIABLE
          ELSE
            MOVE      PMPXFAD3,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Adress Line 4  --------
.
PR2M3858  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD4,VARIABLE
          ELSE
            MOVE      PMPXFAD4,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Post Code  --------
.
PR2M3859  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEPOST,VARIABLE
          ELSE
            MOVE      PMPXFPOS,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Privite Number  --------
.
PR2M3860  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELP,VARIABLE
          ELSE
            MOVE      PMPXFPNO,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Busines Number  --------
.
PR2M3861  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELB,VARIABLE
          ELSE
            MOVE      PMPXFBNO,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Mobile Number  --------
.
PR2M3862  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELM,VARIABLE
          ELSE
            MOVE      PMPXFMNO,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers E-Mail  --------
.
PR2M3863  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEEMAI,VARIABLE
          ELSE
            MOVE      PMPXFEML,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Country of birth  --------
.
PR2M3864  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            PACK      KEY5,CODEC,PMCECONT
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE    TDESC,VARIABLE
            ELSE
              MOVE    SP30,VARIABLE
            ENDIF
          ELSE
            PACK      KEY5,CODEC,PMPXFCNT
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE    TDESC,VARIABLE
            ELSE
              MOVE    SP30,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Correspondence  --------
.
PR2M3865  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MATCH     "1",PMCESLET
            IF        @EQUAL
              MOVE     DYES,VARIABLE
            ELSE
              MOVE     DNO,VARIABLE
            ENDIF
          ELSE
            MATCH     "1",PMPXFCRP
            IF        @EQUAL
              MOVE     DYES,VARIABLE
            ELSE
              MOVE     DNO,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Name on labels  --------
.
PR2M3866  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      SP70,VARIABLE
          ELSE
            MATCH     "1",PMPXFLAB
            IF        @EQUAL
              MOVE     DYES,VARIABLE
            ELSE
              MOVE     DNO,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ format Fathers Relationship to Patient  --------
.
PR2M3867  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "5",CONTTYPE          * Father
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCERELP,VARIABLE
          ELSE
            MOVE      PMPXMREL,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format DVA Card Colour (DX)  --------
.
PR2M3868  MOVE      ONE,FORM2
          MOVE      SP70,VARIABLE
          MOVE      THREE,DIM1
          CALL      GCCARF00
          MATCH     SP70,PMCDDVAC
          IF        !@EQUAL & !@EOS
            PACK      KEY5,CODEDX,PMCDDVAC,SP10   * DVA Card colour
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ format Aboriginality (VA)  --------
.
PR2M3869  PACK      KEY5,CODEVA,PMPXABRG         * Aboriginality
          CALL      RDCODE1
          IF        OVRCD = 0
            MOVE      TDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Privacy (PV)  --------
.
PR2M3870  PACK      KEY5,CODEPV,PMPXPRVI         * Privacy
          CALL      RDCODE1
          IF        OVRCD = 0
            MOVE      TDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Aboriginality (VA) PRS/2  --------
.
PR2M3871  PACK      KEY5,CODEVA,PMVXABRG           * Aboriginality
          CALL      RDCODE1
          IF        OVRCD = 0
            MOVE     TDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Admission Criteria PRS/2  --------
.
PR2M3872  PACK      KEY5,CODEVB,PMVXCADM           * Admission Criteria
          CALL      RDCODE1
          IF        OVRCD = 0
            MOVE     TDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Intention to readmit PRS/2  --------
.
PR2M3873  PACK      KEY5,CODEVR,PMVXIRAD           * Intention to readmit
          CALL      RDCODE1
          IF        OVRCD = 0
            MOVE     TDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Intended stay duration PRS/2  --------
.
PR2M3874  PACK      KEY5,CODEVI,PMVXIDUS           * Intended stay duration
          CALL      RDCODE1
          IF        OVRCD = 0
            MOVE     TDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Carer Availability PRS/2  --------
.
PR2M3875  PACK      KEY5,CODEVK,PMVXCRAV           * Carer Availability
          CALL      RDCODE1
          IF        OVRCD = 0
            MOVE     TDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Crit care Xref PRS/2  --------
.
PR2M3876  PACK      KEY5,CODEVJ,PMVXRCCT           * Crit care Xref
          CALL      RDCODE1
          IF        OVRCD = 0
            MOVE     TDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Admitting point ward   --------
.
PR2M3877  PACK      KEY6,PMVXAPWD,PMVXAPBD
          CALL      RDWARD1
          IF        OVRCD = 0
            MOVE     WBDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Admitting point bed   --------
.
PR2M3878  MOVE      PMVXAPBD,VARIABLE
          GOTO      PR2M3880
.
.------ GP Fax Number Outpatient Based -------                         *I-53708
.
PR2M3879  PACK      KEY10,OTBBRFGP,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,PR2M3880
.
          MOVE      PMHCFAXN,VARIABLE
          GOTO      PR2M3880
.
.
.------ Claim Code (outbb1af) -------                                  *I-57244
.
PR2M3A00  MOVE      OBACOMP,VARIABLE
          GOTO      PR2M3880
.
.------ Booking Slot Date (outbokaf) -------                           *I-61796
.
PR2M3A05  UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          PACK      VARIABLE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR 
          GOTO      PR2M3880
.
.------ Booking Slot Time (outbokaf) -------                           *I-61796
.
PR2M3A10  MOVE      OBATIME,VARIABLE
          GOTO      PR2M3880
.
.------ Visit Type Code   (outbokaf) -------                           *I-61796
.
PR2M3A15  MOVE      OBAVISIT,VARIABLE
          GOTO      PR2M3880
.
.------ Visit Type Desc   (outbokaf) -------                           *I-61796
.
PR2M3A20  MOVE      SP20,TDESC
          MATCH     SP3,OBAVISIT
          GOTO      PR2M3A21 IF EQUAL
.
          PACK      KEY5,CODECV,OBAVISIT
          CALL      RDCODE1                * read the patient codes file
          BRANCH    OVRCD,PR2M3A21
.
PR2M3A21  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ Presenting Complaint (pmsvx1af) ----                           *I-61796
.
PR2M3A25  MOVE      PMVXUDF1,VARIABLE
          GOTO      PR2M3880
.
.------ Source of Referral Cd (outbokaf) ----                          *I-61796
.
PR2M3A30  MOVE      OBASRCR,VARIABLE
          GOTO      PR2M3880
.
.------ Source of Referral Desc (outbokaf) ----                        *I-61796
.
PR2M3A35  MOVE      SP20,TDESC
          MATCH     SP3,OBASRCR
          GOTO      PR2M3A36 IF EQUAL
.
          PACK      KEY5,OSTCATG,OBASRCR
          CALL      RDCODE1                * read the patient codes file
          BRANCH    OVRCD,PR2M3A36
.
PR2M3A36  MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ Local GP Prac Fax Number (pmspx2af) ---
.
PR2M3A40  PACK      PMHCFAXN,SP70
          PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1
          MOVE      PMHCFAXN,VARIABLE
          GOTO      PR2M3880
.
.------ Local GP Prac Email Address (pmpx2af) ----
.
PR2M3A45  PACK      PMHCSEML,SP70,SP70
          PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1
          MOVE      PMHCSEML,VARIABLE
          GOTO      PR2M3880
.
.------ Local GP Preferred Method of Contact code (Cat CZ)
.
PR2M3A50  MOVE      SP70,VARIABLE
          MATCH     SP10,PMPXRHC1
          IF        !@EQUAL
            PACK      KEY10,PMPXRHC1,SP70
            CALL      RDPMHCP1
            IF        OVRCD = 0
              MOVE      PMHCPRFC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.-------- Local GP Preferred Method of Contact description (Cat CZ)
.
PR2M3A55  MOVE      SP70,VARIABLE
          MATCH     SP10,PMPXRHC1
          IF        !@EQUAL
            PACK      KEY10,PMPXRHC1,SP70
            CALL      RDPMHCP1
            IF        OVRCD = 0
              PACK      KEY5,ANSC,ANSZ,PMHCPRFC,SP10
              CALL      RDCODE1
              IF        OVRCD = 0
                MOVE      TDESC,VARIABLE
              ENDIF   
            ENDIF     
          ENDIF       
          GOTO      PR2M3880
.
.------ GP Practice Code -------
.
PR2M3A60  PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          BRANCH    OVRCD,PR2M3880
.
          MOVE      PMHGPRAC,VARIABLE
          GOTO      PR2M3880
.
.------ Referring GP Details (OTBBRFGP)
.
PR2M3A65  PACK      KEY10,OTBBRFGP,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,PR2M3880
.
          SUB       "257",FORM5
          LOAD      VARIABLE,FORM5,PMHCADR1,PMHCADR2,PMHCADR3,PMHCADR4,PMHCADR5:
                                   PMHCPOST,PMHCSTEL,PMHCMOBN,PMHCPAGR,PMHCPAGN:
                                   PMHCPRV1
.
          GOTO      PR2M3880
.
.------ Local GP First Name (PMPXRHC1)
.
PR2M3A70  PACK      PMHCGNAM,SP70
          MOVE      ONE,F2
          CALL      PRHCP000
          GOTO      PR2M3880
.
.------ Local GP Surname (PMPXRHC1)
.
PR2M3A75  PACK      PMHCGNAM,SP70
          MOVE      TWO,F2
          CALL      PRHCP000
          GOTO      PR2M3880
.
.------ Local GP Title First Name Surname (PMPXRHC1)
.
PR2M3A80  PACK      PMHCTITL,SP70
          PACK      PMHCGNAM,SP70
          PACK      PMHCSNAM,SP70
          MOVE      THREE,F2
          CALL      PRHCP000
          GOTO      PR2M3880
.
.------- Next of Kin Mobile Number-------
.
PR2M3A85  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELM,VARIABLE
          ELSE
            MOVE      PMPXKMOB,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------- Next of Kin Email Address-------
.
PR2M3A90  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEEMAI,VARIABLE
          ELSE
            MOVE      PMPXKEML,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------- Emergency Contact Mobile Number-------
.
PR2M3A95  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELM,VARIABLE
          ELSE
            MOVE      PMPXCMOB,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------- Emergency Contact Email Address-------
.
PR2M3B00  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEEMAI,VARIABLE
          ELSE
            MOVE      PMPXCEML,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------- Nearest Relative Mobile Number-------
.
PR2M3B05  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELM,VARIABLE
          ELSE
            MOVE      PMPXRMOB,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------- Nearest Relative Email Address-------
.
PR2M3B10  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEEMAI,VARIABLE
          ELSE 
            MOVE      PMPXREML,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------- Carer Full Name -------
.
PR2M3B15  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCESNAM,PACSNAME              * Mothers Details
          MOVE      PMCEGNAM,PACGNAME
          MOVE      PMCETITL,PACTITLE
          MOVE      "1",PACFRMT
          CALL      PACNAME
          MOVE      PACFNAME,VARIABLE
          GOTO      PR2M3880
.
.-------  Carer Title -------
.
PR2M3B20  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCETITL,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Surname -------
.
PR2M3B25  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCESNAM,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Given Name -------
.
PR2M3B30  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCEGNAM,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Address 1 -------
.
PR2M3B35  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details 
          MOVE      PMCEADD1,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Address 2 -------
.
PR2M3B40  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCEADD2,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Address 3 -------
.
PR2M3B45  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCEADD3,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Address 4 -------
.
PR2M3B50  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCEADD4,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Post Code -------
.
PR2M3B55  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCEPOST,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Telephone Private -------
.
PR2M3B60  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCETELP,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Telephone Business -------
.
PR2M3B65  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCETELB,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Telephone Mobile -------
.
PR2M3B70  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCETELM,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Ralationship -------
.
PR2M3B75  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCERELP,VARIABLE
          GOTO      PR2M3880
.
.------- Carer Email -------
.
PR2M3B80  MOVE      "C",CONTTYPE
          CALL      XCON0000                       * Get Care Details
          MOVE      PMCEEMAI,VARIABLE
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 1 -------
.
PR2M3B81  MOVE      ONE,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 2 -------
.
PR2M3B82  MOVE      TWO,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 3 -------
.
PR2M3B83  MOVE      THREE,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 4 -------
.
PR2M3B84  MOVE      FOUR,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 5 -------
.
PR2M3B85  MOVE      FIVE,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 6 -------
.
PR2M3B86  MOVE      SIX,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 7 -------
.
PR2M3B87  MOVE      SEVEN,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 8 -------
.
PR2M3B88  MOVE      EIGHT,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 9 -------
.
PR2M3B89  MOVE      NINE,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 10-------
.
PR2M3B90  MOVE      TEN,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 11-------
.
PR2M3B91  MOVE      TEN1,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 12-------
.
PR2M3B92  MOVE      TEN2,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 13-------
.
PR2M3B93  MOVE      TEN3,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 14-------
.
PR2M3B94  MOVE      TEN4,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 15-------
.
PR2M3B95  MOVE      TEN5,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 16-------
.
PR2M3B96  MOVE      TEN6,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 17-------
.
PR2M3B97  MOVE      TEN7,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 18-------
.
PR2M3B98  MOVE      TEN8,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 19-------
.
PR2M3B99  MOVE      TEN9,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Extra Screen Cat Code 20-------
.
PR2M3C00  MOVE      TWENTY,F2
          CALL      XCOD0000
          GOTO      PR2M3880
.
.------- Singapore HRN-------
.
PR2M3C01  PROC      GETALTID
          GOTO      PR2M3882
.
.------- Next of Kin Relation Description -------
.
PR2M3C10  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
.
            PACK      KEY10,PMCERELP,SP10
            CALL      RDPMREL1
            IF        OVRCD=1
              MOVE      PMCERELP,PMRLDESC
            ENDIF
            MOVE      PMRLDESC,VARIABLE
          ELSE
            PACK      KEY10,PNKRELP,SP10
            CALL      RDPMREL1
            IF        OVRCD=1
              MOVE      PNKRELP,PMRLDESC
            ENDIF
            MOVE      PMRLDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------- Title Description -------
.
PR2M3C15  PACK      KEY4,PTITL,SP10
          CALL      RDPMTLE1
          IF        OVRCD=1
            MOVE      PTITL,PMTLDESC
          ENDIF
          MOVE      PMTLDESC,VARIABLE
          GOTO      PR2M3880
.
.------- Patient E-Mail Address -------
.
PR2M3C20  MOVE      PMPXPEML,VARIABLE
          GOTO      PR2M3880
.
PR2M3C21  CALL      CMPH0000                * Compensable/Heath Fund Name
          MOVE      CLMDET1,VARIABLE 
          GOTO      PR2M3880
.
PR2M3C22  CALL      CMPH0000                * Compensable/Heath Fund Number
          MOVE      CLMDET2,VARIABLE
          GOTO      PR2M3880
.
PR2M3C23  CALL      PACADDRS                * format patient address
          PACK      VARIABLE,PACADDRS,SP70,SP10
          GOTO      PR2M3880
.
.         Format Current Date
.
PR2M3C24  CALL      IBACLOCK
          MOVE      CCC,CCENT
          MOVE      CYY,CYEAR
          MOVE      CMM,CMON
          MOVE      CDD,CDAY
          CALL      PACDATE
          PACK      VARIABLE,CPCDATE,SP70,SP10
          GOTO      PR2M3880
.
.         Format Current Time
.
PR2M3C25  CALL      IBACLOCK
          PACK      VARIABLE,CTIMEIS,SP70,SP10
          GOTO      PR2M3880
.
.         Format Health Fund code
.
PR2M3C26  PACK      VARIABLE,PFUNDH,SP70,SP10
          GOTO      PR2M3880
.
.         Format Health Fund Table code
.
PR2M3C27  PACK      VARIABLE,PFNDTB,SP70,SP10
          GOTO      PR2M3880
.
.         ACC Number
.
PR2M3C28  PACK      VARIABLE,WCCLMNO,SP70,SP10
          GOTO      PR2M3880
.
.-------- Iwi 1
.
PR2M3C29  MOVE      SP70,VARIABLE
          MATCH     SP10,PMPXIWI1
          IF        !@EQUAL
            PACK      KEY5,ANSLI,ANSLW,PMPXIWI1,SP10
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.-------- Iwi 2
.
PR2M3C30  MOVE      SP70,VARIABLE
          MATCH     SP10,PMPXIWI2
          IF        !@EQUAL
            PACK      KEY5,ANSLI,ANSLW,PMPXIWI2,SP10
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.-------- Iwi 3
.
PR2M3C31  MOVE      SP70,VARIABLE
          MATCH     SP10,PMPXIWI3
          IF        !@EQUAL
            PACK      KEY5,ANSLI,ANSLW,PMPXIWI3,SP10
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ format Emergency Contact Name  --------
.
PR2M3C32  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCESNAM,PACSNAME
            MOVE      PMCEGNAM,PACGNAME
            MOVE      PMCETITL,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,VARIABLE
          ELSE
            PACK      VARIABLE,PTMXECNM,SP70
          ENDIF
          GOTO      PR2M3880
.
.------ format Emergency Contact Adress Line 1  --------
.
PR2M3C33  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000      
            MOVE      PMCEADD1,VARIABLE
          ELSE 
            MOVE      PTMXECA1,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Emergency Contact Adress Line 2  --------
.
PR2M3C34  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000
            MOVE      PMCEADD2,VARIABLE
          ELSE
            MOVE      PTMXECA2,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Emergency Contact Adress Line 3  --------
.
PR2M3C35  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000
            MOVE      PMCEADD3,VARIABLE
          ELSE
            MOVE      PTMXECA3,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Emergency Contact Adress Line 4  --------
.
PR2M3C36  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000
            MOVE      PMCEADD4,VARIABLE
          ELSE
            MOVE      PTMXECA4,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Emergency Contact Post Code  --------
.
PR2M3C37  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000
            MOVE      PMCEPOST,VARIABLE
          ELSE
            MOVE      PTMXECPC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Emergency Contact Private Number  --------
.
PR2M3C38  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000
            MOVE      PMCETELP,VARIABLE
          ELSE
            MOVE      PTMXECPP,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Emergency Contact Business Number  --------
.
PR2M3C39  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000
            MOVE      PMCETELB,VARIABLE
          ELSE
            MOVE      PTMXECBP,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Relationship to Patient  --------
.
PR2M3C40  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000
            PACK      KEY10,PMCERELP,SP70
            CALL      RDPMREL1
            IF        OVRCD=1
              MOVE      PMCERELP,PMRLDESC
            ENDIF
            MOVE      PMRLDESC,VARIABLE
          ELSE
            PACK      KEY10,PTMXECRE,SP70
            CALL      RDPMREL1
            IF        OVRCD=1            
              MOVE      PTMXECRE,PMRLDESC
            ENDIF
            MOVE      PMRLDESC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.-------- Language
.
PR2M3C41  MOVE      SP70,VARIABLE
          MATCH     SP10,PMPXLNG1
          IF        !@EQUAL
            PACK      KEY5,ANSL,ANSA,PMPXLNG1,SP10
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.-------- Language 2
.
PR2M3C42  MOVE      SP70,VARIABLE
          MATCH     SP10,PMPXLNG2
          IF        !@EQUAL
            PACK      KEY5,ANSL,ANSA,PMPXLNG2,SP10
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.-------- Language 3
.
PR2M3C43  MOVE      SP70,VARIABLE
          MATCH     SP10,PMPXLNG3
          IF        !@EQUAL
            PACK      KEY5,ANSL,ANSA,PMPXLNG3,SP10
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ Next Stationery Code Type 1------
.
PR2M3C44  CALL      SOTL0000           * Save outlpcaf file variables
. 
          UNPACK    IBDTTXFL,DIM8,DIM6
          MOVE      OTLPPRNT,SCHDPRNT
          MOVE      OTLPCOPY,SCHDCOPY
          MOVE      STATNCOD,SVSTNCOD
          MOVE      DIM6,STATNCOD
          MOVE      OTLPLETT,LETTNCOD
          MOVE      OTLPPTYP,PRNTTYPE
.
          CALL      PRNTUD00
.
          CALL      ROTL0000           * Restore outlpcaf file variables
.
          MOVE      SVSTNCOD,STATNCOD
.
          GOTO      PR2M3880
.
.------ Patient Medicare Reference Number ------
.
PR2M3C45  MOVE      PTMXMCCD,VARIABLE
          GOTO      PR2M3880
.
.------ Patient Medicare Expiry Date ------
.
PR2M3C46  UNPACK    PMPXMEDC,CCENT,CYEAR,CMON,CDAY
          PACK      VARIABLE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          GOTO      PR2M3880
.
.------ Patient DVA Number ------
.
PR2M3C47  MOVE      ONE,FORM2
          MOVE      THREE,DIM1
          CALL      GCCARF00
          MOVE      PMCDCNUM,VARIABLE
          GOTO      PR2M3880
.
.------ Patient Workcover Insurance Company Code ------
.
PR2M3C48  PACK      KEY8,OBAOUTNO,SP70
          CALL      RDWCOM1
          IF        OVRCD = 0
            PACK      KEY8,OBAOUTNO,SP70
            CALL      RDPMWX11
            IF        OVRCD = 0
              MATCH     "3",PMWXCSTA         * Cancelled
              GOTO      PR2M3880 IF EQUAL
            ENDIF
.
            MOVE      WCICODE,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ Patient Workcover Insurance Company Description ------
.
PR2M3C49  PACK      KEY8,OBAOUTNO,SP70
          CALL      RDWCOM1
          IF        OVRCD = 0
            PACK      KEY8,OBAOUTNO,SP70
            CALL      RDPMWX11
            IF        OVRCD = 0
              MATCH     "3",PMWXCSTA         * Cancelled
              GOTO      PR2M3880 IF EQUAL
            ENDIF
.
            MATCH     SP70,WCICODE
            IF        !@EQUAL | !@EOS
              MOVE      WCICODE,VARIABLE
              PACK      KEY6,WCICODE
              CALL      RDINSR1
              IF        OVRCD=0
                MOVE      INAME,VARIABLE
              ENDIF
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ 1st Concession Card Type Code ------
.
PR2M3C50  MOVE      ONE,FORM2
          CALL      GCCARD00
          MOVE      PMCDCTYP,VARIABLE
          GOTO      PR2M3880
.
.------ 2nd Concession Card Type Code ------
.
PR2M3C51  MOVE      TWO,FORM2
          CALL      GCCARD00
          MOVE      PMCDCTYP,VARIABLE
          GOTO      PR2M3880
.
.------ 3rd Concession Card Type Code ------
.
PR2M3C52  MOVE      THREE,FORM2
          CALL      GCCARD00
          MOVE      PMCDCTYP,VARIABLE
          GOTO      PR2M3880
.
.------ 4th Concession Card Type Code ------
.
PR2M3C53  MOVE      FOUR,FORM2
          CALL      GCCARD00
          MOVE      PMCDCTYP,VARIABLE
          GOTO      PR2M3880
.
.------ 5th Concession Card Type Code ------
.
PR2M3C54  MOVE      FIVE,FORM2
          CALL      GCCARD00
          MOVE      PMCDCTYP,VARIABLE
          GOTO      PR2M3880
.
.------ 6th Concession Card Type Code ------
.
PR2M3C55  MOVE      SIX,FORM2
          CALL      GCCARD00
          MOVE      PMCDCTYP,VARIABLE
          GOTO      PR2M3880
.
.------ 1st Concession Card Type Description ------
.
PR2M3C56  MOVE      ONE,FORM2
          CALL      GCCARD00
          MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ 2nd Concession Card Type Description ------
.
PR2M3C57  MOVE      TWO,FORM2
          CALL      GCCARD00
          MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ 3rd Concession Card Type Description ------
.
PR2M3C58  MOVE      THREE,FORM2
          CALL      GCCARD00
          MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ 4th Concession Card Type Description ------
.
PR2M3C59  MOVE      FOUR,FORM2
          CALL      GCCARD00
          MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ 5th Concession Card Type Description ------
.
PR2M3C60  MOVE      FIVE,FORM2
          CALL      GCCARD00
          MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ 6th Concession Card Type Description ------
.
PR2M3C61  MOVE      SIX,FORM2
          CALL      GCCARD00
          MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ 1st Concession Card Type Number ------
.
PR2M3C62  MOVE      ONE,FORM2
          CALL      GCCARD00
          MOVE      PMCDCNUM,VARIABLE
          GOTO      PR2M3880
.
.------ 2nd Concession Card Type Number ------
.
PR2M3C63  MOVE      TWO,FORM2
          CALL      GCCARD00
          MOVE      PMCDCNUM,VARIABLE
          GOTO      PR2M3880
.
.------ 3rd Concession Card Type Number ------
.
PR2M3C64  MOVE      THREE,FORM2
          CALL      GCCARD00
          MOVE      PMCDCNUM,VARIABLE
          GOTO      PR2M3880
.
.------ 4th Concession Card Type Number ------
.
PR2M3C65  MOVE      FOUR,FORM2
          CALL      GCCARD00
          MOVE      PMCDCNUM,VARIABLE
          GOTO      PR2M3880
.
.------ 5th Concession Card Type Number ------
.
PR2M3C66  MOVE      FIVE,FORM2
          CALL      GCCARD00
          MOVE      PMCDCNUM,VARIABLE
          GOTO      PR2M3880
.
.------ 6th Concession Card Type Number ------
.
PR2M3C67  MOVE      SIX,FORM2
          CALL      GCCARD00
          MOVE      PMCDCNUM,VARIABLE
          GOTO      PR2M3880
.
.------ 1st Concession Card Expiry Date --------
.
PR2M3C68  MOVE      ONE,FORM2
          CALL      GCCARD00
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN=8
            MOVE      CPDATE,VARIABLE
          ELSE
            MOVE      CPCDATE,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ 2nd Concession Card Expiry Date --------
.
PR2M3C69  MOVE      TWO,FORM2
          CALL      GCCARD00
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN=8
            MOVE      CPDATE,VARIABLE
          ELSE
            MOVE      CPCDATE,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ 3rd Concession Card Expiry Date --------
.
PR2M3C70  MOVE      THREE,FORM2
          CALL      GCCARD00
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN=8
            MOVE      CPDATE,VARIABLE
          ELSE
            MOVE      CPCDATE,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ 4th Concession Card Expiry Date --------
.
PR2M3C71  MOVE      FOUR,FORM2
          CALL      GCCARD00
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN=8
            MOVE      CPDATE,VARIABLE
          ELSE
            MOVE      CPCDATE,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ 5th Concession Card Expiry Date --------
.
PR2M3C72  MOVE      FIVE,FORM2
          CALL      GCCARD00
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN=8
            MOVE      CPDATE,VARIABLE
          ELSE
            MOVE      CPCDATE,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ 6th Concession Card Expiry Date --------
.
PR2M3C73  MOVE      SIX,FORM2
          CALL      GCCARD00
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN=8
            MOVE      CPDATE,VARIABLE
          ELSE
            MOVE      CPCDATE,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ Clinic Location Phone Number ------
.
PR2M3C74  MOVE      OTHECTEL,VARIABLE
          GOTO      PR2M3880
.
.------ Clinic Location Type 
.
PR2M3C75  MOVE      SP70,VARIABLE
          MATCH     SP10,OTHELTYP
          IF        !@EQUAL
            PACK      KEY5,ANSL,ANST,OTHELTYP,SP10
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ Clinic Room Number ------
.
PR2M3C76  MOVE      OTMAROOM,VARIABLE
          GOTO      PR2M3880
.
PR2M3C77  CALL      GMCARD00                 * Multiple Card Type Code
          MOVE      PMCDCTYP,VARIABLE
          GOTO      PR2M3880
.
PR2M3C78  CALL      GMCARD00                 * Multiple Card Type Description
          MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
PR2M3C79  CALL      GMCARD00                 * Multiple Card Type expiry date
          MATCH     PMCDEXDT,SP70
          GOTO      PR2M3880 IF EQUAL
.
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,VARIABLE
          GOTO      PR2M3880
.
.------ format Death --------
.
PR2M3C80  COMPARE   "1",PCEASE
          IF        @EQUAL
            MOVE      "YES",VARIABLE
          ELSE
            MOVE      "NO ",VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format Date of Death ------
.
PR2M3C81  PACK      VARIABLE,SP70
          MATCH     SP70,PDECDTE
          GOTO      PR2M3880 IF EQUAL
          UNPACK    PDECDTE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,VARIABLE
          GOTO      PR2M3880
.
.------ Patient Type ------
.
PR2M3C82  MOVE      PTYPE,VARIABLE
          GOTO      PR2M3880
.
.------ Patient Type Description ------
.
PR2M3C83  PACK      VARIABLE,SP70
          MOVE      SP20,TDESC
          PACK      KEY5,ANST,SP1,PTYPE,SP70     * Cat T
          CALL      RDCODE1                      * read the patient codes file 
          BRANCH    OVRCD,PR2M3880
.
          MOVE      TDESC,VARIABLE
          GOTO      PR2M3880
.
.------ IHI Number ------
.
PR2M3C84  PACK      VARIABLE,SP70
          MATCH     "1",PTCNUNET
          IF        @EQUAL
            CALL      GTIHINUM
            MOVE      IHINUMBR,VARIABLE     * IHI Number
          ELSE
            MATCH     "3",PTCNUNET
            IF        @EQUAL
              CALL      GTIHINUM                   * IHI Number
              LJUSTIFY  IHINUMBR
              UNPACK    IHINUMBR,DIM4,DIM4A,DIM4B,DIM4C
              PACK      VARIABLE,DIM4,SP1,DIM4A,SP1,DIM4B,SP1,DIM4C
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
.------ Interpreter Required? ------
.
PR2M3C85  PACK      VARIABLE,SP70,SP70
          MATCH     "0",PMPXINTR
          IF        @EQUAL
            MOVE     "No",VARIABLE
          ENDIF
          MATCH     "1",PMPXINTR
          IF        @EQUAL
            MOVE     "Yes",VARIABLE
          ENDIF
          MATCH     SP1,PMPXINTR
          IF        @EQUAL
            MOVE     "Not Stated",VARIABLE
          ENDIF
          GOTO      PR2M3880
.
. ------- Format Nearest relative name -------
.
PR2M3C86  PACK      VARIABLE,SP70,SP70
          MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCESNAM,PACSNAME
            MOVE      PMCEGNAM,PACGNAME
            MOVE      PMCETITL,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,VARIABLE
          ELSE
            MOVE      PTMXNRNM,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the nearest relative address line 1 ------
.
PR2M3C87  PACK      VARIABLE,SP70,SP70
          MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD1,VARIABLE
          ELSE
            MOVE      PTMXNRA1,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the nearest relative address line 2 ------
.
PR2M3C88  PACK      VARIABLE,SP70,SP70
          MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD2,VARIABLE
          ELSE
            MOVE      PTMXNRA2,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
.------ format the nearest relative address line 3 ------
.
PR2M3C89  PACK      VARIABLE,SP70,SP70
          MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD3,VARIABLE
          ELSE
            MOVE      PTMXNRA3,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
. ------- Format Nearest relative postcode -------
.
PR2M3C90  PACK      VARIABLE,SP70,SP70
          MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEPOST,VARIABLE
          ELSE
            MOVE      PTMXNRPC,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
. ------- Format Nearest relative private phone -------
.
PR2M3C91  PACK      VARIABLE,SP70,SP70
          MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELP,VARIABLE
          ELSE
            MOVE      PTMXNRPP,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
. ------- Format Nearest relative business phone -------
.
PR2M3C92  PACK      VARIABLE,SP70,SP70
          MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELB,VARIABLE
          ELSE
            MOVE      PTMXNRBP,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
. ------- Format Nearest relative relationship -------
.
PR2M3C93  PACK      VARIABLE,SP70,SP70
          MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCERELP,VARIABLE
          ELSE
            MOVE      PTMXNRRE,VARIABLE
          ENDIF
          GOTO      PR2M3880
.
PR2M3C94  PACK      VARIABLE,OTBBPURC
          GOTO      PR2M3880
.
PR2M3C95  PACK      KEY5,CATHP,OTBBPURC,SP70
          MOVE      SP70,TDESC
          CALL      RDCODE1
          PACK      VARIABLE,TDESC,SP70
          GOTO      PR2M3880
.
. ------- print alert care pathway fields -------
.
PR2M3C96  SUB       "390",FORM5             * get so first item is number 1
          PROC      PRTALCPW                * print alert care pathway fields
          GOTO      PR2M3880
.
PR2M3C97  PACK      VARIABLE,PMWXPORD,SP70
          GOTO      PR2M3880
.
PR2M3D00  MOVE      PSEX,DSEXCHAR
          CALL      SEXDSP00
          MOVE      DSEXLDES,VARIABLE        * Get sex long description
          GOTO      PR2M3880
.
PR2M3D10  MOVE      OBAURNO,MBIRURNO
          CALL      MULBIR00                 * Get multlple birth details
          MOVE      MBIRTYOR,VARIABLE
          GOTO      PR2M3880
.
PR2M3D20  PACK      VARIABLE,PMPXPFSN,SP70   * Preferred Surname
          GOTO      PR2M3880
.
PR2M3D30  PACK      VARIABLE,PMPXPFGN,SP70   * Preferred Given Name
          GOTO      PR2M3880
.
PR2M3D40  PACK      VARIABLE,PSNAME,SP70     * Pref Surname instead of Actual SN
          MATCH     "1",PTCNPFSN
          IF        @EQUAL
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFSN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3D50  PACK      VARIABLE,PGNAME,SP70     * Pref GN instead of Actual GN
          MATCH     "1",PTCNPFGN
          IF        @EQUAL
            MATCH     SP70,PMPXPFGN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFGN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3D60  PACK      VARIABLE,PTMASNAM,SP70   * Pref Surname instead of 40char SN
          MATCH     "1",PTCNPFSN
          IF        @EQUAL
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFSN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3E10  PACK      VARIABLE,PMPXUCC4,SP70       * Identify gender
          GOTO      PR2M3880
.
PR2M3E20  PACK      VARIABLE,SP70                * Identify gender long desc
          MOVE      SP70,PTCDLDES
          MATCH     SP70,PMPXUCC4
          IF        !@EQUAL
            MOVE      "Gi",DIM2
            PACK      KEY5,DIM2,PMPXUCC4,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3E30  PACK      VARIABLE,PMPXATF1,SP70,SP70  * Identify gender Free Text
          GOTO      PR2M3880
.
PR2M3E40  PACK      VARIABLE,PMPXUCC5,SP70       * Identify pronoun
          GOTO      PR2M3880
.
PR2M3E50  PACK      VARIABLE,SP70                * Identif pronoun long desc 
          MOVE      SP70,PTCDLDES
          MATCH     SP70,PMPXUCC5
          IF        !@EQUAL
            MOVE      "Gp",DIM2
            PACK      KEY5,DIM2,PMPXUCC5,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3E60  PACK      VARIABLE,PMPXATF2,SP70,SP70  * Identify Pronoun Free Text
          GOTO      PR2M3880
.
PR2M3E70  PACK      VARIABLE,PUSR1,SP70          * PMI UDF 1 Code
          GOTO      PR2M3880
.
PR2M3E80  PACK      VARIABLE,SP70                * PMI UDF 1 Short Description
          MATCH     SP70,PUSR1
          IF        !@EQUAL
            MOVE      "P1",DIM2
            PACK      KEY5,DIM2,PUSR1,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3E90  PACK      VARIABLE,SP70                * PMI UDF 1 Long Description
          MATCH     SP70,PUSR1
          IF        !@EQUAL
            MOVE      "P1",DIM2
            PACK      KEY5,DIM2,PUSR1,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3F00  PACK      VARIABLE,PUSR2,SP70          * PMI UDF 2 Code
          GOTO      PR2M3880
.
PR2M3F10  PACK      VARIABLE,SP70                * PMI UDF 2 Short Description
          MATCH     SP70,PUSR2
          IF        !@EQUAL
            MOVE      "P2",DIM2
            PACK      KEY5,DIM2,PUSR2,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3F20  PACK      VARIABLE,SP70                * PMI UDF 2 Long Description
          MATCH     SP70,PUSR2
          IF        !@EQUAL
            MOVE      "P2",DIM2
            PACK      KEY5,DIM2,PUSR2,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3F30  PACK      VARIABLE,PUSR3,SP70          * PMI UDF 3 Code
          GOTO      PR2M3880
.
PR2M3F40  PACK      VARIABLE,SP70                * PMI UDF 3 Short Description
          MATCH     SP70,PUSR3
          IF        !@EQUAL
            MOVE      "P3",DIM2
            PACK      KEY5,DIM2,PUSR3,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3F50  PACK      VARIABLE,SP70                * PMI UDF 3 Long Description
          MATCH     SP70,PUSR3
          IF        !@EQUAL
            MOVE      "P3",DIM2
            PACK      KEY5,DIM2,PUSR3,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3F60  PACK      VARIABLE,PUSR4,SP70          * PMI UDF 4 Code
          GOTO      PR2M3880
.
PR2M3F70  PACK      VARIABLE,SP70                * PMI UDF 4 Short Description
          MATCH     SP70,PUSR4
          IF        !@EQUAL
            MOVE      "P4",DIM2
            PACK      KEY5,DIM2,PUSR4,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3F80  PACK      VARIABLE,SP70                * PMI UDF 4 Long Description
          MATCH     SP70,PUSR4
          IF        !@EQUAL
            MOVE      "P4",DIM2
            PACK      KEY5,DIM2,PUSR4,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3F90  PACK      VARIABLE,PUSR5,SP70          * PMI UDF 5 Code
          GOTO      PR2M3880
.
PR2M3G00  PACK      VARIABLE,SP70                * PMI UDF 5 Short Description
          MATCH     SP70,PUSR5
          IF        !@EQUAL
            MOVE      "P5",DIM2
            PACK      KEY5,DIM2,PUSR5,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3G10  PACK      VARIABLE,SP70                * PMI UDF 5 Long Description
          MATCH     SP70,PUSR5
          IF        !@EQUAL
            MOVE      "P5",DIM2
            PACK      KEY5,DIM2,PUSR5,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3G20  PACK      VARIABLE,PUSR6,SP70          * PMI UDF 6 Code
          GOTO      PR2M3880
.
PR2M3G30  PACK      VARIABLE,SP70                * PMI UDF 6 Short Description
          MATCH     SP70,PUSR6
          IF        !@EQUAL
            MOVE      "P6",DIM2
            PACK      KEY5,DIM2,PUSR6,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3G40  PACK      VARIABLE,SP70                * PMI UDF 6 Long Description
          MATCH     SP70,PUSR6
          IF        !@EQUAL
            MOVE      "P6",DIM2
            PACK      KEY5,DIM2,PUSR6,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3G50  PACK      VARIABLE,PMPXUSR7,SP70       * PMI UDF 7 Code
          GOTO      PR2M3880
.
PR2M3G60  PACK      VARIABLE,SP70                * PMI UDF 7 Short Description
          MATCH     SP70,PMPXUSR7 
          IF        !@EQUAL
            MOVE      "P7",DIM2
            PACK      KEY5,DIM2,PMPXUSR7,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3G70  PACK      VARIABLE,SP70                * PMI UDF 7 Long Description
          MATCH     SP70,PMPXUSR7 
          IF        !@EQUAL
            MOVE      "P7",DIM2
            PACK      KEY5,DIM2,PMPXUSR7,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3G80  PACK      VARIABLE,PMPXUSR8,SP70       * PMI UDF 8 Code
          GOTO      PR2M3880
.
PR2M3G90  PACK      VARIABLE,SP70                * PMI UDF 8 Short Description
          MATCH     SP70,PMPXUSR8 
          IF        !@EQUAL
            MOVE      "P8",DIM2
            PACK      KEY5,DIM2,PMPXUSR8,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3H00  PACK      VARIABLE,SP70                * PMI UDF 8 Long Description
          MATCH     SP70,PMPXUSR8 
          IF        !@EQUAL
            MOVE      "P8",DIM2
            PACK      KEY5,DIM2,PMPXUSR8,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3H10  PACK      VARIABLE,PMPXUSR9,SP70       * PMI UDF 9 Code
          GOTO      PR2M3880
.
PR2M3H20  PACK      VARIABLE,SP70                * PMI UDF 9 Short Description
          MATCH     SP70,PMPXUSR9 
          IF        !@EQUAL
            MOVE      "P9",DIM2
            PACK      KEY5,DIM2,PMPXUSR9,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      TDESC,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3H30  PACK      VARIABLE,SP70                * PMI UDF 9 Long Description
          MATCH     SP70,PMPXUSR9 
          IF        !@EQUAL
            MOVE      "P9",DIM2
            PACK      KEY5,DIM2,PMPXUSR9,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PR2M3880
.
PR2M3H40  PACK      VARIABLE,PMPXSN21,SP70       * Email Validation Flag  
          GOTO      PR2M3880
.
.
.------ set the variable to the length to print ------
.
PR2M3880  RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
PR2M3882  PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      PR2M3100
.
.------ formatting for Form fields and right justified variables ------
.
PR2M3950  COMPARE   ZERO,PRNTSTRT          * don't bump if printing full length
          GOTO      PR2M3960 IF EQUAL
.
          BUMP      VARIABLE,PRNTSTRT      * bump to starting position
.
.------ print the variable ------
.
PR2M3960  PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      PR2M3100
.
.------ end of MR3 reached ------
.
PR2M3970  MOVE      FALSE,EXIT
.
.------ print new-lines until the end of page is reached ------
.
PR2M3980  PRINT     *N;
          ADD       ONE,LASTROW
.
          COMPARE   LASTROW,IBTHLENG          * test page length
          GOTO      PR2M3999 IF EQUAL
          GOTO      PR2M3999 IF LESS
.
          GOTO      PR2M3980
.
.------ no details on file ------
.
PR2M3990  MOVE      TRUE,EXIT
.
PR2M3999  CALL      CLSPRINT                  * close the spool file
          RETURN
+
.******************************************************************************
.* HCP Details (pmi based) PMPXRHC1                                           *
.* Parameters: F2 (PMSHCP variable)                                           *
.******************************************************************************
PRHCP000  PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,PRHCP999
.
          BRANCH    F2,PRHCP010,PRHCP020,PRHCP030
.
          GOTO      PRHCP999
.
PRHCP010  MOVE      PMHCGNAM,VARIABLE
          GOTO      PRHCP999
.
PRHCP020  MOVE      PMHCSNAM,VARIABLE
          GOTO      PRHCP999
.
PRHCP030  MOVE      PMHCSNAM,PACSNAME
          MOVE      PMHCGNAM,PACGNAME
          MOVE      PMHCTITL,PACTITLE
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAME,VARIABLE
          GOTO      PRHCP999
.
PRHCP999  RETURN
+
.******************************************************************************
.*                                  GXSDD000                                  *
.*                       Get Xtra Screen Doctor Details                       *
.******************************************************************************
GXSDD000  PACK      KEY8,OBAOUTNO
          CALL      RDOTXSC1                * Read an xtra screen file record
          BRANCH    OVRCD,GXSDD950
.
          PACK      KEY6,OTXSDOC1
          CALL      RDDOCT1                 * Read a doctors file record
          BRANCH    OVRCD,GXSDD950
.
GXSDD900  MOVE      ZERO,EXIT
          GOTO      GXSDD999
.
GXSDD950  MOVE      ONE,EXIT
GXSDD999  RETURN
+
.******************************************************************************
.*                                  XCOD0000                                  *
.*                       Get Xtra Screen Category Code description            *
.******************************************************************************
XCOD0000  PACK      KEY6,OBASITE,SP70
          CALL      RDOTSIP1           * Read Site Specific Category Codes
          BRANCH    OVRCD,XCOD9999
.
          PACK      KEY8,OBAOUTNO
          CALL      RDOTXSC1                * Read an xtra screen file record
          BRANCH    OVRCD,XCOD9999
.
          MOVE      SP70,CATEGORY
          LOAD      CATEGORY,F2,OTSPXC01,OTSPXC02,OTSPXC03,OTSPXC04,OTSPXC05:
                                OTSPXC06,OTSPXC07,OTSPXC08,OTSPXC09,OTSPXC10:
                                OTSPXC11,OTSPXC12,OTSPXC13,OTSPXC14,OTSPXC15:
                                OTSPXC16,OTSPXC17,OTSPXC18,OTSPXC19,OTSPXC20
          MOVE      SP70,CODE
          LOAD      CODE,F2,OTXSCO01,OTXSCO02,OTXSCO03,OTXSCO04,OTXSCO05:
                            OTXSCO06,OTXSCO07,OTXSCO08,OTXSCO09,OTXSCO10:
                            OTXSCO11,OTXSCO12,OTXSCO13,OTXSCO14,OTXSCO15:
                            OTXSCO16,OTXSCO17,OTXSCO18,OTXSCO19,OTXSCO20
.
          MATCH     SP70,CATEGORY
          GOTO      XCOD9999 IF EQUAL
.
          MATCH     SP70,CODE
          GOTO      XCOD9999 IF EQUAL
.
          PACK      KEY5,CATEGORY,CODE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,VARIABLE
          ENDIF
.
XCOD9999  RETURN
.
.
.--------------------------------------------------------------------
. Get the patients compensable details if any.
. RETURNS : CLMDET1 = If private the patients health fund name
.                     or W/C, TAC, DVA if compensable
.                     or NILL if not compensable and not private
.           CLMDET2 = If private the patients health fund member number
.                     or W/C, TAC claim numbers, DVA number and (Card Colour)
.                        if compensable
.                     or blank if not compensable and not private
.--------------------------------------------------------------------
CMPH0000  MOVE      SP70,CLMDET1
          MOVE      SP70,CLMDET2
.
          MATCH     SP70,OBACOMP
          gOTO      CMPH9999 IF EQUAL
.
          PACK      KEY5,ANSC,ANSL,OBACOMP,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CMPH9999
.
          MATCH     "3",TCINDC5                  * Self insured
          GOTO      CMPH9000 IF EQUAL
.
.------ see what type of claim we have if any exists ------
.
          MOVE      ZERO,FORM2
CMPH1000  ADD       ONE,FORM2
          COMPARE   SIX,FORM2
          GOTO      CMPH5000 IF NOT LESS
.
          LOAD      ANS,FORM2,TCINDC1,TCINDC2,TCINDC3:
                    TCINDC4,TCINDC5
.
          CMATCH    "W",ANS                      * Work Cover
          GOTO      CMPH2000 IF EQUAL
.
          CMATCH    "M",ANS                      * TAC
          GOTO      CMPH3000 IF EQUAL
.
          CMATCH    "V",ANS                      * VET
          GOTO      CMPH4000 IF EQUAL
.
          GOTO      CMPH1000
.
CMPH2000  OPEN      PATWC1A1,"patwc1af"          * Work Cover
          MOVE      "W/C",CLMDET1
          PACK      KEY8,OBAOUTNO,SP70
          CALL      RDWCOM1
          BRANCH    OVRCD,CMPH9999
.
          OPEN      PMSWX1A1,"pmswx1af"
          PACK      KEY8,OBAOUTNO,SP70
          CALL      RDPMWX11
          IF        OVRCD = 0
            MATCH     "3",PMWXCSTA               * Cancelled
            GOTO      CMPH9999 IF EQUAL
          ENDIF
.
          MOVE      WCCLMNO,CLMDET2
          GOTO      CMPH9999
.
CMPH3000  OPEN      PATWMAB1,"patwmabf"          * TAC
          MOVE      "TAC",CLMDET1
          PACK      KEY8,OBAOUTNO,SP70
          CALL      RDWMAB1
          BRANCH    OVRCD,CMPH9999
.
          MOVE      MREFNO,CLMDET2
          GOTO      CMPH9999
.
CMPH4000  OPEN      PATWVET1,"patwvetf"          * VET
          MOVE      "DVA",CLMDET1
          PACK      KEY8,OBAOUTNO,SP70
          CALL      RDWVET1
          BRANCH    OVRCD,CMPH9999
.
          MOVE      ONE,FORM2
          MOVE      SP70,TDESC
          MOVE      THREE,DIM1	    
          CALL      GCCARD00	  
          MATCH     SP70,PMCDDVAC     
          IF        !@EQUAL & !@EOS	
            PACK      KEY5,ANSD,ANSX,PMCDDVAC,SP10   * DVA Card colour	
            CALL      RDCODE1	  
            IF        OVRCD = 1	    
              MOVE      PMCDDVAC,TDESC	    
            ENDIF     
          ENDIF	    
.
          MOVE      TDESC,DIM1
.
          CLEAR     CLMDET2
          STRIP     VCLMNO
          APPEND    VCLMNO,CLMDET2
          APPEND    " (",CLMDET2
          APPEND    DIM1,CLMDET2
          APPEND    ")",CLMDET2
          RESET     CLMDET2
          GOTO      CMPH9999
.
CMPH5000  MATCH     SP70,PFUNDH
          GOTO      CMPH9999 IF EQUAL
.
          PACK      KEY14,PFUNDH,ZERO4,SP70      * Display health fund
          CALL      RDFUND1
          IF        OVRCD=1
            MOVE      PFUNDH,HFNAME
          ENDIF
.
          MOVE      HFNAME,CLMDET1
          MOVE      PFNDMM,CLMDET2
          GOTO      CMPH9999
.
CMPH9000  MOVE      "NIL",CLMDET1                * Self insured
          MOVE      SP70,CLMDET2
.
CMPH9999  RETURN
.*******************************************************************************
.              Update Labels and Forms Printing Control Table
.*******************************************************************************
PRNTUD00  PACK      KEY5,Z70
          CALL      RSOTLPC1
          CALL      RPOTLPC1
          IF        OVRCD=1
            MOVE      ZERO,F5
            MOVE      F5,OTLPSCHE
          ENDIF
.
          MOVE      OTLPSCHE,F5
          ADD       ONE,F5
          MOVE      F5,OTLPSCHE
          MOVE      OBAURNO,OTLPURNO
          MOVE      OBAOUTNO,OTLPBOOK
          MOVE      OBASITE,OTLPSITE
          MOVE      OBACLIN,OTLPCLIN
          MOVE      OBADATE,OTLPSDAT
          MOVE      OBASTRT,OTLPSTIM
          MOVE      OBASLOT,OTLPSLOT
.
          MOVE      SCHDPRNT,OTLPPRNT
          MOVE      SCHDCOPY,OTLPCOPY
          MOVE      STATNCOD,OTLPSTAT
          MOVE      LETTNCOD,OTLPLETT
.         MOVE      PRNTTYPE,OTLPLETT
          MOVE      PRNTTYPE,OTLPPTYP
.         MOVE      USERID,OTLPWEBU
          PACK      OTLPRDAT,CCC,CYY,CMM,CDD
          REP       " 0",OTLPRDAT
          MOVE      CTIMEIS,OTLPRTIM
.
.         MOVE      ZERO,OTLPSERS
.         MATCH     Z70,LETPRT09
.         IF        !@EQUAL
.           MOVE      ONE,OTLPSERS               * Series booking letter = Yes
.         ENDIF
.
PRNTUD50  PACK      KEY5,OTLPSCHE
          CALL      RAOTLPC1
          IF        OVRCD=1
            TRAP      WRTRAP IF IO               * Trap to stop I * D when
            CALL      WROTLPC1                   * multiple servers write to the
            TRAPCLR   IO                         * outpatient print file
          ELSE
            GOTO      PRNTUD00
          ENDIF
.
PRNTUD99  RETURN
.
WRTRAP    NORETURN
          ADD         ONE,F5
          MOVE        F5,OTLPSCHE
          GOTO        PRNTUD50
.
.--------------------------------------------------------------------
. Get concession card details
.--------------------------------------------------------------------
GCCARD00  MOVE      ZERO,FORM2A
          MOVE      "ct",DIM2
          PACK      KEY19,PURNO,SP70
          CALL      RSPMCCD1
GCCARD20  CALL      RKPMCCD1
          BRANCH    OVRCD,GCCARD80
.
          MATCH     PURNO,PMCDURNO
          GOTO      GCCARD80 IF NOT EQUAL
.
          ADD       ONE,FORM2A
          COMPARE   FORM2,FORM2A
          GOTO      GCCARD20 IF NOT EQUAL
.
          PACK      KEY5,DIM2,PMCDCTYP
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      SP70,TDESC
          ENDIF
.
          GOTO      GCCARD99
.
GCCARD80  MOVE      SP70,PMCDCNUM
          MOVE      SP70,PMCDCTYP
          MOVE      SP70,PMCDEXDT
          MOVE      SP70,TDESC
          GOTO      GCCARD99
.
GCCARD99  RETURN
.
.--------------------------------------------------------------------
.         Get Multiple Card Type
.--------------------------------------------------------------------
GMCARD00  MOVE      "ct",DIM2
          PACK      KEY19,PURNO,SP70
          CALL      RSPMCCD1
GMCARD20  CALL      RKPMCCD1
          BRANCH    OVRCD,GMCARD80
.
          MATCH     PURNO,PMCDURNO
          GOTO      GMCARD80 IF NOT EQUAL
.
          PACK      KEY5,DIM2,PMCDCTYP
          CALL      RDCODE1
          BRANCH    OVRCD,GMCARD20
.
          MATCH     TCINDC6,IBDTPIND             * Check Print Indicator
          GOTO      GMCARD20 IF NOT EQUAL
.
          GOTO      GMCARD99
.
GMCARD80  MOVE      SP70,PMCDCNUM
          MOVE      SP70,PMCDCTYP
          MOVE      SP70,PMCDEXDT
          MOVE      SP70,TDESC
          GOTO      GMCARD99
.
GMCARD99  RETURN
.
.--------------------------------------------------------------------
. Get concession card details
. DIM1 = 1 - Concession Card
.        2 - Safety Net Card
.        3 - DVA Card
.        4 - Pension Card
.--------------------------------------------------------------------
GCCARF00  MOVE      "ct",DIM2
          PACK      KEY19,PURNO,SP70
          CALL      RSPMCCD1
GCCARF20  CALL      RKPMCCD1
          BRANCH    OVRCD,GCCARF80
.
          MATCH     PURNO,PMCDURNO
          GOTO      GCCARF80 IF NOT EQUAL
.
          PACK      KEY5,DIM2,PMCDCTYP
          CALL      RDCODE1
          BRANCH    OVRCD,GCCARF20
.
          MATCH     DIM1,TCINDC1
          GOTO      GCCARF99 IF EQUAL
.
          GOTO      GCCARF20
.
GCCARF80  MOVE      SP70,PMCDCNUM
          MOVE      SP70,PMCDCTYP
          MOVE      SP70,PMCDEXDT
          MOVE      SP70,PMCDDVAC
          GOTO      GCCARF99
.
GCCARF99  RETURN
.

.---------------------------------------------------------------------- 
. Program       : ECLWEB73 
.
. Function      : Eclipse Server 73                  
.                 WebServices Enquiry Functions
.                 DVAW
.                 Copied from ECLWEB24
. Modifications :
.----------------------------------------------------------------------
. V12.00.03 16/10/2025  Peter Vela     TSK 0939466
.           Fixed DVAW Assessment Report hyperlinks
. V12.00.02 18/08/2025  Peter Vela     TSK 0939466
.           Added Eclipse DVAW Claim Full Details fucntionality
. V12.00.01 16/07/2025  Peter Vela     TSK 0939466
.           Copied from ECLWEB24. New web server for Eclipse DVAW 
.           Claim Enquiry Functions
.------------------------------------------------------------
          INC       IBAWEBDF    
.
          INC       TMPALIFD/INC
          INC       NZHISIFD/INC
.
.          INC       OBSDIATD
          INC       FHRDATDF
          INC       ACCDIAFD/INC                 * AE Diagnosis
          INC       ARCVX1FD/INC                 * archive visit table
          INC       EMRECTFD/INC
          INC       EMRECAFD/INC
          INC       EMRIBHFD/INC
          INC       EMRICDFD/INC                 * AE Diagnosis Codes
          INC       HICEMSFD/INC
          INC       OUTEADFD/INC
          INC       OUTEAHFD/INC
          INC       OUTECAFD/INC
          INC       OUTECTFD/INC
          INC       OUTERHFD/INC
          INC       OUTERDFD/INC
          INC       OUTIBHFD/INC
          INC       PRIALSFD/INC
          INC       PRIECTFD/INC
          INC       PRIECAFD/INC
          INC       PRIEAHFD/INC
          INC       PRIEADFD/INC
          INC       PRIESHFD/INC
          INC       PRIESDFD/INC
          INC       PMSETRFD/INC
          INC       PRIIBHFD/INC
          INC       PRIHDBFD/INC                 * holding header file
          INC       PRIPRAFD/INC
          INC       PRIHREFD/INC                 * referral file
          INC       PRIDTRFD/INC
          INC       PRICONFD/INC
          INC       PRIHRETD/INC
          INC       APSMASFD/INC
          INC       BOKRC1FD/INC
          INC       BOKRX1FD/INC
          INC       BOKDIAFD/INC
          INC       EMRCONFD/INC
          INC       EMRUNKFD/INC
          INC       EMRVISFD/INC
          INC       IBADLABS/INC
          INC       OPLBVARS/INC
          INC       PATALRFD/INC
          INC       PATCALAG/INC
          INC       PATCONFD/INC
.         INC       PMSCDNFD/INC
          INC       PMSECOFD/INC
          INC       MEHCONFD/INC
.         INC       MEHLEGFD/INC
          INC       MLTSECFD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       VISMDTFD/INC
          INC       VISMTXFD/INC
          INC       PATCFAFD/INC
.         INC       PATCHCFD/INC
..        INC       PATCURFD/INC
          INC       PATDHEAD/INC
          INC       PATDGWFD/INC
          INC       PATDO1FD/INC
          INC       PATDSCFD/INC
          INC       PATFLTFD/INC
          INC       PATFX1FD/INC
.         INC       PATPEIFD/INC
.         INC       PATUNAFD/INC
          INC       PATMESFD/INC
          INC       PMSCTCFD/INC
          INC       PMSOVRFD/INC
          INC       PMSOVVFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPFD/INC
.         INC       PMSTLEFD/INC            * Patient Titles table
.         INC       PATGSRFD/INC
.         INC       PATFACFD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       PATICUFD/INC
          INC       PATITMFD/INC
          INC       PATIN1FD/INC
          INC       PATINVFD/INC
          INC       PATMI1FD/INC
          INC       PATMA1FD/INC
...          INC       HL7BMTFD/INC
          INC       PATMMBFD/INC
          INC       PATNIDFD/INC
          INC       PATONLFD/INC
.         INC       PATPA1FD/INC
          INC       PATPR1FD/INC
          INC       PATRE1FD/INC
          INC       PATRE1TD/INC            * Person Responsible for Acct Cgi's
.         INC       PATRGMFD/INC
          INC       PATPGRFD/INC
          INC       PATTRNFD/INC
          INC       PATVADFD/INC
          INC       PATVISFD/INC
          INC       NZPSPRFD/INC
          INC       MEHLERFD/INC
.         INC       MEHVI1FD/INC
          INC       PATWC1FD/INC
          INC       PATCLMTD/INC   * Claim cgi variables
          INC       PMSBRQFD/INC
          INC       PMSCCDFD/INC   * Concession Card Details
          INC       PMSWX1FD/INC
.         INC       ACCCMTFD/INC   * ACC (nz) Comments File
          INC       ACCLODFD/INC   * ACC Claim Lodgements
          INC       PMSWORFD/INC
          INC       PMSWORTD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       PATEORFD/INC
          INC       PATFN1FD/INC
          INC       PATWMAFD/INC
          INC       PMSEVTFD/INC
          INC       MRTAUCFD/INC
          INC       MRTLOCFD/INC
          INC       MRTMASFD/INC
          INC       MRTHISFD/INC
          INC       MRTSTFFD/INC
          INC       MRTPDSFD/INC
          INC       MRTVISFD/INC
          INC       OUTCONFD/INC
          INC       OUTSITFD/INC
          INC       OUTCLIFD/INC
          INC       OUTBOAFD/INC
          INC       OUTCANFD/INC
          INC       OUTRF1FD/INC
          INC       OUTRSHFD/INC
          INC       OUTBB1FD/INC
          INC       OUTMA1FD/INC
          INC       OUTHEDFD/INC
          INC       OUTCTYFD/INC
          INC       OUTSESFD/INC
.
          INC       PATECDFD/INC
          INC       PATECOFD/INC
          INC       RESLNKFD/INC
          INC       PMSCLTFD/INC
          INC       PMSCLTTD/INC
          INC       PMSPX2FD/INC
          INC       PMSPX2TD/INC
          INC       NZPSPRTD/INC
          INC       SAVPX2FD/INC
..          INC       WATSUSFD/INC
          INC       PATW11FD/INC                                       *I-43498
          INC       PATW12FD/INC            * WIES12                   *I-51504
          INC       PTW12BFD/INC            * WIES12B
          INC       PATW13FD/INC            * WIES13
          INC       PATW14FD/INC            * WIES14                  *I-145161
          INC       PATW15FD/INC            * WIES15
          INC       PATW16FD/INC            * WIES16
          INC       PATW17FD/INC            * WIES17
.
.    ****** HPS BLR INCLUDE  STARTS HERE    **********
.
          INC       PATASFFD/INC
          INC       PATSFAFD/INC
          INC       PATDADFD/INC
          INC       PMSVX1FD/INC
          INC       OPRDEAFD/INC
          INC       AAEDI1FD/INC
          INC       AAEDE1FD/INC
          INC       PATHSPFD/INC
          INC       OUTDIAFD/INC
          INC       WATTR1FD/INC
          INC       WATTX1FD/INC
          INC       ALLCONFD/INC
          INC       ALLREFFD/INC
          INC       ALLRLNFD/INC
          INC       ALLENCFD/INC
          INC       ALLDEPFD/INC
.
.   ****** HPS BLR CODE ENDS HERE           **********
.
          INC       PRISECFD/INC
          INC       PRIINVFD/INC
          INC       PMSAIDFD/INC
          INC       PMSHCLFD/INC
          INC       PMSHCGTD/INC
          INC       PMSHCPTD/INC
          INC       PMSRESFD/INC
          INC       WEBDATDF
          INC       PMSNUTFD/INC
          INC       PMSNUTTD/INC
          INC       NHIDNRFD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       PATCMCFD/INC
.          INC       OBSRESFD/INC
.          INC       OBSPHYFD/INC
.          INC       OBSCALFD/INC
.          INC       OBSDITFD/INC
.          INC       OBSMEDFD/INC
.          INC       OBSPINFD/INC
.          INC       OBSCNCFD/INC
.          INC       OBSCNAFD/INC
.          INC       OBSCNBFD/INC
.          INC       OBSDIAFD/INC
.          INC       OBSPROFD/INC
.          INC       OBSBHIFD/INC
.          INC       OBSBPHFD/INC
.          INC       OBSREAFD/INC
.          INC       OBSLABFD/INC
          INC       TFILEVAR/INC
          INC       VARGBCRN/INC            * I-48227
          INC       VISPAYFD/INC
          INC       ALLCASFD/INC
          INC       PMSEDGFD/INC       * Effective DRG Dates
          INC       PATMISTD/INC
          INC       RCPDTEFD/INC
          INC       WEBB2BFD/INC
          INC       WEBB2BTD/INC
          INC       WEBIMCFD/INC
          INC       WEBIMAFD/INC
          INC       WEBIMBFD/INC
          INC       WEBIMDFD/INC
          INC       WEBIMEFD/INC
          INC       WEBIMFFD/INC
          INC       WEBIMGFD/INC
          INC       WEBIMHFD/INC
          INC       WEBIHCFD/INC
          INC       WEBIHAFD/INC
          INC       WEBIHBFD/INC
          INC       WEBIHDFD/INC
          INC       WEBIHEFD/INC
          INC       WEBIHFFD/INC
          INC       WEBIHGFD/INC
          INC       WEBIHHFD/INC
          INC       WEBECOFD/INC
          INC       WEBPCAFD/INC
          INC       WEBPCBFD/INC
          INC       WEBPCIFD/INC
          INC       WEBPCEFD/INC
          INC       WEBPCFFD/INC
          INC       WEBPCGFD/INC
          INC       WEBSDDFD/INC
          INC       WEBBBSFD/INC
          INC       WEBBBAFD/INC 
          INC       WEBBBBFD/INC
          INC       WEBBBDFD/INC
          INC       WEBBBEFD/INC
          INC       WEBBBFFD/INC
          INC       WEBBRHFD/INC
          INC       WEBBRDFD/INC
.
          INC       WEBDVWFD/INC
          INC       WEBDVAFD/INC
          INC       WEBDVBFD/INC
          INC       WEBDVDFD/INC
          INC       WEBDVEFD/INC
          INC       WEBDVFFD/INC
          INC       WEBDVHFD/INC
          INC       WEBDVIFD/INC
.
          INC       WEBETRFD/INC
.
          INC       WEBDINVS/INC
.
          INC       RSHWEBDF
.
ACCPORDN  DIM       20
AAEVFLAG  FORM      1                       * AAE visit flag 0=No 1=Yes
ALLHFLAG  FORM      1       * 'All' hospital flag
BATCHNUM  DIM       8
CMDLINE   DIM       200
COLRFLAG  DIM       15
VALDTYPE  FORM      1
EVNTFLAG  FORM      1
EXPCDATE  DIM       8
EXPCTDSC  DIM       20
EMREVENT  FORM      1
ASESDESC  DIM       7
ASESDES1  INIT      "Accept."
ASESDES2  INIT      "Reject."
ASESDES3  INIT      "Warning"
ASESDES4  INIT      "Compl. "
ASESDES5  INIT      "Int Acc"
MEDSDESC  DIM       70
MEDSDES1  INIT      "Patient identification amended"
MEDSDES2  INIT      "Patient Medicare Issue number changed"
MEDSDES3  INIT      "Patient Medicare Number changed"
MEDSDES4  INIT      "Patient card used will expire shortly"
MEDSDES5  INIT      "Patient card expired. Future services may be rejected"
MEDSDES6  INIT      "Old Medicare issue number for patient. Future services may be rejected"
PRCSDESC  DIM       25
PRCSDES1  INIT      "RECEIVED"
PRCSDES2  INIT      "MEDICARE_UNVERIFIED"
PRCSDES3  INIT      "MEDICARE_VERIFIED"
PRCSDES4  INIT      "HEALTH_FUND_UNVERIFIED"
PRCSDES5  INIT      "HEALTH_FUND_VERIFIED"
PRCSDES6  INIT      "MEDICARE_ASSESSING"
PRCSDES7  INIT      "HEALTH_FUND_ASSESSING"
PRCSDES8  INIT      "MEDICARE_REJECTED"
PRCSDES9  INIT      "HEALTH_FUND_REJECTED"
PRCSDE10  INIT      "REQUEST_DELETE"
PRCSDE11  INIT      "COMPLETE"
SFACDESC  DIM       7
SFACDES1  INIT      "Accept."
SFACDES2  INIT      "Reject."
SFACDES3  INIT      "Warning"
ARCFLAG   FORM      1
OVRFLAG   FORM      1
OVVFLAG   FORM      1
AUDITDTE  DIM       12
BEDTDESC  DIM       15
BLNKFLAG  FORM      1
CPPURNO   DIM       8
DISPDATE  DIM       11
NZHISMOD  FORM      1         * NZHIS change mode indicator
FILNHIAF  FILE      ASCII, FIXED=256       * tmp save file for forking
FILTDEPT  DIM       3
DEFTFLAG  FORM      1
TOTALALI  FORM      3
NEXTPAGE  DIM       1                       * Nextpage parameter CGI parameter
UPDTTYPE  DIM       1                       * Update Type
UPDATETY  FORM      1
UPDATTYP  DIM       1
URCOMFLG  FORM      1
UROUTPUT  DIM       20[50]
UROUTEND  FORM      3
PATALTID  DIM       20
PMSALTID  DIM       20
PMSOVRKY  DIM       26
PMSOVVKY  DIM       26
PCIPPRNT  DIM       6
.
ATCHAR    INIT    "@"
ACCIDATE  DIM       11                      * Accident Date
PDCDATE   DIM       11                      * Patient Declaration Date
DECDATE   DIM       11                      * ACC Decline Date 
ACDNTFLG  FORM      1
BTSCHOSP  DIM       3
..NRCDAYS   FORM      5
..LSTDAYS   FORM      5
WARNFLAG  FORM      1
WIESFILE  DIM       8
WARDBED   DIM       7
.COUNT     FORM      3
TACCOUNT     FORM      3
WCOCOUNT     FORM      3
CLAIMSTA  DIM       2
DEFAULTA  DIM       1    * default to all on visit list by type 0=no 1=yes
DIM3      DIM       3
.DIM5      DIM       5
DIM7      DIM       7
.DIM8      DIM       8
.DIM10     DIM       10
DIM10A    DIM       10
DIM11     DIM       11
DIM16     DIM       16
DIM18     DIM       18
.DIM20     DIM       20
.DIM22     DIM       22
.DIM27     DIM       27
DIM30     DIM       30
DIM100    DIM       100
DIM100A   DIM       100
DIM100B   DIM       100
DIM100C   DIM       100
DIM100D   DIM       100
DIM100E   DIM       100
DIM100F   DIM       100
DIM100G   DIM       100
DIM100H   DIM       100
DIM100I   DIM       100
DIM100J   DIM       100
DIM100K   DIM       100
DISWARD   DIM       3
DISUNIT   DIM       3
DISBED    DIM       3
DISPUSER  DIM       30
DISPDATT  DIM       25
DISPFLAG  FORM      1 
DRG041    INIT      "041"
DRG042    INIT      "042"
DRG050    INIT      "050"
DRG051    INIT      "051"
DRG052    INIT      "052"                                             *I-137125
DRG060    INIT      "060"                                             *I-197814
DPAMOUNT  FORM      12.2
.
EXDTBLNK  FORM      1
ECOTFUND  DIM       6
ECOTTYPE  DIM       1
ECOTTRID  DIM       24
ECCLFBID  DIM       3
ECCLFRID  DIM       15
ECCLARID  DIM       20
ECCLCLID  DIM       6 
ECCLRPTC  DIM       3
ECCLEVTC  DIM       2
ECCLITMN  DIM       5
ECCLSRVC  DIM       3
ECCLCACN  DIM       2
ECCLSECN  DIM       2
ECCLRKEY  DIM       24                    *Report Retrieve Key
ECCLSTRD  DIM       24
ECCLTRID  DIM       24               
ECCLCLMI  DIM       22
.
FORM5P2C  FORM      5.2
.FORM6P2   FORM      6.2
FORM6P2A  FORM      6.2
.FORM7P2   FORM      7.2
FORM7P2A  FORM      7.2
FORM7P2C  FORM      7.2
FORM7P2O  FORM      7.2
FILTFDAT  DIM       8
FILTTDAT  DIM       8
FILTURNO  DIM       8
FILTADMN  DIM       8
.
HOSPCODE  DIM       3
HOUR      FORM      2
.HTMLLNK2  DIM       127
.
LASTWBED  DIM       6
LASTDOCT  DIM       6
LASTTYPE  DIM       3
LOOPCNTR  FORM      8
.
MIN       DIM       2
MINTIME   FORM      2
MINUTES   FORM      3
NMPNUMB   DIM       20
.
TIME      FORM      3
.
UIDCREUD  DIM       30       * Print UserID CRE or UPD Date            .0929044
UIDTIMET  DIM       10       * Print UserID CRE or UPD TimeStamp       .0929044
.
CLAIMFLG  FORM      1
CLMUPDFL  FORM      1
CODERNAM  DIM       35                       * Coder Name
CODEDFLG  FORM      1
CLNOT001  DIM       3                        * Type of Note
CLNOTEID  DIM       4                        * Clinical Note ID
CATct     INIT      "ct"
CATCL     INIT      "CL"
CATD1     INIT      "D1"
CATD2     INIT      "D2"
CATD3     INIT      "D3"
CATD4     INIT      "D4"
CATD5     INIT      "D5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATUC1    INIT      "wa"                    * Category User Def Code 1
CATUC2    INIT      "wb"                    * Category User Def Code 2
CATUC3    INIT      "wc"                    * Category User Def Code 3
CATUC4    INIT      "wd"                    * Category User Def Code 4
CATUC5    INIT      "we"                    * Category User Def Code 5
CATUC6    INIT      "wf"                    * Category User Def Code 6
CATUC7    INIT      "wg"                    * Category User Def Code 7
CATUC8    INIT      "wh"                    * Category User Def Code 8
CATLVI    INIT      "vi"
CONTDESC  DIM       16
CONTDES1  INIT      "Not in series   "
CONTDES2  INIT      "First in series "
CONTDES3  INIT      "Last in series  "
CONTDES4  INIT      "Middle in series"
DESCDPST  DIM       20
NOTESKEY  DIM       12                      * Noteskey
.DIM2A     DIM       2                       * Time in Hours
DIM2B     DIM       2                       * Time in Minutes
LINKTYP   DIM       1                       * 0=Desc 1=Code 2=Select List
CATHLV    INIT      "w2"                    * Category Highlight Level
SEVRDESC  DIM      20
SELECTIO  DIM       1                       * Select IO Template No.
SHOWCDMI  DIM       1                       * Show Event Level CDM Icons
TIMEZONE  DIM       6
TXTLEN    FORM      3                       * Text Length
VISITNUM  DIM       4                       * Visit Number
VISCMFLG  FORM      1
FILENAMA  DIM       8                       * FileName of OBCAxxxx
FILENAMB  DIM       8                       * FileName of OBCBxxxx
OBCA      INIT      "obca"
OBCB      INIT      "obcb"
FAOPEN    DIM       8                       * OBCA File that is Open
FBOPEN    DIM       8                       * OBCB File that is Open
WBSEC008  DIM       3                        * Occupational Group
ALRTFLTR  DIM       2
CASEKEYS  DIM       28
CTYPDESC  DIM       25
CCRDTYPE  DIM       20
CCRDNUMB  DIM       20
CCRDEXDT  DIM       12
DELFLAG   FORM      1
EXCLWAIT  FORM      1
EXCLCLOS  FORM      1
FAILCNT   FORM      1
FILTFLAG  FORM      1
FILTHOSP  DIM       3
FILTVTYP  FORM      2
INFORMGP  DIM       1
HYPHEN    INIT      "-"
OUTCDESC  DIM       25
UNKNFLAG  FORM      1                                                  *I-51223
VISTRCOD  DIM       20
VISTDESC  DIM       25
VTYPDESC  DIM       25
VISTDATE  DIM       11
VISTFLAG  FORM      1
VISTTIME  DIM       10
CODDFLAG  FORM      1
.DISCFLAG  FORM      1
DDRGCODE  DIM       4
.DMDCCODE  DIM       4
.DRGVER    DIM       3
PUBLFLAG  FORM      1
HDPEQUIV  DIM       2
HISTDATE  DIM       8
HISTTIME  DIM       5
HISTREQB  DIM       35
HISTLOCN  DIM       30
DESCSNAG  DIM       20
DESCHOME  DIM       30
DESCCLOC  DIM       30
DESCDOCM  DIM       30
DTYPDESC  DIM       25
HWDSOUR   DIM       3                          * S37/P137 - WATCONFD
DISPSUR   DIM       8                          * Display Saved U/R Number
DISPMUR   DIM       8                          * Display Merged U/R Number
.
CHARCR    INIT      0x0D
.ERRFLAG   FORM      1
EMRFLAG   FORM      1
INVNUMBR  DIM       8
HOSPNAME  DIM       50
CODEFA    INIT      "FA"
IPEVENT   INIT      "EV-IP"
OPEVENT   INIT      "EV-OP"
EMEVENT   INIT      "EV-EM"
SAVPSNAM  DIM       20
.SAVDATE   DIM       8
.SAVTIME   DIM       8
SAVCHDT   DIM       8
SAVCHTM   DIM       8
SAVCHUD   DIM       4
SAVCLMNO  DIM       20
SAVETRID  DIM       24
SHOWMAP   FORM      1
SHOWSJOG  FORM      1
SUPERECL  FORM      1         * Eclipse Supervisor flag (1=yes/0=no)
VIEWINDI  FORM      1
PATLINK   DIM       127                     * Link to the next patient info
UPDLINK   DIM       400
CODTYP    FORM      2
DISNAM70  DIM       70
NAME70    DIM       70
STARTNOT  FORM      4
SDOCFNAM  DIM       50
ZEROTWO   INIT      "02"
.FORM3     FORM      3
FORM8     FORM      8
.FORM8A    FORM      8
CATDESC   DIM       25
CODDESC   DIM       25
CODESTAT  FORM      1
EPISODNO  FORM      2                       * Episode No
EPSCD001  FORM      2                       * Episode No (CGI Parameter)
EPSSLIST  FORM      1[99]                   * Episode Select List
.
.FINFLAG   FORM      1
NMDSLIST  DIM       1                       * Show Update Medical Record        
RECCNT    FORM      3
DRECCNT   DIM       3
CHECKCNT  FORM      1
VISCOUNT  FORM      5
NOURSELC  DIM       1
OUTVISTT  DIM       1
OUTPSITE  DIM       6                       
OUTADMIS  DIM       8
OUTORDER  DIM       1                       * 0 = bookings the visit
.                                           * 1 = visits then bookings
REFTDESC  DIM       20
SHOWFRMT  DIM       1                       * Display format for visit list     
.                                           * 0 = Standars 1 = kids
SAVADMNO  DIM       8
SHOWMEDL  DIM       1                       * Show Update Medical Record        
.                                           * 0 = No 1 = Yes
SRCHVIEW  FORM      1                       * Show format for visit search
.                                           * 1 = Allied Health Visit Search
.
.         HPS BLR Comment Ends Here
MAVBATCH  DIM       8
MAVINVCE  DIM       8
MAVMODUL  DIM       1
MBSDESC   DIM       40
MOVEDESC  DIM       25
MRGEFLAG  FORM      1
MOVEADM   INIT      "Admission "
MOVECHG   INIT      "Change    "
MOVEDIS   INIT      "Discharged"
MOVELVE   INIT      "On Leave  "
MOVERET   INIT      "Return    "
MEH01     INIT      "MEHWEB01"
.
ALIASIND  DIM       1
ADMISSF8  FORM      8
ATYPDESC  DIM       25
BEDTRKEY  DIM       30
BTYPDESC  DIM       25
WARDNAME  DIM       25
TODAY     DIM       8
TRANDATE  DIM       12
ADMNDATE  DIM       12
DISCDATE  DIM       12
DATOFBIR  DIM       11
.
DLINKPRG  DIM       8
DLINKREP  DIM       2
DLINKTEM  DIM       3
.
EMPLNAME  DIM       30
EMPLADD1  DIM       35
EMPLADD2  DIM       35
EMPLADD3  DIM       35
EMPLADD4  DIM       35
.
LINKNUM   DIM       2
EPISODE   DIM       2
DOCTCODE  DIM       6
DSCHFLAG  FORM      1
PMVXFLAG  FORM      1
PMSVX044  DIM       3     * Coder Snags
PRIDISCD  DIM       9     * Primary Disease Code - I CAR 18122
PDIADESC  DIM       70    * Primary Disease Code Description - I CAR 18122
PRIOPRCD  DIM       9     * Primary Operation Code
POPRDESC  DIM       70    * Primary Operation Code Description
.PTVIS067  DIM       50    * Diet Comment - I SRF 22685
BRECFLAG  FORM      1
BOOKFLAG  FORM      1     * Book Referral Letter Flag
.
DOWNLD01  FORM      1
DOWNLD02  FORM      1
DOWNLD03  FORM      1
DOWNLD04  FORM      1
DOWNLD05  FORM      1
DOWNLD06  FORM      1
DOWNLD07  FORM      1
DOWNLD08  FORM      1
.
KEY1A     DIM       1
KEY4A     DIM       4
.DIM4      DIM       4
.DIM6      DIM       6
DIM9      DIM       9
DRGFLAG   FORM      1
HLFDCLTY  DIM       1
HLTHFUND  DIM       6
LENPTR    FORM      2
TEMPINVN  DIM       8         * Invoice Number
TEMPBATN  DIM       8         * Batch Number
TEMPADMN  DIM       8         * Admission Number
TEMPURNO  DIM       8         * U/R Number
TEMPHFND  DIM       6         * Health Fund
TEMPPBAT  DIM       8         * Previous Batch Number
TEMPHOSP  DIM       3         * Hospital Code
TEMPMODL  DIM       1
TTYPEARG  DIM       2
TOTOUTS   FORM      12.2
TOTPAID   FORM      12.2
SLOTNUMB  DIM       3
SAVEURNO  DIM       8
SRCHTYPE  FORM      1
PROCSTAT  DIM       1
NEXTVKEY  DIM       26
PREVVKEY  DIM       26
.SKEY31    DIM       31
PREVFLAG  FORM      1  
SAVKEY24  DIM       24
SAVEVISN  DIM       8
SAVKEY26  DIM       26
SAVKEY44  DIM       44
INPATVIS  INIT      " 3"
OUTPVIS   INIT      " 2"
EMERGVIS  INIT      " 1"
ALLIVIS   INIT      "10"
EVENVIS   INIT      " 9"
SITEDONE  FORM      1
SUMOUTS   FORM      12.2
SUMPAID   FORM      12.2
SUMINV    FORM      12.2
SUMJR     FORM      12.2
SHOWFLAG  FORM      1
.
UNIQNUMB  DIM       8
.PRHRE001  DIM       6
.PRHRE002  DIM       10
.PRHRE003  DIM       3
.
CFILEPRE  DIM       3
WAITSTAT  FORM      1
STATDESC  DIM       20
STATCODE  DIM       1
CLAIMCOD  DIM       6
CLAIMTYP  DIM       1
UNITCODE  DIM       6
UNITDESC  DIM       20
PRIODESC  DIM       25
SRCRDESC  DIM       25
PRIOSTAT  DIM       25
PRIOOVER  DIM       8
OVERSTAT  DIM       1
RSUBINDI  FORM      1
.
PATPA001  DIM       8     * Patient U/R Number
PATPA002  DIM       8     * Date this add was changed (CCYYMMDD)
.PATPA003  DIM       35    * Previous Address Line 1
.PATPA004  DIM       35    * Previous Address Line 2
.PATPA005  DIM       35    * Previous Suburb
.PATPA006  DIM       35    * Previous Address Line 4
.PATPA007  DIM       8     * Previous Postcode
.PATPA008  DIM       20    * Previous Private Telephone
.PATPA009  DIM       20    * Previous Business Telephone
.PATPA010  DIM       3     * District of Residence
.PATPA011  DIM       20    * Previous Mobile Phone Number
.PATPA012  DIM       10    * Web User ID
.
SMPOLIC    DIM      20   * POLICE STAT. ACCT REPORTED TO
SMACDAT    DIM       8   * DATE OF ACCIDENT (YYMMDD)
SMSNAME    DIM      30   * SOLICITOR NAME
SMSTELE    DIM      12   * SOLICITOR TELEPHONE
SMCREGO    DIM      36   * CAR REGO NUMBERS INVOLVED
SMACLOC    DIM      40   * ACCIDENT LOCATION
SMDPINDI   FORM      1   * 1= DRIVER, 2= PASSENGER
SMENGAGE   DIM      20   * WHILE ENG IN-FREE FORMAT ENTRY
SMPINJUR   DIM      30   * PATIENT INJURED WHEN
SMMDTRAN   DIM      10   * MODE OF TRANSPORT
SMMECHSE   DIM      30   * MECHANISM OF SEVERIST INJURY
SMREGNSE   DIM      20   * REGION OF SEVERIST INJURY
SMOTHDE1   DIM      30   * OTHER DRIVER DETAILS LINE 1
SMOTHDE2   DIM      30   * "     "      "     LINE 2
SMOTHDE3   DIM      30   * "     "      "     LINE 3
SPTWMTAC   FORM      1   * TAC CLAIM FORM COMPLETED ?
SPTWMTYP   DIM       3   * Role in Accident (CAT RA)
.
SUPERLEV  DIM       1
SWCENAME  DIM      30    * EMPLOYER NAME
SWCEADD1  DIM      35    * EMPLOYER ADDRESS LINE 1
SWCEADD2  DIM      35    * EMPLOYER ADDRESS LINE 2
SWCEADD3  DIM      35    * EMPLOYER ADDRESS LINE 3
SWCEADD4  DIM      35    * EMPLOYER ADDRESS LINE 4
SWCEPOST  DIM       8    * EMPLOYER POSTCODE
SWCETELE  DIM      20    * EMPLOYER TELEPHONE
SWCACDAT  DIM       8    * DATE OF ACCIDENT (YYMMDD)
SWCACCPT  FORM      1    * ACCEPTED BY INSURANCE COMPANY
SWCICODE  DIM       6    * INSURANCE COMPANY CODE
SWCCLMNO  DIM      20    * INSURANCE CLAIM NUMBER 
SWCCOMN1  DIM      40    * COMMENTS
SWCCOMN2  DIM      40    * COMMENTS
SPMWXALO  DIM      50    * Accident Location                  
SPMWXCIN  DIM      3     * Cause of Injury (Cat IK)           
SPMWXICO  DIM      3     * Injury Code (Cat IJ)               
SPMWXCNA  DIM      40    * Contact Name                       
.
COMMTYPE  DIM       3    * Comment Type
COMMLINO  DIM       3    * Comment Line No
COMMCONT  FORM      3    * Comment Count
SAVDATA1  DIM       65 
SAVDATA2  DIM       100 
.
TYPEDESC  DIM       20
TYPOFREQ  FORM      2             * Eclipse type of request
.
NULL      EQU      000
.
.
PTMMB001  DIM        9             * MBS Code
PTMMB002  DIM        8             * Admission Number
PTMMB003  FORM       2             * Record number for admission
PTMMB004  DIM        8             * Operation Date
PTMMB005  DIM        5             * Operation Start Time
PTMMB006  DIM        5             * Operaton End Time
PTMMB007  DIM       70             * Free Format description
DIM40     DIM       40
.
DASH      INIT      "-"
PFFUND    DIM       1     * Program Funding Source
CBOOK     FORM      1     
HBWAIT    FORM      1 
.
CFPAYCOD  DIM       3        * 3M Codefinder PAY Code
.
WBSDD001  DIM       3
.
.
WAITST01  INIT      "Unscheduled  "
WAITST02  INIT      "Scheduled    "
WAITST03  INIT      "Pre-Admitted "
WAITST04  INIT      "Admitted     "
WAITST05  INIT      "Discharged   "
WAITST06  INIT      "Removed      "
WAITST07  INIT      "Performed    "
WAITST08  INIT      "Not Performed"
ENDDAT    DIM       8
ENDDTIME  DIM       5
TACRECKY  DIM       8[50]
WCORECKY  DIM       8[50]
ERRORCNT  FORM      3                 * Count of Errors
ERRORLST  DIM       90[50]            * Error Array
.
.   ****** MEDICARE WEBSERVICES PRODA MANAGEMENT VARIABLES ***********
.
WBSPROID  DIM       60                * Product ID
WBSJKSLO  DIM       60                * JKS/Certificate File Location
WBSPRORG  DIM       60                * PRODA Organisation ID
WBSDVNAM  DIM       60                * Device Name
WBSCLIID  DIM       60                * Client ID
WBSACTAU  DIM       60                * Access Token Audience
WBSACTVC  DIM       60                * Activation Code
WBSDACUR  DIM       60                * Device Activation URL
WBSDAUUR  DIM       60                * Device Authentication URL
WBSRDKUR  DIM       60                * Refresh Device Key URL
.
WBSPILAB  DIM       17                * Product ID Label
WBSJKLAB  DIM       20                * JKS File Location Label
WBSPOLAB  DIM       18                * Proda Org Id Label
WBSDNLAB  DIM       18                * Device Name Label
WBSCILAB  DIM       16                * Client ID Label
WBSATLAB  DIM       27                * Access Token Audience Label
WBSACLAB  DIM       22                * Activation Code Label
WBSDALAB  DIM       27                * Device Activation URL Label
WBSDULAB  DIM       31                * Device Authentication URL Label
WBSRDLAB  DIM       27                * Refresh Device Key URL Label
.
WBSRV001  DIM       60                * Product ID
WBSRV002  DIM       60                * JKS/Certificate File Location
WBSRV003  DIM       60                * PRODA Organisation ID
WBSRV004  DIM       60                * Device Name
WBSRV005  DIM       60                * Client ID
WBSRV006  DIM       60                * Access Token Audience
WBSRV007  DIM       60                * Activation Code
WBSRV008  DIM       60                * Device Activation URL
WBSRV009  DIM       60                * Device Authentication URL
WBSRV010  DIM       60                * Refresh Device Key URL
.
WBSPROPF  FILE      ASCII,FIXED=256
WBSACTVF  FILE      ASCII,FIXED=256
WBSTOKNF  FILE      ASCII,FIXED=256
WBSACTOF  FILE      ASCII,FIXED=256
WBSTOKOF  FILE      ASCII,FIXED=256
PRODAIND  DIM       1
PRDAPATH  DIM       120
ACTVPATH  DIM       120
TOKNPATH  DIM       120
ACTOPATH  DIM       120
TOKOPATH  DIM       120
PRDAFILE  INIT      "webPAS_PRODA.properties"
ACTVFILE  INIT      "webPAS_PRODA_ActivateDevice_curl_response"
TOKNFILE  INIT      "webPAS_PRODA_GetAccessToken_curl_response"
ACTOFILE  INIT      "webPAS_PRODA_ActivateDevice_curl_errors"
TOKOFILE  INIT      "webPAS_PRODA_GetAccessToken_curl_errors"
.
PROPFLNM  DIM       35
PROPFILE  FILE      ASCII,FIXED=256
PROPLITR  INIT      ".properties"
PROPLINE  DIM       150
.
RTVWFLNM  DIM       33
RTVWFILE  FILE      ASCII,FIXED=256
RTVWLITR  INIT      "_imcwrtvw"
RTVWLINE  DIM       150
.
RTVRFLNM  DIM       38
RTVRFILE  FILE      ASCII,FIXED=500
RTVRLITR  INIT      "_imcwrtvw_response"
RTVRLINE  DIM       150
.
RTVEFLNM  DIM       36
RTVEFILE  FILE      ASCII,FIXED=500
RTVELITR  INIT      "_imcwrtvw_errors"
RTVELINE  DIM       150
.
IMCWFLNM  DIM       33
IMCWFILE  FILE      ASCII,FIXED=256
IMCWLITR  INIT      "_imcw"
IMCWLINE  DIM       150
.
IMCRFLNM  DIM       38
IMCRFILE  FILE      ASCII,FIXED=500
IMCRLITR  INIT      "_imcw_response"
IMCRLINE  DIM       250
.
IMCEFLNM  DIM       36
IMCEFILE  FILE      ASCII,FIXED=500
IMCELITR  INIT      "_imcw_errors"
IMCELINE  DIM       150
.
.
.
RTHWFLNM  DIM       33
RTHWFILE  FILE      ASCII,FIXED=256
RTHWLITR  INIT      "_ihcwrtvw"
RTHWLINE  DIM       150
.
RTHRFLNM  DIM       38
RTHRFILE  FILE      ASCII,FIXED=500
RTHRLITR  INIT      "_ihcwrtvw_response"
RTHRLINE  DIM       150
.
RTHEFLNM  DIM       36
RTHEFILE  FILE      ASCII,FIXED=500
RTHELITR  INIT      "_ihcwrtvw_errors"
RTHELINE  DIM       150
.
IHCWFLNM  DIM       33
IHCWFILE  FILE      ASCII,FIXED=256
IHCWLITR  INIT      "_ihcw"
IHCWLINE  DIM       500
.
IHCRFLNM  DIM       38
IHCRFILE  FILE      ASCII,FIXED=500
IHCRLITR  INIT      "_ihcw_response"
IHCRLINE  DIM       500
.
IHCEFLNM  DIM       36
IHCEFILE  FILE      ASCII,FIXED=500
IHCELITR  INIT      "_ihcw_errors"
IHCELINE  DIM       150
.
PCIWFLNM  DIM       29
PCIWFILE  FILE      ASCII,FIXED=256
PCIWLITR  INIT      "_pciw"
PCIWLINE  DIM       150
.
PCIRFLNM  DIM       38
PCIRFILE  FILE      ASCII,FIXED=500
PCIRLITR  INIT      "_pciw_response"
PCIRLINE  DIM       250
.
PCIEFLNM  DIM       36
PCIEFILE  FILE      ASCII,FIXED=500
PCIELITR  INIT      "_pciw_errors"
PCIELINE  DIM       150
.
SDDWFLNM  DIM       29
SDDWFILE  FILE      ASCII,FIXED=256
SDDWLITR  INIT      "_sddw"
SDDWLINE  DIM       150
.
SDDRFLNM  DIM       38
SDDRFILE  FILE      ASCII,FIXED=500
SDDRLITR  INIT      "_sddw_response"
SDDRLINE  DIM       250
.
SDDEFLNM  DIM       36
SDDEFILE  FILE      ASCII,FIXED=500
SDDELITR  INIT      "_sddw_errors"
SDDELINE  DIM       150
.
.
.
BPRWFLNM  DIM       29
BPRWFILE  FILE      ASCII,FIXED=256
BPRWLITR  INIT      "_bprw"
BPRWLINE  DIM       150
.
BPRRFLNM  DIM       38
BPRRFILE  FILE      ASCII,FIXED=500
BPRRLITR  INIT      "_bprw_response"
BPRRLINE  DIM       150
.
BPREFLNM  DIM       36
BPREFILE  FILE      ASCII,FIXED=500
BPRELITR  INIT      "_bprw_errors"
BPRELINE  DIM       150
.
BBSWFLNM  DIM       29
BBSWFILE  FILE      ASCII,FIXED=256
BBSWLITR  INIT      "_bbsw"
BBSWLINE  DIM       150
.
BBSRFLNM  DIM       38
BBSRFILE  FILE      ASCII,FIXED=500
BBSRLITR  INIT      "_bbsw_response"
BBSRLINE  DIM       250
.
BBSEFLNM  DIM       36
BBSEFILE  FILE      ASCII,FIXED=500
BBSELITR  INIT      "_bbsw_errors"
BBSELINE  DIM       150
.
.
.
.
DVRWFLNM  DIM       29
DVRWFILE  FILE      ASCII,FIXED=256
DVRWLITR  INIT      "_dvrw"
DVRWLINE  DIM       150
.
DVRRFLNM  DIM       38
DVRRFILE  FILE      ASCII,FIXED=500
DVRRLITR  INIT      "_dvrw_response"
DVRRLINE  DIM       150
.
DVREFLNM  DIM       36
DVREFILE  FILE      ASCII,FIXED=500
DVRELITR  INIT      "_dvrw_errors"
DVRELINE  DIM       150
.
DVAWFLNM  DIM       29
DVAWFILE  FILE      ASCII,FIXED=256
DVAWLITR  INIT      "_dvaw"
DVAWLINE  DIM       150
.
DVSRFLNM  DIM       38
DVSRFILE  FILE      ASCII,FIXED=500
DVSRLITR  INIT      "_dvaw_response"
DVSRLINE  DIM       250
.
DVSEFLNM  DIM       36
DVSEFILE  FILE      ASCII,FIXED=500
DVSELITR  INIT      "_dvaw_errors"
DVSELINE  DIM       150
.
.
.
.   ****** HPS BLR DECLARATION STARTS HERE    ***********
.
.         HPS BLR Code Starts Here
VISADIAG  DIM       12                *Diagnosis Code
ADIADESC  DIM       25
DDIADESC  DIM       25
VISTLOC   DIM       7
VISHOSID  INIT      "01"
SECOPT    DIM       1
VISTDAY   DIM       5
PVISYSN   FORM      2
VISTCOMH  INIT      "COM"
VISTEMER  INIT      "EMG"
VISTOUTP  INIT      "OP"
VISTINPT  INIT      "IP"
VISTALLH  INIT      "RF"
VISTEVNT  INIT      "EV"
VISTTYPE  DIM       5
VSTATUS   DIM       35
VIEWFLAG  FORM      1
VOLNDESC  DIM       16
.
EMGSTAT1  INIT      "Current"
.
INPSTAT1  INIT      "Pre-adm"
INPSTAT2  INIT      "Current IP"
INPSTAT3  INIT      "Discharged"
INPSTA3A  INIT      "Disc-"
INPSTA3B  INIT      "Cancelled"
INPSTAT4  INIT      "Leave"
INPSTAT5  INIT      "Cancel"
.
ALLSTAT0  INIT      "Waiting"
ALLSTAT1  INIT      "Active"
ALLSTAT2  INIT      "Closed"
ALLSTAT3  INIT      "Inactive"
ALLSTAT4  INIT      "Cancelled"
ALLSTAT5  INIT      "Rejected"
.
WLSTAT1   INIT      "Unscheduled"
WLSTAT2   INIT      "Scheduled"
WLSTAT3   INIT      "Pre-Admitted"
WLSTAT4   INIT      "Admitted"
WLSTAT5   INIT      "Discharged"
WLSTAT6   INIT      "Removed from W/L"
WLSTAT7   INIT      "Performed"
WLSTAT8   INIT      "Not Performed"
WLSTAT9   INIT      "Cancelled Booking"
.
OEVSTA0   INIT      "Outpatient-ATTENDED"
OEVSTA1   INIT      "Outpatient-NO ATTENDANCE"
OEVSTA2   INIT      "Outpatient-CANCELLED"
OBRACKET  INIT      "("
CBRACKET  INIT      ")"
.
STATUS00  INIT      "Waiting    "
STATUS01  INIT      "Ext. Error "
STATUS02  INIT      "Extracted  "
STATUS03  INIT      "SA Error   "
STATUS04  INIT      "Posted     "
STATUS05  INIT      "Received   "
STATUS06  INIT      "Medicare Unverified "
STATUS07  INIT      "Medicare Verified   "
STATUS08  INIT      "Health Fund Unverified"
STATUS09  INIT      "Health Fund Verified  "
STATUS10  INIT      "Medicare Assessing    "
STATUS11  INIT      "Health Fund Assessing "
STATUS12  INIT      "Medicare Rejected     "
STATUS13  INIT      "Health Fund Rejected  "
STATUS14  INIT      "Health Fund Unprocessed"
STATUS15  INIT      "Requested Delete      "
STATUS16  INIT      "Assessing Complete    "
STATUS17  INIT      "MC - Rejected  - Reported"
STATUS18  INIT      "HF - Rejected  - Reported"
STATUS19  INIT      "Complete - Reported"
STATUS20  INIT      "Remittance Reported"
STATUS21  INIT      "Closed"
.
STATSF00  INIT      "Waiting    "
STATSF01  INIT      "Ext. Error "
STATSF02  INIT      "Extracted  "
STATSF03  INIT      "SA Error   "
STATSF04  INIT      "Received   "
STATSF05  INIT      "Closed     "
.
STATBB01  INIT      "Error PAS validation"
STATBB02  INIT      "Extracted           "
STATBB03  INIT      "Error SA validation "
STATBB04  INIT      "Posted              "
STATBB05  INIT      "Received            "
STATBB06  INIT      "Assessment Reported "
STATBB07  INIT      "Payment Reported    "
STATBB08  INIT      "Closed              "
.
STATDW01  INIT      "Error PAS validation"
STATDW02  INIT      "Extracted           "
STATDW03  INIT      "Error SA validation "
STATDW04  INIT      "Posted              "
STATDW05  INIT      "Received            "
STATDW06  INIT      "Assessment Reported "
STATDW07  INIT      "Payment Reported    "
STATDW08  INIT      "Closed              "
.
.-----------------------------------------------------------------------------
.
STATUH00  INIT      "Waiting    "
STATUH01  INIT      "Ext. Error "
STATUH02  INIT      "Extracted  "
STATUH03  INIT      "SA Error   "
STATUH04  INIT      "Posted     "
STATUH05  INIT      "Received   "
STATUH06  INIT      "Unverified "
STATUH07  INIT      "Verified   "
STATUH08  INIT      "Assessing  "
STATUH09  INIT      "Int. Ready "
STATUH10  INIT      "Int. Report"
STATUH11  INIT      "Ready Rej. "
STATUH12  INIT      "Ready Comp."
STATUH13  INIT      "Rej. Report"
STATUH14  INIT      "Com. Report"
STATUH15  INIT      "Rem. Report"
STATUH16  INIT      "Closed     "
.
TYPEDES1  INIT      "Status Request      "
TYPEDES2  INIT      "Status Req. Response"
TYPEDES3  INIT      "Report Request      "
TYPEDES4  INIT      "Report Req. Response"
TYPEDES5  INIT      "Viewed              "
TYPEDES6  INIT      "Data Error          "
TYPEDES7  INIT      "Trans. Error        "
.
TYPEDSF1  INIT      "Viewed              "
TYPEDSF2  INIT      "Data Error          "
TYPEDSF3  INIT      "Trans. Error        "
.
.------- Eclipse Bulk Billing - Type OUTECAFD.OTEATYPE               *T0859743
TYPEDBB1  INIT      "Report Request      "
TYPEDBB2  INIT      "Report Request Resp "
TYPEDBB3  INIT      "Viewed              "
TYPEDBB4  INIT      "Data Error Response "
TYPEDBB5  INIT      "Trans. Error Resp   "
.
TYPEDDW1  INIT      "Report Request      "
TYPEDDW2  INIT      "Report Request Resp "
TYPEDDW3  INIT      "Viewed              "
TYPEDDW4  INIT      "Data Error Response "
TYPEDDW5  INIT      "Trans. Error Resp   "
.
STATPC00  INIT      "Waiting    "
STATPC01  INIT      "Ext. Error "
STATPC02  INIT      "Extracted  "
STATPC03  INIT      "SA Error   "
STATPC04  INIT      "Posted     "
STATPC05  INIT      "Received   "
STATPC06  INIT      "Closed     "
.-----------------------------------------------------------------------------
.
SUBMITED  INIT      "Submitted"
SENT      INIT      "Sent"
RECEIPTD  INIT      "Receipted"
FAILED    INIT      "Failed"
SLSH      INIT      "/"
TILDA30   INIT      "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
.
.------------------------------------------------------------------------
PRGID     INIT      "ECLWEB73"
VERSION   INIT      "V12.00.03"
PRGNAM    INIT      "Webservices Claim Enquiries"
.------------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          IF        PTCNNHII=1
            CALL      CONNECT      * Basic Patient Details
          ENDIF
.
          CALL      OUTFIL00       * Check Correct Site Files Are Open
          BRANCH    EXIT,MAIN1000
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200 
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "INVALID OPTION ECLWEB73",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      GETPAT00
          GOTO      MAIN1000
.
MAIN1200  
          GOTO      MAIN1000
.
MAIN1300  
          GOTO      MAIN1000
.
MAIN1400  CALL      REMOTE00        * Various Remote Scripting Functions
          GOTO      MAIN1000
.
MAIN1500  
          GOTO      MAIN1000
.
MAIN1600  
          GOTO      MAIN1000
.
MAIN1700  
          GOTO      MAIN1000
.
MAIN1800  
          GOTO      MAIN1000
.
MAIN1900  
          GOTO      MAIN1000
.
MAIN2000  
          GOTO      MAIN1000
.
MAIN2100  CALL      WBDV0000   * WebServices DVAW Claim Full Details
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2200  CALL      WBDQ0000   * WebServices DVAW Claim Enquiries
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50:
                       NXTPAG60
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  CALL      PREDIR00
          GOTO      NXTPAG99
.
NXTPAG60  CALL      RELOAD00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                             " alert(#"",WEBTITLE,"#");":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  CALL      INTMAS00   * Open Files Required for PATMASTM
.
          CLOSE     WEBSCHA2   * Close unused files from WEBINT00
          CLOSE     WEBSCHA3   * Close unused files from WEBINT00
          CLOSE     WEBSCHA4   * Close unused files from WEBINT00
.
          OPEN      ACCDIAA1,"accdiaaf"
          OPEN      AAEDE1A1,"aaede1af"
          OPEN      AAEDI1A1,"aaedi1af"
          OPEN      EMRICDA1,"emricdaf"
          OPEN      HICEMSA1,"hicemsaf"
          OPEN      IBAPRTA1,"ibaprtaf"        * For Printer Selection
          OPEN      IBACODE1,"ibacodef"        * For Printer Selection
          OPEN      IHAPASS1,"ihapassf"        * For Printer Selection
          OPEN      IBAPDFA1,"ibapdfaf"        * For default printer selection
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      MRTAUCA2,"mrtaucaf"
          OPEN      MRTMASA1,"mrtmasaf"
          OPEN      MRTMASA2,"mrtmasaf"
          OPEN      MRTHISA1,"mrthisaf"
          OPEN      MRTSTFA1,"mrtstfaf"
          OPEN      MRTLOCA1,"mrtlocaf"
          OPEN      MRTPDSA1,"mrtpdsaf"
          OPEN      MRTVISA1,"mrtvisaf"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATDADA1,"patdadaf" 
.         OPEN      PATCHCO1,"patchcof"
.         OPEN      PATFACT1,"patfactf"
          OPEN      PATINVR1,"patinvrf"
          OPEN      PATINVR3,"patinvrf"
          OPEN      PATINVR5,"patinvrf"
          OPEN      PATIN1A1,"patin1af"
.         OPEN      PATUNAA1,"patunaaf"
          OPEN      PMSAIDA2,"pmsaidaf"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSCTCA1,"pmsctcaf"
          OPEN      PMSCLTA1,"pmscltaf"
.
          MOVE      ZERO,OVRFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSOVRA1,"pmsovraf"
          TRAPCLR   IO
          IF        OVRCD=0
            MOVE      ONE,OVRFLAG
          ENDIF
.
          MOVE      ZERO,OVVFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSOVVA1,"pmsovvaf"
          TRAPCLR   IO
          IF        OVRCD=0
            MOVE      ONE,OVVFLAG
          ENDIF
.
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSHCPA3,"pmshcpaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PMSEVTA1,"pmsevtaf"
.         OPEN      PMSTLEA1,"pmstleaf"          * open Patient Titles table
.         OPEN      PMSTLEA2,"pmstleaf"          *
.         OPEN      PATPA1A1,"patpa1af"
          OPEN      PATPGRA1,"patpgraf" 
.         OPEN      PATGSRN1,"patgsrnf" 
          OPEN      PATICDO1,"paticdof"
          OPEN      PATICUA1,"paticuaf"
          OPEN      PATI10O1,"pati10of"
          OPEN      PATICDD1,"paticddf"
          OPEN      PATI10D1,"pati10df"
          OPEN      PATFLET2,"patfltrf"
          OPEN      PATMESG1,"patmesgf"
.         OPEN      PMSCDNA1,"pmscdnaf"
.
          MOVE      ZERO,ARCFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      ARCVX1A1,"arcvx1af"
          TRAPCLR   IO
          IF        OVRCD=0
            MOVE      ONE,ARCFLAG
          ENDIF
.
          OPEN      PMSVX1A1,"pmsvx1af" 
          OPEN      PATRE1A1,"patre1af"
.         OPEN      PATRGMA1,"patrgmaf"
          OPEN      BOKDIAA1,"bokdiaaf"
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      BOKRX1A1,"bokrx1af"
          OPEN      BOKRC1A6,"bokrc1af"
          OPEN      WATTR1A1,"wattr1af"
          OPEN      WATTX1A1,"wattx1af"
          OPEN      WEBSECA3,"websecaf"
          OPEN      PATEORA1,"pateoraf"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      VISPAYA1,"vispayaf"
.
          OPEN      PATDSCH1,"patdschf"
.         OPEN      PATPEIO1,"patpeiaf"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PATVADA1,"patvadaf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PATVISA4,"patvisaf"
          OPEN      NZPSPRA1,"nzpspraf"
.         OPEN      MEHVI1A1,"mehvi1af"
.         OPEN      MEHVI1A4,"mehvi1af"           * I SRF 22727
.         OPEN      MEHLEGA1,"mehlegaf"           * I SRF 22727
          OPEN      PATMMBS1,"patmmbsf"
          OPEN      PATMMBS2,"patmmbsf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PATHSPA1,"pathspaf"
.
          OPEN      ALLREFA1,"allrefaf"
          OPEN      ALLRLNA2,"allrlnaf"
          OPEN      ALLDEPA1,"alldepaf"
          OPEN      ALLENCA1,"allencaf"
          OPEN      PATDADA1,"patdadaf"
          OPEN      PATNIDA2,"patnidaf"
          OPEN      PATASFA1,"patasfaf"
          OPEN      PATSFAA1,"patsfaaf"
          OPEN      PATWVET1,"patwvetf"
          OPEN      PATWMAB1,"patwmabf"
          OPEN      PATWMAB2,"patwmabf"
          OPEN      PATWMAB3,"patwmabf"
          OPEN      PATWC1A1,"patwc1af"
          OPEN      PATWC1A2,"patwc1af"
          OPEN      PATWC1A3,"patwc1af"
          OPEN      PMSWX1A1,"pmswx1af"
.         OPEN      ACCCMTA1,"acccmtaf"
          OPEN      PMSRESA1,"pmsresaf"
          OPEN      PMSWORA1,"pmsworaf"
          OPEN      PATW11A1,"patw11af"                                *I-43498
          OPEN      PATW12A1,"patw12af"                                *I-51504
          OPEN      PATW12B1,"patw12bf"
          OPEN      PATW13A1,"patw13af"
          OPEN      PATW14A1,"patw14af"                               *I-145161
          OPEN      PATW15A1,"patw15af"
          OPEN      PATW16A1,"patw16af"
          OPEN      PATW17A1,"patw17af"
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EMRUNKA1,"emrunkaf"
          OPEN      EMRVISA1,"emrvisaf"
          TRAPCLR   IO
          MOVE      OVRCD,EMRFLAG
.
          OPEN      PATECDA1,"patecdaf"
          OPEN      PATECOA1,"patecoaf"
          OPEN      PATECDA2,"patecdaf"
          OPEN      PATECOA2,"patecoaf"
.
          CALL      OPICD1                      * Open ICD Disease files
          CALL      OPICO1                      * Open ICD Operation files
.
          OPEN      MLTSECA1,"mltsecaf"
          OPEN      VISMDTA1,"vismdtaf"
          OPEN      VISMTXA1,"vismtxaf"
          OPEN      PMSNUTA1,"pmsnutaf"         * new nutrition file v9.02.17
.          OPEN      OBSPINA1,"obspinaf"
.          OPEN      OBSCNAA1,"obscnaaf"
.          OPEN      OBSCNBA1,"obscnbaf"
.          OPEN      OBSCNCA1,"obscncaf"
.          OPEN      OBSCNCA2,"obscncaf"
.          OPEN      OBSDIAA1,"obsdiaaf"
.          OPEN      OBSBPHA1,"obsbphaf"
.          OPEN      OBSPROA1,"obsproaf"
.          OPEN      OBSREAA1,"obsreaaf"
.          OPEN      OBSBHIA1,"obsbhiaf"
.          OPEN      OBSLABA1,"obslabaf"
.          OPEN      OBSMEDA1,"obsmedaf"
.          OPEN      OBSRESA1,"obsresaf"
.          OPEN      OBSPHYA1,"obsphyaf"
.          OPEN      OBSDITA1,"obsditaf"
.          OPEN      OBSCALA1,"obscalaf"
.          OPEN      OBSCALA1,"obscalaf"
          OPEN      PATMI1A8,"patmi1af"
          OPEN      IBASPOL1,"ibaspolf"         * For spool file       
          OPEN      CONTROLF,"controlf"         * For spool file       
          READ      CONTROLF,ZERO;*43,IBCNMHOS,*85,IBCNUGST
          READ      CONTROLF,TEN;*250,CAUDA1
          READ      CONTROLF,HUND12;*101,PTCNUFFR
          READ      CONTROLF,HUND10;*240,PTCNUALT
          READ      CONTROLF,HUND16;*214,PTCNDCDM
          READ      CONTROLF,HUND06;*203,ALCNMDES
          READ      CONTROLF,FIFTY9;*193,PTCNRQCF
          READ      CONTROLF,HUND06;*217,ALCNCLNF
          COMPARE   ONE,PTCNRQCF       * Using Free Format Requester
          IF        !@EQUAL
            OPEN      MRTSTFA1,"mrtstfaf"
          ENDIF
.
          IF        CAUDA1<>1
            OPEN      PATAUDAL,"pataudal"
            OPEN      PATAUDA2,"pataudal"
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
           
.
.  Katie - have a look into what this if statement is doing 01/02/200 - Comments at Taranaki
.
..          READ      CONTROLF,TWENTY;*164,PTCNUPCM
..          IF        PTCNUPCM=1
..            OPEN      PATCMNT1,"patxcmaf"     * new extra comments file
..          ELSE
.
..            OPEN      PATCMNT1,"patcmntf"
.
..          ENDIF
...........

          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,TEN;*126,CLABPG,CLABPRT,*235,CMDISP
          READ      CONTROLF,TEN3;*188,CMABINS,CVETINS
          READ      CONTROLF,TWENTY;*223,PTCNLNFF,*224,PTCNCHFF
          READ      CONTROLF,THIRTY7;*137,HWDSOUR
          READ      CONTROLF,FIFTY9;*35,CTYPLAB,*220,PTCNUADT
          READ      CONTROLF,EIGHTY;*249,PTCNEDTE
          READ      CONTROLF,EIGHTY8;*59,PTCNI10D
          READ      CONTROLF,EIGHTY9;*180,EMCNLDAT
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          READ      CONTROLF,TWENTY1;*45,PTCNDRSM 
          READ      CONTROLF,SIXTY9;*43,MHCNAUDA,*69,MHCNUSE,*82,MHCNDVIS
          READ      CONTROLF,HUND09;*177,PTCNNHTM
          READ      CONTROLF,TWENTY;*52,PTPCLRES
          READ      CONTROLF,TWENTY1;*237,PTCNPAOF,*238,PTCNAGEC
          READ      CONTROLF,THIRTY3;*200,PRCNRDOC
          READ      CONTROLF,HUND05;*158,PTCNDGPV,*211,PTCNBPAY: *I-43526I-48227
                                    *217,PTCNGDV4,*227,PTCNGDV5       *C-105244
          READ      CONTROLF,HUND09;*151,PTCNGDV3                      *I-51504
          READ      CONTROLF,HUND12;*96,PTCNH7AC,*239,PTCNGDV6        *C-163918
          READ      CONTROLF,HUND10;*61,PTCNGDV7:                     *I-219246
                                    *69,PTCNGDV8:                     *I-284420
                                    *77,PTCNGDV9:                     *I-311669
                                    *85,PTCNGDVX                      *I-0833093
          READ      CONTROLF,HUND17;*220,PTCNGDX1
          READ      CONTROLF,HUND24;*111,PTCNUIMC,*222,PTCNUESF
          READ      CONTROLF,HUND27;*122,PTCNUEBB                     *T0859743
          READ      CONTROLF,HUND28;*211,PTCNPCIP
          READ      CONTROLF,HUND29;*1,PTCNWSDR,*61,PTCNWSIN,*73,PTCNIMCW:
                                    *88,PTCNIHCW,*91,PTCNPCIW,*193,PTCNBBSW:
                                    *249,PTCNDVAW
.
          OPEN      OUTSITA1,"outsitaf"     * Open the site file
          OPEN      OUTSITA3,"outsitaf"     * Open the site file
          MOVE      "out",CFILEPRE          * Save Current File Prefix
          CALL      OPNOUT00                * Open Outpatient Files 
          OPEN      OUTRF1A1,"outrf1af"
          IF        PTCNNHII=1
            OPEN      PATMWSA1,"patmwsaf"
          ENDIF
.
          OPEN      ALLCASA1,"allcasaf"
.
          OPEN      PRISECA1,"prisecaf"
          OPEN      PRIALSA1,"prialsaf"
          OPEN      PRIPRAC1,"pripracf"
          OPEN      PMSETRA1,"pmsetraf"
          OPEN      PMSECOA1,"pmsecoaf"
          OPEN      PMSECOA2,"pmsecoaf"
          OPEN      PRIHDBT2,"prihdbtf"
          OPEN      PRIHREF1,"prihreff"
          OPEN      PRIDTRA1,"pridtraf"
          OPEN      PRIINVO1,"priinvof"
          OPEN      RCPDTEA3,"rcpdteaf"
.
.-------- WebServices 
          MATCH    "1",PTCNWSIN
          IF        @EQUAL
             OPEN      WEBECOA1,"webecoaf"            
             OPEN      WEBECOA2,"webecoaf"
             OPEN      WEBETRA1,"webetraf"
             OPEN      WEBETRA4,"webetraf"
.            OPEN      WEBB2BA1,"webb2baf"
.            OPEN      WEBB2BA2,"webb2baf"
             OPEN      WEBB2BA3,"webb2baf"
.
            MATCH    "1",PTCNDVAW
            IF        @EQUAL
              OPEN      WEBDVWA1,"webdvwaf"
              OPEN      WEBDVWA2,"webdvwaf"
              OPEN      WEBDVWA3,"webdvwaf"
              OPEN      WEBDVWA5,"webdvwaf"
.              OPEN      WEBDVWA6,"webdvwaf"
.
              OPEN      WEBDVAA1,"webdvaaf"
              OPEN      WEBDVAA2,"webdvaaf"
              OPEN      WEBDVAA3,"webdvaaf"
.
              OPEN      WEBDVBA1,"webdvbaf"
              OPEN      WEBDVBA2,"webdvbaf"
.
              OPEN      WEBDVDA1,"webdvdaf"
              OPEN      WEBDVDA2,"webdvdaf"
.
              OPEN      WEBDVEA1,"webdveaf"
              OPEN      WEBDVEA2,"webdveaf"
.
              OPEN      WEBDVFA1,"webdvfaf"
              OPEN      WEBDVFA2,"webdvfaf"
.
              OPEN      WEBDVHA4,"webdvhaf"
.
              OPEN      WEBDVIA2,"webdviaf"
.
            ENDIF
.
          ENDIF
.
INIT9999  RETURN
+
.*******************************************************************************
. OUTFIL00 - Check if the user id has an outpatienty site. If they do open
.            the correct outpatient files according to the site. If they do not
.            have a site make sure the default prefix of out is is used to 
.            open the files.
.*******************************************************************************
OUTFIL00  MATCH     SP70,WBSESIT             * Does the user have a site
          GOTO      OUTFIL50 IF NOT EQUAL
.
OUTFIL10  MATCH     "out",CFILEPRE           * Is out currently open
          IF        !@EQUAL
            MOVE      "out",OSTFILE          * open default prefix of out
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open out Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL50  MOVE      WBSESIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,OUTFIL90           * error invalid site code
.
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL90  MOVE      "Outpatient Site Invalid",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
OUTFIL99  RETURN
.------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILBOKA3  * Get the name of the BOKA3 file
          CLOSE     OUTBOKA3
          OPEN      OUTBOKA3,CFNAME           * Open the file
          CLOSE     OUTBOKA2
          OPEN      OUTBOKA2,CFNAME           * Open the file
          CLOSE     OUTBOKA6
          OPEN      OUTBOKA6,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILRSHA1
          CLOSE     OUTRSHA1
          OPEN      OUTRSHA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILCANA2
          CLOSE     OUTCANA2
          OPEN      OUTCANA2,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILBB1A1  * Get the name of the BOKA3 file
          CLOSE     OUTBB1A1
          OPEN      OUTBB1A1,CFNAME     
.
          PACK      CFNAME,CFILEPRE,FILSESA1  * Get the name of the SESA1 file
          CLOSE     OUTSESA1
          OPEN      OUTSESA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCTYA1  * Get the name of the CTYA1 file
          CLOSE     OUTCTYA1
          OPEN      OUTCTYA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILMA1A1
          CLOSE     OUTMA1A1
          OPEN      OUTMA1A1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILHEDA1
          CLOSE     OUTHEDA1
          OPEN      OUTHEDA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILDIAG1
          CLOSE     OUTDIAG1
          OPEN      OUTDIAG1,CFNAME    
.
OPNOUT99  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,URNUMBER
          MOVE      SP70,PATALTID
          MOVE      SP70,PMSALTID
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,EPSCD001
          MOVE      SP70,SAVEURNO
          MOVE      SP70,ADMISSNO
          MOVE      ZERO,STARTNOT
          MOVE      SP70,NEXTPAGE
          MOVE      SP70,NOURSELC
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,MRGEFLAG
          MOVE      ZERO,SRCHTYPE
          MOVE      ZERO,DOWNLD01
          MOVE      ZERO,DOWNLD02
          MOVE      ZERO,DOWNLD03
          MOVE      ZERO,DOWNLD04
          MOVE      ZERO,DOWNLD05
          MOVE      ZERO,DOWNLD06
          MOVE      ZERO,DOWNLD07
          MOVE      ZERO,DOWNLD08
          MOVE      SP70,PATPA001
          MOVE      SP70,PATPA002
          MOVE      SP70,PMSVX044      * Coder Snags
          MOVE      ZERO,CODEDFLG
          MOVE      ZERO,VIEWTYPE
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,FILTFDAT
          MOVE      SP70,FILTTDAT
          MOVE      SP70,VYEARMTH
          MOVE      ZERO,CHECKCNT
          MOVE      SP70,CLNOT001
          MOVE      SP70,WBSEC008
          MOVE      SP70,ALRTFLTR
          MOVE      ZERO,BOOKFLAG
.          MOVE      Z70,PTVIS067       * I SRF 22685
          MOVE      SP70,ECOTFUND
          MOVE      SP70,ECOTTYPE
          MOVE      SP70,ECOTTRID
          MOVE      ZERO,FILTVTYP
          MOVE      ZERO,FILTFLAG
          MOVE      SP70,FILTHOSP
          MOVE      ZERO,STARTNUM
          MOVE      SP70,MAVBATCH
          MOVE      SP70,MAVINVCE
          MOVE      SP70,MAVMODUL
          MOVE      ZERO,NORECORD
          MOVE      SP70,NEXTVKEY
          MOVE      SP70,PREVVKEY
          MOVE      ZERO,PREVFLAG
          MOVE      ZERO,UPDATETY
          MOVE      SP70,UPDATTYP
          MOVE      ZERO,EMREVENT
          MOVE      SP70,SUPERLEV
.
          MOVE     SP70,PTCLM001
          MOVE     SP70,PTCLM002
          MOVE     SP70,PTCLM003
          MOVE     SP70,PTCLM004
          MOVE     SP70,PTCLM005
          MOVE     SP70,PTCLM006
          MOVE     SP70,PTCLM007
          MOVE     SP70,PTCLM008
          MOVE     SP70,PTCLM010
          MOVE     SP70,PTCLM011
          MOVE     SP70,PTCLM012
          MOVE     SP70,PTCLM013
          MOVE     SP70,PTCLM014
          MOVE     SP70,PTCLM015
          MOVE     SP70,PTCLM016
          MOVE     SP70,PTCLM017
          MOVE     SP70,PTCLM018
          MOVE     SP70,PTCLM019
          MOVE     SP70,PTCLM020
          MOVE     SP70,PTCLM021
          MOVE     SP70,PTCLM022
          MOVE     SP70,PTCLM023
          MOVE     SP70,PTCLM024
          MOVE     SP70,PTCLM025
          MOVE     SP70,PTCLM026
          MOVE     SP70,PTCLM027
          MOVE     SP70,PTCLM028
          MOVE     SP70,PTCLM029
          MOVE     SP70,PTCLM030
          MOVE     SP70,PTCLM031
          MOVE     SP70,PTCLM032
          MOVE     SP70,PTCLM033
          MOVE     SP70,PTCLM034
          MOVE     SP70,PTCLM035
          MOVE     SP70,PTCLM036
          MOVE     SP70,PTCLM037
          MOVE     SP70,PTCLM038
          MOVE     SP70,PTCLM039
          MOVE     SP70,PTCLM040
          MOVE     SP70,PTCLM041
          MOVE     SP70,PTCLM042
          MOVE     SP70,PTCLM043
          MOVE     SP70,PTCLM044
          MOVE     SP70,PTCLM045
          MOVE     SP70,FILTDEPT
          MOVE     ZERO,DEFTFLAG
          MOVE     SP70,PMSOVRKY
          MOVE     SP70,PMSOVVKY
          MOVE     SP70,PCIPPRNT 
.
          CALL      CLPTPRA0                * clear P.R.A cgi variables
.
          MOVE      ONE,TACCOUNT
          WHILE     TACCOUNT <= 50
            MOVE      SP70,TACRECKY[TACCOUNT]
            ADD       ONE,TACCOUNT
          DO
.
          MOVE      ONE,WCOCOUNT
          WHILE     WCOCOUNT <= 50
            MOVE      SP70,WCORECKY[WCOCOUNT]
            ADD       ONE,WCOCOUNT
          DO
.
          MOVE      ZERO,TACCOUNT
          MOVE      ZERO,WCOCOUNT
          MOVE      ZERO,ERRORCNT
          MOVE      ZERO,SRCHVIEW
.
          PACK      WLINE1A,SP30,SP30            
          PACK      WLINE2A,SP30,SP30 
          PACK      WLINE3A,SP30,SP30            
          PACK      WLINE4A,SP30,SP30
          PACK      WLINE5A,SP30,SP30
          PACK      WLINE6A,SP30,SP30
          PACK      WLINE7A,SP30,SP30
          PACK      WLINE8A,SP30,SP30
.
.---end *I-903005 ---
.
          MOVE      SP70,PTMMB001
          MOVE      ZEROVISN,PTMMB002
          MOVE      ZERO,PTMMB003
          MOVE      SP70,PTMMB004
          MOVE      SP70,PTMMB005
          MOVE      SP70,PTMMB006
          MOVE      SP70,PTMMB007
.
          MOVE      SP70,UNIQNUMB
.          MOVE      SP70,PRHRE001
.          MOVE      SP70,PRHRE002
.          MOVE      SP70,PRHRE003
          CALL      CPPRHR00
.
          MOVE      ZERO,EXDTBLNK
          MOVE      ZERO,ALLHFLAG
          MOVE      SP70,FILTURNO
          MOVE      SP70,HLFDCLTY
          MOVE      SP70,HLTHFUND
          MOVE      ZERO,EXCLWAIT
          MOVE      SP70,FILTADMN
          MOVE      SP70,BATCHNUM
          MOVE      ZERO,VALDTYPE
          MOVE      SP70,CLAIMSTA
          MOVE      SP70,INVNUMBR
          MOVE      SP70,PROCSTAT
          MOVE      ZERO,EXCLCLOS
          MOVE      SP70,HOSPCODE
          MOVE      SP70,BTSCHOSP
          MOVE      SP70,ECCLFBID
          MOVE      SP70,ECCLSTRD
          MOVE      SP70,ECCLARID
          MOVE      SP70,ECCLFRID
          MOVE      SP70,ECCLCACN
          MOVE      SP70,ECCLSECN
          MOVE      SP70,ECCLCLID
          MOVE      SP70,ECCLRPTC
          MOVE      SP70,ECCLEVTC
          MOVE      SP70,ECCLITMN
          MOVE      SP70,ECCLSRVC
          MOVE      SP70,ECCLRKEY
          MOVE      SP70,ECCLTRID
          MOVE      SP70,ECCLCLMI
.
          CALL      CLPMCL00
.
          MOVE      SP70,WBSRV001
          MOVE      SP70,WBSRV002
          MOVE      SP70,WBSRV003
          MOVE      SP70,WBSRV004
          MOVE      SP70,WBSRV005
          MOVE      SP70,WBSRV006
          MOVE      SP70,WBSRV007
.
          MOVE      SP70,WBSDD001
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nourselc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NOURSELC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updatety=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,UPDATETY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updattyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pataltid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PATALTID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsaltid=",QRYNAME
          IF        @EQUAL
            PACK      PMSALTID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claimtyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLAIMTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmnut",QRYNAME
          IF        @EQUAL
            CALL      SPNUT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnot=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,STARTNOT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bookflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BOOKFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "epscd001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EPSCD001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchtype=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,SRCHTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchview=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHVIEW
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsvx044=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSVX044
            PACK      PMSVX044,PMSVX044,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "codedflg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CODEDFLG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lfstdate=",QRYNAME
          IF        @EQUAL
            MOVE      "00000000",FRSTDATE
            MATCH     SP20,QRYDATA
            IF        !@EOS
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      FRSTDATE,CCENT,CYEAR,CMON,CDAY
              REP       " 0",FRSTDATE
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "llstdate=",QRYNAME
          IF        @EQUAL
            MOVE      "99999999",LASTDATE
            MATCH     SP20,QRYDATA
            IF        !@EOS
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      LASTDATE,CCENT,CYEAR,CMON,CDAY
              REP       " 0",LASTDATE
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clnot001",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLNOT001
            PACK      CLNOT001,CLNOT001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbsec008",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WBSEC008
            PACK      WBSEC008,WBSEC008,SP70
            GOTO      SETPAR99
          ENDIF
.
.          MATCH     "ptvis067=",QRYNAME            * I SRF 22685
.          IF        @EQUAL
.            MOVE      QRYDATA,PTVIS067             * Populate CGI parameter
.            GOTO      SETPAR99                     * with diet comment
.          ENDIF
.                                                  * end I SRF 22685
          MATCH     "filtvtyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTVTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filthosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alrtfltr=",QRYNAME
          IF        @EQUAL
            MOVE       QRYDATA,ALRTFLTR
            GOTO       SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextvkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTVKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevvkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVVKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH      "updtacno",QRYNAME
          IF         @EQUAL
            COMPARE   "99",TACCOUNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,TACCOUNT
            PACK      TACRECKY[TACCOUNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH      "updwcono",QRYNAME
          IF         @EQUAL
            COMPARE   "99",WCOCOUNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,WCOCOUNT
            PACK      WCORECKY[WCOCOUNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
. *I-903005 ---- start
.
          MATCH     "selprint=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,SELPRINT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdcopy=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,NOLABEL
            GOTO      SETPAR99
          ENDIF
.
. *I-903005 ---- end
.
          CALL       SPPRA000          * Set parameters for PRFA
.
          MATCH     "ptmmb",QRYNAME
          IF        @EQUAL
            CALL      STMMB000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtfdat=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00                *Set CMON from MTHNAM3
            PACK      FILTFDAT,CCENT,CYEAR,CMON,CDAY
          ENDIF
.
          MATCH     "filttdat=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00                *Set CMON from MTHNAM3
            PACK      FILTTDAT,CCENT,CYEAR,CMON,CDAY
          ENDIF
.
          MATCH     "superlev=",QRYNAME
          IF        @EQUAL
            PACK      SUPERLEV,QRYDATA,SP70
          ENDIF
.
          MATCH     "filtdept=",QRYNAME
          IF        @EQUAL
            PACK      FILTDEPT,QRYDATA,SP70
          ENDIF
.
          MATCH     "deftflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DEFTFLAG
          ENDIF
.
          MATCH     "pmsovrky=",QRYNAME
          IF        @EQUAL
            PACK      PMSOVRKY,QRYDATA,SP70
          ENDIF
.
          MATCH     "pmsovvky=",QRYNAME
          IF        @EQUAL
            PACK      PMSOVVKY,QRYDATA,SP70
          ENDIF
.
          MATCH     "uniqnumb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UNIQNUMB
            GOTO      SETPAR99
          ENDIF
.
.          MATCH     "prhre001=",QRYNAME
.          IF        @EQUAL
.            MOVE      QRYDATA,PRHRE001
.            GOTO      SETPAR99
.          ENDIF
.
.          MATCH     "prhre002=",QRYNAME
.          IF        @EQUAL
.            MOVE      QRYDATA,PRHRE002
.            GOTO      SETPAR99
.          ENDIF
.
.          MATCH     "prhre003=",QRYNAME
.          IF        @EQUAL
.            MOVE      QRYDATA,PRHRE003
.            GOTO      SETPAR99
.          ENDIF
.
          MATCH     "prhre",QRYNAME
          IF        @EQUAL
            CALL      SPPRHR00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mavbatch=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MAVBATCH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mavinvce=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MAVINVCE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mavmodul=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MAVMODUL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exdtblnk=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXDTBLNK
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "allhflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ALLHFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filturno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTURNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecotfund=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECOTFUND
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecottype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECOTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecottrid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECOTTRID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hlfdclty=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HLFDCLTY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hlthfund=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HLTHFUND
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exclwait=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXCLWAIT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtadmn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTADMN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "batchnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BATCHNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claimsta=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLAIMSTA
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "invnumbr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INVNUMBR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PROCSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exclclos=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXCLCLOS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HOSPCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "btschosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BTSCHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclfbid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLFBID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclstrd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLSTRD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "eccltrid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLTRID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclarid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLARID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclfrid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLFRID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclcacn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLCACN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclsecn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLSECN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclclid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLCLID
            REP       "~##",ECCLCLID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclclmi=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLCLMI
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclrptc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLRPTC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclevtc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLEVTC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclitmn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLITMN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclsrvc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLSRVC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclrkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLRKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmclt",QRYNAME
          IF        @EQUAL
            CALL      SPMCL000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbsrv",QRYNAME
          IF        @EQUAL
            CALL      SWBSR000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbsdd001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WBSDD001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pcipprnt=",QRYNAME
          IF        @EQUAL
            PACK      PCIPPRNT,QRYDATA,SP70
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------
.   Set Parameters for Medical Records MBS
.------------------------------------------------------------
STMMB000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STMMB010,STMMB020,STMMB030,STMMB040,STMMB050:
                       STMMB060,STMMB070
.
          MOVE      ONE,EXIT
          GOTO      STMMB999

STMMB010  PACK      PTMMB001,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB020  MOVE      QRYDATA,PTMMB002
          GOTO      STMMB999
.
STMMB030  MOVE      QRYDATA,PTMMB003
          GOTO      STMMB999
.
STMMB040  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PTMMB004,CCENT,CYEAR,CMON,CDAY
          GOTO      STMMB999
.
STMMB050  PACK      PTMMB005,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB060  PACK      PTMMB006,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB070  PACK      PTMMB007,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB999  RETURN
+
.------------------------------------------------------------
. Output Patient Enquiry Page
.------------------------------------------------------------
GETPAT00  
          MOVE      ZERO,MASTFLAG
          MOVE      ZERO,MISSFLAG
          MOVE      ZERO,RESPFLAG
          MOVE      ZERO,DSCHFLAG
          MOVE      ZERO,PMVXFLAG
          MOVE      SP70,DOCTCODE
          CALL      IBACLOCK
          CALL      CLPATMAS
          CALL      CLPATMIS
          CALL      CLPATDSC
          CALL      CLPMSPX2
          CALL      CLPMSNUT
          CALL      CLRPDS00
          CALL      CLRICU00
          CALL      CLNZSP00
          CALL      CLPATHSP
          CALL      CLPMSVX1
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
          MATCH     "1",NOURSELC
          IF        @EQUAL
            GOTO      GETPAT20
          ENDIF
.
          MATCH     SP70,PATALTID
          IF        !@EQUAL
            CALL      GETALT00
            BRANCH    EXIT,GETPAT99
          ENDIF
.
          MATCH     SP70,PMSALTID
          IF        !@EQUAL
            CALL      GETAID00
            BRANCH    EXIT,GETPAT99
          ENDIF
.
          MATCH     "       0",URNUMBER
          IF        @EQUAL
            CALL      FINVIS00
            MOVE      EXIT,MASTFLAG
          ELSE
            MOVE      URNUMBER,KEY8
            CALL      RDMAST1
            MOVE      OVRCD,MASTFLAG
            MOVE      PURNO,KEY8
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
          ENDIF
.
          IF        PSTAT=1 | PSTAT=2
            MOVE      PURNO,SAVEURNO
            MOVE      PPSNAME,URNUMBER
            MOVE      ONE,MRGEFLAG
            GOTO      GETPAT00
          ENDIF
.
          IF        MASTFLAG=1
            MOVE      "Can't find patient master details",WEBTITLE
            CALL      WEBERR00
            GOTO      GETPAT99
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMRES1
          IF        OVRCD=1
            CALL      CLPMSRES
          ENDIF
.
          MOVE      ADMISSNO,KEY8
          MATCH     SP70,KEY8
          IF        @EQUAL | @EOS
            MOVE      ONE,MISSFLAG
            MOVE      ONE,RESPFLAG
            MOVE      ONE,DSCHFLAG
            MOVE      ONE,PMVXFLAG
            COMPARE   FOUR,SRCHTYPE         * U/R passed in from pat search
            CALL      FNDCUR00 IF EQUAL     * Find Current Admissin details
          ELSE
            CALL      RDMISS1
            MOVE      OVRCD,MISSFLAG
            CALL      RDPTDAD1
            IF        OVRCD=1
              MOVE      SP70,PTDAADTS
              MOVE      SP70,PTDADCTS
            ENDIF
.
            CALL      RDPTVIS1
            IF        OVRCD=1
              CALL      CLPATVIS
            ENDIF
            CALL      GETNZP00
          ENDIF
.
          MATCH     "035",TEMPLATE
          IF        !@EQUAL|@LESS
            MATCH     "35",TEMPLATE
            IF        !@EQUAL|@LESS
              GOTO      GETPAT02
            ENDIF
          ENDIF
          COMPARE   ONE,MISSFLAG
          IF        @EQUAL
            MOVE      "Invalid admission record",WEBTITLE
            CALL      WEBERR00
            GOTO      GETPAT99
          ENDIF
          COMPARE   ONE,ASTAT
          IF        @EQUAL
            MOVE      "Patient has not been admitted",WEBTITLE
            CALL      WEBERR00
            GOTO      GETPAT99
          ENDIF
.
GETPAT02  MATCH     "070",TEMPLATE
          IF        @EQUAL
            MOVE      ADMISSNO,KEY8
            CALL      RDDETA1
            IF        OVRCD=1
              CALL      CLAAEDET
            ENDIF
.
            MOVE      ADMISSNO,KEY8
            CALL      RDDISA1
            IF        OVRCD=1
              CALL      CLAAEDIS
            ENDIF
          ENDIF
.
          MOVE      ADMISSNO,KEY8
          CALL      RDPMVX11
          IF        OVRCD=1
            IF        ARCFLAG=1
              MOVE      ADMISSNO,KEY8
              CALL      RDARVX11
              IF        OVRCD<>1
                CALL      MVPMAR00
              ENDIF
            ENDIF
          ENDIF
          MOVE      OVRCD,PMVXFLAG
          COMPARE   ONE,PMVXFLAG
          IF        !@EQUAL
            MATCH     SP70,PMVXMHOS
            IF        !@EQUAL
              PACK      KEY3,PMVXMHOS,SP70
              CALL      RDPTHSP1
              IF        OVRCD=1
                CALL      CLPATHSP
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      ADMISSNO,KEY8
          CALL      RDDSCH1
          MOVE      OVRCD,DSCHFLAG
          IF        OVRCD=0
            MOVE      DDATE,ICDRDDTE   * Needed for RDPTICD1 & RDPTICO1 reads
          ENDIF
.
          MOVE      ADMISSNO,KEY8
          CALL      RDRESP1
          MOVE      OVRCD,RESPFLAG
.
          MOVE      ADMISSNO,KEY8
          CALL      RDBKREC1
          MOVE      OVRCD,BRECFLAG
.
          MOVE      SP70,PMEVEVNT
          MOVE      ADMISSNO,KEY8
          CALL      RDPMEVT1
.
GETPAT05  CALL      PATNAA00                * format name without bold tags
.
          MATCH     "034",TEMPLATE          * pre-adm from prev.detail option ?
          IF        @EQUAL
            IF        PCEASE=1
              MOVE      "Patient is Deceased",WEBTITLE
              CALL      WEBERR00
              GOTO      GETPAT99
            ENDIF
          ENDIF
.
.                                                 * read nutrition file
          PACK      KEY16,ADMISSNO,LASTDATE       * set key to read nutrition
          CALL      RDPMNUT1                      * if no rec found, vals blank
.                                                 * out already (CLPMSNUT)
.
          CALL      GETCCD00                      * get concession card details
.
          PACK      KEY8,ADMISSNO,SP70            * read pds file
          CALL      RDMRPDS1
.
          PACK      KEY8,ADMISSNO,SP70            * read icu file
          CALL      RDPTICU1
.
          MOVE      SP70,PRIDISCD
          MOVE      SP70,PDIADESC
          PACK      KEY13,ADMISSNO,SP70                               *C-240107
          CALL      RSPTECD1
          CALL      RKPTECD1
          BRANCH    OVRCD,GETPAT10
          MATCH     DPTEDADM,ADMISSNO
          GOTO      GETPAT10 IF NOT EQUAL
.
          MATCH     PTEDTYPE,CMDISP
          GOTO      GETPAT10 IF NOT EQUAL
.
          MATCH     "  1",DPTEDCNT                                    *C-240107
          GOTO      GETPAT10 IF NOT EQUAL
.
          MOVE      PTEDCODE,PRIDISCD
          MOVE      PTEDDESC,PDIADESC
.
GETPAT10  MOVE      SP70,PRIOPRCD
          MOVE      SP70,POPRDESC
          PACK      KEY13,ADMISSNO,SP70                               *C-240107
          CALL      RSPTECO1
          CALL      RKPTECO1
          BRANCH    OVRCD,GETPAT20
          MATCH     DPTEOADM,ADMISSNO
          GOTO      GETPAT20 IF NOT EQUAL
.
          MATCH     "  1",DPTEOCNT                                    *C-240107
          GOTO      GETPAT20 IF NOT EQUAL
.
          MOVE      PTEOCODE,PRIOPRCD
          MOVE      PTEODESC,POPRDESC
.
.    Webtplaf must be read here to get correct description for WEBTITLE
.
GETPAT20  IF        PTCNNHII=1
            MATCH     "001",TEMPLATE
            IF        @EQUAL
              MOVE      "30",TMOTFRST
              MOVE      "30",TMOTFRST
            ENDIF
            MATCH     "1",TEMPLATE
            IF        @EQUAL
              MOVE      "30",TMOTFRST
              MOVE      "30",TMOTFRST
            ENDIF
          ENDIF
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          PACK      KEY13,PRGID,KEY2,TEMPLATE,SP70
          CALL      RDWBTP1
          CLEAR     WEBTITLE
          APPEND    WBTPDES,WEBTITLE
          APPEND    PATFNAME,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GETPAT99
.
          MATCH     "1",NOURSELC
          IF        @EQUAL
            GOTO      GETPAT90
          ENDIF
          IF        PTCNNHII=1
            MOVE      URNUMBER,KEY8
            CALL      RDNHMAS2
            IF        OVRCD=1
              MOVE      "Missing nhimasaf record",WEBTITLE
              CALL      WEBERR00
              GOTO      GETPAT99
            ENDIF
          ENDIF
.
GETPAT90  IF        PTCNNHII=1
            MATCH     "1",NOURSELC
            IF        @EQUAL
              GOTO      GETPAT92
            ENDIF
            MOVE      URNUMBER,KEY8
            CALL      RDNHMAS2
            IF        OVRCD=1
              MOVE      "Missing nhimasaf record",WEBTITLE
              CALL      WEBERR00
              GOTO      GETPAT99
            ENDIF
            MATCH     "001",TEMPLATE
            IF        !@EQUAL
              MATCH     "1",TEMPLATE
              IF        !@EQUAL
                GOTO      GETPAT92
              ENDIF
            ENDIF
            MOVE      URNUMBER,DIM20                                *I-131266
            SQUEEZE   DIM20
            UNPACK    DIM20,DIM1
            TYPE      DIM1
            GOTO      GETPAT92 IF EQUAL        * numeric prefix on URNUMBER
.
            SCAN      "T-",URNUMBER             * check if temporary number
            IF  !@EQUAL
              RESET     URNUMBER 
              CALL      CONNECT
              BRANCH    EXIT,GETPAT99
              MOVE      SP1,NZIBMWST      * prevent call to SETMED if we miss
              CALL      CHKHCU00
              MATCH     SP70,NZIBMWST
              IF        !@EQUAL
                PROC      SETMED00
              ENDIF
              CALL      DISCNNCT
              BRANCH    EXIT,GETPAT99
            ENDIF
            RESET     URNUMBER 
          ENDIF
.
GETPAT92  CALL      WEBBOD00   * Output Templated Body of HTML 
          IF        MRGEFLAG=1
            CALL      MRGALT00
          ENDIF
          CALL      WEBEND00   * Output End of Web Page
.
.
GETPAT99  RETURN
.------------------------------------------------------------
. Get Concession Card Details if they exist
.------------------------------------------------------------
GETCCD00  UNPACK    SP70,CCRDTYPE,CCRDNUMB,CCRDEXDT
          PACK      KEY19,URNUMBER,SP70
          CALL      RSPMCCD1
          CALL      RKPMCCD1
          BRANCH    OVRCD,GETCCD99
.
          MATCH     URNUMBER,PMCDURNO
          GOTO      GETCCD99 IF NOT EQUAL
.
          MOVE      PMCDCNUM,CCRDNUMB            * card number
.
          PACK      KEY5,CATct,PMCDCTYP,SP70
          CALL      RDCODE1
          IF        OVRCD<>1
            MOVE      TDESC,CCRDTYPE             * card type
          ENDIF
.
          PACK      CCRDEXDT,PMCDEXDT,SP70       * card expiry date
.
GETCCD99  RETURN
.
.------------------------------------------------------------
. Get Alternate ID
.------------------------------------------------------------
GETALT00  
          PACK      KEY30,PATALTID,SP70
          CALL      RSPTNID2
          CALL      RKPTNID2
          BRANCH    OVRCD,GETALT90          * no record on file
          MATCH     PATALTID,PTNINMPI
          GOTO      GETALT90 IF NOT EQUAL   * different National UR
          MOVE      PTNILNUM,URNUMBER
          MOVE      ZERO,EXIT
          GOTO      GETALT99
GETALT90  MOVE      "Can't find patient master details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
GETALT99  RETURN
.
.------------------------------------------------------------
. Get Alternate ID from PMSAIDFD
.------------------------------------------------------------
GETAID00  COMPARE   ONE,PTCNUALT            * Using Alternate ID
          GOTO      GETAID99 IF NOT EQUAL
.
          MATCH     SP70,URNUMBER           * Exit if there is a urnumber
          GOTO      GETAID99 IF NOT EQUAL
.
          PACK      KEY31,PMSALTID,SP70
          CALL      RSPMAID2
          CALL      RKPMAID2
          BRANCH    OVRCD,GETAID90          * no record on file
.
          MATCH     PMSALTID,PMAIALID
          GOTO      GETAID90 IF NOT EQUAL   * different alternate ID
.
          MOVE      PMAIURNO,URNUMBER
          MOVE      ZERO,EXIT
          GOTO      GETAID99
.
GETAID90  MOVE      "Can't find patient master details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
GETAID99  RETURN
+
.------------------------------------------------------------
. Alert that this is a merged U/R
.------------------------------------------------------------
MRGALT00  MATCH     SP70,URNUMBER
          GOTO      MRGALT99 IF EQUAL
.
          MATCH     SP70,SAVEURNO
          GOTO      MRGALT99 IF EQUAL
.
          MOVE      SAVEURNO,DISPSUR
          SQUEEZE   DISPSUR
          MOVE      URNUMBER,DISPMUR
          SQUEEZE   DISPMUR 
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " alert('U/R Number ",DISPSUR," is merged with ":
                             DISPMUR," \n Using ",DISPMUR,"');":
                             "}":
                             "</script>"
          GOTO      MRGALT99
.
MRGALT99  RETURN
.------------------------------------------------------------
. Get Name from Visit Based Tables
.------------------------------------------------------------
FINVIS00  MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,FINVIS80
.
          BRANCH    PVITYPE,FINVIS10,FINVIS20,FINVIS20
          MOVE      ONE,EXIT
          GOTO      FINVIS99
.
FINVIS10  BRANCH    EMRFLAG,FINVIS90
          MOVE      PVIBILL,KEY8
          CALL      RDEMUNK1
          BRANCH    OVRCD,FINVIS90
          MOVE      SP70,PTITL
          MOVE      EMUNSNAM,PSNAME
          MOVE      EMUNGNAM,PGNAME
          MOVE      EMUNBDAT,PBDATE
          MOVE      EMUNSEX,PSEX
          MOVE      EMUNAGE,PSAGE
          MATCH     SP70,PSNAME
          IF        @EQUAL
            MOVE     EMUNDET1,PSNAME
          ENDIF
          MATCH     SP70,PGNAME
          IF        @EQUAL
            MOVE     EMUNDET2,PGNAME
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS20  MOVE      PVIBILL,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,FINVIS90
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS30  MOVE      PVIBILL,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,FINVIS90
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS80  MOVE      ADMISSNO,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,FINVIS85
          MOVE      URNUMBER,PURNO
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS85  BRANCH    EMRFLAG,FINVIS90
          MOVE      ADMISSNO,KEY8
          CALL      RDEMUNK1
          BRANCH    OVRCD,FINVIS90
          MOVE      SP70,PTITL
          MOVE      EMUNSNAM,PSNAME
          MOVE      EMUNGNAM,PGNAME
          MOVE      EMUNBDAT,PBDATE
          MOVE      EMUNSEX,PSEX
          MOVE      EMUNAGE,PSAGE
          MATCH     SP70,PSNAME
          IF        @EQUAL
            MOVE     EMUNDET1,PSNAME
          ENDIF
          MATCH     SP70,PGNAME
          IF        @EQUAL
            MOVE     EMUNDET2,PGNAME
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS90  MOVE      ONE,EXIT
.
FINVIS99  RETURN
+
.------------------------------------------------------------
. Process Fields in Body of HTML Template
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD99,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110,PROFL120
.
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13,PROFLD14,PROFLD15:
                             PROFLD16,PROFLD17,PROFLD18,PROFLD19,PROFL191
          GOTO      PROFLD99
.
.         ********* PROFLD19 ADDED BY HPS BLR
.
PROFLD11  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD12  CALL      MISF0000
          GOTO      PROFLD99
.
PROFLD13  CALL      DSCF0000
          GOTO      PROFLD99
.
PROFLD14  CALL      TABL0000     * Table Displays
          GOTO      PROFLD99
.
PROFLD15  CALL      BREC0000     * Patient Bookings Details
          GOTO      PROFLD99
.
PROFLD16  CALL      MSXF0000     * Master Extension Details
          GOTO      PROFLD99
.
PROFLD17  CALL      DRGS0000     * DRG Information 
          GOTO      PROFLD99
.
PROFLD18  CALL      PMIX0000     * Master Extension Details Two
          GOTO      PROFLD99
.
PROFLD19  CALL      ECLP0000
          GOTO      PROFLD99
.
PROFL191  CALL      VISF0000
          GOTO      PROFLD99
.
PROFLD20  BRANCH  FLDSETNO,PROFLD21,PROFLD22,PROFLD23
          GOTO    PROFLD99
.
PROFLD21  CALL    MASF0000
          GOTO    PROFLD99
.
PROFLD22  CALL    PRHR0000
          GOTO    PROFLD99
.
PROFLD23  CALL    ECFL0000
          GOTO    PROFLD99
.
PROFLD30  BRANCH  FLDSETNO,PROFLD31,PROFLD32
          GOTO    PROFLD99
.
PROFLD31  CALL    ECCL0000
          GOTO    PROFLD99
.
PROFLD32  CALL    MASF0000
          GOTO    PROFLD99
.
PROFLD50  BRANCH  FLDSETNO,PROFLD51,PROFLD52,PROFLD53
          GOTO    PROFLD99
.
PROFLD51  CALL    MASF0000
          GOTO    PROFLD99
.
PROFLD52  CALL    MISF0000
          GOTO    PROFLD99
.
PROFLD53  CALL    ECFH0000
          GOTO    PROFLD99
.
PROFLD60  BRANCH  FLDSETNO,PROFLD61,PROFLD62,PROFLD62
          GOTO    PROFLD99
.
PROFLD61  CALL    EHCL0000
          GOTO    PROFLD99
.
PROFLD62  CALL    MASF0000
          GOTO    PROFLD99
.
PROFL163  CALL    MISF0000
          GOTO    PROFLD99
.
PROFLD70  BRANCH  FLDSETNO,PROFLD71,PROFLD72,PROFLD73
          GOTO    PROFLD99
.
PROFLD71  CALL    MASF0000
          GOTO    PROFLD99
.
PROFLD72  CALL    PRHR0000
          GOTO    PROFLD99
.
PROFLD73  CALL    ECFP0000
          GOTO    PROFLD99
.
PROFLD80  BRANCH  FLDSETNO,PROFLD81,PROFLD82
          GOTO    PROFLD99
.
PROFLD81  CALL    WBPC0000
          GOTO    PROFLD99
.
PROFLD82  CALL    MASF0000
          GOTO    PROFLD99
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91,PROFLD92,PROFLD93
          GOTO      PROFLD99
.
PROFLD91  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD92  CALL      PRHR0000
          GOTO      PROFLD99
.
PROFLD93  CALL      WBBF0000                  * Bulk Billing fields
          GOTO      PROFLD99
.
PROFL100  BRANCH    FLDSETNO,PROFL101,PROFL102
          GOTO      PROFLD99
.
PROFL101  CALL      WBQF0000
          GOTO      PROFLD99
.
PROFL102  CALL      MASF0000
          GOTO      PROFLD99
.
PROFL110  BRANCH    FLDSETNO,PROFL111,PROFL112,PROFL113
          GOTO      PROFLD99
.
PROFL111  CALL      MASF0000 
          GOTO      PROFLD99
.
PROFL112  CALL      PRHR0000
          GOTO      PROFLD99
.
PROFL113  CALL      WBDF0000                  * DVAW fields
          GOTO      PROFLD99
.
PROFL120  BRANCH    FLDSETNO,PROFL121,PROFL122
          GOTO      PROFLD99
.
PROFL121  CALL      WDQF0000
          GOTO      PROFLD99
.
PROFL122  CALL      MASF0000
          GOTO      PROFLD99
.

.
PROFLD99  RETURN
+
.------------------------------------------------------------
. Date selection from Admission Date to Current Date
.------------------------------------------------------------
DATSEL00  MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,DATSEL99
.
          CALL      IBACLOCK
          PACK      TODAY,CCC,CYY,CMM,CDD
          REP       " 0",TODAY
.
          UNPACK    TODAY,CCENT,CYEAR,CMON,CDAY
          MOVE      ZERO,FAILCNT
.
DATSEL10  PACK      KEY8,CCENT,CYEAR,CMON,CDAY
          REP       " 0",KEY8
          MATCH     ADATE,KEY8
          GOTO      DATSEL99 IF LESS
.
          ADD       ONE,FAILCNT
          MATCH     TODAY,KEY8
          IF        @EQUAL
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;"<option value=#"",KEY8,"#" selected>",CDAY,SP1:
                                MTHNAM3,SP1,CCENT,CYEAR,"</option>";
          ELSE
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;"<option value=#"",KEY8,"#">",CDAY,SP1:
                                 MTHNAM3,SP1,CCENT,CYEAR,"</option>";
          ENDIF
.
          MOVE      "-1",ADJDAYS
          CALL      ADJDAT00
          IF        FAILCNT<150
            GOTO      DATSEL10
          ENDIF
DATSEL99  RETURN
.---------------------------------------------------------------------
.         ********    HPS BLR  CODE STARTS HERE   ********* 
.         Display of the Following Fields                   
.                   Special Funding Arrangement
.                   Program Funding Source
.                   Hospital Transferred From
.---------------------------------------------------------------------
ECLP0000  BRANCH    FLDITMNO,ECLP0010,ECLP0020,ECLP0030,ECLP0040,ECLP0050:
                             ECLP0060,ECLP0070,ECLP0080,ECLP0090,ECLP0100:
                             ECLP0110,ECLP0120,ECLP0130,ECLP0140,ECLP0150:
                             ECLP0160,ECLP0170,ECLP0180,ECLP0190
          GOTO      ECLP9999
.
ECLP0010  MOVE      ONE,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0020  MOVE      TWO,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0030  MOVE      THREE,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0040  MOVE      FOUR,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0050  MOVE      FIVE,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0060  MOVE      SIX,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0070  MOVE      SEVEN,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0080  MOVE      EIGHT,FORM1
          CALL      PMSOVR00
          GOTO      ECLP9999
.
ECLP0090  MOVE      ONE,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0100  MOVE      TWO,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0110  MOVE      THREE,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0120  MOVE      FOUR,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0130  MOVE      FIVE,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0140  MOVE      SIX,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0150  MOVE      SEVEN,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0160  MOVE      EIGHT,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0170  MOVE      NINE,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0180  MOVE      TEN,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP0190  MOVE      TEN1,FORM2
          CALL      PMSOVV00
          GOTO      ECLP9999
.
ECLP9999  RETURN
+
.------------------------------------------------------------------------
.
.         ***************        HPS CODE ENDS HERE    ***************
.
.------------------------------------------------------------
. Table Outputs (Visit, Transfers, etc)
.------------------------------------------------------------
TABL0000  BRANCH    FLDITMNO,TABL0100,TABL0200
          GOTO      TABL9999
.
TABL0100  CALL      OVRTAB00
          GOTO      TABL9999
.
TABL0200  CALL      OVVTAB00
          GOTO      TABL9999
.
TABL9999  RETURN
.-----------------------------------------------------------
. Option 1 - DRG Information and Medical Record Options
. First up read DRG File if OVRCD set flag and continue
. This is done here as not to disrupt the Main Routine
.-----------------------------------------------------------
DRGS0000  MOVE      SP70,KEY3
          CALL      GTDRG000       * Get Grouper Version - returns it in KEY3
          COMPARE   ZERO,EPSCD001
          IF        @EQUAL
            MOVE      ONE,EPSCD001   * Set to default to 1 if blank
          ENDIF
          PACK      KEY13,ADMISSNO,EPSCD001,KEY3,SP70 
          CALL      RDPTPGR1   * Read Grouper Details
          IF        OVRCD=1
            PACK      KEY10,ADMISSNO,EPSCD001
            PACK      KEY13,KEY10,SP70 
            CALL      RSPTPGR1   * Read Grouper Details
            CALL      RKPTPGR1
            IF        OVRCD=0
              PACK      DIM10,PTPGADMN,PTPGEPNO
              MATCH     KEY10,DIM10
              GOTO      DRGS0010 IF EQUAL
            ENDIF
            CALL      CLRGRP00
          ENDIF
.
.  Now start normal branch on flditmno section
.
DRGS0010  BRANCH    FLDITMNO,DRGS0100,DRGS0200,DRGS0300,DRGS0400,DRGS0500:
                             DRGS0600,DRGS0700,DRGS0800,DRGS0900,DRGS1000:
                             DRGS1100,DRGS1200,DRGS1300,DRGS1400,DRGS1500:
                             DRGS1600,DRGS1700,DRGS1800,DRGS1900,DRGS2000:
                             DRGS2100,DRGS2200,DRGS2300,DRGS2400,DRGS2500:
                             DRGS2600,DRGS2700,DRGS2800,DRGS2900,DRGS3000:
                             DRGS3100,DRGS3200,DRGS3300,DRGS3400
          GOTO      DRGS9999
.
DRGS0100  CALL      SELEPS00           * Selection List of Episodes
          GOTO      DRGS9999
.
DRGS0200                               * EMPTY!!!!!!!! 
          GOTO      DRGS9999
.
DRGS0300  MATCH     SP70,ACODDTE
          IF        @EQUAL
            WRITE     HTMLFILE;"0";    * Coding Incomplete
          ELSE
            WRITE     HTMLFILE;"1";    * Coding Complete
          ENDIF
          GOTO      DRGS9999
.
DRGS0400  CALL      SHWMAP00   * Set URL Routine           
          GOTO      DRGS9999
.
DRGS0500  WRITE     HTMLFILE;DPTPGADM;  * Admissno No            
          GOTO      DRGS9999
.
DRGS0600  WRITE     HTMLFILE;DPTPGEPN;  * Episode No                    
          GOTO      DRGS9999
.
DRGS0700  WRITE     HTMLFILE;PTPGGPVR;  * Grouper Version               
          GOTO      DRGS9999
.
DRGS0800  MOVE      PTPGNDRG,DDRGCODE   * National DRG                  
          CALL      DISDRG00            * DRG Details
          GOTO      DRGS9999
.
DRGS0900  WRITE     HTMLFILE;PTPGNMDC;  * National MDC                  
          GOTO      DRGS9999
.
DRGS1000  WRITE     HTMLFILE;PTPGNWGT;  * National Weight               
          GOTO      DRGS9999
.
DRGS1100  WRITE     HTMLFILE;PTPGNALS;  * National average LOS              
          GOTO      DRGS9999
.
DRGS1200  MOVE      PTPGSDRG,DDRGCODE   * State DRG                     
          CALL      DISDRG00            * DRG Details
          GOTO      DRGS9999
.
DRGS1300  WRITE     HTMLFILE;PTPGSMDC;  * State MDC                     
          GOTO      DRGS9999
.
DRGS1400  WRITE     HTMLFILE;PTPGSWGT;  * State Weight               
          GOTO      DRGS9999
.
DRGS1500  WRITE     HTMLFILE;PTPGSALS;  * State average LOS               
          GOTO      DRGS9999
.
DRGS1600  MOVE      PTPGLDRG,DDRGCODE   * Local DRG                     
          CALL      DISDRG00            * DRG Details
          GOTO      DRGS9999
.
DRGS1700  WRITE     HTMLFILE;PTPGLMDC;  * Local MDC                     
          GOTO      DRGS9999
.
DRGS1800  WRITE     HTMLFILE;PTPGLWGT;  * Local Weight               
          GOTO      DRGS9999
.
DRGS1900  WRITE     HTMLFILE;PTPGLALS;  * Local average LOS             
          GOTO      DRGS9999
.
DRGS2000  WRITE     HTMLFILE;PTPGPCCL;  * Patient CC class level        
          GOTO      DRGS9999
.
DRGS2100  WRITE     HTMLFILE;PTPGWFIX;  * WIES value fixed              
          GOTO      DRGS9999
.
DRGS2200  WRITE     HTMLFILE;PTPGWVAR;  * WIES value variable           
          GOTO      DRGS9999
.
DRGS2300  WRITE     HTMLFILE;PTPGWTOL;  * WIES value total              
          GOTO      DRGS9999
.
DRGS2400  WRITE     HTMLFILE;PTPGWWTU;  * WIES weight used              
          GOTO      DRGS9999
.
DRGS2500  WRITE     HTMLFILE;PTPGWWTD;  * WIES weight description       
          GOTO      DRGS9999
.
DRGS2600  CALL      WRDDIS00      * Output Discharge Ward Description   
          GOTO      DRGS9999
.
DRGS2700  WRITE     HTMLFILE;PTPGNDRG;  * National DRG
          GOTO      DRGS9999
.
DRGS2800  WRITE     HTMLFILE;PTPGSDRG;  * State DRG
          GOTO      DRGS9999
.
DRGS2900  WRITE     HTMLFILE;PTPGLDRG;  * Local DRG
          GOTO      DRGS9999
.
DRGS3000  MOVE      PTPGNDRG,DDRGCODE   * National DRG
          CALL      WIESVL00            * Display Wies Information
          GOTO      DRGS9999
.
DRGS3100  MOVE      PTPGSDRG,DDRGCODE   * State DRG
          CALL      WIESVL00            * Display Wies Information
          GOTO      DRGS9999
.
DRGS3200  MOVE      PTPGLDRG,DDRGCODE   * Local DRG
          CALL      WIESVL00            * Display Wies Information
          GOTO      DRGS9999
.
DRGS3300  CALL      CODUSR00            * Output Coder User ID
          GOTO      DRGS9999
.
DRGS3400  CALL      CODDAT00            * Output Coding Date and Time
          GOTO      DRGS9999
.
DRGS9999  RETURN
.------------------------------------------------------------
. Codding Date & Time      
. 0.Date 1.Time  
.------------------------------------------------------------
CODDAT00  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
          MOVE      ZERO,ECDFLAG   * Diagnosis Episode Flag
.
          PACK      KEY13,ADMISSNO,EPSCD001,Z70
          CALL      RSPTECD1
          CALL      RPPTECD1
          IF        OVRCD=1
            MOVE      ONE,ECDFLAG
            GOTO      CODDAT10
          ENDIF
.
          MATCH     ADMISSNO,DPTEDADM
          IF        !@EQUAL
            MOVE      ONE,ECDFLAG
            GOTO      CODDAT10
          ENDIF
.
.         Check episode operation coding
.
CODDAT10  PACK      KEY13,ADMISSNO,EPSCD001,Z70                       *C-240107
          CALL      RSPTECO1
          CALL      RPPTECO1
          IF        OVRCD=1
            IF        ECDFLAG=1  
              GOTO      CODDAT40
            ENDIF
          ENDIF
.
          MATCH     ADMISSNO,DPTEOADM
          IF        !@EQUAL
            IF        ECDFLAG=1  
              GOTO      CODDAT40
            ENDIF
          ENDIF
.
CODDAT20  MATCH     PTEDDTCD,PTEODTCD
          IF        @EQUAL
            MATCH     PTEDTIME,PTEOTIME
            IF        @LESS          
              MOVE      PTEDDTCD,F8       * Set Disease Date
              MOVE      PTEDTIME,KEY5     * Set Disease Time
              GOTO      CODDAT21
            ELSE
              MOVE      PTEODTCD,F8       * Set Procedure Date
              MOVE      PTEOTIME,KEY5     * Set Procedure Time
              GOTO      CODDAT21
            ENDIF
          ENDIF
.
          MATCH     PTEDDTCD,PTEODTCD
          IF        @LESS          
            MOVE      PTEDDTCD,F8       * Set Disease Date
            MOVE      PTEDTIME,KEY5     * Set Disease Time
          ELSE         
            MOVE      PTEODTCD,F8       * Set Procedure Date
            MOVE      PTEOTIME,KEY5     * Set Procedure Time
          ENDIF
.
CODDAT21  COMPARE   ZERO,F8       * Check if F8 has anything init?
          GOTO      CODDAT40 IF EQUAL  
.
          MOVE      F8,KEY8      * Set Date as Dim variable
.
          BRANCH    F1,CODDAT30
.
          REP       " 0",KEY8    
          UNPACK    KEY8,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CODDAT99
.
CODDAT30  WRITE     HTMLFILE;KEY5;
          GOTO      CODDAT99

.       if operation/disease coding record doesn't exist, use current date/time
.
CODDAT40  BRANCH    F1,CODDAT50
          MOVE      CMM,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY4,CCC,CYY
          REP       " 0",KEY4
          MOVE      CDD,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;KEY2,SP1,MTHNAM3,SP1,KEY4;
          GOTO      CODDAT99
.
CODDAT50  WRITE     HTMLFILE;CTIMEIS;
          GOTO      CODDAT99
.
CODDAT99  RETURN
.*************************************************************************
.  Out put Coder ID:  0.Desc 1.Code
.*************************************************************************
CODUSR00  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
.
          MOVE      ONE,PTEDEPNO
          MOVE      ONE,PTEDCNT
          PACK      KEY13,ADMISSNO,PTEDEPNO,PTEDCNT,SP70              *C-240107
          CALL      RDPTECD1
          BRANCH    OVRCD,CODUSR20
.
          MATCH     SP70,PTEDUSID         * Web user id
          GOTO      CODUSR05 IF NOT EQUAL 
.         
          MATCH     SP70,PTEDOPER         * user passcode
          GOTO      CODUSR20 IF EQUAL     
.         
          PACK      KEY14,PTEDOPER,SP70
          CALL      RSWBSE3
          CALL      RKWBSE3
          BRANCH    OVRCD,CODUSR20
.         
          MATCH     PTEDOPER,WBSEPCD
          GOTO      CODUSR20 IF NOT EQUAL
.         
          MOVE      WBSEUID,PTEDUSID
.
CODUSR05  PACK      KEY10,PTEDUSID,SP70   * Read Security File
          CALL      RDWBSE1
          BRANCH    OVRCD,CODUSR20
.
          BRANCH    F1,CODUSR10
.
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CODUSR99
.
CODUSR10  WRITE     HTMLFILE;WBSEUID;
          GOTO      CODUSR99
.
.         Check episode operation coding
.
CODUSR20  CALL      RDPTECO1
          BRANCH    OVRCD,CODUSR40
.
          MATCH     SP70,PTEOUSID         * Web user id
          GOTO      CODUSR25 IF NOT EQUAL
.
          MATCH     SP70,PTEOOPER         * user passcode
          GOTO      CODUSR40 IF EQUAL
.         
          PACK      KEY14,PTEOOPER,SP70
          CALL      RSWBSE3
          CALL      RKWBSE3
          BRANCH    OVRCD,CODUSR40
.         
          MATCH     PTEOOPER,WBSEPCD
          GOTO      CODUSR40 IF NOT EQUAL
.
          MOVE      WBSEUID,PTEOUSID
.
CODUSR25  PACK      KEY10,PTEOUSID,SP70  * Read Security File
          CALL      RDWBSE1
          BRANCH    OVRCD,CODUSR40
.
          BRANCH    F1,CODUSR30
.
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CODUSR99
.
CODUSR30  WRITE     HTMLFILE;WBSEUID;
          GOTO      CODUSR99
.
.   if operation/disease coding record doesn't exist, use current Web User 
.
CODUSR40  PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    F1,CODUSR50
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CODUSR99
.
CODUSR50  WRITE     HTMLFILE;WBSEUID;
          GOTO      CODUSR99
.
CODUSR99  RETURN
.--------------------------------------------------------------------
...         **** WIES Details by discharge date ****
...
...       If using 6.0 Grouper then:
...          If Discharge date >= 2010/07/01 use WIES17
...          If Discharge date >= 2009/07/01 use WIES16
...          If Discharge date >= 2008/07/01 use WIES15
...       If using 5.2 Grouper then:
...          If Discharge date >= 2008/07/01 use WIES15
...          If Discharge date >= 2007/07/01 use WIES14
...       If using 5.1 Grouper then:
...          If Discharge date >= 2006/07/01 use WIES13.
...       If using 5.0 Grouper then:
...          If Discharge date >= 2004/07/01 use WIES12.
...          else If Discharge date >= ICD10v4 Cutover use WIES12
...                                    ( go-live earlier than 2004/07/01)
...            else use WIES11.
...
...       If using 4.2 Grouper then:
...            use WIES11.
...
...       Anything other use WIES12
...
... 0.LOS, 1.Low Trim, 2.High Trim, 3.Description, 4.Multiday Weight
... 5.Same Day Weight
... INPUT PARAMETER : DDRGCODE
.------------------------------------------------------------
WIESVL00  UNPACK    DIM127,DIM1,KEY1,DIM127   
          MOVE      ZERO,VIEWFLAG 
          MOVE      KEY1,VIEWFLAG
.
          PACK      KEY8,ADMISSNO,SP70  * Patient must be discharged!
          CALL      RDDSCH1
          BRANCH    OVRCD,WIESVL90
.
.
          MATCH     SP70,DDRGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"&nbsp;";
            GOTO      WIESVL99
          ENDIF
.
.******************************************** start of addition       *I-197814
.         * Check DRG version. For 6.0      support WIES 17,16,15,14,13,12,11,10
.
          MATCH     DRG060,PTCNDGPV         * 6.0 DRG
          IF        @EQUAL
            MATCH     "20100701",DDATE      * 10/11 Fin year
            IF        !@LESS
              GOTO      WIESVL30            * using WIES17 (6.0 DRG)
            ENDIF
            MATCH     "20090701",DDATE      * 09/10 Fin year
            IF        !@LESS
              GOTO      WIESVL20            * using WIES16 (6.0 DRG)
            ENDIF
            MATCH     "20080701",DDATE      * 08/09 Fin year
            IF        !@LESS
              GOTO      WIESVL10            * using WIES15 (6.0 DRG)
            ENDIF
            MATCH     "20070701",DDATE      * 07/08 Fin year
            IF        !@LESS
              GOTO      WIESVL80            * using WIES14 (6.0 DRG)
            ENDIF
            MATCH     "20060701",DDATE      * 06/07 Fin year
            IF        !@LESS
              GOTO      WIESVL70            * using WIES13 (6.0 DRG)
            ENDIF
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (6.0 DRG)
            ENDIF
            MATCH     PTCNGDV5,DDATE        * 05/06 ICD10 Ed.5
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (6.0 DRG)
            ENDIF
.
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 Ed.4 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (6.0 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (6.0 DRG)
          ENDIF
.********************************************   end of addition       *I-197814
.
.******************************************** start of addition       *I-137125
.         * Check DRG version. For 5.2      support WIES 15,14,13,12,11,10   
.
          MATCH     DRG052,PTCNDGPV         * 5.2 DRG
          IF        @EQUAL
            MATCH     "20080701",DDATE      * 08/09 Fin year
            IF        !@LESS
              GOTO      WIESVL10            * using WIES15 (5.2 DRG)
            ENDIF
            MATCH     "20070701",DDATE      * 07/08 Fin year          *I-145161
            IF        !@LESS
              GOTO      WIESVL80            * using WIES14 (5.2 DRG)
            ENDIF
            MATCH     "20060701",DDATE      * 06/07 Fin year
            IF        !@LESS
              GOTO      WIESVL70            * using WIES13 (5.2 DRG)
            ENDIF
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.2 DRG)
            ENDIF
            MATCH     PTCNGDV5,DDATE        * 05/06 ICD10 Ed.5
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.2 DRG)
            ENDIF
.
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 Ed.4 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.2 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (5.2 DRG)
          ENDIF
.********************************************   end of addition       *I-137125
.
.******************************************** start of addition       *I-105244
.         * Check DRG version. For 5.1 only support WIES 13,12,11,10    *I-51504
.
          MATCH     DRG051,PTCNDGPV         * 5.1 DRG
          IF        @EQUAL
            MATCH     "20060701",DDATE      * 06/07 Fin year
            IF        !@LESS
              GOTO      WIESVL70            * using WIES13 (5.1 DRG)
            ENDIF
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.1 DRG)
            ENDIF
            MATCH     PTCNGDV5,DDATE        * 05/06 ICD10 Ed.5          
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.1 DRG)
            ENDIF
.
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 Ed.4 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.1 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (5.1 DRG)
          ENDIF
.********************************************   end of addition       *I-105244
.
.         * Check DRG version. For 5.0 only support WIES 12,11,10      *I-51504
          MATCH     DRG050,PTCNDGPV         * 5.0 DRG
          IF        @EQUAL
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.0 DRG)
            ENDIF
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.0 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (5.0 DRG)
          ENDIF
.
.         * Check DRG version. For 4.2 only support WIES 11,10.9       *I-51504
          MATCH     DRG042,PTCNDGPV         * 4.2 DRG
          IF        @EQUAL
            MATCH     "20030701",DDATE      * 03/04 Fin year
            IF        !@LESS
              GOTO      WIESVL50            * using WIES11 (4.2 DRG)
            ENDIF
          ENDIF
.
          GOTO      WIESVL60                * default to WIES 12
.
.     ***** WIES 15 *****
.         
WIESVL10  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw15af",WIESFILE 
          CALL      RDPT151
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL11,WIESVL12,WIESVL13,WIESVL14,WIESVL15
.
          WRITE     HTMLFILE;PT15ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL11  WRITE     HTMLFILE;PT15LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL12  WRITE     HTMLFILE;PT15HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL13  WRITE     HTMLFILE;PT15DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL14  WRITE     HTMLFILE;PT15TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL15  WRITE     HTMLFILE;PT15TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 16 *****
.
WIESVL20  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw16af",WIESFILE
          CALL      RDPT161
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL21,WIESVL22,WIESVL23,WIESVL24,WIESVL25
.
          WRITE     HTMLFILE;PT16ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL21  WRITE     HTMLFILE;PT16LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL22  WRITE     HTMLFILE;PT16HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL23  WRITE     HTMLFILE;PT16DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL24  WRITE     HTMLFILE;PT16TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL25  WRITE     HTMLFILE;PT16TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 17 *****
.
WIESVL30  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw17af",WIESFILE
          CALL      RDPT171
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL31,WIESVL32,WIESVL33,WIESVL34,WIESVL35
.
          WRITE     HTMLFILE;PT17ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL31  WRITE     HTMLFILE;PT17LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL32  WRITE     HTMLFILE;PT17HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL33  WRITE     HTMLFILE;PT17DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL34  WRITE     HTMLFILE;PT17TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL35  WRITE     HTMLFILE;PT17TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 11 *****                                              *I-43498
.
WIESVL50  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw11af",WIESFILE
          CALL      RDPT111
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL51,WIESVL52,WIESVL53
.
          WRITE     HTMLFILE;PT11ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL51  WRITE     HTMLFILE;PT11LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL52  WRITE     HTMLFILE;PT11HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL53  WRITE     HTMLFILE;PT11DRGD;  * DRG Description
          GOTO      WIESVL99
.
.     ***** WIES 12 *****                                              *I-51504
.
WIESVL60  PACK      KEY4,DDRGCODE,SP70
          MATCH     "20050701",DDATE
          IF        !@LESS
            MOVE      "patw12bf",WIESFILE
            CALL      RDPT12B1
            BRANCH    OVRCD,WIESVL92
          ELSE
            MOVE      "patw12af",WIESFILE
            CALL      RDPT121
            BRANCH    OVRCD,WIESVL92
          ENDIF
.
          BRANCH    VIEWFLAG,WIESVL61,WIESVL62,WIESVL63,WIESVL64,WIESVL65
.
          WRITE     HTMLFILE;PT12ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL61  WRITE     HTMLFILE;PT12LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL62  WRITE     HTMLFILE;PT12HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL63  WRITE     HTMLFILE;PT12DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL64  WRITE     HTMLFILE;PT12TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL65  WRITE     HTMLFILE;PT12TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 13 *****
.
WIESVL70  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw13af",WIESFILE
          CALL      RDPT131
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL71,WIESVL72,WIESVL73,WIESVL74,WIESVL75
.
          WRITE     HTMLFILE;PT13ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL71  WRITE     HTMLFILE;PT13LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL72  WRITE     HTMLFILE;PT13HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL73  WRITE     HTMLFILE;PT13DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL74  WRITE     HTMLFILE;PT13TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL75  WRITE     HTMLFILE;PT13TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 14 *****                                             *I-145161
.
WIESVL80  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw14af",WIESFILE
          CALL      RDPT141
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL81,WIESVL82,WIESVL83,WIESVL84,WIESVL85
.
          WRITE     HTMLFILE;PT14ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL81  WRITE     HTMLFILE;PT14LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL82  WRITE     HTMLFILE;PT14HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL83  WRITE     HTMLFILE;PT14DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL84  WRITE     HTMLFILE;PT14TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL85  WRITE     HTMLFILE;PT14TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
WIESVL90  WRITE     HTMLFILE;"Patient is not Discharged!";
          GOTO      WIESVL99
.
WIESVL91  WRITE     HTMLFILE;"Discharge Date out of WIES Range!";
          GOTO      WIESVL99
.
WIESVL92  MOVE      "DRG Code not found on ",DIM22
          PACK      DIM30,DIM22,WIESFILE
          WRITE     HTMLFILE;DIM30;
          GOTO      WIESVL99
.
.
WIESVL99  RETURN
.-------------------------------------------------------------------------------
.                        ****** CLRGRP00 ******
.-------------------------------------------------------------------------------
CLRGRP00  MOVE      SP70,DPTPGADM   * Admission no
          MOVE      SP70,DPTPGEPN   * Episode no
          MOVE      SP70,PTPGGPVR   * Grouper version
          MOVE      SP70,PTPGNDRG   * National DRG
          MOVE      SP70,PTPGNMDC   * National MDC
          MOVE      ZERO,PTPGNWGT   * National weight
          MOVE      ZERO,PTPGNALS   * National average LOS
          MOVE      SP70,PTPGSDRG   * State DRG
          MOVE      SP70,PTPGSMDC   * State MDC
          MOVE      ZERO,PTPGSWGT   * State weight
          MOVE      ZERO,PTPGSALS   * State average LOS
          MOVE      SP70,PTPGLDRG   * Local DRG
          MOVE      SP70,PTPGLMDC   * Local MDC
          MOVE      ZERO,PTPGLWGT   * Local weight
          MOVE      ZERO,PTPGLALS   * Local average LOS
          MOVE      SP70,PTPGPCCL   * Patient CC class level
          MOVE      ZERO,PTPGWFIX   * WIES value fixed
          MOVE      ZERO,PTPGWVAR   * WIES value variable
          MOVE      ZERO,PTPGWTOL   * WIES value total
          MOVE      ZERO,PTPGWWTU   * WIES weight used
          MOVE      SP70,PTPGWWTD   * WIES weight description
          MOVE      SP70,PTPGSPAR   * Spare variable
.
CLRGRP99  RETURN
.**********************************************************************
.                 ****** WRDDIS00 ******
. Output Ward description
.**********************************************************************
WRDDIS00  PACK      KEY6,PTDSDWRD,SP70
          CALL      RDWARD1
          BRANCH    OVRCD,WRDDIS90
.
          WRITE     HTMLFILE;WBDESC;    * description
          GOTO      WRDDIS99
.
WRDDIS90  WRITE     HTMLFILE;"Invalid Ward Code";
WRDDIS99  RETURN
.----------------------------------------------------------------
.                      SHWMAP00
.  Set url with its associated Episode No.
.----------------------------------------------------------------
SHWMAP00  REP       " +",URNUMBER
          REP       " +",ADMISSNO
          MOVE      EPSCD001,EPISODE
          REP       " +",EPISODE 
          UNPACK    DIM127,D1,KEY8,DIM127
          UNPACK    DIM127,D1,KEY2,DIM127
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;KEY8,".pbl?reportno=",KEY2:
                                 "&template=",FLDPARA:
                                 "&urnumber=",URNUMBER:
                                 "&admissno=",ADMISSNO:
                                 "&epscd001=",EPISODE;
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
SHWMAP99  RETURN
.----------------------------------------------------------------
.  Outputs a selection list of Episode numbers for a given Admission
.                   ******** SELEPS00 ********
.----------------------------------------------------------------
SELEPS00  MOVE      ZERO,F2
          REPEAT
            ADD       ONE,F2
            MOVE      ZERO,EPSSLIST[F2]
          UNTIL     F2 = 99
.
          MOVE      " 1",DIM2               * Check Disease Coding file
          PACK      KEY13,ADMISSNO,DIM2,SP70
          CALL      RSPTECD1
SELEPS10  CALL      RKPTECD1
          BRANCH    OVRCD,SELEPS20
.
          MATCH     ADMISSNO,DPTEDADM       * Check for Admission No
          GOTO      SELEPS20 IF NOT EQUAL
.
          MATCH     SP70,PTEDCODE
          IF        !@EQUAL
            MOVE      ONE,EPSSLIST[PTEDEPNO]
          ENDIF
          GOTO      SELEPS10
.
.
SELEPS20  MOVE      " 1",DIM2               * Check Oper Coding File  *C-240107
          PACK      KEY13,ADMISSNO,DIM2,SP70
          CALL      RSPTECO1
SELEPS30  CALL      RKPTECO1
          BRANCH    OVRCD,SELEPS50
.
          MATCH     ADMISSNO,DPTEOADM    * Check for Admission No
          GOTO      SELEPS50 IF NOT EQUAL
.
          MATCH     SP70,PTEOCODE
          IF        !@EQUAL
            MOVE      ONE,EPSSLIST[PTEOEPNO]
          ENDIF
          GOTO      SELEPS30
.
.
SELEPS50  MOVE      ZERO,F2
          REPEAT
            ADD       ONE,F2
            IF        EPSSLIST[F2] = 1
              MOVE      F2,KEY2
              IF        F2 = EPSCD001
                WRITE     HTMLFILE;"<option value=#"",KEY2,"#" selected>":
                                    KEY2,"</option>"
              ELSE
                WRITE     HTMLFILE;"<option value=#"",KEY2,"#">":
                                    KEY2,"</option>"
              ENDIF
            ENDIF
          UNTIL     F2 = 99
.
SELEPS99  RETURN
.------------------------------------------------------------
.                     DRG Details
.      0.Description, 1.Code, 2.Low Trim, 3.High Trim
.      INPUT PARAMETER : DDRGCODE - DRG Code 
.------------------------------------------------------------
DISDRG00  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
.
          MATCH     SP70,DDRGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"&nbsp;";
            GOTO      DISDRG99
          ENDIF
.
          MOVE      DDRGCODE,KEY4
          MOVE      "999",KEY3
          PACK      KEY7,KEY4,KEY3,SP10   * last DRG version          *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          BRANCH    OVRCD,DISDRG90
          MATCH     PTDWDRGC,KEY4           * same DRG code ?         *I-137125
          GOTO      DISDRG90 IF NOT EQUAL                             *I-137125
.
          BRANCH    F1,DISDRG10,DISDRG20,DISDRG30
          WRITE     HTMLFILE;PTDWDESC; * Description
          GOTO      DISDRG99
.
DISDRG10  WRITE     HTMLFILE;PTDWDRGC;  * Code
          GOTO      DISDRG99
.
DISDRG20  WRITE     HTMLFILE;PTDWLOWT;  * Low Trim
          GOTO      DISDRG99
.
DISDRG30  WRITE     HTMLFILE;PTDWHIGH;  * High Trim
          GOTO      DISDRG99
.
DISDRG90  IF        F1 = ZERO
            WRITE     HTMLFILE;"DRG description not found";
          ENDIF
          IF        F1 = ONE
            WRITE     HTMLFILE;"DRG code not found";
          ENDIF
          IF        F1 > ONE
            WRITE     HTMLFILE;"DRG weightings record not found";
          ENDIF    
          GOTO      DISDRG99
.
DISDRG99  RETURN
.
.-----------------------------------------------------------------
. Find the Current visit details when doing a patient search by ur
.-----------------------------------------------------------------
FNDCUR00  BRANCH    PCEASE,FNDCUR90
.
          PACK      KEY24,URNUMBER,Z70
          CALL      RDSVISA2
FNDCUR10  CALL      RDPVISA2
          BRANCH    OVRCD,FNDCUR90
.         
          MATCH     URNUMBER,PVIURNO
          GOTO      FNDCUR90 IF NOT EQUAL
.         
          BRANCH    PVITYPE,FNDCUR40,FNDCUR50,FNDCUR50
.
          GOTO      FNDCUR10
.
FNDCUR40  PACK      KEY8,PVIBILL,SP70
          CALL      RDEMVIS1
          BRANCH    OVRCD,FNDCUR10
.
          COMPARE   FOUR,EMVISTAT                * Cancelled visit
          GOTO      FNDCUR10 IF EQUAL
.
          MOVE      PVIBILL,ADMISSNO
          GOTO      FNDCUR99
.
FNDCUR50  MOVE      PVIBILL,ADMISSNO
          GOTO      FNDCUR99

FNDCUR90  MOVE      SP70,ADMISSNO
.
FNDCUR99  RETURN
+
.******************************************************************************
.*  Get NZ Procedure details if required                                      *
.******************************************************************************
GETNZP00  COMPARE   FIVE,CFEETYP            * NZ Private only
          GOTO      GETNZP90 IF NOT EQUAL
.
          CALL      CLNZSP00
          PACK      KEY11,ADMISSNO,SP70
          CALL      RSNZSPR1
GETNZP10  CALL      RKNZSPR1
          BRANCH    OVRCD,GETNZP90
.
          MATCH     ADMISSNO,NZSPADMN
          GOTO      GETNZP90 IF NOT EQUAL
.
          COMPARE   "1",NZSPPRIM
          GOTO      GETNZP10 IF NOT EQUAL
          GOTO      GETNZP999
.
GETNZP90  CALL      CLNZSP00
.
GETNZP99  RETURN
+
.**********************************************************************
.  Clear PDS DATA
.**********************************************************************
CLRPDS00  MOVE      SP70,MRPDSTAT
          RETURN
.         
.**********************************************************************
.  Clear ICU DATA   
.**********************************************************************
CLRICU00  MOVE      ZERO,PTICUINT
          MOVE      ZERO,PTICUMEC
          MOVE      ZERO,PTICUCCU
          MOVE      SP70,PTICAMBN
          MOVE      ZERO,PTICCPAP
          MOVE      ZERO,PTICHNCU
.
CLRICU99  RETURN
+
.******************************************************************************
MVPMAR00  PACK      PMVXVISN,ARVXVISN,SP70
          PACK      PMVXVSDT,ARVXVSDT,SP70
          PACK      PMVXDOCA,ARVXDOCA,SP70
          PACK      PMVXDOCT,ARVXDOCT,SP70
          PACK      PMVXCSNR,ARVXCSNR,SP70
          PACK      PMVXPOST,ARVXPOST,SP70
          PACK      PMVXPIND,ARVXPIND,SP70
          PACK      PMVXVLOC,ARVXVLOC,SP70
          PACK      PMVXCFSG,ARVXCFSG,SP70
          PACK      PMVXINGP,ARVXINGP,SP70
          PACK      PMVXCPTH,ARVXCPTH,SP70
          PACK      PMVXHCP1,ARVXHCP1,SP70
          PACK      PMVXHCP2,ARVXHCP2,SP70
          PACK      PMVXHCP3,ARVXHCP3,SP70
          PACK      PMVXHCP4,ARVXHCP4,SP70
          PACK      PMVXRHC1,ARVXRHC1,SP70
          PACK      PMVXRH1G,ARVXRH1G,SP70
          PACK      PMVXRH1C,ARVXRH1G,SP70
          PACK      PMVXRHC2,ARVXRHC2,SP70
          PACK      PMVXRH2G,ARVXRH2G,SP70
          PACK      PMVXRH2C,ARVXRH2C,SP70
          PACK      PMVXRHC3,ARVXRHC2,SP70
          PACK      PMVXRH3G,ARVXRH3G,SP70
          PACK      PMVXRH3C,ARVXRH3C,SP70
          PACK      PMVXRHC4,ARVXRHC4,SP70
          PACK      PMVXRH4G,ARVXRH4G,SP70
          PACK      PMVXRH4C,ARVXRH4C,SP70
          PACK      PMVXABRG,ARVXABRG,SP70
          PACK      PMVXCADM,ARVXCADM,SP70
          PACK      PMVXIRAD,ARVXIRAD,SP70
          PACK      PMVXIDUS,ARVXIDUS,SP70
          PACK      PMVXCRAV,ARVXCRAV,SP70
          PACK      PMVXRCCT,ARVXRCCT,SP70
          PACK      PMVXAPWD,ARVXAPWD,SP70
          PACK      PMVXAPBD,ARVXAPBD,SP70
          PACK      PMVXPOWD,ARVXPOWD,SP70
          PACK      PMVXPOBD,ARVXPOBD,SP70
          PACK      PMVXPSTY,ARVXPSTY,SP70
          PACK      PMVXVALW,ARVXVALW,SP70
          PACK      PMVXPALW,ARVXPALW,SP70
          PACK      PMVXINDC,ARVXINDC,SP70
          PACK      PMVXMDAV,ARVXMDAV,SP70
          PACK      PMVXFRMS,ARVXFRMS,SP70
          PACK      PMVXCSNG,ARVXCSNG,SP70
          MOVE      PMVXPWGT,ARVXPWGT
          MOVE      PMVXPHGT,ARVXPHGT
          PACK      PMVXDHWR,ARVXDHWR,SP70
          PACK      PMVXEDC1,ARVXEDC1,SP70
          PACK      PMVXEDC2,ARVXEDC2,SP70
          PACK      PMVXEDC3,ARVXEDC3,SP70
          PACK      PMVXHOME,ARVXHOME,SP70
          PACK      PMVXUDF1,ARVXUDF1,SP70
          PACK      PMVXUDF2,ARVXUDF2,SP70
          PACK      PMVXUDF3,ARVXUDF3,SP70
          PACK      PMVXUDF4,ARVXUDF4,SP70
          PACK      PMVXUDT1,ARVXUDT1,SP70
          PACK      PMVXUDT2,ARVXUDT2,SP70
          PACK      PMVXUDT3,ARVXUDT3,SP70
          PACK      PMVXUDT4,ARVXUDT4,SP70
          PACK      PMVXUDT5,ARVXUDT5,SP70
          PACK      PMVXUDT6,ARVXUDT6,SP70
          PACK      PMVXCDTE,ARVXCDTE,SP70
          PACK      PMVXCTIM,ARVXCTIM,SP70
          PACK      PMVXWEBC,ARVXWEBC,SP70
          PACK      PMVXLUPD,ARVXLUPD,SP70
          PACK      PMVXLUPT,ARVXLUPT,SP70
          PACK      PMVXWEBU,ARVXWEBU,SP70
          PACK      PMVXMHLS,ARVXMHLS,SP70
          PACK      PMVXPICD,ARVXPICD,SP70
          PACK      PMVXRMOR,ARVXRMOR,SP70
          PACK      PMVXASUT,ARVXASUT,SP70
          PACK      PMVXELPS,ARVXELPS,SP70
          PACK      PMVXEMPL,ARVXEMPL,SP70
          PACK      PMVXFINP,ARVXFINP,SP70
          PACK      PMVXOCCP,ARVXOCCP,SP70
          PACK      PMVXPALC,ARVXPALC,SP70
          PACK      PMVXPPAL,ARVXPPAL,SP70
          PACK      PMVXPPPT,ARVXPPPT,SP70
          PACK      PMVXPSOS,ARVXPSOS,SP70
          PACK      PMVXPYSP,ARVXPYSP,SP70
          PACK      PMVXQLDB,ARVXQLDB,SP70
          PACK      PMVXREAD,ARVXREAD,SP70
          PACK      PMVXUDIN,ARVXUDIN,SP70
          PACK      PMVXUREA,ARVXUREA,SP70
          PACK      PMVXUSAC,ARVXUSAC,SP70
          PACK      PMVXUVTH,ARVXUVTH,SP70
          PACK      PMVXINTR,ARVXINTR,SP70
          PACK      PMVXLNG1,ARVXLNG1,SP70
          PACK      PMVXASGC,ARVXASGC,SP70
          PACK      PMVXMHOS,ARVXMHOS,SP70
          PACK      PMVXDSPD,ARVXDSPD,SP70
          PACK      PMVXDSIF,ARVXDSIF,SP70
          PACK      PMVXPRMI,ARVXPRMI,SP70
          PACK      PMVXPRAI,ARVXPRAI,SP70
          PACK      PMVXPRES,ARVXPRES,SP70
          PACK      PMVXUITR,ARVXUITR,SP70
          PACK      PMVXRPOA,ARVXRPOA,SP70
          PACK      PMVXRCN1,ARVXRCN1,SP70
          PACK      PMVXRCN2,ARVXRCN2,SP70
          PACK      PMVXRHFU,ARVXRHFU,SP70
          PACK      PMVXRDVA,ARVXRDVA,SP70
          PACK      PMVXRSLO,ARVXRSLO,SP70
          PACK      PMVXMLOC,ARVXMLOC,SP70
          PACK      PMVXPACC,ARVXPACC,SP70
          PACK      PMVXEDU1,ARVXEDU1,SP70
          PACK      PMVXEDU2,ARVXEDU2,SP70
          PACK      PMVXEDU3,ARVXEDU3,SP70
          PACK      PMVXPRGM,ARVXPRGM,SP70
          PACK      PMVXCONF,ARVXCONF,SP70
          PACK      PMVXEOCL,ARVXEOCL,SP70
          PACK      PMVXSLOC,ARVXSLOC,SP70
          PACK      PMVXSCLI,ARVXSCLI,SP70
          PACK      PMVXSTRA,ARVXSTRA,SP70
          PACK      PMVXQASN,ARVXQASN,SP70
          PACK      PMVXATCP,ARVXATCP,SP70
          PACK      PMVXATIM,ARVXATIM,SP70
          PACK      PMVXITIM,ARVXITIM,SP70
          PACK      PMVXHFGN,ARVXHFGN,SP70
          PACK      PMVXHFSN,ARVXHFSN,SP70
          PACK      PMVXFUPI,ARVXFUPI,SP70
          PACK      PMVXPOEC,ARVXPOEC,SP70
          PACK      PMVXSPAR,ARVXSPAR,SP70
.
          RETURN
+
CLPATHSP  PACK      PTHSHOSP,SP70
          PACK      PTHSNAME,SP70
          PACK      PTHSADD1,SP70
          PACK      PTHSADD2,SP70
          PACK      PTHSADD3,SP70
          PACK      PTHSADD4,SP70
          PACK      PTHSPCOD,SP70
          PACK      PTHSTELE,SP70
          PACK      PTHSFAXN,SP70
          PACK      PTHSUNIT,SP70
          PACK      PTHSHDPC,SP70
          PACK      PTHSMRPR,SP70
          PACK      PTHSPACT,SP70
          PACK      PTHSHSNO,SP70
          PACK      PTHSPMBS,SP70
          PACK      PTHSTFEE,SP70
          PACK      PTHSHLOC,SP70
          PACK      PTHSRCTY,SP70
          PACK      PTHSVOLM,SP70
          PACK      PTHSSTAT,SP70
          PACK      PTHSDCLM,SP70
          PACK      PTHSAPPR,SP70
          PACK      PTHSUFMS,SP70
          PACK      PTHSABNN,SP70
          PACK      PTHSHSID,SP70
          PACK      PTHSHCEN,SP70
          PACK      PTHSPTIN,SP70
          PACK      PTHSSPID,SP70
          PACK      PTHSEDIP,SP70
          PACK      PTHSORID,SP70
.
          RETURN
+
.------------------------------------------------------------
. Output Eclipse OPV PVM Table Details
.------------------------------------------------------------
OVRTAB00  COMPARE   ONE,OVRFLAG
          GOTO      OVRTAB99 IF NOT EQUAL
.
          PACK      KEY26,URNUMBER,SP70
          CALL      RSPMOVR1
OVRTAB10  CALL      RKPMOVR1
          BRANCH    OVRCD,OVRTAB99
.           
          MATCH     URNUMBER,PMORURNO         * Match UR numbers
          GOTO      OVRTAB99 IF NOT EQUAL
.
          PACK      DISPDATE,SP70
          MATCH     SP70,PMORDATE
          IF        !@EQUAL
            UNPACK    PMORDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:displayOVR('",HTMLLINK
          APPEND    PMORURNO,HTMLLINK
          APPEND    PMORDATE,HTMLLINK
          APPEND    PMORTIME,HTMLLINK
          APPEND    DPMORCNT,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          PACK      SAVKEY26,PMORURNO,PMORDATE,PMORTIME,DPMORCNT,SP70
          MOVE      PMORTRID,SAVETRID
.
          PACK      KEY26,URNUMBER,Z70
          CALL      RSPMOVR1
          CALL      RPPMOVR1
          BRANCH    OVRCD,OVRTAB50 
.
          MATCH     URNUMBER,PMORURNO
          GOTO      OVRTAB50 IF NOT EQUAL
.
          MATCH     "0   ",PMORSTAT
          GOTO      OVRTAB30 IF EQUAL
.
          MATCH     "8005",PMORSTAT
          GOTO      OVRTAB30 IF EQUAL
.
          GOTO      OVRTAB50
.
OVRTAB30  MATCH     PMORTRID,SAVETRID
          GOTO      OVRTAB50 IF NOT EQUAL
.
          PACK      DIM40,PGNAME,SP70
          REP       UPPLOW,DIM40
          PACK      PMORFNAM,PMORFNAM,SP70
          MATCH     SP70,PMORFNAM
          GOTO      OVRTAB31 IF EQUAL
          REP       UPPLOW,PMORFNAM
          MATCH     DIM40,PMORFNAM
          GOTO      OVRTAB40 IF NOT EQUAL
.
OVRTAB31  PACK      PMEDI,PMEDI,SP70
          PACK      PMORMEDN,PMORMEDN,SP70
          MATCH     SP70,PMORMEDN
          GOTO      OVRTAB32 IF EQUAL
          MATCH     PMEDI,PMORMEDN
          GOTO      OVRTAB40 IF NOT EQUAL
.
OVRTAB32  PACK      PTMXMCCD,PTMXMCCD,SP70
          PACK      DIM2,PMORMEDR,SP70
          RJUSTIFY  DIM2
          MATCH     SP70,PMORMEDR
          GOTO      OVRTAB50 IF EQUAL
          MATCH     PTMXMCCD,DIM2
          GOTO      OVRTAB40 IF NOT EQUAL
.
          GOTO      OVRTAB50
.
OVRTAB40  MOVE      SAVKEY26,KEY26
          CALL      RDPMOVR1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                        "#"",PMORDATE,PMORTIME,"#",":
                        "#"",PMORSTAT,"#",":
                        "#"",PMOREROR,"#",":
                        "#"<font color=red>",PMORTRID,"</font>#",":
                        "#"",SP1,"#")"
.
          GOTO      OVRTAB10
.
OVRTAB50  MOVE      SAVKEY26,KEY26
          CALL      RDPMOVR1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                      "#"",PMORDATE,PMORTIME,"#",":
                                      "#"",PMORSTAT,"#",":
                                      "#"",PMOREROR,"#",":
                                      "#"",PMORTRID,"#",":
                                      "#"",SP1,"#")"
.
          GOTO      OVRTAB10
.
OVRTAB99  RETURN
+
.------------------------------------------------------------
. Output Eclipse OPV PVM Tag Details       Parameter: FORM1
.------------------------------------------------------------
PMSOVR00  COMPARE   ONE,OVRFLAG
          GOTO      PMSOVR99 IF NOT EQUAL
.
          PACK      KEY26,PMSOVRKY,SP70
          CALL      RDPMOVR1
          BRANCH    OVRCD,PMSOVR99
.
          BRANCH    FORM1,PMSOVR10,PMSOVR20,PMSOVR30,PMSOVR40,PMSOVR50:
                          PMSOVR60,PMSOVR70,PMSOVR80
.
          GOTO      PMSOVR99
.
PMSOVR10  PACK      DISPDATE,SP70
          MATCH     SP70,PMORDATE
          IF        !@EQUAL
            UNPACK    PMORDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PMSOVR99
.
PMSOVR20  WRITE     HTMLFILE;PMORTIME;
          GOTO      PMSOVR99
.
PMSOVR30  WRITE     HTMLFILE;PMORTRID;
          GOTO      PMSOVR99
.
PMSOVR40  WRITE     HTMLFILE;PMORFNAM;
          GOTO      PMSOVR99
.
PMSOVR50  WRITE     HTMLFILE;PMORMEDN;
          GOTO      PMSOVR99
.
PMSOVR60  WRITE     HTMLFILE;PMORMEDR;
          GOTO      PMSOVR99
.
PMSOVR70  WRITE     HTMLFILE;PMORSTAT;
          GOTO      PMSOVR99
.
PMSOVR80  WRITE     HTMLFILE;PMOREROR;
          GOTO      PMSOVR99
.
PMSOVR99  RETURN
.
.------------------------------------------------------------
. Output Eclipse OVV PVP/PVV Table Details
.------------------------------------------------------------
OVVTAB00  COMPARE   ONE,OVVFLAG
          GOTO      OVVTAB99 IF NOT EQUAL
.
          PACK      KEY26,URNUMBER,SP70
          CALL      RSPMOVV1
OVVTAB10  CALL      RKPMOVV1
          BRANCH    OVRCD,OVVTAB99
.
          MATCH     URNUMBER,PMOVURNO         * Match UR numbers
          GOTO      OVVTAB99 IF NOT EQUAL
.
          PACK      DISPDATE,SP70
          MATCH     SP70,PMOVDATE
          IF        !@EQUAL
            UNPACK    PMOVDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:displayOVV('",HTMLLINK
          APPEND    PMOVURNO,HTMLLINK
          APPEND    PMOVDATE,HTMLLINK
          APPEND    PMOVTIME,HTMLLINK
          APPEND    DPMOVCNT,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          PACK      SAVKEY26,PMOVURNO,PMOVDATE,PMOVTIME,DPMOVCNT,SP70
          MOVE      PMOVTRID,SAVETRID
.
          PACK      KEY26,URNUMBER,Z70
          CALL      RSPMOVV1
          CALL      RPPMOVV1
          BRANCH    OVRCD,OVVTAB50
.
          MATCH     URNUMBER,PMOVURNO
          GOTO      OVVTAB50 IF NOT EQUAL
.
          MATCH     "0   ",PMOVSTAT
          GOTO      OVVTAB30 IF EQUAL
.
          MATCH     "8005",PMOVSTAT
          GOTO      OVVTAB30 IF EQUAL
.
          GOTO      OVVTAB50
.
OVVTAB30  MATCH     PMOVTRID,SAVETRID
          GOTO      OVVTAB50 IF NOT EQUAL
.
          PACK      DIM40,PGNAME,SP70
          REP       UPPLOW,DIM40
          PACK      PMOVFNAM,PMOVFNAM,SP70
          MATCH     SP70,PMOVFNAM
          GOTO      OVVTAB31 IF EQUAL
          REP       UPPLOW,PMOVFNAM
          MATCH     DIM40,PMOVFNAM
          GOTO      OVVTAB40 IF NOT EQUAL
.
OVVTAB31  PACK      DIM40,PSNAME,SP70
          REP       UPPLOW,DIM40
          PACK      PMOVSNAM,PMOVSNAM,SP70
          MATCH     SP70,PMOVSNAM
          GOTO      OVVTAB32 IF EQUAL
          REP       UPPLOW,PMOVSNAM
          MATCH     DIM40,PMOVSNAM
          GOTO      OVVTAB40 IF NOT EQUAL
.
OVVTAB32  MOVE      THREE,DIM1              * Get DVA Card Number
          CALL      GCCARD00
.
          PACK      PMCDCNUM,PMCDCNUM,SP70
          PACK      DIM10,PMOVVETN,SP70
          LJUSTIFY  DIM10
          MATCH     SP70,PMOVVETN
          GOTO      OVVTAB50 IF EQUAL
          MATCH     PMCDCNUM,DIM10
          GOTO      OVVTAB40 IF NOT EQUAL
.
          GOTO      OVVTAB50
.
OVVTAB40  MOVE      SAVKEY26,KEY26
          CALL      RDPMOVV1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                        "#"",PMOVDATE,PMOVTIME,"#",":
                        "#"",PMOVSTAT,"#",":
                        "#"",PMOVEROR,"#",":
                        "#"<font color=red>",PMOVTRID,"</font>#",":
                        "#"",SP1,"#")"
.
          GOTO      OVVTAB10
.
OVVTAB50  MOVE      SAVKEY26,KEY26
          CALL      RDPMOVV1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                      "#"",PMOVDATE,PMOVTIME,"#",":
                                      "#"",PMOVSTAT,"#",":
                                      "#"",PMOVEROR,"#",":
                                      "#"",PMOVTRID,"#",":
                                      "#"",SP1,"#")"
.
          GOTO      OVVTAB10
.
OVVTAB99  RETURN
+
.------------------------------------------------------------
. Output Eclipse OVV Tag Details       Parameter: FORM1
.------------------------------------------------------------
PMSOVV00  COMPARE   ONE,OVVFLAG
          GOTO      PMSOVV99 IF NOT EQUAL
.
          PACK      KEY26,PMSOVVKY,SP70
          CALL      RDPMOVV1
          BRANCH    OVRCD,PMSOVV99
.
          BRANCH    FORM2,PMSOVV10,PMSOVV20,PMSOVV30,PMSOVV40,PMSOVV50:
                          PMSOVV60,PMSOVV70,PMSOVV80,PMSOVV90,PMSOVV91:
                          PMSOVV92
.
          GOTO      PMSOVV99
.
PMSOVV10  PACK      DISPDATE,SP70
          MATCH     SP70,PMOVDATE
          IF        !@EQUAL
            UNPACK    PMOVDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PMSOVV99
.
PMSOVV20  WRITE     HTMLFILE;PMOVTIME;
          GOTO      PMSOVV99
.
PMSOVV30  WRITE     HTMLFILE;PMOVTRID;
          GOTO      PMSOVV99
.
PMSOVV40  WRITE     HTMLFILE;PMOVSNAM;
          GOTO      PMSOVV99
.
PMSOVV50  WRITE     HTMLFILE;PMOVFNAM;
          GOTO      PMSOVV99
.
PMSOVV60  WRITE     HTMLFILE;PMOVVETN;
          GOTO      PMSOVV99
.
PMSOVV70  PACK      DISPDATE,SP70
          MATCH     SP70,PMOVPRDT
          IF        !@EQUAL
            UNPACK    PMOVPRDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PMSOVV99
.
PMSOVV80  WRITE     HTMLFILE;PMOVSTAT;
          GOTO      PMSOVV99
.
PMSOVV90  WRITE     HTMLFILE;PMOVEROR;
          GOTO      PMSOVV99
.
PMSOVV91  WRITE     HTMLFILE;PMOVVENC;
          GOTO      PMSOVV99
.
PMSOVV92  MOVE      "Unknown                                 ",DIM40
.
          MATCH     "PTEC",PMOVVENC
          IF        @EQUAL
            MOVE      "Gold Card                               ",DIM40
          ENDIF
.
          MATCH     "STEC",PMOVVENC
          IF        @EQUAL
            MOVE      "White Card                              ",DIM40
          ENDIF
.
          MATCH     "RPBC",PMOVVENC
          IF        @EQUAL
            MOVE      "Orange Card                             ",DIM40
          ENDIF
.
          MATCH     "PCC ",PMOVVENC
          IF        @EQUAL
            MOVE      "Pensioner Concession Card               ",DIM40
          ENDIF
.
          MATCH     "CSHC",PMOVVENC
          IF        @EQUAL
            MOVE      "Commonwealth Seniors Healthcare Card    ",DIM40
          ENDIF
.
          MATCH     "NIL ",PMOVVENC
          IF        @EQUAL
            MOVE      "Card type cannot be determined          ",DIM40
          ENDIF
.
          WRITE     HTMLFILE;DIM40;
          GOTO      PMSOVV99
.
PMSOVV99  RETURN
.
.------------------------------------------------------------
. WebServices IMCW Claim Full Details
.------------------------------------------------------------
WIMC0000  MATCH     "1",PTCNWSIN
          GOTO      WIMC9500 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      WIMC9500 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      WIMC5000 IF EQUAL
.
          MATCH     ANSC,UPDATTYP
          GOTO      WIMC6000 IF EQUAL
.
          GOTO      WIMC9000
.
WIMC5000  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,WIMC9100
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,WIMC9100
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          CALL      PATFLD00                * Use standard Patient Folder sub
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIMC2
          BRANCH    OVRCD,WIMC9200
.
          CALL      DFUL0000
.
          PACK      KEY71,WBIMHOSP,SP70          * Read B2B Device Table
          CALL      RSWBB2B3
          CALL      RKWBB2B3
          IF        OVRCD=1
            MOVE      SP70,WBB2DPTH
          ELSE
            MATCH     WBIMHOSP,WBB2HOSP
            IF        !@EQUAL
              MOVE      SP70,WBB2DPTH
            ENDIF
          ENDIF
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,WIMC9300
.
          PACK      KEY27,PRHDUNIQ,PRHRE001,PRHRE002,PRHRE003,SP70
          CALL      RDPRHR1
          BRANCH    OVRCD,WIMC9300
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,WIMC9400
.
WIMC5500  CLEAR     WEBTITLE
          MOVE      "WebServices IMCW Claim Full Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,WIMC9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      WIMC9999
.
WIMC6000  PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIMC2
          BRANCH    OVRCD,WIMC9200
.
          MOVE      TWENTY1,WBIMFLAG

          CALL      IBACLOCK
          PACK      WBIMUDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBIMUDAT
          MOVE      CTIMEIS,WBIMUTIM
          MOVE      USERID,WBIMUUID
          CALL      UPWBIMC2
.
.         Write a new history (webimaaf) record
.
          MOVE      WBIMINVN,WBIAINVN
          MOVE      WBIMBATN,WBIABATN
          MOVE      TWENTY1,WBIASTAT
          MOVE      " 5",WBIATYPE
          MOVE      WBSEUID,WBIAOPER
          MOVE      WBIMTRID,WBIATRID
          MOVE      WBIMMSID,WBIAMSID
          MOVE      SP70,WBIAEROR
          MOVE      SP70,WBIAEROT
          MOVE      SP70,WBIASPAR
.
          CALL      IBACLOCK                     * get current date/time
          PACK      WBIADATE,CCC,CYY,CMM,CDD
          REP       " 0",WBIADATE
          MOVE      CTIMEIS,WBIATIME
          REP       " 0",WBIATIME
.
          PACK      KEY26,WBIAINVN,WBIADATE,WBIATIME,WBIATYPE,SP70
          CALL      RAWBIMA1
          IF        OVRCD = 1
            CALL      WRWBIMA1
          ENDIF
.
          MOVE      SP70,TTYPEARG
          MOVE      " 9",TTYPEARG
          CALL      DELETR00
.
          MOVE      "10",TTYPEARG
          CALL      DELETR00
.
          MOVE      " 4",TTYPEARG
          CALL      DELETR00
.
          MOVE      " 5",TTYPEARG
          CALL      DELETR00
.
          CALL      DELECO00
.
          MOVE      ZERO,EXIT
          GOTO      WIMC9999
.
WIMC9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WIMC9999
.
WIMC9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WIMC9999
.
WIMC9200  MOVE      "Can't find WebServices IMCW Claim details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WIMC9999
.
WIMC9300  MOVE      "Doctor Referral details has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WIMC9999
.
WIMC9400  MOVE      "Can't Find Invoice Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WIMC9999
.
WIMC9500  MOVE      "Not using WebServices IMCW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WIMC9999
.
WIMC9999  RETURN
.
.*****************************************************************************
.*                          DFUL0000                                         *
.*****************************************************************************
.
DFUL0000  CALL      GBAL0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBIMFLAG,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19,STATUS20:
                                      STATUS21
.
DFUL9999  RETURN
+
.*****************************************************************************
.*                          GBAL0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on webimcaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBAL0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBIMINVN,KEY8
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      GBAL9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PRINGSTJ,FORM7P2O
          ENDIF
.
GBAL9999  RETURN
+
.*****************************************************************************
.*                          DFUP0000                                         *
.*****************************************************************************
.
DFUP0000  CALL      GBAP0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19
.
DFUP9999  RETURN
+
.*****************************************************************************
.*                          GBAP0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on priectaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBAP0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      EMECINVN,KEY8
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      GBAP9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PRINGSTJ,FORM7P2O
          ENDIF
.
GBAP9999  RETURN
+
.------------------------------------------------------------------------------
. Close webecoaf records
.------------------------------------------------------------------------------
DELECO00  PACK      KEY31,WBIMHFND,ZERO,WBIMTRID,SP70
          CALL      RDWBECO1
          BRANCH    OVRCD,DELECO99
.
.         We should only have one record with flag either 'Open' or 'Closed'
.
          PACK      SKEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
.
          MOVE      ONE,WBEODFLG
          PACK      KEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
          CALL      RAWBECO1
          IF        OVRCD=1
            MOVE      SKEY31,KEY31
            CALL      RDWBECO1                     * reposition
            IF        OVRCD=0
              MOVE      ONE,WBEODFLG
              CALL      UPWBECO1                   * update record
            ENDIF
          ELSE
            MOVE      "0",WBEODFLG                 * set to Open
            PACK      KEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
            CALL      DEWBECO1
          ENDIF
.
DELECO99  RETURN
.
.------------------------------------------------------------------------------
. Close pmsetraf records
.------------------------------------------------------------------------------
DELETR00  PACK      KEY51,SP1,TTYPEARG,SP70
          CALL      RSWBETR1
DELETR10  CALL      RKWBETR1
          BRANCH    OVRCD,DELETR99
.
          MATCH     SP70,WBETSTAT
          GOTO      DELETR99 IF NOT EQUAL
.
          MATCH     TTYPEARG,WBETTYPE
          GOTO      DELETR99 IF NOT EQUAL
.
          MATCH     WBIMTRID,WBETTRID
          GOTO      DELETR10 IF NOT EQUAL
.
          MOVE      "1",WBETSTAT
.
          CALL      IBACLOCK
          PACK      WBETUDTE,CCC,CYY,CMM,CDD
          REP       " 0",WBETUDTE
          MOVE      CTIMEIS,WBETUTIM
          MOVE      USERID,WBETUUID

          CALL       UPWBETR1
.
DELETR99  RETURN
.
.------------------------------------------------------------
. Eclipse IMC Claim Full Details tags
.------------------------------------------------------------
ECFL0000  BRANCH    FLDITMNO,ECFL0100,ECFL0200,ECFL0300,ECFL0400,ECFL0500:
                             ECFL0600,ECFL0700,ECFL0800,ECFL0900,ECFL1000:
                             ECFL1100,ECFL1200,ECFL1300,ECFL1400,ECFL1500:
                             ECFL1600,ECFL1700,ECFL1800,ECFL1900,ECFL2000:
                             ECFL2100,ECFL2200,ECFL2300,ECFL2400,ECFL2500:
                             ECFL2600,ECFL2700,ECFL2800,ECFL2900,ECFL3000:
                             ECFL3100,ECFL3200,ECFL3300,ECFL3400,ECFL3500:
                             ECFL3600,ECFL3700,ECFL3800,ECFL3900,ECFL4000:
                             ECFL4100,ECFL4200,ECFL4300,ECFL4400,ECFL4500:
                             ECFL4600,ECFL4700,ECFL4800,ECFL4900,ECFL5000:
                             ECFL5100,ECFL5200
.
          GOTO      ECFL9999
.
ECFL0100  WRITE     HTMLFILE;FORM7P2O;
          GOTO      ECFL9999
.
ECFL0200  WRITE     HTMLFILE;STATDESC;
          GOTO      ECFL9999
.
ECFL0300  
.         WRITE     HTMLFILE;CONTDESC;
          GOTO      ECFL9999
.
ECFL0400  MATCH     SP70,WBIMPDAT
          GOTO      ECFL9999 IF EQUAL
          UNPACK    WBIMPDAT,CCENT,CYEAR,CMON,CDAY  * Payment Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ECFL9999
.
ECFL0500  WRITE     HTMLFILE;WBIMEETP;
          GOTO      ECFL9999
.
ECFL0600  MATCH     "2",WBIMEETP
          IF        @EQUAL
            WRITE     HTMLFILE;"Medicare Only";
          ELSE
            PACK      KEY14,WBIMHFND,ZERO,ZERO,ZERO,ZERO,SP70
            CALL      RDFUND1
            IF        OVRCD=0
              WRITE     HTMLFILE;HFNAME;
            ENDIF
          ENDIF
          GOTO      ECFL9999
.
ECFL0700  WRITE     HTMLFILE;WBIMINVN;
          GOTO      ECFL9999
.
ECFL0800  WRITE     HTMLFILE;WBIMBATN;
          GOTO      ECFL9999
.
ECFL0900  WRITE     HTMLFILE;WBIMPBAT;
          GOTO      ECFL9999
.
ECFL1000  WRITE     HTMLFILE;WBIMNBAT;
          GOTO      ECFL9999
.
ECFL1100  WRITE     HTMLFILE;WBIMTRID;
          GOTO      ECFL9999
.
ECFL1200  WRITE     HTMLFILE;WBIMFTID;
          GOTO      ECFL9999
.
ECFL1300  WRITE     HTMLFILE;WBIMAMTC;
          GOTO      ECFL9999
.
ECFL1400  WRITE     HTMLFILE;PRINITOT;
          GOTO      ECFL9999
.
ECFL1500  WRITE     HTMLFILE;PRINPAMT;
          GOTO      ECFL9999
.
ECFL1600  WRITE     HTMLFILE;PRINHAMT;
          GOTO      ECFL9999
.
ECFL1700  WRITE     HTMLFILE;PRINOTHA;
          GOTO      ECFL9999
.
ECFL1800  WRITE     HTMLFILE;PRINJAMT;
          GOTO      ECFL9999
.
ECFL1900  WRITE     HTMLFILE;WBIMAMFP;
          GOTO      ECFL9999
.
ECFL2000  MATCH     SP70,WBIMSTAT                * blank status ?
          GOTO      ECFL9999 IF EQUAL            * yes - don't display anything
          GOTO      ECFL9999 IF EOS
.
          MATCH     " 0",WBIMSTAT                * closed without pymt or w/o
          IF        @EQUAL
            WRITE     HTMLFILE;"No Payment or Write-Off";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     " 1",WBIMSTAT                * closed with write-off only
          IF        @EQUAL
            WRITE     HTMLFILE;"Write-Off Only";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     " 2",WBIMSTAT                * closed with payment only
          IF        @EQUAL
            WRITE     HTMLFILE;"Payment Only";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     " 3",WBIMSTAT                * closed with payment & w/o
          IF        @EQUAL
            WRITE     HTMLFILE;"Payment & Write-Off";
            GOTO      ECFL9999
          ENDIF
.
          GOTO      ECFL9999
.
ECFL2100  CALL      EDIH0000
          GOTO      ECFL9999
.
ECFL2200  CALL      EDIP0000
          GOTO      ECFL9999
.
ECFL2300  CALL      EDME0000
          GOTO      ECFL9999
.
ECFL2400  CALL      EDMS0000
          GOTO      ECFL9999
.
ECFL2500  CALL      EDHE0000
          GOTO      ECFL9999
.
ECFL2600  WRITE     HTMLFILE;PRINCNTT;
          GOTO      ECFL9999
.
ECFL2700  
.         WRITE     HTMLFILE;CFEETYP;
          GOTO      ECFL9999
.
ECFL2800  WRITE     HTMLFILE;WBIMAMMP;
          GOTO      ECFL9999
.
ECFL2900  MOVE      "CL",CATEGORY         * claim code
          MOVE      PRHDCLAM,CODE
          CALL      CODITM00
          GOTO      ECFL9999
.
ECFL3000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ECFL3010
.
          WRITE     HTMLFILE;PRHDHFND;
.
          GOTO      ECFL9999
.
ECFL3010  MATCH     SP70,PRHDHFND
          GOTO      ECFL9999 IF EQUAL
          GOTO      ECFL9999 IF EOS
.
          PACK      KEY14,PRHDHFND,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,ECFL9999
.
          WRITE     HTMLFILE;HFNAME;
.
          GOTO      ECFL9999
.
ECFL3100  WRITE     HTMLFILE;UNIQNUMB;
          GOTO      ECFL9999
.
ECFL3200  WRITE     HTMLFILE;PRHRE001;
          GOTO      ECFL9999
.
ECFL3300  WRITE     HTMLFILE;PRHRE002;
          GOTO      ECFL9999
.
ECFL3400  WRITE     HTMLFILE;PRHRE003;
          GOTO      ECFL9999
.
ECFL3500  PACK      KEY22,WBIMUNIQ,WBIMINVN,SP70
          CALL      RSPRDT1
ECFL3510  CALL      RKPRDT1
          BRANCH    OVRCD,ECFL9999
.
          MATCH     WBIMUNIQ,DPRDTUNQ
          GOTO      ECFL9999 IF NOT EQUAL
.
          MATCH     WBIMINVN,PRDTINVN
          GOTO      ECFL9999 IF NOT EQUAL
.
          COMPARE   TWO,PRDTIFLG
          GOTO      ECFL3510 IF NOT EQUAL
.
          WRITE     HTMLFILE;PRDTLVIS;
          GOTO      ECFL9999
.
ECFL3600  CALL      EDHS0000
          GOTO      ECFL9999
.
ECFL3700  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECFL9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFL9999
.
ECFL3800  CALL      RTVHED00
          GOTO      ECFL9999
.
ECFL3900  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECFL9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTVWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFL9999
.
ECFL4000  CALL      RTVJSN00
          GOTO      ECFL9999
.
ECFL4100  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECFL9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTVRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFL9999
.
ECFL4200  CALL      RTVRSP00
          GOTO      ECFL9999
.
ECFL4300  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECFL9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTVELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFL9999
.
ECFL4400  CALL      RTVERR00
          GOTO      ECFL9999
.
ECFL4500  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     SP70,WBIMTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECFL9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBIMTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFL9999
.
ECFL4600  CALL      IMCHED00
          GOTO      ECFL9999
.
ECFL4700  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     SP70,WBIMTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECFL9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBIMTRID,CMDLINE
          APPEND    IMCWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFL9999
.
ECFL4800  CALL      IMCJSN00
          GOTO      ECFL9999
.
ECFL4900  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     SP70,WBIMTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECFL9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBIMTRID,CMDLINE
          APPEND    IMCRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFL9999
.
ECFL5000  CALL      IMCRSP00
          GOTO      ECFL9999
.
ECFL5100  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFL9999
          ENDIF
.
          MATCH     SP70,WBIMTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECFL9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBIMTRID,CMDLINE
          APPEND    IMCELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFL9999
.
ECFL5200  CALL      IMCERR00
          GOTO      ECFL9999
.
ECFL9999  RETURN
+
.------------------------------------------------------------
. Table of EDI History
.------------------------------------------------------------
EDIH0000  MATCH     "1",PTCNWSIN 
          GOTO      EDIH9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      EDIH9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          CALL      EDIHD000      * Output Table Heading
.
          PACK      KEY34,MAVINVCE,Z70
          CALL      RSWBIMA3
EDIH1000  CALL      RPWBIMA3
          BRANCH    OVRCD,EDIH9999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"<!-- ",LOOPCNTR," -->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     MAVINVCE,WBIAINVN
          GOTO      EDIH9999 IF NOT EQUAL
.
          CALL      EDIRW000
.
          GOTO      EDIH1000
.
EDIH9999  RETURN
.------------------------------------------------------------
. EDI History (TABLE HEADING)
.------------------------------------------------------------
EDIHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Time</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Status</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Transaction Type</td>":
                             "<td class=HeadingCell width=10%>":
                             "Batch</td>":
                             "<td class=HeadingCell width=10%>":
                             "Reviewed By</td>":
                             "<td class=HeadingCell width=35%>":
                             "Error Code Description</td>":
                             "</tr>"
.
EDIHD999  RETURN
.------------------------------------------------------------
. EDI History (Detail Row)
.------------------------------------------------------------
EDIRW000  MOVE      SP70,DIM11
          MATCH     SP70,WBIADATE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIADATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBIASTAT,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19,STATUS20:
                                      STATUS21
.
          MOVE      SP30,TYPEDESC
          MOVE      WBIATYPE,TYPOFREQ
          LOAD      TYPEDESC,TYPOFREQ,TYPEDES1,TYPEDES2,TYPEDES3,TYPEDES4:
                                      TYPEDES5,TYPEDES6,TYPEDES7
          IF        TYPOFREQ = 6 | TYPOFREQ = 7
            STRIP     TYPEDESC
            ENDSET    TYPEDESC
            APPEND    SP1,TYPEDESC
            APPEND    WBIAEROR,TYPEDESC
            APPEND    SP20,TYPEDESC
            RESET     TYPEDESC
          ENDIF
.
          MOVE      SP70,DIM30
          PACK      KEY10,WBIAOPER,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      WBIAOPER,DIM30
          ELSE
            MATCH     WBIAOPER,WBSEUID
            IF        @EQUAL
              MOVE      WBSENAM,DIM30
            ELSE
              MOVE      WBIAOPER,DIM30
            ENDIF
          ENDIF
.
          CMATCH    NULL,WBIAEROT
          IF        @EQUAL
            PACK      WBIAEROT,SP70,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",DIM11 ,"</td>";
          WRITE     HTMLFILE;"<td>",WBIATIME,"</td>";
          WRITE     HTMLFILE;"<td>",STATDESC,"</td>":
                             "<td>",TYPEDESC,"</td>":
                             "<td>",WBIABATN,"</td>":
                             "<td>",DIM30,"</td>":
                             "<td>",WBIAEROT,"</td>":
                             "</tr>";
.
EDIRW999  RETURN
.
.------------------------------------------------------------
. WebServices IMCW Claim Enquiries
.------------------------------------------------------------
WMCE0000  MATCH     "1",PTCNWSIN
          GOTO      WMCE9200 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      WMCE9200 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      WMCE6000 IF EQUAL

          MATCH     "V",UPDATTYP
          GOTO      WMCE1000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      WMCE2000 IF EQUAL
.
          MATCH     "D",UPDATTYP
          GOTO      WMCE3000 IF EQUAL
.
          MATCH     "P",UPDATTYP
          GOTO      WMCE4000 IF EQUAL
.
          MATCH     "S",UPDATTYP
          GOTO      WMCE5000 IF EQUAL
.
          GOTO      WMCE9000
.
WMCE1000  CALL      MINV0000
          GOTO      WMCE9999
.
WMCE2000  CALL      RSUB0000
          GOTO      WMCE9999
.
WMCE3000  CALL      WDEL0000
          GOTO      WMCE9999
.
WMCE4000  CALL      OTPC0000
          GOTO      WMCE9999
.
WMCE5000  CALL      RSET0000
          GOTO      WMCE9999
.
WMCE6000  MOVE      TEMPLATE,FORM3
          IF        THREE=FORM3
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,WMCE9100
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDPMPX21
            BRANCH    OVRCD,WMCE9100
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE                   * CALCAGE uses PBDATE
.
            CALL      PATLN000
            CALL      PATFLD00                * Use standard Patient Folder sub
.
            MOVE      URNUMBER,FILTURNO
.           MOVE      UNIQNUMB,FILTADMN
.
            IF        ALLHFLAG=0
              COMPARE   ONE,IBCNMHOS
              IF        @EQUAL
                MOVE      TWO,VIEWTYPE
                MOVE      ZERO,EXDTBLNK
              ELSE
                MOVE      ZERO,VIEWTYPE
                MOVE      ONE,EXDTBLNK
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
.
          MATCH     "4",TEMPLATE
          IF        @EQUAL
            MOVE      "WebServices IMCW Outstanding Assessment Reports Enquiry",WEBTITLE
          ELSE 
            MOVE      "WebServices IMCW Claim Enquiry",WEBTITLE
          ENDIF
.
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,WMCE9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      WMCE9999
.
WMCE9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WMCE9999
.
WMCE9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WMCE9999
.
WMCE9200  MOVE      "Not using Eclipse IMC Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WMCE9999
.
WMCE9999  RETURN
.*****************************************************************************
.*                          MINV0000                                         *
.*****************************************************************************
.
.         First, get the last EDI History record for this invoice
.
MINV0000  PACK      KEY26,MAVINVCE,Z70
          CALL      RSWBIMA1                     * position on last history rec
          CALL      RPWBIMA1                     * read previous record
          BRANCH    OVRCD,MINV3000               * eof - finished
.
          MATCH     MAVINVCE,WBIAINVN            * same invoice still ?
          GOTO      MINV3000 IF NOT EQUAL        * no - finished
.
.         Read priectaf
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIMC2
          BRANCH    OVRCD,MINV3000
.
.         The last EDI history record has been found for the invoice, so
.         write a new record, defaulting some of the values from the read
.         record.
.
          MOVE      MAVBATCH,WBIABATN
          MOVE      MAVINVCE,WBIAINVN
.
MINV1000  CALL      IBACLOCK                     * get current date/time
          PACK      WBIADATE,CCC,CYY,CMM,CDD
          REP       " 0",WBIADATE
          MOVE      CTIMEIS,WBIATIME
          REP       " 0",WBIATIME
.
          MOVE      " 5",WBIATYPE
          MOVE      WBSEUID,WBIAOPER
          MOVE      SP70,WBIASPAR
.
          PACK      KEY26,WBIAINVN,WBIADATE,WBIATIME,WBIATYPE,SP70
          CALL      RAWBIMA1
          IF        OVRCD = 0
            GOTO      MINV1000
          ENDIF
.
          CALL      WRWBIMA1                     * write EDI History record
.
.         If the record has a status of "Medicare Unverified", 
.         "Health Fund Unverified",
.         "Error (SA validation)" or "Health Fund Rejected - Reported"
.         then update the status to "Closed", as the claim cannot go any
.         further (unless resubmitted after closing).
.
          IF        WBIMFLAG = 3 | WBIMFLAG = 6 | WBIMFLAG = 8  | WBIMFLAG = 17 | WBIMFLAG = 18
            PACK      KEY35,WBIMHOSP,WBIMFLAG,WBIMHFND,WBIMUNIQ,WBIMINVN:
                            WBIMBATN,SP70
            CALL      RDWBIMC1                   * read selected record
            BRANCH    OVRCD,MINV3000             * shouldn't happen
.
            MOVE      TWENTY1,WBIMFLAG              * update to "closed"
            CALL      IBACLOCK
            PACK      WBIMUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBIMUDAT
            MOVE      CTIMEIS,WBIMUTIM
            MOVE      USERID,WBIMUUID
            CALL      UPWBIMC1
.
.           Also write an EDI History record (webimaaf) for the close
.
            MOVE      WBIMINVN,WBIAINVN
            MOVE      WBIMBATN,WBIABATN
            MOVE      TWENTY1,WBIASTAT
            MOVE      " 5",WBIATYPE
            MOVE      WBSEUID,WBIAOPER
            MOVE      WBIMTRID,WBIATRID
            MOVE      WBIMMSID,WBIAMSID
            MOVE      SP30,WBIASPAR
.
MINV2000    CALL      IBACLOCK                   * get current time
            PACK      WBIADATE,CCC,CYY,CMM,CDD
            REP       " 0",WBIADATE
            MOVE      CTIMEIS,WBIATIME
            REP       " 0",WBIATIME
.
            PACK      KEY26,WBIAINVN,WBIADATE,WBIATIME,WBIATYPE,SP70
            CALL      RAWBIMA1
            IF        OVRCD = 1
              CALL      WRWBIMA1
            ELSE
              GOTO      MINV2000
            ENDIF
.
            GOTO      MINV9000
          ELSE
            GOTO      MINV9000
          ENDIF
.
MINV3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      MINV9100
.
MINV9000  MOVE      ZERO,EXIT
          GOTO      MINV9999
.
MINV9100  MOVE      ONE,EXIT
.
MINV9999  RETURN
+
.*****************************************************************************
.*                               RSUB0000                                    *
.*                  Process resubmission selection                           *
.*****************************************************************************
RSUB0000  MOVE      ZERO,EXIT
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIMC2
          BRANCH    OVRCD,RSUB7000
.
.         Check if the record has already been resubmitted
.
          MATCH     SP8,WBIMNBAT                 * next batch blank ?
          IF        !@EQUAL
            GOTO      RSUB8000
          ENDIF
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
.         IF        WBIMFLAG <> 19 & WBIMFLAG <> 3
.           GOTO      RSUB7000
.         ENDIF
.
          IF        WBIMFLAG = 21 | WBIMFLAG = 3
.
            PACK      KEY26,WBIMINVN,Z70
            CALL      RSWBIMA1
RSUB2100    CALL      RPWBIMA1
            BRANCH    OVRCD,RSUB2500
.
            MATCH     WBIMINVN,WBIAINVN
            GOTO      RSUB2500 IF NOT EQUAL
.
            MATCH     WBIMTRID,WBIATRID
            GOTO      RSUB2100 IF NOT EQUAL
.
            COMPARE   THREE,WBIASTAT
            GOTO      RSUB2100 IF NOT EQUAL
.
            MATCH     " 6",WBIATYPE
            GOTO      RSUB2100 IF NOT EQUAL
.
            MATCH     "3002",WBIAEROR
            GOTO      RSUB2100 IF NOT EQUAL
.
            MOVE      ZERO,FORM8A
.
            CALL      IBACLOCK
.
            PACK      CURRDATE,CCC,CYY,CMM,CDD
            REP       " 0",CURRDATE
.
            DAYSEP    WBIADATE,CURRDATE,FORM8A
.
            COMPARE   FORM8A,ONE
            GOTO      RSUB2500 IF EQUAL
            GOTO      RSUB2500 IF LESS
.
            GOTO      RSUB7500
.
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RSUB2500  PACK      KEY8,WBIMINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      RSUB6000
          ENDIF
.
          CALL      GBAL0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission (CAR 181439)
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSUB5000
          ENDIF
.
          PACK      KEY16,WBIMINVN,SP8
          CALL      RAWBIMC2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSUB4000
          ENDIF
.
          MOVE      ZERO,WBIMFLAG
          MOVE      SP70,WBIMBATN
          MOVE      MAVBATCH,WBIMPBAT
          MOVE      SP70,WBIMNBAT
          MOVE      SP70,WBIMTRID
          MOVE      ZERO,WBIMAMTC
          MOVE      ZERO,WBIMAMFP
          MOVE      ZERO,WBIMAMMP
          MOVE      SP70,WBIMPDAT
          MOVE      SP70,WBIMSTAT
          MOVE      SP70,WBIMFTID
          MOVE      PRINPRAC,WBIMPRAC
          MOVE      SP70,WBIMMSID
          MOVE      SP70,WBIMCTYP
          MOVE      SP70,WBIMSPAR
.
          PACK      KEY16,WBIMINVN,WBIMBATN,SP70
          CALL      RAWBIMC2
          IF        OVRCD = 1
.
            CALL      IBACLOCK
            PACK      WBIMCDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBIMCDAT
            MOVE      CTIMEIS,WBIMCTIM

            MATCH     SP70,USERID
            IF        !@EQUAL
              MOVE      USERID,WBIMCUID
            ELSE
              MOVE      WBSEUID,WBIMCUID
            ENDIF

            CALL      WRWBIMC1                   * write record
          ELSE
            GOTO      RSUB4000
          ENDIF
.
          PACK      KEY16,WBIMINVN,MAVBATCH,SP70
          CALL      RDWBIMC2
          IF        OVRCD = 1
            CALL      RSUB3000                   * write record
          ELSE
            MOVE      TWENTY1,WBIMFLAG            * set status to closed
          ENDIF
.
          MOVE      "00000000",WBIMNBAT
          CALL      IBACLOCK
          PACK      WBIMUDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBIMUDAT
          MOVE      CTIMEIS,WBIMUTIM
          MOVE      USERID,WBIMUUID
          CALL      UPWBIMC2
.
          GOTO      RSUB9999
.
RSUB3000  CLEAR     WEBTITLE
          APPEND    "Error updating Invoice ",WEBTITLE
          APPEND    WBIMINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    WBIMBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB4000  MOVE      "Invoice already waiting for extraction.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB5000  MOVE      "Claim fully paid.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB6000  CLEAR     WEBTITLE
          APPEND    "Invoice ",WEBTITLE
          APPEND    WBIMINVN,WEBTITLE
          APPEND    " not found.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB7000  MOVE      "Claim not not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB7500  MOVE      "Error 3002. Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB8000  MOVE      "Invoice already resubmitted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUB9000
.
RSUB9000  MOVE      ONE,EXIT
RSUB9999  RETURN
+
.*****************************************************************************
.*                               WDEL0000                                    *
.*                  Process delete records waiting                           *
.*****************************************************************************
WDEL0000  MOVE      ZERO,EXIT
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIMC2
          BRANCH    OVRCD,WDEL8000
.
          MOVE      WBIMINVN,TEMPINVN
          MOVE      WBIMBATN,TEMPBATN
          MOVE      WBIMUNIQ,TEMPADMN
          MOVE      WBIMURNO,TEMPURNO
          MOVE      WBIMHFND,TEMPHFND
          MOVE      WBIMPBAT,TEMPPBAT
          MOVE      WBIMHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      WDEL1000 IF EQUAL
          GOTO      WDEL1000 IF EOS
.
          PACK      KEY35,TEMPHOSP,TWENTY1,TEMPHFND,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDWBIMC1
          IF        OVRCD = 1
            GOTO      WDEL7000
          ELSE
            MOVE      SP70,WBIMNBAT
            CALL      IBACLOCK
            PACK      WBIMUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBIMUDAT
            MOVE      CTIMEIS,WBIMUTIM
            MOVE      USERID,WBIMUUID
            CALL      UPWBIMC1
          ENDIF
.
.         Delete the selected record
.
WDEL1000  PACK      KEY35,TEMPHOSP,SP1,ZERO,TEMPHFND,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEWBIMC1
.
          GOTO      WDEL9999
.
WDEL7000  CLEAR     WEBTITLE
          APPEND    "Error updating previous claim ",WEBTITLE
          APPEND    WBIMINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    WBIMBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      WDEL9000
.
WDEL8000  MOVE      "Record cannot be deleted.",WEBTITLE
          CALL      WEBERR00
          GOTO      WDEL9000
.
WDEL9000  MOVE      ONE,EXIT
WDEL9999  RETURN
+
.*****************************************************************************
.*                          RSET0000                                         *
.*****************************************************************************
.
.         First, get the last EDI History record for this invoice
.
RSET0000  PACK      KEY26,MAVINVCE,Z70
          CALL      RSWBIMA1                     * position on last history rec
          CALL      RPWBIMA1                     * read previous record
          BRANCH    OVRCD,RSET3000               * eof - finished
.
          MATCH     MAVINVCE,WBIAINVN            * same invoice still ?
          GOTO      RSET3000 IF NOT EQUAL        * no - finished
.
.         Read webimcaf
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIMC2
          BRANCH    OVRCD,RSET3000
.
.         If the record has a status of "Health Fund Unverified", "Medicare 
.         Unverified", then allow the status to be set to "Health Fund 
.         Verified", "Medicare Verified" so it can be processed.
.         If the record has a status of "Health Fund Assessing" or "Medicare
.         Assessing", then allow the status to be set to "Closed".
.
          IF        WBIMFLAG = 6 | WBIMFLAG = 8 | WBIMFLAG = 10 | WBIMFLAG = 11
            PACK      KEY35,WBIMHOSP,WBIMFLAG,WBIMHFND,WBIMUNIQ,WBIMINVN:
                            WBIMBATN,SP70
            CALL      RDWBIMC1                   * read selected record
            BRANCH    OVRCD,RSET3000             * shouldn't happen
.
            IF        WBIMFLAG = 6
              MOVE      SEVEN,WBIMFLAG           * reset to "Medicare Verified"
            ENDIF
.
            IF        WBIMFLAG = 8
              MOVE      NINE,WBIMFLAG         * reset to "Health Fund Verified"
            ENDIF
.
            IF        WBIMFLAG = 10
              MOVE      TWENTY1,WBIMFLAG          * reset to "Closed"
            ENDIF
.
            IF        WBIMFLAG = 11
              MOVE      TWENTY1,WBIMFLAG          * reset to "Closed"
            ENDIF
.
            CALL      IBACLOCK
            PACK      WBIMUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBIMUDAT
            MOVE      CTIMEIS,WBIMUTIM
            MOVE      USERID,WBIMUUID
            CALL      UPWBIMC1
.
.           Also write an EDI History record (webimaaf) for the reset
.
            MOVE      WBIMINVN,WBIAINVN
            MOVE      WBIMBATN,WBIABATN
            IF        WBIMFLAG = 7
              MOVE      SEVEN,WBIASTAT
            ENDIF
.
            IF        WBIMFLAG = 9
              MOVE      NINE,WBIASTAT
            ENDIF
.
            IF        WBIMFLAG = 21
              MOVE      TWENTY1,WBIMSTAT
            ENDIF
.
            MOVE      " 0",WBIATYPE
            MOVE      WBSEUID,WBIAOPER
            MOVE      WBIMTRID,WBIATRID
            MOVE      SP70,WBIAEROR
            IF        WBIMFLAG = 7 | WBIMFLAG = 9
              MOVE      "Claim reset manually",WBIAEROT
            ELSE
              MOVE      "Claim closed manually",WBIAEROT
            ENDIF
            MOVE      WBIMMSID,WBIAMSID
            MOVE      SP70,WBIASPAR
.
RSET2000    CALL      IBACLOCK                   * get current time
            PACK      WBIADATE,CCC,CYY,CMM,CDD
            REP       " 0",WBIADATE
            MOVE      CTIMEIS,WBIATIME
            REP       " 0",WBIATIME
.
            PACK      KEY26,WBIAINVN,WBIADATE,WBIATIME,WBIATYPE,SP70
            CALL      RAWBIMA1
            IF        OVRCD = 1
              CALL      WRWBIMA1
            ELSE
              GOTO      RSET2000
            ENDIF
.
            GOTO      RSET9000
          ELSE
            GOTO      RSET9000
          ENDIF
.
RSET3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSET9100
.
RSET9000  MOVE      ZERO,EXIT
          GOTO      RSET9999
.
RSET9100  MOVE      ONE,EXIT
.
RSET9999  RETURN
+
.*****************************************************************************
.*                               OTPC0000                                    *
.*                  Process delete outstanding processing reports            *
.*****************************************************************************
OTPC0000  MOVE      ZERO,EXIT
.
          PACK      KEY31,ECOTFUND,ECOTTYPE,ECOTTRID,SP70
          CALL      RDWBECO1
          BRANCH    OVRCD,OTPC8000
.
          PACK      KEY16,WBEOINVN,WBEOBATN,SP70
          CALL      RDWBIMC2
          BRANCH    OVRCD,OTPC7000
.
.         MATCH     WBEOTRID,WBIMTRID            * same transaction id still ?
.         GOTO      OTPC7000 IF NOT EQUAL        * no
.
          CALL      CLOS0000
.
          GOTO      OTPC9999
.
OTPC7000  MOVE      "Unable to locate claim record.  ",WEBTITLE
          CALL      WEBERR00
          GOTO      OTPC9000
.
OTPC8000  MOVE      "Unable to locate record to close.  ",WEBTITLE
          CALL      WEBERR00
          GOTO      OTPC9000
.
OTPC9000  MOVE      ONE,EXIT
OTPC9999  RETURN
.
.*****************************************************************************
.*                              CLOS0000           Called by: DOUT0000       *
.*             Close a claim that is still waiting for an outstanding        *
.*             report and for which a remittance report has been received.   *
.*****************************************************************************
.
.         Update the outstanding processing report (webecoaf) record
.
CLOS0000  PACK      SKEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
.
.         We should only have one record with flag of Open or Closed
.
          MOVE      "1",WBEODFLG                 * set status to "Closed"
          PACK      KEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
          CALL      RAWBECO1
          IF        OVRCD=1
            MOVE      SKEY31,KEY31
            CALL      RDWBECO1                    * reposition
            IF        OVRCD=0
              MOVE      "1",WBEODFLG              * set status to "Closed"
              CALL      UPWBECO1                  * update record
            ENDIF
          ELSE
            MOVE      "0",WBEODFLG                * set status to "Open"
            PACK      KEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
            CALL      DEWBECO1
          ENDIF
.
.         Update the webimcaf record
.
          MOVE      TWENTY1,WBIMFLAG                * set status to closed
          PACK      WBIMSTAT,SP1,TWO             * set closed with payment

          CALL      IBACLOCK
          PACK      WBIMUDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBIMUDAT
          MOVE      CTIMEIS,WBIMUTIM
          MOVE      USERID,WBIMUUID
          CALL      UPWBIMC2                     * update claim
.
.         Write a new history (webimaaf) record
.
          MOVE      WBIMINVN,WBIAINVN
          MOVE      WBIMBATN,WBIABATN
          MOVE      TWENTY1,WBIASTAT
          MOVE      " 5",WBIATYPE
          MOVE      WBSEUID,WBIAOPER
          MOVE      WBIMTRID,WBIATRID
          MOVE      SP70,WBIAEROR
          MOVE      SP70,WBIAEROT
          MOVE      SP70,WBIASPAR
.
CLOS5000  CALL      IBACLOCK                     * get current date/time
          PACK      WBIADATE,CCC,CYY,CMM,CDD
          REP       " 0",WBIADATE
          MOVE      CTIMEIS,WBIATIME
          REP       " 0",WBIATIME
.
          PACK      KEY26,WBIAINVN,WBIADATE,WBIATIME,WBIATYPE,SP70
          CALL      RAWBIMA1
          IF        OVRCD = 1
            CALL      WRWBIMA1
          ELSE
            GOTO      CLOS5000
          ENDIF
.
CLOS9999 RETURN
.
.------------------------------------------------------------
. WebServices IMCW Claim Enquiries tags
.------------------------------------------------------------
ECCL0000  BRANCH    FLDITMNO,ECCL0100,ECCL0200,ECCL0300,ECCL0400,ECCL0500:
                             ECCL0600,ECCL0700,ECCL0800,ECCL0900,ECCL1000:
                             ECCL1100,ECCL1200,ECCL1300,ECCL1400,ECCL1500:
                             ECCL1600,ECCL1700,ECCL1800,ECCL1900,ECCL2000:
                             ECCL2100,ECCL2200,ECCL2300,ECCL2400,ECCL2500:
                             ECCL2600,ECCL2700,ECCL2800
.
          GOTO      ECCL9999
.
ECCL0100  CALL      ECCT0000
          GOTO      ECCL9999
.
ECCL0200  WRITE     HTMLFILE;IBCNMHOS;    * Multihospital Indicator
          GOTO      ECCL9999
.
ECCL0300  CALL      HOSPID00              * Hospital ID option field
          GOTO      ECCL9999
.
ECCL0400  CALL      SELHFN00              * Health Fund option field
          GOTO      ECCL9999
.
ECCL0500  WRITE     HTMLFILE;HLFDCLTY;
          GOTO      ECCL9999
.
ECCL0600  MOVE      CATCL,CATEGORY
          MOVE      HLTHFUND,CODE
          CALL      CODITM00
          GOTO      ECCL9999
.
ECCL0700  WRITE     HTMLFILE;EXCLWAIT;
          GOTO      ECCL9999
.
ECCL0800  WRITE     HTMLFILE;FILTURNO;
          GOTO      ECCL9999
.
ECCL0900  WRITE     HTMLFILE;FILTADMN;
          GOTO      ECCL9999
.
ECCL1000  WRITE     HTMLFILE;BATCHNUM;
          GOTO      ECCL9999
.
ECCL1100  WRITE     HTMLFILE;CLAIMSTA;
          GOTO      ECCL9999
.
ECCL1200  WRITE     HTMLFILE;INVNUMBR;
          GOTO      ECCL9999
.
ECCL1300  CALL      SELP0000
          GOTO      ECCL9999
.
ECCL1400  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      ECCL9999
.
ECCL1500  WRITE     HTMLFILE;EXDTBLNK;
          GOTO      ECCL9999
.
ECCL1600  WRITE     HTMLFILE;HLTHFUND;
          GOTO      ECCL9999
.
ECCL1700  CALL      PRVE0000
          GOTO      ECCL9999
.
ECCL1800  CALL      NXTE0000
          GOTO      ECCL9999
.
ECCL1900  CALL      BATTB000
          GOTO      ECCL9999
.
ECCL2000  CALL      PREVBT00
          GOTO      ECCL9999
.
ECCL2100  CALL      NEXTBT00
          GOTO      ECCL9999
.
ECCL2200  CALL      ECOT0000
          GOTO      ECCL9999
.
ECCL2300  WRITE     HTMLFILE;PROCSTAT;
          GOTO      ECCL9999
.
ECCL2400  CALL      ECCP0000
          GOTO      ECCL9999
.
ECCL2500  WRITE     HTMLFILE;EXCLCLOS;
          GOTO      ECCL9999
.
ECCL2600  CALL      NEXT0000
          GOTO      ECCL9999
.
ECCL2700  CALL      PREV0000
          GOTO      ECCL9999
.
ECCL2800  CALL      SELV0000
          GOTO      ECCL9999
.
ECCL9999  RETURN
+
.------------------------------------------------------------
. Table of IMCW Claim Enquiries
.------------------------------------------------------------
ECCT0000  MATCH     "1",PTCNWSIN
          GOTO      ECCT9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      ECCT9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      ECCT9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      ECCT9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBIMB2
ECCT0500  CALL      RKWBIMB2
          BRANCH    OVRCD,ECCT2000
          MATCH     WBIBDTBC,LASTDATE
          GOTO      ECCT2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,WBIBBTHN,SP70
          CALL      RSWBIMC3
ECCT1000  CALL      RKWBIMC3
          BRANCH    OVRCD,ECCT0500
          MATCH     WBIBBTHN,WBIMBATN
          GOTO      ECCT0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBIMHOSP
              GOTO      ECCT1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBIMHOSP
                GOTO      ECCT1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     "1",HLFDCLTY
            IF        @EQUAL
              MATCH     "0",WBIMEETP
              IF        !@EQUAL
                MATCH     "1",WBIMEETP
                GOTO      ECCT1000 IF NOT EQUAL
              ENDIF
            ELSE
              MATCH     HLFDCLTY,WBIMEETP
              GOTO      ECCT1000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,WBIMHFND
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   TWENTY1,WBIMFLAG
            GOTO      ECCT1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        WBIMFLAG=ZERO
.             GOTO      ECCT1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBIMURNO
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBIMUNIQ
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBIMBATN
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBIMFLG
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBIMINVN
            GOTO      ECCT1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,ECCT1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      ECCT1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      ECCT1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY34,WBIMINVN,Z70
          CALL      RSWBIMA3
          CALL      RPWBIMA3
          IF        OVRCD=0
            MATCH     WBIMINVN,WBIAINVN
            IF        @EQUAL
              MATCH     " 5",WBIATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBIMFLAG,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19,STATUS20:
                                      STATUS21

.
          CALL      RSBI0000
.
          CALL      GBAL0000
.
          MOVE      WBIMURNO,URNUMBER
.         MOVE      WBIMUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBIMINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBIMUNIQ,WBIMINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECCT1500
.
          MATCH     WBIMUNIQ,DPRDTUNQ
          GOTO      ECCT1500 IF NOT EQUAL
.
          MATCH     WBIMINVN,PRDTINVN
          GOTO      ECCT1500 IF NOT EQUAL
.
          GOTO      ECCT1600
.
ECCT1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECCT1600  REP       " +",WBIMURNO
          REP       " +",WBIMUNIQ
          REP       " +",WBIMBATN
          REP       " +",WBIMINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "2",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBIMURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBIMUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBIMBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBIMINVN,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBIMURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBIMURNO
          REP       "+ ",WBIMUNIQ
          REP       "+ ",WBIMBATN
          REP       "+ ",WBIMINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBIMBATN,"#",":
                             "#"",WBIMUNIQ,"#",":
                             "#"",WBIMINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",WBIMHFND,"#",";
.
          IF        WBIMFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBIMAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBIMPBAT,"#",":
                             "#"",WBIMNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBIMBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBIMNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBIMBATN,WBIMINVN:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBIMBATN,WBIMINVN:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBIMBATN,WBIMINVN:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBIMFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBIMBATN,WBIMINVN:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBIMBATN,DIM8
          REP       " +",WBIMURNO
          REP       " +",WBIMUNIQ
          REP       " +",WBIMBATN
          REP       " +",WBIMINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
             WBIMBATN,"','",WBIMUNIQ,"','",WBIMURNO,"','",WBIMINVN,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
ECCT1900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBIMBATN,"','",WBIMINVN,"','":
                             WBIMURNO,"','",WBIMUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBIMURNO
          REP       "+ ",WBIMUNIQ
          REP       "+ ",WBIMBATN
          REP       "+ ",WBIMINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
 IF        SUPERECL=ONE & (WBIMFLAG=6 | WBIMFLAG=8 | WBIMFLAG=10 | WBIMFLAG = 11)
            WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
                               " value='",WBIMBATN,WBIMINVN:
                               "' onclick=resetStatus(this);>":
                               "#");"
          ELSE
.           WRITE     HTMLFILE;"#"#");"                                   * 19
            WRITE     HTMLFILE;"#"#",";                                   * 19
          ENDIF
.
          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBIMUDAT
          IF        !@EQUAL
            UNPACK    WBIMUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      ECCT1950
          ELSE
            MATCH     SP70,WBIMCDAT
            IF        !@EQUAL
              UNPACK    WBIMCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      ECCT1950
            ELSE
              GOTO      ECCT1950
            ENDIF
          ENDIF

ECCT1950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBIMUUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBIMUUID,SP2,DIM11
            PACK      UIDTIMET,WBIMUTIM
            GOTO      ECCT1970
          ELSE
            MATCH     SP70,WBIMCUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBIMCUID,SP2,DIM11
              PACK      UIDTIMET,WBIMCTIM
              GOTO      ECCT1970
            ELSE
              GOTO      ECCT1970
            ENDIF
          ENDIF

ECCT1970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECCT1000
.
ECCT2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      ECCT9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSWBIMC3
ECCT3000  CALL      RKWBIMC3
          BRANCH    OVRCD,ECCT9000
          MATCH     SP70,WBIMBATN
          GOTO      ECCT9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBIMHOSP
              GOTO      ECCT3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBIMHOSP
                GOTO      ECCT3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     "1",HLFDCLTY
            IF        @EQUAL
              MATCH     "0",WBIMEETP
              IF        !@EQUAL
                MATCH     "1",WBIMEETP
                GOTO      ECCT3000 IF NOT EQUAL
              ENDIF
            ELSE
              MATCH     HLFDCLTY,WBIMEETP
              GOTO      ECCT3000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,WBIMHFND
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
          IF        EXCLCLOS=ONE
            IF        WBIMFLAG=TEN9
              GOTO      ECCT3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBIMFLAG=ZERO
              GOTO      ECCT3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBIMURNO
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBIMUNIQ
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBIMBATN
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBIMFLG
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBIMINVN
            GOTO      ECCT3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,ECCT1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      ECCT1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      ECCT1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY34,WBIMINVN,Z70
          CALL      RSWBIMA3
          CALL      RPWBIMA3
          IF        OVRCD=0
            MATCH     WBIMINVN,WBIAINVN
            IF        @EQUAL
              MATCH     " 5",WBIATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBIMFLAG,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19,STATUS20:
                                      STATUS21
.
          CALL      RSBI0000
.
          CALL      GBAL0000
.
          MOVE      WBIMURNO,URNUMBER
.         MOVE      WBIMUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBIMINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBIMUNIQ,WBIMINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECCT3500
.
          MATCH     WBIMUNIQ,DPRDTUNQ
          GOTO      ECCT3500 IF NOT EQUAL
.
          MATCH     WBIMINVN,PRDTINVN
          GOTO      ECCT3500 IF NOT EQUAL
.
          GOTO      ECCT3600
.
ECCT3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECCT3600  REP       " +",WBIMURNO
          REP       " +",WBIMUNIQ
          REP       " +",WBIMBATN
          REP       " +",WBIMINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "2",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBIMURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBIMUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBIMBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBIMINVN,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBIMURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBIMURNO
          REP       "+ ",WBIMUNIQ
          REP       "+ ",WBIMBATN
          REP       "+ ",WBIMINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBIMBATN,"#",":
                             "#"",WBIMUNIQ,"#",":
                             "#"",WBIMINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",WBIMHFND,"#",";
.
          IF        WBIMFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBIMAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBIMPBAT,"#",":
                             "#"",WBIMNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBIMBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBIMNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBIMBATN,WBIMINVN:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBIMBATN,WBIMINVN:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBIMBATN,WBIMINVN:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBIMFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBIMBATN,WBIMINVN:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBIMBATN,DIM8
          REP       " +",WBIMURNO
          REP       " +",WBIMUNIQ
          REP       " +",WBIMBATN
          REP       " +",WBIMINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
             WBIMBATN,"','",WBIMUNIQ,"','",WBIMURNO,"','",WBIMINVN,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
ECCT8900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBIMBATN,"','",WBIMINVN,"','":
                             WBIMURNO,"','",WBIMUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBIMURNO
          REP       "+ ",WBIMUNIQ
          REP       "+ ",WBIMBATN
          REP       "+ ",WBIMINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
 IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
            WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
                               " value='",WBIMBATN,WBIMINVN:
                               "' onclick=resetStatus(this);>":
                               "#");"
          ELSE
.           WRITE     HTMLFILE;"#"#");"                                   * 19
            WRITE     HTMLFILE;"#"#",";                                   * 19
          ENDIF
.
          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBIMUDAT
          IF        !@EQUAL
            UNPACK    WBIMUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      ECCT8950
          ELSE
            MATCH     SP70,WBIMCDAT
            IF        !@EQUAL
              UNPACK    WBIMCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      ECCT8950
            ELSE
              GOTO      ECCT8950
            ENDIF
          ENDIF

ECCT8950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBIMUUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBIMUUID,SP2,DIM11
            PACK      UIDTIMET,WBIMUTIM
            GOTO      ECCT8970
          ELSE
            MATCH     SP70,WBIMCUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBIMCUID,SP2,DIM11
              PACK      UIDTIMET,WBIMCTIM
              GOTO      ECCT8970
            ELSE
              GOTO      ECCT8970
            ENDIF
          ENDIF

ECCT8970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECCT3000
.
ECCT9000
ECCT9999  RETURN
+
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries
.------------------------------------------------------------
ECCP0000  MATCH     "1",PTCNWSIN
          GOTO      ECCP9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      ECCP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.         MATCH     SP70,HOSPCODE
.         IF        @EQUAL
.           MOVE      WBSEHOSP,HOSPCODE
.         ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSWBIMC5
ECCP1000  CALL      RKWBIMC5
          BRANCH    OVRCD,ECCP9999
          MATCH     FILTURNO,WBIMURNO
          GOTO      ECCP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBIMHOSP
              GOTO      ECCP9999 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBIMHOSP
                GOTO      ECCP9999 IF NOT EQUAL
              ENDIF
            ENDIF
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBIMURNO
              GOTO      ECCP1000 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBIMURNO
              GOTO      ECCP9999 IF NOT EQUAL
            ENDIF
.
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     "1",HLFDCLTY
            IF        @EQUAL
              MATCH     "0",WBIMEETP
              IF        !@EQUAL
                MATCH     "1",WBIMEETP
                GOTO      ECCP1000 IF NOT EQUAL
              ENDIF
            ELSE
              MATCH     HLFDCLTY,WBIMEETP
              GOTO      ECCP1000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,WBIMHFND
            GOTO      ECCP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBIMFLAG=ZERO
              GOTO      ECCP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBIMUNIQ
            GOTO      ECCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBIMBATN
            GOTO      ECCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBIMFLG
            GOTO      ECCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBIMINVN
            GOTO      ECCP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,WBIMBATN,SP70
            CALL      RDWBIMB1
            BRANCH    OVRCD,ECCP1000
.
            MATCH     FRSTDATE,WBIBDTBC
            GOTO      ECCP1000 IF LESS
.
            MATCH     WBIBDTBC,LASTDATE
            GOTO      ECCP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY34,WBIMINVN,Z70
          CALL      RSWBIMA3
          CALL      RPWBIMA3
          IF        OVRCD=0
            MATCH     WBIMINVN,WBIAINVN
            IF        @EQUAL
              MATCH     " 5",WBIATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBIMFLAG,STATUS01,STATUS02,STATUS03,STATUS04:
                                      STATUS05,STATUS06,STATUS07,STATUS08:
                                      STATUS09,STATUS10,STATUS11,STATUS12:
                                      STATUS13,STATUS14,STATUS15,STATUS16:
                                      STATUS17,STATUS18,STATUS19,STATUS20:
                                      STATUS21
.
          CALL      RSBI0000
.
          CALL      GBAL0000
.
          MOVE      WBIMURNO,URNUMBER
.         MOVE      WBIMUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
. 
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBIMINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBIMUNIQ,WBIMINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECCP1500
.
          MATCH     WBIMUNIQ,DPRDTUNQ
          GOTO      ECCP1500 IF NOT EQUAL
.
          MATCH     WBIMINVN,PRDTINVN
          GOTO      ECCP1500 IF NOT EQUAL
.
          GOTO      ECCP1600
.
ECCP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECCP1600  REP       " +",WBIMURNO
          REP       " +",WBIMUNIQ
          REP       " +",WBIMBATN
          REP       " +",WBIMINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "2",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBIMURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBIMUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBIMBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBIMINVN,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBIMURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBIMURNO
          REP       "+ ",WBIMUNIQ
          REP       "+ ",WBIMBATN
          REP       "+ ",WBIMINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBIMBATN,"#",":
                             "#"",WBIMUNIQ,"#",":
                             "#"",WBIMINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",WBIMHFND,"#",";
.
          IF        WBIMFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBIMAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBIMPBAT,"#",":
                             "#"",WBIMNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBIMBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBIMNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBIMBATN,WBIMINVN:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBIMBATN,WBIMINVN:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBIMBATN,WBIMINVN:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBIMFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBIMBATN,WBIMINVN:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBIMBATN,DIM8
          REP       " +",WBIMURNO
          REP       " +",WBIMUNIQ
          REP       " +",WBIMBATN
          REP       " +",WBIMINVN
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
             WBIMBATN,"','",WBIMUNIQ,"','",WBIMURNO,"','",WBIMINVN,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",WBIMURNO
          REP       "+ ",WBIMUNIQ
          REP       "+ ",WBIMBATN
          REP       "+ ",WBIMINVN
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
 IF        SUPERECL=ONE & (WBIMFLAG=6 | WBIMFLAG=8 | WBIMFLAG=10 | WBIMFLAG = 11)
            WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
                               " value='",WBIMBATN,WBIMINVN:
                               "' onclick=resetStatus(this);>":
                               "#");"
          ELSE
            WRITE     HTMLFILE;"#"#");"
          ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECCP1000
.
ECCP9999  RETURN
+
.------------------------------------------------------------
. Hospital ID
.------------------------------------------------------------
HOSPID00  PACK      KEY3,SP10
          CALL      RSPTHSP1
HOSPID10  CALL      RKPTHSP1
          BRANCH    OVRCD,HOSPID90
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          BRANCH    IBCNMHOS,HOSPID20
          WRITE     HTMLFILE;"<option value=",KEY5,">":
                             PTHSNAME,"</option>"
          GOTO      HOSPID10
.
.         Mult-Hospital
.
HOSPID20  BRANCH    ALLHFLAG,HOSPID30            * don't default to user's hosp
          MATCH     SP70,HOSPCODE                                      *C-125462
          IF        @EQUAL
            MOVE      WBSEHOSP,HOSPCODE          * default to user's Hosp code
          ENDIF
HOSPID30  MATCH     HOSPCODE,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               PTHSNAME,"</option>"
          ENDIF
          GOTO      HOSPID10
.
HOSPID90
HOSPID99  RETURN
+
.------------------------------------------------------------
. Health fund Selection
.------------------------------------------------------------
SELHFN00  PACK      KEY14,SP70
          CALL      RDSFUND1
SELHFN10  CALL      RDKFUND1
          BRANCH    OVRCD,SELHFN99
.
          MATCH     SP8,HFTABL           * Check health fund table
          GOTO      SELHFN10 IF EQUAL
.
          MATCH     "0000    ",HFTABL
          GOTO      SELHFN10 IF NOT EQUAL
.
          BRANCH    PHFTACT,SELHFN10     * ignore inactive HF
.
          PACK      KEY8,QUOTE,HCODE,QUOTE
          MATCH     HLTHFUND,HCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                               HFNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY8,">":
                               HFNAME,"</option>"
          ENDIF
          GOTO      SELHFN10
.
SELHFN99  RETURN
+
.------------------------------------------------------------
. Selects Day, Week or Month from Viewtype
.------------------------------------------------------------
SELP0000  MATCH     "1",VIEWTYPE
          GOTO      SELP2000 IF EQUAL
          MATCH     "2",VIEWTYPE
          GOTO      SELP4000 IF EQUAL
.
.Defaults to Daily Viewtype
.--------------------------
.
          WRITE     HTMLFILE;"<select name=lastdate class=DaySelect":
                             " onchange='exdtblankchange();FilterSubmit();'>";
          UNPACK    FRSTDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      "8",ADJDAYS
          CALL      ADJDAT00
          PACK      ENDDATE,CCENT,CYEAR,CMON,CDAY
.
          MOVE      "-7",ADJDAYS
          UNPACK    FRSTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      ADJDAT00
          PACK      STRTDATE,CCENT,CYEAR,CMON,CDAY
.
          IF        EXDTBLNK=1
            WRITE     HTMLFILE;"<option value='",SP8,"' selected>":
                               "</option>";
          ELSE
            WRITE     HTMLFILE;"<option value='",SP8,"'>":
                               "</option>";
          ENDIF
.
SELP1000  UNPACK    STRTDATE,CCENT,CYEAR,CMON,CDAY
          CALL      DAYOFWEK
          LOAD      DAYNAM3,WEEKDAY,MON,TUE,WED,THU,FRI,SAT,SUN
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          IF        EXDTBLNK=1
              WRITE     HTMLFILE;"<option value=",STRTDATE,">":
                                 DAYNAM3,SP1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                                 "</option>";
          ELSE
            MATCH     STRTDATE,FRSTDATE
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",STRTDATE," selected>":
                                 DAYNAM3,SP1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                                 "</option>";
            ELSE
              WRITE     HTMLFILE;"<option value=",STRTDATE,">":
                                 DAYNAM3,SP1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                                 "</option>";
            ENDIF
          ENDIF
.
          MOVE      "1",ADJDAYS
          CALL      ADJDAT00
          PACK      STRTDATE,CCENT,CYEAR,CMON,CDAY
          MATCH     ENDDATE,STRTDATE
          GOTO      SELP1000 IF NOT EQUAL
          GOTO      SELP9000
.
.Select Weekly Viewtype
.--------------------------
SELP2000  WRITE     HTMLFILE;"<select name=lastdate class=WeekSelect":
                             " onchange='exdtblankchange();FilterSubmit();'>";
          UNPACK    FRSTDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      "42",ADJDAYS
          CALL      ADJDAT00
          PACK      ENDDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ENDDATE
.
          UNPACK    FRSTDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      "-42",ADJDAYS
          CALL      ADJDAT00
          PACK      STRTDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRTDATE
          REP       " 0",FRSTDATE
.
          IF        EXDTBLNK=1
            WRITE     HTMLFILE;"<option value='",SP8,"' selected>":
                               "</option>";
          ELSE
            WRITE     HTMLFILE;"<option value='",SP8,"'>":
                               "</option>";
          ENDIF
.
SELP3000  UNPACK    STRTDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          IF        EXDTBLNK=1
            WRITE     HTMLFILE;"<option value=",STRTDATE,">Week of ":
                               CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>";
          ELSE
            MATCH     STRTDATE,FRSTDATE
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",STRTDATE," selected>Week of ":
                                 CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>";
            ELSE
              WRITE     HTMLFILE;"<option value=",STRTDATE,">Week of ":
                                 CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</option>";
            ENDIF
          ENDIF
.
          MOVE      "7",ADJDAYS
          CALL      ADJDAT00
          PACK      STRTDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRTDATE
          MATCH     ENDDATE,STRTDATE
          GOTO      SELP3000 IF NOT EQUAL
          GOTO      SELP9000
.
.
.Select Monthly Viewtype
.------------------------
.
SELP4000  WRITE     HTMLFILE;"<select name=vyearmth class=MonthSelect":
                             " onchange='exdtblankchange();FilterSubmit();'>";
          UNPACK    FRSTDATE,KEY4,CMON,CDAY
          MOVE      KEY4,F4
          MOVE      CMON,F2
          MOVE      CMON,ENDMTH
          ADD       SIX,ENDMTH
          IF        ENDMTH>12
            SUB       "12",ENDMTH
          ENDIF
          SUB       SIX,F2
          IF        F2<0
            SUB       ONE,F4
            ADD       "12",F2
          ENDIF
.
          IF        EXDTBLNK=1
            WRITE     HTMLFILE;"<option value='",SP6,"' selected>":
                               "</option>";
          ELSE
            WRITE     HTMLFILE;"<option value='",SP6,"'>":
                               "</option>";
          ENDIF
.
SELP5000  LOAD      MTHNAM,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY6,F4,F2
          REP       " 0",KEY6
.
          IF        EXDTBLNK=1
            WRITE     HTMLFILE;"<option value=",KEY6,">":
                               MTHNAM,SP1,F4,"</option>";
          ELSE
            MATCH     KEY6,FRSTDATE
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY6," selected>":
                                 MTHNAM,SP1,F4,"</option>";
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY6,">":
                                 MTHNAM,SP1,F4,"</option>";
            ENDIF
          ENDIF
.
          ADD       ONE,F2
          IF        F2>12
            ADD      ONE,F4
            SUB      "12",F2
          ENDIF
          COMPARE   ENDMTH,F2
          GOTO      SELP5000 IF NOT EQUAL
.
SELP9000  WRITE     HTMLFILE;"</select>"
          RETURN
.******************************************************************************
.------------------------------------------------------------
. Next Day, Week, Month
.------------------------------------------------------------
NXTE0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          REP       " +",HLTHFUND
          REP       " +",HLFDCLTY
          REP       " +",BATCHNUM
          REP       " +",INVNUMBR
          REP       " +",CLAIMSTA
          REP       " +",HOSPCODE
          REP       " +",URNUMBER
          REP       " +",UNIQNUMB
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&viewtype=",VIEWTYPE:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&allhflag=",ALLHFLAG:
                             "&hlthfund=",HLTHFUND:
                             "&exclwait=",EXCLWAIT:
                             "&exdtblnk=",EXDTBLNK:
                             "&hlfdclty=",HLFDCLTY:
                             "&batchnum=",BATCHNUM:
                             "&invnumbr=",INVNUMBR:
                             "&claimsta=",CLAIMSTA:
                             "&hospcode=",HOSPCODE:
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&exclclos=",EXCLCLOS;
.
          REP       "+ ",HLTHFUND
          REP       "+ ",HLFDCLTY
          REP       "+ ",BATCHNUM
          REP       "+ ",INVNUMBR
          REP       "+ ",CLAIMSTA
          REP       "+ ",HOSPCODE
          REP       "+ ",URNUMBER
          REP       "+ ",UNIQNUMB
.
NXTE9999  RETURN
.
.--------------------------------------------------------
.
PRVE0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          REP       " +",HLTHFUND
          REP       " +",HLFDCLTY
          REP       " +",BATCHNUM
          REP       " +",INVNUMBR
          REP       " +",CLAIMSTA
          REP       " +",HOSPCODE
          REP       " +",URNUMBER
          REP       " +",UNIQNUMB
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&viewtype=",VIEWTYPE:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&allhflag=",ALLHFLAG:
                             "&hlthfund=",HLTHFUND:
                             "&exclwait=",EXCLWAIT:
                             "&exdtblnk=",EXDTBLNK:
                             "&hlfdclty=",HLFDCLTY:
                             "&batchnum=",BATCHNUM:
                             "&invnumbr=",INVNUMBR:
                             "&claimsta=",CLAIMSTA:
                             "&hospcode=",HOSPCODE:
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&exclclos=",EXCLCLOS;
.
          REP       "+ ",HLTHFUND
          REP       "+ ",HLFDCLTY
          REP       "+ ",BATCHNUM
          REP       "+ ",INVNUMBR
          REP       "+ ",CLAIMSTA
          REP       "+ ",HOSPCODE
          REP       "+ ",URNUMBER
          REP       "+ ",UNIQNUMB
.
PRVE9999  RETURN
+
.------------------------------------------------------------
. Table of Batch Numbers
.------------------------------------------------------------
BATTB000  MATCH     "1",PTCNWSIN
          GOTO      BATTB999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      BATTB999 IF NOT EQUAL
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BATHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70
          CALL      RSWBIMB1                     * position in file
BATTB100  CALL      RPWBIMB1                     * read previous record
          BRANCH    OVRCD,BATTB999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BATTB100
          ENDIF
.
          CALL      BATRW000      * Display Row
          BRANCH    EXIT,BATTB100
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BATTB100 IF NOT EQUAL
.
BATTB999  RETURN
+
.------------------------------------------------------------
. Batch Numbers by Code (TABLE HEADING)
.------------------------------------------------------------
BATHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Batch Number</td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=25%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Health Fund</td>":
                             "<td class=HeadingCell width=15%>":
                             "Date</td>":
                             "<td class=HeadingCell width=15%>":
                             "Time</td>":
.                            "<td class=HeadingCell width=15%>":
.                            "Status</td>":
                             "</tr>"
.
BATHD999  RETURN
.------------------------------------------------------------
. Batch Numbers (TABLE ROW)
.------------------------------------------------------------
BATRW000  MOVE      ZERO,EXIT
          PACK      BTSCHOSP,BTSCHOSP,SP70
.
          UNPACK    WBIBDTBC,CCENT,CYEAR,CMON,CDAY  * Batch Created Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    WBIBTMBC,DIM5,ANS,ANS,ANS
.
          MOVE      SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      BATRW500 IF NOT EQUAL
.
          PACK      KEY24,WBIBBTHN,SP30         * get Hospital for given Batch
          CALL      RSWBIMC3
          CALL      RKWBIMC3
          IF        OVRCD=1
            MOVE      ONE,EXIT
            GOTO      BATRW999
          ENDIF
.
          MATCH     WBIBBTHN,WBIMBATN
          IF        @EQUAL
            MOVE      WBIMHOSP,KEY3
            CALL      RDPTHSP1            * read Hospital name for visit
            IF        OVRCD=1
              MOVE      WBIMHOSP,HOSPNAME
            ELSE
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
.
            MATCH     SP70,BTSCHOSP
            IF        !@EQUAL&!@EOS
              MATCH     BTSCHOSP,WBIMHOSP
              IF        !@EQUAL
                MOVE      ONE,EXIT
                GOTO      BATRW999
              ENDIF
            ENDIF
          ELSE
            MOVE      ONE,EXIT
            GOTO      BATRW999
          ENDIF
.
BATRW500  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",WBIBBTHN,"#")'>":
                             WBIBBTHN,"</a></td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",WBIBHFND,"&nbsp;</td>":
                             "<td>",KEY11,"</td>":
                             "<td>",DIM5,"</td>":
                             "</tr>";
.
BATRW999  RETURN
+
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVBT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",F2:
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&btschosp=",BTSCHOSP;
.
PREVBT99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTBT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",F2:
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&btschosp=",BTSCHOSP;
.
NEXTBT99  RETURN
+
.*****************************************************************************
.*                          RSBI0000                                         *
.*****************************************************************************
RSBI0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,WBIMNBAT                 * next batch blank ?
          GOTO      RSBI9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBIMFLAG <> 21 & WBIMFLAG <> 3
            GOTO      RSBI9000
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
          PACK      KEY8,WBIMINVN,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,RSBI9000
.
          CALL      GBAL0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSBI9000
          ENDIF
.
          PACK      KEY16,WBIMINVN,SP70
          CALL      RAWBIMC2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBI9000
          ENDIF
.
          GOTO      RSBI9999
.
RSBI9000  MOVE      ONE,RSUBINDI
RSBI9999  RETURN
+
.*******************************************************************************
.                         Goes back 1 page
.*******************************************************************************
RELOAD00  CALL      OPENHTML
          BRANCH    EXIT,RELOAD99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                            "    alert(#"",WEBTITLE,"#");":
                             "    history.go(-1);":
.                            "    location.reload();":
                             "}":
                             "</script>"
          CALL      CLOSHTML
RELOAD99  RETURN
.
.--------------------------------------------------------------------------
. Remote Scripting
.               1. Validate IMC Batch Number
.--------------------------------------------------------------------------
REMOTE00  BRANCH    VALDTYPE,REMOTE01,REMOTE02,REMOTE03,REMOTE04,REMOTE05:
                             REMOTE06,REMOTE07,REMOTE08,REMOTE09
          GOTO      REMOTE90
.
REMOTE01  CALL      VALBAT00     * Validate Batch Number IMCW
          GOTO      REMOTE99
.
REMOTE02  CALL      VALUNQ00     * Validate Unique Number IMCW
          GOTO      REMOTE99
.
REMOTE03  CALL      VALBAS00     * Validate Batch Number PCIW
          GOTO      REMOTE99
.
REMOTE04  CALL      VALUNS00     * Validate Unique Number PCIW
          GOTO      REMOTE99
.
REMOTE05  CALL      VALBAH00     * Validate Batch Number IHCW
          GOTO      REMOTE99
.
REMOTE06  CALL      VALBAB00     * Validate Batch Number BBSW
          GOTO      REMOTE99
.
REMOTE07  CALL      VALUNB00     * Validate Unique Num Number BBSW
          GOTO      REMOTE99
.
REMOTE08  CALL      VALBAD00     * Validate Batch Number DVAW
          GOTO      REMOTE99
.
REMOTE09  CALL      VALUND00     * Validate Unique Num Number DVAW
          GOTO      REMOTE99
.
REMOTE90  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTE99
.
REMOTE99  RETURN
+
.------------------------------------------------------------
. Validate Batch Number
. INPUTS: BATCHNUM - Batch Number
.------------------------------------------------------------
VALBAT00  CALL      XMLHED00
          BRANCH    EXIT,VALBAT99
.
          MATCH     "1",PTCNWSIN
          GOTO      VALBAT91 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      VALBAT91 IF NOT EQUAL
.
          PACK      KEY24,BATCHNUM,SP70
          CALL      RSWBIMC3
          CALL      RKWBIMC3
          BRANCH    OVRCD,VALBAT90
.
          MATCH     WBIMBATN,BATCHNUM
          GOTO      VALBAT90 IF NOT EQUAL
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALBAT98
.
VALBAT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Batch number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAT98
.
VALBAT91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Not using WebServices IMCW Module. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAT98
.
VALBAT98  CALL      XMLEND00
VALBAT99  RETURN
+
.------------------------------------------------------------
. Validate Unique Number
. INPUTS: UNIQNUMB - Batch Number
.------------------------------------------------------------
VALUNQ00  CALL      XMLHED00
          BRANCH    EXIT,VALUNQ99
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,VALUNQ90
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALUNQ98
.
VALUNQ90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Unique number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALUNQ98
.
VALUNQ98  CALL      XMLEND00
VALUNQ99  RETURN
+
.------------------------------------------------------------
. Table of Outstanding Assessment Reports
.------------------------------------------------------------
ECOT0000  MATCH     "1",PTCNWSIN
          GOTO      ECOT9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      ECOT9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          MATCH     FRSTDATE,SP70
          GOTO      ECOT9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      ECOT9999 IF EQUAL
.
          MATCH     SP70,PROCSTAT
          IF        @EQUAL
            MOVE      "0",PROCSTAT
          ENDIF 
.
          PACK      KEY39,FRSTDATE,PROCSTAT,SP70
          CALL      RSWBECO2                     * position in file
ECOT1000  CALL      RKWBECO2                     * read next record
          BRANCH    OVRCD,ECOT9999               * end of file
.
          MATCH     WBEOCDAT,LASTDATE
          GOTO      ECOT9999 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          RJUSTIFY  WBEOINVN
          RJUSTIFY  WBEOBATN
          MOVE      SP70,FORMATNM
          MOVE      SP70,KEY3
          MOVE      SP70,URNUMBER
          MOVE      SP70,UNIQNUMB
          PACK      KEY16,WBEOINVN,WBEOBATN,SP70
          CALL      RDWBIMC2
          IF        OVRCD=0
            MOVE      WBIMURNO,URNUMBER
            MOVE      WBIMUNIQ,UNIQNUMB
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            IF        OVRCD=ONE
              CALL      CLPATMAS
            ENDIF
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDPMPX21
            IF        OVRCD=ONE
              CALL      CLPMSPX2
            ENDIF
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE                   * CALCAGE uses PBDATE
.
            CALL      PATLN000
            CALL      PATFLD00
          ELSE
            GOTO      ECOT1000
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     "1",HLFDCLTY
            IF        @EQUAL
              MATCH     "0",WBEOCTYP
              IF        !@EQUAL
                MATCH     "1",WBEOCTYP
                GOTO      ECOT1000 IF NOT EQUAL
              ENDIF
            ELSE
              MATCH     HLFDCLTY,WBEOCTYP
              GOTO      ECOT1000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,WBEOHFND
            GOTO      ECOT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PROCSTAT
          IF        !@EQUAL & !@EOS
            MATCH     PROCSTAT,WBEODFLG
            GOTO      ECOT1000 IF NOT EQUAL
          ENDIF
.
          CALL      ECOTRW00
.
          GOTO      ECOT1000
.
ECOT9999  RETURN
.------------------------------------------------------------
. Table of Outstanding Assessment Reports (Detail Row)
.------------------------------------------------------------
ECOTRW00  REP       " +",URNUMBER
          REP       " +",UNIQNUMB
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    URNUMBER,PATLINK
          APPEND    "&uniqnumb=",PATLINK
          APPEND    UNIQNUMB,PATLINK
          RESET     PATLINK
.
          REP       "+ ",URNUMBER
          REP       "+ ",UNIQNUMB
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          WRITE     HTMLFILE;"t.addRow(#"",WBEOHFND,"#",":
                             "#"",UNIQNUMB,"#",":
                             "#"",URNUMBER,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",WBEOINVN,"#",";
.
          MATCH     "1",WBEODFLG
          IF        @EQUAL
            WRITE     HTMLFILE;"#"<font color=red>closed</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"<input type=checkbox name=otp",DRECCNT:
                               " value='",WBEOHFND,WBEODFLG,WBEOTRID:
                               "' onclick=outprocr(this);>":
                               "#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",PATLINK,"#",";
          WRITE     HTMLFILE;"#"",WBEOTRID,"#",";
          WRITE     HTMLFILE;"#"",KEY3,"#");";
.
ECOTRW99  RETURN
+
.------------------------------------------------------------
. Table of IMC Assessment Report
.------------------------------------------------------------
EDIP0000  MATCH     "1",PTCNWSIN
          GOTO      EDIP9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      EDIP9999 IF NOT EQUAL
.
          CALL      EDIPHD00      * Output Table Heading
.
          PACK      KEY56,WBIMTRID,Z70
          CALL      RSWBIMD2
EDIP1000  CALL      RPWBIMD2
          BRANCH    OVRCD,EDIP9999
.
          MATCH     WBIMTRID,WBIDTRID
          GOTO      EDIP9999 IF NOT EQUAL
.
          CALL      EDIPRW00
.
          GOTO      EDIP1000
.
EDIP9999  RETURN
.------------------------------------------------------------
. EDI Assessment Report (TABLE HEADING)
.------------------------------------------------------------
EDIPHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top colspan=17>":
                             "Medicare Status&nbsp;</td></tr>":
                             "<tr>":
                             "<td class=HeadingCell valign=top colspan=17>":
                             "Health Fund Status&nbsp;</td></tr>":
                             "<tr><td class=HeadingCell></td>":
                             "<td class=HeadingCell valign=top>":
                             "Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Current First Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Current Medicare Num&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Current Reference Num&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Report Status&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Status Code</td>":
                             "<td class=HeadingCell valign=top>":
                             "Health Fund Status Code</td>":
                             "<td class=HeadingCell valign=top>":
                             "Family Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "First Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Num&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Reference Num&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Process Status Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Assessment Event Details&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Health Fund Assessment Event Details&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Report Details&nbsp;</td>":
                             "</tr>"
.
EDIPHD99  RETURN
.
.------------------------------------------------------------
. EDI Assessment Report (Detail Row)
.------------------------------------------------------------
EDIPRW00  MOVE      ZERO,FORM1
          MOVE      "Unknown",ASESDESC
          MOVE      WBIDHFAC,ANS
          REP       "A1R2W3C4",ANS
          MOVE      ANS,FORM1
          LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4
.
.         MOVE      ZERO,FORM1
.         MOVE      "No Change",MEDSDESC
.         MOVE      PRAHMCFC,ANS
.         REP       "A1I2C3W4S5X6",ANS
.         MOVE      ANS,FORM1
.         LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
.                                  MEDSDES5,MEDSDES6
          MOVE      SP70,MEDSDESC
.
.         MOVE      ZERO,FORM2
.         MOVE      "UNKNOWN",PRCSDESC 
.         MOVE      PRAHSTAT,FORM2 
.         LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
.                                  PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
.                                  PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
.                                  PRCSDE10,PRCSDE11
.
          MOVE      SP70,MEDSDESC
.
          WRITE     HTMLFILE;"<tr><td valign=top colspan=17>",WBIDMSTC;
          WRITE     HTMLFILE;"&nbsp",WBIDMSTT,"</td></tr>";
.
          WRITE     HTMLFILE;"<tr><td valign=top colspan=17>",WBIDHFSC;
          WRITE     HTMLFILE;"&nbsp",WBIDHFST,"</td></tr>";
.
          WRITE     HTMLFILE;"<tr><td valign=top>&nbsp;</td></tr>";
.
          WRITE     HTMLFILE;"<tr><td></td>";
          WRITE     HTMLFILE;"<td valign=top>",ASESDESC,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDCLID,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDMCGN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDMCMN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDMCRN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDRPST,"&nbsp;</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDMSTC,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDHFSC,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDMAFN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDMAGN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDMAMN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIDMARN,"</td>";
.         WRITE     HTMLFILE;"<td valign=top>",PRCSDESC,"</td>";
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=02":
                             "&template=004":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:                             
                             "&prhre003=",PRHRE003:
                             "&ecclfbid=",WBIDFBID:
                             "&ecclarid=",WBIDARID:
                             "&ecclclid=",WBIDCLID:
                             "&ecclrptc=",WBIDRPTC,"#";'>":
                             "</td>";
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=02":
                             "&template=005":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclfbid=",WBIDFBID:
                             "&ecclarid=",WBIDARID:
                             "&ecclclid=",WBIDCLID:
                             "&ecclrptc=",WBIDRPTC,"#";'>":
                             "</td>";
.
          MOVE      ZERO,FORM3
          PACK      KEY51,WBIDTRID,ONE,TEN,SP70
          CALL      RSWBETR4
EDIPRW80  CALL      RKWBETR4
          BRANCH    OVRCD,EDIPRW90
.
          MATCH     WBIDTRID,WBETTRID
          GOTO      EDIPRW90 IF NOT EQUAL
.
          MATCH     "1",WBETSTAT
          GOTO      EDIPRW90 IF NOT EQUAL
.
          MATCH     "10",WBETTYPE
          GOTO      EDIPRW90 IF NOT EQUAL
.
          ADD       ONE,FORM3
          MOVE      FORM3,DIM3
          MATCH     DIM3,WBIDRPTC
          GOTO      EDIPRW80 IF NOT EQUAL
.
          MATCH     SP70,WBETSTRD
          GOTO      EDIPRW90 IF EQUAL
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='displayJSON(#"../cgi-bin/eclweb73.pbl":
                             "?reportno=02":
                             "&template=008":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclfbid=",WBIDFBID:
                             "&ecclarid=",WBIDARID:
                             "&ecclclid=",WBIDCLID:
                             "&ecclstrd=",WBETSTRD:
                             "&ecclrptc=",WBIDRPTC,"#");'>":
                             "</td>":
                             "</tr>";
.
          GOTO      EDIPRW99
.
EDIPRW90  MOVE      ZERO,FORM3
          PACK      KEY51,WBIDTRID,ONE,TEN4,SP70
          CALL      RSWBETR4
EDIPRW92  CALL      RKWBETR4
          BRANCH    OVRCD,EDIPRW95
.
          MATCH     WBIDTRID,WBETTRID
          GOTO      EDIPRW95 IF NOT EQUAL
.
          MATCH     "1",WBETSTAT
          GOTO      EDIPRW95 IF NOT EQUAL
.
          MATCH     "14",WBETTYPE
          GOTO      EDIPRW95 IF NOT EQUAL
.
          ADD       ONE,FORM3
          MOVE      FORM3,DIM3
          MATCH     DIM3,WBIDRPTC
          GOTO      EDIPRW92 IF NOT EQUAL
.
          MATCH     SP70,WBETSTRD
          GOTO      EDIPRW95 IF EQUAL
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='displayJSON(#"../cgi-bin/eclweb73.pbl":
                             "?reportno=02":
                             "&template=008":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclfbid=",WBIDFBID:
                             "&ecclarid=",WBIDARID:
                             "&ecclclid=",WBIDCLID:
                             "&ecclstrd=",WBETSTRD:
                             "&ecclrptc=",WBIDRPTC,"#");'>":
                             "</td>":
                             "</tr>";
.
          GOTO      EDIPRW99
.
EDIPRW95  WRITE     HTMLFILE;"<tr><td valign=top>&nbsp;</td></tr>";
.        
EDIPRW99  RETURN
.
.------------------------------------------------------------
. Table of EDI Claim Explanation
.------------------------------------------------------------
EDME0000  MATCH     "1",PTCNWSIN
          GOTO      EDME9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      EDME9999 IF NOT EQUAL
.
          CALL      EDMEHD00      * Output Table Heading
.
          PACK      KEY34,ECCLFBID,ECCLARID,ECCLCLID,ECCLRPTC,SP70
          CALL      RSWBIME1                     * position in file
EDME1000  CALL      RKWBIME1                     * read next record
          BRANCH    OVRCD,EDME9999               * end of file
.
          MATCH     ECCLFBID,WBIEFBID            * same fund brand id ?
          GOTO      EDME9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,WBIEARID            * same account ref. id ?
          GOTO      EDME9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBIECLID,WBIECLID,SP70
.
          MATCH     ECCLCLID,WBIECLID            * same fund ref. id ?
          GOTO      EDME1000 IF NOT EQUAL        * no - finished listing
.
          PACK      WBIERPTC,WBIERPTC,SP70
.
          MATCH     ECCLRPTC,WBIERPTC            * same report counter ?
          GOTO      EDME1000 IF NOT EQUAL        * no - finished listing
.
          CALL      EDMERW00
.
          GOTO      EDME1000
.
EDME9999  RETURN
.
.------------------------------------------------------------
. EDI Claim Explanation (TABLE HEADING)
.------------------------------------------------------------
EDMEHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare Assessment Event ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Card Flag Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Patient Status Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Status Text&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Member Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Member Ref Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Family Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Given Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Details&nbsp;</td>":
                             "</tr>"
.
EDMEHD99  RETURN
.------------------------------------------------------------
. EDI Assessment Report (Detail Row)
.------------------------------------------------------------
EDMERW00  WRITE     HTMLFILE;"<tr><td valign=top>",WBIEMEID,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIECFCD,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIECPSC,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIECPST,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIECPMN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIECPRN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIECPFN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBIECPGN,"</td>";
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=02":
                             "&template=006":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclfbid=",WBIEFBID:
                             "&ecclarid=",WBIEARID:
                             "&ecclclid=",WBIECLID:
                             "&ecclevtc=",WBIEMECN:
                             "&ecclrptc=",WBIERPTC,"#";'>":
                             "</td>":
                             "</tr>";
.
EDMERW99  RETURN
+
.------------------------------------------------------------
. Table of EDI Service Details
.------------------------------------------------------------
EDMS0000  MATCH     "1",PTCNWSIN
          GOTO      EDMS9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      EDMS9999 IF NOT EQUAL
.
          CALL      EDMSHD00      * Output Table Heading
.
          PACK      KEY38,ECCLFBID,ECCLARID,ECCLCLID,ECCLRPTC,ECCLEVTC,SP70
          CALL      RSWBIMF1                     * position in file
EDMS1000  CALL      RKWBIMF1                     * read next record
          BRANCH    OVRCD,EDMS9999               * end of file
.
          MATCH     ECCLFBID,WBIFFBID            * same fund brand id ?
          GOTO      EDMS9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,WBIFARID            * same account ref. id ?
          GOTO      EDMS9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLCLID,WBIFCLID            * same fund ref. id ?
          GOTO      EDMS9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLRPTC,WBIFRPTC            * same report counter ?
          GOTO      EDMS9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLEVTC,WBIFMECN            * same report counter ?
          GOTO      EDMS9999 IF NOT EQUAL
.
          CALL      EDMSRW00
.
          GOTO      EDMS1000
.
EDMS9999  RETURN
+
.------------------------------------------------------------
. EDI Service Details (TABLE HEADING)
.------------------------------------------------------------
EDMSHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Service ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Benefit&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Date Of Service&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Schedule Fee&nbsp;</td>":
                             "</tr>"
.
EDMSHD99  RETURN
+
.------------------------------------------------------------
. EDI Service Details (Detail Row)
.------------------------------------------------------------
EDMSRW00  WRITE     HTMLFILE;"<tr><td>",WBIFSVID,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIFSVBE
          REP       " 0",WBIFSVBE
          UNPACK    WBIFSVBE,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIFSVCA
          REP       " 0",WBIFSVCA
          UNPACK    WBIFSVCA,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIFSVDS
          IF        !@EQUAL & !@EOS
            UNPACK    WBIFSVDS,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIFSVEC,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIFSVIN,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIFSVSF
          REP       " 0",WBIFSVSF
          UNPACK    WBIFSVSF,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
EDMSRW99  RETURN
+
.------------------------------------------------------------
. Table of EDI Services Explanations
.------------------------------------------------------------
EDHE0000  MATCH     "1",PTCNWSIN
          GOTO      EDHE9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      EDHE9999 IF NOT EQUAL
.
          CALL      EDHEHD00      * Output Table Heading
.
          PACK      KEY34,ECCLFBID,ECCLARID,ECCLCLID,ECCLRPTC,SP70
          CALL      RSWBIMG1                     * position in file
EDHE1000  CALL      RKWBIMG1                     * read next record
          BRANCH    OVRCD,EDHE9999               * end of file
.
          MATCH     ECCLFBID,WBIGFBID            * same fund brand id ?
          GOTO      EDHE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,WBIGARID            * same account ref. id ?
          GOTO      EDHE9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBIGCLID,WBIGCLID,SP70
.
          MATCH     ECCLCLID,WBIGCLID            * same fund ref. id ?
          GOTO      EDHE1000 IF NOT EQUAL        * no - finished listing
.
          PACK      WBIGRPTC,WBIGRPTC,SP70
.
          MATCH     ECCLRPTC,WBIGRPTC            * same report counter ?
          GOTO      EDHE1000 IF NOT EQUAL        * no - finished listing
.
          CALL      EDHERW00
.
          GOTO      EDHE1000
.
EDHE9999  RETURN
+
.------------------------------------------------------------
. EDI Service Explanation (TABLE HEADING)
.------------------------------------------------------------
EDHEHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Health Fund Assessment Event ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Details&nbsp;</td>":
                             "</tr>"
.
EDHEHD99  RETURN
+
.------------------------------------------------------------
. EDI Services Explanations (Detail Row)
.------------------------------------------------------------
EDHERW00  WRITE     HTMLFILE;"<tr><td valign=top>",WBIGMEID,"</td>";
          WRITE     HTMLFILE;"<td valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=02":
                             "&template=007":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclfbid=",WBIGFBID:
                             "&ecclarid=",WBIGARID:
                             "&ecclclid=",WBIGCLID:
                             "&ecclevtc=",WBIGMECN:
                             "&ecclrptc=",WBIGRPTC,"#";'>":
                             "</td>":
                             "</tr>";
.
EDHERW99  RETURN
+
.*****************************************************************************
.*                          GBAE0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on pmsectaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBAE0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      EMECINVN,KEY8
          CALL      RDINV1
          IF        OVRCD = 1
            GOTO      GBAE9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR+PTINCRTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PTINGSTJ,FORM7P2O
          ENDIF
.
GBAE9999  RETURN
+
.*****************************************************************************
.*                          DFUE0000                                         *
.*****************************************************************************
.
DFUE0000  CALL      GBAE0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
DFUE9999  RETURN
+
.------------------------------------------------------------
. Eclipse Store and Forward Claim Full Details tags
.------------------------------------------------------------
ECFS0000  BRANCH    FLDITMNO,ECFS0100,ECFS0200,ECFS0300,ECFS0400,ECFS0500:
                             ECFS0600,ECFS0700,ECFS0800,ECFS0900,ECFS1000:
                             ECFS1100,ECFS1200,ECFS1300,ECFS1400,ECFS1500:
                             ECFS1600,ECFS1700,ECFS1800,ECFS1900,ECFS2000:
                             ECFS2100,ECFS2200,ECFS2300,ECFS2400,ECFS2500:
                             ECFS2600,ECFS2700,ECFS2800,ECFS2900,ECFS3000:
                             ECFS3100,ECFS3200,ECFS3300,ECFS3400,ECFS3500:
                             ECFS3600,ECFS3700
.
          GOTO      ECFS9999
.
ECFS0100  WRITE     HTMLFILE;FORM7P2O;
          GOTO      ECFS9999
.
ECFS0200  WRITE     HTMLFILE;STATDESC;
          GOTO      ECFS9999
.
ECFS0300
.         WRITE     HTMLFILE;CONTDESC;
          GOTO      ECFS9999
.
ECFS0400  
.         MATCH     SP70,WBIMPDAT
.         GOTO      ECFS9999 IF EQUAL
.         UNPACK    WBIMPDAT,CCENT,CYEAR,CMON,CDAY  * Payment Date
.         MOVE      CMON,F2
.         LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.         WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ECFS9999
.
ECFS0500  
.         WRITE     HTMLFILE;WBIMEETP;
          GOTO      ECFS9999
.
ECFS0600  
.         MATCH     "2",WBIMEETP
.         IF        @EQUAL
.           WRITE     HTMLFILE;"Medicare Only";
.         ELSE
.           PACK      KEY14,WBIMHFND,ZERO,ZERO,ZERO,ZERO,SP70
.           CALL      RDFUND1
.           IF        OVRCD=0
.             WRITE     HTMLFILE;HFNAME;
.           ENDIF
.         ENDIF
          GOTO      ECFS9999
.
ECFS0700  WRITE     HTMLFILE;EMECINVN;
          GOTO      ECFS9999
.
ECFS0800  WRITE     HTMLFILE;EMECBATN;
          GOTO      ECFS9999
.
ECFS0900  WRITE     HTMLFILE;EMECPBAT;
          GOTO      ECFS9999
.
ECFS1000  WRITE     HTMLFILE;EMECNBAT;
          GOTO      ECFS9999
.
ECFS1100  WRITE     HTMLFILE;EMECTRID;
          GOTO      ECFS9999
.
ECFS1200  
.         WRITE     HTMLFILE;WBIMFTID;
          GOTO      ECFS9999
.
ECFS1300  WRITE     HTMLFILE;EMECAMTC;
          GOTO      ECFS9999
.
ECFS1400  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVAMT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINITOT;
          ENDIF
          GOTO      ECFS9999
.
ECFS1500  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVPATA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINPAMT;
          ENDIF
          GOTO      ECFS9999
.
ECFS1600  
.         WRITE     HTMLFILE;PRINHAMT;
          GOTO      ECFS9999
.
ECFS1700  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVOTHA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINOTHA;
          ENDIF
          GOTO      ECFS9999
.
ECFS1800  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVJOUR;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINJAMT;
          ENDIF
          GOTO      ECFS9999
.
ECFS1900  WRITE     HTMLFILE;WBIMAMFP;
          GOTO      ECFS9999
.
ECFS2000  MATCH     SP70,EMECSTAT                * blank status ?
          GOTO      ECFS9999 IF EQUAL            * yes - don't display anything
          GOTO      ECFS9999 IF EOS
.
          MATCH     " 0",EMECSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed";
            GOTO      ECFS9999
          ENDIF
.
          GOTO      ECFS9999
.
ECFS2100  CALL      EDIS0000
          GOTO      ECFS9999
.
ECFS2200  
.         CALL      EDIP0000
          GOTO      ECFS9999
.
ECFS2300  
.         CALL      EDCE0000
          GOTO      ECFS9999
.
ECFS2400  
.         CALL      EDSD0000
          GOTO      ECFS9999
.
ECFS2500  
.         CALL      EDSE0000
          GOTO      ECFS9999
.
ECFS2600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PTINCRTT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINCNTT;
          ENDIF
          GOTO      ECFS9999
.
ECFS2700
.         WRITE     HTMLFILE;CFEETYP;
          GOTO      ECFS9999
.
ECFS2800  
.         WRITE     HTMLFILE;WBIMAMMP;
          GOTO      ECFS9999
.
ECFS2900  MATCH     "1",MAVMODUL
          IF        @EQUAL
            MOVE      "CL",CATEGORY
            MOVE      EMVICOMP,CODE
            CALL      CODITM00
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL          
            MOVE      "CL",CATEGORY         * claim code
            MOVE      PRHDCLAM,CODE
            CALL      CODITM00
          ENDIF
.
          GOTO      ECFS9999
.
ECFS3000  
.          UNPACK    DIM127,D1,KEY1,DIM127
.          MOVE      ZERO,F1
.          MOVE      KEY1,F1
.          BRANCH    F1,ECFS3010
. 
.          WRITE     HTMLFILE;PRHDHFND;
. 
.          GOTO      ECFS9999
.
.ECFS3010  MATCH     SP70,PRHDHFND
.          GOTO      ECFS9999 IF EQUAL
.          GOTO      ECFS9999 IF EOS
.
.          PACK      KEY14,PRHDHFND,ZERO,ZERO,ZERO,ZERO,SP70
.          CALL      RDFUND1
.          BRANCH    OVRCD,ECFS9999
.
.          WRITE     HTMLFILE;HFNAME;
.
          GOTO      ECFS9999
.
ECFS3100  WRITE     HTMLFILE;UNIQNUMB;
          GOTO      ECFS9999
.
ECFS3200  WRITE     HTMLFILE;PRHRE001;
          GOTO      ECFS9999
.
ECFS3300  WRITE     HTMLFILE;PRHRE002;
          GOTO      ECFS9999
.
ECFS3400  WRITE     HTMLFILE;PRHRE003;
          GOTO      ECFS9999
.
ECFS3500  WRITE     HTMLFILE;MAVMODUL;
          GOTO      ECFS9999
.
ECFS3600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;FOUR;
          ENDIF
          GOTO      ECFS9999
.
ECFS3700  MATCH     SP70,PRHRPIND
          GOTO      ECFS9999 IF EQUAL
          GOTO      ECFS9999 IF EOS
.
          MOVE      "GI",CATEGORY
          MOVE      PRHRPIND,CODE
.
          PACK      KEY5,CATEGORY,CODE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;TDESC;
          ENDIF
.
ECFS9999  RETURN
+
.------------------------------------------------------------
. Table of EDI History
.------------------------------------------------------------
EDIS0000  MATCH     "1",PTCNUESF
          GOTO      EDIS9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          CALL      EDISD000      * Output Table Heading
.
          PACK      KEY35,MAVINVCE,Z70
          CALL      RSEMECA3
EDIS1000  CALL      RPEMECA3
          BRANCH    OVRCD,EDIS9999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     MAVINVCE,EMEAINVN
          GOTO      EDIS9999 IF NOT EQUAL
.
          MATCH     MAVMODUL,EMEAMODL
          GOTO      EDIS1000 IF NOT EQUAL
.
          CALL      EDSRW000
.
          GOTO      EDIS1000
.
EDIS9999  RETURN
.------------------------------------------------------------
. EDI History (TABLE HEADING)
.------------------------------------------------------------
EDISD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Time</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Status</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Transaction Type</td>":
                             "<td class=HeadingCell width=10%>":
                             "Batch</td>":
                             "<td class=HeadingCell width=10%>":
                             "Reviewed By</td>":
                             "<td class=HeadingCell width=35%>":
                             "Error Code Description</td>":
                             "</tr>"
.
EDISD999  RETURN
.------------------------------------------------------------
. EDI History (Detail Row)
.------------------------------------------------------------
EDSRW000  MOVE      SP70,DIM11
          MATCH     SP70,EMEADATE
          IF        !@EQUAL & !@EOS
            UNPACK    EMEADATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMEASTAT,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          MOVE      SP30,TYPEDESC
          MOVE      EMEATYPE,TYPOFREQ
          LOAD      TYPEDESC,TYPOFREQ,TYPEDSF1,TYPEDSF2,TYPEDSF3
          IF        TYPOFREQ = 2 | TYPOFREQ = 3
            STRIP     TYPEDESC
            ENDSET    TYPEDESC
            APPEND    SP1,TYPEDESC
            APPEND    EMEAEROR,TYPEDESC
            APPEND    SP20,TYPEDESC
            RESET     TYPEDESC
          ENDIF
.
          MOVE      SP70,DIM30
          PACK      KEY10,EMEAOPER,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      EMEAOPER,DIM30
          ELSE
            MATCH     EMEAOPER,WBSEUID
            IF        @EQUAL
              MOVE      WBSENAM,DIM30
            ELSE
              MOVE      EMEAOPER,DIM30
            ENDIF
          ENDIF
.
          CMATCH    NULL,EMEAEROT
          IF        @EQUAL
            PACK      EMEAEROT,SP70,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",DIM11 ,"</td>";
          WRITE     HTMLFILE;"<td>",EMEATIME,"</td>";
          WRITE     HTMLFILE;"<td>",STATDESC,"</td>":
                             "<td>",TYPEDESC,"</td>":
                             "<td>",EMEABATN,"</td>":
                             "<td>",DIM30,"</td>":
                             "<td>",EMEAEROT,"</td>":
                             "</tr>";
.
EDSRW999  RETURN
.
.------------------------------------------------------------
. Eclipse STF Claim Enquiries
.------------------------------------------------------------
EMSE0000  MATCH     "1",PTCNUESF
          GOTO      EMSE9200 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      EMSE6000 IF EQUAL

          MATCH     "V",UPDATTYP
          GOTO      EMSE1000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      EMSE2000 IF EQUAL
.
          MATCH     "D",UPDATTYP
          GOTO      EMSE3000 IF EQUAL
.
          MATCH     "P",UPDATTYP
          GOTO      EMSE4000 IF EQUAL
.
          MATCH     "S",UPDATTYP
          GOTO      EMSE5000 IF EQUAL
.
          GOTO      EMSE9000
.
EMSE1000  CALL      MINS0000
          GOTO      EMSE9999
.
EMSE2000  CALL      RSUS0000
          GOTO      EMSE9999
.
EMSE3000  CALL      WDES0000
          GOTO      EMSE9999
.
EMSE4000  CALL      OTPC0000
          GOTO      EMSE9999
.
EMSE5000  
.         CALL      RSET0000
          GOTO      EMSE9999
.
EMSE6000  MOVE      TEMPLATE,FORM3
          IF        THREE=FORM3
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,EMSE9100
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDPMPX21
            BRANCH    OVRCD,EMSE9100
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE                   * CALCAGE uses PBDATE
.
            CALL      PATLN000
            CALL      PATFLD00                * Use standard Patient Folder sub
.
            MOVE      URNUMBER,FILTURNO
.           MOVE      UNIQNUMB,FILTADMN
.
            IF        ALLHFLAG=0
              COMPARE   ONE,IBCNMHOS
              IF        @EQUAL
                MOVE      TWO,VIEWTYPE
                MOVE      ZERO,EXDTBLNK
              ELSE
                MOVE      ZERO,VIEWTYPE
                MOVE      ONE,EXDTBLNK
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
.
          MOVE      "Eclipse PCS Claim Enquiry",WEBTITLE
.
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,EMSE9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      EMSE9999
.
EMSE9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMSE9999
.
EMSE9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMSE9999
.
EMSE9200  MOVE      "Not using Eclipse Store and Forward Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMSE9999
.
EMSE9999  RETURN
+
.------------------------------------------------------------
. Eclipse STF Claim Enquiries tags
.------------------------------------------------------------
ECCS0000  BRANCH    FLDITMNO,ECCS0100,ECCS0200,ECCS0300,ECCS0400,ECCS0500:
                             ECCS0600,ECCS0700,ECCS0800,ECCS0900,ECCS1000:
                             ECCS1100,ECCS1200,ECCS1300,ECCS1400,ECCS1500:
                             ECCS1600,ECCS1700,ECCS1800,ECCS1900,ECCS2000:
                             ECCS2100,ECCS2200,ECCS2300,ECCS2400,ECCS2500:
                             ECCS2600,ECCS2700
.
          GOTO      ECCS9999
.
ECCS0100  CALL      ECSP0000
          GOTO      ECCS9999
.
ECCS0200  WRITE     HTMLFILE;IBCNMHOS;    * Multihospital Indicator
          GOTO      ECCS9999
.
ECCS0300  CALL      HOSPID00              * Hospital ID option field
          GOTO      ECCS9999
.
ECCS0400  CALL      SELHFN00              * Health Fund option field
          GOTO      ECCS9999
.
ECCS0500  WRITE     HTMLFILE;HLFDCLTY;
          GOTO      ECCS9999
.
ECCS0600  MOVE      CATCL,CATEGORY
          MOVE      HLTHFUND,CODE
          CALL      CODITM00
          GOTO      ECCS9999
.
ECCS0700  WRITE     HTMLFILE;EXCLWAIT;
          GOTO      ECCS9999
.
ECCS0800  WRITE     HTMLFILE;FILTURNO;
          GOTO      ECCS9999
.
ECCS0900  WRITE     HTMLFILE;FILTADMN;
          GOTO      ECCS9999
.
ECCS1000  WRITE     HTMLFILE;BATCHNUM;
          GOTO      ECCS9999
.
ECCS1100  WRITE     HTMLFILE;CLAIMSTA;
          GOTO      ECCS9999
.
ECCS1200  WRITE     HTMLFILE;INVNUMBR;
          GOTO      ECCS9999
.
ECCS1300  CALL      SELP0000
          GOTO      ECCS9999
.
ECCS1400  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      ECCS9999
.
ECCS1500  WRITE     HTMLFILE;EXDTBLNK;
          GOTO      ECCS9999
.
ECCS1600  WRITE     HTMLFILE;HLTHFUND;
          GOTO      ECCS9999
.
ECCS1700  CALL      PRVE0000
          GOTO      ECCS9999
.
ECCS1800  CALL      NXTE0000
          GOTO      ECCS9999
.
ECCS1900  CALL      BATTS000
          GOTO      ECCS9999
.
ECCS2000  CALL      PREVBT00
          GOTO      ECCS9999
.
ECCS2100  CALL      NEXTBT00
          GOTO      ECCS9999
.
ECCS2200  
.         CALL      ECOT0000
          GOTO      ECCS9999
.
ECCS2300  WRITE     HTMLFILE;PROCSTAT;
          GOTO      ECCS9999
.
ECCS2400  CALL      ECPP0000
          GOTO      ECCS9999
.
ECCS2500  WRITE     HTMLFILE;EXCLCLOS;
          GOTO      ECCS9999
.
ECCS2600  CALL      ECSE0000
          GOTO      ECCS9999
.
ECCS2700  CALL      ECEP0000
          GOTO      ECCS9999
.
ECCS9999  RETURN
+
.------------------------------------------------------------
. Table of Eclipse STF Claim Enquiries Private Practice
.------------------------------------------------------------
ECSP0000  MATCH     "1",PTCNUESF
          GOTO      ECSP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      ECSP9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      ECSP9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSEMIBH2
ECSP0500  CALL      RKEMIBH2
          BRANCH    OVRCD,ECSP2000
          MATCH     EMIBDTBC,LASTDATE
          GOTO      ECSP2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,EMIBBTHN,SP70
          CALL      RSEMECT3
ECSP1000  CALL      RKEMECT3
          BRANCH    OVRCD,ECSP0500
          MATCH     EMIBBTHN,EMECBATN
          GOTO      ECSP0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",EMECMODL
          GOTO      ECSP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,EMECHOSP
              GOTO      ECSP1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,EMECHOSP
                GOTO      ECSP1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      ECSP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      ECSP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   FIVE,EMECFLAG
            GOTO      ECSP1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        WBIMFLAG=ZERO
.             GOTO      ECSP1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,EMECURNO
            GOTO      ECSP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECSP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECSP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECSP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECSP1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,ECSP1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      ECSP1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      ECSP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBS0000
.
          CALL      GBAP0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,EMECUNIQ,EMECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECSP1500
.
          MATCH     EMECUNIQ,DPRDTUNQ
          GOTO      ECSP1500 IF NOT EQUAL
.
          MATCH     EMECINVN,PRDTINVN
          GOTO      ECSP1500 IF NOT EQUAL
.
          GOTO      ECSP1600
.
ECSP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECSP1600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        EMECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECSP1000
.
ECSP2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      ECSP9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSEMECT3
ECSP3000  CALL      RKEMECT3
          BRANCH    OVRCD,ECSP9000
          MATCH     SP70,EMECBATN
          GOTO      ECSP9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",EMECMODL
          GOTO      ECSP3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,EMECHOSP
              GOTO      ECSP3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,EMECHOSP
                GOTO      ECSP3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      ECSP3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      ECSP3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        EMECFLAG=FIVE
              GOTO      ECSP3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        EMECFLAG=ZERO
              GOTO      ECSP3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,EMECURNO
            GOTO      ECSP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECSP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECSP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECSP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECSP3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,ECSP1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      ECSP1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      ECSP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBS0000
.
          CALL      GBAP0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,EMECUNIQ,EMECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECSP3500
.
          MATCH     EMECUNIQ,DPRDTUNQ
          GOTO      ECSP3500 IF NOT EQUAL
.
          MATCH     EMECINVN,PRDTINVN
          GOTO      ECSP3500 IF NOT EQUAL
.
          GOTO      ECSP3600
.
ECSP3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECSP3600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        EMECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECSP3000
.
ECSP9000
ECSP9999  RETURN
+
.*****************************************************************************
.*                          RSBS0000                                         *
.*****************************************************************************
RSBS0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,EMECNBAT                 * next batch blank ?
          GOTO      RSBS9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        EMECFLAG <> 5 & EMECFLAG <> 3
            GOTO      RSBS9000
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,RSBS9000
.
          CALL      GBAP0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSBS9000
          ENDIF
.
          PACK      KEY17,EMECINVN,SP8,TWO,SP70
          CALL      RAEMECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBS9000
          ENDIF
.
          GOTO      RSBS9999
.
RSBS9000  MOVE      ONE,RSUBINDI
RSBS9999  RETURN
.
.------------------------------------------------------------
. Table of Eclipse STF Claim Enquiries Emergency
.------------------------------------------------------------
ECSE0000  MATCH     "1",PTCNUESF
          GOTO      ECSE9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      ECSE9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      ECSE9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSEMIBH2
ECSE0500  CALL      RKEMIBH2
          BRANCH    OVRCD,ECSE2000
          MATCH     EMIBDTBC,LASTDATE
          GOTO      ECSE2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,EMIBBTHN,SP70
          CALL      RSEMECT3
ECSE1000  CALL      RKEMECT3
          BRANCH    OVRCD,ECSE0500
          MATCH     EMIBBTHN,EMECBATN
          GOTO      ECSE0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "1",EMECMODL
          GOTO      ECSE1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,EMECHOSP
              GOTO      ECSE1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,EMECHOSP
                GOTO      ECSE1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      ECSE1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      ECSE1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   FIVE,EMECFLAG
            GOTO      ECSE1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        WBIMFLAG=ZERO
.             GOTO      ECSE1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,EMECURNO
            GOTO      ECSE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECSE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECSE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECSE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECSE1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,ECSE1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      ECSE1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      ECSE1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBE0000
.
          CALL      GBAE0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,EMECINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,EMECUNIQ,EMECINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,ECSE1500
.
.         MATCH     EMECUNIQ,DPRDTUNQ
.         GOTO      ECSE1500 IF NOT EQUAL
.
.         MATCH     EMECINVN,PRDTINVN
.         GOTO      ECSE1500 IF NOT EQUAL
.
.         GOTO      ECSE1600
.
ECSE1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECSE1600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.              
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        EMECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECSE1000
.
ECSE2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      ECSE9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSEMECT3
ECSE3000  CALL      RKEMECT3
          BRANCH    OVRCD,ECSE9000
          MATCH     SP70,EMECBATN
          GOTO      ECSE9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "1",EMECMODL
          GOTO      ECSE3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,EMECHOSP
              GOTO      ECSE3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,EMECHOSP
                GOTO      ECSE3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      ECSE3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      ECSE3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        EMECFLAG=FIVE
              GOTO      ECSE3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        EMECFLAG=ZERO
              GOTO      ECSE3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,EMECURNO
            GOTO      ECSE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECSE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECSE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECSE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECSE3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,ECSE1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      ECSE1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      ECSE1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBE0000
.
          CALL      GBAE0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,EMECINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,EMECUNIQ,EMECINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,ECSE3500
.
.         MATCH     EMECUNIQ,DPRDTUNQ
.         GOTO      ECSE3500 IF NOT EQUAL
.
.         MATCH     EMECINVN,PRDTINVN
.         GOTO      ECSE3500 IF NOT EQUAL
.
.         GOTO      ECSE3600
.
ECSE3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECSE3600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        EMECFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECSE3000
.
ECSE9000
ECSE9999  RETURN
+
.*****************************************************************************
.*                          RSBE0000                                         *
.*****************************************************************************
RSBE0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,EMECNBAT                 * next batch blank ?
          GOTO      RSBE9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        EMECFLAG <> 5 & EMECFLAG <> 3
            GOTO      RSBE9000
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDINV1
          BRANCH    OVRCD,RSBE9000
.
          CALL      GBAE0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PINVAMT > 0)
            GOTO      RSBE9000
          ENDIF
.
          PACK      KEY17,EMECINVN,SP8,ONE,SP70
          CALL      RAEMECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBE9000
          ENDIF
.
          GOTO      RSBE9999
.
RSBE9000  MOVE      ONE,RSUBINDI
RSBE9999  RETURN
+
.------------------------------------------------------------
. Validate Batch Number PCIW
. INPUTS: BATCHNUM - Batch Number
.------------------------------------------------------------
VALBAS00  CALL      XMLHED00
          BRANCH    EXIT,VALBAS99
.
          MATCH     "1",PTCNWSIN
          GOTO      VALBAS91 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      VALBAS91 IF NOT EQUAL
.
          PACK      KEY24,BATCHNUM,SP70
          CALL      RSWBPCI3
          CALL      RKWBPCI3
          BRANCH    OVRCD,VALBAS90
.
          MATCH     WBPIBATN,BATCHNUM
          GOTO      VALBAS90 IF NOT EQUAL
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALBAS98
.
VALBAS90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Batch number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAS98
.
VALBAS91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Not using PCIW Module. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAS98
.
VALBAS98  CALL      XMLEND00
VALBAS99  RETURN
+
.------------------------------------------------------------
. Validate Unique/Admission Number STF
. INPUTS: UNIQNUMB - Batch Number
.------------------------------------------------------------
VALUNS00  CALL      XMLHED00
          BRANCH    EXIT,VALUNS99
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,VALUNS20
.
          GOTO      VALUNS50  
.
VALUNS20  PACK      KEY8,UNIQNUMB,SP70
          CALL      RDEMVIS1
          BRANCH    OVRCD,VALUNS90
.
          GOTO      VALUNS50
.
.  Dummy ouput for valid Code
.
VALUNS50  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALUNS98
.
VALUNS90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Unique number / Admission Number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALUNS98
.
VALUNS98  CALL      XMLEND00
VALUNS99  RETURN
+
.*****************************************************************************
.*                          MINS0000                                         *
.*****************************************************************************
.
.         First, get the last EDI History record for this invoice
.
MINS0000  PACK      KEY27,MAVINVCE,Z70
          CALL      RSEMECA1                     * position on last history rec
MINS0010  CALL      RPEMECA1                     * read previous record
          BRANCH    OVRCD,MINS3000               * eof - finished
.
          MATCH     MAVINVCE,EMEAINVN            * same invoice still ?
          GOTO      MINS3000 IF NOT EQUAL        * no - finished
.
          MATCH     MAVMODUL,EMECMODUL
          GOTO      MINS0010 IF NOT EQUAL
.
.         Read emrectaf
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDEMECT2
          BRANCH    OVRCD,MINS3000
.
.         The last EDI history record has been found for the invoice, so
.         write a new record, defaulting some of the values from the read
.         record.
.
          MOVE      MAVBATCH,EMEABATN
          MOVE      MAVINVCE,EMEAINVN
          MOVE      MAVMODUL,EMEAMODL
.
MINS1000  CALL      IBACLOCK                     * get current date/time
          PACK      EMEADATE,CCC,CYY,CMM,CDD
          REP       " 0",EMEADATE
          MOVE      CTIMEIS,EMEATIME
          REP       " 0",EMEATIME
.
          MOVE      " 5",EMEATYPE
          MOVE      WBSEUID,EMEAOPER
          MOVE      SP70,EMEASPAR
.
          PACK      KEY27,EMEAINVN,EMEADATE,EMEATIME,EMEATYPE,EMEAMODL,SP70
          CALL      RAEMECA1
          IF        OVRCD = 0
            GOTO      MINS1000
          ENDIF
.
          CALL      WREMECA1                     * write EDI History record
.
.         If the record has a status of 
.         "Error (SA validation)"
.         then update the status to "Closed", as the claim cannot go any
.         further (unless resubmitted after closing).
.
          IF        EMECFLAG = 3
            PACK      KEY30,EMECHOSP,EMECFLAG,EMECMODL,EMECUNIQ,EMECINVN:
                            EMECBATN,SP70
            CALL      RDEMECT1                   * read selected record
            BRANCH    OVRCD,MINS3000             * shouldn't happen
.
            MOVE      FIVE,EMECFLAG              * update to "closed"
            CALL      UPEMECT1
.
.           Also write an EDI History record (emrecaaf) for the close
.
            MOVE      EMECINVN,EMEAINVN
            MOVE      EMECBATN,EMEABATN
            MOVE      FIVE,EMEASTAT
            MOVE      " 1",EMEATYPE
            MOVE      WBSEUID,EMEAOPER
            MOVE      EMECTRID,EMEATRID
            MOVE      SP30,EMEASPAR
.
MINS2000    CALL      IBACLOCK                   * get current time
            PACK      EMEADATE,CCC,CYY,CMM,CDD
            REP       " 0",EMEADATE
            MOVE      CTIMEIS,EMEATIME
            REP       " 0",EMEATIME
.
            PACK      KEY27,EMEAINVN,EMEADATE,EMEATIME,EMEATYPE,EMEAMODL,SP70
            CALL      RAEMECA1
            IF        OVRCD = 1
              CALL      WREMECA1
            ELSE
              GOTO      MINS2000
            ENDIF
.
            GOTO      MINS9000
          ELSE
            GOTO      MINS9000
          ENDIF
.
MINS3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      MINS9100
.
MINS9000  MOVE      ZERO,EXIT
          GOTO      MINS9999
.
MINS9100  MOVE      ONE,EXIT
.
MINS9999  RETURN
+
.*****************************************************************************
.*                               RSUS0000                                    *
.*                  Process resubmission selection                           *
.*****************************************************************************
RSUS0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDEMECT2
          BRANCH    OVRCD,RSUS7000
.
.         Check if the record has already been resubmitted
.
          MATCH     SP8,EMECNBAT                 * next batch blank ?
          IF        !@EQUAL
            GOTO      RSUS8000
          ENDIF
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
.         IF        EMECFLAG <> 19 & EMECFLAG <> 3
.           GOTO      RSUS7000
.         ENDIF
.
          IF        EMECFLAG = 5 | EMECFLAG = 3
.
            PACK      KEY27,EMECINVN,Z70
            CALL      RSEMECA1
RSUS2100    CALL      RPEMECA1
            BRANCH    OVRCD,RSUS2500
.
            MATCH     EMECINVN,EMEAINVN
            GOTO      RSUS2500 IF NOT EQUAL
.
            MATCH     EMECMODL,EMEAMODL
            GOTO      RSUS2100 IF NOT EQUAL
.
            MATCH     EMECTRID,EMEATRID
            GOTO      RSUS2100 IF NOT EQUAL
.
            COMPARE   THREE,EMEASTAT
            GOTO      RSUS2100 IF NOT EQUAL
.
            MATCH     " 2",EMEATYPE
            GOTO      RSUS2100 IF NOT EQUAL
.
            MATCH     "3002",EMEAEROR
            GOTO      RSUS2100 IF NOT EQUAL
.
            MOVE      ZERO,FORM8A
.
            CALL      IBACLOCK
.
            PACK      CURRDATE,CCC,CYY,CMM,CDD
            REP       " 0",CURRDATE
.
            DAYSEP    EMEADATE,CURRDATE,FORM8A
.
            COMPARE   FORM8A,ONE
            GOTO      RSUS2500 IF EQUAL
            GOTO      RSUS2500 IF LESS
.
            GOTO      RSUS7500
.
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RSUS2500  MATCH     "1",EMECMODL
          IF        @EQUAL
.
            PACK      KEY8,EMECINVN,SP70
            CALL      RDINV1
            IF        OVRCD = 1
              GOTO      RSUS6000
            ENDIF
.
            CALL      GBAE0000                    * get outstanding inv. balance
.
          ELSE
.
            PACK      KEY8,EMECINVN,SP70
            CALL      RDPRIN1
            IF        OVRCD = 1
              GOTO      RSUS6000
            ENDIF
.
            CALL      GBAP0000                    * get outstanding inv. balance
.
          ENDIF
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission (CAR 181439)
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSUS5000
          ENDIF
.
          PACK      KEY17,EMECINVN,SP8,EMECMODL,SP70
          CALL      RAEMECT2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSUS4000
          ENDIF
.
          MOVE      ZERO,EMECFLAG
          MOVE      SP70,EMECBATN
          MOVE      MAVBATCH,EMECPBAT
          MOVE      SP70,EMECNBAT
.         MOVE      SP70,EMECCCFL
          MOVE      SP70,EMECTRID
          MOVE      ZERO,EMECAMTC
.         MOVE      ZERO,EMECAMFP
.         MOVE      ZERO,EMECAMMP
.         MOVE      SP70,EMECPDAT
          MOVE      SP70,EMECSTAT
.         MOVE      SP70,EMECFTID
          MOVE      SP70,EMECSPAR
.
          PACK      KEY17,EMECINVN,EMECBATN,EMECMODL,SP70
          CALL      RAEMECT2
          IF        OVRCD = 1
            CALL      WREMECT1                   * write record
          ELSE
            GOTO      RSUS4000
          ENDIF
.
.         Update the selected record with the next batch no. of "00000000".
.         The record will either have a status of "closed" already, or
.         "SA Validation Error".  If it's the latter, then update the status to
.         "closed" as well"
.
.         PACK      KEY35,WBIMHOSP,TEN9,WBIMHFND,WBIMUNIQ,WBIMINVN,MAVBATCH,SP70
.         CALL      RDWBIMC1
.         IF        OVRCD = 1
.    PACK      KEY35,WBIMHOSP,SP1,THREE,WBIMHFND,WBIMUNIQ,WBIMINVN,MAVBATCH,SP70
.           CALL      RDWBIMC1
.           IF        OVRCD = 1
.             GOTO      RSUS3000
.           ELSE
.             MOVE      TEN9,WBIMFLAG            * set status to closed
.           ENDIF
.         ENDIF
.
          PACK      KEY17,EMECINVN,MAVBATCH,MAVMODUL,SP70
          CALL      RDEMECT2
          IF        OVRCD = 1
            CALL      RSUS3000                   * write record
          ELSE
            MOVE      FIVE,EMECFLAG            * set status to closed
          ENDIF
.
          MOVE      "00000000",EMECNBAT
          CALL      UPEMECT2
.
          GOTO      RSUS9999
.
RSUS3000  CLEAR     WEBTITLE
          APPEND    "Error updating Invoice ",WEBTITLE
          APPEND    EMECINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    EMECBATN,WEBTITLE
          APPEND    " Module ",WEBTITLE
          APPEND    EMECMODL,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS4000  MOVE      "Invoice already waiting for extraction.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS5000  MOVE      "Claim fully paid.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS6000  CLEAR     WEBTITLE
          APPEND    "Invoice ",WEBTITLE
          APPEND    EMECINVN,WEBTITLE
          APPEND    " not found.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS7000  MOVE      "Claim not not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS7500  MOVE      "Error 3002. Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS8000  MOVE      "Invoice already resubmitted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUS9000
.
RSUS9000  MOVE      ONE,EXIT
RSUS9999  RETURN
+
.*****************************************************************************
.*                               WDES0000                                    *
.*                  Process delete records waiting                           *
.*****************************************************************************
WDES0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDEMECT2
          BRANCH    OVRCD,WDES8000
.
          MOVE      EMECINVN,TEMPINVN
          MOVE      EMECBATN,TEMPBATN
          MOVE      EMECUNIQ,TEMPADMN
          MOVE      EMECURNO,TEMPURNO
          MOVE      EMECMODL,TEMPMODL
          MOVE      EMECPBAT,TEMPPBAT
          MOVE      EMECHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      WDES1000 IF EQUAL
          GOTO      WDES1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,SP1,FIVE,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDEMECT1
          IF        OVRCD = 1
            GOTO      WDES7000
          ELSE
            MOVE      SP70,EMECNBAT
            CALL      UPEMECT1
          ENDIF
.
.         Delete the selected record
.
WDES1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEEMECT1
.
          GOTO      WDES9999
.
WDES7000  CLEAR     WEBTITLE
          APPEND    "Error updating previous claim ",WEBTITLE
          APPEND    EMECINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    EMECBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      WDES9000
.
WDES8000  MOVE      "Record cannot be deleted.",WEBTITLE
          CALL      WEBERR00
          GOTO      WDES9000
.
WDES9000  MOVE      ONE,EXIT
WDES9999  RETURN
+
.------------------------------------------------------------
. Table of Batch Numbers STF
.------------------------------------------------------------
BATTS000  MATCH     "1",PTCNUESF
          GOTO      BATTS999 IF NOT EQUAL
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BATHS000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70
          CALL      RSEMIBH1                     * position in file
BATTS100  CALL      RPEMIBH1                     * read previous record
          BRANCH    OVRCD,BATTS999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BATTS100
          ENDIF
.
          CALL      BASRW000      * Display Row
          BRANCH    EXIT,BATTS100
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BATTS100 IF NOT EQUAL
.
BATTS999  RETURN
+
.------------------------------------------------------------
. Batch Numbers by Code (TABLE HEADING) STF
.------------------------------------------------------------
BATHS000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Batch Number</td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=25%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Date</td>":
                             "<td class=HeadingCell width=15%>":
                             "Time</td>":
.                            "<td class=HeadingCell width=15%>":
.                            "Status</td>":
                             "</tr>"
.
BATHS999  RETURN
+
.------------------------------------------------------------
. Batch Numbers (TABLE ROW) STF
.------------------------------------------------------------
BASRW000  MOVE      ZERO,EXIT
          PACK      BTSCHOSP,BTSCHOSP,SP70
.
          UNPACK    EMIBDTBC,CCENT,CYEAR,CMON,CDAY  * Batch Created Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    EMIBTMBC,DIM5,ANS,ANS,ANS
.
          MOVE      SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      BASRW500 IF NOT EQUAL
.
          PACK      KEY24,EMIBBTHN,SP30         * get Hospital for given Batch
          CALL      RSEMECT3
          CALL      RKEMECT3
          IF        OVRCD=1
            MOVE      ONE,EXIT
            GOTO      BASRW999
          ENDIF
.
          MATCH     EMIBBTHN,EMECBATN
          IF        @EQUAL
            MOVE      EMECHOSP,KEY3
            CALL      RDPTHSP1            * read Hospital name for visit
            IF        OVRCD=1
              MOVE      EMECHOSP,HOSPNAME
            ELSE
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
.
            MATCH     SP70,BTSCHOSP
            IF        !@EQUAL&!@EOS
              MATCH     BTSCHOSP,EMECHOSP
              IF        !@EQUAL
                MOVE      ONE,EXIT
                GOTO      BASRW999
              ENDIF
            ENDIF
          ELSE
            MOVE      ONE,EXIT
            GOTO      BASRW999
          ENDIF
.
BASRW500  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",EMIBBTHN,"#")'>":
                             EMIBBTHN,"</a></td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",KEY11,"</td>":
                             "<td>",DIM5,"</td>":
                             "</tr>";
.
BASRW999  RETURN
+
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries STF Patient Level Priv Prac
.------------------------------------------------------------
ECPP0000  MATCH     "1",PTCNUESF
          GOTO      ECPP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.         MATCH     SP70,HOSPCODE
.         IF        @EQUAL
.           MOVE      WBSEHOSP,HOSPCODE
.         ENDIF
.
.         PACK      KEY35,HOSPCODE,FILTURNO,SP70
          PACK      KEY35,SP3,FILTURNO,SP70
          CALL      RSEMECT5
ECPP1000  CALL      RKEMECT5
          BRANCH    OVRCD,ECPP9999
          MATCH     FILTURNO,EMECURNO
          GOTO      ECPP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",EMECMODL
          GOTO      ECPP1000 IF NOT EQUAL
.
.         IF        IBCNMHOS=ONE
.           MATCH     SP70,HOSPCODE
.           IF        !@EQUAL & !@EOS
.             MATCH     HOSPCODE,EMECHOSP
.             GOTO      ECPP9999 IF NOT EQUAL
.           ELSE
.             IF        ALLHFLAG<>ONE
.               MATCH     WBSEHOSP,EMECHOSP
.               GOTO      ECPP9999 IF NOT EQUAL
.             ENDIF
.           ENDIF
..
.           MATCH     SP70,FILTURNO
.           IF        !@EQUAL & !@EOS
.             MATCH     FILTURNO,EMECURNO
.             GOTO      ECPP1000 IF NOT EQUAL
.           ENDIF
.
.         ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,EMECURNO
              GOTO      ECPP9999 IF NOT EQUAL
            ENDIF
.
.         ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      ECPP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      ECPP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        EMECFLAG=ZERO
              GOTO      ECPP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECPP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,EMECBATN,SP70
            CALL      RDEMIBH1
            BRANCH    OVRCD,ECPP1000
.
            MATCH     FRSTDATE,EMIBDTBC
            GOTO      ECPP1000 IF LESS
.
            MATCH     EMIBDTBC,LASTDATE
            GOTO      ECPP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBS0000
.
          CALL      GBAP0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,EMECUNIQ,EMECINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,ECPP1500
.
          MATCH     EMECUNIQ,DPRDTUNQ
          GOTO      ECPP1500 IF NOT EQUAL
.
          MATCH     EMECINVN,PRDTINVN
          GOTO      ECPP1500 IF NOT EQUAL
.
          GOTO      ECPP1600
.
ECPP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECPP1600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECPP1000
.
ECPP9999  RETURN
+
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries STF Patient Level Emergency
.------------------------------------------------------------
ECEP0000  MATCH     "1",PTCNUESF
          GOTO      ECEP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     SP70,HOSPCODE
          IF        @EQUAL
            MOVE      WBSEHOSP,HOSPCODE
          ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSEMECT5
ECEP1000  CALL      RKEMECT5
          BRANCH    OVRCD,ECEP9999
          MATCH     FILTURNO,EMECURNO
          GOTO      ECEP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "1",EMECMODL
          GOTO      ECEP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,EMECHOSP
              GOTO      ECEP9999 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,EMECHOSP
                GOTO      ECEP9999 IF NOT EQUAL
              ENDIF
            ENDIF
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,EMECURNO
              GOTO      ECEP1000 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,EMECURNO
              GOTO      ECEP9999 IF NOT EQUAL
            ENDIF
.
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      ECEP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      ECEP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        EMECFLAG=ZERO
              GOTO      ECEP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,EMECUNIQ
            GOTO      ECEP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,EMECBATN
            GOTO      ECEP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DEMECFLG
            GOTO      ECEP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,EMECINVN
            GOTO      ECEP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,EMECBATN,SP70
            CALL      RDEMIBH1
            BRANCH    OVRCD,ECEP1000
.
            MATCH     FRSTDATE,EMIBDTBC
            GOTO      ECEP1000 IF LESS
.
            MATCH     EMIBDTBC,LASTDATE
            GOTO      ECEP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,EMECINVN,Z70
          CALL      RSEMECA3
          CALL      RPEMECA3
          IF        OVRCD=0
            MATCH     EMECINVN,EMEAINVN
            IF        @EQUAL
              MATCH     " 1",EMEATYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,EMECFLAG,STATSF01,STATSF02,STATSF03,STATSF04:
                                      STATSF05
.
          CALL      RSBE0000
.
          CALL      GBAE0000
.
          MOVE      EMECURNO,URNUMBER
.         MOVE      EMECUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,EMECINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,EMECUNIQ,EMECINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,ECEP1500
.
.         MATCH     EMECUNIQ,DPRDTUNQ
.         GOTO      ECEP1500 IF NOT EQUAL
.
.         MATCH     EMECINVN,PRDTINVN
.         GOTO      ECEP1500 IF NOT EQUAL
.
.         GOTO      ECEP1600
.
ECEP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
ECEP1600  REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    EMECURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    EMECUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    EMECBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    EMECINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    EMECMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    EMECURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",EMECBATN,"#",":
                             "#"",EMECUNIQ,"#",":
                             "#"",EMECINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",EMECAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",EMECPBAT,"#",":
                             "#"",EMECNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,EMECBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,EMECNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",EMECBATN,EMECINVN,EMECMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        EMECFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",EMECBATN,EMECINVN,EMECMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      EMECBATN,DIM8
          REP       " +",EMECURNO
          REP       " +",EMECUNIQ
          REP       " +",EMECBATN
          REP       " +",EMECINVN
          REP       " +",EMECMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
EMECBATN,"','",EMECUNIQ,"','",EMECURNO,"','",EMECINVN,"','",EMECMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",EMECURNO
          REP       "+ ",EMECUNIQ
          REP       "+ ",EMECBATN
          REP       "+ ",EMECINVN
          REP       "+ ",EMECMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      ECEP1000
.
ECEP9999  RETURN
+
.------------------------------------------------------------
. Eclipse Claimant NOI Functionality
.------------------------------------------------------------
CLMT0000  MATCH     "1",PTCNUESF
          GOTO      CLMT9200 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      CLMT6000 IF EQUAL

          MATCH     "E",UPDATTYP
          GOTO      CLMT1000 IF EQUAL
.
          GOTO      CLMT9000
.
CLMT1000  CALL      BSBAU000
          GOTO      CLMT9999
.
CLMT6000 CLEAR     WEBTITLE
.
          MOVE      "Eclipse BSB Collection",WEBTITLE
.
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,CLMT9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
CLMT9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
CLMT9200  MOVE      "Not using Eclipse Store and Forward Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
CLMT9999  RETURN
+
.------------------------------------------------------------
. Write/Update Eclipse BSB Claiment Details
.------------------------------------------------------------
BSBAU000  MATCH     Z70,PMCLT001
          GOTO      BSBAU999 IF EQUAL
.
          MATCH     Z70,PMCLT002
          GOTO      BSBAU999 IF EQUAL
.
          RJUSTIFY  PMCLT002
.
          PACK      KEY9,PMCLT001,PMCLT002,SP70
          CALL      RDPMCLT1
          IF        OVRCD=0
            MOVE      PMCLT013,PMCLBNAM
            MOVE      PMCLT014,PMCLBACN
            MOVE      PMCLT015,PMCLBBSB
            CALL      UPPMCLT1
          ELSE
            CALL      CLPMSCLT
            CALL      MVPMCL00
            CALL      WRPMCLT1
.           GOTO      BSBAU900
          ENDIF
.
          GOTO      BSBAU999
.
BSBAU900  MOVE      "Invalid Claimant Record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BSBAU999
.
BSBAU999  RETURN
+
.*****************************************************************************
.*                          GBBE0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on outectaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBBE0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBBSINVN,KEY8
          CALL      RDINV1
          IF        OVRCD = 1
            GOTO      GBBE9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR+PTINCRTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PTINGSTJ,FORM7P2O
          ENDIF
.
GBBE9999  RETURN
+
.*****************************************************************************
.*                          DBBP0000                                         *
.*****************************************************************************
.
DBBP0000  CALL      GBBP0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,OTECFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07,STATBB08 
.
DBBP9999  RETURN
+
.*****************************************************************************
.*                          GBBP0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on outectaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBBP0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBBSINVN,KEY8
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      GBBP9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PRINGSTJ,FORM7P2O
          ENDIF
.
GBBP9999  RETURN
+

.------------------------------------------------------------
. WebServices Bulk Billing Claim Full Details tags
.------------------------------------------------------------
WBBF0000  BRANCH    FLDITMNO,WBBF0100,WBBF0200,WBBF0300,WBBF0400,WBBF0500:
                             WBBF0600,WBBF0700,WBBF0800,WBBF0900,WBBF1000:
                             WBBF1100,WBBF1200,WBBF1300,WBBF1400,WBBF1500:
                             WBBF1600,WBBF1700,WBBF1800,WBBF1900,WBBF2000:
                             WBBF2100,WBBF2200,WBBF2300,WBBF2400,WBBF2500:
                             WBBF2600,WBBF2700,WBBF2800,WBBF2900,WBBF3000:
                             WBBF3100,WBBF3200,WBBF3300,WBBF3400,WBBF3500:
                             WBBF3600,WBBF3700,WBBF3800,WBBF3900,WBBF4000:
                             WBBF4100,WBBF4200,WBBF4300,WBBF4400,WBBF4500:
                             WBBF4600,WBBF4700,WBBF4800,WBBF4900,WBBF5000:
                             WBBF5100,WBBF5200,WBBF5300
.
          GOTO      WBBF9999
.
WBBF0100  WRITE     HTMLFILE;FORM7P2O;
          GOTO      WBBF9999
.
WBBF0200  WRITE     HTMLFILE;STATDESC;
          GOTO      WBBF9999
.
WBBF0300
.         WRITE     HTMLFILE;CONTDESC;
          GOTO      WBBF9999
.
WBBF0400  MATCH     SP70,WBBSPDAT
          GOTO      WBBF9999 IF EQUAL
          UNPACK    WBBSPDAT,CCENT,CYEAR,CMON,CDAY  * Payment Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      WBBF9999
.
WBBF0500  MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBBRCLCA
          UNPACK    WBBRCLCA,DIM7,DIM2              * Claim Charge Amount
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      WBBF9999
.
WBBF0600  MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBBHDAMN
          UNPACK    WBBHDAMN,DIM7,DIM2              * Deposit Amount
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      WBBF9999
.
WBBF0700  WRITE     HTMLFILE;WBBSINVN;
          GOTO      WBBF9999
.
WBBF0800  WRITE     HTMLFILE;WBBSBATN;
          GOTO      WBBF9999
.
WBBF0900  WRITE     HTMLFILE;WBBSPBAT;
          GOTO      WBBF9999
.
WBBF1000  WRITE     HTMLFILE;WBBSNBAT;
          GOTO      WBBF9999
.
WBBF1100  WRITE     HTMLFILE;WBBSTRID;
          GOTO      WBBF9999
.
WBBF1200  
.         WRITE     HTMLFILE;WBIMFTID;
          GOTO      WBBF9999
.
WBBF1300  WRITE     HTMLFILE;WBBSAMTC;
          GOTO      WBBF9999
.
WBBF1400  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVAMT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINITOT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVAMT;
          ENDIF
.
          GOTO      WBBF9999
.
WBBF1500  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVPATA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINPAMT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVPATA;
          ENDIF
.
          GOTO      WBBF9999
.
WBBF1600  
.         WRITE     HTMLFILE;PRINHAMT;
          GOTO      WBBF9999
.
WBBF1700  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVOTHA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINOTHA;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVOTHA;
          ENDIF
.
          GOTO      WBBF9999
.
WBBF1800  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVJOUR;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINJAMT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVJOUR;
          ENDIF
.
          GOTO      WBBF9999
.
WBBF1900  MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBBRCLBP
          UNPACK    WBBRCLBP,DIM7,DIM2          * Claim Benefit Paid
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      WBBF9999
.
WBBF2000  MATCH     SP70,WBBSSTAT                * blank status ?
          GOTO      WBBF9999 IF EQUAL            * yes - don't display anything
          GOTO      WBBF9999 IF EOS
.
          MATCH     " 0",WBBSSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     " 1",WBBSSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed with Write Off";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     " 2",WBBSSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed with Payment";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     " 3",WBBSSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed with WO & Pymt";
            GOTO      WBBF9999
          ENDIF
.
          GOTO      WBBF9999
.
WBBF2100  CALL      WDIB0000
          GOTO      WBBF9999
.
WBBF2200  CALL      WBAR0000   * WebSer Bulk Billing Assessment Report Fields
          GOTO      WBBF9999
.
WBBF2300  CALL      WBEV0000   * WebSer Bulk Billing Med Ev Report Fields
          GOTO      WBBF9999
.
WBBF2400  CALL      WBSD0000   * WebSer Bulk Billing Service Details
          GOTO      WBBF9999
.
WBBF2500  
.-------- CALL      EDSE0000
          GOTO      WBBF9999
.
WBBF2600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PTINCRTT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINCNTT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PTINCRTT;
          ENDIF
.
          GOTO      WBBF9999
.
WBBF2700
.-------- WRITE     HTMLFILE;CFEETYP;
          GOTO      WBBF9999
.
WBBF2800  WRITE     HTMLFILE;WBBSAMTP       * Amount Paid by Medicare
.-------- MOVE      ZERO,FORM7P2C
.-------- UNPACK    OTERCLBP,DIM7,DIM2      * Claim Benefit Paid
.-------- PACK      DIM10,DIM7,DOT,DIM2
.-------- MOVE      DIM10,FORM7P2C
.-------- WRITE     HTMLFILE;FORM7P2C;
          GOTO      WBBF9999
.
WBBF2900  MATCH     "1",MAVMODUL            * Emergency Module
          IF        @EQUAL
            MOVE      "CL",CATEGORY
            MOVE      EMVICOMP,CODE
            CALL      CODITM00
          ENDIF
.
          MATCH     "2",MAVMODUL            * Private Practice Module
          IF        @EQUAL          
            MOVE      "CL",CATEGORY         * claim code
            MOVE      PRHDCLAM,CODE
            CALL      CODITM00
          ENDIF
.
          MATCH     "3",MAVMODUL            * Outpatient Module
          IF        @EQUAL          
            MOVE      "CL",CATEGORY         
            MOVE      OBACOMP,CODE          * Compensation Eligibility
            CALL      CODITM00
          ENDIF
.
          GOTO      WBBF9999
.
WBBF3000  
.--------- UNPACK    DIM127,D1,KEY1,DIM127
.          MOVE      ZERO,F1
.          MOVE      KEY1,F1
.          BRANCH    F1,WBBF3010
. 
.          WRITE     HTMLFILE;PRHDHFND;
. 
.          GOTO      WBBF9999
.
.WBBF3010  MATCH     SP70,PRHDHFND
.          GOTO      WBBF9999 IF EQUAL
.          GOTO      WBBF9999 IF EOS
.
.          PACK      KEY14,PRHDHFND,ZERO,ZERO,ZERO,ZERO,SP70
.          CALL      RDFUND1
.          BRANCH    OVRCD,WBBF9999
.
.--------- WRITE     HTMLFILE;HFNAME;
.
          GOTO      WBBF9999
.
WBBF3100  WRITE     HTMLFILE;UNIQNUMB;
          GOTO      WBBF9999
.
WBBF3200  WRITE     HTMLFILE;PRHRE001;
          GOTO      WBBF9999
.
WBBF3300  WRITE     HTMLFILE;PRHRE002;
          GOTO      WBBF9999
.
WBBF3400  WRITE     HTMLFILE;PRHRE003;
          GOTO      WBBF9999
.
WBBF3500  WRITE     HTMLFILE;MAVMODUL;
          GOTO      WBBF9999
.
WBBF3600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;FOUR;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;TWO;
          ENDIF
.
          GOTO      WBBF9999
.
WBBF3700  MATCH     SP70,PRHRPIND
          GOTO      WBBF9999 IF EQUAL
          GOTO      WBBF9999 IF EOS
.
          MOVE      "GI",CATEGORY
          MOVE      PRHRPIND,CODE
.
          PACK      KEY5,CATEGORY,CODE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;TDESC;
          ENDIF
.
          GOTO      WBBF9999
.
WBBF3800  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      WBBF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bprw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBBF9999
.
WBBF3900  CALL      BPRHED00
          GOTO      WBBF9999
.
WBBF4000  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      WBBF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bprw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    BPRWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBBF9999
.
WBBF4100  CALL      BPRJSN00
          GOTO      WBBF9999
.
WBBF4200  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      WBBF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bprw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    BPRRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBBF9999
.
WBBF4300  CALL      BPRRSP00
          GOTO      WBBF9999
.
WBBF4400  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      WBBF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bprw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    BPRELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBBF9999
.
WBBF4500  CALL      BPRERR00
          GOTO      ECFH9999
.
WBBF4600  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     SP70,WBBSTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      WBBF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bbsw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBBSTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBBF9999
.
WBBF4700  CALL      BBSHED00
          GOTO      WBBF9999
.
WBBF4800  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     SP70,WBBSTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      WBBF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bbsw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBBSTRID,CMDLINE
          APPEND    BBSWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBBF9999
.
WBBF4900  CALL      BBSJSN00
          GOTO      ECFH9999
.
WBBF5000  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     SP70,WBBSTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      WBBF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bbsw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBBSTRID,CMDLINE
          APPEND    BBSRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBBF9999
.
WBBF5100  CALL      BBSRSP00
          GOTO      ECFH9999
.
WBBF5200  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBBF9999
          ENDIF
.
          MATCH     SP70,WBBSTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      WBBF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bbsw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBBSTRID,CMDLINE
          APPEND    BBSELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBBF9999
.
WBBF5300  CALL      BBSERR00
          GOTO      WBBF9999
.
WBBF9999  RETURN
+
.------------------------------------------------------------
. Table of EDI History for Eclipse Bulk Billing 
.------------------------------------------------------------
WDIB0000  MATCH     "1",PTCNWSIN
          GOTO      WDIB9999 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      WDIB9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          CALL      WDIBD000      * Output Table Heading
.
          PACK      KEY35,MAVINVCE,Z70
          CALL      RSWBBBA3
WDIB1000  CALL      RPWBBBA3
          BRANCH    OVRCD,WDIB9999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"<!-- ",LOOPCNTR," -->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     MAVINVCE,WBBAINVN
          GOTO      WDIB9999 IF NOT EQUAL
.
          MATCH     MAVMODUL,WBBAMODL
          GOTO      WDIB1000 IF NOT EQUAL
.
          CALL      WDBRW000
.
          GOTO      WDIB1000
.
WDIB9999  RETURN
.------------------------------------------------------------
. EDI History (Detail Row) - For Eclipse Bulk Billing
.------------------------------------------------------------
WDBRW000  MOVE      SP70,DIM11
          MATCH     SP70,WBBADATE
          IF        !@EQUAL & !@EOS
            UNPACK    WBBADATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBBASTAT,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07,STATBB08
.
          MOVE      SP30,TYPEDESC
          MOVE      WBBATYPE,TYPOFREQ
          LOAD      TYPEDESC,TYPOFREQ,TYPEDBB1,TYPEDBB2,TYPEDBB3,TYPEDBB4:
                                      TYPEDBB5
.
.-------- Type - Data error response (4) OR Transmission Error Response (5)
          IF        TYPOFREQ = 4 | TYPOFREQ = 5
            STRIP     TYPEDESC
            ENDSET    TYPEDESC
            APPEND    SP1,TYPEDESC
            APPEND    WBBAEROR,TYPEDESC
            APPEND    SP20,TYPEDESC
            RESET     TYPEDESC
          ENDIF
.
          MOVE      SP70,DIM30
          PACK      KEY10,WBBAOPER,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      WBBAOPER,DIM30
          ELSE
            MATCH     WBBAOPER,WBSEUID
            IF        @EQUAL
              MOVE      WBSENAM,DIM30
            ELSE
              MOVE      WBBAOPER,DIM30
            ENDIF
          ENDIF
.
          CMATCH    NULL,WBBAEROT
          IF        @EQUAL
            PACK      WBBAEROT,SP70,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",DIM11 ,"</td>";
          WRITE     HTMLFILE;"<td>",WBBATIME,"</td>";
          WRITE     HTMLFILE;"<td>",STATDESC,"</td>":
                             "<td>",TYPEDESC,"</td>":
                             "<td>",WBBABATN,"</td>":
                             "<td>",DIM30,"</td>":
                             "<td>",WBBAEROT,"</td>":
                             "</tr>";
.
WDBRW999  RETURN
.
.------------------------------------------------------------
. Table of Eclipse Bulk Billing  Assessment Report
.------------------------------------------------------------
WBAR0000  MATCH     "1",PTCNWSIN
          GOTO      WBAR9999 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      WBAR9999 IF NOT EQUAL
.
          CALL      WBARHD00      * Output Table Heading
.
          PACK      KEY57,WBBSTRID,Z70
          CALL      RSWBBBD2
WBAR1000  CALL      RPWBBBD2      * Get Assessment Header - outeahaf
          BRANCH    OVRCD,WBAR9999
.
          MATCH     WBBSTRID,WBBDTRID
          GOTO      WBAR9999 IF NOT EQUAL
.
          CALL      WBARRW00
.
          GOTO      WBAR1000
.
WBAR9999  RETURN
.------------------------------------------------------------
. Eclipse Bulk Billing Assessment Report (TABLE HEADING)
.------------------------------------------------------------
WBARHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim Benefit Paid&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim Charge Amount&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Date of Service&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Patient Family Name&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Patient First Name&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Medicare Card Flag&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Medicare Card Number&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Medicare Reference Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Servicing Provider Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Status&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim Transaction Id&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medical Event Details&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Report Details&nbsp;</td>":
                             "</tr>"
.
WBARHD99  RETURN
.
.------------------------------------------------------------
. WenServices Bulk Billing Assessment Report (Detail Row)
.------------------------------------------------------------
WBARRW00  MOVE      ZERO,FORM1
.-------- MOVE      "Unknown",ASESDESC
.-------- MOVE      OTEHCFAC,ANS
.-------- REP       "A1R2W3C4",ANS
.-------- MOVE      ANS,FORM1
.------- -LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4
.
.         MOVE      ZERO,FORM1
.         MOVE      "No Change",MEDSDESC
.         MOVE      OTEHMECF,ANS
.         REP       "A1I2C3W4S5X6",ANS
.         MOVE      ANS,FORM1
.         LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
.                                  MEDSDES5,MEDSDES6
.
.-------- MOVE      ZERO,FORM2
.-------- MOVE      "UNKNOWN",PRCSDESC 
.-------- MOVE      OTEHSTAT,FORM2 
.-------- LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
.--------                          PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
.--------                          PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
.--------                          PRCSDE10,PRCSDE11
.
          MOVE      ZERO,FORM7P2
          RJUSTIFY  WBBDCLBP
          UNPACK    WBBDCLBP,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
.
          MOVE      SP70,DIM30
          IF        FORM7P2 = ZERO
            MOVE      "<br>[No Payment Report]",DIM30
          ENDIF
.
          MOVE      ZERO,FORM7P2A
          RJUSTIFY  WBBDCLCA
          UNPACK    WBBDCLCA,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2A
.
.         MOVE      SP70,DIM11
.         MATCH     SP70,OTEHSDAT
.         IF        !@EQUAL & !@EOS
.           UNPACK    OTEHSDAT,CCENT,CYEAR,CMON,CDAY
.           MOVE      CMON,F2
.           LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.           PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
.         ENDIF
.
          WRITE     HTMLFILE;"<tr><td valign=top>",WBBDCLID,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",FORM7P2,DIM30,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",FORM7P2A,"</td>";
.
          MATCH     SP70,WBBDSRVP
          IF        !@EQUAL
.
            PACK      KEY20,WBBDSRVP,SP70
            CALL      RSPMHCP3
            CALL      RKPMHCP3
            BRANCH    OVRCD,WBARRW50
.
            MATCH     WBBDSRVP,PMHCPRV1
            GOTO      WBARRW50 IF NOT EQUAL
.
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
.
            WRITE     HTMLFILE;"<td valign=top>",WBBDSRVP,"&nbsp;&nbsp;&nbsp;",DOCFNAME,"</td>";
.
          ELSE
.
WBARRW50    WRITE     HTMLFILE;"<td valign=top>",WBBDSRVP,"</td>";
.
          ENDIF
.
          WRITE     HTMLFILE;"<td valign=top>",WBBDSTAT,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBBDTRID,"</td>";
.
.-------- Medical Event Details
.
          REP       " +",URNUMBER
          REP       " +",UNIQNUMB
          REP       " +",MAVINVCE
          REP       " +",MAVBATCH
          REP       " +",MAVMODUL
          REP       " +",PRHRE001
          REP       " +",PRHRE002
          REP       " +",PRHRE003
          REP       " +",WBBDCLID
          REP       "##~",WBBDCLID
          REP       " +",WBBDRPTC
          REP       " +",WBBDTRID
          REP       " +",WBBDRKEY
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=09":
                             "&template=004":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&mavmodul=",MAVMODUL:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclclid=",WBBDCLID:
                             "&ecclrptc=",WBBDRPTC:
                             "&ecclrkey=",WBBDRKEY,"#";'>":
                             "</td>";

          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='displayJSON(#"../cgi-bin/eclweb73.pbl":
                             "?reportno=09":
                             "&template=006":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&mavmodul=",MAVMODUL:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclclid=",WBBDCLID:
                             "&ecclrptc=",WBBDRPTC:
                             "&ecclstrd=",WBBDTRID:
                             "&ecclrkey=",WBBDRKEY,"#");'>":
                             "</td>":
                             "</tr>";
.
          REP       "+ ",URNUMBER
          REP       "+ ",UNIQNUMB
          REP       "+ ",MAVINVCE
          REP       "+ ",MAVBATCH
          REP       "+ ",MAVMODUL
          REP       "+ ",PRHRE001
          REP       "+ ",PRHRE002
          REP       "+ ",PRHRE003
          REP       "+ ",WBBDCLID
          REP       "~##",WBBDCLID
          REP       "+ ",WBBDRPTC
          REP       "+ ",WBBDTRID
          REP       "+ ",WBBDRKEY
.
WBARRW99  RETURN
.
.------------------------------------------------------------
. WebServices Bulk Billing Payment Details (webbrhaf)
.------------------------------------------------------------
.
WBBP0000  PACK      KEY47,WBBSHOSP,WBBSRKEY,SP70
          CALL      RSWBBRH4
WBBP1000  CALL      RKWBBRH4
          BRANCH    OVRCD,WBBP4000
.
          MATCH     WBBSHOSP,WBBHHOSP
          GOTO      WBBP4000 IF NOT EQUAL
.
          MATCH     WBBSRKEY,WBBHRKEY
          GOTO      WBBP4000 IF NOT EQUAL
.
          GOTO      WBBP5000
.
WBBP4000  CALL      CLWEBBRH
.
WBBP5000  PACK      KEY53,WBBSTRID,SP70
          CALL      RSWBBRD2
          CALL      RKWBBRD2
          BRANCH    OVRCD,WBBP9000
.
          MATCH     WBBSTRID,WBBRTRID
          GOTO      WBBP9000 IF NOT EQUAL 
.
          GOTO      WBBP9999 
.
WBBP9000  CALL      CLWEBBRD
.
WBBP9999  RETURN
+
.----------------------------------------------------------------------
. Table of Eclipse Bulk Billing Claim Service and explanation details
.----------------------------------------------------------------------
EBSD0000  MATCH     "1",PTCNUEBB
          GOTO      EBSD9999 IF NOT EQUAL
.
          CALL      EBSDHD00                     * Output Table Heading
.
          PACK      KEY40,ECCLCLID,ECCLRPTC,SP70
          CALL      RSOTEAD1                     * position in file outeadaf
EBSD1000  CALL      RKOTEAD1                     * read next record
          BRANCH    OVRCD,EBSD9999               * end of file
.
          PACK      OTEDCLID,OTEDCLID,SP70
.
          MATCH     ECCLCLID,OTEDCLID            * same claim id ?
          GOTO      EBSD1000 IF NOT EQUAL        * no - finished listing
.
          PACK      OTEDRPTC,OTEDRPTC,SP70
.
          MATCH     ECCLRPTC,OTEDRPTC            * same report counter ?
          GOTO      EBSD1000 IF NOT EQUAL        * no - finished listing
.
          PACK      OTEDRKEY,OTEDRKEY,SP70
.
          MATCH     ECCLRKEY,OTEDRKEY            * same report retrieve key?
          GOTO      EBSD1000 IF NOT EQUAL        * no - finished listing
.
          CALL      EBSDRW00
.
          GOTO      EBSD1000
.
EBSD9999  RETURN
.
.------------------------------------------------------------
. Eclipse Bulk Billing Claim Service Details (TABLE HEADING)
.------------------------------------------------------------
EBSDHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Number of Patients Seen&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Code&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Explanation&nbsp;</td>":
                             "</tr>"

EBSDHD99  RETURN
.------------------------------------------------------------
. Eclipse Bulk Billing Service Details (Detail Row)
.------------------------------------------------------------
EBSDRW00  MOVE      ZERO,FORM7P2C
          UNPACK    OTEDSERB,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
.
          MOVE      SP70,HCEMDESC
.
          MATCH     SP70,OTEDEXPC
          IF        !@EQUAL & !@EOS
            PACK      KEY3,OTEDEXPC,SP70
            CALL      RDHCEMS1
            IF        OVRCD=ONE
              MOVE      "No Description in hicemsaf",HCEMDESC
              PACK      HCEMDESC,HCEMDESC,SP70
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                             "<td valign=top>",OTEDITMN,"</td>":
                             "<td valign=top>",FORM7P2C,"</td>":
                             "<td valign=top>",OTEDNOPA,"</td>":
                             "<td valign=top>",OTEDSRVI,"</td>":
                             "<td valign=top>",OTEDEXPC,"</td>":
                             "<td valign=top>",HCEMDESC,"</td>":
                             "</tr>";
.
EBSDRW99  RETURN
+
.------------------------------------------------------------
. WebServices BBSW Claim Enquiries tags
.------------------------------------------------------------
WBQF0000  BRANCH    FLDITMNO,WBQF0100,WBQF0200,WBQF0300,WBQF0400,WBQF0500:
                             WBQF0600,WBQF0700,WBQF0800,WBQF0900,WBQF1000:
                             WBQF1100,WBQF1200,WBQF1300,WBQF1400,WBQF1500:
                             WBQF1600,WBQF1700,WBQF1800,WBQF1900,WBQF2000:
                             WBQF2100,WBQF2200,WBQF2300,WBQF2400,WBQF2500:
                             WBQF2600,WBQF2700,WBQF2800,WBQF2900
.
          GOTO      WBQF9999
.
WBQF0100  CALL      WBQP0000    * Private Practice - Hospital level enquiry
          GOTO      WBQF9999
.
WBQF0200  WRITE     HTMLFILE;IBCNMHOS;    * Multihospital Indicator
          GOTO      WBQF9999
.
WBQF0300  CALL      HOSPID00              * Hospital ID option field
          GOTO      WBQF9999
.
WBQF0400  CALL      SELHFN00              * Health Fund option field
          GOTO      WBQF9999
.
WBQF0500  WRITE     HTMLFILE;HLFDCLTY;
          GOTO      WBQF9999
.
WBQF0600  MOVE      CATCL,CATEGORY
          MOVE      HLTHFUND,CODE
          CALL      CODITM00
          GOTO      WBQF9999
.
WBQF0700  WRITE     HTMLFILE;EXCLWAIT;
          GOTO      WBQF9999
.
WBQF0800  WRITE     HTMLFILE;FILTURNO;
          GOTO      WBQF9999
.
WBQF0900  WRITE     HTMLFILE;FILTADMN;
          GOTO      WBQF9999
.
WBQF1000  WRITE     HTMLFILE;BATCHNUM;
          GOTO      WBQF9999
.
WBQF1100  WRITE     HTMLFILE;CLAIMSTA;
          GOTO      WBQF9999
.
WBQF1200  WRITE     HTMLFILE;INVNUMBR;
          GOTO      WBQF9999
.
WBQF1300  CALL      SELP0000    * Selects Day, Week or Month from Viewtype
          GOTO      WBQF9999
.
WBQF1400  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      WBQF9999
.
WBQF1500  WRITE     HTMLFILE;EXDTBLNK;
          GOTO      WBQF9999
.
WBQF1600  WRITE     HTMLFILE;HLTHFUND;
          GOTO      WBQF9999
.
WBQF1700  CALL      PRVE0000
          GOTO      WBQF9999
.
WBQF1800  CALL      NXTE0000
          GOTO      WBQF9999
.
WBQF1900  CALL      BATWB000    * Batch header code search
          GOTO      WBQF9999
.
WBQF2000  CALL      PREVBT00
          GOTO      WBQF9999
.
WBQF2100  CALL      NEXTBT00
          GOTO      WBQF9999
.
WBQF2200  
.-------- CALL      ECOT0000
          GOTO      WBQF9999
.
WBQF2300  WRITE     HTMLFILE;PROCSTAT;
          GOTO      WBQF9999
.
WBQF2400  CALL      WBPL0000    * Private Practice - Patient level enquiry
          GOTO      WBQF9999
.
WBQF2500  WRITE     HTMLFILE;EXCLCLOS;
          GOTO      WBQF9999
.
WBQF2600  
.---------CALL      ECSE0000    * Emergency Module - Hosp Level enquiry  
          GOTO      WBQF9999
.
WBQF2700
.---------CALL      ECEP0000    * Emergency Module - Patient level enquiry
          GOTO      WBQF9999
.
WBQF2800  CALL      WBOH0000    * Outpatient Module - Hospital Level enquiry
          GOTO      WBQF9999
.
WBQF2900  CALL      WBOP0000    * Outpatient Module - Patient Level enquiry
          GOTO      WBQF9999
.
WBQF9999  RETURN
+
.----------------------------------------------------------------
. Table of WebServices BBSW Claim Enquiries Private Practice
.----------------------------------------------------------------
.
WBQP0000  MATCH     "1",PTCNWSIN
          GOTO      WBQP9999 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      WBQP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      WBQP9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      WBQP9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBBBB2                * Eclipse Bulk Billing Batch Header
WBQP0500  CALL      RKWBBBB2
          BRANCH    OVRCD,WBQP2000
          MATCH     WBBBDTBC,LASTDATE
          GOTO      WBQP2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,WBBBBTHN,SP70
          CALL      RSWBBBS3
WBQP1000  CALL      RKWBBBS3
          BRANCH    OVRCD,WBQP0500
          MATCH     WBBBBTHN,WBBSBATN
          GOTO      WBQP0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",WBBSMODL
          GOTO      WBQP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBBSHOSP
              GOTO      WBQP1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBBSHOSP
                GOTO      WBQP1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WBQP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WBQP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   EIGHT,WBBSFLAG
            GOTO      WBQP1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        WBIMFLAG=ZERO
.             GOTO      WBQP1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBBSURNO
            GOTO      WBQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBBSUNIQ
            GOTO      WBQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBBSBATN
            GOTO      WBQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBBSFLG
            GOTO      WBQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBBSINVN
            GOTO      WBQP1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,WBQP1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      WBQP1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      WBQP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY27,WBBSINVN,Z70
          CALL      RSWBBBA2
          CALL      RPWBBBA2
          IF        OVRCD=0
            MATCH     WBBSINVN,WBBAINVN
            IF        @EQUAL
              MATCH     " 3",WBBATYPE           * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBBSFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07,STATBB08
.
          CALL      RSBB0000    * Resubmission BB
.
          CALL      GBBP0000    * Get current invoice outstanding balance
.
          MOVE      WBBSURNO,URNUMBER
.         MOVE      WBBSUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBBSINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBBSUNIQ,WBBSINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,WBQP1500
.
          MATCH     WBBSUNIQ,DPRDTUNQ
          GOTO      WBQP1500 IF NOT EQUAL
.
          MATCH     WBBSINVN,PRDTINVN
          GOTO      WBQP1500 IF NOT EQUAL
.
          GOTO      WBQP1600
.
WBQP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBQP1600  REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "9",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBBSURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBBSUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBBSBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBBSINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBBSMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBBSURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBBSBATN,"#",":
                             "#"",WBBSUNIQ,"#",":
                             "#"",WBBSINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBBSAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBBSPBAT,"#",":
                             "#"",WBBSNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBBSBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBBSNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBBSFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBBSBATN,DIM8
          REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBBSBATN,"','",WBBSUNIQ,"','",WBBSURNO,"','",WBBSINVN,"','",WBBSMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WBQP1900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBBSBATN,"','",WBBSINVN,"','":
                             WBBSMODL,"','":
                             WBBSURNO,"','",WBBSUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
.           WRITE     HTMLFILE;"#"",WBBSTRID,"#");"                       * 19
            WRITE     HTMLFILE;"#"",WBBSTRID,"#",";                       * 19
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBBSUDAT
          IF        !@EQUAL
            UNPACK    WBBSUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      WBQP1950
          ELSE
            MATCH     SP70,WBBSCDAT
            IF        !@EQUAL
              UNPACK    WBBSCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      WBQP1950
            ELSE
              GOTO      WBQP1950
            ENDIF
          ENDIF

WBQP1950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBBSUUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBBSUUID,SP2,DIM11
            PACK      UIDTIMET,WBBSUTIM
            GOTO      WBQP1970
          ELSE
            MATCH     SP70,WBBSCUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBBSCUID,SP2,DIM11
              PACK      UIDTIMET,WBBSCTIM
              GOTO      WBQP1970
            ELSE
              GOTO      WBQP1970
            ENDIF
          ENDIF

WBQP1970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          GOTO      WBQP1000
.
WBQP2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      WBQP9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSWBBBS3
WBQP3000  CALL      RKWBBBS3
          BRANCH    OVRCD,WBQP9000
          MATCH     SP70,WBBSBATN
          GOTO      WBQP9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",WBBSMODL
          GOTO      WBQP3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBBSHOSP
              GOTO      WBQP3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBBSHOSP
                GOTO      WBQP3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WBQP3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WBQP3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        WBBSFLAG=EIGHT 
              GOTO      WBQP3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBBSFLAG=ZERO
              GOTO      WBQP3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBBSURNO
            GOTO      WBQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBBSUNIQ
            GOTO      WBQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBBSBATN
            GOTO      WBQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBBSFLG
            GOTO      WBQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBBSINVN
            GOTO      WBQP3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,WBQP1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      WBQP1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      WBQP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY27,WBBSINVN,Z70
          CALL      RSWBBBA2
          CALL      RPWBBBA2
          IF        OVRCD=0
            MATCH     WBBSINVN,WBBAINVN
            IF        @EQUAL
              MATCH     " 3",WBBATYPE         * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBBSFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07,STATBB08
.
          CALL      RSBB0000       * Resubmission BB claim
.
          CALL      GBBP0000       * Get current invoice Oustanding balance
.
          MOVE      WBBSURNO,URNUMBER
.         MOVE      WBBSUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBBSINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBBSUNIQ,WBBSINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,WBQP3500
.
          MATCH     WBBSUNIQ,DPRDTUNQ
          GOTO      WBQP3500 IF NOT EQUAL
.
          MATCH     WBBSINVN,PRDTINVN
          GOTO      WBQP3500 IF NOT EQUAL
.
          GOTO      WBQP3600
.
WBQP3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBQP3600  REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "9",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBBSURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBBSUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBBSBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBBSINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBBSMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBBSURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBBSBATN,"#",":
                             "#"",WBBSUNIQ,"#",":
                             "#"",WBBSINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBBSAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBBSPBAT,"#",":
                             "#"",WBBSNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBBSBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBBSNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBBSFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBBSBATN,DIM8
          REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBBSBATN,"','",WBBSUNIQ,"','",WBBSURNO,"','",WBBSINVN,"','",WBBSMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17 
.
WBQP8900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBBSBATN,"','",WBBSINVN,"','":
                             WBBSMODL,"','":
                             WBBSURNO,"','",WBBSUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"",WBBSTRID,"#",";                       * 19
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBBSUDAT
          IF        !@EQUAL
            UNPACK    WBBSUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      WBPQ8950
          ELSE
            MATCH     SP70,WBBSCDAT
            IF        !@EQUAL
              UNPACK    WBBSCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      WBPQ8950
            ELSE
              GOTO      WBPQ8950
            ENDIF
          ENDIF

WBPQ8950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBBSUUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBBSUUID,SP2,DIM11
            PACK      UIDTIMET,WBBSUTIM
            GOTO      WBPQ8970
          ELSE
            MATCH     SP70,WBBSCUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBBSCUID,SP2,DIM11
              PACK      UIDTIMET,WBBSCTIM
              GOTO      WBPQ8970
            ELSE
              GOTO      WBPQ8970
            ENDIF
          ENDIF

WBPQ8970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          GOTO      WBQP3000
.
WBQP9000
WBQP9999  RETURN
+
.*****************************************************************************
.* Resubmission of WebServices Bulk Billing claims                           *
.*****************************************************************************
RSBB0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,WBBSNBAT                 * next batch blank ?
          GOTO      RSBB9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBBSFLAG = 8 |WBBSFLAG = 3
            GOTO      RSBB1000            * Check OS amount owing
          ELSE
            GOTO      RSBB9000            * Exit
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RSBB1000  PACK      KEY8,WBBSINVN,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,RSBB9000
.
          CALL      GBBP0000                 * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSBB9000
          ENDIF
.
          PACK      KEY17,WBBSINVN,SP8,TWO,SP70
          CALL      RAWBBBS2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBB9000
          ENDIF
.
          GOTO      RSBB9999
.
RSBB9000  MOVE      ONE,RSUBINDI
RSBB9999  RETURN
.
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries Bulk Billing Patient Level Priv Prac
.------------------------------------------------------------
WBPL0000  MATCH     "1",PTCNWSIN
          GOTO      WBPL9999 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      WBPL9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.         MATCH     SP70,HOSPCODE
.         IF        @EQUAL
.           MOVE      WBSEHOSP,HOSPCODE
.         ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSWBBBS5
WBPL1000  CALL      RKWBBBS5
          BRANCH    OVRCD,WBPL9999
          MATCH     FILTURNO,WBBSURNO
          GOTO      WBPL9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",WBBSMODL
          GOTO      WBPL1000 IF NOT EQUAL
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBBSURNO
            GOTO      WBPL9999 IF NOT EQUAL
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WBPL1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WBPL1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBBSFLAG=ZERO
              GOTO      WBPL1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBBSUNIQ
            GOTO      WBPL1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBBSBATN
            GOTO      WBPL1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBBSFLG
            GOTO      WBPL1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBBSINVN
            GOTO      WBPL1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,WBBSBATN,SP70
            CALL      RDWBBBB1
            BRANCH    OVRCD,WBPL1000
.
            MATCH     FRSTDATE,WBBBDTBC
            GOTO      WBPL1000 IF LESS
.
            MATCH     WBBBDTBC,LASTDATE
            GOTO      WBPL1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBBSINVN,Z70
          CALL      RSWBBBA3
          CALL      RPWBBBA3
          IF        OVRCD=0
            MATCH     WBBSINVN,WBBAINVN
            IF        @EQUAL
              MATCH     " 3",WBBATYPE        * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBBSFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07,STATBB08
.
          CALL      RSBB0000    * Resubmission claim
.
          CALL      GBBP0000    * Get current invoice outstanding balance
.
          MOVE      WBBSURNO,URNUMBER
.         MOVE      WBBSUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBBSINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBBSUNIQ,WBBSINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,WBPL1500
.
          MATCH     WBBSUNIQ,DPRDTUNQ
          GOTO      WBPL1500 IF NOT EQUAL
.
          MATCH     WBBSINVN,PRDTINVN
          GOTO      WBPL1500 IF NOT EQUAL
.
          GOTO      WBPL1600
.
WBPL1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBPL1600  REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "9",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBBSURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBBSUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBBSBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBBSINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBBSMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBBSURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBBSBATN,"#",":
                             "#"",WBBSUNIQ,"#",":
                             "#"",WBBSINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBBSAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBBSPBAT,"#",":
                             "#"",WBBSNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBBSBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBBSNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBBSBATN,DIM8
          REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
WBBSBATN,"','",WBBSUNIQ,"','",WBBSURNO,"','",WBBSINVN,"','",WBBSMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      WBPL1000
.
WBPL9999  RETURN
+
.------------------------------------------------------------
. WebServices Bulk Billing Outpatient - Hospital Level Enquiries  
.------------------------------------------------------------
WBOH0000  MATCH     "1",PTCNWSIN
          GOTO      WBOH9999 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      WBOH9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      WBOH9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      WBOH9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBBBB2
WBOH0500  CALL      RKWBBBB2
          BRANCH    OVRCD,WBOH2000
          MATCH     WBBBDTBC,LASTDATE
          GOTO      WBOH2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,WBBBBTHN,SP70
          CALL      RSWBBBS3
WBOH1000  CALL      RKWBBBS3
          BRANCH    OVRCD,WBOH0500
          MATCH     WBBBBTHN,WBBSBATN
          GOTO      WBOH0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "3",WBBSMODL
          GOTO      WBOH1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBBSHOSP
              GOTO      WBOH1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBBSHOSP
                GOTO      WBOH1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WBOH1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WBOH1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   EIGHT,WBBSFLAG               * Closed status
            GOTO      WBOH1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        WBIMFLAG=ZERO
.             GOTO      WBOH1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBBSURNO
            GOTO      WBOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBBSUNIQ
            GOTO      WBOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBBSBATN
            GOTO      WBOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBBSFLG
            GOTO      WBOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBBSINVN
            GOTO      WBOH1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,WBOH1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      WBOH1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      WBOH1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBBSINVN,Z70
          CALL      RSWBBBA3
          CALL      RPWBBBA3
          IF        OVRCD=0
            MATCH     WBBSINVN,WBBAINVN
            IF        @EQUAL
              MATCH     " 3",WBBATYPE       *  Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBBSFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07,STATBB08
.
          CALL      RBBE0000             * Resubmission Bulk Billing claims  
.
          CALL      GBBE0000             * Get current invoice outstanding balance  
.
          MOVE      WBBSURNO,URNUMBER
.         MOVE      WBBSUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,WBBSINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,WBBSUNIQ,WBBSINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,WBOH1500
.
.         MATCH     WBBSUNIQ,DPRDTUNQ
.         GOTO      WBOH1500 IF NOT EQUAL
.
.         MATCH     WBBSINVN,PRDTINVN
.         GOTO      WBOH1500 IF NOT EQUAL
.
.         GOTO      WBOH1600
.
WBOH1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBOH1600  REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "9",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBBSURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBBSUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBBSBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBBSINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBBSMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBBSURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBBSBATN,"#",":
                             "#"",WBBSUNIQ,"#",":
                             "#"",WBBSINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.              
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBBSAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBBSPBAT,"#",":
                             "#"",WBBSNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBBSBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBBSNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBBSFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBBSBATN,DIM8
          REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBBSBATN,"','",WBBSUNIQ,"','",WBBSURNO,"','",WBBSINVN,"','",WBBSMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WBOH1900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBBSBATN,"','",WBBSINVN,"','":
                             WBBSMODL,"','":
                             WBBSURNO,"','",WBBSUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
.           WRITE     HTMLFILE;"#"",WBBSTRID,"#");"                      * 19
            WRITE     HTMLFILE;"#"",WBBSTRID,"#",";                      * 19
.         ENDIF

          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBBSUDAT
          IF        !@EQUAL
            UNPACK    WBBSUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      WBOH1950
          ELSE
            MATCH     SP70,WBBSCDAT
            IF        !@EQUAL
              UNPACK    WBBSCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      WBOH1950
            ELSE
              GOTO      WBOH1950
            ENDIF
          ENDIF

WBOH1950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBBSCUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBBSCUID,SP2,DIM11
            PACK      UIDTIMET,WBBSCTIM
            GOTO      WBOH1970
          ELSE
            MATCH     SP70,WBBSUUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBBSUUID,SP2,DIM11
              PACK      UIDTIMET,WBBSCTIM
              GOTO      WBOH1970
            ELSE
              GOTO      WBOH1970
            ENDIF
          ENDIF

WBOH1970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          MOVE      ZERO,LOOPCNTR
.
          GOTO      WBOH1000
.
WBOH2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      WBOH9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSWBBBS3
WBOH3000  CALL      RKWBBBS3
          BRANCH    OVRCD,WBOH9000
          MATCH     SP70,WBBSBATN
          GOTO      WBOH9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "3",WBBSMODL
          GOTO      WBOH3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBBSHOSP
              GOTO      WBOH3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBBSHOSP
                GOTO      WBOH3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WBOH3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WBOH3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        WBBSFLAG=EIGHT
              GOTO      WBOH3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBBSFLAG=ZERO
              GOTO      WBOH3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBBSURNO
            GOTO      WBOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBBSUNIQ
            GOTO      WBOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBBSBATN
            GOTO      WBOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBBSFLG
            GOTO      WBOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBBSINVN
            GOTO      WBOH3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,WBOH1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      WBOH1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      WBOH1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBBSINVN,Z70
          CALL      RSWBBBA3
          CALL      RPWBBBA3
          IF        OVRCD=0
            MATCH     WBBSINVN,WBBAINVN
            IF        @EQUAL
              MATCH     " 3",WBBATYPE      * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBBSFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07,STATBB08
.
          CALL      RBBE0000     * Resubmission Bulk Billing claims
.
          CALL      GBBE0000     * Get current invoice outstanding balance
.
          MOVE      WBBSURNO,URNUMBER
.         MOVE      WBBSUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,WBBSINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,WBBSUNIQ,WBBSINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,WBOH3500
.
.         MATCH     WBBSUNIQ,DPRDTUNQ
.         GOTO      WBOH3500 IF NOT EQUAL
.
.         MATCH     WBBSINVN,PRDTINVN
.         GOTO      WBOH3500 IF NOT EQUAL
.
.         GOTO      WBOH3600
.
WBOH3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBOH3600  REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "9",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBBSURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBBSUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBBSBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBBSINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBBSMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBBSURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBBSBATN,"#",":
                             "#"",WBBSUNIQ,"#",":
                             "#"",WBBSINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBBSAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBBSPBAT,"#",":
                             "#"",WBBSNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBBSBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBBSNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBBSFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBBSBATN,DIM8
          REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBBSBATN,"','",WBBSUNIQ,"','",WBBSURNO,"','",WBBSINVN,"','",WBBSMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WBOH8900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBBSBATN,"','",WBBSINVN,"','":
                             WBBSMODL,"','":
                             WBBSURNO,"','",WBBSUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
.           WRITE     HTMLFILE;"#"",WBBSTRID,"#");"                      * 19
            WRITE     HTMLFILE;"#"",WBBSTRID,"#",";                      * 19
.         ENDIF

          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBBSUDAT
          IF        !@EQUAL
            UNPACK    WBBSUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      WBOH8950
          ELSE
            MATCH     SP70,WBBSCDAT
            IF        !@EQUAL
              UNPACK    WBBSCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      WBOH8950
            ELSE
              GOTO      WBOH8950
            ENDIF
          ENDIF

WBOH8950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBBSCUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBBSCUID,SP2,DIM11
            PACK      UIDTIMET,WBBSCTIM
            GOTO      WBOH8970
          ELSE
            MATCH     SP70,WBBSUUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBBSUUID,SP2,DIM11
              PACK      UIDTIMET,WBBSCTIM
              GOTO      WBOH8970
            ELSE
              GOTO      WBOH8970
            ENDIF
          ENDIF

WBOH8970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          MOVE      ZERO,LOOPCNTR
.
          GOTO      WBOH3000
.
WBOH9000
WBOH9999  RETURN
+
.*****************************************************************************
.* Check resubmission of WebServices Bulk Billing claim
.*****************************************************************************
RBBE0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,WBBSNBAT                 * next batch blank ?
          GOTO      RBBE9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBBSFLAG = 8 | WBBSFLAG = 3
            GOTO      RBBE1000                   * Check OS amount
          ELSE
            GOTO      RBBE9000                   * Exit
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RBBE1000  PACK      KEY8,WBBSINVN,SP70
          CALL      RDINV1
          BRANCH    OVRCD,RBBE9000
.
          CALL      GBBE0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PINVAMT > 0)
            GOTO      RBBE9000
          ENDIF
.
          PACK      KEY17,WBBSINVN,SP8,ONE,SP70
          CALL      RAWBBBS2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RBBE9000
          ENDIF
.
          GOTO      RBBE9999
.
RBBE9000  MOVE      ONE,RSUBINDI
RBBE9999  RETURN
+
.------------------------------------------------------------
. WebServices Bulk Billing Outpatient - Patient Level Enquiries  
.------------------------------------------------------------
WBOP0000  MATCH     "1",PTCNWSIN
          GOTO      WBOP9999 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      WBOP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.         MATCH     SP70,HOSPCODE
.         IF        @EQUAL
.           MOVE      WBSEHOSP,HOSPCODE
.         ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSWBBBS5
WBOP1000  CALL      RKWBBBS5
          BRANCH    OVRCD,WBOP9999
          MATCH     FILTURNO,WBBSURNO
          GOTO      WBOP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "3",WBBSMODL
          GOTO      WBOP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBBSHOSP
              GOTO      WBOP9999 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBBSHOSP
                GOTO      WBOP9999 IF NOT EQUAL
              ENDIF
            ENDIF
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBBSURNO
              GOTO      WBOP1000 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBBSURNO
              GOTO      WBOP9999 IF NOT EQUAL
            ENDIF
.
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WBOP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WBOP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBBSFLAG=ZERO
              GOTO      WBOP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBBSUNIQ
            GOTO      WBOP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBBSBATN
            GOTO      WBOP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBBSFLG
            GOTO      WBOP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBBSINVN
            GOTO      WBOP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,WBBSBATN,SP70
            CALL      RDWBBBB1
            BRANCH    OVRCD,WBOP1000
.
            MATCH     FRSTDATE,WBBBDTBC
            GOTO      WBOP1000 IF LESS
.
            MATCH     WBBBDTBC,LASTDATE
            GOTO      WBOP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBBSINVN,Z70
          CALL      RSWBBBA3
          CALL      RPWBBBA3
          IF        OVRCD=0
            MATCH     WBBSINVN,WBBAINVN
            IF        @EQUAL
              MATCH     " 3",WBBATYPE      *Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBBSFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07,STATBB08
.
          CALL      RBBE0000          * Resubmission BB claims
.
          CALL      GBBE0000          * Get current invoice outstanding balance
.
          MOVE      WBBSURNO,URNUMBER
.         MOVE      WBBSUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,WBBSINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,WBBSUNIQ,WBBSINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,WBOP1500
.
.         MATCH     WBBSUNIQ,DPRDTUNQ
.         GOTO      WBOP1500 IF NOT EQUAL
.
.         MATCH     WBBSINVN,PRDTINVN
.         GOTO      WBOP1500 IF NOT EQUAL
.
.         GOTO      WBOP1600
.
WBOP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBOP1600  REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "9",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBBSURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBBSUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBBSBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBBSINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBBSMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBBSURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBBSBATN,"#",":
                             "#"",WBBSUNIQ,"#",":
                             "#"",WBBSINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBBSAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBBSPBAT,"#",":
                             "#"",WBBSNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBBSBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBBSNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBBSFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBBSBATN,WBBSINVN,WBBSMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBBSBATN,DIM8
          REP       " +",WBBSURNO
          REP       " +",WBBSUNIQ
          REP       " +",WBBSBATN
          REP       " +",WBBSINVN
          REP       " +",WBBSMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
WBBSBATN,"','",WBBSUNIQ,"','",WBBSURNO,"','",WBBSINVN,"','",WBBSMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",WBBSURNO
          REP       "+ ",WBBSUNIQ
          REP       "+ ",WBBSBATN
          REP       "+ ",WBBSINVN
          REP       "+ ",WBBSMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      WBOP1000
.
WBOP9999  RETURN
+
.------------------------------------------------------------
. Table of Batch Numbers Bulk Billing
.------------------------------------------------------------
BATWB000  MATCH     "1",PTCNWSIN
          GOTO      BATWB999 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      BATWB999 IF NOT EQUAL
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BATHB000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70
          CALL      RSWBBBB1                     * position in file
BATWB100  CALL      RPWBBBB1                     * read previous record
          BRANCH    OVRCD,BATWB999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BATWB100
          ENDIF
.
          CALL      BABRW000      * Display Row
          BRANCH    EXIT,BATWB100
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BATWB100 IF NOT EQUAL
.
BATWB999  RETURN
+
.------------------------------------------------------------
. Batch Numbers by Code (TABLE HEADING) Bulk Billing
.------------------------------------------------------------
BATHB000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Batch Number</td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=25%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Date</td>":
                             "<td class=HeadingCell width=15%>":
                             "Time</td>":
.                            "<td class=HeadingCell width=15%>":
.                            "Status</td>":
                             "</tr>"
.
BATHB999  RETURN
+
.------------------------------------------------------------
. Batch Numbers (TABLE ROW) Bulk Billing
.------------------------------------------------------------
BABRW000  MOVE      ZERO,EXIT
          PACK      BTSCHOSP,BTSCHOSP,SP70
.
          UNPACK    WBBBDTBC,CCENT,CYEAR,CMON,CDAY  * Batch Created Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR

          UNPACK    WBBBTMBC,DIM5,ANS,ANS,ANS
.
          MOVE      SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      BABRW500 IF NOT EQUAL
.
          PACK      KEY24,WBBBBTHN,SP30         * get Hospital for given Batch
          CALL      RSWBBBS3
          CALL      RKWBBBS3
          IF        OVRCD=1
            MOVE      ONE,EXIT
            GOTO      BABRW999
          ENDIF
.
          MATCH     WBBBBTHN,WBBSBATN
          IF        @EQUAL
            MOVE      WBBSHOSP,KEY3
            CALL      RDPTHSP1            * read Hospital name for visit
            IF        OVRCD=1
              MOVE      WBBSHOSP,HOSPNAME
            ELSE
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
.
            MATCH     SP70,BTSCHOSP
            IF        !@EQUAL&!@EOS
              MATCH     BTSCHOSP,WBBSHOSP
              IF        !@EQUAL
                MOVE      ONE,EXIT
                GOTO      BABRW999
              ENDIF
            ENDIF
          ELSE
            MOVE      ONE,EXIT
            GOTO      BABRW999
          ENDIF
.
BABRW500  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",WBBBBTHN,"#")'>":
                             WBBBBTHN,"</a></td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",KEY11,"</td>":
                             "<td>",DIM5,"</td>":
                             "</tr>";
.
BABRW999  RETURN
+
.*****************************************************************************
.* Eclipse Bulk Billing - Marked As Viewed                                   *
.*****************************************************************************
.
.         First, get the last EDI History record for this invoice
.
MAVB0000  PACK      KEY27,MAVINVCE,Z70
          CALL      RSOTECA1                     * position on last history rec
MAVB0010  CALL      RPOTECA1                     * read previous record
          BRANCH    OVRCD,MAVB3000               * eof - finished
.
          MATCH     MAVINVCE,OTEAINVN            * same invoice still ?
          GOTO      MAVB3000 IF NOT EQUAL        * no - finished
.
          MATCH     MAVMODUL,OTECMODUL
          GOTO      MAVB0010 IF NOT EQUAL
.
.         Read otectaf
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDOTECT2
          BRANCH    OVRCD,MAVB3000
.
.         The last EDI history record has been found for the invoice, so
.         write a new record, defaulting some of the values from the read
.         record.
.
          MOVE      MAVBATCH,OTEABATN
          MOVE      MAVINVCE,OTEAINVN
          MOVE      MAVMODUL,OTEAMODL
.
MAVB1000  CALL      IBACLOCK                     * get current date/time
          PACK      OTEADATE,CCC,CYY,CMM,CDD
          REP       " 0",OTEADATE
          MOVE      CTIMEIS,OTEATIME
          REP       " 0",OTEATIME
.
          MOVE      " 7",OTEATYPE                * Type - Closed
          MOVE      WBSEUID,OTEAOPER
          MOVE      SP70,OTEASPAR
.
          PACK      KEY27,OTEAINVN,OTEADATE,OTEATIME,OTEATYPE,OTEAMODL,SP70
          CALL      RAOTECA1
          IF        OVRCD = 0
            GOTO      MAVB1000
          ENDIF
.
          CALL      WROTECA1                     * write EDI History record
.
.         If the record has a status of 
.         "Error (SA validation)"
.         then update the status to "Closed", as the claim cannot go any
.         further (unless resubmitted after closing).
.
          IF        OTECFLAG = 3
            PACK      KEY30,OTECHOSP,OTECFLAG,OTECMODL,OTECUNIQ,OTECINVN:
                            OTECBATN,SP70
            CALL      RDOTECT1                   * read selected record
            BRANCH    OVRCD,MAVB3000             * shouldn't happen
.
            MOVE      SEVEN,OTECFLAG             * update to "closed"
            CALL      UPOTECT1
.
.           Also write an EDI History record (outecaaf) for the close
.
            MOVE      OTECINVN,OTEAINVN
            MOVE      OTECBATN,OTEABATN
            MOVE      SEVEN,OTEASTAT            * Status - Closed
            MOVE      " 3",OTEATYPE             * Type - Viewed
            MOVE      WBSEUID,OTEAOPER
            MOVE      OTECTRID,OTEATRID
            MOVE      SP30,OTEASPAR
.
MAVB2000    CALL      IBACLOCK                   * get current time
            PACK      OTEADATE,CCC,CYY,CMM,CDD
            REP       " 0",OTEADATE
            MOVE      CTIMEIS,OTEATIME
            REP       " 0",OTEATIME
.
            PACK      KEY27,OTEAINVN,OTEADATE,OTEATIME,OTEATYPE,OTEAMODL,SP70
            CALL      RAOTECA1
            IF        OVRCD = 1
              CALL      WROTECA1
            ELSE
              GOTO      MAVB2000
            ENDIF
.
            GOTO      MAVB9000
          ELSE
            GOTO      MAVB9000
          ENDIF
.
MAVB3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      MAVB9100
.
MAVB9000  MOVE      ZERO,EXIT
          GOTO      MAVB9999
.
MAVB9100  MOVE      ONE,EXIT
.
MAVB9999  RETURN
+
.*****************************************************************************
.*                               WDBB0000                                    *
.* Eclipse Bulk Billing - Delete waiting claims                              *
.*****************************************************************************
WDBB0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBBBS2
          BRANCH    OVRCD,WDBB8000
.
          MOVE      WBBSINVN,TEMPINVN
          MOVE      WBBSBATN,TEMPBATN
          MOVE      WBBSUNIQ,TEMPADMN
          MOVE      WBBSURNO,TEMPURNO
          MOVE      WBBSMODL,TEMPMODL
          MOVE      WBBSPBAT,TEMPPBAT
          MOVE      WBBSHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      WDBB1000 IF EQUAL
          GOTO      WDBB1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,SP1,EIGHT,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDWBBBS1
          IF        OVRCD = 1
            GOTO      WDBB7000
          ELSE
            MOVE      SP70,WBBSNBAT
            CALL      IBACLOCK
            PACK      WBBSUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBBSUDAT
            MOVE      CTIMEIS,WBBSUTIM
            MOVE      USERID,WBBSUUID
            CALL      UPWBBBS1
          ENDIF
.
.         Delete the selected record
.
WDBB1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEWBBBS1
.
          GOTO      WDBB9999
.
WDBB7000  CLEAR     WEBTITLE
          APPEND    "Error updating previous claim ",WEBTITLE
          APPEND    WBBSINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    WBBSBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      WDBB9000
.
WDBB8000  MOVE      "Record cannot be deleted.",WEBTITLE
          CALL      WEBERR00
          GOTO      WDBB9000
.
WDBB9000  MOVE      ONE,EXIT
WDBB9999  RETURN
+
.------------------------------------------------------------
. Next Day, Week, Month
.------------------------------------------------------------
NEXT0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&viewtype=",VIEWTYPE:
                             "&hlthfund=",HLTHFUND:
                             "&hlfdclty=",HLFDCLTY:
                             "&procstat=",PROCSTAT;
.
NEXT9999  RETURN
+
.------------------------------------------------------------
. Previous Day, Week, Month
.------------------------------------------------------------
PREV0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&viewtype=",VIEWTYPE:
                             "&hlthfund=",HLTHFUND:
                             "&hlfdclty=",HLFDCLTY:
                             "&procstat=",PROCSTAT;
.
PREV9999  RETURN
+
.------------------------------------------------------------
. Medicare WebServices PRODA Management
.------------------------------------------------------------
PRDA0000  MATCH     "1",PTCNWSIN
          GOTO      PRDA9160 IF NOT EQUAL
.
          CALL      PROPN000
.
          MATCH     "1",PRODAIND
          GOTO      PRDA9100 IF EQUAL
.
          MATCH     "2",PRODAIND
          GOTO      PRDA9120 IF EQUAL
.
          MATCH     "3",PRODAIND
          GOTO      PRDA9130 IF EQUAL
.
          MATCH     "4",PRODAIND
          GOTO      PRDA9140 IF EQUAL
.
          MATCH     "5",PRODAIND
          GOTO      PRDA9150 IF EQUAL
.
          OPEN      WBSPROPF,PRDAPATH
          OPEN      WBSACTVF,ACTVPATH
          OPEN      WBSTOKNF,TOKNPATH
          OPEN      WBSACTOF,ACTOPATH
          OPEN      WBSTOKOF,TOKNPATH
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      PRDA6000 IF EQUAL

          MATCH     "U",UPDATTYP
          GOTO      PRDA1000 IF EQUAL
.
          MATCH     "A",UPDATTYP
          GOTO      PRDA2000 IF EQUAL
.
          MATCH     "G",UPDATTYP
          GOTO      PRDA3000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      PRDA4000 IF EQUAL
.
          GOTO      PRDA9000
.
PRDA1000  CALL      CLWBSR00
          CALL      MVWBSR00           
.
          CALL      WRWBSR00     
.
          GOTO      PRDA9999
.
PRDA2000  CLEAR     CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_PRODA_run ActivateDevice ",CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          GOTO      PRDA9999
.
PRDA3000  CLEAR     CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_PRODA_run GetAccessToken ",CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          GOTO      PRDA9999
.
PRDA4000  CLEAR     CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_PRODA_run RefreshKeyDevice ",CMDLINE
          APPEND    PTCNWSDR,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          GOTO      PRDA9999
.
PRDA6000  CALL      RDWBSR00
.
          CLEAR     WEBTITLE
          MOVE      "Medicare WebServices PRODA Management",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,PRDA9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      PRDA9999
.
PRDA9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
PRDA9100  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    PRDAPATH,WEBTITLE 
          RESET     WEBTITLE      
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
PRDA9120  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    ACTVPATH,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
PRDA9130  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    TOKNPATH,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
PRDA9140  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    ACTOPATH,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
PRDA9150  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    TOKOPATH,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
PRDA9160  MOVE      "Not Using Medicare WebServices.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CLMT9999
.
PRDA9999  CLOSE      WBSPROPF
          CLOSE      WBSACTVF
          CLOSE      WBSTOKNF
          CLOSE      WBSACTOF
          CLOSE      WBSTOKOF
          RETURN
+
.------------------------------------------------------------
. Read WebServices PRODA properties file
.------------------------------------------------------------
RDWBSR00  READ      WBSPROPF,SEQ;WBSPILAB,WBSPROID
          READ      WBSPROPF,SEQ;WBSJKLAB,WBSJKSLO
          READ      WBSPROPF,SEQ;WBSPOLAB,WBSPRORG
          READ      WBSPROPF,SEQ;WBSDNLAB,WBSDVNAM
          READ      WBSPROPF,SEQ;WBSCILAB,WBSCLIID
          READ      WBSPROPF,SEQ;WBSATLAB,WBSACTAU
          READ      WBSPROPF,SEQ;WBSACLAB,WBSACTVC
          READ      WBSPROPF,SEQ;WBSDALAB,WBSDACUR
          READ      WBSPROPF,SEQ;WBSDULAB,WBSDAUUR
          READ      WBSPROPF,SEQ;WBSRDLAB,WBSRDKUR
.
RDWBSR99  RETURN
+
.------------------------------------------------------------
. Write WebServices PRODA properties file
.------------------------------------------------------------
WRWBSR00  STRIP     WBSPROID
          STRIP     WBSJKSLO
          STRIP     WBSPRORG
          STRIP     WBSDVNAM
          STRIP     WBSCLIID
          STRIP     WBSACTAU
          STRIP     WBSACTVC
          STRIP     WBSDACUR
          STRIP     WBSDAUUR
          STRIP     WBSRDKUR
.
          WRITE     WBSPROPF,SEQ;WBSPILAB,WBSPROID
          WRITE     WBSPROPF,SEQ;WBSJKLAB,WBSJKSLO
          WRITE     WBSPROPF,SEQ;WBSPOLAB,WBSPRORG
          WRITE     WBSPROPF,SEQ;WBSDNLAB,WBSDVNAM
          WRITE     WBSPROPF,SEQ;WBSCILAB,WBSCLIID
          WRITE     WBSPROPF,SEQ;WBSATLAB,WBSACTAU
          WRITE     WBSPROPF,SEQ;WBSACLAB,WBSACTVC
          WRITE     WBSPROPF,SEQ;WBSDALAB,WBSDACUR
          WRITE     WBSPROPF,SEQ;WBSDULAB,WBSDAUUR
          WRITE     WBSPROPF,SEQ;WBSRDLAB,WBSRDKUR
.
WRWBSR99  RETURN
+
.------------------------------------------------------------
.  WebServices PRODA Tags
.------------------------------------------------------------
PRTG0000  BRANCH    FLDITMNO,PRTG0100,PRTG0200,PRTG0300,PRTG0400,PRTG0500:
                             PRTG0600,PRTG0700,PRTG0800,PRTG0900,PRTG1000:
                             PRTG1100,PRTG1200,PRTG1300,PRTG1400,PRTG1500:
                             PRTG1600,PRTG1700,PRTG1800,PRTG1900
.
          GOTO      PRTG9999
.
PRTG0100  WRITE     HTMLFILE;WBSPROID;
          GOTO      PRTG9999
.
PRTG0200  WRITE     HTMLFILE;WBSJKSLO;
          GOTO      PRTG9999
.
PRTG0300  WRITE     HTMLFILE;WBSPRORG;
          GOTO      PRTG9999
.
PRTG0400  WRITE     HTMLFILE;WBSDVNAM;
          GOTO      PRTG9999
.
PRTG0500  WRITE     HTMLFILE;WBSCLIID;
          GOTO      PRTG9999
.
PRTG0600  WRITE     HTMLFILE;WBSACTAU;
          GOTO      PRTG9999
.
PRTG0700  WRITE     HTMLFILE;WBSACTVC;
          GOTO      PRTG9999
.
PRTG0800  CALL      PRDACT00
          GOTO      PRTG9999
.
PRTG0900  CALL      PRDTKN00
          GOTO      PRTG9999
.
PRTG1000  CALL      PRDACO00
          GOTO      PRTG9999
.
PRTG1100  CALL      PRDTKO00
          GOTO      PRTG9999
.
PRTG1200  WRITE     HTMLFILE;WBSDACUR;
          GOTO      PRTG9999
.
PRTG1300  WRITE     HTMLFILE;WBSDAUUR;
          GOTO      PRTG9999
.
PRTG1400  WRITE     HTMLFILE;WBSRDKUR;
          GOTO      PRTG9999
.
PRTG1500  WRITE     HTMLFILE;PRDAPATH;
          GOTO      PRTG9999
.
PRTG1600  WRITE     HTMLFILE;ACTVPATH;
          GOTO      PRTG9999
.
PRTG1700  WRITE     HTMLFILE;TOKNPATH;
          GOTO      PRTG9999
.
PRTG1800  WRITE     HTMLFILE;ACTOPATH;
          GOTO      PRTG9999
.
PRTG1900  WRITE     HTMLFILE;TOKOPATH;
          GOTO      PRTG9999
.
PRTG9999  RETURN
+
.------------------------------------------------------------
.  Move spaces to WebServices variables
.------------------------------------------------------------
CLWBSR00  MOVE      SP70,WBSPROID
          MOVE      SP70,WBSJKSLO
          MOVE      SP70,WBSPRORG
          MOVE      SP70,WBSDVNAM
          MOVE      SP70,WBSCLIID
          MOVE      SP70,WBSACTAU
          MOVE      SP70,WBSACTVC
          MOVE      SP70,WBSDACUR 
          MOVE      SP70,WBSDAUUR 
          MOVE      SP70,WBSRDKUR 
.
CLWBSR99  RETURN
+
.------------------------------------------------------------
.   Set Parameters for WebServices PRODA variables
.------------------------------------------------------------
SWBSR000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SWBSR010,SWBSR020,SWBSR030,SWBSR040,SWBSR050:
                       SWBSR060,SWBSR070,SWBSR080,SWBSR090,SWBSR100
.
          MOVE      ONE,EXIT
          GOTO      SWBSR999

SWBSR010  PACK      WBSRV001,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR020  PACK      WBSRV002,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR030  PACK      WBSRV003,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR040  PACK      WBSRV004,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR050  PACK      WBSRV005,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR060  PACK      WBSRV006,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR070  PACK      WBSRV007,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR080  PACK      WBSRV008,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR090  PACK      WBSRV009,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR100  PACK      WBSRV010,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR999  RETURN
+
.------------------------------------------------------------
.  Move WebServices cgi variables to text file variables
.------------------------------------------------------------
MVWBSR00  MOVE      WBSRV001,WBSPROID
          MOVE      WBSRV002,WBSJKSLO
          MOVE      WBSRV003,WBSPRORG
          MOVE      WBSRV004,WBSDVNAM
          MOVE      WBSRV005,WBSCLIID
          MOVE      WBSRV006,WBSACTAU
          MOVE      WBSRV007,WBSACTVC
          MOVE      WBSRV008,WBSDACUR
          MOVE      WBSRV009,WBSDAUUR
          MOVE      WBSRV010,WBSRDKUR
.
MVWBSR99  RETURN
+
.------------------------------------------------------------
.  Display Activate Device Response from Medicarwe PRODA
.------------------------------------------------------------
PRDACT00  OPEN      WBSACTVF,ACTVPATH
.
PRDACT10  PACK      VAR,SP70,SP70
          READ      WBSACTVF,SEQ;VAR
          GOTO      PRDACT99 IF OVER
.
          WRITE     HTMLFILE;VAR                    
.
          GOTO      PRDACT10
.
PRDACT99  CLOSE     WBSACTVF
          RETURN
+
.------------------------------------------------------------
.  Display Activate Device Standard Out from Medicare PRODA
.------------------------------------------------------------
PRDACO00  OPEN      WBSACTOF,ACTOPATH
.
PRDACO10  READ      WBSACTOF,SEQ;DIM100,DIM100A
          GOTO      PRDACO99 IF OVER
.
          WRITE     HTMLFILE;DIM100,DIM100A
.
          GOTO      PRDACO10
.
PRDACO99  CLOSE     WBSACTOF
          RETURN
+
.------------------------------------------------------------
.  Display Get Access Token Standard Out from Medicare PRODA
.------------------------------------------------------------
PRDTKO00  OPEN      WBSTOKOF,TOKOPATH
.
PRDTKO10  READ      WBSTOKOF,SEQ;DIM100,DIM100A
          GOTO      PRDTKO99 IF OVER
.
          WRITE     HTMLFILE;DIM100,DIM100A
.
          GOTO      PRDTKO10
.
PRDTKO99  CLOSE     WBSTOKOF
          RETURN
+
.------------------------------------------------------------
.  Display Access Token Response from Medicarwe PRODA
.------------------------------------------------------------
PRDTKN00  OPEN      WBSTOKNF,TOKNPATH
.
PRDTKN10  READ      WBSTOKNF,SEQ;VAR
          GOTO      PRDTKN99 IF OVER
.
          SCAN      "access_token",VAR
          GOTO      PRDTKN50 IF EQUAL
.
          WRITE     HTMLFILE;VAR
.
          GOTO      PRDTKN10
.
PRDTKN50  CLOSE     WBSTOKNF
          OPEN      WBSTOKNF,TOKNPATH
.
          READ      WBSTOKNF,SEQ;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                                 DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
          GOTO      PRDTKN99 IF OVER
.
          WRITE     HTMLFILE;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                             DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
.
PRDTKN99  CLOSE     WBSTOKNF
          RETURN
+
.------------------------------------------------------------
.  Open PRODA Text Files
.------------------------------------------------------------
PROPN000  CLEAR     PRDAPATH
          APPEND    PTCNWSDR,PRDAPATH
          RESET     PRDAPATH
          STRIP     PRDAPATH
          ENDSET    PRDAPATH
          APPEND    SLASH,PRDAPATH
          APPEND    PRDAFILE,PRDAPATH
          RESET     PRDAPATH
.
          MOVE      ZERO,PRODAIND
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSPROPF,PRDAPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,PRODAIND
            GOTO      PROPN500
          ENDIF
          CLOSE     WBSPROPF
.
          CLEAR     ACTVPATH
          APPEND    PTCNWSDR,ACTVPATH
          RESET     ACTVPATH
          STRIP     ACTVPATH
          ENDSET    ACTVPATH
          APPEND    SLASH,ACTVPATH
          APPEND    ACTVFILE,ACTVPATH
          RESET     ACTVPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSACTVF,ACTVPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      TWO,PRODAIND
            GOTO      PROPN500
          ENDIF
          CLOSE     WBSACTVF
.
          CLEAR     TOKNPATH
          APPEND    PTCNWSDR,TOKNPATH
          RESET     TOKNPATH
          STRIP     TOKNPATH
          ENDSET    TOKNPATH
          APPEND    SLASH,TOKNPATH
          APPEND    TOKNFILE,TOKNPATH
          RESET     TOKNPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSTOKNF,TOKNPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      THREE,PRODAIND
            GOTO      PROPN500
          ENDIF
          CLOSE     WBSTOKNF
.
          CLEAR     ACTOPATH
          APPEND    PTCNWSDR,ACTOPATH
          RESET     ACTOPATH
          STRIP     ACTOPATH
          ENDSET    ACTOPATH
          APPEND    SLASH,ACTOPATH
          APPEND    ACTOFILE,ACTOPATH
          RESET     ACTOPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSACTOF,ACTOPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      FOUR,PRODAIND
            GOTO      PROPN500
          ENDIF
          CLOSE     WBSACTOF
.
          CLEAR     TOKOPATH
          APPEND    PTCNWSDR,TOKOPATH
          RESET     TOKOPATH
          STRIP     TOKOPATH
          ENDSET    TOKOPATH
          APPEND    SLASH,TOKOPATH
          APPEND    TOKOFILE,TOKOPATH
          RESET     TOKOPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WBSTOKOF,TOKOPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      FIVE,PRODAIND
            GOTO      PROPN500
          ENDIF
          CLOSE     WBSTOKOF
.
PROPN500
.
PROPN999  RETURN
+
.------------------------------------------------------------
. Table of EDI Service Details
.------------------------------------------------------------
EDHS0000  MATCH     "1",PTCNWSIN
          GOTO      EDHS9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      EDHS9999 IF NOT EQUAL
.
          CALL      EDHSHD00      * Output Table Heading
.
          PACK      KEY38,ECCLFBID,ECCLARID,ECCLCLID,ECCLRPTC,ECCLEVTC,SP70
          CALL      RSWBIMH1                     * position in file
EDHS1000  CALL      RKWBIMH1                     * read next record
          BRANCH    OVRCD,EDHS9999               * end of file
.
          MATCH     ECCLFBID,WBIHFBID            * same fund brand id ?
          GOTO      EDHS9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,WBIHARID            * same account ref. id ?
          GOTO      EDHS9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLCLID,WBIHCLID            * same fund ref. id ?
          GOTO      EDHS9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLRPTC,WBIHRPTC            * same report counter ?
          GOTO      EDHS9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLEVTC,WBIHMECN            * same report counter ?
          GOTO      EDHS9999 IF NOT EQUAL
.
          CALL      EDHSRW00
.
          GOTO      EDHS1000
.
EDHS9999  RETURN
+
.------------------------------------------------------------
. EDI Service Details (TABLE HEADING)
.------------------------------------------------------------
EDHSHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Service ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Assessment Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Benefit&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Date Of Service&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Schedule Fee&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Text&nbsp;</td>":
                             "</tr>"
.
EDHSHD99  RETURN
+
.------------------------------------------------------------
. EDI Service Details (Detail Row)
.------------------------------------------------------------
EDHSRW00  WRITE     HTMLFILE;"<tr><td>",WBIHSVID,"</td>";
          WRITE     HTMLFILE;"<td>",WBIHSVAC,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIHSVBE
          REP       " 0",WBIHSVBE
          UNPACK    WBIHSVBE,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIHSVCA
          REP       " 0",WBIHSVCA
          UNPACK    WBIHSVCA,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIHSVDS
          IF        !@EQUAL & !@EOS
            UNPACK    WBIHSVDS,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIHSVIT,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIHSVSF
          REP       " 0",WBIHSVSF
          UNPACK    WBIHSVSF,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIHSVEC,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIHSVET,"</td>";
.
EDHSRW99  RETURN
+
.---------------------------------------------------------------
. IMCW RTVW <tran id>.properties tag
.---------------------------------------------------------------
RTVHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      RTVHED99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     RTVHED99 IF EQUAL
          GOTO     RTVHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      RTVHED99
          ENDIF
.
RTVHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      RTVHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      RTVHED10
.
RTVHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. IMCW RTVW <tran id>_imcwrtvw  tag
.---------------------------------------------------------------
RTVJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      RTVJSN99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     RTVJSN99 IF EQUAL
          GOTO     RTVJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTVWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      RTVWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      RTVJSN99
          ENDIF
.
RTVJSN10  READ      RTVWFILE,SEQ;RTVWLINE
          GOTO      RTVJSN99 IF OVER
.
          WRITE     HTMLFILE;RTVWLINE
.
          GOTO      RTVJSN10
.
RTVJSN99  CLOSE     RTVWFILE
.
          RETURN
+
.---------------------------------------------------------------
. IMCW RTVW <tran id>_imcwrtvw_response  tag
.---------------------------------------------------------------
RTVRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      RTVRSP99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     RTVRSP99 IF EQUAL
          GOTO     RTVRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTVRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      RTVRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      RTVRSP99
          ENDIF
.
RTVRSP10  READ      RTVRFILE,SEQ;RTVRLINE
          GOTO      RTVRSP99 IF OVER
.
          WRITE     HTMLFILE;RTVRLINE
.
          GOTO      RTVRSP10
.
RTVRSP99  CLOSE     RTVRFILE
.
          RETURN
+
.---------------------------------------------------------------
. IMCW RTVW <tran id>_imcwrtvw_errors  tag
.---------------------------------------------------------------
RTVERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      RTVERR99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     RTVERR99 IF EQUAL
          GOTO     RTVERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTVELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      RTVEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      RTVERR99
          ENDIF
.
RTVERR10  READ      RTVEFILE,SEQ;RTVELINE
          GOTO      RTVERR99 IF OVER
.
          WRITE     HTMLFILE;RTVELINE
.
          GOTO      RTVERR10
.
RTVERR99  CLOSE     RTVEFILE
.
          RETURN
+
.---------------------------------------------------------------
. IMCW <tran id>.properties tag
.---------------------------------------------------------------
IMCHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      IMCHED99
          ENDIF
.
          MATCH    SP70,WBIMTRID
          GOTO     IMCHED99 IF EQUAL
          GOTO     IMCHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBIMTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IMCHED99
          ENDIF
.
IMCHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      IMCHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      IMCHED10
.
IMCHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. IMCW <tran id>_imcw  tag
.---------------------------------------------------------------
IMCJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      IMCJSN99
          ENDIF
.
          MATCH    SP70,WBIMTRID
          GOTO     IMCJSN99 IF EQUAL
          GOTO     IMCJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBIMTRID,CMDLINE
          APPEND    IMCWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IMCWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IMCJSN99
          ENDIF
.
IMCJSN10  READ      IMCWFILE,SEQ;IMCWLINE
          GOTO      IMCJSN99 IF OVER
.
          WRITE     HTMLFILE;IMCWLINE
.
          GOTO      IMCJSN10
.
IMCJSN99  CLOSE     IMCWFILE
.
          RETURN
+
.---------------------------------------------------------------
. IMCW <tran id>_imcw_response  tag
.---------------------------------------------------------------
IMCRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      IMCRSP99
          ENDIF
.
          MATCH    SP70,WBIMTRID
          GOTO     IMCRSP99 IF EQUAL
          GOTO     IMCRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBIMTRID,CMDLINE
          APPEND    IMCRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IMCRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IMCRSP99
          ENDIF
.
IMCRSP10  READ      IMCRFILE,SEQ;IMCRLINE
          GOTO      IMCRSP99 IF OVER
.
          WRITE     HTMLFILE;IMCRLINE
.
          GOTO      IMCRSP10
.
IMCRSP99  CLOSE     IMCRFILE
.
          RETURN
+
.---------------------------------------------------------------
. IMCW <tran id>_imcw_errors  tag
.---------------------------------------------------------------
IMCERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      IMCERR99
          ENDIF
.
          MATCH    SP70,WBIMTRID
          GOTO     IMCERR99 IF EQUAL
          GOTO     IMCERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/imcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBIMTRID,CMDLINE
          APPEND    IMCELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IMCEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IMCERR99
          ENDIF
.
IMCERR10  READ      IMCEFILE,SEQ;IMCELINE
          GOTO      IMCERR99 IF OVER
.
          WRITE     HTMLFILE;IMCELINE
.
          GOTO      IMCERR10
.
IMCERR99  CLOSE     IMCEFILE
.
          RETURN
+
.------------------------------------------------------------
. WebServices IHCW  Claim Full Details
.------------------------------------------------------------
ECFD0000  MATCH     "1",PTCNWSIN
          GOTO      ECFD9500 IF NOT EQUAL
.
          MATCH     "1",PTCNIHCW
          GOTO      ECFD9500 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      ECFD5000 IF EQUAL
.
          MATCH     ANSC,UPDATTYP
          GOTO      ECFD6000 IF EQUAL
.
          GOTO      ECFD9000
.
ECFD5000  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,ECFD9100
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,ECFD9100
.
          CALL      GETPA200
          CALL      PATLN000
          CALL      PATFLD00                * Use standard Patient Folder sub
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIHC2
          BRANCH    OVRCD,ECFD9200
.
          CALL      DFUH0000
.
          PACK      KEY71,WBICHOSP,SP70          * Read B2B Device Table
          CALL      RSWBB2B3
          CALL      RKWBB2B3
          IF        OVRCD=1
            MOVE      SP70,WBB2DPTH
          ELSE
            MATCH     WBICHOSP,WBB2HOSP
            IF        !@EQUAL
              MOVE      SP70,WBB2DPTH
            ENDIF
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "WebServices IHCW Claim Full Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,ECFD9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      ECFD9999
.
ECFD6000  PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIHC2
          BRANCH    OVRCD,ECFD9200
.
          MOVE      TEN6,WBICFLAG

          CALL      IBACLOCK
          PACK      WBICCDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBICCDAT
          MOVE      CTIMEIS,WBICCTIM
          MOVE      USERID,WBICCUID
          CALL      UPWBIHC2
.
.         Write a new history (webihaaf) record
.
          MOVE      WBICINVN,WBIIINVN
          MOVE      WBICBATN,WBIIBATN
          MOVE      TEN6,WBIISTAT
          MOVE      " 5",WBIITYPE
          MOVE      WBSEUID,WBIIOPER
          MOVE      WBICTRID,WBIITRID
          MOVE      WBICMSID,WBIIMSID
          MOVE      SP70,WBIIEROR
          MOVE      SP70,WBIIEROT
          MOVE      SP70,WBIISPAR
.
          CALL      IBACLOCK                     * get current date/time
          PACK      WBIIDATE,CCC,CYY,CMM,CDD
          REP       " 0",WBIIDATE
          MOVE      CTIMEIS,WBIITIME
          REP       " 0",WBIITIME
.
          PACK      KEY26,WBIIINVN,WBIIDATE,WBIITIME,WBIITYPE,SP70
          CALL      RAWBIHA1
          IF        OVRCD = 1
            CALL      WRWBIHA1
          ENDIF
.
          MOVE      SP70,TTYPEARG
          MOVE      " 1",TTYPEARG
          CALL      DELETR00
.
          MOVE      " 3",TTYPEARG
          CALL      DELETR00
.
          MOVE      " 4",TTYPEARG
          CALL      DELETR00
.
          MOVE      " 5",TTYPEARG
          CALL      DELETR00
.
          CALL      DELEHO00
.
          MOVE      ZERO,EXIT
          GOTO      ECFD9999
.
ECFD9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECFD9999
.
ECFD9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECFD9999
.
ECFD9200  MOVE      "Can't find WebServices Claim details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECFD9999
.
ECFD9500  MOVE      "Not using WebServices IHCW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WIMC9999
.
ECFD9999  RETURN
+
.*****************************************************************************
.*                          DFUH0000                                         *
.*****************************************************************************
.
DFUH0000  CALL      GBAH0000                     * get outstanding inv. balance
.
          MOVE      STATUH00,STATDESC
          LOAD      STATDESC,WBICFLAG,STATUH01,STATUH02,STATUH03,STATUH04:
                                      STATUH05,STATUH06,STATUH07,STATUH08:
                                      STATUH09,STATUH10,STATUH11,STATUH12:
                                      STATUH13,STATUH14,STATUH15,STATUH16
.
          MOVE      "Unknown         ",CONTDESC
          MOVE      WBICCCFL,ANS
          REP       "N1F2L3M4",ANS
          MOVE      ANS,FORM1
          LOAD      CONTDESC,FORM1,CONTDES1,CONTDES2,CONTDES3,CONTDES4
.
DFUH9999  RETURN
+
.*****************************************************************************
.*                          GBAH0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on pmsectaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBAH0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBICINVN,KEY8
          CALL      RDINV1
          IF        OVRCD = 1
            GOTO      GBAH9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR+PTINCRTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PTINGSTJ,FORM7P2O
          ENDIF
.
GBAH9999  RETURN
+
.------------------------------------------------------------------------------
. Close webecoaf records
.------------------------------------------------------------------------------
DELEHO00  PACK      KEY31,WBICHFND,ZERO,WBICTRID,SP70
          CALL      RDWBECO1
          BRANCH    OVRCD,DELEHO99
.
.         We should only have one record with flag either 'Open' or 'Closed'
.
          PACK      SKEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
.
          MOVE      ONE,WBEODFLG
          PACK      KEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
          CALL      RAWBECO1
          IF        OVRCD=1
            MOVE      SKEY31,KEY31
            CALL      RDWBECO1                     * reposition
            IF        OVRCD=0
              MOVE      ONE,WBEODFLG
              CALL      UPWBECO1                   * update record
            ENDIF
          ELSE
            MOVE      "0",WBEODFLG                 * set to Open
            PACK      KEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
            CALL      DEWBECO1
          ENDIF
.
DELEHO99  RETURN
+
.------------------------------------------------------------
. WebServices IHCW Claim Full Details tags
.------------------------------------------------------------
.
ECFH0000  BRANCH    FLDITMNO,ECFH0100,ECFH0200,ECFH0300,ECFH0400,ECFH0500:
                             ECFH0600,ECFH0700,ECFH0800,ECFH0900,ECFH1000:
                             ECFH1100,ECFH1200,ECFH1300,ECFH1400,ECFH1500:
                             ECFH1600,ECFH1700,ECFH1800,ECFH1900,ECFH2000:
                             ECFH2100,ECFH2200,ECFH2300,ECFH2400,ECFH2500:
                             ECFH2600,ECFH2700,ECFH2800,ECFH2900,ECFH3000:
                             ECFH3100,ECFH3200,ECFH3300,ECFH3400,ECFH3500:
                             ECFH3600,ECFH3700,ECFH3800,ECFH3900,ECFH4000:
                             ECFH4100,ECFH4200,ECFH4300,ECFH4400,ECFH4500:
                             ECFH4600
.
          GOTO      ECFH9999
.
ECFH0100  WRITE     HTMLFILE;FORM7P2O;
          GOTO      ECFH9999
.
ECFH0200  WRITE     HTMLFILE;STATDESC;
          GOTO      ECFH9999
.
ECFH0300  WRITE     HTMLFILE;CONTDESC;
          GOTO      ECFH9999
.
ECFH0400  MATCH     SP70,WBICPDAT
          GOTO      ECFH9999 IF EQUAL
          UNPACK    WBICPDAT,CCENT,CYEAR,CMON,CDAY  * Payment Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ECFH9999
.
ECFH0500  WRITE     HTMLFILE;WBICEETP;
          GOTO      ECFH9999
.
ECFH0600  IF        WBICEETP=0
            UNPACK    DIM127,D1,KEY1,DIM127
            PACK      KEY14,WBICHFND,ZERO,ZERO,ZERO,ZERO,SP70
            CALL      RDFUND1
            IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
            ELSE
              WRITE     HTMLFILE;AFUNDH;
            ENDIF
            WRITE     HTMLFILE;" / ";
            PACK      KEY14 WITH WBICHFND,AFNDTB,SP70
            CALL      RDFUND1
            IF        OVRCD=0
              WRITE     HTMLFILE;HFNAME;      * Description of Table
            ELSE
              WRITE     HTMLFILE;AFNDTB;      * Table code
            ENDIF
          ELSE
            MOVE      "CL",CATEGORY
            MOVE      WBICHFND,CODE
            CALL      CODITM00
          ENDIF
          GOTO      ECFH9999
.
ECFH0700  WRITE     HTMLFILE;WBICINVN;
          GOTO      ECFH9999
.
ECFH0800  WRITE     HTMLFILE;WBICBATN;
          GOTO      ECFH9999
.
ECFH0900  WRITE     HTMLFILE;WBICPBAT;
          GOTO      ECFH9999
.
ECFH1000  WRITE     HTMLFILE;WBICNBAT;
          GOTO      ECFH9999
.
ECFH1100  WRITE     HTMLFILE;WBICTRID;
          GOTO      ECFH9999
.
ECFH1200  WRITE     HTMLFILE;WBICFTID;
          GOTO      ECFH9999
.
ECFH1300  WRITE     HTMLFILE;WBICAMTC;
          GOTO      ECFH9999
.
ECFH1400  WRITE     HTMLFILE;PINVAMT;
          GOTO      ECFH9999
.
ECFH1500  WRITE     HTMLFILE;PINVPATA;
          GOTO      ECFH9999
.
ECFH1600  WRITE     HTMLFILE;PINVHFDA;
          GOTO      ECFH9999
.
ECFH1700  WRITE     HTMLFILE;PINVOTHA;
          GOTO      ECFH9999
.
ECFH1800  WRITE     HTMLFILE;PINVJOUR;
          GOTO      ECFH9999
.
ECFH1900  WRITE     HTMLFILE;WBICAMTP;
          GOTO      ECFH9999
.
ECFH2000  MATCH     SP70,WBICSTAT                 * blank status ?
          GOTO      ECFH9999 IF EQUAL            * yes - don't display anything
          GOTO      ECFH9999 IF EOS
.
          MATCH     " 0",WBICSTAT                * closed without pymt or w/o
          IF        @EQUAL
            WRITE     HTMLFILE;"No Payment or Write-Off";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     " 1",WBICSTAT                * closed with write-off only
          IF        @EQUAL
            WRITE     HTMLFILE;"Write-Off Only";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     " 2",WBICSTAT                * closed with payment only
          IF        @EQUAL
            WRITE     HTMLFILE;"Payment Only";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     " 3",WBICSTAT                * closed with payment & w/o
          IF        @EQUAL
            WRITE     HTMLFILE;"Payment & Write-Off";
            GOTO      ECFH9999
          ENDIF
.
          GOTO      ECFH9999
.
ECFH2100  CALL      EHIH0000
          GOTO      ECFH9999
.
ECFH2200  CALL      EHAR0000
          GOTO      ECFH9999
.
ECFH2300  CALL      EHCD0000
          GOTO      ECFH9999
.
ECFH2400  CALL      EHCE0000
          GOTO      ECFH9999
.
ECFH2500  CALL      EHSD0000
          GOTO      ECFH9999
.
ECFH2600  WRITE     HTMLFILE;PTINCRTT;
          GOTO      ECFH9999
.
ECFH2700  WRITE     HTMLFILE;CFEETYP;
          GOTO      ECFH9999
.
ECFH2800  WRITE     HTMLFILE;WBICFLAG;
          GOTO      ECFH9999
.
ECFH2900  PACK      SAVKEY24,WBICADMN,WBICINVN,WBICBATN,SP70
          MOVE      WBICADMN,SAVEVISN
          MOVE      WBICTRID,SAVETRID
.
          PACK      KEY24,WBICADMN,SP70
          CALL      RSWBIHC4
ECFH2910  CALL      RKWBIHC4
          BRANCH    OVRCD,ECFH2999
.
          MATCH     SAVEVISN,WBICADMN
          GOTO      ECFH2999 IF NOT EQUAL
.
          MATCH     SAVETRID,WBICPCTI
          GOTO      ECFH2910 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;
.
ECFH2999  PACK      KEY24,SAVKEY24,SP70
          CALL      RDWBIHC4
.
          GOTO      ECFH9999
.
ECFH3000  CALL      EHSE0000
          GOTO      ECFH9999
.
ECFH3100  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECFH9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFH9999
.
ECFH3200  CALL      RTHHED00
          GOTO      ECFH9999
.
ECFH3300  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECFH9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTHWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFH9999
.
ECFH3400  CALL      RTHJSN00
          GOTO      ECFH9999
.
ECFH3500  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECFH9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTHRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFH9999
.
ECFH3600  CALL      RTHRSP00
          GOTO      ECFH9999
.
ECFH3700  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECFH9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTHELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFH9999
.
ECFH3800  CALL      RTHERR00
          GOTO      ECFH9999
.
ECFH3900  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     SP70,WBICTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECFH9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBICTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFH9999
.
ECFH4000  CALL      IHCHED00
          GOTO      ECFH9999
.
ECFH4100  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     SP70,WBICTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECFH9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBICTRID,CMDLINE
          APPEND    IHCWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFH9999
.
ECFH4200  CALL      IHCJSN00
          GOTO      ECFH9999
.
ECFH4300  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     SP70,WBICTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECFH9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBICTRID,CMDLINE
          APPEND    IHCRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFH9999
.
ECFH4400  CALL      IHCRSP00
          GOTO      ECFH9999
.
ECFH4500  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFH9999
          ENDIF
.
          MATCH     SP70,WBICTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECFH9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBICTRID,CMDLINE
          APPEND    IHCELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFH9999
.
ECFH4600  CALL      IHCERR00
          GOTO      ECFH9999
.
ECFH9999  RETURN
+
.------------------------------------------------------------
. Table of WebServices IHCW History
.------------------------------------------------------------
EHIH0000  MOVE      ZERO,LOOPCNTR
.
          CALL      EHIHD000      * Output Table Heading
.
          PACK      KEY34,MAVINVCE,Z70
          CALL      RSWBIHA3
EHIH1000  CALL      RPWBIHA3
          BRANCH    OVRCD,EHIH9999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"<!-- ",LOOPCNTR," -->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     MAVINVCE,WBIIINVN
          GOTO      EHIH9999 IF NOT EQUAL
.
          CALL      EHIRW000
.
          GOTO      EHIH1000
.
EHIH9999  RETURN
+
.------------------------------------------------------------
. WebServices IHCW History (TABLE HEADING)
.------------------------------------------------------------
EHIHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Time</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Status</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Transaction Type</td>":
                             "<td class=HeadingCell width=5%>":
                             "Batch</td>":
                             "<td class=HeadingCell width=15%>":
                             "Reviewed By</td>":
                             "<td class=HeadingCell width=35%>":
                             "Error Code Description</td>":
                             "</tr>"
.
EHIHD999  RETURN
+
.------------------------------------------------------------
. WebServices IHCW History (Detail Row)
.------------------------------------------------------------
EHIRW000  MOVE      SP70,DIM11
          MATCH     SP70,WBIIDATE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIIDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          MOVE      STATUH00,STATDESC
          LOAD      STATDESC,WBIISTAT,STATUH01,STATUH02,STATUH03,STATUH04:
                                      STATUH05,STATUH06,STATUH07,STATUH08:
                                      STATUH09,STATUH10,STATUH11,STATUH12:
                                      STATUH13,STATUH14,STATUH15,STATUH16
.
          MOVE      SP30,TYPEDESC
          MOVE      WBIITYPE,TYPOFREQ
          LOAD      TYPEDESC,TYPOFREQ,TYPEDES1,TYPEDES2,TYPEDES3,TYPEDES4:
                                      TYPEDES5,TYPEDES6,TYPEDES7
          IF        TYPOFREQ = 6 | TYPOFREQ = 7
            STRIP     TYPEDESC
            ENDSET    TYPEDESC
            APPEND    SP1,TYPEDESC
            APPEND    WBIIEROR,TYPEDESC
            APPEND    SP20,TYPEDESC
            RESET     TYPEDESC
          ENDIF
.
          MOVE      SP70,DIM30
          PACK      KEY10,WBIIOPER,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      WBIIOPER,DIM30
          ELSE
            MATCH     WBIIOPER,WBSEUID
            IF        @EQUAL
              MOVE      WBSENAM,DIM30
            ELSE
              MOVE      WBIIOPER,DIM30
            ENDIF
          ENDIF
.
          CMATCH    NULL,WBIIEROT
          IF        @EQUAL
            PACK      WBIIEROT,SP70,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",DIM11 ,"</td>";
          WRITE     HTMLFILE;"<td>",WBIITIME,"</td>";
          WRITE     HTMLFILE;"<td>",STATDESC,"</td>":
                             "<td>",TYPEDESC,"</td>":
                             "<td>",WBIIBATN,"</td>":
                             "<td>",DIM30,"</td>":
                             "<td>",WBIIEROT,"</td>":
                             "</tr>";
.
EHIRW999  RETURN
+
.------------------------------------------------------------
. Table of WebServices IHCW Assessment Report
.------------------------------------------------------------
EHAR0000  CALL      EHARHD00      * Output Table Heading
.
          PACK      KEY65,WBICTRID,Z70
          CALL      RSWBIHD2
EHAR1000  CALL      RPWBIHD2
          BRANCH    OVRCD,EHAR9999
.
          MATCH     WBICTRID,WBIKFTID
          GOTO      EHAR9999 IF NOT EQUAL
.
          CALL      EHARRW00
.
          GOTO      EHAR1000
.
EHAR9999  RETURN
+
.------------------------------------------------------------
. IHCW Assessment Report (TABLE HEADING)
.------------------------------------------------------------
EHARHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=25%>":
                             "Status</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Reference Id</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Charge Amt</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Benefit Amount</td>":
                             "<td class=HeadingCell width=10%>":
                             "Excess Amt</td>":
                             "<td class=HeadingCell width=10%>":
                             "CoPayment Amt</td>":
                             "<td class=HeadingCell width=5%>":
                             "Claim Assessment Details</td>":
                             "<td class=HeadingCell width=5%>":
                             "Service Assessment Details</td>":
                             "<td class=HeadingCell width=5%>":
                             "Report Details</td>":
                             "</tr>"
.
EHARHD99  RETURN
+ 
.------------------------------------------------------------
. IHCW Assessment Report (Detail Row)
.------------------------------------------------------------
.
EHARRW00  MOVE      ZERO,FORM1
          MOVE      "Unknown",ASESDESC
          MOVE      WBIKCFAC,ANS
          REP       "A1R2W3C4I5",ANS
          MOVE      ANS,FORM1
          LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4,ASESDES5
.
          WRITE     HTMLFILE;"<tr><td>",WBIKFSCD," ",WBIKFSTX,"</td>";
          WRITE     HTMLFILE;"<td>",ASESDESC,"</td>";
          WRITE     HTMLFILE;"<td>",WBIKFRID,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIKTCAM
          UNPACK    WBIKTCAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIKTBAM
          UNPACK    WBIKTBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIKEXAM
          UNPACK    WBIKEXAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIKCPAM
          UNPACK    WBIKCPAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          WRITE     HTMLFILE;"<td><img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=5":
                             "&template=004":
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&ecclfbid=",WBIKFBID:
                             "&ecclarid=",WBIKARID:
                             "&ecclfrid=",WBIKFRID:
                             "&ecclrptc=",WBIKRPTC,"#";'>":
                             "</td>";
.
          WRITE     HTMLFILE;"<td><img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=5":
                             "&template=005":
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&ecclfbid=",WBIKFBID:
                             "&ecclarid=",WBIKARID:
                             "&ecclfrid=",WBIKFRID:
                             "&ecclrptc=",WBIKRPTC,"#";'>":
                             "</td>";
.
          MOVE      ZERO,FORM3
          PACK      KEY51,WBIKFTID,ONE,SP1,THREE,SP70
          CALL      RSWBETR4
EHARRW80  CALL      RKWBETR4
          BRANCH    OVRCD,EHARRW90
.
          MATCH     WBIKFTID,WBETTRID
          GOTO      EHARRW90 IF NOT EQUAL
.
          MATCH     "1",WBETSTAT
          GOTO      EHARRW90 IF NOT EQUAL
.
          MATCH     " 3",WBETTYPE
          GOTO      EHARRW90 IF NOT EQUAL
.
          ADD       ONE,FORM3
          MOVE      FORM3,DIM3
          MATCH     DIM3,WBIKRPTC
          GOTO      EHARRW80 IF NOT EQUAL
.
          MATCH     SP70,WBETSTRD
          GOTO      EHARRW90 IF EQUAL
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='displayJSON(#"../cgi-bin/eclweb73.pbl":
                             "?reportno=05":
                             "&template=008":
                             "&urnumber=",URNUMBER:
                             "&admissno=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
.                            "&prhre001=",PRHRE001:
.                            "&prhre002=",PRHRE002:
.                            "&prhre003=",PRHRE003:
                             "&ecclfbid=",WBIKFBID:
                             "&ecclarid=",WBIKARID:
                             "&ecclfrid=",WBIKFRID:
                             "&ecclstrd=",WBETSTRD:
                             "&ecclrptc=",WBIKRPTC,"#");'>":
                             "</td>":
                             "</tr>";
.
          GOTO      EHARRW99
.
EHARRW90  MOVE      ZERO,FORM3
          PACK      KEY51,WBIKFTID,ONE,TEN6,SP70
          CALL      RSWBETR4
EHARRW92  CALL      RKWBETR4
          BRANCH    OVRCD,EHARRW95
.
          MATCH     WBIKFTID,WBETTRID
          GOTO      EHARRW95 IF NOT EQUAL
.
          MATCH     "1",WBETSTAT
          GOTO      EHARRW95 IF NOT EQUAL
.
          MATCH     "16",WBETTYPE
          GOTO      EHARRW95 IF NOT EQUAL
.
          ADD       ONE,FORM3
          MOVE      FORM3,DIM3
          MATCH     DIM3,WBIKRPTC
          GOTO      EHARRW92 IF NOT EQUAL
.
          MATCH     SP70,WBETSTRD
          GOTO      EHARRW95 IF EQUAL
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='displayJSON(#"../cgi-bin/eclweb73.pbl":
                             "?reportno=05":
                             "&template=008":
                             "&urnumber=",URNUMBER:
                             "&admissno=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
.                            "&prhre001=",PRHRE001:
.                            "&prhre002=",PRHRE002:
.                            "&prhre003=",PRHRE003:
                             "&ecclfbid=",WBIKFBID:
                             "&ecclarid=",WBIKARID:
                             "&ecclfrid=",WBIKFRID:
                             "&ecclstrd=",WBETSTRD:
                             "&ecclrptc=",WBIKRPTC,"#");'>":
                             "</td>":
                             "</tr>";
.
          GOTO      EHARRW99
.
EHARRW95  WRITE     HTMLFILE;"<td valign=top>&nbsp;</td></tr>";
.
EHARRW99  RETURN
+
.------------------------------------------------------------
. Table of IHCW Claim Assessment Details
.------------------------------------------------------------
EHCD0000  CALL      EHCDHD00      * Output Table Heading
.
          PACK      KEY43,ECCLFBID,ECCLARID,ECCLFRID,ECCLRPTC,SP70
          CALL      RSWBIHE1                     * position in file
EHCD1000  CALL      RKWBIHE1                     * read next record
          BRANCH    OVRCD,EHCD9999               * end of file
.
          MATCH     ECCLFBID,WBILFBID            * same fund brand id ?
          GOTO      EHCD9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,WBILARID            * same account ref. id ?
          GOTO      EHCD9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBILFRID,WBILFRID,SP70
.
          MATCH     ECCLFRID,WBILFRID            * same fund ref. id ?
          GOTO      EHCD9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBILRPTC,WBILRPTC,SP70
.
          MATCH     ECCLRPTC,WBILRPTC            * same report counter ?
          GOTO      EHCD9999 IF NOT EQUAL        * no - finished listing
.
          CALL      EHCDRW00
.
          GOTO      EHCD1000
.
EHCD9999  RETURN
+
.------------------------------------------------------------
. IHCW Claim Assessment Details (TABLE HEADING)
.------------------------------------------------------------
EHCDHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Element Name</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Message Part ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Explanation</td>":
                             "</tr>"
.
EHCDHD99  RETURN
+
.------------------------------------------------------------
. IHCW Claim Assessment Details (Detail Row)
.------------------------------------------------------------
EHCDRW00  WRITE     HTMLFILE;"<tr><td>",WBILELNM,"</td>";
          WRITE     HTMLFILE;"<td>",WBILMPID,"</td>";
.
          WRITE     HTMLFILE;"<td><img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=5":
                             "&template=006":
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&ecclfbid=",WBILFBID:
                             "&ecclarid=",WBILARID:
                             "&ecclfrid=",WBILFRID:
                             "&ecclrptc=",WBILRPTC:
                             "&ecclcacn=",WBILCACN,"#";'>":
                             "</td>":
                             "</tr>";
.
EHCDRW99  RETURN
+
.------------------------------------------------------------
. Table of IHCW Claim Details Explanations
.------------------------------------------------------------
EHCE0000  CALL      EHCEHD00      * Output Table Heading
.
          PACK      KEY45,ECCLFBID,ECCLARID,ECCLFRID,ECCLRPTC,ECCLCACN:
                          SP70
          CALL      RSWBIHF1                     * position in file
EHCE1000  CALL      RKWBIHF1                     * read next record
          BRANCH    OVRCD,EHCE9999               * end of file
.
          MATCH     ECCLFBID,WBINFBID            * same fund brand id ?
          GOTO      EHCE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,WBINARID            * same account ref. id ?
          GOTO      EHCE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLFRID,WBINFRID            * same fund ref. id ?
          GOTO      EHCE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLRPTC,WBINRPTC            * same report counter ?
          GOTO      EHCE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLCACN,WBINCACN            * same service code ?
          GOTO      EHCE9999 IF NOT EQUAL        * no - finished listing
.
          CALL      EHCERW00
.
          GOTO      EHCE1000
.
EHCE9999  RETURN
+
.------------------------------------------------------------
. IHCW Claim Assessment Explanation Details (TABLE HEADING)
.------------------------------------------------------------
EHCEHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Explanation Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Explanation Text</td>":
                             "</tr>"
.
EHCEHD99  RETURN
+
.------------------------------------------------------------
. IHCW Claim Assessment Explanation Details (Detail Row)
.------------------------------------------------------------
EHCERW00  WRITE     HTMLFILE;"<tr><td>",WBINEXCD,"</td>";
          WRITE     HTMLFILE;"<td>",WBINEXTX,"</td>":
                             "</tr>";
.
EHCERW99  RETURN
+
.------------------------------------------------------------
. Table of IHCW Service Assessment Details
.------------------------------------------------------------
EHSD0000  CALL      EHSDHD00      * Output Table Heading
.
          PACK      KEY43,ECCLFBID,ECCLARID,ECCLFRID,ECCLRPTC,SP70
          CALL      RSWBIHG1                     * position in file
EHSD1000  CALL      RKWBIHG1                     * read next record
          BRANCH    OVRCD,EHSD9999               * end of file
.
          MATCH     ECCLFBID,WBIOFBID            * same fund brand id ?
          GOTO      EHSD9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,WBIOARID            * same account ref. id ?
          GOTO      EHSD9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBIOFRID,WBIOFRID,SP70
.
          MATCH     ECCLFRID,WBIOFRID            * same fund ref. id ?
          GOTO      EHSD9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBIORPTC,WBIORPTC,SP70
.
          MATCH     ECCLRPTC,WBIORPTC            * same report counter ?
          GOTO      EHSD9999 IF NOT EQUAL        * no - finished listing
.
          CALL      EHSDRW00
.
          GOTO      EHSD1000
.
EHSD9999  RETURN
+
.------------------------------------------------------------
. IHCW Service Assessment Details (TABLE HEADING)
.------------------------------------------------------------
EHSDHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>":
                             "Service Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Charge Amount</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Number of Services</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Fund Benefit Amount</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Service Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "From Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "To Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Explanation</td>":
                             "</tr>"
.
EHSDHD99  RETURN
+
.------------------------------------------------------------
. IHCW Service Assessment Explanation Details (Detail Row)
.------------------------------------------------------------
EHSDRW00  WRITE     HTMLFILE;"<tr><td>",WBIOSCOD," - ",WBIOSDSC,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIOCAMT
          UNPACK    WBIOCAMT,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIONOSV,"</td>";
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIOFBAM
          UNPACK    WBIOFBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;"<td>",FORM7P2C,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIOSDTE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIOSDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIOFDTE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIOFDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIOTDTE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIOTDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          WRITE     HTMLFILE;"<td><img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=5":
                             "&template=007":
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&ecclfbid=",WBIOFBID:
                             "&ecclarid=",WBIOARID:
                             "&ecclfrid=",WBIOFRID:
                             "&ecclrptc=",WBIORPTC:
                             "&ecclsecn=",WBIOSECN,"#";'>":
                             "</td>":
                             "</tr>";
.
EHSDRW99  RETURN
+
.------------------------------------------------------------
. Table of IHCW Service Details Explanations
.------------------------------------------------------------
EHSE0000  CALL      EHSEHD00      * Output Table Heading
.
          PACK      KEY45,ECCLFBID,ECCLARID,ECCLFRID,ECCLRPTC,ECCLSECN:
                          SP70
          CALL      RSWBIHH1                     * position in file
EHSE1000  CALL      RKWBIHH1                     * read next record
          BRANCH    OVRCD,EHSE9999               * end of file
.
          MATCH     ECCLFBID,WBIPFBID            * same fund brand id ?
          GOTO      EHSE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLARID,WBIPARID            * same account ref. id ?
          GOTO      EHSE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLFRID,WBIPFRID            * same fund ref. id ?
          GOTO      EHSE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLRPTC,WBIPRPTC            * same report counter ?
          GOTO      EHSE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLSECN,WBIPSECN            * same service code ?
          GOTO      EHSE9999 IF NOT EQUAL        * no - finished listing
.
          CALL      EHSERW00
.
          GOTO      EHSE1000
.
EHSE9999  RETURN
+
.------------------------------------------------------------
. IHCW  Service Assessment Explanation Details (TABLE HEADING)
.------------------------------------------------------------
EHSEHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Explanation Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Explanation Text</td>":
                             "</tr>"
.
EHSEHD99  RETURN
+
.------------------------------------------------------------
. IHCW Service Assessment Explanation Details (Detail Row)
.------------------------------------------------------------
EHSERW00  WRITE     HTMLFILE;"<tr><td>",WBIPEXCD,"</td>";
          WRITE     HTMLFILE;"<td>",WBIPEXTX,"</td>":
                             "</tr>";
.
EHSERW99  RETURN
+
.------------------------------------------------------------
. WebServices IHCW Enquiries
.------------------------------------------------------------
.
ECCE0000  RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      ECCE6000 IF EQUAL

          MATCH     "V",UPDATTYP
          GOTO      ECCE1000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      ECCE2000 IF EQUAL
.
          MATCH     "D",UPDATTYP
          GOTO      ECCE3000 IF EQUAL
.
          MATCH     "P",UPDATTYP
          GOTO      ECCE4000 IF EQUAL
.
          MATCH     "S",UPDATTYP
          GOTO      ECCE5000 IF EQUAL
.
          GOTO      ECCE9000
.
ECCE1000  CALL      MINH0000
          GOTO      ECCE9999
.
ECCE2000  CALL      RSUH0000
          GOTO      ECCE9999
.
ECCE3000  CALL      WDEH0000
          GOTO      ECCE9999
.
ECCE4000  CALL      OTPH0000
          GOTO      ECCE9999
.
ECCE5000  CALL      RSEH0000
          GOTO      ECCE9999
.
ECCE6000  MOVE      TEMPLATE,FORM3
          IF        FOUR=FORM3
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,ECFD9100
.
            CALL      GETPA200
            CALL      PATLN000
            CALL      PATFLD00                * Use standard Patient Folder sub
.
            MOVE      URNUMBER,FILTURNO
.           MOVE      ADMISSNO,FILTADMN
.
            IF        ALLHFLAG=0
              COMPARE   ONE,IBCNMHOS
              IF        @EQUAL
                MOVE      TWO,VIEWTYPE
                MOVE      ZERO,EXDTBLNK
              ELSE
                MOVE      ZERO,VIEWTYPE
                MOVE      ONE,EXDTBLNK
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
.
          MOVE      TEMPLATE,FORM3
          IF        THREE=FORM3
            MOVE      "WebServices IHCW Outstanding Ass Reports Enquiry",WEBTITLE
          ELSE
            MOVE      "WebServices IHCW Claim Enquiry",WEBTITLE
          ENDIF
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,ECCE9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      ECCE9999
.
ECCE9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECCE9999
.
ECCE9999  RETURN
+
.---------------------------------------------------------------------------
. Patient Details from master file to display in table c
.   Requires ADMISSNO & URNUMBER to be set.
.   URNUMBER can be blank if a Valid Admission Record is Expected.
.---------------------------------------------------------------------------
GETPA200  MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          IF        OVRCD=0
            MOVE      AURNO,URNUMBER
          ENDIF
          MOVE      OVRCD,MISSFLAG
.
          MATCH     "       0",URNUMBER
          IF        @EQUAL
            MOVE      ADMISSNO,KEY8
            CALL      RDPRAM1
            BRANCH    OVRCD,GETPA295
          ELSE
            PACK      KEY8,URNUMBER
            CALL      RDMAST1
            BRANCH    OVRCD,GETPA295
            PACK      KEY8,URNUMBER
            CALL      RDPMPX21
            BRANCH    OVRCD,GETPA295
          ENDIF
.
          CALL      PATINT00                * Format Patient Name with Initial
.
          IF        PCEASE=1
            MOVE      PDECDTE,AGEDATE            * Date of Death
          ELSE
            PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
          ENDIF
          REP       " 0",AGEDATE
          CALL      CALCAGE
.
          MOVE      SP70,DOCFNAME
          PACK      KEY6,ADOCTA
          CALL      RDDOCT1
          IF        OVRCD=0
            MOVE      DTITL,FMTTITLE            * I CAR 13038
            MOVE      DGNAME,FMTGNAME
            MOVE      DSNAME,FMTSNAME
            CALL      DOCNM000                  * end I CAR 13038
            PACK      SDOCFNAM,DOCFNAME
...         CALL      SDOCNM00
          ENDIF
.
GETPA210  MOVE      SP70,DESCDPST
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMWOR1
          IF        OVRCD=1
            CALL      CLPMWO00
          ENDIF
.
          MATCH     SP70,PMWODPST
          IF        !@EQUAL
            PACK      KEY5,CATLVI,PMWODPST,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      PMWODPST,TDESC
            ENDIF
            MOVE     TDESC,DESCDPST
          ENDIF
.
          COMPARE   "999",ASTAY
          IF        @EQUAL
            PACK      EXPCTDSC,HYPHEN,SP70
            GOTO      GETPA220
          ENDIF
.
          MATCH     SP70,PMWOEDAT
          IF        !@EQUAL
            UNPACK    PMWOEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      EXPCTDSC,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,PMWOEDTM
            MATCH     SP70,PMWOEDTM
            IF        @EQUAL
              PACK      FHRENDDT,CCENT,CYEAR,FHRDASH,CMON,FHRDASH,CDAY
            ELSE
              PACK      FHRENDDT,CCENT,CYEAR,FHRDASH,CMON,FHRDASH,CDAY,ANST,PMWOEDTM,TIMEZONE,SP70
            ENDIF
            GOTO      GETPA220
          ENDIF
.
          MOVE      CCC,CCENT
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      ASTAY,ADJDAYS
          CALL      ADJDAT00
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      EXPCTDSC,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          PACK      FHRENDDT,CCENT,CYEAR,FHRDASH,CMON,FHRDASH,CDAY
.
. Find if expected disch date is =,<, or > current date and set bgcolor flag
.
GETPA220  MOVE      SP70,COLRFLAG
          PACK      EXPCDATE,CCENT,CYEAR,CMON,CDAY
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MATCH     CURRDATE,EXPCDATE
          IF        @EQUAL
            MOVE      "CurrDischDate",COLRFLAG        * Set bgcolor to Current
          ENDIF
          IF        @LESS
            MOVE      "PastDischDate",COLRFLAG          * set bgcolor to past
          ENDIF
.
          PACK      KEY3,SP70
          PACK      KEY8,URNUMBER
          CALL      RDPMPX21
          BRANCH    OVRCD,GETPA295

          MOVE      AADMNO,PMVXVISN            * Find Visit extension record
          PACK      KEY8,PMVXVISN,SP70
          CALL      RDPMVX11
          IF        OVRCD=1
            MOVE      SP70,PMVXVALW
            MOVE      SP70,PMVXPALW
            MOVE      SP70,PMVXUDF2
            MOVE      SP70,PMVXPOWD
            MOVE      SP70,PMVXPOBD
          ENDIF
.
          GOTO      GETPA299
.
GETPA295  MOVE      "Invalid Record",PSNAME
          MOVE      SP70,PGNAME
          MOVE      SP70,PTITL
          CALL      PATNAM00
.
GETPA299  RETURN
+
FHRCON00
FHRCON99  RETURN
+
.*****************************************************************************
.*                          MINH0000                                         *
.*****************************************************************************
.
.         First, get the last IHCW History record for this invoice
.
MINH0000  PACK      KEY26,MAVINVCE,Z70
          CALL      RSWBIHA1                     * position on last history rec
          CALL      RPWBIHA1                     * read previous record
          BRANCH    OVRCD,MINH3000               * eof - finished
.
          MATCH     MAVINVCE,WBIIINVN            * same invoice still ?
          GOTO      MINH3000 IF NOT EQUAL        * no - finished
.
.         Read webihcaf
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIHC2
          BRANCH    OVRCD,MINH3000
.
.         The last IHCW history record has been found for the invoice, so
.         write a new record, defaulting some of the values from the read
.         record.
.
          MOVE      MAVBATCH,WBIIBATN
          MOVE      MAVINVCE,WBIIINVN
.
MINH1000  CALL      IBACLOCK                     * get current date/time
          PACK      WBIIDATE,CCC,CYY,CMM,CDD
          REP       " 0",WBIIDATE
          MOVE      CTIMEIS,WBIITIME
          REP       " 0",WBIITIME
.
          MOVE      " 5",WBIITYPE
          MOVE      WBSEUID,WBIIOPER
          MOVE      SP70,WBIISPAR
.
          PACK      KEY26,WBIIINVN,WBIIDATE,WBIITIME,WBIITYPE,SP70
          CALL      RAWBIHA1
          IF        OVRCD = 0
            GOTO      MINH1000
          ENDIF
.
          CALL      WRWBIHA1                     * write EDI History record
.
.         If the record has a status of "Health Fund Unverified",
.         "Error (SA validation)" or "Health Fund Rejected - Reported"
.         then update the status to "Closed", as the claim cannot go any
.         further (unless resubmitted after closing).
.
          IF        WBICFLAG = 3 | WBICFLAG = 6 | WBICFLAG = 13
            PACK      KEY35,WBICHOSP,WBICFLAG,WBICHFND,WBICADMN,WBICINVN:
                            WBICBATN,SP70
            CALL      RDWBIHC1                   * read selected record
            BRANCH    OVRCD,MINH3000             * shouldn't happen
.
            MOVE      TEN6,WBICFLAG              * update to "closed"

            CALL      IBACLOCK
            PACK      WBICUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBICUDAT
            MOVE      CTIMEIS,WBICUTIM
            MOVE      USERID,WBICUUID

            CALL      UPWBIHC1
.
.           Also write an IHCW History record (webihaaf) for the close
.
            MOVE      WBICINVN,WBIIINVN
            MOVE      WBICBATN,WBIIBATN
            MOVE      TEN6,WBIISTAT
            MOVE      " 5",WBIITYPE
            MOVE      WBSEUID,WBIIOPER
            MOVE      WBICTRID,WBIITRID
            MOVE      SP30,WBIISPAR
.
MINH2000    CALL      IBACLOCK                   * get current time
            PACK      WBIIDATE,CCC,CYY,CMM,CDD
            REP       " 0",WBIIDATE
            MOVE      CTIMEIS,WBIITIME
            REP       " 0",WBIITIME
.
            PACK      KEY26,WBIIINVN,WBIIDATE,WBIITIME,WBIITYPE,SP70
            CALL      RAWBIHA1
            IF        OVRCD = 1
              CALL      WRWBIHA1
            ELSE
              GOTO      MINH2000
            ENDIF
.
            GOTO      MINH9000
          ELSE
            GOTO      MINH9000
          ENDIF
.
MINH3000  MOVE      "IHCW Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      MINH9100
.
MINH9000  MOVE      ZERO,EXIT
          GOTO      MINH9999
.
MINH9100  MOVE      ONE,EXIT
.
MINH9999  RETURN
+
.*****************************************************************************
.*                               RSUH0000                                    *
.*                  Process resubmission selection                           *
.*****************************************************************************
RSUH0000  MOVE      ZERO,EXIT
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIHC2
          BRANCH    OVRCD,RSUH7000
.
.         Check if the record has already been resubmitted
.
          MATCH     SP8,WBICNBAT                 * next batch blank ?
          IF        !@EQUAL
            GOTO      RSUH8000
          ENDIF
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
.         IF        WBICFLAG <> 16 & WBICFLAG <> 3
.           GOTO      RSUH7000
.         ENDIF
.
          IF        WBICFLAG = 16 | WBICFLAG = 3
.
            PACK      KEY26,WBICINVN,Z70
            CALL      RSWBIHA1
RSUH2100    CALL      RPWBIHA1
            BRANCH    OVRCD,RSUH2500
.
            MATCH     WBICINVN,WBIIINVN
            GOTO      RSUH2500 IF NOT EQUAL
.
            MATCH     WBICTRID,WBIITRID
            GOTO      RSUH2100 IF NOT EQUAL
.
            COMPARE   THREE,WBIISTAT
            GOTO      RSUH2100 IF NOT EQUAL
.
            MATCH     " 6",WBIITYPE
            GOTO      RSUH2100 IF NOT EQUAL
.
            MATCH     "3002",WBIIEROR
            GOTO      RSUH2100 IF NOT EQUAL
.
            MOVE      ZERO,FORM8A
.
            CALL      IBACLOCK
.
            PACK      CURRDATE,CCC,CYY,CMM,CDD
            REP       " 0",CURRDATE
.
            DAYSEP    WBIIDATE,CURRDATE,FORM8A
.
            COMPARE   FORM8A,ONE
            GOTO      RSUH2500 IF EQUAL
            GOTO      RSUH2500 IF LESS
.
            GOTO      RSUH7500
.
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RSUH2500  PACK      KEY8,WBICINVN,SP70
          CALL      RDINV1
          IF        OVRCD = 1
            GOTO      RSUH6000
          ENDIF
.
          CALL      GBAH0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission (CAR 181439)
.
.         IF        (FORM7P2O <= 0) & (PINVAMT > 0)
.           GOTO      RSUH5000
.         ENDIF
.
          PACK      KEY16,WBICINVN,SP8
          CALL      RAWBIHC2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSUH4000
          ENDIF
.
          MOVE      ZERO,WBICFLAG
          MOVE      SP8,WBICBATN
          MOVE      MAVBATCH,WBICPBAT
          MOVE      SP8,WBICNBAT
          MOVE      SP1,WBICCCFL
          MOVE      SP30,WBICTRID
          MOVE      ZERO,WBICAMTC
          MOVE      ZERO,WBICAMTP
          MOVE      SP8,WBICPDAT
          MOVE      SP2,WBICSTAT
          MOVE      SP30,WBICFTID
          MOVE      SP70,WBICMSID
          PACK      WBICSPAR,SP70,SP70
.
          PACK      KEY16,WBICINVN,WBICBATN,SP70
          CALL      RAWBIHC2

          IF        OVRCD = 1
            CALL      IBACLOCK
            PACK      WBICCDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBICCDAT
            MOVE      CTIMEIS,WBICCTIM
            MOVE      USERID,WBICCUID
            CALL      WRWBIHC1                   * write record
          ELSE
            GOTO      RSUH4000
          ENDIF
.
.         Update the selected record with the next batch no. of "00000000".
.         The record will either have a status of "closed" already, or
.         "SA Validation Error".  If it's the latter, then update the status to
.         "closed" as well"
.
.         PACK      KEY35,WBICHOSP,TEN6,WBICHFND,WBICADMN,WBICINVN,MAVBATCH,SP70
.         CALL      RDWBIHC1
.         IF        OVRCD = 1
.    PACK      KEY35,WBICHOSP,SP1,THREE,WBICHFND,WBICADMN,WBICINVN,MAVBATCH,SP70
.           CALL      RDWBIHC1
.           IF        OVRCD = 1
.             GOTO      RSUH3000
.           ELSE
.             MOVE      TEN6,WBICFLAG            * set status to closed
.           ENDIF
.         ENDIF
.
          PACK      KEY16,WBICINVN,MAVBATCH,SP70
          CALL      RDWBIHC2
          IF        OVRCD = 1
            CALL      RSUH3000                   * write record
          ELSE
            MOVE      TEN6,WBICFLAG            * set status to closed
          ENDIF
.
          MOVE      "00000000",WBICNBAT

          CALL      IBACLOCK
          PACK      WBICCDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBICCDAT
          MOVE      CTIMEIS,WBICCTIM
          MOVE      USERID,WBICCUID

          CALL      UPWBIHC2
.
          GOTO      RSUH9999
.
RSUH3000  CLEAR     WEBTITLE
          APPEND    "Error updating Invoice ",WEBTITLE
          APPEND    WBICINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    WBICBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUH9000
.
RSUH4000  MOVE      "Invoice already waiting for extraction.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUH9000
.
RSUH5000  MOVE      "Claim fully paid.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUH9000
.
RSUH6000  CLEAR     WEBTITLE
          APPEND    "Invoice ",WEBTITLE
          APPEND    WBICINVN,WEBTITLE
          APPEND    " not found.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUH9000
.
RSUH7000  MOVE      "Claim not not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUH9000
.
RSUH7500  MOVE      "Error 3002. Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUH9000
.
RSUH8000  MOVE      "Invoice already resubmitted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUH9000
.
RSUH9000  MOVE      ONE,EXIT
RSUH9999  RETURN
+
.------------------------------------------------------------------------
. Format Patient Name with Second Name Initial
.------------------------------------------------------------------------
PATINT00  CLEAR     DISPNAME
          MOVE      PSNAME,SAVPSNAM
.
..        REP       "' ",PSNAME
          REP       "#" ",PSNAME
..        REP       "' ",PGNAME
          REP       "#" ",PGNAME
          MOVE      SP70,PATFNAME
          REP       UPPLOW,PSNAME
          APPEND    "<b>",DISPNAME
          APPEND    PSNAME,DISPNAME
          APPEND    "</b>",DISPNAME
          PACK      NAME35,PTITL,SP70
          CALL      NAMSTR00
.
          MOVELPTR  PGNAME,LENPTR
          MOVE      ONE,COUNT
PATINT10  BUMP      PGNAME
          GOTO      PATINT80 IF EOS
          ADD       ONE,COUNT
          MATCH     SP1,PGNAME
          GOTO      PATINT10 IF NOT EQUAL
          BUMP      PGNAME
          ADD       ONE,COUNT
PATINT80  RESET     PGNAME
          SETLPTR   PGNAME,COUNT
          PACK      NAME35,PGNAME,SP70
          CALL      NAMSTR00
          RESET     PGNAME,LENPTR
.
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,PATFNAME
          STRIP     PATFNAME
.
          MOVE      SAVPSNAM,PSNAME         * Original value with quotes etc
.
PATINT90  RESET     PGNAME
.
PATINT99  RETURN
+
.*****************************************************************************
.*                               WDEH0000                                    *
.*                  Process delete records waiting                           *
.*****************************************************************************
WDEH0000  MOVE      ZERO,EXIT
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIHC2
          BRANCH    OVRCD,WDEH8000
.
          MOVE      WBICINVN,TEMPINVN
          MOVE      WBICBATN,TEMPBATN
          MOVE      WBICADMN,TEMPADMN
          MOVE      WBICURNO,TEMPURNO
          MOVE      WBICHFND,TEMPHFND
          MOVE      WBICPBAT,TEMPPBAT
          MOVE      WBICHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      WDEH1000 IF EQUAL
          GOTO      WDEH1000 IF EOS
.
          PACK      KEY35,TEMPHOSP,TEN6,TEMPHFND,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDWBIHC1
          IF        OVRCD = 1
            GOTO      WDEH7000
          ELSE
            MOVE      SP70,WBICNBAT

            CALL      IBACLOCK
            PACK      WBICUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBICUDAT
            MOVE      CTIMEIS,WBICUTIM
            MOVE      USERID,WBICUUID
            CALL      UPWBIHC1
          ENDIF
.
.         Delete the selected record
.
WDEH1000  PACK      KEY35,TEMPHOSP,SP1,ZERO,TEMPHFND,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEWBIHC1
.
          GOTO      WDEH9999
.
WDEH7000  CLEAR     WEBTITLE
          APPEND    "Error updating previous claim ",WEBTITLE
          APPEND    WBICINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    WBICBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      WDEH9000
.
WDEH8000  MOVE      "Record cannot be deleted.",WEBTITLE
          CALL      WEBERR00
          GOTO      WDEH9000
.
WDEH9000  MOVE      ONE,EXIT
WDEH9999  RETURN
+
.*****************************************************************************
.*                               OTPH0000                                    *
.*                  Process delete outstanding processing reports            *
.*****************************************************************************
OTPH0000  MOVE      ZERO,EXIT
.
          PACK      KEY31,ECOTFUND,ECOTTYPE,ECOTTRID,SP70
          CALL      RDWBECO1
          BRANCH    OVRCD,OTPH8000
.
          PACK      KEY16,WBEOINVN,WBEOBATN,SP70
          CALL      RDWBIHC2
          BRANCH    OVRCD,OTPH7000
.
.         MATCH     WBEOTRID,WBICTRID            * same transaction id still ?
.         GOTO      OTPH7000 IF NOT EQUAL        * no
.
          CALL      CLOH0000
.
          GOTO      OTPH9999
.
OTPH7000  MOVE      "Unable to locate IHCW claim record.  ",WEBTITLE
          CALL      WEBERR00
          GOTO      OTPH9000
.
OTPH8000  MOVE      "Unable to locate webecoaf record to close.  ",WEBTITLE
          CALL      WEBERR00
          GOTO      OTPH9000
.
OTPH9000  MOVE      ONE,EXIT
OTPH9999  RETURN
+
.*****************************************************************************
.*                              CLOH0000           Called by: DOUT0000       *
.*             Close a claim that is still waiting for an outstanding        *
.*             report and for which a remittance report has been received.   *
.*****************************************************************************
.
.         Update the outstanding processing report (webecoaf) record
.
CLOH0000  PACK      SKEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
.
.         We should only have one record with flag of Open or Closed
.
          MOVE      "1",WBEODFLG                 * set status to "Closed"
          PACK      KEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
          CALL      RAWBECO1
          IF        OVRCD=1
            MOVE      SKEY31,KEY31
            CALL      RDWBECO1                    * reposition
            IF        OVRCD=0
              MOVE      "1",WBEODFLG              * set status to "Closed"
              CALL      UPWBECO1                  * update record
            ENDIF
          ELSE
            MOVE      "0",WBEODFLG                * set status to "Open"
            PACK      KEY31,WBEOHFND,WBEODFLG,WBEOTRID,SP70
            CALL      DEWBECO1
          ENDIF
.
.         Update the webihcaf record
.
          MOVE      TEN6,WBICFLAG                * set status to closed
          PACK      WBICSTAT,SP1,TWO             * set closed with payment

          CALL      IBACLOCK
          PACK      WBICCDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBICCDAT
          MOVE      CTIMEIS,WBICCTIM
          MOVE      USERID,WBICCUID
          CALL      UPWBIHC2                     * update claim
.
.         Write a new history (webihaaf) record
.
          MOVE      WBICINVN,WBIIINVN
          MOVE      WBICBATN,WBIIBATN
          MOVE      TEN6,WBIISTAT
          MOVE      " 5",WBIITYPE
          MOVE      WBSEUID,WBIIOPER
          MOVE      WBICTRID,WBIITRID
          MOVE      WBICMSID,WBIIMSID
          MOVE      SP70,WBIIEROR
          MOVE      SP70,WBIIEROT
          MOVE      SP70,WBIISPAR
.
CLOH5000  CALL      IBACLOCK                     * get current date/time
          PACK      WBIIDATE,CCC,CYY,CMM,CDD
          REP       " 0",WBIIDATE
          MOVE      CTIMEIS,WBIITIME
          REP       " 0",WBIITIME
.
          PACK      KEY26,WBIIINVN,WBIIDATE,WBIITIME,WBIITYPE,SP70
          CALL      RAWBIHA1
          IF        OVRCD = 1
            CALL      WRWBIHA1
          ELSE
            GOTO      CLOH5000
          ENDIF
.
CLOH9999 RETURN
+
.*****************************************************************************
.*                          RSEH0000                                         *
.*****************************************************************************
.
.         First, get the last IHCW History record for this invoice
.
RSEH0000  PACK      KEY26,MAVINVCE,Z70
          CALL      RSWBIHA1                     * position on last history rec
          CALL      RPWBIHA1                     * read previous record
          BRANCH    OVRCD,RSEH3000               * eof - finished
.
          MATCH     MAVINVCE,WBIIINVN            * same invoice still ?
          GOTO      RSEH3000 IF NOT EQUAL        * no - finished
.
.         Read webihcaf
.
          PACK      KEY16,MAVINVCE,MAVBATCH,SP70
          CALL      RDWBIHC2
          BRANCH    OVRCD,RSEH3000
.
.         If the record has a status of "Health Fund Unverified", then allow
.         the status to be set to "Verified" so it can be processed.
.         If the record has a status of "Assessing" or "Int. Ready", then allow
.         the status to be set to "Closed".
.
          IF        WBICFLAG = 6 | WBICFLAG = 8 | WBICFLAG = 9
      PACK      KEY35,WBICHOSP,WBICFLAG,WBICHFND,WBICADMN,WBICINVN,WBICBATN,SP70
            CALL      RDWBIHC1                   * read selected record
            BRANCH    OVRCD,RSEH3000             * shouldn't happen
.
            IF        WBICFLAG = 6
              MOVE      SEVEN,WBICFLAG             * reset to "verified"
            ELSE
              MOVE      TEN6,WBICFLAG            * reset to "closed"
            ENDIF

            CALL      IBACLOCK
            PACK      WBICUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBICUDAT
            MOVE      CTIMEIS,WBICUTIM
            MOVE      USERID,WBICUUID
            CALL      UPWBIHC1
.
.           Also write an IHCW History record (webihaaf) for the reset
.
            MOVE      WBICINVN,WBIIINVN
            MOVE      WBICBATN,WBIIBATN
            IF        WBICFLAG = 7
              MOVE      SEVEN,WBIISTAT
            ELSE
              MOVE      TEN6,WBIISTAT
            ENDIF
            MOVE      " 0",WBIITYPE
            MOVE      WBSEUID,WBIIOPER
            MOVE      WBICTRID,WBIITRID
            MOVE      SP30,WBIIEROR
            IF        WBICFLAG = 7
              MOVE      "Claim reset manually",WBIIEROT
            ELSE
              MOVE      "Claim closed manually",WBIIEROT
            ENDIF
            MOVE      SP30,WBIISPAR
.
RSEH2000    CALL      IBACLOCK                   * get current time
            PACK      WBIIDATE,CCC,CYY,CMM,CDD
            REP       " 0",WBIIDATE
            MOVE      CTIMEIS,WBIITIME
            REP       " 0",WBIITIME
.
            PACK      KEY26,WBIIINVN,WBIIDATE,WBIITIME,WBIITYPE,SP70
            CALL      RAWBIHA1
            IF        OVRCD = 1
              CALL      WRWBIHA1
            ELSE
              GOTO      RSEH2000
            ENDIF
.
            GOTO      RSEH9000
          ELSE
            GOTO      RSEH9000
          ENDIF
.
RSEH3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSEH9100
.
RSEH9000  MOVE      ZERO,EXIT
          GOTO      RSEH9999
.
RSEH9100  MOVE      ONE,EXIT
.
RSEH9999  RETURN
+
.------------------------------------------------------------
. IHCW Claim Enquiries tags
.------------------------------------------------------------
EHCL0000  BRANCH    FLDITMNO,EHCL0100,EHCL0200,EHCL0300,EHCL0400,EHCL0500:
                             EHCL0600,EHCL0700,EHCL0800,EHCL0900,EHCL1000:
                             EHCL1100,EHCL1200,EHCL1300,EHCL1400,EHCL1500:
                             EHCL1600,EHCL1700,EHCL1800,EHCL1900,EHCL2000:
                             EHCL2100,EHCL2200,EHCL2300,EHCL2400,EHCL2500
.
          GOTO      EHCL9999
.
EHCL0100  CALL      EHCT0000
          GOTO      EHCL9999
.
EHCL0200  WRITE     HTMLFILE;IBCNMHOS;    * Multihospital Indicator
          GOTO      EHCL9999
.
EHCL0300  CALL      HOSPID00              * Hospital ID option field
          GOTO      EHCL9999
.
EHCL0400  CALL      SELHFN00              * Health Fund option field
          GOTO      EHCL9999
.
EHCL0500  WRITE     HTMLFILE;HLFDCLTY;
          GOTO      EHCL9999
.
EHCL0600  MOVE      CATCL,CATEGORY
          MOVE      HLTHFUND,CODE
          CALL      CODITM00
          GOTO      EHCL9999
.
EHCL0700  WRITE     HTMLFILE;EXCLWAIT;
          GOTO      EHCL9999
.
EHCL0800  WRITE     HTMLFILE;FILTURNO;
          GOTO      EHCL9999
.
EHCL0900  WRITE     HTMLFILE;FILTADMN;
          GOTO      EHCL9999
.
EHCL1000  WRITE     HTMLFILE;BATCHNUM;
          GOTO      EHCL9999
.
EHCL1100  WRITE     HTMLFILE;CLAIMSTA;
          GOTO      EHCL9999
.
EHCL1200  WRITE     HTMLFILE;INVNUMBR;
          GOTO      EHCL9999
.
EHCL1300  CALL      SELP0000
          GOTO      EHCL9999
.
EHCL1400  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      EHCL9999
.
EHCL1500  WRITE     HTMLFILE;EXDTBLNK;
          GOTO      EHCL9999
.
EHCL1600  WRITE     HTMLFILE;HLTHFUND;
          GOTO      EHCL9999
.
EHCL1700  CALL      PRVH0000
          GOTO      EHCL9999
.
EHCL1800  CALL      NXTH0000
          GOTO      EHCL9999
.
EHCL1900  CALL      BATTH000
          GOTO      EHCL9999
.
EHCL2000  CALL      PREVBT00
          GOTO      EHCL9999
.
EHCL2100  CALL      NEXTBT00
          GOTO      EHCL9999
.
EHCL2200  CALL      ECOH0000
          GOTO      EHCL9999
.
EHCL2300  WRITE     HTMLFILE;PROCSTAT;
          GOTO      EHCL9999
.
EHCL2400  CALL      EHCP0000
          GOTO      EHCL9999
.
EHCL2500  WRITE     HTMLFILE;EXCLCLOS;
          GOTO      EHCL9999
.
EHCL9999  RETURN
+
.------------------------------------------------------------
. Table of IHCW Claim Enquiries
.------------------------------------------------------------
.
EHCT0000  MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      EHCT9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      EHCT9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBIHB2
EHCT0500  CALL      RKWBIHB2
          BRANCH    OVRCD,EHCT2000
          MATCH     WBIJDTBC,LASTDATE
          GOTO      EHCT2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,WBIJBTHN,SP70
          CALL      RSWBIHC3
EHCT1000  CALL      RKWBIHC3
          BRANCH    OVRCD,EHCT0500
          MATCH     WBIJBTHN,WBICBATN
          GOTO      EHCT0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBICHOSP
              GOTO      EHCT1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBICHOSP
                GOTO      EHCT1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     HLFDCLTY,DWBICEET
            GOTO      EHCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,WBICHFND
            GOTO      EHCT1000 IF NOT EQUAL
          ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   TEN6,WBICFLAG
            GOTO      EHCT1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        WBICFLAG=ZERO
.             GOTO      EHCT1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBICURNO
            GOTO      EHCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBICADMN
            GOTO      EHCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBICBATN
            GOTO      EHCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBICFLG
            GOTO      EHCT1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBICINVN
            GOTO      EHCT1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBICBATN,SP70
.           CALL      RDWBIHB1
.           BRANCH    OVRCD,EHCT1000
.
.           MATCH     FRSTDATE,WBIJDTBC
.           GOTO      EHCT1000 IF LESS
.
.           MATCH     WBIJDTBC,LASTDATE
.           GOTO      EHCT1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY34,WBICINVN,Z70
          CALL      RSWBIHA3
          CALL      RPWBIHA3
          IF        OVRCD=0
            MATCH     WBICINVN,WBIIINVN
            IF        @EQUAL
              MATCH     " 5",WBIITYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBICFLAG,STATUH01,STATUH02,STATUH03,STATUH04:
                                      STATUH05,STATUH06,STATUH07,STATUH08:
                                      STATUH09,STATUH10,STATUH11,STATUH12:
                                      STATUH13,STATUH14,STATUH15,STATUH16
.
          CALL      RSBH0000
.
          CALL      GBAH0000
.
          MOVE      WBICURNO,URNUMBER
          MOVE      WBICADMN,ADMISSNO
          CALL      GETPA200
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          REP       " +",WBICURNO
          REP       " +",WBICADMN
          REP       " +",WBICBATN
          REP       " +",WBICINVN
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBICURNO,UPDLINK
          APPEND    "&admissno=",UPDLINK
          APPEND    WBICADMN,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBICBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBICINVN,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBICURNO,PATLINK
          APPEND    "&admissno=",PATLINK
          APPEND    WBICADMN,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBICURNO
          REP       "+ ",WBICADMN
          REP       "+ ",WBICBATN
          REP       "+ ",WBICINVN
.
          REP       "+ ",WBICCUID                             
          REP       "+ ",WBICUUID                             
.
          WRITE     HTMLFILE;"t.addRow(#"",WBICBATN,"#",":                * 0
                             "#"",WBICADMN,"#",":                         * 1   
                             "#"",WBICINVN,"#",":                         * 2
                             "#"",FORMATNM,"#",":                         * 3
                             "#"",WBICHFND,"#",";                         * 4 
.
          IF        WBICFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBICAMTC,"#",";                       * 5  
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":                         * 6
                             "#"",WBICPBAT,"#",":                         * 7
                             "#"",WBICNBAT,"#",":                         * 8
                             "#"#",":                                     * 9
                             "#"",UPDLINK,"#",":                          * 10 
                             "#"#",":                                     * 11
                             "#"",PATLINK,"#",";                          * 12
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBICBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";                                   * 13
          ELSE
            MATCH     SP70,WBICNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBICBATN,WBICINVN:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBICBATN,WBICINVN:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBICBATN,WBICINVN:
                               "' onclick=reSubmit(this);>":
                               "#",";                                     * 14
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBICFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBICBATN,WBICINVN:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";                                   * 15
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";                             * 16
.
          MOVE      WBICBATN,DIM8
          REP       " +",WBICURNO
          REP       " +",WBICADMN
          REP       " +",WBICBATN
          REP       " +",WBICINVN
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
      WBICBATN,"','",WBICADMN,"','",WBICURNO,"','",WBICINVN,"');> ",DIM8,"#",";
.
EHCT1900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBICBATN,"','",WBICINVN,"','":
                             WBICURNO,"','",WBICADMN,"');> ","#",";       * 18
.
          REP       "+ ",WBICURNO
          REP       "+ ",WBICADMN
          REP       "+ ",WBICBATN
          REP       "+ ",WBICINVN
.
          REP       "+ ",WBICCUID                                 
          REP       "+ ",WBICUUID                                 
.
. Allow status reset if applicable security level applies (column 18)
.
          IF        SUPERECL=ONE & (WBICFLAG=6 | WBICFLAG=8 | WBICFLAG=9)
            WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
                               " value='",WBICBATN,WBICINVN:
                               "' onclick=resetStatus(this);>":
                               "#"";
          ELSE
            WRITE     HTMLFILE;"#"#"";                                  * 19
          ENDIF

          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBICUDAT
          IF        !@EQUAL
            UNPACK    WBICUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      EHCT1920
          ELSE
            MATCH     SP70,WBICCDAT
            IF        !@EQUAL
              UNPACK    WBICCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      EHCT1920
            ELSE
              GOTO      EHCT1990
            ENDIF
          ENDIF

EHCT1920  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBICUUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBICUUID,SP2,DIM11
            PACK      UIDTIMET,WBICUTIM
            GOTO      EHCT1990
          ELSE
            MATCH     SP70,WBICCUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBICCUID,SP2,DIM11
              PACK      UIDTIMET,WBICCTIM
              GOTO      EHCT1990
            ELSE
              GOTO      EHCT1990
            ENDIF
          ENDIF

EHCT1990  WRITE     HTMLFILE;",#"",UIDCREUD,UIDTIMET,"#");"             * 20
          MOVE      ZERO,LOOPCNTR
.
          GOTO      EHCT1000
.
EHCT2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      EHCT9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSWBIHC3
EHCT3000  CALL      RKWBIHC3
          BRANCH    OVRCD,EHCT9000
          MATCH     SP70,WBICBATN
          GOTO      EHCT9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBICHOSP
              GOTO      EHCT3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBICHOSP
                GOTO      EHCT3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     HLFDCLTY,DWBICEET
            GOTO      EHCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,WBICHFND
            GOTO      EHCT3000 IF NOT EQUAL
          ENDIF
.
          IF        EXCLCLOS=ONE
            IF        WBICFLAG=TEN6
              GOTO      EHCT3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBICFLAG=ZERO
              GOTO      EHCT3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBICURNO
            GOTO      EHCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBICADMN
            GOTO      EHCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBICBATN
            GOTO      EHCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBICFLG
            GOTO      EHCT3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBICINVN
            GOTO      EHCT3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBICBATN,SP70
.           CALL      RDWBIHB1
.           BRANCH    OVRCD,EHCT1000
.
.           MATCH     FRSTDATE,WBIJDTBC
.           GOTO      EHCT1000 IF LESS
.
.           MATCH     WBIJDTBC,LASTDATE
.           GOTO      EHCT1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY34,WBICINVN,Z70
          CALL      RSWBIHA3
          CALL      RPWBIHA3
          IF        OVRCD=0
            MATCH     WBICINVN,WBIIINVN
            IF        @EQUAL
              MATCH     " 5",WBIITYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBICFLAG,STATUH01,STATUH02,STATUH03,STATUH04:
                                      STATUH05,STATUH06,STATUH07,STATUH08:
                                      STATUH09,STATUH10,STATUH11,STATUH12:
                                      STATUH13,STATUH14,STATUH15,STATUH16
.
          CALL      RSBH0000
.
          CALL      GBAH0000
.
          MOVE      WBICURNO,URNUMBER
          MOVE      WBICADMN,ADMISSNO
          CALL      GETPA200
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          REP       " +",WBICURNO
          REP       " +",WBICADMN
          REP       " +",WBICBATN
          REP       " +",WBICINVN
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBICURNO,UPDLINK
          APPEND    "&admissno=",UPDLINK
          APPEND    WBICADMN,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBICBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBICINVN,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBICURNO,PATLINK
          APPEND    "&admissno=",PATLINK
          APPEND    WBICADMN,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBICURNO
          REP       "+ ",WBICADMN
          REP       "+ ",WBICBATN
          REP       "+ ",WBICINVN
.
          WRITE     HTMLFILE;"t.addRow(#"",WBICBATN,"#",":                * 0
                             "#"",WBICADMN,"#",":                         * 1
                             "#"",WBICINVN,"#",":                         * 2  
                             "#"",FORMATNM,"#",":                         * 3
                             "#"",WBICHFND,"#",";                         * 4
.
          IF        WBICFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBICAMTC,"#",";                       * 5 
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":                         * 6
                             "#"",WBICPBAT,"#",":                         * 7
                             "#"",WBICNBAT,"#",":                         * 8
                             "#"#",":                                     * 9
                             "#"",UPDLINK,"#",":                          * 10
                             "#"#",":                                     * 11
                             "#"",PATLINK,"#",";                          * 12
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBICBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";                                   * 13
          ELSE
            MATCH     SP70,WBICNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBICBATN,WBICINVN:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBICBATN,WBICINVN:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBICBATN,WBICINVN:
                               "' onclick=reSubmit(this);>":
                               "#",";                                     * 14
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBICFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBICBATN,WBICINVN:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";                                   * 15
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";                             * 16
.
          MOVE      WBICBATN,DIM8
          REP       " +",WBICURNO
          REP       " +",WBICADMN
          REP       " +",WBICBATN
          REP       " +",WBICINVN
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
      WBICBATN,"','",WBICADMN,"','",WBICURNO,"','",WBICINVN,"');> ",DIM8,"#",";
.
EHCT8900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBICBATN,"','",WBICINVN,"','":
                             WBICURNO,"','",WBICADMN,"');> ","#",";       * 18
.
          REP       "+ ",WBICURNO
          REP       "+ ",WBICADMN
          REP       "+ ",WBICBATN
          REP       "+ ",WBICINVN
.
          REP       "+ ",WBICCUID                             
          REP       "+ ",WBICUUID                             
.
. Allow status reset if applicable security level applies (column 18)
.
          IF        SUPERECL=ONE & (WBICFLAG=6 | WBICFLAG=8 | WBICFLAG=9)
            WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
                               " value='",WBICBATN,WBICINVN: 
                               "' onclick=resetStatus(this);>":
                               "#"";
          ELSE
            WRITE     HTMLFILE;"#"#"";                                  * 19
          ENDIF

          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBICUDAT
          IF        !@EQUAL
            UNPACK    WBICUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      EHCT8920
          ELSE
            MATCH     SP70,WBICCDAT
            IF        !@EQUAL
              UNPACK    WBICCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      EHCT8920
            ELSE
              GOTO      EHCT8990
            ENDIF
          ENDIF

EHCT8920  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBICUUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBICUUID,SP2,DIM11
            PACK      UIDTIMET,WBICUTIM
            GOTO      EHCT8990
          ELSE
            MATCH     SP70,WBICCUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBICCUID,SP2,DIM11
              PACK      UIDTIMET,WBICCTIM
              GOTO      EHCT8990
            ELSE
              GOTO      EHCT8990
            ENDIF
          ENDIF

.
EHCT8990  WRITE     HTMLFILE;",#"",UIDCREUD,UIDTIMET,"#");"             * 20
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      EHCT3000
.
EHCT9000
EHCT9999  RETURN
+
.------------------------------------------------------------
. Next Day, Week, Month
.------------------------------------------------------------
NXTH0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          REP       " +",HLTHFUND
          REP       " +",HLFDCLTY
          REP       " +",BATCHNUM
          REP       " +",INVNUMBR
          REP       " +",CLAIMSTA
          REP       " +",HOSPCODE
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&viewtype=",VIEWTYPE:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&allhflag=",ALLHFLAG:
                             "&hlthfund=",HLTHFUND:
                             "&exclwait=",EXCLWAIT:
                             "&exdtblnk=",EXDTBLNK:
                             "&hlfdclty=",HLFDCLTY:
                             "&batchnum=",BATCHNUM:
                             "&invnumbr=",INVNUMBR:
                             "&claimsta=",CLAIMSTA:
                             "&hospcode=",HOSPCODE:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO:
                             "&exclclos=",EXCLCLOS;
.
          REP       "+ ",HLTHFUND
          REP       "+ ",HLFDCLTY
          REP       "+ ",BATCHNUM
          REP       "+ ",INVNUMBR
          REP       "+ ",CLAIMSTA
          REP       "+ ",HOSPCODE
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
NXTH9999  RETURN
.
.--------------------------------------------------------
.
PRVH0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          REP       " +",HLTHFUND
          REP       " +",HLFDCLTY
          REP       " +",BATCHNUM
          REP       " +",INVNUMBR
          REP       " +",CLAIMSTA
          REP       " +",HOSPCODE
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&viewtype=",VIEWTYPE:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&allhflag=",ALLHFLAG:
                             "&hlthfund=",HLTHFUND:
                             "&exclwait=",EXCLWAIT:
                             "&exdtblnk=",EXDTBLNK:
                             "&hlfdclty=",HLFDCLTY:
                             "&batchnum=",BATCHNUM:
                             "&invnumbr=",INVNUMBR:
                             "&claimsta=",CLAIMSTA:
                             "&hospcode=",HOSPCODE:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO:
                             "&exclclos=",EXCLCLOS;
.
          REP       "+ ",HLTHFUND
          REP       "+ ",HLFDCLTY
          REP       "+ ",BATCHNUM
          REP       "+ ",INVNUMBR
          REP       "+ ",CLAIMSTA
          REP       "+ ",HOSPCODE
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
PRVH9999  RETURN
+
.------------------------------------------------------------
. Table of Batch Numbers
.------------------------------------------------------------
.
BATTH000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BATHH000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70
          CALL      RSWBIHB1                     * position in file
BATTH100  CALL      RPWBIHB1                     * read previous record
          BRANCH    OVRCD,BATTH999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BATTH100
          ENDIF
.
          CALL      BATRH000      * Display Row
          BRANCH    EXIT,BATTH100
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BATTH100 IF NOT EQUAL
.
BATTH999  RETURN
+
.------------------------------------------------------------
. Batch Numbers by Code (TABLE HEADING)
.------------------------------------------------------------
BATHH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Batch Number</td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=25%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Health Fund</td>":
                             "<td class=HeadingCell width=15%>":
                             "Date</td>":
                             "<td class=HeadingCell width=15%>":
                             "Time</td>":
.                            "<td class=HeadingCell width=15%>":
.                            "Status</td>":
                             "</tr>"
.
BATHH999  RETURN
+
.------------------------------------------------------------
. Batch Numbers (TABLE ROW)
.------------------------------------------------------------
BATRH000  MOVE      ZERO,EXIT
          PACK      BTSCHOSP,BTSCHOSP,SP70
.
          UNPACK    WBIJDTBC,CCENT,CYEAR,CMON,CDAY  * Batch Created Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
.         MOVE      "Extracted     ",BSTATDES
.         LOAD      BSTATDES,PTEHFLAG,BSTATDS1,BSTATDS2,BSTATDS3
.
          UNPACK    WBIJTMBC,DIM5,ANS,ANS,ANS
.
          MOVE      SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      BATRH500 IF NOT EQUAL
.
          PACK      KEY24,WBIJBTHN,SP30         * get Hospital for given Batch
          CALL      RSWBIHC3
          CALL      RKWBIHC3
          IF        OVRCD=1
            MOVE      ONE,EXIT
            GOTO      BATRH999
          ENDIF
.
          MATCH     WBIJBTHN,WBICBATN
          IF        @EQUAL
            MOVE      WBICHOSP,KEY3
            CALL      RDPTHSP1            * read Hospital name for visit
            IF        OVRCD=1
              MOVE      WBICHOSP,HOSPNAME
            ELSE
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
.
            MATCH     SP70,BTSCHOSP
            IF        !@EQUAL&!@EOS
              MATCH     BTSCHOSP,WBICHOSP
              IF        !@EQUAL
                MOVE      ONE,EXIT
                GOTO      BATRH999
              ENDIF
            ENDIF
          ELSE
            MOVE      ONE,EXIT
            GOTO      BATRH999
          ENDIF
.
BATRH500  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",WBIJBTHN,"#")'>":
                             WBIJBTHN,"</a></td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",WBIJHFND,"&nbsp;</td>":
                             "<td>",KEY11,"</td>":
                             "<td>",DIM5,"</td>":
                             "</tr>";
.
BATRH999  RETURN
+
.*****************************************************************************
.*                          RSBH0000                                         *
.*****************************************************************************
RSBH0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,WBICNBAT                 * next batch blank ?
          GOTO      RSBH9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBICFLAG <> 16 & WBICFLAG <> 3
            GOTO      RSBH9000
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
          PACK      KEY8,WBICINVN,SP70
          CALL      RDINV1
          BRANCH    OVRCD,RSBH9000
.
          CALL      GBAH0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PINVAMT > 0)
            GOTO      RSBH9000
          ENDIF
.
          PACK      KEY16,WBICINVN,SP70
          CALL      RAWBIHC2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBH9000
          ENDIF
.
          GOTO      RSBH9999
.
RSBH9000  MOVE      ONE,RSUBINDI
RSBH9999  RETURN
+
.------------------------------------------------------------
. Table of Outstanding Assessment Reports
.------------------------------------------------------------
ECOH0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY31,SP70
          CALL      RSWBECO1                     * position in file
ECOH1000  CALL      RKWBECO1                     * read next record
          BRANCH    OVRCD,ECOH9999               * end of file
.
          RJUSTIFY  WBEOINVN
          RJUSTIFY  WBEOBATN
          MOVE      SP70,FORMATNM
          MOVE      SP70,KEY3
          MOVE      SP70,URNUMBER
          MOVE      SP70,ADMISSNO
          PACK      KEY16,WBEOINVN,WBEOBATN,SP70
          CALL      RDWBIHC2
          IF        OVRCD=0
            MOVE      WBICURNO,URNUMBER
            MOVE      WBICADMN,ADMISSNO
            CALL      GETPA200
            CALL      PATLN000
            CALL      PATFLD00
          ELSE
            GOTO      ECOH1000
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     HLFDCLTY,WBEOCTYP
            GOTO      ECOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,WBEOHFND
            GOTO      ECOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PROCSTAT
          IF        !@EQUAL & !@EOS
            MATCH     PROCSTAT,WBEODFLG
            GOTO      ECOH1000 IF NOT EQUAL
          ENDIF
.
          CALL      ECOHRW00
.
          GOTO      ECOH1000
.
ECOH9999  RETURN
+
.------------------------------------------------------------
. Table of Outstanding Assessment Reports (Detail Row)
.------------------------------------------------------------
ECOHRW00  REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    URNUMBER,PATLINK
          APPEND    "&admissno=",PATLINK
          APPEND    ADMISSNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          WRITE     HTMLFILE;"t.addRow(#"",WBEOHFND,"#",":
                             "#"",ADMISSNO,"#",":
                             "#"",URNUMBER,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",WBEOINVN,"#",";
.
          MATCH     "1",WBEODFLG
          IF        @EQUAL
            WRITE     HTMLFILE;"#"<font color=red>closed</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"<input type=checkbox name=otp",DRECCNT:
                               " value='",WBEOHFND,WBEODFLG,WBEOTRID:
                               "' onclick=outprocr(this);>":
                               "#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",PATLINK,"#",";
          WRITE     HTMLFILE;"#"",WBEOTRID,"#",";
          WRITE     HTMLFILE;"#"",KEY3,"#");";
.
ECOHRW99  RETURN
+
.------------------------------------------------------------
. Patient Level Table of WebServices IHCW Claim Enquiries
.------------------------------------------------------------
EHCP0000  MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.          IF        EXDTBLNK = 0
.            PACK      KEY16,FRSTDATE,SP70
.          ELSE
.            PACK      KEY16,SP70
.          ENDIF
.
.          CALL      RSWBIHB2
.EHCP0500  CALL      RKWBIHB2
.          BRANCH    OVRCD,EHCP9999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
.          ADD       ONE,LOOPCNTR
.
.          IF        (LOOPCNTR = 500)
.            WRITE     HTMLFILE;"// ",LOOPCNTR
.            MOVE      ZERO,LOOPCNTR
.          ENDIF
.
. -----------------------------------------------------
.
.         IF        EXDTBLNK = 0
.           MATCH     WBIJDTBC,LASTDATE
.           GOTO      EHCP9999 IF LESS
.         ENDIF
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        @EQUAL
              MOVE      WBSEHOSP,HOSPCODE
            ENDIF
          ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSWBIHC5
EHCP1000  CALL      RKWBIHC5
          BRANCH    OVRCD,EHCP9999
          MATCH     FILTURNO,WBICURNO
          GOTO      EHCP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
.         MATCH     WBIJBTHN,WBICBATN
.         GOTO      EHCP9999 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBICHOSP
              GOTO      EHCP9999 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBICHOSP
                GOTO      EHCP9999 IF NOT EQUAL
              ENDIF
            ENDIF
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBICURNO
              GOTO      EHCP1000 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBICURNO
              GOTO      EHCP9999 IF NOT EQUAL
            ENDIF
.
          ENDIF
.
          MATCH     SP70,HLFDCLTY
          IF        !@EQUAL & !@EOS
            MATCH     HLFDCLTY,DWBICEET
            GOTO      EHCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,HLTHFUND
          IF        !@EQUAL & !@EOS
            PACK      HLTHFUND,HLTHFUND,SP70
            MATCH     HLTHFUND,WBICHFND
            GOTO      EHCP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBICFLAG=ZERO
              GOTO      EHCP1000
            ENDIF
          ENDIF
.
.         MATCH     SP70,FILTURNO
.         IF        !@EQUAL & !@EOS
.           MATCH     FILTURNO,WBICURNO
.           GOTO      EHCP1000 IF NOT EQUAL
.         ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBICADMN
            GOTO      EHCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBICBATN
            GOTO      EHCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBICFLG
            GOTO      EHCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBICINVN
            GOTO      EHCP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,WBICBATN,SP70
            CALL      RDWBIHB1
            BRANCH    OVRCD,EHCP1000
.
            MATCH     FRSTDATE,WBIJDTBC
            GOTO      EHCP1000 IF LESS
.
            MATCH     WBIJDTBC,LASTDATE
            GOTO      EHCP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY34,WBICINVN,Z70
          CALL      RSWBIHA3
          CALL      RPWBIHA3
          IF        OVRCD=0
            MATCH     WBICINVN,WBIIINVN
            IF        @EQUAL
              MATCH     " 5",WBIITYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBICFLAG,STATUH01,STATUH02,STATUH03,STATUH04:
                                      STATUH05,STATUH06,STATUH07,STATUH08:
                                      STATUH09,STATUH10,STATUH11,STATUH12:
                                      STATUH13,STATUH14,STATUH15,STATUH16
.
          CALL      RSBH0000
.
          CALL      GBAH0000
.
          MOVE      WBICURNO,URNUMBER
          MOVE      WBICADMN,ADMISSNO
          CALL      GETPA200
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          REP       " +",WBICURNO
          REP       " +",WBICADMN
          REP       " +",WBICBATN
          REP       " +",WBICINVN
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBICURNO,UPDLINK
          APPEND    "&admissno=",UPDLINK
          APPEND    WBICADMN,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBICBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBICINVN,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBICURNO,PATLINK
          APPEND    "&admissno=",PATLINK
          APPEND    WBICADMN,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBICURNO
          REP       "+ ",WBICADMN
          REP       "+ ",WBICBATN
          REP       "+ ",WBICINVN
.
          WRITE     HTMLFILE;"t.addRow(#"",WBICBATN,"#",":
                             "#"",WBICADMN,"#",":
                             "#"",WBICINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",WBICHFND,"#",";
.
          IF        WBICFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBICAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBICPBAT,"#",":
                             "#"",WBICNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBICBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBICNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBICBATN,WBICINVN:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBICBATN,WBICINVN:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBICBATN,WBICINVN:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBICFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBICBATN,WBICINVN:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBICBATN,DIM8
          REP       " +",WBICURNO
          REP       " +",WBICADMN
          REP       " +",WBICBATN
          REP       " +",WBICINVN
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
      WBICBATN,"','",WBICADMN,"','",WBICURNO,"','",WBICINVN,"');> ",DIM8,"#",";
          REP       "+ ",WBICURNO
          REP       "+ ",WBICADMN
          REP       "+ ",WBICBATN
          REP       "+ ",WBICINVN
.
. Allow status reset if applicable security level applies (column 18)
.
          IF        SUPERECL=ONE & (WBICFLAG=6 | WBICFLAG=8 | WBICFLAG=9)
            WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
                               " value='",WBICBATN,WBICINVN:
                               "' onclick=resetStatus(this);>":
                               "#");"
          ELSE
            WRITE     HTMLFILE;"#"#");"
          ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      EHCP1000
.
EHCP9999  RETURN
+
.---------------------------------------------------------------
. IHCW RTVW <tran id>.properties tag
.---------------------------------------------------------------
RTHHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      RTHHED99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     RTHHED99 IF EQUAL
          GOTO     RTHHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      RTHHED99
          ENDIF
.
RTHHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      RTHHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      RTHHED10
.
RTHHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. IHCW RTVW <tran id>_ihcwrtvw  tag
.---------------------------------------------------------------
RTHJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      RTHJSN99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     RTHJSN99 IF EQUAL
          GOTO     RTHJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTHWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      RTHWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      RTHJSN99
          ENDIF
.
RTHJSN10  READ      RTHWFILE,SEQ;RTHWLINE
          GOTO      RTHJSN99 IF OVER
.
          WRITE     HTMLFILE;RTHWLINE
.
          GOTO      RTHJSN10
.
RTHJSN99  CLOSE     RTHWFILE
.
          RETURN
+
.---------------------------------------------------------------
. IHCW RTVW <tran id>_ihcwrtvw_response  tag
.---------------------------------------------------------------
RTHRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      RTHRSP99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     RTHRSP99 IF EQUAL
          GOTO     RTHRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTHRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      RTHRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      RTHRSP99
          ENDIF
.
RTHRSP10  READ      RTHRFILE,SEQ;RTHRLINE
          GOTO      RTHRSP99 IF OVER
.
          WRITE     HTMLFILE;RTHRLINE
.
          GOTO      RTHRSP10
.
RTHRSP99  CLOSE     RTHRFILE
.
          RETURN
+
.---------------------------------------------------------------
. IHCW RTVW <tran id>_ihcwrtvw_errors  tag
.---------------------------------------------------------------
RTHERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      RTHERR99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     RTHERR99 IF EQUAL
          GOTO     RTHERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    RTHELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      RTHEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      RTHERR99
          ENDIF
.
RTHERR10  READ      RTHEFILE,SEQ;RTHELINE
          GOTO      RTHERR99 IF OVER
.
          WRITE     HTMLFILE;RTHELINE
.
          GOTO      RTHERR10
.
RTHERR99  CLOSE     RTHEFILE
.
          RETURN
+
.---------------------------------------------------------------
. IHCW <tran id>.properties tag
.---------------------------------------------------------------
IHCHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      IHCHED99
          ENDIF
.
          MATCH    SP70,WBICTRID
          GOTO     IHCHED99 IF EQUAL
          GOTO     IHCHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBICTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IHCHED99
          ENDIF
.
IHCHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      IHCHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      IHCHED10
.
IHCHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. IHCW <tran id>_ihcw  tag
.---------------------------------------------------------------
IHCJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      IHCJSN99
          ENDIF
.
          MATCH    SP70,WBICTRID
          GOTO     IHCJSN99 IF EQUAL
          GOTO     IHCJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBICTRID,CMDLINE
          APPEND    IHCWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IHCWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IHCJSN99
          ENDIF
.
IHCJSN10  READ      IHCWFILE,SEQ;IHCWLINE
          GOTO      IHCJSN99 IF OVER
.
          WRITE     HTMLFILE;IHCWLINE
.
          GOTO      IHCJSN10
.
IHCJSN99  CLOSE     IHCWFILE
.
          RETURN
+
.---------------------------------------------------------------
. IHCW <tran id>_ihcw_response  tag
.---------------------------------------------------------------
IHCRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      IHCRSP99
          ENDIF
.
          MATCH    SP70,WBICTRID
          GOTO     IHCRSP99 IF EQUAL
          GOTO     IHCRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBICTRID,CMDLINE
          APPEND    IHCRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IHCRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IHCRSP99
          ENDIF
.
IHCRSP10  READ      IHCRFILE,SEQ;IHCRLINE
          GOTO      IHCRSP99 IF OVER
.
          WRITE     HTMLFILE;IHCRLINE
.
          GOTO      IHCRSP10
.
IHCRSP99  CLOSE     IHCRFILE
.
          RETURN
+
.---------------------------------------------------------------
. IHCW <tran id>_ihcw_errors  tag
.---------------------------------------------------------------
IHCERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      IHCERR99
          ENDIF
.
          MATCH    SP70,WBICTRID
          GOTO     IHCERR99 IF EQUAL
          GOTO     IHCERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ihcw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBICTRID,CMDLINE
          APPEND    IHCELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      IHCEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IHCERR99
          ENDIF
.
IHCERR10  READ      IHCEFILE,SEQ;IHCELINE
          GOTO      IHCERR99 IF OVER
.
          WRITE     HTMLFILE;IHCELINE
.
          GOTO      IHCERR10
.
IHCERR99  CLOSE     IHCEFILE
.
          RETURN
+
.------------------------------------------------------------
. Validate Batch Number
. INPUTS: BATCHNUM - Batch Number
.------------------------------------------------------------
VALBAH00  CALL      XMLHED00
          BRANCH    EXIT,VALBAH99
.
          PACK      KEY24,BATCHNUM,SP70
          CALL      RSWBIHC3
          CALL      RKWBIHC3
          BRANCH    OVRCD,VALBAH90
.
          MATCH     WBICBATN,BATCHNUM
          GOTO      VALBAH90 IF NOT EQUAL
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALBAH98
.
VALBAH90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Batch number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAH98
.
VALBAH98  CALL      XMLEND00
VALBAH99  RETURN
+
.------------------------------------------------------------
. WebServices PCIW Full Details
.------------------------------------------------------------
WPCI0000  MATCH     "1",PTCNWSIN
          GOTO      WPCI9500 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      WPCI9500 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      WPCI5000 IF EQUAL
.
          MATCH     ANSC,UPDATTYP
          GOTO      WPCI6000 IF EQUAL
.
          MATCH     ANSD,UPDATTYP
          GOTO      WPCI7000 IF EQUAL
.
          MATCH     ANSB,UPDATTYP
          GOTO      WPCI8000 IF EQUAL
.
          MATCH     ANSL,UPDATTYP
          GOTO      WPCI8500 IF EQUAL
.
          MATCH     ANSP,UPDATTYP
          GOTO      WPCI8600 IF EQUAL
.
          GOTO      WPCI9000
.
WPCI5000  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,WPCI9100
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,WPCI9100
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          CALL      PATFLD00                * Use standard Patient Folder sub
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          BRANCH    OVRCD,WPCI9200
.
          MOVE      WBPIUNIQ,UNIQNUMB
.
          MATCH     "1",MAVMODUL
          IF        @EQUAL
.
            CALL      DFUW0000
.
            PACK      KEY8,MAVINVCE,SP70
            CALL      RDINV1
            BRANCH    OVRCD,WPCI9400
.
            PACK      KEY8,PINVADM,SP70
            CALL      RDEMVIS1
            BRANCH    OVRCD,WPCI9700
.
            GOTO      WPCI5500
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
.
            CALL      DFWP0000
.
            PACK      KEY8,UNIQNUMB,SP70
            CALL      RDPRHD2
            BRANCH    OVRCD,WPCI9300
.
            PACK      KEY27,PRHDUNIQ,PRHRE001,PRHRE002,PRHRE003,SP70
            CALL      RDPRHR1
            BRANCH    OVRCD,WPCI9300
.
            PACK      KEY8,MAVINVCE,SP70
            CALL      RDPRIN1
            BRANCH    OVRCD,WPCI9400
.
            GOTO      WPCI5500
          ENDIF
.
          GOTO      WPCI9600
.
WPCI5500  PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBSDD2
          IF        OVRCD=1
            CALL      CLWEBSDD
          ENDIF
.
          PACK      KEY71,WBPIHOSP,SP70          * Read B2B Device Table
          CALL      RSWBB2B3
          CALL      RKWBB2B3
          IF        OVRCD=1
            MOVE      SP70,WBB2DPTH
          ELSE
            MATCH     WBPIHOSP,WBB2HOSP
            IF        !@EQUAL
              MOVE      SP70,WBB2DPTH
            ENDIF
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "WebServices PCIW Full Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,WPCI9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI6000  PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          BRANCH    OVRCD,WPCI9200
.
          MOVE      SIX,WBPIFLAG

          CALL      IBACLOCK
          PACK      WBPICDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBPICDAT
          MOVE      CTIMEIS,WBPICTIM
          MOVE      USERID,WBPICUID
          CALL      UPWBPCI2
.
.         Write a new history (webpcaaf) record
.
          MOVE      WBPIINVN,WBPHINVN
          MOVE      WBPIBATN,WBPHBATN
          MOVE      SIX,WBPHSTAT
          MOVE      " 1",WBPHTYPE
          MOVE      WBSEUID,WBPHOPER
          MOVE      WBPITRID,WBPHTRID
          MOVE      SP70,WBPHEROR
          MOVE      SP70,WBPHEROT
          PACK      WBPHSPAR,SP70,SP70
          MOVE      WBPIMODL,WBPHMODL
          MOVE      WBPIMSID,WBPHMSID
.
          CALL      IBACLOCK                     * get current date/time
          PACK      WBPHDATE,CCC,CYY,CMM,CDD
          REP       " 0",WBPHDATE
          MOVE      CTIMEIS,WBPHTIME
          REP       " 0",WBPHTIME
.
          PACK      KEY27,WBPHINVN,WBPHDATE,WBPHTIME,WBPHTYPE,WBPHMODL,SP70
          CALL      RAWBPCA1
          IF        OVRCD = 1
            CALL      WRWBPCA1
          ENDIF
.
.         MOVE      SP70,TTYPEARG
.         MOVE      " 9",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      "10",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      " 4",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      " 5",TTYPEARG
.         CALL      DELETR00
.
.         CALL      DELECO00
.
          MOVE      ZERO,EXIT
          GOTO      WPCI9999
.
WPCI7000  PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          BRANCH    OVRCD,WPCI9200
.
          CALL      CLWEBSDD
.
          MOVE      WBPIHOSP,WBSWHOSP
          MOVE      ZERO,WBSWFLAG
          MOVE      WBPIMODL,WBSWMODL
          MOVE      WBPIUNIQ,WBSWUNIQ
          MOVE      WBPIINVN,WBSWINVN
          MOVE      WBPIBATN,WBSWBATN
          MOVE      WBPIURNO,WBSWURNO
          MOVE      WBPITRID,WBSWTRID
          MOVE      WBPIMSID,WBSWMSID
          MOVE      "Waiting",WBSWTEXT
          MOVE      WBSDD001,WBSWRESC
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RAWBSDD2
          IF        OVRCD=0
            GOTO      WPCI9800
          ENDIF
.
          CALL      WRWBSDD2
.
          MOVE      ZERO,EXIT
          GOTO      WPCI9999
.
WPCI8000  
.         MATCH     SP70,PTCNPCIP
.         GOTO      WPCI9900 IF EQUAL
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          BRANCH    OVRCD,WPCI9200
.
          MATCH     SP70,WBPITRID
          GOTO      WPCI9910 IF EQUAL
.
          PACK      KEY46,WBPITRID,SP70
          CALL      RSWBPCE2
          CALL      RKWBPCE2
          BRANCH    OVRCD,WPCI9920
.
          MATCH     WBPITRID,WBPETRID
          GOTO      WPCI9920 IF NOT EQUAL
.
          MATCH     "MEDICARE_ASSESSED",WBPESTAT
          GOTO      WPCI9930 IF NOT EQUAL
.
.         MOVE      PTCNPCIP,SCHDPRNT
          MOVE      PCIPPRNT,SCHDPRNT
.
          MOVE      "IBAWEB27",SCHDPGID
          MOVE      "Generating a PCIW Claim and Benefit Form",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
          MOVE      "IBAWEB27",SETDFPRG
          MOVE      "07",SETDFRPT
          CALL      SETDEF00
.
.         Write Keyin parameters
.
          MATCH     "1",WBPIMODL
          IF        @EQUAL
            MOVE      "1",KEYSTARR[1]          * 1 for ED
          ELSE
            MOVE      "2",KEYSTARR[1]
          ENDIF
.
          MOVE      MAVINVCE,KEYSTARR[2]     * Invoice number
          MOVE      SP70,KEYSTARR[3]
          MOVE      SP70,KEYSTARR[4]
.
          MOVE      FOUR,KEYSTCNT         * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
          MOVE      ZERO,EXIT
          GOTO      WPCI9999
.
WPCI8500
.         MATCH     SP70,PTCNPCIP
.         GOTO      WPCI9900 IF EQUAL
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          BRANCH    OVRCD,WPCI9200
.
          MATCH     SP70,WBPITRID
          GOTO      WPCI9910 IF EQUAL
.
          PACK      KEY46,WBPITRID,SP70
          CALL      RSWBPCE2
          CALL      RKWBPCE2
          BRANCH    OVRCD,WPCI9920
.
          MATCH     WBPITRID,WBPETRID
          GOTO      WPCI9920 IF NOT EQUAL
.
.         MATCH     "MEDICARE_ASSESSED",WBPESTAT
.         GOTO      WPCI9930 IF NOT EQUAL
.
.         MOVE      PTCNPCIP,SCHDPRNT
          MOVE      PCIPPRNT,SCHDPRNT
.
          MOVE      "IBAWEB26",SCHDPGID
          MOVE      "Generating a PCIW Lodgement of Advice",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
          MOVE      "IBAWEB26",SETDFPRG
          MOVE      "07",SETDFRPT
          CALL      SETDEF00
.
.         Write Keyin parameters
.
          MATCH     "1",WBPIMODL
          IF        @EQUAL
            MOVE      "1",KEYSTARR[1]          * 1 for ED
          ELSE
            MOVE      "2",KEYSTARR[1]
          ENDIF
.
          MOVE      MAVINVCE,KEYSTARR[2]     * Invoice number
          MOVE      SP70,KEYSTARR[3]
          MOVE      SP70,KEYSTARR[4]
.
          MOVE      FOUR,KEYSTCNT         * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
          MOVE      ZERO,EXIT
          GOTO      WPCI9999
.
WPCI8600
.         MATCH     SP70,PTCNPCIP
.         GOTO      WPCI9900 IF EQUAL
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          BRANCH    OVRCD,WPCI9200
.
          MATCH     SP70,WBPITRID
          GOTO      WPCI9910 IF EQUAL
.
          PACK      KEY46,WBPITRID,SP70
          CALL      RSWBPCE2
          CALL      RKWBPCE2
          BRANCH    OVRCD,WPCI9920
.
          MATCH     WBPITRID,WBPETRID
          GOTO      WPCI9920 IF NOT EQUAL
.
          MATCH     "MEDICARE_PENDABLE",WBPESTAT
          GOTO      WPCI9930 IF NOT EQUAL
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          IF        OVRCD=0
            MOVE      TWO,WBPIFLAG

            CALL      IBACLOCK
            PACK      WBPICDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBPICDAT
            MOVE      CTIMEIS,WBPICTIM
            MOVE      USERID,WBPICUID
            CALL      UPWBPCI2
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      WPCI9999
.
WPCI9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9200  MOVE      "Can't find PCIW Claim details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9300  MOVE      "Doctor Referral details has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9400  MOVE      "Can't Find Invoice Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9500  MOVE      "Not using PCIW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9600  MOVE      "Invalid PCIW webPAS Module",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9700  MOVE      "Emergency Visit has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9800  MOVE      "SDDW record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9900  MOVE      "Invalid PCIW Printer ID. Please check parameter.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9910  MOVE      "Invalid transaction id webpciaf",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9920  MOVE      "PCIW Assessment record webpceaf not found",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9930  MOVE      "PCIW not MEDICARE_ASSESSED. Form not printed.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCI9999
.
WPCI9999  RETURN
+
.*****************************************************************************
.*                          DFUW0000                                         *
.*****************************************************************************
.
DFUW0000  CALL      GBAW0000                     * get outstanding inv. balance
.
          MOVE      STATPC00,STATDESC
          LOAD      STATDESC,WBPIFLAG,STATPC01,STATPC02,STATPC03,STATPC04:
                                      STATPC05,STATPC06
.
DFUW9999  RETURN
+
.*****************************************************************************
.*                          GBAW0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on webpciaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBAW0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBPIINVN,KEY8
          CALL      RDINV1
          IF        OVRCD = 1
            GOTO      GBAW9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR+PTINCRTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PTINGSTJ,FORM7P2O
          ENDIF
.
GBAW9999  RETURN
+
.------------------------------------------------------------
. WebServices PCIW Claim Full Details tags
.------------------------------------------------------------
ECFP0000  BRANCH    FLDITMNO,ECFP0100,ECFP0200,ECFP0300,ECFP0400,ECFP0500:
                             ECFP0600,ECFP0700,ECFP0800,ECFP0900,ECFP1000:
                             ECFP1100,ECFP1200,ECFP1300,ECFP1400,ECFP1500:
                             ECFP1600,ECFP1700,ECFP1800,ECFP1900,ECFP2000:
                             ECFP2100,ECFP2200,ECFP2300,ECFP2400,ECFP2500:
                             ECFP2600,ECFP2700,ECFP2800,ECFP2900,ECFP3000:
                             ECFP3100,ECFP3200,ECFP3300,ECFP3400,ECFP3500:
                             ECFP3600,ECFP3700,ECFP3800,ECFP3900,ECFP4000:
                             ECFP4100,ECFP4200,ECFP4300,ECFP4400,ECFP4500:
                             ECFP4600,ECFP4700,ECFP4800,ECFP4900,ECFP5000:
                             ECFP5100,ECFP5200,ECFP5300,ECFP5400,ECFP5500:
                             ECFP5600,ECFP5700,ECFP5800,ECFP5900,ECFP6000:
                             ECFP6100,ECFP6200,ECFP6300,ECFP6400,ECFP6500:
                             ECFP6600
.
          GOTO      ECFP9999
.
ECFP0100  WRITE     HTMLFILE;FORM7P2O;
          GOTO      ECFP9999
.
ECFP0200  WRITE     HTMLFILE;STATDESC;
          GOTO      ECFP9999
.
ECFP0300
.         WRITE     HTMLFILE;CONTDESC;
          GOTO      ECFP9999
.
ECFP0400
.         MATCH     SP70,PRECPDAT
.         GOTO      ECFP9999 IF EQUAL
.         UNPACK    PRECPDAT,CCENT,CYEAR,CMON,CDAY  * Payment Date
.         MOVE      CMON,F2
.         LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.         WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ECFP9999
.
ECFP0500
.         WRITE     HTMLFILE;PRECEETP;
          GOTO      ECFP9999
.
ECFP0600
.         MATCH     "2",PRECEETP
.         IF        @EQUAL
.           WRITE     HTMLFILE;"Medicare Only";
.         ELSE
.           PACK      KEY14,PRECHFND,ZERO,ZERO,ZERO,ZERO,SP70
.           CALL      RDFUND1
.           IF        OVRCD=0
.             WRITE     HTMLFILE;HFNAME;
.           ENDIF
.         ENDIF
          GOTO      ECFP9999
.
ECFP0700  WRITE     HTMLFILE;WBPIINVN;
          GOTO      ECFP9999
.
ECFP0800  WRITE     HTMLFILE;WBPIBATN;
          GOTO      ECFP9999
.
ECFP0900  WRITE     HTMLFILE;WBPIPBAT;
          GOTO      ECFP9999
.
ECFP1000  WRITE     HTMLFILE;WBPINBAT;
          GOTO      ECFP9999
.
ECFP1100  WRITE     HTMLFILE;WBPITRID;
          GOTO      ECFP9999
.
ECFP1200
.         WRITE     HTMLFILE;PRECFTID;
          GOTO      ECFP9999
.
ECFP1300  WRITE     HTMLFILE;WBPIAMTC;
          GOTO      ECFP9999
.
ECFP1400  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVAMT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINITOT;
          ENDIF
          GOTO      ECFP9999
.
ECFP1500  MOVE      ZERO,DPAMOUNT
.
          MOVE      WBPIINVN,KEY12
          SQUEEZE   KEY12
          RJUSTIFY  KEY12
          PACK      KEY29,KEY12,SP70
          CALL      RSRCDTE3
ECFP1510  CALL      RKRCDTE3
          BRANCH    OVRCD,ECFP1590
.
          MATCH     KEY12,RCDTINVN           
          GOTO      ECFP1590 IF NOT EQUAL    
.
          ADD       RCDTAMNT,DPAMOUNT
.
          GOTO      ECFP1510
.
ECFP1590  WRITE     HTMLFILE;DPAMOUNT;
.
          GOTO      ECFP9999
.
.
.ECFP1500  MATCH     "1",MAVMODUL
.          IF        @EQUAL
.            WRITE     HTMLFILE;PINVPATA;
.          ENDIF
.
.          MATCH     "2",MAVMODUL
.          IF        @EQUAL
.            WRITE     HTMLFILE;PRINPAMT;
.          ENDIF
.
.          GOTO      ECFP9999
.
ECFP1600
.         WRITE     HTMLFILE;PRINHAMT;
          GOTO      ECFP9999
.
ECFP1700  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVOTHA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINOTHA;
          ENDIF
          GOTO      ECFP9999
.
ECFP1800  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVJOUR;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINJAMT;
          ENDIF
          GOTO      ECFP9999
.
ECFP1900  
.         WRITE     HTMLFILE;PRECAMFP;
          GOTO      ECFP9999
.
ECFP2000  MATCH     SP70,WBPISTAT                * blank status ?
          GOTO      ECFP9999 IF EQUAL            * yes - don't display anything
          GOTO      ECFP9999 IF EOS
.
          MATCH     " 0",WBPISTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed";
            GOTO      ECFP9999
          ENDIF
.
          GOTO      ECFP9999
.
ECFP2100  CALL      WDIS0000
          GOTO      ECFP9999
.
ECFP2200  CALL      WDIP0000
          GOTO      ECFP9999
.
ECFP2300  CALL      WDCE0000
          GOTO      ECFP9999
.
ECFP2400  CALL      WDSD0000
          GOTO      ECFP9999
.
ECFP2500
.         CALL      WDSE0000
          GOTO      ECFP9999
.
ECFP2600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PTINCRTT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINCNTT;
          ENDIF
          GOTO      ECFP9999
.
ECFP2700
.         WRITE     HTMLFILE;CFEETYP;
          GOTO      ECFP9999
.
ECFP2800
.         WRITE     HTMLFILE;PRECAMMP;
          GOTO      ECFP9999
.
ECFP2900  MATCH     "1",MAVMODUL
          IF        @EQUAL
            MOVE      "CL",CATEGORY
            MOVE      EMVICOMP,CODE
            CALL      CODITM00
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            MOVE      "CL",CATEGORY         * claim code
            MOVE      PRHDCLAM,CODE
            CALL      CODITM00
          ENDIF
.
          GOTO      ECFP9999
.
ECFP3000
.          UNPACK    DIM127,D1,KEY1,DIM127
.          MOVE      ZERO,F1
.          MOVE      KEY1,F1
.          BRANCH    F1,ECFP3010
.
.          WRITE     HTMLFILE;PRHDHFND;
.
.          GOTO      ECFP9999
.
.ECFP3010  MATCH     SP70,PRHDHFND
.          GOTO      ECFP9999 IF EQUAL
.          GOTO      ECFP9999 IF EOS
.
.          PACK      KEY14,PRHDHFND,ZERO,ZERO,ZERO,ZERO,SP70
.          CALL      RDFUND1
.          BRANCH    OVRCD,ECFP9999
.
.          WRITE     HTMLFILE;HFNAME;
.
          GOTO      ECFP9999
.
ECFP3100  WRITE     HTMLFILE;UNIQNUMB;
          GOTO      ECFP9999
.
ECFP3200  WRITE     HTMLFILE;PRHRE001;
          GOTO      ECFP9999
.
ECFP3300  WRITE     HTMLFILE;PRHRE002;
          GOTO      ECFP9999
.
ECFP3400  WRITE     HTMLFILE;PRHRE003;
          GOTO      ECFP9999
.
ECFP3500  WRITE     HTMLFILE;MAVMODUL;
          GOTO      ECFP9999
.
ECFP3600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;FOUR;
          ENDIF
          GOTO      ECFP9999
.
ECFP3700  MATCH     SP70,PRHRPIND
          GOTO      ECFP9999 IF EQUAL
          GOTO      ECFP9999 IF EOS
.
          MOVE      "GI",CATEGORY
          MOVE      PRHRPIND,CODE
.
          PACK      KEY5,CATEGORY,CODE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;TDESC;
          ENDIF
.
          GOTO      ECFP9999
.
ECFP3800  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,ECCLTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP3900  CALL      PCRHED00
          GOTO      ECFP9999
.
ECFP4000  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,ECCLTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLTRID,CMDLINE
          APPEND    PCIWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP4100  CALL      PCRJSN00
          GOTO      ECFP9999
.
ECFP4200  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,ECCLTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLTRID,CMDLINE
          APPEND    PCIRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP4300  CALL      PCRRSP00
          GOTO      ECFP9999
.
ECFP4400  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,ECCLTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLTRID,CMDLINE
          APPEND    PCIELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP4500  CALL      PCRERR00
          GOTO      ECFP9999
.
ECFP4600  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,WBPITRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBPITRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP4700  CALL      PCIHED00
          GOTO      ECFP9999
.
ECFP4800  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,WBPITRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBPITRID,CMDLINE
          APPEND    PCIWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP4900  CALL      PCIJSN00
          GOTO      ECFP9999
.
ECFP5000  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,WBPITRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBPITRID,CMDLINE
          APPEND    PCIRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP5100  CALL      PCIRSP00
          GOTO      ECFP9999
.
ECFP5200  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,WBPITRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBPITRID,CMDLINE
          APPEND    PCIELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP5300  CALL      PCIERR00
          GOTO      ECFP9999
.
ECFP5400  PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBSDD2
          IF        OVRCD=0
            GOTO      ECFP9999
          ENDIF
.
          PACK      KEY46,WBPITRID,SP70
          CALL      RSWBPCE2
          CALL      RKWBPCE2
          BRANCH    OVRCD,ECFP9999
.
          MATCH     WBPITRID,WBPETRID
          GOTO      ECFP9999 IF NOT EQUAL
.
          MATCH     "MEDICARE_ASSESSED",WBPESTAT
          GOTO      ECFP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;
.
          GOTO      ECFP9999
.
ECFP5500  WRITE     HTMLFILE;WBSWTEXT;
          GOTO      ECFP9999 
.
ECFP5600  WRITE     HTMLFILE;WBSWRESC;
          GOTO      ECFP9999
.
ECFP5700  MOVE      "rn",CATEGORY  
          MOVE      WBSWRESC,CODE
          CALL      CODITM00
          GOTO      ECFP9999
.
ECFP5800  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,WBSWTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/sddw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBSWTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP5900  CALL      SDDHED00
          GOTO      ECFP9999
.
ECFP6000  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,WBSWTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/sddw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBSWTRID,CMDLINE
          APPEND    SDDWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP6100  CALL      SDDJSN00
          GOTO      ECFP9999
.
ECFP6200  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,WBSWTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/sddw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBSWTRID,CMDLINE
          APPEND    SDDRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP6300  CALL      SDDRSP00
          GOTO      ECFP9999
.
ECFP6400  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECFP9999
          ENDIF
.
          MATCH     SP70,WBSWTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECFP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/sddw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBSWTRID,CMDLINE
          APPEND    SDDELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECFP9999
.
ECFP6500  CALL      SDDERR00
          GOTO      ECFP9999
.
ECFP6600  PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBSDD2
          IF        OVRCD=0
            GOTO      ECFP9999
          ENDIF
.
          PACK      KEY46,WBPITRID,Z70
          CALL      RSWBPCE2
          CALL      RPWBPCE2
          BRANCH    OVRCD,ECFP9999
.
          MATCH     WBPITRID,WBPETRID
          GOTO      ECFP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;WBPESTAT;
.
          GOTO      ECFP9999
.
ECFP9999  RETURN
+
.------------------------------------------------------------
. Table of PCIW History
.------------------------------------------------------------
WDIS0000  MATCH     "1",PTCNWSIN
          GOTO      WDIS9999 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      WDIS9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          CALL      WDISD000      * Output Table Heading
.
          PACK      KEY35,MAVINVCE,Z70
          CALL      RSWBPCA3
WDIS1000  CALL      RPWBPCA3
          BRANCH    OVRCD,WDIS9999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"<!-- ",LOOPCNTR," -->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     MAVINVCE,WBPHINVN
          GOTO      WDIS9999 IF NOT EQUAL
.
.         MATCH     MAVMODUL,WBPHMODL
.         GOTO      WDIS1000 IF NOT EQUAL
.
          CALL      WDSRW000
.
          GOTO      WDIS1000
.
WDIS9999  RETURN
+
.------------------------------------------------------------
. PCIW History (TABLE HEADING)
.------------------------------------------------------------
WDISD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Time</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Status</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Transaction Type</td>":
                             "<td class=HeadingCell width=10%>":
                             "Batch</td>":
                             "<td class=HeadingCell width=10%>":
                             "Reviewed By</td>":
                             "<td class=HeadingCell width=35%>":
                             "Error Code Description</td>":
                             "</tr>"
.
WDISD999  RETURN
+
.------------------------------------------------------------
. PCIW History (Detail Row)
.------------------------------------------------------------
WDSRW000  MOVE      SP70,DIM11
          MATCH     SP70,WBPHDATE
          IF        !@EQUAL & !@EOS
            UNPACK    WBPHDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBPHSTAT,STATPC01,STATPC02,STATPC03,STATPC04:
                                      STATPC05,STATPC06
.
          MOVE      SP30,TYPEDESC
          MOVE      WBPHTYPE,TYPOFREQ
          LOAD      TYPEDESC,TYPOFREQ,TYPEDSF1,TYPEDSF2,TYPEDSF3
          IF        TYPOFREQ = 2 | TYPOFREQ = 3
            STRIP     TYPEDESC
            ENDSET    TYPEDESC
            APPEND    SP1,TYPEDESC
            APPEND    WBPHEROR,TYPEDESC
            APPEND    SP20,TYPEDESC
            RESET     TYPEDESC
          ENDIF
.
          MOVE      SP70,DIM30
          PACK      KEY10,WBPHOPER,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      WBPHOPER,DIM30
          ELSE
            MATCH     WBPHOPER,WBSEUID
            IF        @EQUAL
              MOVE      WBSENAM,DIM30
            ELSE
              MOVE      WBPHOPER,DIM30
            ENDIF
          ENDIF
.
          CMATCH    NULL,WBPHEROT
          IF        @EQUAL
            PACK      WBPHEROT,SP70,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",DIM11 ,"</td>";
          WRITE     HTMLFILE;"<td>",WBPHTIME,"</td>";
          WRITE     HTMLFILE;"<td>",STATDESC,"</td>":
                             "<td>",TYPEDESC,"</td>":
                             "<td>",WBPHBATN,"</td>":
                             "<td>",DIM30,"</td>":
                             "<td>",WBPHEROT,"</td>":
                             "</tr>";
.
WDSRW999  RETURN
+
.------------------------------------------------------------
. Table of PCIW Sychronous Assessment Report
.------------------------------------------------------------
WDIP0000  MATCH     "1",PTCNWSIN
          GOTO      WDIP9999 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      WDIP9999 IF NOT EQUAL
.
          CALL      WDIPHD00      * Output Table Heading
.
          PACK      KEY46,WBPITRID,Z70
          CALL      RSWBPCE2
WDIP1000  CALL      RPWBPCE2
          BRANCH    OVRCD,WDIP9999
.
          MATCH     WBPITRID,WBPETRID
          GOTO      WDIP9999 IF NOT EQUAL
.
          CALL      WDIPRW00
.
          GOTO      WDIP1000
.
WDIP9999  RETURN
+
.------------------------------------------------------------
. PCIW Assessment Report (TABLE HEADING)
.------------------------------------------------------------
WDIPHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Status&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim Current Mem Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim Current Ref Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Pat Current Mem Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Pat Current Ref Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Text&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Transaction Id&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medical Event Details&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Report Details&nbsp;</td>":
                             "</tr>"
.
WDIPHD99  RETURN
+
.------------------------------------------------------------
. PCIW Assessment Report (Detail Row)
.------------------------------------------------------------
WDIPRW00  WRITE     HTMLFILE;"<tr><td valign=top>",WBPESTAT,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBPECLID,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBPECCMN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBPECCMR,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBPEPCMN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBPEPCMR,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBPEECDE,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBPEETXT,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBPETRID,"</td>";
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=07":
                             "&template=004":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&mavmodul=",MAVMODUL:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclclmi=",WBPECLID:
                             "&eccltrid=",WBPETRID,"#";'>":
                             "</td>";
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='displayJSON(#"../cgi-bin/eclweb73.pbl":
                             "?reportno=07":
                             "&template=006":
                             "&urnumber=",URNUMBER:
                             "&admissno=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&mavmodul=",MAVMODUL:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclclmi=",WBPECLID:
                             "&eccltrid=",WBPETRID,"#");'>":
                             "</td>":
                             "</tr>";
.
WDIPRW99  RETURN
+
.------------------------------------------------------------
. Table of PCIW Claim Medical Event Assessment Esponse Report
.------------------------------------------------------------
WDCE0000  MATCH     "1",PTCNWSIN
          GOTO      WDCE9999 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      WDCE9999 IF NOT EQUAL
.
          CALL      WDCEHD00      * Output Table Heading
.
          PACK      KEY49,ECCLCLMI,ECCLTRID,SP70
          CALL      RSWBPCF1                     * position in file
WDCE1000  CALL      RKWBPCF1                     * read next record
          BRANCH    OVRCD,WDCE9999               * end of file
.
          MATCH     ECCLCLMI,WBPFCLID            * same claim id
          GOTO      WDCE9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLTRID,WBPFTRID            * same account ref. id ?
          GOTO      WDCE9999 IF NOT EQUAL        * no - finished listing
.
          CALL      WDCERW00
.
          GOTO      WDCE1000
.
WDCE9999  RETURN
+
.------------------------------------------------------------
. PCIW Medical Event Assessment Report Table (TABLE HEADING)
.------------------------------------------------------------
WDCEHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Event Date&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medical Event ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Details&nbsp;</td>":
                             "</tr>"
.
WDCEHD99  RETURN
+
.------------------------------------------------------------
. PCIW Medical Event Assessment Report Table (Detail Row)
.------------------------------------------------------------
WDCERW00  MOVE      SP70,DIM11
          MATCH     SP70,WBPFEVDT
          IF        !@EQUAL & !@EOS
            UNPACK    WBPFEVDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td valign=top>",DIM11,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBPFMEID,"</td>";
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=07":
                             "&template=005":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&mavmodul=",MAVMODUL:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclclmi=",WBPFCLID:
                             "&eccltrid=",WBPFTRID:
                             "&ecclrptc=",WBPFCNTR,"#";'>":
                             "</td>":
                             "</tr>";
.
WDCERW99  RETURN
+
.------------------------------------------------------------
. Table of PCIW Service Details
.------------------------------------------------------------
WDSD0000  MATCH     "1",PTCNWSIN
          GOTO      WDSD9999 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      WDSD9999 IF NOT EQUAL
.
          CALL      WDSDHD00      * Output Table Heading
.
          PACK      KEY51,ECCLCLMI,ECCLTRID,ECCLRPTC,SP70
          CALL      RSWBPCG1                     * position in file
WDSD1000  CALL      RKWBPCG1                     * read next record
          BRANCH    OVRCD,WDSD9999               * end of file
.
          MATCH     ECCLCLMI,WBPGCLID            * same fund brand id ?
          GOTO      WDSD9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLTRID,WBPGTRID            * same account ref. id ?
          GOTO      WDSD9999 IF NOT EQUAL        * no - finished listing
.
          MATCH     ECCLRPTC,WBPGCNTR            * same fund ref. id ?
          GOTO      WDSD9999 IF NOT EQUAL        * no - finished listing
.
          CALL      WDSDRW00
.
          GOTO      WDSD1000
.
WDSD9999  RETURN
+ 
.------------------------------------------------------------
. PCIW Service Details (TABLE HEADING)
.------------------------------------------------------------
WDSDHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Service ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Assessment Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Benefit Paid&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Number of Patients Seen&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Error Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Error Text&nbsp;</td>":
                             "</tr>"
.
WDSDHD99  RETURN
+
.------------------------------------------------------------
. PCIW Service Details (Detail Row)
.------------------------------------------------------------
WDSDRW00  WRITE     HTMLFILE;"<tr><td>",WBPGSVID,"</td>";
          WRITE     HTMLFILE;"<td>",WBPGASCD,"</td>";
.
          MOVE      ZERO,FORM5P2C
          RJUSTIFY  WBPGBENP
          UNPACK    WBPGBENP,DIM5,DIM2
          PACK      DIM8,DIM5,DOT,DIM2
          MOVE      DIM8,FORM5P2C
          WRITE     HTMLFILE;"<td>",FORM5P2C,"</td>";
.
          MOVE      ZERO,FORM5P2C
          RJUSTIFY  WBPGCHGA
          UNPACK    WBPGCHGA,DIM5,DIM2
          PACK      DIM8,DIM5,DOT,DIM2
          MOVE      DIM8,FORM5P2C
          WRITE     HTMLFILE;"<td>",FORM5P2C,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBPGITMN,"</td>";
          WRITE     HTMLFILE;"<td>",WBPGNMPT,"</td>";
          WRITE     HTMLFILE;"<td>",WBPGCODE,"</td>";
          WRITE     HTMLFILE;"<td>",WBPGTEXT,"</td>":
                             "</tr>";
.
WDSDRW99  RETURN
+
.---------------------------------------------------------------
. PCIW Report <tran id>.properties tag
.---------------------------------------------------------------
PCRHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      PCRHED99
          ENDIF
.
          MATCH    SP70,ECCLTRID
          GOTO     PCRHED99 IF EQUAL
          GOTO     PCRHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      PCRHED99
          ENDIF
.
PCRHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      PCRHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      PCRHED10
.
PCRHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. PCIW Report <tran id>_pciw tag
.---------------------------------------------------------------
PCRJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      PCRJSN99
          ENDIF
.
          MATCH    SP70,ECCLTRID
          GOTO     PCRJSN99 IF EQUAL
          GOTO     PCRJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLTRID,CMDLINE
          APPEND    PCIWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PCIWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      PCRJSN99
          ENDIF
.
PCRJSN10  READ      PCIWFILE,SEQ;PCIWLINE
          GOTO      PCRJSN99 IF OVER
.
          WRITE     HTMLFILE;PCIWLINE
.
          GOTO      PCRJSN10
.
PCRJSN99  CLOSE     PCIWFILE
.
          RETURN
+
.---------------------------------------------------------------
. PCIW Report <tran id>_pciw_response  tag
.---------------------------------------------------------------
PCRRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      PCRRSP99
          ENDIF
.
          MATCH    SP70,ECCLTRID 
          GOTO     PCRRSP99 IF EQUAL
          GOTO     PCRRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLTRID,CMDLINE
          APPEND    PCIRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PCIRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      PCRRSP99
          ENDIF
.
PCRRSP10  READ      PCIRFILE,SEQ;PCIRLINE
          GOTO      PCRRSP99 IF OVER
.
          WRITE     HTMLFILE;PCIRLINE
.
          GOTO      PCRRSP10
.
PCRRSP99  CLOSE     PCIRFILE
.
          RETURN
+
.---------------------------------------------------------------
. PCIW Report <tran id>_pciw_errors  tag
.---------------------------------------------------------------
PCRERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      PCRERR99
          ENDIF
.
          MATCH    SP70,ECCLTRID
          GOTO     PCRERR99 IF EQUAL
          GOTO     PCRERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLTRID,CMDLINE
          APPEND    PCIELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PCIEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      PCRERR99
          ENDIF
.
PCRERR10  READ      PCIEFILE,SEQ;PCIELINE
          GOTO      PCRERR99 IF OVER
.
          WRITE     HTMLFILE;PCIELINE
.
          GOTO      PCRERR10
.
PCRERR99  CLOSE     PCIEFILE
.
          RETURN
+
.---------------------------------------------------------------
. PCIW <tran id>.properties tag
.---------------------------------------------------------------
PCIHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      PCIHED99
          ENDIF
.
          MATCH    SP70,WBPITRID
          GOTO     PCIHED99 IF EQUAL
          GOTO     PCIHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBPITRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      PCIHED99
          ENDIF
.
PCIHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      PCIHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      PCIHED10
.
PCIHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. PCIW <tran id>_pciw  tag
.---------------------------------------------------------------
PCIJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      PCIJSN99
          ENDIF
.
          MATCH    SP70,WBPITRID
          GOTO     PCIJSN99 IF EQUAL
          GOTO     PCIJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBPITRID,CMDLINE
          APPEND    PCIWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PCIWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      PCIJSN99
          ENDIF
.
PCIJSN10  READ      PCIWFILE,SEQ;PCIWLINE
          GOTO      PCIJSN99 IF OVER
.
          WRITE     HTMLFILE;PCIWLINE
.
          GOTO      PCIJSN10
.
PCIJSN99  CLOSE     PCIWFILE
.
          RETURN
+
.---------------------------------------------------------------
. PCIW <tran id>_pciw_response  tag
.---------------------------------------------------------------
PCIRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      PCIRSP99
          ENDIF
.
          MATCH    SP70,WBPITRID
          GOTO     PCIRSP99 IF EQUAL
          GOTO     PCIRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBPITRID,CMDLINE
          APPEND    PCIRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PCIRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      PCIRSP99
          ENDIF
.
PCIRSP10  READ      PCIRFILE,SEQ;PCIRLINE
          GOTO      PCIRSP99 IF OVER
.
          WRITE     HTMLFILE;PCIRLINE
.
          GOTO      PCIRSP10
.
PCIRSP99  CLOSE     PCIRFILE
.
          RETURN
+
.---------------------------------------------------------------
. PCIW <tran id>_pciw_errors  tag
.---------------------------------------------------------------
PCIERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      PCIERR99
          ENDIF
.
          MATCH    SP70,WBPITRID
          GOTO     PCIERR99 IF EQUAL
          GOTO     PCIERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/pciw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBPITRID,CMDLINE
          APPEND    PCIELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PCIEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      PCIERR99
          ENDIF
.
PCIERR10  READ      PCIEFILE,SEQ;PCIELINE
          GOTO      PCIERR99 IF OVER
.
          WRITE     HTMLFILE;PCIELINE
.
          GOTO      PCIERR10
.
PCIERR99  CLOSE     PCIEFILE
.
          RETURN
+
.------------------------------------------------------------
. WebServices PCIW Claim Enquiries
.------------------------------------------------------------
WPCE0000  MATCH     "1",PTCNWSIN
          GOTO      WPCE9200 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      WPCE9200 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      WPCE6000 IF EQUAL

          MATCH     "V",UPDATTYP
          GOTO      WPCE1000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      WPCE2000 IF EQUAL
.
          MATCH     "D",UPDATTYP
          GOTO      WPCE3000 IF EQUAL
.
          MATCH     "P",UPDATTYP
          GOTO      WPCE4000 IF EQUAL
.
          MATCH     "S",UPDATTYP
          GOTO      WPCE5000 IF EQUAL
.
          GOTO      WPCE9000
.
WPCE1000  CALL      MINP0000
          GOTO      WPCE9999
.
WPCE2000  CALL      RSUP0000
          GOTO      WPCE9999
.
WPCE3000  CALL      WDEP0000
          GOTO      WPCE9999
.
WPCE4000  
.         CALL      OTPC0000
          GOTO      WPCE9999
.
WPCE5000
.         CALL      RSET0000
          GOTO      WPCE9999
.
WPCE6000  MOVE      TEMPLATE,FORM3
          IF        THREE=FORM3
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,WPCE9100
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDPMPX21
            BRANCH    OVRCD,WPCE9100
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE                   * CALCAGE uses PBDATE
.
            CALL      PATLN000
            CALL      PATFLD00                * Use standard Patient Folder sub
.
            MOVE      URNUMBER,FILTURNO
.           MOVE      UNIQNUMB,FILTADMN
.
            IF        ALLHFLAG=0
              COMPARE   ONE,IBCNMHOS
              IF        @EQUAL
                MOVE      TWO,VIEWTYPE
                MOVE      ZERO,EXDTBLNK
              ELSE
                MOVE      ZERO,VIEWTYPE
                MOVE      ONE,EXDTBLNK
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
.
          MOVE      "WebServices PCIW Claim Enquiry",WEBTITLE
.
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,WPCE9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      WPCE9999
.
WPCE9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCE9999
.
WPCE9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCE9999
.
WPCE9200  MOVE      "Not using WebServices PCIW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WPCE9999
.
WPCE9999  RETURN
+
.*****************************************************************************
.*                          MINP0000                                         *
.*****************************************************************************
.
.         First, get the last PCIW History record for this invoice
.
MINP0000  PACK      KEY27,MAVINVCE,Z70
          CALL      RSWBPCA1                     * position on last history rec
MINP0010  CALL      RPWBPCA1                     * read previous record
          BRANCH    OVRCD,MINP3000               * eof - finished
.
          MATCH     MAVINVCE,WBPHINVN            * same invoice still ?
          GOTO      MINP3000 IF NOT EQUAL        * no - finished
.
          MATCH     MAVMODUL,WBPHMODL
          GOTO      MINP0010 IF NOT EQUAL
.
.         Read emrectaf
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          BRANCH    OVRCD,MINP3000
.
.         The last PCIW history record has been found for the invoice, so
.         write a new record, defaulting some of the values from the read
.         record.
.
          MOVE      MAVBATCH,WBPHBATN
          MOVE      MAVINVCE,WBPHINVN
          MOVE      MAVMODUL,WBPHMODL
.
MINP1000  CALL      IBACLOCK                     * get current date/time
          PACK      WBPHDATE,CCC,CYY,CMM,CDD
          REP       " 0",WBPHDATE
          MOVE      CTIMEIS,WBPHTIME
          REP       " 0",WBPHTIME
.
          MOVE      " 1",WBPHTYPE
          MOVE      WBSEUID,WBPHOPER
          PACK      WBPHSPAR,SP70,SP70
.
          PACK      KEY27,WBPHINVN,WBPHDATE,WBPHTIME,WBPHTYPE,WBPHMODL,SP70
          CALL      RAWBPCA1
          IF        OVRCD = 0
            GOTO      MINP1000
          ENDIF
.
          CALL      WRWBPCA1                     * write EDI History record
.
.         If the record has a status of
.         "Error (SA validation)"
.         then update the status to "Closed", as the claim cannot go any
.         further (unless resubmitted after closing).
.
          IF        WBPIFLAG = 3
            PACK      KEY30,WBPIHOSP,WBPIFLAG,WBPIMODL,WBPIUNIQ,WBPIINVN:
                            WBPIBATN,SP70
            CALL      RDWBPCI1                   * read selected record
            BRANCH    OVRCD,MINP3000             * shouldn't happen
.
            MOVE      SIX,WBPIFLAG              * update to "closed"

            CALL      IBACLOCK
            PACK      WBPICDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBPICDAT
            MOVE      CTIMEIS,WBPIUTIM
            MOVE      USERID,WBPIUUID
            CALL      UPWBPCI1
.
.           Also write an PCIW History record (webpcaaf) for the close
.
            MOVE      WBPIINVN,WBPHINVN
            MOVE      WBPIBATN,WBPHBATN
            MOVE      SIX,WBPHSTAT
            MOVE      " 1",WBPHTYPE
            MOVE      WBSEUID,WBPHOPER
            MOVE      WBPITRID,WBPHTRID
            PACK      WBPHSPAR,SP70,SP70
.
MINP2000    CALL      IBACLOCK                   * get current time
            PACK      WBPHDATE,CCC,CYY,CMM,CDD
            REP       " 0",WBPHDATE
            MOVE      CTIMEIS,WBPHTIME
            REP       " 0",WBPHTIME
.
            PACK      KEY27,WBPHINVN,WBPHDATE,WBPHTIME,WBPHTYPE,WBPHMODL,SP70
            CALL      RAWBPCA1
            IF        OVRCD = 1
              CALL      WRWBPCA1
            ELSE
              GOTO      MINP2000
            ENDIF
.
            GOTO      MINP9000
          ELSE
            GOTO      MINP9000
          ENDIF
.
MINP3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      MINP9100
.
MINP9000  MOVE      ZERO,EXIT
          GOTO      MINP9999
.
MINP9100  MOVE      ONE,EXIT
.
MINP9999  RETURN
+
.*****************************************************************************
.*                               RSUP0000                                    *
.*                  Process resubmission selection                           *
.*****************************************************************************
RSUP0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          BRANCH    OVRCD,RSUP7000
.
.         Check if the record has already been resubmitted
.
          MATCH     SP8,WBPINBAT                 * next batch blank ?
          IF        !@EQUAL
            GOTO      RSUP8000
          ENDIF
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBPIFLAG = 6 | WBPIFLAG = 3
.
            PACK      KEY27,WBPIINVN,Z70
            CALL      RSWBPCA1
RSUP2100    CALL      RPWBPCA1
            BRANCH    OVRCD,RSUP2500
.
            MATCH     WBPIINVN,WBPHINVN
            GOTO      RSUP2500 IF NOT EQUAL
.
            MATCH     WBPIMODL,WBPHMODL
            GOTO      RSUP2100 IF NOT EQUAL
.
            MATCH     WBPITRID,WBPHTRID
            GOTO      RSUP2100 IF NOT EQUAL
.
            COMPARE   THREE,WBPHSTAT
            GOTO      RSUP2100 IF NOT EQUAL
.
            MATCH     " 2",WBPHTYPE
            GOTO      RSUP2100 IF NOT EQUAL
.
            MATCH     "3002",WBPHEROR
            GOTO      RSUP2100 IF NOT EQUAL
.
            MOVE      ZERO,FORM8A
.
            CALL      IBACLOCK
.
            PACK      CURRDATE,CCC,CYY,CMM,CDD
            REP       " 0",CURRDATE
.
            DAYSEP    WBPHDATE,CURRDATE,FORM8A
.
            COMPARE   FORM8A,ONE
            GOTO      RSUP2500 IF EQUAL
            GOTO      RSUP2500 IF LESS
.
            GOTO      RSUP7500
.
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RSUP2500  MATCH     "1",WBPIMODL
          IF        @EQUAL
.
            PACK      KEY8,WBPIINVN,SP70
            CALL      RDINV1
            IF        OVRCD = 1
              GOTO      RSUP6000
            ENDIF
.
            CALL      GBAW0000                    * get outstanding inv. balance
.
          ELSE
.
            PACK      KEY8,WBPIINVN,SP70
            CALL      RDPRIN1
            IF        OVRCD = 1
              GOTO      RSUP6000
            ENDIF
.
            CALL      GBWP0000                    * get outstanding inv. balance
.
          ENDIF
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission (CAR 181439)
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSUP5000
          ENDIF
.
          PACK      KEY17,WBPIINVN,SP8,WBPIMODL,SP70
          CALL      RAWBPCI2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSUP4000
          ENDIF
.
          MOVE      ZERO,WBPIFLAG
          MOVE      SP70,WBPIBATN
          MOVE      MAVBATCH,WBPIPBAT
          MOVE      SP70,WBPINBAT
          MOVE      SP70,WBPITRID
          MOVE      ZERO,WBPIAMTC
          MOVE      SP70,WBPISTAT
          PACK      WBPISPAR,SP70,SP70
.
          PACK      KEY17,WBPIINVN,WBPIBATN,WBPIMODL,SP70
          CALL      RAWBPCI2
          IF        OVRCD = 1
            CALL      IBACLOCK
            PACK      WBPICDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBPICDAT
            MOVE      CTIMEIS,WBPICTIM
            MOVE      USERID,WBPICUID
            CALL      WRWBPCI1                   * write record
          ELSE
            GOTO      RSUP4000
          ENDIF
.
.         Update the selected record with the next batch no. of "00000000".
.         The record will either have a status of "closed" already, or
.         "SA Validation Error".  If it's the latter, then update the status to
.         "closed" as well"
.
.         PACK      KEY35,PRECHOSP,TEN9,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.         CALL      RDPRECT1
.         IF        OVRCD = 1
.    PACK      KEY35,PRECHOSP,SP1,THREE,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.           CALL      RDPRECT1
.           IF        OVRCD = 1
.             GOTO      RSUP3000
.           ELSE
.             MOVE      TEN9,PRECFLAG            * set status to closed
.           ENDIF
.         ENDIF
.
          PACK      KEY17,WBPIINVN,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          IF        OVRCD = 1
            CALL      RSUP3000                   * write record
          ELSE
            MOVE      SIX,WBPIFLAG            * set status to closed
          ENDIF
.
          MOVE      "00000000",WBPINBAT

          CALL      IBACLOCK
          PACK      WBPICDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBPICDAT
          MOVE      CTIMEIS,WBPICTIM
          MOVE      USERID,WBPICUID
          CALL      UPWBPCI2
.
          GOTO      RSUP9999
.
RSUP3000  CLEAR     WEBTITLE
          APPEND    "Error updating Invoice ",WEBTITLE
          APPEND    WBPIINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    WBPIINVN,WEBTITLE
          APPEND    " Module ",WEBTITLE
          APPEND    WBPIMODL,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUP9000
.
RSUP4000  MOVE      "Invoice already waiting for extraction.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUP9000
.
RSUP5000  MOVE      "Claim fully paid.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUP9000
.
RSUP6000  CLEAR     WEBTITLE
          APPEND    "Invoice ",WEBTITLE
          APPEND    WBPIINVN,WEBTITLE
          APPEND    " not found.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RSUP9000
.
RSUP7000  MOVE      "Claim not not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUP9000
.
RSUP7500  MOVE      "Error 3002. Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUP9000
.
RSUP8000  MOVE      "Invoice already resubmitted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSUP9000
.
RSUP9000  MOVE      ONE,EXIT
RSUP9999  RETURN
+
.*****************************************************************************
.*                          DFWP0000                                         *
.*****************************************************************************
.
DFWP0000  CALL      GBWP0000                     * get outstanding inv. balance
.
          MOVE      STATPC00,STATDESC
          LOAD      STATDESC,WBPIFLAG,STATPC01,STATPC02,STATPC03,STATPC04:
                                      STATPC05,STATPC06
.
DFWP9999  RETURN
+
.*****************************************************************************
.*                          GBWP0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on webpciaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBWP0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBPIINVN,KEY8
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      GBWP9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PRINGSTJ,FORM7P2O
          ENDIF
.
GBWP9999  RETURN
+
.*****************************************************************************
.*                               WDEP0000                                    *
.*                  Process delete records waiting                           *
.*****************************************************************************
WDEP0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBPCI2
          BRANCH    OVRCD,WDEP8000
.
          MOVE      WBPIINVN,TEMPINVN
          MOVE      WBPIBATN,TEMPBATN
          MOVE      WBPIUNIQ,TEMPADMN
          MOVE      WBPIURNO,TEMPURNO
          MOVE      WBPIMODL,TEMPMODL
          MOVE      WBPIPBAT,TEMPPBAT
          MOVE      WBPIHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      WDEP1000 IF EQUAL
          GOTO      WDEP1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,SP1,SIX,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDWBPCI1
          IF        OVRCD = 1
            GOTO      WDEP7000
          ELSE
            MOVE      SP70,WBPINBAT

            CALL      IBACLOCK
            PACK      WBPICDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBPICDAT
            MOVE      CTIMEIS,WBPICTIM
            MOVE      USERID,WBPICUID
            CALL      UPWBPCI1
          ENDIF
.
.         Delete the selected record
.
WDEP1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEWBPCI1
.
          GOTO      WDEP9999
.
WDEP7000  CLEAR     WEBTITLE
          APPEND    "Error updating previous claim ",WEBTITLE
          APPEND    WBPIINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    WBPIBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      WDEP9000
.
WDEP8000  MOVE      "Record cannot be deleted.",WEBTITLE
          CALL      WEBERR00
          GOTO      WDEP9000
.
WDEP9000  MOVE      ONE,EXIT
WDEP9999  RETURN
+
.------------------------------------------------------------
. WebServices PCIW Claim Enquiries tags
.------------------------------------------------------------
.
WBPC0000  BRANCH    FLDITMNO,WBPC0100,WBPC0200,WBPC0300,WBPC0400,WBPC0500:
                             WBPC0600,WBPC0700,WBPC0800,WBPC0900,WBPC1000:
                             WBPC1100,WBPC1200,WBPC1300,WBPC1400,WBPC1500:
                             WBPC1600,WBPC1700,WBPC1800,WBPC1900,WBPC2000:
                             WBPC2100,WBPC2200,WBPC2300,WBPC2400,WBPC2500:
                             WBPC2600,WBPC2700
.
          GOTO      WBPC9999
.
WBPC0100  CALL      WBHP0000
          GOTO      WBPC9999
.
WBPC0200  WRITE     HTMLFILE;IBCNMHOS;    * Multihospital Indicator
          GOTO      WBPC9999
.
WBPC0300  CALL      HOSPID00              * Hospital ID option field
          GOTO      WBPC9999
.
WBPC0400  CALL      SELHFN00              * Health Fund option field
          GOTO      WBPC9999
.
WBPC0500  WRITE     HTMLFILE;HLFDCLTY;
          GOTO      WBPC9999
.
WBPC0600  MOVE      CATCL,CATEGORY
          MOVE      HLTHFUND,CODE
          CALL      CODITM00
          GOTO      WBPC9999
.
WBPC0700  WRITE     HTMLFILE;EXCLWAIT;
          GOTO      WBPC9999
.
WBPC0800  WRITE     HTMLFILE;FILTURNO;
          GOTO      WBPC9999
.
WBPC0900  WRITE     HTMLFILE;FILTADMN;
          GOTO      WBPC9999
.
WBPC1000  WRITE     HTMLFILE;BATCHNUM;
          GOTO      WBPC9999
.
WBPC1100  WRITE     HTMLFILE;CLAIMSTA;
          GOTO      WBPC9999
.
WBPC1200  WRITE     HTMLFILE;INVNUMBR;
          GOTO      WBPC9999
.
WBPC1300  CALL      SELP0000
          GOTO      WBPC9999
.
WBPC1400  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      WBPC9999
.
WBPC1500  WRITE     HTMLFILE;EXDTBLNK;
          GOTO      WBPC9999
.
WBPC1600  WRITE     HTMLFILE;HLTHFUND;
          GOTO      WBPC9999
.
WBPC1700  CALL      PRVW0000
          GOTO      WBPC9999
.
WBPC1800  CALL      NXTW0000
          GOTO      WBPC9999
.
WBPC1900  CALL      BATTW000
          GOTO      WBPC9999
.
WBPC2000  CALL      PREWBT00
          GOTO      WBPC9999
.
WBPC2100  CALL      NEXWBT00
          GOTO      WBPC9999
.
WBPC2200
.         CALL      ECOT0000
          GOTO      WBPC9999
.
WBPC2300  WRITE     HTMLFILE;PROCSTAT;
          GOTO      WBPC9999
.
WBPC2400  CALL      WBPP0000
          GOTO      WBPC9999
.
WBPC2500  WRITE     HTMLFILE;EXCLCLOS;
          GOTO      WBPC9999
.
WBPC2600  CALL      WBHE0000
          GOTO      WBPC9999
.
WBPC2700  CALL      WBPE0000
          GOTO      WBPC9999
.
WBPC9999  RETURN
+
.----------------------------------------------------------------------
. Table of WebServices PCIW Claim Enquiries Private Practice Hosp Level
.----------------------------------------------------------------------
WBHP0000  MATCH     "1",PTCNWSIN
          GOTO      WBHP9999 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      WBHP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      WBHP9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      WBHP9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBPCB2
WBHP0500  CALL      RKWBPCB2
          BRANCH    OVRCD,WBHP2000
          MATCH     WBPBDTBC,LASTDATE
          GOTO      WBHP2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,WBPBBTHN,SP70
          CALL      RSWBPCI3
WBHP1000  CALL      RKWBPCI3
          BRANCH    OVRCD,WBHP0500
          MATCH     WBPBBTHN,WBPIBATN
          GOTO      WBHP0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",WBPIMODL
          GOTO      WBHP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBPIHOSP
              GOTO      WBHP1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBPIHOSP
                GOTO      WBHP1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      WBHP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      WBHP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   SIX,WBPIFLAG
            GOTO      WBHP1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        PRECFLAG=ZERO
.             GOTO      WBHP1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBPIURNO
            GOTO      WBHP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBPIUNIQ
            GOTO      WBHP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBPIBATN
            GOTO      WBHP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBPIFLG
            GOTO      WBHP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBPIINVN
            GOTO      WBHP1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,WBHP1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      ECSP1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      WBHP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBPIINVN,Z70
          CALL      RSWBPCA3
          CALL      RPWBPCA3
          IF        OVRCD=0
            MATCH     WBPIINVN,WBPHINVN
            IF        @EQUAL
              MATCH     " 1",WBPHTYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATPC00,STATDESC
          LOAD      STATDESC,WBPIFLAG,STATPC01,STATPC02,STATPC03,STATPC04:
                                      STATPC05,STATPC06
.
          CALL      RSBP0000
.
          CALL      GBWP0000
.
          MOVE      WBPIURNO,URNUMBER
.         MOVE      WBPIUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBPIINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBPIUNIQ,WBPIINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,WBHP1500
.
          MATCH     WBPIUNIQ,DPRDTUNQ
          GOTO      WBHP1500 IF NOT EQUAL
.
          MATCH     WBPIINVN,PRDTINVN
          GOTO      WBHP1500 IF NOT EQUAL
.
          GOTO      WBHP1600
.
WBHP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBHP1600  REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "5",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBPIURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBPIUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBPIBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBPIINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBPIMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBPIURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBPIBATN,"#",":
                             "#"",WBPIUNIQ,"#",":
                             "#"",WBPIINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBPIAMTC,"#",";
          ENDIF
.
          IF        WBPIFLAG=FIVE
.
            PACK      KEY46,WBPITRID,Z70
            CALL      RSWBPCE2
            CALL      RPWBPCE2
            IF        OVRCD=0
.
              MATCH     WBPITRID,WBPETRID
              IF        @EQUAL
                WRITE     HTMLFILE;"#"",STATDESC," ",WBPESTAT,"#",";
              ELSE
                WRITE     HTMLFILE;"#"",STATDESC,"#",";
              ENDIF
.
            ELSE
              WRITE     HTMLFILE;"#"",STATDESC,"#",";
            ENDIF
.
          ELSE
            WRITE     HTMLFILE;"#"",STATDESC,"#",";
          ENDIF
.
.         WRITE     HTMLFILE;"#"",STATDESC,"#",":
          WRITE     HTMLFILE;"#"",WBPIPBAT,"#",":
                             "#"",WBPINBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBPIBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBPINBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBPIFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBPIBATN,DIM8
          REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBPIBATN,"','",WBPIUNIQ,"','",WBPIURNO,"','",WBPIINVN,"','",WBPIMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WBHP1900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBPIBATN,"','",WBPIINVN,"','":
                             WBPIMODL,"','":
                             WBPIURNO,"','",WBPIUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          PACK      KEY17,WBPIINVN,WBPIBATN,WBPIMODL,SP70
          CALL      RDWBSDD2
          IF        OVRCD=1
            CALL      CLWEBSDD
          ENDIF
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
.           WRITE     HTMLFILE;"#"",WBSWTEXT,"#");"                       * 19
            WRITE     HTMLFILE;"#"",WBSWTEXT,"#",";                       * 19
.         ENDIF
.
          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBPIUDAT
          IF        !@EQUAL
            UNPACK    WBPIUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      WBHP1950
          ELSE
            MATCH     SP70,WBPICDAT
            IF        !@EQUAL
              UNPACK    WBPICDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      WBHP1950
            ELSE
              GOTO      WBHP1950
            ENDIF
          ENDIF

WBHP1950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBPIUUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBPIUUID,SP2,DIM11
            PACK      UIDTIMET,WBPIUTIM
            GOTO      WBHP1970
          ELSE
            MATCH     SP70,WBPICUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBPICUID,SP2,DIM11
              PACK      UIDTIMET,WBPICTIM
              GOTO      WBHP1970
            ELSE
              GOTO      WBHP1970
            ENDIF
          ENDIF

WBHP1970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"             * 20

          MOVE      ZERO,LOOPCNTR
.
          GOTO      WBHP1000
.
WBHP2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      WBHP9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSWBPCI3
WBHP3000  CALL      RKWBPCI3
          BRANCH    OVRCD,WBHP9000
          MATCH     SP70,WBPIBATN
          GOTO      WBHP9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",WBPIMODL
          GOTO      WBHP3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBPIHOSP
              GOTO      WBHP3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBPIHOSP
                GOTO      WBHP3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      WBHP3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      WBHP3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        WBPIFLAG=SIX
              GOTO      WBHP3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBPIFLAG=ZERO
              GOTO      WBHP3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBPIURNO
            GOTO      WBHP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBPIUNIQ
            GOTO      WBHP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBPIBATN
            GOTO      WBHP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBPIFLG
            GOTO      WBHP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBPIINVN
            GOTO      WBHP3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,WBHP1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      WBHP1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      WBHP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBPIINVN,Z70
          CALL      RSWBPCA3
          CALL      RPWBPCA3
          IF        OVRCD=0
            MATCH     WBPIINVN,WBPHINVN
            IF        @EQUAL
              MATCH     " 1",WBPHTYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATPC00,STATDESC
          LOAD      STATDESC,WBPIFLAG,STATPC01,STATPC02,STATPC03,STATPC04:
                                      STATPC05,STATPC06
.
          CALL      RSBP0000
.
          CALL      GBWP0000
.
          MOVE      WBPIURNO,URNUMBER
.         MOVE      WBPIUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBPIINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBPIUNIQ,WBPIINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,WBHP3500
.
          MATCH     WBPIUNIQ,DPRDTUNQ
          GOTO      WBHP3500 IF NOT EQUAL
.
          MATCH     WBPIINVN,PRDTINVN
          GOTO      WBHP3500 IF NOT EQUAL
.
          GOTO      WBHP3600
.
WBHP3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBHP3600  REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "7",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBPIURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBPIUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBPIBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBPIINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBPIMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBPIURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBPIBATN,"#",":
                             "#"",WBPIUNIQ,"#",":
                             "#"",WBPIINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBPIAMTC,"#",";
          ENDIF
.
          IF        WBPIFLAG=FIVE
.
            PACK      KEY46,WBPITRID,Z70
            CALL      RSWBPCE2
            CALL      RPWBPCE2
            IF        OVRCD=0
.
              MATCH     WBPITRID,WBPETRID
              IF        @EQUAL
                WRITE     HTMLFILE;"#"",STATDESC," ",WBPESTAT,"#",";
              ELSE
                WRITE     HTMLFILE;"#"",STATDESC,"#",";
              ENDIF
.
            ELSE
              WRITE     HTMLFILE;"#"",STATDESC,"#",";
            ENDIF
.
          ELSE
            WRITE     HTMLFILE;"#"",STATDESC,"#",";
          ENDIF
.
.         WRITE     HTMLFILE;"#"",STATDESC,"#",":
          WRITE     HTMLFILE;"#"",WBPIPBAT,"#",":
                             "#"",WBPINBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBPIBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBPINBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBPIFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBPIBATN,DIM8
          REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBPIBATN,"','",WBPIUNIQ,"','",WBPIURNO,"','",WBPIINVN,"','",WBPIMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WBHP8900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBPIBATN,"','",WBPIINVN,"','":
                             WBPIMODL,"','":
                             WBPIURNO,"','",WBPIUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          PACK      KEY17,WBPIINVN,WBPIBATN,WBPIMODL,SP70
          CALL      RDWBSDD2
          IF        OVRCD=1
            CALL      CLWEBSDD
          ENDIF
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
.           WRITE     HTMLFILE;"#"",WBSWTEXT,"#");"                      * 19
            WRITE     HTMLFILE;"#"",WBSWTEXT,"#",";                      * 19
.         ENDIF

          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBPIUDAT
          IF        !@EQUAL
            UNPACK    WBPIUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      WBHP8950
          ELSE
            MATCH     SP70,WBPICDAT
            IF        !@EQUAL
              UNPACK    WBPICDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      WBHP8950
            ELSE
              GOTO      WBHP8950
            ENDIF
          ENDIF

WBHP8950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBPIUUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBPIUUID,SP2,DIM11
            PACK      UIDTIMET,WBPIUTIM
            GOTO      WBHP8970
          ELSE
            MATCH     SP70,WBPICUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBPICUID,SP2,DIM11
              PACK      UIDTIMET,WBPICTIM
              GOTO      WBHP8970
            ELSE
              GOTO      WBHP8970
            ENDIF
          ENDIF

WBHP8970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          MOVE      ZERO,LOOPCNTR
.
          GOTO      WBHP3000
.
WBHP9000
WBHP9999  RETURN
+
PRVW0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          REP       " +",HLTHFUND
          REP       " +",HLFDCLTY
          REP       " +",BATCHNUM
          REP       " +",INVNUMBR
          REP       " +",CLAIMSTA
          REP       " +",HOSPCODE
          REP       " +",URNUMBER
          REP       " +",UNIQNUMB
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&viewtype=",VIEWTYPE:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&allhflag=",ALLHFLAG:
                             "&hlthfund=",HLTHFUND:
                             "&exclwait=",EXCLWAIT:
                             "&exdtblnk=",EXDTBLNK:
                             "&hlfdclty=",HLFDCLTY:
                             "&batchnum=",BATCHNUM:
                             "&invnumbr=",INVNUMBR:
                             "&claimsta=",CLAIMSTA:
                             "&hospcode=",HOSPCODE:
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&exclclos=",EXCLCLOS;
.
          REP       "+ ",HLTHFUND
          REP       "+ ",HLFDCLTY
          REP       "+ ",BATCHNUM
          REP       "+ ",INVNUMBR
          REP       "+ ",CLAIMSTA
          REP       "+ ",HOSPCODE
          REP       "+ ",URNUMBER
          REP       "+ ",UNIQNUMB
.
PRVW9999  RETURN
+
NXTW0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
.
          REP       " +",HLTHFUND
          REP       " +",HLFDCLTY
          REP       " +",BATCHNUM
          REP       " +",INVNUMBR
          REP       " +",CLAIMSTA
          REP       " +",HOSPCODE
          REP       " +",URNUMBER
          REP       " +",UNIQNUMB
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&viewtype=",VIEWTYPE:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&allhflag=",ALLHFLAG:
                             "&hlthfund=",HLTHFUND:
                             "&exclwait=",EXCLWAIT:
                             "&exdtblnk=",EXDTBLNK:
                             "&hlfdclty=",HLFDCLTY:
                             "&batchnum=",BATCHNUM:
                             "&invnumbr=",INVNUMBR:
                             "&claimsta=",CLAIMSTA:
                             "&hospcode=",HOSPCODE:
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&exclclos=",EXCLCLOS;
.
          REP       "+ ",HLTHFUND
          REP       "+ ",HLFDCLTY
          REP       "+ ",BATCHNUM
          REP       "+ ",INVNUMBR
          REP       "+ ",CLAIMSTA
          REP       "+ ",HOSPCODE
          REP       "+ ",URNUMBER
          REP       "+ ",UNIQNUMB
.
NXTW9999  RETURN
.
.------------------------------------------------------------
. Table of Batch Numbers PCIW
.------------------------------------------------------------
BATTW000  MATCH     "1",PTCNWSIN
          GOTO      BATTW999 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      BATTW999 IF NOT EQUAL
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BATHP000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70
          CALL      RSWBPCB1                     * position in file
BATTW100  CALL      RPWBPCB1                     * read previous record
          BRANCH    OVRCD,BATTW999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BATTW100
          ENDIF
.
          CALL      BAPRW000      * Display Row
          BRANCH    EXIT,BATTW100
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BATTW100 IF NOT EQUAL
.
BATTW999  RETURN
+
.------------------------------------------------------------
. Batch Numbers by Code (TABLE HEADING) PCIW
.------------------------------------------------------------
BATHP000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Batch Number</td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=25%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Date</td>":
                             "<td class=HeadingCell width=15%>":
                             "Time</td>":
.                            "<td class=HeadingCell width=15%>":
.                            "Status</td>":
                             "</tr>"
.
BATHP999  RETURN
+
.------------------------------------------------------------
. Batch Numbers (TABLE ROW) PCIW
.------------------------------------------------------------
.
BAPRW000  MOVE      ZERO,EXIT
          PACK      BTSCHOSP,BTSCHOSP,SP70
.
          UNPACK    WBPBDTBC,CCENT,CYEAR,CMON,CDAY  * Batch Created Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    WBPBTMBC,DIM5,ANS,ANS,ANS
.
          MOVE      SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      BAPRW500 IF NOT EQUAL
.
          PACK      KEY24,WBPBBTHN,SP30         * get Hospital for given Batch
          CALL      RSWBPCI3
          CALL      RKWBPCI3
          IF        OVRCD=1
            MOVE      ONE,EXIT
            GOTO      BAPRW999
          ENDIF
.
          MATCH     WBPBBTHN,WBPIBATN
          IF        @EQUAL
            MOVE      WBPIHOSP,KEY3
            CALL      RDPTHSP1            * read Hospital name for visit
            IF        OVRCD=1
              MOVE      WBPIHOSP,HOSPNAME
            ELSE
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
.
            MATCH     SP70,BTSCHOSP
            IF        !@EQUAL&!@EOS
              MATCH     BTSCHOSP,WBPIHOSP
              IF        !@EQUAL
                MOVE      ONE,EXIT
                GOTO      BAPRW999
              ENDIF
            ENDIF
          ELSE
            MOVE      ONE,EXIT
            GOTO      BAPRW999
          ENDIF
.
BAPRW500  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",WBPBBTHN,"#")'>":
                             WBPBBTHN,"</a></td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",KEY11,"</td>":
                             "<td>",DIM5,"</td>":
                             "</tr>";
.
BAPRW999  RETURN
+
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREWBT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",F2:
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&btschosp=",BTSCHOSP;
.
PREWBT99  RETURN
+
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXWBT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"eclweb73.pbl":
                             "?reportno=",F2:
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&btschosp=",BTSCHOSP;
.
NEXWBT99  RETURN
+
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries PCIW Patient Level Priv Prac
.------------------------------------------------------------
WBPP0000  MATCH     "1",PTCNWSIN
          GOTO      WBPP9999 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      WBPP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.         MATCH     SP70,HOSPCODE
.         IF        @EQUAL
.           MOVE      WBSEHOSP,HOSPCODE
.         ENDIF
.
.         PACK      KEY35,HOSPCODE,FILTURNO,SP70
          PACK      KEY35,SP3,FILTURNO,SP70
          CALL      RSWBPCI5
WBPP1000  CALL      RKWBPCI5
          BRANCH    OVRCD,WBPP9999
          MATCH     FILTURNO,WBPIURNO
          GOTO      WBPP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",WBPIMODL
          GOTO      WBPP1000 IF NOT EQUAL
.
.         IF        IBCNMHOS=ONE
.           MATCH     SP70,HOSPCODE
.           IF        !@EQUAL & !@EOS
.             MATCH     HOSPCODE,WBPIMODL
.             GOTO      WBPP9999 IF NOT EQUAL
.           ELSE
.             IF        ALLHFLAG<>ONE
.               MATCH     WBSEHOSP,WBPIMODL
.               GOTO      WBPP9999 IF NOT EQUAL
.             ENDIF
.           ENDIF
..
.           MATCH     SP70,FILTURNO
.           IF        !@EQUAL & !@EOS
.             MATCH     FILTURNO,WBPIURNO
.             GOTO      WBPP1000 IF NOT EQUAL
.           ENDIF
.
.         ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBPIURNO
              GOTO      WBPP9999 IF NOT EQUAL
            ENDIF
.
.         ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      WBPP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      WBPP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBPIFLAG=ZERO
              GOTO      WBPP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBPIUNIQ
            GOTO      WBPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBPIBATN
            GOTO      WBPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBPIFLG
            GOTO      WBPP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBPIINVN
            GOTO      WBPP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,WBPIBATN,SP70
            CALL      RDWBPCB1
            BRANCH    OVRCD,WBPP1000
.
            MATCH     FRSTDATE,WBPBDTBC
            GOTO      WBPP1000 IF LESS
.
            MATCH     WBPBDTBC,LASTDATE
            GOTO      WBPP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBPIINVN,Z70
          CALL      RSWBPCA3
          CALL      RPWBPCA3
          IF        OVRCD=0
            MATCH     WBPIINVN,WBPHINVN
            IF        @EQUAL
              MATCH     " 1",WBPHTYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATPC00,STATDESC
          LOAD      STATDESC,WBPIFLAG,STATPC01,STATPC02,STATPC03,STATPC04:
                                      STATPC05,STATPC06
.
          CALL      RSBP0000
.
          CALL      GBWP0000
.
          MOVE      WBPIURNO,URNUMBER
.         MOVE      WBPIUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBPIINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBPIUNIQ,WBPIINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,WBPP1500
.
          MATCH     WBPIUNIQ,DPRDTUNQ
          GOTO      WBPP1500 IF NOT EQUAL
.
          MATCH     WBPIINVN,PRDTINVN
          GOTO      WBPP1500 IF NOT EQUAL
.
          GOTO      WBPP1600
.
WBPP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBPP1600  REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "7",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBPIURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBPIUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBPIBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBPIINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBPIMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBPIURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBPIBATN,"#",":
                             "#"",WBPIUNIQ,"#",":
                             "#"",WBPIINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBPIAMTC,"#",";
          ENDIF
.
          IF        WBPIFLAG=FIVE
.
            PACK      KEY46,WBPITRID,Z70
            CALL      RSWBPCE2
            CALL      RPWBPCE2
            IF        OVRCD=0
.
              MATCH     WBPITRID,WBPETRID
              IF        @EQUAL
                WRITE     HTMLFILE;"#"",STATDESC," ",WBPESTAT,"#",";
              ELSE
                WRITE     HTMLFILE;"#"",STATDESC,"#",";
              ENDIF
.
            ELSE
              WRITE     HTMLFILE;"#"",STATDESC,"#",";
            ENDIF
.
          ELSE
            WRITE     HTMLFILE;"#"",STATDESC,"#",";
          ENDIF
.
.         WRITE     HTMLFILE;"#"",STATDESC,"#",":
          WRITE     HTMLFILE;"#"",WBPIPBAT,"#",":
                             "#"",WBPINBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBPIBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBPINBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBPIBATN,DIM8
          REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
WBPIBATN,"','",WBPIUNIQ,"','",WBPIURNO,"','",WBPIINVN,"','",WBPIMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          PACK      KEY17,WBPIINVN,WBPIBATN,WBPIMODL,SP70
          CALL      RDWBSDD2
          IF        OVRCD=1
            CALL      CLWEBSDD
          ENDIF
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"",WBSWTEXT,"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      WBPP1000
.
WBPP9999  RETURN
+
.------------------------------------------------------------
. Table of WebServices PCIW Claim Enquiries Emergency
.------------------------------------------------------------
WBHE0000  MATCH     "1",PTCNWSIN
          GOTO      WBHE9999 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      WBHE9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      WBHE9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      WBHE9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBPCB2
WBHE0500  CALL      RKWBPCB2
          BRANCH    OVRCD,WBHE2000
          MATCH     WBPBDTBC,LASTDATE
          GOTO      WBHE2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,WBPBBTHN,SP70
          CALL      RSWBPCI3
WBHE1000  CALL      RKWBPCI3
          BRANCH    OVRCD,WBHE0500
          MATCH     WBPBBTHN,WBPIBATN
          GOTO      WBHE0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "1",WBPIMODL
          GOTO      WBHE1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBPIHOSP
              GOTO      WBHE1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBPIHOSP
                GOTO      WBHE1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      WBHE1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      WBHE1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   SIX,WBPIFLAG
            GOTO      WBHE1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        PRECFLAG=ZERO
.             GOTO      WBHE1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBPIURNO
            GOTO      WBHE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBPIUNIQ
            GOTO      WBHE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBPIBATN
            GOTO      WBHE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBPIFLG
            GOTO      WBHE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBPIINVN
            GOTO      WBHE1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,WBHE1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      WBHE1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      WBHE1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBPIINVN,Z70
          CALL      RSWBPCA3
          CALL      RPWBPCA3
          IF        OVRCD=0
            MATCH     WBPIINVN,WBPHINVN
            IF        @EQUAL
              MATCH     " 1",WBPHTYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATPC00,STATDESC
          LOAD      STATDESC,WBPIFLAG,STATPC01,STATPC02,STATPC03,STATPC04:
                                      STATPC05,STATPC06
.
          CALL      RSBW0000
.
          CALL      GBAW0000
.
          MOVE      WBPIURNO,URNUMBER
.         MOVE      WBPIUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,WBPIINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,WBPIUNIQ,WBPIINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,WBHE1500
.
.         MATCH     WBPIUNIQ,DPRDTUNQ
.         GOTO      WBHE1500 IF NOT EQUAL
.
.         MATCH     WBPIINVN,PRDTINVN
.         GOTO      WBHE1500 IF NOT EQUAL
.
.         GOTO      WBHE1600
.
WBHE1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBHE1600  REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "7",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBPIURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBPIUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBPIBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBPIINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBPIMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBPIURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBPIBATN,"#",":
                             "#"",WBPIUNIQ,"#",":
                             "#"",WBPIINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBPIAMTC,"#",";
          ENDIF
.
.
          IF        WBPIFLAG=FIVE
.
            PACK      KEY46,WBPITRID,Z70
            CALL      RSWBPCE2
            CALL      RPWBPCE2
            IF        OVRCD=0
.
              MATCH     WBPITRID,WBPETRID
              IF        @EQUAL
                WRITE     HTMLFILE;"#"",STATDESC," ",WBPESTAT,"#",";
              ELSE
                WRITE     HTMLFILE;"#"",STATDESC,"#",";
              ENDIF
.
            ELSE
              WRITE     HTMLFILE;"#"",STATDESC,"#",";
            ENDIF
.
          ELSE
            WRITE     HTMLFILE;"#"",STATDESC,"#",";
          ENDIF
.
.         WRITE     HTMLFILE;"#"",STATDESC,"#",":
          WRITE     HTMLFILE;"#"",WBPIPBAT,"#",":
                             "#"",WBPINBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBPIBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBPINBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBPIFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBPIBATN,DIM8
          REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBPIBATN,"','",WBPIUNIQ,"','",WBPIURNO,"','",WBPIINVN,"','",WBPIMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WBHE1900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBPIBATN,"','",WBPIINVN,"','":
                             WBPIMODL,"','":
                             WBPIURNO,"','",WBPIUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          PACK      KEY17,WBPIINVN,WBPIBATN,WBPIMODL,SP70
          CALL      RDWBSDD2
          IF        OVRCD=1
            CALL      CLWEBSDD
          ENDIF
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"",WBSWTEXT,"#");"                       * 19
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      WBHE1000
.
WBHE2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      WBHE9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSWBPCI3
WBHE3000  CALL      RKWBPCI3
          BRANCH    OVRCD,WBHE9000
          MATCH     SP70,WBPIBATN
          GOTO      WBHE9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "1",WBPIMODL
          GOTO      WBHE3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBPIHOSP
              GOTO      WBHE3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBPIHOSP
                GOTO      WBHE3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      WBHE3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      WBHE3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        WBPIFLAG=SIX
              GOTO      WBHE3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBPIFLAG=ZERO
              GOTO      WBHE3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBPIURNO
            GOTO      WBHE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBPIUNIQ
            GOTO      WBHE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBPIBATN
            GOTO      WBHE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBPIFLG
            GOTO      WBHE3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBPIINVN
            GOTO      WBHE3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,PRECBATN,SP70
.           CALL      RDPRIBH1
.           BRANCH    OVRCD,WBHE1000
.
.           MATCH     FRSTDATE,PRIBDTBC
.           GOTO      WBHE1000 IF LESS
.
.           MATCH     PRIBDTBC,LASTDATE
.           GOTO      WBHE1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBPIINVN,Z70
          CALL      RSWBPCA3
          CALL      RPWBPCA3
          IF        OVRCD=0
            MATCH     WBPIINVN,WBPHINVN
            IF        @EQUAL
              MATCH     " 1",WBPHTYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATPC00,STATDESC
          LOAD      STATDESC,WBPIFLAG,STATPC01,STATPC02,STATPC03,STATPC04:
                                      STATPC05,STATPC06
.
          CALL      RSBW0000
.
          CALL      GBAW0000
.
          MOVE      WBPIURNO,URNUMBER
.         MOVE      WBPIUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,WBPIINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,WBPIUNIQ,WBPIINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,WBHE3500
.
.         MATCH     WBPIUNIQ,DPRDTUNQ
.         GOTO      WBHE3500 IF NOT EQUAL
.
.         MATCH     WBPIINVN,PRDTINVN
.         GOTO      WBHE3500 IF NOT EQUAL
.
.         GOTO      WBHE3600
.
WBHE3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBHE3600  REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "7",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBPIURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBPIUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBPIBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBPIINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBPIMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBPIURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBPIBATN,"#",":
                             "#"",WBPIUNIQ,"#",":
                             "#"",WBPIINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBPIAMTC,"#",";
          ENDIF
.
          IF        WBPIFLAG=FIVE
.
            PACK      KEY46,WBPITRID,Z70
            CALL      RSWBPCE2
            CALL      RPWBPCE2
            IF        OVRCD=0
.
              MATCH     WBPITRID,WBPETRID
              IF        @EQUAL
                WRITE     HTMLFILE;"#"",STATDESC," ",WBPESTAT,"#",";
              ELSE
                WRITE     HTMLFILE;"#"",STATDESC,"#",";
              ENDIF
.
            ELSE
              WRITE     HTMLFILE;"#"",STATDESC,"#",";
            ENDIF
.
          ELSE
            WRITE     HTMLFILE;"#"",STATDESC,"#",";
          ENDIF
.
.         WRITE     HTMLFILE;"#"",STATDESC,"#",":
          WRITE     HTMLFILE;"#"",WBPIPBAT,"#",":
                             "#"",WBPINBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBPIBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBPINBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBPIFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBPIBATN,DIM8
          REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBPIBATN,"','",WBPIUNIQ,"','",WBPIURNO,"','",WBPIINVN,"','",WBPIMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WBHE8900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBPIBATN,"','",WBPIINVN,"','":
                             WBPIMODL,"','":
                             WBPIURNO,"','",WBPIUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          PACK      KEY17,WBPIINVN,WBPIBATN,WBPIMODL,SP70
          CALL      RDWBSDD2
          IF        OVRCD=1
            CALL      CLWEBSDD
          ENDIF
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"",WBSWTEXT,"#");"                       * 19
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      WBHE3000
.
WBHE9000
WBHE9999  RETURN
+
.------------------------------------------------------------------
. Table of WebServices Claim Enquiries PCIW Patient Level Emergency
.------------------------------------------------------------------
WBPE0000  MATCH     "1",PTCNWSIN
          GOTO      WBPE9999 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      WBPE9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     SP70,HOSPCODE
          IF        @EQUAL
            MOVE      WBSEHOSP,HOSPCODE
          ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSWBPCI5
WBPE1000  CALL      RKWBPCI5
          BRANCH    OVRCD,WBPE9999
          MATCH     FILTURNO,WBPIURNO
          GOTO      WBPE9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "1",WBPIMODL
          GOTO      WBPE1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBPIHOSP
              GOTO      WBPE9999 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBPIHOSP
                GOTO      WBPE9999 IF NOT EQUAL
              ENDIF
            ENDIF
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBPIURNO
              GOTO      WBPE1000 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBPIURNO
              GOTO      WBPE9999 IF NOT EQUAL
            ENDIF
.
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,PRECEETP
.           GOTO      WBPE1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,PRECHFND
.           GOTO      WBPE1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBPIFLAG=ZERO
              GOTO      WBPE1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBPIUNIQ
            GOTO      WBPE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBPIBATN
            GOTO      WBPE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBPIFLG
            GOTO      WBPE1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBPIINVN
            GOTO      WBPE1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,WBPIBATN,SP70
            CALL      RDWBPCB1
            BRANCH    OVRCD,WBPE1000
.
            MATCH     FRSTDATE,WBPBDTBC
            GOTO      WBPE1000 IF LESS
.
            MATCH     WBPBDTBC,LASTDATE
            GOTO      WBPE1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBPIINVN,Z70
          CALL      RSWBPCA3
          CALL      RPWBPCA3
          IF        OVRCD=0
            MATCH     WBPIINVN,WBPHINVN
            IF        @EQUAL
              MATCH     " 1",WBPHTYPE
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATPC00,STATDESC
          LOAD      STATDESC,WBPIFLAG,STATPC01,STATPC02,STATPC03,STATPC04:
                                      STATPC05,STATPC06
.
          CALL      RSBW0000
.
          CALL      GBAW0000
.
          MOVE      WBPIURNO,URNUMBER
.         MOVE      WBPIUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,WBPIINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,WBPIUNIQ,WBPIINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,WBPE1500
.
.         MATCH     WBPIUNIQ,DPRDTUNQ
.         GOTO      WBPE1500 IF NOT EQUAL
.
.         MATCH     WBPIINVN,PRDTINVN
.         GOTO      WBPE1500 IF NOT EQUAL
.
.         GOTO      WBPE1600
.
WBPE1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WBPE1600  REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "7",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBPIURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBPIUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBPIBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBPIINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBPIMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBPIURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBPIBATN,"#",":
                             "#"",WBPIUNIQ,"#",":
                             "#"",WBPIINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBPIAMTC,"#",";
          ENDIF
.
          IF        WBPIFLAG=FIVE        
.
            PACK      KEY46,WBPITRID,Z70
            CALL      RSWBPCE2
            CALL      RPWBPCE2
            IF        OVRCD=0
.
              MATCH     WBPITRID,WBPETRID
              IF        @EQUAL
                WRITE     HTMLFILE;"#"",STATDESC," ",WBPESTAT,"#",";
              ELSE
                WRITE     HTMLFILE;"#"",STATDESC,"#",";
              ENDIF
.
            ELSE
              WRITE     HTMLFILE;"#"",STATDESC,"#",";
            ENDIF
.
          ELSE
            WRITE     HTMLFILE;"#"",STATDESC,"#",";
          ENDIF
.
.         WRITE     HTMLFILE;"#"",STATDESC,"#",":
          WRITE     HTMLFILE;"#"",WBPIPBAT,"#",":
                             "#"",WBPINBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBPIBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBPINBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBPIFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBPIBATN,WBPIINVN,WBPIMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBPIBATN,DIM8
          REP       " +",WBPIURNO
          REP       " +",WBPIUNIQ
          REP       " +",WBPIBATN
          REP       " +",WBPIINVN
          REP       " +",WBPIMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
WBPIBATN,"','",WBPIUNIQ,"','",WBPIURNO,"','",WBPIINVN,"','",WBPIMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",WBPIURNO
          REP       "+ ",WBPIUNIQ
          REP       "+ ",WBPIBATN
          REP       "+ ",WBPIINVN
          REP       "+ ",WBPIMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          PACK      KEY17,WBPIINVN,WBPIBATN,WBPIMODL,SP70
          CALL      RDWBSDD2
          IF        OVRCD=1
            CALL      CLWEBSDD
          ENDIF
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (PRECFLAG=5 | PRECFLAG=7 | PRECFLAG=9 | PRECFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",PRECBATN,PRECINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"",WBSWTEXT,"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      WBPE1000
.
WBPE9999  RETURN
+
.*****************************************************************************
.*                          RSBW0000                                         *
.*****************************************************************************
RSBW0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,WBPINBAT                 * next batch blank ?
          GOTO      RSBW9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBPIFLAG <> 6 & WBPIFLAG <> 3
            GOTO      RSBW9000
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
          PACK      KEY8,WBPIINVN,SP70
          CALL      RDINV1
          BRANCH    OVRCD,RSBW9000
.
          CALL      GBAW0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PINVAMT > 0)
            GOTO      RSBW9000
          ENDIF
.
          PACK      KEY17,WBPIINVN,SP8,ONE,SP70
          CALL      RAWBPCI2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBW9000
          ENDIF
.
          GOTO      RSBW9999
.
RSBW9000  MOVE      ONE,RSUBINDI
RSBW9999  RETURN
+
.*****************************************************************************
.*                          RSBP0000                                         *
.*****************************************************************************
RSBP0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,WBPINBAT                 * next batch blank ?
          GOTO      RSBP9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBPIFLAG <> 6 & WBPIFLAG <> 3
            GOTO      RSBP9000
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
          PACK      KEY8,WBPIINVN,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,RSBP9000
.
          CALL      GBWP0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSBP9000
          ENDIF
.
          PACK      KEY17,WBPIINVN,SP8,TWO,SP70
          CALL      RAWBPCI2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSBP9000
          ENDIF
.
          GOTO      RSBP9999
.
RSBP9000  MOVE      ONE,RSUBINDI
RSBP9999  RETURN
+
.---------------------------------------------------------------
. SDDW <tran id>.properties tag
.---------------------------------------------------------------
SDDHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      SDDHED99
          ENDIF
.
          MATCH    SP70,WBSWTRID
          GOTO     SDDHED99 IF EQUAL
          GOTO     SDDHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/sddw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBSWTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      SDDHED99
          ENDIF
.
SDDHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      SDDHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      SDDHED10
.
SDDHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. SDDW <tran id>_sddw  tag
.---------------------------------------------------------------
SDDJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      SDDJSN99
          ENDIF
.
          MATCH    SP70,WBSWTRID
          GOTO     SDDJSN99 IF EQUAL
          GOTO     SDDJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/sddw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBSWTRID,CMDLINE
          APPEND    SDDWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SDDWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      SDDJSN99
          ENDIF
.
SDDJSN10  READ      SDDWFILE,SEQ;SDDWLINE
          GOTO      SDDJSN99 IF OVER
.
          WRITE     HTMLFILE;SDDWLINE
.
          GOTO      SDDJSN10
.
SDDJSN99  CLOSE     SDDWFILE
.
          RETURN
+
.---------------------------------------------------------------
. SDDW <tran id>_sddw_response  tag
.---------------------------------------------------------------
SDDRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      SDDRSP99
          ENDIF
.
          MATCH    SP70,WBSWTRID
          GOTO     SDDRSP99 IF EQUAL
          GOTO     SDDRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/sddw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBSWTRID,CMDLINE
          APPEND    SDDRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SDDRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      SDDRSP99
          ENDIF
.
SDDRSP10  READ      SDDRFILE,SEQ;SDDRLINE
          GOTO      SDDRSP99 IF OVER
.
          WRITE     HTMLFILE;SDDRLINE
.
          GOTO      SDDRSP10
.
SDDRSP99  CLOSE     SDDRFILE
.
          RETURN
+
.---------------------------------------------------------------
. SDDW <tran id>_sddw_errors  tag
.---------------------------------------------------------------
SDDERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      SDDERR99
          ENDIF
.
          MATCH    SP70,WBSWTRID
          GOTO     SDDERR99 IF EQUAL
          GOTO     SDDERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/sddw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBSWTRID,CMDLINE
          APPEND    SDDELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SDDEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      SDDERR99
          ENDIF
.
SDDERR10  READ      SDDEFILE,SEQ;SDDELINE
          GOTO      SDDERR99 IF OVER
.
          WRITE     HTMLFILE;SDDELINE
.
          GOTO      SDDERR10
.
SDDERR99  CLOSE     SDDEFILE
.
          RETURN
+
.--------------------------------------------------------------------
. WebServices Bulk Billing Claim Full Details        
.--------------------------------------------------------------------
WBBS0000  MATCH     "1",PTCNWSIN
          GOTO      WBBS9500 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      WBBS9500 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      WBBS5000 IF EQUAL
.
          MATCH     ANSC,UPDATTYP           * Close Eclipse claim
          GOTO      WBBS6000 IF EQUAL
.
          GOTO      WBBS9000
.
WBBS5000  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,WBBS9100
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,WBBS9100
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          CALL      PATFLD00                * Use standard Patient Folder sub
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBBBS2            * Get transaction details - outectaf
          BRANCH    OVRCD,WBBS9200
.
          CALL      CLWEBBRH
          IF        WBBSFLAG > 6
            CALL      WBBP0000          * Get payment details - outerhaf
          ENDIF
.
          PACK      KEY71,WBBSHOSP,SP70          * Read B2B Device Table
          CALL      RSWBB2B3
          CALL      RKWBB2B3
          IF        OVRCD=1
            MOVE      SP70,WBB2DPTH
          ELSE
            MATCH     WBBSHOSP,WBB2HOSP
            IF        !@EQUAL
              MOVE      SP70,WBB2DPTH
            ENDIF
          ENDIF
.
.-------- Emergency Module
          MATCH     "1",MAVMODUL
          GOTO      WBBS5200 IF NOT EQUAL
.
          CALL      BBWE0000            * Get OS Invoice balance from patinvrf
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDINV1
          BRANCH    OVRCD,WBBS9400
.
          PACK      KEY8,PINVADM,SP70
          CALL      RDEMVIS1
          BRANCH    OVRCD,WBBS9700
.
          GOTO      WBBS5500
.
.-------- Private Practice Module
WBBS5200  MATCH     "2",MAVMODUL
          GOTO      WBBS5300 IF NOT EQUAL
.
          CALL      BBWP0000            * Get OS Invoice balance from priinvof
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,WBBS9300
.
          PACK      KEY27,PRHDUNIQ,PRHRE001,PRHRE002,PRHRE003,SP70
          CALL      RDPRHR1
          BRANCH    OVRCD,WBBS9300
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,WBBS9400
.
          GOTO      WBBS5500
.
.-------- Outpatient Module
WBBS5300  MATCH     "3",MAVMODUL
          GOTO      WBBS9600 IF NOT EQUAL
.
          CALL      BBWE0000            * Get OS Invoice balance from patinvrf
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDINV1
          BRANCH    OVRCD,WBBS9400
.
          PACK      KEY8,PINVADM,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,WBBS9800
.
          COMPARE   TWO,PVITYPE         * Outpatient visit type
          GOTO      WBBS9800 IF NOT EQUAL
.
          MOVE      "out",OSTFILE
          MOVE      PVISITE,KEY6
          CALL      RDSITA1             * Get the file header for this site
.
          PACK      CFNAME WITH OSTFILE,FILBB1A1
          CALL      OPOTBB11
.
          MOVE      PVIBILL,KEY8
          CALL      RDBOKB1             * Get outbb1af.obacomp - claim code
          BRANCH    OVRCD,WBBS9810

          GOTO      WBBS5500
.
WBBS5500  CLEAR     WEBTITLE
          MOVE      "WebServices BBSW Full Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,WBBS9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS6000  PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBBBS2
          BRANCH    OVRCD,WBBS9200
.
          MOVE      EIGHT,WBBSFLAG             * Eclipse status = closed
          CALL      UPWBBBS2
.
.         Write a new history (webbbsaf) record
.
          MOVE      WBBSINVN,WBBAINVN
          MOVE      WBBSBATN,WBBABATN
          MOVE      EIGHT,WBBASTAT             * Status - Closed
          MOVE      " 3",WBBATYPE              * Type - Viewed
          MOVE      WBSEUID,WBBAOPER
          MOVE      WBBATRID,WBBATRID
          MOVE      SP70,WBBAEROR
          MOVE      SP70,WBBAEROT
          MOVE      SP70,WBBASPAR
          MOVE      WBBSMODL,WBBAMODL
          MOVE      WBBSTRID,WBBATRID
          MOVE      WBBSMSID,WBBAMSID
.
          CALL      IBACLOCK                     * get current date/time
          PACK      WBBADATE,CCC,CYY,CMM,CDD
          REP       " 0",WBBADATE
          MOVE      CTIMEIS,WBBATIME
          REP       " 0",WBBATIME
.
          PACK      KEY27,WBBAINVN,WBBADATE,WBBATIME,WBBATYPE,WBBAMODL,SP70
          CALL      RAWBBBA1
          IF        OVRCD = 1
            CALL      WRWBBBA1
          ENDIF
.
.         MOVE      SP70,TTYPEARG
.         MOVE      " 9",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      "10",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      " 4",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      " 5",TTYPEARG
.         CALL      DELETR00
.
.         CALL      DELECO00
.
          MOVE      ZERO,EXIT
          GOTO      WBBS9999
.
WBBS9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS9200  MOVE      "Can't find WebServices BBSW Claim details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS9300  MOVE      "Doctor Referral details has not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS9400  MOVE      "Can't Find Invoice Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS9500  MOVE      "Not using WebServices BBSW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS9600  MOVE      "Invalid Bulk Billing webPAS Module",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS9700  MOVE      "Emergency Visit has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS9800  MOVE      "Outpatient Visit has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS9810  MOVE      "OP Visit Compensation Eligibility Not Found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBS9999
.
WBBS9999  RETURN
+
.*****************************************************************************
.*                          BBWE0000                                         *
.*****************************************************************************
.
BBWE0000  CALL      GBWE0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBBSFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07,STATBB08
.
BBWE9999  RETURN
+
.*****************************************************************************
.*                          GBWE0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on webbbsaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GBWE0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBBSINVN,KEY8
          CALL      RDINV1
          IF        OVRCD = 1
            GOTO      GBWE9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR+PTINCRTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PTINGSTJ,FORM7P2O
          ENDIF
.
GBWE9999  RETURN
+
.*****************************************************************************
.*                          BBWP0000                                         *
.*****************************************************************************
.
BBWP0000  CALL      GWBP0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBBSFLAG,STATBB01,STATBB02,STATBB03,STATBB04:
                                      STATBB05,STATBB06,STATBB07,STATBB08
.
BBWP9999  RETURN
+
.*****************************************************************************
.*                          GWBP0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on webbbsaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GWBP0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBBSINVN,KEY8
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      GWBP9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PRINGSTJ,FORM7P2O
          ENDIF
.
GWBP9999  RETURN
+
.------------------------------------------------------------
. EDI History (TABLE HEADING)
.------------------------------------------------------------
WDIBD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Time</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Status</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Transaction Type</td>":
                             "<td class=HeadingCell width=10%>":
                             "Batch</td>":
                             "<td class=HeadingCell width=10%>":
                             "Reviewed By</td>":
                             "<td class=HeadingCell width=35%>":
                             "Error Code Description</td>":
                             "</tr>"
.
WDIBD999  RETURN
+
.----------------------------------------------------------------------
. Table of WebServices Bulk Billing Claim  Medical Event Details
.----------------------------------------------------------------------
WBEV0000  MATCH     "1",PTCNWSIN
          GOTO      WBEV9999 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      WBEV9999 IF NOT EQUAL
.
          CALL      WBEVHD00                     * Output Table Heading
.
          PACK      KEY35,ECCLCLID,ECCLRPTC,SP70
          CALL      RSWBBBE1                     * position in file outeadaf
WBEV1000  CALL      RKWBBBE1                     * read next record
          BRANCH    OVRCD,WBEV9999               * end of file
.
          PACK      WBBECLID,WBBECLID,SP70
.
          MATCH     ECCLCLID,WBBECLID            * same claim id ?
          GOTO      WBEV9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBBERPTC,WBBERPTC,SP70
.
          MATCH     ECCLRPTC,WBBERPTC            * same report counter ?
          GOTO      WBEV9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBBERKEY,WBBERKEY,SP70
.
          MATCH     ECCLRKEY,WBBERKEY            * same report retrieve key?
          GOTO      WBEV1000 IF NOT EQUAL        * no - finished listing
.
          CALL      WBEVRW00
.
          GOTO      WBEV1000
.
WBEV9999  RETURN
+
.------------------------------------------------------------
. Eclipse Bulk Billing Claim Medical Event Details (TABLE HEADING)
.------------------------------------------------------------
WBEVHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Event Date&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Event Id&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Status Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Status Text&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Member Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Member Ref&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Family Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Given Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Services&nbsp;</td>":
                             "</tr>"

WBEVHD99  RETURN
+
.------------------------------------------------------------
. Eclipse Bulk Billing Medical Event (Detail Row)
.------------------------------------------------------------
WBEVRW00  MOVE      ZERO,FORM1
.-------- MOVE      "Unknown",ASESDESC
.-------- MOVE      OTEHCFAC,ANS
.-------- REP       "A1R2W3C4",ANS
.-------- MOVE      ANS,FORM1
.------- -LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4
.
.         MOVE      ZERO,FORM1
.         MOVE      "No Change",MEDSDESC
.         MOVE      OTEHMECF,ANS
.         REP       "A1I2C3W4S5X6",ANS
.         MOVE      ANS,FORM1
.         LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
.                                  MEDSDES5,MEDSDES6
.
.-------- MOVE      ZERO,FORM2
.-------- MOVE      "UNKNOWN",PRCSDESC
.-------- MOVE      OTEHSTAT,FORM2
.-------- LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
.--------                          PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
.--------                          PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
.--------                          PRCSDE10,PRCSDE11
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBBEEVDT
          IF        !@EQUAL & !@EOS
            UNPACK    WBBEEVDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
.         MOVE      ZERO,FORM6P2
.         UNPACK    OTEHCLBP,DIM6,DIM2
.         PACK      DIM9,DIM6,DOT,DIM2
.         MOVE      DIM9,FORM6P2
.
.         MOVE      SP70,DIM30
.         IF        FORM6P2 = ZERO
.           MOVE      "<br>[No Payment Report]",DIM30
.         ENDIF
.
.         MOVE      ZERO,FORM6P2A
.         UNPACK    OTEHCLCA,DIM6,DIM2
.         PACK      DIM9,DIM6,DOT,DIM2
.         MOVE      DIM9,FORM6P2A
.
.         MOVE      SP70,DIM11
.         MATCH     SP70,OTEHSDAT
.         IF        !@EQUAL & !@EOS
.           UNPACK    OTEHSDAT,CCENT,CYEAR,CMON,CDAY
.           MOVE      CMON,F2
.           LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.           PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
.         ENDIF
.
          MOVE      WBBEPTST,DIM100
.
          WRITE     HTMLFILE;"<td valign=top>",DIM11,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBBEEVID,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBBEPTSC,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",DIM100,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBBEPTMN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBBEPTMR,"</td>";
.         WRITE     HTMLFILE;"<td valign=top>",WBBEPTMR,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBBEPTFN,"</td>";
.         WRITE     HTMLFILE;"<td valign=top>",WBBEPTGN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBBEPTGN,"</td>";
.
.-------- Service Details
.
          REP       "##~",WBBECLID
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=09":
                             "&template=005":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&mavmodul=",MAVMODUL:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclclid=",WBBECLID:
                             "&ecclrptc=",WBBERPTC:
                             "&ecclevtc=",WBBEMEVC:
                             "&ecclrkey=",WBBERKEY,"#";'>":
                             "</td>":
                             "</tr>";
.
          REP       "~##",WBBECLID
.
WBEVRW99  RETURN
+
.----------------------------------------------------------------------
. Table of WebServices Bulk Billing Services Details
.----------------------------------------------------------------------
WBSD0000  MATCH     "1",PTCNWSIN
          GOTO      WBSD9999 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      WBSD9999 IF NOT EQUAL
.
          CALL      WBSDHD00                     * Output Table Heading
.
          PACK      KEY37,ECCLCLID,ECCLRPTC,ECCLEVTC,SP70
          CALL      RSWBBBF1                     * position in file outeadaf
WBSD1000  CALL      RKWBBBF1                     * read next record
          BRANCH    OVRCD,WBSD9999               * end of file
.
          PACK      WBBFCLID,WBBFCLID,SP70
.
          MATCH     ECCLCLID,WBBFCLID            * same claim id ?
          GOTO      WBSD9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBBFRPTC,WBBFRPTC,SP70
.
          MATCH     ECCLRPTC,WBBFRPTC            * same report counter ?
          GOTO      WBSD9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBBFMEVC,WBBFMEVC,SP70
.
          MATCH     ECCLEVTC,WBBFMEVC            * same report counter ?
          GOTO      WBSD9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBBFRKEY,WBBFRKEY,SP70
.
          MATCH     ECCLRKEY,WBBFRKEY            * same report retrieve key?
          GOTO      WBSD1000 IF NOT EQUAL        * no - finished listing
.
          CALL      WBSDRW00
.
          GOTO      WBSD1000
.
WBSD9999  RETURN
+
.------------------------------------------------------------
. WebServices Bulk Billing Claim Service Details (TABLE HEADING)
.------------------------------------------------------------
WBSDHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Service Id&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Assessment Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Number Of Patients&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Provider Number&nbsp;</td>":
                             "</tr>"
.
WBSDHD99  RETURN
+
.------------------------------------------------------------
. WebServices Bulk Billing Service Details (Detail Row)
.------------------------------------------------------------
WBSDRW00  MOVE      ZERO,FORM7P2
          RJUSTIFY  WBBFBEPD
          UNPACK    WBBFBEPD,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
.
          MOVE      ZERO,FORM7P2A
          RJUSTIFY  WBBFCHAM
          UNPACK    WBBFCHAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2A
.
          MOVE      SP70,HCEMDESC
.
          MATCH     SP70,WBBFASSC
          IF        !@EQUAL & !@EOS
            PACK      KEY3,WBBFASSC,SP70
            CALL      RDHCEMS1
            IF        OVRCD=ONE
              MOVE      "No Description in hicemsaf",HCEMDESC
              PACK      HCEMDESC,HCEMDESC,SP70
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                             "<td valign=top>",WBBFSVID,"</td>":
                             "<td valign=top>",WBBFASSC," - ",HCEMDESC,"</td>":
                             "<td valign=top>",FORM7P2,"</td>":
                             "<td valign=top>",FORM7P2A,"</td>":
                             "<td valign=top>",WBBFITMN,"</td>":
                             "<td valign=top>",WBBFNOFP,"</td>":
                             "<td valign=top>",WBBFPROV,"</td>":
                             "</tr>";
.
WBSDRW99  RETURN
+
.---------------------------------------------------------------
. BBSW BPRW <tran id>.properties tag
.---------------------------------------------------------------
BPRHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      BPRHED99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     BPRHED99 IF EQUAL
          GOTO     BPRHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bprw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      BPRHED99
          ENDIF
.
BPRHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      BPRHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      BPRHED10
.
BPRHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. BBSW BPRW <tran id>_bprw  tag
.---------------------------------------------------------------
BPRJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      BPRJSN99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     BPRJSN99 IF EQUAL
          GOTO     BPRJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bprw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    BPRWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      BPRWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      BPRJSN99
          ENDIF
.
BPRJSN10  READ      BPRWFILE,SEQ;BPRWLINE
          GOTO      BPRJSN99 IF OVER
.
          WRITE     HTMLFILE;BPRWLINE
.
          GOTO      BPRJSN10
.
BPRJSN99  CLOSE     BPRWFILE
.
          RETURN
+
.---------------------------------------------------------------
. BBSW BPRW <tran id>_bprw_response  tag
.---------------------------------------------------------------
BPRRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      BPRRSP99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     BPRRSP99 IF EQUAL
          GOTO     BPRRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bprw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    BPRRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      BPRRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      BPRRSP99
          ENDIF
.
BPRRSP10  READ      BPRRFILE,SEQ;BPRRLINE
          GOTO      BPRRSP99 IF OVER
.
          WRITE     HTMLFILE;BPRRLINE
.
          GOTO      BPRRSP10
.
BPRRSP99  CLOSE     BPRRFILE
.
          RETURN
+
.---------------------------------------------------------------
. BBSW BPRW <tran id>_bprw_errors  tag
.---------------------------------------------------------------
BPRERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      BPRERR99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     BPRERR99 IF EQUAL
          GOTO     BPRERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bprw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    BPRELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      BPREFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      BPRERR99
          ENDIF
.
BPRERR10  READ      BPREFILE,SEQ;BPRELINE
          GOTO      BPRERR99 IF OVER
.
          WRITE     HTMLFILE;BPRELINE
.
          GOTO      BPRERR10
.
BPRERR99  CLOSE     BPREFILE
.
          RETURN
+
.---------------------------------------------------------------
. BBSW <tran id>.properties tag
.---------------------------------------------------------------
BBSHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      BBSHED99
          ENDIF
.
          MATCH    SP70,WBBSTRID
          GOTO     BBSHED99 IF EQUAL
          GOTO     BBSHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bbsw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBBSTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      BBSHED99
          ENDIF
.
BBSHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      BBSHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      BBSHED10
.
BBSHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. BBSW <tran id>_bbsw  tag
.---------------------------------------------------------------
BBSJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      BBSJSN99
          ENDIF
.
          MATCH    SP70,WBBSTRID
          GOTO     BBSJSN99 IF EQUAL
          GOTO     BBSJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bbsw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBBSTRID,CMDLINE
          APPEND    BBSWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      BBSWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      BBSJSN99
          ENDIF
.
BBSJSN10  READ      BBSWFILE,SEQ;BBSWLINE
          GOTO      BBSJSN99 IF OVER
.
          WRITE     HTMLFILE;BBSWLINE
.
          GOTO      BBSJSN10
.
BBSJSN99  CLOSE     BBSWFILE
.
          RETURN
+
.---------------------------------------------------------------
. BBSW <tran id>_bbsw_response  tag
.---------------------------------------------------------------
BBSRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      BBSRSP99
          ENDIF
.
          MATCH    SP70,WBBSTRID
          GOTO     BBSRSP99 IF EQUAL
          GOTO     BBSRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bbsw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBBSTRID,CMDLINE
          APPEND    BBSRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      BBSRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      BBSRSP99
          ENDIF
.
BBSRSP10  READ      BBSRFILE,SEQ;BBSRLINE
          GOTO      BBSRSP99 IF OVER
.
          WRITE     HTMLFILE;BBSRLINE
.
          GOTO      BBSRSP10
.
BBSRSP99  CLOSE     BBSRFILE
.
          RETURN
+
.---------------------------------------------------------------
. BBSW <tran id>_bbsw_errors  tag
.---------------------------------------------------------------
BBSERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      BBSERR99
          ENDIF
.
          MATCH    SP70,WBBSTRID
          GOTO     BBSERR99 IF EQUAL
          GOTO     BBSERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/bbsw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBBSTRID,CMDLINE
          APPEND    BBSELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      BBSEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      BBSERR99
          ENDIF
.
BBSERR10  READ      BBSEFILE,SEQ;BBSELINE
          GOTO      BBSERR99 IF OVER
.
          WRITE     HTMLFILE;BBSELINE
.
          GOTO      BBSERR10
.
BBSERR99  CLOSE     BBSEFILE
.
          RETURN
+
.------------------------------------------------------------
. WebServices BBSW Claim Enquiries
.------------------------------------------------------------
WBBQ0000  MATCH     "1",PTCNWSIN
          GOTO      WBBQ9200 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      WBBQ9200 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      WBBQ6000 IF EQUAL

          MATCH     "V",UPDATTYP
          GOTO      WBBQ1000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      WBBQ2000 IF EQUAL
.
          MATCH     "D",UPDATTYP
          GOTO      WBBQ3000 IF EQUAL
.
          MATCH     "P",UPDATTYP
          GOTO      WBBQ4000 IF EQUAL
.
          MATCH     "S",UPDATTYP
          GOTO      WBBQ5000 IF EQUAL
.
          GOTO      WBBQ9000
.
WBBQ1000  CALL      MABB0000          * Mark as Viewed
          GOTO      WBBQ9999
.
WBBQ2000  CALL      RBEB0000          * Resubmit
          GOTO      WBBQ9999
.
WBBQ3000  CALL      WDBB0000          * Delete waiting
          GOTO      WBBQ9999
.
WBBQ4000
.         CALL      OTPC0000
          GOTO      WBBQ9999
.
WBBQ5000
.         CALL      RSET0000
          GOTO      WBBQ9999
.
WBBQ6000  MOVE      TEMPLATE,FORM3
          IF        THREE=FORM3
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,WBBQ9100
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDPMPX21
            BRANCH    OVRCD,WBBQ9100
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE                   * CALCAGE uses PBDATE
.
            CALL      PATLN000
            CALL      PATFLD00                * Use standard Patient Folder sub
.
            MOVE      URNUMBER,FILTURNO
.           MOVE      UNIQNUMB,FILTADMN
.
            IF        ALLHFLAG=0
              COMPARE   ONE,IBCNMHOS
              IF        @EQUAL
                MOVE      TWO,VIEWTYPE
                MOVE      ZERO,EXDTBLNK
              ELSE
                MOVE      ZERO,VIEWTYPE
                MOVE      ONE,EXDTBLNK
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
.
          MOVE      "WebServices BBSW Claim Enquiry",WEBTITLE
.
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,WBBQ9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      WBBQ9999
.
WBBQ9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBQ9999
.
WBBQ9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBQ9999
.
WBBQ9200  MOVE      "Not using WebServices BBSW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBBQ9999
.
WBBQ9999  RETURN
+
.*****************************************************************************
.* WebServices Bulk Billing - Marked As Viewed                               *
.*****************************************************************************
.
.         First, get the last BBSW History record for this invoice
.
MABB0000  PACK      KEY27,MAVINVCE,Z70
          CALL      RSWBBBA1                     * position on last history rec
MABB0010  CALL      RPWBBBA1                     * read previous record
          BRANCH    OVRCD,MABB3000               * eof - finished
.
          MATCH     MAVINVCE,WBBAINVN            * same invoice still ?
          GOTO      MABB3000 IF NOT EQUAL        * no - finished
.
          MATCH     MAVMODUL,WBBAMODLL
          GOTO      MABB0010 IF NOT EQUAL
.
.         Read webbbsaf
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBBBS2
          BRANCH    OVRCD,MABB3000
.
.         The last EDI history record has been found for the invoice, so
.         write a new record, defaulting some of the values from the read
.         record.
.
          MOVE      MAVBATCH,WBBABATN
          MOVE      MAVINVCE,WBBAINVN
          MOVE      MAVMODUL,WBBAMODL
.
MABB1000  CALL      IBACLOCK                     * get current date/time
          PACK      WBBADATE,CCC,CYY,CMM,CDD
          REP       " 0",WBBADATE
          MOVE      CTIMEIS,WBBATIME
          REP       " 0",WBBATIME
.
          MOVE      " 3",WBBATYPE                * Type - Closed
          MOVE      WBSEUID,WBBAOPER
          MOVE      SP70,WBBASPAR
.
          PACK      KEY27,WBBAINVN,WBBADATE,WBBATIME,WBBATYPE,WBBAMODL,SP70
          CALL      RAWBBBA1
          IF        OVRCD = 0
            GOTO      MABB1000
          ENDIF
.
          CALL      WRWBBBA1                     * write EDI History record
.
.         If the record has a status of
.         "Error (SA validation)"
.         then update the status to "Closed", as the claim cannot go any
.         further (unless resubmitted after closing).
.
          IF        WBBSFLAG = 3
            PACK      KEY30,WBBSHOSP,WBBSFLAG,WBBSMODL,WBBSUNIQ,WBBSINVN:
                            WBBSBATN,SP70
            CALL      RDWBBBS1                   * read selected record
            BRANCH    OVRCD,MABB3000             * shouldn't happen
.
            MOVE      EIGHT,WBBSFLAG             * update to "closed"
            CALL      IBACLOCK
            PACK      WBBSUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBBSUDAT
            MOVE      CTIMEIS,WBBSUTIM
            MOVE      USERID,WBBSUUID
            CALL      UPWBBBS1
.
.           Also write an EDI History record (webbbaaf) for the close
.
            MOVE      WBBSINVN,WBBAINVN
            MOVE      WBBSBATN,WBBABATN
            MOVE      EIGHT,WBBASTAT            * Status - Closed
            MOVE      " 3",WBBATYPE             * Type - Viewed
            MOVE      WBSEUID,WBBAOPER
            MOVE      WBBSTRID,WBBATRID
            MOVE      SP70,WBBASPAR
.
MABB2000    CALL      IBACLOCK                   * get current time
            PACK      WBBADATE,CCC,CYY,CMM,CDD
            REP       " 0",WBBADATE
            MOVE      CTIMEIS,WBBATIME
            REP       " 0",WBBATIME
.
            PACK      KEY27,WBBAINVN,WBBADATE,WBBATIME,WBBATYPE,WBBAMODL,SP70
            CALL      RAWBBBA1
            IF        OVRCD = 1
              CALL      WRWBBBA1
            ELSE
              GOTO      MABB2000
            ENDIF
.
            GOTO      MABB9000
          ELSE
            GOTO      MABB9000
          ENDIF
.
MABB3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      MABB9100
.
MABB9000  MOVE      ZERO,EXIT
          GOTO      MABB9999
.
MABB9100  MOVE      ONE,EXIT
.
MABB9999  RETURN
+
.*****************************************************************************
.*                               RBEB0000                                    *
.* WebServices Bulk Billing - Process resubmission selection                 *
.*****************************************************************************
RBEB0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBBBS2
          BRANCH    OVRCD,RBEB7000
.
.         Check if the record has already been resubmitted
.
          MATCH     SP8,WBBSNBAT                 * next batch blank ?
          IF        !@EQUAL
            GOTO      RBEB8000
          ENDIF
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBBSFLAG = 8 | WBBSFLAG = 3
.
            PACK      KEY27,WBBSINVN,Z70
            CALL      RSWBBBA1
RBEB2100    CALL      RPWBBBA1
            BRANCH    OVRCD,RBEB2500
.
            MATCH     WBBSINVN,WBBAINVN
            GOTO      RBEB2500 IF NOT EQUAL
.
            MATCH     WBBSMODL,WBBAMODL
            GOTO      RBEB2100 IF NOT EQUAL
.
            MATCH     WBBSTRID,WBBATRID
            GOTO      RBEB2100 IF NOT EQUAL
.
            COMPARE   THREE,WBBASTAT           * Status - Error SA valdidation
            GOTO      RBEB2100 IF NOT EQUAL
.
            MATCH     " 4",WBBATYPE            * Type - Data Error response
            GOTO      RBEB2100 IF NOT EQUAL
.
            MATCH     "3002",WBBAEROR
            GOTO      RBEB2100 IF NOT EQUAL
.
            MOVE      ZERO,FORM8A
.
            CALL      IBACLOCK
.
            PACK      CURRDATE,CCC,CYY,CMM,CDD
            REP       " 0",CURRDATE
.
            DAYSEP    WBBADATE,CURRDATE,FORM8A
.
            COMPARE   FORM8A,ONE
            GOTO      RBEB2500 IF EQUAL
            GOTO      RBEB2500 IF LESS
.
            GOTO      RBEB7500
.
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RBEB2500  MATCH     "1",WBBSMODL
          IF        @EQUAL
.
            PACK      KEY8,WBBSINVN,SP70
            CALL      RDINV1
            IF        OVRCD = 1
              GOTO      RBEB6000
            ENDIF
.
            CALL      GBWE0000               * get outstanding inv. balance
.
          ELSE
.
            MATCH     "3",WBBSMODL
            IF        @EQUAL
.
              PACK      KEY8,WBBSINVN,SP70
              CALL      RDINV1
              IF        OVRCD = 1
                GOTO      RBEB6000
              ENDIF
.
              CALL      GBWE0000               * get outstanding inv. balance
.
            ELSE
.
              PACK      KEY8,WBBSINVN,SP70
              CALL      RDPRIN1
              IF        OVRCD = 1
                GOTO      RBEB6000
              ENDIF
.
              CALL      GWBP0000               * get outstanding inv. balance
            ENDIF
.
          ENDIF
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission (CAR 181439)
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RBEB5000
          ENDIF
.
          PACK      KEY17,WBBSINVN,SP8,WBBSMODL,SP70
          CALL      RAWBBBS2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RBEB4000
          ENDIF
.
          MOVE      ZERO,WBBSFLAG
          MOVE      SP70,WBBSBATN
          MOVE      MAVBATCH,WBBSPBAT
          MOVE      SP70,WBBSNBAT
.         MOVE      SP70,WBBSCCFL
          MOVE      SP70,WBBSTRID
          MOVE      ZERO,WBBSAMTC
.         MOVE      ZERO,WBBSAMFP
          MOVE      ZERO,WBBSAMTP
          MOVE      SP70,WBBSPDAT
          MOVE      SP70,WBBSSTAT
.         MOVE      SP70,WBBSFTID
          MOVE      SP70,WBBSMSID
          MOVE      SP70,WBBSSPAR
.
          PACK      KEY17,WBBSINVN,WBBSBATN,WBBSMODL,SP70
          CALL      RAWBBBS2
          IF        OVRCD = 1

            CALL      IBACLOCK
            PACK      WBBSCDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBBSCDAT
            MOVE      CTIMEIS,WBBSCTIM
            MOVE      USERID,WBBSCUID

            CALL      WRWBBBS1                   * write record
          ELSE
            GOTO      RBEB4000
          ENDIF
.
.         Update the selected record with the next batch no. of "00000000".
.         The record will either have a status of "closed" already, or
.         "SA Validation Error".  If it's the latter, then update the status to
.         "closed" as well"
.
.         PACK      KEY35,PRECHOSP,TEN9,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.         CALL      RDPRECT1
.         IF        OVRCD = 1
.    PACK      KEY35,PRECHOSP,SP1,THREE,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.           CALL      RDPRECT1
.           IF        OVRCD = 1
.             GOTO      RBEB3000
.           ELSE
.             MOVE      TEN9,PRECFLAG            * set status to closed
.           ENDIF
.         ENDIF
.
          PACK      KEY17,WBBSINVN,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBBBS2
          IF        OVRCD = 1
            CALL      RBEB3000                   * write record
          ELSE
            MOVE      EIGHT,WBBSFLAG             * set status to closed
          ENDIF
.
          MOVE      "00000000",WBBSNBAT
          CALL      UPWBBBS2
.
          GOTO      RBEB9999
.
RBEB3000  CLEAR     WEBTITLE
          APPEND    "Error updating Invoice ",WEBTITLE
          APPEND    WBBSINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    WBBSBATN,WEBTITLE
          APPEND    " Module ",WEBTITLE
          APPEND    WBBSMODL,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RBEB9000
.
RBEB4000  MOVE      "Invoice already waiting for extraction.",WEBTITLE
          CALL      WEBERR00
          GOTO      RBEB9000
.
RBEB5000  MOVE      "Claim fully paid.",WEBTITLE
          CALL      WEBERR00
          GOTO      RBEB9000
.
RBEB6000  CLEAR     WEBTITLE
          APPEND    "Invoice ",WEBTITLE
          APPEND    WBBSINVN,WEBTITLE
          APPEND    " not found.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RBEB9000
.
RBEB7000  MOVE      "Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RBEB9000
.
RBEB7500  MOVE      "Error 3002. Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RBEB9000
.
RBEB8000  MOVE      "Invoice already resubmitted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RBEB9000
.
RBEB9000  MOVE      ONE,EXIT
RBEB9999  RETURN
+
.------------------------------------------------------------
. Validate Batch Number BBSW
. INPUTS: BATCHNUM - Batch Number
.------------------------------------------------------------
VALBAB00  CALL      XMLHED00
          BRANCH    EXIT,VALBAB99
.
          MATCH     "1",PTCNWSIN
          GOTO      VALBAB91 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      VALBAB91 IF NOT EQUAL
.
          PACK      KEY24,BATCHNUM,SP70
          CALL      RSWBBBS3
          CALL      RKWBBBS3
          BRANCH    OVRCD,VALBAB90
.
          MATCH     WBBSBATN,BATCHNUM
          GOTO      VALBAB90 IF NOT EQUAL
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALBAB98
.
VALBAB90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Batch number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAB98
.
VALBAB91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Not using PCIW Module. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAB98
.
VALBAB98  CALL      XMLEND00
VALBAB99  RETURN
+
.------------------------------------------------------------
. Validate Unique/Admission Number BBSW
. INPUTS: UNIQNUMB - Batch Number
.------------------------------------------------------------
VALUNB00  CALL      XMLHED00
          BRANCH    EXIT,VALUNB99
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,VALUNB20
.
          GOTO      VALUNB50
.
VALUNB20  PACK      KEY36,UNIQNUMB,SP70
          CALL      RDSBOKA6
          CALL      RDKBOKA6
          BRANCH    OVRCD,VALUNB90
.
          MATCH     UNIQNUMB,DOBAOUTN
          GOTO      VALUNB90 IF NOT EQUAL
.
.         PACK      KEY8,UNIQNUMB,SP70
.         CALL      RDEMVIS1
.         BRANCH    OVRCD,VALUNB90
.
          GOTO      VALUNB50
.
.  Dummy ouput for valid Code
.
VALUNB50  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALUNB98
.
VALUNB90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Unique number / Admission Number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALUNB98
.
VALUNB98  CALL      XMLEND00
VALUNB99  RETURN
+
.------------------------------------------------------------
. Set Default Printer
.------------------------------------------------------------
SETDEF00  MOVE      PRGID,SAVPRGID
          MOVE      REPORTNO,SAVREPTN
.
          MOVE      SCHDPRNT,SELPRINT
          MOVE      SETDFPRG,PRGID
          MOVE      SETDFRPT,REPORTNO
          CALL      UPDFPT00
.
          MOVE      SAVPRGID,PRGID
          MOVE      SAVREPTN,REPORTNO
          RETURN
+
.------------------------------------------------------------
. WebServices DVAW Claim Enquiries
.------------------------------------------------------------
.
WBDQ0000  MATCH     "1",PTCNWSIN
          GOTO      WBDQ9200 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      WBDQ9200 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      WBDQ6000 IF EQUAL

          MATCH     "V",UPDATTYP
          GOTO      WBDQ1000 IF EQUAL
.
          MATCH     "R",UPDATTYP
          GOTO      WBDQ2000 IF EQUAL
.
          MATCH     "D",UPDATTYP
          GOTO      WBDQ3000 IF EQUAL
.
          MATCH     "P",UPDATTYP
          GOTO      WBDQ4000 IF EQUAL
.
          MATCH     "S",UPDATTYP
          GOTO      WBDQ5000 IF EQUAL
.
          GOTO      WBDQ9000
.
WBDQ1000  CALL      MADW0000          * Mark as Viewed
          GOTO      WBDQ9999
.
WBDQ2000  CALL      RBED0000          * Resubmit
          GOTO      WBDQ9999
.
WBDQ3000  CALL      WDDW0000          * Delete waiting
          GOTO      WBDQ9999
.
WBDQ4000
.         CALL      OTPC0000
          GOTO      WBDQ9999
.
WBDQ5000
.         CALL      RSET0000
          GOTO      WBDQ9999
.
WBDQ6000  MOVE      TEMPLATE,FORM3
          IF        THREE=FORM3
            PACK      KEY8,URNUMBER,SP70
            CALL      RDMAST1
            BRANCH    OVRCD,WBDQ9100
.
            PACK      KEY8,URNUMBER,SP70
            CALL      RDPMPX21
            BRANCH    OVRCD,WBDQ9100
.
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            CALL      CALCAGE                   * CALCAGE uses PBDATE
.
            CALL      PATLN000
            CALL      PATFLD00                * Use standard Patient Folder sub
.
            MOVE      URNUMBER,FILTURNO
.           MOVE      UNIQNUMB,FILTADMN
.
            IF        ALLHFLAG=0
              COMPARE   ONE,IBCNMHOS
              IF        @EQUAL
                MOVE      TWO,VIEWTYPE
                MOVE      ZERO,EXDTBLNK
              ELSE
                MOVE      ZERO,VIEWTYPE
                MOVE      ONE,EXDTBLNK
              ENDIF
            ENDIF
          ENDIF
.
          CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
.
          MOVE      "WebServices DVAW Claim Enquiry",WEBTITLE
.
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,WBDQ9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      WBDQ9999
.
WBDQ9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDQ9999
.
WBDQ9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDQ9999
.
WBDQ9200  MOVE      "Not using WebServices DVAW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDQ9999
.
WBDQ9999  RETURN
+
.*****************************************************************************
.*                               WDDW0000                                    *
.* Eclipse DVAW - Delete waiting claims                                      *
.*****************************************************************************
WDDW0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBDVW2
          BRANCH    OVRCD,WDDW8000
.
          MOVE      WBDWINVN,TEMPINVN
          MOVE      WBDWBATN,TEMPBATN
          MOVE      WBDWUNIQ,TEMPADMN
          MOVE      WBDWURNO,TEMPURNO
          MOVE      WBDWMODL,TEMPMODL
          MOVE      WBDWPBAT,TEMPPBAT
          MOVE      WBDWHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      WDDW1000 IF EQUAL
          GOTO      WDDW1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,SP1,EIGHT,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDWBDVW1
          IF        OVRCD = 1
            GOTO      WDDW7000
          ELSE
            MOVE      SP70,WBDWNBAT
            CALL      IBACLOCK
            PACK      WBDWUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBDWUDAT
            MOVE      CTIMEIS,WBDWUTIM
            MOVE      USERID,WBDWUUID
            CALL      UPWBDVW1
          ENDIF
.
.         Delete the selected record
.
WDDW1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEWBDVW1
.
          GOTO      WDDW9999
.
WDDW7000  CLEAR     WEBTITLE
          APPEND    "Error updating previous claim ",WEBTITLE
          APPEND    WBDWINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    WBDWBATN,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      WDDW9000
.
WDDW8000  MOVE      "Record cannot be deleted.",WEBTITLE
          CALL      WEBERR00
          GOTO      WDDW9000
.
WDDW9000  MOVE      ONE,EXIT
WDDW9999  RETURN
+
.*****************************************************************************
.*                               RBED0000                                    *
.* WebServices DVAW         - Process resubmission selection                 *
.*****************************************************************************
RBED0000  MOVE      ZERO,EXIT
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBDVW2
          BRANCH    OVRCD,RBED7000
.
.         Check if the record has already been resubmitted
.
          MATCH     SP8,WBDWNBAT                 * next batch blank ?
          IF        !@EQUAL
            GOTO      RBED8000
          ENDIF
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBDWFLAG = 8 | WBDWFLAG = 3
.
            PACK      KEY27,WBDWINVN,Z70
            CALL      RSWBDVA1
RBED2100    CALL      RPWBDVA1
            BRANCH    OVRCD,RBED2500
.
            MATCH     WBDWINVN,WBDAINVN
            GOTO      RBED2500 IF NOT EQUAL
.
            MATCH     WBDWMODL,WBDAMODL
            GOTO      RBED2100 IF NOT EQUAL
.
            MATCH     WBDWTRID,WBDATRID
            GOTO      RBED2100 IF NOT EQUAL
.
            COMPARE   THREE,WBDASTAT           * Status - Error SA valdidation
            GOTO      RBED2100 IF NOT EQUAL
.
            MATCH     " 4",WBDATYPE            * Type - Data Error response
            GOTO      RBED2100 IF NOT EQUAL
.
            MATCH     "3002",WBDAEROR
            GOTO      RBED2100 IF NOT EQUAL
.
            MOVE      ZERO,FORM8A
.
            CALL      IBACLOCK
.
            PACK      CURRDATE,CCC,CYY,CMM,CDD
            REP       " 0",CURRDATE
.
            DAYSEP    WBDADATE,CURRDATE,FORM8A
.
            COMPARE   FORM8A,ONE
            GOTO      RBED2500 IF EQUAL
            GOTO      RBED2500 IF LESS
.
            GOTO      RBED7500
.
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RBED2500  MATCH     "1",WBDWMODL
          IF        @EQUAL
.
            PACK      KEY8,WBDWINVN,SP70
            CALL      RDINV1
            IF        OVRCD = 1
              GOTO      RBED6000
            ENDIF
.
            CALL      GDWE0000               * get outstanding inv. balance
.
          ELSE
.
            MATCH     "3",WBDWMODL
            IF        @EQUAL
.
              PACK      KEY8,WBDWINVN,SP70
              CALL      RDINV1
              IF        OVRCD = 1
                GOTO      RBED6000
              ENDIF
.
              CALL      GDWE0000               * get outstanding inv. balance
.
            ELSE
.
              PACK      KEY8,WBDWINVN,SP70
              CALL      RDPRIN1
              IF        OVRCD = 1
                GOTO      RBED6000
              ENDIF
.
              CALL      GWDP0000               * get outstanding inv. balance
            ENDIF
.
          ENDIF
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission (CAR 181439)
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RBED5000
          ENDIF
.
          PACK      KEY17,WBDWINVN,SP8,WBDWMODL,SP70
          CALL      RAWBDVW2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RBED4000
          ENDIF
.
          MOVE      ZERO,WBDWFLAG
          MOVE      SP70,WBDWBATN
          MOVE      MAVBATCH,WBDWPBAT
          MOVE      SP70,WBDWNBAT
.         MOVE      SP70,WBDWCCFL
          MOVE      SP70,WBDWTRID
          MOVE      ZERO,WBDWAMTC
.         MOVE      ZERO,WBDWAMFP
          MOVE      ZERO,WBDWAMDP
          MOVE      ZERO,WBDWAMMP
          MOVE      SP70,WBDWPDAT
          MOVE      SP70,WBDWSTAT
.         MOVE      SP70,WBDWFTID
          MOVE      SP70,WBDWMSID
          MOVE      SP70,WBDWSPAR
.
          PACK      KEY17,WBDWINVN,WBDWBATN,WBDWMODL,SP70
          CALL      RAWBDVW2
          IF        OVRCD = 1

            CALL      IBACLOCK
            PACK      WBDWCDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBDWCDAT
            MOVE      CTIMEIS,WBDWCTIM
            MOVE      USERID,WBDWCUID

            CALL      WRWBDVW1                   * write record
          ELSE
            GOTO      RBED4000
          ENDIF
.
.         Update the selected record with the next batch no. of "00000000".
.         The record will either have a status of "closed" already, or
.         "SA Validation Error".  If it's the latter, then update the status to
.         "closed" as well"
.
.         PACK      KEY35,PRECHOSP,TEN9,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.         CALL      RDPRECT1
.         IF        OVRCD = 1
.    PACK      KEY35,PRECHOSP,SP1,THREE,PRECHFND,PRECUNIQ,PRECINVN,MAVBATCH,SP70
.           CALL      RDPRECT1
.           IF        OVRCD = 1
.             GOTO      RBED3000
.           ELSE
.             MOVE      TEN9,PRECFLAG            * set status to closed
.           ENDIF
.         ENDIF
.
          PACK      KEY17,WBDWINVN,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBDVW2
          IF        OVRCD = 1
            CALL      RBED3000                   * write record
          ELSE
            MOVE      EIGHT,WBDWFLAG             * set status to closed
          ENDIF
.
          MOVE      "00000000",WBDWNBAT
          CALL      UPWBDVW2
.
          GOTO      RBED9999
.
RBED3000  CLEAR     WEBTITLE
          APPEND    "Error updating Invoice ",WEBTITLE
          APPEND    WBDWINVN,WEBTITLE
          APPEND    " Batch ",WEBTITLE
          APPEND    WBDWBATN,WEBTITLE
          APPEND    " Module ",WEBTITLE
          APPEND    WBDWMODL,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RBED9000
.
RBED4000  MOVE      "Invoice already waiting for extraction.",WEBTITLE
          CALL      WEBERR00
          GOTO      RBED9000
.
RBED5000  MOVE      "Claim fully paid.",WEBTITLE
          CALL      WEBERR00
          GOTO      RBED9000
.
RBED6000  CLEAR     WEBTITLE
          APPEND    "Invoice ",WEBTITLE
          APPEND    WBDWINVN,WEBTITLE
          APPEND    " not found.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      RBED9000
.
RBED7000  MOVE      "Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RBED9000
.
RBED7500  MOVE      "Error 3002. Claim not available for resubmission.",WEBTITLE
          CALL      WEBERR00
          GOTO      RBED9000
.
RBED8000  MOVE      "Invoice already resubmitted.",WEBTITLE
          CALL      WEBERR00
          GOTO      RBED9000
.
RBED9000  MOVE      ONE,EXIT
RBED9999  RETURN
+
.*****************************************************************************
.*                          GWDP0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on webdvwaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GWDP0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBDWINVN,KEY8
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      GWDP9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PRINGSTJ,FORM7P2O
          ENDIF
.
GWDP9999  RETURN
+
.*****************************************************************************
.*                          GDWE0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on webdvwaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GDWE0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBDWINVN,KEY8
          CALL      RDINV1
          IF        OVRCD = 1
            GOTO      GDWE9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR+PTINCRTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PTINGSTJ,FORM7P2O
          ENDIF
.
GDWE9999  RETURN
+
.*****************************************************************************
.* WebServices DVAW         - Marked As Viewed                               *
.*****************************************************************************
.
.         First, get the last DVAW History record for this invoice
.
MADW0000  PACK      KEY27,MAVINVCE,Z70
          CALL      RSWBDVA1                     * position on last history rec
MADW0010  CALL      RPWBDVA1                     * read previous record
          BRANCH    OVRCD,MADW3000               * eof - finished
.
          MATCH     MAVINVCE,WBDAINVN            * same invoice still ?
          GOTO      MADW3000 IF NOT EQUAL        * no - finished
.
          MATCH     MAVMODUL,WBDAMODLL
          GOTO      MADW0010 IF NOT EQUAL
.
.         Read webdvwaf
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBDVW2
          BRANCH    OVRCD,MADW3000
.
.         The last EDI history record has been found for the invoice, so
.         write a new record, defaulting some of the values from the read
.         record.
.
          MOVE      MAVBATCH,WBDABATN
          MOVE      MAVINVCE,WBDAINVN
          MOVE      MAVMODUL,WBDAMODL
.
MADW1000  CALL      IBACLOCK                     * get current date/time
          PACK      WBDADATE,CCC,CYY,CMM,CDD
          REP       " 0",WBDADATE
          MOVE      CTIMEIS,WBDATIME
          REP       " 0",WBDATIME
.
          MOVE      " 3",WBDATYPE                * Type - Closed
          MOVE      WBSEUID,WBDAOPER
          MOVE      SP70,WBDASPAR
.
          PACK      KEY27,WBDAINVN,WBDADATE,WBDATIME,WBDATYPE,WBDAMODL,SP70
          CALL      RAWBDVA1
          IF        OVRCD = 0
            GOTO      MADW1000
          ENDIF
.
          CALL      WRWBDVA1                     * write EDI History record
.
.         If the record has a status of
.         "Error (SA validation)"
.         then update the status to "Closed", as the claim cannot go any
.         further (unless resubmitted after closing).
.
          IF        WBDWFLAG = 3
            PACK      KEY30,WBDWHOSP,WBDWFLAG,WBDWMODL,WBDWUNIQ,WBDWINVN:
                            WBDWBATN,SP70
            CALL      RDWBDVW1                   * read selected record
            BRANCH    OVRCD,MADW3000             * shouldn't happen
.
            MOVE      EIGHT,WBDWFLAG             * update to "closed"
            CALL      IBACLOCK
            PACK      WBDWUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBDWUDAT
            MOVE      CTIMEIS,WBDWUTIM
            MOVE      USERID,WBDWUUID
            CALL      UPWBDVW1
.
.           Also write an EDI History record (webdvaaf) for the close
.
            MOVE      WBDWINVN,WBDAINVN
            MOVE      WBDWBATN,WBDABATN
            MOVE      EIGHT,WBDASTAT            * Status - Closed
            MOVE      " 3",WBDATYPE             * Type - Viewed
            MOVE      WBSEUID,WBDAOPER
            MOVE      WBDWTRID,WBDATRID
            MOVE      SP70,WBDASPAR
.
MADW2000    CALL      IBACLOCK                   * get current time
            PACK      WBDADATE,CCC,CYY,CMM,CDD
            REP       " 0",WBDADATE
            MOVE      CTIMEIS,WBDATIME
            REP       " 0",WBDATIME
.
            PACK      KEY27,WBDAINVN,WBDADATE,WBDATIME,WBDATYPE,WBDAMODL,SP70
            CALL      RAWBDVA1
            IF        OVRCD = 1
              CALL      WRWBDVA1
            ELSE
              GOTO      MADW2000
            ENDIF
.
            GOTO      MADW9000
          ELSE
            GOTO      MADW9000
          ENDIF
.
MADW3000  MOVE      "Claim not yet extracted.",WEBTITLE
          CALL      WEBERR00
          GOTO      MADW9100
.
MADW9000  MOVE      ZERO,EXIT
          GOTO      MADW9999
.
MADW9100  MOVE      ONE,EXIT
.
MADW9999  RETURN
+
.*****************************************************************************
.* Eclipse DVAW - Close/Open Eclipse Tables to avoid I*H 255 open file limit *
.*****************************************************************************
DCOET000  MATCH    "1",PTCNWSIN
          IF        @EQUAL
             CLOSE     WEBECOA1
             CLOSE     WEBECOA2
             CLOSE     WEBETRA1
             CLOSE     WEBETRA4
.            CLOSE     WEBB2BA1
.            CLOSE     WEBB2BA2
             CLOSE     WEBB2BA3
.
            MATCH    "1",PTCNIMCW
            IF        @EQUAL
              CLOSE     WEBIMCA1
              CLOSE     WEBIMCA2
              CLOSE     WEBIMCA3
              CLOSE     WEBIMCA5
.             CLOSE     WEBIMCA6
              CLOSE     WEBIMAA1
.             CLOSE     WEBIMAA2
              CLOSE     WEBIMAA3
.             CLOSE     WEBIMDA1
              CLOSE     WEBIMDA2
              CLOSE     WEBIMEA1
              CLOSE     WEBIMFA1
              CLOSE     WEBIMGA1
              CLOSE     WEBIMHA1
              CLOSE     WEBIMBA1
              CLOSE     WEBIMBA2
            ENDIF
.
            MATCH    "1",PTCNIHCW
            IF        @EQUAL
              CLOSE     WEBIHCA1
              CLOSE     WEBIHCA2
              CLOSE     WEBIHCA3
              CLOSE     WEBIHCA4
              CLOSE     WEBIHCA5
.             CLOSE     WEBIHCA6
              CLOSE     WEBIHAA1
.             CLOSE     WEBIHAA2
              CLOSE     WEBIHAA3
.             CLOSE     WEBIHDA1
              CLOSE     WEBIHDA2
              CLOSE     WEBIHEA1
              CLOSE     WEBIHFA1
              CLOSE     WEBIHGA1
              CLOSE     WEBIHHA1
              CLOSE     WEBIHBA1
              CLOSE     WEBIHBA2
            ENDIF
.
            MATCH    "1",PTCNPCIW
            IF        @EQUAL
              CLOSE     WEBPCIA1
              CLOSE     WEBPCIA2
              CLOSE     WEBPCIA3
.             CLOSE     WEBPCIA4
              CLOSE     WEBPCIA5
.             CLOSE     WEBPCIA6
              CLOSE     WEBPCAA1
.             CLOSE     WEBPCAA2
              CLOSE     WEBPCAA3
              CLOSE     WEBPCBA1
              CLOSE     WEBPCBA2
              CLOSE     WEBPCEA1
              CLOSE     WEBPCEA2
              CLOSE     WEBPCFA1
              CLOSE     WEBPCGA1
.
              CLOSE     WEBSDDA2
            ENDIF
.
            MATCH    "1",PTCNBBSW
            IF        @EQUAL
              CLOSE     WEBBBSA1
              CLOSE     WEBBBSA2
              CLOSE     WEBBBSA3
              CLOSE     WEBBBSA5
              CLOSE     WEBBBSA6
.
              CLOSE     WEBBBAA1
              CLOSE     WEBBBAA2
              CLOSE     WEBBBAA3
.
              CLOSE     WEBBBBA1
              CLOSE     WEBBBBA2
.
              CLOSE     WEBBBDA1
              CLOSE     WEBBBDA2
.
              CLOSE     WEBBBEA1
              CLOSE     WEBBBEA2
.
              CLOSE     WEBBBFA1
              CLOSE     WEBBBFA2
.
              CLOSE     WEBBRHA4
.
              CLOSE     WEBBRDA2
.
            ENDIF
.
            MATCH    "1",PTCNDVAW
            IF        @EQUAL
              OPEN      WEBDVWA1,"webdvwaf"
              OPEN      WEBDVWA2,"webdvwaf"
              OPEN      WEBDVWA3,"webdvwaf"
              OPEN      WEBDVWA5,"webdvwaf"
.              OPEN      WEBDVWA6,"webdvwaf"
.
              OPEN      WEBDVAA1,"webdvaaf"
              OPEN      WEBDVAA2,"webdvaaf"
              OPEN      WEBDVAA3,"webdvaaf"
.
              OPEN      WEBDVBA1,"webdvbaf"
              OPEN      WEBDVBA2,"webdvbaf"
.
              OPEN      WEBDVDA1,"webdvdaf"
              OPEN      WEBDVDA2,"webdvdaf"
.
              OPEN      WEBDVEA1,"webdveaf"
              OPEN      WEBDVEA2,"webdveaf"
.
              OPEN      WEBDVFA1,"webdvfaf"
              OPEN      WEBDVFA2,"webdvfaf"
.
              OPEN      WEBDVHA4,"webdvhaf"
.
              OPEN      WEBDVIA2,"webdviaf"
.
            ENDIF
.
          ENDIF
.
DCOET999  RETURN
.*****************************************************************************
.* Eclipse DVAW - Open/Close Eclipse Tables to avoid I*H 255 open file limit *
.*****************************************************************************
DOCET000  MATCH    "1",PTCNWSIN
          IF        @EQUAL
             OPEN      WEBECOA1,"webecoaf"
             OPEN      WEBECOA2,"webecoaf"
             OPEN      WEBETRA1,"webetraf"
             OPEN      WEBETRA4,"webetraf"
.            OPEN      WEBB2BA1,"webb2baf"
.            OPEN      WEBB2BA2,"webb2baf"
             OPEN      WEBB2BA3,"webb2baf"
.
            MATCH    "1",PTCNIMCW
            IF        @EQUAL
              OPEN      WEBIMCA1,"webimcaf"
              OPEN      WEBIMCA2,"webimcaf"
              OPEN      WEBIMCA3,"webimcaf"
              OPEN      WEBIMCA5,"webimcaf"
.             OPEN      WEBIMCA6,"webimcaf"
              OPEN      WEBIMAA1,"webimaaf"
.             OPEN      WEBIMAA2,"webimaaf"
              OPEN      WEBIMAA3,"webimaaf"
.             OPEN      WEBIMDA1,"webimdaf"
              OPEN      WEBIMDA2,"webimdaf"
              OPEN      WEBIMEA1,"webimeaf"
              OPEN      WEBIMFA1,"webimfaf"
              OPEN      WEBIMGA1,"webimgaf"
              OPEN      WEBIMHA1,"webimhaf"
              OPEN      WEBIMBA1,"webimbaf"
              OPEN      WEBIMBA2,"webimbaf"
            ENDIF
.
            MATCH    "1",PTCNIHCW
            IF        @EQUAL
              OPEN      WEBIHCA1,"webihcaf"
              OPEN      WEBIHCA2,"webihcaf"
              OPEN      WEBIHCA3,"webihcaf"
              OPEN      WEBIHCA4,"webihcaf"
              OPEN      WEBIHCA5,"webihcaf"
.             OPEN      WEBIHCA6,"webihcaf"
              OPEN      WEBIHAA1,"webihaaf"
.             OPEN      WEBIHAA2,"webihaaf"
              OPEN      WEBIHAA3,"webihaaf"
.             OPEN      WEBIHDA1,"webihdaf"
              OPEN      WEBIHDA2,"webihdaf"
              OPEN      WEBIHEA1,"webiheaf"
              OPEN      WEBIHFA1,"webihfaf"
              OPEN      WEBIHGA1,"webihgaf"
              OPEN      WEBIHHA1,"webihhaf"
              OPEN      WEBIHBA1,"webihbaf"
              OPEN      WEBIHBA2,"webihbaf"
            ENDIF
.
            MATCH    "1",PTCNPCIW
            IF        @EQUAL
              OPEN      WEBPCIA1,"webpciaf"
              OPEN      WEBPCIA2,"webpciaf"
              OPEN      WEBPCIA3,"webpciaf"
.             OPEN      WEBPCIA4,"webpciaf"
              OPEN      WEBPCIA5,"webpciaf"
.             OPEN      WEBPCIA6,"webpciaf"
              OPEN      WEBPCAA1,"webpcaaf"
.             OPEN      WEBPCAA2,"webpcaaf"
              OPEN      WEBPCAA3,"webpcaaf"
              OPEN      WEBPCBA1,"webpcbaf"
              OPEN      WEBPCBA2,"webpcbaf"
              OPEN      WEBPCEA1,"webpceaf"
              OPEN      WEBPCEA2,"webpceaf"
              OPEN      WEBPCFA1,"webpcfaf"
              OPEN      WEBPCGA1,"webpcgaf"
.
              OPEN      WEBSDDA2,"websddaf"
            ENDIF
.
            MATCH    "1",PTCNBBSW
            IF        @EQUAL
              OPEN      WEBBBSA1,"webbbsaf"
              OPEN      WEBBBSA2,"webbbsaf"
              OPEN      WEBBBSA3,"webbbsaf"
              OPEN      WEBBBSA5,"webbbsaf"
              OPEN      WEBBBSA6,"webbbsaf"
.
              OPEN      WEBBBAA1,"webbbaaf"
              OPEN      WEBBBAA2,"webbbaaf"
              OPEN      WEBBBAA3,"webbbaaf"
.
              OPEN      WEBBBBA1,"webbbbaf"
              OPEN      WEBBBBA2,"webbbbaf"
.
              OPEN      WEBBBDA1,"webbbdaf"
              OPEN      WEBBBDA2,"webbbdaf"
.
              OPEN      WEBBBEA1,"webbbeaf"
              OPEN      WEBBBEA2,"webbbeaf"
.
              OPEN      WEBBBFA1,"webbbfaf"
              OPEN      WEBBBFA2,"webbbfaf"
.
              OPEN      WEBBRHA4,"webbrhaf"
.
              OPEN      WEBBRDA2,"webbrdaf"
.
            ENDIF
.
            MATCH    "1",PTCNDVAW
            IF        @EQUAL
              CLOSE     WEBDVWA1
              CLOSE     WEBDVWA2
              CLOSE     WEBDVWA3
              CLOSE     WEBDVWA5
.              CLOSE     WEBDVWA6
.
              CLOSE     WEBDVAA1
              CLOSE     WEBDVAA2
              CLOSE     WEBDVAA3
.
              CLOSE     WEBDVBA1
              CLOSE     WEBDVBA2
.
              CLOSE     WEBDVDA1
              CLOSE     WEBDVDA2
.
              CLOSE     WEBDVEA1
              CLOSE     WEBDVEA2
.
              CLOSE     WEBDVFA1
              CLOSE     WEBDVFA2
.
              CLOSE     WEBDVHA4
.
              CLOSE     WEBDVIA2
.
            ENDIF
.
          ENDIF

DOCET999  RETURN
+
.------------------------------------------------------------
. WebServices DVAW Claim Enquiries tags
.------------------------------------------------------------
WDQF0000  BRANCH    FLDITMNO,WDQF0100,WDQF0200,WDQF0300,WDQF0400,WDQF0500:
                             WDQF0600,WDQF0700,WDQF0800,WDQF0900,WDQF1000:
                             WDQF1100,WDQF1200,WDQF1300,WDQF1400,WDQF1500:
                             WDQF1600,WDQF1700,WDQF1800,WDQF1900,WDQF2000:
                             WDQF2100,WDQF2200,WDQF2300,WDQF2400,WDQF2500:
                             WDQF2600,WDQF2700,WDQF2800,WDQF2900
.
          GOTO      WDQF9999
.
WDQF0100  CALL      WDQP0000    * Private Practice - Hospital level enquiry
          GOTO      WDQF9999
.
WDQF0200  WRITE     HTMLFILE;IBCNMHOS;    * Multihospital Indicator
          GOTO      WDQF9999
.
WDQF0300  CALL      HOSPID00              * Hospital ID option field
          GOTO      WDQF9999
.
WDQF0400  CALL      SELHFN00              * Health Fund option field
          GOTO      WDQF9999
.
WDQF0500  WRITE     HTMLFILE;HLFDCLTY;
          GOTO      WDQF9999
.
WDQF0600  MOVE      CATCL,CATEGORY
          MOVE      HLTHFUND,CODE
          CALL      CODITM00
          GOTO      WDQF9999
.
WDQF0700  WRITE     HTMLFILE;EXCLWAIT;
          GOTO      WDQF9999
.
WDQF0800  WRITE     HTMLFILE;FILTURNO;
          GOTO      WDQF9999
.
WDQF0900  WRITE     HTMLFILE;FILTADMN;
          GOTO      WDQF9999
.
WDQF1000  WRITE     HTMLFILE;BATCHNUM;
          GOTO      WDQF9999
.
WDQF1100  WRITE     HTMLFILE;CLAIMSTA;
          GOTO      WDQF9999
.
WDQF1200  WRITE     HTMLFILE;INVNUMBR;
          GOTO      WDQF9999
.
WDQF1300  CALL      SELP0000    * Selects Day, Week or Month from Viewtype
          GOTO      WDQF9999
.
WDQF1400  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      WDQF9999
.
WDQF1500  WRITE     HTMLFILE;EXDTBLNK;
          GOTO      WDQF9999
.
WDQF1600  WRITE     HTMLFILE;HLTHFUND;
          GOTO      WDQF9999
.
WDQF1700  CALL      PRVE0000
          GOTO      WDQF9999
.
WDQF1800  CALL      NXTE0000
          GOTO      WDQF9999
.
WDQF1900  CALL      BATWD000    * Batch header code search
          GOTO      WDQF9999
.
WDQF2000  CALL      PREVBT00
          GOTO      WDQF9999
.
WDQF2100  CALL      NEXTBT00
          GOTO      WDQF9999
.
WDQF2200
.-------- CALL      ECOT0000
          GOTO      WDQF9999
.
WDQF2300  WRITE     HTMLFILE;PROCSTAT;
          GOTO      WDQF9999
.
WDQF2400  CALL      WDPL0000    * Private Practice - Patient level enquiry
          GOTO      WDQF9999
.
WDQF2500  WRITE     HTMLFILE;EXCLCLOS;
          GOTO      WDQF9999
.
WDQF2600
.---------CALL      ECSE0000    * Emergency Module - Hosp Level enquiry
          GOTO      WDQF9999
.
WDQF2700
.---------CALL      ECEP0000    * Emergency Module - Patient level enquiry
          GOTO      WDQF9999
.
WDQF2800  CALL      WDOH0000    * Outpatient Module - Hospital Level enquiry
          GOTO      WDQF9999
.
WDQF2900  CALL      WDOP0000    * Outpatient Module - Patient Level enquiry
          GOTO      WDQF9999
.
WDQF9999  RETURN
+
.------------------------------------------------------------
. Table of Batch Numbers DVAW
.------------------------------------------------------------
BATWD000  MATCH     "1",PTCNWSIN
          GOTO      BATWD999 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      BATWD999 IF NOT EQUAL
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BATDV000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70
          CALL      RSWBDVB1                     * position in file
BATWD100  CALL      RPWBDVB1                     * read previous record
          BRANCH    OVRCD,BATWD999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BATWD100
          ENDIF
.
          CALL      BADRW000      * Display Row
          BRANCH    EXIT,BATWD100
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BATWD100 IF NOT EQUAL
.
BATWD999  RETURN
+
.------------------------------------------------------------
. Batch Numbers by Code (TABLE HEADING) DVAW 
.------------------------------------------------------------
BATDV000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Batch Number</td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=25%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Date</td>":
                             "<td class=HeadingCell width=15%>":
                             "Time</td>":
.                            "<td class=HeadingCell width=15%>":
.                            "Status</td>":
                             "</tr>"
.
BATDV999  RETURN
+
.------------------------------------------------------------
. Batch Numbers (TABLE ROW) 
.------------------------------------------------------------
BADRW000  MOVE      ZERO,EXIT
          PACK      BTSCHOSP,BTSCHOSP,SP70
.
          UNPACK    WBDBDTBC,CCENT,CYEAR,CMON,CDAY  * Batch Created Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR

          UNPACK    WBDBTMBC,DIM5,ANS,ANS,ANS
.
          MOVE      SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      BADRW500 IF NOT EQUAL
.
          PACK      KEY24,WBDBBTHN,SP30         * get Hospital for given Batch
          CALL      RSWBDVW3
          CALL      RKWBDVW3
          IF        OVRCD=1
            MOVE      ONE,EXIT
            GOTO      BADRW999
          ENDIF
.
          MATCH     WBDBBTHN,WBDWBATN
          IF        @EQUAL
            MOVE      WBDWHOSP,KEY3
            CALL      RDPTHSP1            * read Hospital name for visit
            IF        OVRCD=1
              MOVE      WBDWHOSP,HOSPNAME
            ELSE
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
.
            MATCH     SP70,BTSCHOSP
            IF        !@EQUAL&!@EOS
              MATCH     BTSCHOSP,WBDWHOSP
              IF        !@EQUAL
                MOVE      ONE,EXIT
                GOTO      BADRW999
              ENDIF
            ENDIF
          ELSE
            MOVE      ONE,EXIT
            GOTO      BADRW999
          ENDIF
.
BADRW500  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",WBDBBTHN,"#")'>":
                             WBDBBTHN,"</a></td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",KEY11,"</td>":
                             "<td>",DIM5,"</td>":
                             "</tr>";
.
BADRW999  RETURN
+
.------------------------------------------------------------
. WebServices DVAW Outpatient - Patient Level Enquiries
.------------------------------------------------------------
WDOP0000  MATCH     "1",PTCNWSIN
          GOTO      WDOP9999 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      WDOP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.         MATCH     SP70,HOSPCODE
.         IF        @EQUAL
.           MOVE      WBSEHOSP,HOSPCODE
.         ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSWBDVW5
WDOP1000  CALL      RKWBDVW5
          BRANCH    OVRCD,WDOP9999
          MATCH     FILTURNO,WBDWURNO
          GOTO      WDOP9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "3",WBDWMODL
          GOTO      WDOP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBDWHOSP
              GOTO      WDOP9999 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBDWHOSP
                GOTO      WDOP9999 IF NOT EQUAL
              ENDIF
            ENDIF
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBDWURNO
              GOTO      WDOP1000 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     SP70,FILTURNO
            IF        !@EQUAL & !@EOS
              MATCH     FILTURNO,WBDWURNO
              GOTO      WDOP9999 IF NOT EQUAL
            ENDIF
.
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WDOP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WDOP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBDWFLAG=ZERO
              GOTO      WDOP1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBDWUNIQ
            GOTO      WDOP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBDWBATN
            GOTO      WDOP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBDWFLG
            GOTO      WDOP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBDWINVN
            GOTO      WDOP1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,WBDWBATN,SP70
            CALL      RDWBDVB1
            BRANCH    OVRCD,WDOP1000
.
            MATCH     FRSTDATE,WBDBDTBC
            GOTO      WDOP1000 IF LESS
.
            MATCH     WBDBDTBC,LASTDATE
            GOTO      WDOP1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBDWINVN,Z70
          CALL      RSWBDVA3
          CALL      RPWBDVA3
          IF        OVRCD=0
            MATCH     WBDWINVN,WBDAINVN
            IF        @EQUAL
              MATCH     " 3",WBDATYPE      *Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBDWFLAG,STATDW01,STATDW02,STATDW03,STATDW04:
                                      STATDW05,STATDW06,STATDW07,STATDW08
.
          CALL      RDWE0000          * Resubmission DVAW claims
.
          CALL      GVWE0000          * Get current invoice outstanding balance
.
          MOVE      WBDWURNO,URNUMBER
.         MOVE      WBDWUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,WBDWINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,WBDWUNIQ,WBDWINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,WDOP1500
.
.         MATCH     WBDWUNIQ,DPRDTUNQ
.         GOTO      WDOP1500 IF NOT EQUAL
.
.         MATCH     WBDWINVN,PRDTINVN
.         GOTO      WDOP1500 IF NOT EQUAL
.
.         GOTO      WDOP1600
.
WDOP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WDOP1600  REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "11",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBDWURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBDWUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBDWBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBDWINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBDWMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBDWURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBDWBATN,"#",":
                             "#"",WBDWUNIQ,"#",":
                             "#"",WBDWINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBDWAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBDWPBAT,"#",":
                             "#"",WBDWNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBDWBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBDWNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBDWBATN,DIM8
          REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
WBDWBATN,"','",WBDWUNIQ,"','",WBDWURNO,"','",WBDWINVN,"','",WBDWMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      WDOP1000
.
WDOP9999  RETURN
+
.*****************************************************************************
.*                          GVWE0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on webdvwaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GVWE0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBDWINVN,KEY8
          CALL      RDINV1
          IF        OVRCD = 1
            GOTO      GVWE9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR+PTINCRTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PTINGSTJ,FORM7P2O
          ENDIF
.
GVWE9999  RETURN
+
.*****************************************************************************
.* Check resubmission of WebServices DVAW claim
.*****************************************************************************
RDWE0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,WBDWNBAT                 * next batch blank ?
          GOTO      RDWE9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBDWFLAG = 8 | WBDWFLAG = 3
            GOTO      RDWE1000                   * Check OS amount
          ELSE
            GOTO      RDWE9000                   * Exit
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RDWE1000  PACK      KEY8,WBDWINVN,SP70
          CALL      RDINV1
          BRANCH    OVRCD,RDWE9000
.
          CALL      GVWE0000                     * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PINVAMT > 0)
            GOTO      RDWE9000
          ENDIF
.
          PACK      KEY17,WBDWINVN,SP8,ONE,SP70
          CALL      RAWBDVW2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RDWE9000
          ENDIF
.
          GOTO      RDWE9999
.
RDWE9000  MOVE      ONE,RSUBINDI
RDWE9999  RETURN
+
.------------------------------------------------------------
. WebServices DVAW Outpatient - Hospital Level Enquiries
.------------------------------------------------------------
WDOH0000  MATCH     "1",PTCNWSIN
          GOTO      WDOH9999 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      WDOH9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      WDOH9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      WDOH9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBDVB2
WDOH0500  CALL      RKWBDVB2
          BRANCH    OVRCD,WDOH2000
          MATCH     WBDBDTBC,LASTDATE
          GOTO      WDOH2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,WBDBBTHN,SP70
          CALL      RSWBDVW3
WDOH1000  CALL      RKWBDVW3
          BRANCH    OVRCD,WDOH0500
          MATCH     WBDBBTHN,WBDWBATN
          GOTO      WDOH0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "3",WBDWMODL
          GOTO      WDOH1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBDWHOSP
              GOTO      WDOH1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBDWHOSP
                GOTO      WDOH1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WDOH1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WDOH1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   EIGHT,WBDWFLAG               * Closed status
            GOTO      WDOH1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        WBIMFLAG=ZERO
.             GOTO      WDOH1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBDWURNO
            GOTO      WDOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBDWUNIQ
            GOTO      WDOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBDWBATN
            GOTO      WDOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBDWFLG
            GOTO      WDOH1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBDWINVN
            GOTO      WDOH1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,WDOH1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      WDOH1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      WDOH1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBDWINVN,Z70
          CALL      RSWBDVA3
          CALL      RPWBDVA3
          IF        OVRCD=0
            MATCH     WBDWINVN,WBDAINVN
            IF        @EQUAL
              MATCH     " 3",WBDATYPE       *  Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBDWFLAG,STATDW01,STATDW02,STATDW03,STATDW04:
                                      STATDW05,STATDW06,STATDW07,STATDW08
.
          CALL      RDWE0000             * Resubmission DVAW claims
.
          CALL      GVWE0000             * Get current invoice outstanding balance
.
          MOVE      WBDWURNO,URNUMBER
.         MOVE      WBDWUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,WBDWINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,WBDWUNIQ,WBDWINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,WDOH1500
.
.         MATCH     WBDWUNIQ,DPRDTUNQ
.         GOTO      WDOH1500 IF NOT EQUAL
.
.         MATCH     WBDWINVN,PRDTINVN
.         GOTO      WDOH1500 IF NOT EQUAL
.
.         GOTO      WDOH1600
.
WDOH1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WDOH1600  REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "11",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBDWURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBDWUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBDWBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBDWINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBDWMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBDWURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBDWBATN,"#",":
                             "#"",WBDWUNIQ,"#",":
                             "#"",WBDWINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBDWAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBDWPBAT,"#",":
                             "#"",WBDWNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBDWBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBDWNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBDWFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBDWBATN,DIM8
          REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBDWBATN,"','",WBDWUNIQ,"','",WBDWURNO,"','",WBDWINVN,"','",WBDWMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WDOH1900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBDWBATN,"','",WBDWINVN,"','":
                             WBDWMODL,"','":
                             WBDWURNO,"','",WBDWUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
.           WRITE     HTMLFILE;"#"",WBDWTRID,"#");"                      * 19
            WRITE     HTMLFILE;"#"",WBDWTRID,"#",";                      * 19
.         ENDIF

          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBDWUDAT
          IF        !@EQUAL
            UNPACK    WBDWUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      WDOH1950
          ELSE
            MATCH     SP70,WBDWCDAT
            IF        !@EQUAL
              UNPACK    WBDWCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      WDOH1950
            ELSE
              GOTO      WDOH1950
            ENDIF
          ENDIF

WDOH1950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBDWCUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBDWCUID,SP2,DIM11
            PACK      UIDTIMET,WBDWCTIM
            GOTO      WDOH1970
          ELSE
            MATCH     SP70,WBDWUUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBDWUUID,SP2,DIM11
              PACK      UIDTIMET,WBDWCTIM
              GOTO      WDOH1970
            ELSE
              GOTO      WDOH1970
            ENDIF
          ENDIF

WDOH1970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          MOVE      ZERO,LOOPCNTR
.
          GOTO      WDOH1000
.
WDOH2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      WDOH9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSWBDVW3
WDOH3000  CALL      RKWBDVW3
          BRANCH    OVRCD,WDOH9000
          MATCH     SP70,WBDWBATN
          GOTO      WDOH9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "3",WBDWMODL
          GOTO      WDOH3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBDWHOSP
              GOTO      WDOH3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBDWHOSP
                GOTO      WDOH3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WDOH3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WDOH3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        WBDWFLAG=EIGHT
              GOTO      WDOH3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBDWFLAG=ZERO
              GOTO      WDOH3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBDWURNO
            GOTO      WDOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBDWUNIQ
            GOTO      WDOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBDWBATN
            GOTO      WDOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBDWFLG
            GOTO      WDOH3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBDWINVN
            GOTO      WDOH3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,WDOH1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      WDOH1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      WDOH1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBDWINVN,Z70
          CALL      RSWBDVA3
          CALL      RPWBDVA3
          IF        OVRCD=0
            MATCH     WBDWINVN,WBDAINVN
            IF        @EQUAL
              MATCH     " 3",WBDATYPE      * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBDWFLAG,STATDW01,STATDW02,STATDW03,STATDW04:
                                      STATDW05,STATDW06,STATDW07,STATDW08
.
          CALL      RDWE0000     * Resubmission DVAW Claims
.
          CALL      GVWE0000     * Get current invoice outstanding balance
.
          MOVE      WBDWURNO,URNUMBER
.         MOVE      WBDWUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
.         PACK      KEY8,WBDWINVN,SP70
.         CALL      RDPRIN1
.         IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
.         ENDIF
.
.         MOVE      SP70,PRDTPRAC
.         MOVE      SP70,PRDTDOCT
.         MOVE      SP70,PRDTCODE
.
.         PACK      KEY22,WBDWUNIQ,WBDWINVN,SP70
.         CALL      RSPRDT1
.         CALL      RKPRDT1
.         BRANCH    OVRCD,WDOH3500
.
.         MATCH     WBDWUNIQ,DPRDTUNQ
.         GOTO      WDOH3500 IF NOT EQUAL
.
.         MATCH     WBDWINVN,PRDTINVN
.         GOTO      WDOH3500 IF NOT EQUAL
.
.         GOTO      WDOH3600
.
WDOH3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WDOH3600  REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "11",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBDWURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBDWUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBDWBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBDWINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBDWMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBDWURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBDWBATN,"#",":
                             "#"",WBDWUNIQ,"#",":
                             "#"",WBDWINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBDWAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBDWPBAT,"#",":
                             "#"",WBDWNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBDWBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBDWNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBDWFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBDWBATN,DIM8
          REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBDWBATN,"','",WBDWUNIQ,"','",WBDWURNO,"','",WBDWINVN,"','",WBDWMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WDOH8900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBDWBATN,"','",WBDWINVN,"','":
                             WBDWMODL,"','":
                             WBDWURNO,"','",WBDWUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
.           WRITE     HTMLFILE;"#"",WBDWTRID,"#");"                      * 19
            WRITE     HTMLFILE;"#"",WBDWTRID,"#",";                      * 19
.         ENDIF

          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBDWUDAT
          IF        !@EQUAL
            UNPACK    WBDWUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      WDOH8950
          ELSE
            MATCH     SP70,WBDWCDAT
            IF        !@EQUAL
              UNPACK    WBDWCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      WDOH8950
            ELSE
              GOTO      WDOH8950
            ENDIF
          ENDIF

WDOH8950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBDWCUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBDWCUID,SP2,DIM11
            PACK      UIDTIMET,WBDWCTIM
            GOTO      WDOH8970
          ELSE
            MATCH     SP70,WBDWUUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBDWUUID,SP2,DIM11
              PACK      UIDTIMET,WBDWCTIM
              GOTO      WDOH8970
            ELSE
              GOTO      WDOH8970
            ENDIF
          ENDIF

WDOH8970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          MOVE      ZERO,LOOPCNTR
.
          GOTO      WDOH3000
.
WDOH9000
WDOH9999  RETURN
+
.------------------------------------------------------------
. Table of Eclipse Claim Enquiries DVAW Patient Level Priv Prac
.------------------------------------------------------------
WDPL0000  MATCH     "1",PTCNWSIN
          GOTO      WDPL9999 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      WDPL9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
.         MATCH     SP70,HOSPCODE
.         IF        @EQUAL
.           MOVE      WBSEHOSP,HOSPCODE
.         ENDIF
.
          PACK      KEY35,HOSPCODE,FILTURNO,SP70
          CALL      RSWBDVW5
WDPL1000  CALL      RKWBDVW5
          BRANCH    OVRCD,WDPL9999
          MATCH     FILTURNO,WBDWURNO
          GOTO      WDPL9999 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",WBDWMODL
          GOTO      WDPL1000 IF NOT EQUAL
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBDWURNO
            GOTO      WDPL9999 IF NOT EQUAL
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WDPL1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WDPL1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBDWFLAG=ZERO
              GOTO      WDPL1000
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBDWUNIQ
            GOTO      WDPL1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBDWBATN
            GOTO      WDPL1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBDWFLG
            GOTO      WDPL1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBDWINVN
            GOTO      WDPL1000 IF NOT EQUAL
          ENDIF
.
          IF        EXDTBLNK=0
.
            PACK      KEY8,WBDWBATN,SP70
            CALL      RDWBDVB1
            BRANCH    OVRCD,WDPL1000
.
            MATCH     FRSTDATE,WBDBDTBC
            GOTO      WDPL1000 IF LESS
.
            MATCH     WBDBDTBC,LASTDATE
            GOTO      WDPL1000 IF LESS
.
          ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY35,WBDWINVN,Z70
          CALL      RSWBDVA3
          CALL      RPWBDVA3
          IF        OVRCD=0
            MATCH     WBDWINVN,WBDAINVN
            IF        @EQUAL
              MATCH     " 3",WBDATYPE        * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBDWFLAG,STATDW01,STATDW02,STATDW03,STATDW04:
                                      STATDW05,STATDW06,STATDW07,STATDW08
.
          CALL      RSDW0000    * Resubmission claim
.
          CALL      GDWP0000    * Get current invoice outstanding balance
.
          MOVE      WBDWURNO,URNUMBER
.         MOVE      WBDWUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBDWINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBDWUNIQ,WBDWINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,WDPL1500
.
          MATCH     WBDWUNIQ,DPRDTUNQ
          GOTO      WDPL1500 IF NOT EQUAL
.
          MATCH     WBDWINVN,PRDTINVN
          GOTO      WDPL1500 IF NOT EQUAL
.
          GOTO      WDPL1600
.
WDPL1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WDPL1600  REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "11",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBDWURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBDWUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBDWBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBDWINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBDWMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBDWURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBDWBATN,"#",":
                             "#"",WBDWUNIQ,"#",":
                             "#"",WBDWINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBDWAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBDWPBAT,"#",":
                             "#"",WBDWNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBDWBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBDWNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
.         ELSE
.           WRITE     HTMLFILE;"#"#",";
.         ENDIF
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBDWBATN,DIM8
          REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                                " class=ListIcon onclick=displayClaim('":
WBDWBATN,"','",WBDWUNIQ,"','",WBDWURNO,"','",WBDWINVN,"','",WBDWMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"#");"
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          GOTO      WDPL1000
.
WDPL9999  RETURN
+
.*****************************************************************************
.*                          GDWP0000               Called by: Lots           *
.*                Get the current invoice outstanding balance                *
.* Requires:  Valid read on webdvwaf record                                  *
.* Returns:   FORM7P2O - Outstanding invoice amount                          *
.*****************************************************************************
.
GDWP0000  MOVE      ZERO,FORM7P2O                * initialise outst. amount
.
.         Get the invoice record
.
          MOVE      WBDWINVN,KEY8
          CALL      RDPRIN1
          IF        OVRCD = 1
            GOTO      GDWP9999
          ENDIF
.
.         Calculate the current amount outstanding from the invoice details
.
          ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM7P2O
          IF        IBCNUGST=2
            ADD       PRINGSTJ,FORM7P2O
          ENDIF
.
GDWP9999  RETURN
+
.*****************************************************************************
.* Resubmission of WebServices DVAW claims                                   *
.*****************************************************************************
RSDW0000  MOVE      ZERO,RSUBINDI
.
          MATCH     SP8,WBDWNBAT                 * next batch blank ?
          GOTO      RSDW9000 IF NOT EQUAL
.
.         Only allow resubmission of claims with a "closed" status, or a
.         status of "SA Validation Error"
.
          IF        WBDWFLAG = 8 |WBDWFLAG = 3
            GOTO      RSDW1000            * Check OS amount owing
          ELSE
            GOTO      RSDW9000            * Exit
          ENDIF
.
.         Only allow resubmission of claims which have an outstanding amount
.         owing on the invoice
.
RSDW1000  PACK      KEY8,WBDWINVN,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,RSDW9000
.
          CALL      GDWP0000                 * get outstanding inv. balance
.
.         If the invoice is balanced or overpaid and it is not a zero invoice,
.         then don't allow resubmission
.
          IF        (FORM7P2O <= 0) & (PRINITOT > 0)
            GOTO      RSDW9000
          ENDIF
.
          PACK      KEY17,WBDWINVN,SP8,TWO,SP70
          CALL      RAWBDVW2                     * claim already waiting ?
          IF        OVRCD = 0
            GOTO      RSDW9000
          ENDIF
.
          GOTO      RSDW9999
.
RSDW9000  MOVE      ONE,RSUBINDI
RSDW9999  RETURN
+
.
.----------------------------------------------------------------
. Table of WebServices DVAW Claim Enquiries Private Practice
.----------------------------------------------------------------
.
WDQP0000  MATCH     "1",PTCNWSIN
          GOTO      WDQP9999 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      WDQP9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
.
          PACK      KEY18,WBSEUID,PRGID,SP70
          CALL      RDWBST1                 * check server security level
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
          IF        WBSTLEV=99
            MOVE      ONE,SUPERECL          * eclipse supervisor = yes
          ELSE
            MOVE      ZERO,SUPERECL         * eclipse supervisor = no
          ENDIF
.
          MATCH     FRSTDATE,SP70
          GOTO      WDQP9999 IF EQUAL
          MATCH     LASTDATE,SP70
          GOTO      WDQP9999 IF EQUAL
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBDVB2                * Eclipse DVAW Batch Header
WDQP0500  CALL      RKWBDVB2
          BRANCH    OVRCD,WDQP2000
          MATCH     WBDBDTBC,LASTDATE
          GOTO      WDQP2000 IF LESS
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          PACK      KEY24,WBDBBTHN,SP70
          CALL      RSWBDVW3
WDQP1000  CALL      RKWBDVW3
          BRANCH    OVRCD,WDQP0500
          MATCH     WBDBBTHN,WBDWBATN
          GOTO      WDQP0500 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",WBDWMODL
          GOTO      WDQP1000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBDWHOSP
              GOTO      WDQP1000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBDWHOSP
                GOTO      WDQP1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WDQP1000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WDQP1000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            COMPARE   EIGHT,WBDWFLAG
            GOTO      WDQP1000 IF EQUAL
          ENDIF
.
.         IF        EXCLWAIT=ONE
.           IF        WBIMFLAG=ZERO
.             GOTO      WDQP1000
.           ENDIF
.         ENDIF
.
          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBDWURNO
            GOTO      WDQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBDWUNIQ
            GOTO      WDQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBDWBATN
            GOTO      WDQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBDWFLG
            GOTO      WDQP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBDWINVN
            GOTO      WDQP1000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,WDQP1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      WDQP1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      WDQP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY27,WBDWINVN,Z70
          CALL      RSWBDVA2
          CALL      RPWBDVA2
          IF        OVRCD=0
            MATCH     WBDWINVN,WBDAINVN
            IF        @EQUAL
              MATCH     " 3",WBDATYPE           * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBDWFLAG,STATDW01,STATDW02,STATDW03,STATDW04:
                                      STATDW05,STATDW06,STATDW07,STATDW08
.
          CALL      RSDW0000    * Resubmission claim
.
          CALL      GDWP0000    * Get current invoice outstanding balance
.
          MOVE      WBDWURNO,URNUMBER
.         MOVE      WBDWUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBDWINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBDWUNIQ,WBDWINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,WDQP1500
.
          MATCH     WBDWUNIQ,DPRDTUNQ
          GOTO      WDQP1500 IF NOT EQUAL
.
          MATCH     WBDWINVN,PRDTINVN
          GOTO      WDQP1500 IF NOT EQUAL
.
          GOTO      WDQP1600
.
WDQP1500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WDQP1600  REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "11",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBDWURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBDWUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBDWBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBDWINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBDWMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBDWURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBDWBATN,"#",":
                             "#"",WBDWUNIQ,"#",":
                             "#"",WBDWINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBDWAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBDWPBAT,"#",":
                             "#"",WBDWNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBDWBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBDWNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBDWFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBDWBATN,DIM8
          REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBDWBATN,"','",WBDWUNIQ,"','",WBDWURNO,"','",WBDWINVN,"','",WBDWMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WDQP1900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBDWBATN,"','",WBDWINVN,"','":
                             WBDWMODL,"','":
                             WBDWURNO,"','",WBDWUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
.           WRITE     HTMLFILE;"#"",WBDWTRID,"#");"                       * 19
            WRITE     HTMLFILE;"#"",WBDWTRID,"#",";                       * 19
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBDWUDAT
          IF        !@EQUAL
            UNPACK    WBDWUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      WDQP1950
          ELSE
            MATCH     SP70,WBDWCDAT
            IF        !@EQUAL
              UNPACK    WBDWCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      WDQP1950
            ELSE
              GOTO      WDQP1950
            ENDIF
          ENDIF

WDQP1950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBDWUUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBDWUUID,SP2,DIM11
            PACK      UIDTIMET,WBDWUTIM
            GOTO      WDQP1970
          ELSE
            MATCH     SP70,WBDWCUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBDWCUID,SP2,DIM11
              PACK      UIDTIMET,WBDWCTIM
              GOTO      WDQP1970
            ELSE
              GOTO      WDQP1970
            ENDIF
          ENDIF

WDQP1970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          GOTO      WDQP1000
.
WDQP2000  MOVE      ZERO,LOOPCNTR
.
          IF        EXCLWAIT=1 & EXCLCLOS=1
            GOTO      WDQP9000
          ENDIF
.
          PACK      KEY24,SP70
          CALL      RSWBDVW3
WDQP3000  CALL      RKWBDVW3
          BRANCH    OVRCD,WDQP9000
          MATCH     SP70,WBDWBATN
          GOTO      WDQP9000 IF NOT EQUAL
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     "2",WBDWMODL
          GOTO      WDQP3000 IF NOT EQUAL
.
          IF        IBCNMHOS=ONE
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     HOSPCODE,WBDWHOSP
              GOTO      WDQP3000 IF NOT EQUAL
            ELSE
              IF        ALLHFLAG<>ONE
                MATCH     WBSEHOSP,WBDWHOSP
                GOTO      WDQP3000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.         MATCH     SP70,HLFDCLTY
.         IF        !@EQUAL & !@EOS
.           MATCH     HLFDCLTY,WBIMEETP
.           GOTO      WDQP3000 IF NOT EQUAL
.         ENDIF
.
.         MATCH     SP70,HLTHFUND
.         IF        !@EQUAL & !@EOS
.           PACK      HLTHFUND,HLTHFUND,SP70
.           MATCH     HLTHFUND,WBIMHFND
.           GOTO      WDQP3000 IF NOT EQUAL
.         ENDIF
.
          IF        EXCLCLOS=ONE
            IF        WBDWFLAG=EIGHT
              GOTO      WDQP3000
            ENDIF
          ENDIF
.
          IF        EXCLWAIT=ONE
            IF        WBDWFLAG=ZERO
              GOTO      WDQP3000
            ENDIF
          ENDIF

          MATCH     SP70,FILTURNO
          IF        !@EQUAL & !@EOS
            MATCH     FILTURNO,WBDWURNO
            GOTO      WDQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTADMN
          IF        !@EQUAL & !@EOS
            MATCH     FILTADMN,WBDWUNIQ
            GOTO      WDQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,BATCHNUM
          IF        !@EQUAL & !@EOS
            MATCH     BATCHNUM,WBDWBATN
            GOTO      WDQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CLAIMSTA
          IF        !@EQUAL & !@EOS
            MATCH     CLAIMSTA,DWBDWFLG
            GOTO      WDQP3000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,INVNUMBR
          IF        !@EQUAL & !@EOS
            MATCH     INVNUMBR,WBDWINVN
            GOTO      WDQP3000 IF NOT EQUAL
          ENDIF
.
.         IF        EXDTBLNK=0
.
.           PACK      KEY8,WBIMBATN,SP70
.           CALL      RDWBIMB1
.           BRANCH    OVRCD,WDQP1000
.
.           MATCH     FRSTDATE,WBIBDTBC
.           GOTO      WDQP1000 IF LESS
.
.           MATCH     WBIBDTBC,LASTDATE
.           GOTO      WDQP1000 IF LESS
.
.         ENDIF
.
          MOVE      ZERO,VIEWINDI
          PACK      KEY27,WBDWINVN,Z70
          CALL      RSWBDVA2
          CALL      RPWBDVA2
          IF        OVRCD=0
            MATCH     WBDWINVN,WBDAINVN
            IF        @EQUAL
              MATCH     " 3",WBDATYPE         * Type - Viewed
              IF        @EQUAL
                MOVE      ONE,VIEWINDI
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBDWFLAG,STATDW01,STATDW02,STATDW03,STATDW04:
                                      STATDW05,STATDW06,STATDW07,STATDW08
.
          CALL      RSDW0000       * Resubmission DVAW claim
.
          CALL      GDWP0000       * Get current invoice Oustanding balance
.
          MOVE      WBDWURNO,URNUMBER
.         MOVE      WBDWUNIQ,ADMISSNO
.         CALL      GETPAT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          MOVE      SP70,KEY3
          CALL      PATFLD00
.
          PACK      KEY8,WBDWINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP70,PRINPRAC
            MOVE      SP70,PRINDOCT
            MOVE      SP70,PRINCLAM
          ENDIF
.
          MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
          PACK      KEY22,WBDWUNIQ,WBDWINVN,SP70
          CALL      RSPRDT1
          CALL      RKPRDT1
          BRANCH    OVRCD,WDQP3500
.
          MATCH     WBDWUNIQ,DPRDTUNQ
          GOTO      WDQP3500 IF NOT EQUAL
.
          MATCH     WBDWINVN,PRDTINVN
          GOTO      WDQP3500 IF NOT EQUAL
.
          GOTO      WDQP3600
.
WDQP3500  MOVE      SP70,PRDTPRAC
          MOVE      SP70,PRDTDOCT
          MOVE      SP70,PRDTCODE
.
WDQP3600  REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          CLEAR     UPDLINK
          APPEND    "eclweb73",UPDLINK
          APPEND    ".pbl?reportno=",UPDLINK
          APPEND    "11",UPDLINK
          APPEND    "&template=",UPDLINK
          APPEND    "001",UPDLINK
          APPEND    "&urnumber=",UPDLINK
          APPEND    WBDWURNO,UPDLINK
          APPEND    "&uniqnumb=",UPDLINK
          APPEND    WBDWUNIQ,UPDLINK
          APPEND    "&mavbatch=",UPDLINK
          APPEND    WBDWBATN,UPDLINK
          APPEND    "&mavinvce=",UPDLINK
          APPEND    WBDWINVN,UPDLINK
          APPEND    "&mavmodul=",UPDLINK
          APPEND    WBDWMODL,UPDLINK
          APPEND    "&prhre001=",UPDLINK
          APPEND    PRDTPRAC,UPDLINK
          APPEND    "&prhre002=",UPDLINK
          APPEND    PRDTDOCT,UPDLINK
          APPEND    "&prhre003=",UPDLINK
          APPEND    PRDTCODE,UPDLINK
          RESET     UPDLINK
.
          CLEAR     PATLINK
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    WBDWURNO,PATLINK
          RESET     PATLINK
.
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
          WRITE     HTMLFILE;"t.addRow(#"",WBDWBATN,"#",":
                             "#"",WBDWUNIQ,"#",":
                             "#"",WBDWINVN,"#",":
                             "#"",FORMATNM,"#",":
                             "#"#",";
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<font color=red>",FORM7P2O,"&nbsp;*</font>#",";
          ELSE
            WRITE     HTMLFILE;"#"",WBDWAMTC,"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",STATDESC,"#",":
                             "#"",WBDWPBAT,"#",":
                             "#"",WBDWNBAT,"#",":
                             "#"#",":
                             "#"",UPDLINK,"#",":
                             "#"#",":
                             "#"",PATLINK,"#",";
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,WBDWBATN
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"#"#",";
          ELSE
            MATCH     SP70,WBDWNBAT
            IF        @EQUAL|@EOS
              IF        VIEWINDI=ONE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this); checked>":
                                   "#",";
              ELSE
                WRITE     HTMLFILE;"#"<input type=checkbox name=prc",DRECCNT:
                                   " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                                   "' onclick=MarkAsViewed(this);>":
                                   "#",";
              ENDIF
            ELSE
              WRITE     HTMLFILE;"#"#",";
            ENDIF
          ENDIF
.
.         IF        RSUBINDI=ZERO
          IF        WBDWFLAG <> ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=rsb",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=reSubmit(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          IF        WBDWFLAG=ZERO
            WRITE     HTMLFILE;"#"<input type=checkbox name=del",DRECCNT:
                               " value='",WBDWBATN,WBDWINVN,WBDWMODL:
                               "' onclick=delWaitn(this);>":
                               "#",";
          ELSE
            WRITE     HTMLFILE;"#"#",";
          ENDIF
.
          WRITE     HTMLFILE;"#"",KEY3,"#",";
.
          MOVE      WBDWBATN,DIM8
          REP       " +",WBDWURNO
          REP       " +",WBDWUNIQ
          REP       " +",WBDWBATN
          REP       " +",WBDWINVN
          REP       " +",WBDWMODL
          REP       " +",PRDTPRAC
          REP       " +",PRDTDOCT
          REP       " +",PRDTCODE
.
          WRITE     HTMLFILE;"#"","<img src='../images/InvoiceIcon.gif'":
                               " class=ListIcon onclick=displayClaim('":
WBDWBATN,"','",WBDWUNIQ,"','",WBDWURNO,"','",WBDWINVN,"','",WBDWMODL,"','":
             PRDTPRAC,"','",PRDTDOCT,"','",PRDTCODE,"');> ",DIM8,"#",";   * 17
.
WDQP8900  WRITE     HTMLFILE;"#"",STATDESC:
                             "<img src='../images/JsonIcon.gif' ":
                             "class=ListIcon align=right ":
                             "onclick=JSONPopupFrame('":
                             WBDWBATN,"','",WBDWINVN,"','":
                             WBDWMODL,"','":
                             WBDWURNO,"','",WBDWUNIQ,"','":
                             PRDTPRAC,"','",PRDTDOCT,"','":
                             PRDTCODE,"');> ","#",";                      * 18
.
          REP       "+ ",WBDWURNO
          REP       "+ ",WBDWUNIQ
          REP       "+ ",WBDWBATN
          REP       "+ ",WBDWINVN
          REP       "+ ",WBDWMODL
          REP       "+ ",PRDTPRAC
          REP       "+ ",PRDTDOCT
          REP       "+ ",PRDTCODE
.
.
. Allow status reset if applicable security level applies (column 18)
.
.IF        SUPERECL=ONE & (WBIMFLAG=5 | WBIMFLAG=7 | WBIMFLAG=9 | WBIMFLAG = 10)
.           WRITE     HTMLFILE;"#"<input type=checkbox name=rst",DRECCNT:
.                              " value='",WBIMBATN,WBIMINVN:
.                              "' onclick=resetStatus(this);>":
.                              "#");"
.         ELSE
            WRITE     HTMLFILE;"#"",WBDWTRID,"#",";                       * 19
.         ENDIF
.
          MOVE      ZERO,LOOPCNTR
.
          MOVE      SP70,DIM11
          MOVE      SP70,UIDCREUD
          MOVE      SP70,UIDTIMET

          MATCH     SP70,WBDWUDAT
          IF        !@EQUAL
            UNPACK    WBDWUDAT,CCENT,CYEAR,CMON,CDAY
            GOTO      WDQP8950
          ELSE
            MATCH     SP70,WBDWCDAT
            IF        !@EQUAL
              UNPACK    WBDWCDAT,CCENT,CYEAR,CMON,CDAY
              GOTO      WDQP8950
            ELSE
              GOTO      WDQP8950
            ENDIF
          ENDIF

WDQP8950  MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,WBDWUUID
          IF        !@EQUAL
            PACK      UIDCREUD,WBDWUUID,SP2,DIM11
            PACK      UIDTIMET,WBDWUTIM
            GOTO      WDQP8970
          ELSE
            MATCH     SP70,WBDWCUID
            IF        !@EQUAL
              PACK      UIDCREUD,WBDWCUID,SP2,DIM11
              PACK      UIDTIMET,WBDWCTIM
              GOTO      WDQP8970
            ELSE
              GOTO      WDQP8970
            ENDIF
          ENDIF

WDQP8970  WRITE     HTMLFILE;"#"",UIDCREUD,SP1,UIDTIMET,"#");"            * 20

          GOTO      WDQP3000
.
WDQP9000
WDQP9999  RETURN
+
.------------------------------------------------------------
. Validate Batch Number DVAW
. INPUTS: BATCHNUM - Batch Number
.------------------------------------------------------------
VALBAD00  CALL      XMLHED00
          BRANCH    EXIT,VALBAD99
.
          MATCH     "1",PTCNWSIN
          GOTO      VALBAD91 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      VALBAD91 IF NOT EQUAL
.
          PACK      KEY24,BATCHNUM,SP70
          CALL      RSWBDVW3
          CALL      RKWBDVW3
          BRANCH    OVRCD,VALBAD90
.
          MATCH     WBDWBATN,BATCHNUM
          GOTO      VALBAD90 IF NOT EQUAL
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALBAD98
.
VALBAD90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Batch number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAD98
.
VALBAD91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Not using DVAW Module. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAD98
.
VALBAD98  CALL      XMLEND00
VALBAD99  RETURN
+
.------------------------------------------------------------
. Validate Unique/Admission Number DVAW
. INPUTS: UNIQNUMB - Batch Number
.------------------------------------------------------------
VALUND00  CALL      XMLHED00
          BRANCH    EXIT,VALUND99
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,VALUND20
.
          GOTO      VALUND50
.
VALUND20  PACK      KEY36,UNIQNUMB,SP70
          CALL      RDSBOKA6
          CALL      RDKBOKA6
          BRANCH    OVRCD,VALUND90
.
          MATCH     UNIQNUMB,DOBAOUTN
          GOTO      VALUND90 IF NOT EQUAL
.
.         PACK      KEY8,UNIQNUMB,SP70
.         CALL      RDEMVIS1
.         BRANCH    OVRCD,VALUND90
.
          GOTO      VALUND50
.
.  Dummy ouput for valid Code
.
VALUND50  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALUND98
.
VALUND90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Unique number / Admission Number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALUND98
.
VALUND98  CALL      XMLEND00
VALUND99  RETURN
+
.--------------------------------------------------------------------
. WebServices DVAW Claim Full Details
.--------------------------------------------------------------------
WBDV0000  MATCH     "1",PTCNWSIN
          GOTO      WBDV9500 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      WBDV9500 IF NOT EQUAL
.
          RESET     UPDATTYP
          MATCH     SP70,UPDATTYP
          GOTO      WBDV5000 IF EQUAL
.
          MATCH     ANSC,UPDATTYP           * Close Eclipse claim
          GOTO      WBDV6000 IF EQUAL
.
          GOTO      WBDV9000
.
WBDV5000  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,WBDV9100
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,WBDV9100
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD
          CALL      CALCAGE                   * CALCAGE uses PBDATE
          CALL      PATLN000
          CALL      PATFLD00                * Use standard Patient Folder sub
.
          PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBDVW2            * Get transaction details - outectaf
          BRANCH    OVRCD,WBDV9200
.
          CALL      CLWEBDVH
          IF        WBDWFLAG > 6
            CALL      WBDP0000          * Get payment details - outerhaf
          ENDIF
.
          PACK      KEY71,WBDWHOSP,SP70          * Read B2B Device Table
          CALL      RSWBB2B3
          CALL      RKWBB2B3
          IF        OVRCD=1
            MOVE      SP70,WBB2DPTH
          ELSE
            MATCH     WBDWHOSP,WBB2HOSP
            IF        !@EQUAL
              MOVE      SP70,WBB2DPTH
            ENDIF
          ENDIF
.
.-------- Emergency Module
          MATCH     "1",MAVMODUL
          GOTO      WBDV5200 IF NOT EQUAL
.
          CALL      DVWE0000            * Get OS Invoice balance from patinvrf
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDINV1
          BRANCH    OVRCD,WBDV9400
.
          PACK      KEY8,PINVADM,SP70
          CALL      RDEMVIS1
          BRANCH    OVRCD,WBDV9700
.
          GOTO      WBDV5500
.
.-------- Private Practice Module
WBDV5200  MATCH     "2",MAVMODUL
          GOTO      WBDV5300 IF NOT EQUAL
.
          CALL      DVWP0000            * Get OS Invoice balance from priinvof
.
          PACK      KEY8,UNIQNUMB,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,WBDV9300
.
          PACK      KEY27,PRHDUNIQ,PRHRE001,PRHRE002,PRHRE003,SP70
          CALL      RDPRHR1
          BRANCH    OVRCD,WBDV9300
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDPRIN1
          BRANCH    OVRCD,WBDV9400
.
          GOTO      WBDV5500
.
.-------- Outpatient Module
WBDV5300  MATCH     "3",MAVMODUL
          GOTO      WBDV9600 IF NOT EQUAL
.
          CALL      DVWE0000            * Get OS Invoice balance from patinvrf
.
          PACK      KEY8,MAVINVCE,SP70
          CALL      RDINV1
          BRANCH    OVRCD,WBDV9400
.
          PACK      KEY8,PINVADM,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,WBDV9800
.
          COMPARE   TWO,PVITYPE         * Outpatient visit type
          GOTO      WBDV9800 IF NOT EQUAL
.
          MOVE      "out",OSTFILE
          MOVE      PVISITE,KEY6
          CALL      RDSITA1             * Get the file header for this site
.
          PACK      CFNAME WITH OSTFILE,FILBB1A1
          CALL      OPOTBB11
.
          MOVE      PVIBILL,KEY8
          CALL      RDBOKB1             * Get outbb1af.obacomp - claim code
          BRANCH    OVRCD,WBDV9810

          GOTO      WBDV5500
.
WBDV5500  CLEAR     WEBTITLE
          MOVE      "WebServices DVAW Full Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,WBDV9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV6000  PACK      KEY17,MAVINVCE,MAVBATCH,MAVMODUL,SP70
          CALL      RDWBDVW2
          BRANCH    OVRCD,WBDV9200
.
          MOVE      EIGHT,WBDWFLAG             * Eclipse status = closed
          CALL      UPWBDVW2
.
.         Write a new history (webdvwaf) record
.
          MOVE      WBDWINVN,WBDAINVN
          MOVE      WBDWBATN,WBDABATN
          MOVE      EIGHT,WBDASTAT             * Status - Closed
          MOVE      " 3",WBDATYPE              * Type - Viewed
          MOVE      WBSEUID,WBDAOPER
          MOVE      WBDWTRID,WBDATRID
          MOVE      SP70,WBDAEROR
          MOVE      SP70,WBDAEROT
          MOVE      SP70,WBDASPAR
          MOVE      WBDWMODL,WBDAMODL
          MOVE      WBDWTRID,WBDATRID
          MOVE      WBDWMSID,WBDAMSID
.
          CALL      IBACLOCK                     * get current date/time
          PACK      WBDADATE,CCC,CYY,CMM,CDD
          REP       " 0",WBDADATE
          MOVE      CTIMEIS,WBDATIME
          REP       " 0",WBDATIME
.
          PACK      KEY27,WBDAINVN,WBDADATE,WBDATIME,WBDATYPE,WBDAMODL,SP70
          CALL      RAWBDVA1
          IF        OVRCD = 1
            CALL      WRWBDVA1
          ENDIF
.
.         MOVE      SP70,TTYPEARG
.         MOVE      " 9",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      "10",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      " 4",TTYPEARG
.         CALL      DELETR00
.
.         MOVE      " 5",TTYPEARG
.         CALL      DELETR00
.
.         CALL      DELECO00
.
          MOVE      ZERO,EXIT
          GOTO      WBDV9999
.
WBDV9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV9100  MOVE      "Can't find Patient Master details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV9200  MOVE      "Can't find WebServices DVAW Claim details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV9300  MOVE      "Doctor Referral details has not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV9400  MOVE      "Can't Find Invoice Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV9500  MOVE      "Not using WebServices DVAW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV9600  MOVE      "Invalid DVAW webPAS Module",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV9700  MOVE      "Emergency Visit has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV9800  MOVE      "Outpatient Visit has Not been selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV9810  MOVE      "OP Visit Compensation Eligibility Not Found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBDV9999
.
WBDV9999  RETURN
+
.*****************************************************************************
.*                          DVWE0000                                         *
.*****************************************************************************
.
DVWE0000  CALL      GDWE0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBDWFLAG,STATDW01,STATDW02,STATDW03,STATDW04:
                                      STATDW05,STATDW06,STATDW07,STATDW08
.
DVWE9999  RETURN
+
.------------------------------------------------------------
. WebServices DVAW Payment Details (webdvhaf)
.------------------------------------------------------------
.
WBDP0000  PACK      KEY47,WBDWHOSP,WBDWRKEY,SP70
          CALL      RSWBDVH4
WBDP1000  CALL      RKWBDVH4
          BRANCH    OVRCD,WBDP4000
.
          MATCH     WBDWHOSP,WBDHHOSP
          GOTO      WBDP4000 IF NOT EQUAL
.
          MATCH     WBDWRKEY,WBDHRKEY
          GOTO      WBDP4000 IF NOT EQUAL
.
          GOTO      WBDP5000
.
WBDP4000  CALL      CLWEBDVH
.
WBDP5000  PACK      KEY53,WBDWTRID,SP70
          CALL      RSWBDVI2
          CALL      RKWBDVI2
          BRANCH    OVRCD,WBDP9000
.
          MATCH     WBDWTRID,WBDITRID
          GOTO      WBDP9000 IF NOT EQUAL
.
          GOTO      WBDP9999
.
WBDP9000  CALL      CLWEBDVI
.
WBDP9999  RETURN
+
.*****************************************************************************
.*                          DVWP0000                                         *
.*****************************************************************************
.
DVWP0000  CALL      GWDP0000                     * get outstanding inv. balance
.
          MOVE      STATUS00,STATDESC
          LOAD      STATDESC,WBDWFLAG,STATDW01,STATDW02,STATDW03,STATDW04:
                                      STATDW05,STATDW06,STATDW07,STATDW08
.
DVWP9999  RETURN
+
.------------------------------------------------------------
. WebServices DVAW Claim Full Details tags
.------------------------------------------------------------
WBDF0000  BRANCH    FLDITMNO,WBDF0100,WBDF0200,WBDF0300,WBDF0400,WBDF0500:
                             WBDF0600,WBDF0700,WBDF0800,WBDF0900,WBDF1000:
                             WBDF1100,WBDF1200,WBDF1300,WBDF1400,WBDF1500:
                             WBDF1600,WBDF1700,WBDF1800,WBDF1900,WBDF2000:
                             WBDF2100,WBDF2200,WBDF2300,WBDF2400,WBDF2500:
                             WBDF2600,WBDF2700,WBDF2800,WBDF2900,WBDF3000:
                             WBDF3100,WBDF3200,WBDF3300,WBDF3400,WBDF3500:
                             WBDF3600,WBDF3700,WBDF3800,WBDF3900,WBDF4000:
                             WBDF4100,WBDF4200,WBDF4300,WBDF4400,WBDF4500:
                             WBDF4600,WBDF4700,WBDF4800,WBDF4900,WBDF5000:
                             WBDF5100,WBDF5200,WBDF5300
.
          GOTO      WBDF9999
.
WBDF0100  WRITE     HTMLFILE;FORM7P2O;
          GOTO      WBDF9999
.
WBDF0200  WRITE     HTMLFILE;STATDESC;
          GOTO      WBDF9999
.
WBDF0300
.         WRITE     HTMLFILE;CONTDESC;
          GOTO      WBDF9999
.
WBDF0400  MATCH     SP70,WBDWPDAT
          GOTO      WBDF9999 IF EQUAL
          UNPACK    WBDWPDAT,CCENT,CYEAR,CMON,CDAY  * Payment Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      WBDF9999
.
WBDF0500  MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBDICLCA
          UNPACK    WBDICLCA,DIM7,DIM2              * Claim Charge Amount
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      WBDF9999
.
WBDF0600  MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBDHDAMN
          UNPACK    WBDHDAMN,DIM7,DIM2              * Deposit Amount
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      WBDF9999
.
WBDF0700  WRITE     HTMLFILE;WBDWINVN;
          GOTO      WBDF9999
.
WBDF0800  WRITE     HTMLFILE;WBDWBATN;
          GOTO      WBDF9999
.
WBDF0900  WRITE     HTMLFILE;WBDWPBAT;
          GOTO      WBDF9999
.
WBDF1000  WRITE     HTMLFILE;WBDWNBAT;
          GOTO      WBDF9999
.
WBDF1100  WRITE     HTMLFILE;WBDWTRID;
          GOTO      WBDF9999
.
WBDF1200
.         WRITE     HTMLFILE;WBIMFTID;
          GOTO      WBDF9999
.
WBDF1300  WRITE     HTMLFILE;WBDWAMTC;
          GOTO      WBDF9999
.
WBDF1400  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVAMT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINITOT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVAMT;
          ENDIF
.
          GOTO      WBDF9999
.
WBDF1500  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVPATA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINPAMT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVPATA;
          ENDIF
.
          GOTO      WBDF9999
.
WBDF1600
.         WRITE     HTMLFILE;PRINHAMT;
          GOTO      WBDF9999
.
WBDF1700  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVOTHA;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINOTHA;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVOTHA;
          ENDIF
.
          GOTO      WBDF9999
.
WBDF1800  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVJOUR;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINJAMT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PINVJOUR;
          ENDIF
.
          GOTO      WBDF9999
.
WBDF1900  MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBDICLBP
          UNPACK    WBDICLBP,DIM7,DIM2          * Claim Benefit Paid
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      WBDF9999
.
WBDF2000  MATCH     SP70,WBDWSTAT                * blank status ?
          GOTO      WBDF9999 IF EQUAL            * yes - don't display anything
          GOTO      WBDF9999 IF EOS
.
          MATCH     " 0",WBDWSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     " 1",WBDWSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed with Write Off";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     " 2",WBDWSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed with Payment";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     " 3",WBDWSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"Closed with WO & Pymt";
            GOTO      WBDF9999
          ENDIF
.
          GOTO      WBDF9999
.
WBDF2100  CALL      WDID0000
          GOTO      WBDF9999
.
WBDF2200  CALL      WDAR0000   * WebSer Bulk Billing Assessment Report Fields
          GOTO      WBDF9999
.
WBDF2300  CALL      WDEV0000   * WebSer Bulk Billing Med Ev Report Fields
          GOTO      WBDF9999
.
WBDF2400  CALL      WBDD0000   * WebSer Bulk Billing Service Details
          GOTO      WBDF9999
.
WBDF2500
.-------- CALL      EDSE0000
          GOTO      WBDF9999
.
WBDF2600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PTINCRTT;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PRINCNTT;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;PTINCRTT;
          ENDIF
.
          GOTO      WBDF9999
.
WBDF2700
.-------- WRITE     HTMLFILE;CFEETYP;
          GOTO      WBDF9999
.
WBDF2800  WRITE     HTMLFILE;WBDWAMMP       * Amount Paid by Medicare
.-------- MOVE      ZERO,FORM7P2C
.-------- UNPACK    OTERCLBP,DIM7,DIM2      * Claim Benefit Paid
.-------- PACK      DIM10,DIM7,DOT,DIM2
.-------- MOVE      DIM10,FORM7P2C
.-------- WRITE     HTMLFILE;FORM7P2C;
          GOTO      WBDF9999
.
WBDF2900  MATCH     "1",MAVMODUL            * Emergency Module
          IF        @EQUAL
            MOVE      "CL",CATEGORY
            MOVE      EMVICOMP,CODE
            CALL      CODITM00
          ENDIF
.
          MATCH     "2",MAVMODUL            * Private Practice Module
          IF        @EQUAL
            MOVE      "CL",CATEGORY         * claim code
            MOVE      PRHDCLAM,CODE
            CALL      CODITM00
          ENDIF
.
          MATCH     "3",MAVMODUL            * Outpatient Module
          IF        @EQUAL
            MOVE      "CL",CATEGORY
            MOVE      OBACOMP,CODE          * Compensation Eligibility
            CALL      CODITM00
          ENDIF
.
          GOTO      WBDF9999
.
WBDF3000
.--------- UNPACK    DIM127,D1,KEY1,DIM127
.          MOVE      ZERO,F1
.          MOVE      KEY1,F1
.          BRANCH    F1,WBDF3010
.
.          WRITE     HTMLFILE;PRHDHFND;
.
.          GOTO      WBDF9999
.
.WBDF3010  MATCH     SP70,PRHDHFND
.          GOTO      WBDF9999 IF EQUAL
.          GOTO      WBDF9999 IF EOS
.
.          PACK      KEY14,PRHDHFND,ZERO,ZERO,ZERO,ZERO,SP70
.          CALL      RDFUND1
.          BRANCH    OVRCD,WBDF9999
.
.--------- WRITE     HTMLFILE;HFNAME;
.
          GOTO      WBDF9999
.
WBDF3100  WRITE     HTMLFILE;UNIQNUMB;
          GOTO      WBDF9999
.
WBDF3200  WRITE     HTMLFILE;PRHRE001;
          GOTO      WBDF9999
.
WBDF3300  WRITE     HTMLFILE;PRHRE002;
          GOTO      WBDF9999
.
WBDF3400  WRITE     HTMLFILE;PRHRE003;
          GOTO      WBDF9999
.
WBDF3500  WRITE     HTMLFILE;MAVMODUL;
          GOTO      WBDF9999
.
WBDF3600  MATCH     "1",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;
          ENDIF
.
          MATCH     "2",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;FOUR;
          ENDIF
.
          MATCH     "3",MAVMODUL
          IF        @EQUAL
            WRITE     HTMLFILE;TWO;
          ENDIF
.
          GOTO      WBDF9999
.
WBDF3700  MATCH     SP70,PRHRPIND
          GOTO      WBDF9999 IF EQUAL
          GOTO      WBDF9999 IF EOS
.
          MOVE      "GI",CATEGORY
          MOVE      PRHRPIND,CODE
.
          PACK      KEY5,CATEGORY,CODE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            WRITE     HTMLFILE;TDESC;
          ENDIF
.
          GOTO      WBDF9999
.
WBDF3800  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      WBDF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvrw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBDF9999
.
WBDF3900  CALL      DVRHED00
          GOTO      WBDF9999
.
WBDF4000  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      WBDF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvrw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    DVRWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBDF9999
.
WBDF4100  CALL      DVRJSN00
          GOTO      WBDF9999
.
WBDF4200  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      WBDF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvrw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    DVRRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBDF9999
.
WBDF4300  CALL      DVRRSP00
          GOTO      WBDF9999
.
WBDF4400  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     SP70,ECCLSTRD
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      WBDF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvrw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    DVRELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBDF9999
.
WBDF4500  CALL      DVRERR00
          GOTO      ECFH9999
.
WBDF4600  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     SP70,WBDWTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      WBDF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvaw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBDWTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBDF9999
.
WBDF4700  CALL      DVWHED00
          GOTO      WBDF9999
.
WBDF4800  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     SP70,WBDWTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      WBDF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvaw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBDWTRID,CMDLINE
          APPEND    DVAWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBDF9999
.
WBDF4900  CALL      DVWJSN00
          GOTO      ECFH9999
.
WBDF5000  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     SP70,WBDWTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      WBDF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvaw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBDWTRID,CMDLINE
          APPEND    DVSRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBDF9999
.
WBDF5100  CALL      DVWRSP00
          GOTO      ECFH9999
.
WBDF5200  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      WBDF9999
          ENDIF
.
          MATCH     SP70,WBDWTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      WBDF9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvaw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBDWTRID,CMDLINE
          APPEND    DVSELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      WBDF9999
.
WBDF5300  CALL      DVWERR00
          GOTO      WBDF9999
.
WBDF9999  RETURN
+
.------------------------------------------------------------
. Table of EDI History for Eclipse DVAW
.------------------------------------------------------------
WDID0000  MATCH     "1",PTCNWSIN
          GOTO      WDID9999 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      WDID9999 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
          CALL      WDIDD000      * Output Table Heading
.
          PACK      KEY35,MAVINVCE,Z70
          CALL      RSWBDVA3
WDID1000  CALL      RPWBDVA3
          BRANCH    OVRCD,WDID9999
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"<!-- ",LOOPCNTR," -->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     MAVINVCE,WBDAINVN
          GOTO      WDID9999 IF NOT EQUAL
.
          MATCH     MAVMODUL,WBDAMODL
          GOTO      WDID1000 IF NOT EQUAL
.
          CALL      WDDRW000
.
          GOTO      WDID1000
.
WDID9999  RETURN
+
.------------------------------------------------------------
. EDI History (Detail Row) - For Eclipse DVAW
.------------------------------------------------------------
WDDRW000  MOVE      SP70,DIM11
          MATCH     SP70,WBDADATE
          IF        !@EQUAL & !@EOS
            UNPACK    WBDADATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
          MOVE      STATUS00,STATDESC         * Status - Not Sent/Waiting
          LOAD      STATDESC,WBDASTAT,STATDW01,STATDW02,STATDW03,STATDW04:
                                      STATDW05,STATDW06,STATDW07,STATDW08
.
          MOVE      SP30,TYPEDESC
          MOVE      WBDATYPE,TYPOFREQ
          LOAD      TYPEDESC,TYPOFREQ,TYPEDDW1,TYPEDDW2,TYPEDDW3,TYPEDDW4:
                                      TYPEDDW5
.
.-------- Type - Data error response (4) OR Transmission Error Response (5)
          IF        TYPOFREQ = 4 | TYPOFREQ = 5
            STRIP     TYPEDESC
            ENDSET    TYPEDESC
            APPEND    SP1,TYPEDESC
            APPEND    WBDAEROR,TYPEDESC
            APPEND    SP20,TYPEDESC
            RESET     TYPEDESC
          ENDIF
.
          MOVE      SP70,DIM30
          PACK      KEY10,WBDAOPER,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      WBDAOPER,DIM30
          ELSE
            MATCH     WBDAOPER,WBSEUID
            IF        @EQUAL
              MOVE      WBSENAM,DIM30
            ELSE
              MOVE      WBDAOPER,DIM30
            ENDIF
          ENDIF
.
          CMATCH    NULL,WBDAEROT
          IF        @EQUAL
            PACK      WBDAEROT,SP70,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",DIM11 ,"</td>";
          WRITE     HTMLFILE;"<td>",WBDATIME,"</td>";
          WRITE     HTMLFILE;"<td>",STATDESC,"</td>":
                             "<td>",TYPEDESC,"</td>":
                             "<td>",WBDABATN,"</td>":
                             "<td>",DIM30,"</td>":
                             "<td>",WBDAEROT,"</td>":
                             "</tr>";
.
WDDRW999  RETURN
+
.------------------------------------------------------------
. EDI History (TABLE HEADING)
.------------------------------------------------------------
WDIDD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>":
                             "Date</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Time</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Status</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Transaction Type</td>":
                             "<td class=HeadingCell width=10%>":
                             "Batch</td>":
                             "<td class=HeadingCell width=10%>":
                             "Reviewed By</td>":
                             "<td class=HeadingCell width=35%>":
                             "Error Code Description</td>":
                             "</tr>"
.
WDIDD999  RETURN
+
.---------------------------------------------------------------
. DVAW <tran id>_dvaw_errors  tag
.---------------------------------------------------------------
DVWERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      DVWERR99
          ENDIF
.
          MATCH    SP70,WBDWTRID
          GOTO     DVWERR99 IF EQUAL
          GOTO     DVWERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvaw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBDWTRID,CMDLINE
          APPEND    DVSELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      DVSEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      DVWERR99
          ENDIF
.
DVWERR10  READ      DVSEFILE,SEQ;DVSELINE
          GOTO      DVWERR99 IF OVER
.
          WRITE     HTMLFILE;DVSELINE
.
          GOTO      DVWERR10
.
DVWERR99  CLOSE     DVSEFILE
.
          RETURN
+
.---------------------------------------------------------------
. DVAW <tran id>_dvaw_response  tag
.---------------------------------------------------------------
DVWRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      DVWRSP99
          ENDIF
.
          MATCH    SP70,WBDWTRID
          GOTO     DVWRSP99 IF EQUAL
          GOTO     DVWRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvaw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBDWTRID,CMDLINE
          APPEND    DVSRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      DVSRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      DVWRSP99
          ENDIF
.
DVWRSP10  READ      DVSRFILE,SEQ;DVSRLINE
          GOTO      DVWRSP99 IF OVER
.
          WRITE     HTMLFILE;DVSRLINE
.
          GOTO      DVWRSP10
.
DVWRSP99  CLOSE     DVSRFILE
.
          RETURN
+
.---------------------------------------------------------------
. DVAW <tran id>_dvaw  tag
.---------------------------------------------------------------
DVWJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      DVWJSN99
          ENDIF
.
          MATCH    SP70,WBDWTRID
          GOTO     DVWJSN99 IF EQUAL
          GOTO     DVWJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvaw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBDWTRID,CMDLINE
          APPEND    DVAWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      DVAWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      DVWJSN99
          ENDIF
.
DVWJSN10  READ      DVAWFILE,SEQ;DVAWLINE
          GOTO      DVWJSN99 IF OVER
.
          WRITE     HTMLFILE;DVAWLINE
.
          GOTO      DVWJSN10
.
DVWJSN99  CLOSE     DVAWFILE
.
          RETURN
+
.---------------------------------------------------------------
. DVAW <tran id>.properties tag
.---------------------------------------------------------------
DVWHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      DVWHED99
          ENDIF
.
          MATCH    SP70,WBDWTRID
          GOTO     DVWHED99 IF EQUAL
          GOTO     DVWHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvaw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBDWTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      DVWHED99
          ENDIF
.
DVWHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      DVWHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      DVWHED10
.
DVWHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. DVAW DVRW <tran id>_dvrw_errors  tag
.---------------------------------------------------------------
DVRERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      DVRERR99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     DVRERR99 IF EQUAL
          GOTO     DVRERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvrw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    DVRELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      DVREFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      DVRERR99
          ENDIF
.
DVRERR10  READ      DVREFILE,SEQ;DVRELINE
          GOTO      DVRERR99 IF OVER
.
          WRITE     HTMLFILE;DVRELINE
.
          GOTO      DVRERR10
.
DVRERR99  CLOSE     DVREFILE
.
          RETURN
+
.---------------------------------------------------------------
. DVAW DVRW <tran id>_dvrw_response  tag
.---------------------------------------------------------------
DVRRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      DVRRSP99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     DVRRSP99 IF EQUAL
          GOTO     DVRRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvrw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    DVRRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      DVRRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      DVRRSP99
          ENDIF
.
DVRRSP10  READ      DVRRFILE,SEQ;DVRRLINE
          GOTO      DVRRSP99 IF OVER
.
          WRITE     HTMLFILE;DVRRLINE
.
          GOTO      DVRRSP10
.
DVRRSP99  CLOSE     DVRRFILE
.
          RETURN
+
.---------------------------------------------------------------
. DVAW DVRW <tran id>_dvrw  tag
.---------------------------------------------------------------
DVRJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      DVRJSN99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     DVRJSN99 IF EQUAL
          GOTO     DVRJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvrw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    DVRWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      DVRWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      DVRJSN99
          ENDIF
.
DVRJSN10  READ      DVRWFILE,SEQ;DVRWLINE
          GOTO      DVRJSN99 IF OVER
.
          WRITE     HTMLFILE;DVRWLINE
.
          GOTO      DVRJSN10
.
DVRJSN99  CLOSE     DVRWFILE
.
          RETURN
+
.---------------------------------------------------------------
. DVAW DVRW <tran id>.properties tag
.---------------------------------------------------------------
DVRHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      DVRHED99
          ENDIF
.
          MATCH    SP70,ECCLSTRD
          GOTO     DVRHED99 IF EQUAL
          GOTO     DVRHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/dvrw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    ECCLSTRD,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      DVRHED99
          ENDIF
.
DVRHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      DVRHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      DVRHED10
.
DVRHED99  CLOSE     PROPFILE
.
          RETURN
+
.----------------------------------------------------------------------
. Table of WebServices DVAW Services Details
.----------------------------------------------------------------------
WBDD0000  MATCH     "1",PTCNWSIN
          GOTO      WBDD9999 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      WBDD9999 IF NOT EQUAL
.
          CALL      WBDDHD00                     * Output Table Heading
.
          PACK      KEY37,ECCLCLID,ECCLRPTC,ECCLEVTC,SP70
          CALL      RSWBDVF1                     * position in file outeadaf
WBDD1000  CALL      RKWBDVF1                     * read next record
          BRANCH    OVRCD,WBDD9999               * end of file
.
          PACK      WBDFCLID,WBDFCLID,SP70
.
          MATCH     ECCLCLID,WBDFCLID            * same claim id ?
          GOTO      WBDD9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBDFRPTC,WBDFRPTC,SP70
.
          MATCH     ECCLRPTC,WBDFRPTC            * same report counter ?
          GOTO      WBDD9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBDFMEVC,WBDFMEVC,SP70
.
          MATCH     ECCLEVTC,WBDFMEVC            * same report counter ?
          GOTO      WBDD9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBDFRKEY,WBDFRKEY,SP70
.
          MATCH     ECCLRKEY,WBDFRKEY            * same report retrieve key?
          GOTO      WBDD1000 IF NOT EQUAL        * no - finished listing
.
          CALL      WBDDRW00
.
          GOTO      WBDD1000
.
WBDD9999  RETURN
+
.------------------------------------------------------------
. WebServices DVAW Service Details (Detail Row)
.------------------------------------------------------------
WBDDRW00  MOVE      ZERO,FORM7P2
          RJUSTIFY  WBDFBEPD
          UNPACK    WBDFBEPD,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
.
          MOVE      ZERO,FORM7P2A
          RJUSTIFY  WBDFCHAM
          UNPACK    WBDFCHAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2A
.
          MOVE      SP70,HCEMDESC
.
          MATCH     SP70,WBDFASSC
          IF        !@EQUAL & !@EOS
            PACK      KEY3,WBDFASSC,SP70
            CALL      RDHCEMS1
            IF        OVRCD=ONE
              MOVE      "No Description in hicemsaf",HCEMDESC
              PACK      HCEMDESC,HCEMDESC,SP70
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                             "<td valign=top>",WBDFSVID,"</td>":
                             "<td valign=top>",WBDFASSC," - ",HCEMDESC,"</td>":
                             "<td valign=top>",FORM7P2,"</td>":
                             "<td valign=top>",FORM7P2A,"</td>":
                             "<td valign=top>",WBDFITMN,"</td>":
                             "<td valign=top>",WBDFNOFP,"</td>":
                             "<td valign=top>",WBDFPROV,"</td>":
                             "</tr>";
.
WBDDRW99  RETURN
+
.------------------------------------------------------------
. WebServices DVAW Claim Service Details (TABLE HEADING)
.------------------------------------------------------------
WBDDHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Service Id&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Assessment Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Number Of Patients&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Provider Number&nbsp;</td>":
                             "</tr>"
.
WBDDHD99  RETURN
+
.----------------------------------------------------------------------
. Table of WebServices DVAW Claim  Medical Event Details
.----------------------------------------------------------------------
WDEV0000  MATCH     "1",PTCNWSIN
          GOTO      WDEV9999 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      WDEV9999 IF NOT EQUAL
.
          CALL      WDEVHD00                     * Output Table Heading
.
          PACK      KEY35,ECCLCLID,ECCLRPTC,SP70
          CALL      RSWBDVE1                     * position in file outeadaf
WDEV1000  CALL      RKWBDVE1                     * read next record
          BRANCH    OVRCD,WDEV9999               * end of file
.
          PACK      WBDECLID,WBDECLID,SP70
.
          MATCH     ECCLCLID,WBDECLID            * same claim id ?
          GOTO      WDEV9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBDERPTC,WBDERPTC,SP70
.
          MATCH     ECCLRPTC,WBDERPTC            * same report counter ?
          GOTO      WDEV9999 IF NOT EQUAL        * no - finished listing
.
          PACK      WBDERKEY,WBDERKEY,SP70
.
          MATCH     ECCLRKEY,WBDERKEY            * same report retrieve key?
          GOTO      WDEV1000 IF NOT EQUAL        * no - finished listing
.
          CALL      WDEVRW00
.
          GOTO      WDEV1000
.
WDEV9999  RETURN
+
.------------------------------------------------------------
. Eclipse DVAW Claim Medical Event Details (TABLE HEADING)
.------------------------------------------------------------
WDEVHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Event Date&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Event Id&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Status Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Status Text&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Member Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Member Ref&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Family Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Given Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Services&nbsp;</td>":
                             "</tr>"

WDEVHD99  RETURN
+
.------------------------------------------------------------
. Eclipse DVAW Medical Event (Detail Row)
.------------------------------------------------------------
WDEVRW00  MOVE      ZERO,FORM1
.-------- MOVE      "Unknown",ASESDESC
.-------- MOVE      OTEHCFAC,ANS
.-------- REP       "A1R2W3C4",ANS
.-------- MOVE      ANS,FORM1
.------- -LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4
.
.         MOVE      ZERO,FORM1
.         MOVE      "No Change",MEDSDESC
.         MOVE      OTEHMECF,ANS
.         REP       "A1I2C3W4S5X6",ANS
.         MOVE      ANS,FORM1
.         LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
.                                  MEDSDES5,MEDSDES6
.
.-------- MOVE      ZERO,FORM2
.-------- MOVE      "UNKNOWN",PRCSDESC
.-------- MOVE      OTEHSTAT,FORM2
.-------- LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
.--------                          PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
.--------                          PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
.--------                          PRCSDE10,PRCSDE11
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBDEEVDT
          IF        !@EQUAL & !@EOS
            UNPACK    WBDEEVDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
          ENDIF
.
.         MOVE      ZERO,FORM6P2
.         UNPACK    OTEHCLBP,DIM6,DIM2
.         PACK      DIM9,DIM6,DOT,DIM2
.         MOVE      DIM9,FORM6P2
.
.         MOVE      SP70,DIM30
.         IF        FORM6P2 = ZERO
.           MOVE      "<br>[No Payment Report]",DIM30
.         ENDIF
.
.         MOVE      ZERO,FORM6P2A
.         UNPACK    OTEHCLCA,DIM6,DIM2
.         PACK      DIM9,DIM6,DOT,DIM2
.         MOVE      DIM9,FORM6P2A
.
.         MOVE      SP70,DIM11
.         MATCH     SP70,OTEHSDAT
.         IF        !@EQUAL & !@EOS
.           UNPACK    OTEHSDAT,CCENT,CYEAR,CMON,CDAY
.           MOVE      CMON,F2
.           LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.           PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
.         ENDIF
.
          MOVE      WBDEPTST,DIM100
.
          WRITE     HTMLFILE;"<td valign=top>",DIM11,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBDEEVID,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBDEPTSC,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",DIM100,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBDEPTMN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBDEPTMR,"</td>";
.         WRITE     HTMLFILE;"<td valign=top>",WBDEPTMR,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBDEPTFN,"</td>";
.         WRITE     HTMLFILE;"<td valign=top>",WBDEPTGN,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBDEPTGN,"</td>";
.
.-------- Service Details
.
          REP       "##~",WBDECLID
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=11":
                             "&template=005":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&mavmodul=",MAVMODUL:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclclid=",WBDECLID:
                             "&ecclrptc=",WBDERPTC:
                             "&ecclevtc=",WBDEMEVC:
                             "&ecclrkey=",WBDERKEY,"#";'>":
                             "</td>":
                             "</tr>";
.
          REP       "~##",WBDECLID
.
WDEVRW99  RETURN
+
.------------------------------------------------------------
. Table of Eclipse DVAW Assessment Report
.------------------------------------------------------------
WDAR0000  MATCH     "1",PTCNWSIN
          GOTO      WDAR9999 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      WDAR9999 IF NOT EQUAL
.
          CALL      WDARHD00      * Output Table Heading
.
          PACK      KEY57,WBDWTRID,Z70
          CALL      RSWBDVD2
WDAR1000  CALL      RPWBDVD2      * Get Assessment Header - outeahaf
          BRANCH    OVRCD,WDAR9999
.
          MATCH     WBDWTRID,WBDDTRID
          GOTO      WDAR9999 IF NOT EQUAL
.
          CALL      WDARRW00
.
          GOTO      WDAR1000
.
WDAR9999  RETURN
+
.------------------------------------------------------------
. Eclipse DVAW Assessment Report (TABLE HEADING)
.------------------------------------------------------------
WDARHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim Benefit Paid&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim Charge Amount&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Date of Service&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Patient Family Name&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Patient First Name&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Medicare Card Flag&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Medicare Card Number&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Medicare Reference Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Servicing Provider Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Status&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim Transaction Id&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medical Event Details&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Report Details&nbsp;</td>":
                             "</tr>"
.
WDARHD99  RETURN
+
.------------------------------------------------------------
. WebServices DVAW Assessment Report (Detail Row)
.------------------------------------------------------------
WDARRW00  MOVE      ZERO,FORM1
.-------- MOVE      "Unknown",ASESDESC
.-------- MOVE      OTEHCFAC,ANS
.-------- REP       "A1R2W3C4",ANS
.-------- MOVE      ANS,FORM1
.------- -LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4
.
.         MOVE      ZERO,FORM1
.         MOVE      "No Change",MEDSDESC
.         MOVE      OTEHMECF,ANS
.         REP       "A1I2C3W4S5X6",ANS
.         MOVE      ANS,FORM1
.         LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
.                                  MEDSDES5,MEDSDES6
.
.-------- MOVE      ZERO,FORM2
.-------- MOVE      "UNKNOWN",PRCSDESC
.-------- MOVE      OTEHSTAT,FORM2
.-------- LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
.--------                          PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
.--------                          PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
.--------                          PRCSDE10,PRCSDE11
.
          MOVE      ZERO,FORM7P2
          RJUSTIFY  WBDDCLBP
          UNPACK    WBDDCLBP,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
.
          MOVE      SP70,DIM30
          IF        FORM7P2 = ZERO
            MOVE      "<br>[No Payment Report]",DIM30
          ENDIF
.
          MOVE      ZERO,FORM7P2A
          RJUSTIFY  WBDDCLCA
          UNPACK    WBDDCLCA,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2A
.
.         MOVE      SP70,DIM11
.         MATCH     SP70,OTEHSDAT
.         IF        !@EQUAL & !@EOS
.           UNPACK    OTEHSDAT,CCENT,CYEAR,CMON,CDAY
.           MOVE      CMON,F2
.           LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.           PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP70
.         ENDIF
.
          WRITE     HTMLFILE;"<tr><td valign=top>",WBDDCLID,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",FORM7P2,DIM30,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",FORM7P2A,"</td>";
.
          MATCH     SP70,WBDDSRVP
          IF        !@EQUAL
.
            PACK      KEY20,WBDDSRVP,SP70
            CALL      RSPMHCP3
            CALL      RKPMHCP3
            BRANCH    OVRCD,WDARRW50
.
            MATCH     WBDDSRVP,PMHCPRV1
            GOTO      WDARRW50 IF NOT EQUAL
.
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
.
            WRITE     HTMLFILE;"<td valign=top>",WBDDSRVP,"&nbsp;&nbsp;&nbsp;",DOCFNAME,"</td>";
.
          ELSE
.
WDARRW50    WRITE     HTMLFILE;"<td valign=top>",WBDDSRVP,"</td>";
.
          ENDIF
.
          WRITE     HTMLFILE;"<td valign=top>",WBDDSTAT,"</td>";
          WRITE     HTMLFILE;"<td valign=top>",WBDDTRID,"</td>";
.
.-------- Medical Event Details
.
          REP       " +",URNUMBER
          REP       " +",UNIQNUMB
          REP       " +",MAVINVCE
          REP       " +",MAVBATCH
          REP       " +",MAVMODUL
          REP       " +",PRHRE001
          REP       " +",PRHRE002
          REP       " +",PRHRE003
          REP       " +",WBDDCLID
          REP       "##~",WBDDCLID
          REP       " +",WBDDRPTC
          REP       " +",WBDDTRID
          REP       " +",WBDDRKEY
.
          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='location.href=#"eclweb73.pbl":
                             "?reportno=11":
                             "&template=004":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&mavmodul=",MAVMODUL:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclclid=",WBDDCLID:
                             "&ecclrptc=",WBDDRPTC:
                             "&ecclrkey=",WBDDRKEY,"#";'>":
                             "</td>";

          WRITE     HTMLFILE;"<td align=center valign=top>":
                             "<img src=#"../images/CommentIcon.gif#"":
                             " onclick='displayJSON(#"../cgi-bin/eclweb73.pbl":
                             "?reportno=11":
                             "&template=006":
                             "&urnumber=",URNUMBER:
                             "&uniqnumb=",UNIQNUMB:
                             "&mavinvce=",MAVINVCE:
                             "&mavbatch=",MAVBATCH:
                             "&mavmodul=",MAVMODUL:
                             "&prhre001=",PRHRE001:
                             "&prhre002=",PRHRE002:
                             "&prhre003=",PRHRE003:
                             "&ecclclid=",WBDDCLID:
                             "&ecclrptc=",WBDDRPTC:
                             "&ecclstrd=",WBDDTRID:
                             "&ecclrkey=",WBDDRKEY,"#");'>":
                             "</td>":
                             "</tr>";
.
          REP       "+ ",URNUMBER
          REP       "+ ",UNIQNUMB
          REP       "+ ",MAVINVCE
          REP       "+ ",MAVBATCH
          REP       "+ ",MAVMODUL
          REP       "+ ",PRHRE001
          REP       "+ ",PRHRE002
          REP       "+ ",PRHRE003
          REP       "+ ",WBDDCLID
          REP       "~##",WBDDCLID
          REP       "+ ",WBDDRPTC
          REP       "+ ",WBDDTRID
          REP       "+ ",WBDDRKEY
.
WDARRW99  RETURN
+
.*****************************************************************************
          INC       ACCDIAIO/INC
          INC       APSMASIO/INC
          INC       ARCVX1IO/INC
          INC       BOKDIAIO/INC
          INC       BOKRC1IO/INC
          INC       BOKRX1IO/INC
          INC       EMRICDIO/INC
          INC       EMRUNKIO/INC
          INC       EMRVISIO/INC
          INC       EMRECTIO/INC
          INC       EMRECAIO/INC
          INC       EMRIBHIO/INC
          INC       HICEMSIO/INC
          INC       MLTSECIO/INC
          INC       OUTEADIO/INC
          INC       OUTEAHIO/INC
          INC       OUTECAIO/INC
          INC       OUTECTIO/INC
          INC       OUTERHIO/INC
          INC       OUTERDIO/INC
          INC       OUTIBHIO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PATDGWIO/INC
.         INC       PATCHCIO/INC
          INC       VISMDTIO/INC
          INC       VISMTXIO/INC
          INC       PATDO1IO/INC
.         INC       PATFACIO/INC
          INC       PATDSCIO/INC
          INC       PATFLTIO/INC
.         INC       PATPEIIO/INC
          INC       PATIN1IO/INC
          INC       PATITMIO/INC
          INC       PATMA1IO/INC
          INC       PATMMBIO/INC
.         INC       PATPA1IO/INC
          INC       PATPR1IO/INC
          INC       PATMI1IO/INC
          INC       PATRE1IO/INC
.         INC       PATRGMIO/INC
          INC       PATTRNIO/INC
          INC       PATVISIO/INC
          INC       NZPSPRIO/INC
.         INC       MEHVI1IO/INC
.         INC       MEHLEGIO/INC
          INC       PATWR1IO/INC
          INC       PATWC1IO/INC
          INC       PMSCLTIO/INC
          INC       PMSWX1IO/INC
.         INC       ACCCMTIO/INC   * ACC Comments File
          INC       ACCLODIO/INC   * ACC Claim Lodgements
.         INC       PMSTLEIO/INC            * Patient Titles table
          INC       PMSWORIO/INC
          INC       PATWVEIO/INC
          INC       PMSEVTIO/INC
          INC       PATEORIO/INC
          INC       PATFN1IO/INC
          INC       OUTBOAIO/INC
          INC       OUTCANIO/INC
          INC       OUTRSHIO/INC
          INC       OUTBB1IO/INC
          INC       OUTMA1IO/INC
          INC       OUTHEDIO/INC
          INC       OUTSITIO/INC
          INC       OUTSESIO/INC
          INC       OUTCLIIO/INC
          INC       OUTCTYIO/INC
          INC       MRTAUCIO/INC
          INC       MRTLOCIO/INC
          INC       MRTMASIO/INC
          INC       MRTHISIO/INC
          INC       MRTSTFIO/INC
          INC       MRTPDSIO/INC
          INC       MRTVISIO/INC 
          INC       PATECOIO/INC
          INC       PATECDIO/INC
.         INC       PATGSRIO/INC
          INC       PATICDIO/INC
          INC       PATICOIO/INC
          INC       PATICUIO/INC
          INC       PATINVIO/INC
          INC       PATNIDIO/INC
          INC       PATALRIO/INC
          INC       PATPGRIO/INC
          INC       PATVADIO/INC
          INC       RESLNKIO/INC
          INC       PATW11IO/INC                                       *I-43498
          INC       PATW12IO/INC            * WIES12                   *I-51504
          INC       PTW12BIO/INC            * WIES12B
          INC       PATW13IO/INC            * WIES13
          INC       PATW14IO/INC            * WIES14                  *I-145161
          INC       PATW15IO/INC            * WIES15
          INC       PATW16IO/INC            * WIES16
          INC       PATW17IO/INC            * WIES17
          INC       PATWMAIO/INC
.         INC       PMSCDNIO/INC
          INC       PMSCTCIO/INC
          INC       PMSOVRIO/INC
          INC       PMSOVVIO/INC
.
..          INC       PMSHCGIO/INC
..          INC       PMSHCPIO/INC
.
          INC       PMSPX2IO/INC
..          INC       WATSUSIO/INC
          INC       BOKRECTM
          INC       CLPMSVX1
          INC       CLWEBSDD
          INC       CLWEBDVH
          INC       CLWEBDVI
          INC       DGCLICAC
          INC       DGCLICEC
          INC       DGCLICOB
          INC       GCCARD00
          INC       NZPSPRTM
          INC       PATDOCTM
..          INC       PATDOCCD
          INC       PATNAMCD
          INC       PMIGTNID
          INC       PMSHCGTM
          INC       PMSHCPTM
          INC       PATMASTM
          INC       CLPMSPX2
          INC       CLPMSRES
          INC       PMSPX2TM
          INC       PATMSXTM
          INC       PATMISTM
          INC       PATCLMTM
          INC       PATRE1TM                * Person Responsible for Account
          INC       PATVISTM
          INC       PATDSCTM
          INC       PRIHRETM
          INC       PMSCLTTM
.          INC       OBSCNATM
.          INC       OBSDIATM
          INC       PMSWORTM
          INC       NAMSTRCD
          INC       IBAWEBCD
          INC       GETDRG
          INC       CALCAGE
.          INC       OBSCNAPR
          INC       CLPATMAS
          INC       CLPATMIS
          INC       CLPATDSC
          INC       CLPATDOC
          INC       CLPATVIS
          INC       CLWEBBRH
          INC       CLWEBBRD
          INC       CLWEBB2B
          INC       DAYOFWEK
          INC       DGCLICUP
.         INC       PMSCDNDS
          INC       WEBB2BTM
.
          INC       PATASFIO/INC
          INC       PATSFAIO/INC
          INC       PATDADIO/INC
          INC       PMSAIDIO/INC
          INC       PMSCCDIO/INC   * Concession Card Details
          INC       PMSVX1IO/INC
          INC       AAEDI1IO/INC
          INC       AAEDE1IO/INC
          INC       PATHSPIO/INC
          INC       OUTDIAIO/INC
          INC       OUTRF1IO/INC
          INC       ALLREFIO/INC
          INC       ALLRLNIO/INC
          INC       ALLENCIO/INC
          INC       WATTR1IO/INC
          INC       WATTX1IO/INC
          INC       ALLDEPIO/INC
          INC       OPRDEAIO/INC
          INC       PATCMCIO/INC
          INC       PATCFAIO/INC
.         INC       PATUNAIO/INC
          INC       PATMESIO/INC
          INC       PATFX1IO/INC
          INC       PRIPRAIO/INC
          INC       PRISECIO/INC
          INC       PRIALSIO/INC
          INC       PRIECTIO/INC
          INC       PRIECAIO/INC
          INC       PRIEAHIO/INC
          INC       PRIEADIO/INC
          INC       PRIESHIO/INC
          INC       PRIESDIO/INC
          INC       PRIINVIO/INC
          INC       PMSECOIO/INC
          INC       PMSETRIO/INC
          INC       PRIIBHIO/INC
          INC       PRIHDBIO/INC                 * holding header file
          INC       PRIHREIO/INC                 * holding referral file
          INC       PRIDTRIO/INC
          INC       RCPDTEIO/INC
.
.        ******* HPS BLR INCLUDE ENDS HERE          ************
.
          INC       WEBDATCD
          INC       CLPMSNUT
          INC       CLPMSCLT
          INC       PATFFLAB
          INC       PMSNUTIO/INC
          INC       PMSRESIO/INC
          INC       PMSNUTTM     
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       CLNHIMAS
.          INC       OBSRESIO/INC
.          INC       OBSPHYIO/INC
.          INC       OBSCALIO/INC
.          INC       OBSDITIO/INC
.          INC       OBSMEDIO/INC
.          INC       OBSPINIO/INC
.          INC       OBSCNCIO/INC
.          INC       OBSCNAIO/INC
.          INC       OBSCNBIO/INC
.          INC       OBSDIAIO/INC
.          INC       OBSBPHIO/INC
.          INC       OBSBHIIO/INC
.          INC       OBSLABIO/INC
.          INC       OBSPROIO/INC
.          INC       OBSREAIO/INC
          INC       VISPAYIO/INC
          INC       ALLCASIO/INC
          INC       WEBB2BIO/INC
          INC       WEBIMCIO/INC
          INC       WEBIMAIO/INC
          INC       WEBIMBIO/INC
          INC       WEBIMDIO/INC
          INC       WEBIMEIO/INC
          INC       WEBIMFIO/INC
          INC       WEBIMGIO/INC
          INC       WEBIMHIO/INC
          INC       WEBIHCIO/INC
          INC       WEBIHAIO/INC
          INC       WEBIHBIO/INC
          INC       WEBIHDIO/INC
          INC       WEBIHEIO/INC
          INC       WEBIHFIO/INC
          INC       WEBIHGIO/INC
          INC       WEBIHHIO/INC
          INC       WEBETRIO/INC
          INC       WEBECOIO/INC
          INC       WEBPCAIO/INC
          INC       WEBPCBIO/INC
          INC       WEBPCIIO/INC
          INC       WEBPCEIO/INC
          INC       WEBPCFIO/INC
          INC       WEBPCGIO/INC
          INC       WEBSDDIO/INC
          INC       WEBBBSIO/INC
          INC       WEBBBAIO/INC
          INC       WEBBBBIO/INC
          INC       WEBBBDIO/INC
          INC       WEBBBEIO/INC
          INC       WEBBBFIO/INC
          INC       WEBBRHIO/INC
          INC       WEBBRDIO/INC
.
          INC       WEBDVWIO/INC
          INC       WEBDVAIO/INC
          INC       WEBDVBIO/INC
          INC       WEBDVDIO/INC
          INC       WEBDVEIO/INC
          INC       WEBDVFIO/INC
          INC       WEBDVHIO/INC
          INC       WEBDVIIO/INC
.
          INC       TMPALIIO/INC
          INC       PMSEDGIO/INC       * Effective DRG Dates
          INC       RSHWEBCD
          INC       NZHISWIO
          INC       AAEMASTM
          INC       CLOUTHED
          INC       FHRDATCD
          INC       GETEFDRG

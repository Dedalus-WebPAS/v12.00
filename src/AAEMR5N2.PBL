.******************************************************************************
.* System         : Accident and Emergency                                    *
.*                                                                            *
.* Include Name   : AAEMR5N2                                                  *
.*                                                                            *
.* Author         : Beavis and Butthead                                       *
.*                                                                            *
.* Function       : To print the A&E MR5 details - Layout 2 - User defined    *
.*                                                                            *
.* NOTE           : make sure the ibavaraf file is updated !!!!!              *
.*                                                                            *
.* Modifications  :                                                           *
.******************************************************************************
.*         V12.00.01 14/05/2025  J.Tan          TSK 0955096                   *
.*                   Added alpanumeric visit number generation                *
.*         V11.02.01 21/01/2022  Jacob Jackson TSK 0864505                    *
.*                   Added preferred name option fields                       *
.*                   MR5209, MR5210, MR5211, MR5212, MR5213                   *
.* V11.00.01 17/11/2020   Thanh T       TSHK 0878747                          *
.*           Added MR5208 - multiple birth details                            * 
.******************************************************************************
.*         V10.14.01 19/02/2019  Ebon Clements TSK 0867703                    *
.*                   Changed NHI ethnicity file reads to use KEY5             *
.*         V10.10.01 17/03/2017  Thanh T.      TSK 0832066                    *
.*                   Changed DVA PREPAT/PMPXDVAC fields to use the new        *
.*                   concession card PMCDCNUM/PMCDDVAC fields                 *
.*         V10.03.01 29/11/2011 Jill Parkinson CAR 249362                     *
.*                   Changed alert key from key13 to key16                    *
.*         V10.02.01 07/06/2011 Ebon Clements    CAR 239530                   *
.*                   Added print extra contact functionality                  *
.*         V9.05.01  24/03/2006  Peter Vela CAR 61299                         *
.*                   Increased field no size from DIM3 to DIM5                *
.*         V5.08.01  05/05/2000  Tonii                                        *
.*                   Mods to make 'Medicare Reference Number' available in    *
.*                   Stationary templating for A&E forms. Added new label     *
.*                   MR2M5207.                                                *
.******************************************************************************
.*            V5.07.01  27/10/98  Katie Nelson                                *
.*                      Removed the include PATPAOFS                          *
.*            V5.07     06/10/98  Jim Stathopoulos                            *
.*                      507 Changes                                           *
.******************************************************************************
.*        V5.05.01  13/01/1998  Nick     SRF 643695                           *
.*                  Added PNKADD4,PKADD4,PADD4,PTMXECA4                       *
.******************************************************************************
.*        V5.04.03  08/04/1997  Howellsy                                      *
.*                  Added PTMXCELL,PTMXADD1-4,PTMXPOST,NHMAETH1-3,NHMARES,PSMOK
.*        V5.03.05  03/05/1996    Steve Armstrong  SRF 641430                 *
.*                  added PMI UD field 2, 3, 4, 5, 6                          *
.*        V5.03.04  16/04/1996    Howellsy   5.04                             *
.*                  Added User Defined 6-8 Codes & Descriptions               *
.*        V5.03.03  09/04/1996    Howellsy                                    *
.*                  Only print the length (IBDTPLEN) of a text item.          *
.*        V5.03.02  27/10/1995    Justin Coates  (SUHT mods)                  *
.*                  added alerts                                              *
.*        V5.03.01  27/06/1995    Justin Coates  SRF 600912                   *
.*                  added PMI UD field 1                                      *
.******************************************************************************
.*                  25/03/90 Graeme Williams                                  *
.*                  Added complaint/diagnosis and Added years resident        *
.*                  21/06/90 J.Tan                                            *
.*                  Initialised variable                                      *
.*                  01/11/90 J.Tan     SRF 106894                             *
.*                  Added lots of variables                                   *
.*        V5.01.02  29/01/91 J.Tan  SRF 106960                                *
.*                  Mods to have priority, workcare insurance company etc.    *
.*        V5.01.03  16/03/92 J.Tan  SRF 113642                                *
.*                  Added variables from visit card information               *
.*        V5.01.04  16/09/1993    LOFTY          (DUDLEY changes)             *
.*                  added new variables from details file                     *
.*        V5.01.05  30/11/93  ROD                (DUDLEY changes)             *
.*                  added new variables for GP Practice address & fix GPcount *
.*        V5.01.06  30/05/94  Rob Leonard        (Taranaki changes)           *
.*                  Added new variable - Medical Alert                        *
.*        V5.02.01  11/12/1994  Graeme Williams                               *
.*                  Added option for a fifth priority code                    *
.*        V5.02.02  03/01/1995  Graeme Williams   SRF 134242                  *
.*                  Added national id number                                  *
.*        V5.02.03  12/04/1995  Greg Horvat      SRF 135636                   *
.*                  Added hospital approval & hospital file numbers           *
.*        V5.02.04  16/05/1995  Paul Howells         SRF 134950               *
.*                  Changed Priority Code to a hospital controlled code       *
.******************************************************************************
.
LINMR5N2  DISPLAY   *P1:24,*EL,*P40:24,*V2LON,"** Generating Lineup **";
          CALL      OPNPRINT                  * open the spool file
          PRINT     *N;
          MOVE      ONE,CURRROW
          PACK      KEY12,HEMR5COD,SP6         * position on details file
          CALL      RSIBDET1
          CALL      RKIBDET1
          BRANCH    OVRCD,LN2M5990
.
          MATCH     HEMR5COD,IBDTSCOD          * match stationary codes
          GOTO      LN2M5990 IF NOT EQUAL
.
          MOVE      IBDTROW,LASTROW
.
          COMPARE   CURRROW,IBDTROW           * compare rows
          GOTO      LN2M5200 IF EQUAL
.
.------ print new-lines until current row equals the one read in ------
.
LN2M5000  PRINT     *N;
          ADD       ONE,CURRROW
.
          COMPARE   CURRROW,IBDTROW           * compare rows
          GOTO      LN2M5200 IF EQUAL
.
          GOTO      LN2M5000
.
.------ read through the details file ------
.
LN2M5100  CALL      RKIBDET1
          BRANCH    OVRCD,LN2M5900
.
          MATCH     HEMR5COD,IBDTSCOD          * match stationary codes
          GOTO      LN2M5900 IF NOT EQUAL
.
          MOVE      IBDTROW,LASTROW
.
          COMPARE   CURRROW,IBDTROW           * compare rows
          GOTO      LN2M5200 IF EQUAL
.
.------ print new-lines until current row equals the one read in ------
.
LN2M5110  PRINT     *N;
          ADD       ONE,CURRROW
.
          COMPARE   CURRROW,IBDTROW           * compare rows
          GOTO      LN2M5200 IF EQUAL
.
          GOTO      LN2M5110
.
.------ branch on field indicator ------
.
LN2M5200  BRANCH    IBDTINDC,LN2M5300,LN2M5400
.
.------ field is a text field ------
.
LN2M5300  PRINT     *IBDTCOL,IBDTTXFL;
          GOTO      LN2M5100
.
.------ field is a data field ------
.
LN2M5400  MOVE      IBDTTXFL,DIM5
          MOVE      DIM5,FORM5
.
          BRANCH    FORM5,LN2M5450,LN2M5450,LN2M5450,LN2M5430,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:      10
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:      20
                          LN2M5450,LN2M5440,LN2M5460,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5470,LN2M5500,LN2M5450,LN2M5450:      30
                          LN2M5450,LN2M5450,LN2M5490,LN2M5460,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5510,LN2M5450:      40
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5470:      50
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:      60
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:      70
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:      80
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:      90
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5440,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     100
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5460:
                          LN2M5460,LN2M5460,LN2M5450,LN2M5450,LN2M5450:     110
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     120
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5430,LN2M5440,LN2M5450,LN2M5450:     130
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     140
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     150
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     160
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     170
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     180
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:        
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     190
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     200
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     210
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     220
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:     230
                          LN2M5450,LN2M5450,LN2M5450,LN2M5450,LN2M5450:
                          LN2M5450,LN2M5450
.
.------ format patients age ------
.
LN2M5430  MOVE      "999",VARIABLE
          GOTO      LN2M5600
.
.------ format full date fields ------
.
LN2M5440  MOVE      "99/99/9999",VARIABLE
          GOTO      LN2M5600
.
.------ format all other Dim fields ------
.
LN2M5450  PACK      VARIABLE,X100,X27
          GOTO      LN2M5600
.
.------ format time variables ------
.
LN2M5460  MOVE      "99:99",VARIABLE
          GOTO      LN2M5600
.
.------ format birth date ------
.
LN2M5470  MOVE      "99/99/9999",VARIABLE
          GOTO      LN2M5600
.
.------ format doctors name ------
.
LN2M5490  MOVE      "X.XXXXXXXXXXXXXXXXXXXX",VARIABLE
          GOTO      LN2M5600
.
.------ format A & E number ------
.
LN2M5500  MOVE      "99999999",VARIABLE
          GOTO      LN2M5600
.
.------ format year variables ------
.
LN2M5510  MOVE      "99",VARIABLE
          GOTO      LN2M5600
.
.------ only print amount of variable specified ------
.
LN2M5600  RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      LN2M5100
.
.------ line-up completed ------
.
LN2M5900  MOVE      FALSE,EXIT
.
.------ print new-lines until we reach the end of the page ------
.
LN2M5910  PRINT     *N;
          ADD       ONE,LASTROW
.
          COMPARE   LASTROW,IBTHLENG            * compare rows
          GOTO      LN2M5999 IF EQUAL
.
          GOTO      LN2M5910
.
.------ no details on file ------
.
LN2M5990  MOVE      TRUE,EXIT
.
LN2M5999  CALL      CLSPRINT
          RETURN
.
.*********************************************************************
.         Print the patients MR5 
.*********************************************************************
PRTMR5N2  CALL      OPNPRINT
          PRINT     *N;
          MOVE      ONE,CURRROW
          PACK      KEY12,HEMR5COD,SP6
          CALL      RSIBDET1                   * position on the details file
          CALL      RKIBDET1
          BRANCH    OVRCD,PR2M9990
.
          MATCH     HEMR5COD,IBDTSCOD           * match stationary codes
          GOTO      PR2M9990 IF NOT EQUAL
.
          MOVE      IBDTROW,LASTROW
.
          COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      PR2M5200 IF EQUAL
.
.------ print new-lines until current row equals the one read in ------
.
PR2M5000  PRINT     *N;
          ADD       ONE,CURRROW
.
          COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      PR2M5200 IF EQUAL
.
          GOTO      PR2M5000
.
.------ read through the details file ------
.
PR2M5100  CALL      RKIBDET1
          BRANCH    OVRCD,PR2M9900
.
          MATCH     HEMR5COD,IBDTSCOD           * match stationary codes
          GOTO      PR2M9900 IF NOT EQUAL
.
          MOVE      IBDTROW,LASTROW
.
          COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      PR2M5200 IF EQUAL
.
.------ print new-lines until current row equals the one read in ------
.
PR2M5110  PRINT     *N;
          ADD       ONE,CURRROW
.
          COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      PR2M5200 IF EQUAL
.
          GOTO      PR2M5110
.
.------ branch on the field type ------
.
PR2M5200  BRANCH    IBDTINDC,PR2M5300,PR2M5400
.
.------ the field is a text field ------
.
PR2M5300  RESET     IBDTTXFL,IBDTPLEN
          LENSET    IBDTTXFL
          RESET     IBDTTXFL 
          PRINT     *IBDTCOL,*+,IBDTTXFL;
          GOTO      PR2M5100
.
.------ the field is a data field ------
.
PR2M5400  MOVE      IBDTTXFL,DIM5
          MOVE      DIM5,FORM5
          PACK      VARIABLE,SP30,SP30,SP30,SP30,SP10
          BRANCH    FORM5,MR5001,MR5002,MR5003,MR5004,MR5005:
                          MR5006,MR5007,MR5008,MR5009,MR5010:      10
                          MR5011,MR5012,MR5013,MR5014,MR5015:
                          MR5016,MR5017,MR5018,MR5019,MR5020:      20
                          MR5021,MR5022,MR5023,MR5024,MR5025:
                          MR5026,MR5027,MR5028,MR5029,MR5030:      30
                          MR5031,MR5032,MR5033,MR5034,MR5035:
                          MR5036,MR5037,MR5038,MR5039,MR5040:      40
                          MR5041,MR5042,MR5043,MR5044,MR5045:
                          MR5046,MR5047,MR5048,MR5049,MR5050:      50
                          MR5051,MR5052,MR5053,MR5054,MR5055:
                          MR5056,MR5057,MR5058,MR5059,MR5060:      60
                          MR5061,MR5062,MR5063,MR5064,MR5065:
                          MR5066,MR5067,MR5068,MR5069,MR5070:      70
                          MR5071,MR5072,MR5073,MR5074,MR5075:
                          MR5076,MR5077,MR5078,MR5079,MR5080:      80
                          MR5081,MR5082,MR5083,MR5084,MR5085:
                          MR5086,MR5087,MR5088,MR5089,MR5090:      90
                          MR5091,MR5092,MR5093,MR5094,MR5095:
                          MR5096,MR5097,MR5098,MR5099,MR5100:     100
                          MR5101,MR5102,MR5103,MR5104,MR5105:
                          MR5106,MR5107,MR5108,MR5109,MR5110:     110
                          MR5111,MR5112,MR5113,MR5114,MR5115:
                          MR5116,MR5117,MR5118,MR5119,MR5120:     120
                          MR5121,MR5122,MR5123,MR5124,MR5125:
                          MR5126,MR5127,MR5128,MR5129,MR5130:     130
                          MR5131,MR5132,MR5133,MR5134,MR5134:
                          MR5134,MR5134,MR5134,MR5134,MR5140:     140
                          MR5140,MR5140,MR5140,MR5140,MR5140:
                          MR5146,MR5147,MR5148,MR5149,MR5150:     150
                          MR5151,MR5152,MR5152,MR5152,MR5152:
                          MR5152,MR5152,MR5152,MR5152,MR5152:     160
                          MR5152,MR5152,MR5152,MR5152,MR5152:
                          MR5152,MR5152,MR5152,MR5152,MR5152:     170
                          MR5152,MR5152,MR5152,MR5152,MR5152:
                          MR5152,MR5152,MR5152,MR5152,MR5152:     180
                          MR5152,MR5153,MR5154,MR5155,MR5156:
                          MR5157,MR5158,MR5159,MR5160,MR5161:     190
                          MR5162,MR5163,MR5164,MR5165,MR5166:         
                          MR5167,MR5168,MR5169,MR5170,MR5171:     200
                          MR5172,MR5173,MR5174,MR5175,MR5176:
                          MR5177,MR5178,MR5179,MR5180,MR5181:     210
                          MR5182,MR5183,MR5184,MR5185,MR5186: 
                          MR5187,MR5188,MR5189,MR5190,MR5191:     220
                          MR5192,MR5193,MR5194,MR5195,MR5196: 
                          MR5197,MR5198,MR5199,MR5200,MR5201:     230
                          MR5202,MR5203,MR5204,MR5205,MR5206:
                          MR5207,MR5208,MR5209,MR5210,MR5211:     240
                          MR5212,MR5213
      
          GOTO      PR2M9000
.
.------ format the patients surname ------
.
MR5001    MOVE      PSNAME,VARIABLE
          GOTO      PR2M9000
.
.------ format the patients given name ------
.
MR5002    MOVE      PGNAME,VARIABLE
          GOTO      PR2M9000
.
.------ format the patients title ------
.
MR5003    MOVE      PTITL,VARIABLE
          GOTO      PR2M9000
.
.------ format the patients age ------
.
MR5004    MOVE      PSAGE,VARIABLE
          MOVE      THREE,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PR2M9890
.
.------ format the U/R number ------
.
MR5005    MOVE      ADAURNO,VARIABLE
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PR2M9890
.
.------ format the case notes indicator ------
.
MR5006    MOVE      SP1,ANS
          LOAD      ANS,PCASE,CCNOTES
          MOVE      ANS,VARIABLE
          GOTO      PR2M9000
.
.------ format the patients address line 1 ------
.
MR5007    MOVE      PADD1,VARIABLE
          GOTO      PR2M9000
.
.------ format the patients address line 2 ------
.
MR5008    MOVE      PADD2,VARIABLE
          GOTO      PR2M9000
.
.------ format the suburb ------
.
MR5009    MOVE      PSUBRB,VARIABLE
          GOTO      PR2M9000
.
.------ format the post code ------
.
MR5010    MOVE      PPOST,VARIABLE
          GOTO      PR2M9000
.
.------ format the private telephone number ------
.
MR5011    MOVE      PTELEP,VARIABLE
          GOTO      PR2M9000
.
.------ format the person financially responsible name ------
.
MR5012    PACK      PKNAME,SP70,SP10
          MOVE      ADANUMB,KEY8
          CALL      RDRESP1
          MOVE      PKNAME,VARIABLE
          GOTO      PR2M9000
.
.------ format the V.A. Description ------
.
MR5013    CALL      GETVA2                * get the V.A. description
          MOVE      VADESC,VARIABLE
          GOTO      PR2M9000
.
.------ format the W.C.A. Description ------
.
MR5014    CALL      GETWCA2               * get the W.C.A. description
          MOVE      WCDESC,VARIABLE
          GOTO      PR2M9000
.
.------ format the person financially responsible address line 1 ------
.
MR5015    PACK      PKADD1,SP20,SP20
          MOVE      ADANUMB,KEY8
          CALL      RDRESP1               * read responsible for account file
          MOVE      PKADD1,VARIABLE
          GOTO      PR2M9000
.
.------ format the person financially responsible address line 2 ------
.
MR5016    PACK      PKADD2,SP20,SP20
          MOVE      ADANUMB,KEY8
          CALL      RDRESP1               * read responsible for account file
          MOVE      PKADD2,VARIABLE
          GOTO      PR2M9000
.
.------ format the person financially responsible suburb ------
.
MR5017    PACK      PKSUBR,SP20,SP20
          MOVE      ADANUMB,KEY8
          CALL      RDRESP1               * read responsible for account file
          MOVE      PKSUBR,VARIABLE
          GOTO      PR2M9000
.
.------ format the person financially responsible post code ------
.
MR5018    MOVE      SP8,PKPOST
          MOVE      ADANUMB,KEY8
          CALL      RDRESP1               * read responsible for account file
          MOVE      PKPOST,VARIABLE
          GOTO      PR2M9000
.
.------ format insurance status description ------
.
MR5019    MOVE      CODEU1,TCODE
          MOVE      ADAINSUR,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format employer description ------
.
MR5020    MOVE      ADAEMPL,VARIABLE
          GOTO      PR2M9000
.
.------ format the medicare number ------
.
MR5021    MOVE      PMEDI,VARIABLE
          GOTO      PR2M9000
.
.------ format the visit date ------
.
MR5022    UNPACK    ADADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN = 10
            PACK      VARIABLE,CPCDATE,SP30,SP30,SP30
          ELSE
            PACK      VARIABLE,CPDATE,SP30,SP30,SP30
          ENDIF
          GOTO      PR2M9000
.
.------ format the visit time ------
.
MR5023    MOVE      ADATIME,VARIABLE
          GOTO      PR2M9000
.
.------ format the local doctor ------
.
MR5024    MOVE      PLOCDOC,VARIABLE
          GOTO      PR2M9000
.
.------ format the patients occupation ------
.
MR5025    MOVE      POCCUP,VARIABLE
          GOTO      PR2M9000
.
.------ format the patients sex ------
.
MR5026    MOVE      PSEX,VARIABLE
          GOTO      PR2M9000
.
.------ format the patients birth date ------
.
MR5027    UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN = 10
            PACK      VARIABLE,CPCDATE,SP30,SP30,SP30
          ELSE
            PACK      VARIABLE,CPDATE,SP30,SP30,SP30
          ENDIF
          GOTO      PR2M9000
.
.------ format the A&E number ------
.
MR5028    MOVE      ADANUMB,VARIABLE
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PR2M9890
.
.------ format the source of referral (H.D.P Eq.) ------
.
MR5029    MOVE      SP4,SRC4
          MATCH     SP3,ADASRC
          GOTO      MR5029A IF EQUAL
.
          PACK      KEY5 WITH CODES,ADASRC
          CALL      RDCODE1                    * read the patient codes file
          BRANCH    OVRCD,MR5029A
.
          MOVE      THCSCOD,SRC4
.
MR5029A   MOVE      SRC4,VARIABLE
          GOTO      PR2M9000
.
.------ format the situation (H.D.P Eq.) ------
.
MR5030    MOVE      SP4,SIT4
          MATCH     SP3,ADASIT
          GOTO      MR5030A IF EQUAL
.
          PACK      KEY5 WITH CODEES,ADASIT
          CALL      RDCODE1                    * read the patient codes file
          BRANCH    OVRCD,MR5030A
.
          MOVE      THCSCOD,SIT4
.
MR5030A   MOVE      SIT4,VARIABLE
          GOTO      PR2M9000
.
.------ format the mode of arrival (H.D.P Eq.) ------
.
MR5031    MOVE      SP4,MODE4
          MATCH     SP3,ADAMODE
          GOTO      MR5031A IF EQUAL
.
          PACK      KEY5 WITH CODEEA,ADAMODE
          CALL      RDCODE1                    * read the patient codes file
          BRANCH    OVRCD,MR5031A
.
          MOVE      THCSCOD,MODE4
.
MR5031A   MOVE      MODE4,VARIABLE
          GOTO      PR2M9000
.
.------ format previous A & E attendance description ------
.
MR5032    MOVE      CODEEP,TCODE
          MOVE      ADAPREV,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format the doctor allocated name ------
.
MR5033    MOVE      SP30,AEDOCNAM
          PACK      VARIABLE,SP30,SP30,SP30,SP30,SP7
          MATCH     SP6,ADADOCT
          GOTO      MR5033A IF EQUAL
.
          MOVE      ADADOCT,KEY6
          CALL      RDDOCT1                  * read the doctors file
          BRANCH    OVRCD,MR5033A
.
          MOVE      DGNAME,ANS
          PACK      AEDOCNAM,ANS,DOT,DSNAME
.
MR5033A   MOVE      AEDOCNAM,VARIABLE
          GOTO      PR2M9000
.
.------ format the time actually seen ------
.
MR5034    MOVE      ADASEEN,VARIABLE
          GOTO      PR2M9000
.
.------ format the highlight code no 1 (HDP Eq.) ------
.
MR5035    MOVE      SP4,HIGH14
          MATCH     SP3,PHIGH1
          GOTO      MR5035A IF EQUAL
.
          PACK      KEY5 WITH CODEH1,PHIGH1
          CALL      RDCODE1                    * read the patient codes file
          BRANCH    OVRCD,MR5035A
.
          MOVE      THCSCOD,HIGH14
.
MR5035A   MOVE      HIGH14,VARIABLE
          GOTO      PR2M9000
.
.------ format the highlight code no 2 (HDP Eq.) ------
.
MR5036    MOVE      SP4,HIGH24
          MATCH     SP3,PHIGH2
          GOTO      MR5036A IF EQUAL
.
          PACK      KEY5 WITH CODEH2,PHIGH2
          CALL      RDCODE1                    * read the patient codes file
          BRANCH    OVRCD,MR5036A
.
          MOVE      THCSCOD,HIGH24
.
MR5036A   MOVE      HIGH24,VARIABLE
          GOTO      PR2M9000
.
.------ format the highlight code no 3 (HDP Eq.) ------
.
MR5037    MOVE      SP4,HIGH34
          MATCH     SP3,PHIGH3
          GOTO      MR5037A IF EQUAL
.
          PACK      KEY5 WITH CODEH3,PHIGH3
          CALL      RDCODE1                    * read the patient codes file
          BRANCH    OVRCD,MR5037A
.
          MOVE      THCSCOD,HIGH34
.
MR5037A   MOVE      HIGH34,VARIABLE
          GOTO      PR2M9000
.
.------ format the complaint/diagnosis ------
.
MR5038    MOVE      ADADIAG,VARIABLE
          GOTO      PR2M9000
.
.------ format the number of years resident ------
.
MR5039    MOVE      PYRRES,VARIABLE
          MOVE      TWO,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PR2M9890
.
.------ format the health fund ------
.
MR5040    MOVE      PFUNDH,VARIABLE
          GOTO      PR2M9000
.
.------ format health fund table ------
.
MR5041    MOVE      PFNDTB,VARIABLE
          GOTO      PR2M9000
.
.------ format fund membership number ------
.
MR5042    MOVE      PFNDMM,VARIABLE
          GOTO      PR2M9000
.
.------ format employers address line 1 ------
.
MR5043    PACK      WCEADD1,SP20,SP10
          MOVE      ADANUMB,KEY8
          OPEN      PATWC1A1,"patwc1af"
          CALL      RDWCOM1
          CLOSE     PATWC1A1
          MOVE      WCEADD1,VARIABLE
          GOTO      PR2M9000
.
.------ format employers address line 2 ------
.
MR5044    PACK      WCEADD2,SP20,SP10
          MOVE      ADANUMB,KEY8
          OPEN      PATWC1A1,"patwc1af"
          CALL      RDWCOM1
          CLOSE     PATWC1A1
          MOVE      WCEADD2,VARIABLE
          GOTO      PR2M9000
.
.------ format employers address line 3 ------
.
MR5045    PACK      WCEADD3,SP20,SP10
          MOVE      ADANUMB,KEY8
          OPEN      PATWC1A1,"patwc1af"
          CALL      RDWCOM1
          CLOSE     PATWC1A1
          MOVE      WCEADD3,VARIABLE
          GOTO      PR2M9000
.
.------ format employers postcode ------
.
MR5046    MOVE      SP10,WCEPOST
          MOVE      ADANUMB,KEY8
          OPEN      PATWC1A1,"patwc1af"
          CALL      RDWCOM1
          CLOSE     PATWC1A1
          MOVE      WCEPOST,VARIABLE
          GOTO      PR2M9000
.
.------ format employers telephone ------
.
MR5047    MOVE      SP20,WCETELE
          MOVE      ADANUMB,KEY8
          OPEN      PATWC1A1,"patwc1af"
          CALL      RDWCOM1
          CLOSE     PATWC1A1
          MOVE      WCETELE,VARIABLE
          GOTO      PR2M9000
.
.------ format workcare claim number ------
.
MR5048    MOVE      SP20,WCCLMNO
          MOVE      ADANUMB,KEY8
          OPEN      PATWC1A1,"patwc1af"
          CALL      RDWCOM1
          CLOSE     PATWC1A1
          MOVE      WCCLMNO,VARIABLE
          GOTO      PR2M9000
.
.------ format M.A.B. Reference number ------
.
MR5049    MOVE      SP20,MREFNO
          MOVE      ADANUMB,KEY8
          OPEN      PATWMAB1,"patwmabf"
          CALL      RDWMAB1
          CLOSE     PATWMAB1
          MOVE      MREFNO,VARIABLE
          GOTO      PR2M9000
.
.------ format date of accident ------
.
MR5050    MOVE      SP10,MACDAT
          MOVE      ADANUMB,KEY8
          OPEN      PATWMAB1,"patwmabf"
          CALL      RDWMAB1
          CLOSE     PATWMAB1
          MATCH     SP8,MACDAT
          GOTO      PR2M9000 IF EQUAL
.
          UNPACK    MACDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,VARIABLE
          GOTO      PR2M9000
.
.------ format registration number of vehicle ------
.
MR5051    PACK      MCREGO,SP20,SP20
          MOVE      ADANUMB,KEY8
          OPEN      PATWMAB1,"patwmabf"
          CALL      RDWMAB1
          CLOSE     PATWMAB1
          MOVE      MCREGO,VARIABLE
          GOTO      PR2M9000
.
.------ format accident location ------
.
MR5052    PACK      MACLOC,SP20,SP20
          MOVE      ADANUMB,KEY8
          OPEN      PATWMAB1,"patwmabf"
          CALL      RDWMAB1
          CLOSE     PATWMAB1
          MOVE      MACLOC,VARIABLE
          GOTO      PR2M9000
.
.------- format veteran claim number ------
.
MR5053    MOVE      SP20,VCLMNO
          MOVE      ADANUMB,KEY8
          OPEN      PATWVET1,"patwvetf"
          CALL      RDWVET1
          CLOSE     PATWVET1
          MOVE      VCLMNO,VARIABLE
          GOTO      PR2M9000
.
.------ format repat. number ------
.
MR5054    MOVE      THREE,DIM1
          CALL      GCCARD00
          MOVE      PMCDCNUM,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 1 code ------
.
MR5055    MOVE      ADAUSR1,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 1 (H.D.P Eq.) ------
.
MR5056    MOVE      SP4,DIM4
          MATCH     SP3,ADAUSR1
          GOTO      MR5056A IF EQUAL
.
          PACK      KEY5,CODEA1,ADAUSR1
          CALL      RDCODE1
          BRANCH    OVRCD OF MR5056A
          MOVE      THCSCOD,DIM4
.
MR5056A   MOVE      DIM4,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 1 description ------
.
MR5057    MOVE      CODEA1,TCODE
          PACK      ACODE,ADAUSR1,SP10
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format user defined field 2 code ------
.
MR5058    MOVE      ADAUSR2,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 2 (H.D.P Eq.) ------
.
MR5059    MOVE      SP4,DIM4
          MATCH     SP3,ADAUSR2
          GOTO      MR5059A IF EQUAL
.
          PACK      KEY5,CODEA2,ADAUSR2
          CALL      RDCODE1
          BRANCH    OVRCD OF MR5059A
          MOVE      THCSCOD,DIM4
.
MR5059A   MOVE      DIM4,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 2 description ------
.
MR5060    MOVE      CODEA2,TCODE
          PACK      ACODE,ADAUSR2,SP10
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format user defined field 3 code ------
.
MR5061    MOVE      ADAUSR3,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 3 (H.D.P Eq.) ------
.
MR5062    MOVE      SP4,DIM4
          MATCH     SP3,ADAUSR3
          GOTO      MR5062A IF EQUAL
.
          PACK      KEY5,CODEA3,ADAUSR3
          CALL      RDCODE1
          BRANCH    OVRCD OF MR5062A
          MOVE      THCSCOD,DIM4
.
MR5062A   MOVE      DIM4,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 3 description ------
.
MR5063    MOVE      CODEA3,TCODE
          PACK      ACODE,ADAUSR3,SP10
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format the situation code ------
.
MR5064    MOVE      ADASIT,VARIABLE
          GOTO      PR2M9000
.
.------ format the situation description ------
.
MR5065    MOVE      CODEES,TCODE
          MOVE      ADASIT,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format the source of referral code ------
.
MR5066    MOVE      ADASRC,VARIABLE
          GOTO      PR2M9000
.
.------ format the source of referral description ------
.
MR5067    MOVE      CODES,TCODE
          MOVE      ADASRC,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format the highlight code no 1 -------
.
MR5068    MOVE      PHIGH1,VARIABLE
          GOTO      PR2M9000
.
.------ format the highlight code no 1 description -------
.
MR5069    MOVE      CODEH1,TCODE
          MOVE      PHIGH1,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format the highlight code no 2 -------
.
MR5070    MOVE      PHIGH2,VARIABLE
          GOTO      PR2M9000
.
.------ format the highlight code no 2 description -------
.
MR5071    MOVE      CODEH2,TCODE
          MOVE      PHIGH2,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format the highlight code no 3 -------
.
MR5072    MOVE      PHIGH3,VARIABLE
          GOTO      PR2M9000
.
.------ format the highlight code no 3 description -------
.
MR5073    MOVE      CODEH3,TCODE
          MOVE      PHIGH3,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format the mode of arrival ------
.
MR5074    MOVE      ADAMODE,VARIABLE
          GOTO      PR2M9000
.
.------ format the mode of arrival description ------
.
MR5075    MOVE      CODEEA,TCODE
          MOVE      ADAMODE,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format insurance status code ------
.
MR5076    MOVE      ADAINSUR,VARIABLE
          GOTO      PR2M9000
.
.------ format insurance status (H.D.P. Eq.) ------
.
MR5077    MOVE      SP4,DIM4
          MATCH     SP3,ADAINSUR
          GOTO      MR5077A IF EQUAL
.
          PACK      KEY5 WITH CODEU1,ADAINSUR
          CALL      RDCODE1                    * read the patient codes file
          BRANCH    OVRCD,MR5077A
          MOVE      THCSCOD,DIM4
.
MR5077A   MOVE      DIM4,VARIABLE
          GOTO      PR2M9000
.
.------- format claim code -------
.
MR5078    MOVE      ADACOMP,VARIABLE
          GOTO      PR2M9000
.
.------- format claim description -------
.
MR5079    MOVE      CODECL,TCODE
          MOVE      ADACOMP,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format patient classification ------
.
MR5080    MOVE      ADACLASS,VARIABLE
          GOTO      PR2M9000
.
.------ format patient classification (H.D.P.Eq.) ------
.
MR5081    MOVE      SP4,DIM4
          MATCH     SP3,ADACLASS
          GOTO      MR5081A IF EQUAL
.
          PACK      KEY5,CODEA,ADACLASS
          CALL      RDCODE1
          BRANCH    OVRCD OF MR5081A
          MOVE      THCSCOD,DIM4
.
MR5081A   MOVE      DIM4,VARIABLE
          GOTO      PR2M9000
.
.------ format patient classification description ------
.
MR5082    MOVE      CODEA,TCODE
          MOVE      ADACLASS,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format user defined field 4 code ------
.
MR5083    MOVE      ADAUSR4,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 4 (H.D.P Eq.) ------
.
MR5084    MOVE      SP4,DIM4
          MATCH     SP3,ADAUSR4
          GOTO      MR5084A IF EQUAL
.
          PACK      KEY5,CODEA4,ADAUSR4
          CALL      RDCODE1
          BRANCH    OVRCD OF MR5084A
          MOVE      THCSCOD,DIM4
.
MR5084A   MOVE      DIM4,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 4 description ------
.
MR5085    MOVE      CODEA4,TCODE
          PACK      ACODE,ADAUSR4,SP10
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format user defined field 5 code ------
.
MR5086    MOVE      ADAUSR5,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 5 (H.D.P Eq.) ------
.
MR5087    MOVE      SP4,DIM4
          MATCH     SP3,ADAUSR5
          GOTO      MR5087A IF EQUAL
.
          PACK      KEY5,CODEA5,ADAUSR5
          CALL      RDCODE1
          BRANCH    OVRCD OF MR5087A
          MOVE      THCSCOD,DIM4
.
MR5087A   MOVE      DIM4,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 5 description ------
.
MR5088    MOVE      CODEA5,TCODE
          PACK      ACODE,ADAUSR5,SP10
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format workcare company code ------
.
MR5089    MOVE      SP20,WCICODE
          MOVE      ADANUMB,KEY8
          OPEN      PATWC1A1,"patwc1af"
          CALL      RDWCOM1
          CLOSE     PATWC1A1
          MOVE      WCICODE,VARIABLE
          GOTO      PR2M9000
.
.------ format workcare company description ------
.
MR5090    MOVE      SP20,WCICODE
          MOVE      SP30,INAME
          MOVE      ADANUMB,KEY8
          OPEN      PATWC1A1,"patwc1af"
          CALL      RDWCOM1
          CLOSE     PATWC1A1
          BRANCH    OVRCD,MR5090A
.
          MOVE      WCICODE,KEY6
          OPEN      PATIN1A1,"patin1af"
          CALL      RDINSR1
          CLOSE     PATIN1A1
.
MR5090A   MOVE      INAME,VARIABLE
          GOTO      PR2M9000
.
.------ format priority code ------
.
MR5091    MOVE      ADAPRTY,VARIABLE
          GOTO      PR2M9000
.
.------ format priority description ------
.
MR5092    PACK      TCODE,ANSA,ANSA
          MOVE      ADAPRTY,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format the M.A.B. Description ------
.
MR5093    CALL      GETMAB2               * get the M.A.B. description
          MOVE      MADESC,VARIABLE
          GOTO      PR2M9000
.
.------ format the business telephone number ------
.
MR5094    MOVE      PTELEB,VARIABLE
          GOTO      PR2M9000
.
.------ format Comp.elig. from visit card -----
.
MR5095    MOVE      PTVKCOMP,VARIABLE
          GOTO      PR2M9000
.
.------ format Card number from visit card -----
.
MR5096    MOVE      PTVKCARD,VARIABLE 
          GOTO      PR2M9000
.
.------ format Exp. date from visit card -----
.
MR5097    UNPACK    PTVKCEXP,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        IBDTPLEN = 10
            PACK      VARIABLE,CPCDATE,SP30,SP30,SP30
          ELSE
            PACK      VARIABLE,CPDATE,SP30,SP30,SP30
          ENDIF
          GOTO      PR2M9000
.
.------ format Exemp. Type from visit card -----
.
MR5098    MOVE      PTVKCXMP,VARIABLE
          GOTO      PR2M9000
.
.------ format Exemp. Type description from visit card -----
.
MR5099    MOVE      "XM",TCODE
          MOVE      PTVKCXMP,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format Comp.elig. description from visit card -----
.
MR5100    MOVE      "CL",TCODE
          MOVE      PTVKCOMP,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format Referring GP. code -----
.
MR5101    MOVE      AEDARFGP,VARIABLE
          GOTO      PR2M9000
.
.------ format Referring GP. description ------
.
MR5102    PACK      PACFNAME,SP30,SP30,SP20
          PACK      KEY10,AEDARFGP,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCSNAM,PACSNAME
            MOVE      PMHCGNAM,PACGNAME
            MOVE      PMHCTITL,PACTITLE
            MOVE      TWO,PACFRMT
            CALL      PACNAME
          ENDIF
          MOVE      PACFNAME,VARIABLE
          GOTO      PR2M9000
.
.------ format GP practice code ------
.
MR5103    MOVE      "-",ANS
          MATCH     SP2,AEDAGPPT
          IF        @EQUAL
            MOVE      SP1,ANS
          ENDIF
          PACK      VARIABLE,AEDAGPPC,ANS,AEDAGPPT,SP30,SP30
          GOTO      PR2M9000
.
.------ format GP practice description ------
.
MR5104    PACK      PMHGPNAM,SP30
          PACK      KEY10,AEDAGPPC,SP70
          PACK      KEY12,KEY10,AEDAGPPT,SP70
          CALL      RDPMHCG1
          MOVE      PMHGPNAM,VARIABLE
          GOTO      PR2M9000
.
.------ format Time of Initial Assessment ------
.
MR5105    MOVE      AEDATIAS,VARIABLE
          GOTO      PR2M9000
.
.------ format decision to admit time ------
.
MR5106    MOVE      AEDADTAT,VARIABLE
          GOTO      PR2M9000
.
.------ format Time elapsed since incident ------
.
MR5107    MOVE      AEDATESI,VARIABLE
          GOTO      PR2M9000
.
.------ format Employer (Work care) ------
.
MR5108    MOVE      AEDAEMPL,VARIABLE
          GOTO      PR2M9000
.
.------ format RTA Seatbelt details -----
.
MR5109    MOVE      AEDARTAS,VARIABLE
          GOTO      PR2M9000
.
.------ format RTA Seatbelt details description -----
.
MR5110    MOVE      "AR",TCODE
          MOVE      AEDARTAS,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5111    MOVE      AEDAINIT,VARIABLE                      * initiator
          GOTO      PR2M9000
.
MR5112    MOVE      "AI",TCODE
          MOVE      AEDAINIT,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5113    MOVE      AEDAPLIN,VARIABLE                      * place of incident
          GOTO      PR2M9000
.
MR5114    MOVE      "AP",TCODE
          MOVE      AEDAPLIN,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5115    PACK      VARIABLE,PADD4,SP30,SP30,SP30          * patient add 4
          GOTO      PR2M9000
.
MR5116    PACK      VARIABLE,PMHCADR1,SP30,SP30,SP30       * GP add 1
          GOTO      PR2M9000
.
MR5117    PACK      VARIABLE,PMHCADR2,SP30,SP30,SP30       * GP add 2
          GOTO      PR2M9000
.
MR5118    PACK      VARIABLE,PMHCADR3,SP30,SP30,SP30       * GP add 3
          GOTO      PR2M9000
.
MR5119    PACK      VARIABLE,PMHCADR4,SP30,SP30,SP30       * GP add 4
          GOTO      PR2M9000
.
MR5120    PACK      VARIABLE,PMHCPOST,SP30,SP30,SP30       * GP post code
          GOTO      PR2M9000
.
. ------- GP addresses -------
.
MR5121    MOVE      ONE,FORM1
          PACK      VARIABLE,SP30,SP30,SP30
          CLEAR     VARIABLE
          WHILE     FORM1 <= FIVE
            LOAD      KEY35,FORM1,PMHCADR1,PMHCADR2,PMHCADR3,PMHCADR4,PMHCPOST
            APPEND    KEY35,VARIABLE
            RESET     VARIABLE
            STRIP     VARIABLE
            ENDSET    VARIABLE
            APPEND    ", ",VARIABLE
            ADD       ONE,FORM1
          DO
          GOTO      PR2M9000
.
MR5122    MOVE      PMHCSTEL,VARIABLE       * GP Phone
          GOTO      PR2M9000
.
MR5123    MOVE      PMSTAT,VARIABLE                    * marital status
          GOTO      PR2M9000
.
MR5124    MOVE      "M ",TCODE
          MOVE      PMSTAT,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5125    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details 
            MOVE      PMCESNAM,PACSNAME
            MOVE      PMCEGNAM,PACGNAME
            MOVE      PMCETITL,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            PACK      VARIABLE,PACFNAME,SP30,SP30,SP30
          ELSE
            PACK      VARIABLE,PNKNAME,SP30,SP30,SP30    * NOK name
          ENDIF
          GOTO      PR2M9000
.
MR5126    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000
            PACK      VARIABLE,PMCETELP,SP30,SP30,SP30
          ELSE
            PACK      VARIABLE,PNKTELP,SP30,SP30,SP30    * NOK phone
          ENDIF
          GOTO      PR2M9000
.
MR5127    PACK      VARIABLE,AEDANPNA,SP30,SP30,SP30   * number of prev. att
          GOTO      PR2M9000
.
MR5128    UNPACK    AEDADIAS,CCENT,CYEAR,CMON,CDAY    * date of initial ass.
          CALL      PACDATE
          IF        IBDTPLEN = 10
            PACK      VARIABLE,CPCDATE,SP30,SP30,SP30
          ELSE
            PACK      VARIABLE,CPDATE,SP30,SP30,SP30
          ENDIF
          GOTO      PR2M9000
.
MR5129    MOVE      "AE",TCODE                   * Time elapsed description
          MOVE      AEDATESI,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5130    MOVE      SP30,PMHCGNAM
          PACK      KEY10,AEDARFGP,SP70
          CALL      RDPMHCP1
          MOVE      PMHCGNAM,VARIABLE            * GP First Name
          GOTO      PR2M9000
.
MR5131    MOVE      SP30,PMHCSNAM
          PACK      KEY10,AEDARFGP,SP70
          CALL      RDPMHCP1
          MOVE      PMHCSNAM,VARIABLE            * GP Surname 
          GOTO      PR2M9000
.
MR5132    MOVE      AEDACONS,VARIABLE            * consultant on take code
          GOTO      PR2M9000
.
MR5133    PACK      VARIABLE,SP30,SP30,SP30      * consultant on take name
          MOVE      AEDACONS,KEY6
          CALL      RDDOCT1
          IF        OVRCD = ZERO
            MOVE      DSNAME,PACSNAME
            MOVE      DGNAME,PACGNAME
            MOVE      DTITL,PACTITLE
            MOVE      TWO,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- format GP Practice Address details * PMI based -------
.
MR5134    PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          BRANCH    OVRCD,PR2M9000
.
          SUB       "133",FORM5
          LOAD      VARIABLE,FORM5,PMHGADD1,PMHGADD2,PMHGADD3:
                                   PMHGADD4,PMHGPOST,PMHGPTEL
          GOTO      PR2M9000
.
. ------- format GP Practice Address details * A&E based -------
.
MR5140    PACK      KEY10,AEDAGPPC,SP70
          PACK      KEY12,KEY10,AEDAGPPT,SP70
          CALL      RDPMHCG1
          BRANCH    OVRCD,PR2M9000
.
          SUB       "139",FORM5
          LOAD      VARIABLE,FORM5,PMHGADD1,PMHGADD2,PMHGADD3:
                                   PMHGADD4,PMHGPOST,PMHGPTEL
          GOTO      PR2M9000
.
. ------- format Medical Alert --------
.
MR5146    PACK      VARIABLE,SP30,SP30,SP30
          OPEN      PATALRT1,"patalrtf"
          PACK      KEY16,ADAURNO,SP20
          CALL      RSPTALR1
.
MR5146A   CALL      RKPTALR1                * check for alerts
          BRANCH    OVRCD,PR2M9000
.
          MATCH     ADAURNO,PTALURNO
          GOTO      PR2M9000 IF NOT EQUAL
.
          PACK      KEY5,PTALCATG,PTALCODE
          CALL      RDCODE1
          BRANCH    OVRCD,MR5146A 
.
          MATCH     ANSN,TCINDC1
          GOTO      MR5146A IF EQUAL
.
          MOVE      TDESC,VARIABLE
          GOTO      PR2M9000
.
MR5147    PACK      KEY10,CHOSINDX,PURNO,SP10    * national number
          OPEN      PATNIDA1,"patnidaf"
          CALL      RDPTNID1
          IF        OVRCD = 1
            MOVE      SP20,VARIABLE
          ELSE
            MOVE      PTNINMPI,VARIABLE
          ENDIF
          MOVE      TWENTY,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PR2M9890
.
MR5148    MOVE      CAPPRVNO,VARIABLE       * hospital approval number
          COMPARE   ONE,IBCNMHOS
          GOTO      PR2M9000 IF NOT EQUAL
.
          PACK      VARIABLE,PTHSAPPR,SP70
          GOTO      PR2M9000
.
MR5149    MOVE      CFILENO,VARIABLE        * hospital file number
          GOTO      PR2M9000
.
MR5150    MOVE      PUSR1,VARIABLE          * PMI UD field 1 Code 
          GOTO      PR2M9000
.
MR5151    MOVE      "P1",TCODE              * PMI UD field 1 Desc
          MOVE      PUSR1,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5152    SUB       "151",FORM5
          PROC      PATPAOFS
          GOTO      PR2M9000
.
.------ format user defined field 6 code ------
.
MR5153    MOVE      AEDSUSR6,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 6 (H.D.P Eq.) ------
.
MR5154    MOVE      SP4,DIM4
          MATCH     SP3,AEDSUSR6
          GOTO      MR5154A IF EQUAL
.
          PACK      KEY5,CODEA6,AEDSUSR6
          CALL      RDCODE1
          BRANCH    OVRCD OF MR5154A
          MOVE      THCSCOD,DIM4
.
MR5154A   MOVE      DIM4,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 6 description ------
.
MR5155    MOVE      CODEA6,TCODE
          PACK      ACODE,AEDSUSR6,SP10
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format user defined field 7 code ------
.
MR5156    MOVE      AEDSUSR7,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 7 (H.D.P Eq.) ------
.
MR5157    MOVE      SP4,DIM4
          MATCH     SP3,AEDSUSR7
          GOTO      MR5157A IF EQUAL
.
          PACK      KEY5,CODEA7,AEDSUSR7
          CALL      RDCODE1
          BRANCH    OVRCD OF MR5157A
          MOVE      THCSCOD,DIM4
.
MR5157A   MOVE      DIM4,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 7 description ------
.
MR5158    MOVE      CODEA7,TCODE
          PACK      ACODE,AEDSUSR7,SP10
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
.------ format user defined field 8 code ------
.
MR5159    MOVE      AEDSUSR8,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 8 (H.D.P Eq.) ------
.
MR5160    MOVE      SP4,DIM4
          MATCH     SP3,AEDSUSR8
          GOTO      MR5160A IF EQUAL
.
          PACK      KEY5,CODEA8,AEDSUSR8
          CALL      RDCODE1
          BRANCH    OVRCD OF MR5160A
          MOVE      THCSCOD,DIM4
.
MR5160A   MOVE      DIM4,VARIABLE
          GOTO      PR2M9000
.
.------ format user defined field 8 description ------
.
MR5161    MOVE      CODEA8,TCODE
          PACK      ACODE,AEDSUSR8,SP10
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
. ------- Religion ---------------------------------
.
MR5162    MOVE      PREG,VARIABLE                    
          GOTO      PR2M9000
.
MR5163    MOVE      "R ",TCODE
          MOVE      PREG,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
. ------- Country of Birth -------------------------
.
MR5164    MOVE      PCONT,VARIABLE                    
          GOTO      PR2M9000
.
MR5165    MOVE      "C ",TCODE
          MOVE      PCONT,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
. ------- Format Emergency contact name -------
.
MR5166    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCESNAM,PACSNAME
            MOVE      PMCEGNAM,PACGNAME
            MOVE      PMCETITL,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,VARIABLE
          ELSE
            MOVE      PTMXECNM,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format Emergency contact address 1 -------
.
MR5167    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD1,VARIABLE
          ELSE
            MOVE      PTMXECA1,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format Emergency contact address 2 -------
.
MR5168    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD2,VARIABLE
          ELSE
            MOVE      PTMXECA2,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format Emergency contact address 3 -------
.
MR5169    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD3,VARIABLE
          ELSE
            MOVE      PTMXECA3,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format Emergency contact address 4 -------
.
MR5170    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD4,VARIABLE
          ELSE
            MOVE      PTMXECA4,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format Emergency contact postcode -------
.
MR5171    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEPOST,VARIABLE
          ELSE
            MOVE      PTMXECPC,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format Emergency contact private phone -------
.
MR5172    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELP,VARIABLE
          ELSE
            MOVE      PTMXECPP,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format Emergency contact business phone -------
.
MR5173    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELB,VARIABLE
          ELSE
            MOVE      PTMXECBP,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format Emergency contact relationship -------
.
MR5174    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCERELP,VARIABLE
          ELSE
            MOVE      PTMXECRE,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format N.O.K Address 1 -------------------
.
MR5175    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD1,VARIABLE
          ELSE
            MOVE      PNKADD1,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format N.O.K Address 2 -------------------
.
MR5176    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD2,VARIABLE
          ELSE
            MOVE      PNKADD2,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format N.O.K Address 3 -------------------
.
MR5177    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD3,VARIABLE
          ELSE
            MOVE      PNKSUBR,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format N.O.K Address 4 -------------------
.
MR5178    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEADD4,VARIABLE
          ELSE
            MOVE      PNKADD4,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format N.O.K Post Code ------------------
.
MR5179    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCEPOST,VARIABLE
          ELSE
            MOVE      PNKPOST,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format N.O.K Telephone Business --------------
.
MR5180    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCETELB,VARIABLE
          ELSE
            MOVE      PNKTELB,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
. ------- Format N.O.K Relationship ---------------------
.
MR5181    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Next of Kin
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCERELP,VARIABLE
          ELSE
            MOVE      PNKRELP,VARIABLE
          ENDIF
          GOTO      PR2M9000
.
MR5182    MOVE      PUSR2,VARIABLE          * PMI UD field 2 Code 
          GOTO      PR2M9000
.
MR5183    MOVE      "P2",TCODE              * PMI UD field 2 Desc
          MOVE      PUSR2,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5184    MOVE      PUSR3,VARIABLE          * PMI UD field 3 Code 
          GOTO      PR2M9000
.
MR5185    MOVE      "P3",TCODE              * PMI UD field 3 Desc
          MOVE      PUSR3,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5186    MOVE      PUSR4,VARIABLE          * PMI UD field 4 Code 
          GOTO      PR2M9000
.
MR5187    MOVE      "P4",TCODE              * PMI UD field 4 Desc
          MOVE      PUSR4,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5188    MOVE      PUSR5,VARIABLE          * PMI UD field 5 Code 
          GOTO      PR2M9000
.
MR5189    MOVE      "P5",TCODE              * PMI UD field 5 Desc
          MOVE      PUSR5,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5190    MOVE      PUSR6,VARIABLE          * PMI UD field 6 Code 
          GOTO      PR2M9000
.
MR5191    MOVE      "P6",TCODE              * PMI UD field 6 Desc
          MOVE      PUSR6,ACODE
          CALL      MR5PTCD0
          GOTO      PR2M9000
.
MR5192    MOVE      PTMXCELL,VARIABLE          * cellular telephone
          GOTO      PR2M9000
.
MR5193    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE                * Postal Address
            CALL      XCON0000                    * Get extra contact details
            MOVE      PMCEADD1,VARIABLE
          ELSE
            MOVE      PTMXADD1,VARIABLE           * Postal Address line 1
          ENDIF
          GOTO      PR2M9000
.
MR5194    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE                * Postal Address
            CALL      XCON0000                    * Get extra contact details
            MOVE      PMCEADD2,VARIABLE
          ELSE
            MOVE      PTMXADD2,VARIABLE           * Postal Address line 2
          ENDIF
          GOTO      PR2M9000
.
MR5195    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE                * Postal Address
            CALL      XCON0000                    * Get extra contact details
            MOVE      PMCEADD3,VARIABLE
          ELSE
            MOVE      PTMXADD3,VARIABLE           * Postal Address line 3
          ENDIF
          GOTO      PR2M9000
.
MR5196    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE                * Postal Address
            CALL      XCON0000                    * Get extra contact details
            MOVE      PMCEADD4,VARIABLE
          ELSE
            MOVE      PTMXADD4,VARIABLE           * Postal Address line 4
          ENDIF
          GOTO      PR2M9000
.
MR5197    MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE                * Postal Address
            CALL      XCON0000                    * Get extra contact details
            MOVE      PMCEPOST,VARIABLE
          ELSE
            MOVE      PTMXPOST,VARIABLE           * Postcode
          ENDIF
          GOTO      PR2M9000
.
MR5198    COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M5100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
          PACK      VARIABLE,NHMAETH,SP70,SP70     * Ethnicity code (NHI only)
          GOTO      PR2M9000
.
MR5199    COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M5100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          MATCH     SP5,NHMAETH                   * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PR2M9000
          ENDIF
.
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH,SP70
          CALL      RDNHETH1
          PACK      VARIABLE,NHETDES,SP70,SP70
          GOTO      PR2M9000
.
MR5200    COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M5100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH2
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
          PACK      VARIABLE,NHMAETH2,SP70,SP70     * Ethnicity code (NHI only)
          GOTO      PR2M9000
.
MR5201    COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M5100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH2
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          MATCH     SP5,NHMAETH2                  * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PR2M9000
          ENDIF
.
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH2,SP70
          CALL      RDNHETH1
          PACK      VARIABLE,NHETDES,SP70,SP70
          GOTO      PR2M9000
.
MR5202    COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M5100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH3
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
          PACK      VARIABLE,NHMAETH3,SP70,SP70     * Ethnicity code (NHI only)
          GOTO      PR2M9000
.
MR5203    COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M5100 IF NOT EQUAL
.
          MOVE      SP5,NHMAETH3
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          MATCH     SP5,NHMAETH3                  * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PR2M9000
          ENDIF
.
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH3,SP70
          CALL      RDNHETH1
          PACK      VARIABLE,NHETDES,SP70,SP70
          GOTO      PR2M9000
.
MR5204    COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PR2M5100 IF NOT EQUAL
.
          MOVE      SP1,NHMARES
          OPEN      NHIMASA2,"nhimasaf"
          MOVE      PURNO,KEY8
          CALL      RDNHMAS2
.
          PACK      VARIABLE,SP70,SP70            * Resident Status (NHI only)
          MATCH     "Y",NHMARES
          IF        @EQUAL
            PACK      VARIABLE,DYES,SP70,SP70
          ENDIF
.
          MATCH     "N",NHMARES
          IF        @EQUAL
            PACK      VARIABLE,DNO,SP70,SP70
          ENDIF
          GOTO      PR2M9000
.
.------ format the smoker indicator ------
.
MR5205    MOVE      "UNK",DIM3  
          LOAD      DIM3,PSMOK,DYES,DNO
          PACK      VARIABLE,DIM3,SP70,SP70
          GOTO      PR2M9000
.
MR5206    PACK      PKADD4,SP20,SP20
          MOVE      ADANUMB,KEY8
          CALL      RDRESP1               * read responsible for account file
          MOVE      PKADD4,VARIABLE
          GOTO      PR2M9000
.
.------ format the medicare reference number ------
.
MR5207    MOVE      PTMXMCCD,VARIABLE
          GOTO      PR2M9000
.
.------ format the medicare reference number ------
.
MR5208    MOVE      ADAURNO,MBIRURNO
          CALL      MULBIR00
          MOVE      MBIRTYOR,VARIABLE
          GOTO      PR2M9000
.
MR5209    PACK      VARIABLE,PMPXPFSN,SP70   * Preferred Surname
          GOTO      PR2M9000
.
MR5210    PACK      VARIABLE,PMPXPFGN,SP70   * Preferred Given Name
          GOTO      PR2M9000
.
MR5211    PACK      VARIABLE,PSNAME,SP70     * Pref Surname instead of Actual SN
          MATCH     "1",PTCNPFSN
          IF        @EQUAL
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFSN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PR2M9000
.
MR5212    PACK      VARIABLE,PGNAME,SP70     * Pref GN instead of Actual GN
          MATCH     "1",PTCNPFGN
          IF        @EQUAL
            MATCH     SP70,PMPXPFGN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFGN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PR2M9000
.
MR5213    PACK      VARIABLE,PTMASNAM,SP70   * Pref Surname instead of 40char SN
          MATCH     "1",PTCNPFSN
          IF        @EQUAL
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFSN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PR2M9000
.
.
.******************************************************************************
.------ set the variable to the length to print ------
.
PR2M9000  RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      PR2M5100
.
.------ formatting for Form fields and right justified variables ------
.
PR2M9890  COMPARE   ZERO,PRNTSTRT          * don't bump if printing full length
          GOTO      PR2M9895 IF EQUAL
.
          BUMP      VARIABLE,PRNTSTRT      * bump to starting position
.
.------ print the variable ------
.
PR2M9895  PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      PR2M5100
.
.------ end of MR5 reached ------
.
PR2M9900  MOVE      FALSE,EXIT
.
.------ print new-lines until the end of page is reached ------
.
PR2M9910  PRINT     *N;
          ADD       ONE,LASTROW
.
          COMPARE   LASTROW,IBTHLENG          * test page length
          GOTO      PR2M9999 IF EQUAL
.
          GOTO      PR2M9910
.
.------ no details on file ------
.
PR2M9990  MOVE      TRUE,EXIT
.
PR2M9999  CALL      CLSPRINT
          RETURN
+
.*********************************************************************
.         get description for a codes file entry
.*********************************************************************
MR5PTCD0  MOVE      SP20,DANS1
          MATCH     SP3,ACODE
          IF        !@EQUAL
            PACK      KEY5,TCODE,ACODE
            CALL      RDCODE1
            IF        OVRCD = ZERO
              MOVE      TDESC,DANS1
            ENDIF
          ENDIF
          MOVE      DANS1,VARIABLE          * set print variable
          RETURN
+
.*********************************************************************
.         get the V.A description if it exists 
.*********************************************************************
GETVA2    MOVE      SP3,VADESC
          UNPACK    SP5 WITH TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
          PACK      KEY5 WITH CODECL,ADACOMP
          CALL      RDCODE1                    * read the patient codes file
          MOVE      ZERO,FORM2
.
.------ check the next indicator ------
.
NXTVA2    ADD       ONE,FORM2
.
          COMPARE   SIX,FORM2
          GOTO      ENDVA2 IF NOT LESS
.
          LOAD      ANS USING FORM2 OF TCINDC1,TCINDC2,TCINDC3:
                    TCINDC4,TCINDC5
.
          CMATCH    ANSV TO ANS
          GOTO      CLVA2 IF EQUAL
.
          GOTO      NXTVA2 
.
.------ claim is a vehicle accident ------
.
CLVA2     MOVE      "VA ",VADESC
.
ENDVA2    RETURN
.
.*********************************************************************
.         get the W.C.A description if it exists 
.*********************************************************************
GETWCA2   MOVE      SP3,WCDESC
          UNPACK    SP5 WITH TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
          PACK      KEY5 WITH CODECL,ADACOMP
          CALL      RDCODE1                    * read the patient codes file
          MOVE      ZERO,FORM2
.
.------ check the next indicator ------
.
NXTWCA2   ADD       ONE,FORM2
.
          COMPARE   SIX,FORM2
          GOTO      ENDWCA2 IF NOT LESS
.
          LOAD      ANS USING FORM2 OF TCINDC1,TCINDC2,TCINDC3:
                    TCINDC4,TCINDC5
.
          CMATCH    ANSW TO ANS
          GOTO      CLWCO2 IF EQUAL
.
          GOTO      NXTWCA2
.
.------ claim is a workers compensation claim ------
.
CLWCO2    MOVE      "WCA",WCDESC
.
ENDWCA2   RETURN
.
.*********************************************************************
.         get MAB description if it exists 
.*********************************************************************
GETMAB2   MOVE      SP3,MADESC
          UNPACK    SP5 WITH TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
          PACK      KEY5 WITH CODECL,ADACOMP
          CALL      RDCODE1                    * read the patient codes file
          MOVE      ZERO,FORM2
.
.------ check the next indicator ------
.
NXTMAB2   ADD       ONE,FORM2
.
          COMPARE   SIX,FORM2
          GOTO      ENDMAB2 IF NOT LESS
.
          LOAD      ANS USING FORM2 OF TCINDC1,TCINDC2,TCINDC3:
                    TCINDC4,TCINDC5
.
          CMATCH    ANSM TO ANS
          GOTO      CLMAB2 IF EQUAL
.
          GOTO      NXTMAB2 
.
.------ claim is a vehicle accident ------
.
CLMAB2    MOVE      "MAB",MADESC
.
ENDMAB2   RETURN
.
...............................................................................

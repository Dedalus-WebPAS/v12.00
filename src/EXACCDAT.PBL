.*****************************************************************************
.*                           EXACCDAT                                        *
.*                Extract NZ ACC data for a given visit number               *
.* Requires: PTCNHDPS - valid read on parameter (Sector 80, Position 250)    *
.*           VISNUMBR - visit number                                         *
.* Returns:  EXIT   0 = NZ site                                              *
.*                  1 = not NZ site                                          *
.*                                                                           *
.* Mods:                                                                     *
.* V10.11.01 09/11/2017  Peter Vela       TSK 0847214                        *
.*           Fixed defaults for Continue Normal Work Ind and Alternative Work*
.*           Ind                                                             *
.* V10.08.02 21/10/2016  Steve Armstrong  TSK 0819758                        *
.*           Mods to cater for ACC Claim Comment data fields                 *
.*****************************************************************************
.* V10.06.00 18/06/2015  Steve Armstrong  CAR 313849/313856/313857/313858    *
.*           Created include                                                 *
.*****************************************************************************
.
.         Now get matching ACC data record for NZ sites only
.
EXACCDAT  COMPARE   ONE,PTCNHDPS                 * NZ ?
          GOTO      EXACC920 IF NOT EQUAL        * no - finished
.
          MATCH     "       0",VISNUMBR          * visit number available ?
          GOTO      EXACC910 IF EQUAL            * no - finished
.
          MOVE      VISNUMBR,KEY8
          CALL      RDWCOM1                      * ACC record on file ?
          BRANCH    OVRCD,EXACC910               * no - finished
.
          CALL      CLPMSWX1                     * clear pmswx1af variables
          MOVE      VISNUMBR,KEY8
          CALL      RDPMWX11                     * ACC extension on file ?
.
          MOVE      WCENAME,ACCDNAME
          STRIP     ACCDNAME
          MOVE      WCEADD1,ACCDADD1
          STRIP     ACCDADD1
          MOVE      WCEADD2,ACCDADD2
          STRIP     ACCDADD2
          MOVE      WCEADD3,ACCDADD3
          STRIP     ACCDADD3
          MOVE      WCEADD4,ACCDADD4
          STRIP     ACCDADD4
          MOVE      WCEPOST,ACCDPOST
          SQUEEZE   ACCDPOST
          MOVE      WCETELE,ACCDTELP
          STRIP     ACCDTELP
          MOVE      WCACDAT,ACCDACDT
          SQUEEZE   ACCDACDT
.
          IF        WCACCPT = 1
            MOVE      ANSY,ACCDACPT
          ELSE
            MOVE      ANSN,ACCDACPT
          ENDIF
          SQUEEZE   ACCDACPT
.
          MOVE      WCICODE,ACCDINSR
          SQUEEZE   ACCDINSR
          MOVE      WCCLMNO,ACCDCLNO
          STRIP     ACCDCLNO
          MOVE      WCCOMN1,ACCDCOM1
          STRIP     ACCDCOM1
          MOVE      WCCOMN2,ACCDCOM2
          STRIP     ACCDCOM2
          MOVE      PMWXALOC,ACCDALOC
          STRIP     ACCDALOC
          MOVE      PMWXCINJ,ACCDCINJ
          SQUEEZE   ACCDCINJ
          MOVE      PMWXICOD,ACCDICOD
          SQUEEZE   ACCDICOD
          MOVE      PMWXCNAM,ACCDCNAM
          STRIP     ACCDCNAM
          MOVE      PMWXCDTE,ACCDCDTE
          SQUEEZE   ACCDCDTE
          MOVE      PMWXCTIM,ACCDCTIM
          SQUEEZE   ACCDCTIM
          MOVE      PMWXWEBC,ACCDWEBC
          SQUEEZE   ACCDWEBC
          MOVE      PMWXLUPD,ACCDLUPD
          SQUEEZE   ACCDLUPD
          MOVE      PMWXLUPT,ACCDLUPT
          SQUEEZE   ACCDLUPT
          MOVE      PMWXWEBU,ACCDWEBU
          SQUEEZE   ACCDWEBU
          MOVE      PMWXACCF,ACCDACCF
          SQUEEZE   ACCDACCF
          MOVE      PMWXPLIN,ACCDPLIN
          SQUEEZE   ACCDPLIN
          MOVE      PMWXACTI,ACCDACTI
          SQUEEZE   ACCDACTI
          MOVE      PMWXADTE,ACCDADTE
          SQUEEZE   ACCDADTE
          MOVE      PMWXATME,ACCDATME
          SQUEEZE   ACCDATME
          MOVE      PMWXACLC,ACCDACLC
          SQUEEZE   ACCDACLC
.
          MATCH     "1",PMWXAINZ
          IF        @EQUAL
            MOVE      ANSY,ACCDAINZ
          ELSE
            MOVE      ANSN,ACCDAINZ
          ENDIF
          SQUEEZE   ACCDAINZ
.
          MATCH     "1",PMWXMOVV
          IF        @EQUAL
            MOVE      ANSY,ACCDMOVV
          ELSE
            MOVE      ANSN,ACCDMOVV
          ENDIF
          SQUEEZE   ACCDMOVV
.
          MATCH     "1",PMWXSPTI
          IF        @EQUAL
            MOVE      ANSY,ACCDSPTI
          ELSE
            MOVE      ANSN,ACCDSPTI
          ENDIF
          SQUEEZE   ACCDSPTI
.
          MOVE      PMWXSPRT,ACCDSPRT
          SQUEEZE   ACCDSPRT
.
          MATCH     "1",PMWXRECI
          IF        @EQUAL
            MOVE      ANSY,ACCDRECI
          ELSE
            MOVE      ANSN,ACCDRECI
          ENDIF
          SQUEEZE   ACCDRECI
.
          MATCH     "1",PMWXTRIC
          IF        @EQUAL
            MOVE      ANSY,ACCDTRIC
          ELSE
            MOVE      ANSN,ACCDTRIC
          ENDIF
          SQUEEZE   ACCDTRIC
.
          MOVE      PMWXESTA,ACCDESTA
          SQUEEZE   ACCDESTA
          MOVE      PMWXPDDT,ACCDPDDT
          SQUEEZE   ACCDPDDT
          MOVE      PMWXARG1,ACCDARG1
          STRIP     ACCDARG1
          MOVE      PMWXARG2,ACCDARG2
          STRIP     ACCDARG2
          MOVE      PMWXARSN,ACCDARSN
          STRIP     ACCDARSN
          MOVE      PMWXARTL,ACCDARTL
          SQUEEZE   ACCDARTL
          MOVE      PMWXARRP,ACCDARRP
          SQUEEZE   ACCDARRP
.
          MATCH     "1",PMWXASST
          IF        @EQUAL
            MOVE      ANSY,ACCDASST
          ELSE
            MOVE      ANSN,ACCDASST
          ENDIF
          SQUEEZE   ACCDASST
.
          MATCH     "1",PMWXNEED
          IF        @EQUAL
            MOVE      ANSY,ACCDNEED
          ELSE
            MOVE      ANSN,ACCDNEED
          ENDIF
          SQUEEZE   ACCDNEED
.
          MOVE      ANSY,ACCDCONT
          MATCH     SP70,PMWXCONT
          IF        !@EQUAL & !@EOS
            MATCH     "1",PMWXCONT
            IF        @EQUAL
              MOVE      ANSY,ACCDCONT
            ELSE
              MOVE      ANSN,ACCDCONT
            ENDIF
          ENDIF
          SQUEEZE   ACCDCONT
.
          MOVE      SP70,ACCDALTW
          MATCH     SP70,PMWXALTW
          IF        !@EQUAL & !@EOS
            MATCH     "1",PMWXALTW
            IF        @EQUAL
              MOVE      ANSY,ACCDALTW
            ELSE
              MOVE      ANSN,ACCDALTW
            ENDIF
          ENDIF
          SQUEEZE   ACCDALTW
.
          MOVE      PMWXTYPA,ACCDTYPA
          SQUEEZE   ACCDTYPA
          MOVE      PMWXSALT,ACCDSALT
          SQUEEZE   ACCDSALT
          MOVE      PMWXHPDA,ACCDHPDA
          SQUEEZE   ACCDHPDA
          MOVE      PMWXUNFD,ACCDUNFD
          SQUEEZE   ACCDUNFD
          MOVE      PMWXUNFT,ACCDUNFT
          SQUEEZE   ACCDUNFT
          MOVE      PMWXFISD,ACCDFISD
          SQUEEZE   ACCDFISD
          MOVE      PMWXRNWD,ACCDRNWD
          SQUEEZE   ACCDRNWD
          MOVE      PMWXCSTA,ACCDCSTA
          SQUEEZE   ACCDCSTA
          MOVE      PMWXTWRK,ACCDTWRK
          SQUEEZE   ACCDTWRK
          MOVE      PMWXOEST,ACCDOEST
          STRIP     ACCDOEST
          MOVE      PMWXTPRO,ACCDTPRO
          SQUEEZE   ACCDTPRO
          MOVE      PMWXECOD,ACCDECOD
          SQUEEZE   ACCDECOD
.
.         Get ACC Claim Comments
.
          CALL      ACCCOM00
.
EXACC900  MOVE      ZERO,EXIT
          GOTO      EXACC999
.
EXACC910  MOVE      ONE,EXIT
          GOTO      EXACC999
.
EXACC920  MOVE      TWO,EXIT
          GOTO      EXACC999
.
EXACC999  RETURN
+
.*****************************************************************************
.*                              ACCCOM00                                     *
.*     Load any ACC related comments for comment types:                      *
.*        001 - Cause of Injury                                              *
.*        002 - Injury Comments                                              *
.*        003 - Alternative Work Restrictions                                *
.*     NB: Only loads up to 500 characters of text (5 lines of 100           *
.*         characters maximum) for each comment type.                        *
.*****************************************************************************
.
ACCCOM00  MOVE      ONE,TYPCOUNT                 * initialise acc type counter
          CLEAR     ACCDTYP1                     * clear comment related fields
          CLEAR     ACCDTYP2
          CLEAR     ACCDTYP3
          CLEAR     ACCDDAT1
          CLEAR     ACCDDAT2
          CLEAR     ACCDDAT3
.
          WHILE     TYPCOUNT < 4
            LOAD      ACCCMTYP,TYPCOUNT,ACCTYPE1:   * type 001
                                        ACCTYPE2:   * type 002
                                        ACCTYPE3    * type 003
.
            MOVE      ZERO,LINCOUNT              * initialise line counter
            CLEAR     DIM500                     * clear comment variable
.
.           Loop through acccmtaf and load the comments for the current type
.
            PACK      KEY26,WCCLMNO,ACCCMTYP,SP30
            CALL      RSACCMT1                   * position at start of type
ACCCOM10    CALL      RKACCMT1                   * read next record
            BRANCH    OVRCD,ACCCOM90             * eof - finished type
.
            MATCH     WCCLMNO,ACCMACCN           * same claim number still ?
            GOTO      ACCCOM90 IF NOT EQUAL      * no - finished type
.
            MATCH     ACCCMTYP,ACCMTYPE          * same comment type still ?
            GOTO      ACCCOM90 IF NOT EQUAL      * no - finished type
.
.           We have a valid comment line for the comment type,
.           so load the data and see if we can load any more lines.
.
            APPEND    ACCMDATA,DIM500
.
            ADD       ONE,LINCOUNT               * increment line counter
            COMPARE   FIVE,LINCOUNT              * max lines reached ?
            GOTO      ACCCOM10 IF LESS           * no - get next comment line
.
ACCCOM90    IF        LINCOUNT <> 0
              STORE     ACCCMTYP,TYPCOUNT,ACCDTYP1,ACCDTYP2,ACCDTYP3
              RESET     DIM500
              STORE     DIM500,TYPCOUNT,ACCDDAT1,ACCDDAT2,ACCDDAT3
            ENDIF
            ADD       ONE,TYPCOUNT               * increment acc type counter
          DO
.
ACCCOM99  RETURN
+

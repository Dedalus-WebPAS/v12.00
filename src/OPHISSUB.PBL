.******************************************************************************
.* Common Routines for the Waiting List History                               *
.* Mods                                                                       *
.*        V5.09.B01 01/02/2001  Greg Horvat                                   *
.*                  Replaced Z variables with Z70                             *
.*                                                                            *
.******************************************************************************
.*  Routines      : WOPHIS00 - Write to Waiting List History                  *
.*                : GETCHG00 - Get Reason for Change of Session   Date        *
.******************************************************************************
.* WOPHIS00 - Write to the Theatre History
.******************************************************************************
WOPHIS00  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,SEVENTY9;*138,PTCNURHA
.
          COMPARE   ONE,PTCNURHA
          GOTO      WOPHIS99 IF NOT EQUAL
.
. ------- Check if anything has changed ---------------------------
.
.
. ------- write a history record -----------------------
.
WOPHIS50  OPEN      OPRHISA1,"oprhisaf" 
          PACK      KEY8,CCC,CYY,CMM,CDD,SP10
          REP       " 0",KEY8
.
          MOVE      OPHITCHG,FORM2
          PACK      KEY38,OPDAURNO,OPDAADMN,OPDAUNIQ,KEY8,Z70
          CALL      RSOPHIS1
          CALL      RPOPHIS1
          BRANCH    OVRCD,WOPHIS60
.
          MATCH     OPDAURNO,OPHIURNO
          GOTO      WOPHIS60 IF NOT EQUAL
.
          MATCH     OPDAADMN,OPHIEVNT
          GOTO      WOPHIS60 IF NOT EQUAL
.
          MOVE      OPDAUNIQ,KEY10
          MATCH     KEY10,OPHIUNIQ
          GOTO      WOPHIS60 IF NOT EQUAL
.
          MATCH     KEY8,OPHIEDAT
          GOTO      WOPHIS60 IF NOT EQUAL
.
          ADD       ONE,OPHIUCNT
          GOTO      WOPHIS70
.
WOPHIS60  MOVE      OPDAURNO,OPHIURNO
          MOVE      OPDAADMN,OPHIEVNT 
          MOVE      OPDAUNIQ,OPHIUNIQ
          PACK      OPHIEDAT,CCC,CYY,CMM,CDD,SP10
          REP       " 0",OPHIEDAT
          MOVE      ONE,OPHIUCNT
.
WOPHIS70  MOVE      OPDADATE,OPHIDATE
          MOVE      SAOPCHGD,OPHICHGD
          PACK      OPHISPAR,SP20,SP20,SP20
          MOVE      FORM2,OPHITCHG
.
          PACK      KEY38,OPHIURNO,OPHIEVNT,OPHIUNIQ,OPHIEDAT,OPHIUCNT,SP20
          CALL      RAOPHIS1
          IF        OVRCD=1
            CALL      WROPHIS1
          ENDIF
.
WOPHIS99  RETURN
.
.******************************************************************************
.* GETCHG00 - Get Reason for Change of Sched Adm Date                         *
.******************************************************************************
GETCHG00  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,SEVENTY9;*138,PTCNURHA
.
. ------- check if using rha booking system -----------------
.
          COMPARE   ONE,PTCNURHA
          GOTO      GETCHG90 IF NOT EQUAL
.
          DISPLAY   *P1:24,*EL,"Transfer Reason :"
.
          MOVE      "SC",CODE              * category
          MOVE      SP3,CKYIDEF3
          MOVE      ONE,CKYIMAND
          MOVE      "19",ECOL
          MOVE      "24",EVERT
.
          CALL      PATCODKY                * keyin a codes field
          BRANCH    EXIT,GETCHG95,GETCHG95
.
          MOVE      ACODE,SAOPCHGD
.
GETCHG90  MOVE      ZERO,EXIT
          GOTO      GETCHG99
.
GETCHG95  MOVE      ONE,EXIT                * EXITCHAR
GETCHG99  RETURN

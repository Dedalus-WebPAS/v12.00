.**************************************************************************
.*   Program Name : OPHTMREQ  -  Print Theatre Requisitions HTML Version  *
.*                  Need to Read OPRDETAF, OPRSESAF, PATMA1AF             *
.*                                                                        *
.*   Author       : Peter Vela                                            *
.*   Date         : 11/02/2020                                            *
.*   Mod's        :                                                       *
.**************************************************************************
.* V11.03.01 31/01/2023  Thanh T.           TSK 0919770                   *
.*           Changed HTMCOM00, HDESC400, HDESC200, HITEM0000 to cater for *
.*           adding Hospital field                                        *
.**************************************************************************  
.*        V11.00.02 20/05/2020  Peter Vela  Task 0871644                  *
.*                  Added TD colspan 3 to comments colum                  *
.*                  Fixed total page calculation                          *
.*        V11.00.01 07/04/2020  Peter Vela  Task 0871644                  *
.*                  Fixed Comments length, Cat OG Long Description        *
.*                  and Item description length                           *
.*        V10.15.01 10/12/2019  Peter Vela  Task 0871644                  *
.*                  Ported from OPPRTREQ. Created new HTML version        *
.**************************************************************************
.*                                                                        *
.*   Parameters   : ODDAUNIQ - Unique Number                              *
.*                  TEAMNUMB - Team Number                                *
.*                                                                        *
.*   Returns      : None                                                  *
.**************************************************************************
OPHTMREQ  CALL      CRTMP000
.
          CALL      IBACLOCK
          PACK      CDATE,CDD,SLASH,CMM,SLASH,CCC,CYY
          REP       " 0",CDATE
          MOVE      ZERO,CPAGENO
          MOVE      ONE,CNOUNDLN
.
          MOVE      ZERO,FIRSTITM   * set print first item flag false
          MOVE      ZERO,FIRSTEQP   * set print first equipment flag false
          MOVE      ZERO,GRNDITEM   * Total quantity of items
          MOVE      ZERO,GRNDTRAY   * Total quantity of trays
          MOVE      ZERO,TTYPTRAY   * Total type of trays
          MOVE      ZERO,TPERTRAY   * Total items per tray
          MOVE      ZERO,TOTLITEM   * Total for items only 
          MOVE      ZERO,GRNDEQPM   * Total for Equipment 
.
          CALL      GHEDHT00
.
.         Load Temp File
.
          MOVE      OPDAUNIQ,OPRQUNIQ
          MOVE      TEAMNUMB,OPRQTEAM
          PACK      KEY36,OPRQUNIQ,OPRQTEAM,SP70
          CALL      RSOPREQ3
HTREQ100  CALL      RKOPREQ3                      * get next record
          BRANCH    OVRCD,HTREQ200                * end of requisition file ?
.
          MATCH     OPDAUNIQ,OPRQUNIQ             * still same unique Id ?
          GOTO      HTREQ200 IF NOT EQUAL
.
          MATCH     TEAMNUMB,OPRQTEAM             * still same Team no. ?
          GOTO      HTREQ200 IF NOT EQUAL
.
.
.         MATCH     "3",OPRQTYPE
.         GOTO      HTREQ100 IF EQUAL
.
          MOVE      OPRQITEM,OPPRPREF
          MOVE      ONE,SKIPDPRF
          CALL      PRFDSC00
.
          PACK      KEY5,ANSO,ANSG,OPRQCLSS,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      "Invalid Class",PTCDLDES
          ENDIF
.
          PACK      SAVKEY36,OPRQUNIQ,OPRQTEAM,OPRQDCOD,OPRQCLSS,OPRQTYPE:
                             OPRQITEM,SP70
.
          MOVE      "Unknown",KEY9
          MATCH     "0",OPRQTYPE
          IF        @EQUAL
            MOVE      "Tray",KEY9
          ENDIF
          MATCH     "1",OPRQTYPE
          IF        @EQUAL
            MOVE      "Item",KEY9
          ENDIF
          MATCH     "2",OPRQTYPE
          IF        @EQUAL
            MOVE      "Equipment",KEY9
          ENDIF
.
          MATCH     "3",OPRQTYPE
          IF        @EQUAL
            CALL      HTMCOM00
            GOTO      HTREQ100
          ENDIF
.
          MOVE      TCFORM6,TEMPASSC
          RJUSTIFY  TEMPASSC
.
.         MOVE      OPRQTYPE,TEMPTYPE
          MATCH     "0",OPRQTYPE
          IF        @EQUAL
            MOVE      "1",TEMPTYPE
          ENDIF
          MATCH     "1",OPRQTYPE
          IF        @EQUAL
            MOVE      "2",TEMPTYPE
          ENDIF
          MATCH     "2",OPRQTYPE
          IF        @EQUAL
            MOVE      "3",TEMPTYPE
          ENDIF
.
          MOVE      SAVKEY36,TEMPKY36
          MOVE      OPRQITEM,TEMPITEM
          MOVE      PREFDESC,TEMPPDSC
          MOVE      KEY9,TEMPKEY9
          MOVE      TDESC,TEMPTDSC
          MOVE      OPRQAMNT,TEMPAMNT
          RJUSTIFY  TEMPAMNT
          ADD       ONE,FORM3
          MOVE      FORM3,TEMPCONT
          MOVE      OPRQDCOD,TEMPDOCT
          MOVE      OPRQCLSS,TEMPCLSS
          MOVE      OPRQUNIQ,TEMPUNIQ
          MOVE      OPRQTEAM,TEMPTEAM
.
          PACK      KEY10,TEMPASSC,TEMPTYPE,TEMPCONT,SP70
          CALL      RATMPRE1
          IF        OVRCD=1
            CALL      WRTMPRE1
          ENDIF
.
          GOTO      HTREQ100
.
.         Loop Through Temp File
.
HTREQ200  MOVE      ZERO,CLNO
          CALL      CALTPG00
.
          MOVE      SP70,SAVEASSC
          MOVE      ZERO,CLNO
.
          PACK      KEY10,SP70
          CALL      RSTMPRE1
HTREQ300  CALL      RKTMPRE1
          BRANCH    OVRCD,HTREQ900
.
          MOVE      TEMPKY36,KEY36
          CALL      RDOPREQ1
          BRANCH    OVRCD,HTREQ300
.
.
.         Initial page headings
.
          IF        CPAGENO=0
            CALL      HTMHED00
            CALL      HTMPRO00
            CALL      IEHED000
          ENDIF
.
          MATCH     SAVEASSC,TEMPASSC
          IF        !@EQUAL
.
            CALL     CALNWP00
.
            MOVE     "OG",CATEGORY
            MOVE     TEMPCLSS,CODE
            CALL     GETCOD00
.
            PRINT     TR;
              PRINT     TD;
                PRINT     NBSP;
              PRINT     ETD;
            PRINT     ETR
            ADD       ONE,CLNO
.
            PRINT     TR;
              PRINT     TD20;
                PRINT     BOLD,PTCDLDES,EBOLD;
              PRINT     ETD;
            PRINT     ETR
            ADD       ONE,CLNO
.
          ENDIF
          MOVE      TEMPASSC,SAVEASSC
.
.         ADD       ONE,CLNO
.
.
. Print Item details, first check if we need a new page
.
          IF        CLNO>57
.           CALL      PGECNT00
            PRINT     ETABLE;
            PRINT     PGEBREAK;
            MOVE      ZERO,CLNO
            CALL      HTMHED00                    * print standard headings
            IF        FIRSTITM=1 | FIRSTEQP=1
.             CALL      HTHED000                  * print table headings
              CALL      HTMPRO00
              CALL      IEHED000
            ENDIF
          ENDIF
.
          MATCH     "0",OPRQTYPE
          IF        @EQUAL 
            CALL      HDESC000
.           CALL      TRHED000                    * print table headings
.
.           PRINT     *1,"| ",OPRQITEM:
.                     *19,"| ",OPITDESC:
.                     *77,"| Tray":
.                     *89,"| ",TDESC:
.                     *117,"|    ",OPRQAMNT:
.                     *132,"|"
.
.           PRINT     TR;
.             PRINT     TD;
.               PRINT     OPRQITEM;
.             PRINT     ETD;
.             PRINT     TD;
.               PRINT     OPITDESC;
.             PRINT     ETD;
.             PRINT     TD;
.               PRINT     "Tray";
.             PRINT     ETD;
.             PRINT     TD;
.               PRINT     TDESC;
.             PRINT     ETD;
.             PRINT     TD;
.               PRINT     OPRQAMNT;
.             PRINT     ETD;
.           PRINT     ETR
.
.           ADD       ONE,CLNO
            ADD       OPRQAMNT,GRNDTRAY
            ADD       ONE,TTYPTRAY
.
.           PRINT     TR;
.             PRINT     "<td colspan=5>";
.               PRINT     nbsp;
.             PRINT     ETD;
.           PRINT     ETR
.           ADD       ONE,CLNO
.
.           CALL      TYHED000
.
.           PRINT     TR;
.             PRINT     TD;
.               PRINT     BOLD,TEMPTDSC,EBOLD;
.             PRINT     ETD;
.           PRINT     ETR;
.
            CALL      HITEM000           
          ENDIF
.
          MATCH     "1",OPRQTYPE
          IF        @EQUAL
            IF        FIRSTITM=0
.             CALL      IEHED000                  * print table headings
              MOVE      ONE,FIRSTITM
            ENDIF
            CALL    HDESC000
.
.           PRINT     *1,"| ",OPRQITEM:
.                     *19,"| ",OPITDESC:
.                     *77,"| Item":
.                     *89,"| ",TDESC:
.                     *117,"|    ",OPRQAMNT:
.                     *132,"|"
.
.            MATCH     SAVEASSC,TEMPASSC
.            IF        !@EQUAL
.              PRINT     TR;
.                PRINT     TD;
.                  PRINT     BOLD,TEMPTDSC,EBOLD;
.                PRINT     ETD;
.              PRINT     ETR
.            ENDIF
.HTREQ500    MOVE      TEMPASSC,SAVEASSC
.
            PRINT     TR;
              PRINT     TD;
                PRINT     NBSP;
              PRINT     ETD;
              PRINT     TD;
                PRINT     OPRQAMNT;
              PRINT     ETD;
              PRINT     TD;
                PRINT     DIM90;
.               PRINT     OPITDESC;
              PRINT     ETD;
              PRINT     TD;
                PRINT     OPRQITEM;
              PRINT     ETD;
            PRINT     ETR
            ADD       ONE,CLNO
.
            ADD       OPRQAMNT,TOTLITEM
            ADD       OPRQAMNT,GRNDITEM
          ENDIF
.
          MATCH     "2",OPRQTYPE
          IF        @EQUAL
            IF        FIRSTEQP=0
              IF        FIRSTITM=1
.
.               CALL      UND132                      * print underlines
.               PRINT     *1,"| Total Items":
.                         *122,TOTLITEM:
.                         *132,"|"
.               CALL      UND132                      * print underlines
.               PRINT     *N
.
.               PRINT     TR;
.                 PRINT     "<td colspan=5>";
.                   PRINT     HR;
.                 PRINT     ETD;
.               PRINT     ETR
.
.                PRINT     TR;
.                  PRINT     TD;
.                    PRINT     "Total Items";
.                  PRINT     ETD;
..                 PRINT     TD;
..                   PRINT     NBSP;
..                 PRINT     ETD;
..                 PRINT     TD;
..                   PRINT     NBSP;                  
..                 PRINT     ETD;
..                 PRINT     TD;
..                   PRINT     NBSP;
..                 PRINT     ETD;
.                  PRINT     TD;
.                    PRINT     TOTLITEM;
.                  PRINT     ETD;
.                PRINT     ETR
.
.               PRINT     TR;
.                 PRINT     TD;
.                   PRINT     NBSP;
.                 PRINT     ETD;
.               PRINT     ETR
.
.               PRINT     TR;
.                 PRINT     TD;
.                   PRINT     NBSP;
.                 PRINT     ETD;
.               PRINT     ETR
.
.               ADD       TWO,CLNO
              ENDIF
.             CALL      IEHED000                  * print table headings
              MOVE      ONE,FIRSTEQP
            ENDIF
            CALL      HDESC000
.
.           PRINT     *1,"| ",OPRQITEM:
.                     *19,"| ",OPITDESC:
.                     *77,"| Equipment":
.                     *89,"| ",TDESC:
.                     *117,"|    ",OPRQAMNT:
.                     *132,"|"
.
            PRINT     TR;
              PRINT     TD;
                PRINT     NBSP;
              PRINT     ETD;
              PRINT     TD;
                PRINT     OPRQAMNT;
              PRINT     ETD;
              PRINT     TD;
                PRINT     DIM90;
.               PRINT     OPITDESC;
              PRINT     ETD;
              PRINT     TD;
                PRINT     OPRQITEM;
              PRINT     ETD;
            PRINT     ETR
            ADD       ONE,CLNO
.
            ADD       OPRQAMNT,GRNDEQPM
          ENDIF
.
           MATCH     "3",OPRQTYPE
           IF        @EQUAL
.
.              PACK      KEY21,OPRQDCOD,SP70
.              CALL      RSOPPCM1
.HTREQ800      CALL      RKOPPCM1
.              BRANCH    OVRCD,HTREQ850
..
.              MATCH     OPRQDCOD,OPPCCODE
.              GOTO      HTREQ850 IF NOT EQUAL
..
.              MATCH     OPRQCLSS,OPPCCLSS
.              GOTO      HTREQ800 IF NOT EQUAL
.
              PRINT     TR;
                PRINT     TDCL3;
                  PRINT     TEMPPDSC;
                PRINT     ETD;
              PRINT     ETR
              ADD       ONE,CLNO

          ENDIF
.
HTREQ850  GOTO      HTREQ300
.
HTREQ900  IF        FIRSTEQP=1
.
.           CALL      UND132                      * print underlines
.           PRINT      *1,"| Total Equipments":
.                     *122,GRNDEQPM:
.                     *132,"|"
.           CALL      UND132                      * print underlines
.
.               PRINT     TR;
.                 PRINT     "<td colspan=5>";
.                   PRINT     HR;
.                 PRINT     ETD;
.               PRINT     ETR
.
.               PRINT     TR;
.                 PRINT     TD;
.                   PRINT     "Total Equipments";
.                 PRINT     ETD;
.                 PRINT     TD;
.                   PRINT     GRNDEQPM;
.                 PRINT     ETD;
.                 PRINT     TD;
.
.                 PRINT     ETD;
.                 PRINT     TD;
.
.                 PRINT     ETD;
.                 PRINT     TD;
.
.                 PRINT     ETD;
.               PRINT     ETR
.
.               PRINT     TR;
.                 PRINT     "<td colspan=5>";
.                   PRINT     HR;
.                 PRINT     ETD;
.               PRINT     ETR
.
.           ADD       ONE,CLNO
          ELSE
            IF        FIRSTITM=1
.
.             CALL      UND132                      * print underlines
.             PRINT     *1,"| Total Items":
.                       *122,TOTLITEM:
.                       *132,"|"
.             CALL      UND132                      * print underlines
.
.               PRINT     TR;
.                 PRINT     "<td colspan=5>";
.                   PRINT     HR;
.                 PRINT     ETD;
.               PRINT     ETR
.
.                PRINT     TR;
.                  PRINT     TD;
.                    PRINT     "Total Items";
.                  PRINT     ETD;
..                 PRINT     TD;
..                   PRINT     NBSP;
..                 PRINT     ETD;
..                 PRINT     TD;
..                   PRINT     NBSP;
..                 PRINT     ETD;
..                 PRINT     TD;
..                   PRINT     NBSP;
..                 PRINT     ETD;
.                  PRINT     TD;
.                    PRINT     TOTLITEM;
.                  PRINT     ETD;
.                PRINT     ETR
.
.               PRINT     TR;
.                 PRINT     TD;
.                   PRINT     NBSP;
.                 PRINT     ETD;
.               PRINT     ETR
.
.               PRINT     TR;
.                 PRINT     TD;
.                   PRINT     NBSP;
.                 PRINT     ETD;
.               PRINT     ETR
.
.             ADD       TWO,CLNO 
            ENDIF
          ENDIF
.
.         PRINT     ETABLE
.
          IF        CLNO>57
.           CALL      PGECNT00
            PRINT     ETABLE;
            PRINT     PGEBREAK;
            MOVE      ZERO,CLNO
            CALL      HTMHED00                    * print standard headings
            PRINT     TABLE;
            PRINT     TR,TD,NBSP,ETD,ETR;
            ADD       ONE,CLNO
            PRINT     TR,TD,NBSP,ETD,ETR;
            ADD       ONE,CLNO
            PRINT     TR,TD,"**End of Report**",ETD,ETR;
            ADD       ONE,CLNO
.
.           WHILE     CLNO <= 57
.             PRINT     TR,TD,NBSP,ETD,ETR
.             ADD       ONE,CLNO
.           DO 
.
.           CALL      PGECNT00
            PRINT     ETABLE;
          ELSE
            PRINT     ETABLE;
            PRINT     TABLE;
            PRINT     TR,TD,NBSP,ETD,ETR;
            ADD       ONE,CLNO
            PRINT     TR,TD,NBSP,ETD,ETR;
            ADD       ONE,CLNO
            PRINT     TR,TD,"**End of Report**",ETD,ETR;
            ADD       ONE,CLNO
.
.           WHILE     CLNO <= 57
.             PRINT     TR,TD,NBSP,ETD,ETR
.             ADD       ONE,CLNO
.           DO
.
.           CALL      PGECNT00
            PRINT     ETABLE;
          ENDIF
.
.         PRINT     *N,*1,"Total Type of Trays          :",TTYPTRAY:
.                   *N,*1,"Total Quantity of Trays      :",GRNDTRAY: 
.                   *N,*1,"Total Quantity of Items      :",GRNDITEM: 
.                   *N,*1,"Total Quantity of Equipments :",GRNDEQPM
.         PRINT     *N,*1,"*** End of report ***" 
.
.          PRINT     TABLE
..
.            PRINT     TR;
.              PRINT     TD;
.            PRINT     NBSP;
.              PRINT     ETD;
.            PRINT     ETR
..
.            PRINT     TR;
.              PRINT     TD;
.            PRINT     NBSP;
.              PRINT     ETD;
.            PRINT     ETR
.
.            PRINT     TR;
.              PRINT     TD;
.                PRINT     "Total Type of Trays          :",TTYPTRAY;
.              PRINT     ETD;
.            PRINT     ETR
..
.            PRINT     TR;
.              PRINT     TD;
.                PRINT     "Total Quantity of Trays      :",GRNDTRAY;
.              PRINT     ETD;
.            PRINT     ETR
..
.            PRINT     TR;
.              PRINT     TD;
.                PRINT     "Total Quantity of Items      :",GRNDITEM;
.              PRINT     ETD;
.            PRINT     ETR
..
.            PRINT     TR;
.              PRINT     TD;
.                PRINT     "Total Quantity of Equipments :",GRNDEQPM;
.              PRINT     ETD;
.            PRINT     ETR
..
.            PRINT     TR;
.              PRINT     TD;
.                PRINT     NBSP;
.              PRINT     ETD;
.            PRINT     ETR
..
.            PRINT     TR;
.              PRINT     TD;
.                PRINT     "*** End of report ***";
.              PRINT     ETD;
.            PRINT     ETR
. 
.          PRINT     ETABLE
.
HTREQ999  CALL      KTMP0000
          RETURN
+
. *****************************************************************************
. * GHEDHT00 : Get Header Details                                             *
. *****************************************************************************
GHEDHT00  MOVE      PSNAME,PACSNAME              * format patient name
          MOVE      PGNAME,PACGNAME
          MOVE      PTITL,PACTITLE
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAME,PATNME30
.
.         get Clinic name
.
          PACK      CLINNAME,OPSECLIN,SP70
          IF        OPCNCLSU=1
            PACK      KEY6,OPSECLIN,SP70      * using doctor
            CALL      RDDOCT1
            IF        OVRCD=0
              MOVE      DGNAME,PACGNAME
              MOVE      DSNAME,PACSNAME
              MOVE      DTITL,PACTITLE
              MOVE      ONE,PACFRMT
              CALL      PACNAME
              MOVE      PACFNAME,CLINNAME
            ENDIF
          ELSE
            PACK      KEY6,OPSECLIN,SP70      * using clinic
            CALL      RDOPCLI1
            IF        OVRCD=0         
              MOVE      OPCLDESC,CLINNAME
            ENDIF
          ENDIF
.
.         get Anaesthetist name
.
          PACK      ANAENAME,OPSEANAE,SP70
          PACK      KEY6,OPSEANAE,SP70
          CALL      RDDOCT1
          IF        OVRCD=0
            MOVE      DGNAME,PACGNAME
            MOVE      DSNAME,PACSNAME
            MOVE      DTITL,PACTITLE
            MOVE      ONE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,ANAENAME
          ENDIF
.
.         get format Session date
.
          UNPACK    OPDADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPCDATE,SESSDATE
.
.         get Session date day of week
.
          UNPACK    OPDADATE,CCENT,CYEAR,CMON,CDAY
          CALL      DAYOFWEK
          LOAD      DAYDESC,WEEKDAY,MON,TUE,WED,THU,FRI,SAT,SUN
.
.         get theatre room description
.
          PACK      KEY6,OPDATHET
          CALL      RDOPOPR1
          IF        OVRCD=0
            MOVE      OPRMDESC,OPRRMNME
          ELSE
            PACK      OPRRMNME,OPDATHET,SP70
          ENDIF
.
.         get Operating Surgeon name 
.
          MOVE      CLINNAME,SURGNAME
          MOVE      ZERO,F2
          PACK      KEY35,OPDAUNIQ,TEAMNUMB,F2,SP70
          CALL      RSOPTSM1
          CALL      RKOPTSM1
          BRANCH    OVRCD,GHEDHT99  
.
          PACK      KEY13,OPTSUNID,OPTSTMNO,OPTSSIND
          MATCH     KEY13,KEY35
          GOTO      GHEDHT99 IF NOT EQUAL
.
          PACK      SURGNAME,OPTSSCDE,SP70
          PACK      KEY6,OPTSSCDE,SP70
          CALL      RDDOCT1
          IF        OVRCD=0
            MOVE      DGNAME,PACGNAME
            MOVE      DSNAME,PACSNAME
            MOVE      DTITL,PACTITLE
            MOVE      ONE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,SURGNAME
          ENDIF
.
GHEDHT99  RETURN
.
. *****************************************************************************
. * HTMHED00 : Print the Heading                                              *
. *****************************************************************************
HTMHED00  CALL      WHEAD132
.
          PRINT     TABLE
.
          PRINT     TR;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP; 
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     "U/R : ",BOLD,PURNO,EBOLD;
            PRINT     ETD;
            PRINT     TD;
              PRINT     "Patient : ",BOLD,PATNME30,EBOLD;
            PRINT     ETD;
            PRINT     TD;
              PRINT     "Visit No: ",BOLD,OPDAADMN,EBOLD;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     "Clinic : ",BOLD,CLINNAME,EBOLD;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     "Team No      : ",BOLD,TEAMNUMB,EBOLD;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     "Date/Time/Day: ",BOLD,SESSDATE,", ",OPSETIME,", ":
                         DAYDESC,EBOLD;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     "Surgeon: ",BOLD,SURGNAME,EBOLD;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     "Theatre: ",BOLD,OPRRMNME,EBOLD;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     "Anaesthetist : ",BOLD,ANAENAME,EBOLD;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          CALL      IBACLOCK
          UNPACK    CURRDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          PRINT     TR;
            PRINT     TD;
              PRINT     "Case No: ",BOLD,OPDACASE,EBOLD;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     "Printed On: ",BOLD,CPCDATE," ",CTIMEIS,EBOLD;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     ETABLE
.
.         ADD       TEN,CLNO
.
HTMHED99  RETURN
+
.**************************************************************************
.*                            HTHED000              Called by: HTREQ000   *
.*                   print the table headings                             *
.**************************************************************************
HTHED000  PRINT     TABLE
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     HR;
.           PRINT     ETD;
.         PRINT     ETR
.
          PRINT     TR;
            PRINT     TDHD;
              PRINT     "Code";
            PRINT     ETD;
            PRINT     TDHD;
              PRINT     "Description";
            PRINT     ETD;
            PRINT     TDHD;
              PRINT     "Type";
            PRINT     ETD;
            PRINT     TDHD;
              PRINT     "Class";
            PRINT     ETD;
            PRINT     TDHD;
              PRINT     "Quantity";
            PRINT     ETD;
          PRINT     ETR 
          ADD       ONE,CLNO
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     HR;
.           PRINT     ETD;
.         PRINT     ETR
.
.         PRINT     ETABLE
. 
.         ADD       ONE,CLNO
.
HTHED999  RETURN
+
.**************************************************************************
.*                            HITEM000              Called by: HTREQ000   *
.*                      print the tray items                              *
.**************************************************************************
HITEM000  MOVE      ZERO,TPERTRAY
          PACK      KEY33,OPRQITEM,SP10
          CALL      RSOPTRB1
HITEM100  CALL      RKOPTRB1
          BRANCH    OVRCD,HITEM900
.
          MATCH     OPTDCODE,OPRQITEM
          GOTO      HITEM900 IF NOT EQUAL
.
          MATCH     "1",OPCNPTMC
          IF        @EQUAL
.
            IF        CFEETYP=FIVE
.
              PACK      KEY37,OPTDITEM,SP70
              CALL      RSNZMCH3
HITEM110      CALL      RKNZMCH3
              BRANCH    OVRCD,HITEM200
.
              MOVE      OPTDITEM,DIM9
.
              MATCH     DIM9,NZMCMCHG
              GOTO      HITEM200 IF NOT EQUAL
.
              MATCH     "1",NZMCACFL
              GOTO      HITEM110 IF EQUAL
.
              MOVE      NZMCDESC,DIM90
.             MOVE      NZMCDESC,OPITDESC
              GOTO      HITEM250
.
            ELSE
.
              PACK      KEY9,OPTDITEM,SP70
              IF        IBCNMHOS=1
                PACK      KEY3,WBSEHOSP,SP70
                CALL      RDPTHSP1
                BRANCH    OVRCD,HITEM120
                PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
              ELSE
HITEM120        PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
              ENDIF
              CALL      PATMCHRD
.
              IF        EXIT=ZERO
                MOVE      MDESC,DIM90
.               MOVE      MDESC,OPITDESC
                GOTO      HITEM250
              ENDIF
.
              GOTO      HITEM200
.
            ENDIF
.
          ELSE
.
HITEM200    PACK      KEY15,OPTDITEM,SP70
            CALL      RDOPITE1
            IF        OVRCD=ONE
.             MOVE      "Missing description",OPITDESC
              MOVE      "Missing description",DIM90
            ELSE
              MOVE      OPITDESC,DIM90
            ENDIF
.
          ENDIF
.
HITEM250  IF        CLNO>57
.           CALL      PGECNT00
            PRINT     ETABLE;
            PRINT     PGEBREAK;
            MOVE      ZERO,CLNO
            CALL      HTMHED00                      * print standard headings
.           CALL      HTHED000                      * print table headings
            CALL      HTMPRO00
            CALL      IEHED000
          ENDIF
.
HITEM300  
.         PRINT     *1,"| ",OPTDITEM:
.                   *19,"| ",OPITDESC:
.                   *77,"| ":
.                   *89,"| ":
.                   *117,"|    ",OPTDQTY:
.                   *132,"|"
.
          PRINT     TR;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
            PRINT     TD;
              PRINT     OPTDQTY;
            PRINT     ETD;
            PRINT     TD;
              PRINT     DIM90;
.             PRINT     OPITDESC;
            PRINT     ETD;
            PRINT     TD;
              PRINT     OPTDITEM;
            PRINT     ETD;
.           PRINT     TD;
.             PRINT     NBSP;
.           PRINT     ETD;
.           PRINT     TD;
.             PRINT     OPTDQTY; 
.           PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
.         ADD       ONE,CLNO
          ADD       OPTDQTY,TPERTRAY
..          ADD       OPTDQTY,GRNDITEM
.                    
          GOTO      HITEM100
.
HITEM900  
.         CALL      UND132
.         PRINT     *1,"| Total Items per Tray ",OPRQITEM:
.                   *122,TPERTRAY:
.                   *132,"|"
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     HR;
.           PRINT     ETD;
.         PRINT     ETR
.
.          PRINT     TR;
.            PRINT     "<td width=20%>";
.              PRINT     "Total Items per Tray ",OPRQITEM;
.            PRINT     ETD;
..           PRINT     TD;
..             PRINT     NBSP;
..           PRINT     ETD;
..           PRINT     TD;
..             PRINT     NBSP;
..           PRINT     ETD;
..           PRINT     TD;
..             PRINT     NBSP;
..           PRINT     ETD;
.            PRINT     TD;
.              PRINT     TPERTRAY;
.            PRINT     ETD;
.          PRINT     ETR
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     NBSP;
.           PRINT     ETD;
.         PRINT     ETR
.
          IF        OPRQAMNT>1
            MULT      OPRQAMNT,TPERTRAY
.
.           PRINT     *1,"| Total Quantity of Items for Tray ",OPRQITEM:
.                     *122,TPERTRAY:
.                     *132,"|"
.
.            PRINT     TR;
.              PRINT     TD;
.                PRINT     "Total Quantity of Items for Tray",OPRQITEM;
.              PRINT     ETD;
.              PRINT     TD;
.                PRINT     NBSP;
.              PRINT     ETD;
.              PRINT     TD;
.                PRINT     NBSP;
.              PRINT     ETD;
..             PRINT     TD;
..               PRINT     NBSP;
..             PRINT     ETD;
.              PRINT     TD;
.                PRINT     TPERTRAY;
.              PRINT     ETD;
.            PRINT     ETR
.
.           PRINT     TR;
.             PRINT     "<td colspan=5>";
.               PRINT     HR;
.             PRINT     ETD;
.           PRINT     ETR
.
.           ADD       ONE,CLNO
          ENDIF
          ADD       TPERTRAY,GRNDITEM
.
.         CALL      UND132
.         PRINT     *N;
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     HR;
.           PRINT     ETD;
.         PRINT     ETR
.
.         PRINT     TR;
.           PRINT     TD;
.             PRINT     NBSP;
.           PRINT     ETD;
.         PRINT     ETR
.
.          PRINT     TR;
.            PRINT     TD;
.              PRINT     NBSP;
.            PRINT     ETD;
.          PRINT     ETR
..
.          PRINT     TR;
.            PRINT     TD;
.              PRINT     NBSP;
.            PRINT     ETD;
.          PRINT     ETR
..
.          PRINT     TR;
.            PRINT     TD;
.              PRINT     NBSP;
.            PRINT     ETD;
.          PRINT     ETR
.
.         ADD       TWO,CLNO
.
HITEM999  RETURN
+
.**************************************************************************
.*                              HDESC000         Called by: HTREQ000      *
.*                      get the class description                         *
.**************************************************************************
HDESC000  PACK      KEY5,ANSO,ANSG,OPRQCLSS
          CALL      RDCODE1
          COMPARE   ZERO,OVRCD
          GOTO      HDESC200 IF EQUAL
.
          MOVE      "<Missing Class>",TDESC
.
HDESC200  MATCH     "1",OPRQTYPE                  * item ?
          GOTO      HDESC300 IF EQUAL
          MATCH     "2",OPRQTYPE                  * tray ?
          GOTO      HDESC400 IF EQUAL
.
. get item description from OPRTRAFD 
.
.         MOVE      "Missing description",OPITDESC    * assume not on file
          MOVE      "Missing description",DIM90
          PACK      KEY18,OPRQITEM,SP70
          CALL      RDOPTRA1
          BRANCH    OVRCD,HDESC999
          MOVE      OPTHDESC,DIM90
.         MOVE      OPTHDESC,OPITDESC             * move to dim 50
          GOTO      HDESC999
.
. get item description from OPRITEFD/PATMCHFD/NZPMCHFD 
.
HDESC300  MATCH     "1",OPCNPTMC
          IF        @EQUAL 
.
            IF        CFEETYP=FIVE
.
              PACK      KEY37,OPRQITEM,SP70
              CALL      RSNZMCH3
HDESC310      CALL      RKNZMCH3
              BRANCH    OVRCD,HDESC350
.
              MOVE      OPRQITEM,DIM9
.
              MATCH     DIM9,NZMCMCHG
              GOTO      HDESC350 IF NOT EQUAL
.
              MATCH     "1",NZMCACFL
              GOTO      HDESC310 IF EQUAL
.
              MOVE      NZMCDESC,DIM90
.             MOVE      NZMCDESC,OPITDESC
              GOTO      HDESC999
.
            ELSE
.
              PACK      KEY9,OPRQITEM,SP70
              IF        IBCNMHOS=1
                PACK      KEY3,WBSEHOSP,SP70
                CALL      RDPTHSP1
                BRANCH    OVRCD,HDESC320
                PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
              ELSE
HDESC320        PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
              ENDIF
              CALL      PATMCHRD
.
              IF        EXIT=ZERO
                MOVE      MDESC,DIM90
.               MOVE      MDESC,OPITDESC
                GOTO      HDESC999
              ENDIF
.
              GOTO      HDESC350
.
            ENDIF
.
          ELSE
.
HDESC350    PACK      KEY15,OPRQITEM,SP70
            CALL      RDOPITE1
            COMPARE   ZERO,OVRCD
            IF        @EQUAL
              MOVE      OPITDESC,DIM90
            ELSE
              MOVE      "Missing description",OPITDESC
            ENDIF
.
.           GOTO      HDESC999 IF EQUAL
.           MOVE      "Missing description",OPITDESC
.           GOTO      HDESC999
.
          ENDIF
.
HDESC400  MOVE      "Missing description",DIM90
.         MOVE      "Missing description",OPITDESC
          PACK      KEY18,OPRQITEM,SP70
          CALL      RDOPEQP1 
          BRANCH    OVRCD,HDESC999
          MOVE      OPEQDESC,DIM90
.         MOVE      OPEQDESC,OPITDESC             * move to dim 50
          GOTO      HDESC999
.
HDESC999  RETURN
+
.**************************************************************************
.*                              WHEAD132                                  *
.*                            HTML Heading                                *
.**************************************************************************
WHEAD132  OPEN      WEBSECA3,"websecaf"
          MOVE      SP70,WBSENAM
.         PACK      KEY14,PASSCODE,SP70
.         CALL      RSWBSE3
.         CALL      RKWBSE3
.         IF        OVRCD=0
.           MATCH     PASSCODE,WBSEPCD
.           IF        !@EQUAL
.             MOVE      SP70,WBSENAM
.           ENDIF
.         ENDIF
.
          ADD      ONE,CPAGENO
.
.         PRINT     TABLE,TR,TD,WBSENAM,ETD,ETR:
.                   TR,TD,PRGID,ETD,TD,CNAME:
.                   ETD,TD,"Date : ",CDATE:
.                   ETD,ETR:
.                   TR,TD,VERSION,ETD,TD,PRGNAM,SP1,CPHDROPT,ETD,TD:
.                   "Time : ",CTIMEIS,ETD,ETR:
.                   TR,TD,NBSP,ETD,TD,NBSP,ETD,TD,"Page : ",CPAGENO,ETD,ETR
.
          PRINT    TABLE
            CALL     PGECNT00
            PRINT    TR;
              PRINT    "<td align=center>";
                PRINT    "Theatre Requisition Report";
              PRINT    TD;
            PRINT    ETR
            ADD       ONE,CLNO
          PRINT    ETABLE
.
          GOTO     WHED132Z
.
WHED132Z  CALL     IBACLOCK
          PRINT    ETABLE
.         ADD      ONE,CLNO
          RETURN
+
.**************************************************************************
.*                              HTMPRO00                                  *
.*                            Procedures                                  *
.**************************************************************************
HTMPRO00  PACK      KEY10,OPDAUNIQ,SP70
          CALL      RDOPDEA3
          BRANCH    OVRCD,HTMPRO99
.
          PRINT    TABLE
.
          PRINT    TR;
            PRINT    TD;
              PRINT    "Procedure/s: ";
            PRINT    ETD;
            PRINT    TD;
              MATCH    SP70,OPDAPROV
              IF       !@EQUAL & !@EOS
                PRINT    OPDAPROV," - ",OPDADES1;
              ENDIF
            PRINT    ETD;
          PRINT    ETR
          ADD       ONE,CLNO
.
          MATCH    SP70,OPDAPRV2
          IF       !@EQUAL & !@EOS
            PRINT    TR;
              PRINT    TD;
                PRINT    NBSP;
              PRINT    ETD;
              PRINT    TD;
                MATCH    SP70,OPDAPRV2
                IF       !@EQUAL & !@EOS
                  PRINT    OPDAPRV2," - ",OPDADES2;
                ENDIF
              PRINT    ETD;
            PRINT    ETR
            ADD      ONE,CLNO
          ENDIF
.
          MATCH    SP70,OPDAPRV3
          IF       !@EQUAL & !@EOS
            PRINT    TR;
              PRINT    TD;
                PRINT    NBSP;
              PRINT    ETD;
              PRINT    TD;
                MATCH    SP70,OPDAPRV3
                IF       !@EQUAL & !@EOS
                  PRINT    OPDAPRV3," - ",OPDADES3;
                ENDIF
              PRINT    ETD;
            PRINT    ETR
            ADD      ONE,CLNO
          ENDIF
.
          MATCH    SP70,OPDAANAE
          IF       !@EQUAL & !@EOS
            MOVE     "OA",CATEGORY
            MOVE     OPDAANAE,CODE
            CALL     GETCOD00
.
            PRINT    TR;
              PRINT    TD;
                PRINT    NBSP;
              PRINT    ETD;
              PRINT    TD;
                PRINT    OPDAANAE," - ",PTCDLDES;
              PRINT    ETD;
            PRINT    ETR  
            ADD      ONE,CLNO
          ENDIF 
.
          PRINT    TR;
            PRINT    TD;
              PRINT    NBSP;
            PRINT    ETD;
          PRINT    ETR
          ADD      ONE,CLNO
.
          PRINT    TR;
            PRINT    TD;
              PRINT    NBSP;
            PRINT    ETD;
          PRINT    ETR
          ADD      ONE,CLNO
.
          PRINT    TR;
            PRINT    TD;
              PRINT    NBSP;
            PRINT    ETD;
          PRINT    ETR
          ADD      ONE,CLNO
.
          PRINT    ETABLE          
.
.         ADD      SEVEN,CLNO
.
HTMPRO99  RETURN
+
.**************************************************************************
.*                            TRHED000              Called by: HTREQ000   *
.*                   print the table headings                             *
.**************************************************************************
TRHED000  PRINT     TABLE
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     HR;
.           PRINT     ETD;
.         PRINT     ETR
.
          PRINT     TR;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     TD;
              PRINT     NBSP;
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
          PRINT     TR;
            PRINT     "<td class=HighLightRed width=20%>";
              PRINT     DIM90;
.             PRINT     OPITDESC;
            PRINT     ETD;
            PRINT     TDTY;
              PRINT     "Description";
            PRINT     ETD;
            PRINT     TDTY;
              PRINT     "Type";
            PRINT     ETD;
            PRINT     TDTY;
              PRINT     "Class";
            PRINT     ETD;
            PRINT     TDTY;
              PRINT     "Quantity";
            PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     HR;
.           PRINT     ETD;
.         PRINT     ETR
.
.         PRINT     ETABLE
.
.         ADD       FIVE,CLNO
.
TRHED999  RETURN
+
.**************************************************************************
.*                            TYHED000              Called by: HTREQ000   *
.*                   print the table headings                             *
.**************************************************************************
TYHED000  PRINT     TABLE
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     HR;
.           PRINT     ETD;
.         PRINT     ETR
.
          PRINT     TR;
            PRINT     "<td class=HeadingCell width=20%>";
              PRINT     "Group";
            PRINT     ETD;
            PRINT     TDHD;
              PRINT     "Qty";
            PRINT     ETD;
            PRINT     TDHD;
              PRINT     "Description";
            PRINT     ETD;
            PRINT     TDHD;
              PRINT     "Code in Tray";
            PRINT     ETD;
.           PRINT     TDHD;
.             PRINT     "Quantity";
.           PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     HR;
.           PRINT     ETD;
.         PRINT     ETR
.
.         PRINT     ETABLE
.
.         ADD       ONE,CLNO
.
TYHED999  RETURN
+
.**************************************************************************
.*                            IEHED000              Called by: HTREQ000   *
.*                   print the table headings                             *
.**************************************************************************
IEHED000  PRINT     TABLE
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     HR;
.           PRINT     ETD;
.         PRINT     ETR
.
          PRINT     TR;
            PRINT     TD;
              PRINT     BOLD;
                PRINT     "Group";
              PRINT     EBOLD;
            PRINT     ETD;
            PRINT     TD;
              PRINT     BOLD;
              PRINT     "Qty";
              PRINT     EBOLD;
            PRINT     ETD;
            PRINT     TD;
              PRINT     BOLD;
                PRINT     "Description";
              PRINT     EBOLD;
            PRINT     ETD;
            PRINT     TD;
              PRINT     BOLD;
                PRINT     "Code";
              PRINT     EBOLD;
            PRINT     ETD;
.           PRINT     TDHD;
.             PRINT     "Quantity";
.           PRINT     ETD;
          PRINT     ETR
          ADD       ONE,CLNO
.
.         PRINT     TR;
.           PRINT     "<td colspan=5>";
.             PRINT     HR;
.           PRINT     ETD;
.         PRINT     ETR
.
.         PRINT     ETABLE
.
.         ADD       ONE,CLNO
.
IEHED999  RETURN
+
.*****************************************************************************
.         Load All comments
.*****************************************************************************
HTMCOM00  MOVE      "Comment",KEY9
          MOVE      OPRQITEM,DIM9
.
          PACK      KEY24,OPRQDCOD,DIM9,OPRQCLSS,SP70
          CALL      RSOPPCM1
HTMCOM10  CALL      RKOPPCM1
          BRANCH    OVRCD,HTMCOM99
.
          MATCH     OPRQDCOD,OPPCCODE
          GOTO      HTMCOM99 IF NOT EQUAL
.
          MATCH     OPRQITEM,OPPCPREF
          GOTO      HTMCOM99 IF NOT EQUAL
.
          MATCH     OPRQCLSS,OPPCCLSS
          GOTO      HTMCOM99 IF NOT EQUAL
.
          MOVE      OPPCDESC,PREFDESC
.
.         MOVE      ONE,SHOWHEAD
.
          MOVE      TCFORM6,TEMPASSC
          RJUSTIFY  TEMPASSC
.
.         MOVE      OPRQTYPE,TEMPTYPE
          MOVE      "0",TEMPTYPE
.
          MOVE      SAVKEY36,TEMPKY36
          MOVE      OPPCLINE,TEMPITEM
          MOVE      PREFDESC,TEMPPDSC
          MOVE      KEY9,TEMPKEY9
          MOVE      TDESC,TEMPTDSC
          MOVE      ZERO,TEMPAMNT
          RJUSTIFY  TEMPAMNT
          ADD       ONE,FORM3
          MOVE      FORM3,TEMPCONT
          MOVE      OPRQDCOD,TEMPDOCT
          MOVE      OPRQCLSS,TEMPCLSS
.
          PACK      KEY10,TEMPASSC,TEMPTYPE,TEMPCONT,SP70
          CALL      RATMPRE1
          IF        OVRCD=1
            CALL      WRTMPRE1
          ENDIF
.
.         WRITE     HTMLFILE;"<tr><td nowrap valign=middle>":
.                            "<a href='javascript:UpdateReq(#"",SAVKEY36:
.                            "#");'><img src=../images/EditIcon.gif class=Icon":
.                            " hspace=4 border=0 align=absmiddle></a>&nbsp;":
.                            OPPCLINE,"</td>":
.                            "<td>",PREFDESC,"</td>":
.                            "<td>",KEY9,"</td>":
.                            "<td>",TDESC,"</td>":
.                            "<td>&nbsp;</td>":
.                            "<td>&nbsp;</td>":
.                            "</tr>"
.
          GOTO      HTMCOM10
.
HTMCOM99  RETURN
+
.*****************************************************************************
.         Calculate if new page necessary for requisition section
.*****************************************************************************
CALNWP00  PACK      SAVKEY10,TEMPASSC,TEMPTYPE,TEMPCONT,SP70
          MOVE      TEMPASSC,SAVEASS2
.
          MOVE      CLNO,SAVECLNO
.
CALNWP10  CALL      RKTMPRE1
          BRANCH    OVRCD,CALNWP90
.
          MATCH     SAVEASS2,TEMPASSC
          IF        @EQUAL
            ADD       ONE,SAVECLNO
.
            IF        SAVECLNO>55
.
.             WHILE     CLNO <= 57
.               PRINT     TR,TD,NBSP,ETD,ETR
.               ADD       ONE,CLNO
.             DO
.             CALL      PGECNT00
.
              PRINT     ETABLE;
              PRINT     PGEBREAK;
              MOVE      ZERO,CLNO
              CALL      HTMHED00  
              CALL      HTMPRO00
              CALL      IEHED000
.
              GOTO      CALNWP90
            ELSE
              GOTO      CALNWP10
            ENDIF
.
          ENDIF
.
CALNWP90  MOVE      SAVKEY10,KEY10
          CALL      RDTMPRE1        
.
CALNWP99  RETURN
+
.*****************************************************************************
.         Print Page Count
.*****************************************************************************
PGECNT00  PRINT     TR,TDRJ,"Page ",CPAGENO," of  ",TPAGENO,ETD,ETR;
          ADD       ONE,CLNO
.
PGECNT99  RETURN
+
.*****************************************************************************
.         Calculate Total Pages
.*****************************************************************************
CALTPG00  MOVE      ZERO,TPAGENO
          MOVE      TWENTY9,CLNO
.
          PACK      KEY10,SP70
          CALL      RSTMPRE1
CALTPG10  CALL      RKTMPRE1
          BRANCH    OVRCD,CALTPG99
.
          ADD       ONE,CLNO
.
          COMPARE   FIFTY5,CLNO
          IF        FIFTY5 < CLNO
            ADD       ONE,TPAGENO
            MOVE      TWENTY9,CLNO
          ENDIF
.
          GOTO      CALTPG10
.
.CALTPG50  ASSIGN    CLNO/28,TPAGENO
..
.          IF        CLNO%28 > 0
.            ADD       ONE,TPAGENO
.          ENDIF
.
CALTPG99  IF       CLNO >= TWENTY9
            ADD      ONE,TPAGENO
          ENDIF
.
          RETURN

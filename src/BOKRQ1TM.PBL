.----------------------------------------------------------------------
. Modifications
.
. V11.03.01  28/02/2023  Peter Vela TSK 0909393
.            Changed KEY for oprsesaf reads
. V11.00.01  10/03/2020  J.Tan      TSK 0838262
.            Added Effective from and to date to MBS Item file
. V10.08.01  08/08/2016  Davin      TSK 0321234
.            Added chronic condition alert (pmpxsn11) at BRQRW000
. V10.06.04  17/07/2015  Peter Vela CAR 319262
.            Fixed age calculation in BRQRW000
. V10.06.03  16/07/2015  Peter Vela CAR 319529
.            Added Approve to RAUR0000
. V10.06.02  04/06/2015  Peter Vela CAR 317611
.            Changed to display operation description in BRQRW00
. V10.06.01  22/05/2015  Peter Vela CAR 312771
.            Added Theatre Request Approvals
. V10.05.06  30/01/2015  Peter Vela CAR 310302
.            Added location desc validation to BRQRW000
. V10.05.05  16/12/2014  Peter Vela CAR 310143
.            Added disability alerts
. V10.05.04  02/12/2014  Peter Vela CAR 308859
.            Added Consent Obtained to BRQRW000
. V10.05.03  19/11/2014  Peter Vela CAR 307781
.            Fixed SP70 comparison of THETCOMP in BRQL1000
.            Checked for Unscheduled status when displaying Book button
.            in BRQRW300
.            Added Booking Request Status hidden variable in BRQRW000
. V10.05.02  17/11/2014  Davin      CAR 307766
.            Fixed alert image display at BRQRW000
. V10.05.01  17/09/2014  J.Tan      CAR 302391
.            Added Surname and Givenname to AllocateUR
. V10.04.01  12/02/2014  Peter Vela CAR 218689
.            Created include
.
.------------------------------------------------------------------------
.   Clear Parameters for Theatre Booking Requests Table
.------------------------------------------------------------------------
.
CLRREQ00  MOVE      SP70,BKREQ001
          MOVE      SP70,BKREQ002
          MOVE      SP70,BKREQ003
          MOVE      SP70,BKREQ004
          MOVE      SP70,BKREQ005
          MOVE      SP70,BKREQ006
          MOVE      SP70,BKREQ007
          MOVE      SP70,BKREQ008
          MOVE      SP70,BKREQ009
          MOVE      SP70,BKREQ010
          MOVE      SP70,BKREQ011
          MOVE      SP70,BKREQ012
          MOVE      SP70,BKREQ013
          MOVE      SP70,BKREQ014
          MOVE      SP70,BKREQ015
          MOVE      SP70,BKREQ016
          MOVE      SP70,BKREQ017
          MOVE      SP70,BKREQ018
          MOVE      SP70,BKREQ019
          MOVE      SP70,BKREQ020
          MOVE      SP70,BKREQ021
          MOVE      SP70,BKREQ022
          MOVE      SP70,BKREQ023
          MOVE      SP70,BKREQ024
          MOVE      SP70,BKREQ025
          MOVE      SP70,BKREQ026
          MOVE      SP70,BKREQ027
          MOVE      SP70,BKREQ028
          MOVE      SP70,BKREQ029
          MOVE      SP70,BKREQ030
          MOVE      SP70,BKREQ031
          MOVE      SP70,BKREQ032
          MOVE      SP70,BKREQ033
          MOVE      SP70,BKREQ034
          MOVE      SP70,BKREQ035
          MOVE      SP70,BKREQ036
          MOVE      SP70,BKREQ037
          MOVE      SP70,BKREQ038
          MOVE      SP70,BKREQ039
          MOVE      SP70,BKREQ040
          MOVE      SP70,BKREQ041
          MOVE      SP70,BKREQ042
          MOVE      SP70,BKREQ043
          MOVE      SP70,BKREQ044
          MOVE      SP70,BKREQ045
          MOVE      SP70,BKREQ046
          MOVE      SP70,BKREQ047
          MOVE      SP70,BKREQ048
          MOVE      SP70,BKREQ049
          MOVE      SP70,BKREQ050
          MOVE      SP70,BKREQ051
          MOVE      SP70,BKREQ052
          MOVE      SP70,BKREQ053
          MOVE      SP70,BKREQ054
          MOVE      SP70,BKREQ055
          MOVE      SP70,BKREQ056
          MOVE      SP70,BKREQ057
          MOVE      SP70,BKREQ058
          MOVE      SP70,BKREQ059
.
CLRREQ99  RETURN
+
.------------------------------------------------------------
. Add Attribute Field
.------------------------------------------------------------
BKRQ0000  BRANCH    FLDITMNO,BKRQ0100,BKRQ0200,BKRQ0300,BKRQ0400,BKRQ0500:
                             BKRQ0600,BKRQ0700,BKRQ0800,BKRQ0900,BKRQ1000:
                             BKRQ1100,BKRQ1200,BKRQ1300,BKRQ1400,BKRQ1500:
                             BKRQ1600,BKRQ1700,BKRQ1800,BKRQ1900,BKRQ2000:
                             BKRQ2100,BKRQ2200,BKRQ2300,BKRQ2400,BKRQ2500:
                             BKRQ2600,BKRQ2700,BKRQ2800,BKRQ2900,BKRQ3000:
                             BKRQ3100,BKRQ3200,BKRQ3300,BKRQ3400,BKRQ3500:
                             BKRQ3600,BKRQ3700,BKRQ3800,BKRQ3900,BKRQ4000:
                             BKRQ4100,BKRQ4200,BKRQ4300,BKRQ4400,BKRQ4500:
                             BKRQ4600,BKRQ4700,BKRQ4800,BKRQ4900,BKRQ5000:
                             BKRQ5100,BKRQ5200,BKRQ5300,BKRQ5400,BKRQ5500:
                             BKRQ5600,BKRQ5700,BKRQ5800,BKRQ5900,BKRQ6000:
                             BKRQ6100,BKRQ6200,BKRQ6300,BKRQ6400,BKRQ6500:
                             BKRQ6600,BKRQ6700,BKRQ6800,BKRQ6900,BKRQ7000:
                             BKRQ7100,BKRQ7200,BKRQ7300,BKRQ7400,BKRQ7500:
                             BKRQ7600,BKRQ7700,BKRQ7800,BKRQ7900,BKRQ8000:
                             BKRQ8100,BKRQ8200,BKRQ8300,BKRQ8400,BKRQ8500:
                             BKRQ8600,BKRQ8700,BKRQ8800,BKRQ8900,BKRQ9000:
                             BKRQ9100,BKRQ9200
.
BKRQ0100  WRITE     HTMLFILE;BKRQURNO;
          GOTO      BKRQ9999
.
BKRQ0200  WRITE     HTMLFILE;BKRQVISN;
          GOTO      BKRQ9999
.
BKRQ0300  WRITE     HTMLFILE;BKRQBKTY;
          GOTO      BKRQ9999
.
BKRQ0400  WRITE     HTMLFILE;BKRQREQN;
          GOTO      BKRQ9999
.
BKRQ0500  WRITE     HTMLFILE;BKRQSTAT;
          GOTO      BKRQ9999
.
BKRQ0600  WRITE     HTMLFILE;BKRQHOSP;
          GOTO      BKRQ9999
.
BKRQ0700  WRITE     HTMLFILE;BKRQPRIO;
          GOTO      BKRQ9999
.
BKRQ0800  WRITE     HTMLFILE;BKRQSNAM;
          GOTO      BKRQ9999
.
BKRQ0900  WRITE     HTMLFILE;BKRQGNAM;
          GOTO      BKRQ9999
.
BKRQ1000  MATCH     SP70,BKRQBDAT
          GOTO      BKRQ9999 IF EQUAL
          UNPACK    BKRQBDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BKRQ9999
.
BKRQ1100  WRITE     HTMLFILE;BKRQGEND;
          GOTO      BKRQ9999
.
BKRQ1200  WRITE     HTMLFILE;BKRQRDOC;
          GOTO      BKRQ9999
.
BKRQ1300  WRITE     HTMLFILE;BKRQUNIT;
          GOTO      BKRQ9999
.
BKRQ1400  MATCH     SP70,BKRQCSDT
          GOTO      BKRQ9999 IF EQUAL
          UNPACK    BKRQCSDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BKRQ9999
.
BKRQ1500  WRITE     HTMLFILE;BKRQCSTM;
          GOTO      BKRQ9999
.
BKRQ1600  WRITE     HTMLFILE;BKRQCTCT;
          GOTO      BKRQ9999
.
BKRQ1700  WRITE     HTMLFILE;BKRQLOCN;
          GOTO      BKRQ9999
.
BKRQ1800  WRITE     HTMLFILE;BKRQADPT;
          GOTO      BKRQ9999
.
BKRQ1900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,BKRQ1910,BKRQ1920
          PACK      KEY6,BKRQEPOW,SP70
          CALL      RDWARD1
          BRANCH    OVRCD,BKRQ9999
          WRITE     HTMLFILE;WBDESC;
          GOTO      BKRQ9999
.
BKRQ1910  WRITE     HTMLFILE;BKRQEPOW;
          GOTO      BKRQ9999
.
BKRQ1920  PACK      DFLTWARD,BKRQEPOW  *post op ward selection list
          CALL      WSEL0000
          GOTO      BKRQ9999
.
BKRQ2000  WRITE     HTMLFILE;BKRQSURG;
          GOTO      BKRQ9999
.
BKRQ2100  WRITE     HTMLFILE;BKRQTHET;
          GOTO      BKRQ9999
.
BKRQ2200  WRITE     HTMLFILE;BKRQANAE;
          GOTO      BKRQ9999
.
BKRQ2300  WRITE     HTMLFILE;BKRQMBS1;
          GOTO      BKRQ9999
.
BKRQ2400  WRITE     HTMLFILE;BKRQMBS2;
          GOTO      BKRQ9999
.
BKRQ2500  WRITE     HTMLFILE;BKRQMBS3;
          GOTO      BKRQ9999
.
BKRQ2600  WRITE     HTMLFILE;BKRQMBD1;
          GOTO      BKRQ9999
.
BKRQ2700  WRITE     HTMLFILE;BKRQMBD2;
          GOTO      BKRQ9999
.
BKRQ2800  WRITE     HTMLFILE;BKRQMBD3;
          GOTO      BKRQ9999
.
BKRQ2900  WRITE     HTMLFILE;BKRQPROR;
          GOTO      BKRQ9999
.
BKRQ3000  WRITE     HTMLFILE;BKRQDURA;
          GOTO      BKRQ9999
.
BKRQ3100  WRITE     HTMLFILE;BKRQINFC;
          GOTO      BKRQ9999
.
BKRQ3200  WRITE     HTMLFILE;BKRQEQU1;
          GOTO      BKRQ9999
.
BKRQ3300  WRITE     HTMLFILE;BKRQEQU2;
          GOTO      BKRQ9999
.
BKRQ3400  WRITE     HTMLFILE;BKRQEQU3;
          GOTO      BKRQ9999
.
BKRQ3500  MATCH     SP70,BKRQCDAT
          GOTO      BKRQ9999 IF EQUAL
          UNPACK    BKRQCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BKRQ9999
.
BKRQ3600  WRITE     HTMLFILE;BKRQCTIM;
          GOTO      BKRQ9999
.
BKRQ3700  WRITE     HTMLFILE;BKRQCUSR;
          GOTO      BKRQ9999
.
BKRQ3800  MATCH     SP70,BKRQUDAT
          GOTO      BKRQ9999 IF EQUAL
          UNPACK    BKRQUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BKRQ9999
.
BKRQ3900  WRITE     HTMLFILE;BKRQUTIM;
          GOTO      BKRQ9999
.
BKRQ4000  WRITE     HTMLFILE;BKRQUUSR;
          GOTO      BKRQ9999
.
BKRQ4100  MATCH     SP70,BKRQCNDT
          GOTO      BKRQ9999 IF EQUAL
          UNPACK    BKRQCNDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BKRQ9999
.
BKRQ4200  WRITE     HTMLFILE;BKRQCNTM;
          GOTO      BKRQ9999
.
BKRQ4300  WRITE     HTMLFILE;BKRQCNUS;
          GOTO      BKRQ9999
.
BKRQ4400  WRITE     HTMLFILE;BKRQCNCD;
          GOTO      BKRQ9999
.
BKRQ4500  WRITE     HTMLFILE;BKRQOPTY;
          GOTO      BKRQ9999
.
BKRQ4600  WRITE     HTMLFILE;BKRQTRCD;
          GOTO      BKRQ9999
.
BKRQ4700  WRITE     HTMLFILE;BKRQATCD;
          GOTO      BKRQ9999
.
BKRQ4800  WRITE     HTMLFILE;BKRQATYP;
          GOTO      BKRQ9999
.
BKRQ4900  WRITE     HTMLFILE;BKRQCTYP;
          GOTO      BKRQ9999
.
BKRQ5000  WRITE     HTMLFILE;BKRQELOS;
          GOTO      BKRQ9999
.
BKRQ5100  WRITE     HTMLFILE;BKRQCTY6;
          GOTO      BKRQ9999
.
BKRQ5200  WRITE     HTMLFILE;BKRQCTY7;
          GOTO      BKRQ9999
.
BKRQ5300  WRITE     HTMLFILE;BKRQCTY8;
          GOTO      BKRQ9999
.
BKRQ5400  WRITE     HTMLFILE;BKRQCTY9;
          GOTO      BKRQ9999
.
BKRQ5500  WRITE     HTMLFILE;BKRQASRC;
          GOTO      BKRQ9999
.
BKRQ5600  WRITE     HTMLFILE;BKRQBTYP;
          GOTO      BKRQ9999
.
BKRQ5700  WRITE     HTMLFILE;BKRQELON;
          GOTO      BKRQ9999
.
BKRQ5800  WRITE     HTMLFILE;BKRQCSNT;
          GOTO      BKRQ9999
.
BKRQ5900  MATCH     SP70,BKRQCCDT
          GOTO      BKRQ9999 IF EQUAL
          UNPACK    BKRQCCDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BKRQ9999
.
BKRQ6000  MOVE      "rp",CATEGORY                * Priority
          MOVE      BKRQPRIO,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ6100  MOVE      "ap",CATEGORY                * Admitting Point
          MOVE      BKRQADPT,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ6200  CALL      TSEL0000
          GOTO      BKRQ9999
.
BKRQ6300  MOVE      "OA",CATEGORY        
          MOVE      BKRQANAE,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ6400  MOVE      "XE",CATEGORY         
          MOVE      BKRQEQU1,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ6500  MOVE      "XE",CATEGORY          
          MOVE      BKRQEQU2,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ6600  MOVE      "XE",CATEGORY           
          MOVE      BKRQEQU3,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ6700  MOVE      "OK",CATEGORY            
          MOVE      BKRQINFC,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ6800  CALL      BRQL0000                     * Theatre Request List
          GOTO      BKRQ9999
.
BKRQ6900  CALL      SELV0000
          GOTO      BKRQ9999
.
BKRQ7000  CALL      PRRQ0000
          GOTO      BKRQ9999
.
BKRQ7100  CALL      NXRQ0000
          GOTO      BKRQ9999
.
BKRQ7200  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      BKRQ9999
.
BKRQ7300  MOVE      "rp",CATEGORY
          MOVE      FILTPRIO,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ7400  WRITE     HTMLFILE;FILTSTAT;
          GOTO      BKRQ9999
.
BKRQ7500  WRITE     HTMLFILE;TABLVIEW;
          GOTO      BKRQ9999
.
BKRQ7600  CALL      TRQL0000                 * Theatre Session Request List
          GOTO      BKRQ9999
.
BKRQ7700  CALL      RAUL0000                 * Theatre Request Audit List
          GOTO      BKRQ9999
.
BKRQ7800  WRITE     HTMLFILE;BKRUAURQ;
          GOTO      BKRQ9999
.
BKRQ7900  MOVE      BKRUAUTY,FORM1
          LOAD      BOKAUDSC,FORM1,BOKAUDS1,BOKAUDS2,BOKAUDS3,BOKAUDS4:
                                   BOKAUDS5,BOKAUDS6,BOKAUDS7,BOKAUDS8
          WRITE     HTMLFILE;BOKAUDSC;
          GOTO      BKRQ9999
.
BKRQ8000  MATCH     SP70,BKRUADAT
          GOTO      BKRQ9999 IF EQUAL
          UNPACK    BKRUADAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      BKRQ9999
.
BKRQ8100  WRITE     HTMLFILE;BKRUATIM;
          GOTO      BKRQ9999
.
BKRQ8200  PACK      KEY10,BKRUAUSR,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,BKRQ9999
          WRITE     HTMLFILE;WBSENAM;
          GOTO      BKRQ9999
.
BKRQ8300  MATCH     SP70,BKRUCNCD
          GOTO      BKRQ9999 IF EQUAL
          GOTO      BKRQ9999 IF EOS
.
          PACK      KEY5,ANSB,ANSC,BKRUCNCD,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,BKRQ9999
.
          WRITE     HTMLFILE;TDESC;
          GOTO      BKRQ9999
.
BKRQ8400  MOVE      BKRUAUTY,FORM1
          BRANCH    FORM1,BKRQ9999,BKRQ9999,BKRQ9999,BKRQ9999:
                          BKRQ9999,BKRQ9999,BKRQ8470
.
          GOTO      BKRQ9999
.
BKRQ8470  MATCH     SP70,BKRUCSDT
          GOTO      BKRQ9999 IF EQUAL
          UNPACK    BKRUCSDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR," at ",BKRUCSTM;
          GOTO      BKRQ9999
.
BKRQ8500  PACK      KEY10,BKRQCUSR,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,BKRQ9999
          WRITE     HTMLFILE;WBSENAM;
          GOTO      BKRQ9999
.
BKRQ8600  MOVE      SP70,DOCFNAME
          MATCH     SP70,BKRQRDOC
          IF        !@EQUAL
            PACK      KEY10,BKRQRDOC,SP70
            CALL      RDPMHCP1
            IF        OVRCD<>1
              MOVE      PMHCTITL,FMTTITLE
              MOVE      PMHCGNAM,FMTGNAME
              MOVE      PMHCSNAM,FMTSNAME
              CALL      DOCNM000
            ENDIF
          ENDIF
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      BKRQ9999
.
BKRQ8700  MOVE      "WU",CATEGORY
          MOVE      BKRQUNIT,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ8800  CALL      OPCOMQ00
          GOTO      BKRQ9999
.
BKRQ8900  MOVE      "BC",CATEGORY                * Cancellation Code
          MOVE      BKRQCNCD,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ9000  WRITE     HTMLFILE;THETCOMP;
          GOTO      BKRQ9999
.
BKRQ9100  MOVE      "BK",CATEGORY
          MOVE      BKRQBKTY,CODE
          CALL      CODITM00
          GOTO      BKRQ9999
.
BKRQ9200  PACK      KEY27,BKRQREQN,SP70
          CALL      RSBKRAU1
BKRQ9210  CALL      RKBKRAU1
          BRANCH    OVRCD,BKRQ9999
.
          MATCH     BKRQREQN,BKRUAURQ
          GOTO      BKRQ9999 IF NOT EQUAL
.
          MATCH     "8",BKRUAUTY
          GOTO      BKRQ9210 IF NOT EQUAL
.
          WRITE     HTMLFILE;"Request Approved ";
.
          MATCH     SP70,BKRUADAT
          IF        !@EQUAL
            UNPACK    BKRUADAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR," at ",BKRUATIM;
          ENDIF
.
          MATCH     SP70,BKRUAUSR
          IF        !@EQUAL
            PACK      KEY10,BKRUAUSR,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              WRITE     HTMLFILE;" by ",WBSENAM;
            ELSE
              WRITE     HTMLFILE;" by ",BKRUAUSR;
            ENDIF
          ENDIF
.
          GOTO      BKRQ9999
.
BKRQ9999  RETURN
+
.------------------------------------------------------------
.   Set Parameters for theatre bookings table
.------------------------------------------------------------
SBKREQ00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SBKREQ01,SBKREQ02,SBKREQ03,SBKREQ04,SBKREQ05:
                       SBKREQ06,SBKREQ07,SBKREQ08,SBKREQ09,SBKREQ10:
                       SBKREQ11,SBKREQ12,SBKREQ13,SBKREQ14,SBKREQ15:
                       SBKREQ16,SBKREQ17,SBKREQ18,SBKREQ19,SBKREQ20:
                       SBKREQ21,SBKREQ22,SBKREQ23,SBKREQ24,SBKREQ25:
                       SBKREQ26,SBKREQ27,SBKREQ28,SBKREQ29,SBKREQ30:
                       SBKREQ31,SBKREQ32,SBKREQ33,SBKREQ34,SBKREQ35:
                       SBKREQ36,SBKREQ37,SBKREQ38,SBKREQ39,SBKREQ40:
                       SBKREQ41,SBKREQ42,SBKREQ43,SBKREQ44,SBKREQ45:
                       SBKREQ46,SBKREQ47,SBKREQ48,SBKREQ49,SBKREQ50:
                       SBKREQ51,SBKREQ52,SBKREQ53,SBKREQ54,SBKREQ55:
                       SBKREQ56,SBKREQ57,SBKREQ58,SBKREQ59 
.
          MOVE      ONE,EXIT
          GOTO      SBKREQ99
.
SBKREQ01  MOVE      QRYDATA,BKREQ001
          GOTO      SBKREQ99
.
SBKREQ02  MOVE      QRYDATA,BKREQ002
          GOTO      SBKREQ99
.
SBKREQ03  MOVE      QRYDATA,BKREQ003
          GOTO      SBKREQ99
.
SBKREQ04  MOVE      QRYDATA,BKREQ004
          GOTO      SBKREQ99
.
SBKREQ05  MOVE      QRYDATA,BKREQ005
          GOTO      SBKREQ99
.
SBKREQ06  MOVE      QRYDATA,BKREQ006
          GOTO      SBKREQ99
.
SBKREQ07  MOVE      QRYDATA,BKREQ007
          GOTO      SBKREQ99
.
SBKREQ08  MOVE      QRYDATA,BKREQ008
          GOTO      SBKREQ99
.
SBKREQ09  MOVE      QRYDATA,BKREQ009
          GOTO      SBKREQ99
.
SBKREQ10  MATCH     SP70,QRYDATA
          GOTO      SBKREQ99 IF EQUAL
          GOTO      SBKREQ99 IF EOS
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      BKREQ010,CCENT,CYEAR,CMON,CDAY
          GOTO      SBKREQ99
.
SBKREQ11  MOVE      QRYDATA,BKREQ011
          GOTO      SBKREQ99
.
SBKREQ12  MOVE      QRYDATA,BKREQ012
          GOTO      SBKREQ99
.
SBKREQ13  MOVE      QRYDATA,BKREQ013
          GOTO      SBKREQ99
.
SBKREQ14  MATCH     SP70,QRYDATA
          GOTO      SBKREQ99 IF EQUAL
          GOTO      SBKREQ99 IF EOS
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      BKREQ014,CCENT,CYEAR,CMON,CDAY
          GOTO      SBKREQ99
.
SBKREQ15  MOVE      QRYDATA,BKREQ015
          GOTO      SBKREQ99
.
SBKREQ16  MOVE      QRYDATA,BKREQ016
          GOTO      SBKREQ99
.
SBKREQ17  MOVE      QRYDATA,BKREQ017
          GOTO      SBKREQ99
.
SBKREQ18  MOVE      QRYDATA,BKREQ018
          GOTO      SBKREQ99
.
SBKREQ19  MOVE      QRYDATA,BKREQ019
          GOTO      SBKREQ99
.
SBKREQ20  MOVE      QRYDATA,BKREQ020
          GOTO      SBKREQ99
.
SBKREQ21  MOVE      QRYDATA,BKREQ021
          GOTO      SBKREQ99
.
SBKREQ22  MOVE      QRYDATA,BKREQ022
          GOTO      SBKREQ99
.
SBKREQ23  MOVE      QRYDATA,BKREQ023
          GOTO      SBKREQ99
.
SBKREQ24  MOVE      QRYDATA,BKREQ024
          GOTO      SBKREQ99
.
SBKREQ25  MOVE      QRYDATA,BKREQ025
          GOTO      SBKREQ99
.
SBKREQ26  MOVE      QRYDATA,BKREQ026
          GOTO      SBKREQ99
.
SBKREQ27  MOVE      QRYDATA,BKREQ027
          GOTO      SBKREQ99
.
SBKREQ28  MOVE      QRYDATA,BKREQ028
          GOTO      SBKREQ99
.
SBKREQ29  MOVE      QRYDATA,BKREQ029
          GOTO      SBKREQ99
.
SBKREQ30  MOVE      QRYDATA,BKREQ030
          GOTO      SBKREQ99
.
SBKREQ31  MOVE      QRYDATA,BKREQ031
          GOTO      SBKREQ99
.
SBKREQ32  MOVE      QRYDATA,BKREQ032
          GOTO      SBKREQ99
.
SBKREQ33  MOVE      QRYDATA,BKREQ033
          GOTO      SBKREQ99
.
SBKREQ34  MOVE      QRYDATA,BKREQ034
          GOTO      SBKREQ99
.
SBKREQ35  MATCH     SP70,QRYDATA
          GOTO      SBKREQ99 IF EQUAL
          GOTO      SBKREQ99 IF EOS
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      BKREQ035,CCENT,CYEAR,CMON,CDAY
          GOTO      SBKREQ99
.
SBKREQ36  MOVE      QRYDATA,BKREQ036
          GOTO      SBKREQ99
.
SBKREQ37  MOVE      QRYDATA,BKREQ037
          GOTO      SBKREQ99
.
SBKREQ38  MATCH     SP70,QRYDATA
          GOTO      SBKREQ99 IF EQUAL
          GOTO      SBKREQ99 IF EOS
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      BKREQ038,CCENT,CYEAR,CMON,CDAY
          GOTO      SBKREQ99
.
SBKREQ39  MOVE      QRYDATA,BKREQ039
          GOTO      SBKREQ99
.
SBKREQ40  MOVE      QRYDATA,BKREQ040
          GOTO      SBKREQ99
.
SBKREQ41  MATCH     SP70,QRYDATA
          GOTO      SBKREQ99 IF EQUAL
          GOTO      SBKREQ99 IF EOS
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      BKREQ041,CCENT,CYEAR,CMON,CDAY
          GOTO      SBKREQ99
.
SBKREQ42  MOVE      QRYDATA,BKREQ042
          GOTO      SBKREQ99
.
SBKREQ43  MOVE      QRYDATA,BKREQ043
          GOTO      SBKREQ99
.
SBKREQ44  MOVE      QRYDATA,BKREQ044
          GOTO      SBKREQ99
.
SBKREQ45  MOVE      QRYDATA,BKREQ045
          GOTO      SBKREQ99
.
SBKREQ46  MOVE      QRYDATA,BKREQ046
          GOTO      SBKREQ99
.
SBKREQ47  MOVE      QRYDATA,BKREQ047
          GOTO      SBKREQ99
.
SBKREQ48  MOVE      QRYDATA,BKREQ048
          GOTO      SBKREQ99
.
SBKREQ49  MOVE      QRYDATA,BKREQ049
          GOTO      SBKREQ99
.
SBKREQ50  MOVE      QRYDATA,BKREQ050
          GOTO      SBKREQ99
.
SBKREQ51  MOVE      QRYDATA,BKREQ051
          GOTO      SBKREQ99
.
SBKREQ52  MOVE      QRYDATA,BKREQ052
          GOTO      SBKREQ99
.
SBKREQ53  MOVE      QRYDATA,BKREQ053
          GOTO      SBKREQ99
.
SBKREQ54  MOVE      QRYDATA,BKREQ054
          GOTO      SBKREQ99
.
SBKREQ55  MOVE      QRYDATA,BKREQ055
          GOTO      SBKREQ99
.
SBKREQ56  MOVE      QRYDATA,BKREQ056
          GOTO      SBKREQ99
.
SBKREQ57  MOVE      QRYDATA,BKREQ057
          GOTO      SBKREQ99
.
SBKREQ58  MOVE      QRYDATA,BKREQ058
          GOTO      SBKREQ99
.
SBKREQ59  MATCH     SP70,QRYDATA
          GOTO      SBKREQ99 IF EQUAL
          GOTO      SBKREQ99 IF EOS
.
          UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      BKREQ059,CCENT,CYEAR,CMON,CDAY
          GOTO      SBKREQ99
.
SBKREQ99  RETURN
.------------------------------------------------------------------------
.         Update theatre bookings request file
.------------------------------------------------------------------------
MVBOKREQ  PACK      BKRQURNO,BKREQ001,SP70
          PACK      BKRQVISN,BKREQ002,SP70
          PACK      BKRQBKTY,BKREQ003,SP70
          PACK      BKRQREQN,BKREQ004,SP70
          PACK      BKRQSTAT,BKREQ005,SP70
          PACK      BKRQHOSP,BKREQ006,SP70
          PACK      BKRQPRIO,BKREQ007,SP70
          PACK      BKRQSNAM,BKREQ008,SP70
          PACK      BKRQGNAM,BKREQ009,SP70
          PACK      BKRQBDAT,BKREQ010,SP70
          PACK      BKRQGEND,BKREQ011,SP70
          PACK      BKRQRDOC,BKREQ012,SP70
          PACK      BKRQUNIT,BKREQ013,SP70
          PACK      BKRQCSDT,BKREQ014,SP70
          PACK      BKRQCSTM,BKREQ015,SP70
          PACK      BKRQCTCT,BKREQ016,SP70
          PACK      BKRQLOCN,BKREQ017,SP70,SP70
          PACK      BKRQADPT,BKREQ018,SP70
          PACK      BKRQEPOW,BKREQ019,SP70
          PACK      BKRQSURG,BKREQ020,SP70
          PACK      BKRQTHET,BKREQ021,SP70
          PACK      BKRQANAE,BKREQ022,SP70
          PACK      BKRQMBS1,BKREQ023,SP70
          PACK      BKRQMBS2,BKREQ024,SP70
          PACK      BKRQMBS3,BKREQ025,SP70
          PACK      BKRQMBD1,BKREQ026,SP70,SP70
          PACK      BKRQMBD2,BKREQ027,SP70,SP70
          PACK      BKRQMBD3,BKREQ028,SP70,SP70
          PACK      BKRQPROR,BKREQ029,SP70
          PACK      BKRQDURA,BKREQ030,SP70
          PACK      BKRQINFC,BKREQ031,SP70
          PACK      BKRQEQU1,BKREQ032,SP70
          PACK      BKRQEQU2,BKREQ033,SP70
          PACK      BKRQEQU3,BKREQ034,SP70
          PACK      BKRQCDAT,BKREQ035,SP70
          PACK      BKRQCTIM,BKREQ036,SP70
          PACK      BKRQCUSR,BKREQ037,SP70
          PACK      BKRQUDAT,BKREQ038,SP70
          PACK      BKRQUTIM,BKREQ039,SP70
          PACK      BKRQUUSR,BKREQ040,SP70
          PACK      BKRQCNDT,BKREQ041,SP70
          PACK      BKRQCNTM,BKREQ042,SP70
          PACK      BKRQCNUS,BKREQ043,SP70
          PACK      BKRQCNCD,BKREQ044,SP70
          PACK      BKRQOPTY,BKREQ045,SP70
          PACK      BKRQTRCD,BKREQ046,SP70
          PACK      BKRQATCD,BKREQ047,SP70
          PACK      BKRQATYP,BKREQ048,SP70
          PACK      BKRQCTYP,BKREQ049,SP70
          PACK      BKRQELOS,BKREQ050,SP70
          PACK      BKRQCTY6,BKREQ051,SP70
          PACK      BKRQCTY7,BKREQ052,SP70
          PACK      BKRQCTY8,BKREQ053,SP70
          PACK      BKRQCTY9,BKREQ054,SP70
          PACK      BKRQASRC,BKREQ055,SP70
          PACK      BKRQBTYP,BKREQ056,SP70
          PACK      BKRQELON,BKREQ057,SP70
          PACK      BKRQCSNT,BKREQ058,SP70
          PACK      BKRQCCDT,BKREQ059,SP70
          RETURN
.------------------------------------------------------------------------
.         Update theatre bookings request audit file
.------------------------------------------------------------------------
MVBOKRAU  PACK      BKRUAURQ,BKRQREQN,SP70
.                   BKRUAUTY - populated before this function depending
.                              on record type
          CALL      IBACLOCK
          PACK      BKRUADAT,CCC,CYY,CMM,CDD
          REP       " 0",BKRUADAT
          MOVE      CTIMEIS,BKRUATIM
          REP       " 0",BKRUATIM
          PACK      BKRUAUSR,WBSEUID,SP70
          PACK      BKRUURNO,BKRQURNO,SP70
          PACK      BKRUVISN,BKRQVISN,SP70
          PACK      BKRUBKTY,BKRQBKTY,SP70
          PACK      BKRUREQN,BKRQREQN,SP70
          PACK      BKRUSTAT,BKRQSTAT,SP70
          PACK      BKRUHOSP,BKRQHOSP,SP70
          PACK      BKRUPRIO,BKRQPRIO,SP70
          PACK      BKRUSNAM,BKRQSNAM,SP70
          PACK      BKRUGNAM,BKRQGNAM,SP70
          PACK      BKRUBDAT,BKRQBDAT,SP70
          PACK      BKRUGEND,BKRQGEND,SP70
          PACK      BKRURDOC,BKRQRDOC,SP70
          PACK      BKRUUNIT,BKRQUNIT,SP70
          PACK      BKRUCSDT,BKRQCSDT,SP70
          PACK      BKRUCSTM,BKRQCSTM,SP70
          PACK      BKRUCTCT,BKRQCTCT,SP70,SP70
          PACK      BKRULOCN,BKRQLOCN,SP70
          PACK      BKRUADPT,BKRQADPT,SP70
          PACK      BKRUEPOW,BKRQEPOW,SP70
          PACK      BKRUSURG,BKRQSURG,SP70
          PACK      BKRUTHET,BKRQTHET,SP70
          PACK      BKRUANAE,BKRQANAE,SP70
          PACK      BKRUMBS1,BKRQMBS1,SP70
          PACK      BKRUMBS2,BKRQMBS2,SP70
          PACK      BKRUMBS3,BKRQMBS3,SP70
          PACK      BKRUMBD1,BKRQMBD1,SP70,SP70
          PACK      BKRUMBD2,BKRQMBD2,SP70,SP70
          PACK      BKRUMBD3,BKRQMBD3,SP70,SP70
          PACK      BKRUPROR,BKRQPROR,SP70
          PACK      BKRUDURA,BKRQDURA,SP70
          PACK      BKRUINFC,BKRQINFC,SP70
          PACK      BKRUEQU1,BKRQEQU1,SP70
          PACK      BKRUEQU2,BKRQEQU2,SP70
          PACK      BKRUEQU3,BKRQEQU3,SP70
          PACK      BKRUCDAT,BKRQCDAT,SP70
          PACK      BKRUCTIM,BKRQCTIM,SP70
          PACK      BKRUCUSR,BKRQCUSR,SP70
          PACK      BKRUUDAT,BKRQUDAT,SP70
          PACK      BKRUUTIM,BKRQUTIM,SP70
          PACK      BKRUUUSR,BKRQUUSR,SP70
          PACK      BKRUCNDT,BKRQCNDT,SP70
          PACK      BKRUCNTM,BKRQCNTM,SP70
          PACK      BKRUCNUS,BKRQCNUS,SP70
          PACK      BKRUCNCD,BKRQCNCD,SP70
          PACK      BKRUOPTY,BKRQOPTY,SP70
          PACK      BKRUTRCD,BKRQTRCD,SP70
          PACK      BKRUATCD,BKRQATCD,SP70
          PACK      BKRUATYP,BKRQATYP,SP70
          PACK      BKRUCTYP,BKRQCTYP,SP70
          PACK      BKRUELOS,BKRQELOS,SP70
          PACK      BKRUCTY6,BKRQCTY6,SP70
          PACK      BKRUCTY7,BKRQCTY7,SP70
          PACK      BKRUCTY8,BKRQCTY8,SP70
          PACK      BKRUCTY9,BKRQCTY9,SP70
          PACK      BKRUASRC,BKRQASRC,SP70
          PACK      BKRUBTYP,BKRQBTYP,SP70
          PACK      BKRUELON,BKRQELON,SP70
          PACK      BKRUCSNT,BKRQCSNT,SP70
          PACK      BKRUCCDT,BKRQCCDT,SP70
.
          RETURN
.
.-----------------------------------------------------------
.        Generate Unique Theatre Request Booking Number
.-----------------------------------------------------------
GUTRN000  MOVE      "113",PRXCODE
          CALL      GETSLK00
          READ      CONTROLF,HUND13;*19,OPCNUTRN
.
GUTRN100  MOVE      OPCNUTRN,BKRQREQN
          UNPACK    OPCNUTRN,ANS,KEY9
          MATCH     "a",ANS
          GOTO      GUTRN115 IF LESS
          MOVE      ZERO,F9
          MOVE      KEY9,F9
.
GUTRN110  COMPARE   "999999999",F9               * at the end of the group
          GOTO      GUTRN111 IF NOT EQUAL
.
          MATCH     "z",ANS
          GOTO      GUTRN900 IF EQUAL
.
          REP       REPUNIQ,ANS
          MOVE      ZERO,F9
.
GUTRN111  ADD       ONE,F9
          MOVE      F9,D9
          REP       " 0",D9
.
          PACK      KEY10,ANS,D9,SP70
          CALL      RDBKRQ11
          IF        OVRCD=ONE
            GOTO      GUTRN950
          ENDIF
.
          GOTO      GUTRN110
.
. no records
.
GUTRN115  MOVE      ONE,F9
          MOVE      "a",ANS
.
          MOVE      F9,D9
          REP       " 0",D9
.
          PACK      KEY10,ANS,D9,SP70
          GOTO      GUTRN950
.
GUTRN900  MOVE      ONE,EXIT                  * Passcode allocation full
          GOTO      GUTRN999
.
GUTRN950  MOVE      KEY10,OPCNUTRN 
          WRITAB    CONTROLF,HUND13;*19,OPCNUTRN
.
          MATCH     "0000000000",BKRQREQN
          GOTO      GUTRN100 IF EQUAL
.
GUTRN999  CALL      RELSLK00
          RETURN
.------------------------------------------------------------
. Operating Room/Theatre Code Selection
.------------------------------------------------------------
TSEL0000  PACK      KEY6,SP70
          CALL      RSOPOPR1
TSEL0100  CALL      RKOPOPR1
          BRANCH    OVRCD,TSEL9999
.
          COMPARE   ONE,OPRMSTAT            * Is theatre inactive?
          GOTO      TSEL0100 IF EQUAL       * Yes, do not display
.
          MOVE      OPRMDESC,KEY35
          PACK      KEY8,QUOTE,OPRMROOM,QUOTE
          MATCH     BKRQTHET,OPRMROOM
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                               KEY35,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY8,">",KEY35,"</option>"
          ENDIF
          GOTO      TSEL0100
.
TSEL9999  RETURN
.
.------------------------------------------------------------
. Theatre Request List
.------------------------------------------------------------
BRQL0000  MOVE      ZERO,PRIOCNTR
.
          MATCH     SP70,FILTPRIO
          IF        !@EQUAL & !@EOS
            PACK      KEY21,FRSTDATE,FILTPRIO,SP70
            CALL      RDBKRQ13
          ELSE
            MATCH     "3",FILTSTAT
            IF        @EQUAL
              PACK      KEY19,FRSTDATE,ONE,SP70
            ELSE 
              PACK      KEY19,FRSTDATE,FILTSTAT,SP70
            ENDIF
            CALL      RSBKRQ14
          ENDIF
.
BRQL1000  MATCH     SP70,FILTPRIO
          IF        !@EQUAL & !@EOS
            CALL      RKBKRQ13
          ELSE
            CALL      RKBKRQ14
          ENDIF
          BRANCH    OVRCD,BRQL9999
.
          MATCH     BKRQCDAT,LASTDATE
          GOTO      BRQL9999 IF LESS
.
          MATCH     SP70,FILTPRIO
          IF        !@EQUAL
            MATCH     BKRQPRIO,FILTPRIO
            GOTO      BRQL1000 IF NOT EQUAL
          ENDIF
.
          CALL      GTTH0000
.
          MATCH     SP70,FILTSTAT
          IF        !@EQUAL
            MATCH     "3",FILTSTAT
            IF        @EQUAL
              MATCH     "1",BKRQSTAT
              GOTO      BRQL1000 IF NOT EQUAL
              MATCH     SP70,THETCOMP
              GOTO      BRQL1000 IF EQUAL  
            ELSE
              MATCH     "1",FILTSTAT
              IF        @EQUAL
                MATCH     "1",BKRQSTAT
                GOTO      BRQL1000 IF NOT EQUAL
                MATCH     SP70,THETCOMP
                GOTO      BRQL1000 IF NOT EQUAL
              ELSE
                MATCH     BKRQSTAT,FILTSTAT
                GOTO      BRQL1000 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
          CALL      BRQRW000
.
          GOTO      BRQL1000 
.
BRQL9999  RETURN
.
.------------------------------------------------------------
. Theatre Request List Row
.------------------------------------------------------------
BRQRW000  MATCH     SP70,BKRQURNO
          IF        !@EQUAL & !@EOS
            PACK      KEY8,BKRQURNO,SP70
            CALL      RDMAST1  
            IF        OVRCD=0
              CALL      RDPMPX21
              IF        OVRCD=1
                CALL      CLPMSPX2
              ENDIF
              UNPACK    PBDATE,CDAY,CMON,CYEAR,CCENT
              CALL      IBACLOCK
              IF        PCEASE=1
                MOVE      PDECDTE,AGEDATE            * Date of Death
              ELSE
                PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
              ENDIF
              REP       " 0",AGEDATE
              CALL      CALCAGE
              CALL      PATLN000
              CALL      PATFLD00
              MOVE      KEY3,FOLDERSF           * and store suffix
            ELSE
              CALL      CLPMSPX2
              PACK      FORMATNM,SP70,SP70
              MOVE      SP70,FOLDERSF
            ENDIF
          ELSE
            MOVE      BKRQSNAM,PSNAME
            MOVE      BKRQGNAM,PGNAME
            MOVE      BKRQSNAM,PTMASNAM
            MOVE      SP70,PTITL
            CALL      PATNAM00
            PACK      FORMATNM,PATFNAME,SP70
          ENDIF
.
          MOVE      SP70,PRIOASC1
          MOVE      SP70,PRIOASSN
          MOVE      SP70,PRIOHEQV
          MOVE      BKRQPRIO,PRIODESC
          MATCH     SP70,BKRQPRIO
          IF        !@EQUAL & !@EOS
            PACK      KEY5,CATrp,BKRQPRIO,SP70
            CALL      RDCODE1
            IF        OVRCD=0
               ASSIGN    (TCFORM6*60),PRIOASSN             * Convert into min
               MOVE      PRIOASSN,PRIOASSD
               LJUSTIFY  PRIOASSD
               MOVE      THCSCOD,PRIOHEQV
               MOVE      PTCDASC1,PRIOASC1
            ENDIF
          ENDIF
.
          MOVE      BKRQUNIT,UNITDESC
          MATCH     SP70,BKRQUNIT
          IF        !@EQUAL & !@EOS
            PACK      KEY5,ANSW,ANSU,BKRQUNIT,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,UNITDESC
            ENDIF
          ENDIF
.
          MOVE      SP70,CSDATSTR
          MATCH     SP70,BKRQCSDT
          IF        !@EQUAL & !@EOS
            UNPACK    BKRQCSDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      CSDATSTR,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR 
          ENDIF
          PACK      CSDATDSC,BKRQCSDT,BKRQCSTM
.
          MOVE      SP70,RQDATSTR
          MATCH     SP70,BKRQCDAT
          IF        !@EQUAL & !@EOS
            UNPACK    BKRQCDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      RQDATSTR,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          PACK      RQDATDSC,BKRQCDAT,BKRQCTIM
.
BRQRW100  MOVE      BKRQLOCN,LOCNDESC
          MATCH     SP70,BKRQVISN
          IF        !@EQUAL & !@EOS
            PACK      KEY8,BKRQVISN,SP70
            CALL      RDMISS1
            IF        OVRCD=0
              IF        ASTAT=2
                PACK      LOCNDESC,AWARD,SP1,SLASH,SP1,ABED
                PACK      KEY6,AWARD,SP70
                CALL      RDWARD1
                IF        OVRCD=0
                  PACK      LOCNDESC,PTWDSDES,SP1,SLASH,SP1,ABED
                ENDIF
              ENDIF
            ENDIF            
          ELSE
            PACK      KEY17,BKRQURNO,TWO,SP70
            CALL      RSPTMI18
            CALL      RKPTMI18
            IF        OVRCD=0
              MATCH     AURNO,BKRQURNO
              IF        @EQUAL
                IF        ASTAT=2
                  PACK      LOCNDESC,AWARD,SP1,SLASH,SP1,ABED
                  PACK      KEY6,AWARD,SP70
                  CALL      RDWARD1
                  IF        OVRCD=0
                    PACK      LOCNDESC,PTWDSDES,SP1,SLASH,SP1,ABED
                  ENDIF
              ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      BKRQCNCD,CANCDESC
          MATCH     SP70,BKRQCNCD
          IF        !@EQUAL & !@EOS
            PACK      KEY5,ANSB,ANSC,BKRQCNCD,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,CANCDESC
            ENDIF
          ENDIF
.
.         MOVE      SP70,CNDATDSC
.         MATCH     SP70,BKRQCNDT
.         IF        !@EQUAL & !@EOS
.           UNPACK    BKRQCNDT,CCENT,CYEAR,CMON,CDAY
.           MOVE      CMON,F2
.           LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.           PACK      CNDATDSC,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.         ENDIF
          PACK      CNDATDSC,BKRQCNDT,BKRQCNTM
.
          PACK      CNUSRDSC,BKRQCNUS,SP70
          PACK      KEY10,BKRQCNUS,SP70
          CALL      RDWBSE1
          IF        OVRCD=0
            MOVE      WBSENAM,CNUSRDSC
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"":
                             HTMLLINK,"&nbsp;#",#"";                 * 0
.
          REP       " +",BKRQREQN
          REP       " +",BKRQURNO
          REP       " +",BKRQVISN
          REP       " +",BKRQSNAM
          REP       " +",BKRQGNAM
.
          ADD       ONE,PRIOCNTR
          MOVE      PRIOCNTR,PRIOCNTD
          REP       " 0",PRIOCNTD
.
          WRITE     HTMLFILE;PRIODESC:
                             "<A HREF=javascript:UpdateTheatreRequest('":
                             BKRQREQN,"','",BKRQURNO,"','",BKRQVISN,"')>":
                             "<img src=../images/EditIcon.gif hspace=4 ":
                             "border=0></a>":            
                             "<input type=hidden":
                             " name=priod",PRIOCNTD," value='",PRIOASSD,"'>":
                             "<input type=hidden":
                             " name=priov",PRIOCNTD," value='",PRIOHEQV,"'>":
                             "<input type=hidden":
                             " name=pridt",PRIOCNTD," value='",BKRQCSDT,"'>":
                             "<input type=hidden":
                             " name=pritm",PRIOCNTD," value='",BKRQCSTM,"'>":
                             "<input type=hidden":
                             " name=pritc",PRIOCNTD," value='",THETCOMP,"'>":
                             "<input type=hidden":
                             " name=prist",PRIOCNTD," value='",BKRQSTAT,"'>":
                             "<input type=hidden value='",OPSEDATE,"'>":
                             "<input type=hidden value='",PRIOASC1,"'>":
                             "&nbsp;#",#"";                         * 1
.
          MATCH     "++++++++",BKRQURNO
          IF        @EQUAL
            WRITE     HTMLFILE;"<A HREF=javascript:AllocateUR('":
                               BKRQREQN,"','",BKRQSNAM,"','",BKRQGNAM,"')>":
                               "<img src=../images/ActionIcon.gif hspace=4 ":
                               "border=0></a>":
                               FORMATNM:
                               "&nbsp;#",#"";                       * 2
          ELSE
            WRITE     HTMLFILE;"<A HREF=javascript:GotoUR('":
                               BKRQURNO,"','",BKRQVISN,"')>":
                               "<img src=../images/PatientFolder":
                               FOLDERSF,".gif hspace=4 ":
                               "border=0></a>":
                               FORMATNM:
                               "&nbsp;#",#"";                       * 2
          ENDIF
.
          MATCH     "++++++++",BKRQURNO
          IF        !@EQUAL
.                                                                   * 3
            MOVE      ZERO,EXIT
            PROC      DISPALRT                * check for Disability Alerts
            IF        EXIT=0 | EXIT=2
.
            MATCH     "1",PMPXSIN7
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIconM.gif'":
                                 " class=ListIcon onclick=PatientAlerts('":
                                 BKRQURNO,"','",BKRQVISN,"');>";
            ENDIF
            MATCH     "1",PMPXSIN8
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIconB.gif'":
                                 " class=ListIcon onclick=PatientAlerts('":
                                 BKRQURNO,"','",BKRQVISN,"');>";
            ENDIF
            MATCH     "1",PMPXSIN9
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIconR.gif'":
                                 "class=ListIcon onclick=PatientAlerts('":
                                 BKRQURNO,"','",BKRQVISN,"');>";
            ENDIF
            MATCH     "1",PMPXSN11
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIconC.gif'":
                                 "class=ListIcon onclick=PatientAlerts('":
                                 BKRQURNO,"','",BKRQVISN,"');>";
            ENDIF
            MATCH     "1",PTMXSIN1
             IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIcon.gif'":
                                 " class=ListIcon onclick=PatientAlerts('":
                                 BKRQURNO,"','",BKRQVISN,"');>";
              GOTO      BRQRW300
            ENDIF
            MATCH     "2",PTMXSIN1
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIconBlack.gif'":
                                 "class=ListIcon onclick=PatientAlerts('":
                                 BKRQURNO,"','",BKRQVISN,"');>";
              GOTO      BRQRW300
            ENDIF
.
            MATCH     "3",PTMXSIN1
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIconDelete.gif'":
                                 " class=ListIcon onclick=PatientAlerts('":
                                 BKRQURNO,"','",BKRQVISN,"');>";
              GOTO      BRQRW300
            ENDIF
.
            MATCH     SP70,PTMXSIN1
            IF        !@EQUAL
              WRITE     HTMLFILE;"<img src='../images/AlertIcon":
                                 PTMXSIN1,".gif'":
                                 " class=ListIcon onclick=PatientAlerts('":
                                 BKRQURNO,"','",BKRQVISN,"');>";
            ENDIF
.
            ENDIF
.
BRQRW300    IF        EXIT=1 | EXIT=2
              WRITE     HTMLFILE;"<img src='../images/AlertIconDIS.gif'":
                                 " class=ListIcon onclick=PatientAlerts('":
                                 BKRQURNO,"','",BKRQVISN,"');>";
            ENDIF
.
.
            WRITE     HTMLFILE;"&nbsp;#",#"";
.
          ELSE
            WRITE     HTMLFILE;"&nbsp;#",#"";                       * 3
          ENDIF
.
          REP       "+ ",BKRQREQN
          REP       "+ ",BKRQURNO
          REP       "+ ",BKRQVISN
          REP       "+ ",BKRQSNAM
          REP       "+ ",BKRQGNAM
. 
.         PACK      KEY17,BKRQMBS1,SP70
.         CALL      PATITMRD
.         IF        OVRCD=1
.           MOVE      BKRQMBD1,IDESC                                * 4
.         ENDIF
          WRITE     HTMLFILE;BKRQMBD1," ",BKRQMBD2," ",BKRQMBD3,"&nbsp;#",#"";
.
          MOVE      SP70,DOCFNAME
          MATCH     SP70,BKRQRDOC
          IF        !@EQUAL
            PACK      KEY10,BKRQRDOC,SP70
            CALL      RDPMHCP1
            IF        OVRCD<>1
              MOVE      PMHCTITL,FMTTITLE
              MOVE      PMHCGNAM,FMTGNAME
              MOVE      PMHCSNAM,FMTSNAME
              CALL      DOCNM000
            ENDIF
          ENDIF
          REP       " +",BKRQRDOC
          WRITE     HTMLFILE;"<a href=":
                             "javascript:DoctorViewFrame('",BKRQRDOC,"')>":
                             DOCFNAME,"</a>":
                             "&nbsp;#",#"";                         * 5
          REP       "+ ",BKRQRDOC
.
          WRITE     HTMLFILE;UNITDESC,"&nbsp;#",#"";                * 6
.
          WRITE     HTMLFILE;CSDATDSC,"&nbsp;#",#"";   * 7
.
          WRITE     HTMLFILE;PRIOASSD,"#",#"";         * 8
          WRITE     HTMLFILE;PRIOHEQV,"#",#"";         * 9
.
          WRITE     HTMLFILE;"&nbsp;#",#"";            * 10 
.                                                      (Calculated on front end)
.
          WRITE     HTMLFILE;LOCNDESC,"&nbsp;#",#"";   * 11 
.
          REP       " +",BKRQREQN
          REP       " +",BKRQURNO
          REP       " +",BKRQVISN
          REP       " +",BKRQSURG
.
          MATCH     "++++++++",BKRQURNO
          IF        !@EQUAL & !@EOS
            MATCH     "1",OPCNUTRA
            IF        @EQUAL
              MATCH     "0",BKRQSTAT
              IF        @EQUAL
                WRITE     HTMLFILE;"<input type=button name=approvetheatre ":
                                   "onclick=ApproveTheatre('":
                   BKRQREQN,"'); ":
                                   "value=Approve class=button>";
              ELSE
                MATCH     "A",BKRQSTAT
                IF        @EQUAL
                  WRITE     HTMLFILE;"<input type=button name=booktheatre ":
                                     "onclick=BookTheatre('":
                   BKRQURNO,"','",BKRQVISN,"','",BKRQREQN,"','",BKRQSURG,"'); ":
                                     "value=Book class=button>";
                ENDIF
              ENDIF
            ELSE
              MATCH     "0",BKRQSTAT
              IF        @EQUAL
                WRITE     HTMLFILE;"<input type=button name=booktheatre ":
                                   "onclick=BookTheatre('":
                   BKRQURNO,"','",BKRQVISN,"','",BKRQREQN,"','",BKRQSURG,"'); ":
                                   "value=Book class=button>";
              ENDIF
            ENDIF
            WRITE     HTMLFILE;"&nbsp;#",#"";          * 12 
          ELSE
            MATCH     "1",OPCNUTRA
            IF        @EQUAL
              MATCH     "0",BKRQSTAT
              IF        @EQUAL
                WRITE     HTMLFILE;"<input type=button name=approvetheatre ":
                                   "onclick=ApproveTheatre('":
                   BKRQREQN,"'); ":
                                   "value=Approve class=button>";
              ENDIF
            ENDIF
            WRITE     HTMLFILE;"&nbsp;#",#"";          * 12
          ENDIF
.
          REP       "+ ",BKRQREQN
          REP       "+ ",BKRQURNO
          REP       "+ ",BKRQVISN
          REP       "+ ",BKRQSURG
.
          MOVE      SP70,DOCFNAME
          MATCH     SP70,BKRQSURG
          IF        !@EQUAL
            PACK      KEY10,BKRQSURG,SP70
            CALL      RDPMHCP1
            IF        OVRCD<>1
              MOVE      PMHCTITL,FMTTITLE
              MOVE      PMHCGNAM,FMTGNAME
              MOVE      PMHCSNAM,FMTSNAME
              CALL      DOCNM000
            ENDIF
          ENDIF
          REP       " +",BKRQSURG
          WRITE     HTMLFILE;"<a href=":
                             "javascript:DoctorViewFrame('",BKRQSURG,"')>":
                             DOCFNAME,"</a>":
                             "&nbsp;#",#"";                         * 13
          REP       "+ ",BKRQSURG 
.
          CALL      GTTH0000
          MOVE      SP70,DOCFNAME
          MATCH     SP70,ANAECODE
          IF        !@EQUAL
            PACK      KEY10,ANAECODE,SP70
            CALL      RDPMHCP1
            IF        OVRCD<>1
              MOVE      PMHCTITL,FMTTITLE
              MOVE      PMHCGNAM,FMTGNAME
              MOVE      PMHCSNAM,FMTSNAME
              CALL      DOCNM000
            ENDIF
          ENDIF
          REP       " +",ANAECODE
          WRITE     HTMLFILE;"<a href=":
                             "javascript:DoctorViewFrame('",ANAECODE,"')>":
                             DOCFNAME,"</a>":
                             "&nbsp;#",#"";                         * 14
          REP       "+ ",ANAECODE
.
          WRITE     HTMLFILE;THETDATE,THETTIME:
                             "&nbsp;#",#"";                         * 15
.
          WRITE     HTMLFILE;THETOPER,"&nbsp;#",#"";                * 16
.
          WRITE     HTMLFILE;THETSTAT,"&nbsp;#",#"";                * 17
.
          WRITE     HTMLFILE;RQDATDSC,"&nbsp;#",#"";                * 18
.
          CALL      GETBOK00
          WRITE     HTMLFILE;BOKRDATE,"#",#"";                      * 19
.
.         MOVE      SP70,ARDATDSC
.         MATCH     SP70,THETARRD
.         IF        !@EQUAL & !@EOS
.           UNPACK    THETARRD,CCENT,CYEAR,CMON,CDAY
.           MOVE      CMON,F2
.           LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.           PACK      ARDATDSC,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.           WRITE     HTMLFILE;ARDATDSC," at ",THETARRT,"&nbsp;#",#""; * 20
.         ELSE
            WRITE     HTMLFILE;THETARRD,THETCOMP:
                               "&nbsp;#",#"";                          * 20
.         ENDIF
.
          WRITE     HTMLFILE;"<input type=hidden":
                             " name=clsdt",PRIOCNTD," value='",BKRQCSDT,"'>":
                             "<input type=hidden":
                             " name=clstm",PRIOCNTD," value='",BKRQCSTM,"'>":
                             "<input type=hidden":
                             " name=arrdt",PRIOCNTD," value='",THETARRD,"'>":
                             "<input type=hidden":
                             " name=arrtm",PRIOCNTD," value='",THETCOMP,"'>":
                             "<input type=hidden":
                             " name=brcht",PRIOCNTD," value='",PRIOASSD,"'>";
          WRITE     HTMLFILE;"&nbsp;#",#"";                          * 21 
.
          WRITE     HTMLFILE;CANCDESC:
                             "&nbsp;#",#"";                          * 22
.
          WRITE     HTMLFILE;CNDATDSC:
                             "&nbsp;#",#"";                          * 23

          WRITE     HTMLFILE;CNUSRDSC:
                             "&nbsp;#",#"";                          * 24
.
          CALL      GTRQEQ00
.
          WRITE     HTMLFILE;EQUIDES1,"<br>":
                             EQUIDES2,"<br>":
                             EQUIDES3:
                             "&nbsp;#",#"";                          * 25
.
          WRITE     HTMLFILE;RQDATSTR," ",BKRQCTIM,"<br>":
                             CSDATSTR," ",BKRQCSTM:
                             "&nbsp;#",#"";                          * 26
.
          WRITE     HTMLFILE;BKRQREQN,"&nbsp;#",#"";                 * 27
.
          MOVE      SP70,DIM3
          MATCH     ANSN,BKRQCSNT
          IF        @EQUAL
            MOVE      "No ",DIM3
          ENDIF
.
          MATCH     ANSY,BKRQCSNT
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ENDIF
.
          MOVE      SP70,DIM15
          MATCH     "0",BKRQSTAT
          IF        @EQUAL
            MOVE      "Unscheduled    ",DIM15
          ENDIF
.
          MATCH     "1",BKRQSTAT
          IF        @EQUAL
            MOVE      "Scheduled      ",DIM15
          ENDIF
.
          MATCH     "2",BKRQSTAT
          IF        @EQUAL
            MOVE      "Cancelled      ",DIM15
          ENDIF
.
          WRITE     HTMLFILE;DIM3," / ",DIM15,"#");"                        * 28
.
BRQRW999  RETURN
.
.*******************************************************************************
.                          Previous Day, Week, Month
.*******************************************************************************
PRRQ0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          REP       " +",FILTPRIO
          REP       " +",FILTSTAT
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;"oprweb01.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&viewtype=",VIEWTYPE:
                             "&filtprio=",FILTPRIO:
                             "&filtstat=",FILTSTAT;
.
          REP       "+ ",FILTPRIO
          REP       "+ ",FILTSTAT
.
PRRQ9999  RETURN
.
.*******************************************************************************
.                          Next Day, Week, Month
.*******************************************************************************
NXRQ0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          REP       " +",FILTPRIO
          REP       " +",FILTSTAT
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;"oprweb01.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&viewtype=",VIEWTYPE:
                             "&filtprio=",FILTPRIO:
                             "&filtstat=",FILTSTAT;
.
          REP       "+ ",FILTPRIO
          REP       "+ ",FILTSTAT
.
NXRQ9999  RETURN
.
.*******************************************************************************
.                          Get Anaesthetist if available
.*******************************************************************************
GTTH0000  MOVE     SP70,ANAECODE
          MOVE     SP70,THETDATE
          MOVE     SP70,THETTIME
          MOVE     SP70,THETOPER
          MOVE     SP70,THETSTAT
          MOVE     SP70,THETARRD
          MOVE     SP70,THETARRT
          MOVE     SP70,THETCOMP
.
          MATCH    SP70,BKRQVISN
          GOTO     GTTH9999 IF EQUAL
          GOTO     GTTH9999 IF EOS
.
          PACK     KEY31,BKRQVISN,SP70
          CALL     RSOPDEA2
GTTH0010  CALL     RKOPDEA2
          BRANCH   OVRCD,GTTH9999
.
          MATCH    OPDAADMN,BKRQVISN
          GOTO     GTTH9999 IF NOT EQUAL
.
          MATCH    OPDAREQN,BKRQREQN
          GOTO     GTTH0010 IF NOT EQUAL
.
.         UNPACK   OPDADATE,CCENT,CYEAR,CMON,CDAY
.         MOVE     CMON,F2
.         LOAD     MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.         PACK     THETDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          MOVE     OPDADATE,THETDATE
.
          MOVE     OPDATIME,THETTIME
          MOVE     OPDATHET,THETOPER
.
          PACK     KEY22,OPDAHOSP,OPDADATE,OPDATIME,OPDACLIN,SP70
          CALL     RDOPSES1
          BRANCH   OVRCD,GTTH2000
.
          PACK     ANAECODE,OPSEANAE,SP70
.
          IF       OPSESTAT=ZERO
            MOVE     "Cancelled",THETSTAT
          ENDIF
.
          IF       OPSESTAT=ONE
            MOVE     "Active - Booked",THETSTAT
          ENDIF
.
          IF       OPSESTAT=TWO
            MOVE     "Active - Extra Session",THETSTAT
          ENDIF
.
          PACK     THETSTAT,THETSTAT,SP70
.
GTTH2000  PACK     KEY10,OPDAUNIQ,SP70
          CALL     RDOPARD1
          BRANCH   OVRCD,GTTH9999
.
          MATCH    SP70,OPARATIM
          IF       !@EQUAL & !@EOS
            MOVE     OPARATIM,THETARRT
            MOVE     OPDADATE,THETARRD
          ENDIF
.
          PACK     KEY11,OPDAUNIQ,ONE,SP70
          CALL     RDOPSRG1
          IF       OVRCD=1
            MOVE     SP70,OPSGTIPS
            MOVE     SP70,OPSGTISS
            MOVE     SP70,OPSGTISE
            MOVE     SP70,OPSGTIDR
          ENDIF
.
          MOVE     ZERO,FORM2
          MOVE     OPCNTRCS,FORM2
.         
          LOAD     THETCOMP,FORM2,OPARTCAL,OPARATIM,OPARANAP,OPARANAS:
                                  OPSGTIPS,OPSGTISS,OPSGTISE,OPARANAE:
                                  OPSGTIDR,OPARTIRF,OPARTIRB,OPARTIRD:
                                  OPARTIDP,OPARTETC
                                  
.
GTTH9999  RETURN
.*******************************************************************************
.                          Get Booking if available
.*******************************************************************************
GETBOK00  MOVE     SP70,BOKRDATE
.
          MATCH    SP70,BKRQVISN
          GOTO     GETBOK99 IF EQUAL
          GOTO     GETBOK99 IF EOS
.
          PACK     KEY8,BKRQVISN,SP70
          CALL     RDBKREC1
          BRANCH   OVRCD,GETBOK99
.
          MATCH    SP70,BKREBKDT
          GOTO     GETBOK99 IF EQUAL
          GOTO     GETBOK99 IF EOS
.
.         UNPACK   BKREBKDT,CCENT,CYEAR,CMON,CDAY
.         MOVE     CMON,F2
.         LOAD     MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.         PACK     BOKRDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR          
          MOVE     BKREBKDT,BOKRDATE
.
GETBOK99  RETURN
.------------------------------------------------------------
. Theatre Session Request List
.------------------------------------------------------------
TRQL0000  MOVE      ZERO,PRIOCNTR
.
          PACK      KEY17,ZERO,SP70                * Theatre needed in this key?
          CALL      RSBKRQ15
TRQL1000  CALL      RKBKRQ15
          BRANCH    OVRCD,TRQL9999
.
          MATCH     "0",BKRQSTAT
          GOTO      TRQL9999 IF NOT EQUAL
.
.         MATCH     BKRQTHET,OPSETHET
.         GOTO      TRQL9999 IF NOT EQUAL
.
          CALL      BRQRW000
.
          GOTO      TRQL1000
.
TRQL9999  RETURN
.
.------------------------------------------------------------
. Get Equipment from Theatre Requests Table
.------------------------------------------------------------
GTRQEQ00  MOVE      SP70,EQUIDES1
          MOVE      SP70,EQUIDES2
          MOVE      SP70,EQUIDES3
.
          MATCH     SP70,BKRQEQU1
          IF        !@EQUAL & !@EOS
            PACK      KEY5,ANSX,ANSE,BKRQEQU1,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,EQUIDES1
            ENDIF
          ENDIF
.
          MATCH     SP70,BKRQEQU2
          IF        !@EQUAL & !@EOS
            PACK      KEY5,ANSX,ANSE,BKRQEQU2,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,EQUIDES2
            ENDIF
          ENDIF
.
          MATCH     SP70,BKRQEQU3
          IF        !@EQUAL & !@EOS
            PACK      KEY5,ANSX,ANSE,BKRQEQU3,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,EQUIDES3
            ENDIF
          ENDIF
.
GTRQEQ99  RETURN
.
.------------------------------------------------------------
. Theatre Request Audit List
.------------------------------------------------------------
RAUL0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          PACK      KEY18,URNUMBER,SP70
          CALL      RSBKRQ12
RAUL0100  CALL      RKBKRQ12
          BRANCH    OVRCD,RAUL9999
.
          MATCH     URNUMBER,BKRQURNO
          GOTO      RAUL9999 IF NOT EQUAL
.
          PACK      KEY27,BKRQREQN,SP70
          CALL      RSBKRAU1
RAUL0200  CALL      RKBKRAU1
          BRANCH    OVRCD,RAUL0100
.
          MATCH     BKRQREQN,BKRUAURQ
          GOTO      RAUL0100 IF NOT EQUAL
.
          CALL      RAUR0000
.
          GOTO      RAUL0200 
.
RAUL9999  RETURN
.
.------------------------------------------------------------
. Theatre Request Audit List Row
.------------------------------------------------------------
RAUR0000  MOVE      SP70,UPDVALRQ
          MATCH     "7",BKRUAUTY
          IF        @EQUAL
            UNPACK    BKRUCSDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      UPDVALRQ,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,BKRUCSTM
          ENDIF
.
          PACK      CNUSRDSC,BKRUAUSR,SP70         * User Id and Desc
          PACK      KEY10,BKRUAUSR,SP70
          CALL      RDWBSE1
          IF        OVRCD=0
            MOVE      WBSENAM,CNUSRDSC
          ENDIF 
.
          MOVE      BKRUCNCD,CANCDESC              * Cancellation Reason
          MATCH     SP70,BKRUCNCD
          IF        !@EQUAL & !@EOS
            PACK      KEY5,ANSB,ANSC,BKRUCNCD,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,CANCDESC
            ENDIF
          ENDIF
.
          MOVE      SP70,BOKAUDSC                  * Audit Type
          MOVE      BKRUAUTY,FORM1
          LOAD      BOKAUDSC,FORM1,BOKAUDS1,BOKAUDS2,BOKAUDS3,BOKAUDS4:
                                   BOKAUDS5,BOKAUDS6,BOKAUDS7,BOKAUDS8 
.
          CLEAR     HTMLLINK                       * Audit Link
          APPEND    "javascript:displayTheatreRequestAudit('",HTMLLINK
          APPEND    BKRUAURQ,HTMLLINK
          APPEND    BKRUADAT,HTMLLINK
          APPEND    BKRUATIM,HTMLLINK
          APPEND    BKRUAUTY,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          STRIP     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",BKRUAURQ,"#",":
                             "#"",BKRUADAT,BKRUATIM,"#",":
                             "#"",BOKAUDSC,"#",":
                             "#"",CANCDESC,"#",":
                             "#"",CNUSRDSC,"#",":
                             "#"",UPDVALRQ,"#")"

.
RAUR9999  RETURN
.------------------------------------------------------------
. Comments
.------------------------------------------------------------
OPCOMQ00  UNPACK    DIM127,ANS,OPCOMTYP,DIM127
          PACK      KEY16,BKRQREQN,OPCOMTYP,SP70
          CALL      RSOPDED1
OPCOMQ10  CALL      RKOPDED1
          BRANCH    OVRCD,OPCOMQ99
          MATCH     OPDDUNIQ,BKRQREQN
          GOTO      OPCOMQ99 IF NOT EQUAL
          MATCH     OPDDTYPE,OPCOMTYP
          GOTO      OPCOMQ99 IF NOT EQUAL
          STRIP     OPDDDATA
          MOVELPTR  OPDDDATA,LENGTH
          SFORMAT   VAR,LENGTH
          MOVE      OPDDDATA,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,127
          GOTO      OPCOMQ10
.
OPCOMQ99  RETURN
.
.------------------------------------------------------------
. Cancel Scheduled Request Booking
.------------------------------------------------------------
CANRQ100  MATCH     SP70,OPDAREQN
          GOTO      CANRQ199 IF EQUAL
          GOTO      CANRQ199 IF EOS
.
          MATCH     SP70,BKREQ005
          GOTO      CANRQ199 IF EQUAL
          GOTO      CANRQ199 IF EOS          
.
          PACK      KEY10,OPDAREQN,SP70
          CALL      RDBKRQ11
          BRANCH    OVRCD,CANRQ199
.
          MOVE      BKREQ005,BKRQSTAT
          MATCH     "0",BKRQSTAT
          IF        @EQUAL
            MOVE      SP70,BKRQVISN
          ENDIF
.
          MOVE      BKREQ044,BKRQCNCD
          CALL      IBACLOCK
          PACK      BKRQCNDT,CCC,CYY,CMM,CDD
          REP       " 0",BKRQCNDT
          CLOCK     TIME,BKRQCNTM 
          MOVE      WBSEUID,BKRQCNUS
.
          CALL      UPBKRQ11
.
          CALL      CLBOKRAU
          MATCH     "0",BKRQSTAT
          IF        @EQUAL
            MOVE      FIVE,BKRUAUTY
          ELSE
            MOVE      THREE,BKRUAUTY
          ENDIF
          CALL      MVBOKRAU
.
          PACK      KEY27,BKRUAURQ,BKRUADAT,BKRUATIM,BKRUAUTY,SP70
          CALL      RABKRAU1
          IF        OVRCD=1
            CALL      WRBKRAU1
          ENDIF
.
CANRQ199  RETURN

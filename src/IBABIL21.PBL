.******************************************************************************
.*                                                                            *
.*              P R O G R A M  S U M M A R Y                                  *
.*              -------------  -------------                                  *
.*                                                                            *
.*     PROGRAM NAME:     IBABIL21                                             *
.*                                                                            *
.*     FUNCTION:         RE-PRINT PATIENT INVOICES                            *
.*                                                                            *
.*     DATE WRITTEN:     27/07/86                                             *
.*                                                                            *
.*     AUTHOR:           MALCOLM HAYSE (I.B.A) W2.00                          *
.*                                                                            *
.*     MODIFICATIONS:                                                         *
.*                                                                            *
.*----------------------------------------------------------------------------*
.* V12.00.03 06/10/2025  J.Tan          TSK 0966784                           *
.*           Recompiled for PATCATAI - Fixed printing ICD10 on reprint        *
.* V12.00.02 30/09/2025  Thanh T        TSK 0937505                           *
.*           Recompiled for PATINVHL changes                                  *
.* V12.00.01 30/05/2025  Don Nguyen     TSK 0955096                           *
.*           Alphanumeric visit number changes                                *
.*----------------------------------------------------------------------------*
.*        V11.04.01 07/11/2024 Thanh T         TSK 0946085                    *
.*                  Added RCCNSTRF field - Display Statement Reference        *
.*----------------------------------------------------------------------------*
.*        V11.03.03 08/11/2023  Nikitha B      TSK 0927699c                   *
.*                  Read CAPPRVNO and PTCNHABN for Hospital Approval          * 
.*                  and ABN number.                                           *
.*        V11.03.02 04/10/2023  Nikitha B      TSK 0927699                    *
.*                  Recompiled for PATINVHL, PATINVTL - Stationary variables  *
.*        V11.03.01 15/06/2023  Bella Turco    TSK 0931756                    *
.*                  Recompiled for PRTINVBD                                   *
.*        V11.02.01 09/02/2022  Thanh T       TSK 0905641                     *
.*                  Recompiled as OUTMA1FD changes                            *
.*        V11.01.07 14/09/2021  Davin           TSK 0911277                   *
.*                  Recompiled for PRTINVBD                                   *
.*        V11.01.06 10/09/2021  Davin           TSK 0911277                   *
.*                  Recompiled for PATINVTL - Changed field 20 length to 12.2 *
.*        V11.01.05 31/08/2021  J.Tan           TSK 0910799                   *
.*                  Recompiled for PRTINVBD - printing Referring ADF          *
.*        V11.01.04 24/08/2021  Davin           TSK 0897318                   *
.*                  Recompiled for PATINVTL - added field 57(Adjustment Total)*
.*        V11.01.03 03/08/2021  J.Tan           TSK 0909724                   *
.*                  Recompiled for PRTINVBD - SJOG invoice                    *
.*        V11.01.02 07/06/2021  J.Tan           TSK 0888369                   *
.*                  Fixed I*C nzpspraf                                        *
.*        V11.01.01 27/04/2021  Thanh T        TSK 0895165                    *
.*                  Recompiled for OPRARDFD changes                           *
.*----------------------------------------------------------------------------*
.*        V11.00.04 19/01/2021  J.Tan          TSK 0883075                    *
.*                  Recompiled for PRTINVBD - mod to print ADF addr.on invoice*
.*        V11.00.03 14/10/2020  J.Tan          TSK 0894879                    *
.*                  Recompiled for PRTINVBD - Print 30 item desc.for RCH Inv. *
.*        V11.00.02 08/04/2020 J.Tan           TSK 0868813                    *
.*                  Recompiled for PATINVHL                                   *
.*                  15/04/2020 Thanh T         TSK 0879163                    *
.*                  Added SEXDSP00                                            *
.*----------------------------------------------------------------------------*
.*        V11.00.01 10/03/2020  Jill Parkinson Task 0879163                   *
.*                  Added include SEXDSCIO                                    *
.*        V10.14.01 09/09/2019  J.Tan           TSK 0857392                   *
.*                  Recompiled for ABF invoice                                *
.*        V10.12.02 11/05/2018  J.Tan          TSK 0856648                    *
.*                  Added PMI Extension (pmspx2af) on Reprint Invoice         *
.*        V10.12.01 28/02/2018  J.Tan          TSK 0852351                    *
.*                  Recompiled for PATINVHL-fields 226 227(Program Code/Desc) *
.*        V10.10.01 11/04/2017  J.Tan          TSK 0836088                    *
.*                  Mod to get service doctor for Invoice items grouped by Doc*
.*        V10.09.01 19/01/2017  J.Tan          TSK 0829932                    *
.*                  Recompiled for PATANVS - PRFA add4 default from Master rec*
.*        V10.08.02 07/11/2016  Ebon Clements   TSK 0827937                   *
.*                  Recompiled for PATINVHL - Hospital approval number        *
.*        V10.08.01 02/05/2016  Ebon Clements   TSK 0268970                   *
.*                  Change to use OUTCLIFD index 1 instead of index 2         *
.*        V10.07.01 18/11/2015  J.Tan           CAR 303942                    *
.*                  Added new payment types                                   *
.*        V10.06.07 14/08/2015  J.Tan           CAR 320073                    *
.*                  Recompiled for PATCATAI-reprint invoice for unreleased csh*
.*        V10.06.06 07/08/2015  Davin         CAR 317002                      *
.*                  Recompiled for PRTINVBD - Print pmexname for ADF MO       *
.*        V10.06.05 14/07/2015  Peter Vela     CAR 318700                     *
.*                  Recompiled for PRBILCMN - Validate for deleted VISMDT     *
.*                  record                                                    *
.*        V10.06.04 23/06/2015  J.Tan          CAR 318039                     *
.*                  Recompiled for PRBILCMN -printing billing comments for EMR*
.*        V10.06.03 09/06/2015  J.Tan          CAR 316116                     *
.*                  Recompiled for PATCATAI - printing receipts details       * 
.*        V10.06.02 15/05/2015  Davin         CAR 310155                      *
.*                  Recompiled for PATGBCRN - added MOD10V05 for BPAY         *
.*        V10.06.01 02/04/2015  Ania P         CAR 313236                     *
.*                  Recompiled for PRTINVBD                                   *
.*        V10.05.06 10/02/2015 J.Tan      CAR 311717                          *
.*                  Recompiled for PATINVHL                                   *
.*        V10.05.05 12/01/2014  Peter Vela     CAR 310738                     *
.*                  Recompiled for PRTINVBD                                   *
.*        V10.05.04 29/10/2014 J.Tan     CAR 307268                           *
.*                  Recompiled for PATCATAI - print date for Mech.Ventilation *
.*        V10.05.03 28/10/2014 J.Tan     CAR 304455                           *
.*                  Recompiled for PATINVHL -fixed Doctor Name and Provider no*
.*        V10.05.02 27/10/2014 J.Tan     CAR 302440                           *
.*                  Recompiled PATCATAI - Unreleased Banked receipt           *
.*        V10.05.01 08/10/2014  J.Tan          CAR 302769                     *
.*                  Added range of Claim code and Health Fund                 *
.*        V10.04.05 24/06/2014  J.Tan          CAR 302586                     *
.*                  Recompiled for PATCATAI - problem printing cheque drawer  *
.*        V10.04.04 23/06/2014  J.Tan          CAR 302586                     *
.*                  Recompiled for PATCATAI - problem printing cheque drawer  *
.*        V10.04.03 23/06/2014  J.Tan          CAR 302586                     *
.*                  Recompiled for PATCATAI - problem printing payer details  *
.*        V10.04.02 26/02/2014  J.Tan          CAR 275810                     *
.*                  Recompiled for PRTINVBD - to print Defence Force details  *
.*        V10.04.01 20/01/2014  J.Tan          CAR 273713                     *
.*                  Recompiled for PRTINVBD -Print payment types of a receipt *
.*        V10.03.12 09/12/2013  Ania P         CAR 294740                     *
.*                  Recompiled for PATINVHL                                   *
.*        V10.03.11 12/09/2013  Peter Vela     CAR 271911                     *
.*                  Recompiled for PATINVTL                                   *
.*        V10.03.10 04/07/2013  J.Tan          CAR 287959                     *
.*                  Mods to set WEBFLAG to one                                *
.*        V10.03.09 20/06/2013  Davin          CAR 287161                     *
.*                  Recompiled for PATGBCRN - right justify ptcnhbpi          *
.*        V10.03.08 17/04/2013  Don Nguyen     CAR 282342                     *
.*                  Recompiled for PATINVHL, PATINVTL                         *
.*        V10.03.07 09/04/2013  Don Nguyen     CAR 282342                     *
.*                  Recompiled for PATGBCRN, PATINVHL, PATINVTL               *
.*        V10.03.06 05/03/2013  Patrick Adair  CAR 281898                     *
.*                  Recompiled for PRNTICDC                                   *
.*        V10.03.05 18/07/2012  Don Nguyen     CAR 264561                     *
.*                  Recompiled for PATGBCRN                                   *
.*        V10.03.04 06/01/2012 J.Tan           CAR 257430                     *
.*                  Fixed printing lumpsum description                        *
.*        V13.03.03 16/12/2011 Mike Laming     CAR 257430                     *
.*                  Fixes in DLUM0000, OLUM0000 & RPRTINV for Lump Sum desc.  *
.*        V10.03.02 29/11/2011 J.Tan           CAR 254776                     *
.*                  Recompiled for PATINVHL - added variables for full address*
.*        V10.03.01 03/11/2011 J.Tan  CAR 235425                              *
.*                  Mods printing SX invoice                                  *
.*        V10.02.03 12/10/2011 J.Tan  CAR 235370                              *
.*                  Recompiled for PATINVHL - NHI names for SX                *
.*        V10.02.02 22/09/2011  J.Tan  CAR 251774                             *
.*                  Fixed I*C pmsvx1af                                        *
.*        V10.02.01 04/04/2011  Jill Parkinson CAR 239574                     *
.*                  Removed open of ibaprntf                                  *
.*        V10.01.01 10/12/2010  J.Tan           CAR 233034                    *
.*                  Mods for Contract ID to per-diem bed fees                 *
.*        V10.00.04 26/10/2010  Davin           CAR 231481                    *
.*                  Recompiled for PATCATAI - added ward provider number (hea)*
.*        V10.00.03 16/09/2010 J.Tan            CAR 229937                    *
.*                  Recompiled for PATANVS -multiple pages for Cabrini invoice*
.*        V10.00.02 22/07/2010  J.Tan         CAR 226975                      *
.*                  Recompiled for PATCATAI - I*C on htmlfile for printing    * 
.*                  credit note with bpay on inv.tail                         *
.*        V10.00.01 21/06/2010 J.Tan          CAR 218905                      *
.*                  Recompiled for PATCATAI-printing No of Accom.days for SJOG*
.*        V9.12.06  27/01/2010  J.Tan         CAR 214417                      *
.*                  Fixed printing PRFA for SX Funder invoice                 *
.*        V9.12.05  04/12/2009  Peter Vela    CAR 202333                      *
.*                  Recompiled for PATINVHL - Changed variable 88 to          * 
.*                  surname only                                              *
.*        V9.12.04  24/11/2009  Davin         CAR 210721                      *
.*                  Recompiled for CHKCMXPT - I*C on patcmxaf file            *
.*        V9.12.03  24/10/2009  J.Tan         CAR 210064                      *
.*                  Recompiled for PATCATAI - print SJOG unit price of Misc.  *
.*        V9.12.02  08/09/2009  J.Tan          CAR 205303                     *
.*                  Added Casemix Contract ID                                 *
.*        V9.12.01  21/07/2009  J.Tan          CAR 199603                     *
.*                  Recompiled for PATCATAI - prints ICD codes on TAC/WC Inv. *
.*        V9.11.05  07/04/2009  Mike Laming   CAR 171702                      *
.*                  Recompiled for PATINVHL - Add "IBABIL31" to Re-print Head *
.*        V9.11.04  01/04/2009  J.Tan         CAR 192772                      *
.*                  Recompiled for PATCATAI - Mods to Johns Hopkins invoice   *
.*        V9.11.03  23/03/2009  Davin         CAR 178015                      *
.*                  Recompiled for PATINVHL - Changed BPAY CRN to use inv. no.*
.*        V9.11.02  24/02/2009 J.Tan      CAR 188205                          *
.*                  Mods to print 'Non-bank deposit' as 'Payment recieved'    *
.*        V9.11.01  14/10/2008  Peter Vela    CAR 159227                      *
.*                  Recompiled for PATINVHL - Added Emergency Invoice         *
.*                  Arrival Date and Time                                     *
.*        V9.10.02  13/05/2008  Ebon Clements CAR 166566                      *
.*                  Recompiled for PATINVHL                                   *
.*        V9.10.01  09/05/2008 Ebon Clements  CAR 168171                      *
.*                  Added open of RCPBNKA1                                    *
.*        V9.09.16  01/02/2008 J.Tan  CAR 160221                              *
.*                  Fixed re-print non-balanced invoice for SX                *
.*        V9.09.15  27/12/2007  Peter Vela    CAR 155907                      *
.*                  Recompiled for PATINVTL                                   *
.*        V9.09.14  22/11/2007  J.Tan         CAR 155607                      *
.*                  Fixed printing SJOG cash to check for cancelled status and*
.*                  amount                                                    *
.*        V9.09.13  16/11/2007 Peter Vela         110766                      *
.*                  Recompiled for PATINVHL                                   *
.*        V9.09.12  12/11/2007 Peter Vela         151199                      *
.*                  Added new Emergency Cancellation status
.*        V9.09.11  07/11/2007 Sandra Barcham     149623                      *
.*                  Included credit note totals in minimum calculation        *
.*        V9.09.10  30/10/2007 Sandra Barcham     149623                      *
.*                  Included credit note totals in minimum calculation        *
.*        V9.09.09  13/09/2007 J.Tan          CAR 149664                      *
.*                  Recompiled for PATCATAI - I*C                             *
.*        V9.09.08  12/09/2007 Jill Habasque  CAR 149664                      *
.*                  Added another open of pmsvx1af                            *
.*        V9.09.07  10/08/2007 Peter Vela     CAR 146143                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.06  25/07/2007 Peter Vela     CAR 144787                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.05  13/07/2007 Sandra Barcham CAR 142686                      *
.*                  Fix I * C on rcpdtea3                                     *
.*        V9.09.04  03/07/2007 Peter Vela     CAR 142173                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.03  29/06/2007 Peter Vela     CAR 142173                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.02  25/06/2007 Peter Vela     CAR 142173                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.01  14/06/2007  J.Tan         CAR 142173                      *
.*                  Recompiled for PATCATAI - Emergency events                *
.*        V9.08.13  10/05/2007  J.Tan         CAR 140468                      *
.*                  Mods not to close controlf file                           *
.*        V9.08.12  17/04/2007  J.Tan         CAR 138571                      *
.*                  Recompiled for PATCATAI - No doc.charge for outpatients   *
.*        V9.08.11  15/03/2007  J.Tan         CAR 136149                      *
.*                  Mods to use default claim code from system parameter      *
.*        V9.08.10  19/02/2007 Peter Vela     CAR 135241                      *
.*                  Recompiled for WEBDINVS - St. John of God invoice layout  *
.*        V9.08.09  13/12/2006  J.Tan         CAR 127625                      *
.*                  Mods to JH HRN                                            *
.*        V9.08.08  05/12/2006  J.Tan         CAR 127092                      *
.*                  Recompiled for PATCATAI - JH Invoices                     *
.*        V9.08.07  27/11/2006  Steve Armstrong   CAR 126039                  *
.*                  Recompiled for changes to SGCHKDIG                        *
.*        V9.08.06  16/11/2006  Steve Armstrong   CAR 124160                  *
.*                  Recompiled for PATINVHL (Singapore HRN)                   *
.*                  Recompiled for PATINVTL (Singapore HRN)                   *
.*        V9.08.05  14/11/2006  Peter Vela    CAR 124547                      *
.*                  Added reads for PTCNDEES PTCNDDES                         *
.*        V9.08.04  26/10/2006  J.Tan         CAR 122541                      *
.*                  Recompiled for PATCATAI-Alternate Item group for JH invoic*
.*        V9.08.03  20/10/2006  J.Tan          CAR 118490                     *
.*                  Mods to set diagnosis and health fund for outpat/aae      *
.*        V9.08.02  11/10/2006  Jill Habasque CAR 121261                      *
.*                  Recompiled for PATINVHL                                   *
.*        V9.08.01  29/09/2006  Peter Vela    CAR 120319                      *
.*                  Recompiled for PATINVHL                                   *
.******************************************************************************
.*        V9.07.05  25/09/2006  Peter Vela    CAR 118940                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.07.04  06/09/2006  Jill Habasque CAR 109852                      *
.*                  Added procedure GETALIDS                                  *
.*        V9.07.03  18/08/2006  J.Tan         CAR 115853                      *
.*                  Recompiled for PATCATAI - printing claim for Pendlebury   *
.*        V9.07.02  02/08/2006  Peter Vela    CAR 113658                      *
.*                  Recompiled for PATCATAI - Fixed Date and Cash Payment     *
.*                  display                                                   *
.*        V9.07.01  25/07/2006  Peter Vela    CAR 113658                      * 
.*                  Recompiled for PATCATAI - Fixed "Journal Total" display   *
.*        V9.06.02  16/05/2006  Peter Vela    CAR 104103                      *
.*                  Recompiled for PATCATAI - PTCNINVL=12                     *
.*        V9.06.01  24/04/2006  J.Tan         CAR 102287                      *
.*                  Recompiled for PATINVHL - fields for multi hospitaldetails*
.*        V9.05.02  29/03/2006  Peter Vela    CAR 95780                       *
.*                  Recompiled for PATINVHL - Added emg mobile contact numbers*
.*        V9.05.01  27/03/2006  Peter Vela    CAR 61299                       *
.*                  Recompiled for PATINVHL                                   *
.*        V9.05.B01 02/10/2005  J.Tan         CAR 89413                       *
.*                  Recompiled for PATCATAI - Mods printing 2nd line acc.desc.*
.*                  Recompiled for PATCATAI - Print Invoice comments          *
.*        V9.04.28  11/10/2005  J.Tan         CAR 79727                       *
.*                  Recompiled for PATCATAI - Fixed printing grosstot         *
.*        V9.04.27  27/09/2005  J.Tan         CAR 77671                       *
.*                  Recompiled for PATCATAI - GROSSTOT overlapping fields     *
.*        V9.04.26  06/09/2005  J.Tan         CAR 74862                       *
.*                  Recompiled for PATCATAI - layout 11 printing payment total*
.*        V9.04.25  10/08/2005  J.Tan        CAR 66543                        *
.*                  Recompiled for PATCATAI - printing RCH invoice tail       *
.*        V9.04.24  01/08/2005 J.Tan   CAR  69340                             *
.*                  Recompiled for PATCATAI - fixed printing credit note total*
.*        V9.04.23  14/07/2005  Peter Vela     CAR 62172                      *
.*                  Recompiled for PATINVTL                                   *
.*        V9.04.22  12/07/2005  J.Tan          CAR 67096                      *
.*                  Recompiled for PATCATAI - fixed TROFF000                  *
.*        V9.04.21  28/06/2005  Peter Vela     CAR 65165                      *
.*                  Recompiled for PATANVS                                    *
.*        V9.04.20  06/06/2005  J.Tan          CAR 61641                      *
.*                  Fixed print Ballarat invoice with claim                   *
.*        V9.04.19  31/05/2005  J.Tan          CAR 61641                      *
.*                  Fixed RHS multiple page invoice                           *
.*        V9.04.18  27/05/2005  J.Tan          CAR 61641                      *
.*                  Added page number to invoice tail                         *
.*        V9.04.17  10/05/2005  J.Tan         CAR 61488                       *
.*                  Recompile for PATINVHL - Ballarat invoice                 *
.*        V9.04.16  10/05/2005  J.Tan         CAR 61488                       *
.*                  Mods for Ballarat invoice layout 19 landscape             *
.*        V9.04.15  04/03/2005  J.Tan         CAR 57321                       *
.*                  Recompiled for PATCATAI - SVHM Reprint invoice with Adjust*
.*        V9.04.14  24/02/2005  J.Tan         CAR 58263                       *
.*                  Recompiled for PATCATAI - printing item description       *
.*        V9.04.13  17/02/2005  Mike Laming   CAR 56030                       *
.*                  Re-compile for PATINV25 - fix screen painted tail printing*
.*        V9.04.12  09/12/2004  J.Tan         CAR 55635                       *
.*                  Recompiled for PATINVTL - Receipt amount on invoice tail  *
.*        V9.04.11  03/12/2004  J.Tan   CAR 55599                             *
.*                  Recompiled for PATCATAI - Calvary ACT invoice layout      *
.*        V9.04.10  16/11/2004  Guomin Fu  CAR 54768                          *
.*                  Recompiled for PATCATAI - Pendlebury layout(PTCNINVL=16)  *
.*        V9.04.09  28/10/2004  J.Tan    CAR 54453                            *
.*                  Fixed EMG discharged date  from Event file                *
.*        V9.04.08  26/10/2004  J.Tan    CAR 54380                            *
.*                  Recompiled for PATCATAI-fixed unit price amnt for OUT/EMG *
.*        V9.04.07  26/10/2004  J.Tan   CAR 54532                             *
.*                  Recompiled for PATCATAI - SVHM Emergency invoice          *
.*        V9.04.06  15/10/2004  J.Tan   CAR 52765                             *
.*                  Recompiled for PATCATAI - SVHM outpatient invoice         *
.*        V9.04.05  01/10/2004  Peter Vela CAR 52906                          *
.*                  Recompiled for PATCATAI                                   *
.*                  22/09/2004  Lina Vo  CAR 53660                            *
.*                  Recompiled for PATCATAI                                   *
.*        V9.04.04  06/09/2004  Lina Vo  CAR 52998                            *
.*                  Recompiled for PATANVS, PATINVHL & PATDINVS.              *
.*        V9.04.03  02/09/2004  J.Tan    CAR 53073                            *
.*                  Mods for multi hospital                                   *
.*        V9.04.02  27/08/2004  J.Tan    CAR 52835                            *
.*                  Recompiled for PATCATAI - multi hospital                  *
.*        V9.04.01  27/08/2004  J.Tan    CAR 52891                            *
.*                  Recompiled for PATCATAI - printing journals over payments *
.*        V9.03.11  11/06/2004  Mike Laming   CAR 49016  July 2004 PRS/2      *
.*                  - Add Sex Description routine SEXDSC00 with Code "R" -    *
.*                  "Intersex" added                                          *
.*       V9.03.10  06/04/2004  Peter Vela  CAR 48227                          *
.*                 Added VARGBCRN and PATGBCRN - BPAY Reference Number        *
.*       V9.03.09  03/02/2004  J.Tan  CAR 45047                               *
.*                 Recompiled for PATCATAI - Non-banked Cash                  *
.*       V9.03.08  19/12/2003 J.Tan   CAR 44093                               *
.*                 Replaced patcashf with comdepaf                            *
.*       V9.03.07  21/11/2003  J.Tan   CAR  44161                             *
.*                 Recompiled for PATCATAI - print credit note                *
.*       V9.03.06  07/11/2003  Peter Vela  CAR 44849                          *
.*                 Recompiled for PATVINTL                                    *
.*       V9.03.05  03/11/2003  Peter Vela  CAR 44757                          *
.*                 Recompiled for PATVINTL                                    *
.*       V9.03.04  04/09/2003  CAR 42713   Mike Laming                        *
.*                 Recompiled for PATINVTL (correct GST twice in final Total) *
.*       V9.03.03  18/08/2003  Tracey Nguyen CAR 40940                        *
.*                 Added codes to display the Outpatient clinic description   *
.*                 and the HCP name for Outpatient invoices.                  *
.*       V9.03.02  31/07/2003  J.Tan   CAR 40786                              *
.*                 Mods to read parameter for printing two lines of desc.     *
.*                 28/07/2003  Lina Vo CAR 41196                              *
.*                 Open outbb1af at beginning to fix I*C problem.             *
.*                 Added dummy section WEBERR00 for PATANVS.PBL.              *
.*                 Recompiled for changes in PATSELFN to use comcodaf instead *
.*                 of controlf & ibasmaaf.                                    *
.*       V9.03.01  20/06/2003  J.Tan  CAR 40417                               *
.*                 Fixed reprint for SVHM and removed form feed               *
.*       V9.02.31  02/05/2003  CAR 38750   Mike Laming                        *
.*                 Add GST Journal to NetTotal calculations in Optns 4,5 & 6  *
.*       V9.02.30  04/04/2003  Dean Cramer   CAR 36512                        *
.*                 Recompiled for PATCATAI - Skip display prompts for web     *
.*       V9.02.29  03/04/2003  Dean Cramer   CAR 37906                        *
.*                 Recompiled for PATCATAI - fix SVHM journal totals puting   *
.*                 out the invoice body length.                               * 
.*       V9.02.28  05/03/2003  Dean Cramer   CAR 36833                        *
.*                 Recompiled for PATCATAI                                    *
.*                 Fix Descriptions in accommodation display for Calvary C.   *
.*       V9.02.27  03/01/2003  Dean Cramer   CAR 34374                        *
.*                 Recompiled for PATCATAI                                    *
.*                 Fix so Misc Item Descriptions print for Calvary Cairns.    *
.*                 Make so body length consistent for all Calvary Invoices.   *
.*       V9.02.26  12/11/2002  J.Tan                                          *
.*                 Recompiled for PATCATAI                                    *
.*       V9.02.25  26/10/2002  Dean Cramer defect                             *
.*                 Include Outpatient Clinic Name  - Access                   * 
.*                 Recompile for PATINVHL - Outpatient Clinic Name - Extract  *
.*                 Remove Quantity in Outpatient Misc Items for RCH PATACTAI  * 
.*                 Make Outpatient body same as produced by IBAOUT20          *
.*                 17/10/2002  Dean Cramer defect 23126                       *
.*                 Recompiled for PATCATAI - Calvary Cairns page slew before  *
.*                 total line print.                                          *
.*       V9.02.24  14/10/2002  Dean Cramer defect 22662                       *
.*                 Recompiled for includes re St.V's format.                  *
.*       V9.02.23  08/07/2002  Dean Cramer                                    *
.*                 Recompiled include changes for Calvary Cairns              *
.*       V9.02.22  25/07/2002  Dean Cramer                                    *
.*                 Recompiled for PATCATAI - RCH format when claims           *
.*       V9.02.21  19/07/2002  Dean Cramer                                    *
.*                 Recompiled for PATCATAI - RCH to avoid rebates section     *
.*       V9.02.20  16/07/2002  Dean Cramer                                    *
.*                 Recompiled for PATCATAI - indicate multiple misc items     *
.*       V9.02.19  25/06/2002  Dean Cramer                                    *
.*                 Recompiled for OUTCATBI                                    *
.*       V9.02.18  21/06/2002  Dean Cramer                                    *
.*                 Recompiled for PATCATAI, PATINVTL & PATINV23               *
.*                                         - RCH formats                      *
.*       V9.02.17  13/06/2002  Dean Cramer                                    *
.*                 Recompiled for PATCATAI - RCH formats                      *
.*       V9.02.16  03/06/2002  J.Tan                                          *
.*                 Recompiled for casemix billing                             *
.*       V9.02.15  30/05/2002  J.Tan  defect 17679                            *
.*                 Recompiled for PATCATAI - no theatre fees desc for RCH SVH *
.*       V9.02.14  29/05/2002  J.Tan                                          *
.*                 Recompiled for PATINVHL - fixed insurance claim variable   *
.*        V9.02.13  27/05/2002  J.Tan                                         *
.*                  Recompile for PATCATAI - release 6.09 changes             *
.*        V9.02.12  17/05/2002  J.Tan                                         *
.*                  Recompile for PATCATAI - release 6.09 changes             *
.*        V9.02.11  03/05/2002  J.Tan                                         *
.*                  Recompile for PATCATAI - Emergency has no GST             *
.*        V9.02.10  01/05/2002  J.Tan                                         *
.*                  Mods to open emrvisaf and outbb1 file                     *
.*        V9.02.08  18/04/2002  J.Tan                                         *
.*                  Recompiled for PATINVTL - STV invoice layout              *
.*        V9.02.07  12/04/2002  J.Tan                                         *
.*                  Recompiled for PATCATAI PATANVS                           *
.*        V9.02.06  26/03/2002  J.Tan                                         *
.*                  Recompiled for PATCATAI                                   *
.*        V9.02.05  07/02/2002  Bronko Sosic                                  *
.*                  Recompiled for PATINVS                                    *
.*        V9.02.04  07/12/2001  Tonii                                         *
.*                  Recompiled for PATCATBI - Casemix changes                 *
.*        V9.02.03  22/10/2001  Dean Cramer                                   *
.*                  Recompiled for PATINVS. Also make spool and printer       *
.*                  select at end for web.                                    *
.*        V9.02.02  13/10/2001  J.Tan                                         *
.*                  Recompiled for PATDINVS                                   *
.*        V9.02.01  22/09/2001  Tonii  SRF 13075                              *
.*                  Recompiled for PATCATAI                                   *
.******************************************************************************
.*        V5.08.16  22/11/2000  Greg Horvat                                   *
.*                  Recompiled for PATCATAI - Commented out any code to do    *
.*                  with Hong Kong or Mt Alvernia                             *
.*        V5.08.15  09/11/2000  Ebon Clements SRF 6891                        *
.*                  Recompiled for PATINVS read patmchgf with key26           *
.*        V5.08.14  20/10/2000  Steve Downing                                 *
.*                  Recompiled for PATANVS                                    *
.*        V5.08.13  06/10/2000  Davin                                         *
.*                  Recompiled for Ann Caudle invoices                        *
.*        V5.08.12  29/09/2000  Jill Habasque SRF 3060                        *
.*                  Recompiled for PATINVHL                                   *
.*        V5.08.11  29/09/2000  Jill Habasque SRF 6328                        *
.*                  Recompiled for PATCATAI                                   *
.*        V5.08.10  19/09/2000  Davin  SRF 6070                               *
.*                  Recompiled for invoice templating                         *
.*        V5.08.09  28/08/2000  Tonii                                         *
.*                  Mods to accept Unknown and Indeterminate as valid patient *
.*                  sex description                                           *
.*        V5.08.08  17/08/2000  Davin                                         *
.*                  Recompiled for PATANVS - added formfeed for MBF (2 page)  *
.*        V5.08.07  16/08/2000  Caleb Sharman                                 *
.*                  Changed Health Fund variables to be 8 chars               *
.*        V5.08.06  24/07/2000  Davin                                         *
.*                  Recompiled for PATINVTL - template multipage invoice tail *
.*        V5.08.05  06/07/2000  Davin                                         *
.*                  Recompiled for PATINVHL, PATINVTL & PATCATAI              *
.*        V5.08.04  29/06/2000  Steve Armstrong                               *
.*                  Recompiled for PATCATAI                                   *
.*        V5.08.03  06/06/2000  Jill Habasque                                 *
.*                  Changed from key10 to key14 for the health fund file      *
.*        V5.08.02  16/05/2000  J.Tan                                         *
.*                  Recompiled for PATCATAI - print invoice on landscape      *
.*        V5.08.B04 10/04/2000  Greg Horvat                                   *
.*                  Removed MATADAFD MATADBFD & MATADBIO                      *
.*        V5.08.B03 30/03/2000  Davin                                         *
.*                  Recompiled for invoice templating                         *
.*        V5.08.B02 11/03/2000 Steve Armstrong        5.08 Mods               *
.*                  Mods for changes to OUTCLIFD (effective date)             *
.*        V5.08.B01 05/01/2000 J.Tan                                          *
.*                  Recompiled for PATANVS - Mods to have zero filled curdates*
.******************************************************************************
.*        V5.07.08  15/10/1999  Steve Armstrong                               *
.*                  Removed reference to CSTRTYR (not used)                   *
.*        V5.07.07  24/08/1999  Jill Habasque                                 *
.*                  Changed to display Start to Finish instead of A to ZZZZ   *
.*        V5.07.06  09/08/1999  Caleb Sharman SRF 633189                      *
.*                  Recompiled for PATANVS                                    *
.*        V5.07.05  04/08/1999  Jill Habasque SRF 633553                      *
.*                  Recompiled for PATINVS                                    *
.*        V5.07.04  13/07/1999  Greg Horvat                                   *
.*                  Replaced certain variables & with KEY variables           *
.*        V5.07.03  21/06/1999  J.Tan  SRF 632459                             *
.*                  Recompiled for PATCATAI - printing accommodation          *
.*        V5.07.02  19/05/1999  J Habasque SRF 631718                         *
.*                  Recompiled for PATCATAI                                   *
.*        V5.07.01  19/03/1999  J.Tan                                         *
.*                  Recompiled for casemix funding                            *
.*       V5.07.B04  20/01/1999  Nicole Harrington 507 rebound 114             *
.*                  Recompiled for PATCATAI                                   *
.*       V5.07.B03  13/01/1999  Jim Stathopoulos                              *
.*                  Fixed Global Compile Errors                               *
.*       V5.07.B02  17/12/1998  Jim Stathopoulos                              *
.*                  507 Rebounds                                              *
.*       V5.07.B01  10/11/1998  Jim Stathopoulos                              *
.*                  507 Changes                                               *
.******************************************************************************
.*        V5.06.01  12/06/1998  Nick Read          SRF 626266                 *
.*                  Recompiled for PATCATAI                                   *
. *****************************************************************************
.*        V5.05.02  17/12/1997 Nick   SRF 623072                              *
.*                  Recompiled for PATANVS                                    *
.*        V5.05.01  14/10/1997  Steve Armstrong    SRF 643393                 *
.*                  Recompiled for removal of THC invoice message             *
. *****************************************************************************
.*        V5.04.03  14/07/1997  Howellsy                                      *
.*                  Added West Wimmera Invoice Layout                         *
.*        V5.04.02  22/07/1996  Steve Armstrong  SRF 641785                   *
.*                  Recompiled for changes to PATINV15                        *
.*        V5.04.01  15/06/1996  Greg Horvat      SRF 616143                   *
.*                  Recompiled for PATANVS, PATCATAI & PATINV17 - Added new   *
.*                  invoice layout for MBF - layout 17                        *
.*                                                                            *
.* ************************************************************************** *
.*                                                                            *
.*        V5.02.01  13/02/1995  Greg Horvat      SRF 134920 134922 134932     *
.*                  Recompiled for IBAPRINT                                   *
.*        V5.02.02  21/02/1995  Greg Horvat      SRF 135134                   *
.*                  Recompiled for PATANVS - Changes to Port Mac. invoice     *
.*        V5.02.03  22/02/1995  Greg Horvat      SRF 135134                   *
.*                  Recompiled for PATCATAI - Changed printing of E.F.R.      *
.*        V5.02.04  10/04/1995  Greg Horvat      SRF 135653                   *
.*                  Recompiled for PATANVS - Changes to layout 9 header       *
.*        V5.02.05  19/04/1995  Steve Armstrong                               *
.*                  Recompiled                                                *
.*        V5.03.B2  19/05/1995  Greg Horvat      SRF 136535                   *
.*                  Recompiled for PATINV16 - Changed Port Mac. tail over 2   *
.*                  pages                                                     *
.*        V5.03.B3  06/06/95  Paul Howells                  SRF 136735        *
.*                  Recompiled for PATSELFN                                   *
.*        V5.03.01  01/08/1995  Greg Horvat      SRF 610897                   *
.*                  Recompiled for PATCATAI - Changed Port Mac. A&E invoice   *
.*                  reprints to print the attending doctor in the body of the *
.*                  invoice                                                   *
.*        V5.03.02  04/08/1995  Greg Horvat      SRF 611050                   *
.*                  Recompiled for PATINV16 - Fixed invoice line ups          *
.*        V5.03.03  04/09/1995  ROD              SRF 611596                   *
.*                  Recompile for PATINV16 & PATANVS                          *
.*        V5.03.04  18/12/95 J.Tan      SRF 612485                            *
.*                  Recompiled for PATANVS (lineup for invoice 13,14,15,16)   *
.*        V5.03.05  07/02/1996  Greg Horvat                                   *
.*                  Recompiled for PATCATAI - Changes to REBAT000 routine     *
.*                                                                            *
.******************************************************************************
.
         INC       STD001FD
.
         INC       CHKDIGVR/INC
         INC       EMRCONFD/INC
         INC       EMRHISFD/INC
         INC       EMRVISFD/INC
         INC       IBACONFD/INC
         INC       IBAGEDFD/INC
         INC       IBATMDFD/INC
         INC       IBATMHFD/INC
         INC       IBAGSTFD/INC
         INC       COMDEPFD/INC
         INC       MLTCFNFD/INC
.
         INC       PABXVARS/INC
         INC       NHIMASFD/INC
         INC       PATVISFD/INC
         INC       PATMI1FD/INC
         INC       PATCONFD/INC
         INC       PATDSCFD/INC
         INC       PATECDFD/INC
         INC       PATIBLFD/INC
         INC       PATRE1FD/INC
         INC       PATMA1FD/INC
         INC       PMSEVTFD/INC
         INC       PMSHCPFD/INC
         INC       PMSPX2FD/INC
         INC       PATTRNFD/INC
         INC       PMSMTIFD/INC
         INC       PMSEXTFD/INC
         INC       PMSPRGFD/INC
         INC       PMSTLEFD/INC
         INC       PATICDFD/INC
         INC       PATCMXFD/INC         * casemix files
         INC       PATAFEFD/INC
         INC       PATASDFD/INC
         INC       PATHDFFD/INC
         INC       PATHLFFD/INC
         INC       PATLDFFD/INC
         INC       PATLSDFD/INC
.
         INC       PMSCIDFD/INC
         INC       PATCRAFD/INC
         INC       PATWR1FD/INC
         INC       PATDO1FD/INC
         INC       PATIN1FD/INC
         INC       PATCODFD/INC
         INC       PATFN1FD/INC
         INC       PATFX1FD/INC
         INC       PATCFAFD/INC
         INC       PATHSPFD/INC
         INC       PATHFRFD/INC      * HEALTH FUND RECEIPT INVOICES
         INC       PATWC1FD/INC
         INC       PATWMAFD/INC
         INC       PATWVEFD/INC
         INC       PATIJRFD/INC
         INC       PATDINVS/INC
         INC       PATSELDT/INC
         INC       PMSCNOFD/INC
         INC       PMSFCIFD/INC
         INC       PMSVX1FD/INC
         INC       PMSPYRFD/INC
         INC       IBAPRNFD/INC
.
         INC       PATINVFD/INC
         INC       PATDTRFD/INC
         INC       PATREMFD/INC
         INC       OUTDTRFD/INC
         INC       OUTCTYFD/INC
         INC       OPRARDFD/INC
         INC       OPRDEAFD/INC
         INC       AAEDTRFD/INC
         INC       AAECONFD/INC
         INC       AAEDE1FD/INC
         INC       AAEDEBFD/INC
         INC       AAEDI1FD/INC
.
         INC       RCPBNKFD/INC
         INC       RCPDTEFD/INC
         INC       RCPBDTFD/INC
         INC       RCPCRSFD/INC
.        INC       RCPCONFD/INC
.
         INC       OUTBOAFD/INC
         INC       OUTBB1FD/INC
         INC       OUTCLIFD/INC
         INC       OUTSITFD/INC
         INC       PATNIDFD/INC
         INC       PATITMFD/INC
         INC       NZPIVBFD/INC
         INC       NZPCFNFD/INC
         INC       NZPSPRFD/INC
         INC       NZPRDTFD/INC
         INC       NZPMCHFD/INC
         INC       NZPMXCFD/INC
.
         INC       IBASECFD/INC
.
         INC       VARGBCRN/INC          * I-48227
+
.
ADMISSNO DIM       8
BATCHNO  FORM    8
LNO      FORM    2
SAVETREF DIM     8
DIM4     DIM     4
DIM14    DIM     14
DIM18    DIM     18
DIM30    DIM     30
DIM30A   DIM     30
.
.
DPSTAT          DIM    25
.
START           INIT      "Start"
STAT1           INIT   "Patient is pre admitted "
STAT2           INIT   "Admitted on "
STAT3           INIT   "Discharged on "
STAT4           INIT   "Patient is on leave     "
STAT5           INIT   "Patient is cancelled    "
STATO           INIT   "Outpatient on "
STATE           INIT   "A + E on "
.
CODE            DIM    2
CODECL          INIT   "CL"
CODEDP          INIT   "DP"
CPDATE1         DIM    8
CCENT1          DIM    2
CYEAR1          DIM    2
CMON1           DIM    2
CN              INIT   "CN"
CDAY1           DIM    2
CLRFLAG         FORM   1
CWEBDNAM        DIM    2
CWEBDNAI        DIM    1
.
DOWNCASE  INIT      "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"
DAYSDIFF        FORM   2
..DSEX            DIM    6
.
DOCTCODE        DIM     6
DISPNAME        DIM     60
DOCNAME         DIM     22         * DOCTORNAME SHORTENED
DNAME           DIM     20
.
AGEMASK1 DIM       9
AGEMASK2 DIM       9
AGEMASK3 DIM       9
AGEMASK4 DIM       9
.
DATFROM  DIM       8
DATTO    DIM       8
DIM5A    DIM       5
DIM12    DIM       12
DIM12A   DIM       12
DOCFNAME  DIM       50
.
EDCLM    DIM       3
EDHFN    DIM       6
ENDNAM   DIM       8
.
FINISH   INIT      "Finish"
FIVE9    FORM      "59"
FORM5    FORM      5
FMTGNAME  DIM       35
FMTTITLE  DIM       10
FMTSNAME  DIM       35
.
INVFROM  DIM       8
INVTO    DIM       8
.
KEY12A    DIM       12
.
LINECNT  FORM      2
.
MINOWE   FORM      6.2
.
NAME35    DIM       35
OPTB     FORM      1
OTCNOTIH  DIM       6
OTCNOTIT  DIM       6
.
PAGECNT   FORM       3
.
REGIST8   DIM        2
RECPFLG   FORM       1
.RECFLAG   FORM       1
.
STCLM     DIM       3
STHFN     DIM       6
SERVDOCT  DIM       10
SP14      INIT       "              "
SPLING    FORM       2
.
SAVKEY12  DIM       12
STRTNAM   DIM        6
.
TFFSAMNT  FORM      12.2
TOTBAL    FORM       6.2
ZERO00    FORM      ".00"
ZTWO      FORM      "00"
.
.         Web Variables (only the include files use these variables)
.
DAYFORMT  DIM       4
NJAN      INIT      "January"
NFEB      INIT      "February"
NMAR      INIT      "March"
NAPR      INIT      "April"
NMAY      INIT      "May"
NJUN      INIT      "June"
NJUL      INIT      "July"
NAUG      INIT      "August"
NSEP      INIT      "September"
NOCT      INIT      "October"
NNOV      INIT      "November"
NDEC      INIT      "December"
.
MENUTYPE  DIM       2
.
HJNL      DIM       2
HOSPID    DIM       3
HTMLFILE  FIFO      ASCII, FIXED=250
MAXSEPDY  FORM      "35"
MTHNAM3   DIM       3
MTHNAM3A  DIM       3
.
.         end web variables
.
CODEA     INIT      "A "
CODEBT    INIT      "BT"
FHDUDT1   DIM       8
FHDUDT2   DIM       8
HDUDAY1   FORM      3                       * High Dependency
HDUDAY2   FORM      3
HDUFLG    FORM      "0"
LWCHG     FORM      6.2                     * Labour Ward Fee
LWDT      DIM       8
LWCODE    INIT      "LW"
OTCODE    INIT      "OT"
MBSNUM    FORM      "0"
MBS1      DIM       9
MBS2      DIM       9
MBS3      DIM       9
MBSDT1    DIM       8
MBSDT2    DIM       8
MBSDT3    DIM       8
MBSCH1    DIM       9
MBSCH2    DIM       9
MBSCH3    DIM       9
OTCHG1    FORM      6.2
OTCHG2    FORM      6.2
OTFLG     FORM      "0"
OTDESC1   DIM       15
OTDESC2   DIM       15
OTDT1     DIM       8           * Other Items
OTDT2     DIM       8
.
RCCNSTRF  DIM       1        * Display Statement Reference
.
SURGFLG   FORM      "0"
THDUDT1   DIM       8
THDUDT2   DIM       8
THEACHG   FORM      6.2                     * Theatre Fee
THEADTE   DIM       8
XDESC     DIM       30
.
PRGID     INIT      "IBABIL21"
PRGNAM    INIT      "Re-Print Patient Invoices"
VERSION   INIT      "V12.00.03"
+
.         START OF PROGRAM
.
          CALL      DISPHEAD
.
          DISPLAY   *P56:24,*EL,"Opening patmi1af";
          OPEN      PATMI1A1,"patmi1af"
.
          DISPLAY   *P64:24,"outsitaf";
          OPEN      OUTSITA1,"outsitaf"
.
          MOVE       "out",OSTFILE
          PACK       CFNAME,OSTFILE,FILBB1A1  * Set up physical filename
          CALL       OPOTBB11
.
          DISPLAY   *P64:24,"aaede1af";
          OPEN      AAEDE1A1,"aaede1af"
.
          DISPLAY   *P64:24,"aaedi1af";
          OPEN      AAEDI1A1,"aaedi1af"
.
          DISPLAY   *P64:24,"emrvisaf";
          OPEN      EMRVISA1,"emrvisaf"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA1,"patvisaf"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA2,"patvisaf"
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH1,"patdschf"
.
          DISPLAY   *P64:24,"patwr1af";
          OPEN      PATWR1A1,"patwr1af"
.
          DISPLAY   *P64:24,"patinvrf";
          OPEN      PATINVR1,"patinvrf"
.
          DISPLAY   *P64:24,"patinvrf";
          OPEN      PATINVR2,"patinvrf"
.
          DISPLAY   *P64:24,"patdtraf";
          OPEN      PATDTRA1,"patdtraf"
          OPEN      PATDTRA3,"patdtraf"
.
          DISPLAY   *P64:24,"aaedtref";
          OPEN      AAEDTRE1,"aaedtref"
          OPEN      AAEDTRE3,"aaedtref"
.
          DISPLAY   *P64:24,"patdo1af";
          OPEN      PATDO1A1,"patdo1af"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
.
          DISPLAY   *P64:24,"patmx1af";
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY   *P64:24,"pmspx2af";
          OPEN      PMSPX2A1,"pmspx2af"
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"pathfrec";
          OPEN      PATHFRE1,"pathfrec"
.
          DISPLAY   *P64:24,"patijrnf";
          OPEN      PATIJRN1,"patijrnf"
.
          DISPLAY   *P64:24,"rcpbdtaf";
          OPEN      RCPBDTA1,"rcpbdtaf"
.
          DISPLAY   *P64:24,"rcpdteaf";
          OPEN      RCPDTEA3,"rcpdteaf"
.
          DISPLAY   *P64:24,"rcpbnkaf";
          OPEN      RCPBNKA1,"rcpbnkaf"
.
          DISPLAY   *P64:24,"oprardaf";
          OPEN      OPRARDA1,"oprardaf"
.
          DISPLAY   *P64:24,"oprdetaf";
          OPEN      OPRDETA1,"oprdetaf"
.
          DISPLAY   *P64:24,"mltcfnaf"
          OPEN      MLTCFNA1,"mltcfnaf"
          OPEN      MLTCFNA2,"mltcfnaf"
.
          DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"
.
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATFN1A1,"patfn1af"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS,*85,IBCNUGST
          READ      CONTROLF,TEN;*66,CINVLAY,*79,CAPPRVNO,*94,CAGECOFF:
                                 *96,CNEXTINV,*166,CMEMB
          READ      CONTROLF,TEN3;CHADD1,CHADD2,CHPOST:
                                      CHPADD1,CHPADD2,CHPPOST,CHTELEB
          READ      CONTROLF,TEN4;CNOCLMS,CINMES1:
                                      CINMES2
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,TWENTY1;*44,PTCNIDES:
                                     *51,PTCNINVL,*200,PTCNICRA,*237,PTCNPAOF
          READ      CONTROLF,THIRTY;*132,HSTANDM,HINVDES
          READ      CONTROLF,THIRTY2;*57,OTCNOTIH,*63,OTCNOTIT
          READ      CONTROLF,FIVE9;*33,CPRTREC,*37,CTYPCHG,*62,CINVJRN:
                                    *66,CGSTPERC,CGSTITEM
          READ      CONTROLF,SEVENTY8;*40,AECNAEIH,*46,AECNAEIT
          READ      CONTROLF,EIGHTY;*248,PTCNPEFR
          READ      CONTROLF,EIGHTY8;*86,CDAILYDT 
          READ      CONTROLF,EIGHTY9;*221,EMCNGINV
          READ      CONTROLF,NINTY8;*136,PTCNPAIH,*142,PTCNPAIT,*148,PTCNINVB
          READ      CONTROLF,HUND03;*220,PTCNDEES,*221,PTCNDDES
          READ      CONTROLF,HUND05;*177,PTCNTFEE:
                                    *195,PTCNLASR
          READ      CONTROLF,HUND18;*165,PTCNPPRC,*166,PTCNPITM
          READ      CONTROLF,HUND30;*1,PTCNHABN
.
          IF        CFEETYP=5
            OPEN      NZPSPRA1,"nzpspraf"
            OPEN      NZPSPRA2,"nzpspraf"
          ENDIF
.
          UNPACK    CDAILYDT,XCENT,XYEAR,XMON,XDAY
          MOVE      XCENT,CC
          MOVE      XYEAR,YY
          MOVE      XMON,MM
          MOVE      XDAY,DD
.
          MOVE      ZERO TO DISPROG
.
.          LAST LINE ON THE PAGE
.
          MATCH     "IBARSH",PGM
          GOTO      PRSKIP IF EQUAL 
.
          CALL      SELPRINT
          MOVE      CPRTFLG,SPLING          * Save the spooling flag
.
.       CPRTREC - 0 = Print receipt
.                 1 = Don't Print receipt
.
PRSKIP 
.       MOVE      CPRTREC,RECPFLG
.
        MOVE      ZERO,WEBFLAG
        MATCH     "IBARSH",PGM
        IF        @EQUAL
          MOVE      ONE,WEBFLAG
        ENDIF
.
.       Remove Single receipt and printing cash receipts options
.
START 
.       BRANCH    RECPFLG OF START1
        MOVE      SP6,STCLM
        MOVE      SP6,STHFN
        MOVE      SP6,EDCLM
        MOVE      SP6,EDHFN
.
        HLINE     *G37,2,53,80
          DISPLAY   *P1:3,*EF:
                 *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                  *P1:5,*V2LON,ONE,*HOFF," = Lineup Print":
                  *P1:6,*V2LON,TWO,*HOFF," = Single Invoice":
                *P1:7,*V2LON,THREE,*HOFF," = Single Receipt":
                 *P1:8,*V2LON,FOUR,*HOFF," = Printing Cash Receipts":
                 *P1:9,*V2LON,FIVE,*HOFF," = Outstanding Invoices ":
                                            "for a Given Date Range":
                 *P1:10,*V2LON,SIX,*HOFF," = Outstanding Invoices ":
                                            "for a Given Invoice Range";
         COMPARE   ONE,CINVJRN
         GOTO      STARTA IF NOT EQUAL
.
         DISPLAY   *P1:11,*V2LON,SEVEN,*HOFF," = Invoices with Journals"
.
STARTA   KEYIN     *P1:13,*EL,"Option : ",*V2LON,OPTION;
.
         COMPARE   ZERO,OPTION
         GOTO      ENDIT IF EQUAL
         GOTO      REPEAT
.
START1   HLINE     *G37,2,53,80
         DISPLAY   *P1:3,*EF:
                 *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                  *P1:5,*V2LON,ONE,*HOFF," = Lineup Print":
                  *P1:6,*V2LON,TWO,*HOFF," = Single Invoice":
                *P1:7,*V2LON,THREE,*HOFF," = Outstanding Invoices ":
                                            "for a Given Date Range":
                 *P1:8,*V2LON,FOUR,*HOFF," = Outstanding Invoices ":
                                            "for a Given Invoice Range";
          COMPARE   ONE,CINVJRN
          GOTO      START1A IF NOT EQUAL
.
          DISPLAY   *P1:9,*V2LON,FIVE,*HOFF," = Invoices with Journals"
.
START1A   KEYIN     *P1:11,*EL,"Option : ",*V2LON,OPTION;
.
          COMPARE   ZERO,OPTION
          GOTO      ENDIT IF EQUAL
.
REPEAT   
.        BRANCH    RECPFLG OF REPEAT1
.
         BRANCH    OPTION OF START,OPTION2,OPTION3,OPTIONP,OPTIONP,OPTIONP:
                             OPTIONP
         GOTO      REPEAT2
.
.REPEAT1  BRANCH    OPTION OF START,OPTION2,OPTIONP,OPTIONP,OPTIONP
.
REPEAT2  BEEP
         GOTO      START
+
OPTIONP  
.         OPEN      CONTROLF,"controlf"
.         CALL      PATSELFN
.         BRANCH    EXIT,START
.         CLOSE     CONTROLF
.
.         BRANCH    RECPFLG OF OPTIONP1
         BRANCH    OPTION OF START,OPTION2,OPTION3,OPTION4,OPTION5,OPTION6:
                             OPTION7
         GOTO      START
.
.OPTIONP1 BRANCH    OPTION OF START,OPTION2,OPTION5,OPTION6,OPTION7
.
.        SECOND OPTION
.
OPTION2
         DISPLAY   *P53:2,*V2LON," - Single Invoice ",*P1:3,*EF
         GOTO      KTIVR
.
.        THIRD OPTION
.
OPTION3
         DISPLAY   *P53:2,*V2LON," - Single Receipt ",*P1:3,*EF
.
.     SINGLE INVOICE ONLY
.
KTIVR    KEYIN      *P1:4,*EL,"Please Enter Invoice Number : ":
                    *DE,*JR,*V2LON,PINVNO;
         RESET      PINVNO
         GOTO       START IF EOS
.
         MOVE       PINVNO,KEY8
         CALL       RDINV1
         BRANCH     OVRCD OF INVINVR
.
         MATCH      ZEROVISN,PINVADM
         GOTO       CANINVR IF EQUAL
.
         MOVE       PINVADM,AADMNO
.
         MOVE       PINVUR,KEY8
         CALL       RDMAST1
         BRANCH     OVRCD OF INVURNO
         CALL       RDPMPX21
         BRANCH     OVRCD OF INVURNO
.
         CALL       GPNAME
.
         CALL       GETDETS
         BRANCH     OVRCD OF INVADMN
.
         IF         CFEETYP = 6
           CALL       GINOP000                   * Get invoice type for Mt. Alv
           COMPARE    ZERO,SNGOPTN               * exit selected ? 
           GOTO       REPEAT IF EQUAL            * yes
         ENDIF
.
         CALL       DISPB
         CALL       DATAB
.
         MOVE       ZERO,PRINTFLG
         MOVE       ONE,COPYINV
         CALL       CALCTAI       *** displays on screen
.
ASKOPT   KEYIN      *P1:24,*EL," (",*V2LON,"R",*HOFF,")e-Print, (":
                              *V2LON,"E",*HOFF,")xit, (":
                              *V2LON,"N",*HOFF,")ext ? ",*V2LON,ANS;
         REP        UPPLOW,ANS
.
         CMATCH     ANSE,ANS
         GOTO       START IF EQUAL
.
         CMATCH     ANSR,ANS
         GOTO       RPRTINV IF EQUAL
.
         CMATCH     ANSN,ANS
         GOTO       OPTION3 IF EQUAL
.
         GOTO       ASKOPT
.
RPRTINV  MOVE       ZERO,JHFLAG
         IF         CFEETYP=5 | CFEETYP=9
           MOVE       ONE,JHFLAG
         ENDIF
.
         MOVE      SP70,EXPPAYER
         IF        CFEETYP=5
           MOVE      PINVNO,KEY8
           CALL      RDINV1
           IF        OVRCD=0
             MATCH     SP70,PTINHFND
             IF        @EQUAL
               MOVE      "PRFA  ",EXPPAYER
             ELSE
               MOVE      PTINHFND,EXPPAYER
             ENDIF
           ENDIF
         ENDIF
.
         MOVE       PTINCNID,CONTRCID                                 *I-257430
         CALL       INVPRT        *** PRINTS THE INVOICE
.
         MOVE       PINVNO TO KEY8
         CALL       RDHFRE1
         BRANCH     OVRCD TO REPEAT
.
         BRANCH     HFRSTAT TO REPEAT
         CALL       DEHFRE1
         GOTO       REPEAT
.
INVINVR
          DISPLAY   *P1:24,*EL,*B,"Invoice Number does not Exist.  ";
          CALL      HITENTER
          GOTO      KTIVR
.
CANINVR   DISPLAY   *P1:24,*EL,*B,"Invoice Number has been Cancelled.  ";
          CALL      HITENTER
          GOTO      KTIVR
+
.        THIRD OPTION
.
OPTION4
         DISPLAY   *P53:2,*V2LON,"- Printing Cash Receipts ",*P1:3,*EF
.
.        Ask what cash receipt option they want
.
         DISPLAY   *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                   *P1:5,*V2LON,ONE,*HOFF," = Print All Cash Receipts":
                   *P1:6,*V2LON,TWO,*HOFF:
                         " = Print All Non-Insurance Invoice Receipts":
                   *P1:7,*V2LON,THREE,*HOFF:
                         " = Print Only Outstanding Balance Receipts":
                   *P1:8,*V2LON,FOUR,*HOFF:
                         " = Print Non-Insurance Outstanding Balance Receipts":
                   *P1:9,*V2LON,FIVE,*HOFF," = Clear Cash Receipt file":
                   *P1:10,*V2LON,SIX,*HOFF:
                         " = Clear Insurance Invoice Receipts":
                   *P1:11,*V2LON,SEVEN,*HOFF:
                         " = Clear Non-Insurance Invoice Receipts"
.
OPT4KY   KEYIN     *P1:13,*EF,"Option : ",*V2LON,OPTB
.
         COMPARE   ZERO,OPTB
         GOTO      START IF EQUAL
.
         BRANCH    OPTB OF OPT4GEN,OPT4GEN,OPT4MIN,OPT4MIN:
                           OPT4CLR,OPT4CLR,OPT4CLR
.
         BEEP
         GOTO      OPT4KY
.
.        Key in the minimum amount outstanding
.
OPT4MIN  KEYIN      *P1:15,"Minimum amount owing : ",*EL,*V2LON,MINOWE:
                    *P24:15,*DV,MINOWE
.
         COMPARE    ZERO,MINOWE
         GOTO       OPT4KY IF LESS
.
OPT4GEN  MATCH     "IBARSH",PGM
         GOTO      OPT4GNX IF EQUAL
. 
         DISPLAY   *P1:24,*EL,"*** Generating Receipts ***";
.
        CALL       OPNPRINT
        MOVE       THREE,CPRTFLG     * Allow all receipts to be spooled together
.
OPT4GNX MOVE       SP8,KEY8
        CALL       RDSHFRE1
.
NEXTH   CALL       RDKHFRE1
        BRANCH     OVRCD OF ENDH
.
        DISPLAY    *P1:24,*EL,*P55:24,"Scanning : ",HFRINVR;
.
        COMPARE    ZERO,FSTSYS
        GOTO       INPGEN IF EQUAL
.
        MOVE       HFRINVR,KEY8
        CALL       RDINV1
.
        COMPARE    FSTSYS,PINVSYS
        GOTO       NEXTH IF NOT EQUAL
.
        BRANCH     PINVSYS OF INPGEN,OUTGEN,INPGEN,INPGEN,NEXTH
.
OUTGEN  MATCH      FSTSITE,PINVSITE
        GOTO       NEXTH IF LESS
.
        MATCH      PINVSITE,FEDSITE
        GOTO       NEXTH IF LESS
.
        MOVE       SP3,OSTSYST
        MOVE       "out",OSTFILE
        MOVE       PINVSITE,KEY6
        CALL       RDSITA1
.
        MATCH      FSTDEPT,OSTSYST
        GOTO       NEXTH IF LESS
.
        MATCH      OSTSYST,FEDDEPT
        GOTO       NEXTH IF LESS
.
INPGEN  MOVE       ONE,HFRSTAT
        CALL       UPHFRE1          **** now set to in use
.
        MOVE       HFRINVR,KEY8
        CALL       RDINV1
        BRANCH     OVRCD OF FINH
.
.       Check if we want to print this invoice
.
        BRANCH     OPTB OF PRT4REC,CHK4INS,CHK4OUT,CHK4INS
.
.       Check for a Non-insurance invoice
.
CHK4INS BRANCH     PINVTYP OF FREEST
.
        BRANCH     OPTB OF PRT4REC,PRT4REC
.
.       Check for a non-zero outstanding amount
.
CHK4OUT MOVE      PINVAMT,NETTOT
        ADD       PINVPATA,NETTOT
        ADD       PINVHFDA,NETTOT
        ADD       PINVOTHA,NETTOT
        ADD       PINVJOUR,NETTOT
        ADD       PTINGSTJ,NETTOT           * GST Journal              *I-90231
        ADD       PTINCRTT,NETTOT           * Credit Note
.
        COMPARE   ZERO00,NETTOT
        GOTO      FREEST IF EQUAL
.
        COMPARE   MINOWE,NETTOT
        GOTO      FREEST IF LESS
.
.       Print this receipt
.
PRT4REC MOVE       PINVADM,AADMNO
.
        MOVE       PINVUR,KEY8
        CALL       RDMAST1
        BRANCH     OVRCD OF FINH
.
        CALL       GPNAME
.
        CALL       GETDETS
        BRANCH     OVRCD OF FINH
.
        MOVE       ONE,PRINTFLG
        MOVE       ZERO,JHFLAG
        IF         CFEETYP=5 | CFEETYP=9
          MOVE       ONE,JHFLAG
        ENDIF
        CALL       INVPRT        *** PRINTS THE INVOICE
        COMPARE    "15",PTCNINVL
        GOTO       FINH IF EQUAL    * No form feed for SVHM
.
        BRANCH     CINVLAY OF FF1,FINH,FF1,FINH,FINH,FINH,FINH,FINH
FF1     PRINT      *F;    * single formfeed to separate pages
.
FINH    MOVE       HFRINVR,KEY8
        CALL       DEHFRE1          **** NOW FINISHED
        CALL       RDSHFRE1
        GOTO       NEXTH
.
FREEST  MOVE       ZERO,HFRSTAT     * Free status indicator
        CALL       UPHFRE1
        GOTO       NEXTH
.
.       Clear cash receipts audit file
.
OPT4CLR MOVE       SP8,KEY8
.
        DISPLAY    *P1:24,*EL,*P10:24,"Cleared : ",*P55:24,"Scanning : ";
        CALL       RDSHFRE1
CLR4LP  CALL       RDKHFRE1
        BRANCH     OVRCD OF ENDC4
.
        DISPLAY    *P68:24,HFRINVR;
.
        COMPARE    ZERO,FSTSYS
        GOTO       INPCL4 IF EQUAL
.
        MOVE       HFRINVR,KEY8
        CALL       RDINV1
.
        COMPARE    FSTSYS,PINVSYS
        GOTO       CLR4LP IF NOT EQUAL
.
        BRANCH     PINVSYS OF INPCL4,OUTCLR,INPCL4,INPCL4,CLR4LP
.
OUTCLR  MATCH      FSTSITE,PINVSITE
        GOTO       CLR4LP IF LESS
.
        MATCH      PINVSITE,FEDSITE
        GOTO       CLR4LP IF LESS
.
        MOVE       SP3,OSTSYST
        MOVE       "out",OSTFILE
        MOVE       PINVSITE,KEY6
        CALL       RDSITA1
.
        MATCH      FSTDEPT,OSTSYST
        GOTO       CLR4LP IF LESS
.
        MATCH      OSTSYST,FEDDEPT
        GOTO       CLR4LP IF LESS
.
INPCL4  MOVE       HFRINVR,KEY8
        CALL       RDINV1
        BRANCH     OVRCD OF CLR4LP
.
        BRANCH     OPTB OF CLR4LP,CLR4LP,CLR4LP,CLR4LP,CLR4REC,CLR4INS,CHK4NI
.
.       Check for an insurance invoice
.
CLR4INS BRANCH     PINVTYP OF CLR4REC
        GOTO       CLR4LP
.
.       Check for a non-insurance invoice
.
CHK4NI  BRANCH     PINVTYP OF CLR4LP
.
.       Delete this invoice
.
CLR4REC DISPLAY    *P20:24,*V2LON,HFRINVR;
.
        MOVE       HFRINVR,KEY8
        CALL       DEHFRE1
        CALL       RDSHFRE1
        GOTO       CLR4LP
.
ENDC4   DISPLAY    *P1:24,*EL,*V2LON:
                   "** Receipts Cleared **",*W2;
        GOTO       START
.
ENDH    MATCH      "IBARSH",PGM
        GOTO       START IF EQUAL
.
        DISPLAY    *P1:24,*EL,*V2LON:
                   "*** All Receipts Generated ***",*W2;
.
        MOVE       SPLING,CPRTFLG       * Restore the original setting
        CALL       CLSPRINT
.
        GOTO       START
.
.       Print only Outstanding Invoices for a given date range
.
OPTION5  DISPLAY   *P53:2,*V2LON," - Outstanding Invoices ",*P1:3,*EF,*HOFF:
                   *P1:4,"From Date : "
.
OPT5A
         MOVE      FOUR,VERT
         MOVE      TEN3,COL
         MOVE      ZERO,IDAY
         MOVE      ZERO,IMON
         MOVE      ZERO,IYEAR
         MOVE      ZERO,ICENT
         CALL      KEYINDTE
         COMPARE   ONE,IDAY
         GOTO      START IF LESS
.
        PACK       DATFROM WITH ICENT,IYEAR,IMON,IDAY
        REP        " 0",DATFROM
        PACK       KEY4,CCC,CYY
        REP        " 0",KEY4
        DISPLAY    *P1:5,"  To Date : ",*V2LON,CDD,*HOFF,"/":
                   *V2LON,CMM,*HOFF,"/",*V2LON,KEY4
        MOVE       FIVE,VERT
        MOVE       CDD,IDAY
        MOVE       CMM,IMON
        MOVE       CYY,IYEAR
        MOVE       CCC,ICENT
        CALL       KEYINDTE
        PACK       DATTO WITH ICENT,IYEAR,IMON,IDAY
        REP        " 0",DATTO
.
        MATCH      DATFROM,DATTO
        GOTO       OPT5F IF NOT LESS
.
        DISPLAY    *P1:24,*EL,*B,"Invalid Date Range.  ";
        CALL       HITENTER
        GOTO       OPTION5
.
OPT5F   CALL       GETRNGE
        CALL       GCLM000             * Keyin range of Claim code
        CALL       GHFN000             * Keyin range of Health fund
.
        KEYIN      *P1:15,"Minimum amount owing : ",*EL,*V2LON,MINOWE:
                   *P24:15,*DV,MINOWE
.
         COMPARE   ZERO,MINOWE
         GOTO      OPTION5 IF LESS
.
         IF        CFEETYP = 6
           CALL      GINOP000                    * Get invoice type for Mt. Alv.
           COMPARE   ZERO,SNGOPTN                * exit selected ?
           GOTO      START IF EQUAL              * yes
         ENDIF
.
         OPEN      CONTROLF,"controlf"
         CALL      PATSELFN
         BRANCH    EXIT,START
.
         CALL      KHOS0000                     * Keyin hospital ID
         BRANCH    EXIT,START
.
OPT5G    CALL      CONTQST                      * Ok to continue ?
         BRANCH    CEXIT,OPT5H:                 * yes
                         OPTION5:               * no
                         START                  * cancel
.
OPT5H    MATCH     "IBARSH",PGM
         GOTO      OPT5H2 IF EQUAL
.
         CALL      OPNPRINT
         MOVE      THREE,CPRTFLG     * Allow all receipts to be spooled together
.
OPT5H2   PACK      KEY16 WITH DATFROM,SP8
         CALL      RDSINV2
.       
OPT5I    CALL      RDKINV2
         BRANCH    OVRCD OF OPT5Z
.
        COMPARE    FSTSYS,PINVSYS
        GOTO       OPT5I IF LESS
.
        COMPARE    PINVSYS,FEDSYS
        GOTO       OPT5I IF LESS
.
        BRANCH     PINVSYS OF INPOP5,OUTOP5,INPOP5,INPOP5,OPT5I
.
OUTOP5  MATCH      FSTSITE,PINVSITE
        GOTO       OPT5I IF LESS
.
        MATCH      PINVSITE,FEDSITE
        GOTO       OPT5I IF LESS
.
        MOVE       SP3,OSTSYST
        MOVE       "out",OSTFILE
        MOVE       PINVSITE,KEY6
        CALL       RDSITA1
.
        MATCH      FSTDEPT,OSTSYST
        GOTO       OPT5I IF LESS
.
        MATCH      OSTSYST,FEDDEPT
        GOTO       OPT5I IF LESS
.
INPOP5   MATCH     PINVDTE,DATTO
         GOTO      OPT5Z IF LESS
.
         UNPACK    PINVDTE WITH XCENT,XYEAR,XMON,XDAY
         DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ":
                   *V2LON,PINVNO,SP2,XDAY,SLASH,XMON,SLASH,XYEAR;
.
         MOVE      PINVAMT,NETTOT
         ADD       PINVPATA,NETTOT
         ADD       PINVHFDA,NETTOT
         ADD       PINVOTHA,NETTOT
         ADD       PINVJOUR,NETTOT
         ADD       PTINGSTJ,NETTOT          * GST Journal              *I-90231
         ADD       PTINCRTT,NETTOT           * Credit Note
.
         COMPARE   ZERO00,NETTOT
         GOTO      OPT5I IF EQUAL
.
         COMPARE   MINOWE,NETTOT
         GOTO      OPT5I IF LESS
.
         MOVE      PINVUR,KEY8
         CALL      RDMAST1
         BRANCH    OVRCD OF OPT5I
.
         CALL      CHKRNGE
         BRANCH    OVRCD OF OPT5I
.
         CALL      GPNAME
.
         CALL      GETDETS
         BRANCH    OVRCD OF OPT5I
.
         CALL      CRNG000                  * Check range of claim code
         BRANCH    EXIT OF OPT5I
.
         CALL      HRNG000                  * Check range of health fund
         BRANCH    EXIT OF OPT5I
.
         CALL      GETXDET                  * Get Extra Details
.
         PACK      SERVDOCT,SP70
         IF        PINVSYS=1
           MATCH     "1",EMCNGINV           * Group invoice by service doctor?
           IF        @EQUAL
             CALL      GSDC0000              * Get Service doctor 
           ENDIF
         ENDIF
.
         MOVE      ONE,PRINTFLG
         MOVE      ZERO,JHFLAG
         IF        CFEETYP=5 | CFEETYP=9
           MOVE      ONE,JHFLAG
         ENDIF
         CALL      INVPRT        *** PRINTS THE INVOICE
.
         COMPARE   "15",PTCNINVL
         GOTO      CHKHFR IF EQUAL    * No form feed for SVHM
.
         BRANCH    CINVLAY OF FF2,CHKHFR,FF2,CHKHFR,CHKHFR,CHKHFR,CHKHFR:
                              CHKHFR
FF2      PRINT     *F;
.
CHKHFR   MOVE      PINVNO TO KEY8
         CALL      RDHFRE1
         BRANCH    OVRCD TO OPT5I
.
         BRANCH    HFRSTAT TO OPT5I
         CALL      DEHFRE1
         GOTO      OPT5I
.
OPT5Z    MATCH     "IBARSH",PGM
         GOTO      START IF EQUAL
.
         DISPLAY   *P1:24,*V2LON,*EL:
                   "***  Generating Completed  ***",*W;
         MOVE      SPLING,CPRTFLG       * Restore the original setting
         CALL      CLSPRINT
         GOTO      START
.
.       Print only Outstanding Invoices for a given date range
.
OPTION6  DISPLAY   *P53:2,*V2LON," - Outstanding Invoices ",*P1:3,*EF,*HOFF:
                   *P1:4,"Invoice From : "
.
OPT6A    MOVE      SP8,INVFROM
         KEYIN     *P16:4,*V2LON,*EL,FORM8
.
         COMPARE   ZERO,FORM8
         GOTO      START IF LESS
         GOTO      OPT6B IF EQUAL
.
         SUB       ONE,FORM8
         MOVE      FORM8,INVFROM
         ADD       ONE,FORM8
.
OPT6B    DISPLAY   *P16:4,*V2LON,*EL,FORM8:
                   *P1:5,*HOFF,"Invoice To  : "
.
         MOVE      "99999999",INVTO
         KEYIN     *P16:5,*V2LON,*EL,*JR,*DE,*RV,INVTO
.
         MATCH     INVFROM,INVTO
         GOTO      OPT6C IF NOT LESS
.
         DISPLAY    *P1:24,*EL,*B,"Invalid Invoice Range.  ";
         CALL       HITENTER
         GOTO       OPTION6
.
OPT6C    DISPLAY    *P16:5,*V2LON,*EL,INVTO
         CALL       GETRNGE
         CALL       GCLM000             * Keyin range of Claim code
         CALL       GHFN000             * Keyin range of Health fund
.
         KEYIN      *P1:15,"Minimum amount owing : ",*EL,*V2LON,MINOWE:
                    *P24:15,*DV,MINOWE
.
         COMPARE   ZERO,MINOWE
         GOTO      OPTION6 IF LESS
.
         IF        CFEETYP = 6
           CALL      GINOP000                    * Get invoice type for Mt. Alv.
           COMPARE   ZERO,SNGOPTN                * exit selected ?
           GOTO      START IF EQUAL              * yes
         ENDIF
.     
         OPEN      CONTROLF,"controlf"
         CALL      PATSELFN
         BRANCH    EXIT,START
.
         CALL      KHOS0000                     * Keyin hospital ID
         BRANCH    EXIT,START
.
OPT6D    CALL       CONTQST                      * Ok to continue ?
         BRANCH     CEXIT,OPT6E:                 * yes
                          OPTION6:               * no
                          START                  * cancel
.
OPT6E    MATCH     "IBARSH",PGM
         GOTO      OPT6E2 IF EQUAL
.
         CALL      OPNPRINT
         MOVE      THREE,CPRTFLG     * Allow all receipts to be spooled together
.
OPT6E2   MOVE      INVFROM,KEY8
         CALL      RDSINV1
.       
OPT6F    CALL      RDKINV1
         BRANCH    OVRCD OF OPT6Z
.
        COMPARE    FSTSYS,PINVSYS
        GOTO       OPT6F IF LESS
.
        COMPARE    PINVSYS,FEDSYS
        GOTO       OPT6F IF LESS
.
        BRANCH     PINVSYS OF INPOP6,OUTOP6,INPOP6,INPOP6,OPT6F
.
OUTOP6  MATCH      FSTSITE,PINVSITE
        GOTO       OPT6F IF LESS
.
        MATCH      PINVSITE,FEDSITE
        GOTO       OPT6F IF LESS
.
        MOVE       SP3,OSTSYST
        MOVE       "out",OSTFILE
        MOVE       PINVSITE,KEY6
        CALL       RDSITA1
.
        MATCH      FSTDEPT,OSTSYST
        GOTO       OPT6F IF LESS
.
        MATCH      OSTSYST,FEDDEPT
        GOTO       OPT6F IF LESS
.
INPOP6   MATCH     PINVNO,INVTO
         GOTO      OPT6Z IF LESS
.
         UNPACK    PINVDTE WITH XCENT,XYEAR,XMON,XDAY
         DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ":
                   *V2LON,PINVNO,SP2,XDAY,SLASH,XMON,SLASH,XYEAR;
.
         MOVE      PINVAMT,NETTOT
         ADD       PINVPATA,NETTOT
         ADD       PINVHFDA,NETTOT
         ADD       PINVOTHA,NETTOT
         ADD       PINVJOUR,NETTOT
         ADD       PTINGSTJ,NETTOT          * GST Journal              *I-90231
         ADD       PTINCRTT,NETTOT           * Credit Note
.
         COMPARE   ZERO00,NETTOT
         GOTO      OPT6F IF EQUAL
.
         COMPARE   MINOWE,NETTOT
         GOTO      OPT6F IF LESS
.
         MOVE      PINVUR,KEY8
         CALL      RDMAST1
         BRANCH    OVRCD OF OPT6F
.
         CALL      CHKRNGE
         BRANCH    OVRCD OF OPT6F
.
         CALL      GPNAME
.
         CALL      GETDETS
         BRANCH    OVRCD OF OPT6F
.
         CALL      CRNG000                  * Check range of claim code
         BRANCH    EXIT OF OPT6F
.
         CALL      HRNG000                  * Check range of health fund
         BRANCH    EXIT OF OPT6F
.
         CALL       GETXDET                      * Get extra details
.
         PACK      SERVDOCT,SP70
         IF        PINVSYS=1
           MATCH     "1",EMCNGINV           * Group invoice by service doctor?
           IF        @EQUAL
             CALL      GSDC0000              * Get Service doctor
           ENDIF
         ENDIF
.
         MOVE      ONE,PRINTFLG
         MOVE      ZERO,JHFLAG
         IF        CFEETYP=5 | CFEETYP=9
           MOVE      ONE,JHFLAG
         ENDIF
         CALL      INVPRT        *** PRINTS THE INVOICE
.
         COMPARE   "15",PTCNINVL
         GOTO      CHKHFR2 IF EQUAL    * No form feed for SVHM
.
         BRANCH    CINVLAY OF FF3,CHKHFR2,FF3,CHKHFR2,CHKHFR2,CHKHFR2,CHKHFR2:
                              CHKHFR2
FF3      PRINT     *F;
.
CHKHFR2  MOVE      PINVNO TO KEY8
         CALL      RDHFRE1
         BRANCH    OVRCD TO OPT6F
.
         BRANCH    HFRSTAT TO OPT6F
         CALL      DEHFRE1
         GOTO      OPT6F
.
OPT6Z    MATCH     "IBARSH",PGM
         GOTO      START IF EQUAL
.
         DISPLAY   *P1:24,*V2LON,*EL:
                   "***  Generating Completed  ***",*W;
         MOVE      SPLING,CPRTFLG      * Restore the original setting
         CALL      CLSPRINT
         GOTO      START
+
.
.        Re-print Invoices with Journals
.
OPTION7  COMPARE   ONE,CINVJRN
         GOTO      REPEAT2 IF NOT EQUAL
.
         DISPLAY   *P53:2,*V2LON,"- Invoices with Journals ",*P1:3,*EF
.
         DISPLAY   *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                   *P1:5,*V2LON,ONE,*HOFF," = Print Invoices By Batch Number":
                   *P1:6,*V2LON,TWO,*HOFF:
                         " = Clear Invoices with Journals file"
.
OPT7KY   KEYIN     *P1:8,*EF,"Option : ",*V2LON,OPTB
.
         COMPARE   ZERO,OPTB
         GOTO      START IF EQUAL
.
         BRANCH    OPTB OF OPT7GEN,OPT7CLR
.
         BEEP
         GOTO      OPT7KY
.
.
.        Print all Invoices with Journals
.
OPT7GEN  MOVE      ZERO,BATCHNO
         KEYIN     *P1:10,*EL,"Batch Number  :",BATCHNO
         COMPARE   ZERO,BATCHNO
         GOTO      OPT7KY IF EQUAL
.
         MOVE      ZERO,CLRFLAG
         MOVE      ZERO,RECFLAG
.
         KEYIN     *P1:12,*EL,"Do you want to clear Patient Invoices with":
                              " Journals file (Y/N) ? ",ANS;
         REP       UPPLOW,ANS
         CMATCH    ANSY,ANS
         GOTO      CLRFILE IF EQUAL
.
         CMATCH    ANSN,ANS
         GOTO      NOCLEAR IF EQUAL
         BEEP
         GOTO      OPTION7
.
CLRFILE  MOVE      ONE,CLRFLAG           * Flag to clear the file
.
NOCLEAR  IF        CFEETYP = 6
           CALL      GINOP000                    * Get invoice type for Mt. Alv.
           COMPARE   ZERO,SNGOPTN                * exit selected ?
           GOTO      START IF EQUAL              * yes
         ENDIF
.
         CALL       CONTQST                      * Ok to continue ?
         BRANCH     CEXIT,STPROC:                * yes
                          OPTION7:               * no
                          START                  * cancel
.
STPROC   MATCH     "IBARSH",PGM
         GOTO      STPROCX IF EQUAL
.
         DISPLAY   *P1:24,*EL,"*** Reprint Invoices with Journals ***";
.
         CALL      OPNPRINT
         MOVE      THREE,CPRTFLG    * Allow all invoices to be spooled together
.
STPROCX  PACK      KEY16 WITH BATCHNO,SP8
         CALL      RDSIJRN1
NEXTIJR  CALL      RDKIJRN1
         BRANCH    OVRCD OF IJR900
.
         DISPLAY   *P1:24,*EL,*P55:24,"Scanning : ",IJINVNO;
.
         COMPARE   BATCHNO,IJBATCH
         GOTO      IJR900 IF NOT EQUAL
.
         COMPARE   ZERO,FSTSYS
         GOTO      IJR200 IF EQUAL
.
         MOVE      IJINVNO,KEY8
         CALL      RDINV1
.
         COMPARE   FSTSYS,PINVSYS
         GOTO      NEXTIJR IF NOT EQUAL
.
         BRANCH    PINVSYS OF IJR200,IJR100,IJR200,IJR200,NEXTIJR
.
IJR100   MATCH     FSTSITE,PINVSITE
         GOTO      NEXTIJR IF LESS
.
         MATCH     PINVSITE,FEDSITE
         GOTO      NEXTIJR IF LESS
.
         MOVE      SP3,OSTSYST
         MOVE      "out",OSTFILE
         MOVE      PINVSITE,KEY6
         CALL      RDSITA1
.
         MATCH     FSTDEPT,OSTSYST
         GOTO      NEXTIJR IF LESS
.
         MATCH     OSTSYST,FEDDEPT
         GOTO      NEXTIJR IF LESS
.
IJR200   MOVE      IJINVNO,KEY8
         CALL      RDINV1
         BRANCH    OVRCD OF IJR400
.
.        Ignore the insurance invoice
.
         BRANCH    PINVTYP OF NEXTIJR
.
         MOVE      PINVADM,AADMNO
         MOVE      PINVUR,KEY8
         CALL      RDMAST1
         BRANCH    OVRCD OF IJR400
.
         CALL      GPNAME
.
         CALL      GETDETS
         BRANCH    OVRCD OF IJR400
.
         MOVE      ONE,PRINTFLG
         MOVE      ZERO,JHFLAG
         IF        CFEETYP=5 | CFEETYP=9
           MOVE      ONE,JHFLAG
         ENDIF
         CALL      INVPRT              *** Print the invoice
         MOVE      ONE,RECFLAG           * Found one invoice to be printed
.
         COMPARE   "15",PTCNINVL
         GOTO      IJR400 IF EQUAL    * No form feed for SVHM
.
         BRANCH    CINVLAY OF IJR300,IJR400,IJR300,IJR400,IJR400,IJR400:
                              IJR400,IJR400
IJR300   PRINT     *F;                 *** Single formfeed to separte pages
.
IJR400   COMPARE   ZERO,CLRFLAG
         GOTO      NEXTIJR IF EQUAL
.
.        Delete the record
.
         PACK      KEY16 WITH IJBATCH,IJINVNO
         CALL      DEIJRN1
         CALL      RDSIJRN1
         GOTO      NEXTIJR
.
IJR900   BRANCH    RECFLAG OF IJR999
.
         DISPLAY   *P1:24,*EL,*B,"No Invoices Generated.  ";
         CALL      HITENTER
         GOTO      START
.
IJR999   DISPLAY   *P1:24,*EL,"All Invoices Generated.  ";
         CALL      HITENTER
         GOTO      START
.
.
.        Option to clear Invoices with Journals file
.
OPT7CLR  DISPLAY   *P1:24,*EL,*P10:24,"Cleared : ",*P55:24,"Scanning : ";
         MOVE      SP20,KEY16
         CALL      RDSIJRN1
ICLR100  CALL      RDKIJRN1
         BRANCH    OVRCD OF ICLR999
.
         DISPLAY   *P68:24,IJINVNO;
         COMPARE   ZERO,FSTSYS
         GOTO      ICLR300 IF EQUAL
.
         MOVE      IJINVNO,KEY8
         CALL      RDINV1
.
         COMPARE   FSTSYS,PINVSYS
         GOTO      ICLR100 IF NOT EQUAL
.
         BRANCH    PINVSYS OF ICLR300,ICLR200,ICLR300,ICLR300,ICLR100
.
ICLR200  MATCH     FSTSITE,PINVSITE
         GOTO      ICLR100 IF LESS
.
         MATCH     PINVSITE,FEDSITE
         GOTO      ICLR100 IF LESS
.
         MOVE      SP3,OSTSYST
         MOVE      "out",OSTFILE
         MOVE      PINVSITE,KEY6
         CALL      RDSITA1
.
         MATCH     FSTDEPT,OSTSYST
         GOTO      ICLR100 IF LESS
.
         MATCH     OSTSYST,FEDDEPT
         GOTO      ICLR100 IF LESS
.
ICLR300  MOVE      IJINVNO,KEY8
         CALL      RDINV1
         BRANCH    OVRCD OF ICLR100
.
.        Delete the record
.
         DISPLAY   *P20:24,*V2LON,IJINVNO;
.
         PACK      KEY16 WITH IJBATCH,IJINVNO
         CALL      DEIJRN1
         CALL      RDSIJRN1
         GOTO      ICLR100
.
ICLR999  DISPLAY   *P1:24,*EL,*V2LON:
                   "** Invoices with Journals file Cleared **",*W2;
         GOTO      START
.
+
.
.        Subroutine to ask the operator for a name range
.
GETRNGE  MOVE      "Start ",STRTNAM
         MOVE      "Finish",ENDNAM
.
         KEYIN     *P1:7,*EL,*P1:9,*EL:
                   *P1:7,"Enter starting name  : ",*DV,*V2LON,STRTNAM:
                   *P24:7,*RV,STRTNAM,*HOFF:
                   *P1:9,"Enter ending name    : ",*DV,*V2LON,ENDNAM:
                   *P24:9,*RV,ENDNAM
.
         MATCH     "Start ",STRTNAM
         IF        @EQUAL
           MOVE      "A     ",STRTNAM
         ENDIF
.
         MATCH     "Finish",ENDNAM
         IF        @EQUAL
           MOVE      "ZZZZZZ",ENDNAM
         ENDIF
.
         MATCH     STRTNAM,ENDNAM
         RETURN    IF NOT LESS
.
         DISPLAY   *P1:24,*EL,*B,"Invalid Name Range.  ";
         CALL      HITENTER
         GOTO      GETRNGE
.
.        Subroutine to check that the patient is in the required name range
.
CHKRNGE  MOVE      ZERO,OVRCD
.
         IF          IBCNMHOS=1
           MATCH       SP10,HOSPID
           IF          !@EQUAL
             OPEN        PMSVX1A1,"pmsvx1af"
             PACK        KEY8,PINVADM,SP8
             CALL        RDPMVX11
             BRANCH      OVRCD,CHKR999
             MATCH       PMVXMHOS,HOSPID
             GOTO        OVERCOND IF NOT EQUAL
           ENDIF
         ENDIF
.
         MATCH     STRTNAM,PSNAME
         GOTO      OVERCOND IF LESS
.
         PACK      DIM20,ENDNAM,SP20        * for matching purpose
.
......   MATCH     PSNAME,ENDNAM
         MATCH     PSNAME,DIM20             
         GOTO      OVERCOND IF LESS
CHKR999  RETURN
.
.******************************************************************************
.       Check range of claim code
.******************************************************************************
CRNG000  MATCH     SP70,STCLM
         IF        !@EQUAL
           MATCH     STCLM,PINVCLM
           GOTO      CRNG9000 IF LESS
         ENDIF
.
         MATCH     SP70,EDCLM
         IF        !@EQUAL
           MATCH     PINVCLM,EDCLM
           GOTO      CRNG9000 IF LESS
         ENDIF
.
         MOVE      ZERO,EXIT
         GOTO      CRNG999
.
CRNG9000 MOVE      ONE,EXIT
CRNG999  RETURN
+
.******************************************************************************
.       Check range of health fund
.******************************************************************************
HRNG000  MATCH     SP70,STHFN
         IF        !@EQUAL
           MATCH     STHFN,AFUNDH
           GOTO      HRNG9000 IF LESS
         ENDIF
.
         MATCH     SP70,EDHFN
         IF        !@EQUAL
           MATCH     AFUNDH,EDHFN
           GOTO      HRNG9000 IF LESS
         ENDIF
.
         MOVE      ZERO,EXIT
         GOTO      HRNG999
.
HRNG9000 MOVE      ONE,EXIT
HRNG999  RETURN
+
.******************************************************************************
.        Keyin range of claim code
.******************************************************************************
GCLM000 MOVE     SP3,STCLM
        DISPLAY  *P1:11,*EL:
                 *P1:11,*EL,"Starting Claim Type  : "
.
        MOVE     "11",EVERT
        MOVE     TWENTY4,ECOL
        MOVE     ZERO,CKYIMAND
        MOVE     "CL",CODE
        CALL     PATCODKY
.
        MOVE     ACODE,STCLM
.
        MATCH    SP3,STCLM
        GOTO     GCLM100 IF NOT EQUAL
.
        DISPLAY  *P24:11,*V2LON,START;
        GOTO     GCLM200
.
GCLM100 DISPLAY  *P24:11,*V2LON,STCLM
.
GCLM200 MOVE     SP3,EDCLM
        DISPLAY  *P41:11,*EL,"Ending Claim Type    : "
.
        MOVE     "11",EVERT
        MOVE     SIXTY4,ECOL
        MOVE     "CL",CODE
        CALL     PATCODKY
.
        MOVE     ACODE,EDCLM
.
        MATCH    SP3,EDCLM
        GOTO     GCLM400 IF NOT EQUAL
.
        MOVE     "zzz",EDCLM
        DISPLAY  *P64:11,*V2LON,FINISH;
        GOTO     GCLM500
.
GCLM400 DISPLAY  *P64:11,*V2LON,EDCLM
.
GCLM500 MATCH    STCLM,EDCLM
        GOTO     GCLM999 IF NOT LESS
.
        DISPLAY  *P1:24,*EL,*B,*V2LON:
                 "** Ending Claim < Starting Claim **",*W2
        GOTO     GCLM000
.
GCLM999 RETURN
+
.******************************************************************************
.       Keyin range of health fund
.******************************************************************************
GHFN000 MOVE     SP3,STHFN
        DISPLAY  *P1:13,*EF,"Starting Health Fund : ";
.
        MOVE     "13",EVERT
        MOVE     TWENTY4,ECOL
        MOVE     ZERO,CKYIMAND
        CALL     PATFNDKY
.
        MOVE     HCODE,STHFN
        MATCH    SP6,STHFN
        GOTO     GHFN100 IF NOT EQUAL
.
        DISPLAY  *P24:13,*V2LON,START;
        GOTO     GHFN200
.
GHFN100 DISPLAY  *P24:13,*V2LON,STHFN;
.
GHFN200 MOVE     SP3,EDHFN
        DISPLAY  *P41:13,*EL,"Ending Health Fund   : ";
.
        MOVE     "13",EVERT
        MOVE     SIXTY4,ECOL
        MOVE     ZERO,CKYIMAND
        CALL     PATFNDKY
.
        MOVE     HCODE,EDHFN
        MATCH    SP6,EDHFN
        GOTO     GHFN300 IF NOT EQUAL
.
        MOVE     "zzz",EDHFN
        DISPLAY  *P64:13,*V2LON,FINISH;
        GOTO     GHFN400
.
GHFN300 DISPLAY  *P64:13,*V2LON,EDHFN
.
GHFN400 MATCH    STHFN,EDHFN
        GOTO     GHFN999 IF NOT LESS
.
        DISPLAY  *P1:24,*EL,*B,*V2LON:
                 "** Ending Health Fund must be greater":
                 " than or equal to Starting Health Fund **",*W2,*P1:10,*EL
        GOTO     GHFN000
.
GHFN999 RETURN
+
.         Subroutine to key in a date
.
KEYINDTE  
          IF        IDAY=0
            MOVE      SP10,CDAY        * no default day/mon
            MOVE      SP10,CMON
            MOVE      SP10,CYEAR
            MOVE      SP10,CCENT
          ELSE
            MOVE      IDAY,CDAY        * set up day/mon
            MOVE      IMON,CMON
            MOVE      IYEAR,CYEAR
            MOVE      ICENT,CCENT
          ENDIF
.
          MOVE      VERT,CVERT         * set up position
          MOVE      COL,CCOL
.
          MOVE      "0",CCANLDTE       * 0=cannot cancel default date, 1=can
          MOVE      "1",CDEFDTE        * 0=3 C/R's to accept date, 1=1 C/R
          REPEAT
            CALL      KEYDATE          * nez modified to use standard routine
          UNTIL     CQUEST=0
.
          MOVE      ZERO,IDAY
          MOVE      CDAY,IDAY
.
          RETURN
.
.       Get the name of the patient
.
GPNAME  CLEAR     PNAME
        REP       ", ",PTITL
        REP       ", ",PGNAME
        REP       ", ",PSNAME
.
        PACK      DIM6 WITH SP1,PTITL,SP1
FRSTCH  CMATCH    SP1,DIM6
        GOTO      APGNAM IF NOT EQUAL
        BUMP      DIM6
        GOTO      FRSTCH IF NOT EOS
.
        APPEND    PGNAME,PNAME
        GOTO      APS1
.
APGNAM  APPEND    DIM6,PNAME
APG1    CMATCH    SP1,PNAME
        GOTO      APG2 IF NOT EQUAL
        BUMP      PNAME,-1
        GOTO      APG1 IF NOT EOS
.
        CLEAR     PNAME
        APPEND    PGNAME,PNAME
        GOTO      APS1
.
APG2    APPEND    SP1,PNAME
        APPEND    PGNAME,PNAME
.
APS1    CMATCH    SP1,PNAME
        GOTO      APS2 IF NOT EQUAL
        BUMP      PNAME,-1
        GOTO      APS1 IF NOT EOS
.
        CLEAR     PNAME
        APPEND    PSNAME,PNAME
        GOTO      APSPS
.
APS2    APPEND    SP1,PNAME
        APPEND    PSNAME,PNAME
.
APSPS   APPEND    SP30,PNAME
        APPEND    SP30,PNAME
        RESET     PNAME
        RETURN
+
INVURNO
         DISPLAY   *P1:24,*EL,*B,"U/R Number does not Exist.  ";
         CALL      HITENTER
         GOTO      REPEAT
.
INVADMN
         DISPLAY   *P1:24,*EL,*B,"Billing Number does not Exist.  ";
         CALL      HITENTER
         GOTO      REPEAT
.
INVINVC
         DISPLAY   *P1:24,*EL,*B,"Invoice does not Exist.  ";
         CALL      HITENTER
         GOTO      REPEAT
.
INVPAID
         DISPLAY   *P1:24,*EL,*B,"Patient has Paid up all Accounts.  ";
         CALL      HITENTER
         GOTO      REPEAT
.
.      BASIC DETAILS MENU
.
DISPB    DISPLAY   *P1:4,"U/R Number :",*EF:
                   *P1:5,"Billing No :":
                   *P27:4,"Name :":
                   *P27:5,"Sex  :":
                   *P43:5,"Born :":
                   *P62:5,"Age :"
.
         BRANCH    PINVSYS OF AAEDPB,OUTDPB,INPDPB,OUTDPB,DISP9
.
.        Inpatient Basic Data Display
.
INPDPB   DISPLAY   *P27:6,"Ward :":
                   *P43:6,"Doct :"
         RETURN
.
.        Outpatient Basic Data Display
.
OUTDPB   DISPLAY   *P27:6,"Site :":
                   *P43:6,"Clin :"
         RETURN
.
.        A + E Basic Data Display
.
AAEDPB   DISPLAY   *P27:6,"Time :":
                   *P43:6,"Doct :"
DISP9    RETURN
+
.
.          SUBROUTINE,DISPLAY BASIC DATA ONTO THE SCREEN
.
DATAB   BRANCH     PINVSYS OF AAEDTB,OUTDTB,INPDTB,OTHDTB,XDATAB
.
.       Inpatient Basic Data
.
INPDTB  MOVE       SP30,DPSTAT
        LOAD       DPSTAT FROM ASTAT OF STAT1,STAT2,STAT3,STAT4,STAT5
.
.       Add dates if this is a current admission or discharge
.
        BRANCH     ASTAT OF XDATAB,XSTAT1,XSTAT2
        GOTO       XDATAB
.
XSTAT1  UNPACK     ADATE INTO XCENT,XYEAR,XMON,XDAY
        PACK       DPSTAT WITH STAT2,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR,SP10
        GOTO       XDATAB
.
XSTAT2  UNPACK     DDATE INTO XCENT,XYEAR,XMON,XDAY
        PACK       DPSTAT WITH STAT3,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR,SP10
        GOTO       XDATAB
.
.       Outpatient Basic Data
.
OUTDTB  UNPACK     OBADATE WITH XCENT,XYEAR,XMON,XDAY
        PACK       DPSTAT WITH STATO,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR,SP10
        GOTO       XDATAB
.
.       A + E Basic Data
.
AAEDTB  UNPACK     ADADATE WITH XCENT,XYEAR,XMON,XDAY
        PACK       DPSTAT WITH STATE,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR,SP10
        GOTO       XDATAB
.
.       Other financial Basic Data
.
OTHDTB  UNPACK     PINVDTE WITH XCENT,XYEAR,XMON,XDAY
        PACK       DPSTAT WITH XDAY,SLASH,XMON,SLASH,XCENT,XYEAR,SP20
.
.       Continue with the determining of the data
.
XDATAB  UNPACK     PBDATE INTO XCENT,XYEAR,XMON,XDAY
.
.* ****************************************** Start of Changes         *C-49016
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSC00                * get sex description (in IBACOMN)
.                                           *       returns DSEXDESC & DSEXNO
          MOVE      DSEXDESC,DSEX
.* ******************************************   End of Changes         *C-49016
.
CNTPD2
        DISPLAY    *P13:4,*V2LON,PINVUR:
                   *P34:4,PSNAME,PGNAME:
                   *P13:5,PINVADM:
                   *P34:5,DSEX:
                   *P50:5,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR:
                   *P67:5,PSAGE:
                   *P1:6,DPSTAT
.
GETXDET   BRANCH     PINVSYS OF AAEDT1,OUTDT1,INPDT1,OTHDT1,ENDDB
.
.       Inpatient extra information
.
INPDT1  MATCH      SP3,AWARD
        GOTO       NOWRDS IF EQUAL
.
        PACK       KEY6 WITH AWARD,ABED
        CALL       RDWARD1
        BRANCH     OVRCD OF NOWRDS
.
        MATCH      WADMNO,AADMNO
        GOTO       NOWRDS IF NOT EQUAL
.
        IF         (OPTION=2)|(OPTION=3)
          DISPLAY    *P34:6,*V2LON,AWARD,SLASH,ABED
        ENDIF
        GOTO       BASDOC
.
NOWRDS  IF         (OPTION=2)|(OPTION=3)
          DISPLAY    *P34:6,*V2LON," N/A"
        ENDIF
.
BASDOC    MOVE      SP30,DOCNAME
          MOVE      ADOCTA,KEY6
          OPEN      PATDO1A1,"patdo1af"
          CALL      RDDOCT1
          CLOSE     PATDO1A1
          BRANCH    OVRCD OF ENDDB
          MOVE      DGNAME,ANS
          PACK      DOCNAME WITH ANS,DOT,DSNAME
          IF        (OPTION=2)|(OPTION=3)
            DISPLAY    *P50:6,*EL,*V2LON,DOCNAME
          ENDIF
ENDDB     RETURN
.
.         Outpatient Extra information
.
OUTDT1    MOVE       SP30,OCADESC
.
          PACK       CFNAME,OSTFILE,FILCLIA1
          OPEN       OUTCLIA1,CFNAME
.
          PACK      KEY20,PVISITE,PVIDOCT,PVIDATE
          CALL      RDCLIA1
          IF        OVRCD = 1
            CALL      RDPCLIA1
            IF        OVRCD = 0
              MATCH     PVISITE,OCASITE
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ELSE
                MATCH     PVIDOCT,OCACLIN
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          CLOSE     OUTCLIA1
          IF        OVRCD = 1
            MOVE      "Unknown clinic",OCADESC
            PACK      OCADESC,OCADESC,SP30
..            GOTO      DSPOUTBD
          ENDIF
.
            MATCH      SP6,OCADOCT
            GOTO       DSPOUTBD IF EQUAL
.
            MOVE      OCADOCT,KEY6
            OPEN      PATDO1A1,"patdo1af"
            CALL      RDDOCT1
            CLOSE     PATDO1A1
            BRANCH    OVRCD OF DSPOUTBD
..          MOVE       DGNAME,ANS
..          PACK       OCADESC WITH ANS,DOT,DSNAME
.
DSPOUTBD  IF        (OPTION=2)|(OPTION=3)
            DISPLAY    *P34:6,*V2LON,OBASITE,*P50:6,OCADESC
          ENDIF
          RETURN
.
.         A + E Extra Information
.
AAEDT1    MOVE      SP30,DOCNAME
.
          MOVE      ADADOCT,KEY6
          OPEN      PATDO1A1,"patdo1af"
          CALL      RDDOCT1
          CLOSE     PATDO1A1
          BRANCH    OVRCD OF DSPAAEBD
.
          MOVE      DGNAME,ANS
          PACK      DOCNAME WITH ANS,DOT,DSNAME
.
DSPAAEBD  IF        (OPTION=2)|(OPTION=3)
            DISPLAY    *P34:6,*V2LON,ADATIME,*P50:6,DOCNAME
          ENDIF
.
          RETURN
.
.         Other Financial Extra Information
.
OTHDT1    MOVE       SP30,OCADESC
.
          PACK       CFNAME,OSTFILE,FILCLIA1
          OPEN       OUTCLIA1,CFNAME
.
          PACK      KEY20,PVISITE,PVIDOCT,PVIDATE
          CALL      RDCLIA1
          IF        OVRCD = 1
            CALL      RDPCLIA1
            IF        OVRCD = 0
              MATCH     PVISITE,OCASITE
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ELSE
                MATCH     PVIDOCT,OCACLIN
                IF        !@EQUAL
                  MOVE      ONE,OVRCD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          CLOSE     OUTCLIA1
          IF        OVRCD = 1
            MOVE      "Unknown clinic",OCADESC
            PACK      OCADESC,OCADESC,SP30
            GOTO      DSPOTHBD
          ENDIF
.
          MATCH      SP6,OCADOCT
          GOTO       DSPOTHBD IF EQUAL
.
          MOVE       OCADOCT,KEY6
          OPEN      PATDO1A1,"patdo1af"
          CALL       RDDOCT1
          CLOSE     PATDO1A1
          BRANCH     OVRCD OF DSPOTHBD
          MOVE       DGNAME,ANS
          PACK       OCADESC WITH ANS,DOT,DSNAME
.
DSPOTHBD  IF        (OPTION=2)|(OPTION=3)
            DISPLAY    *P34:6,*V2LON,PVISITE,*P50:6,OCADESC
          ENDIF
          RETURN
.
.         Subroutine to get the relevant details for the patient for this inv.
.
GETDETS   BRANCH     PINVSYS OF AAEDETS,OUTDETS,INPDETS,OTHDETS,GETD9
.
.         Inpatient invoice
.
INPDETS   MOVE       SP8,DDATE
          MOVE       SP3,DSTAT
          MOVE       SP3,DDEST
          MOVE       SP9,DFMBS
          MOVE       SP70,AFUNDH
          PACK       DDIAG WITH SP30,SP30
          PACK       DDIAG2 WITH SP30,SP30
.
          MOVE       PINVADM,KEY8
          CALL       RDDSCH1
.
          MOVE       PINVADM,KEY8
          CALL       RDMISS1
.
          IF         IBCNMHOS=1
            OPEN       PMSVX1A1,"pmsvx1af"
            CALL       RDPMVX11
          ENDIF      
          RETURN
.
.         Outpatient invoice
.
OUTDETS   MOVE       PINVADM,PVIBILL
          MOVE       PVIBILL,KEY8
          CALL       RDVISA1
          BRANCH     OVRCD OF OUTDETED
.
          MOVE       PVIBILL,AADMNO         * Populate the admission number
.
          MOVE       "out",OSTFILE
          MOVE       PVISITE,KEY6
          CALL       RDSITA1
.
          PACK       CFNAME,OSTFILE,FILBB1A2
          CLOSE      OUTBB1A2
          CALL       OPOTBB12
.
          PACK       CFNAME,OSTFILE,FILBB1A1  * Set up physical filename
          CLOSE      OUTBB1A1
          CALL       OPOTBB11
.
          CLOSE      OUTDTRO1
          PACK       CFNAME,OSTFILE,FILDTRO1
          OPEN       OUTDTRO1,CFNAME
.
          PACK       KEY16,PVIDATE,PVIBILL
          CALL       RDBOKB2
          BRANCH     OVRCD OF OUTDETED
.
          MOVE       OBBCTYP,OBACTYP
          MOVE       OBACOMP,ACLAIM
          MOVE       OTBBFUND,AFUNDH
          MOVE       OTBBTBLE,AFNDTB
          MOVE       SP70,AFNDMM
.
          MOVE       PVIURNO,OBAURNO
          MOVE       PVISITE,OBASITE
          MOVE       OBADATE,ADATE            * Initialize ADATE
          MOVE       SP10,DDATE
.
          MOVE       SP70,ADIAG1
          MOVE       SP70,ADIAG2
          MOVE       SP70,DDIAG
          MOVE       SP70,DDIAG2
.
OUTDETED  RETURN
.
.
.         A + E invoice
.
AAEDETS   MOVE       PINVADM,ADANUMB
          MOVE       ADANUMB,KEY8
          CALL       RDDETA1
          BRANCH     OVRCD,GETD9
.
          MOVE       ADANUMB,AADMNO         * populate the admission number
          MOVE       ADACOMP,ACLAIM
          MOVE       ADADATE,ADATE          * Initialize ADATE
          MOVE       AEDAFUND,AFUNDH
          MOVE       SP10,DDATE
.
          CALL       RDDISA1
          IF         OVRCD=0
            MOVE       ADSDATE,DDATE        * discharged date
          ENDIF
          MOVE       ZERO,OVRCD
.
          MATCH      SP10,DDATE
          GOTO       GETD9 IF NOT EQUAL
.
          MOVE       ADANUMB,KEY8
          CALL       RDEMVIS1
          IF         OVRCD=0
            MOVE       EMVIDDAT,DDATE
            MOVE       EMVIFUND,AFUNDH
          ENDIF
          MOVE       ZERO,OVRCD
.
GETD9     RETURN
.
.         Other Financial invoice
.
OTHDETS   MOVE       SP6,PVIDOCT
          MOVE       PINVADM,PVIBILL
          MOVE       PVIBILL,KEY8
          CALL       RDVISA1
.
          MOVE       PVIBILL,AADMNO         * Populate the admission number
.
          MOVE       "out",OSTFILE
          CLOSE      OUTDTRO1
          PACK       CFNAME,OSTFILE,FILDTRO1
          OPEN       OUTDTRO1,CFNAME
.
          MOVE       PINVDTE,ADATE
          MOVE       SP10,DDATE
          MOVE       SP70,AFUNDH
          RETURN
+
.*************************************************************************
.*                             GINOP000                                  *
.*                  get invoice option for Mt. Alvernia (CFEETYP = 6)    *
.* Returns: SNGOPTN - Type of invoice displayed/printed                  *
.*                      0 = Exit                                         *
.*                      1 = Detailed invoice by cost centre              *
.*                      2 = Detailed invoice by date                     *
.*                      3 = Summary invoice                              *
.*                      4 = Final invoice                                *
.*************************************************************************
.
GINOP000  DISPLAY   *P1:16,*EF,*V2LON,ZERO,*HOFF,". Exit":
                    *P1:17,*V2LON,ONE,*HOFF,". Detail Invoice by Cost Centre":
                    *P1:18,*V2LON,TWO,*HOFF,". Detail Invoice by Date":
                    *P1:19,*V2LON,THREE,*HOFF,". Summary Invoice":
                    *P1:20,*V2LON,FOUR,*HOFF,". Final Invoice"
.
GINOP050  KEYIN     *P1:22,*EL,"Select Option : ",*DV,UNDLN1:
                    *P17:22,*V2LON,SNGOPTN
.
          BRANCH    SNGOPTN,GINOP900:            * Detail by Cost Centre
                            GINOP900:            * Detail by Date
                            GINOP900:            * Summary
                            GINOP900             * Final
.
          COMPARE   ZERO,SNGOPTN
          GOTO      GINOP900 IF EQUAL            * Exit
.
          BEEP
          GOTO      GINOP050                     * invalid selection
.
GINOP900  
.         DISPLAY   *P1:8,*EF
.         IF        SNGOPTN <> 2
.           CALL      CLERT000                   * clear temp file
.         ENDIF
.
GINOP999  RETURN
+
.*******************************************************************************
.         DLUM0000 - Generate lumpsum for daycase
.*******************************************************************************
DLUM0000  MOVE      SP10,PTHFBCAT         * initialise table type
          OPEN      PATFN1A1,"patfn1af"
          PACK      KEY14,AFUNDH,AFNDTB,SP70
          CALL      RDFUND1
.
          PACK      SAVDES1,SP20,SP20
          PACK      SAVDES2,SP20,SP20
          OPEN      PATLSDA1,"patlsdaf"   * open Day case file
          PACK      KEY27,CONTRCID,ACLAIM,AFUNDH,PTHFBCAT,CMDRG,SP20  *C-257430
          CALL      RDPTLSD1
          IF        OVRCD = 1
            PACK      KEY27,CONTRCID,ACLAIM,SP6,SP3,CMDRG,SP20        *C-257430
            CALL      RDPTLSD1
            IF        OVRCD = 1
              READ      CONTROLF,TWENTY;*193,PTCNDCLM
              CALL      DCLM0000
              PACK      KEY27,CONTRCID,PTCNDCLM,SP6,SP3,CMDRG,SP20    *C-257430
              CALL      RDPTLSD1
              CLOSE     PATLSDA1
              BRANCH    OVRCD,DLUM9999        * no lumpsum charge
            ENDIF
          ENDIF
          CLOSE     PATLSDA1
.
          MOVE      PTLSDES1,SAVDES1
          MOVE      PTLSDES2,SAVDES2
          MOVE      SAVDES1,LSDESC1       * PATCATAI reads LSDESC1, not SAVDES1
          MOVE      SAVDES2,LSDESC2
DLUM9999  RETURN
+
.*******************************************************************************
.         OLUM0000 - Overnight lumpsum
.*******************************************************************************
OLUM0000  MOVE      SP10,PTHFBCAT         * initialise table type
          OPEN      PATFN1A1,"patfn1af"
          PACK      KEY14,AFUNDH,AFNDTB,SP70
          CALL      RDFUND1
.
          OPEN      PATHLFA1,"pathlfaf"
          PACK      KEY27,CONTRCID,ACLAIM,AFUNDH,PTHFBCAT,CMDRG
          CALL      RDPTHLF1                                          *C-257430
          IF        OVRCD = 1
            PACK      KEY27,CONTRCID,ACLAIM,SP6,SP3,CMDRG
            CALL      RDPTHLF1                                        *C-257430
            IF        OVRCD = 1
              READ      CONTROLF,TWENTY;*193,PTCNDCLM
              CALL      DCLM0000
              PACK      KEY27,CONTRCID,PTCNDCLM,SP6,SP3,CMDRG
              CALL      RDPTHLF1                                      *C-257430
              CLOSE     PATHLFA1
              BRANCH    OVRCD,OLUM9999        * no lumpsum charges
            ENDIF
          ENDIF
          CLOSE     PATHLFA1
          MOVE      PTHLDES1,SAVDES1
          MOVE      PTHLDES2,SAVDES2
          MOVE      SAVDES1,LSDESC1       * PATCATAI reads LSDESC1, not SAVDES1
          MOVE      SAVDES2,LSDESC2
.
OLUM9999  RETURN
+
.*******************************************************************************
.       Keyin hospital ID
.*******************************************************************************
KHOS0000  MOVE       ZERO,EXIT
          MOVE       SP70,HOSPID
          COMPARE    ONE,IBCNMHOS
          GOTO       KHOS9999 IF NOT EQUAL
.
          DISPLAY    *P1:15,*EL,"Hospital Id : ";
          MOVE       TEN5,ECOL
          MOVE       "15",EVERT
          MOVE       SP3,CKYIDEF3
          MOVE       ZERO,CKYIMAND           * Not Mandatory
          OPEN       PATHSPA1,"pathspaf"
.
          CALL       PATHSPKY
          BRANCH     EXIT,KHOS1000,KHOS9000
          MOVE       PTHSHOSP,HOSPID
          MOVE       ZERO,EXIT
          GOTO       KHOS9999
.
KHOS1000  MOVE       "All Hospitals",PTHSNAME
          MOVE       SP70,HOSPID
          MOVE       ZERO,EXIT
          GOTO       KHOS9999
.
KHOS9000  MOVE       ONE,EXIT
KHOS9999  RETURN
+
.*******************************************************************************
.         Get the default charging claim code for multi hospital
.*******************************************************************************
DCLM0000  IF        IBCNMHOS=1
            OPEN      PATHSPA1,"pathspaf"
            MOVE      PMVXMHOS,KEY3
            CALL      RDPTHSP1
            IF        OVRCD=0
              MOVE      PTHSDCLM,PTCNDCLM     * default claim code charging
            ENDIF
          ENDIF
          MATCH     SP70,PTCNDCLM
          IF        @EQUAL
            MOVE      "0  ",PTCNDCLM          * Use zero claim code
          ENDIF
DCLM9999  RETURN
.
WEBERR00  RETURN
+
PRTEOL    IF        IBCNUGST=2 & PTCNINVL=9 & PTCNINVB=2
            CALL      PRTEOL18         * print right handside
          ELSE
            PRINT     *N;
          ENDIF
          RETURN
+
.-------------------------------------------------
. Format Doctors Given Name
.-------------------------------------------------
DOCGIV00  CMATCH    SP1,NAME35               * Remove Leading Blanks
          IF        @EQUAL
            BUMP      NAME35
            GOTO      DOCGIV00 IF NOT EOS
            GOTO      DOCGIV99               * entire name if blank
          ENDIF
          PACK      KEY35,NAME35,SP30        * reset form pointer
          MOVE      KEY35,NAME35
.
          SCAN      SP1,NAME35             * Locate the blank
          GOTO      DOCGIV20 IF NOT EQUAL
          BUMP      NAME35,-1              * go back 1 to end of name
          MOVEFPTR  NAME35,CCITEM          * another handly form field
          RESET     NAME35                 * reset the form pointer
          SETLPTR   NAME35,CCITEM          * set logical length to end of name
.
.         Save this name
.
          UNPACK    NAME35,KEY1,KEY50
          REP       DOWNCASE,KEY50
          APPEND    KEY1,DISPNAME
          STRIP     KEY50
          APPEND    KEY50,DISPNAME
          APPEND    SP1,DISPNAME
.
.         Check for any more names
.
          SETLPTR   NAME35,35              * reset logical length
          ADD       ONE,CCITEM             * position of 1st blank
          RESET     NAME35,CCITEM          * reset to this point
          PACK      KEY35,NAME35,SP70      * reset form pointer
          MOVE      KEY35,NAME35

DOCGIV10  CMATCH    SP1,NAME35               * Remove Leading Blanks
          IF        @EQUAL
            BUMP      NAME35
            GOTO      DOCGIV10 IF NOT EOS
            GOTO      DOCGIV99               * entire name if blank
          ENDIF
          PACK      KEY35,NAME35,SP30        * reset form pointer
          MOVE      KEY35,NAME35
.
          SCAN      SP1,NAME35             * Locate the blank
          GOTO      DOCGIV20 IF NOT EQUAL
          BUMP      NAME35,-1              * go back 1 to end of name
          MOVEFPTR  NAME35,CCITEM          * another handly form field
          RESET     NAME35                 * reset the form pointer
          SETLPTR   NAME35,CCITEM          * set logical length to end of name
.
.         Save this Initial
.
          UNPACK    NAME35,KEY1,KEY50
          APPEND    KEY1,DISPNAME
          APPEND    SP1,DISPNAME
.
          GOTO      DOCGIV99
.
.         Rest of the string is one name
.
DOCGIV20  UNPACK    NAME35,KEY1,KEY50
          REP       DOWNCASE,KEY50
          APPEND    KEY1,DISPNAME
          STRIP     KEY50
          APPEND    KEY50,DISPNAME
          APPEND    SP1,DISPNAME
.
DOCGIV99  RETURN
+
.
ENDIT    CHAIN     PGM
.------------------------------------------------------------
. Procedure to get Doctor Code from Outpatient Clinic ID
. COPTION - 1 Return DOCTCODE
.           2 Output Location
.           3 (N/A)
.           4 Output Menu Type
.           5 Output Unit
.------------------------------------------------------------
          DEFPROC  OUTDET00
.
          INC      OUTPREFD/INC
          INC      OUTCLIFD/INC
          INC      OUTBOAFD/INC
          INC      OUTMA1FD/INC
          INC      OUTBB1FD/INC
.
KEYBOA    DIM      28
KEYCLI    DIM      20
.
          MOVE     SP70,DOCTCODE
          COMPARE  ZERO,PVITYPE
          GOTO     OUTDET50 IF EQUAL
.
          PACK     KEY6,PVISITE,SP70
          CALL     RDSITA1
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYCLI,PVISITE,PVIDOCT,PVIDATE,SP70
          BRANCH   COPTION,OUTDET60
.
          PACK     KEY8,OSTFILE,FILBOKA1 * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTBOKA1,KEY8         * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYBOA,PVISITE,PVIDOCT,PVIDATE,SP70
          PACK     KEY28,PVISITE,PVIDOCT,PVIDATE,SP70
          PACK     KEY20,PVISITE,PVIDOCT,PVIDATE,SP70
          CALL     RDSBOKA1
OUTDET10  CALL     RDKBOKA1
          BRANCH   OVRCD,OUTDET95
          PACK     KEYBOA,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          MATCH    KEY20,KEYBOA
          GOTO     OUTDET95 IF NOT EQUAL
          MATCH    OBAOUTNO,PVIBILL         * Set up billing number
          GOTO     OUTDET10 IF NOT EQUAL
          GOTO     OUTDET80
.
OUTDET50  MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     OUTPREA1,"outpreaf"   * Pre Attendance File
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
          MOVE     ADMISSNO,KEY8
          CALL     RDPREA1               * Check for Pre-Attendance
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEY6,OPRSITE,SP70
          CALL     RDSITA1
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYCLI,OPRSITE,OPRCLIN,OPRDATE,SP70
          PACK     KEYBOA,OPRSITE,OPRCLIN,OPRDATE,OPRSTRT,OPRSLOT
.
          BRANCH   COPTION,OUTDET60,OUTDET70,OUTDET70,OUTDET70
.
OUTDET60  MOVE     ZERO,OVRCD
          PACK     KEY8,OSTFILE,FILCLIA1 * Determine Doctor from Clinic ID
          TRAP     OVERCOND IF IO
          OPEN     OUTCLIA1,KEY8         * Clinic Details
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEY20,KEYCLI,SP70 * Read for Current Effective Clinic
          CALL     RDCLIA1
          COMPARE  ONE,OVRCD
          GOTO     OUTDET65 IF NOT EQUAL
.         
          PACK     KEY20,KEYCLI,Z70  * Read for Current Effective Clinic
          CALL     RDSCLIA1
          CALL     RDPCLIA1
          BRANCH   OVRCD,OUTDET95
.
OUTDET65  MOVE     OCADOCT,DOCTCODE
          MATCH    SP70,DOCTCODE
          IF       @EQUAL
            MOVE     OCACCONS,DOCTCODE
          ENDIF
          MOVE     ZERO,EXIT
          GOTO     OUTDET99
.
OUTDET70  PACK     KEY8,OSTFILE,FILBOKA1 * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTBOKA1,KEY8         * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          MOVE     KEYBOA,KEY28
          CALL     RDBOKA1
          BRANCH   OVRCD,OUTDET95
.
OUTDET80  IF       COPTION=4
            PACK     MENUTYPE,TWO,OBASTAT * Outpatient Booking
            MOVE     ZERO,EXIT
            GOTO     OUTDET99
          ENDIF
.
          IF       COPTION=5
            PACK     CFNAME,OSTFILE,FILBB1A1
            CALL     OPOTBB11
            MOVE     ADMISSNO,KEY8
            CALL     RDBOKB1
            IF       OVRCD=0
              MATCH    SP6,OTBBDEPT
              GOTO     OUTDET95 IF EQUAL
              MOVE     OTBBDEPT,CODE       * Unit code
              MOVE     ZERO,EXIT
            ENDIF
            GOTO     OUTDET99
          ENDIF
.
          MOVE     ZERO,OVRCD
          PACK     KEY8,OSTFILE,FILMA1A1  * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTMA1A1,KEY8          * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEY18,OBASITE,OBACLIN,OBADAY,OBASTRT
          CALL     RDMASA1
          BRANCH   OVRCD,OUTDET95
.
          WRITE    HTMLFILE;OTMACLOC;
          MOVE     ZERO,EXIT
          GOTO     OUTDET99
.
OUTDET95  MOVE     ONE,EXIT
          GOTO     OUTDET99
.
          INC       OUTCLIIO/INC
          INC      OUTPREIO/INC
          INC       OUTBOAIO/INC
          INC       OUTMA1IO/INC
          INC       IBAOVRIO/INC
          INC       OUTBB1IO/INC
.
OUTDET99  ENDPROC
.------------------------------------------------------------
. Procedure to get Emergency Details
.   COPTION = 1 Return Consultant DOCTCODE
.             2 Output Location
.             3 Output Triage Status
.             4 Output Menu Type
.------------------------------------------------------------
          DEFPROC  EMRCHK00
.
          INC      EMRVISFD/INC
          INC      EMRLOCFD/INC
.
EMRCHK10  MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     EMRVISA1,"emrvisaf"
          TRAPCLR  IO
          BRANCH   OVRCD,EMRCHK90
.
          MOVE     ADMISSNO,KEY8
          CALL     RDEMVIS1
          BRANCH   OVRCD,EMRCHK90
.
          COMPARE  FOUR,EMVISTAT
          GOTO     EMRCHK90 IF EQUAL
.
          MOVE     EMVIDOCT,DOCTCODE
          IF       COPTION=4
            PACK     MENUTYPE,ONE,EMVISTAT
            GOTO     EMRCHK99
          ENDIF
          IF       COPTION=2
            IF       EMVISTAT=1
              OPEN     EMRLOCA1,"emrlocaf"
              MOVE     "Other Departments",EMLODESC
              MOVE     EMVILOCN,KEY3
              CALL     RDEMLOC1
              WRITE    HTMLFILE;"Emergency - ",EMLODESC;
            ELSE
              WRITE    HTMLFILE;"Discharged";
            ENDIF
          ENDIF
          IF       COPTION=3
            WRITE    HTMLFILE;EMVITRIG;
          ENDIF
          GOTO     EMRCHK99
.
EMRCHK90  MOVE     PVIDOCT,DOCTCODE
          IF       COPTION=2
            WRITE    HTMLFILE;"Emergency";
          ENDIF
          GOTO     EMRCHK99
.
          INC      EMRVISIO/INC
          INC      EMRLOCIO/INC
          INC       IBAOVRIO/INC
.
EMRCHK99  ENDPROC
+
.*****************************************************************************
.*  GETALTID
.*  Procedure to get an alternate ID
.*  Exit=0  No alternate ID
.*       1  Alternate ID's exist
.*****************************************************************************
          DEFPROC   GETALIDS
.
          INC       PMSAIDFD/INC
.
          MOVE      ZERO,EXIT
          PACK      KEY20,SP70
          OPEN      PMSAIDA1,"pmsaidaf"
.
          PACK      KEY31,PURNO,SP70
          CALL      RSPMAID1           * Read alternate id Table
GETALI10  CALL      RKPMAID1
          BRANCH    OVRCD,GETALI99
.
          MATCH     PURNO,PMAIURNO     * Check same UR
          GOTO      GETALI99 IF NOT EQUAL
.
          MATCH     "1",PMAIDISU
          GOTO      GETALI10 IF NOT EQUAL
.
          PACK      KEY20,PMAIALID,SP70
          MOVE      ONE,EXIT
          GOTO      GETALI99
.
          INC       PMSAIDIO/INC
          INC       IBAOVRIO/INC
.
GETALI99  CLOSE     PMSAIDA1
.
          ENDPROC
.
PRTIPROV  RETURN
.
.*****************************************************************************
.         Get Service doctor for Emergency items grouped by Service doctor
.*****************************************************************************
GSDC0000  PACK      KEY31,PINVADM,PINVNO,SP70
          CALL      RDSDTRE3
GSDC1000  CALL      RDKDTRE3
          BRANCH    OVRCD,GSDC9999
          MATCH     PINVADM,ADANUMB
          GOTO      GSDC9999 IF NOT EQUAL
          MATCH     PINVNO,ATINVNO               * Check if Same Invoice
          GOTO      GSDC9999 IF NOT EQUAL
.
          MATCH     SP70,ATDTEDAD
          GOTO      GSDC1000 IF EQUAL
.
          MOVE      ATDTEDAD,SERVDOCT            * get service doctor
GSDC9999  RETURN
+
          INC       PATSELFN
          INC       PATHSPKY
          INC       PATDOCCD
          INC       VALCMXFN
          INC       VALCONTR
          INC       GETCNEFF
          INC       PATCODKY
          INC       PATFNDKY
          INC       SEXDSCIO
.
          INC       PATANVS            *** ALREADY INVOICED
          INC       PATCATAI           *** ALREADY INVOICED
          INC       PRTINVBD
          INC       PATINVHL                * templated invoice header
          INC       PATINVTL                * templated invoice tail
          INC       PATGBCRN                * I-48227 BPAY Reference No.
	  INC       CLPATDTR
          INC       SEXDSP00
.
          INC       EMRHISIO/INC
          INC       EMRVISIO/INC
          INC       IBATMDIO/INC
          INC       IBATMHIO/INC
          INC       IBAGSTIO/INC
          INC       COMDEPIO/INC
.
          INC       PATCMXIO/INC
          INC       PATAFEIO/INC       * for casemix
          INC       PATASDIO/INC
          INC       PATHDFIO/INC
          INC       PATHLFIO/INC
          INC       PATLDFIO/INC
          INC       PATLSDIO/INC
.
          INC       NHIMASIO/INC
          INC       PMSCIDIO/INC
          INC       PATCRAIO/INC
          INC       PATDO1IO/INC
          INC       PATWR1IO/INC
          INC       PATCODIO/INC
          INC       PATIBLIO/INC
          INC       PATMA1IO/INC
          INC       PMSEVTIO/INC
          INC       PMSHCPIO/INC
          INC       PMSPX2IO/INC
          INC       PATRE1IO/INC
          INC       PATFN1IO/INC
          INC       PATFX1IO/INC
          INC       PATCFAIO/INC
          INC       PATHSPIO/INC
          INC       PATHFRIO/INC          *** health fund INVOICING
          INC       PATINVIO/INC
          INC       PATIN1IO/INC
          INC       PATDTRIO/INC
          INC       PATREMIO/INC
          INC       OUTDTRIO/INC
          INC       OUTCTYIO/INC
          INC       RCPBDTIO/INC
          INC       RCPCRSIO/INC
          INC       OPRDEAIO/INC
          INC       AAEDTRIO/INC
          INC       PATTRNIO/INC
          INC       PMSMTIIO/INC
          INC       PMSEXTIO/INC
          INC       PMSPRGIO/INC
          INC       PMSTLEIO/INC
          INC       PATVISIO/INC
          INC       PATWC1IO/INC
          INC       PATWMAIO/INC
          INC       PATWVEIO/INC
          INC       PATIJRIO/INC
          INC       IBAPRNIO/INC
.
          INC       RCPBNKIO/INC
          INC       RCPDTEIO/INC
.
          INC       IBAPRINT
          INC       GETALTID
          INC       NAMSTRCD
          INC       PRNTICDC
          INC       IBASECIO/INC
          INC       IBAGEDIO/INC
          INC       PATDSCIO/INC
          INC       PATECDIO/INC
          INC       PATMI1IO/INC
          INC       MLTCFNIO/INC
          INC       OUTCLIIO/INC
          INC       OUTBB1IO/INC
          INC       OUTSITIO/INC
          INC       OPRARDIO/INC
          INC       AAEDE1IO/INC
          INC       AAEDI1IO/INC
          INC       PATNIDIO/INC
          INC       PATITMIO/INC
          INC       PATICDIO/INC
          INC       PMSCNOIO/INC
          INC       PMSFCIIO/INC
          INC       PMSPYRIO/INC
          INC       PMSVX1IO/INC
          INC       NZPIVBIO/INC
          INC       NZPCFNIO/INC
          INC       NZPSPRIO/INC
          INC       NZPRDTIO/INC
          INC       NZPMCHIO/INC
          INC       NZPMXCIO/INC
          INC       PATITMRD
          INC       STD001IO
.............................................................................

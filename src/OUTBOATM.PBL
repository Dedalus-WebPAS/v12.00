.------------------------------------------------------------
. Outpatient Booking Field
.------------------------------------------------------------
. V12.00.01 23/05/2025  Ebon Clements   TSK 0955096
.           Alphanueric visit number changes
. V11.05.02 20.12.2024 DA Sarkies      TSK 0954547
.           Commented out <cat> tags to prevent browser incompatibility
. V11.05.01 26.11.2024  Ebon Clements  Task 0954547
.           Added <cat-c> start and end tag to category=XX tag
. V11.02.02 29.03.2022 DA Sarkies      TSK 0905641
.           Added cgi variables for additional HCP            
. V11.02.01 09/02/2022 Thanh T         TSK 0905641
.           Added Additional HCP Code (1-4) for outbb1af      
. V10.15.01 23/10/2019  Ebon Clements    TSK 0308709
.           Added Clinic type linked visit type functionality - VISSEL00
.------------------------------------------------------------
. V10.14.03 18/07/2019  Ebon Clements   TSK 0877629
.           Added don't show audit option to VICMNF00 tag - OBOX2300
. V10.14.02 27/05/2019  Ebon Clements   TSK 0870183
.           Get rescheduled appointment clinic type from outhedaf - APPTSU00
. V10.14.01 21/03/2019  Tracey Nguyen  TSK 0838668
.           Added CHARTREV in APPTSU00
.------------------------------------------------------------
. V10.13.02  05/10/2018  Thanh T       TSK 0859743
.            Added OTBBBKOV/OBOX1800 OTBBBKPR/OBOX1900
.                  OTBBBKPM/OBOX2000 OTBBBKBA/OBOX2100
.                  OTBBRDAT/OBOX2200   
. V10.13.01 30/07/2018  Don Nguyen     TSK 0847735
.           Added OBOX1700 - Clinic Group (Cat CG) code output
.------------------------------------------------------------
. V10.12.05 05/07/2018  Thanh T        TSK 0857684
.           Changed to display Occupational Group Desc instead of code in
.           Comments field
. V10.12.01 29/06/2018  Ebon Clements  TSK 0859680
.           Display booking comments newest first - OBOA7700
.------------------------------------------------------------
. V10.11.02 14/03/2018  Richa Phogat   TSK 0853461
.           Removed count from OCANTB00 to display complete list of Cancelled 
.           appiontments
. V10.11.03 30/11/2017  Thanh T.       TSK 0821710
.           Audit Amission/outpatient visit comments
. V10.11.02 11/09/2017  Thanh T.       TSK 0821710
.           Audit Amission/outpatient visit comments
. V10.11.01 08/08/2017  Thanh T.       TSK 0821710
.           Audit Amission/outpatient visit comments
.------------------------------------------------------------
. V10.08.01 05/10/2016  Ebon Clements  TSK 0304330
.           Added health fund/table tags to OBOX0000
. V10.06.02 11/08/2015  Peter Vela     CAR 319532
.           Added slot template location to APPTAB00
. V10.06.01 30/04/2015  Don Nguyen     CAR 314266
.           Modified OBOA3300; cleaned up and added test for Indicator 1
. V10.05.07 02/03/2015  Ebon Clements  CAR 311848
.           Fixed display of cancelled appointment hospital if the
.           session has also been cancelled. - OCANTB00
. V10.05.06 24/02/2015  Don Nguyen     CAR 303885
.           Modified APPTAB00 to output PTHSNAME - Hospital Name
. V10.05.05 14/11/2014  Ebon Clements  CAR 292656
.           Added appointment comments to cancellation list - OCANTB00
. V10.05.04 21/10/2014  Ebon Clements  CAR 268970
.           Change to use OUTCLIFD index 1 instead of index 2
. V10.05.03 20/08/2014  Ania P           CAR 303879
.           Corrected missing ; in OBOX1300.
. V10.05.02 18/08/2014  Ania P           CAR 303879
.           Added output for OTBBPURC
. V10.05.01 16/07/2014  Ebon Clements    CAR 251384
.           Added OTBBTCOD tier 2 code tag - OBOX0000
. V10.04.01 27/03/2014  Ebon Clements    CAR 227351
.           List all reschedules for a cancelled appointment - OCANTB00
. V10.03.05 20/05/2013  Don Nguyen       CAR 285199
.           Added OBOX1100 - Outpatients Clinic ID/Description (site-based)
. V10.03.04 05/12/2012 Peter Vela        CAR 262297
.           Added CANCOM00 to HATB0000
. V10.03.03 06/03/2012 Peter McMullen    CAR 250154
.           Added tag for user fields OBOUSRx (1 through 8)
. V10.03.02 29/02/2012 Ebon Clements  CAR 209358
.           Added rescheduled by date and time to reschedule alert - APPTSU76
. V10.03.01 20/11/2011 Nicole Torrisi CAR 240817
.           Changed OBOA3300 to only default to active Reschedule Reason codes
. V10.02.03 13/07/2011 Ebon Clements CAR 242246
.           Added display hospital id option to cancelled appt list - OCANTB00
. V10.02.02 24/06/2011 Ebon Clements CAR 242246
.           Added OTBBNMDS to OTBBCLHR
. V10.02.01 20/05/2011 Ebon Clements     CAR 239554
.           Added OTBBGLDT and OTBBSNGL
. V10.00.02 22/07/2010 Ebon Clements     CAR 85133 
.           Added rescheduled column to cancelled appointment list - OCANTB00
. V10.00.01 03/06/2010  Ebon Clements  CAR 208220
.           Added comment icon link to APPTSU00
. V9.12.02  13/01/2010  Jill Parkinson CAR 211158
.           Mods to not select inactive codes in DEFC0000
. V9.12.01  26/08/2009  Peter McMullen CAR 171901
.                       remove MAPCAT00 call
. V9.09.01  29/10/2007  Ebon Clements     CAR 153567
.           Added multi hospital test to VISSEL00
. V9.05.01  23/03/2006  Ebon Clements     CAR 79277
.           Added OTBBSCAR 
. V9.05.B01 20/02/2006  Ebon Clements     CAR 76341
.           Added referral and encounter file audit 
. V9.04.02  03/08/05 J.Tan    CAR 62750   
.           Removed redefined amount variables
. V9.04.02  29/07/2005  J.Tan          CAR 69403
.           Fixed Actual doctor seen to validate using HCP (instead of patdoct)
. V9.04.01  11/02/2005  Mike Laming              CAR 48413
.           Add Cancellation Comments free text field using "viscmtaf"
. V9.03.05  26/07/2004  Peter Vela     CAR 51304
.           Added Date, Time and Reason to Rescheduled pop up box in Table
.           of Appointments APPTSU00
. V9.03.04  14/07/2004  Peter Vela     CAR 51518
.           Added Operator column in Cancelled Appointments table
.           outweb0203015.html and outweb0203017.html
. V9.03.03  07/11/2003  Ebon Clements  CAR 43484
.           Changed OBOA7700 to format comments the same as OBOA7500
. V9.03.02  08/07/2003  Ebon Clements  CAR 40633
.           Mods to visit type selection list to allow for over bookings.
. V9.03.01  02/07/2003  Ebon Clements  CAR 40874
.           Added OTBBFLUP to TAG OBOA2800 as it was not used
. V9.02.19  24/02/2003  Sylvek Litewka CAR 36688
.           Modified procedure CLOUTBOA to MOVE ZEROUR to OBAURNO instead of
.           SP70.
. V9.02.18  07/12/2002  Lina Vo        SRF 22709
.           Open outcanaf with site prefix                               
. V9.02.17  13/11/2002  Sylvek Litewka SRF 22721
.           Modified OBOA7000 to obtain Category Code from "outsipaf.dat"
.           file for given site code.
.           Fixed Display for User Defined Time (OBOA7400). 
. V9.02.16  23/08/2002  Ebon Clements SRF 17673
.           Added VISTFLAG to visit type selection list for selection of 
.           unavailable visit types.
. V9.02.15  01/05/2002  Ebon Clements
.           Added LINK2PRT details to OCANTB00 for update Appointment      
.           Cancellation details  
. V9.02.14  04/03/2002  Ebon Clements
.           Added default of cliam code to public in DEFC0000 if no default  
. V9.02.13  28/02/2002  Ebon Clements
.           Removed definition of CFILEPRE so it gets the value from OUTWEB02 
. V9.02.12  25/02/2002  Ebon Clements
.           Added a new tag for a default claim code. It will default to the
.           claim code of the patients last visit.
. V9.02.11  29/01/2002  Ebon Clements
.           Fixed reads on the clinic table for clinic discription display
. V9.02.10  12/11/2001  B.G.Ackland
.           Fix Cancelled Appointments Table
. V9.02.09  31/10/2001  BGA
.           Fixed Clinic Description Display
. V9.02.08  26/10/2001  BGA
.           Fixed O/P problems
. V9.02.07  23.10.2001 B.G.Ackland
.           Change Day Name to 3 characters
. V9.02.06  13.10.2001 Raghu - HPS
.           Fixed Visit Type options to exclude "N" codes, 
.           Fixed clear referral source if indicator is Yes.
. V9.02.05  21.09.2001 Ashwin - HPS
.           Fixed routine APPSMS00 to display appointment time instead of 
.           clinic start time in Appointment update summary screen
. V9.02.04  17.09.2001 Sai,Jagath - HPS
.           Fixed for location type in outweb0203001 html,Fixed for Clinic type
. V9.02.03  08.09.2001 Ashwin,Sai -HPS
.    Added tag for Preferred Language,Changed for appointment summary APPTSU00
. V9.02.02  24.08.2001 HPS
.           Changes made for Preferred language 3 in routine OBOA8900
. V9.02.01  20.08.2001 HPS-ODC
.           Changes made for Bug Fixing - Nos 169 177 185 193 195 196 198 200
.                                         and OffShore Raised Defects
. B.G.Ackland 10.04.2001 
. Fixed OBOA1300 to Ignore if No Valid Key Identified
.------------------------------------------------------------
       
OBOA0000  BRANCH    FLDITMNO,OBOA0100,OBOA0200,OBOA0300,OBOA0400,OBOA0500:
                             OBOA0600,OBOA0700,OBOA0800,OBOA0900,OBOA1000:
                             OBOA1100,OBOA1200,OBOA1300,OBOA1400,OBOA1500:
                             OBOA1600,OBOA1700,OBOA1800,OBOA1900,OBOA2000:
                             OBOA2100,OBOA2200,OBOA2300,OBOA2400,OBOA2500:
                             OBOA2600,OBOA2700,OBOA2800,OBOA2900,OBOA3000:
                             OBOA3100,OBOA3200,OBOA3300,OBOA3400,OBOA3500:
                             OBOA3600,OBOA3700,OBOA3800,OBOA3900,OBOA4000:
                             OBOA4100,OBOA4200,OBOA4300,OBOA4400,OBOA4500:
                             OBOA4600,OBOA4700,OBOA4800,OBOA4900,OBOA5000:
                             OBOA5100,OBOA5200,OBOA5300,OBOA5400,OBOA5500:
                             OBOA5600,OBOA5700,OBOA5800,OBOA5900,OBOA6000:
                             OBOA6100,OBOA6200,OBOA6300,OBOA6400,OBOA6500:
                             OBOA6600,OBOA6700,OBOA6800,OBOA6900,OBOA7000:
                             OBOA7100,OBOA7200,OBOA7300,OBOA7400,OBOA7500:
                             OBOA7600,OBOA7700,OBOA7800,OBOA7900,OBOA8000:
                             OBOA8100,OBOA8200,OBOA8300,OBOA8400,OBOA8500:
                             OBOA8600,OBOA8700,OBOA8800,OBOA8900,OBOA9000:
                             OBOA9100,OBOA9200,OBOA9300,OBOA9400,OBOA9500:
                             OBOA9600,OBOA9700,OBOA9800,OBOA9990
.                                           *** HPS Code Ends Here ***
. Additional tags are available at OBOA2700                               
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      OBOA9999
.
OBOA0100  REP       " +",CASEKEYS
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          WRITE     HTMLFILE;LINKPRG,".pbl?reportno=",LINKREP:
                                 "&template=",LINKTEM:
                                 "&casekeys=",CASEKEYS;
          REP       "+ ",CASEKEYS
          GOTO      OBOA9999
.
OBOA0200  MOVE      OBASITE,KEY6
          CALL      RDSITA1
          IF        OVRCD=0
            WRITE     HTMLFILE;OSTDESC;
          ENDIF 
          GOTO      OBOA9999
.
OBOA0300  UNPACK    DIM127,D1,ANS,DIM127
          MATCH     SP70,OBADATE
          IF        @EQUAL
            PACK      KEY20,OBASITE,OBACLIN,Z70
          ELSE
            PACK      KEY20,OBASITE,OBACLIN,OBADATE,Z70
          ENDIF
.
          CALL      RDCLIA1
          IF        OVRCD = 0
            CALL      RDKCLIA1            * Read Clinic Record
            GOTO      OBOA0301          
          ENDIF
.
          CALL      RDSCLIA1              * Position read not a full key
OBOA0301  CALL      RDPCLIA1              * Read Clinic Record
          BRANCH    OVRCD,OBOA9999
.
          MATCH     OCASITE,OBASITE
          GOTO      OBOA9999 IF NOT EQUAL
.
          MATCH     OCACLIN,OBACLIN
          GOTO      OBOA9999 IF NOT EQUAL
.
          MOVE      ANS,F1
          BRANCH    F1,OBOA0310
          WRITE     HTMLFILE;OCACLIN;
          GOTO      OBOA9999
.
OBOA0310  WRITE     HTMLFILE;OCADESC;
          GOTO      OBOA9999
.
OBOA0400  MATCH     SP70,OBADATE
          GOTO      OBOA9999 IF EQUAL
          UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OBOA9999
.
OBOA0500  MATCH     SP70,OBASTRT
          GOTO      OBOA9999 IF EQUAL
          WRITE     HTMLFILE;OBASTRT;
          GOTO      OBOA9999
.
OBOA0600  WRITE     HTMLFILE;OBASLOT;
          GOTO      OBOA9999
.
OBOA0700  MATCH     SP70,OTBBDPTM
          GOTO      OBOA9999 IF EQUAL
          WRITE     HTMLFILE;OTBBDPTM;
          GOTO      OBOA9999
.
OBOA0800  MATCH     SP70,OBACTYP
          GOTO      OBOA9999 IF EQUAL
          WRITE     HTMLFILE;OBACTYP;
          GOTO      OBOA9999
.
OBOA0900  MATCH     SP70,OBAURNO
          GOTO      OBOA9999 IF EQUAL
          WRITE     HTMLFILE;OBAURNO;
          GOTO      OBOA9999
.
OBOA1000  MOVE      "CV",CATEGORY
          MOVE      OBAVISIT,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA1100  WRITE     HTMLFILE;OBAOUTNO;
          GOTO      OBOA9999
.
OBOA1200  BRANCH    OBASTAT,OBOA1210,OBOA1220,OBOA1230,OBOA1240,OBOA1250:
                            OBOA1260
          WRITE     HTMLFILE;"Not Booked";
          GOTO      OBOA9999
OBOA1210  WRITE     HTMLFILE;"Booked";
          GOTO      OBOA9999
OBOA1220  WRITE     HTMLFILE;"Not Used";
          GOTO      OBOA9999
OBOA1230  WRITE     HTMLFILE;"Extended Slot";
          GOTO      OBOA9999
OBOA1240  WRITE     HTMLFILE;"Attended";
          GOTO      OBOA9999
OBOA1250  WRITE     HTMLFILE;"No Attendance";
          GOTO      OBOA9999
OBOA1260  WRITE     HTMLFILE;"Suspended";
          GOTO      OBOA9999
.
OBOA1300  MATCH     SP70,OBASTRT
          GOTO      OBOA9999 IF EQUAL
          LOAD      DAYNAM3,OBADAY,MON,TUE,WED,THU,FRI,SAT,SUN
          WRITE     HTMLFILE;DAYNAM3;
          GOTO      OBOA9999
.
OBOA1400  WRITE     HTMLFILE;OBAEXSL;
          GOTO      OBOA9999
.
OBOA1500  WRITE     HTMLFILE;OBAFINST;
          GOTO      OBOA9999
.
OBOA1600  MATCH     SP70,OBATIME
          GOTO      OBOA9999 IF EQUAL
          WRITE     HTMLFILE;OBATIME;
          GOTO      OBOA9999
.
OBOA1700  UNPACK    OBABKDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OBOA9999
.
OBOA1800  MOVE      "CS",CATEGORY
          MOVE      OBASESST,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA1900  MOVE      "DO",CATEGORY
          MOVE      OBADISCH,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA2000  PACK      KEY6,WBSESIT,SP70
          CALL      RDSITA1
          BRANCH    OVRCD,OBOA9999 
.
          MOVE      OSTCATG,CATEGORY
          MOVE      OBASRCR,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA2100  MOVE      "CL",CATEGORY
          MOVE      OBACOMP,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA2200  MOVE      "A ",CATEGORY
          MOVE      OBACLASS,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA2300  MOVE      "U1",CATEGORY
          MOVE      OBAINS,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA2400  MOVE      "CA",CATEGORY
          MOVE      OBAATTN,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA2500  MOVE      OBADOCT,DOCTCODE
          CALL      DOCDET00
          GOTO      OBOA9999
.
OBOA2600  WRITE     HTMLFILE;OBACOMM;
          GOTO      OBOA9999
.
OBOA2700  UNPACK    DIM127,D1,KEY3,DIM127   * OUTWEBXX.XX.X27.XXX
          MOVE      KEY3,FLDITMNO
          CALL      OBOX0000                * additional fieldset of tags
          GOTO      OBOA9999
.
OBOA2800  WRITE     HTMLFILE;OTBBFLUP;
          GOTO      OBOA9999
.
OBOA2900  MOVE      "CV",CATEGORY
          MOVE      OBAVISIT,CODE
          MOVE      THREE,VISTFLAG
          CALL      VISSEL00
          GOTO      OBOA9999
.
OBOA3000  UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OBOA9999
.
OBOA3100  MOVE      "P ",CATEGORY
          MOVE      OBACAT,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA3200  MOVE      "PR",CATEGORY
          MOVE      OBAPRTY,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA3300  PACK      CODE,SP70
          MOVE      "RR",CATEGORY
.
          PACK      KEY5,CATEGORY,OBARSCHD,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,OBOA3310
.
          MATCH     "I",PTCOACTV
          GOTO      OBOA3310 IF EQUAL       * don't default to an inactive code
.
          MATCH     "D",TCINDC1
          GOTO      OBOA3310 IF EQUAL       * don't default if indc1=D
.
          MOVE      OBARSCHD,CODE
.
OBOA3310  CALL      CODITM00
          GOTO      OBOA9999
.
OBOA3400  WRITE     HTMLFILE;OBBBOOK;
          GOTO      OBOA9999
.
OBOA3500  WRITE     HTMLFILE;OBBCTYP;
          GOTO      OBOA9999
.
OBOA3600  MOVE      "O1",CATEGORY
          MOVE      OBOUSR1,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA3700  MOVE      "O2",CATEGORY
          MOVE      OBOUSR2,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA3800  MOVE      "O3",CATEGORY
          MOVE      OBOUSR3,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA3900  MOVE      "O4",CATEGORY
          MOVE      OBOUSR4,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA4000  MATCH     SP70,OBALADMN
          IF        !@EQUAL
            WRITE     HTMLFILE;OBALADMN;
          ENDIF
          GOTO      OBOA9999
.
OBOA4100  MOVE      "AC",CATEGORY
          MOVE      OTBBDEPT,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA4200  MOVE      "OB",CATEGORY
          MOVE      OTBBTRAN,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA4300  MOVE      "OL",CATEGORY             
          MOVE      OTBBLNGI,CODE            
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA4400  MATCH     SP70,OTBBTMFS
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBTMFS;
          ENDIF
          GOTO      OBOA9999
.
OBOA4500  MATCH     SP70,OTBBTMBO
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBTMBO;
          ENDIF
          GOTO      OBOA9999
.
OBOA4600  MATCH     SP70,OTBBGPFA
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBGPFA;
          ENDIF
          GOTO      OBOA9999
.
OBOA4700  MATCH     SP70,OTBBECRA
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBECRA;
          ENDIF
          GOTO      OBOA9999
.
OBOA4800  PACK      GENPCODE,OTBBRFGP,SP70
          CALL      HCPDET00
          GOTO      OBOA9999
.
OBOA4900  MATCH     SP70,OTBBGPPC
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBGPPC;
          ENDIF
          GOTO      OBOA9999
.
OBOA5000  PACK      GENPCODE,OTBBADCS,SP70
          CALL      HCPDET00
          GOTO      OBOA9999
.
OBOA5100  MATCH     SP70,OTBBCITM
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBCITM;
          ENDIF
          GOTO      OBOA9999
.
OBOA5200  MATCH     SP70,OTBBASTM
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBASTM;
          ENDIF
          GOTO      OBOA9999
.
OBOA5300  MATCH     SP70,OTBBDPTM
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBDPTM;
          ENDIF
          GOTO      OBOA9999
.
OBOA5400  MOVE      "OZ",CATEGORY
          MOVE      OTBBOUTC,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA5500  MATCH     SP70,OTBBSNDL
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBSNDL;
          ENDIF
          GOTO      OBOA9999
.
OBOA5600  MATCH     SP70,OTBBGPPT
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBGPPT;
          ENDIF
          GOTO      OBOA9999
.
OBOA5700  MOVE      "DA",CATEGORY
          MOVE      OTBBDOFR,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA5800  MATCH     SP70,OTBBOPER
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBOPER;
          ENDIF
          GOTO      OBOA9999
.
OBOA5900  MOVE      "O5",CATEGORY
          MOVE      OBOUSR5,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA6000  MOVE      "O6",CATEGORY
          MOVE      OBOUSR6,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA6100  MOVE      "O7",CATEGORY
          MOVE      OBOUSR7,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA6200  MOVE      "O8",CATEGORY
          MOVE      OBOUSR8,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA6300  MATCH     SP70,OTBBRANK
          IF        !@EQUAL
            WRITE     HTMLFILE;OTBBRANK;
          ENDIF
          GOTO      OBOA9999
.
OBOA6400  MATCH     SP70,OPDICODE
          IF        !@EQUAL
            WRITE     HTMLFILE;OPDICODE;
          ENDIF
          GOTO      OBOA9999
.
OBOA6500  MATCH     SP70,OPDIDESC
          IF        !@EQUAL
            WRITE     HTMLFILE;OPDIDESC;
          ENDIF
          GOTO      OBOA9999
.
OBOA6600  WRITE     HTMLFILE;CASEKEYS;
          GOTO      OBOA9999
.
OBOA6700  MATCH     SP70,OTBCRDAT
          GOTO      OBOA9999 IF EQUAL
.
          UNPACK    OTBCRDAT,CCENT,CYEAR,CMON,CDAY                             
          MOVE      CMON,F2                                                    
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC 
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;                 
          GOTO      OBOA9999
.
OBOA6800  MATCH     SP70,NEWSLOTK
          IF        !@EQUAL
            WRITE     HTMLFILE;NEWSLOTK;
          ENDIF
          GOTO      OBOA9999
.
. User Defined Date 1 to 6 
.   %OUTWEB02.05.369.1 = User Def Date 1
.
OBOA6900  UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          COMPARE   ZERO,F1
          GOTO      OBOA9999 IF EQUAL
          MOVE      SP70,KEY8
          LOAD      KEY8,F1,OTXSDTE1,OTXSDTE2,OTXSDTE3,OTXSDTE4,OTXSDTE5:
                            OTXSDTE6
          MATCH     SP70,KEY8
          GOTO      OBOA9999 IF EQUAL
          UNPACK    KEY8,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OBOA9999
.
.   .(User Def Code No).(Display Type)
.   %OUTWEB02.05.370.01.2 = User Def Code 01 Select List 
.   %OUTWEB02.05.370.02.2 = User Def Code 02 Select List
.   Category Code is obtained from the "outsipaf.dat" file
.
OBOA7000  PACK      KEY6,OBASITE,SP70
          CALL      RDOTSIP1           * Read Site Specific Category Codes
          BRANCH    OVRCD,OBOA9999
.
          UNPACK    DIM127,D1,KEY2,DIM127
          MOVE      ZERO,F2
          MOVE      KEY2,F2
          MOVE      SP70,CATEGORY
          LOAD      CATEGORY,F2,OTSPXC01,OTSPXC02,OTSPXC03,OTSPXC04,OTSPXC05:
                                OTSPXC06,OTSPXC07,OTSPXC08,OTSPXC09,OTSPXC10:
                                OTSPXC11,OTSPXC12,OTSPXC13,OTSPXC14,OTSPXC15:
                                OTSPXC16,OTSPXC17,OTSPXC18,OTSPXC19,OTSPXC20
          MOVE      SP70,CODE
          LOAD      CODE,F2,OTXSCO01,OTXSCO02,OTXSCO03,OTXSCO04,OTXSCO05:
                            OTXSCO06,OTXSCO07,OTXSCO08,OTXSCO09,OTXSCO10:
                            OTXSCO11,OTXSCO12,OTXSCO13,OTXSCO14,OTXSCO15:
                            OTXSCO16,OTXSCO17,OTXSCO18,OTXSCO19,OTXSCO20
          CALL      CODITM00
          GOTO      OBOA9999
.
. User Defined Doctor 1 to 3
.   %OUTWEB02.05.371.2 = User Def Doctor 2
.
OBOA7100  UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          MOVE      SP70,DOCTCODE
          LOAD      DOCTCODE,F1,OTXSDOC1,OTXSDOC2,OTXSDOC3
          CALL      DOCDET00
          GOTO      OBOA9999
.
. User Defined Amount 1 to 2
.   %OUTWEB02.05.372.2 = User Amount 2
.
OBOA7200  UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          COMPARE   ZERO,F1
          GOTO      OBOA9999 IF EQUAL
          MOVE      ZERO,F12P2
          LOAD      F12P2,F1,OTXSAMT1,OTXSAMT2
          WRITE     HTMLFILE;F12P2;
          GOTO      OBOA9999
.
. User Defined Free Format Reference 1 to 6
.   %OUTWEB02.05.372.6 = User Defined Ref 6
.
OBOA7300  UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          COMPARE   ZERO,F1
          GOTO      OBOA9999 IF EQUAL
          MOVE      SP70,KEY40
          LOAD      KEY40,F1,OTXSDSC1,OTXSDSC2,OTXSDSC3,OTXSDSC4,OTXSDSC5:
                             OTXSDSC6
          WRITE     HTMLFILE;KEY40;
          GOTO      OBOA9999
.
. User Defined Time 1 to 6
.   %OUTWEB02.05.374.1 = User Defined Time 1 to 6
.
OBOA7400  UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          COMPARE   ZERO,F1
          GOTO      OBOA9999 IF EQUAL
          MOVE      SP70,KEY5
          LOAD      KEY5,F1,OTXSTIM1,OTXSTIM2,OTXSTIM3,OTXSTIM4,OTXSTIM5:
                            OTXSTIM6
          WRITE     HTMLFILE;KEY5;
          GOTO      OBOA9999
.
OBOA7500  PACK      KEY12,OBAOUTNO
          CALL      RSOTXWP1
OBOA7510  CALL      RKOTXWP1
          BRANCH    OVRCD,OBOA9999
.
          MATCH     OTXWOUTN,OBAOUTNO
          GOTO      OBOA9999 IF NOT EQUAL
.
          STRIP     OTXWDESC
          MOVELPTR  OTXWDESC,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      OTXWDESC,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,127
          GOTO      OBOA7510
.
OBOA7600  CALL      APPTAB00
          GOTO      OBOA9999
.
OBOA7700  MOVE      ZERO,F1                 * Show audit details
          CALL      VICMNF00
          GOTO      OBOA9999
.
OBOA7800  MOVE      "SA",CATEGORY
          MOVE      OTBBSPCA,CODE
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA7900  MATCH     SP70,OPDICOD2           ***HPS Code Starts Here***
          IF        !@EQUAL
            WRITE     HTMLFILE;OPDICOD2;
          ENDIF
          GOTO      OBOA9999
.
OBOA8000  MATCH     SP70,OPDIDES2
          IF        !@EQUAL
            WRITE     HTMLFILE;OPDIDES2;
          ENDIF
          GOTO      OBOA9999
.
OBOA8100  MATCH     SP70,OPDICOD3
          IF        !@EQUAL
            WRITE     HTMLFILE;OPDICOD3;
          ENDIF
          GOTO      OBOA9999
.
OBOA8200  MATCH     SP70,OPDIDES3
          IF        !@EQUAL
            WRITE     HTMLFILE;OPDIDES3;
          ENDIF
          GOTO      OBOA9999
.
OBOA8300  MATCH     SP70,OPDICOD4
          IF        !@EQUAL
            WRITE     HTMLFILE;OPDICOD4;
          ENDIF
          GOTO      OBOA9999
.
OBOA8400  MATCH     SP70,OPDIDES4
          IF        !@EQUAL
            WRITE     HTMLFILE;OPDIDES4;
          ENDIF
          GOTO      OBOA9999
.
OBOA8500  MATCH     SP70,OPDICOD5
          IF        !@EQUAL
            WRITE     HTMLFILE;OPDICOD5;
          ENDIF
          GOTO      OBOA9999
.
OBOA8600  MATCH     SP70,OPDIDES5
          IF        !@EQUAL
            WRITE     HTMLFILE;OPDIDES5;
          ENDIF
          GOTO      OBOA9999
.
OBOA8700  MOVE      ZERO,LINK2PRT
          MOVE      ZERO,SHOWHOSC
          CALL      OCANTB00                * Show Hospital - No
          GOTO      OBOA9999
.
OBOA8800  CALL      APPTSU00
          GOTO      OBOA9999
.
OBOA8900  MOVE      ZERO,OVRCD
          PACK      KEY8,URNUMBER,SP70      * changing for BUG/CR 47
          CALL      RDPMPX21                * Read the file pmspx2af(PMSPX2FD)
          MATCH     "1",PMPXINTR
          GOTO      OBOA9999 IF NOT EQUAL
.
          MATCH     SP70,PMPXLNG1
          IF        @EQUAL
            MOVE      SP70,TDESC
            WRITE     HTMLFILE;TDESC;
          ELSE 
            MOVE      "LA",CATEGORY           * write first language
            MOVE      PMPXLNG1,CODE
            PACK      KEY5,CATEGORY,CODE,SP70
            CALL      RDCODE1         
            WRITE     HTMLFILE;TDESC;
          ENDIF
.                                           * write second language
          MATCH     SP70,PMPXLNG2
          IF        @EQUAL
            MOVE      SP70,TDESC
            WRITE     HTMLFILE;TDESC;
          ELSE
            MOVE      "LA",CATEGORY
            MOVE      PMPXLNG2,CODE
            PACK      KEY5,CATEGORY,CODE,SP70
            CALL      RDCODE1         
            IF        OVRCD = 0
              WRITE     HTMLFILE;"-"
              WRITE     HTMLFILE;TDESC;
            ENDIF
          ENDIF
.                                           * write third language
          MATCH     SP70,PMPXLNG3
          IF        @EQUAL
            MOVE      SP70,TDESC
            WRITE     HTMLFILE;TDESC;
          ELSE 
            MOVE      "LA",CATEGORY
            MOVE      PMPXLNG3,CODE
            PACK      KEY5,CATEGORY,CODE,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              WRITE     HTMLFILE;"-"
              WRITE     HTMLFILE;TDESC;
            ENDIF
          ENDIF 
          GOTO      OBOA9999
.
OBOA9000  WRITE     HTMLFILE;OTBBRFGP;
          GOTO      OBOA9999 
.
OBOA9100  CALL      APPSMS00                * HPS-ODC Code Added (Fix 91-94)
          GOTO      OBOA9999
.
OBOA9200  WRITE     HTMLFILE;DOCFNAME;
          GOTO      OBOA9999
.
OBOA9300  MOVE      ZERO,OVRCD
          PACK      KEY8,URNUMBER,SP70      
          CALL      RDPMPX21                * Read the file pmspx2af(PMSPX2FD)
          MATCH     "1",PMPXINTR
          GOTO      OBOA9999 IF NOT EQUAL
.
          MATCH     SP70,PMPXLNG1
          IF        @EQUAL
            MOVE      SP70,TDESC
            WRITE     HTMLFILE;TDESC;
          ELSE
            MOVE      "LA",CATEGORY           * write first language
            MOVE      PMPXLNG1,CODE
            PACK      KEY5,CATEGORY,CODE,SP70
            CALL      RDCODE1
            WRITE     HTMLFILE;TDESC;
          ENDIF
          GOTO      OBOA9999
.
OBOA9400  MOVE      "CV",CATEGORY
          MOVE      OBAVISIT,CODE
          MOVE      TWO,VISTFLAG
          CALL      VISSEL00 
          GOTO      OBOA9999 
.
OBOA9500  PACK      KEY6,WBSESIT,SP70
          CALL      RDSITA1
          BRANCH    OVRCD,OBOA9999
.
          MOVE      OSTCATG,CATEGORY
          MOVE      SP70,CODE
          COMPARE   "1",OTCNCSRR
          IF        @EQUAL
            MOVE      OBASRCR,CODE
          ENDIF
          CALL      CODITM00
          GOTO      OBOA9999
.
OBOA9600  MOVE      "CI",CATEGORY
          MOVE      OTBBCIND,CODE
          MATCH     SP70,CODE
          IF        @EQUAL
            MOVE      OMACIND,CODE
          ENDIF
          CALL      CODITM00 
          GOTO      OBOA9999 
.
OBOA9700  PROC      DEFC0000                * Get default claim code
          GOTO      OBOA9999
.
OBOA9800  MOVE      ONE,LINK2PRT
          MOVE      ZERO,SHOWHOSC           * Show Hospital - No
          CALL      OCANTB00
          GOTO      OBOA9999
.
OBOA9990  MOVE      "CV",CATEGORY
          MOVE      OBAVISIT,CODE
          MOVE      ZERO,VISTFLAG
          CALL      VISSEL00 
          GOTO      OBOA9999
.
OBOA9999  RETURN
.------------------------------------------------------------
. Cancelled Appointments Table
.------------------------------------------------------------
OCANTB00  PACK      CFNAME,CFILEPRE,FILCANA2
          OPEN      OUTCANA2,CFNAME    
          PACK      KEY24,URNUMBER,Z70
          CALL      RSOTCAN2
OCANTB10  CALL      RPOTCAN2
          BRANCH    OVRCD,OCANTB99
          MATCH     URNUMBER,OPCNURNO
          GOTO      OCANTB99 IF NOT EQUAL
.
          CALL      CLOUTHED
          PACK      KEY25,OPCNSITE,OPCNCLIN,OPCNDATE,OPCNSTRT,SP70
          CALL      RDSESA1
          IF        OVRCD=1
            UNPACK    OPCNDATE,CCENT,CYEAR,CMON,CDAY
            CALL      DAYOFWEK
            PACK      KEY18,OPCNSITE,OPCNCLIN,WEEKDAY,OPCNSTRT,SP70
            CALL      RDMASA1
            IF        OVRCD<>1
              MOVE      OTMAHOSP,OTHEHOSP     * Use clinic master hospital
            ENDIF
          ELSE
            PACK      KEY28,OSESITE,OSECLIN,OSEDAY,OSESTRT,OSESSHNO:
                            OSESSDAT,SP70
            CALL      RDOTHED1
          ENDIF
.
          MOVE      "CB",CATEGORY
          MOVE      OPCNREAS,CODE
          CALL      GETCOD00
          PACK      KEY21,TDESC,SP70
.
          UNPACK    OPCNDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    OPCNRDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY13,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      SP70,DIM30                                         *I-51518
          PACK      KEY14,OPCNOPER,SP70
          CALL      RSWBSE3
          CALL      RKWBSE3
          BRANCH    OVRCD,OCANTB20                                     *C-48413
.
          MATCH     OPCNOPER,WBSEPCD
          IF        @EQUAL
            PACK      DIM30,WBSENAM,SP70                           *end I-51518
          ENDIF
.
OCANTB20  WRITE     HTMLFILE;"<tr><td nowrap>"
.
          IF        LINK2PRT = 1
           WRITE      HTMLFILE;"<img src=../images/AppointmentIcon.gif ":
                               "class=ListIcon ":
                               "onclick=#"CancelLink('",OPCNOUTN,"');#"> ":
                               KEY12,"&nbsp",OPCNTIME,"</td>";
          ELSE
            WRITE     HTMLFILE;KEY12,"&nbsp",OPCNTIME,"</td>";
          ENDIF
.
          IF        SHOWHOSC=1
            WRITE     HTMLFILE;"<td>",OTHEHOSP,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",OPCNCLIN,"</td>":
                             "<td>",KEY13,"</td>":
                             "<td>",KEY21,"&nbsp; </td>":
                             "<td>",DIM30,"&nbsp; </td>":  
                             "<td>"; 
.
          MOVE      SP70,KEY1          * No we have not displayed a reschedule
.
          PACK      KEY11,OPCNOUTN,Z70
          CALL      RDSRSHA1
OCANTB30  CALL      RDPRSHA1                          * Check if rescheduled
          BRANCH    OVRCD,OCANTB60
.
          MATCH     OPCNOUTN,OPRSOUTN
          GOTO      OCANTB60 IF NOT EQUAL
.
          MOVE      SP70,TDESC
          MOVE      SP70,KEY17
          MOVE      SP70,KEY36
.
          UNPACK    OPRSDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY17,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,OPRSTIME
.
          PACK      KEY20,OPCNSITE,OPCNCLIN,OPCNDATE,SP70
          CALL      RDCLIA1
          IF        OVRCD=1
            PACK      KEY20,OPCNSITE,OPCNCLIN,OPCNDATE,Z70
            CALL      RDSCLIA1
            CALL      RDPCLIA1
            BRANCH    OVRCD,OCANTB55
.
            MATCH     OPCNSITE,OCASITE
            GOTO      OCANTB55 IF NOT EQUAL
.
            MATCH     OPCNCLIN,OCACLIN
            GOTO      OCANTB55 IF NOT EQUAL
          ENDIF
.
          CLEAR     KEY36
          APPEND    " - ",KEY36
          APPEND    OCADESC,KEY36
          APPEND    " - ",KEY36
          RESET     KEY36
.
OCANTB55  MOVE      SP70,TDESC
          MATCH     SP70,OPRSREAS                     * Reschedule reason
          IF        !@EQUAL
            PACK      KEY5,ANSR,ANSR,OPRSREAS,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      OPRSREAS,TDESC
            ENDIF
          ENDIF
.
          MOVE      ONE,KEY1           * yes we have displayed a reschedule     
          WRITE     HTMLFILE;KEY17,KEY36,TDESC,"<br>";
          GOTO      OCANTB30
.
OCANTB60  MATCH     "1",KEY1           * yes we have displayed a reschedule
          IF        @EQUAL
            WRITE     HTMLFILE;"</td>";
          ELSE
            WRITE     HTMLFILE;"&nbsp</td>";
          ENDIF
          CALL      CANCOM00         
          CALL      APPCOM00         
.
          WRITE     HTMLFILE;"</tr>"
.
          GOTO      OCANTB10
.
OCANTB99  RETURN
.******************************************************************************
.                        Display Cancel List Comments
.******************************************************************************
CANCOM00  WRITE     HTMLFILE;"<td>"; 
          PACK      DIM60,SP70
          PACK      KEY14,DOPCNOUT,ZERO,ZERO,FIVE,SP70
          CALL      RSVSCMT1
CANCOM10  CALL      RKVSCMT1
          BRANCH    OVRCD,CANCOM90
.
          MATCH     VSCTVIST,DOPCNOUT
          GOTO      CANCOM90 IF NOT EQUAL
.
          MATCH     "005",VSCTTYPE
          GOTO      CANCOM90 IF NOT EQUAL
.
          PACK      DIM60,VSCTDATA,SP70          
          WRITE     HTMLFILE;DIM60,"<br>"
.
          GOTO      CANCOM10
.
CANCOM90  WRITE     HTMLFILE;"&nbsp;</td>";
.
CANCOM99  RETURN
.
.---------------------------------------------------------------------
. Retrieve the all appointment comment text lines of the latest active
. visit comment details
.---------------------------------------------------------------------
APPCOM00  WRITE     HTMLFILE;"<td>";
.
          PACK      KEY17,DOPCNOUT,VSCMTTYP,Z70      * Key for start of comment
          CALL      RSVSMDT1
APPCOM10  CALL      RPVSMDT1
          BRANCH    OVRCD,APPCOM90
.
          MATCH     DOPCNOUT,VSMDVISN
          GOTO      APPCOM90 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMDTYPE
          GOTO      APPCOM90 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT          * is comment deleted
          GOTO      APPCOM10 IF EQUAL
.
. Retrieve comment header
.
          MATCH     VSMDDATE,SP70
          IF        @EQUAL
            MOVE     SP70,VSCMDATE
            GOTO     APPCOM20
          ENDIF
.
          UNPACK    VSMDDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN:
                               JUL,AUG,SEP,OCT,NOV,DEC
          PACK      VSCMDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
APPCOM20  PACK      KEY10,VSMDUSER,SP70
          CALL      RDWBSE1
          IF        OVRCD = 0
            MOVE      WBSENAM,VSCMUSRN
          ELSE
            MOVE      VSMDUSER,VSCMUSRN
          ENDIF
          STRIP     VSCMUSRN
.
APPCOM30  PACK      VSCMLINE,VSCMDATE,SP1,VSMDTIME,SP1,VSCMUSRN,SP1,VSMDOCCG
          WRITE     HTMLFILE;VSCMLINE
.
. Retrieve the comment text line details
.
          PACK      KEY20,VSMDVISN,VSMDTYPE,VSMDNOTE,SP70
          CALL      RSVSMTX1
APPCOM60  CALL      RKVSMTX1
          BRANCH    OVRCD,APPCOM10
.
          MATCH     VSMDVISN,VSMTVISN
          GOTO      APPCOM10 IF NOT EQUAL
.
          MATCH     VSMDTYPE,VSMTTYPE
          GOTO      APPCOM10 IF NOT EQUAL
.
          MATCH     VSMDNOTE,VSMTNOTE
          GOTO      APPCOM10 IF NOT EQUAL
.
          STRIP     VSMTCMNT
.
          WRITE     HTMLFILE;VSMTCMNT,"<br>"
.
          GOTO      APPCOM60 
.
APPCOM90  WRITE     HTMLFILE;"&nbsp;</td>";
.
APPCOM99  RETURN

.******************************************************************************
.                        Date Formating
.******************************************************************************
DATEFM00  UNPACK    OPCNDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      ENDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          UNPACK    OPCNRDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
DATEFM99  RETURN
.------------------------------------------------------------
. Appointment Same Day Summary
.------------------------------------------------------------
APPTAB00  PACK      CASEKEYS,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          MOVE      OBADATE,TMPDATE
          MOVE      OBASTRT,TEMPTIME
          MOVE      OBATIME,SLOTTIME
.
          PACK      KEY36,URNUMBER,TMPDATE,SP70
          CALL      RDSBOKA3
APPTAB10  CALL      RDKBOKA3
          BRANCH    OVRCD,APPTAB90
          MATCH     OBAURNO,URNUMBER
          GOTO      APPTAB90 IF NOT EQUAL
          MATCH     OBADATE,TMPDATE
          GOTO      APPTAB90 IF NOT EQUAL
.
          PACK      KEY28,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          MATCH     KEY28,CASEKEYS           * Ignore Slot being Viewed
          GOTO      APPTAB10 IF EQUAL         
.
          COMPARE   THREE,OBASTAT            * Ignore Extended Slots
          GOTO      APPTAB10 IF EQUAL         
.
          MOVE      OBAOUTNO,KEY8
          CALL      RDBOKB1
          BRANCH    OVRCD,APPTAB10
.          
          PACK      KEY28,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          CLEAR     HTMLLINK
          APPEND    "javascript:AppointLink('",HTMLLINK
          APPEND    KEY28,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          PACK      KEY12,OBASITE,OBACTYP,SP70
          CALL      RDCTYA1
.
          PACK      KEY18,OBASITE,OBACLIN,OBADAY,OBASTRT,SP70 
          CALL      RDMASA1
.
          PACK      KEY20,OBASITE,OBACLIN,OBADATE,SP70
          CALL      RDCLIA1
          IF        OVRCD = 0
            GOTO      APPTAB30
          ENDIF
.
          PACK      KEY20,OBASITE,OBACLIN,OBADATE,Z70
          CALL      RDSCLIA1          * Read Clinic Record
          CALL      RDPCLIA1          * Read Clinic Record
          BRANCH    OVRCD,APPTAB20
.
          MATCH     OCASITE,OBASITE
          GOTO      APPTAB20 IF NOT EQUAL
.
          MATCH     OCACLIN,OBACLIN
          GOTO      APPTAB30 IF EQUAL
.
APPTAB20  MOVE      "No Valid Clinic at Date",OCADESC
.
APPTAB30  MOVE      "OZ",CATEGORY
          MOVE      OTBBOUTC,CODE
          CALL      GETCOD00
          MOVE      TDESC,OUTCDESC
.
          MOVE      "CV",CATEGORY
          MOVE      OBAVISIT,CODE
          CALL      GETCOD00
          MOVE      TDESC,VTYPDESC
.
          MOVE      "CT",CATEGORY           *** HPS Code Starts here ***
          MOVE      OTMALTYP,CODE
          CALL      GETCOD00
          MOVE      TDESC,CLILDESC          *** HPS Code Ends here ***
.
          MOVE      OBATIME,DIM5
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",OBADATE,DIM5,"#",":
                             "#"",OCTDESC,"#",":
                             "#"",OCADESC,"#",":
                             "#"",CLILDESC,"#",":
                             "#"",VTYPDESC,"#",";
          BRANCH    OBASTAT,APPTAB51,APPTAB52,APPTAB53,APPTAB54,APPTAB55:
                            APPTAB56
          WRITE     HTMLFILE;"#" #",";
          GOTO      APPTAB60
.
APPTAB51  WRITE     HTMLFILE;"#"Booked#",";
          GOTO      APPTAB60
APPTAB52  WRITE     HTMLFILE;"#"Not Used#",";
          GOTO      APPTAB60
APPTAB53  WRITE     HTMLFILE;"#"Extended Slot#",";
          GOTO      APPTAB60
APPTAB54  WRITE     HTMLFILE;"#"Attended#",";
          GOTO      APPTAB60
APPTAB55  WRITE     HTMLFILE;"#"DNA#",";
          GOTO      APPTAB60
APPTAB56  WRITE     HTMLFILE;"#"Suspended#",";
          GOTO      APPTAB60
.
APPTAB60  WRITE     HTMLFILE;"#"";
          PACK      KEY25,OBASITE,OBACLIN,OBADATE,OBASTRT,SP70
          CALL      RDSESA1
          BRANCH    OVRCD,APPTAB61
.
          PACK      KEY28,OSESITE,OSECLIN,OSEDAY,OSESTRT,OSESSHNO,OSESSDAT,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,APPTAB61
.
          PACK      KEY3,OTHEHOSP
          CALL      RDPTHSP1
          BRANCH    OVRCD,APPTAB61
.
          WRITE     HTMLFILE;PTHSNAME;
APPTAB61  WRITE     HTMLFILE;"#",";
.
          MOVE      SP70,CLILDESC
          MOVE      "CT",CATEGORY
          MOVE      OTHELTYP,CODE
          CALL      GETCOD00
          MOVE      TDESC,CLILDESC
.
          WRITE     HTMLFILE;"#"",CLILDESC,"#"";
          WRITE     HTMLFILE;");"
          GOTO      APPTAB10
.
APPTAB90  MOVE      CASEKEYS,KEY28
          CALL      RDBOKA1
          IF        OVRCD=1
            CALL      CLOUTBOA
            CALL      CLOUTBOB
            GOTO      APPTAB99
          ENDIF
          MOVE      OBAOUTNO,KEY8
          CALL      RDBOKB1
          IF        OVRCD=1
            CALL      CLOUTBOB
          ENDIF
.
APPTAB99  RETURN
.
CLOUTBOA  MOVE      SP70,OBASITE  
          MOVE      SP70,OBACLIN  
          MOVE      SP70,OBADATE  
          MOVE      SP70,OBASTRT  
          MOVE      SP70,DOBASLOT 
          MOVE      SP70,OBATIME  
          MOVE      SP70,OBACTYP  
          MOVE      ZEROUR,OBAURNO  
          MOVE      SP70,OBAVISIT 
          MOVE      SP70,DOBAOUTN 
          MOVE      SP70,DOBASTAT 
          MOVE      ZERO,OBADAY
          MOVE      ZERO,OBAEXSL
          MOVE      SP70,OBAFINST 
          MOVE      SP70,OBALOCK  
          MOVE      ZERO,OBAPXRAY
          MOVE      SP70,OBABKDTE 
          MOVE      ZERO,OBAPULL
          MOVE      SP70,OBASESST 
          MOVE      SP70,OBADISCH 
          MOVE      SP70,DOTBARES 
          MOVE      SP70,OBASPARA 
          MOVE      ZERO,OBASLOT 
          MOVE      ZEROVISN,OBAOUTNO
          MOVE      ZERO,OBASTAT
          MOVE      ZERO,OTBARESV
          RETURN
.
CLOUTBOB  MOVE      SP70,OBASRCR  
          MOVE      SP70,OBACOMP  
          MOVE      SP70,OBACLASS 
          MOVE      SP70,OBAINS   
          MOVE      SP70,OBAATTN  
          MOVE      SP70,OBADOCT  
          MOVE      SP70,OBACOMM  
          MOVE      SP70,OTBBFUND 
          MOVE      SP70,OTBBTBLE 
          MOVE      SP70,DOTBBPVI 
          MOVE      SP70,OTBBSPAR 
          MOVE      SP70,OBADATE 
          MOVE      SP70,OBACAT   
          MOVE      SP70,OBAPRTY  
          MOVE      SP70,OBARSCHD 
          MOVE      SP70,OBBPORT  
          MOVE      SP70,OBBBOOK  
          MOVE      SP70,OBBCTYP  
          MOVE      SP70,OBOUSR1  
          MOVE      SP70,OBOUSR2  
          MOVE      SP70,OBOUSR3  
          MOVE      SP70,OBOUSR4  
          MOVE      SP70,OBALADMN 
          MOVE      SP70,OTBBDEPT 
          MOVE      SP70,OTBBTRAN 
          MOVE      SP70,OTBBLNGI 
          MOVE      SP70,OTBBTMFS 
          MOVE      SP70,OTBBTMBO 
          MOVE      SP70,OTBBGPFA 
          MOVE      SP70,OTBBECRA 
          MOVE      SP70,OTBBRFGP 
          MOVE      SP70,OTBBGPPC 
          MOVE      SP70,OTBBADCS 
          MOVE      SP70,OTBBCITM 
          MOVE      SP70,OTBBASTM 
          MOVE      SP70,OTBBDPTM 
          MOVE      SP70,OTBBOUTC 
          MOVE      SP70,OTBBSNDL 
          MOVE      SP70,OTBBGPPT 
          MOVE      SP70,OTBBDOFR 
          MOVE      SP70,OTBBOPER 
          MOVE      SP70,OBOUSR5  
          MOVE      SP70,OBOUSR6  
          MOVE      SP70,OBOUSR7  
          MOVE      SP70,OBOUSR8  
          MOVE      SP70,OTBBRANK 
          MOVE      SP70,OTBBFLUP 
          MOVE      SP70,OTBBSPCA
          MOVE      SP70,OTBBCIND
          MOVE      SP70,OTBBFLUP
          MOVE      SP70,OTBBSCAR 
          MOVE      SP70,OTBBGLDT 
          MOVE      SP70,OTBBSNGL 
          MOVE      SP70,OTBBNMDS
          MOVE      SP70,OTBBCART
          MOVE      SP70,OTBBSRVD
          MOVE      SP70,OTBBCLHR
          MOVE      SP70,OTBBCONT
          MOVE      SP30,OTBBTCOD
          MOVE      SP70,OTBBPURC
          MOVE      SP70,OTBBBKOV
          MOVE      SP70,OTBBBKPR
          MOVE      SP70,OTBBBKPM
          MOVE      SP70,OTBBBKBA
          MOVE      SP70,OTBBRDAT
          MOVE      SP70,OTBBHCP1
          MOVE      SP70,OTBBHCP2
          MOVE      SP70,OTBBHCP3
          MOVE      SP70,OTBBHCP4
          MOVE      SP70,OTBBSPR1 
.
          MOVE      SP70,OTXSDTE1
          MOVE      SP70,OTXSDTE2
          MOVE      SP70,OTXSDTE3
          MOVE      SP70,OTXSDTE4
          MOVE      SP70,OTXSDTE5
          MOVE      SP70,OTXSDTE6
          MOVE      SP70,OTXSCO01
          MOVE      SP70,OTXSCO02
          MOVE      SP70,OTXSCO03
          MOVE      SP70,OTXSCO04
          MOVE      SP70,OTXSCO05
          MOVE      SP70,OTXSCO06
          MOVE      SP70,OTXSCO07
          MOVE      SP70,OTXSCO08
          MOVE      SP70,OTXSCO09
          MOVE      SP70,OTXSCO10
          MOVE      SP70,OTXSCO11
          MOVE      SP70,OTXSCO12
          MOVE      SP70,OTXSCO13
          MOVE      SP70,OTXSCO14
          MOVE      SP70,OTXSCO15
          MOVE      SP70,OTXSCO16
          MOVE      SP70,OTXSCO17
          MOVE      SP70,OTXSCO18
          MOVE      SP70,OTXSCO19
          MOVE      SP70,OTXSCO20
          MOVE      SP70,OTXSDOC1
          MOVE      SP70,OTXSDOC2
          MOVE      SP70,OTXSDOC3
          MOVE      ZERO,OTXSAMT1
          MOVE      ZERO,OTXSAMT2
          MOVE      SP70,OTXSDSC1
          MOVE      SP70,OTXSDSC2
          MOVE      SP70,OTXSDSC3
          MOVE      SP70,OTXSDSC4
          MOVE      SP70,OTXSDSC5
          MOVE      SP70,OTXSDSC6
          MOVE      SP70,OTXSTIM1
          MOVE      SP70,OTXSTIM2
          MOVE      SP70,OTXSTIM3
          MOVE      SP70,OTXSTIM4
          MOVE      SP70,OTXSTIM5
          MOVE      SP70,OTXSTIM6
          MOVE      SP70,OTXSSPAR
          MOVE      SP70,OTBBSPCA           * Added for special arrangement
.
          RETURN
.
.------------------------------------------------------------
. Appointment Summary for U/R
.------------------------------------------------------------
APPTSU00  PACK      CASEKEYS,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          PACK      KEY36,URNUMBER,SP70
          CALL      RDSBOKA3
APPTSU10  CALL      RDKBOKA3
          BRANCH    OVRCD,APPTSU90
          MATCH     OBAURNO,URNUMBER
          GOTO      APPTSU90 IF NOT EQUAL
          COMPARE   THREE,OBASTAT
          GOTO      APPTSU10 IF EQUAL
.
          MOVE      OBAOUTNO,KEY8
          CALL      RDBOKB1
          BRANCH    OVRCD,APPTSU10
          PACK      KEY28,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          CLEAR     HTMLLINK
          APPEND    "javascript:AppointLink('",HTMLLINK
          APPEND    KEY28,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          PACK      KEY12,OBASITE,OBACTYP,SP70
          CALL      RDCTYA1
.
          PACK      KEY18,OBASITE,OBACLIN,OBADAY,OBASTRT,SP70  
          CALL      RDMASA1
.
          PACK      KEY20,OBASITE,OBACLIN,OBADATE,SP70
          CALL      RDCLIA1
          IF        OVRCD = 0
            GOTO      APPTSU30
          ENDIF
.
          PACK      KEY20,OBASITE,OBACLIN,OBADATE,Z70
          CALL      RDSCLIA1          * Read Clinic Record
          CALL      RDPCLIA1          * Read Clinic Record
          BRANCH    OVRCD,APPTSU20
.
          MATCH     OCASITE,OBASITE
          GOTO      APPTSU20 IF NOT EQUAL
.
          MATCH     OCACLIN,OBACLIN
          GOTO      APPTSU30 IF EQUAL
.
APPTSU20  MOVE      "No Valid Clinic at Date",OCADESC
.
APPTSU30  MOVE      "OZ",CATEGORY
          MOVE      OTBBOUTC,CODE
          CALL      GETCOD00
          MOVE      TDESC,OUTCDESC
.
          MOVE      "CV",CATEGORY
          MOVE      OBAVISIT,CODE
          CALL      GETCOD00
          MOVE      TDESC,VTYPDESC
.
          MOVE      ZERO,CHARTREV                  * No        *T0838668-start
          MATCH     ANSC,TCINDC8                   * Chart Review Slot
          IF        @EQUAL
            MOVE     ONE,CHARTREV                  * Yes
          ENDIF                                                *T0838668-end
.
          MOVE      "CT",CATEGORY           *** HPS Code Starts here ***
          MOVE      OTMALTYP,CODE
          CALL      GETCOD00
          MOVE      TDESC,CLILDESC   
.
          MOVE      "CI",CATEGORY   
          MOVE      OTBBCIND,CODE
          MATCH     SP70,CODE
          IF        @EQUAL
            MOVE      OMACIND,CODE
          ENDIF
          CALL      GETCOD00
          MOVE      TDESC,KEY25          *** HPS Code Ends here ***
.
          MOVE      OBATIME,DIM5
.
          MOVE      ZERO,VISCMFLG
          PACK      HTMLLNK2,SP70,SP70
.                            
          MOVE      OBAOUTNO,KEY8
          CALL      CHVSCM00
          IF        VISCMFLG = ONE 
            CLEAR     HTMLLNK2 
            APPEND    "javascript:ViewBookNotes('",HTMLLNK2
            APPEND    OBAURNO,HTMLLNK2
            APPEND    "','",HTMLLNK2
            APPEND    OBAOUTNO,HTMLLNK2
            APPEND    "')",HTMLLNK2
            RESET     HTMLLNK2
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",OBADATE,DIM5,"#",":
                             "#"",OCTDESC,"#",":
                             "#"",OCADESC,"#",":
                             "#"",OUTCDESC,"#",":
                             "#"",VTYPDESC,"#",":
                             "#"",CLILDESC,"#",":
                             "#"",KEY25,"#",";
          BRANCH    OBASTAT,APPTSU51,APPTSU52,APPTSU53,APPTSU54,APPTSU55:
                            APPTSU56
          WRITE     HTMLFILE;"#" #",#"";
          GOTO      APPTSU60
.
APPTSU51  WRITE     HTMLFILE;"#"Booked#",#"";
          GOTO      APPTSU60
APPTSU52  WRITE     HTMLFILE;"#"Not Used#",#"";
          GOTO      APPTSU60
APPTSU53  WRITE     HTMLFILE;"#"Extended Slot#",#"";
          GOTO      APPTSU60
APPTSU54  WRITE     HTMLFILE;"#"Attended#",#"";
          GOTO      APPTSU60
APPTSU55  WRITE     HTMLFILE;"#"DNA#",#"";
          GOTO      APPTSU60
APPTSU56  WRITE     HTMLFILE;"#"Suspended#",#"";
          GOTO      APPTSU60
.
APPTSU60  WRITE     HTMLFILE;VISCMFLG,"#",":
                            "#"",HTMLLNK2,"#",":
                            "#"",CHARTREV,"#");"    *T0838668
.
          PACK      KEY11,OBAOUTNO,SP70
          CALL      RDSRSHA1
APPTSU70  CALL      RDKRSHA1
          BRANCH    OVRCD,APPTSU10
          MATCH     OBAOUTNO,OPRSOUTN
          GOTO      APPTSU10 IF NOT EQUAL
.
          PACK      KEY20,OPRSSITE,OPRSCLIN,OPRSDATE,SP70
          CALL      RDCLIA1
          COMPARE   ONE,OVRCD
          GOTO      APPTSU76 IF NOT EQUAL
.
          PACK      KEY20,OPRSSITE,OPRSCLIN,OPRSDATE,Z70
          CALL      RDSCLIA1          * Read Clinic Record
          CALL      RDPCLIA1          * Read Clinic Record
          BRANCH    OVRCD,APPTSU75
.
          MATCH     OPRSSITE,OCASITE
          GOTO      APPTSU75 IF NOT EQUAL
.
          MATCH     OPRSCLIN,OCACLIN
          GOTO      APPTSU76 IF EQUAL
.
APPTSU75  MOVE      "No Valid Clinic at Date",OCADESC
APPTSU76  MOVE      "RR",CATEGORY                                      *I-51304
          MOVE      OPRSREAS,CODE
          CALL      GETCOD00                                       *end I-51304
.
          PACK      KEY14,OPRSOPER,SP70
          CALL      RSWBSE3
          CALL      RKWBSE3                 * get rescheduled by user name
          BRANCH    OVRCD,APPTSU79
.
          MATCH     OPRSOPER,WBSEPCD
          GOTO      APPTSU80 IF EQUAL
.
APPTSU79  MOVE      OPRSOPER,WBSENAM
          
APPTSU80  CLEAR     HTMLLNKL                                           *I-51304
          APPEND    "javascript:alert('Appointment Rescheduled to ",HTMLLNKL
          UNPACK    OPRSNDAT,CCENT,CYEAR,CMON,CDAY
          APPEND    OPRSNTIM,HTMLLNKL
          APPEND    SP1,HTMLLNKL
          APPEND    CDAY,HTMLLNKL
          APPEND    "/",HTMLLNKL
          APPEND    CMON,HTMLLNKL
          APPEND    "/",HTMLLNKL
          APPEND    CCENT,HTMLLNKL
          APPEND    CYEAR,HTMLLNKL
          APPEND    "\\nReason: ",HTMLLNKL
          APPEND    TDESC,HTMLLNKL
          APPEND    "\\nOperator: ",HTMLLNKL
          APPEND    WBSENAM,HTMLLNKL
          APPEND    "\\nRescheduled Date: ",HTMLLNKL
          UNPACK    OPRSRDTE,CCENT,CYEAR,CMON,CDAY
          APPEND    SP1,HTMLLNKL
          APPEND    CDAY,HTMLLNKL
          APPEND    "/",HTMLLNKL
          APPEND    CMON,HTMLLNKL
          APPEND    "/",HTMLLNKL
          APPEND    CCENT,HTMLLNKL
          APPEND    CYEAR,HTMLLNKL
          APPEND    " at ",HTMLLNKL
          APPEND    OPRSRTIM,HTMLLNKL
          APPEND    "')",HTMLLNKL
          RESET     HTMLLNKL                                       *end I-51304
.
          UNPACK    OPRSDATE,CCENT,CYEAR,CMON,CDAY
          CALL      DAYOFWEK
          LOAD      DAYNAM3,WEEKDAY,MON,TUE,WED,THU,FRI,SAT,SUN
.
          MOVE      SP70,OTHECTYP
          MOVE      SP70,OTHELTYP
.
          PACK      KEY18,OPRSSITE,OPRSCLIN,WEEKDAY,OPRSSTRT,SP70  
          CALL      RDMASA1
          BRANCH    OVRCD,APPTSU85
.
          MOVE      OMATYP,OTHECTYP
          MOVE      OTMALTYP,OTHELTYP
.
          PACK      KEY25,OPRSSITE,OPRSCLIN,OPRSDATE,OPRSSTRT,SP70
          CALL      RDSESA1
          BRANCH    OVRCD,APPTSU85

          PACK      KEY28,OSESITE,OSECLIN,OSEDAY,OSESTRT,OSESSHNO,OSESSDAT,SP70
          CALL      RDOTHED1
          BRANCH    OVRCD,APPTSU85

APPTSU85  PACK      KEY12,OTHESITE,OTHECTYP,SP70
          CALL      RDCTYA1
          IF        OVRCD=1
            MOVE      SP70,OCTDESC
          ENDIF
.
          MOVE      "CT",CATEGORY           *** HPS Code Starts here ***
          MOVE      OTHELTYP,CODE
          CALL      GETCOD00
          MOVE      TDESC,CLILDESC
.
          MOVE      ZERO,VISCMFLG
          PACK      HTMLLNK2,SP70,SP70
.                            
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLNKL,"#",":
                             "#"",OPRSDATE,OPRSTIME,"#",":
                             "#"",OCTDESC,"#",":
                             "#"",OCADESC,"#",":
                             "#"",OUTCDESC,"#",":
                             "#"",VTYPDESC,"#",":
                             "#"",CLILDESC,"#",":
                             "#"",KEY25,"#",":
                             "#"Rescheduled#",":
                             "#"",VISCMFLG,"#",":
                             "#"",HTMLLNK2,"#",":
                             "#"",CHARTREV,"#");"    *T0838668

          GOTO      APPTSU70
.
APPTSU90  MOVE      CASEKEYS,KEY28
          CALL      RDBOKA1
          IF        OVRCD=1
            CALL      CLOUTBOA
            CALL      CLOUTBOB
            GOTO      APPTSU99
          ENDIF
          MOVE      OBAOUTNO,KEY8
          CALL      RDBOKB1
          IF        OVRCD=1
            CALL      CLOUTBOB
          ENDIF
APPTSU99  RETURN
.
.----------------------------------------------------------------------
. check if visit comment exists 
.----------------------------------------------------------------------
CHVSCM00  PACK      KEY17,KEY8,VSCMTTYP,Z70      * Key for start of comment
          CALL      RSVSMDT1
CHVSCM20  CALL      RPVSMDT1
          BRANCH    OVRCD,CHVSCM99
.
          MATCH     KEY8,VSMDVISN
          GOTO      CHVSCM99 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMDTYPE
          GOTO      CHVSCM99 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT          * is comment deleted
          GOTO      CHVSCM20 IF EQUAL
.
          MOVE      ONE,VISCMFLG
.
CHVSCM99  RETURN
.                                           * HPS-ODC Code Starts (Fix 91-94)
APPSMS00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          PACK      CASEKEYS,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          PACK      KEY36,URNUMBER,Z70
          CALL      RDSBOKA3
APPSMS10  CALL      RDPBOKA3
          BRANCH    OVRCD,APPSMS90
          MATCH     OBAURNO,URNUMBER
          GOTO      APPSMS90 IF NOT EQUAL
          COMPARE   ZERO,OBASTAT
          GOTO      APPSMS10 IF EQUAL
          BRANCH    OBASTAT,APPSMS15,APPSMS10,APPSMS10
.
APPSMS15  MOVE      OBAOUTNO,KEY8
          CALL      RDBOKB1
          BRANCH    OVRCD,APPSMS10
          PACK      KEY28,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
.
          PACK      KEY12,OBASITE,OBACTYP,SP70
          CALL      RDCTYA1
.
          MOVE      SP70,KEY4
          MATCH     "1",OTBBFLUP
          IF        @EQUAL
            MOVE      "Done",KEY4
          ENDIF
          PACK      KEY28,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          WRITE     HTMLFILE;"t.addRow(#"",OBAURNO,"#",":
                             "#"",OBAOUTNO,"#",":
                             "#"",KEY28,"#",":
                             "#"",OBADATE,OBATIME,"#",":
                             "#"",OCTDESC,"#",":
                             "#"",OTBBCITM,"#",":
                             "#"",OTBBASTM,"#",":
                             "#"",OTBBDPTM,"#",":
                             "#"",KEY4,"#");"
.
          GOTO      APPSMS10
.
APPSMS90  MOVE      CASEKEYS,KEY28
          CALL      RDBOKA1
          IF        OVRCD=1
            CALL      CLOUTBOA
            CALL      CLOUTBOB
            GOTO      APPSMS99
          ENDIF
.
          MOVE      OBAOUTNO,KEY8
          CALL      RDBOKB1
          IF        OVRCD=1
            CALL      CLOUTBOB
          ENDIF
APPSMS99  RETURN                            * HPS-ODC Code Ends (Fix 91-94)
.
.------------------------------------------------------------
. Add Visit Type Selection Options to Form 
. OVERBOOK - 0 = Do not display over bookings sloty types
. OVERBOOK - 1 = Only display over bookings sloty types
.------------------------------------------------------------
VISSEL00  MOVE      ZERO,OVERBOOK
          MOVE      ZERO,LINKVTYP           * Display all visit types
.
          PACK      KEY15,OBASITE,OBACTYP,SP70
          CALL      RSOTCVT1
          CALL      RKOTCVT1                * Check the clinic type for
          BRANCH    OVRCD,VISSEL05          * linked visit types
.
          MATCH     OBASITE,OCVTSITE        * Same Site
          GOTO      VISSEL05 IF NOT EQUAL
.
          MATCH     OBACTYP,OCVTCTYP        * Same Clinic Type
          GOTO      VISSEL05 IF NOT EQUAL
.
          MOVE      ONE,LINKVTYP            * Only display linked visit types
.
VISSEL05  PACK      KEY5,CATEGORY,CODE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MATCH    ANSZ,TCINDC2
            IF       @EQUAL
              MOVE     ONE,OVERBOOK        * Yes only display over booking types
            ENDIF
          ENDIF
.
          MOVE      SP70,TDESC
          PACK      KEY5,CATEGORY,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      CATEGORY,TCODE
            MOVE      "Invalid Category",TDESC
          ENDIF
          REP       " _",TCODE
          REP       " _",THCSCOD
          WRITE     HTMLFILE;"<!--<cat-c category=#"",TCODE,"#" name=#"",TDESC:
                             "#" map=#"",THCSCOD,"#"></cat-c>-->"
.
          PACK      PTCDKEY2,CATEGORY,SP70
          CALL      RDSCODE2
VISSEL10  CALL      RDKCODE2
          BRANCH    OVRCD,VISSEL99
          MATCH     CATEGORY,TCODE
          GOTO      VISSEL99 IF NOT EQUAL
          MATCH     SP70,ACODE
          GOTO      VISSEL10 IF EQUAL
          MATCH     "I",PTCOACTV
          GOTO      VISSEL10 IF EQUAL
          PACK      KEY15,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10:
                          TCINDC11,THCSCOD
.
          IF        VISTFLAG=0
            MATCH     "U",TCINDC6           * Skip unavailabl
            GOTO      VISSEL10 IF EQUAL
.
            IF        OVERBOOK =1
              MATCH     ANSZ,TCINDC2          * Skip over bookings
              GOTO      VISSEL10 IF NOT EQUAL
            ELSE
              MATCH     ANSZ,TCINDC2          * Skip over bookings
              GOTO      VISSEL10 IF EQUAL
            ENDIF
          ENDIF
.
          IF        VISTFLAG=1
            MATCH     "U",TCINDC6           * Only display unavailable
            GOTO      VISSEL10 IF NOT EQUAL
          ENDIF
.
          IF        VISTFLAG=2
            MATCH     "N",KEY15             * Skip New slots
            GOTO      VISSEL10 IF EQUAL
.
            IF        TCFORM6 > ONE
              GOTO      VISSEL10            * Skip if not a single slot
            ENDIF
.
            MATCH     "U",TCINDC6           * Skip unavailable
            GOTO      VISSEL10 IF EQUAL
.
            MATCH     "Z",TCINDC2           * skip over bookings
            GOTO      VISSEL10 IF EQUAL
          ENDIF
.
          IF        VISTFLAG=3
            MATCH     "U",TCINDC6           * display all except unavailable
            GOTO      VISSEL10 IF EQUAL     * for reschedule screen
          ENDIF
.
          PACK      KEY20,QUOTE,ACODE,KEY15,QUOTE
          MATCH     CODE,ACODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY20," selected>":
                               TDESC,"</option>"
          ELSE
            IF        LINKVTYP=1
              PACK      KEY15,OBASITE,OBACTYP,ACODE,SP70
              CALL      RDOTCVT1          * Only display linked visit types
              BRANCH    OVRCD,VISSEL10
            ENDIF
.
            IF        IBCNMHOS=1            
              MATCH    "1",PTCDHOSS
              IF       @EQUAL
                PACK     KEY8,WBSEHOSP,TCODE,ACODE,SP70
                CALL     RDMLCOD1 
                BRANCH   OVRCD,VISSEL10
              ENDIF   
            ENDIF  
            WRITE     HTMLFILE;"<option value=",KEY20,">",TDESC,"</option>"
          ENDIF
          GOTO      VISSEL10
VISSEL99  RETURN
.
.------------------------------------------------------------
. DEFC0000 - Get default claim code from patients last visit
.------------------------------------------------------------
          DEFPROC   DEFC0000  
.
          INC       ALLCONFD/INC
          INC       PATVISFD/INC
          INC       EMRVISFD/INC
          INC       OUTBB1FD/INC
          INC       PATMI1FD/INC
          INC       PMSEVTFD/INC
          INC       ALLREFFD/INC
.
CATCL     INIT      "CL"
.
          OPEN      PATVISA2,"patvisaf"
.
          PACK      KEY24,URNUMBER,Z70
          CALL      RDSVISA2
DEFC1000  CALL      RDPVISA2
.
          MATCH     URNUMBER,PVIURNO
          GOTO      DEFC8000 IF NOT EQUAL
.
          BRANCH    PVITYPE,DEFC2000,DEFC3000,DEFC4000,DEFC1000:
                            DEFC1000,DEFC1000,DEFC1000,DEFC1000:
                            DEFC5000 
.
          GOTO      DEFC1000
.
DEFC2000  OPEN      EMRVISA1,"emrvisaf"
          PACK      KEY8,PVIBILL            * EMR Visit
          CALL      RDEMVIS1
          BRANCH    OVRCD,DEFC8000
.
          MOVE      EMVICOMP,CODE
          GOTO      DEFC9000
.
DEFC3000  PACK      CFNAME,CFILEPRE,FILBB1A1
          CALL      OPOTBB11                * Open the file 
          PACK      KEY8,PVIBILL            * Outpatient
          CALL      RDBOKB1
          BRANCH    OVRCD,DEFC8000
.
          MOVE      OBACOMP,CODE
          GOTO      DEFC9000
.
DEFC4000  OPEN      PATMI1A1,"patmi1af"
          PACK      KEY8,PVIBILL            * Inpatient
          CALL      RDMISS1
          BRANCH    OVRCD,DEFC8000
.
          MOVE      ACLAIM,CODE
          GOTO      DEFC9000
.
.
DEFC5000  MATCH     " 1",PVISYST            * Event
          GOTO      DEFC5500 IF EQUAL
.
          MATCH     " 2",PVISYST            * Allied Health
          GOTO      DEFC6000 IF EQUAL
.
          GOTO      DEFC8000          
.
DEFC5500  OPEN      PMSEVTA1,"pmsevtaf"
          PACK      KEY8,PVIBILL
          CALL      RDPMEVT1
          BRANCH    OVRCD,DEFC8000
.
          MOVE      PMEVCCOD,CODE
          GOTO      DEFC9000
.
DEFC6000  OPEN      ALLREFA1,"allrefaf"
          PACK      KEY8,PVIBILL
          CALL      RDALREF1
          BRANCH    OVRCD,DEFC8000
.
          MOVE      ALRECOMP,CODE
          GOTO      DEFC9000
.
DEFC8000  MOVE      SP70,CODE
          PACK      KEY5,CATCL,SP70
          CALL      RDSCODE1
DEFC8500  CALL      RDKCODE1
          BRANCH    OVRCD,DEFC9000
.
          MATCH     CATCL,TCODE
          GOTO      DEFC9000 IF NOT EQUAL
.
          MATCH     ANSI,PTCOACTV
          GOTO      DEFC8500 IF EQUAL
.
          MATCH     "2",TCINDC9
          IF        @EQUAL
            MOVE      ACODE,CODE
            GOTO      DEFC9000
          ENDIF
.
          GOTO      DEFC8500
.
DEFC9000  MATCH     SP70,CODE
          GOTO      DEFC9100 IF EQUAL
.
          PACK      KEY5,ANSC,ANSL,CODE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,DEFC9100
.
          MATCH     ANSI,PTCOACTV
          IF        @EQUAL
            PACK      CODE,SP70
          ENDIF
.
DEFC9100  MOVE      "CL",CATEGORY
          CALL      CODITM00
          GOTO      DEFC9999
.
          INC       PATVISIO/INC
          INC       EMRVISIO/INC
          INC       OUTBB1IO/INC
          INC       PATMI1IO/INC
          INC       PMSEVTIO/INC
          INC       ALLREFIO/INC
          INC       IBAOVRIO/INC
.
DEFC9999  ENDPROC
.
.------------------------------------------------------------
. Additional fields from OBOA2700
.------------------------------------------------------------
OBOX0000  BRANCH    FLDITMNO,OBOX0100,OBOX0200,OBOX0300,OBOX0400,OBOX0500:
                             OBOX0600,OBOX0700,OBOX0800,OBOX0900,OBOX1000:
                             OBOX1100,OBOX1200,OBOX1300,OBOX1400,OBOX1500:
                             OBOX1600,OBOX1700,OBOX1800,OBOX1900,OBOX2000:
                             OBOX2100,OBOX2200,OBOX2300,OBOX2400,OBOX2500:
                             OBOX2600,OBOX2700
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      OBOX9999
.
OBOX0100  WRITE     HTMLFILE;OTBBSCAR;      * Send correspondence to carer
          GOTO      OBOX9999
.
OBOX0200  MATCH     SP70,OTBBGLDT
          GOTO      OBOA9999 IF EQUAL
.
          UNPACK    OTBBGLDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OBOX9999
.
OBOX0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OBOX0310,OBOX0320
.
          MATCH     "0",OTBBSNGL
          IF        @EQUAL
            WRITE     HTMLFILE;"No";
            GOTO      OBOX9999
          ENDIF
.
          MATCH     "1",OTBBSNGL
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
            GOTO      OBOX9999
          ENDIF
.
          MATCH     "2",OTBBSNGL
          IF        @EQUAL
            WRITE     HTMLFILE;"N/A";
            GOTO      OBOX9999
          ENDIF
          GOTO      OBOX9999
.
OBOX0310  WRITE     HTMLFILE;OTBBSNGL;      * Send generate letter (Y/N)
          GOTO      OBOX9999
.
OBOX0320  MATCH     "0",OTBBSNGL
          IF        @EQUAL
            WRITE     HTMLFILE;"<option selected value=#"0#">No</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"0#">No</option>"
          ENDIF
.
          MATCH     "1",OTBBSNGL
          IF        @EQUAL
            WRITE     HTMLFILE;"<option selected value=#"1#">Yes</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"1#">Yes</option>"
          ENDIF
.
          MATCH     "2",OTBBSNGL
          IF        @EQUAL
            WRITE     HTMLFILE;"<option selected value=#"2#">N/A</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"2#">N/A</option>"
          ENDIF
.
          GOTO      OBOX9999
.
OBOX0400  MOVE      "NM",CATEGORY
          MOVE      OTBBNMDS,CODE
          CALL      CODITM00
          GOTO      OBOX9999
.
OBOX0500  MOVE      "CC",CATEGORY
          MOVE      OTBBCART,CODE
          CALL      CODITM00
          GOTO      OBOX9999
.
OBOX0600  MOVE      "sd",CATEGORY
          MOVE      OTBBSRVD,CODE
          CALL      CODITM00
          GOTO      OBOX9999
.
OBOX0700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OBOX0710
.
          MATCH     "1",OTBBCLHR
          GOTO      OBOX9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;"Yes";
          GOTO      OBOX9999
.
OBOX0710  WRITE     HTMLFILE;OTBBCLHR;
          GOTO      OBOX9999
.
OBOX0800  MOVE      ZERO,LINK2PRT
          MOVE      ONE,SHOWHOSC
          CALL      OCANTB00                * Show Hospital - No
          GOTO      OBOX9999
.
OBOX0900  MOVE      ONE,LINK2PRT
          MOVE      ONE,SHOWHOSC           * Show Hospital - No
          CALL      OCANTB00
          GOTO      OBOX9999
.
OBOX1000  UNPACK    DIM127,D1,KEY1,DIM127   * OUTWEBXX.XX.X27.002.x 
          PACK      DIM3,SP70 
          MOVE      KEY1,F1
          LOAD      DIM3,F1,OBOUSR1,OBOUSR2,OBOUSR3,OBOUSR4,OBOUSR5:
                            OBOUSR6,OBOUSR7,OBOUSR8
          WRITE     HTMLFILE;DIM3; 
          GOTO      OBOX9999 
.
OBOX1100  UNPACK    DIM127,D1,ANS,DIM127
          MATCH     SP70,OBADATE
          IF        @EQUAL
            PACK      KEY20,OBASITE,OBACLIN,Z70
          ELSE
            PACK      KEY20,OBASITE,OBACLIN,OBADATE,Z70
          ENDIF
.
          CALL      RDCLIA1
          IF        OVRCD = 0
            CALL      RDKCLIA1            * Read Clinic Record
            GOTO      OBOX1101
          ENDIF
.
          CALL      RDSCLIA1              * Position read not a full key
OBOX1101  CALL      RDPCLIA1              * Read Clinic Record
          BRANCH    OVRCD,OBOX9999
.
          MATCH     OCASITE,OBASITE
          GOTO      OBOX9999 IF NOT EQUAL
.
          MATCH     OCACLIN,OBACLIN
          GOTO      OBOX9999 IF NOT EQUAL
.
          MOVE      ANS,F1
          BRANCH    F1,OBOX1110
          WRITE     HTMLFILE;OCACLIN;
          GOTO      OBOX9999
.
OBOX1110  WRITE     HTMLFILE;OCADESC;
          GOTO      OBOX9999
.
OBOX1200  MOVE      "NC",CATEGORY
          MOVE      OTBBTCOD,CODE
          CALL      CODITM00
          GOTO      OBOX9999
.
OBOX1300  UNPACK    DIM127,D1,D1,DIM127
          MOVE      D1,F1
          BRANCH    F1,OBOX1301,OBOX1302
.
          WRITE     HTMLFILE;OTBBPURC;
          GOTO      OBOX9999
.
OBOX1301  MOVE      "HP",CATEGORY
          MOVE      OTBBPURC,CODE
          CALL      CODITM00
          GOTO      OBOX9999
.  
OBOX1302  MOVE      "HP",CATEGORY
          CALL      CODSEL00
          GOTO      OBOX9999
.
OBOX1400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OBOX1410
.
          MATCH     SP70,OTBBFUND
          GOTO      OBOX9999 IF EQUAL
.
          WRITE     HTMLFILE;OTBBFUND; 
          GOTO      OBOX9999
.
OBOX1410  PACK      KEY14,OTBBFUND,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
          ELSE
            WRITE     HTMLFILE;OTBBFUND;
          ENDIF

          GOTO      OBOX9999
.
OBOX1500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OBOX1510
.
          MATCH     SP70,OTBBTBLE
          GOTO      OBOX9999 IF EQUAL
.
          WRITE     HTMLFILE;OTBBTBLE;
          GOTO      OBOX9999
.
OBOX1510  PACK      KEY14,OTBBFUND,OTBBTBLE,SP70
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;      * Description of Table
          ELSE
            WRITE     HTMLFILE;OTBBTBLE;      * Table code
          ENDIF
          GOTO      OBOX9999
.
OBOX1600  CALL      VICMNA00
          GOTO      OBOX9999 
.
OBOX1700  PACK      KEY12,OBASITE,OBACTYP,SP70
          CALL      RDCTYA1
          BRANCH    OVRCD,OBOX9999
.
          MOVE      "CG",KEY2
          PACK      KEY5,KEY2,OCTGRP,SP70   * Clinic Group
          CALL      RDCODE1
          BRANCH    OVRCD,OBOX9999
.
          PACK      KEY66,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10:
                          TCINDC11,THCSCOD,PTCDNHCP,TCFORM6:
                          TCINDC12,TCINDC13,TCINDC14,TCINDC15,TCINDC16:
                          TCINDC17,TCINDC18,TCINDC19,TCINDC20,TCINDC21:
                          PTCOACTV,PTCDASC1,PTCDASC2,PTCDASC3,PTCDASC4:
                          PTCDASC5,SP70
          WRITE     HTMLFILE;ACODE,KEY66;
          GOTO      OBOX9999 
.
OBOX1800  MOVE      "ro",CATEGORY
          MOVE      OTBBBKOV,CODE
          CALL      CODITM00
          GOTO      OBOX9999
.
OBOX1900  MOVE      "RF",CATEGORY
          MOVE      OTBBBKPR,CODE
          CALL      CODITM00
          GOTO      OBOX9999
.
OBOX2000  WRITE     HTMLFILE;OTBBBKPM;
          GOTO      OBOX9999
.
OBOX2100  MOVE      "0",DIM1
          MATCH     "1",OTBBBKBA
          IF        @EQUAL
            MOVE      OTBBBKBA,DIM1
          ENDIF
          WRITE     HTMLFILE;DIM1;
          GOTO      OBOX9999
.
OBOX2200  MATCH     OTBBRDAT,SP70
          GOTO      OBOX9999 IF EQUAL
          UNPACK    OTBBRDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      OBOX9999
.
OBOX2300  MOVE      ONE,F1                 * Don't show audit details
          CALL      VICMNF00
          GOTO      OBOX9999
.
OBOX2400  WRITE     HTMLFILE;OTBBHCP1;
          GOTO      OBOX9999
.
OBOX2500  WRITE     HTMLFILE;OTBBHCP2;
          GOTO      OBOX9999
.
OBOX2600  WRITE     HTMLFILE;OTBBHCP3;
          GOTO      OBOX9999
.
OBOX2700  WRITE     HTMLFILE;OTBBHCP4;
          GOTO      OBOX9999
.
OBOX9999  RETURN
.
.-----------------------------------------------------------------------
. Retrieve the last number of visit comment details
. F1 = 0 Show audit details
. F1 = 1 Don't show audit details
.-----------------------------------------------------------------------
VICMNF00  PACK      KEY17,ADMISSNO,VSCMTTYP,Z70
.
          CALL      RSVSMDT1
VICMNF10  CALL      RPVSMDT1
          BRANCH    OVRCD,VICMNF99
.
          MATCH     ADMISSNO,VSMDVISN
          GOTO      VICMNF99 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMDTYPE
          GOTO      VICMNF99 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT
          GOTO      VICMNF10 IF EQUAL
.
. Retrieve comment header
.
          MATCH     VSMDDATE,SP70
          IF        @EQUAL
            MOVE     SP70,VSCMDATE
            GOTO     VICMNF20
          ENDIF
.
          UNPACK    VSMDDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN:
                               JUL,AUG,SEP,OCT,NOV,DEC
          PACK      VSCMDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
VICMNF20  PACK      KEY10,VSMDUSER,SP70
          CALL      RDWBSE1
          IF        OVRCD = 0
            MOVE      WBSENAM,VSCMUSRN
          ELSE
            MOVE      VSMDUSER,VSCMUSRN
          ENDIF
          STRIP     VSCMUSRN
.
VICMNF30  PACK      KEY20,SP70
          MATCH     VSMDOCCG,SP70
          IF        !@EQUAL
            MOVE      "w0",KEY2
            PACK      KEY5,KEY2,VSMDOCCG,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      KEY20,VSMDOCCG,SP70
            ELSE
              PACK      KEY20,TDESC,SP70
            ENDIF
          ENDIF
.
VICMNF40  PACK      VSCMLINE,VSCMDATE,SP1,VSMDTIME,SP1,VSCMUSRN,SP1,KEY20
          IF        F1<>1
            WRITE     HTMLFILE;VSCMLINE
          ENDIF
.
          CALL      VICMXA00
.
          GOTO      VICMNF10
.
VICMNF99  RETURN
.
.-----------------------------------------------------------------------
. Retrieve the last number of visit comment details
.-----------------------------------------------------------------------
VICMNA00  MOVE      SP70,KEY3
          UNPACK    DIM127,DIM1,KEY3,DIM127
          MOVE      KEY3,VSCMNOFS
.
          MOVE      ZERO,F3
          PACK      KEY17,ADMISSNO,VSCMTTYP,Z70
.
          CALL      RSVSMDT1
VICMNA10  CALL      RPVSMDT1
          BRANCH    OVRCD,VICMNA99
.
          IF        F3 = VSCMNOFS
            GOTO      VICMNA99
          ENDIF
.
          MATCH     ADMISSNO,VSMDVISN
          GOTO      VICMNA99 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMDTYPE
          GOTO      VICMNA99 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT
          GOTO      VICMNA10 IF EQUAL
.
. Retrieve comment header
.
          MATCH     VSMDDATE,SP70
          IF        @EQUAL
            MOVE     SP70,VSCMDATE
            GOTO     VICMNA20
          ENDIF
.
          UNPACK    VSMDDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN:
                               JUL,AUG,SEP,OCT,NOV,DEC
          PACK      VSCMDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
VICMNA20  PACK      KEY10,VSMDUSER,SP70
          CALL      RDWBSE1
          IF        OVRCD = 0
            MOVE      WBSENAM,VSCMUSRN
          ELSE
            MOVE      VSMDUSER,VSCMUSRN
          ENDIF
          STRIP     VSCMUSRN
.
VICMNA30  PACK      KEY20,SP70
          MATCH     VSMDOCCG,SP70
          IF        !@EQUAL
            MOVE      "w0",KEY2
            PACK      KEY5,KEY2,VSMDOCCG,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      KEY20,VSMDOCCG,SP70
            ELSE
              PACK      KEY20,TDESC,SP70
            ENDIF
          ENDIF
.
VICMNA40  PACK      VSCMLINE,VSCMDATE,SP1,VSMDTIME,SP1,VSCMUSRN,SP1,KEY20
          WRITE     HTMLFILE;VSCMLINE
          ADD       ONE,F3
.
          CALL      VICMXA00
.
          GOTO      VICMNA10
.
VICMNA99  RETURN
.
.---------------------------------------------------------------------
. Retrieve comment text details
.---------------------------------------------------------------------
.
VICMXA00  PACK      KEY20,VSMDVISN,VSMDTYPE,VSMDNOTE,SP70
          CALL      RSVSMTX1
VICMXA20  CALL      RKVSMTX1
          BRANCH    OVRCD,VICMXA99
.
          MATCH     VSMDVISN,VSMTVISN
          GOTO      VICMXA99 IF NOT EQUAL
.
          MATCH     VSMDTYPE,VSMTTYPE
          GOTO      VICMXA99 IF NOT EQUAL
.
          MATCH     VSMDNOTE,VSMTNOTE
          GOTO      VICMXA99 IF NOT EQUAL
.
          STRIP     VSMTCMNT
          MOVELPTR  VSMTCMNT,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      VSMTCMNT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,70
.
          GOTO      VICMXA20
.
VICMXA99  RETURN

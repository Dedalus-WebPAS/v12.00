.******************************************************************************
.* System         : ALL                     Release 5.01                      *
.*                                                                            *
.* Include Name   : DXPATMAS.PBL                                              *
.*                                                                            *
.* Function       : To display the values from PATMA1FD/PATMX1FD/PATRE1FD     *
.*                  NOTE: the label numbers for this indicate the item number *
.*                        each variable is - this corresponds to the items in *
.*                        HOS31/PAT31/PAT01/PAT32/TRA21 for PMI details       *
.*                                                                            *
.* Author         : Justin Coates           30/07/1992                        *
.*                                                                            *
.* Parameters     : PATMA1FD record for the data to display                   *
.*                  NMPNUMB       the National UR number                      *
.*                  SCRSPTFD/SCRSBGFD records                                 *
.*                                                                            *
.* Includes Req'd : DXPATCOD      display a field from patcodfd               *
.*                                                                            *
.* Modifications  :                                                           *
.*                                                                            *
.*----------------------------------------------------------------------------*
.* V11.05.02 30/01/2025  Thanh T          TSK 0956569                         *
.*           Changed DPTM1226, DPTM1228, DPTM1230 and DPTM1232 to fix issue   *
.*           with Ethnicity and Lang Spoken At Home description not printing  *
.*           correct                                                          *
.* V11.05.01 30/01/2025  Thanh T          TSK 0956569                         *
.*           Changed DPTM1234 and DPTM1236 to fix issue with NOK main         *
.*           language description not printing correct                        *
.* V11.04.03 08/10/2024  Thanh T        TSK 0952281                           *
.*           Changed FPNAME00 to use PATMA1AF.PTMASNAM first if it contains   *
.*           data, else use PATMA1AF.PSNAME                                   *
.* V11.04.02 17/05/2024  Thanh T        TSK 0941543                           *
.*           Added DPTM1225-DPTM1236 for Ethnicity1-2, Main Language Spoken   *
.*           At Home 1-2 and Next Of Kin Main Language Spoken At Home 1-2     *
.            variables for Codes and long descriptions (225-236)              *
.* V11.04.01 27/11/2023  Peter Vela     TSK 0935874                           *
.*           Added validation for PTCNUNET = 3                                *
.*----------------------------------------------------------------------------*
.*        V11.02.02 20/04/2022  Thanh T         TSK 0903453                   *
.*                  Added DPTM1219 to DPTM1224 for Identifying gender/pronoun * 
.*                  and free text fields                                      *
.*        V11.02.01 24/01/2022 Jacob Jackson    TSK 0864505                   *
.*                  Added preferred name option field (preferred surname      *
.*                  over 40char surname)                                      *
.*        V11.00.02 19/11/2020 Thanh T         TSK 0878747                    *
.*                  Added DPTM1217 for multiple birth                         *
.*        V11.00.01 14/04/2020 Thanh T         TSK 0879163                    *
.*                  Changed DPTM1012 to return sex associate field 1.         *
.*                  Added DPTM1216 for sex long description                   *
.*----------------------------------------------------------------------------*
.*        V10.14.03 11/06/2019 Nicole Torrisi  TSK 0870675                    *
.*                  Packed VAR with spaces - DPTM1215                         *
.*        V10.14.02 30/04/2019 Nicole Torrisi  TSK 0870675                    *
.*                  Added 215 - Email address                                 *
.*        V10.14.01 19/02/2019 Ebon Clements   TSK 0867703                    *
.*                  Changed NHI ethnicity file reads to use KEY5              *
.*        V10.13.01 15/10/2018 Richa Phogat    TSK 0862844                    *
.*                  Updated tags for DPTM1114, DPTM1115, DPTM1196             *
.*        V10.12.01 10/07/2018 Nicole Torrisi  TSK 0857785                    *
.*                  Added 214 - Alternate ID using FIRSTALT                   *
.*        V10.10.02 16/03/2017 Richa Phogat    TSK 0832066                    *
.*                  Changed DVA Card Number to be collected from              *
.*                  PMCDCNUM.PMSCCDFD instead of PREPAT.PMIMA1FD              * 
.*        V10.10.01 02/03/2017  Tracey Nguyen     TSK 0317279                 *
.*                  Fixed multi given name formatting in title case           *
.*                  (DPTM1210 and DPTM1211)                                   *
.*        V10.08.01 07/09/2016  Peter Vela        TSK 0821597                 *
.*                  Added CALRDESC - Medical Records Alert Description        *
.*        V10.05.02 02/12/2014  Nicole Torrisi    CAR 304493                  *
.*                  Changed DPTM1136 to use PACLNAME - takes 40 char PTMASNAM *
.*        V10.05.01 20/10/2014  Peter Vela        CAR 301311                  *
.*                  Added UR number with hyphen label variable                *
.*        V10.04.01 24/02/2014  Don Nguyen        CAR 291879                  *
.*                  Added field item 209 (DPTM1209) - IHI Number              *
.*                  21/02/2014  J.Tan             CAR 285504                  *
.*                  Added new variables 210 for First given name and          *
.*                  211 for Second Given name                                 *
.*        V10.03.03 09/09/2013  Nicole Torrisi    CAR 287738                  *
.*                  Added setting PACFRMT=1 in DPTM1196                       *
.*        V10.03.02 12/12/2012  Don Nguyen        CAR 277958                  *
.*                  Added DPTM1208 (Formatted Patient Name)                   *
.*        V10.03.01 30/11/2011  Jill Parkinson    CAR 249362                  *
.*                  Changed alert keys                                        *
.*        V10.02.03 11/10/2011  Saroeun Soeur     CAR 246773                  *
.*                  added DPTM1201,DPTM1202,DPTM1203,DPTM1204,DPTM1204        *
.*                  DPTM1205,DPTM1206,DPTM1207                                * 
.*        V10.02.02 22/09/2011  Davin             CAR 248749                  *
.*                  Added vars 197 (pmpxfnam) & 198 (pmpxsnam)                *
.*                  Added vars 199 (medalert) & 200 (micalert)                *
.*        V10.02.01 09/06/2011  Ebon Clements     CAR 239530                  *
.*                  Added print extra contact functionality                   *
.*        V10.01.01 13/01/2011  Jill Parkinson    CAR 236279                  *
.*                  Added use of PTMASNAM                                     *
.*        V10.00.02 04/10/2010  Steve Armstrong   CAR 231275                  *
.*                  Mods to add the following variables:                      *
.*                  194 - Local GP Surgery Fax                                *
.*                  195 - Local GP Code                                       *
.*                  196 - Local GP Formatted Name                             *
.*        V10.00.01 16/09/2010  Ebon Clements     CAR 230238                  *
.*                  Read practice before printing practice name (DPTM1117)    *
.******************************************************************************
.*        V9.12.02  13/10/2009  WeeLee Koo        CAR 205308                  *
.*                  Cleared Field for PMHGPTEL before using (DPTM1119)        *
.*                  Added individual read function to all PMHGXXXX            *
.*        V9.12.01  04/08/2009  Peter Vela        CAR 202478                  *
.*                  Added HCP Surgery Telephone Number for PMPXRHC1           *
.*        V9.11.01  22/10/2008  Peter Vela        CAR 180404                  *
.*                  Added Concession Card variables                           *
.*                  Added DVA Card variables                                  *
.*                  Added Pension card variables                              *
.*        V9.10.01  16/05/2008  Ebon Clements     CAR 166563                  *
.*                  Added safety net card variables                            *
.*        V9.09.03  19/11/2007  Peter Vela        CAR 110766                  *
.*                  Added new address variables with defaulting functionality *
.*                  (postal -> PMI)                                           *
.*        V9.09.02  01/08/2007  J.Tan             CAR 146650                  *
.*                  Fixed printing blank health fund                          *
.*        V9.09.01  12/07/2007  Peter Vela        CAR 142913                  *
.*                  Added PMSCCDFD Concession Card variables                  *
.*                  Card Type (Code and Desc)                                 *
.*                  Card Number                                               *
.*                  Card Expiry Date                                          *
.*        V9.08.02  15/12/2006  J.Tan             CAR 125800                  *
.*                  - Fixed HRN No                                            *
.*        V9.08.01  23/11/2006  Steve Armstrong   CAR 125800                  *
.*                  - Added Current Date (166) and Singapore HRN (167)        *
.******************************************************************************
.*        V9.07.02  20/09/2006 Peter Vela CAR 118225                          *
.*                  - Changed Preferred Given Parameters  and Surname         *
.*                    to DIM fields                                           *
.*        V9.07.01  08/09/2006 Peter Vela CAR 118225                          *
.*                  - Added Preferred Given Name                              *
.*                  - Added Preferred Surname                                 *
.*                  - Added Preferred Given Name instead of Actual Given Name *
.*                  - Added Preferred Surname instead of Actual Surname       *
.*        V9.04.03  23/09/2005 J.Tan      CAR 73899                           *
.*                  - Added GP Practice Address 2,3,4 and postcode            *
.*        V9.04.02  18/01/2005 Peter Vela CAR 55331                           *
.*                  - Add Mobile Number                                       *
.*                  - Correct display of Med expiry date                      *
.*        V9.04.01  21/09/2004 J.Tan                                          *
.*                  - Add Medicare expiry date                                *
.*        V9.03.01  11/06/2004  Mike Laming   CAR 49016  July 2004 PRS/2      *
.*                  - Add Sex Description routine SEXDSC00 with Code "R" -    *
.*                  "Intersex" added                                          *
.*        V9.00.B01 13/07/2001  Sandra Barcham                                *
.*                  Replaced GP with HCP                                      *
.*        V5.09.B02 01/02/2001  Greg Horvat                                   *
.*                  Changed to not use CODE?? variables for setting up the    *
.*                  TCODE variable                                            *
.*        V5.09.B01 10/01/2001  Greg Horvat                                   *
.*                  Replaced DIM6 with KEY6                                   *
.*        V5.08.03  27/09/2000  Dean Cramer                                   *
.*                  Mods to include PTMXSLAC - SLA Code                       *
.*        V5.08.02  28/08/2000  Tonii                                         *
.*                  Mods to accept Unknown and Indeterminate as valid patient *
.*                  sex description                                           *
.*        V5.08.01  06/06/2000  Jill Habasque                                 *
.*                  Changed from key10 to key14 for the health fund file      *
.*        V5.07.02  27/10/1999  Katie Nelson                                  *
.*                  Added Free Format Text Line (LABELS)                      *
.*        V5.07.01  10/03/1999  Jim Stathopoulos                              *
.*                  Fixed Health Fund Table Error                             *
.******************************************************************************
.*        V5.06.02  09/11/1998  Steve Armstrong                               *
.*                  Mods to get national no. using PMIGTNID                   *
.*        V5.06.01  15/06/1998  Glenn Berry        SRF 644421                 *
.*                  Read GP Codes file first for field 115                    *
.******************************************************************************
.*        V5.05.03  16/12/1997  Steve Armstrong    EMR                        *
.*                  Mods for new field PTMXMCCD                               *
.*        V5.05.02  02/10/1997  Steve Armstrong            THC                *
.*                  Added code for Formatted Name (which was missing for      *
.*                  item 136 for LABELS).                                     *
.*                  Added item 152 for Formatted Address (for LABELS)         *
.*        V5.05.01  17/09/1997  Steve Armstrong    SRF 642860                 *
.*                  Mods for age definition (d,w,m,y)                         *
.******************************************************************************
.*        V5.01.01  15/09/92  J.Tan        SRF 117083                         *
.*                  Added LGA Code                                            *
.*        V5.01.02  15/10/1992  Justin Coates     (HONG KONG changes)         *
.*                  Changed to use DISPITEM (not dxsetval)                    *
.*        V5.01.03  10/02/1993  i chung           SRF 120620                  *
.*                  Fixed incorrect description displayed for "Health Fund" - *
.*                  Label DPTMS101                                            *
.*        V5.01.04  24/02/1993  Steve O'Gorman                                *
.*                  Fixed display of Pension Number Expiry DateHealth Fund" - *
.*        V5.01.05  22/09/1993  RKS                                           *
.*                  Added Registration Date                                   *
.*        V5.01.06  18/10/1993  RKS                                           *
.*                  Added Special Meal                                        *
.*        V5.01.07  03/11/1993    Justin Coates  QUOTE 440017 SRF 440204      *
.*                  added display of practice count to practice code field    *
.*        V5.01.08  1/12/93       Ian Rutt Mt Alvernia Mods #3.1              *
.*                  added display of emp. code NOK occ., NOK emp code and     *
.*                  death certificate number                                  * 
.*        V5.01.09  29/03/1994    Justin Coates                               *
.*                  unpack plddate the correct way                            *
.*        V5.01.10  12/04/1994    Justin Coates                               *
.*                  added display of variable 127                             *
.*        V5.01.11  15/04/1994  Steve Armstrong                               *
.*                  Fixed read of health fund file (packing key with spaces   *
.*                  instead of zeroes)                                        *
.*        V5.01.12  05/06/1995  ROD                                           *
.*                  Add Resident Status and Ethnicity (NHI only) items        *
.*        V5.03.01  05/10/1995    Howellsy      suht                          *
.*                  added call to KOSDTE00                                    *
.*        V5.03.02  26/04/1996  Steve Armstrong   5.04 Mods                   *
.*                  Added Kiwi Card Details                                   *
.*        V5.04.01  12/07/1996  Howellsy           5.04 MOH                   *
.*                  Added nhi ethnicity 2 & 3 as display only                 *
.*       V5.04.02  14/02/1997    Howellsy     WHT                             *
.*                 Added Cellular Phone Number & Postal Address               *
.******************************************************************************
DXPATMAS  PACK      VAR,SP30,SP30,SP20
          MOVE      SCPSITM,FIELDNO
          BRANCH    FIELDNO,DPTM1001,DPTM1002,DPTM1003,DPTM1004,DPTM1005:
                            DPTM1006,DPTM1007,DPTM1008,DPTM1009,DPTM1010:  *10
                            DPTM1011,DPTM1012,DPTM1013,DPTM1014,DPTM1015:
                            DPTM1016,DPTM1017,DPTM1018,DPTM1019,DPTM1020:  *20 
                            DPTM1021,DPTM1022,DPTM1023,DPTM1024,DPTM1025:
                            DPTM1026,DPTM1027,DPTM1028,DPTM1029,DPTM1030:  *30
                            DPTM1031,DPTM1032,DPTM1033,DPTM1034,DPTM1035:
                            DPTM1036,DPTM1037,DPTM1038,DPTM1039,DPTM1040:  *40
                            DPTM1041,DPTM1042,DPTM1043,DPTM1044,DPTM1045:
                            DPTM1046,DPTM1047,DPTM1048,DPTM1049,DPTM1050:  *50
                            DPTM1051,DPTM1052,DPTM1053,DPTM1054,DPTM1055:
                            DPTM1056,DPTM1057,DPTM1058,DPTM1059,DPTM1060:  *60
                            DPTM1061,DPTM1062,DPTM1063,DPTM1064,DPTM1065:
                            DPTM1066,DPTM1067,DPTM1068,DPTM1069,DPTM1070:  *70
                            DPTM1071,DPTM1072,DPTM1073,DPTM1074,DPTM1075:
                            DPTM1076,DPTM1077,DPTM1078,DPTM1079,DPTM1080:  *80
                            DPTM1081,DPTM1082,DPTM1083,DPTM1084,DPTM1085:
                            DPTM1086,DPTM1087,DPTM1088,DPTM1089,DPTM1090:  *90
                            DPTM1091,DPTM1092,DPTM1093,DPTM1094,DPTM1095:
                            DPTM1096,DPTM1097,DPTM1098,DPTM1099,DPTM1100:  *100
                            DPTM1101,DPTM1102,DPTM1103,DPTM1104,DPTM1105:
                            DPTM1106,DPTM1107,DPTM1108,DPTM1109,DPTM1110:  *110
                            DPTM1111,DPTM1112,DPTM1113,DPTM1114,DPTM1115:
                            DPTM1116,DPTM1117,DPTM1118,DPTM1119,DPTM1120:  *120
                            DPTM1121,DPTM1122,DPTM1123,DPTM1124,DPTM1125:
                            DPTM1126,DPTM1127,DPTM1128,DPTM1129,DPTM1130:  *130
                            DPTM1131,DPTM1132,DPTM1133,DPTM1134,DPTM1135:
                            DPTM1136,DPTM1137,DPTM1138,DPTM1139,DPTM1140:  *140
                            DPTM1141,DPTM1142,DPTM1143,DPTM1144,DPTM1145:
                            DPTM1146,DPTM1147,DPTM1148,DPTM1149,DPTM1150:  *150
                            DPTM1151,DPTM1152,DPTM1153,DPTM1154,DPTM1155:
                            DPTM1156,DPTM1157,DPTM1158,DPTM1159,DPTM1160:  *160
                            DPTM1161,DPTM1162,DPTM1163,DPTM1164,DPTM1165:
                            DPTM1166,DPTM1167,DPTM1168,DPTM1169,DPTM1170:  *170
                            DPTM1171,DPTM1172,DPTM1173,DPTM1174,DPTM1175:
                            DPTM1176,DPTM1177,DPTM1178,DPTM1179,DPTM1180:  *180
                            DPTM1181,DPTM1182,DPTM1183,DPTM1184,DPTM1185:
                            DPTM1186,DPTM1187,DPTM1188,DPTM1189,DPTM1190:  *190
                            DPTM1191,DPTM1192,DPTM1193,DPTM1194,DPTM1195:
                            DPTM1196,DPTM1197,DPTM1198,DPTM1199,DPTM1200:  *200
		            DPTM1201,DPTM1203,DPTM1203,DPTM1204,DPTM1205:
		            DPTM1206,DPTM1207,DPTM1208,DPTM1209,DPTM1210:  *210
                            DPTM1211,DPTM1212,DPTM1213,DPTM1214,DPTM1215:
                            DPTM1216,DPTM1217,DPTM1218,DPTM1219,DPTM1220:  *220
                            DPTM1221,DPTM1222,DPTM1223,DPTM1224,DPTM1225:
                            DPTM1226,DPTM1227,DPTM1228,DPTM1229,DPTM1230:  *230
                            DPTM1231,DPTM1232,DPTM1233,DPTM1234,DPTM1235:
                            DPTM1236    
.
          GOTO      DPTMS999
.
.===================================================================
.
DPTM1001  PACK      VAR,PTITL,SP70,SP10     * title
          GOTO      DPTMS995
.
DPTM1002  MATCH     SP70,PTMASNAM
          IF        !@EQUAL
            PACK      VAR,PTMASNAM,SP70,SP10    * surname
          ELSE
            PACK      VAR,PSNAME,SP70,SP10    * surname
          ENDIF
          GOTO      DPTMS995
.
DPTM1003  PACK      VAR,PGNAME,SP70,SP10    * given name
          GOTO      DPTMS995
.
DPTM1004  PACK      VAR,PPSNAME,SP70,SP10   * previous surname
          GOTO      DPTMS995
.
DPTM1005  PACK      VAR,PADD1,SP70,SP10     * address 1
          GOTO      DPTMS995
.
DPTM1006  PACK      VAR,PADD2,SP70,SP10     * address 2
          GOTO      DPTMS995
.
DPTM1007  PACK      VAR,PSUBRB,SP70,SP10    * suburb
          GOTO      DPTMS995
.
DPTM1008  PACK      VAR,PADD4,SP70,SP10     * address 2
          GOTO      DPTMS995
.
DPTM1009  PACK      VAR,PPOST,SP70,SP10     * post code
          GOTO      DPTMS995
.
DPTM1010  PACK      VAR,PTELEP,SP70,SP10    * private phone
          GOTO      DPTMS995
.
DPTM1011  PACK      VAR,PTELEB,SP70,SP10    * busines phone
          GOTO      DPTMS995
.
DPTM1012  MOVE      SP6,KEY6                * sex
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSP00                * get sex associate field 1
          PACK      VAR,DSEXASC1,SP70      
          GOTO      DPTMS995
.
DPTM1013  PACK      VAR,PMSTAT,SP70,SP10    * marital status
          GOTO      DPTMS995
.
DPTM1014  MOVE      PMSTAT,ACODE
          MOVE      "M ",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1015  UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          IF        SCPSLEN = 8
            PACK      VAR,CPDATE,SP70,SP10
          ELSE
            PACK      VAR,CPCDATE,SP70,SP10
          ENDIF
          GOTO      DPTMS995
.
DPTM1016  PACK      VAR,PCONT,SP70,SP10     * country of birth
          GOTO      DPTMS995
.
DPTM1017  MOVE      PCONT,ACODE
          MOVE      "C ",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1018  PACK      VAR,PREG,SP70,SP10      * religon
          GOTO      DPTMS995
.
DPTM1019  MOVE      PREG,ACODE
          MOVE      "R ",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1020  PACK      VAR,PTYPE,SP70,SP10     * patient type
          GOTO      DPTMS995
.
DPTM1021  MOVE      PTYPE,ACODE
          MOVE      "T ",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1022  PACK      VAR,POCCUP,SP70,SP10    * occupation
          GOTO      DPTMS995
.
DPTM1023  PACK      VAR,PMEDI,SP70,SP10     * medicare number
          GOTO      DPTMS995
.
DPTM1024  PACK      VAR,PPENNO,SP70,SP10    * pension number
          GOTO      DPTMS995
.
DPTM1025  UNPACK    PPNDTE,CCENT,CYEAR,CMON
          PACK      VAR,CMON,SLASH,CCENT,CYEAR,SP70,SP10
          GOTO      DPTMS995
.
DPTM1026  MOVE      THREE,DIM1              * set for DVA card type
          CALL      CONCAD00                * get DVA card details
          PACK      VAR,PMCDCNUM,SP70,SP10  * repatriation number
          GOTO      DPTMS995
.
DPTM1027  MOVE      DUNK,CCITEMD            * smoker
          LOAD      CCITEMD,PSMOK,DYES,DNO
          PACK      VAR,CCITEMD,SP70,SP10
          GOTO      DPTMS995
.
DPTM1028  PACK      VAR,PUSR1,SP70,SP10     * PMI UD field 1
          GOTO      DPTMS995
.
DPTM1029  MOVE      PUSR1,ACODE
          MOVE      "P1",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1030  PACK      VAR,PUSR2,SP70,SP10     * PMI UD field 2
          GOTO      DPTMS995
.
DPTM1031  MOVE      PUSR2,ACODE
          MOVE      "P2",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1032  PACK      VAR,PUSR3,SP70,SP10     * PMI UD field 3
          GOTO      DPTMS995
.
DPTM1033  MOVE      PUSR3,ACODE
          MOVE      "P3",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1034  PACK      VAR,PUSR4,SP70,SP10     * PMI UD field 4
          GOTO      DPTMS995
.
DPTM1035  MOVE      PUSR4,ACODE
          MOVE      "P4",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1036  PACK      VAR,PUSR5,SP70,SP10     * PMI UD field 5
          GOTO      DPTMS995
.
DPTM1037  MOVE      PUSR5,ACODE
          MOVE      "P5",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1038  PACK      VAR,PUSR6,SP70,SP10     * PMI UD field 6
          GOTO      DPTMS995
.
DPTM1039  MOVE      PUSR6,ACODE
          MOVE      "P6",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1040  MATCH     SP8,PTMXOSDT
          IF        !@EQUAL
            IF        PCEASE=1
              MOVE      PTMXOSDT,CYRSFDTE
              MOVE      PDECDTE,CYRSTDTE
              CALL      CALCYRS                   * calculate the no of years 
              MOVE      CYRSYEAR,PYRRES
            ELSE
              MOVE      PTMXOSDT,CYRSFDTE
              PACK      CYRSTDTE,CCC,CYY,CMM,CDD
              CALL      CALCYRS                   * calculate the no of years 
              MOVE      CYRSYEAR,PYRRES
            ENDIF
          ENDIF
.
          PACK      VAR,PYRRES,SP70,SP10    * years resident
          GOTO      DPTMS995
.
DPTM1041  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE            * Next of Kin
            CALL      XCON0000                * Get extra contact details
            MOVE      PMCESNAM,PACSNAME
            MOVE      PMCEGNAM,PACGNAME
            MOVE      PMCETITL,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            PACK      VAR,PACFNAME,SP70,SP10
          ELSE
            PACK      VAR,PNKNAME,SP70,SP10   * NOK name
          ENDIF
          GOTO      DPTMS995
.
DPTM1042  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE            * Next of Kin
            CALL      XCON0000                * Get extra contact details
            PACK      VAR,PMCEADD1,SP70,SP10
          ELSE
            PACK      VAR,PNKADD1,SP70,SP10   * NOK address 1
          ENDIF
          GOTO      DPTMS995
.
DPTM1043  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE            * Next of Kin
            CALL      XCON0000                * Get extra contact details
            PACK      VAR,PMCEADD2,SP70,SP10
          ELSE
            PACK      VAR,PNKADD2,SP70,SP10   * NOK address 2
          ENDIF
          GOTO      DPTMS995
.
DPTM1044  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE            * Next of Kin
            CALL      XCON0000                * Get extra contact details
            PACK      VAR,PMCEADD3,SP70,SP10
          ELSE
            PACK      VAR,PNKSUBR,SP70,SP10   * NOK suburb
          ENDIF
          GOTO      DPTMS995
.
DPTM1045  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE            * Next of Kin
            CALL      XCON0000                * Get extra contact details
            PACK      VAR,PMCEADD4,SP70,SP10
          ELSE
            PACK      VAR,PNKADD4,SP70,SP10   * NOK address 2
          ENDIF
          GOTO      DPTMS995
.
DPTM1046  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE            * Next of Kin
            CALL      XCON0000                * Get extra contact details
            PACK      VAR,PMCEPOST,SP70,SP10
          ELSE
            PACK      VAR,PNKPOST,SP70,SP10   * NOK post code
          ENDIF
          GOTO      DPTMS995
.
DPTM1047  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE            * Next of Kin
            CALL      XCON0000                * Get extra contact details
            PACK      VAR,PMCETELP,SP70,SP10
          ELSE
            PACK      VAR,PNKTELP,SP70,SP10   * NOK private phone
          ENDIF
          GOTO      DPTMS995
.
DPTM1048  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE            * Next of Kin
            CALL      XCON0000                * Get extra contact details
            PACK      VAR,PMCETELB,SP70,SP10
          ELSE
            PACK      VAR,PNKTELB,SP70,SP10   * NOK business phone
          ENDIF
          GOTO      DPTMS995
.
DPTM1049  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE            * Next of Kin
            CALL      XCON0000                * Get extra contact details
            PACK      VAR,PMCERELP,SP70,SP10
          ELSE
            PACK      VAR,PNKRELP,SP70,SP10   * NOK relationship
          ENDIF
          GOTO      DPTMS995
.
DPTM1050  PACK      VAR,PMICRO,SP70,SP10    * microfilm address
          GOTO      DPTMS995
.
.         Patient age - se if displaying d,w,m,y with age
.
DPTM1051  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,EIGHTY;*229,PTCNDATE
          IF        PTCNDATE = 1
            CALL      IBACLOCK
            PACK      AGEDATE,CCC,CYY,CMM,CDD
            REP       " 0",AGEDATE
            CALL      CALCAGE
            REP       UPPLOW,PSAGETYP
          ELSE
            UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CDAY,IDAY
            MOVE      CMON,IMON
            MOVE      CYEAR,IYEAR
            MOVE      CCENT,ICENT
          ENDIF
.
. Calculate patients age
.
          CALL      AGECHK
          IF        PTCNDATE = 1
            PACK      VAR,PSAGECON,PSAGETYP,SP70,SP10
          ELSE
            PACK      VAR,PSAGE,SP70,SP10
          ENDIF
          GOTO      DPTMS995
.
DPTM1052  MOVE      SP3,CCITEMD                * familial history
          MATCH     SP1,PTMXFHMD
          IF        !@EQUAL
            MATCH     "1",PTMXFHMD
            IF        @EQUAL
              MOVE      DYES,CCITEMD
            ELSE
              MOVE      DNO,CCITEMD
            ENDIF
          ENDIF
          PACK      VAR,CCITEMD,SP70,SP10
          GOTO      DPTMS995
.
DPTM1053  PACK      VAR,PTMXMHU1,SP70,SP10  * Extension UD field 1
          GOTO      DPTMS995
.
DPTM1054  MOVE      PTMXMHU1,ACODE
          MOVE      "V6",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1055  PACK      VAR,PTMXMHU2,SP70,SP10  * Extension UD field 2
          GOTO      DPTMS995
.
DPTM1056  MOVE      PTMXMHU2,ACODE
          MOVE      "V7",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1057  PACK      VAR,PTMXMHU3,SP70,SP10  * Extension UD field 3
          GOTO      DPTMS995
.
DPTM1058  MOVE      PTMXMHU3,ACODE
          MOVE      "V8",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1059  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCESNAM,PACSNAME
            MOVE      PMCEGNAM,PACGNAME
            MOVE      PMCETITL,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            PACK      VAR,PACFNAME,SP70,SP10
          ELSE
            PACK      VAR,PTMXECNM,SP70,SP10  * EC name
          ENDIF
          GOTO      DPTMS995
.
DPTM1060  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD1,SP70,SP10
          ELSE
            PACK      VAR,PTMXECA1,SP70,SP10  * EC address 1
          ENDIF
          GOTO      DPTMS995
.
DPTM1061  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD2,SP70,SP10
          ELSE
            PACK      VAR,PTMXECA2,SP70,SP10  * EC address 2
          ENDIF
          GOTO      DPTMS995
.
DPTM1062  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD3,SP70,SP10
          ELSE
            PACK      VAR,PTMXECA3,SP70,SP10  * EC address 3
           ENDIF
          GOTO      DPTMS995
.
DPTM1063  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD4,SP70,SP10
          ELSE
            PACK      VAR,PTMXECA4,SP70,SP10  * EC address 4
          ENDIF
          GOTO      DPTMS995
.
DPTM1064  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEPOST,SP70,SP10
          ELSE
            PACK      VAR,PTMXECPC,SP70,SP10  * EC post code
          ENDIF
          GOTO      DPTMS995
.
DPTM1065  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCETELP,SP70,SP10
          ELSE
            PACK      VAR,PTMXECPP,SP70,SP10  * EC private phone
          ENDIF
          GOTO      DPTMS995
.
DPTM1066  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCETELB,SP70,SP10
          ELSE
            PACK      VAR,PTMXECBP,SP70,SP10  * EC business phone
          ENDIF
          GOTO      DPTMS995
.
DPTM1067  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "3",CONTTYPE          * Emergency Contact
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCERELP,SP70,SP10
          ELSE
            PACK      VAR,PTMXECRE,SP70,SP10  * EC relative
          ENDIF
          GOTO      DPTMS995
.
DPTM1068  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            MOVE      PMCESNAM,PACSNAME
            MOVE      PMCEGNAM,PACGNAME
            MOVE      PMCETITL,PACTITLE
            MOVE      "1",PACFRMT
            CALL      PACNAME
            PACK      VAR,PACFNAME,SP70,SP10
          ELSE
            PACK      VAR,PTMXNRNM,SP70,SP10  * nearest relative name
          ENDIF
          GOTO      DPTMS995
.
DPTM1069  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD1,SP70,SP10
          ELSE
            PACK      VAR,PTMXNRA1,SP70,SP10  * nearest relative address 1
          ENDIF
          GOTO      DPTMS995
.
DPTM1070   MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD2,SP70,SP10
          ELSE
            PACK      VAR,PTMXNRA2,SP70,SP10  * nearest relative address 2
          ENDIF
          GOTO      DPTMS995
.
DPTM1071  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD3,SP70,SP10
          ELSE
            PACK      VAR,PTMXNRA3,SP70,SP10  * nearest relative address 3
          ENDIF
          GOTO      DPTMS995
.
DPTM1072  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD4,SP70,SP10
          ELSE
            PACK      VAR,PTMXNRA4,SP70,SP10  * nearest relative address 4
          ENDIF
          GOTO      DPTMS995
.
DPTM1073  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEPOST,SP70,SP10
          ELSE
            PACK      VAR,PTMXNRPC,SP70,SP10  * nearest relative post code
          ENDIF
          GOTO      DPTMS995
.
DPTM1074  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCETELP,SP70,SP10
          ELSE
            PACK      VAR,PTMXNRPP,SP70,SP10  * nearest relative private phone
          ENDIF
          GOTO      DPTMS995
.
DPTM1075  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCETELB,SP70,SP10
          ELSE
            PACK      VAR,PTMXNRBP,SP70,SP10  * nearest relative business phone
          ENDIF
          GOTO      DPTMS995
.
DPTM1076  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "8",CONTTYPE          * Nearest Relative
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCERELP,SP70,SP10
          ELSE
            PACK      VAR,PTMXNRRE,SP70,SP10  * nearest relative relative
          ENDIF
          GOTO      DPTMS995
.
DPTM1077  PACK      VAR,PKNAME,SP70,SP10    * PRA name
          GOTO      DPTMS995
.
DPTM1078  PACK      VAR,PKADD1,SP70,SP10    * PRA address 1
          GOTO      DPTMS995
.
DPTM1079  PACK      VAR,PKADD2,SP70,SP10    * PRA address 2
          GOTO      DPTMS995
.
DPTM1080  PACK      VAR,PKSUBR,SP70,SP10    * PRA address 3
          GOTO      DPTMS995
.
DPTM1081  PACK      VAR,PKADD4,SP70,SP10    * PRA address 4
          GOTO      DPTMS995
.
DPTM1082  PACK      VAR,PKPOST,SP70,SP10    * PRA post code
          GOTO      DPTMS995
.
DPTM1083  PACK      VAR,PKTELEP,SP70,SP10   * PRA private phone
          GOTO      DPTMS995
.
DPTM1084  PACK      VAR,PKTELEB,SP70,SP10   * PRA business phone
          GOTO      DPTMS995
.
DPTM1085  PACK      VAR,PKRELP,SP70,SP10    * PRA relative
          GOTO      DPTMS995
.
DPTM1086  PACK      VAR,PURNO,SP70,SP10     * U/R number
          GOTO      DPTMS995
.
DPTM1087  PACK      VAR,PTMXCHNM,SP70,SP10  * chinese name
          GOTO      DPTMS995
.
DPTM1088  PACK      VAR,PLOCDOC,SP70,SP10   * local doctor
          GOTO      DPTMS995
.
DPTM1089  IF        PCASE = 1
            MOVE      DYES,CCITEMD
          ELSE
            MOVE      DNO,CCITEMD
          ENDIF
          PACK      VAR,CCITEMD,SP70,SP10      * case notes
          GOTO      DPTMS995
.
DPTM1090  IF        PCEASE = 1
            MOVE      DYES,CCITEMD
          ELSE
            MOVE      DNO,CCITEMD
          ENDIF
          PACK      VAR,CCITEMD,SP70,SP10      * deceased indicator
          GOTO      DPTMS995
.
DPTM1091  UNPACK    SP20,CPCDATE,CPDATE     * date of death
          MATCH     SP8,PDECDTE
          IF        !@EQUAL
            UNPACK    PDECDTE,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
          ENDIF
          IF        SCPSLEN = 8
            PACK      VAR,CPDATE,SP70,SP10
          ELSE
            PACK      VAR,CPCDATE,SP70,SP10
          ENDIF
          GOTO      DPTMS995
.
DPTM1092  IF        PAUTOPY = 1
            MOVE      DYES,CCITEMD
          ELSE
            MOVE      DNO,CCITEMD
          ENDIF
          PACK      VAR,CCITEMD,SP70,SP10      * autopsy
          GOTO      DPTMS995
.
DPTM1093  IF        PHOSP = 1
            MOVE      "20",SCPSLEN
            UNPACK    PLDDATE,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            PACK      VAR,DYES,PLDAYS,SP2,CPDATE,SP70,SP70
          ELSE
            MOVE      "20",SCPSLEN
            PACK      VAR,DNO,SP70,SP70
          ENDIF
          GOTO      DPTMS995
.
DPTM1094  PACK      VAR,PHIGH1,SP70,SP10    * highlight code 1
          GOTO      DPTMS995
.
DPTM1095  MOVE      PHIGH1,ACODE
          MOVE      "H1",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1096  PACK      VAR,PHIGH2,SP70,SP10    * highlight code 2
          GOTO      DPTMS995
.
DPTM1097  MOVE      PHIGH2,ACODE
          MOVE      "H2",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1098  PACK      VAR,PHIGH3,SP70,SP10    * highlight code 3
          GOTO      DPTMS995
.
DPTM1099  MOVE      PHIGH3,ACODE
          MOVE      "H3",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1100  IF        PUYN1 = 1
            MOVE      DYES,CCITEMD
          ELSE
            MOVE      DNO,CCITEMD
          ENDIF
          PACK      VAR,CCITEMD,SP70,SP10      * Yes/No field 1
          GOTO      DPTMS995
.
DPTM1101  IF        PUYN2 = 1
            MOVE      DYES,CCITEMD
          ELSE
            MOVE      DNO,CCITEMD
          ENDIF
          PACK      VAR,CCITEMD,SP70,SP10      * Yes/No field 2
          GOTO      DPTMS995
.
DPTM1102  IF        PUYN3 = 1
            MOVE      DYES,CCITEMD
          ELSE
            MOVE      DNO,CCITEMD
          ENDIF
          PACK      VAR,CCITEMD,SP70,SP10      * Yes/No field 3
          GOTO      DPTMS995
.
DPTM1103  PACK      VAR,PDIET,SP70,SP10     * diet code
          GOTO      DPTMS995
.
DPTM1104  MOVE      PDIET,ACODE
          MOVE      "DC",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1105  PACK      VAR,PFUNDH,SP70,SP10    * health fund
          GOTO      DPTMS995
.
DPTM1106  MATCH     SP70,PFUNDH
          IF        @EQUAL
            MOVE      SP70,HFNAME
          ELSE
            PACK      KEY14,PFUNDH,ZERO,ZERO,ZERO,ZERO,SP10
            OPEN      PATFN1A1,"patfn1af"
            MOVE      "Invalid Health Fund",HFNAME
            CALL      RDFUND1
          ENDIF
          PACK      VAR,HFNAME,SP70,SP10
          GOTO      DPTMS995
.
DPTM1107  PACK      VAR,PFNDTB,SP70,SP10    * health fund table
          GOTO      DPTMS995
.
DPTM1108  PACK      KEY14,PFUNDH,PFNDTB,SP10
          OPEN      PATFN1A1,"patfn1af"
.
          MATCH     KEY14,SP10
          IF        @EQUAL
            MOVE      SP70,HFNAME
          ELSE
            MOVE      "Invalid Health Fund Table",HFNAME
          ENDIF
.
          CALL      RDFUND1
          PACK      VAR,HFNAME,SP70,SP10
          GOTO      DPTMS995
.
DPTM1109  PACK      VAR,PFNDMM,SP70,SP10    * health fund membership number
          GOTO      DPTMS995
.
DPTM1110  CALL      PMIGTNID
          MOVE      NMPNUMB,KEY20           * national UR number
          SQUEEZE   KEY20 
          PACK      VAR,KEY20,SP70,SP10
          GOTO      DPTMS995
.
DPTM1111  PACK      VAR,PTMXLGA,SP70,SP10   * LGA code
          GOTO      DPTMS995
.
DPTM1112  PACK      VAR,PTMXDOFR,SP70,SP10  * District of Residence
          GOTO      DPTMS995
.
DPTM1113  MOVE      PTMXDOFR,ACODE
          MOVE      "DA",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1114  MOVE      SP35,PMHCSNAM
          MOVE      SP10,PMHCHCPC
          PACK      KEY8,PURNO,SP10
          CALL      RDPMPX21
          IF        OVRCD=0
            PACK      KEY10,PMPXRHC1,SP70           * Registered HCP
            CALL      RDPMHCP1
          ENDIF
            PACK      VAR,PMHCHCPC,SP70,SP10
          GOTO      DPTMS995
.
DPTM1115  MOVE      SP35,PMHCSNAM
          MOVE      SP10,PMHCHCPC
          MOVE      SP70,PACFNAME
          PACK      KEY8,PURNO,SP10
          CALL      RDPMPX21
          IF        OVRCD = 0
            PACK      KEY10,PMPXRHC1,SP70           * Registered HCP Name
            CALL      RDPMHCP1
.
            PACK      PMHCSNAM,PMHCSNAM,SP20
            MATCH     SP35,PMHCSNAM
            IF        @EQUAL
              PACK      VAR,SP70,SP10
            ELSE
              MOVE      TWO,PACFRMT
              MOVE      PMHCGNAM,ANS 
              MOVE      ANS,PACGNAME
              MOVE      PMHCSNAM,PACSNAME
              CLEAR     PACTITLE
              CALL      PACNAME
            ENDIF
          ENDIF
          PACK      VAR,PACFNAME,SP70,SP10  * Registered HCP name
          GOTO      DPTMS995
.
DPTM1116  MOVE      SP70,PMHGADD1
          MATCH     SP10,PMPXRH1G
          IF        @EQUAL
            MOVE      SP70,PMHGPNAM
          ELSE
            MOVE      "Invalid GP Practice Code",PMHGPNAM
          ENDIF
          PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70  * HCP Practice code
          CALL      RDPMHCG1
          MOVE      "-",ANS
          MATCH     SP2,PMPXR1GC
          IF        @EQUAL
            MOVE      SP1,ANS
          ENDIF
          PACK      VAR,PMPXRH1G,ANS,PMPXR1GC,SP70,SP10
          GOTO      DPTMS995
.
DPTM1117  PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          IF        OVRCD=1
            MOVE      SP70,PMHGPNAM
          ENDIF
.
          PACK      VAR,PMHGPNAM,SP70,SP10  * HCP Practice Name
          GOTO      DPTMS995
.
DPTM1118  PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          IF        OVRCD = 1
            MOVE      SP70,PMHGADD1
          ENDIF
.
          PACK      VAR,PMHGADD1,SP70,SP10  * HCP Practice Address Line 1
          GOTO      DPTMS995
.
DPTM1119  PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          IF        OVRCD = 1
            MOVE      SP70,PMHGPTEL
          ENDIF
.
          PACK      VAR,PMHGPTEL,SP70,SP10  * HCP Practice Phone Number
          GOTO      DPTMS995
.
DPTM1120  PACK      VAR,PTMXSPID,SP70,SP10  * Supplemntary Id
          GOTO      DPTMS995
.
DPTM1121  PACK      VAR,PTMAEMPC,SP70,SP10
          GOTO      DPTMS995
.
DPTM1122  MOVE      SP30,GNAME
          PACK      KEY6,PTMAEMPC,SP6
          CALL      RDGOVR1
          PACK      VAR,GNAME,SP70,SP10
          GOTO      DPTMS995
.
DPTM1123  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      SP70,VAR  
          ELSE
            PACK      VAR,PTMANOKO,SP70,SP10
          ENDIF
          GOTO      DPTMS995
.
DPTM1124  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      SP70,VAR
          ELSE
            PACK      VAR,PTMANOKE,SP70,SP10
          ENDIF
          GOTO      DPTMS995
.
DPTM1125  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      SP70,VAR
          ELSE
            MOVE      SP30,GNAME
            PACK      KEY6,PTMANOKE,SP6
            CALL      RDGOVR1
            PACK      VAR,GNAME,SP70,SP10
          ENDIF
          GOTO      DPTMS995
.
DPTM1126  PACK      VAR,PTMADCNO,SP70,SP10
          GOTO      DPTMS995
.
DPTM1127  PACK      VAR,PMPXRHC1,SP70,SP10
          MOVE      SP35,PMHCSNAM
          PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1
          GOTO      DPTMS995
.
DPTM1128  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      DPTMS999 IF NOT EQUAL
          PACK      VAR,SP70,SP70                 * Resident Status (NHI only)
          MATCH     "Y",NHMARES
          IF        @EQUAL
            PACK      VAR,DYES,SP70,SP70
          ENDIF
          MATCH     "N",NHMARES
          IF        @EQUAL
            PACK      VAR,DNO,SP70,SP70
          ENDIF
          GOTO      DPTMS995
.
DPTM1129  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      DPTMS999 IF NOT EQUAL
          PACK      VAR,NHMAETH,SP70,SP70         * Ethnicity code (NHI only)
          GOTO      DPTMS995
.
DPTM1130  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      DPTMS999 IF NOT EQUAL
          MATCH     SP5,NHMAETH                   * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VAR,SP70,SP70
            GOTO      DPTMS995
          ENDIF
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH,SP70
          CALL      RDNHETH1
          PACK      VAR,NHETDES,SP70,SP70
          GOTO      DPTMS995
.
DPTM1131  UNPACK    SP20,CPCDATE,CPDATE     * date of death
          MATCH     SP8,PTMXOSDT
          IF        !@EQUAL
            IF        PCEASE=1
              MOVE      PTMXOSDT,CYRSFDTE
              MOVE      PDECDTE,CYRSTDTE
              CALL      CALCYRS                   * calculate the no of years 
              MOVE      CYRSYEAR,PYRRES
            ELSE
              MOVE      PTMXOSDT,CYRSFDTE
              PACK      CYRSTDTE,CCC,CYY,CMM,CDD
              CALL      CALCYRS                   * calculate the no of years 
              MOVE      CYRSYEAR,PYRRES
            ENDIF
.
            UNPACK    PTMXOSDT,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
          ENDIF
.
          IF        SCPSLEN = 8
            PACK      VAR,CPDATE,SP70,SP10
          ELSE
            PACK      VAR,CPCDATE,SP70,SP10
          ENDIF
.
          GOTO      DPTMS995
.
DPTM1132  PACK      VAR,PTMXOPER,SP70,SP10
          GOTO      DPTMS995
.
DPTM1133  MOVE      SP70,SECUSER
          MATCH     SP4,PTMXOPER 
          IF        !@EQUAL
            CALL      OPPASS1
            PACK      KEY4,PTMXOPER,SP6
            CALL      RDPASS1  
          ENDIF
          PACK      VAR,SECUSER,SP70,SP10
          GOTO      DPTMS995
.
DPTM1134  MOVE      SP20,CPCDATE            * Registration Date 
          MATCH     SP8,PTMXRDAT
          IF        !@EQUAL
            UNPACK    PTMXRDAT,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
          ENDIF
          PACK      VAR,CPCDATE,SP70,SP10
          GOTO      DPTMS995
.
DPTM1135  MATCH     SP30,PTMXMEAL         * Super piece of code that!
          PACK      VAR,PTMXMEAL,SP70
          GOTO      DPTMS995
.
DPTM1136  MATCH     SP70,PTMASNAM
          IF        !@EQUAL
            MOVE      PTMASNAM,KEY40
          ELSE
            MOVE      PSNAME,KEY40          * Formatted Name (for LABELS)
          ENDIF
.
          MOVE      PGNAME,KEY25
          MOVE      PTITL,KEY9
          CALL      PACLNAME
          PACK      VAR,KEY80,SP70,SP10
          GOTO      DPTMS995
.
DPTM1137  PACK      VAR,PTMXCARD,SP70,SP10  * card number
          GOTO      DPTMS995
.
DPTM1138  UNPACK    PTMXCEXP,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10  * card expiry date
          GOTO      DPTMS995
.
DPTM1139  PACK      VAR,PTMXCXMP,SP70,SP10  * card exemption code
          GOTO      DPTMS995
.
DPTM1140  MOVE      PTMXCXMP,ACODE          * card exemption desc.
          MOVE      "XM",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1141  PACK      VAR,PTMXFMLY,SP70,SP10  * family id
          GOTO      DPTMS995
.
DPTM1142  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      DPTMS999 IF NOT EQUAL
          PACK      VAR,NHMAETH2,SP70,SP70         * Ethnicity code (NHI only)
          GOTO      DPTMS995
.
DPTM1143  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      DPTMS999 IF NOT EQUAL
          MATCH     SP5,NHMAETH2                  * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VAR,SP70,SP70
            GOTO      DPTMS995
          ENDIF
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH2,SP70
          CALL      RDNHETH1
          PACK      VAR,NHETDES,SP70,SP70
          GOTO      DPTMS995
.
DPTM1144  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      DPTMS999 IF NOT EQUAL
          PACK      VAR,NHMAETH3,SP70,SP70         * Ethnicity code (NHI only)
          GOTO      DPTMS995
.
DPTM1145  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      DPTMS999 IF NOT EQUAL
          MATCH     SP5,NHMAETH3                  * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VAR,SP70,SP70
            GOTO      DPTMS995
          ENDIF
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH3,SP70
          CALL      RDNHETH1
          PACK      VAR,NHETDES,SP70,SP70
          GOTO      DPTMS995
.
DPTM1146  PACK      VAR,PTMXCELL,SP70,SP10  * Cellular Phone Number
          GOTO      DPTMS995
.
DPTM1147  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD1,SP70,SP10
          ELSE 
            PACK      VAR,PTMXADD1,SP70,SP10  * Postal Address Line 1
          ENDIF
          GOTO      DPTMS995
.
DPTM1148  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD2,SP70,SP10
          ELSE
            PACK      VAR,PTMXADD2,SP70,SP10  * Postal Address Line 2
          ENDIF
          GOTO      DPTMS995
.
DPTM1149  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD3,SP70,SP10
          ELSE
            PACK      VAR,PTMXADD3,SP70,SP10  * Postal Address Line 3
          ENDIF
          GOTO      DPTMS995
.
DPTM1150  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEADD4,SP70,SP10
          ELSE
            PACK      VAR,PTMXADD4,SP70,SP10  * Postal Address Line 4
          ENDIF
          GOTO      DPTMS995
.
DPTM1151  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            PACK      VAR,PMCEPOST,SP70,SP10
          ELSE
            PACK      VAR,PTMXPOST,SP70,SP10  * Postal Address Post code
          ENDIF
          GOTO      DPTMS995
.
DPTM1152  CALL      PACADDRS                * format patient address (LABELS)
          PACK      VAR,PACADDRS,SP70,SP10
          GOTO      DPTMS995
.
DPTM1153  PACK      VAR,PTMXMCCD,SP70,SP10  * Medicare Code
          GOTO      DPTMS995
.
DPTM1154  PACK      VAR,FREETEXT,SP70,SP10  * Free Format Text Line (LABELS) 
          GOTO      DPTMS995                
.
DPTM1155  PACK      VAR,PTMXSLAC,SP70,SP10  * SLA Code                       
          GOTO      DPTMS995                
.
DPTM1156  UNPACK    PMPXMEDC,CCENT,CYEAR,CMON,CDAY
          PACK      VAR,CMON,SLASH,CCENT,CYEAR,SP70
          GOTO      DPTMS995
.
DPTM1157  PACK      VAR,PTMXCELL,SP70,SP10  * Mobile Number
          GOTO      DPTMS995
.
DPTM1158  PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          IF        OVRCD = 1
            MOVE      SP70,PMHGADD2
          ENDIF
.
          PACK      VAR,PMHGADD2,SP70,SP10  * HCP Practice Address Line 2
          GOTO      DPTMS995
.
DPTM1159  PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          IF        OVRCD = 1
            MOVE      SP70,PMHGADD3
          ENDIF
.
          PACK      VAR,PMHGADD3,SP70,SP10  * HCP Practice Address Line 3
          GOTO      DPTMS995
.
DPTM1160  PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          IF        OVRCD = 1
            MOVE      SP70,PMHGADD4
          ENDIF
.
          PACK      VAR,PMHGADD4,SP70,SP10  * HCP Practice Address Line 4
          GOTO      DPTMS995
.
DPTM1161  PACK      KEY10,PMPXRH1G,SP70
          PACK      KEY12,KEY10,PMPXR1GC,SP70
          CALL      RDPMHCG1
          IF        OVRCD = 1
            MOVE      SP70,PMHGPOST
          ENDIF
.
          PACK      VAR,PMHGPOST,SP70,SP10  * HCP Practice Postcode
          GOTO      DPTMS995
.
DPTM1162  PACK      VAR,PMPXPFSN,SP70,SP10  * Preferred Surname
          GOTO      DPTMS995
.
DPTM1163  PACK      VAR,PMPXPFGN,SP70,SP10  * Preferred Given Name
          GOTO      DPTMS995
.
DPTM1164  PACK      VAR,PSNAME,SP70,SP10    * Pref Surname instead of Actual SN
          MATCH     "1",PTCNPFSN
          IF        @EQUAL
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL & !@EOS
              PACK      VAR,PMPXPFSN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      DPTMS995
.
DPTM1165  PACK      VAR,PGNAME,SP70,SP10    * Pref Giv Name instead of Actual GN
          MATCH     "1",PTCNPFGN
          IF        @EQUAL
            MATCH     SP70,PMPXPFGN
            IF        !@EQUAL & !@EOS
              PACK      VAR,PMPXPFGN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      DPTMS995
.
DPTM1166  CALL      IBACLOCK                     * current date
          MOVE      CCC,CCENT
          MOVE      CYY,CYEAR
          MOVE      CMM,CMON
          MOVE      CDD,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10
          GOTO      DPTMS995
.
DPTM1167  PROC      GETALTID                     * Singapore HRN
          PACK      VAR,CHKDIGNO,SP70,SP10
          GOTO      DPTMS995
.
DPTM1168  PACK      VAR,PMCDCTYP,SP70,SP10
          GOTO      DPTMS995
.
DPTM1169  MOVE      PMCDCTYP,ACODE
          MOVE      "ct",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1170  PACK      VAR,PMCDCNUM,SP70,SP10
          GOTO      DPTMS995
.
DPTM1171  UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10
          GOTO      DPTMS995
.
DPTM1172  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            MATCH     SP70,PMCEADD1
            GOTO      DPT1172A IF EQUAL
            GOTO      DPT1172A IF EOS
.         
            PACK      VAR,PMCEADD1,SP70
          ELSE
            MATCH     SP70,PTMXADD1
            GOTO      DPT1172A IF EQUAL
            GOTO      DPT1172A IF EOS
.         
            PACK      VAR,PTMXADD1,SP70
          ENDIF
          GOTO      DPTMS995
.
DPT1172A  PACK      VAR,PADD1,SP70
          GOTO      DPTMS995
.
DPTM1173  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            MATCH     SP70,PMCEADD1
            GOTO      DPT1173A IF EQUAL
            GOTO      DPT1173A IF EOS
.
            PACK      VAR,PMCEADD2,SP70
          ELSE
            MATCH     SP70,PTMXADD1
            GOTO      DPT1173A IF EQUAL
            GOTO      DPT1173A IF EOS
.
            PACK      VAR,PTMXADD2,SP70
          ENDIF
          GOTO      DPTMS995
.
DPT1173A  PACK      VAR,PADD2,SP70
          GOTO      DPTMS995
.
DPTM1174  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            MATCH     SP70,PMCEADD1
            GOTO      DPT1174A IF EQUAL
            GOTO      DPT1174A IF EOS
.
            PACK      VAR,PMCEADD3,SP70
          ELSE
            MATCH     SP70,PTMXADD1
            GOTO      DPT1174A IF EQUAL
            GOTO      DPT1174A IF EOS
.
            PACK      VAR,PTMXADD3,SP70
          ENDIF
          GOTO      DPTMS995
.
DPT1174A  PACK      VAR,PSUBRB,SP70
          GOTO      DPTMS995
.
DPTM1175  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            MATCH     SP70,PMCEADD1
            GOTO      DPT1175A IF EQUAL
            GOTO      DPT1175A IF EOS
.
            PACK      VAR,PMCEADD4,SP70
          ELSE
            MATCH     SP70,PTMXADD1
            GOTO      DPT1175A IF EQUAL
            GOTO      DPT1175A IF EOS
.
            PACK      VAR,PTMXADD4,SP70
          ENDIF
          GOTO      DPTMS995
.
DPT1175A  PACK      VAR,PADD4,SP70
          GOTO      DPTMS995
.
DPTM1176  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "1",CONTTYPE          * Postal Address
            CALL      XCON0000              * Get extra contact details
            MATCH     SP70,PMCEADD1
            GOTO      DPT1176A IF EQUAL
            GOTO      DPT1176A IF EOS
.
            PACK      VAR,PMCEPOST,SP70
          ELSE
            MATCH     SP70,PTMXADD1
            GOTO      DPT1176A IF EQUAL
            GOTO      DPT1176A IF EOS
.
            PACK      VAR,PTMXPOST,SP70
          ENDIF
          GOTO      DPTMS995
.
DPT1176A  PACK      VAR,PPOST,SP70
          GOTO      DPTMS995
.
DPTM1177  MOVE      TWO,DIM1
          CALL      CONCAD00
          PACK      VAR,PMCDCTYP,SP70,SP10
          GOTO      DPTMS995
.
DPTM1178  MOVE      TWO,DIM1
          CALL      CONCAD00
          MOVE      PMCDCTYP,ACODE
          MOVE      "ct",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1179  MOVE      TWO,DIM1
          CALL      CONCAD00
          PACK      VAR,PMCDCNUM,SP70,SP10
          GOTO      DPTMS995
.
DPTM1180  MOVE      TWO,DIM1
          CALL      CONCAD00
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10
          GOTO      DPTMS995
.
DPTM1181  MOVE      ONE,DIM1
          CALL      CONCAD00
          PACK      VAR,PMCDCTYP,SP70,SP10
          GOTO      DPTMS995
.
DPTM1182  MOVE      ONE,DIM1
          CALL      CONCAD00
          MOVE      PMCDCTYP,ACODE
          MOVE      "ct",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1183  MOVE      ONE,DIM1
          CALL      CONCAD00
          PACK      VAR,PMCDCNUM,SP70,SP10
          GOTO      DPTMS995
.
DPTM1184  MOVE      ONE,DIM1
          CALL      CONCAD00
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10
          GOTO      DPTMS995
.
DPTM1185  MOVE      THREE,DIM1
          CALL      CONCAD00
          PACK      VAR,PMCDCTYP,SP70,SP10
          GOTO      DPTMS995
.
DPTM1186  MOVE      THREE,DIM1
          CALL      CONCAD00
          MOVE      PMCDCTYP,ACODE
          MOVE      "ct",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1187  MOVE      THREE,DIM1
          CALL      CONCAD00
          PACK      VAR,PMCDCNUM,SP70,SP10
          GOTO      DPTMS995
.
DPTM1188  MOVE      THREE,DIM1
          CALL      CONCAD00
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10
          GOTO      DPTMS995
.
DPTM1189  MOVE      FOUR,DIM1
          CALL      CONCAD00
          PACK      VAR,PMCDCTYP,SP70,SP10
          GOTO      DPTMS995
.
DPTM1190  MOVE      FOUR,DIM1
          CALL      CONCAD00
          MOVE      PMCDCTYP,ACODE
          MOVE      "ct",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1191  MOVE      FOUR,DIM1
          CALL      CONCAD00
          PACK      VAR,PMCDCNUM,SP70,SP10
          GOTO      DPTMS995
.
DPTM1192  MOVE      FOUR,DIM1
          CALL      CONCAD00
          UNPACK    PMCDEXDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      VAR,CPCDATE,SP70,SP10
          GOTO      DPTMS995
.
DPTM1193  PACK      PMHCSTEL,SP70
          PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1
          PACK      VAR,PMHCSTEL,SP70,SP10
          GOTO      DPTMS995
.
DPTM1194  PACK      PMHCFAXN,SP70
          PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1
          PACK      VAR,PMHCFAXN,SP70,SP10
          GOTO      DPTMS995
.
DPTM1195  PACK      VAR,PMPXRHC1,SP70,SP10
          GOTO      DPTMS995
.
DPTM1196  PACK      PACFNAME,SP70
          PACK      KEY8,PURNO,SP10
          CALL      RDPMPX21
          IF        OVRCD = 0
            PACK      KEY10,PMPXRHC1,SP70
            CALL      RDPMHCP1
            IF        OVRCD = 0
              MOVE      PMHCTITL,PACTITLE
              MOVE      PMHCGNAM,PACGNAME
              MOVE      PMHCSNAM,PACSNAME
              MOVE      ONE,PACFRMT
              CALL      PACNAME
            ENDIF
          ENDIF
          PACK      VAR,PACFNAME,SP70,SP10
          GOTO      DPTMS995
.
DPTM1197  PACK      VAR,PMPXFNAM,SP70,SP10             * patient first name
          GOTO      DPTMS995
.
DPTM1198  PACK      VAR,PMPXSNAM,SP70,SP10             * patient second name
          GOTO      DPTMS995
.
DPTM1199  MOVE      "M",DIM1                           * wa medical alerts
          CALL      GETALR00
          RESET     VAR
          GOTO      DPTMS995
.
DPTM1200  MOVE      "B",DIM1                           * wa micro alerts
          CALL      GETALR00
          RESET     VAR
          GOTO      DPTMS995
.
DPTM1201  PACK      VAR,PMPXMSNA,SP70,SP10             * Mother's surname
          GOTO      DPTMS995
.
DPTM1202  PACK      VAR,PMPXMGNA,SP70,SP10             * Mother's given name         
          GOTO      DPTMS995
.
DPTM1203  PACK      VAR,PMPXFSNA,SP70,SP10             * Father's surname
          GOTO      DPTMS995
.
DPTM1204  PACK      VAR,PMPXFGNA,SP70,SP10             * Father's given name
          GOTO      DPTMS995
.
DPTM1205  MOVE      PMPXLNG1,ACODE                     * Preferred Language 1
          MOVE      "LA",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1206  MOVE      PMPXLNG2,ACODE                     * Preferred Language 2
          MOVE      "LA",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1207  MOVE      PMPXLNG3,ACODE                     * Preferred Language 3
          MOVE      "LA",TCODE
          CALL      DXPATCOD
          GOTO      DPTMS999
.
DPTM1208  CALL      FPNAME00                           * Formatted Patient Name
          GOTO      DPTMS995
.
DPTM1209  PACK      VAR,SP70,SP70
          MATCH     "1",PTCNUNET
          IF        @EQUAL
            CALL      GTIHINUM                         * IHI Number
            MOVE      IHINUMBR,VAR
          ELSE
            MATCH     "3",PTCNUNET
            IF        @EQUAL
              CALL      GTIHINUM                   * IHI Number
              LJUSTIFY  IHINUMBR
              UNPACK    IHINUMBR,DIM4,DIM4A,DIM4B,DIM4C
              PACK      VAR,DIM4,SP1,DIM4A,SP1,DIM4B,SP1,DIM4C
            ENDIF
          ENDIF
          GOTO      DPTMS995
.
DPTM1210  CLEAR     VAR
          MATCH     SP70,PMPXFNAM
          IF        !@EQUAL
            CLEAR     DISPNAME
            PACK      NAME35,PMPXFNAM,SP70
            STRIP     NAME35
            CALL      NAMSTR00
            APPEND    SP70,DISPNAME
            RESET     DISPNAME
            STRIP     DISPNAME
            APPEND    DISPNAME,VAR
          ENDIF
          RESET     VAR
          STRIP     VAR
          GOTO      DPTMS995
.
DPTM1211  CLEAR     VAR
          MATCH     SP70,PMPXSNAM
          IF        !@EQUAL
            CLEAR     DISPNAME
            PACK      NAME35,PMPXSNAM,SP70
            STRIP     NAME35
            CALL      NAMSTR00
            APPEND    SP70,DISPNAME
            RESET     DISPNAME
            STRIP     DISPNAME
            APPEND    DISPNAME,VAR
          ENDIF
          RESET     VAR
          STRIP     VAR
          GOTO      DPTMS995
.
DPTM1212  UNPACK    PURNO,KEY7,KEY1
          PACK      VAR,KEY7,DASH,KEY1,SP70,SP10       * U/R number with hyphen
          GOTO      DPTMS995
.
DPTM1213  PACK      VAR,SP70,SP70
.
          MATCH     SP70,PTMXSIN1
          GOTO      DPTMS995 IF EQUAL
          GOTO      DPTMS995 IF EOS
.
          MATCH     "3",PTMXSIN1
          GOTO      DPTMS995 IF EQUAL
.
          PACK      VAR,CALRDESC,SP70,SP70
          GOTO      DPTMS995
.
DPTM1214  MOVE      "FIRSTALT",D8
          PROC      GETALTID                             * Alternate ID
          PACK      VAR,KEY20,SP70
          GOTO      DPTMS995
.
DPTM1215  PACK      VAR,PMPXPEML,SP70,SP70
          GOTO      DPTMS995
.
DPTM1216  MOVE      PSEX,DSEXCHAR
          CALL      SEXDSP00                * get sex long description
          PACK      VAR,DSEXLDES,SP70      
          GOTO      DPTMS995
.
DPTM1217  MOVE      PURNO,MBIRURNO
          CALL      MULBIR20
          PACK      VAR,MBIRTYOR,SP70
          GOTO      DPTMS995
.
DPTM1218  PACK      VAR,PTMASNAM,SP70,SP10    * Pref SN instead of 40char SN
          MATCH     "1",PTCNPFSN
          IF        @EQUAL
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL & !@EOS
              PACK      VAR,PMPXPFSN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      DPTMS995
.
DPTM1219  PACK      VAR,PMPXUCC4,SP70            * Identify gender
          GOTO      DPTMS995  
.
DPTM1220  PACK      VAR,SP70                     * Identify gender long desc
          MATCH     SP70,PMPXUCC4
          IF        !@EQUAL
            MOVE      "Gi",DIM2
            PACK      KEY5,DIM2,PMPXUCC4,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VAR
            ENDIF
          ENDIF
          GOTO      DPTMS995
.
DPTM1221  PACK      VAR,PMPXATF1,SP70,SP70       * Identify gender Free Text
          GOTO      DPTMS995
.
DPTM1222  PACK      VAR,PMPXUCC5,SP70            * Identify pronoun
          GOTO      DPTMS995
.
DPTM1223  PACK      VAR,SP70                     * Identif pronoun long desc
          MATCH     SP70,PMPXUCC5
          IF        !@EQUAL
            MOVE      "Gp",DIM2
            PACK      KEY5,DIM2,PMPXUCC5,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VAR
            ENDIF
          ENDIF
          GOTO      DPTMS995
.
DPTM1224  PACK      VAR,PMPXATF2,SP70,SP70       * Identify Pronoun Free Text
          GOTO      DPTMS995
.
DPTM1225  PACK      VAR,PMPXETH1,SP70   * Ethnicity 1 Code
          GOTO      DPTMS995
.
DPTM1226  MATCH     SP70,PMPXETH1
          GOTO      DPTMS995 IF EQUAL
.
          MOVE      "EN",DIM2
          PACK      KEY5,DIM2,PMPXETH1,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,DPTMS995
.
          PACK      VAR,PTCDLDES,SP70   * Ethnicity 1 Long Desc
          GOTO      DPTMS995
.
DPTM1227  PACK      VAR,PMPXETH2,SP70   * Ethnicity 2 Code
          GOTO      DPTMS995
.
DPTM1228  MATCH     SP70,PMPXETH2
          GOTO      DPTMS995 IF EQUAL
.
          MOVE      "EN",DIM2
          PACK      KEY5,DIM2,PMPXETH2,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,DPTMS995
.
          PACK      VAR,PTCDLDES,SP70   * Ethnicity 2 Long Desc
          GOTO      DPTMS995
.
DPTM1229  PACK      VAR,PMPXLAN1,SP70   * Lang Spoken At Home 1 Code
          GOTO      DPTMS995
.
DPTM1230  MATCH     SP70,PMPXLAN1
          GOTO      DPTMS995 IF EQUAL
.
          MOVE      "l1",DIM2
          PACK      KEY5,DIM2,PMPXLAN1,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,DPTMS995
.
          PACK      VAR,PTCDLDES,SP70   * Lang Spoken At Home 1 Long Desc
          GOTO      DPTMS995
.
DPTM1231  PACK      VAR,PMPXLAN2,SP70   * Lang Spoken At Home 1 Code
          GOTO      DPTMS995
.
DPTM1232  MATCH     SP70,PMPXLAN2
          GOTO      DPTMS995 IF EQUAL
.
          MOVE      "l1",DIM2
          PACK      KEY5,DIM2,PMPXLAN2,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,DPTMS995
.
          PACK      VAR,PTCDLDES,SP70   * Lang Spoken At Home 1 Long Desc
          GOTO      DPTMS995
.
DPTM1233  CALL      GPMCEX00
          BRANCH    EXIT,DPTMS995
.
          PACK      VAR,PMCELAN1,SP70   * Lang Spoken At Home 1 Code
.                                            * Extra Contact
          GOTO      DPTMS995
.
DPTM1234  CALL      GPMCEX00
          BRANCH    EXIT,DPTMS995
.
          MATCH     SP70,PMCELAN1
          GOTO      DPTMS995 IF EQUAL
.
          MOVE      "l1",DIM2
          PACK      KEY5,DIM2,PMCELAN1,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,DPTMS995
.
          PACK      VAR,PTCDLDES,SP70   * Lang Spoken At Home 1 Long Desc
.                                            * Extra Contact
          GOTO      DPTMS995
.
DPTM1235  CALL      GPMCEX00
          BRANCH    EXIT,DPTMS995
.
          PACK      VAR,PMCELAN2,SP70   * Lang Spoken At Home 2 Code
.                                            * Extra Contact
          GOTO      DPTMS995
.
DPTM1236  CALL      GPMCEX00
          BRANCH    EXIT,DPTMS995
.
          MATCH     SP70,PMCELAN2
          GOTO      DPTMS995 IF EQUAL
.
          MOVE      "l1",DIM2
          PACK      KEY5,DIM2,PMCELAN2,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,DPTMS995
.
          PACK      VAR,PTCDLDES,SP70   * Lang Spoken At Home 2 Long Desc
.                                            * Extra Contact
          GOTO      DPTMS995
.
. ******* actually display the variable *******
.
DPTMS995  CALL      DISPITEM 
.
DPTMS999  RETURN
.
.--------------------------------------------------------------------
. Get concession card details
. DIM1 = 1 - Concession Card
.        2 - Safety Net Card
.        3 - DVA Card
.        4 - Pension Card
.--------------------------------------------------------------------
CONCAD00  MOVE      "ct",DIM2
          PACK      KEY19,PURNO,SP70
          CALL      RSPMCCD1
CONCAD20  CALL      RKPMCCD1
          BRANCH    OVRCD,CONCAD80
.
          MATCH     PURNO,PMCDURNO
          GOTO      CONCAD80 IF NOT EQUAL
.
          PACK      KEY5,DIM2,PMCDCTYP
          CALL      RDCODE1
          BRANCH    OVRCD,CONCAD20
.
          MATCH     DIM1,TCINDC1
          GOTO      CONCAD99 IF EQUAL
.
          GOTO      CONCAD20
.
CONCAD80  MOVE      SP70,PMCDCNUM
          MOVE      SP70,PMCDCTYP
          MOVE      SP70,PMCDEXDT
          GOTO      CONCAD99
.
CONCAD99  RETURN
.
.--------------------------------------------------------------------
. Get alert details (wahealth)
. DIM1 = M - Medical Alert
.        B - Micro Alert
.--------------------------------------------------------------------
GETALR00  PACK      VAR,SP70,SP70
          PACK      KEY16,PURNO,SP70
          CALL      RSPTALR1
GETALR10  CALL      RKPTALR1
          BRANCH    OVRCD,GETALR99
.
          MATCH     PURNO,PTALURNO
          GOTO      GETALR99 IF NOT EQUAL
.
          MATCH     SP70,PTALEDAT
          GOTO      GETALR10 IF NOT EQUAL        * alert is inactive
.
          PACK      KEY5,PTALCATG,PTALCODE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,GETALR10
.
          MATCH     ANSM,TCINDC5
          IF        @EQUAL
            MATCH     "M",DIM1
            GOTO      GETALR80 IF EQUAL          * wahealth medical alert
          ENDIF
          MATCH     ANSB,TCINDC5
          IF        @EQUAL
            MATCH     "B",DIM1                   * wahealth micro alert
            IF        @EQUAL
              MOVE      PTALCODE,D1              * first char of alert code
              RESET     VAR
              STRIP     VAR
              ENDSET    VAR
              APPEND    D1,VAR
            ENDIF
          ENDIF
          GOTO      GETALR10
.
GETALR80  PACK      VAR,DYES,SP70,SP70           * medical alerts exist
          GOTO      GETALR99
.
GETALR99  RETURN
+
.--------------------------------------------------------------------
. Format Patient Name in the following format:
.   FAMILY NAME, Given Names
.
.--------------------------------------------------------------------
FPNAME00  CLEAR     VAR
          REP       "#" ",PSNAME
          REP       "#" ",PGNAME
          REP       "#" ",PTMASNAM
          REP       UPPLOW,PSNAME                * uppercase the Surname
          REP       UPPLOW,PTMASNAM
          MATCH     SP70,PTMASNAM
          IF        !@EQUAL
            STRIP     PTMASNAM
            APPEND    PTMASNAM,VAR
          ELSE 
            STRIP     PSNAME
            APPEND    PSNAME,VAR
          ENDIF
.
          MATCH     SP70,PGNAME
          IF        !@EQUAL
            CLEAR     DISPNAME
            PACK      NAME35,PGNAME,SP70
            STRIP     NAME35
            CALL      NAMSTR00
            APPEND    SP70,DISPNAME
            RESET     DISPNAME
            STRIP     DISPNAME
            APPEND    ", ",VAR
            APPEND    DISPNAME,VAR
          ENDIF
          RESET     VAR
          STRIP     VAR
.
FPNAME99  RETURN
+
.
.***************************************************************************
.  This routine formats a name into the format.
.         Surname, Title Given_names
.---------------------------------------------------------------------------
.
PACLNAME  PACK      KEY80,SP30,SP30,SP30       * Initialise to blanks.
.
PACLN500  CLEAR     KEY80
          APPEND    KEY40,KEY80                * Append surname
.
.         Find the end of the surname
.
PACLN550  CMATCH    SP1,KEY80
          GOTO      PACLN600 IF NOT EQUAL
.
          BUMP      KEY80,-1                   * Try the previous character
          GOTO      PACLN550 IF NOT EOS
.
.         No surname. Go directly to adding the title
.
          CLEAR     KEY80                      * Make sure the name is cleared
          GOTO      PACLN610
.
.         Found the end of the surname. Add the title
.
PACLN600  APPEND    ", ",KEY80                 * Add a blank after the surname
PACLN610  APPEND    KEY9,KEY80                 * Append the title
.
.         Find the end of the title
.
PACLN650  CMATCH    SP1,KEY80
          GOTO      PACLN700 IF NOT EQUAL
.
          BUMP      KEY80,-1                 * Try the previous character
          GOTO      PACLN650 IF NOT EOS
.
.         No title or surname. Go directly to adding the given names
.
          CLEAR     KEY80                    * Make sure the name is cleared
          GOTO      PACLN710
.
.         Found the end of the title. Add the given names
.
PACLN700  APPEND    SP1,KEY80                * Add a blank after the title
PACLN710  APPEND    KEY25,KEY80              * Append the given names
          APPEND    SP30,KEY80               * Pad out with spaces
          APPEND    SP30,KEY80               * Pad out with spaces
          APPEND    SP30,KEY80               * Pad out with spaces
          RESET     KEY80
PACLN999  RETURN
.
...............................................................................

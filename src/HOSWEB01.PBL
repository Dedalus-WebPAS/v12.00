.----------------------------------------------------------------------
. Program       : HOSWEB01
.
. Function      : Hosclaims (Enquiry) Web Server
.
. Modifications : 
.----------------------------------------------------------------------
. V12.00.03 02/07/2025  Peter Vela       TSK 0939466
.           Added functionality for Eclipse WebServices DVAW Claim JSON Extract
.           hosweb0123001.html/standard. New REPORTNO and PROFLD00 sections.
. V12.00.02 30/06/2025  Peter Vela       TSK 0939466
.           Added functionality to display DVAW Transaction Requests in 
.           WBTRT000 - WBTRW000
. V12.00.01 16/05/2025  Nikitha B       TSK 0955096                         
.           Alphanumeric changes.                                           
. V11.05.05 12/03/2025  Alina Bhari      TSK 0939771  
.           Validate correct match for location and Transaction ID -VALTLI00 
. V11.05.04 05/03/2025  Alina Bhari      TSK 0939771  
.           Added remote script to validate transaction ID and location ID
.           - REMOTE60,VALTLI00                                           
. V11.05.03 03/03/2025  Alina Bhari      TSK 0939771  
.           Checked for correct transaction ID and location Id - WBSTRN45
. V11.05.02 20/02/2025  Alina Bhari      TSK 0939771  
.           Corrected the spelling of Error Message -WBSERR00       
.           Check the locationID for any invalid values -WBSTRN40   
. V11.05.01 10/01/2025  Alina Bhari      TSK 0939771  
.           Added ability to request a missing ERA by inputting the 
.           transactionID and locationID - WBSTRN40,WBSTRN50,WBSTRN70,LOCATNID,
.           TRANSCID,WEBERHIO,WEBERHFD,WEBERHA4,WBSERR00                 
. V11.04.03 05/04/2024  PJ Le Febour     TSK 0929044i 
.           update WBICUUID WBICUDAT WBICUTIM before call UPWBIHC1
.           update WBIMUUID WBIMUDAT WBIMUTIM before call UPWBIMC1
.           update WBBSUUID WBBSUDAT WBBSUTIM before call UPWBBBS1
. V11.04.02 14/03/2024  PJ Le Febour     TSK 0929044e 
.           update WBICCUID WBICCDAT WBICUTIM before call UPWBIHC1
.           update WBIMCUID WBIMCDAT WBIMCTIM before call UPWBIMC1
.           update WBBSCUID WBBSCDAT WBBSCTIM before call UPWBBBS1
. V11.04.01 22/02/2024  PJ Le Febour     TSK 0929044db
.           update WBETUUID  before call UPWBETR1
.           update WBICUUID WBICUDAT WBICUTIM before call UPWBIHC1
.           update WBIMUUID WBIMUDAT WBIMUTIM before call UPWBIMC1
.           update WBPIUUID WBPIUDAT WBPIUTIM before call UPWBPCI1
.           update WBBSUUID WBBSUDAT WBBSUTIM before call UPWBBBS1
. V11.03.01 13/09/2023  Bella Turco    TSK 0936614
.           Recompiled for PATCERTM                                     
. V11.02.02 26/09/2022  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value.
. V11.02.01 09/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTMA1FD (PATMASTM) changes
. V11.01.10 07/12/2021  Peter Vela     TSK 0909175
.           Fixed BBSW title
. V11.01.09 11/10/2021  Peter Vela     TSK 0898361
.           Added request type literals for WebServices Transaction Requests
. V11.01.08 29/09/2021  Peter Vela     TSK 0909175 
.           Added loop counter to WBTRT000 to prevent internal server 
.           timeout error
. V11.01.07 15/09/2021  Peter Vela     TSK 0909175
.           Added call to displayJSONBPYW
. V11.01.06 30/07/2021  Peter Vela     TSK 0909175
.           Added WebServices BBSW Functionality
. V11.01.05 31/05/2021  Peter Vela     TSK 0906538
.           Added WebServices PCIW functionality
.           Fixed read emrectaf in PDEL0000
. V11.01.04 11/05/2021  Peter Vela     TSK 0902857
.           Added WebServices Transaction Requests Enquiry
. V11.01.03 10/05/2021  Peter Vela     TSK 0902857
.           Added IHCW Assessment Reports
. V11.01.02 01/04/2021  Peter Vela     TSK 0902857
.           Recompiled for WEBIHCFD - Added Index 8
. V11.01.01 01/03/2021  Peter Vela     TSK 0902857
.           Added WebServices IHCW
. V11.00.08 25/01/2021  Peter Vela     TSK 0898361
.           Added WebServices IMCW Assessment Reports
. V11.00.07 09/12/2020  Thanh T        TSK 0872840
.           Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
. V11.00.06 21/10/2020  Peter Vela       TSK 0898361
.           Added WebServices IMCW
. V11.00.05 03/06/2020  Peter Vela       TSK 0874025
.           Added Active and Hospital validation in MPRSEL00 
. V11.00.04 23/04/2020  Peter Vela       TSK 0874025
.           Added Medical Practice to IMC extracts filtering 
. V11.00.03 22/04/2020  Peter Vela       TSK 0874025
.           Recompiled for PRIECTFD
. V11.00.02 17/04/2020  Peter Vela       Task 0874025
.           Recompiled for PRIECTFD
. V11.00.01 27/02/2020  Ebon Clements    Task 0816715
.           Added created and updated by fields to future actions
. V10.14.06 05/03/2019  Peter Vela       Task 0860826
.           Removed Health Fund only option from EAHM0000
. V10.14.05 28/02/2019  Peter Vela       Task 0870981
.           Fixed Claim Assessment Description for IMC EAHM0000, EMEN1100,
.           EMDRR000,EMRS1400
. V10.14.04 26/02/2019  Peter Vela       Task 0867807
.           Added missing desctriptions to REQTYP99 variables
. V10.14.03 08/02/2019  Peter Vela       Task 0867807
.           Added DBS descriptions to REQTYP99 variables
.           Added medicare care flag description into EBEN1000 EAHB0000
. V10.14.02 07/02/2019  Peter Vela       TSK 0867807
.           Added "No Payment Report" message in EAHB0000 if Claim Benefit
.           Amount is zero
. V10.14.01 05/02/2019  Peter Vela       TSK 0867807
.           Added explanation code/description validation in EADBR000
. V10.13.08 30/01/2019  Peter Vela     Task 0859743
.           Added DBS Processing Report functionality
. V10.13.07 02/01/2019  J.Tan          Task 0866108
.           Added IMC Status and Report Request Type
. V10.13.06 21/12/2018  Peter Vela     Task 0859743
.           Recompiled for OUTECTFD
. V10.13.05 05/12/2018  Peter Vela     Task 0859743
.           Added Eclipse DBS Bulk Billing functionality
. V10.13.04 05/11/2018  Peter Vela     Task 0863035
.           Added extraction flag to FCLR1000, FCLR2000
. V10.13.03 26/10/2018  Peter Vela     Task 0859742
.           Added EMECMODL to FCLR1000, FCLR2000
. V10.13.02 12/10/2018  Peter Vela     Task 0859742
.           Added Eclipse PCS Claims Extract Functionality 
. V10.13.01 01/08/2018  Peter Vela     Task 0861036
.           Modified ECLEXT00 to redirect back on errors to prevent webpage
.           expiry
. V10.11.04 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.03 20/11/2017  Ania P         TSK 0846843
.           Fixed CERCHK00 rules.
. V10.11.02 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
. V10.11.01 14/07/2017  Thanh T.       TSK 0821710
.           Audit Amission/outpatient visit comments. PATMISTM changed.
.----------------------------------------------------------------------
. V10.10.01 27/03/2017  Peter Vela      TSK 0834566
.           Changed to 3rd index in Eclipse Transaction Requests
. V10.08.01 22/06/2016  Peter Vela      TSK 0294177
.           Added Eclipse IMC functionality
. V10.04.02 07/04/2014  Peter Vela      CAR 286258
.           Recompiled for PATMASTM
. V10.04.01 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
.----------------------------------------------------------------------
. V10.03.05 10/12/2013  Ania P           CAR 292436   
.           Fixed U * R in CLAIM000
. V10.03.04 25/09/2013  Patrick Adair    CAR 284545
.           Recompiled - changes to PATCERTM
.           Added showcurr cgi variable for certificate display
. V10.03.03 18/07/2013  Peter Vela       CAR 288632
.           Fixed ECLPRE30 again to cater for nulls in PMSESHFD
. V10.03.02 16/07/2013  Peter Vela       CAR 288632
.           Modified ECLPRE30 to cater for nulls in PMSESHFD
. V10.03.01 31/05/2013  Peter Vela       CAR 261630
.           Removed port number from temp file name
. V10.01.01 26/11/2010  Davin            CAR 233458
.           Added option to delete eclipse claims waiting for extraction
.           (declmarr/edel0000)
. V10.00.02 17/08/2010  Davin            CAR 223805
.           Added active flag to program code maintenance (pmprg003/pmpgactv)
. V10.00.01 17/05/2010  Peter Vela       CAR 221442
.           Added partial read loop to look for PMSEAH record @ ECLPRE00
. V9.12.04  01/10/2009  Jill Parkinson   CAR 174079
.           Mods to patck PTHFSTAT
. V9.12.03  17/08/2009  Peter Vela       CAR 203723
.           Added validations for PTFXECLP.patfx1af Eclipse Participant
.           Health Fund Extension File.
. V9.12.02  10/06/2009  Davin            CAR 197893
.           Limit Eclipse Extract to 50 claims (added limrec00)
. V9.12.01  05/05/2009  Peter Vela       CAR 183976
.           Added - 7 OEC (ECF) Status Request
.                   8 OEC (ECF) Report Request
.           to Eclipse Request Types
. V9.11.02  02/04/2009  Jill Habasque    CAR 193772
.           Added RDAFACT1 directly before WRFACT1
. V9.11.01  08/01/2009  Davin            CAR 183976
.           Added option 8  - Eclipse Claims Extract
.           Added option 9  - Eclipse Assessing Report Enquiry
.           Added option 10 - Eclipse Transaction Requests Enquiry
. V9.09.05  15/11/2007  Steve Armstrong  CAR 154963
.           Recompiled for changes to HSCLMSRV
. V9.09.04  13/11/2007  Steve Armstrong  CAR 153566
.        -  Fixed update of Next Batch Number (PTEDNBAT="00000000") in
.           source record for a resubmission (BACITM00).  Record was being
.           re-read using status "2" when the status could be "2", "3" or "4"
.           - should have used BATCHKEY to load KEY32 as it will already
.           contain the correct status.
.        -  Also fixed deletion of resubmission record from the "Claims
.           Waiting for Extraction" enquiry screen, to use index 3 to do a
.           direct read on the original source record instead of using index 1
.           (as it was using status "2" when the status could be "2", "3" or
.           "4").
.        -  Also fixed setting of PTESPCSN when creating a resubmission record
.           in patedsaf.
. V9.09.03  24/10/2007  Ebon Clements  CAR 151941
.           Added health fund and occupational group to future actions
. V9.09.02  24/08/2007  Ebon Clements  CAR 125462
.           Fixed display in invoice amount decimal places
. V9.09.01  10/08/2007  Mike Laming    CAR 125462
.           Added selection of Hospital Name if multi-hospital for all options
. V9.08.06  23/05/2007  Ebon Clements  CAR 138885 
.           Added call to HSCLMSRV (Check claim status) to HOSENQ70.
. V9.08.05  22/03/2007  Mike Laming    CAR 125462
.           Added Multi-hosp Hospital to HOS Claims Enquiry (Claims Waiting)
.           Added Multi-hosp selection list and Select Calims Waiting by Hosp.
. V9.08.04  31/01/2007  Peter Vela     CAR 127930
.           Recompiled for MRTMASFD
. V9.08.03  30/01/2007  Mike Laming   CAR 131592
.           Add routine to find last Inv. for each Admission/Visit
. V9.08.02  11/01/2006  Mike Laming   CAR 103368
.           Add Inpatient/Outpatient extract logic
. V9.08.01  22/11/2006  Mike Laming   CAR 103368
.           Add Report 6 - CCPS Claims Extract
.           Add Report 7 - CCPS Claims Enquiry
. V9.06.01  08/05/2006  Peter Vela    CAR 104252
.           Renamed DPTCEURN to PTCEURNO
.           Renamed DPTCLURN to PTCLURNO
. V9.05.03  09/03/2006  Mike Laming   CAR 79281
.           Add update of "patmx1af" when processing 3B Cetificates at MAS3B000
. V9.05.02  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.01  09/03/2006  Mike Laming   CAR 79281
.           Add Future Actions maintenance to Certificates at CERAD000 on.
. V9.05.B03 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.05.B02 15/12/2005  Mike Laming       CAR 86040
.           Recompile for changes to PATCERTM (for Certificates by Admission)
. V9.04.05  25/11/2005  Mike Laming       CAR 86040
.           Add Certificates maintenance & Program Code Maintenance
. V9.04.04  21/11/2005  Peter Vela    CAR 68675
.           Recompiled for PATDSCTM
. V9.04.03  28/03/2005  Steve Armstrong   CAR 50708
.           Mods to verify status 2 or greater instead of just 2.
. V9.04.02  01/03/2005  Peter Vela    CAR 57547
.           Recompiled for PATVADFD and PATVADIO
. V9.04.01  05/10/2004 Jill Habasque CAR 53798
.----------------------------------------------------------------------
.           Added hospital selection list                      
. V9.03.03  10/06/2004 Pat Dirito                CAR 50552
.           Removed usage of PTCNUEDI                          
. V9.03.02  08/06/2004 Pat Dirito CAR 48876
.           Added HSEL0000,VALGRP00 & VALFIN00 for NCG Extract 
.           07/06/2004 Peter Vela CAR 49016
.           2004 Statutory Changes - recompiled for PMSPX2TM
. V9.03.01  10/05/2004  Pat Dirito               CAR 49520
.           Added Option 3 Electronic Claims Enquiry
. V9.03.00  19/04/2004  Pat Dirito               CAR 48900
.           Created Web Server.
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       EMRECTFD/INC          * Eclipse PCS Claims Table
          INC       EMRECAFD/INC
          INC       HICEMSFD/INC
.
          INC       PATDO1FD/INC   * Doctor File
          INC       PATFX1FD/INC   * Health Fund Extension
          INC       PATHSPFD/INC
          INC       PATMI1FD/INC
          INC       PATMA1FD/INC
          INC       PATVISFD/INC   * Patients Visits File
          INC       PMSVX1FD/INC   * Visit Extension File
          INC       PATCONFD/INC
          INC       OPRCONFD/INC
          INC       PATALRFD/INC
          INC       OUTECTFD/INC
          INC       OUTEAHFD/INC
          INC       OUTEADFD/INC
          INC       OUTECAFD/INC
          INC       OUTSITFD/INC
          INC       OUTBOAFD/INC   * Outpatient Booking Sessions
          INC       OUTBB1FD/INC   * Outpatient Booking Details
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       PATPR1FD/INC
          INC       PMSPX2FD/INC
          INC       PATFN1FD/INC
          INC       PATWR1FD/INC
          INC       MRTMASFD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       PATCALAG/INC
          INC       PMSPX2TD/INC
          INC       PATRE1FD/INC
          INC       PATDGWFD/INC
          INC       PATITMFD/INC
          INC       PATDADFD/INC
          INC       PATVADFD/INC
          INC       PATCMCFD/INC
          INC       PATASFFD/INC
          INC       PMSEAHFD/INC
          INC       PMSEADFD/INC
          INC       PMSESHFD/INC
          INC       PMSESDFD/INC
          INC       PMSHCGTD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCPTD/INC
          INC       PATHGPFD/INC
          INC       APSMASFD/INC
          INC       PATIN1FD/INC
          INC       PATDSCFD/INC
          INC       RCPREGFD/INC
          INC       VARWISCM/INC          * Variables for PATWIES7
.
          INC       PATEDSFD/INC
          INC       PATEDTFD/INC
          INC       PATEBHFD/INC
          INC       PATINVFD/INC
          INC       PRIINVFD/INC
.
          INC       PATCERFD/INC          * Patient Certificates
          INC       PATCERTD/INC
          INC       PATCLCFD/INC          * Pat. Certificates Comments
          INC       PMSCCDFD/INC          * Concession Card Details
          INC       PMSECTFD/INC          * Eclipse IHC Claims Table
          INC       PRIALSFD/INC
          INC       PRIPRAFD/INC
          INC       PRISECFD/INC
          INC       PRIECTFD/INC          * Eclipse IMC Claims Table
          INC       PRIECAFD/INC
          INC       PRIEAHFD/INC
          INC       PRIEADFD/INC
          INC       PRIESHFD/INC
          INC       PRIESDFD/INC
          INC       PMSETRFD/INC          * Eclipse Transactions Request Table
          INC       PMSPRGFD/INC          * Program Codes Table
          INC       PATFACFD/INC          * Future Actions
          INC       PATPARFD/INC          * Eclipse Participants
          INC       PATPCPFD/INC          * Eclipse Participant Capabilities
.
          INC       VISPAYFD/INC          * Visit based Payer Details
.
          INC       WEBETRFD/INC
          INC       WEBERHFD/INC
.
          INC       WEBBBSFD/INC
          INC       WEBBBAFD/INC
          INC       WEBBBBFD/INC
.
          INC       WEBDVWFD/INC
          INC       WEBDVAFD/INC
          INC       WEBDVBFD/INC
.
          INC       WEBIMCFD/INC
          INC       WEBIMAFD/INC
          INC       WEBIMBFD/INC
          INC       WEBIMDFD/INC
          INC       WEBIMEFD/INC
          INC       WEBIMFFD/INC
          INC       WEBIMGFD/INC
          INC       WEBIMHFD/INC
.
          INC       WEBIHAFD/INC
          INC       WEBIHBFD/INC
          INC       WEBIHCFD/INC
          INC       WEBIHDFD/INC
          INC       WEBIHEFD/INC
          INC       WEBIHFFD/INC
          INC       WEBIHGFD/INC
          INC       WEBIHHFD/INC
.
          INC       WEBPCIFD/INC          * WebServices PCIW Claims Table
          INC       WEBPCAFD/INC
.
          INC       WEBPARFD/INC
          INC       WEBPCPFD/INC
.
          INC       TFILEVAR/INC
.
.----------------------------------------------------------------------
ALLHFLAG  FORM      1       * 'All' hospital flag
ASSESKEY  DIM       38
ASSE2KEY  DIM       41
ASESDESC  DIM       7
ASESDES1  INIT      "Accept."
ASESDES2  INIT      "Reject."
ASESDES3  INIT      "Warning"
ASESDES4  INIT      "Compl. "
MEDSDESC  DIM       70
MEDSDES1  INIT      "Patient identification amended"
MEDSDES2  INIT      "Patient Medicare Issue number changed"
MEDSDES3  INIT      "Patient Medicare Number changed"
MEDSDES4  INIT      "Patient card used will expire shortly"
MEDSDES5  INIT      "Patient card expired. Future services may be rejected"
MEDSDES6  INIT      "Old Medicare issue number for patient. Future services may be rejected"
PRCSDESC  DIM       25
PRCSDES1  INIT      "RECEIVED"
PRCSDES2  INIT      "MEDICARE_UNVERIFIED"
PRCSDES3  INIT      "MEDICARE_VERIFIED"
PRCSDES4  INIT      "HEALTH_FUND_UNVERIFIED"
PRCSDES5  INIT      "HEALTH_FUND_VERIFIED"
PRCSDES6  INIT      "MEDICARE_ASSESSING"
PRCSDES7  INIT      "HEALTH_FUND_ASSESSING"
PRCSDES8  INIT      "MEDICARE_REJECTED"
PRCSDES9  INIT      "HEALTH_FUND_REJECTED"
PRCSDE10  INIT      "REQUEST_DELETE"
PRCSDE11  INIT      "COMPLETE"
CLAMDESC  DIM       9
COUNTER   FORM      3
CSTADESC  DIM       25
CTYPDESC  DIM       25
NEXTPAGE  DIM       1       * Nextpage parameter CGI parameter
UPDTTYPE  DIM       1       * Update Type
STARTKEY  DIM       10      * Starting Key
CURRDATE  DIM       8       * Current Date
ENDFYEAR  DIM       8                       * End of financial year
CERTIF3B  FORM      1
SAVEHOSP  DIM       3
SAVKEY4   FORM      4
STFIYEAR  DIM       8       * Start of financial year
DIM3      DIM       3
DIM4      DIM       4
DIM6      DIM       6
DIM7      DIM       7
DIM8A     DIM       8
DIM8B     DIM       8
DIM8C     DIM       8
DIM9      DIM       9
DIM10     DIM       10
DIM11     DIM       11
DIM15     DIM       15
DIM30     DIM       30
DIM45     DIM       45
DISPHOUR  DIM       2
DISPMIN   DIM       2
DISPSEC   DIM       2
EXTRNAME  DIM       127
.
EXTRFILE  FILE      ASCII, FIXED=53      * file length is irrelevant as we
.                                          only need to know if it exists
FILTTYPE  DIM       2
FILTSTAT  DIM       1
FILTPRAC  DIM       10
.FILTOPTN  DIM       1
.
FIRSTFLG  FORM      1                    * first record flag
.                                                0 = no
.                                                1 = yes
FORM8     FORM      8 
FORM3     FORM      3 
FORM6P2   FORM      6.2
FORM6P2A  FORM      6.2
FORM7P2   FORM      7.2
FORM7P2C  FORM      7.2
FORM12D2  FORM      12.2
FORM12P2  FORM      12.2
FRSTLINE  FORM      1
DOCTCODE  DIM       8
IMCWINDC  FORM      1
IHCWINDC  FORM      1
PCIWINDC  FORM      1
BBSWINDC  FORM      1
DVAWINDC  FORM      1
ETRWINDC  FORM      1
PARTCODE  DIM       3
EXTRTYPE  DIM       1
PSAGETYP  DIM       3
MBSDESC   DIM       70
PSAGECON  DIM       3
BATCHNUM  DIM       8
CLAMTYPE  DIM       3
MEDITYPE  DIM       1
INVOICEN  DIM       8
HFUNDESC  DIM       30
HFUNDTYP  DIM       6
HOSPCODE  DIM       3                                                 *I-125462
SAVHCODE  DIM       3                                                 *I-125462
HOSPNAME  DIM       50                                                *I-125462
BATCHKEY  DIM       32
VALDCODE  DIM       6
CLAIMARR  DIM       32[50] * Array of HosClaims 
DECLMARR  DIM       8[50]  * Array of Eclipse Claims to delete (invno)
ECCLMARR  DIM       90[50] * Eclipse Claims (hosp/admno/invno/ur/invdate/amount)
.                                            3   +  8  +  8  + 8 +  8  + 15 = 50
.                          * Eclipse PCS    
.                            (hosp/admno/invno/ur/invdate/amount/module/flag)
.                             3   +  8  +  8  + 8 +  8  + 15 + 2 + 2 = 54
.
.                          * Eclipse DBS
.                    (hosp/admno/invno/ur/invdate/amount/module/flag/outpat key)
.                     3   +  8  +  8  + 8 +  8  + 15 + 2 + 2 + 36 = 90
.
PECLMARR  DIM       9[50]  * Array of Eclipse Claims to delete (invno,module)
.
ECLKEY3   DIM       3
ECPRPTCD  DIM       3
ECPRINVN  DIM       20
ECPRFNDR  DIM       12
ECPRCLID  DIM       6
ECPRFRID  DIM       15
ECPRREPT  DIM       3
ECPREVCN  DIM       2
ECPRSVCN  DIM       4
ECPREXCN  DIM       2
ECPRRRKY  DIM       24
ECPRSRVI  DIM       4
ECPRCFEC  DIM       4
ECPREXPC  DIM       3
ECPRSCOD  DIM       11
ECPRITMN  DIM       5
ECPRSRVC  DIM       3
ECTRSTAT  DIM       1
ECTRTYPE  DIM       2
ECTRLOCN  DIM       8
ECTRCDTE  DIM       8
ECTRCTIM  DIM       8
ECTRTRID  DIM       24
ERRORLST  DIM       70[50]
BNEXTFLD  DIM       8      * table display field
FUNDDESC  DIM       40
VALDTYPE  FORM      1
CHECKDFL  FORM      1      * Tickbox checked flag
NEWSTATS  DIM       1
REASONCD  DIM       1
COUNT     FORM      3
COUNTEC   FORM      3
FRMTNAME  DIM       60
FADTDATE  DATE      8
ERRORCNT  FORM      3       * Count of Errors
.
.                                           * Comments work file       *I-86040
COMM127   DIM       127
COMFILAF  FILE      ASCII, FIXED=128
COMFILNM  DIM       8
COMFILPR  INIT      "hos01a"
COMFLAG   FORM      1
COMMEND   FORM      3
.                                           * PMSPRGFD CGI variables   *I-86040
OPTNFLAG  FORM      1                       * eclipse extract filter (1 or 2)
PATHDESC  DIM       4
PMPRG001  DIM       8
PMPRG002  DIM       50
PMPRG003  DIM       1
.
NEXTVKEY  DIM       24
PREVVKEY  DIM       24
NEXTAKEY  DIM       24
PREVAKEY  DIM       24
NEXTIKEY  DIM       16
PREVIKEY  DIM       16
NEXTUKEY  DIM       32
PREVUKEY  DIM       32
NEXTEKEY  DIM       35
NEXTWKEY  DIM       32
PRACTICE  DIM       6
PREVEKEY  DIM       35
PREVWKEY  DIM       32
PREVFLAG  FORM      1
PRVAFLAG  FORM      1
PRVIFLAG  FORM      1
PRVUFLAG  FORM      1
PRVWFLAG  FORM      1
REQTYPDS  DIM       20
REQSTATS  DIM       28
SAVEADMN  DIM       8
SAVEINVN  DIM       8
SAVEINAM  FORM      12.2
SAVEINTY  DIM       1
SAVEBATN  DIM       8
SAVESTAT  DIM       1
SAVEERRS  DIM       1
SAVETDAT  DIM       8
SAVKEY19  DIM       19
SAVKEY24  DIM       24
SAVKEY26  DIM       26
SAVKEY30  DIM       30
SAVKEY32  DIM       32
SAVKEY35  DIM       35
SAVKEY16  DIM       16
SAVREPTN  FORM      2
SAVPRGID  DIM       8
SETDFPRG  DIM       8
SETDFRPT  FORM      2
SYSTEMID  DIM       1
SHOWCURR  DIM       1
SHOWFLAG  FORM      1
STATKEY1  DIM       1
STCOUNTR  FORM      2
ENDDDATE  DIM       8
SUBFLAG   FORM      1
UPDTEDT   FORM      1
TOGGLE    FORM      1
LASTCLAM  FORM      3       * Last Item of Batch array
LASTDCLM  FORM      3       * Last Item of Eclipse delete array
LASTECLM  FORM      3       * Last Item of Eclipse array
LOOPCNTR  FORM      8
TOTALCNT  FORM      3
.
TEMPINVN  DIM       8         * Invoice Number
TEMPBATN  DIM       8         * Batch Number
TEMPADMN  DIM       8         * Admission Number
TEMPURNO  DIM       8         * U/R Number
TEMPHFND  DIM       6         * Health Fund
TEMPPBAT  DIM       8         * Previous Batch Number
TEMPHOSP  DIM       3         * Hospital Code
.
TEMPMODL  DIM       1
TRANSCID  DIM       24        * Transaction ID
LOCATNID  DIM       8         * Location ID
.
CATcr     INIT      "cr"
CATFA     INIT      "FA"
CATU1     INIT      "U1"
CATU2     INIT      "U2"
CATU3     INIT      "U3"
CATU4     INIT      "U4"
CATU5     INIT      "U5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATVI     INIT      "VI"
CLAMST00  INIT      "Unknown  "
CLAMST01  INIT      "Accepted "
CLAMST02  INIT      "Rejected "
CLAMST03  INIT      "Warning  "
CLAMST04  INIT      "Completed"
CLAMST05  INIT      "Interim  "
REQTYP00  INIT      "Not Applicable      "
REQTYP01  INIT      "IHC Status Request  "
REQTYP02  INIT      "Get Participant     "
REQTYP03  INIT      "Report Request      "
REQTYP04  INIT      "ERA Status Request  "
REQTYP05  INIT      "ERA Report Request  "
REQTYP06  INIT      "Location/Certificate"
REQTYP07  INIT      "OEC (ECF) Status Req"
REQTYP08  INIT      "OEC (ECF) Report Req"
REQTYP09  INIT      "IMC Status Request  "
REQTYP10  INIT      "IMC Report Request  "
REQTYP11  INIT      "DBS Proc Rep Request"
REQTYP12  INIT      "DBS Pay Rep Request "
REQTYP13  INIT      "IHC D/Range Stat Req"
REQTYP14  INIT      "IMC D/Range Stat Req"
REQTYP15  INIT      "OEC D/Range Stat Req"
REQSTS00  INIT      "Waiting to be processed     "
REQSTS01  INIT      "Processing by server adaptor"
REQSTS02  INIT      "Processed by server adaptor "
REQSTS03  INIT      "Processing Error            "
.
REQTYW00  INIT      "Not Applicable      "
REQTYW01  INIT      "IHCW STSW Request   "
REQTYW02  INIT      "GPRW Request        "
REQTYW03  INIT      "IHCW RTVW Request   "
REQTYW04  INIT      "ERAW STSW Request   "
REQTYW05  INIT      "ERAW RTVW Request   "
REQTYW06  INIT      "Location/Certificate"
REQTYW07  INIT      "OEC (ECF) Status Req"
REQTYW08  INIT      "OEC (ECF) Report Req"
REQTYW09  INIT      "IMCW STSW Request   "
REQTYW10  INIT      "IMCW RTVW Request   "
REQTYW11  INIT      "BBSW BPRW Request   "
REQTYW12  INIT      "BBSW BPYW Request   "
REQTYW13  INIT      "IMCW STSW Multiple  "
REQTYW14  INIT      "IMCW RTVW Multiple  "
REQTYW15  INIT      "IHCW STSW Multiple  "
REQTYW16  INIT      "IHCW RTVW Multiple  "
REQTYW17  INIT      "ERAW RTVW Multiple  "
REQTYW18  INIT      "IMCW STSW Date Range"
REQTYW19  INIT      "IHCW STSW Date Range"
REQTYW20  INIT      "DVAW DVRW Request   "
REQTYW21  INIT      "DVAW DVYW Request   "
.
DIM5      DIM       5
DIM8      DIM       8
ZERO4     INIT      "0000"
ZERO8     INIT      "00000000"
OUTPATH1  INIT      "sent"
OUTPATH2  INIT      "ack"
OUTPATH3  INIT      "nack"
SP90      INIT      "                                                                                          "
STATUS0   INIT      "Wait  "
STATUS1   INIT      "Error "
STATUS2   INIT      "Extrac"
STATUS3   INIT      "Sent  "
STATUS4   INIT      "Ack   "
STATUS5   INIT      "NAck  "
STATUS9   INIT      "Cancel"
STATU20   INIT      "Not Sent"
STATU21   INIT      "Extract "
STATU22   INIT      "Sent (FS"
STATU23   INIT      "App.Pend"
STATU24   INIT      "Approved"
STATU25   INIT      "Amend   "
STATU26   INIT      "        "
STATU27   INIT      "Resubmit"
STATU28   INIT      "Can/Resu"
STATU29   INIT      "Cancel'd"
STATDESC  DIM       6
STATDES2  DIM       8
BSTATDES  DIM       14
BSTATDS1  INIT      "Sent          "
BSTATDS2  INIT      "Acknowledged  "
BSTATDS3  INIT      "Unacknowledged"
BTYPEDES  DIM       12
BTYPEDS1  INIT      "Claim       "
BTYPEDS2  INIT      "Cancellation"
MEDONLY   INIT      "Medical only"
CLAIM     INIT      "Claim"
CANCELS   INIT      "Cancellation"
CANCELD   INIT      "Cancelled"
EXCLUDE   INIT      "Excluded"
NULL      INIT      000
.
.----------------------------------------------------------------------
PRGID     INIT      "HOSWEB01"
VERSION   INIT      "V12.00.03"
PRGNAM    INIT      "Hosclaims Enquiry Web Server"
.----------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200,MAIN2300,MAIN2400,MAIN2500:
                             MAIN2600,MAIN2700,MAIN2800,MAIN2900,MAIN3000:
                             MAIN3100,MAIN3200,MAIN3300
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      HOSEXT00        * Health Fund HosClaims Account Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      REMOTE00        * Various Remote Scripting Functions
          GOTO      MAIN1000
.
MAIN1300  CALL      HOSENQ00        * HosClaims/Electronic Claims Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      CERTM000        * Certificates Maintenance         *I-86040
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      PRGCD000        * Program Codes Maintenance        *I-86040
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.         
MAIN1600  CALL      CCPEXT00        * CCPS EDI Claims Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.         
MAIN1700  CALL      CCPENQ00        * CCPS EDI Enquiry and Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      ECLEXT00        * Eclipse IHC Claims Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1900  CALL      ECLPRE00        * Eclipse Assessing Report Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2000  CALL      ECLTRN00        * Eclipse Transaction Requests Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2100  CALL      MCLEXT00        * Eclipse IMC Claims Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2200  CALL      ECLPRM00        * Eclipse IMC Assessing Report Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2300  CALL      PCLEXT00        * Eclipse PCS Claims Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2400  CALL      DBSEXT00        * Eclipse DBS Claims Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2500  CALL      ECLDBM00        * Eclipse DBS Assessing Report Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2600  CALL      IMWEXT00        * WebServices IMCW Claims Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2700  CALL      IMWPRM00        * WebServices IMCW Assessing Report Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2800  CALL      IHWEXT00        * WebServices IHCW Claims Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2900  CALL      IHWPRM00        * WebServices IHCW Assessing Report Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3000  CALL      WBSTRN00        * WebServices Transaction Requests Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3100  CALL      PCWEXT00        * WebServices PCIW Claims Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3200  CALL      BBWEXT00        * WebServices PCIW Claims Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3300  CALL      DVWEXT00        * WebServices DVAW Claims Extract
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50:
                       NXTPAG60
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PREDIR00      * Redirect Parent
          GOTO      NXTPAG99
.
NXTPAG50  CALL      RELOAD00      * Reload
          GOTO      NXTPAG99
.
NXTPAG60  CALL      REDALT00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.*******************************************************************************
.                         Reload page
.*******************************************************************************
RELOAD00  CALL      OPENHTML
          BRANCH    EXIT,RELOAD99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                            "    alert(#"",WEBTITLE,"#");":
                             "    history.go(-1);":
.                            "    location.reload();":
                             "}":
                             "</script>"
          CALL      CLOSHTML
RELOAD99  RETURN
.----------------------------------------------------------------------
. Output Javascript List of Errors
.----------------------------------------------------------------------
ERRLST00  CALL      OPENHTML
          BRANCH    EXIT,ERRLST95
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {"
.
          MOVE      ZERO,F3
ERRLST10  ADD       ONE,F3
          IF        F3>ERRORCNT | F3>50
            GOTO      ERRLST20
          ENDIF
         
          WRITE     HTMLFILE;"  alert(#"",ERRORLST[F3],"\n#");"
          GOTO      ERRLST10

ERRLST20  WRITE     HTMLFILE;"  alert(#"All Other Records Processed\n#");":
                             "  location.href='",REDIRECT,"';":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      ERRLST99
.
ERRLST95  DISPLAY   "*** Fifo Not Found ***"
.
ERRLST99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.-----------------------------------..............-------------------------
. Check ICD Record
.   Required - VALDTYPE
.               1. Validate Batch Number
.               2. Validate Item for Resubmit
.               3. Validate Health Fund Group
.               4. Validate dates for financial year
.               6. Validate Transaction Id and Location Id
.--------------------------------------------------------------------------
REMOTE00  BRANCH    VALDTYPE,REMOTE10,REMOTE20,REMOTE30,REMOTE40,REMOTE50:
                             REMOTE60
          GOTO      REMOTE90
.
REMOTE10  CALL      VALBAT00     * Validate Batch Number
          GOTO      REMOTE99
.
REMOTE20  CALL      BACITM00     * Validate Batch Item Number
          GOTO      REMOTE99
.
REMOTE30  CALL      VALGRP00     * Validate Health Fund Group
          GOTO      REMOTE99
.
REMOTE40  CALL      VALFIN00     * Validate dates for financial year
          GOTO      REMOTE99
.
REMOTE50  CALL      CHNGST00     * Change Status on CCPS Invoices   
          GOTO      REMOTE99
.
REMOTE60  CALL      VALTLI00     * Validate Transactio and Location ID
          GOTO      REMOTE99
.
REMOTE90  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTE99
.
REMOTE99  RETURN
.------------------------------------------------------------
. Validate Batch Number
. INPUTS: BATCHNUM - Batch Number
.------------------------------------------------------------
VALBAT00  CALL      XMLHED00
          BRANCH    EXIT,VALBAT99
.
          PACK      KEY8,BATCHNUM,SP70
          CALL      RDPTEBH1
          BRANCH    OVRCD,VALBAT90

.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALBAT98
.
VALBAT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Batch number not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALBAT98
.
VALBAT98  CALL      XMLEND00
VALBAT99  RETURN
.------------------------------------------------------------
. Validate Batch Item Number
. INPUTS: BATCHKEY - Batch Number
.------------------------------------------------------------
BACITM00  CALL      XMLHED00
          BRANCH    EXIT,BACITM99
.
          PACK      KEY32,BATCHKEY,SP70
          CALL      RDPTEDS1
          BRANCH    OVRCD,BACITM90
.
.         Now check if the record has already been resubmitted
.
          MATCH     SP8,PTESNBAT                 * next batch blank ?
          IF        !@EQUAL
            IF        CHECKDFL=ONE
              GOTO      BACITM91        * Only report error if checked!
            ENDIF
          ENDIF
.
.         Only allow resubmission of invoices already sent.
.
          COMPARE   TWO,PTESFLAG
          IF        @LESS
            GOTO      BACITM92
          ENDIF
.
          MOVE      PTESBATN,PTESPBAT  * Set Previous Batch
          MOVE      PTESCSNO,PTESPCSN  * Set prev. claim sequential no. I-153566
          MOVE      ZERO,PTESFLAG
          MOVE      SP8,PTESBATN
          MOVE      SP8,PTESNBAT
          MOVE      SP8,PTESCSNO
          MOVE      SP1,PTESCCFL
          MOVE      SP30,PTESSPAR
.
.   Following code will toggle depending on whether Resubmit is ticked or not
.
          IF        CHECKDFL=ONE
            PACK      KEY32,PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN,SP70
            CALL      RAPTEDS1
            IF        OVRCD=1
              CALL      WRPTEDS1                   * write record
            ENDIF
          ELSE 
            PACK      KEY32,PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN,SP70
            CALL      RAPTEDS1
            IF        OVRCD=0
              CALL      DEPTEDS1                   * delete record
            ENDIF
          ENDIF
.
.         Re-read record with BATCHKEY as fields were reset above
.
          PACK      KEY32,BATCHKEY,SP70            * CAR 153566
          CALL      RDPTEDS1
          BRANCH    OVRCD,BACITM90
.
.         Update the selected record with the next batch no. of "00000000"
.
          IF        CHECKDFL=ONE
            MOVE      "00000000",PTESNBAT    * Ticked tick box
          ELSE
            MOVE      SP70,PTESNBAT          * Unticked
          ENDIF
          CALL      UPPTEDS1
.
.         Output dummy line.
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      BACITM98
.
BACITM90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "patedsaf record not on file. ":
                             "</RETURN_VALUE>"
          GOTO      BACITM98
.
BACITM91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invoice already resubmitted. ":
                             "</RETURN_VALUE>"
          GOTO      BACITM98
.
BACITM92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invoice not sent.  ":
                             "</RETURN_VALUE>"
          GOTO      BACITM98
.
BACITM98  CALL      XMLEND00
.
BACITM99  RETURN
.------------------------------------------------------------
. Validate Health Fund Group  
. INPUTS: VALDCODE - Fund Group
.------------------------------------------------------------
VALGRP00  CALL      XMLHED00
          BRANCH    EXIT,VALGRP99
.
          PACK      KEY14,SP70
          CALL      RDSFUND1                * position at start of HF table
VALGRP20  CALL      RDKFUND1                * read next record
          BRANCH    OVRCD,VALGRP90          * eof - finished
.
          MATCH     "0000    ",HFTABL       * HF header record ?
          GOTO      VALGRP30 IF NOT EQUAL   * no - ignore
.
          MATCH     VALDCODE,PTHFHGRP       * matching health fund group ?
          GOTO      VALGRP40 IF EQUAL       * yes
.
VALGRP30  PACK      KEY14,HCODE,Z70    
          CALL      RDSFUND1                * position for next HF header rec.
          GOTO      VALGRP20                * get next record
.
.  Dummy ouput for valid Code
.
VALGRP40  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALGRP98
.
VALGRP90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                          "No health funds set up for this health fund group.":
                             "</RETURN_VALUE>"
          GOTO      VALGRP98
.
VALGRP98  CALL      XMLEND00
VALGRP99  RETURN
.------------------------------------------------------------
. Validate Date Financial Period
. INPUTS: STRTDATE - Start Date
.         ENDDDATE - End Date
.------------------------------------------------------------
VALFIN00  CALL      XMLHED00
          BRANCH    EXIT,VALFIN99
.
          MOVE      STRTDATE,KEY4
          PACK      STFIYEAR,KEY4,ZERO,SEVEN,ZERO,ONE
          MOVE      KEY4,SAVKEY4
.
          MATCH     STFIYEAR,STRTDATE
          IF        @LESS
            PACK      ENDFYEAR,KEY4,ZERO,SIX,THREE,ZERO
            SUBTRACT  ONE,SAVKEY4
            PACK      STFIYEAR,SAVKEY4,ZERO,SEVEN,ZERO,ONE
          ELSE
            ADD       ONE,SAVKEY4
            PACK      ENDFYEAR,SAVKEY4,ZERO,SIX,THREE,ZERO
          ENDIF
.
          MATCH     ENDDDATE,ENDFYEAR
          IF        @LESS
            GOTO      VALFIN90
          ENDIF
.
.  Dummy ouput for valid Code
.
VALFIN40  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALFIN98
.
VALFIN90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Both dates must be from the same financial year!":
                             "</RETURN_VALUE>"
          GOTO      VALFIN98
.
VALFIN98  CALL      XMLEND00
VALFIN99  RETURN
.------------------------------------------------------------
. Validate Change EDI status for CCPS Invoices
. INPUTS: BATCHKEY - Batch Number
.------------------------------------------------------------
CHNGST00  CALL      XMLHED00
          BRANCH    EXIT,CHNGST99
.
          PACK      KEY26,BATCHKEY,SP70
          CALL      RDPTEDT1
          BRANCH    OVRCD,CHNGST90
.
          MOVE      ZERO,F1
          MOVE      NEWSTATS,F1
.                       Resub    Approv   Cancel    Sent
          BRANCH    F1,CHNGST10,CHNGST20,CHNGST30,CHNGST40
          GOTO      CHNGST80
.
.
.         Now check if the record has already been resubmitted
.
.
CHNGST10  MATCH     SP8,PTETNBAT            * next batch blank ?
          GOTO      CHNGST91 IF NOT EQUAL   * Only report error if checked!
.
.         Only allow resubmission of invoices already "extracted"
.
          COMPARE   TWO,PTETFLAG
          GOTO      CHNGST92 IF LESS
          MOVE      PTETCCST,FORM2
          IF        FORM2 > 3 & FORM2 < 9
           GOTO       CHNGST94
          ENDIF
.
          PACK      KEY24,PTETADMN,SP30
          MOVE      PTETADMN,SAVEADMN
          CALL      RSPTEDT4
CHNGST12  CALL      RKPTEDT4
          BRANCH    OVRCD,CHNGST80
          MATCH     SAVEADMN,PTETADMN
          GOTO      CHNGST80 IF NOT EQUAL
.
          MOVE      NINE,PTETFLAG
          MOVE      " 7",PTETCCST
          MOVE      "00000000",PTETNBAT
          CALL      UPPTEDT4
.
.                                           * create new record with blank Batch
          MOVE      PTETBATN,PTETPBAT       * Set Previous Batch
          MOVE      SP8,PTETBATN
          MOVE      SP8,PTETNBAT
          MOVE      ZERO,PTETFLAG
          MOVE      " 0",PTETCCST
.
          PACK      KEY26,PTETFLAG,PTETADMN,PTETINVN,PTETBATN,SP70
          CALL      RAPTEDT1
          IF        OVRCD=1
            CALL      WRPTEDT1                   * write record
          ENDIF
.
          GOTO      CHNGST12
.
.                             Set 'Approved' flag
.
CHNGST20  PACK      KEY24,PTETADMN,SP30
          MOVE      PTETADMN,SAVEADMN
          CALL      RSPTEDT4
CHNGST22  CALL      RKPTEDT4
          BRANCH    OVRCD,CHNGST80
          MATCH     SAVEADMN,PTETADMN
          GOTO      CHNGST80 IF NOT EQUAL
.
          MOVE      FOUR,PTETFLAG
          MOVE      " 4",PTETCCST
          CALL      UPPTEDT4
          GOTO      CHNGST22
.
.                             Set 'Cancelled' flag
.
CHNGST30  PACK      KEY24,PTETADMN,SP30
          MOVE      PTETADMN,SAVEADMN
          CALL      RSPTEDT4
CHNGST32  CALL      RKPTEDT4
          BRANCH    OVRCD,CHNGST80
          MATCH     SAVEADMN,PTETADMN
          GOTO      CHNGST80 IF NOT EQUAL
.
          MOVE      PTETCCST,FORM2
          IF        FORM2 < 3 | FORM2 = 8
            MOVE      NINE,PTETFLAG         * Status = Not Sent, Extracted, Sent
            MOVE      " 9",PTETCCST
            CALL      UPPTEDT4
          ENDIF
          IF        FORM2 = 3 | FORM2 = 4
            MOVE      NINE,PTETFLAG         * Status = Approv.Pending, Approved
            MOVE      " 8",PTETCCST
            MOVE      "00000000",PTETNBAT
            CALL      UPPTEDT4
.                                           * set up new record to "resubmit"
            MOVE      ZERO,PTETFLAG
            MOVE      " 7",PTETCCST
            MOVE      PTETBATN,PTETPBAT
            UNPACK    SP30,PTETBATN,PTETNBAT
            PACK      KEY26,PTETFLAG,PTETADMN,PTETINVN,PTETBATN
            CALL      WRPTEDT1
          ENDIF
          GOTO      CHNGST32
.
.                             Set 'Sent' flag
.
CHNGST40  PACK      KEY24,PTETADMN,SP30
          MOVE      PTETADMN,SAVEADMN
          CALL      RSPTEDT4
CHNGST42  CALL      RKPTEDT4
          BRANCH    OVRCD,CHNGST80
          MATCH     SAVEADMN,PTETADMN
          GOTO      CHNGST80 IF NOT EQUAL
.
          MOVE      THREE,PTETFLAG
          MOVE      " 2",PTETCCST
          CALL      UPPTEDT4
          GOTO      CHNGST42
.
.
CHNGST80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      CHNGST98
.
CHNGST90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "patedtaf record not on file. ":
                             "</RETURN_VALUE>"
          GOTO      CHNGST98
.
CHNGST91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invoice already resubmitted. ":
                             "</RETURN_VALUE>"
          GOTO      CHNGST98
.
CHNGST92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invoice not extracted. ":
                             "</RETURN_VALUE>"
          GOTO      CHNGST98
.
CHNGST93  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Error updating Invoice ",PTETINVN:
                             " Batch ",PTETBATN:
                             "</RETURN_VALUE>"
          GOTO      CHNGST98
.
CHNGST94  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invoice must be cancelled and resubmitted.":
                             "</RETURN_VALUE>"
          GOTO      CHNGST98
.
CHNGST98  CALL      XMLEND00
CHNGST99  RETURN
.
.*******************************************************************************
. Validate Transaction and Location ID - VALTLI00    
.*******************************************************************************
VALTLI00  CALL      XMLHED00
          BRANCH    EXIT,VALTLI99
.
          PACK      KEY61,TRANSCID,SP70
          CALL      RSWBERH4                     * position in fil
VALTLI10  CALL      RKWBERH4
          BRANCH    OVRCD,VALTLI90
.
          MATCH     WBEIFTID,TRANSCID
          IF        @EQUAL
            MATCH     SP70,WBEIRADV
            GOTO      VALTLI90 IF EQUAL
.
            MATCH     SP70,WBEIPNUM
            GOTO      VALTLI90 IF EQUAL
.
            MATCH     WBEIPLID,LOCATNID
            IF        @EQUAL
              GOTO      VALTLI80
            ELSE
              GOTO      VALTLI10
            ENDIF
          ENDIF
          GOTO      VALTLI10
.
VALTLI80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             WBEIFTID,"|",WBEIPLID,"|",LOCATNID:
                             "</RETURN_VALUE>"
          GOTO      VALTLI99
.
VALTLI90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "</RETURN_VALUE>";
          GOTO      VALTLI99
.
VALTLI99  CALL      XMLEND00
          RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  CALL      INTMAS00     * Open routine for PATMASTM 
          OPEN      PATVISA2,"patvisaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATASFA1,"patasfaf"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATIN1A1,"patin1af"
.
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
.
          OPEN      PATEBHA1,"patebhaf"
          OPEN      PATEBHA2,"patebhaf"
          OPEN      PATINVR1,"patinvrf"
          OPEN      PATINVR3,"patinvrf"
          OPEN      PRIINVO1,"priinvof" 
          OPEN      PATEDSA1,"patedsaf"
          OPEN      PATEDSA2,"patedsaf"
          OPEN      PATEDSA3,"patedsaf"
          OPEN      PATEDSA4,"patedsaf"
          OPEN      PATEDSA5,"patedsaf"
.
          OPEN      PATEDTA1,"patedtaf"
          OPEN      PATEDTA2,"patedtaf"
          OPEN      PATEDTA3,"patedtaf"
          OPEN      PATEDTA4,"patedtaf"
          OPEN      PATEDTA5,"patedtaf"
          OPEN      OUTBB1A1,"outbb1af"
          OPEN      OUTBOKA6,"outbokaf"
          OPEN      PATFX1A1,"patfx1af"
          OPEN      VISPAYA1,"vispayaf"
          OPEN      HICEMSA1,"hicemsaf"
.
          OPEN      PATHGRP1,"pathgrpf"
.                                           * Certificates             *I-86040
          OPEN      PATCERA1,"patceraf"
          OPEN      PATCLCA1,"patclcaf"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSEAHA1,"pmseahaf"
          OPEN      PMSEADA1,"pmseadaf"
          OPEN      PMSESHA1,"pmseshaf"
          OPEN      PMSESDA1,"pmsesdaf"
          OPEN      PMSHCPA1,"pmshcpaf"
.                                           * Program Codes            *I-86040
          OPEN      PMSPRGA1,"pmsprgaf"
.                                           * Future Actions           *I-79281
          OPEN      PATFACT1,"patfactf"     
.
          OPEN      PMSECTA1,"pmsectaf"
          OPEN      PMSECTA2,"pmsectaf"
.         OPEN      PRIECTA1,"priectaf"
.         OPEN      PRIECTA2,"priectaf"
          OPEN      PRIALSA1,"prialsaf" 
          OPEN      PRIPRAC1,"pripracf"
          OPEN      PRISECA1,"prisecaf"
          OPEN      PRISECA2,"prisecaf"
          OPEN      PMSETRA1,"pmsetraf"
          OPEN      PMSETRA2,"pmsetraf"
          OPEN      PMSETRA3,"pmsetraf"
          OPEN      PATPARA1,"patparaf"
          OPEN      PATPCPA1,"patpcpaf"
.          
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS,*85,IBCNUGST
          READ      CONTROLF,TEN3;*194,CVETINS
          READ      CONTROLF,HUND10;*115,PTCNUEDI,*118,PTCNEDIO
          READ      CONTROLF,HUND14;*153,PTCNECLO
          READ      CONTROLF,HUND19;*1,PTCNIMCO
          READ      CONTROLF,HUND24;*111,PTCNUIMC,*222,PTCNUESF
          READ      CONTROLF,HUND25;*238,PTCNNRTD
          READ      CONTROLF,HUND27;*1,PTCNESFO,*122,PTCNUEBB,*123,PTCNEDBO
          READ      CONTROLF,HUND29;*61,PTCNWSIN,*73,PTCNIMCW,*88,PTCNIHCW:
                                    *91,PTCNPCIW,*193,PTCNBBSW,*249,PTCNDVAW
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          MATCH     "1",PTCNUIMC
          IF        @EQUAL
            OPEN      PRIECTA1,"priectaf"
            OPEN      PRIECTA2,"priectaf"
            OPEN      PRIECTA6,"priectaf"
            OPEN      PRIECAA1,"priecaaf"
            OPEN      PRIECAA2,"priecaaf"
            OPEN      PRIECAA3,"priecaaf"
            OPEN      PRIEAHA1,"prieahaf"
            OPEN      PRIEAHA2,"prieahaf"
            OPEN      PRIEADA1,"prieadaf"
            OPEN      PRIESHA1,"prieshaf"
            OPEN      PRIESDA1,"priesdaf"
          ENDIF 
.
          OPEN      IBAPDFA1,"ibapdfaf"        * For default printer selection
.
          CALL      TFILENAM
          MOVE      TFILNAME,COMFILNM
.
          OPEN      EMRECTA1,"emrectaf"
          OPEN      EMRECTA2,"emrectaf"
          OPEN      EMRECAA1,"emrecaaf"
          OPEN      EMRECAA2,"emrecaaf"
.
          OPEN      OUTECTA1,"outectaf"
          OPEN      OUTECTA2,"outectaf"
          OPEN      OUTECTA6,"outectaf"
          OPEN      OUTECAA1,"outecaaf"
          OPEN      OUTECAA2,"outecaaf"
          OPEN      OUTEAHA1,"outeahaf"
          OPEN      OUTEADA1,"outeadaf"
.
          OPEN      RCPREGA1,"rcpregaf"
.
          MOVE      ONE,IMCWINDC
          MOVE      ONE,IHCWINDC
          MOVE      ONE,ETRWINDC
          MOVE      ONE,PCIWINDC
          MOVE      ONE,BBSWINDC
          MOVE      ONE,DVAWINDC
.
          MATCH     "1",PTCNWSIN
          IF        @EQUAL
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBPARA1,"webparaf"
            TRAPCLR   IO
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBPCPA1,"webpcpaf"
            TRAPCLR   IO
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBETRA1,"webetraf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,ETRWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBETRA2,"webetraf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,ETRWINDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBETRA3,"webetraf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,ETRWINDC
            ENDIF
.
            OPEN      WEBERHA4,"weberhaf"
.
            MATCH     "1",PTCNIHCW
            IF       @EQUAL
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHCA1,"webihcaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHCA2,"webihcaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHCA6,"webihcaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHAA1,"webihaaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHAA2,"webihaaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHAA3,"webihaaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHBA1,"webihbaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHBA2,"webihbaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHDA1,"webihdaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHDA2,"webihdaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHEA1,"webiheaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHFA1,"webihfaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHGA1,"webihgaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHHA1,"webihhaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHBA1,"webihbaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIHBA2,"webihbaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IHCWINDC
              ENDIF
.
            ENDIF
.
            MATCH     "1",PTCNIMCW
            IF       @EQUAL
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMCA1,"webimcaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMCA2,"webimcaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMCA6,"webimcaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMAA1,"webimaaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMAA2,"webimaaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMAA3,"webimaaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
.             MOVE      ZERO,OVRCD
.             TRAP      OVERCOND IF IO
.             OPEN      WEBPARA1,"webparaf"
.             TRAPCLR   IO
.             IF        OVRCD=1
.               MOVE      ZERO,IMCWINDC
.             ENDIF
.
.             MOVE      ZERO,OVRCD
.             TRAP      OVERCOND IF IO
.             OPEN      WEBPCPA1,"webpcpaf"
.             TRAPCLR   IO
.             IF        OVRCD=1
.               MOVE      ZERO,IMCWINDC
.             ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMDA1,"webimdaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMDA2,"webimdaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMEA1,"webimeaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMFA1,"webimfaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMGA1,"webimgaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMHA1,"webimhaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMBA1,"webimbaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBIMBA2,"webimbaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,IMCWINDC
              ENDIF
.
            ENDIF
.
            MATCH     "1",PTCNPCIW
            IF       @EQUAL
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBPCIA1,"webpciaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,PCIWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBPCIA2,"webpciaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,PCIWINDC
              ENDIF
.
            ENDIF
.
            MATCH     "1",PTCNBBSW
            IF       @EQUAL
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBBBSA1,"webbbsaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,BBSWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBBBSA2,"webbbsaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,BBSWINDC
              ENDIF
.
            ENDIF
.
            MATCH     "1",PTCNDVAW
            IF       @EQUAL
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBDVWA1,"webdvwaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,DVAWINDC
              ENDIF
.
              MOVE      ZERO,OVRCD
              TRAP      OVERCOND IF IO
              OPEN      WEBDVWA2,"webdvwaf"
              TRAPCLR   IO
              IF        OVRCD=1
                MOVE      ZERO,DVAWINDC
              ENDIF
.
            ENDIF
.
          ENDIF
.          
INIT9999  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          MOVE      ZERO,REPORTNO
          MOVE      ZERO,LASTDCLM
          MOVE      ZERO,LASTECLM
          MOVE      SP70,TEMPLATE
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,STARTKEY
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,BATCHNUM
          MOVE      SP70,CLAMTYPE
          MOVE      SP70,MEDITYPE
          MOVE      ONE,OPTNFLAG                 * default filter by hfund
          MOVE      SP70,HFUNDESC
          MOVE      SP70,HFUNDTYP
          MOVE      SP70,INVOICEN
          MOVE      SP70,HOSPCODE                                     *I-125462
          MOVE      SP70,HOSPNAME                                     *I-125462
          MOVE      SP70,URNUMBER
          MOVE      SP70,ADMISSNO
          MOVE      SP70,BATCHKEY
          MOVE      SP70,VALDCODE
          MOVE      SP70,CHECKDFL
          MOVE      ZERO,VALDTYPE
          MOVE      SP70,NEWSTATS
          MOVE      SP70,REASONCD
.
          MOVE      SP70,NEXTVKEY
          MOVE      SP70,PREVVKEY
          MOVE      SP70,NEXTAKEY
          MOVE      SP70,PREVAKEY
          MOVE      SP70,NEXTIKEY
          MOVE      SP70,PREVIKEY
          MOVE      SP70,NEXTUKEY
          MOVE      SP70,PREVUKEY
          MOVE      SP70,NEXTEKEY
          MOVE      SP70,NEXTWKEY
          MOVE      SP70,PREVEKEY
          MOVE      SP70,PREVWKEY
          MOVE      ZERO,PREVFLAG
          MOVE      ZERO,PRVAFLAG
          MOVE      ZERO,PRVIFLAG
          MOVE      ZERO,PRVUFLAG
          MOVE      ZERO,PRVWFLAG
          MOVE      ZERO,SHOWCURR
.
          MOVE      SP70,STRTDATE
          MOVE      SP70,ENDDDATE
.
          MOVE      ONE,COUNT
          WHILE     COUNT <= 50
            MOVE      SP70,CLAIMARR[COUNT]
            MOVE      SP70,ERRORLST[COUNT]
            ADD       ONE,COUNT
          DO
.
          MOVE      ONE,COUNT
          WHILE     COUNT <= 50
            MOVE      SP70,DECLMARR[COUNT]
            MOVE      SP90,ECCLMARR[COUNT]
            MOVE      SP70,PECLMARR[COUNT]
            ADD       ONE,COUNT
          DO
.                                           * Certificates             *I-86040
          CALL      CLPTCE00                * in PATCERTM
.
.                                           * Comments work file       *I-86040
.         MOVE      ONE,COMFLAG
.         MOVE      ZERO,COMMEND
.         PACK      COMFILNM,COMFILPR,PORT
.         REP       " 0",COMFILNM
.         PREP      COMFILAF,COMFILNM
.                                           * Program Codes            *I-86040
          MOVE      Z70,PMPRG001
          MOVE      Z70,PMPRG002
          MOVE      Z70,PMPRG003
          MOVE      SP70,STARTKEY
          MOVE      SP70,SELPRINT
          MOVE      SP70,PARTCODE
          MOVE      SP70,EXTRTYPE
          MOVE      SP70,ECPRPTCD
          MOVE      SP70,ECPRINVN
          MOVE      SP70,ECPRCLID
          MOVE      SP70,ECPRFRID
          MOVE      SP70,ECPRFNDR
          MOVE      SP70,ECPRREPT
          MOVE      SP70,ECPREVCN
          MOVE      SP70,ECPRSVCN
          MOVE      SP70,ECPREXCN
          MOVE      SP70,ECPRRRKY
          MOVE      SP70,ECPRSRVI
          MOVE      SP70,ECPRCFEC
          MOVE      SP70,ECPREXPC
          MOVE      SP70,ECPRSCOD
          MOVE      SP70,ECPRSRVC
          MOVE      SP70,ASSESKEY
          MOVE      SP70,ASSE2KEY
          MOVE      SP70,ECTRSTAT
          MOVE      SP70,ECTRTYPE
          MOVE      SP70,ECTRLOCN
          MOVE      SP70,ECTRCDTE
          MOVE      SP70,ECTRCTIM
          MOVE      SP70,ECTRTRID
          MOVE      SP70,FILTTYPE
          MOVE      SP70,FILTSTAT
          MOVE      SP70,FILTPRAC
          MOVE      SP70,TRANSCID
          MOVE      SP70,LOCATNID
.          MOVE      SP70,FILTOPTN
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            PACK      UPDTTYPE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.  
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF 
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "invoicen=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FORM8     * Justify Right
            MOVE      FORM8,INVOICEN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HOSPCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "batchnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FORM8     * Justify Right
            MOVE      FORM8,BATCHNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE  
            PACK      VALDCODE,VALDCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "batchkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BATCHKEY  
            PACK      BATCHKEY,BATCHKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "checkdfl=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CHECKDFL 
            GOTO      SETPAR99
          ENDIF
.         
          MATCH     "newstats=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEWSTATS  
            PACK      NEWSTATS,NEWSTATS,SP70
            GOTO      SETPAR99
          ENDIF
.         
          MATCH     "reasoncd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REASONCD
            PACK      REASONCD,REASONCD,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "systemid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SYSTEMID
            PACK      SYSTEMID,SYSTEMID,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextvkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTVKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevvkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVVKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextakey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTAKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevakey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVAKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextukey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTUKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevukey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVUKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextekey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTEKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextwkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTWKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevekey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVEKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevwkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVWKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextikey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTIKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "previkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVIKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prvaflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRVAFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prviflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRVIFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prvuflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRVUFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prvwflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRVWFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "strtdate=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * To Format Month
            PACK      STRTDATE,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "endddate=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * To Format Month
            PACK      ENDDDATE,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claim",QRYNAME
          IF        @EQUAL
            CALL      CLAIM000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "declm",QRYNAME
          IF        @EQUAL
            CALL      DECLM000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclm",QRYNAME
          IF        @EQUAL
            CALL      ECCLM000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "peclm",QRYNAME
          IF        @EQUAL
            CALL      PECLM000
            GOTO      SETPAR99
          ENDIF
.                                           * Certificates             *I-86040
          MATCH     "ptcer",QRYNAME
          IF        @EQUAL
            CALL      SPPTCE00              * in PATCERTM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "commtext",QRYNAME
          IF        @EQUAL
            CALL      GETEXT00
            GOTO      SETPAR99
          ENDIF
.                                           * Program Codes            *I-86040
          MATCH     "pmprg001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMPRG001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmprg002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMPRG002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmprg003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMPRG003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clamtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLAMTYPE
            MOVE      TWO,OPTNFLAG               * filter by claim type
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "meditype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MEDITYPE
            MOVE      TWO,OPTNFLAG               * filter by claim type
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hfundtyp=",QRYNAME
          IF        @EQUAL
            PACK      HFUNDTYP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hfundesc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HFUNDESC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "selprint=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SELPRINT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "partcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PARTCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "extrtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXTRTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprptcd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRPTCD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprinvn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRINVN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprclid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRCLID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprfrid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRFRID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprfndr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRFNDR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprrept=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRREPT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprevcn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPREVCN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprsvcn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRSVCN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprexcn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPREXCN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprrrky=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRRRKY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprsrvi=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRSRVI
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprcfec=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRCFEC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprexpc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPREXPC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprscod=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRSCOD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecprsrvc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECPRSRVC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "asseskey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ASSESKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "asse2key=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ASSE2KEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ectrstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECTRSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ectrtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECTRTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ectrlocn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECTRLOCN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ectrcdte=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECTRCDTE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ectrctim=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECTRCTIM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ectrtrid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECTRTRID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showcurr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWCURR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtprac=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTPRAC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "transcID=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TRANSCID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "locatnID=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LOCATNID
            GOTO      SETPAR99
          ENDIF
.
.
.          MATCH     "filtoptn=",QRYNAME
.          IF        @EQUAL
.            MOVE      QRYDATA,FILTOPTN
.            GOTO      SETPAR99
.          ENDIF
.
SETPAR99  RETURN
.
.----------------------------------------------------------------
. Get Text Comments                                                    *I-86040
.----------------------------------------------------------------
GETEXT00  PREP      COMFILAF,COMFILNM
          MOVE      ZERO,COMFLAG            * comments found
          MOVE      ONE,F3
          WRITE     COMFILAF,SEQ;QRYDATA
.
GETEXT10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA
          GOTO      GETEXT90 IF OVER
          MATCH     SP70,QRYNAME
          GOTO      GETEXT80 IF NOT EQUAL
          ADD       ONE,F3
          WRITE     COMFILAF,SEQ;QRYDATA
          GOTO      GETEXT10
.
GETEXT80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
GETEXT90  MOVE      F3,COMMEND
          OPEN      COMFILAF,COMFILNM
GETEXT99  RETURN
.
.----------------------------------------------------------------
. Set parameter for Batch Array
.----------------------------------------------------------------
CLAIM000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          COMPARE   ZERO,F3
          GOTO      CLAIM9999 IF EQUAL
          PACK      CLAIMARR[F3],QRYDATA,SP70
          MOVE      F3,LASTCLAM
CLAIM999  RETURN
.----------------------------------------------------------------
. Set parameter for Eclipse Claim Array
.----------------------------------------------------------------
ECCLM000  IF        LASTECLM < 50
            ADD       ONE,LASTECLM
            PACK      ECCLMARR[LASTECLM],QRYDATA,SP90
          ENDIF
ECCLM999  RETURN
.----------------------------------------------------------------
. Set parameter for Delete Eclipse Claim Array
.----------------------------------------------------------------
DECLM000  IF        LASTDCLM < 50
            ADD       ONE,LASTDCLM
            PACK      DECLMARR[LASTDCLM],QRYDATA,SP70
          ENDIF
DECLM999  RETURN
.----------------------------------------------------------------
. Set parameter for Delete Eclipse Claim Array
.----------------------------------------------------------------
PECLM000  IF        LASTDCLM < 50
            ADD       ONE,LASTDCLM
            PACK      PECLMARR[LASTDCLM],QRYDATA,SP70
          ENDIF
PECLM999  RETURN
.------------------------------------------------------------
. Health Fund HosClaims Account Extract 
.------------------------------------------------------------
HOSEXT00  MATCH     SP70,UPDTTYPE
          GOTO      HOSEXT60 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Check/Validate Batch Number
          GOTO      HOSEXT10 IF EQUAL
.
          GOTO      HOSEXT90
.
HOSEXT10  PACK      KEY8,BATCHNUM,SP70
          CALL      RDPTEBH1 
          BRANCH    OVRCD,HOSEXT91
.
          MATCH     SP70,PTEHHFGP       * No Health Fund set
          GOTO      HOSEXT60 IF EQUAL
.
          PACK      KEY14,PTEHHFGP,ZERO4,SP70
          CALL      RDFUND1                      * HF on file ?
          IF        OVRCD = 1
            MOVE      "Unknown Health Fund",FUNDDESC
          ELSE
            MOVE      HFNAME,FUNDDESC
          ENDIF
.
.                                                                     *I-125462
          UNPACK    SP70,PTESBATN,PTESADMN,PMVXMHOS,PTHSNAME
          UNPACK    SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      HOSEXT70 IF NOT EQUAL
.
          PACK      KEY24,BATCHNUM,SP30     * get Hospital for given Batch
          CALL      RSPTEDS3
          CALL      RKPTEDS3
.
          MATCH     BATCHNUM,PTESBATN
          IF        @EQUAL
            PACK      KEY8,PTESADMN
            CALL      RDPMVX11
            IF        OVRCD = 0
              MOVE      PMVXMHOS,KEY3
              CALL      RDPTHSP1            * read Hospital name for visit
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
          ENDIF
.
          GOTO      HOSEXT70
.
HOSEXT60  MOVE      SP70,PTEHHFGP     * Clear Batch Number Fund Variables
          UNPACK    SP70,HOSPNAME
          MOVE      SP70,FUNDDESC   
.
HOSEXT70  CLEAR     WEBTITLE
          MOVE      "Health Fund HosClaims Account Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HOSEXT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      HOSEXT99
.
HOSEXT90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSEXT99
.
HOSEXT91  MOVE      "Batch number not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSEXT99
.
HOSEXT99  RETURN
.------------------------------------------------------------
. HosClaims/Electronic Claims Enquiry 
.------------------------------------------------------------
HOSENQ00  MATCH     SP70,UPDTTYPE
          GOTO      HOSENQ70 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Check/Validate Batch Number
          GOTO      HOSENQ10 IF EQUAL
.
          MATCH     "B",UPDTTYPE    * Check/Validate Admission Number
          GOTO      HOSENQ20 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Check/Validate Invoice Number
          GOTO      HOSENQ30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Check/Validate U/R Number
          GOTO      HOSENQ40 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Claims Waiting for Extraction 
          GOTO      HOSENQ70 IF EQUAL
.
          MATCH     "G",UPDTTYPE    * Delete Claims                
          GOTO      HOSENQ50 IF EQUAL
.
          GOTO      HOSENQ90
.
.    * Read/Validate Batch Number display function
.
HOSENQ10  PACK      KEY8,BATCHNUM,SP70
          CALL      RDPTEBH1 
          BRANCH    OVRCD,HOSENQ91
.
          MOVE      SP70,FUNDDESC
          MATCH     SP70,PTEHHFGP       * No Health Fund set ?
          IF        !@EQUAL
            PACK      KEY14,PTEHHFGP,ZERO4,SP70
            CALL      RDFUND1                    * HF on file ?
            IF        OVRCD = 1
              MOVE      "Unknown Health Fund",FUNDDESC
            ELSE
              MOVE      HFNAME,FUNDDESC
            ENDIF
          ENDIF
.
.                                                                     *I-125462
          UNPACK    SP70,PTESBATN,PTESADMN,PMVXMHOS,PTHSNAME
          UNPACK    SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      HOSENQ70 IF NOT EQUAL
.         
          PACK      KEY24,BATCHNUM,SP30         * get Hospital for given Batch
          CALL      RSPTEDS3
          CALL      RKPTEDS3
.
          MATCH     BATCHNUM,PTESBATN
          IF        @EQUAL
            MOVE      PTESADMN,KEY8
            CALL      RDPMVX11              * read Visit Extension
            IF        OVRCD = 0
              MOVE      PMVXMHOS,KEY3
              CALL      RDPTHSP1            * read Hospital name for visit
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
          ENDIF
.
          GOTO      HOSENQ70
.
.    * Read/Validate Admission Number display function
.
HOSENQ20  PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1 
          BRANCH    OVRCD,HOSENQ92
.
          MOVE      "Unknown Patient",FRMTNAME   * format patient name
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          IF        OVRCD=0
            MOVE      PSNAME,PACSNAME
            MOVE      PGNAME,PACGNAME
            MOVE      PTITL,PACTITLE
            MOVE      ONE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,FRMTNAME
          ENDIF
.
.                                                                     *I-125462
          UNPACK    SP70,PMVXMHOS,PTHSHOSP,PTHSNAME
          UNPACK    SP70,HOSPNAME
          IF        IBCNMHOS = 1
            MOVE      AADMNO,KEY8
            CALL      RDPMVX11              * read Visit Extension
            IF        OVRCD = 0
              MOVE      PMVXMHOS,KEY3
              CALL      RDPTHSP1            * read Hospital name for visit
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
          ENDIF
.
          GOTO      HOSENQ70
.
.    * Read/Validate Invoice Number display function
.
HOSENQ30  PACK      KEY8,INVOICEN,SP70
          CALL      RDINV1 
          BRANCH    OVRCD,HOSENQ93
.
          MOVE      "Unknown Patient",FRMTNAME   * format patient name
          MOVE      PINVUR,KEY8
          CALL      RDMAST1
          IF        OVRCD=0
            MOVE      PSNAME,PACSNAME
            MOVE      PGNAME,PACGNAME
            MOVE      PTITL,PACTITLE
            MOVE      ONE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,FRMTNAME
          ENDIF
.
.                                                                     *I-125462
          UNPACK    SP70,PMVXMHOS,PTHSHOSP,PTHSNAME
          UNPACK    SP70,HOSPNAME
          IF        IBCNMHOS = 1
            MOVE      PINVADM,KEY8
            CALL      RDPMVX11              * read Visit Extension
            IF        OVRCD = 0
              MOVE      PMVXMHOS,KEY3
              CALL      RDPTHSP1            * read Hospital name for visit
              MOVE      PTHSNAME,HOSPNAME
            ENDIF   
          ENDIF     
.
          GOTO      HOSENQ70
.
.    * Read/Validate U/R Number display function
.
HOSENQ40  PACK      KEY8,URNUMBER,SP70 
          CALL      RDMAST1
          IF        OVRCD=0
            MOVE      PSNAME,PACSNAME
            MOVE      PGNAME,PACGNAME
            MOVE      PTITL,PACTITLE
            MOVE      ONE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,FRMTNAME
          ELSE
            GOTO      HOSENQ94
          ENDIF
.
          GOTO      HOSENQ70
.
.   ************ DELETE CLAIM FUNCTION ************
.
HOSENQ50  MOVE      ZERO,ERRORCNT 
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTCLAM
            MATCH     SP70,CLAIMARR[COUNT]
            IF        !@EQUAL
              CALL      WDEL0000   * Delete Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      HOSENQ99 IF EQUAL
.
          CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      HOSENQ99
.
HOSENQ70  CLEAR     WEBTITLE
          MOVE      "Electronic Claims Enquiry",WEBTITLE
          RESET     WEBTITLE
.
          MATCH     SP70,UPDTTYPE
          IF        @EQUAL
            CALL      HSCLMSRV   * Checking and updating claim statuses
          ENDIF
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HOSENQ99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      HOSENQ99
.
HOSENQ90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSENQ99
.
HOSENQ91  MOVE      "Batch number not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSENQ99
.
HOSENQ92  MOVE      "Admission record not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSENQ99
.
HOSENQ93  MOVE      "Invoice record not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSENQ99
.
HOSENQ94  MOVE      "U/R record not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HOSENQ99
.
HOSENQ99  RETURN
.*****************************************************************************
.*                               WDEL0000              Called by: HOSENQ00   *
.*                   Delete selecetd Claim records                           *
.*****************************************************************************
WDEL0000  PACK      KEY32,CLAIMARR[COUNT],SP70
          CALL      RDPTEDS1
          BRANCH    OVRCD,WDEL9999
.
.         Is this a resubmission from a previous batch?  If so, then remove
.         the next batch number from that record
.
          MATCH     SP8,PTESPBAT
          GOTO      WDEL9000 IF EQUAL
.
.         Use index 3 to get the previous batch record for update (CAR 153566)
.
          PACK      KEY24,PTESPBAT,PTESADMN,PTESINVN
          CALL      RDPTEDS3
          BRANCH    OVRCD,WDEL1000
.
.         Now position on the same record using index 1 (as there is no
.         UPPTEDS3), before updating
.
          PACK      KEY32,PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN
          CALL      RDPTEDS1
          BRANCH    OVRCD,WDEL1000
.
          MOVE      SP8,PTESNBAT
          CALL      UPPTEDS1
          GOTO      WDEL2000
.
WDEL1000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      WDEL9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Error updating previous claim - ",ERRORLST[ERRORCNT]
          APPEND    PTESINVN,ERRORLST[ERRORCNT]
          APPEND    "  Batch - ",ERRORLST[ERRORCNT]
          APPEND    PTESBATN,ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      WDEL9999
.
.  Re-read record to be deleted as above positioned on a different record
.
WDEL2000  PACK      KEY32,CLAIMARR[COUNT],SP70
          CALL      RDPTEDS1
          BRANCH    OVRCD,WDEL9999
.
WDEL9000  PACK      KEY32,SP1,ZERO,PTESHFND,PTESADMN,PTESINVN,PTESBATN,SP70
          CALL      DEPTEDS1
.
WDEL9999  RETURN
+
.*****************************************************************************
.*                               EDEL0000                                    *
.*                   Delete selected Eclipse Claim records                   *
.*****************************************************************************
EDEL0000  MOVE      DECLMARR[COUNT],KEY8    * invoice number
          PACK      KEY16,KEY8,SP70         * batch number is blank
          CALL      RDPMECT2
          BRANCH    OVRCD,EDEL8000
.
          MOVE      PMECINVN,TEMPINVN
          MOVE      PMECBATN,TEMPBATN
          MOVE      PMECADMN,TEMPADMN
          MOVE      PMECURNO,TEMPURNO
          MOVE      PMECHFND,TEMPHFND
          MOVE      PMECPBAT,TEMPPBAT
          MOVE      PMECHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      EDEL1000 IF EQUAL
          GOTO      EDEL1000 IF EOS
.
          PACK      KEY35,TEMPHOSP,TEN5,TEMPHFND,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDPMECT1
          IF        OVRCD = 1
            GOTO      EDEL7000
          ELSE
            MOVE      SP70,PMECNBAT
            CALL      UPPMECT1
          ENDIF
.
.         Delete the selected record
.
EDEL1000  PACK      KEY35,TEMPHOSP,SP1,ZERO,TEMPHFND,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEPMECT1
.
          GOTO      EDEL9999
.
EDEL7000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      EDEL9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Error updating previous claim - ",ERRORLST[ERRORCNT]
          APPEND    PMECINVN,ERRORLST[ERRORCNT]
          APPEND    "  Batch - ",ERRORLST[ERRORCNT]
          APPEND    PMECBATN,ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      EDEL9999
.
EDEL8000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      EDEL9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Record cannot be deleted.  ",ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      EDEL9999

EDEL9999  RETURN
+
.--------------------------------------------------------------------------
.*                             SECLX000                                   *
.*               Schedule Eclipse Extract (IBAPMS04)                      *
.--------------------------------------------------------------------------
SECLX000  MOVE      "IBAPMS04",SCHDPGID
          MOVE      "Eclipse Claims Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAPMS04",SETDFPRG
          MOVE      "8",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ONE,COUNT
          MOVE      HOSPCODE,KEYSTARR[COUNT]    * hospital id
          ADD       ONE,COUNT
          MOVE      OPTNFLAG,KEYSTARR[COUNT]    * extract by fund(1)/claim(2)
          ADD       ONE,COUNT
          MOVE      HFUNDTYP,KEYSTARR[COUNT]    * health fund / claim code
.
          MOVE      THREE,TOTALCNT              * first 3 keyins
.
          ADD      ONE,COUNT
          MOVE     ONE,COUNTEC
          WHILE     COUNTEC <= LASTECLM
            MATCH     SP90,ECCLMARR[COUNTEC]
            IF        !@EQUAL
              MOVE      ECCLMARR[COUNTEC],KEYSTARR[COUNT]    * to be extracted
            ENDIF
            ADD      ONE,COUNT
            ADD      ONE,COUNTEC
          DO
.
          ADD       LASTECLM,TOTALCNT            * eclipse claims keyins
.
          PACK      KEYSTARR[COUNT],SP70         * blank record to signal exit
          ADD       ONE,COUNT
          ADD       ONE,TOTALCNT
.
          MOVE      ANSP,KEYSTARR[COUNT]         * (P)ost
.>>>>
.>>>>     ADD       ONE,COUNT
.>>>>     MOVE      ANSY,KEYSTARR[COUNT]         * (Y) to extract (if ok)
.>>>>
          ADD       ONE,COUNT
          MOVE      SP70,KEYSTARR[COUNT]         * (Enter) to exit
          ADD       ONE,COUNT
          MOVE      "\",KEYSTARR[COUNT]          * (\) to exit
.
          ADD       THREE,TOTALCNT               * add last 3 keyins (if error)
.>>>>     ADD       FOUR,TOTALCNT                * add last 4 keyins (if ok)
          MOVE      TOTALCNT,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SECLX999  RETURN
+
................................................................................
CERTM000  MOVE      ZERO,EXIT
          MATCH     SP70,UPDTTYPE
          GOTO      CERTM500 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add a Certificate
          GOTO      CERTM100 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * delete Certificate
          GOTO      CERTM200 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Certificate
          GOTO      CERTM300 IF EQUAL
.
          GOTO      CERTM900
.
CERTM100  CALL      CERAD000
          GOTO      CERTM999
.
CERTM200  CALL      CERDE000
          GOTO      CERTM999
.
CERTM300  CALL      CERUP000
          GOTO      CERTM999
.
CERTM500  MOVE      URNUMBER,KEY8   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,CERTM910
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY19,URNUMBER,PTCER002,PTCER003
          CALL      RDPTCER1
          IF        OVRCD=1
            CALL      CLRPTCE0              * clear file variableS
          ENDIF
.
.
CERTM510  CLEAR     WEBTITLE
          MOVE      "Certificate Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CERTM999
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      CERTM999
.
CERTM900  MOVE      "Invalid Form Action. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CERTM999
.
CERTM910  MOVE      "Can't find patient Master Details. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CERTM999
.
CERTM999  CLOSE     COMFILAF,DELETE
          RETURN
+
.------------------------------------------------------------
. CERAD000 - Write a new Certificate record
.------------------------------------------------------------
CERAD000  MOVE      ZERO,EXIT
.
          PACK      KEY19,URNUMBER,PTCER002,PTCER003,SP70
          CALL      RDPTCER1
          BRANCH    OVRCD,CERAD500
          GOTO      CERAD900
.
CERAD500  PACK      KEY19,URNUMBER,PTCER002,SP70    * scan all dates
          CALL      CERCHK00                * check for overlap certificates
          BRANCH    EXIT,CERAD910
.
CERAD600  PACK      PTCEURNO,URNUMBER,SP70
          CALL      UPTCE000
.
          PACK      KEY19,PTCEURNO,PTCETYPE,PTCEFDAT,SP70
.
          CALL      WRPTCER1
.
          CALL      CLCUP000                * write any comments
.
          CALL      CERFUA00                * check if Future Actions reqd
          COMPARE   ZERO,EXIT
          CALL      FUTAD000 IF EQUAL       * process Future Actions
.
          IF        CERTIF3B = 1
            CALL      MAS3B000              * Update "patmx1af" with Exp.Date
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CERAD999
.
CERAD900  MOVE      "Certificate Type/Date already exists. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CERAD999
.
CERAD910  MOVE      "Date Range overlaps another Certificate. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CERAD999
.
CERAD999  RETURN
+
.------------------------------------------------------------
. CERDE000 - Delete a Certificate record
.------------------------------------------------------------
CERDE000  MOVE      ZERO,EXIT
          PACK      KEY19,URNUMBER,PTCER002,PTCER003,SP70
          CALL      RDPTCER1
          BRANCH    OVRCD,CERDE900
.
CERDE500  CALL      CLCDE000                * delete any comments
.
          CALL      DEPTCER1                * delete certificate record
.
          CALL      CERFUA00                * check if Future Actions reqd
          COMPARE   ZERO,EXIT
          CALL      FUTDE000 IF EQUAL       * process Future Actions
.
          MOVE      ZERO,EXIT
          GOTO      CERDE999
.
CERDE900  MOVE      "Certificate not found. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
CERDE999  RETURN
+
+
.------------------------------------------------------------
. CERUP000 - Update a Certificate record
.------------------------------------------------------------
CERUP000  MOVE      ZERO,EXIT
.
          PACK      KEY19,URNUMBER,PTCER002,PTCER003,SP70
          CALL      RDPTCER1
          BRANCH    OVRCD,CERUP900
.
CERUP500  CALL      CERCHK00                * check for overlap certificates
          BRANCH    EXIT,CERUP910
.                                           * re-read record to be updated
          PACK      KEY19,URNUMBER,PTCER002,PTCER003,SP70
          CALL      RDPTCER1
.
CERUP600  MOVE      URNUMBER,PTCEURNO
          MOVE      PTCETDAT,SAVETDAT
          CALL      UPTCE000
.
          PACK      KEY19,PTCEURNO,PTCETYPE,PTCEFDAT,SP70
.
          CALL      UPPTCER1
.
          CALL      CLCUP000                * write any comments
.
          CALL      CERFUA00                * check if Future Actions reqd
          COMPARE   ZERO,EXIT
          CALL      FUTUP000 IF EQUAL       * process Future Actions
.
          IF        CERTIF3B = 1
            CALL      MAS3B000              * Update "patmx1af" with Exp.Date
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CERUP999
.
CERUP900  MOVE      "Certificate not found. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CERUP999
.
CERUP910  MOVE      "Date Range overlaps another Certificate .",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CERUP999
.
CERUP999  RETURN
+
.------------------------------------------------------------
. CERCHK00 - Check Certificate for overlap date range
.------------------------------------------------------------
CERCHK00  MOVE      ZERO,EXIT
.                                           * check indicator for Cert. Type
          PACK      KEY5,CATcr,PTCER002,SP5
          CALL      RDCODE1
          IF        OVRCD = 0
            MATCH     "U",TCINDC1
            GOTO      CERCHK99 IF EQUAL     * 3B Certif. - no further checks
          ENDIF
.
          PACK      KEY19,URNUMBER,PTCER002,SP70    * set before CALL
          CALL      RSPTCER1
CERCHK10  CALL      RKPTCER1
          BRANCH    OVRCD,CERCHK99
.
          PACK      KEY11,PTCEURNO,PTCETYPE,SP20
          MATCH     KEY11,KEY19
          GOTO      CERCHK99 IF NOT EQUAL
.
          MATCH     PTCEFDAT,PTCER003
          GOTO      CERCHK10 IF EQUAL       * bypassing checking itself
          IF        @LESS
            MATCH     PTCEFDAT,PTCER004
            GOTO      CERCHK99 IF LESS      * both dates less than old record
          ENDIF
.
          MATCH     PTCER004,PTCETDAT
          IF        @LESS
            MATCH     PTCER003,PTCETDAT
            GOTO      CERCHK10 IF LESS
          ENDIF
.
          MATCH     PTCER003,PTCEFDAT
          IF        @LESS
            MATCH   PTCETDAT,PTCER004
            IF        @LESS
              GOTO      CERCHK90
            ENDIF
          ENDIF
.
          GOTO      CERCHK10
.
CERCHK90  MOVE      ONE,EXIT
.
CERCHK99  RETURN
+
.------------------------------------------------------------
. CERFUA00 - Check Certificate for Future Actions   
.------------------------------------------------------------
CERFUA00  MOVE      ZERO,CERTIF3B
.                                           * check indicator for Cert. Type
          PACK      KEY5,CATcr,PTCETYPE,SP5
          CALL      RDCODE1
          IF        OVRCD = 0
            MATCH     "U",TCINDC1
            GOTO      CERFUA90 IF NOT EQUAL         * not a 3B Certif.
            MOVE      ONE,CERTIF3B
          ENDIF
.
          MATCH     SP8,ADMISSNO            * bypass if no Admission No.
          GOTO      CERFUA90 IF EQUAL
          GOTO      CERFUA90 IF EOS  
.                                           * Get & check Action Code (Cat. FA)
          READ      CONTROLF,FIFTY9;*8,PTCN3BFA,*11,PTCN3BDY
          MATCH     SP3,PTCN3BFA
          GOTO      CERFUA90 IF EQUAL
          PACK      KEY5,CATFA,PTCN3BFA,SP6
          CALL      RDCODE1
          BRANCH    OVRCD,CERFUA90
.
          GOTO      CERFUA99
.
CERFUA90  MOVE      ONE,EXIT
.
CERFUA99  RETURN
+
.------------------------------------------------------------
. CLCUP000 - Write/update Certificate Comments
.------------------------------------------------------------
CLCUP000  BRANCH    COMFLAG,CLCUP900
.
.                                           * delete any existing comments
          PACK      KEY19,PTCEURNO,PTCETYPE,PTCEFDAT,SP70
          PACK      KEY22,PTCEURNO,PTCETYPE,PTCEFDAT,SP70
          CALL      RSPTCLC1
CLCUP100  CALL      RKPTCLC1
          BRANCH    OVRCD,CLCUP200
.
          PACK      KEY22,PTCLURNO,PTCLTYPE,PTCLFDAT,DPTCLLCN
          MATCH     KEY19,KEY22
          GOTO      CLCUP200 IF NOT EQUAL
.
          CALL      DEPTCLC1
          CALL      RSPTCLC1
          GOTO      CLCUP100
.
CLCUP200  COMPARE   ZERO,COMMEND
          GOTO      CLCUP999 IF EQUAL
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      COMFILAF,COMFILNM
          TRAPCLR   IO
          BRANCH    OVRCD,CLCUP999
.                                           * read comments from text file
          MOVE      ZERO,F2
CLCUP300  READ      COMFILAF,SEQ;COMM127
          GOTO      CLCUP900 IF OVER
.
          PACK      PTCLURNO,PTCEURNO,SP70
          PACK      PTCLTYPE,PTCETYPE,SP70
          PACK      PTCLFDAT,PTCEFDAT,SP70
          ADD       ONE,F2
          MOVE      F2,PTCLLCNT
          MOVE      PTCLLCNT,DPTCLLCN
          PACK      PTCLSPAR,SP70
          PACK      KEY22,PTCLURNO,PTCLTYPE,PTCLFDAT,DPTCLLCN,SP70
          CALL      RDPTCLC1
          IF        OVRCD=1
            MOVE      COMM127,PTCLTEXT
            CALL      WRPTCLC1
          ENDIF
          COMPARE   F2,COMMEND
          GOTO      CLCUP300 IF NOT EQUAL
.
CLCUP900  CLOSE     COMFILAF,DELETE
.
CLCUP999  RETURN
+
.------------------------------------------------------------
. CLCDE000 - Delete Certificate Comments
.------------------------------------------------------------
CLCDE000  MOVE      ZERO,EXIT
.
.                                           * delete any existing comments
          PACK      KEY19,PTCEURNO,PTCETYPE,PTCEFDAT,SP70
          PACK      KEY22,PTCEURNO,PTCETYPE,PTCEFDAT,SP70
          CALL      RSPTCLC1
CLCDE100  CALL      RKPTCLC1
          BRANCH    OVRCD,CLCUP200
.
          PACK      KEY22,PTCLURNO,PTCLTYPE,PTCLFDAT,DPTCLLCN
          MATCH     KEY19,KEY22
          GOTO      CLCDE900 IF NOT EQUAL
.
          CALL      DEPTCLC1
          CALL      RSPTCLC1
          GOTO      CLCDE100
.
CLCDE900  CLOSE     COMFILAF,DELETE
.
CLCDE999  RETURN
.
.------------------------------------------------------------
. Add Future Actions for 3D Certificates
.------------------------------------------------------------
FUTAD000  MOVE      ZERO,EXIT
.
          PACK      KEY8,URNUMBER,SP8
          CALL      RDMAST1
          BRANCH    OVRCD,FUTAD999
.
          MOVE      PTCETDAT,FADTDATE
          SUB       PTCN3BDY,FADTDATE       * create Future Action Date
          MOVE      FADTDATE,KEY8
.
          PACK      KEY19,ADMISSNO,KEY8,PTCN3BFA,SP20
          CALL      RDAFACT1
          COMPARE   ZERO,OVRCD
          GOTO      FUTAD999 IF EQUAL
.
          MOVE      KEY8,FADATE
          MOVE      ADMISSNO,FADMNO
          MOVE      ADMISSNO,DFADMNO
          MOVE      PTCN3BFA,FACODE
          MOVE      URNUMBER,PTFCURNO
          MOVE      SP70,FACOMM
          MOVE      "3B Certificate expiry",KEY30 
          PACK      FACOMM,KEY30,SP70
          MOVE      SP70,PTFCDTCP
          MOVE      WBSEOCG,PTFCOCGR
          MOVE      PFUNDH,PTFCOCGR
          MOVE      SP70,PTFCSTAT
          PACK      PTFCCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PTFCCDAT
          CLOCK     TIME,PTFCCTIM
          MOVE      USERID,PTFCCUID
          MOVE      SP70,PTFCUDAT
          MOVE      SP70,PTFCUTIM
          MOVE      SP70,PTFCUUID
          MOVE      SP70,PTFCSPAR
.
          PACK      KEY19,ADMISSNO,FADATE,FACODE,SP20
          CALL      RDAFACT1
          IF        OVRCD=1
            CALL      WRFACT1
          ENDIF
.
FUTAD999  RETURN
.
.------------------------------------------------------------
. Delete Future Actions for 3D Certificates
.------------------------------------------------------------
FUTDE000  MOVE      ZERO,EXIT
.
          MOVE      PTCETDAT,FADTDATE
          SUB       PTCN3BDY,FADTDATE       * create Future Action Date
          MOVE      FADTDATE,KEY8
.
          PACK      KEY19,ADMISSNO,KEY8,PTCN3BFA,SP20
          CALL      DEFACT1
.
FUTDE999  RETURN
.
.------------------------------------------------------------
. Update Future Actions for 3D Certificates
.------------------------------------------------------------
FUTUP000  MOVE      ZERO,EXIT
.                                           * position on original date
          MOVE      SAVETDAT,FADTDATE
          SUB       PTCN3BDY,FADTDATE       * create original Future Action Date
          MOVE      FADTDATE,KEY8
.
          PACK      KEY19,ADMISSNO,KEY8,PTCN3BFA,SP20
          CALL      RDFACT1
          BRANCH    OVRCD,FUTUP999
.
          MOVE      PTCETDAT,FADTDATE
          SUB       PTCN3BDY,FADTDATE       * create Future Action Date
          MOVE      FADTDATE,FADATE
          MOVE      PTCN3BFA,FACODE
.
          PACK      PTFCUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PTFCUDAT
          CLOCK     TIME,PTFCUTIM
          MOVE      USERID,PTFCUUID
.
          CALL      UPFACT1
.
FUTUP999  RETURN
.
.------------------------------------------------------------
. Update "patmx1af" with 3B Certificate Expiry Date
.------------------------------------------------------------
MAS3B000  COMPARE   ONE,CERTIF3B
          GOTO      MAS3B000 IF NOT EQUAL
.
          PACK      KEY8,URNUMBER,SP8
          CALL      RDMAST1
          BRANCH    OVRCD,MAS3B999
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD,SP10
          REP       " 0",CURRDATE
.
          MATCH     PTCETDAT,CURRDATE
          GOTO      MAS3B999 IF NOT LESS
.
          MATCH     PTCETDAT,PTMX3BEX       * is this a later Expiry Date?
....      GOTO      MAS3B999 IF NOT LESS          * ??? do we do this ???
.
          MOVE      PTCETDAT,PTMX3BEX       * set Master file 3B expiry date
          CALL      UPMAST1
.
MAS3B999  RETURN
.------------------------------------------------------------
. Program Codes Details
.------------------------------------------------------------
PRGCD000  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      PRGCD500 IF EQUAL
.
          MATCH     "A",UPDTTYPE           * Add Formaction
          GOTO      PRGCD100 IF EQUAL
.
          MATCH     "U",UPDTTYPE           * Update Formaction
          GOTO      PRGCD200 IF EQUAL
.
          MATCH     "D",UPDTTYPE           * Delete Formaction
          GOTO      PRGCD300 IF EQUAL
.
          GOTO      PRGCD903
.
.         ************ ADD FORMACTION ***********
.
PRGCD100  RESET     PMPRG001
          PACK      KEY8,PMPRG001,SP70
          CALL      RDPMPRG1                * check if Program code exists
          COMPARE   ZERO,OVRCD
          GOTO      PRGCD902 IF EQUAL
.
          PACK      PMPGCODE,PMPRG001,SP70
          UNPACK    SP70,PMPGDESC,PMPGSPAR
          MATCH     PMPRG002,Z70
          IF        !@EQUAL
            PACK      PMPGDESC,PMPRG002,SP70
          ENDIF
          MATCH     PMPRG003,Z70
          IF        !@EQUAL
            MOVE      PMPRG003,PMPGACTV
          ENDIF
          CALL      WRPMPRG1
.
          MOVE      ZERO,EXIT
          GOTO      PRGCD999
.
.         ************ UPDATE FORMACTION **********
.
PRGCD200  PACK      KEY8,PMPRG001,SP8
          CALL      RDPMPRG1
          BRANCH    OVRCD,PRGCD901
.
          UNPACK    SP70,PMPGDESC,PMPGSPAR
          MATCH     PMPRG002,Z70
          IF        !@EQUAL
            PACK      PMPGDESC,PMPRG002,SP70
          ENDIF
          MATCH     PMPRG003,Z70
          IF        !@EQUAL
            PACK      PMPGACTV,PMPRG003,SP70
          ENDIF
          CALL      UPPMPRG1                * update Program Codes record
.
          MOVE      ZERO,EXIT
          GOTO      PRGCD999
.
.         ************ DELETE FORMACTION **********
.
PRGCD300  PACK      KEY8,PMPRG001,SP8
          CALL      DEPMPRG1                * delete Program Codes record
          BRANCH    OVRCD,PRGCD901
.
          MOVE      ZERO,EXIT
          GOTO      PRGCD999
.
.         ************ DISPLAY FORMACTION **********
.
PRGCD500  PACK      KEY8,STARTKEY,SP70
          CALL      RDPMPRG1
          IF        OVRCD=1
            UNPACK    SP70,PMPGCODE,PMPGDESC,PMPGSPAR
          ENDIF
.
          MOVE      "Program Code Maintenance",WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRGCD999
          CALL      WEBBOD00                * Process Web Body
          CALL      WEBEND00                * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRGCD999
.
PRGCD901  MOVE      "Program Code not found. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRGCD999
.
PRGCD902  MOVE      "Program Code exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRGCD999
.
PRGCD903  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRGCD999
.
PRGCD999  RETURN
+
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD99,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110,PROFL120,PROFL130,PROFL140,PROFL150:
                             PROFL160,PROFL170,PROFL180,PROFL190,PROFL200:
                             PROFL210,PROFL220,PROFL230
.
          GOTO      PROFLD99 
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11
          GOTO      PROFLD99
.
PROFLD11  CALL      HOST0000     * Hosclaims Extract
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31
          GOTO      PROFLD99
.
PROFLD31  CALL      ENEQ0000     * Electronic Claims Enquiry 
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41,PROFLD42
          GOTO      PROFLD99
.
PROFLD41  CALL      MASF0000     * PMI Details
          GOTO      PROFLD99
.
PROFLD42  CALL      DPTCE000     * Certificate Details (in PATCERTM)
          GOTO      PROFLD99
.
PROFLD50  CALL      DPMPG000     * Program Codes Details
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61
          GOTO      PROFLD99
.
PROFLD61  CALL      CCPS0000     * CCPS EDI Claims Extract
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71
          GOTO      PROFLD99
.
PROFLD71  CALL      ECEQ0000     * CCPS Electronic Claims Enquiry
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81
          GOTO      PROFLD99
.
PROFLD81  CALL      EEXT0000     * Eclipse IHC Claims Extract
          GOTO      PROFLD99
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91,PROFLD92,PROFLD93
          GOTO      PROFLD99
.
PROFLD91  CALL      EPEN0000     * Eclipse Assessment Report Enquiry
          GOTO      PROFLD99
.
PROFLD92  CALL      EARD0000     * Eclipse Assessment Report Details
          GOTO      PROFLD99
.
PROFLD93  CALL      EARS0000     * Eclipse Assessment Report Services
          GOTO      PROFLD99
.
PROFL100  BRANCH    FLDSETNO,PROFL101
          GOTO      PROFLD99
.
PROFL101  CALL      ETRD0000     * Eclipse Transaction Requests
          GOTO      PROFLD99
.
PROFL110  BRANCH    FLDSETNO,PROFL111
          GOTO      PROFLD99
.
PROFL111  CALL      MEXT0000     * Eclipse IMC Claims Extract
          GOTO      PROFLD99
.
PROFL120  BRANCH    FLDSETNO,PROFL121,PROFL122,PROFL123
          GOTO      PROFLD99
.
PROFL121  CALL      EMEN0000     * Eclipse IMC Assessment Report Enquiry
          GOTO      PROFLD99
.
PROFL122  CALL      EMRD0000     * Eclipse IMC Assessment Report Details
          GOTO      PROFLD99
.
PROFL123  CALL      EMRS0000     * Eclipse IMC Assessment Report Services
          GOTO      PROFLD99
.
PROFL130  BRANCH    FLDSETNO,PROFL131
          GOTO      PROFLD99
.
PROFL131  CALL      FEXT0000     * Eclipse PCS Claims Extract
          GOTO      PROFLD99
.
PROFL140  BRANCH    FLDSETNO,PROFL141
          GOTO      PROFLD99
.
PROFL141  CALL      DEXT0000     * Eclipse DBS Claims Extract
          GOTO      PROFLD99
.
PROFL150  BRANCH    FLDSETNO,PROFL151,PROFL152
          GOTO      PROFLD99
.
PROFL151  CALL      EBEN0000     * Eclipse DBS Assessment Report Enquiry
          GOTO      PROFLD99
.
PROFL152  CALL      EBRD0000     * Eclipse DBS Assessment Report Details
          GOTO      PROFLD99
.
PROFL160  BRANCH    FLDSETNO,PROFL161
          GOTO      PROFLD99
.
PROFL161  CALL      MEXW0000     * WebServices IMCW Claims Extract
          GOTO      PROFLD99
.
PROFL170  BRANCH    FLDSETNO,PROFL171,PROFL172,PROFL173,PROFL174,PROFL175
          GOTO      PROFLD99
.
PROFL171  CALL      IMWD0000     * WebServices IMCW webimdaf tags
          GOTO      PROFLD99
.
PROFL172  CALL      IMWE0000     * WebServices IMCW webimeaf tags
          GOTO      PROFLD99
.
PROFL173  CALL      IMWF0000     * WebServices IMCW webimfaf tags
          GOTO      PROFLD99
.
PROFL174  CALL      IMWG0000     * WebServices IMCW webimgaf tags
          GOTO      PROFLD99
.
PROFL175  CALL      IMWH0000     * WebServices IMCW webimhaf tags
          GOTO      PROFLD99
.
PROFL180  BRANCH    FLDSETNO,PROFL181
          GOTO      PROFLD99
.
PROFL181  CALL      WEXT0000     * WebServices IHCW Claims Extract
          GOTO      PROFLD99
.
PROFL190  BRANCH    FLDSETNO,PROFL191,PROFL192,PROFL193,PROFL194,PROFL195
          GOTO      PROFLD99
.
PROFL191  CALL      IHWD0000     * WebServices IHCW webihdaf tags
          GOTO      PROFLD99
.
PROFL192  CALL      IHWE0000     * WebServices IHCW webiheaf tags
          GOTO      PROFLD99
.
PROFL193  CALL      IHWF0000     * WebServices IHCW webihfaf tags
          GOTO      PROFLD99
.
PROFL194  CALL      IHWG0000     * WebServices IHCW webihgaf tags
          GOTO      PROFLD99
.
PROFL195  CALL      IHWH0000     * WebServices IHCW webihhaf tags
          GOTO      PROFLD99
.
PROFL200  BRANCH    FLDSETNO,PROFL201
          GOTO      PROFLD99
.
PROFL201  CALL      WTRD0000     * WebServices Transaction Requests
          GOTO      PROFLD99
.
PROFL210  BRANCH    FLDSETNO,PROFL211
          GOTO      PROFLD99
.
PROFL211  CALL      PEXT0000     * WebServices PCIW Claims Extract
          GOTO      PROFLD99
.
PROFL220  BRANCH    FLDSETNO,PROFL221
          GOTO      PROFLD99
.
PROFL221  CALL      BEXT0000     * Eclipse BBSW Claims Extract
          GOTO      PROFLD99
.
PROFL230  BRANCH    FLDSETNO,PROFL231
          GOTO      PROFLD99
.
PROFL231  CALL      VEXT0000     * Eclipse DVAW Claims Extract
          GOTO      PROFLD99
.
PROFLD99  RETURN
.--------------------------------------------------------------------------
. Option 1 - Hosclaims Extract
.--------------------------------------------------------------------------
HOST0000  BRANCH    FLDITMNO,HOST0100,HOST0200,HOST0300,HOST0400,HOST0500:
                             HOST0600,HOST0700,HOST0800,HOST0900,HOST1000:
                             HOST1100,HOST1200,HOST1300
          GOTO      HOST9999
.
HOST0100  MATCH     SP70,BATCHNUM
          GOTO      HOST9999 IF EQUAL
          WRITE     HTMLFILE;BATCHNUM;    * Batch Health Fund Name
          GOTO      HOST9999
.
HOST0200  MATCH     SP70,PTEHHFGP
          GOTO      HOST9999 IF EQUAL
          WRITE     HTMLFILE;PTEHHFGP;    * Batch Health Fund
          GOTO      HOST9999
.
HOST0300  MATCH     SP70,FUNDDESC
          GOTO      HOST9999 IF EQUAL
          WRITE     HTMLFILE;FUNDDESC;    * Batch Health Fund Name
          GOTO      HOST9999
.
HOST0400  CALL      HSVTB000              * Table of all Invoices for a Batch
          GOTO      HOST9999
.
HOST0500  CALL      PREVGR00              * Show Previous group of records
          GOTO      HOST9999
.
HOST0600  CALL      NEXTGR00              * Show Next group of records
          GOTO      HOST9999
.
HOST0700  CALL      BATTB000              * Table of Batch Numbers
          GOTO      HOST9999
.
HOST0800  CALL      PREVBT00              * Show Previous group of records
          GOTO      HOST9999
.
HOST0900  CALL      NEXTBT00              * Show Next group of records
          GOTO      HOST9999
.
HOST1000  CALL      HSEL0000              * Health Fund Group Selection List
          GOTO      HOST9999
.
HOST1100  MOVE      "CL",CATEGORY         * Compensation code/Claim Type
          MOVE      SP70,CODE
          CALL      CODITM00              
          GOTO      HOST9999
.
HOST1200  CALL      HOSPID00              * Hospital Selection List
          GOTO      HOST9999
.
HOST1300  CALL      ENHOS000              * Hospital Name header      *I-125462
          GOTO      HOST9999
.
HOST9999  RETURN
.------------------------------------------------------------
. Health Fund Group Selection
.------------------------------------------------------------
HSEL0000  PACK      KEY6,SP70
          CALL      RSPAHGP1
HSEL0100  CALL      RKPAHGP1
          BRANCH    OVRCD,HSEL9999
.
          MOVE      PTHGDESC,KEY50
          PACK      KEY8,QUOTE,PTHGCODE,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY8,">",KEY50,"</option>"
          GOTO      HSEL0100
.
HSEL9999  RETURN
.------------------------------------------------------------
. Hospital ID
.------------------------------------------------------------
HOSPID00  PACK      KEY3,SP10
          CALL      RSPTHSP1
HOSPID10  CALL      RKPTHSP1
          BRANCH    OVRCD,HOSPID90
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          BRANCH    IBCNMHOS,HOSPID20
          WRITE     HTMLFILE;"<option value=",KEY5,">":
                             PTHSNAME,"</option>"
          GOTO      HOSPID10
.
.         Mult-Hospital
.
HOSPID20  BRANCH    ALLHFLAG,HOSPID30            * don't default to user's hosp
          MATCH     SP6,HOSPCODE                                      *C-125462
          IF        @EQUAL
            MOVE      WBSEHOSP,HOSPCODE          * default to user's Hosp code
          ENDIF
HOSPID30  MATCH     HOSPCODE,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               PTHSNAME,"</option>"
          ENDIF
          GOTO      HOSPID10
.
HOSPID90  MOVE      ZERO,ALLHFLAG
HOSPID99  RETURN
+
.--------------------------------------------------------------------------
. Option 3 - Electronic Claims Enquiry 
.--------------------------------------------------------------------------
ENEQ0000  BRANCH    FLDITMNO,ENEQ0100,ENEQ0200,ENEQ0300,ENEQ0400,ENEQ0500:
                             ENEQ0600,ENEQ0700,ENEQ0800,ENEQ0900,ENEQ1000:
                             ENEQ1100,ENEQ1200,ENEQ1300,ENEQ1400,ENEQ1500:
                             ENEQ1600,ENEQ1700,ENEQ1800,ENEQ1900,ENEQ2000:
                             ENEQ2100,ENEQ2200,ENEQ2300,ENEQ2400,ENEQ2500:
                             ENEQ2600,ENEQ2700,ENEQ2800,ENEQ2900,ENEQ3000
          GOTO      ENEQ9999
.
ENEQ0100  MATCH     SP70,BATCHNUM
          GOTO      ENEQ9999 IF EQUAL
          WRITE     HTMLFILE;BATCHNUM;    * Batch Health Fund Name
          GOTO      ENEQ9999
.
ENEQ0200  MATCH     SP70,PTEHHFGP
          GOTO      ENEQ9999 IF EQUAL
          WRITE     HTMLFILE;PTEHHFGP;    * Batch Health Fund
          GOTO      ENEQ9999
.
ENEQ0300  MATCH     SP70,FUNDDESC
          GOTO      ENEQ9999 IF EQUAL
          WRITE     HTMLFILE;FUNDDESC;    * Batch Health Fund Name
          GOTO      ENEQ9999
.
ENEQ0400  CALL      BACTB000              * Claims Enquiry by Batch
          GOTO      ENEQ9999
.
ENEQ0500  CALL      PREVGR00              * Show Previous group of records
          GOTO      ENEQ9999
.
ENEQ0600  CALL      NEXTGR00              * Show Next group of records
          GOTO      ENEQ9999
.
ENEQ0700  MATCH     SP70,UPDTTYPE
          GOTO      ENEQ9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI          
          GOTO      ENEQ9999
.
ENEQ0800  MOVE      "Extracted     ",BSTATDES
          LOAD      BSTATDES,PTEHFLAG,BSTATDS1,BSTATDS2,BSTATDS3
          STRIP     BSTATDES
          WRITE     HTMLFILE;BSTATDES;    * Batch Status          
          GOTO      ENEQ9999
.
ENEQ0900  WRITE     HTMLFILE;FRMTNAME;    * Formatted Patient Name
          GOTO      ENEQ9999
.
ENEQ1000  CALL      ADMTB000              * Claims Enquiry by Admission
          GOTO      ENEQ9999
.
ENEQ1100  WRITE     HTMLFILE;AURNO;       * U/R Number
          GOTO      ENEQ9999
.
ENEQ1200  MATCH     SP70,ADMISSNO
          GOTO      ENEQ9999 IF EQUAL
          WRITE     HTMLFILE;ADMISSNO;    * Admission Number 
          GOTO      ENEQ9999
.
ENEQ1300  MATCH     SP70,INVOICEN
          GOTO      ENEQ9999 IF EQUAL
          WRITE     HTMLFILE;INVOICEN;    * Invoice Number 
          GOTO      ENEQ9999
.
ENEQ1400  WRITE     HTMLFILE;DPINVADM;    * Admission Number
          GOTO      ENEQ9999
.
ENEQ1500  WRITE     HTMLFILE;PINVUR;      * U/R Number
          GOTO      ENEQ9999
.
ENEQ1600  CALL      INVTB000              * Claims Enquiry by Invoice
          GOTO      ENEQ9999
.
ENEQ1700  CALL      PREVIN00              * Show Previous group of records
          GOTO      ENEQ9999
.
ENEQ1800  CALL      NEXTIN00              * Show Next group of records
          GOTO      ENEQ9999
.
ENEQ1900  CALL      PREVAD00              * Show Previous group of records
          GOTO      ENEQ9999
.
ENEQ2000  CALL      NEXTAD00              * Show Next group of records
          GOTO      ENEQ9999
.
ENEQ2100  MATCH     SP70,URNUMBER
          GOTO      ENEQ9999 IF EQUAL
          WRITE     HTMLFILE;URNUMBER;    * U/R Number
          GOTO      ENEQ9999
.
ENEQ2200  CALL      URNTB000              * Claims Enquiry by U/R
          GOTO      ENEQ9999
.
ENEQ2300  CALL      PREVUR00              * Show Previous group of records
          GOTO      ENEQ9999
.
ENEQ2400  CALL      NEXTUR00              * Show Next group of records
          GOTO      ENEQ9999
.
ENEQ2500  CALL      WATTB000              * Claims Waiting for Extraction
          GOTO      ENEQ9999
.
ENEQ2600  CALL      PREVW000              * Show Previous group of records
          GOTO      ENEQ9999
.
ENEQ2700  CALL      NEXTW000              * Show Next group of records
          GOTO      ENEQ9999
.
ENEQ2800  COMPARE   ONE,IBCNMHOS          * Check Multi-hospital 
          GOTO      ENEQ9999 IF NOT EQUAL
          CALL      ENMH0000              * display Multi-hosp. selection list
          GOTO      ENEQ9999
.
ENEQ2900  CALL      ENSHN000              * selected Hospital Desc (Multi-hosp)
          GOTO      ENEQ9999
.
.                                                                     *I-125462
ENEQ3000  CALL      ENHOS000              * Hospital name for header (multi-hos)
          GOTO      ENEQ9999
.
ENEQ9999  RETURN
.------------------------------------------------------------
. Table of all Invoices for a Batch                 
.------------------------------------------------------------
HSVTB000  MOVE      ONE,SHOWFLAG            * Show no more visits message
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PREVFLAG = 1         
            MATCH     SP70,PREVVKEY
            IF        !@EQUAL
              CALL      GETPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVVKEY
              GOTO      HSVTB050
            ENDIF
            PACK      KEY24,BATCHNUM,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      HSVTB050
          ENDIF
.
          MATCH     SP70,NEXTVKEY
          IF        !@EQUAL
            CALL      LASTVS00              * Check to see if at the last rec 
            PACK      KEY24,NEXTVKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTVKEY
            GOTO      HSVTB050
          ENDIF
.
          MATCH     SP70,BATCHNUM           * Exit as we don't have a Batch No.
          GOTO      HSVTB999 IF EQUAL
.
          PACK      KEY24,BATCHNUM,SP70
HSVTB050  CALL      RSPTEDS3                * Position for batch #
HSVTB100  CALL      RKPTEDS3                * read next record
          BRANCH    OVRCD,HSVTB900          * end of file
.
          MATCH     PTESBATN,BATCHNUM       * Still same batch?
          GOTO      HSVTB900 IF NOT EQUAL
.
          MATCH     "00000000",PTESNBAT
          GOTO      HSVTB100 IF EQUAL
.
          PACK      NEXTVKEY,PTESBATN,PTESADMN,PTESINVN,SP70
          MATCH     SP70,PREVVKEY
          IF        @EQUAL
            PACK      PREVVKEY,PTESBATN,PTESADMN,PTESINVN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      HSVTB100
          ENDIF
.
          CALL      HSVRW000      * Display Register Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      HSVTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

HSVTB200  CALL      RKPTEDS3                * read next record
          BRANCH    OVRCD,HSVTB800          * end of file
.
          MATCH     PTESBATN,BATCHNUM       * Still same batch?
          GOTO      HSVTB800 IF NOT EQUAL
.
          MATCH     "00000000",PTESNBAT     * read next if equal
          GOTO      HSVTB200 IF EQUAL

          MOVE      ZERO,SHOWFLAG   * Not at last record
          GOTO      HSVTB900
.
HSVTB800  MOVE      ONE,SHOWFLAG    * At last record
.
HSVTB900  CALL      NOMORE00                * Show no more records message
          GOTO      HSVTB999 
.
HSVTB999  RETURN
.------------------------------------------------------------
. All Invoices for a Batch (TABLE ROW)
.------------------------------------------------------------
HSVRW000  PACK      KEY8,PTESINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      "Unknown",KEY15
          ELSE
            MOVE      PINVAMT,KEY15
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          WRITE     HTMLFILE;PTESADMN,"&nbsp;</td>":
                             "<td>",PTESINVN,"&nbsp;</td>":
                             "<td>",PTESURNO,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td>",STATUS3,"&nbsp;</td>":
                             "<td>",PTESPBAT,"&nbsp;</td>":
                             "<td>",PTESNBAT,"&nbsp;</td>"
.
HSVRW999  RETURN
.------------------------------------------------------------
. Table of all Invoices for a Batch                 
.------------------------------------------------------------
BACTB000  MOVE      ONE,SHOWFLAG            * Show no more visits message
.
          IF        NORECORD=0
            MOVE      "14",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PREVFLAG = 1         
            MATCH     SP70,PREVVKEY
            IF        !@EQUAL
              CALL      BGTPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVVKEY
              GOTO      BACTB050
            ENDIF
            PACK      KEY24,BATCHNUM,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      BACTB050
          ENDIF
.
          MATCH     SP70,NEXTVKEY
          IF        !@EQUAL
            CALL      BLSTVS00              * Check to see if at the last rec 
            PACK      KEY24,NEXTVKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTVKEY
            GOTO      BACTB050
          ENDIF
.
          MATCH     SP70,BATCHNUM           * Exit as we don't have a Batch No.
          GOTO      BACTB999 IF EQUAL
.
          PACK      KEY24,BATCHNUM,SP70
BACTB050  CALL      RSPTEDS3                * Position for batch #
BACTB100  CALL      RKPTEDS3                * read next record
          BRANCH    OVRCD,BACTB900          * end of file
.
          MATCH     PTESBATN,BATCHNUM       * Still same batch?
          GOTO      BACTB900 IF NOT EQUAL
.
          PACK      NEXTVKEY,PTESBATN,PTESADMN,PTESINVN,SP70
          MATCH     SP70,PREVVKEY
          IF        @EQUAL
            PACK      PREVVKEY,PTESBATN,PTESADMN,PTESINVN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BACTB100
          ENDIF
.
          CALL      BACRW000      * Output Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BACTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

BACTB200  CALL      RKPTEDS3                * read next record
          BRANCH    OVRCD,BACTB800          * end of file
.
          MATCH     PTESBATN,BATCHNUM       * Still same batch?
          GOTO      BACTB800 IF NOT EQUAL
.
          MOVE      ZERO,SHOWFLAG   * Not at last record
          GOTO      BACTB900
.
BACTB800  MOVE      ONE,SHOWFLAG    * At last record
.
BACTB900  CALL      NOMREB00                * Show no more records message
          GOTO      BACTB999 
.
BACTB999  RETURN
.------------------------------------------------------------
. All Invoices for a Batch (TABLE ROW)
.------------------------------------------------------------
BACRW000  MOVE      ZERO,SUBFLAG
.
          PACK      KEY8,PTESINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      "Unknown",KEY15
          ELSE
            MOVE      PINVAMT,KEY15
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          MOVE      STATUS0,STATDESC
          LOAD      STATDESC,PTESFLAG,STATUS1,STATUS2,STATUS3,STATUS4,STATUS5
.
          MOVE      PTESNBAT,BNEXTFLD
          IF        PTESFLAG > 1
            MATCH     ZERO8,PTESNBAT
            IF        @EQUAL
              MOVE      "Waiting",BNEXTFLD
              MOVE      ONE,SUBFLAG
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;PTESADMN,"&nbsp;</td>":
                             "<td>",PTESINVN,"&nbsp;</td>":
                             "<td>",PTESURNO,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td>",STATDESC,"&nbsp;</td>":
                             "<td>",PTESPBAT,"&nbsp;</td>":
                             "<td>",BNEXTFLD,"&nbsp;</td>"
.
          IF        SUBFLAG = ONE
            WRITE     HTMLFILE;"<td><input type=checkbox name=dummy":
                      " value='",PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN:
                      "' onclick='Resubmit(this);' checked></td>"
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=dummy":
                      " value='",PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN:
                      "' onclick='Resubmit(this);'></td>"
          ENDIF
.
BACRW999  RETURN
.------------------------------------------------------------
. Table of all Invoices for an Admission            
.------------------------------------------------------------
ADMTB000  MOVE      ONE,SHOWFLAG            * Show no more visits message
.
          MOVE      "14",NORECORD       * Set Default No Records to Display
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PRVAFLAG = 1         
            MATCH     SP70,PREVAKEY
            IF        !@EQUAL
              CALL      ADMPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVAKEY
              GOTO      ADMTB050
            ENDIF
            PACK      KEY24,ADMISSNO,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      ADMTB050
          ENDIF
.
          MATCH     SP70,NEXTAKEY
          IF        !@EQUAL
            CALL      ADMLVS00              * Check to see if at the last rec 
            PACK      KEY24,NEXTAKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTAKEY
            GOTO      ADMTB050
          ENDIF
.
          MATCH     SP70,ADMISSNO           * Exit as we don't have a Admin No.
          GOTO      ADMTB999 IF EQUAL
.
          PACK      KEY24,ADMISSNO,SP70
ADMTB050  CALL      RSPTEDS4                * Position for Admiss #
ADMTB100  CALL      RKPTEDS4                * read next record
          BRANCH    OVRCD,ADMTB900          * end of file
.
          MATCH     PTESADMN,ADMISSNO       * Still same Admission?
          GOTO      ADMTB900 IF NOT EQUAL
.
          PACK      NEXTAKEY,PTESADMN,PTESINVN,PTESBATN,SP70
          MATCH     SP70,PREVAKEY
          IF        @EQUAL
            PACK      PREVAKEY,PTESADMN,PTESINVN,PTESBATN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ADMTB100
          ENDIF
.
          CALL      ADMRW000      * Output Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ADMTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

ADMTB200  CALL      RKPTEDS4                * read next record
          BRANCH    OVRCD,ADMTB800          * end of file
.
          MATCH     PTESADMN,ADMISSNO       * Still same Admission?
          GOTO      ADMTB800 IF NOT EQUAL
.
          MOVE      ZERO,SHOWFLAG   * Not at last record
          GOTO      ADMTB900
.
ADMTB800  MOVE      ONE,SHOWFLAG    * At last record
.
ADMTB900  CALL      NOMREB00                * Show no more records message
          GOTO      ADMTB999 
.
ADMTB999  RETURN
.------------------------------------------------------------
. All Invoices for a Batch (TABLE ROW)
.------------------------------------------------------------
ADMRW000  MOVE      ZERO,SUBFLAG
.
          PACK      KEY8,PTESINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      "Unknown",KEY15
          ELSE
            MOVE      PINVAMT,KEY15
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          MOVE      STATUS0,STATDESC
          LOAD      STATDESC,PTESFLAG,STATUS1,STATUS2,STATUS3,STATUS4,STATUS5
.
          MOVE      PTESNBAT,BNEXTFLD
          IF        PTESFLAG > 1
            MATCH     ZERO8,PTESNBAT
            IF        @EQUAL
              MOVE      "Waiting",BNEXTFLD
              MOVE      ONE,SUBFLAG
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;PTESINVN,"&nbsp;</td>":
                             "<td>",PTESBATN,"&nbsp;</td>":
                             "<td>",PTESHFND,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td>",STATDESC,"&nbsp;</td>":
                             "<td>",PTESPBAT,"&nbsp;</td>":
                             "<td>",BNEXTFLD,"&nbsp;</td>"
.
          IF        SUBFLAG = ONE
            WRITE     HTMLFILE;"<td><input type=checkbox name=dummy":
                      " value='",PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN:
                      "' onclick='Resubmit(this);' checked></td>"
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=dummy":
                      " value='",PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN:
                      "' onclick='Resubmit(this);'></td>"
          ENDIF
.
ADMRW999  RETURN
.------------------------------------------------------------
. Table of all Invoices for an U/R            
.------------------------------------------------------------
URNTB000  MOVE      ONE,SHOWFLAG        
.
          MOVE      "14",NORECORD       * Set Default No Records to Display
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PRVUFLAG = 1         
            MATCH     SP70,PREVUKEY
            IF        !@EQUAL
              CALL      URNPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVUKEY
              GOTO      URNTB050
            ENDIF
            PACK      KEY32,URNUMBER,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      URNTB050
          ENDIF
.
          MATCH     SP70,NEXTUKEY
          IF        !@EQUAL
            CALL      URNLVS00              * Check to see if at the last rec 
            PACK      KEY32,NEXTUKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTUKEY
            GOTO      URNTB050
          ENDIF
.
          MATCH     SP70,URNUMBER           * Exit as we don't have a URNin No.
          GOTO      URNTB999 IF EQUAL
.
          PACK      KEY32,URNUMBER,SP70
URNTB050  CALL      RSPTEDS5                * Position for U/R #
URNTB100  CALL      RKPTEDS5                * read next record
          BRANCH    OVRCD,URNTB900          * end of file
.
          MATCH     PTESURNO,URNUMBER       * Still same U/R?
          GOTO      URNTB900 IF NOT EQUAL
.
          PACK      NEXTUKEY,PTESURNO,PTESADMN,PTESINVN,PTESBATN,SP70
          MATCH     SP70,PREVUKEY
          IF        @EQUAL
            PACK      PREVUKEY,PTESURNO,PTESADMN,PTESINVN,PTESBATN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      URNTB100
          ENDIF
.
          CALL      URNRW000      * Output Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      URNTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

URNTB200  CALL      RKPTEDS5                * read next record
          BRANCH    OVRCD,URNTB800          * end of file
.
          MATCH     PTESURNO,URNUMBER       * Still same U/R?
          GOTO      URNTB800 IF NOT EQUAL
.
          MOVE      ZERO,SHOWFLAG   * Not at last record
          GOTO      URNTB900
.
URNTB800  MOVE      ONE,SHOWFLAG    * At last record
.
URNTB900  CALL      NOMREC00        * Show no more records message
          GOTO      URNTB999 
.
URNTB999  RETURN
.------------------------------------------------------------
. All Invoices for a Batch (TABLE ROW)
.------------------------------------------------------------
URNRW000  MOVE      ZERO,SUBFLAG
.
          UNPACK    SP70,DPINVADM,PMVXMHOS,PTHSHOSP,PTHSNAME          *I-125462
          UNPACK    SP70,HOSPNAME
          PACK      KEY8,PTESINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      "Unknown",KEY15
          ELSE
            MOVE      PINVAMT,KEY15
          ENDIF
.                                           * identify visit hospital *I-125462
          IF        IBCNMHOS = 1
            MOVE      PTESADMN,KEY8
            CALL      RDPMVX11
            MATCH     SP3,PMVXMHOS
            IF        !@EQUAL
              MOVE      PMVXMHOS,KEY3
              CALL      RDPTHSP1            * read Hospital name for visit
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          MOVE      STATUS0,STATDESC
          LOAD      STATDESC,PTESFLAG,STATUS1,STATUS2,STATUS3,STATUS4,STATUS5
.
          MOVE      PTESNBAT,BNEXTFLD
          IF        PTESFLAG > 1
            MATCH     ZERO8,PTESNBAT
            IF        @EQUAL
              MOVE      "Waiting",BNEXTFLD
              MOVE      ONE,SUBFLAG
            ENDIF
          ENDIF
.
.                                                                     *C-125462
          IF        IBCNMHOS = 1
            WRITE     HTMLFILE;PTESADMN,"&nbsp;</td>":
                               "<td>",PTHSNAME,"&nbsp;</td>":
                               "<td>",PTESINVN,"&nbsp;</td>":
                               "<td>",KEY15,"&nbsp;</td>":
                               "<td>",PTESBATN,"&nbsp;</td>":
                               "<td>",PTESHFND,"&nbsp;</td>":
                               "<td>",STATDESC,"&nbsp;</td>":
                               "<td>",PTESPBAT,"&nbsp;</td>":
                               "<td>",BNEXTFLD,"&nbsp;</td>"
          ELSE
            WRITE     HTMLFILE;PTESADMN,"&nbsp;</td>":
                               "<td>",PTESINVN,"&nbsp;</td>":
                               "<td>",KEY15,"&nbsp;</td>":
                               "<td>",PTESBATN,"&nbsp;</td>":
                               "<td>",PTESHFND,"&nbsp;</td>":
                               "<td>",STATDESC,"&nbsp;</td>":
                               "<td>",PTESPBAT,"&nbsp;</td>":
                               "<td>",BNEXTFLD,"&nbsp;</td>"
          ENDIF
.
          IF        SUBFLAG = ONE
            WRITE     HTMLFILE;"<td><input type=checkbox name=dummy":
                      " value='",PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN:
                      "' onclick='Resubmit(this);' checked></td>"
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=dummy":
                      " value='",PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN:
                      "' onclick='Resubmit(this);'></td>"
          ENDIF
.
URNRW999  RETURN
.------------------------------------------------------------
. Table of all Claims Waiting For Extraction  
.------------------------------------------------------------
WATTB000  MOVE      ONE,SHOWFLAG        
          MOVE      ZERO,FORM3
.
          MOVE      "17",NORECORD       * Set Default No Records to Display
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PRVWFLAG = 1         
            MATCH     SP70,PREVWKEY
            IF        !@EQUAL
              CALL      WATPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVWKEY
              GOTO      WATTB050
            ENDIF
            PACK      KEY32,SP1,ZERO,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      WATTB050
          ENDIF
.
          MATCH     SP70,NEXTWKEY
          IF        !@EQUAL
            CALL      WATLVS00              * Check to see if at the last rec 
            PACK      KEY32,NEXTWKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTWKEY
            GOTO      WATTB050
          ENDIF
.
          PACK      KEY32,SP1,ZERO,SP70
WATTB050  CALL      RSPTEDS1                
WATTB100  CALL      RKPTEDS1                * read next record
          BRANCH    OVRCD,WATTB900          * end of file
.
          COMPARE   ZERO,PTESFLAG           * waiting for extract still ?
          GOTO      WATTB900 IF NOT EQUAL
.
.                                                                     *I-125462
          COMPARE   ONE,IBCNMHOS
          GOTO      WATTB200 IF NOT EQUAL
          CALL      WATSL000                * select by Hospital ID
          BRANCH    EXIT,WATTB100
.
WATTB200  PACK      NEXTWKEY,PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN,SP70
          MATCH     SP70,PREVWKEY
          IF        @EQUAL
            PACK      PREVWKEY,PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      WATTB100
          ENDIF
.
          CALL      WATRW000      * Output Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      WATTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

WATTB300  CALL      RKPTEDS1                * read next record
          BRANCH    OVRCD,WATTB800          * end of file
.
          COMPARE   ZERO,PTESFLAG           * waiting for extract still ?
          GOTO      WATTB800 IF NOT EQUAL
.
          MOVE      ZERO,SHOWFLAG   * Not at last record
          GOTO      WATTB900
.
WATTB800  MOVE      ONE,SHOWFLAG    * At last record
.
WATTB900  CALL      NOMREC00        * Show no more records message
          GOTO      WATTB999 
.
WATTB999  RETURN
.
.------------------------------------------------------------
. Check Invoice for selected Hospital ID against Visit Extn.
.------------------------------------------------------------
WATSL000  MOVE      ZERO,EXIT
.
          MOVE      PTESADMN,KEY8
          CALL      RDPMVX11
          BRANCH    OVRCD,WATSL900
.
          MATCH     HOSPCODE,PMVXMHOS
          GOTO      WATSL999 IF EQUAL
.
WATSL900  MOVE      ONE,EXIT                * Invoice not selected
.
WATSL999  RETURN
.------------------------------------------------------------
. All Invoices for a Batch (TABLE ROW)
.------------------------------------------------------------
WATRW000  MOVE      ZERO,SUBFLAG
.
          PACK      KEY8,PTESINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      "Unknown",KEY15
          ELSE
            MOVE      PINVAMT,KEY15
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;PTESHFND,"&nbsp;</td>":
                             "<td>",PTESADMN,"&nbsp;</td>":
                             "<td>",PTESINVN,"&nbsp;</td>":
                             "<td>",PTESURNO,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td>",PTESPBAT,"&nbsp;</td>":
                             "<td><input type=checkbox name=claim",KEY3:
                        " value='",PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN:
                             "' ></td>"
.
WATRW999  RETURN
+
.------------------------------------------------------------
. Display Multi-hospital selection list   
.------------------------------------------------------------
ENMH0000  COMPARE   ONE,IBCNMHOS
          GOTO      ENMH9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<td class=DataLabel>Hospital ID &nbsp; &nbsp;":
                             " &nbsp; &nbsp;":
                             "<select name=hospcode title='Hospital ID' ":
                             "class=Mandatory onchange='SetHosp(this);'>"
.
          CALL      HOSPID00
.
          WRITE     HTMLFILE;"</select></td>";
.
ENMH9999  RETURN
+
.------------------------------------------------------------
. Display selected Hospital Name (multi-hospital)
.------------------------------------------------------------
ENSHN000  COMPARE   ONE,IBCNMHOS
          GOTO      ENSHN999 IF NOT EQUAL
.
          MOVE      " Unknown",DIM8
          PACK      PTHSNAME,HOSPCODE,DIM8
          PACK      KEY3,HOSPCODE,SP10
          CALL      RDPTHSP1
.
          WRITE     HTMLFILE;PTHSNAME
.
ENSHN999  RETURN
+
.------------------------------------------------------------
. Display Hospital Name (multi-hospital) for headers
.------------------------------------------------------------
ENHOS000  COMPARE   ONE,IBCNMHOS          * Hospital name for header (multi-hos)
          GOTO      ENHOS900 IF NOT EQUAL
          MATCH     SP70,HOSPNAME
          GOTO      ENHOS900 IF EQUAL
.
          WRITE     HTMLFILE;"<td class=DataLabel>Hospital &nbsp;":
                             "<input type=text name=dummy4 size=25 ":
                             "class=Readonly readonly value=",QUOTE:
                             PTHSNAME,QUOTE,"</td>";
          GOTO      ENHOS999
.
ENHOS900  WRITE     HTMLFILE;"<input type=hidden name=dummy4 value=":
                             QUOTE,QUOTE,">";
ENHOS999  GOTO      ENEQ9999
+
.------------------------------------------------------------
. Table of Enquiries by Invoice           
.------------------------------------------------------------
INVTB000  MOVE      ONE,SHOWFLAG          * Show no more visits message
.
          MOVE      "14",NORECORD         * Set Default No Records to Display
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PRVIFLAG = 1         
            MATCH     SP70,PREVIKEY
            IF        !@EQUAL
              CALL      INVPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVIKEY
.
.  Check if start of list need to do INVTB040 read for blank!
.
              UNPACK    KEY16,DIM8,KEY8
              MATCH     KEY8,SP70
              GOTO      INVTB040 IF EQUAL
              GOTO      INVTB050
            ENDIF
            PACK      KEY16,INVOICEN,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      INVTB050
          ENDIF
.
          MATCH     SP70,NEXTIKEY
          IF        !@EQUAL
            CALL      INVLVS00              * Check to see if at the last rec 
            PACK      KEY16,NEXTIKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTIKEY
.
.  Check if start of list need to do INVTB040 read for blank!
.
            UNPACK    KEY16,DIM8,KEY8
            MATCH     KEY8,SP70
            GOTO      INVTB040 IF EQUAL
            GOTO      INVTB050
          ENDIF
.
          MATCH     SP70,INVOICEN           * Exit as we don't have a Invoice No
          GOTO      INVTB999 IF EQUAL
.
.         See if record exists with no batch number
.
INVTB040  PACK      KEY16,INVOICEN,SP70
          CALL      RDPTEDS2
          IF        OVRCD=0
            GOTO      INVTB150
          ENDIF
.
          PACK      KEY16,INVOICEN,SP70
INVTB050  CALL      RSPTEDS2                * Position for Invoice #
INVTB100  CALL      RKPTEDS2                * read next record
          BRANCH    OVRCD,INVTB900          * end of file
.
          MATCH     PTESINVN,INVOICEN       * Still same Invoice No?
          GOTO      INVTB900 IF NOT EQUAL
          MOVE      ONE,FRSTLINE
.
INVTB150  PACK      NEXTIKEY,PTESINVN,PTESBATN,SP70
          MATCH     SP70,PREVIKEY
          IF        @EQUAL
            PACK      PREVIKEY,PTESINVN,PTESBATN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      INVTB100
          ENDIF
.
          CALL      INVRW000      * Output Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      INVTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

INVTB200  CALL      RKPTEDS2                * read next record
          BRANCH    OVRCD,INVTB800          * end of file
.
          MATCH     PTESINVN,INVOICEN       * Still same Invoice No?
          GOTO      INVTB800 IF NOT EQUAL
.
          MOVE      ZERO,SHOWFLAG   * Not at last record
          GOTO      INVTB900
.
INVTB800  MOVE      ONE,SHOWFLAG    * At last record
.
INVTB900  CALL      NOMREB00        * Show no more records message
          GOTO      INVTB999 
.
INVTB999  RETURN
.------------------------------------------------------------
. All Invoices for a Batch (TABLE ROW)
.------------------------------------------------------------
INVRW000  MOVE      ZERO,SUBFLAG
.
          PACK      KEY8,PTESINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      "Unknown",KEY15
          ELSE
            MOVE      PINVAMT,KEY15
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          MOVE      STATUS0,STATDESC
          LOAD      STATDESC,PTESFLAG,STATUS1,STATUS2,STATUS3,STATUS4,STATUS5
.
          MOVE      PTESNBAT,BNEXTFLD
          IF        PTESFLAG > 1
            MATCH     ZERO8,PTESNBAT
            IF        @EQUAL
              MOVE      "Waiting",BNEXTFLD
              MOVE      ONE,SUBFLAG
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;PTESBATN,"&nbsp;</td>":
                             "<td>",PTESHFND,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td>",STATDESC,"&nbsp;</td>":
                             "<td>",PTESPBAT,"&nbsp;</td>":
                             "<td>",BNEXTFLD,"&nbsp;</td>"
.
          IF        SUBFLAG = ONE
            WRITE     HTMLFILE;"<td><input type=checkbox name=dummy":
                      " value='",PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN:
                      "' onclick='Resubmit(this);' checked></td>"
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=dummy":
                      " value='",PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN:
                      "' onclick='Resubmit(this);'></td>"
          ENDIF
.
INVRW999  RETURN
.------------------------------------------------------------
. NOMREB00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMREB00  COMPARE   ONE,SHOWFLAG
          GOTO      NOMREB99 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<tr bgcolor=#FF0000>":
                             "<td colspan=8 align=center>":
                             "No more records</td>"
.
NOMREB99  RETURN
.------------------------------------------------------------
. NOMREC00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMREC00  COMPARE   ONE,SHOWFLAG
          GOTO      NOMREC99 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<tr bgcolor=#FF0000>":
                             "<td colspan=9 align=center>":
                             "No more records</td>"
.
NOMREC99  RETURN
.------------------------------------------------------------
. TOTREC00 - Display "Total records" at end of list
.------------------------------------------------------------
TOTREC00  WRITE     HTMLFILE;"<tr bgcolor=#FF0000>":
                             "<td colspan=9 align=center>":
                             "<b>Total records:":
                             DISNUMB:
                             "</b></td>"
.
TOTREC99  RETURN
.------------------------------------------------------------
. LIMREC00 - Display "Limit reached" at end of list
.------------------------------------------------------------
LIMREC00  WRITE     HTMLFILE;"<tr bgcolor=#FFFF00>":
                             "<td colspan=9 align=center>":
                             "<b>Batch limit of 50 reached.":
                             " More claims are waiting to be extracted.":
                             "</b></td>"
.
LIMREC99  RETURN
.--------------------------------------------------------------------------
. GETPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
GETPVS00  PACK      KEY24,PREVVKEY,Z70
          PACK      SAVKEY24,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDS3                     * Position for batch #
GETPVS10  CALL      RPPTEDS3                     * read next record
          BRANCH    OVRCD,GETPVS91               * end of file
.
          MATCH     PTESBATN,BATCHNUM            * same batch still ?
          GOTO      GETPVS91 IF NOT EQUAL
.
          MATCH     "00000000",PTESNBAT
          GOTO      GETPVS91 IF EQUAL
.
          PACK      SAVKEY24,PTESBATN,PTESADMN,PTESINVN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      GETPVS90 IF EQUAL
.
          GOTO      GETPVS10
.
GETPVS90  MOVE      SAVKEY24,KEY24          * New start key for display
          SUB       ONE,NORECORD
          GOTO      GETPVS99
.
GETPVS91  PACK      KEY24,BATCHNUM,SP70
          SUB       ONE,NORECORD
          GOTO      GETPVS99
.
GETPVS99  RETURN
.--------------------------------------------------------------------------
.       ************* BATCH ENQUIRY ************
. BGTPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
BGTPVS00  PACK      KEY24,PREVVKEY,Z70
          PACK      SAVKEY24,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDS3                     * Position for batch #
BGTPVS10  CALL      RPPTEDS3                     * read next record
          BRANCH    OVRCD,BGTPVS91               * end of file
.
          MATCH     PTESBATN,BATCHNUM            * same batch still ?
          GOTO      BGTPVS91 IF NOT EQUAL
.
          PACK      SAVKEY24,PTESBATN,PTESADMN,PTESINVN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      BGTPVS90 IF EQUAL
.
          GOTO      BGTPVS10
.
BGTPVS90  MOVE      SAVKEY24,KEY24          * New start key for display
          SUB       ONE,NORECORD
          GOTO      BGTPVS99
.
BGTPVS91  PACK      KEY24,BATCHNUM,SP70
          SUB       ONE,NORECORD
          GOTO      BGTPVS99
.
BGTPVS99  RETURN
.--------------------------------------------------------------------------
.       ************* ADMISSION ENQUIRY ************
. ADMPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
ADMPVS00  PACK      KEY24,PREVAKEY,Z70
          PACK      SAVKEY24,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDS4                     * Position for Admission #
ADMPVS10  CALL      RPPTEDS4                     * read next record
          BRANCH    OVRCD,ADMPVS91               * end of file
.
          MATCH     PTESADMN,ADMISSNO       * Still same Admission?
          GOTO      ADMPVS91 IF NOT EQUAL
.
          PACK      SAVKEY24,PTESADMN,PTESINVN,PTESBATN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      ADMPVS90 IF EQUAL
.
          GOTO      ADMPVS10
.
ADMPVS90  MOVE      SAVKEY24,KEY24          * New start key for display
          SUB       ONE,NORECORD
          GOTO      ADMPVS99
.
ADMPVS91  PACK      KEY24,ADMISSNO,SP70
          SUB       ONE,NORECORD
          GOTO      ADMPVS99
.
ADMPVS99  RETURN
.--------------------------------------------------------------------------
.       ************* U/R ENQUIRY ************
. URNPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
URNPVS00  PACK      KEY32,PREVUKEY,Z70
          PACK      SAVKEY32,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDS5                     * Position for U/R #
URNPVS10  CALL      RPPTEDS5                     * read next record
          BRANCH    OVRCD,URNPVS91               * end of file
.
          MATCH     PTESURNO,URNUMBER       * Still same U/R?
          GOTO      URNPVS91 IF NOT EQUAL
.
          PACK      SAVKEY32,PTESURNO,PTESADMN,PTESINVN,PTESBATN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      URNPVS90 IF EQUAL
.
          GOTO      URNPVS10
.
URNPVS90  MOVE      SAVKEY32,KEY32          * New start key for display
          SUB       ONE,NORECORD
          GOTO      URNPVS99
.
URNPVS91  PACK      KEY32,URNUMBER,SP70
          SUB       ONE,NORECORD
          GOTO      URNPVS99
.
URNPVS99  RETURN
.--------------------------------------------------------------------------
.       ************* CLAIMS WAITING FOR EXTRACTION ENQUIRY ************
. URNPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.--------------------------------------------------------------------------
WATPVS00  PACK      KEY32,PREVWKEY,Z70
          PACK      SAVKEY32,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDS1                     
WATPVS10  CALL      RPPTEDS1                     * read next record
          BRANCH    OVRCD,WATPVS91               * end of file
.
          COMPARE   ZERO,PTESFLAG                * waiting for extract still ?
          GOTO      WATPVS91 IF NOT EQUAL
.
          PACK      SAVKEY32,PTESFLAG,PTESHFND,PTESADMN,PTESINVN,PTESBATN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      WATPVS90 IF EQUAL
.
          GOTO      WATPVS10
.
WATPVS90  MOVE      SAVKEY32,KEY32          * New start key for display
          SUB       ONE,NORECORD
          GOTO      WATPVS99
.
WATPVS91  PACK      KEY32,SP1,ZERO,SP70
          SUB       ONE,NORECORD
          GOTO      WATPVS99
.
WATPVS99  RETURN
.--------------------------------------------------------------------------
.       ************* INVOICE ENQUIRY ************
. INVPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
INVPVS00  PACK      KEY16,PREVIKEY,Z70
          PACK      SAVKEY16,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDS2                     * Position for Invoice #
INVPVS10  CALL      RPPTEDS2                     * read next record
          BRANCH    OVRCD,INVPVS91               * end of file
.
          MATCH     PTESINVN,INVOICEN       * Still same Invoice?
          GOTO      INVPVS91 IF NOT EQUAL
.
          PACK      SAVKEY16,PTESINVN,PTESBATN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      INVPVS90 IF EQUAL
.
          GOTO      INVPVS10
.
INVPVS90  MOVE      SAVKEY16,KEY16          * New start key for display
          SUB       ONE,NORECORD
          GOTO      INVPVS99
.
INVPVS91  PACK      KEY16,INVOICEN,SP70
          SUB       ONE,NORECORD
          GOTO      INVPVS99
.
INVPVS99  RETURN
.------------------------------------------------------------
. LASTVS00 - Check to see if this is the last record displayed. 
.            If so the next button will go back to the start.
.------------------------------------------------------------
LASTVS00  PACK      KEY24,NEXTVKEY,SP70
          CALL      RSPTEDS3                     * Position for batch #
          CALL      RKPTEDS3                     * read next record
          BRANCH    OVRCD,LASTVS90               * end of file
.
          MATCH     PTESBATN,BATCHNUM            * same batch still ?
          GOTO      LASTVS90 IF NOT EQUAL
.
          MATCH     "00000000",PTESNBAT
          GOTO      LASTVS90 IF EQUAL
.
          GOTO      LASTVS99
.
LASTVS90  PACK      NEXTVKEY,BATCHNUM,SP70
          GOTO      LASTVS99                * No more record goto firt record
.
LASTVS99  RETURN
.------------------------------------------------------------
.       ************* ADMISSION ENQUIRY ************
. ADMLVS00 - Check to see if this is the last record displayed. 
.            If so the next button will go back to the start.
.------------------------------------------------------------
ADMLVS00  PACK      KEY24,NEXTAKEY,SP70
          CALL      RSPTEDS4                     * Position for Admin #
          CALL      RKPTEDS4                     * read next record
          BRANCH    OVRCD,ADMLVS90               * end of file
.
          MATCH     PTESADMN,ADMISSNO       * Still same Admission?
          GOTO      ADMLVS90 IF NOT EQUAL
.
          GOTO      ADMLVS99
.
ADMLVS90  PACK      NEXTAKEY,ADMISSNO,SP70
          GOTO      ADMLVS99                * No more record goto firt record
.
ADMLVS99  RETURN
.------------------------------------------------------------
.       ************* U/R ENQUIRY ************
. URNLVS00 - Check to see if this is the last record displayed. 
.            If so the next button will go back to the start.
.------------------------------------------------------------
URNLVS00  PACK      KEY32,NEXTUKEY,SP70
          CALL      RSPTEDS5                     * Position for U/R #
          CALL      RKPTEDS5                     * read next record
          BRANCH    OVRCD,URNLVS90               * end of file
.
          MATCH     PTESURNO,URNUMBER       * Still same U/R?
          GOTO      URNLVS90 IF NOT EQUAL
.
          GOTO      URNLVS99
.
URNLVS90  PACK      NEXTUKEY,URNUMBER,SP70
          GOTO      URNLVS99                * No more record goto firt record
.
URNLVS99  RETURN
.-----------------------------------------------------------------------------
.       ************* CLAIMS WAITING FOR EXTRACTION ENQUIRY ************
. WATLVS00 - Check to see if this is the last record displayed. 
.            If so the next button will go back to the start.
.-----------------------------------------------------------------------------
WATLVS00  PACK      KEY32,NEXTWKEY,SP70
          CALL      RSPTEDS1    
          CALL      RKPTEDS1                     * read next record
          BRANCH    OVRCD,WATLVS90               * end of file
.
          COMPARE   ZERO,PTESFLAG                * waiting for extract still ?
          GOTO      WATLVS90 IF NOT EQUAL
.
          GOTO      WATLVS99
.
WATLVS90  PACK      NEXTWKEY,SP1,ZERO,SP70
          GOTO      WATLVS99                * No more record goto firt record
.
WATLVS99  RETURN
.------------------------------------------------------------
.       ************* INVOICE ENQUIRY ************
. INVLVS00 - Check to see if this is the last record displayed. 
.            If so the next button will go back to the start.
.------------------------------------------------------------
INVLVS00  PACK      KEY16,NEXTIKEY,SP70
          CALL      RSPTEDS2                     * Position for Invoice No
          CALL      RKPTEDS2                     * read next record
          BRANCH    OVRCD,INVLVS90               * end of file
.
          MATCH     PTESINVN,INVOICEN       * Still same Invoice?
          GOTO      INVLVS90 IF NOT EQUAL
.
          GOTO      INVLVS99
.
INVLVS90  PACK      NEXTIKEY,INVOICEN,SP70
          GOTO      INVLVS99                * No more record goto firt record
.
INVLVS99  RETURN
.------------------------------------------------------------
.       ************* BATCH ENQUIRY ************
. BLSTVS00 - Check to see if this is the last record displayed. 
.            If so the next button will go back to the start.
.------------------------------------------------------------
BLSTVS00  PACK      KEY24,NEXTVKEY,SP70
          CALL      RSPTEDS3                     * Position for batch #
          CALL      RKPTEDS3                     * read next record
          BRANCH    OVRCD,BLSTVS90               * end of file
.
          MATCH     PTESBATN,BATCHNUM            * same batch still ?
          GOTO      BLSTVS90 IF NOT EQUAL
.
          GOTO      BLSTVS99
.
BLSTVS90  PACK      NEXTVKEY,BATCHNUM,SP70
          GOTO      BLSTVS99                * No more record goto firt record
.
BLSTVS99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",BATCHNUM
          REP       " +",PREVVKEY
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prevflag=",ONE:
                                 "&prevvkey=",PREVVKEY:
                                 "&batchnum=",BATCHNUM:
                                 "&startkey=",STARTKEY:
                                 "&updttype=",UPDTTYPE;
.
          REP       "+ ",BATCHNUM
          REP       "+ ",PREVVKEY
.
PREVGR99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",BATCHNUM
          REP       " +",NEXTVKEY
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nextvkey=",NEXTVKEY:
                                 "&batchnum=",BATCHNUM:
                                 "&startkey=",STARTKEY:
                                 "&updttype=",UPDTTYPE;
.
          REP       "+ ",BATCHNUM
          REP       "+ ",NEXTVKEY
.
NEXTGR99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVIN00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",INVOICEN
          REP       " +",PREVIKEY
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prviflag=",ONE:
                                 "&previkey=",PREVIKEY:
                                 "&invoicen=",INVOICEN:
                                 "&updttype=",UPDTTYPE;
.
          REP       "+ ",INVOICEN
          REP       "+ ",PREVIKEY
.
PREVIN99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTIN00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",INVOICEN
          REP       " +",NEXTIKEY
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nextikey=",NEXTIKEY:
                                 "&invoicen=",INVOICEN:
                                 "&updttype=",UPDTTYPE;
.
          REP       "+ ",INVOICEN
          REP       "+ ",NEXTIKEY
.
NEXTIN99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVAD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",ADMISSNO
          REP       " +",PREVAKEY
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prvaflag=",ONE:
                                 "&prevakey=",PREVAKEY:
                                 "&admissno=",ADMISSNO:
                                 "&updttype=",UPDTTYPE;
.
          REP       "+ ",ADMISSNO
          REP       "+ ",PREVAKEY
.
PREVAD99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTAD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",ADMISSNO
          REP       " +",NEXTAKEY
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nextakey=",NEXTAKEY:
                                 "&admissno=",ADMISSNO:
                                 "&updttype=",UPDTTYPE;
.
          REP       "+ ",ADMISSNO
          REP       "+ ",NEXTAKEY
.
NEXTAD99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVUR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",URNUMBER
          REP       " +",PREVUKEY
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prvuflag=",ONE:
                                 "&prevukey=",PREVUKEY:
                                 "&urnumber=",URNUMBER:
                                 "&updttype=",UPDTTYPE;
.
          REP       "+ ",URNUMBER
          REP       "+ ",PREVUKEY
.
PREVUR99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTUR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",URNUMBER
          REP       " +",NEXTUKEY
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nextukey=",NEXTUKEY:
                                 "&urnumber=",URNUMBER:
                                 "&updttype=",UPDTTYPE;
.
          REP       "+ ",URNUMBER
          REP       "+ ",NEXTUKEY
.
NEXTUR99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVW000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PREVWKEY
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prvwflag=",ONE:
                                 "&prevwkey=",PREVWKEY:
                                 "&updttype=E";
.
          REP       "+ ",PREVWKEY
.
PREVW999  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTW000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",NEXTWKEY
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nextwkey=",NEXTWKEY:
                                 "&updttype=E";
.
          REP       "+ ",NEXTWKEY
.
NEXTW999  RETURN
.------------------------------------------------------------
. Table of Batch Numbers
.------------------------------------------------------------
BATTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BATHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "17",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70     
          CALL      RSPTEBH1                     * position in file
BATTB100  CALL      RPPTEBH1                     * read previous record
          BRANCH    OVRCD,BATTB999
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BATTB100
          ENDIF
.
          CALL      BATRW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BATTB100 IF NOT EQUAL
.
BATTB999  RETURN
.------------------------------------------------------------
. Batch Numbers by Code (TABLE HEADING)
.------------------------------------------------------------
BATHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Batch Number</td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell width=25%>":
                               "Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Health Fund</td>":
                             "<td class=HeadingCell width=15%>":
                             "Date</td>":
                             "<td class=HeadingCell width=15%>":
                             "Time</td>":
                             "<td class=HeadingCell width=15%>":
                             "Status</td>":
                             "</tr>"
.
BATHD999  RETURN
.------------------------------------------------------------
. Batch Numbers (TABLE ROW)
.------------------------------------------------------------
BATRW000  UNPACK    PTEHDTBC,CCENT,CYEAR,CMON,CDAY  * Batch Created Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      "Extracted     ",BSTATDES
          LOAD      BSTATDES,PTEHFLAG,BSTATDS1,BSTATDS2,BSTATDS3
.
          UNPACK    PTEHTMBC,DIM5,ANS,ANS,ANS
.
          MOVE      SP70,HOSPNAME
          COMPARE   ONE,IBCNMHOS
          GOTO      BATRW500 IF NOT EQUAL
.
          PACK      KEY24,PTEHBTHN,SP30         * get Hospital for given Batch
          CALL      RSPTEDS3
          CALL      RKPTEDS3
.
          MATCH     PTEHBTHN,PTESBATN
          IF        @EQUAL
            MOVE      PTESADMN,KEY8
            CALL      RDPMVX11              * read Visit Extension
            IF        OVRCD = 0
              MOVE      PMVXMHOS,KEY3
              CALL      RDPTHSP1            * read Hospital name for visit
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
          ENDIF
.
BATRW500  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",PTEHBTHN,"#")'>":
                             PTEHBTHN,"</a></td>";
.
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",HOSPNAME,"&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",PTEHHFGP,"&nbsp;</td>":
                             "<td>",KEY11,"</td>":
                             "<td>",DIM5,"</td>":
                             "<td>",BSTATDES,"</td>":
                             "</tr>"; 
.
BATRW999  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVBT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                             "?reportno=",F1:
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2;
.
PREVBT99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTBT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                             "?reportno=",F1:
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2;
.
NEXTBT99  RETURN
.-----------------------------------------------------------
. Display Program Codes Details                                        *I-86040
.-----------------------------------------------------------
DPMPG000  BRANCH    FLDITMNO,DPMPG100,DPMPG200,DPMPG300,DPMPG400,DPMPG500:
                             DPMPG600
.
DPMPG100  CALL      DPMTB000                * Display table of Program codes
          GOTO      DPMPG999
.
DPMPG200  MATCH     SP70,PMPGCODE
          GOTO      DPMPG999 IF EQUAL
          WRITE     HTMLFILE;PMPGCODE;
          GOTO      DPMPG999
.
DPMPG300  MATCH     SP70,PMPGDESC
          GOTO      DPMPG999 IF EQUAL
          WRITE     HTMLFILE;PMPGDESC;
          GOTO      DPMPG999
.
DPMPG400  CALL      NEXTGR00
          GOTO      DPMPG999
.
DPMPG500  CALL      PREVGR00
          GOTO      DPMPG999
.
DPMPG600  WRITE     HTMLFILE;PMPGACTV;
          GOTO      DPMPG999
.
DPMPG999  RETURN
.---------------------------------------------------------------------
. Display Table of Note Types
.---------------------------------------------------------------------
DPMTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
.                                           * Output Table Heading
          WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>Code</td>":
                               "<td class=HeadingCell width=60%>":
                               "Description</td>":
                               "<td class=HeadingCell width=20%>Active</td>":
                             "</tr>"
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,STARTKEY,SP8
          CALL      RSPMPRG1                * Positional Read
          IF        OVRCD=0
            CALL      RPPMPRG1
          ENDIF
.
DPMTB100  CALL      RKPMPRG1                * Sequential Read
          BRANCH    OVRCD,DPMTB900
          MATCH     SP70,PMPGCODE
          GOTO      DPMTB100 IF EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DPMTB100
          ENDIF
.
          MATCH     SP70,PMPGDESC
          IF        @EQUAL
            MOVE      "&nbsp;",PMPGDESC
          ELSE
            RESET     PMPGDESC
          ENDIF
.
          MATCH     "1",PMPGACTV
          IF        @EQUAL
            MOVE      "No ",DIM3                 * inactive
          ELSE
            MOVE      "Yes",DIM3                 * active
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><a href='javascript:ShowDetail05":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmprg001=",PMPGCODE:
                             "&startkey=",PMPGCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMPGCODE,"</td>":
                             "<td>",PMPGDESC,"</td>":
                             "<td>",DIM3,"</td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DPMTB100 IF NOT EQUAL
          GOTO      DPMTB999
.
DPMTB900  CALL      NOMORE00      * Display No More Records Message
.
DPMTB999  RETURN
+
.******************************************************************** *I-103368
.------------------------------------------------------------
. CCPS EDI Claims Extract
.------------------------------------------------------------
CCPEXT00  MATCH     SP70,UPDTTYPE
          GOTO      CCPEXT60 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Check/Validate Batch Number
          GOTO      CCPEXT10 IF EQUAL
.
          GOTO      CCPEXT90
.
CCPEXT10  PACK      KEY8,BATCHNUM,SP70
          CALL      RDPTEBH1
          BRANCH    OVRCD,CCPEXT91
.
          MATCH     SP70,PTEHHFGP           * No Health Fund set
          GOTO      CCPEXT60 IF EQUAL
.
          MATCH     "CCPS  ",PTEHHFGP       * CCPS as Health Fund
          GOTO      CCPEXT60 IF EQUAL
.
          PACK      KEY14,PTEHHFGP,ZERO4,SP70
          CALL      RDFUND1                      * HF on file ?
          IF        OVRCD = 1
            MOVE      "Unknown Health Fund",FUNDDESC
          ELSE
            MOVE      HFNAME,FUNDDESC
          ENDIF
          GOTO      CCPEXT70
.
CCPEXT60  MOVE      SP70,PTEHHFGP     * Clear Batch Number Fund Variables
          MOVE      SP70,FUNDDESC
.
CCPEXT70  CLEAR     WEBTITLE
          MOVE      "Health Fund HosClaims Account Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CCPEXT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      CCPEXT99
.
CCPEXT90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CCPEXT99
.
CCPEXT91  MOVE      "Batch number not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CCPEXT99
.
CCPEXT99  RETURN
.------------------------------------------------------------
. CCPS Electronic Claims Enquiry
.------------------------------------------------------------
CCPENQ00  MATCH     SP70,UPDTTYPE
          GOTO      CCPENQ70 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Check/Validate Batch Number
          GOTO      CCPENQ10 IF EQUAL
.
          MATCH     "B",UPDTTYPE    * Check/Validate Admission/Visit Number
          GOTO      CCPENQ20 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Check/Validate Invoice Number
          GOTO      CCPENQ30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Check/Validate U/R Number
          GOTO      CCPENQ40 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Claims Waiting for Extraction
          GOTO      CCPENQ70 IF EQUAL
.
          MATCH     "G",UPDTTYPE    * Exclude Claim from extraction
          GOTO      CCPENQ50 IF EQUAL
.
          GOTO      CCPENQ90
.
.    * Read/Validate Batch Number display function
.
CCPENQ10  PACK      KEY8,BATCHNUM,SP70
          CALL      RDPTEBH1
          BRANCH    OVRCD,CCPENQ91
.
          MATCH     SP70,PTEHHFGP       * No Health Fund set
          IF        @EQUAL
            MOVE      SP70,PTEHHFGP     * Clear Batch Number Fund Variables
            MOVE      SP70,FUNDDESC
            GOTO      CCPENQ70
          ENDIF
.
          GOTO      CCPENQ70
.
.    * Read/Validate Admission/Visit Number display function
.
CCPENQ20  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,CCPENQ92
.
          PACK      KEY8,PVIBILL,SP70       * set key for O/P Details or Admiss.
          MOVE      PTVITYPE,FORM2
.                           A&E      O/P     INPAT
          BRANCH    FORM2,CCPENQ94,CCPENQ22,CCPENQ24
          GOTO      CCPENQ94
.
CCPENQ22  CALL      RDBOKB1
          BRANCH    OVRCD,CCPENQ96
          GOTO      CCPENQ27
.
.                                           * read Admission data
CCPENQ24  CALL      RDMISS1
          BRANCH    OVRCD,CCPENQ97
.
CCPENQ27  PACK      KEY8,PVIURNO
          MOVE      "Unknown Patient",FRMTNAME   * format patient name
          CALL      RDMAST1
          IF        OVRCD=0
            MOVE      PSNAME,PACSNAME
            MOVE      PGNAME,PACGNAME
            MOVE      PTITL,PACTITLE
            MOVE      ONE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,FRMTNAME
          ENDIF
.
          GOTO      CCPENQ70
.
.    * Read/Validate Invoice Number display function
.
CCPENQ30  PACK      KEY8,INVOICEN,SP70
          CALL      RDINV1
          BRANCH    OVRCD,CCPENQ93
.
          MOVE      "Unknown Patient",FRMTNAME   * format patient name
          MOVE      PINVUR,KEY8
          CALL      RDMAST1
          IF        OVRCD=0
            MOVE      PSNAME,PACSNAME
            MOVE      PGNAME,PACGNAME
            MOVE      PTITL,PACTITLE
            MOVE      ONE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,FRMTNAME
          ENDIF
.
          GOTO      CCPENQ70
.
.    * Read/Validate U/R Number display function
.
CCPENQ40  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=0
            MOVE      PSNAME,PACSNAME
            MOVE      PGNAME,PACGNAME
            MOVE      PTITL,PACTITLE
            MOVE      ONE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAME,FRMTNAME
          ELSE
            GOTO      CCPENQ94
          ENDIF
.
          GOTO      CCPENQ70
.
.   ************ EXCLUDE CLAIM FUNCTION ************
.
CCPENQ50  MOVE      ZERO,ERRORCNT
          PACK      KEY26,BATCHKEY,SP30
          CALL      RDPTEDT1
          BRANCH    OVRCD,CCPENQ60
          MOVE      PTETEXCL,F1      
          IF        F1 = 0
            MOVE      "1",PTETEXCL
          ELSE
            MOVE      "0",PTETEXCL
          ENDIF
....      CALL      UPPTEDT1
.
          MOVE      ZERO,EXIT
          MOVE      PTETADMN,SAVEADMN
          MOVE      PTETEXCL,ANS
          PACK      KEY24,SAVEADMN,SP30
          CALL      RSPTEDT4
CCPENQ55  CALL      RKPTEDT4
          BRANCH    OVRCD,CCPENQ99
.
          MATCH     SAVEADMN,PTETADMN
          GOTO      CCPENQ99 IF NOT EQUAL
.
          MOVE      ANS,PTETEXCL
          CALL      UPPTEDT4
          GOTO      CCPENQ55
.
CCPENQ60  CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      CCPENQ99
.
CCPENQ70  CLEAR     WEBTITLE
          MOVE      "CCPS Claims Enquiry",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CCPENQ99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      CCPENQ99
.
CCPENQ90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CCPENQ99
.
CCPENQ91  MOVE      "Batch number not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CCPENQ99
.
CCPENQ92  MOVE      "Visits record not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CCPENQ99
.
CCPENQ93  MOVE      "Invoice record not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CCPENQ99
.
CCPENQ94  MOVE      "U/R record not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CCPENQ99
.
CCPENQ95  MOVE      "Invalid System No. recorded ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CCPENQ99
.
CCPENQ96  MOVE      "O/P Booking record not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CCPENQ99
.
CCPENQ97  MOVE      "Admission record not on file. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CCPENQ99
.
CCPENQ99  RETURN
.--------------------------------------------------------------------------
. Option 6 - CCPS Electronic Claims Extract
.--------------------------------------------------------------------------
CCPS0000  BRANCH    FLDITMNO,CCPS0100,CCPS9999,CCPS9999,CCPS0400,CCPS0500:
                             CCPS0600,CCPS0700,CCPS0800,CCPS0900
          GOTO      CCPS9999
.
CCPS0100  MATCH     SP70,BATCHNUM
          GOTO      CCPS9999 IF EQUAL
          WRITE     HTMLFILE;BATCHNUM;    * Batch Health Fund Name
          GOTO      CCPS9999
.
.
.
CCPS0400  CALL      BADTB000              * Table of all Invoices for a Batch
          GOTO      CCPS9999
.
CCPS0500  CALL      PREVGR00              * Show Previous group of records
          GOTO      CCPS9999
.
CCPS0600  CALL      NEXTGR00              * Show Next group of records
          GOTO      CCPS9999
.
..PS0700  CALL      BATTB000              * Table of Batch Numbers
CCPS0700
          GOTO      CCPS9999
.
CCPS0800  CALL      PREVBT00              * Show Previous group of records
          GOTO      CCPS9999
.
CCPS0900  CALL      NEXTBT00              * Show Next group of records
          GOTO      CCPS9999
.
CCPS9999  RETURN
.
.--------------------------------------------------------------------------
. Option 7 - CCPS Electronic Claims Enquiry
.--------------------------------------------------------------------------
ECEQ0000  BRANCH    FLDITMNO,ECEQ0100,ECEQ0200,ECEQ0300,ECEQ0400,ECEQ0500:
                             ECEQ0600,ECEQ0700,ECEQ0800,ECEQ0900,ECEQ1000:
                             ECEQ1100,ECEQ1200,ECEQ1300,ECEQ1400,ECEQ1500:
                             ECEQ1600,ECEQ1700,ECEQ1800,ECEQ1900,ECEQ2000:
                             ECEQ2100,ECEQ2200,ECEQ2300,ECEQ2400,ECEQ2500:
                             ECEQ2600,ECEQ2700,ECEQ2800,ECEQ2900,ECEQ3000
          GOTO      ECEQ9999
.
ECEQ0100  MATCH     SP70,BATCHNUM
          GOTO      ECEQ9999 IF EQUAL
          WRITE     HTMLFILE;BATCHNUM;    * Batch Health Fund Name
          GOTO      ECEQ9999
.
ECEQ0200  MATCH     SP70,PTEHHFGP
          GOTO      ECEQ9999 IF EQUAL
          WRITE     HTMLFILE;PTEHHFGP;    * Batch Health Fund
          GOTO      ECEQ9999
.
ECEQ0300  MATCH     SP70,FUNDDESC
          GOTO      ECEQ9999 IF EQUAL
          WRITE     HTMLFILE;FUNDDESC;    * Batch Health Fund Name
          GOTO      ECEQ9999
.
ECEQ0400  CALL      BADTB000              * Claims Enquiry by Batch
          GOTO      ECEQ9999
.
ECEQ0500  CALL      PREVGR00              * Show Previous group of records
          GOTO      ECEQ9999
.
ECEQ0600  CALL      NEXTGR00              * Show Next group of records
          GOTO      ECEQ9999
.
ECEQ0700  MATCH     SP70,UPDTTYPE
          GOTO      ECEQ9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI
          GOTO      ECEQ9999
.
ECEQ0800  MOVE      "Extracted     ",BSTATDES
          LOAD      BSTATDES,PTEHFLAG,BSTATDS1,BSTATDS2,BSTATDS3
          STRIP     BSTATDES
          WRITE     HTMLFILE;BSTATDES;    * Batch Status
          GOTO      ECEQ9999
.
ECEQ0900  WRITE     HTMLFILE;FRMTNAME;    * Formatted Patient Name
          GOTO      ECEQ9999
.
ECEQ1000  CALL      ADDTB000              * Claims Enquiry by Admission
          GOTO      ECEQ9999
.
ECEQ1100  WRITE     HTMLFILE;PVIURNO;     * U/R Number
          GOTO      ECEQ9999
.
ECEQ1200  MATCH     SP70,ADMISSNO
          GOTO      ECEQ9999 IF EQUAL
          WRITE     HTMLFILE;ADMISSNO;    * Admission Number
          GOTO      ECEQ9999
.
ECEQ1300  MATCH     SP70,INVOICEN
          GOTO      ECEQ9999 IF EQUAL
          WRITE     HTMLFILE;INVOICEN;    * Invoice Number
          GOTO      ECEQ9999
.
ECEQ1400  WRITE     HTMLFILE;DPINVADM;    * Admission Number
          GOTO      ECEQ9999
.
ECEQ1500  WRITE     HTMLFILE;PINVUR;      * U/R Number
          GOTO      ECEQ9999
.
ECEQ1600  CALL      INDTB000              * Claims Enquiry by Invoice
          GOTO      ECEQ9999
.
ECEQ1700  CALL      PREVIN00              * Show Previous group of records
          GOTO      ECEQ9999
.
ECEQ1800  CALL      NEXTIN00              * Show Next group of records
          GOTO      ECEQ9999
.
ECEQ1900  CALL      PREVAD00              * Show Previous group of records
          GOTO      ECEQ9999
.
ECEQ2000  CALL      NEXTAD00              * Show Next group of records
          GOTO      ECEQ9999
.
ECEQ2100  MATCH     SP70,URNUMBER
          GOTO      ECEQ9999 IF EQUAL
          WRITE     HTMLFILE;URNUMBER;    * U/R Number
          GOTO      ECEQ9999
.
ECEQ2200  CALL      URDTB000              * Claims Enquiry by U/R
          GOTO      ECEQ9999
.
ECEQ2300  CALL      PREVUR00              * Show Previous group of records
          GOTO      ECEQ9999
.
ECEQ2400  CALL      NEXTUR00              * Show Next group of records
          GOTO      ECEQ9999
.
ECEQ2500  CALL      WADTB000              * Claims Waiting for Extraction
          GOTO      ECEQ9999
.
ECEQ2600  CALL      PREVW000              * Show Previous group of records
          GOTO      ECEQ9999
.
ECEQ2700  CALL      NEXTW000              * Show Next group of records
          GOTO      ECEQ9999
.
.
ECEQ2800  MOVE      "Medical only",BTYPEDES
          LOAD      BTYPEDES,PTEHEETP,BTYPEDS1,BTYPEDS2
          STRIP     BTYPEDES
          WRITE     HTMLFILE;BTYPEDES;    * Batch Status
          GOTO      ECEQ9999
.
ECEQ2900  MOVE      SP10,DIM10
          MATCH     "3",SYSTEMID
          IF        @EQUAL
            MOVE     " Inpatient",DIM10
          ELSE
            MATCH     "2",SYSTEMID
            IF        @EQUAL
              MOVE      "Outpatient",DIM10
            ENDIF
          ENDIF
          WRITE     HTMLFILE;DIM10;       * Selection Type
          GOTO      ECEQ9999
.
ECEQ3000  WRITE     HTMLFILE;SYSTEMID;
          GOTO      ECEQ9999
.
ECEQ9999  RETURN
+
.------------------------------------------------------------
. Table of all Admissions/Visits for a Batch
.------------------------------------------------------------
BADTB000  MOVE      ONE,SHOWFLAG            * Show no more visits message
          MOVE      ZERO,F3
.
          IF        NORECORD=0
            MOVE      "14",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PREVFLAG = 1
            MATCH     SP70,PREVVKEY
            IF        !@EQUAL
              CALL      BADPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVVKEY
              GOTO      BADTB050
            ENDIF
            PACK      KEY24,BATCHNUM,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      BADTB050
          ENDIF
.
          MATCH     SP70,NEXTVKEY
          IF        !@EQUAL
            CALL      BGDTVS00              * Check to see if at the last rec
            PACK      KEY24,NEXTVKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTVKEY
            GOTO      BADTB050
          ENDIF
.
          MATCH     SP70,BATCHNUM           * Exit as we don't have a Batch No.
          GOTO      BADTB999 IF EQUAL
.
          MOVE      SP8,SAVEADMN
          PACK      KEY24,BATCHNUM,Z70
BADTB050  CALL      RSPTEDT3                * Position at end of batch #
BADTB100  CALL      RPPTEDT3                * read prev record
          BRANCH    OVRCD,BADTB900          * end of file
.
          MATCH     PTETBATN,BATCHNUM       * Still same batch?
          GOTO      BADTB900 IF NOT EQUAL
.         
          MATCH     SAVEADMN,PTETADMN       * only display last Inv. for Visit
          GOTO      BADTB100 IF EQUAL
          MOVE      PTETADMN,SAVEADMN       
          MOVE      ONE,FRSTLINE
.
          PACK      NEXTVKEY,PTETBATN,PTETADMN,PTETINVN,SP70
          MATCH     SP70,PREVVKEY
          IF        @EQUAL
            PACK      PREVVKEY,PTETBATN,PTETADMN,PTETINVN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BADTB100
          ENDIF
.
          CALL      BADRW000      * Output Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BADTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

BADTB200  CALL      RKPTEDT3                * read next record
          BRANCH    OVRCD,BADTB800          * end of file
.
          MATCH     PTETBATN,BATCHNUM       * Still same batch?
          GOTO      BADTB800 IF NOT EQUAL
.
          MOVE      ZERO,SHOWFLAG           * Not at last record
          GOTO      BADTB900
.
BADTB800  MOVE      ONE,SHOWFLAG            * At last record
.
BADTB900  CALL      NOMREB00                * Show no more records message
          GOTO      BADTB999
.
BADTB999  RETURN
.------------------------------------------------------------
. All Invoices for a Batch (TABLE ROW)
.------------------------------------------------------------
BADRW000  MOVE      ZERO,SUBFLAG
.
          CALL      COMRW000                * common code for CCPS rows
.
          WRITE     HTMLFILE;PTETADMN,"&nbsp;</td>":
                             "<td>",PTETINVN,"&nbsp;</td>":
                             "<td>",PTETURNO,"&nbsp;</td>":
                             "<td>",DIM45,"&nbsp;</td>":          * patient name
                             "<td>",CPCDATE,"&nbsp;</td>":
                             "<td>",KEY10,"&nbsp;</td>":          * Inv.Amount
                             "<td>",STATDESC,"&nbsp;</td>":
                             "<td>",STATDES2,"&nbsp;</td>":
                             "<td>",PTETPBAT,"&nbsp;</td>":
                             "<td>",BNEXTFLD,"&nbsp;</td>";
.
.                                           * Change Status selection
          CALL      COMRX000                * common html for CCPS rows
.
BADRW999  RETURN
.
.------------------------------------------------------------
. Common code for CCPS rows
.------------------------------------------------------------
COMRW000  MOVE      ZERO,EXIT
.
          MATCH     PURNO,PTETURNO
          GOTO      COMRW100 IF EQUAL
          PACK      DIM45,SP70
          PACK      KEY8,PTETURNO,SP8
          CALL      RDMAST1
          BRANCH    OVRCD,COMRW200
          MOVE      ONE,FRSTLINE
.
COMRW100  SQUEEZE   PSNAME                  * Patient Name *******************
          PACK      DIM45,PSNAME,COMMA,SP1,PGNAME
.
COMRW200  UNPACK    PTETINAM,KEY5,KEY10
          UNPACK    PTETINDT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * Format the current date
          REP       " 0",CPCDATE
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>";
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>";
          ENDIF
.
          MOVE      STATUS0,STATDESC
          LOAD      STATDESC,PTETFLAG,STATUS1,STATUS2,STATUS3,STATUS4,STATUS5:
                                      STATUS0,STATUS0,STATUS0,STATUS9
          MOVE      SP10,STATDES2
          MOVE      PTETCCST,FORM2
          LOAD      STATDES2,FORM2,STATU21,STATU22,STATU23,STATU24,STATU25:
                                   STATU26,STATU27,STATU28,STATU29
          MATCH     "1",SAVEERRS
          IF        @EQUAL
            MOVE      "Errors",STATDES2
            MOVE      SP1,SAVEERRS
          ENDIF
.
          MOVE      PTETNBAT,BNEXTFLD
          IF        PTETFLAG > 1
            MATCH     ZERO8,PTETNBAT
            IF        @EQUAL
              MOVE      "Waiting",BNEXTFLD
              MOVE      ONE,SUBFLAG
            ENDIF
          ENDIF
          MOVE      SP7,KEY7
          MATCH     "1",PTETEXCL
          IF        @EQUAL
            MOVE      "Exclude",KEY7
          ENDIF
.
          ADD       ONE,F3
          MOVE      F3,DIM3
          REP       " 0",DIM3
.
          PACK      KEY26,PTETFLAG,PTETADMN,PTETINVN,PTETBATN,SP30
          MOVE      "stats",DIM5
          PACK      DIM8A,DIM5,DIM3
          MOVE      "reasn",DIM5
          PACK      DIM8B,DIM5,DIM3
          MOVE      "claim",DIM5
          PACK      DIM8C,DIM5,DIM3
.
COMRW999  RETURN
.
.
COMRX000  MOVE      ZERO,EXIT
          IF        FRSTLINE = 0
            WRITE     HTMLFILE;"<td>","&nbsp;</td>":
                               "<td>","&nbsp;</td>";
            GOTO      COMRX999
          ENDIF
.
.                                           * Change Status selection
          WRITE     HTMLFILE;"<td><select name=",DIM8A:
                    " onchange='ChngStat(#"",KEY26,"#",",DIM8A,",",DIM8B,");'>":
                    " <option value=#"0#">        </option> ":
                    " <option value=#"1#">Resubmit</option> ":
                    " <option value=#"2#">Approve </option> ":
                    " <option value=#"3#">Cancel  </option> ":
                    " <option value=#"4#">Sent    </option> ":
                    " </select></td> ";
.                                           * Reason Code - for Cancellation
          WRITE     HTMLFILE;"<td><select name=",DIM8B," disabled":
                    " onchange='ChngStat(#"",KEY26,"#",",DIM8A,",",DIM8B,");'>":
                    " <option value=#" #">        </option> ":
                    " <option value=#"H#">Hospital Error</option> ":
                    " <option value=#"P#">Patient Error</option> ":
                    " </select></td> ";
          MOVE     ZERO,FRSTLINE
.
COMRX999  RETURN
.------------------------------------------------------------
. Table of all Invoices for an Admission
.------------------------------------------------------------
ADDTB000  MOVE      ONE,SHOWFLAG            * Show no more visits message
          MOVE      ZERO,F3
.
          MOVE      "14",NORECORD       * Set Default No Records to Display
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PRVAFLAG = 1
            MATCH     SP70,PREVAKEY
            IF        !@EQUAL
              CALL      ADDPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVAKEY
              GOTO      ADDTB050
            ENDIF
            PACK      KEY24,ADMISSNO,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      ADDTB050
          ENDIF
.
          MATCH     SP70,NEXTAKEY
          IF        !@EQUAL
            CALL      ADDLVS00              * Check to see if at the last rec
            PACK      KEY24,NEXTAKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTAKEY
            GOTO      ADDTB050
          ENDIF
.
          MATCH     SP70,ADMISSNO           * Exit as we don't have a Admin No.
          GOTO      ADDTB999 IF EQUAL
.
          PACK      KEY24,ADMISSNO,SP70
ADDTB050  CALL      RSPTEDT4                * Position for Admiss #
ADDTB100  CALL      RKPTEDT4                * read next record
          BRANCH    OVRCD,ADDTB900          * end of file
.
          MATCH     PTETADMN,ADMISSNO       * Still same Admission?
          GOTO      ADDTB900 IF NOT EQUAL
.
          COMPARE   NINE,PTETFLAG
          GOTO      ADDTB100 IF EQUAL
.
          PACK      NEXTAKEY,PTETADMN,PTETINVN,PTETBATN,SP70
          MATCH     SP70,PREVAKEY
          IF        @EQUAL
            PACK      PREVAKEY,PTETADMN,PTETINVN,PTETBATN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ADDTB100
          ENDIF
.
          CALL      ADDRW000      * Output Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ADDTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

ADDTB200  CALL      RKPTEDT4                * read next record
          BRANCH    OVRCD,ADDTB800          * end of file
.
          MATCH     PTETADMN,ADMISSNO       * Still same Admission?
          GOTO      ADDTB800 IF NOT EQUAL
.
          MOVE      ZERO,SHOWFLAG   * Not at last record
          GOTO      ADDTB900
.
ADDTB800  MOVE      ONE,SHOWFLAG    * At last record
.
ADDTB900  CALL      NOMREC00                * Show no more records message
          GOTO      ADDTB999
.
ADDTB999  RETURN
.------------------------------------------------------------
. All Invoices for an Admission (TABLE ROW)
.------------------------------------------------------------
ADDRW000  MOVE      ZERO,SUBFLAG
.
          CALL      COMRW000                * common code for CCPS rows
.
          WRITE     HTMLFILE;PTETINVN,"&nbsp;</td>":
                             "<td>",PTETBATN,"&nbsp;</td>":
                             "<td>",CPCDATE,"&nbsp;</td>":
                             "<td>",KEY10,"&nbsp;</td>":         * Inv.Amount
                             "<td>",STATDESC,"&nbsp;</td>":
                             "<td>",STATDES2,"&nbsp;</td>":
                             "<td>",PTETPBAT,"&nbsp;</td>":
                             "<td>",BNEXTFLD,"&nbsp;</td>";
.
.                                           * Change Status selection
          CALL      COMRX000                * common html for CCPS rows
.
ADDRW999  RETURN
+
.------------------------------------------------------------
. Table of Enquiries by Invoice
.------------------------------------------------------------
INDTB000  MOVE      ONE,SHOWFLAG          * Show no more visits message
.
          MOVE      "14",NORECORD         * Set Default No Records to Display
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PRVIFLAG = 1
            MATCH     SP70,PREVIKEY
            IF        !@EQUAL
              CALL      INDPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVIKEY
.
.  Check if start of list need to do INDTB040 read for blank!
.
              UNPACK    KEY16,DIM8,KEY8
              MATCH     KEY8,SP70
              GOTO      INDTB040 IF EQUAL
              GOTO      INDTB050
            ENDIF
            PACK      KEY16,INVOICEN,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      INDTB050
          ENDIF
.
          MATCH     SP70,NEXTIKEY
          IF        !@EQUAL
            CALL      INDLVS00              * Check to see if at the last rec
            PACK      KEY16,NEXTIKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTIKEY
.
.  Check if start of list need to do INDTB040 read for blank!
.
            UNPACK    KEY16,DIM8,KEY8
            MATCH     KEY8,SP70
            GOTO      INDTB040 IF EQUAL
            GOTO      INDTB050
          ENDIF
.
          MATCH     SP70,INVOICEN           * Exit as we don't have a Invoice No
          GOTO      INDTB999 IF EQUAL
.
.         See if record exists with no batch number
.
INDTB040  PACK      KEY16,INVOICEN,SP70
          CALL      RDPTEDT2
          IF        OVRCD=0
            GOTO      INDTB150
          ENDIF
.
          PACK      KEY16,INVOICEN,SP70
INDTB050  CALL      RSPTEDT2                * Position for Invoice #
INDTB100  CALL      RKPTEDT2                * read next record
          BRANCH    OVRCD,INDTB900          * end of file
.
          MATCH     PTETINVN,INVOICEN       * Still same Invoice No?
          GOTO      INDTB900 IF NOT EQUAL
.
INDTB150  PACK      NEXTIKEY,PTETINVN,PTETBATN,SP70
          MATCH     SP70,PREVIKEY
          IF        @EQUAL
            PACK      PREVIKEY,PTETINVN,PTETBATN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      INDTB100
          ENDIF
.
          CALL      INDRW000      * Output Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      INDTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

INDTB200  CALL      RKPTEDT2                * read next record
          BRANCH    OVRCD,INDTB800          * end of file
.
          MATCH     PTETINVN,INVOICEN       * Still same Invoice No?
          GOTO      INDTB800 IF NOT EQUAL
.
          MOVE      ZERO,SHOWFLAG   * Not at last record
          GOTO      INDTB900
.
INDTB800  MOVE      ONE,SHOWFLAG    * At last record
.
INDTB900  CALL      NOMREC00        * Show no more records message
          GOTO      INDTB999
.
INDTB999  RETURN
.------------------------------------------------------------
. All Invoices for a Batch (TABLE ROW)
.------------------------------------------------------------
INDRW000  MOVE      ZERO,SUBFLAG
.
          CALL      COMRW000                * common code for CCPS rows
.
          WRITE     HTMLFILE;PTETBATN,"&nbsp;</td>":
                             "<td>",CPCDATE,"&nbsp;</td>":
                             "<td>",KEY10,"&nbsp;</td>":         * Inv.Amount
                             "<td>",STATDESC,"&nbsp;</td>":
                             "<td>",STATDES2,"&nbsp;</td>":
                             "<td>",PTETPBAT,"&nbsp;</td>":
                             "<td>",BNEXTFLD,"&nbsp;</td>";
.
.                                           * Change Status selection
          CALL      COMRX000                * common html for CCPS rows
.
INDRW999  RETURN
+
.------------------------------------------------------------
. Table of all Invoices for an U/R
.------------------------------------------------------------
URDTB000  MOVE      ONE,SHOWFLAG
.
          MOVE      "14",NORECORD       * Set Default No Records to Display
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PRVUFLAG = 1
            MATCH     SP70,PREVUKEY
            IF        !@EQUAL
              CALL      URDPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVUKEY
              GOTO      URDTB050
            ENDIF
            PACK      KEY32,URNUMBER,SP70   * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      URDTB050
          ENDIF
.
          MATCH     SP70,NEXTUKEY
          IF        !@EQUAL
            CALL      URDLVS00              * Check to see if at the last rec
            PACK      KEY32,NEXTUKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTUKEY
            GOTO      URDTB050
          ENDIF
.
          MATCH     SP70,URNUMBER           * Exit as we don't have a URNin No.
          GOTO      URDTB999 IF EQUAL
.
          PACK      KEY32,URNUMBER,SP70
URDTB050  CALL      RSPTEDT5                * Position for U/R #
URDTB100  CALL      RKPTEDT5                * read next record
          BRANCH    OVRCD,URDTB900          * end of file
.
          MATCH     PTETURNO,URNUMBER       * Still same U/R?
          GOTO      URDTB900 IF NOT EQUAL
.
          COMPARE   NINE,PTETFLAG
          GOTO      URDTB100 IF EQUAL
.
          PACK      NEXTUKEY,PTETURNO,PTETADMN,PTETINVN,PTETBATN,SP70
          MATCH     SP70,PREVUKEY
          IF        @EQUAL
            PACK      PREVUKEY,PTETURNO,PTETADMN,PTETINVN,PTETBATN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      URDTB100
          ENDIF
.
          CALL      URDRW000      * Output Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      URDTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

URDTB200  CALL      RKPTEDT5                * read next record
          BRANCH    OVRCD,URDTB800          * end of file
.
          MATCH     PTETURNO,URNUMBER       * Still same U/R?
          GOTO      URDTB800 IF NOT EQUAL
.
          MOVE      ZERO,SHOWFLAG   * Not at last record
          GOTO      URDTB900
.
URDTB800  MOVE      ONE,SHOWFLAG    * At last record
.
URDTB900  CALL      NOMREC00        * Show no more records message
          GOTO      URDTB999
.
URDTB999  RETURN
.------------------------------------------------------------
. All Invoices for a U/R Number (TABLE ROW)
.------------------------------------------------------------
URDRW000  MOVE      ZERO,SUBFLAG
.
          CALL      COMRW000                * common code for CCPS rows
.
          WRITE     HTMLFILE;PTETADMN,"&nbsp;</td>":
                             "<td>",PTETINVN,"&nbsp;</td>":
                             "<td>",CPCDATE,"&nbsp;</td>":
                             "<td>",KEY10,"&nbsp;</td>":         * Inv.Amount
                             "<td>",PTETBATN,"&nbsp;</td>":
                             "<td>",STATDESC,"&nbsp;</td>":
                             "<td>",STATDES2,"&nbsp;</td>":
                             "<td>",PTETPBAT,"&nbsp;</td>":
                             "<td>",BNEXTFLD,"&nbsp;</td>"
.
.                                           * Change Status selection
          CALL      COMRX000                * common html for CCPS rows
.
URDRW999  RETURN
+
.------------------------------------------------------------
. Table of all Claims Waiting For Extraction
.------------------------------------------------------------
WADTB000  MOVE      ONE,SHOWFLAG
          MOVE      ZERO,FORM3
          PACK      SYSTEMID,SYSTEMID,SP1
          REP       " 0",SYSTEMID
.
          MOVE      "12",NORECORD       * Set Default No Records to Display
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.         * Previous button cgi
.
          IF        PRVWFLAG = 1
            MATCH     SP70,PREVWKEY
            IF        !@EQUAL
              CALL      WADPVS00            * Get previous records key
              MOVE      ZERO,STARTNUM       * Reset counters to zero
              MOVE      ZERO,RECNUMB
              MOVE      ZERO,DISNUMB
              MOVE      SP70,PREVWKEY
              GOTO      WADTB050
            ENDIF
            PACK      KEY24,SP70            * Go back to start if at
            MOVE      ZERO,STARTNUM         * the end of the list
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            GOTO      WADTB050
          ENDIF
.
          MATCH     SP70,NEXTWKEY
          IF        !@EQUAL
            CALL      WADLVS00              * Check to see if at the last rec
            PACK      KEY24,NEXTWKEY,SP70
            MOVE      ZERO,STARTNUM         * Reset counters
            MOVE      ZERO,RECNUMB
            MOVE      ZERO,DISNUMB
            MOVE      SP70,NEXTWKEY
            GOTO      WADTB050
          ENDIF
.
          PACK      KEY24,SP30
WADTB050  CALL      RSPTEDT4
WADTB100  CALL      RKPTEDT4                * read next record
          BRANCH    OVRCD,WADTB900          * end of file
.
          COMPARE   TWO,PTETFLAG            * waiting for extract still ?
          GOTO      WADTB100 IF NOT LESS
          MATCH     "0",SYSTEMID            * 0 = All, 2=O/P, 3=Inpat.
          GOTO      WADTB150 IF EQUAL
          MATCH     SYSTEMID,PTETISYS
          GOTO      WADTB100 IF NOT EQUAL
.
WADTB150  MOVE      ZERO,EXIT
          CALL      RDEDT000                * read all Invoices for Admiss.
          BRANCH    EXIT,WADTB100
.           
          PACK      NEXTWKEY,PTETADMN,PTETINVN,PTETBATN,SP70
          MATCH     SP70,PREVWKEY
          IF        @EQUAL
            PACK      PREVWKEY,PTETADMN,PTETINVN,PTETBATN,SP70
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM >= RECNUMB
            GOTO      WADTB100
          ENDIF
.
          CALL      WADRW000      * Output Row
.
          WRITE     HTMLFILE;"</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      WADTB100 IF NOT EQUAL
.
.    If NORECORD & DISNUMB are EQUAL can still be at last record!
.    Check if at last record and set SHOWFLAG=1 if so.

WADTB200  CALL      RKPTEDT4                * read next record
          BRANCH    OVRCD,WADTB800          * end of file
.
          MOVE      ZERO,SHOWFLAG           * Not at last record
          GOTO      WADTB900
.
WADTB800  MOVE      ONE,SHOWFLAG            * At last record
.
WADTB900  CALL      NOMREC00                * Show no more records message
          GOTO      WADTB999
.
WADTB999  RETURN
.------------------------------------------------------------
. All Invoices waiting for extraction (TABLE ROW)
.------------------------------------------------------------
WADRW000  MOVE      ZERO,SUBFLAG
.
          CALL      COMRW000                * common code for CCPS rows
          MOVE      MEDONLY,BTYPEDES
          MOVE      PTETINTY,F1
          LOAD      BTYPEDES,F1,CLAIM,CANCELS
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          WRITE     HTMLFILE;PTETADMN,"&nbsp;</td>":
                             "<td>",PTETURNO,"&nbsp;</td>":
                             "<td>",DIM45,"&nbsp;</td>":          * Pat.name
                             "<td>",PTETINVN,"&nbsp;</td>":
                             "<td>",CPCDATE,"&nbsp;</td>":
                             "<td>",KEY10,"&nbsp;</td>":          * Inv amount
                             "<td>",PTETPBAT,"&nbsp;</td>":
                             "<td>",BTYPEDES,"&nbsp;</td>":
                             "<td>",STATDES2,"&nbsp;</td>":
                             "<td>",KEY7,"&nbsp;</td>":           * exclude desc
.
                             "<td><input type=checkbox name=",DIM8C:
                             " onclick='CheckExclude(#"",KEY26,"#");":
                             "'></td>";
.
WADRW999  RETURN
+
.--------------------------------------------------------------------------
. RDEDT000 - Read through all Invoices for the current Admission/Visit
.--------------------------------------------------------------------------
RDEDT000  MOVE      ZERO,EXIT
          MOVE      ZERO,UPDTEDT
.                                           * save this Summary recd data
          MOVE      SP1,SAVEERRS
          MOVE      PTETADMN,SAVEADMN
          MOVE      PTETINVN,SAVEINVN
          MOVE      PTETINTY,SAVEINTY
          MOVE      PTETBATN,SAVEBATN
          MOVE      PTETINAM,SAVEINAM       * Invoice Amount
          IF        PTETFLAG = 1
            MOVE      "1",SAVEERRS
          ENDIF
.
          PACK      KEY24,PTETADMN,PTETINVN,PTETBATN,SP30
.
          PACK      KEY8,PTETINVN,SP8       * read Patient Invoice file
          CALL      RDPTINV1                * to check for "credits"
          IF        OVRCD = 0
            REP       " 0",PTINCRST
            MATCH     "0",PTINCRST
            IF        !@EQUAL
              MOVE      PINVAMT,SAVEINAM
              ADD       PTINCRTT,SAVEINAM   * Credit values are negative
              MOVE      SAVEINAM,PTETINAM
              MOVE      ONE,UPDTEDT
            ENDIF
            MATCH     SP1,PTETISYS
            IF        @EQUAL
              MOVE      PINVSYS,PTETISYS
              MOVE      ONE,UPDTEDT
            ENDIF
          ENDIF
          MOVE      PTETINAM,FORM12D2
.
.                                           * establish if Discharged or Finishd
          MOVE      "0",SAVESTAT            * default "not Disch", "not Attend"
          MATCH     "3",PTETISYS
          IF        @EQUAL
            PACK      KEY8,PTETADMN
            CALL      RDDSCH1
            IF        OVRCD = 0
              MOVE      "1",SAVESTAT        * 1=Discharged 0=not Discharged
            ENDIF
          ELSE
            PACK      KEY36,PTETADMN,SP20,SP20
            CALL      RDSBOKA6              * position on visit no.
            CALL      RDKBOKA6              * read next record
            MATCH     DOBAOUTN,PTETADMN
            IF        @EQUAL
              IF        OBASTAT = 4
                MOVE      "1",SAVESTAT      * patient seen
              ENDIF
            ENDIF
          ENDIF
.                                           * establish if Claim or Medical only
          PACK      KEY14,PTETADMN,SP10
          CALL      RSVSPAY1
RDEDT100  CALL      RKVSPAY1
          BRANCH    OVRCD,RDEDT200
.
          MATCH     VSPAVISN,PTETADMN
          GOTO      RDEDT200 IF NOT EQUAL
.
          PACK      KEY6,VSPAPAYC
          CALL      RDPTFX11
          BRANCH    OVRCD,RDEDT200
.
          COMPARE   ZERO,PTFXEXTR           * is Expected Payor HF for EDI ?
          GOTO      RDEDT100 IF EQUAL       * no, get next one
.
          MOVE      "1",SAVEINTY            * set Invoice Type to "Claim"
          MOVE      ONE,UPDTEDT
.
RDEDT200  IF        UPDTEDT = 1
            MOVE      SAVEINTY,PTETINTY
            CALL      UPPTEDT4              * update summary record
          ENDIF
.
.
.                                           * find the last "patedtaf" record
RDEDT300  CALL      RKPTEDT4                * read next record
          BRANCH    OVRCD,RDEDT500
          MATCH     SAVEADMN,PTETADMN
          GOTO      RDEDT500 IF NOT EQUAL
.                                           * save highest Invoice No. details
          PACK      KEY24,PTETADMN,PTETINVN,PTETBATN,SP30
          MOVE      PTETINVN,SAVEINVN
          MOVE      PTETINAM,SAVEINAM
          IF        PTETFLAG = 1
            MOVE      "1",SAVEERRS
          ENDIF
.
          PACK      KEY8,PTETINVN,SP8       * read Patient Invoice file
          CALL      RDPTINV3                * to check for "credits"
          IF        OVRCD = 0
            REP       " 0",PTINCRST
            MATCH     "0",PTINCRST
            IF        !@EQUAL
              MOVE      PINVAMT,SAVEINAM
              ADD       PTINCRTT,SAVEINAM   * Credit values are negative
              MOVE      SAVEINAM,PTETINAM
              MOVE      ONE,UPDTEDT
            ENDIF
            MATCH     SP1,PTETISYS
            IF        @EQUAL
              MOVE      PINVSYS,PTETISYS
              MOVE      ONE,UPDTEDT
            ENDIF
          ENDIF
          ADD       SAVEINAM,FORM12D2
.
          MATCH     PTETINTY,SAVEINTY
          IF        !@EQUAL
            MOVE      SAVEINTY,PTETINTY
            MOVE      ONE,UPDTEDT
          ENDIF
.
          IF        UPDTEDT = 1
            MOVE      SAVEINTY,PTETINTY
            CALL      UPPTEDT4              * update summary record
          ENDIF
          MOVE      ZERO,UPDTEDT
          GOTO      RDEDT300
.
.
RDEDT500  CALL      RDPTEDT4                * re-read last Inv. record
          MOVE      FORM12D2,PTETINAM       * set up Total of all Invoices
          MATCH     "1",SAVEERRS
          IF        @EQUAL
            MOVE      " 1",DPTETFLG
          ENDIF
.
RDEDT900  MATCH     "1",SAVESTAT
          GOTO      RDEDT999 IF EQUAL
          MOVE      ONE,EXIT                * This Admiss/Visit not discharged
.
RDEDT999  RETURN
.--------------------------------------------------------------------------
.       ************* BATCH ENQUIRY ************
. BADPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
BADPVS00  PACK      KEY24,PREVVKEY,Z70
          PACK      SAVKEY24,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDT3                     * Position for batch #
BADPVS10  CALL      RPPTEDT3                     * read next record
          BRANCH    OVRCD,BADPVS91               * end of file
.
          MATCH     PTETBATN,BATCHNUM            * same batch still ?
          GOTO      BADPVS91 IF NOT EQUAL
.
          PACK      SAVKEY24,PTETBATN,PTETADMN,PTETINVN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      BADPVS90 IF EQUAL
.
          GOTO      BADPVS10
.
BADPVS90  MOVE      SAVKEY24,KEY24          * New start key for display
          SUB       ONE,NORECORD
          GOTO      BADPVS99
.
BADPVS91  PACK      KEY24,BATCHNUM,SP70
          SUB       ONE,NORECORD
          GOTO      BADPVS99
.
BADPVS99  RETURN
.--------------------------------------------------------------------------
.       ************* ADMISSION ENQUIRY ************
. ADDPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
ADDPVS00  PACK      KEY24,PREVAKEY,Z70
          PACK      SAVKEY24,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDT4                     * Position for Admission #
ADDPVS10  CALL      RPPTEDT4                     * read next record
          BRANCH    OVRCD,ADDPVS91               * end of file
.
          MATCH     PTETADMN,ADMISSNO       * Still same Admission?
          GOTO      ADDPVS91 IF NOT EQUAL
.
          PACK      SAVKEY24,PTETADMN,PTETINVN,PTETBATN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      ADDPVS90 IF EQUAL
.
          GOTO      ADDPVS10
.
ADDPVS90  MOVE      SAVKEY24,KEY24          * New start key for display
          SUB       ONE,NORECORD
          GOTO      ADDPVS99
.
ADDPVS91  PACK      KEY24,ADMISSNO,SP70
          SUB       ONE,NORECORD
          GOTO      ADDPVS99
.
ADDPVS99  RETURN
.--------------------------------------------------------------------------
.       ************* U/R ENQUIRY ************
. URDPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
URDPVS00  PACK      KEY32,PREVUKEY,Z70
          PACK      SAVKEY32,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDT5                     * Position for U/R #
URDPVS10  CALL      RPPTEDT5                     * read next record
          BRANCH    OVRCD,URDPVS91               * end of file
.
          MATCH     PTETURNO,URNUMBER       * Still same U/R?
          GOTO      URDPVS91 IF NOT EQUAL
.
          PACK      SAVKEY32,PTETURNO,PTETADMN,PTETINVN,PTETBATN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      URDPVS90 IF EQUAL
.
          GOTO      URDPVS10
.
URDPVS90  MOVE      SAVKEY32,KEY32          * New start key for display
          SUB       ONE,NORECORD
          GOTO      URDPVS99
.
URDPVS91  PACK      KEY32,URNUMBER,SP70
          SUB       ONE,NORECORD
          GOTO      URDPVS99
.
URDPVS99  RETURN
.--------------------------------------------------------------------------
.       ************* CLAIMS WAITING FOR EXTRACTION ENQUIRY ************
. WADPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.--------------------------------------------------------------------------
WADPVS00  PACK      KEY24,PREVWKEY,Z70
          PACK      SAVKEY24,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDT4
WADPVS10  CALL      RPPTEDT4                     * read next record
          BRANCH    OVRCD,WADPVS91               * end of file
.
          COMPARE   TWO,PTETFLAG                 * waiting for extract still ?
          GOTO      WADPVS91 IF NOT LESS
.
          PACK      SAVKEY24,PTETADMN,PTETINVN,PTETBATN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      WADPVS90 IF EQUAL
.
          GOTO      WADPVS10
.
WADPVS90  MOVE      SAVKEY24,KEY24          * New start key for display
          SUB       ONE,NORECORD
          GOTO      WADPVS99
.
WADPVS91  PACK      KEY24,SP70
          SUB       ONE,NORECORD
          GOTO      WADPVS99
.
WADPVS99  RETURN
.--------------------------------------------------------------------------
.       ************* INVOICE ENQUIRY ************
. INDPVS00 - Read back one full page of records to get the
.            previous record listv start key.
.------------------------------------------------------------
INDPVS00  PACK      KEY16,PREVIKEY,Z70
          PACK      SAVKEY16,SP70
          MOVE      ZERO,F2
          ADD       ONE,NORECORD
.
          CALL      RSPTEDT2                     * Position for Invoice #
INDPVS10  CALL      RPPTEDT2                     * read next record
          BRANCH    OVRCD,INDPVS91               * end of file
.
          MATCH     PTETINVN,INVOICEN       * Still same Invoice?
          GOTO      INDPVS91 IF NOT EQUAL
.
          PACK      SAVKEY16,PTETINVN,PTETBATN,SP70
          ADD       ONE,F2
          COMPARE   F2,NORECORD
          GOTO      INDPVS90 IF EQUAL
.
          GOTO      INDPVS10
.
INDPVS90  MOVE      SAVKEY16,KEY16          * New start key for display
          SUB       ONE,NORECORD
          GOTO      INDPVS99
.
INDPVS91  PACK      KEY16,INVOICEN,SP70
          SUB       ONE,NORECORD
          GOTO      INDPVS99
.
INDPVS99  RETURN
+
.------------------------------------------------------------
.       ************* ADMISSION ENQUIRY ************
. ADDLVS00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
ADDLVS00  PACK      KEY24,NEXTAKEY,SP70
          CALL      RSPTEDT4                     * Position for Admin #
          CALL      RKPTEDT4                     * read next record
          BRANCH    OVRCD,ADDLVS90               * end of file
.
          MATCH     PTETADMN,ADMISSNO       * Still same Admission?
          GOTO      ADDLVS90 IF NOT EQUAL
.
          GOTO      ADDLVS99
.
ADDLVS90  PACK      NEXTAKEY,ADMISSNO,SP70
          GOTO      ADDLVS99                * No more record goto firt record
.
ADDLVS99  RETURN
.------------------------------------------------------------
.       ************* U/R ENQUIRY ************
. URDLVS00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
URDLVS00  PACK      KEY32,NEXTUKEY,SP70
          CALL      RSPTEDT5                     * Position for U/R #
          CALL      RKPTEDT5                     * read next record
          BRANCH    OVRCD,URDLVS90               * end of file
.
          MATCH     PTETURNO,URNUMBER       * Still same U/R?
          GOTO      URDLVS90 IF NOT EQUAL
.
          GOTO      URDLVS99
.
URDLVS90  PACK      NEXTUKEY,URNUMBER,SP70
          GOTO      URDLVS99                * No more record goto firt record
.
URDLVS99  RETURN
.-----------------------------------------------------------------------------
.       ************* CLAIMS WAITING FOR EXTRACTION ENQUIRY ************
. WADLVS00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.-----------------------------------------------------------------------------
WADLVS00  PACK      KEY24,NEXTWKEY,SP70
          CALL      RSPTEDT4
          CALL      RKPTEDT4                     * read next record
          BRANCH    OVRCD,WADLVS90               * end of file
.
          GOTO      WADLVS99
.
WADLVS90  PACK      NEXTWKEY,SP70
          GOTO      WADLVS99                * No more record goto firt record
.
WADLVS99  RETURN
.------------------------------------------------------------
.       ************* INVOICE ENQUIRY ************
. INDLVS00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
INDLVS00  PACK      KEY16,NEXTIKEY,SP70
          CALL      RSPTEDT2                     * Position for Invoice No
          CALL      RKPTEDT2                     * read next record
          BRANCH    OVRCD,INDLVS90               * end of file
.
          MATCH     PTETINVN,INVOICEN       * Still same Invoice?
          GOTO      INDLVS90 IF NOT EQUAL
.
          GOTO      INDLVS99
.
INDLVS90  PACK      NEXTIKEY,INVOICEN,SP70
          GOTO      INDLVS99                * No more record goto firt record
.
INDLVS99  RETURN
.------------------------------------------------------------
.       ************* BATCH ENQUIRY ************
. BGDTVS00 - Check to see if this is the last record displayed.
.            If so the next button will go back to the start.
.------------------------------------------------------------
BGDTVS00  PACK      KEY24,NEXTVKEY,SP70
          CALL      RSPTEDT3                     * Position for batch #
          CALL      RKPTEDT3                     * read next record
          BRANCH    OVRCD,BGDTVS90               * end of file
.
          MATCH     PTETBATN,BATCHNUM            * same batch still ?
          GOTO      BGDTVS90 IF NOT EQUAL
.
          GOTO      BGDTVS99
.
BGDTVS90  PACK      NEXTVKEY,BATCHNUM,SP70
          GOTO      BGDTVS99                * No more record goto firt record
.
BGDTVS99  RETURN
+
.------------------------------------------------------------
. Eclipse IHC Claims Extract
.------------------------------------------------------------ 
ECLEXT00  MATCH     SP70,UPDTTYPE
          GOTO      ECLEXT80 IF EQUAL 
.         
          MATCH     "H",UPDTTYPE    * List Claims by Health Fund
          GOTO      ECLEXT10 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * List Claims by Claim Code
          GOTO      ECLEXT20 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Extract Claims
          GOTO      ECLEXT30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Claims
          GOTO      ECLEXT40 IF EQUAL
.
          GOTO      ECLEXT85
.
ECLEXT10  MATCH     SP70,HFUNDTYP                * no code chosen yet
          GOTO      ECLEXT80 IF EQUAL
.
          PACK      KEY14,HFUNDTYP,ZERO4,SP70
          CALL      RDFUND1                      * HF on file ?
          BRANCH    OVRCD,ECLEXT93
.
          MOVE      HFUNDTYP,KEY6
          CALL      RDPTFX11                     * hfund extension record?
          BRANCH    OVRCD,ECLEXT93
.
          COMPARE   THREE,PTFXEXTR               * using Eclipse ?
          GOTO      ECLEXT94 IF NOT EQUAL
.
          MOVE      SP70,ECLKEY3
          MATCH     SP70,PTFXECLP
          IF        @EQUAL | @EOS
            MATCH     SP3,PTHFHGRP                 * blank health fund group ?
            GOTO      ECLEXT95 IF EQUAL
            MOVE      PTHFHGRP,ECLKEY3
          ELSE
            MOVE      PTFXECLP,ECLKEY3
          ENDIF
.
          MOVE      ECLKEY3,KEY3
          CALL      RDPTPAR1                     * participant code on file ?
          BRANCH    OVRCD,ECLEXT95
.
          MATCH     CVETINS,ECLKEY3
          GOTO      ECLEXT96 IF EQUAL            * is the participant DVA ?
.
          MOVE      ECLKEY3,KEY3
          PACK      KEY9,KEY3,ANSI,ANSH,ANSC,SP3
          CALL      RDPTPCP1                     * IHC capability ?
          BRANCH    OVRCD,ECLEXT87
.
          CALL      RERR0000                     * reset any error records
          GOTO      ECLEXT80
.
ECLEXT20  MATCH     SP70,HFUNDTYP                * no code chosen yet
          GOTO      ECLEXT80 IF EQUAL
.
          MATCH     SP6,CVETINS                  * insurance code for DVA?
          GOTO      ECLEXT97 IF EQUAL
.
          PACK      KEY6,CVETINS,SP6
          CALL      RDINSR1                      * insurance company on file ?
          BRANCH    OVRCD,ECLEXT90
.
          MOVE      CVETINS,KEY3
          CALL      RDPTPAR1                     * participant code on file ?
          BRANCH    OVRCD,ECLEXT95
.
          MOVE      CVETINS,KEY3
          PACK      KEY9,KEY3,ANSI,ANSH,ANSC,SP3
          CALL      RDPTPCP1                     * IHC capability ?
          BRANCH    OVRCD,ECLEXT87
.
          PACK      KEY5,ANSC,ANSL,HFUNDTYP,SP5
          CALL      RDCODE1
          BRANCH    OVRCD,ECLEXT98
.
          MOVE      ZERO,FORM1
          WHILE     FORM1 < 5
            ADD       ONE,FORM1
            LOAD      ANS,FORM1,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
            MATCH     ANSV,ANS                   * DVA code ?
            GOTO      ECLEXT25 IF EQUAL          * yes
          DO
.
          GOTO      ECLEXT98
.
ECLEXT25  CALL      RERR0000                     * reset any error records
          GOTO      ECLEXT80
.
ECLEXT30  COMPARE   ZERO,LASTDCLM
          GOTO      ECLEXT35 IF EQUAL            * any claims to delete first ?
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,DECLMARR[COUNT]
            IF        !@EQUAL
              CALL      EDEL0000                 * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
          MOVE      ONE,NEXTPAGE
.
          COMPARE   ZERO,ERRORCNT
          GOTO      ECLEXT35 IF EQUAL
.
          CALL      ERRLST00                     * display any delete errors
.>>>>     MOVE      ONE,EXIT
.>>>>     GOTO      ECLEXT99
.
ECLEXT35  COMPARE   ONE,PTCNUEDI                 * using edi module?
          GOTO      ECLEXT91 IF NOT EQUAL
.
          MATCH     SP70,PTCNECLO                * eclipse outbound path set?
          GOTO      ECLEXT92 IF EQUAL
.
          COMPARE   ZERO,LASTECLM
          GOTO      ECLEXT86 IF EQUAL            * no claims to extract
.
          CALL      SECLX000                     * Extract Eclipse Claims
.
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
.   ************ DELETE CLAIM FUNCTION ************
.>>>>     
ECLEXT40  COMPARE   ZERO,LASTDCLM
          GOTO      ECLEXT86 IF EQUAL            * no claims to delete
.
          MOVE      ZERO,ERRORCNT 
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM 
            MATCH     SP70,DECLMARR[COUNT]
            IF        !@EQUAL
              CALL      EDEL0000   * Delete Eclipse Claim Record 
            ENDIF   
            ADD      ONE,COUNT
          DO
.         
          MOVE      ZERO,EXIT
.         
          COMPARE   ZERO,ERRORCNT
          GOTO      ECLEXT99 IF EQUAL
.
          CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      ECLEXT99
.
ECLEXT80  CLEAR     WEBTITLE
          MOVE      "Eclipse IHC Claims Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ECLEXT99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      ECLEXT99
.
ECLEXT85  MOVE      "Invalid Form Action.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT86  MOVE      "No claims selected to extract.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT87  MOVE      "Participant cannot accept IHCs.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT90  MOVE      "Insurance code not found.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT91  MOVE      "Hospital not using the EDI Module.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT92  MOVE      "Eclipse Outbound Path blank.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT93  MOVE      "Health Fund or extension record not found.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT94  MOVE      "Health Fund not using Eclipse.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT95  MOVE      "Participant code blank or not on file.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT96  MOVE      "Process DVA claims by claim code.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT97  MOVE      "Insurance code for DVA is blank.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT98  MOVE      "Claim code not DVA related.",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      ECLEXT99
.
ECLEXT99  RETURN
+
.--------------------------------------------------------------------------
. Option 8 - Eclipse Claims Extract tags
.--------------------------------------------------------------------------
EEXT0000  BRANCH    FLDITMNO,EEXT0100,EEXT0200,EEXT0300,EEXT0400,EEXT0500:
                             EEXT0600,EEXT0700,EEXT0800
          GOTO      EEXT9999
.
EEXT0100  MOVE      ONE,ALLHFLAG          * default to 'All'
          CALL      HOSPID00              * display Multi-hosp. selection list
          GOTO      EEXT9999
.
EEXT0200  CALL      ECSHN000              * selected Hospital Desc (Multi-hosp)
          GOTO      EEXT9999
.
EEXT0300  MOVE      "CL",CATEGORY         * Compensation code/Claim Type
          MOVE      HFUNDTYP,CODE
          CALL      CODITM00
          GOTO      EEXT9999
.
EEXT0400  CALL      ECWFX000              * Claims Waiting for Extraction
          GOTO      EEXT9999
.
EEXT0500  MATCH     SP70,UPDTTYPE
          GOTO      EEXT9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI
          GOTO      EEXT9999
.
EEXT0600  WRITE     HTMLFILE;CLAMTYPE;    * Claim type CGI
          GOTO      EEXT9999
.
EEXT0700  MATCH     SP70,HFUNDTYP
          GOTO      EEXT9999 IF EQUAL
          WRITE     HTMLFILE;HFUNDTYP;    * Health Fund CGI
          GOTO      EEXT9999
.
EEXT0800  WRITE     HTMLFILE;HFUNDESC;    * Health Fund Desc CGI
          GOTO      EEXT9999
.
EEXT9999  RETURN
+
.------------------------------------------------------------
. Table of all Eclipse IHC Claims Waiting For Extraction
.------------------------------------------------------------
ECWFX000  MOVE      ZERO,FORM3
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     HFUNDTYP,SP70           * cannot have blank code
          GOTO      ECWFX900 IF EQUAL
.
          PACK      KEY35,HOSPCODE,SP1,ZERO,SP70
ECWFX040  CALL      RSPMECT1
ECWFX050  CALL      RKPMECT1                * read next record
          BRANCH    OVRCD,ECWFX900          * end of file
.
          MATCH     SP3,HOSPCODE                 * all hospitals ?
          IF        !@EQUAL
            MATCH     HOSPCODE,PMECHOSP          * no - same hospital still ?
            GOTO      ECWFX900 IF NOT EQUAL      * no - finished
          ENDIF
.
          COMPARE   ZERO,PMECFLAG                * waiting for extract still ?
          IF        !@EQUAL
            PACK      KEY35,PMECHOSP,Z70
            GOTO      ECWFX040                   * get next record
          ENDIF
.
.         Processing by Health Fund (option 1) or claim code (option 2)
.
          IF        OPTNFLAG = 1
            MATCH     HFUNDTYP,PMECHFND          * same health fund ?
            GOTO      ECWFX050 IF NOT EQUAL      * no - ignore record
.
            COMPARE   ZERO,PMECEETP              * health fund claim type ?
            GOTO      ECWFX050 IF NOT EQUAL      * no - ignore record
            GOTO      ECWFX200                   * yes
          ENDIF
.
.         Processing by claim code option
.
ECWFX100  MOVE      PMECADMN,KEY8
          CALL      RDMISS1                      * admission on file ?
          BRANCH    OVRCD,ECWFX050               * no - ignore record
.
          MATCH     SP3,ACLAIM                   * blank claim code ?
          GOTO      ECWFX050 IF EQUAL            * yes - ignore record
.
.         Check we have the same claim code
.
          MATCH     CLAMTYPE,ACLAIM              * same claim code ?
          GOTO      ECWFX050 IF NOT EQUAL        * no - ignore record
.
          COMPARE   ONE,PMECEETP                 * claim code claim type ?
          GOTO      ECWFX050 IF NOT EQUAL        * no - ignore record
.
.         A waiting record for the health fund/claim code has been found,
.         so get the invoice details and calculate the amount outstanding.
.
ECWFX200  CALL      ECLRW000      * Output Row
          IF        DISNUMB>=50
            GOTO      ECWFX800
          ENDIF
          GOTO      ECWFX050
.
ECWFX800  CALL      LIMREC00        * Show batch limit reached message
          GOTO      ECWFX999
.
ECWFX900  CALL      TOTREC00        * Show no more records message
.
ECWFX999  RETURN
+
.------------------------------------------------------------
. Display Eclipse selected Hospital Name (multi-hospital)
.------------------------------------------------------------
ECSHN000  COMPARE   ONE,IBCNMHOS
          GOTO      ECSHN999 IF NOT EQUAL
.
          MOVE      " All",DIM4
          PACK      PTHSNAME,HOSPCODE,DIM4
          PACK      KEY3,HOSPCODE,SP10
          CALL      RDPTHSP1
.
          WRITE     HTMLFILE;PTHSNAME
.
ECSHN999  RETURN
+
.-------------------------------------------------------------
. Link to Prev Eclipse Group
.-------------------------------------------------------------
PREVEC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",FILTTYPE
          REP       " +",FILTSTAT
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&filttype=",FILTTYPE:
                                 "&filtstat=",FILTSTAT:
                                 "&updttype=",UPDTTYPE;
.
          REP       "+ ",FILTTYPE
          REP       "+ ",FILTSTAT
.
PREVEC99  RETURN
.-----------------------------------------------------------
. Link to Next Eclipse Group
.-----------------------------------------------------------
NEXTEC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",FILTTYPE
          REP       " +",FILTSTAT
.
          WRITE     HTMLFILE;"hosweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&filttype=",FILTTYPE:
                                 "&filtstat=",FILTSTAT:
                                 "&updttype=",UPDTTYPE;
.
          REP       "+ ",FILTTYPE
          REP       "+ ",FILTSTAT
.
NEXTEC99  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse (TABLE ROW)
.------------------------------------------------------------
ECLRW000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,PMECINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      SP8,PINVDTE
          ELSE
            MATCH     ZEROVISN,PINVADM
            IF        @EQUAL
              GOTO      ECLRW900                 * delete claim
            ENDIF
            IF        PINVTYP =2
              GOTO      ECLRW900                 * delete claim
            ENDIF
            ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR),FORM12P2
            IF        IBCNUGST=2
              ADD       PTINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PINVDTE
          IF        !@EQUAL
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;PMECADMN,"&nbsp;</td>":
                             "<td>",PMECINVN,"&nbsp;</td>":
                             "<td>",PMECURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",PMECHOSP,PMECADMN,PMECINVN:
                                        PMECURNO,PINVDTE,KEY15:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=declm",KEY3:
                             " value='",PMECINVN:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      ECLRW999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in pmsectaf
.
ECLRW900  PACK      SAVKEY35,PMECHOSP,PMECFLAG,PMECHFND,PMECADMN,PMECINVN:
                             PMECBATN
          MOVE      SAVKEY35,KEY35
          CALL      DEPMECT1                 * delete cancelled/zero invoices
          MOVE      SAVKEY35,KEY35
          CALL      RSPMECT1
.
ECLRW999  RETURN
+
.*****************************************************************************
.*                              RERR0000           Called by: ECLEXT00       *
.*             Reset error records back to zero status (Not Sent)            *
.*             just in case there were any problems with a previous          *
.*             batch and the error records were not set back to zero.        *
.*****************************************************************************
.
RERR0000  MOVE      HOSPCODE,SAVEHOSP            * initialise hospital
          MOVE      ZERO,FIRSTFLG                * initialise flag
.
          PACK      KEY35,HOSPCODE,SP1,ONE,HFUNDTYP,SP30,SP10
RERR0500  CALL      RSPMECT1                     * position in file
          CALL      RKPMECT1                     * read next record
          BRANCH    OVRCD,RERR9999               * eof - finished
.
          IF        FIRSTFLG = 0
            MATCH     SP3,HOSPCODE               * all hospitals extract ?
            IF        @EQUAL
              MOVE      PMECHOSP,SAVEHOSP        * yes-load first hospital code
            ENDIF
            MOVE      ONE,FIRSTFLG               * set first flag to no
          ENDIF
.
          MATCH     SP3,HOSPCODE                 * all hospitals extract ?
          GOTO      RERR5000 IF NOT EQUAL        * no
.
.         We are running an extract for all hospitals
.
          MATCH     SAVEHOSP,PMECHOSP            * same hospital still ?
          IF        !@EQUAL
            MOVE      PMECHOSP,SAVEHOSP          * no - save new hospital code
            PACK      KEY35,PMECHOSP,SP1,ONE,HFUNDTYP,SP30,SP10
            GOTO      RERR0500
          ENDIF
.
          COMPARE   ONE,PMECFLAG                 * error record still ?
          GOTO      RERR4000 IF NOT EQUAL        * no - get next hospital
.
          MATCH     HFUNDTYP,PMECHFND            * same health fund still ?
          GOTO      RERR4000 IF NOT EQUAL        * no - finished
.
          GOTO      RERR8000
.
RERR4000  PACK      KEY35,PMECHOSP,Z70
          GOTO      RERR0500
.
.         We are running an extract for a given hospital id
.
RERR5000  MATCH     HOSPCODE,PMECHOSP            * same hospital still ?
          GOTO      RERR9999 IF NOT EQUAL        * no - finished
.
          COMPARE   ONE,PMECFLAG                 * error record still ?
          GOTO      RERR9999 IF NOT EQUAL        * no - finished
.
          MATCH     HFUNDTYP,PMECHFND            * same health fund still ?
          GOTO      RERR9999 IF NOT EQUAL        * no - finished
.
.         Reset the record status to "Waiting"
.
RERR8000  PACK      SAVKEY35,PMECHOSP,PMECFLAG,PMECHFND,PMECADMN,PMECINVN:
                             PMECBATN
          MOVE      ZERO,PMECFLAG                * yes - reset flag to "0"
          CALL      UPPMECT1                     * update record
          MOVE      SAVKEY35,KEY35               * load key to reposition
          GOTO      RERR0500                     * get next record
.
RERR9999  RETURN
+
.------------------------------------------------------------
. Set Default Printer
.------------------------------------------------------------
SETDEF00  MOVE      PRGID,SAVPRGID
          MOVE      REPORTNO,SAVREPTN
.
          MOVE      SCHDPRNT,SELPRINT
          MOVE      SETDFPRG,PRGID
          MOVE      SETDFRPT,REPORTNO
          CALL      UPDFPT00
.
          MOVE      SAVPRGID,PRGID
          MOVE      SAVREPTN,REPORTNO
          RETURN
+
.------------------------------------------------------------
. Eclipse Assessing Report Enquiry
.------------------------------------------------------------
ECLPRE00  MATCH     SP70,UPDTTYPE
          GOTO      ECLPRE80 IF EQUAL
.
          MATCH     "H",UPDTTYPE    * Assessment Report Header
          GOTO      ECLPRE10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Assessment Report Details
          GOTO      ECLPRE20 IF EQUAL
.
          MATCH     "S",UPDTTYPE    * Assessment Report Services Header
          GOTO      ECLPRE30 IF EQUAL
.
          MATCH     "P",UPDTTYPE    * Print Assessment Report
          GOTO      ECLPRE40 IF EQUAL
.
          GOTO      ECLPRE85
.
ECLPRE10  PACK      KEY38,ECPRPTCD,ECPRINVN,ECPRFNDR,ECPRREPT,SP70
          CALL      RDPMEAH1
          IF        OVRCD=1
.
            PACK      KEY38,ECPRPTCD,SP70
            CALL      RSPMEAH1
ECLPRE15    CALL      RKPMEAH1
            BRANCH    OVRCD,ECLPRE86
.
            PACK      ECPRPTCD,ECPRPTCD,SP70
            CMATCH    NULL,PMAHFBID
            IF        @EQUAL
              MOVE      SP70,PMAHFBID
            ENDIF
            PACK      PMAHFBID,PMAHFBID,SP70
            MATCH     ECPRPTCD,PMAHFBID
            GOTO      ECLPRE86 IF NOT EQUAL
.
            PACK      ECPRINVN,ECPRINVN,SP70
            CMATCH    NULL,PMAHARID
            IF        @EQUAL
              MOVE      SP70,PMAHARID
            ENDIF
            PACK      PMAHARID,PMAHARID,SP70
            MATCH     ECPRINVN,PMAHARID
            GOTO      ECLPRE15 IF NOT EQUAL
.
            PACK      ECPRFNDR,ECPRFNDR,SP70
            CMATCH    NULL,PMAHFRID
            IF        @EQUAL
              MOVE      SP70,PMAHFRID
            ENDIF
            PACK      PMAHFRID,PMAHFRID,SP70
            MATCH     ECPRFNDR,PMAHFRID
            GOTO      ECLPRE15 IF NOT EQUAL
.
            PACK      ECPRREPT,ECPRREPT,SP70
            CMATCH    NULL,PMAHRPTC
            IF        @EQUAL
              MOVE      SP70,PMAHRPTC
            ENDIF
            PACK      PMAHRPTC,PMAHRPTC,SP70
            MATCH     ECPRREPT,PMAHRPTC
            GOTO      ECLPRE15 IF NOT EQUAL
.
          ENDIF
.
          GOTO      ECLPRE80
.
ECLPRE20  PACK      KEY38,ECPRPTCD,ECPRINVN,ECPRFNDR,ECPRREPT,SP70
          CALL      RDPMEAH1
          IF        OVRCD=1
.           
            PACK      KEY38,ECPRPTCD,SP70
            CALL      RSPMEAH1
ECLPRE25    CALL      RKPMEAH1 
            BRANCH    OVRCD,ECLPRE86
.           
            PACK      ECPRPTCD,ECPRPTCD,SP70
            CMATCH    NULL,PMAHFBID
            IF        @EQUAL
              MOVE      SP70,PMAHFBID
            ENDIF     
            PACK      PMAHFBID,PMAHFBID,SP70
            MATCH     ECPRPTCD,PMAHFBID
            GOTO      ECLPRE86 IF NOT EQUAL
.
            PACK      ECPRINVN,ECPRINVN,SP70
            CMATCH    NULL,PMAHARID
            IF        @EQUAL
              MOVE      SP70,PMAHARID
            ENDIF
            PACK      PMAHARID,PMAHARID,SP70
            MATCH     ECPRINVN,PMAHARID
            GOTO      ECLPRE25 IF NOT EQUAL
.
            PACK      ECPRFNDR,ECPRFNDR,SP70
            CMATCH    NULL,PMAHFRID
            IF        @EQUAL
              MOVE      SP70,PMAHFRID
            ENDIF
            PACK      PMAHFRID,PMAHFRID,SP70
            MATCH     ECPRFNDR,PMAHFRID
            GOTO      ECLPRE25 IF NOT EQUAL
.
            PACK      ECPRREPT,ECPRREPT,SP70
            CMATCH    NULL,PMAHRPTC
            IF        @EQUAL
              MOVE      SP70,PMAHRPTC
            ENDIF
            PACK      PMAHRPTC,PMAHRPTC,SP70
            MATCH     ECPRREPT,PMAHRPTC
            GOTO      ECLPRE25 IF NOT EQUAL
.
          ENDIF
.
          PACK      KEY45,ECPRPTCD,ECPRINVN,ECPRFNDR,ECPRREPT:
                          ECPRCFEC,ECPREXPC,SP70
          CALL      RDPMEAD1
          IF        OVRCD=1
.
            PACK      KEY45,ECPRPTCD,SP70
            CALL      RSPMEAD1
ECLPRE27    CALL      RKPMEAD1
            BRANCH    OVRCD,ECLPRE87
.
            PACK      ECPRPTCD,ECPRPTCD,SP70
            CMATCH    NULL,PMADFBID
            IF        @EQUAL
              MOVE      SP70,PMADFBID
            ENDIF
            PACK      PMADFBID,PMADFBID,SP70
            MATCH     ECPRPTCD,PMADFBID
            GOTO      ECLPRE87 IF NOT EQUAL 
.
            PACK      ECPRINVN,ECPRINVN,SP70
            CMATCH    NULL,PMADARID
            IF        @EQUAL
              MOVE      SP70,PMADARID
            ENDIF
            PACK      PMADARID,PMADARID,SP70
            MATCH     ECPRINVN,PMADARID
            GOTO      ECLPRE27 IF NOT EQUAL
.
            PACK      ECPRFNDR,ECPRFNDR,SP70
            CMATCH    NULL,PMADFRID
            IF        @EQUAL
              MOVE      SP70,PMADFRID
            ENDIF
            PACK      PMADFRID,PMADFRID,SP70
            MATCH     ECPRFNDR,PMADFRID
            GOTO      ECLPRE27 IF NOT EQUAL
.
            PACK      ECPRREPT,ECPRREPT,SP70
            CMATCH    NULL,PMADRPTC
            IF        @EQUAL
              MOVE      SP70,PMADRPTC
            ENDIF
            PACK      PMADRPTC,PMADRPTC,SP70
            MATCH     ECPRREPT,PMADRPTC
            GOTO      ECLPRE27 IF NOT EQUAL
.
            PACK      ECPRCFEC,ECPRCFEC,SP70
            CMATCH    NULL,PMADCFEC
            IF        @EQUAL
              MOVE      SP70,PMADCFEC
            ENDIF
            PACK      PMADCFEC,PMADCFEC,SP70
            MATCH     ECPRCFEC,PMADCFEC
            GOTO      ECLPRE27 IF NOT EQUAL
.
            PACK      ECPREXPC,ECPREXPC,SP70
            CMATCH    NULL,PMADEXPC
            IF        @EQUAL
              MOVE      SP70,PMADEXPC
            ENDIF
            PACK      PMADEXPC,PMADEXPC,SP70
            MATCH     ECPREXPC,PMADEXPC
            GOTO      ECLPRE27 IF NOT EQUAL
.
          ENDIF 
.
          GOTO      ECLPRE80
.
ECLPRE30  
.          PACK      KEY52,ECPRPTCD,ECPRINVN,ECPRFNDR,ECPRREPT:
.                          ECPRSCOD,ECPRSRVC,SP70
.          CALL      RDPMESH1
.          IF        OVRCD=1
.
            PACK      KEY52,ECPRPTCD,SP70
            CALL      RSPMESH1
ECLPRE35    CALL      RKPMESH1
            BRANCH    OVRCD,ECLPRE86 
.
            PACK      ECPRPTCD,ECPRPTCD,SP70
            CMATCH    NULL,PMSHFBID
            IF        @EQUAL
              MOVE      SP70,PMSHFBID
            ENDIF
            PACK      PMSHFBID,PMSHFBID,SP70
            MATCH     ECPRPTCD,PMSHFBID
            GOTO      ECLPRE86 IF NOT EQUAL
.
            PACK      ECPRINVN,ECPRINVN,SP70
            CMATCH    NULL,PMSHARID
            IF        @EQUAL
              MOVE      SP70,PMSHARID
            ENDIF
            PACK      PMSHARID,PMSHARID,SP70
            MATCH     ECPRINVN,PMSHARID
            GOTO      ECLPRE35 IF NOT EQUAL
.
            PACK      ECPRFNDR,ECPRFNDR,SP70
            CMATCH    NULL,PMSHFRID
            IF        @EQUAL
              MOVE      SP70,PMSHFRID
            ENDIF
            PACK      PMSHFRID,PMSHFRID,SP70
            MATCH     ECPRFNDR,PMSHFRID
            GOTO      ECLPRE35 IF NOT EQUAL
.
            PACK      ECPRREPT,ECPRREPT,SP70
            CMATCH    NULL,PMSHRPTC
            IF        @EQUAL
              MOVE      SP70,PMSHRPTC
            ENDIF
            PACK      PMSHRPTC,PMSHRPTC,SP70
            MATCH     ECPRREPT,PMSHRPTC
            GOTO      ECLPRE35 IF NOT EQUAL
.
            PACK      ECPRSCOD,ECPRSCOD,SP70
            CMATCH    NULL,PMSHSCOD
            IF        @EQUAL
              MOVE      SP70,PMSHSCOD
            ENDIF
            PACK      PMSHSCOD,PMSHSCOD,SP70
            MATCH     ECPRSCOD,PMSHSCOD
            GOTO      ECLPRE35 IF NOT EQUAL
.
            PACK      ECPRSRVC,ECPRSRVC,SP70
            CMATCH    NULL,PMSHSRVC
            IF        @EQUAL
              MOVE      SP70,PMSHSRVC
            ENDIF
            PACK      PMSHSRVC,PMSHSRVC,SP70
            MATCH     ECPRSRVC,PMSHSRVC
            GOTO      ECLPRE35 IF NOT EQUAL
.
.          ENDIF
.
          GOTO      ECLPRE80
.
ECLPRE40  CALL      SECAR000      * Schedule print Assessment Report
.
          MOVE      ZERO,EXIT
          GOTO      ECLPRE99
.
ECLPRE80  CLEAR     WEBTITLE
          MOVE      "Eclipse Assessing Report Enquiry",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ECLPRE99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      ECLPRE99
.
ECLPRE85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLPRE99
.
ECLPRE86  MOVE      "Assessment Report Header not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLPRE99
.
ECLPRE87  MOVE      "Assessment Report Details not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLPRE99
.
ECLPRE99  RETURN
+
.--------------------------------------------------------------------------
. Option 9 - Eclipse Assessing Report Enquiry tags
.--------------------------------------------------------------------------
EPEN0000  BRANCH    FLDITMNO,EPEN0100,EPEN0200,EPEN0300,EPEN0400,EPEN0500:
                             EPEN0600,EPEN0700,EPEN0800,EPEN0900,EPEN1000:
                             EPEN1100,EPEN1200,EPEN1300,EPEN1400,EPEN1500:
                             EPEN1600,EPEN1700
          GOTO      EPEN9999
.
EPEN0100  UNPACK    DIM127,D1,DIM1,DIM127
          MOVE      ZERO,FORM1
          MOVE      DIM1,FORM1
          BRANCH    FORM1,EPEN0110
.
          WRITE     HTMLFILE;PARTCODE;
          GOTO      EPEN9999
.
EPEN0110  PACK      KEY3,PARTCODE,SP70
          CALL      RDPTPAR1
          BRANCH    OVRCD,EPEN9999
.
          WRITE     HTMLFILE;PTPRNAME;
          GOTO      EPEN9999
.
EPEN0200  CALL      EAHR0000
          GOTO      EPEN9999
.
EPEN0300  WRITE     HTMLFILE;PMAHFBID;
          GOTO      EPEN9999
.
EPEN0400  WRITE     HTMLFILE;PMAHARID;
          GOTO      EPEN9999
.
EPEN0500  WRITE     HTMLFILE;PMAHFRID;
          GOTO      EPEN9999
.
EPEN0600  WRITE     HTMLFILE;PMAHRPTC;
          GOTO      EPEN9999
.
EPEN0700  WRITE     HTMLFILE;PMAHFSCD;
          GOTO      EPEN9999
.
EPEN0800  WRITE     HTMLFILE;PMAHFCID;
          GOTO      EPEN9999
.
EPEN0900  WRITE     HTMLFILE;PMAHCFAC;
          GOTO      EPEN9999
.
EPEN1000  MOVE      ZERO,FORM7P2
          UNPACK    PMAHTCAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EPEN9999
.
EPEN1100  MOVE      ZERO,FORM7P2
          UNPACK    PMAHTBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EPEN9999
.
EPEN1200  MOVE      ZERO,FORM7P2
          UNPACK    PMAHEXAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EPEN9999
.
EPEN1300  MOVE      ZERO,FORM7P2
          UNPACK    PMAHCPAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2     
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EPEN9999
.
EPEN1400  WRITE     HTMLFILE;PMAHFTID;
          GOTO      EPEN9999
.
EPEN1500  MATCH     SP70,PMAHUDTE
          GOTO      EPEN9999 IF EQUAL
          UNPACK    PMAHUDTE,CCENT,CYEAR,CMON,CDAY  * Service Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EPEN9999
.
EPEN1600  WRITE     HTMLFILE;PMAHUTIM;
          GOTO      EPEN9999
.
EPEN1700  WRITE     HTMLFILE;PMAHFBID,PMAHARID,PMAHFRID,PMAHRPTC;
          GOTO      EPEN9999
.
EPEN9999  RETURN
+
.--------------------------------------------------------------------------
. Option 9 - Eclipse Assessing Report Details tags
.--------------------------------------------------------------------------
EARD0000  BRANCH    FLDITMNO,EARD0100,EARD0200,EARD0300,EARD0400,EARD0500:
                             EARD0600,EARD0700,EARD0800,EARD0900,EARD1000
          GOTO      EARD9999
.
EARD0100  CALL      EADR0000
          GOTO      EARD9999
.
EARD0200  WRITE     HTMLFILE;PMADFBID;
          GOTO      EARD9999
.
EARD0300  WRITE     HTMLFILE;PMADARID;
          GOTO      EARD9999
.
EARD0400  WRITE     HTMLFILE;PMADFRID;
          GOTO      EARD9999
.
EARD0500  WRITE     HTMLFILE;PMADRPTC;
          GOTO      EARD9999
.
EARD0600  WRITE     HTMLFILE;PMADCFEC;
          GOTO      EARD9999
.
EARD0700  WRITE     HTMLFILE;PMADEXPC;
          GOTO      EARD9999
.
EARD0800  WRITE     HTMLFILE;PMADCFET;
          GOTO      EARD9999
.
EARD0900  WRITE     HTMLFILE;PMADELNM;
          GOTO      EARD9999
.
EARD1000  WRITE     HTMLFILE;PMADMPID;
          GOTO      EARD9999
.
EARD9999  RETURN
+
.--------------------------------------------------------------------------
. Option 9 - Eclipse Assessing Report Services tags
.--------------------------------------------------------------------------
EARS0000  BRANCH    FLDITMNO,EARS0100,EARS0200,EARS0300,EARS0400,EARS0500:
                             EARS0600,EARS0700,EARS0800,EARS0900,EARS1000:
                             EARS1100,EARS1200,EARS1300,EARS1400,EARS1500
          GOTO      EARS9999
.
EARS0100  CALL      ESDR0000
          GOTO      EARS9999
.
EARS0200  WRITE     HTMLFILE;PMSHFBID;
          GOTO      EARS9999
.
EARS0300  WRITE     HTMLFILE;PMSHARID;
          GOTO      EARS9999
.
EARS0400  WRITE     HTMLFILE;PMSHFRID;
          GOTO      EARS9999
.
EARS0500  WRITE     HTMLFILE;PMSHRPTC;
          GOTO      EARS9999
.
EARS0600  WRITE     HTMLFILE;PMSHSCOD;
          GOTO      EARS9999
.
EARS0700  WRITE     HTMLFILE;PMSHSRVC;
          GOTO      EARS9999
.
EARS0800  WRITE     HTMLFILE;PMSHSDSC;
          GOTO      EARS9999
.
EARS0900  WRITE     HTMLFILE;PMSHNOSV;
          GOTO      EARS9999
.
EARS1000  MOVE      ZERO,FORM7P2
          UNPACK    PMSHCAMT,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EARS9999
.
EARS1100  MOVE      ZERO,FORM7P2
          UNPACK    PMSHFBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EARS9999
.
EARS1200  MATCH     SP70,PMSHFDTE
          GOTO      EARS9999 IF EQUAL
          UNPACK    PMSHFDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EARS9999
.
EARS1300  MATCH     SP70,PMSHTDTE
          GOTO      EARS9999 IF EQUAL
          UNPACK    PMSHTDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EARS9999
.
EARS1400  MATCH     SP70,PMSHSDTE
          GOTO      EARS9999 IF EQUAL
          UNPACK    PMSHSDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EARS9999
.
EARS1500  CALL      ESDD0000
          GOTO      EARS9999
.
EARS9999  RETURN
+
.***************************************************************************
.*                             EAHR0000                                    *
.*   Display all the assessment reports received from a given participant  *
.***************************************************************************
EAHR0000  MATCH     SP70,PARTCODE
          GOTO      EAHR9999 IF EQUAL
.
          PACK      KEY38,PARTCODE,SP70
          CALL      RSPMEAH1                     * position in file
EAHR1000  CALL      RKPMEAH1                     * read next record
          BRANCH    OVRCD,EAHR9999               * end of file
.
          MATCH     PARTCODE,PMAHFBID
          GOTO      EAHR9999 IF NOT EQUAL
.
          MOVE      ZERO,FORM1
.         
          MOVE      ZERO,FORM7P2
          UNPACK    PMAHTCAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
.
          MOVE      PMAHCFAC,STATKEY1
          REP       "A1R2W3C4I5",STATKEY1
          MOVE      STATKEY1,FORM1
          MOVE      CLAMST00,CLAMDESC
          LOAD      CLAMDESC,FORM1,CLAMST01,CLAMST02,CLAMST03,CLAMST04,CLAMST05
.
          MOVE      SP70,DIM11
          MATCH     SP70,PMAHUDTE
          IF        !@EQUAL & !@EOS
            UNPACK    PMAHUDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          REP       " +",PMAHFBID
          REP       " +",PMAHARID
          REP       " +",PMAHFRID
          REP       " +",PMAHRPTC
.
        WRITE     HTMLFILE;"t.addRow(#"","<img src='../images/CommentIcon.gif'":
                           " class=ListIcon onclick=displayProH('":
          PMAHFBID,"','",PMAHARID,"','",PMAHFRID,"','",PMAHRPTC,"','002');> ";
.
          REP       "+ ",PMAHFBID
          REP       "+ ",PMAHARID
          REP       "+ ",PMAHFRID
          REP       "+ ",PMAHRPTC
.
          WRITE     HTMLFILE;PMAHARID,"#",";               * 0
.
          WRITE     HTMLFILE;"#"",PMAHFRID,"#",":          * 1
                             "#"",PMAHRPTC,"#",":          * 2
                             "#"",CLAMDESC,"#",":          * 3
                             "#"",FORM7P2,"#",":           * 4
                             "#"",DIM11,"#",";             * 5
.
          REP       " +",PMAHFBID
          REP       " +",PMAHARID
          REP       " +",PMAHFRID
          REP       " +",PMAHRPTC
.
          WRITE     HTMLFILE;"#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=displayProH('":
          PMAHFBID,"','",PMAHARID,"','",PMAHFRID,"','",PMAHRPTC,"','003');> ":
          "#",";                                           * 6
.
          WRITE     HTMLFILE;"#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=displayProH('":
          PMAHFBID,"','",PMAHARID,"','",PMAHFRID,"','",PMAHRPTC,"','005');> ":
          "#");"                                           * 7
.
          REP       "+ ",PMAHFBID
          REP       "+ ",PMAHARID
          REP       "+ ",PMAHFRID
          REP       "+ ",PMAHRPTC
.
          GOTO      EAHR1000
.
EAHR9999  RETURN
+
.***************************************************************************
.*                             EADR0000                                    *
.*   Display the assessment report details received for a claim            *
.***************************************************************************
EADR0000  CALL      EADRH000
.
          PACK      KEY45,PMAHFBID,PMAHARID,PMAHFRID,PMAHRPTC,SP70
          CALL      RSPMEAD1
EADR1000  CALL      RKPMEAD1
          BRANCH    OVRCD,EADR9999
.
          MATCH     PMAHFBID,PMADFBID
          GOTO      EADR9999 IF NOT EQUAL
.
          MATCH     PMAHARID,PMADARID
          GOTO      EADR9999 IF NOT EQUAL
.
          MATCH     PMAHFRID,PMADFRID
          GOTO      EADR9999 IF NOT EQUAL
.
          MATCH     PMAHRPTC,PMADRPTC
          GOTO      EADR9999 IF NOT EQUAL
.
          CALL      EADRR000
.
          GOTO      EADR1000
.
EADR9999  RETURN
+
.------------------------------------------------------------
. EAD Assessment Details (TABLE HEADING)
.------------------------------------------------------------
EADRH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Fund<br>Brand ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Account<br>Reference ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Fund<br>Reference ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Report<br>Counter</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Explanation<br>Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Explanation Code<br>Counter</td>":
                             "</tr>"
.
EADRH999  RETURN
.------------------------------------------------------------
. Eclipse Assessment Details (Detail Row)
.------------------------------------------------------------
EADRR000  REP       " +",PMADFBID
          REP       " +",PMADARID
          REP       " +",PMADFRID
          REP       " +",PMADRPTC
          REP       " +",PMADCFEC
          REP       " +",PMADEXPC
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displayAssD('",PMADFBID:
                             "','",PMADARID,"','",PMADFRID,"','",PMADRPTC:
                             "','",PMADCFEC,"','",PMADEXPC,"');>&nbsp;";
          REP       "+ ",PMADFBID
          REP       "+ ",PMADARID
          REP       "+ ",PMADFRID
          REP       "+ ",PMADRPTC
          REP       "+ ",PMADCFEC
          REP       "+ ",PMADEXPC
.
          WRITE     HTMLFILE;PMADFBID,"</td>":
                             "<td>",PMADARID,"</td>":
                             "<td>",PMADFRID,"</td>":
                             "<td>",PMADRPTC,"</td>":
                             "<td>",PMADCFEC,"</td>":
                             "<td>",PMADEXPC,"</td>":
                             "</tr>"
.
EADRR999  RETURN
+
.***************************************************************************
.*                             ESDR0000                                    *
.*   Display the service report header received for a claim                *
.***************************************************************************
ESDR0000  CALL      ESDRH000
.         
          PACK      KEY52,PMAHFBID,PMAHARID,PMAHFRID,PMAHRPTC,SP70
          CALL      RSPMESH1
ESDR1000  CALL      RKPMESH1 
          BRANCH    OVRCD,ESDR9999
.         
          MATCH     PMAHFBID,PMSHFBID
          GOTO      ESDR9999 IF NOT EQUAL
.         
          MATCH     PMAHARID,PMSHARID
          GOTO      ESDR9999 IF NOT EQUAL
.
          MATCH     PMAHFRID,PMSHFRID
          GOTO      ESDR9999 IF NOT EQUAL
.
          MATCH     PMAHRPTC,PMSHRPTC
          GOTO      ESDR9999 IF NOT EQUAL
.
          CALL      ESDRR000
.
          GOTO      ESDR1000
.
ESDR9999  RETURN
+
.------------------------------------------------------------
. ESH Assessment Services Header (TABLE HEADING)
.------------------------------------------------------------
ESDRH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "Fund<br>Brand ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Account<br>Reference ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Fund<br>Reference ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Report<br>Counter</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Service<br>Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Service Code<br>Counter</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=10%>":
                             "Details</td>":
                             "</tr>"
.
ESDRH999  RETURN
.------------------------------------------------------------
. Eclipse Services Header (Detail Row)
.------------------------------------------------------------
ESDRR000  REP       " +",PMSHFBID
          REP       " +",PMSHARID
          REP       " +",PMSHFRID
          REP       " +",PMSHRPTC
          REP       " +",PMSHSCOD
          REP       " +",PMSHSRVC
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",PMSHFBID:
                             "','",PMSHARID,"','",PMSHFRID,"','",PMSHRPTC:
                             "','",PMSHSCOD,"','",PMSHSRVC,"','006');>&nbsp;";
          REP       "+ ",PMSHFBID
          REP       "+ ",PMSHARID
          REP       "+ ",PMSHFRID
          REP       "+ ",PMSHRPTC
          REP       "+ ",PMSHSCOD
          REP       "+ ",PMSHSRVC
.
          WRITE     HTMLFILE;PMSHFBID,"</td>":
                             "<td>",PMSHARID,"</td>":
                             "<td>",PMSHFRID,"</td>":
                             "<td>",PMSHRPTC,"</td>":
                             "<td>",PMSHSCOD,"</td>":
                             "<td>",PMSHSRVC,"</td>";
.
          REP       " +",PMSHFBID
          REP       " +",PMSHARID
          REP       " +",PMSHFRID
          REP       " +",PMSHRPTC
          REP       " +",PMSHSCOD
          REP       " +",PMSHSRVC
          WRITE     HTMLFILE;"<td><img src='../images/EditIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",PMSHFBID:
                             "','",PMSHARID,"','",PMSHFRID,"','",PMSHRPTC:
                             "','",PMSHSCOD,"','",PMSHSRVC,"','007');>":
                             "</td></tr>"
.
ESDRR999  RETURN
+
.***************************************************************************
.*                             ESDD0000                                    *
.*   Display the service report details received for a claim               *
.***************************************************************************
ESDD0000  CALL      ESDDH000
.
          PACK      KEY59,PMSHFBID,PMSHARID,PMSHFRID,PMSHRPTC:
                          PMSHSCOD,PMSHSRVC,SP70
          CALL      RSPMESD1
ESDD1000  CALL      RKPMESD1
          BRANCH    OVRCD,ESDD9999
.
          MATCH     PMSHFBID,PMSDFBID
          GOTO      ESDD9999 IF NOT EQUAL
.
          MATCH     PMSHARID,PMSDARID
          GOTO      ESDD9999 IF NOT EQUAL
.
          MATCH     PMSHFRID,PMSDFRID
          GOTO      ESDD9999 IF NOT EQUAL
.
          MATCH     PMSHRPTC,PMSDRPTC
          GOTO      ESDD9999 IF NOT EQUAL
.
          MATCH     PMSHSCOD,PMSDSCOD
          GOTO      ESDD9999 IF NOT EQUAL
.
          MATCH     PMSHSRVC,PMSDSRVC
          GOTO      ESDD9999 IF NOT EQUAL
.
          CALL      ESDDR000
.
          GOTO      ESDD1000
.
ESDD9999  RETURN
+
.------------------------------------------------------------
. ESD Assessment Services Details (TABLE HEADING)
.------------------------------------------------------------
ESDDH000  WRITE     HTMLFILE;"<tr>";
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Service<br>Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Service&nbsp;Code<br>Counter</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Explanation Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Explanation<br>Counter</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=50%>":
                             "Explanation Text</td>":
                             "</tr>"
.
ESDDH999  RETURN
.------------------------------------------------------------
. Eclipse Services Details (Detail Row)
.------------------------------------------------------------
ESDDR000  WRITE     HTMLFILE;"<tr><td>",PMSDSCOD,"</td>":
                             "<td>",PMSDSRVC,"</td>":
                             "<td>",PMSDSFEC,"</td>":
                             "<td>",PMSDSEXC,"</td>":
                             "<td>",PMSDSFET,"</td></tr>"
.
ESDDR999  RETURN
+
.--------------------------------------------------------------------------
.*                             SECAR000                                   *
.*               Schedule Eclipse Assessment Report (IBAPMS08)            *
.--------------------------------------------------------------------------
SECAR000  MOVE      "IBAPMS08",SCHDPGID
          MOVE      "Eclipse Assessment Report",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAPMS08",SETDFPRG
          MOVE      "9",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ASSESKEY,KEYSTARR[1]    * key for pmseahaf
          MOVE      ONE,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SECAR999  RETURN
+
.------------------------------------------------------------
. Eclipse Claims Extract
.------------------------------------------------------------
ECLTRN00  MATCH     SP70,UPDTTYPE
          GOTO      ECLTRN80 IF EQUAL
.
          MATCH     "T",UPDTTYPE    * Transaction Request Details Display
          GOTO      ECLTRN10 IF EQUAL
.
          MATCH     "R",UPDTTYPE    * Transaction Request Resend All Errors
          GOTO      ECLTRN20 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Transaction Request Resend Single Error
          GOTO      ECLTRN30 IF EQUAL
.
          GOTO      ECLTRN85
.
ECLTRN10  PACK      KEY51,ECTRSTAT,ECTRTYPE,ECTRLOCN,ECTRCDTE:
                          ECTRCTIM,ECTRTRID,SP70
          CALL      RDPMETR1
          BRANCH    OVRCD,ECLTRN86
.
          GOTO      ECLTRN80
.
ECLTRN20  PACK      KEY51,ANSE,SP70
          CALL      RSPMETR1                     * position in file
          CALL      RKPMETR1                     * read next record
          BRANCH    OVRCD,ECLTRN80               * end of file
.         
          MATCH     ANSE,PMETSTAT                * still error record ?
          GOTO      ECLTRN80 IF NOT EQUAL        * no - exit
.
          MOVE      SP1,PMETSTAT            * reset fields
          MOVE      SP8,PMETUDTE
          MOVE      SP8,PMETUTIM
          MOVE      SP4,PMETEROR
          CALL      UPPMETR1
          GOTO      ECLTRN20
.
ECLTRN30  PACK      KEY51,ECTRSTAT,ECTRTYPE,ECTRLOCN,ECTRCDTE:
                          ECTRCTIM,ECTRTRID,SP70
          CALL      RDPMETR1
          BRANCH    OVRCD,ECLTRN87
.
          MOVE      SP1,PMETSTAT            * reset fields
          MOVE      SP8,PMETUDTE
          MOVE      SP8,PMETUTIM                 
          MOVE      SP4,PMETEROR                 
          CALL      UPPMETR1                * update record
          GOTO      ECLTRN80
.
ECLTRN80  CLEAR     WEBTITLE
          MOVE      "Eclipse Transaction Requests",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ECLTRN99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      ECLTRN99
.
ECLTRN85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLTRN99
.
ECLTRN86  MOVE      "Transaction Request Details not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLTRN99
.
ECLTRN87  MOVE      "Selected record could not be updated.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLTRN99
.
ECLTRN99  RETURN
+
.--------------------------------------------------------------------------
. Option 10 - Eclipse Transaction Request Details tags
.--------------------------------------------------------------------------
ETRD0000  BRANCH    FLDITMNO,ETRD0100,ETRD0200,ETRD0300,ETRD0400,ETRD0500:
                             ETRD0600,ETRD0700,ETRD0800,ETRD0900,ETRD1000:
                             ETRD1100,ETRD1200,ETRD1300,ETRD1400,ETRD1500:
                             ETRD1600,ETRD1700,ETRD1800,ETRD1900
          GOTO      ETRD9999
.
ETRD0100  CALL      ECTRT000
          GOTO      ETRD9999
.
ETRD0200  MOVE      PMETSTAT,DIM1
          REP       " 10213E4",DIM1
          MOVE      DIM1,F1
          MOVE      SP70,REQSTATS
          LOAD      REQSTATS,F1,REQSTS00,REQSTS01,REQSTS02,REQSTS03
          WRITE     HTMLFILE;REQSTATS;
          GOTO      ETRD9999
.
ETRD0300  MOVE      PMETTYPE,FORM2
          MOVE      REQTYP00,REQTYPDS
          LOAD      REQTYPDS,FORM2,REQTYP01,REQTYP02,REQTYP03,REQTYP04,REQTYP05:
                                   REQTYP06,REQTYP07,REQTYP08,REQTYP09,REQTYP10:
                                   REQTYP11,REQTYP12,REQTYP13,REQTYP14,REQTYP15
          WRITE     HTMLFILE;REQTYPDS;
          GOTO      ETRD9999
.
ETRD0400  WRITE     HTMLFILE;PMETTRID;
          GOTO      ETRD9999
.
ETRD0500  PACK      KEY11,SP70
          MATCH     SP70,PMETCDTE
          IF        !@EQUAL
            UNPACK    PMETCDTE,CCENT,CYEAR,CMON,CDAY  * Date Created
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;KEY11;
          GOTO      ETRD9999
.
ETRD0600  WRITE     HTMLFILE;PMETCTIM;
          GOTO      ETRD9999
.
ETRD0700  WRITE     HTMLFILE;PMETBATN;
          GOTO      ETRD9999
.
ETRD0800  WRITE     HTMLFILE;PMETINVN;
          GOTO      ETRD9999
.
ETRD0900  PACK      KEY11,SP70
          MATCH     SP70,PMETUDTE
          IF        !@EQUAL
            UNPACK    PMETUDTE,CCENT,CYEAR,CMON,CDAY  * Date Updated
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;KEY11;
          GOTO      ETRD9999
.
ETRD1000  WRITE     HTMLFILE;PMETUTIM;
          GOTO      ETRD9999
.
ETRD1100  WRITE     HTMLFILE;PMETLOCN;
          GOTO      ETRD9999
.
ETRD1200  WRITE     HTMLFILE;PMETSNID;
          GOTO      ETRD9999
.
ETRD1300  UNPACK    PMETFDTM,DIM8,DIM6
          PACK      KEY20,SP70
          MATCH     SP70,DIM8
          IF        !@EQUAL
            UNPACK    DIM8,CCENT,CYEAR,CMON,CDAY  * From Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            MOVE      SP8,KEY8
            MATCH     SP6,DIM6
            IF        !@EQUAL
              UNPACK    DIM6,DISPHOUR,DISPMIN,DISPSEC
              PACK      KEY8,DISPHOUR,COLON,DISPMIN,COLON,DISPSEC
              REP       " 0",KEY8
            ENDIF
            PACK      KEY20,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,KEY8
          ENDIF
          WRITE     HTMLFILE;KEY20;
          GOTO      ETRD9999
.
ETRD1400  UNPACK    PMETTDTM,DIM8,DIM6
          PACK      KEY20,SP70
          MATCH     SP70,DIM8
          IF        !@EQUAL
            UNPACK    DIM8,CCENT,CYEAR,CMON,CDAY  * From Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            MOVE      SP8,KEY8
            MATCH     SP6,DIM6
            IF        !@EQUAL
              UNPACK    DIM6,DISPHOUR,DISPMIN,DISPSEC
              PACK      KEY8,DISPHOUR,COLON,DISPMIN,COLON,DISPSEC
              REP       " 0",KEY8
            ENDIF
            PACK      KEY20,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,KEY8
          ENDIF
          WRITE     HTMLFILE;KEY20;
          GOTO      ETRD9999
.
ETRD1500  WRITE     HTMLFILE;PMETEROR;
          GOTO      ETRD9999
.
ETRD1600  CALL      PREVEC00        * Show Prev group of records
          GOTO      ETRD9999
.
ETRD1700  CALL      NEXTEC00        * Show Next group of records
          GOTO      ETRD9999
.
ETRD1800  WRITE     HTMLFILE;FILTTYPE;      * request type filter
          GOTO      ETRD9999
.
ETRD1900  WRITE     HTMLFILE;FILTSTAT;      * status filter
          GOTO      ETRD9999
.
ETRD9999  RETURN
+
.------------------------------------------------------------
. Table of all Eclipse Transaction Requests (pmsetraf)
.------------------------------------------------------------
ECTRT000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      ONE,SHOWFLAG
.
          CALL      ECTRH000                * output heading
.
          IF        NORECORD=0
            MOVE      "20",NORECORD         * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      FILTSTAT,D1
          REP       " E0 10213E",D1
.
          PACK      KEY51,D1,Z70
          CALL      RSPMETR3
ECTRT100  CALL      RPPMETR3                * read next record
          BRANCH    OVRCD,ECTRT900          * end of file
.
          MATCH     D1,PMETSTAT
          GOTO      ECTRT900 IF NOT EQUAL   * filter by status
.
ECTRT200  MATCH     SP70,FILTTYPE
          GOTO      ECTRT300 IF EQUAL       * all selected
.
          MATCH     FILTTYPE,PMETTYPE       * filter by type
          GOTO      ECTRT100 IF NOT EQUAL
.
ECTRT300  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ECTRT100              * If < than strt Rec then Read Next
          ENDIF
.
          CALL      ECTRW000                * Output Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ECTRT100 IF NOT EQUAL
          MOVE      ZERO,SHOWFLAG
.
ECTRT900  CALL      NOMREC00                * Show no more records message
.
ECTRT999  RETURN
+
.------------------------------------------------------------
. Eclipse Transaction Requests (TABLE HEADING)
.------------------------------------------------------------
ECTRH000  WRITE     HTMLFILE;"<tr>";
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Type Of Request</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Transaction ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Error Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Location ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Date Created</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Time Created</td>":
                             "</tr>"
.
ECTRH999  RETURN
+
.------------------------------------------------------------
. Display Eclipse Transaction Requests (TABLE ROW)
.------------------------------------------------------------
ECTRW000  IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          REP       " +",PMETSTAT
          REP       " +",PMETTYPE
          REP       " +",PMETLOCN
          REP       " +",PMETCDTE
          REP       " +",PMETCTIM
          REP       " +",PMETTRID
          WRITE     HTMLFILE;"<img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displayTrans('",PMETSTAT:
                             "','",PMETTYPE,"','",PMETLOCN,"','",PMETCDTE:
                             "','",PMETCTIM,"','",PMETTRID,"');>&nbsp;";
          REP       "+ ",PMETSTAT
          REP       "+ ",PMETTYPE
          REP       "+ ",PMETLOCN
          REP       "+ ",PMETCDTE
          REP       "+ ",PMETCTIM
          REP       "+ ",PMETTRID
.         
          PACK      KEY11,SP70
          MATCH     SP70,PMETCDTE
          IF        !@EQUAL
            UNPACK    PMETCDTE,CCENT,CYEAR,CMON,CDAY  * Date Created
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      PMETTYPE,FORM2
          MOVE      REQTYP00,REQTYPDS
          LOAD      REQTYPDS,FORM2,REQTYP01,REQTYP02,REQTYP03,REQTYP04,REQTYP05:
                                   REQTYP06,REQTYP07,REQTYP08,REQTYP09,REQTYP10:
                                   REQTYP11,REQTYP12,REQTYP13,REQTYP14,REQTYP15
.
          WRITE     HTMLFILE;REQTYPDS,"&nbsp;</td>":
                             "<td>",PMETTRID,"&nbsp;</td>";
.
          MATCH     SP70,PMETEROR
          IF        @EQUAL
            WRITE     HTMLFILE;"<td>",PMETEROR,"&nbsp;</td>";
          ELSE
            WRITE     HTMLFILE;"<td>",PMETEROR,"&nbsp;&nbsp;";
            REP       " +",PMETSTAT
            REP       " +",PMETTYPE
            REP       " +",PMETLOCN
            REP       " +",PMETCDTE
            REP       " +",PMETCTIM
            REP       " +",PMETTRID
            WRITE     HTMLFILE;"<img src='../images/MoveIcon.gif'":
                             " class=ListIcon onclick=ResendError('",PMETSTAT:
                             "','",PMETTYPE,"','",PMETLOCN,"','",PMETCDTE:
                             "','",PMETCTIM,"','",PMETTRID,"');>&nbsp;";
            REP       "+ ",PMETSTAT
            REP       "+ ",PMETTYPE
            REP       "+ ",PMETLOCN
            REP       "+ ",PMETCDTE
            REP       "+ ",PMETCTIM
            REP       "+ ",PMETTRID
          ENDIF
.
          WRITE     HTMLFILE;"<td>",PMETLOCN,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",PMETCTIM,"&nbsp;</td></tr>"
.
          GOTO      ECTRW999
.
ECTRW999  RETURN
+
.------------------------------------------------------------
. Eclipse IMC Claims Extract
.------------------------------------------------------------
MCLEXT00  MATCH     "1",PTCNUIMC
          GOTO      MCLEXT91 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      MCLEXT80 IF EQUAL
.
          MATCH     "H",UPDTTYPE    * List Claims by Health Fund
          GOTO      MCLEXT10 IF EQUAL
.
          MATCH     "M",UPDTTYPE    * List Claims by Medicare 
          GOTO      MCLEXT20 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Extract Claims
          GOTO      MCLEXT30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Claims
          GOTO      MCLEXT40 IF EQUAL
.
          GOTO      MCLEXT85
.
MCLEXT10  MATCH     SP70,HFUNDTYP                * no code chosen yet
          GOTO      MCLEXT80 IF EQUAL
.
          PACK      KEY14,HFUNDTYP,ZERO4,SP70
          CALL      RDFUND1                      * HF on file ?
          BRANCH    OVRCD,MCLEXT93
.
          MOVE      HFUNDTYP,KEY6
          CALL      RDPTFX11                     * hfund extension record?
          BRANCH    OVRCD,MCLEXT93
.
          COMPARE   THREE,PTFXEXTR               * using Eclipse ?
          GOTO      MCLEXT94 IF NOT EQUAL
.
          MOVE      SP70,ECLKEY3
          MATCH     SP70,PTFXECLP
          IF        @EQUAL | @EOS
            MATCH     SP3,PTHFHGRP                 * blank health fund group ?
            GOTO      MCLEXT95 IF EQUAL
            MOVE      PTHFHGRP,ECLKEY3
          ELSE
            MOVE      PTFXECLP,ECLKEY3
          ENDIF
.
          MOVE      ECLKEY3,KEY3
          CALL      RDPTPAR1                     * participant code on file ?
          BRANCH    OVRCD,MCLEXT95
.
          MOVE      ECLKEY3,KEY3
          PACK      KEY9,KEY3,ANSI,ANSM,ANSC,SP70
          CALL      RSPTPCP1                     * IMC capability ?
          CALL      RKPTPCP1
          BRANCH    OVRCD,MCLEXT87
.
          MATCH     KEY3,PTPPCODE
          GOTO      MCLEXT87 IF NOT EQUAL
.
          MATCH     "IMC",PTPPCPID
          GOTO      MCLEXT87 IF NOT EQUAL
.
          CALL      MERR0000                     * reset any error records
          GOTO      MCLEXT80
.
MCLEXT20  
.         MATCH     SP70,HFUNDTYP                * no code chosen yet
.         GOTO      MCLEXT80 IF EQUAL
.
.         MATCH     SP6,CVETINS                  * insurance code for DVA?
.         GOTO      MCLEXT97 IF EQUAL
.
.         PACK      KEY6,CVETINS,SP6
.         CALL      RDINSR1                      * insurance company on file ?
.         BRANCH    OVRCD,MCLEXT90
.
.         MOVE      CVETINS,KEY3
.         CALL      RDPTPAR1                     * participant code on file ?
.         BRANCH    OVRCD,MCLEXT95
.
.         MOVE      CVETINS,KEY3
.         PACK      KEY9,KEY3,ANSI,ANSH,ANSC,SP3
.         CALL      RDPTPCP1                     * IHC capability ?
.         BRANCH    OVRCD,MCLEXT87
.
.         PACK      KEY5,ANSC,ANSL,HFUNDTYP,SP5
.         CALL      RDCODE1
.         BRANCH    OVRCD,MCLEXT98
.
.         MOVE      ZERO,FORM1
.         WHILE     FORM1 < 5
.           ADD       ONE,FORM1
.           LOAD      ANS,FORM1,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
.           MATCH     ANSV,ANS                   * DVA code ?
.           GOTO      MCLEXT25 IF EQUAL          * yes
.         DO
.
.         GOTO      MCLEXT98
.
MCLEXT25  CALL      MERR0000                     * reset any error records
          GOTO      MCLEXT80
.
MCLEXT30  COMPARE   ZERO,LASTDCLM
          GOTO      MCLEXT35 IF EQUAL            * any claims to delete first ?
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,DECLMARR[COUNT]
            IF        !@EQUAL
              CALL      MDEL0000                 * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      MCLEXT35 IF EQUAL
.
          CALL      ERRLST00                     * display any delete errors
.>>>>     MOVE      ONE,EXIT
.>>>>     GOTO      MCLEXT99
.
MCLEXT35  MATCH     "1",PTCNUIMC                 * using edi module?
          GOTO      MCLEXT91 IF NOT EQUAL
.
          MATCH     SP70,PTCNIMCO                * eclipse outbound path set?
          GOTO      MCLEXT92 IF EQUAL
.
          COMPARE   ZERO,LASTECLM
          GOTO      MCLEXT86 IF EQUAL            * no claims to extract
.
          CALL      SMCLX000                     * Extract Eclipse Claims
.
          MOVE      ZERO,EXIT
          GOTO      MCLEXT99
.
.   ************ DELETE CLAIM FUNCTION ************
.>>>>
MCLEXT40  COMPARE   ZERO,LASTDCLM
          GOTO      MCLEXT86 IF EQUAL            * no claims to delete
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,DECLMARR[COUNT]
            IF        !@EQUAL
              CALL      MDEL0000   * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      MCLEXT99 IF EQUAL
.
          CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT80  CLEAR     WEBTITLE
          MOVE      "Eclipse IMC Claims Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,MCLEXT99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT86  MOVE      "No claims selected to extract.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT87  MOVE      "Participant cannot accept IMCs.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT90  MOVE      "Insurance code not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT91  MOVE      "Hospital not using the EDI Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT92  MOVE      "Eclipse IMC Outbound Path blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT93  MOVE      "Health Fund or extension record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT94  MOVE      "Health Fund not using Eclipse.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT95  MOVE      "Participant code blank or not on file.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT97  MOVE      "Insurance code for DVA is blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT98  MOVE      "Claim code not DVA related.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MCLEXT99
.
MCLEXT99  RETURN
+
.*****************************************************************************
.*                               MDEL0000                                    *
.*               Delete selected Eclipse IMC Claim records                   *
.*****************************************************************************
MDEL0000  MOVE      DECLMARR[COUNT],KEY8    * invoice number
          PACK      KEY16,KEY8,SP70         * batch number is blank
          CALL      RDPRECT2
          BRANCH    OVRCD,MDEL8000
.
          MOVE      PRECINVN,TEMPINVN
          MOVE      PRECBATN,TEMPBATN
          MOVE      PRECUNIQ,TEMPADMN
          MOVE      PRECURNO,TEMPURNO
          MOVE      PRECHFND,TEMPHFND
          MOVE      PRECPBAT,TEMPPBAT
          MOVE      PRECHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      MDEL1000 IF EQUAL
          GOTO      MDEL1000 IF EOS
.
          PACK      KEY35,TEMPHOSP,TEN5,TEMPHFND,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDPRECT1
          IF        OVRCD = 1
            GOTO      MDEL7000
          ELSE
            MOVE      SP70,PRECNBAT
            CALL      UPPRECT1
          ENDIF
.
.         Delete the selected record
.
MDEL1000  PACK      KEY35,TEMPHOSP,SP1,ZERO,TEMPHFND,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEPRECT1
.
          GOTO      MDEL9999
.
MDEL7000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      MDEL9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Error updating previous claim - ",ERRORLST[ERRORCNT]
          APPEND    PRECINVN,ERRORLST[ERRORCNT]
          APPEND    "  Batch - ",ERRORLST[ERRORCNT]
          APPEND    PRECBATN,ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      MDEL9999
.
MDEL8000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      MDEL9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Record cannot be deleted.  ",ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      MDEL9999

MDEL9999  RETURN
+
.--------------------------------------------------------------------------
.*                             SMCLX000                                   *
.*               Schedule Eclipse Extract (IBAPRI07)                      *
.--------------------------------------------------------------------------
SMCLX000  MOVE      "IBAPRI07",SCHDPGID
          MOVE      "Eclipse IMC Claims Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAPRI07",SETDFPRG
          MOVE      "11",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ONE,COUNT
          MOVE      HOSPCODE,KEYSTARR[COUNT]    * hospital id
          ADD       ONE,COUNT
          MOVE      OPTNFLAG,KEYSTARR[COUNT]    * extract by fund(1)/medicare(2)
.
          COMPARE   TWO,OPTNFLAG
          GOTO      MECLX500 IF EQUAL
.
.          MATCH     "1",FILTOPTN
.          IF        @EQUAL
.            MOVE      THREE,KEYSTARR[COUNT]      * Replace OPTNFLAG with zero
.            GOTO      MECLX500                  * All extract types are selected
.         ENDIF
.
          ADD       ONE,COUNT
          MOVE      HFUNDTYP,KEYSTARR[COUNT]    * health fund
.
          MOVE      THREE,TOTALCNT              * first 3 keyins
          GOTO      MECLX600
.
MECLX500  MOVE      TWO,TOTALCNT
.
MECLX600  ADD      ONE,COUNT
          MOVE     ONE,COUNTEC
          WHILE     COUNTEC <= LASTECLM
            MATCH     SP90,ECCLMARR[COUNTEC]
            IF        !@EQUAL
              MOVE      ECCLMARR[COUNTEC],KEYSTARR[COUNT]    * to be extracted
            ENDIF
            ADD      ONE,COUNT
            ADD      ONE,COUNTEC
          DO
.
          ADD       LASTECLM,TOTALCNT            * eclipse claims keyins
.
          PACK      KEYSTARR[COUNT],SP70         * blank record to signal exit
          ADD       ONE,COUNT
          ADD       ONE,TOTALCNT
.
          MOVE      ANSP,KEYSTARR[COUNT]         * (P)ost
.>>>>
.>>>>     ADD       ONE,COUNT
.>>>>     MOVE      ANSY,KEYSTARR[COUNT]         * (Y) to extract (if ok)
.>>>>
          ADD       ONE,COUNT
          MOVE      SP70,KEYSTARR[COUNT]         * (Enter) to exit
          ADD       ONE,COUNT
          MOVE      "\",KEYSTARR[COUNT]          * (\) to exit
.
          ADD       THREE,TOTALCNT               * add last 3 keyins (if error)
.>>>>     ADD       FOUR,TOTALCNT                * add last 4 keyins (if ok)
          MOVE      TOTALCNT,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SMCLX999  RETURN
+
.*****************************************************************************
.*                              MERR0000           Called by: MCLEXT00       *
.*             Reset error records back to zero status (Not Sent)            *
.*             just in case there were any problems with a previous          *
.*             batch and the error records were not set back to zero.        *
.*****************************************************************************
.
MERR0000  MOVE      HOSPCODE,SAVEHOSP            * initialise hospital
          MOVE      ZERO,FIRSTFLG                * initialise flag
.
          PACK      KEY35,HOSPCODE,SP1,ONE,HFUNDTYP,SP30,SP10
MERR0500  CALL      RSPRECT1                     * position in file
          CALL      RKPRECT1                     * read next record
          BRANCH    OVRCD,MERR9999               * eof - finished
.
          IF        FIRSTFLG = 0
            MATCH     SP3,HOSPCODE               * all hospitals extract ?
            IF        @EQUAL
              MOVE      PRECHOSP,SAVEHOSP        * yes-load first hospital code
            ENDIF
            MOVE      ONE,FIRSTFLG               * set first flag to no
          ENDIF
.
          MATCH     SP3,HOSPCODE                 * all hospitals extract ?
          GOTO      MERR5000 IF NOT EQUAL        * no
.
.         We are running an extract for all hospitals
.
          MATCH     SAVEHOSP,PRECHOSP            * same hospital still ?
          IF        !@EQUAL
            MOVE      PRECHOSP,SAVEHOSP          * no - save new hospital code
            PACK      KEY35,PRECHOSP,SP1,ONE,HFUNDTYP,SP30,SP10
            GOTO      MERR0500
          ENDIF
.
          COMPARE   ONE,PRECFLAG                 * error record still ?
          GOTO      MERR4000 IF NOT EQUAL        * no - get next hospital
.
          MATCH     HFUNDTYP,PRECHFND            * same health fund still ?
          GOTO      MERR4000 IF NOT EQUAL        * no - finished
.
          GOTO      MERR8000
.
MERR4000  PACK      KEY35,PRECHOSP,Z70
          GOTO      MERR0500
.
.         We are running an extract for a given hospital id
.
MERR5000  MATCH     HOSPCODE,PRECHOSP            * same hospital still ?
          GOTO      MERR9999 IF NOT EQUAL        * no - finished
.
          COMPARE   ONE,PRECFLAG                 * error record still ?
          GOTO      MERR9999 IF NOT EQUAL        * no - finished
.
          MATCH     HFUNDTYP,PRECHFND            * same health fund still ?
          GOTO      MERR9999 IF NOT EQUAL        * no - finished
.
.         Reset the record status to "Waiting"
.
MERR8000  PACK      SAVKEY35,PRECHOSP,PRECFLAG,PRECHFND,PRECUNIQ,PRECINVN:
                             PRECBATN
          MOVE      ZERO,PRECFLAG                * yes - reset flag to "0"
          CALL      UPPRECT1                     * update record
          MOVE      SAVKEY35,KEY35               * load key to reposition
          GOTO      MERR0500                     * get next record
.
MERR9999  RETURN
+
.--------------------------------------------------------------------------
. Option 11 - Eclipse IMC Claims Extract tags
.--------------------------------------------------------------------------
MEXT0000  BRANCH    FLDITMNO,MEXT0100,MEXT0200,MEXT0300,MEXT0400,MEXT0500:
                             MEXT0600,MEXT0700,MEXT0800,MEXT0900
          GOTO      MEXT9999
.
MEXT0100  MOVE      ONE,ALLHFLAG          * default to 'All'
          CALL      HOSPID00              * display Multi-hosp. selection list
          GOTO      MEXT9999
.
MEXT0200  CALL      ECSHN000              * selected Hospital Desc (Multi-hosp)
          GOTO      MEXT9999
.
MEXT0300  
.         MOVE      "CL",CATEGORY         * Compensation code/Claim Type
.         MOVE      HFUNDTYP,CODE
.         CALL      CODITM00
          GOTO      MEXT9999
.
MEXT0400  CALL      MCWFX000              * Claims Waiting for Extraction
          GOTO      MEXT9999
.
MEXT0500  MATCH     SP70,UPDTTYPE
          GOTO      MEXT9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI
          GOTO      MEXT9999
.
MEXT0600 
.         WRITE     HTMLFILE;CLAMTYPE;    * Claim type CGI
          GOTO      MEXT9999
.
MEXT0700  MATCH     SP70,HFUNDTYP
          GOTO      MEXT9999 IF EQUAL
          WRITE     HTMLFILE;HFUNDTYP;    * Health Fund CGI
          GOTO      MEXT9999
.
MEXT0800  WRITE     HTMLFILE;HFUNDESC;    * Health Fund Desc CGI
          GOTO      MEXT9999
.
MEXT0900  MOVE      USERID,KEY10
          CALL      RDPRALS1
          BRANCH    OVRCD,MEXT0910
          MOVE      FILTPRAC,PRACTICE
          CALL      MPRSEL00
          GOTO      MEXT9999
.
MEXT0910  MOVE      USERID,KEY16
          CALL      RSPRSEC2
MEXT0915  CALL      RKPRSEC2
          BRANCH    OVRCD,MEXT9999
.
          MATCH     USERID,PRSEUSID
          GOTO      MEXT9999 IF NOT EQUAL
.
          MOVE      PRSEPRAC,KEY6
          CALL      RDPRPR1
          IF        OVRCD=1
            MOVE      "Unknown Practice",PRPRDESC
          ENDIF
.
          MOVE      FILTPRAC,DIM6
          MATCH     DIM6,PRPRCODE    * Default Medical Prac
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#" selected>":
                                 "(",PRPRCODE,") ",PRPRDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#">":
                                 "(",PRPRCODE,") ",PRPRDESC,"</option>"
          ENDIF
.
          GOTO      MEXT0915
.
MEXT9999  RETURN
+
.------------------------------------------------------------
. Table of all Eclipse IMC Claims Waiting For Extraction
.------------------------------------------------------------
MCWFX000  MATCH     "1",PTCNUIMC
          GOTO      MCWFX999 IF NOT EQUAL
.
          MOVE      ZERO,FORM3
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.          MATCH     "1",FILTOPTN
.          IF        !@EQUAL
.            MATCH     HFUNDTYP,SP70           * cannot have blank code
.            GOTO      MCWFX900 IF EQUAL
.          ENDIF
.
          PACK      KEY35,HOSPCODE,SP1,ZERO,SP70
MCWFX040  CALL      RSPRECT1
MCWFX050  CALL      RKPRECT1                * read next record
          BRANCH    OVRCD,MCWFX900          * end of file
.
          MATCH     SP3,HOSPCODE                 * all hospitals ?
          IF        !@EQUAL
            MATCH     HOSPCODE,PRECHOSP          * no - same hospital still ?
            GOTO      MCWFX900 IF NOT EQUAL      * no - finished
          ENDIF
.
          COMPARE   ZERO,PRECFLAG                * waiting for extract still ?
          IF        !@EQUAL
            PACK      KEY35,PRECHOSP,Z70
            GOTO      MCWFX040                   * get next record
          ENDIF
.
          MATCH     SP70,FILTPRAC
          IF        !@EQUAL & !@EOS
            PACK      FILTPRAC,FILTPRAC,SP70
            MATCH     FILTPRAC,PRECPRAC
            GOTO      MCWFX050 IF NOT EQUAL
          ENDIF
.
.          MATCH     "1",FILTOPTN
.          GOTO      MCWFX200 IF EQUAL
.           
.         Processing by Health Fund (option 1) or medicare (option 2)
.
          IF        OPTNFLAG = 1
            MATCH     HFUNDTYP,PRECHFND          * same health fund ?
            GOTO      MCWFX050 IF NOT EQUAL      * no - ignore record
.
            MATCH     SP70,PRECEETP         
            GOTO      MCWFX050 IF EQUAL     
.
            MATCH     "2",PRECEETP
            GOTO      MCWFX050 IF EQUAL
.
            GOTO      MCWFX200             
          ENDIF
.
.         Processing by medicare option
.
MCWFX100  MATCH     "2",PRECEETP                 * medicare only?
          GOTO      MCWFX050 IF NOT EQUAL        * no - ignore record
.
.         A waiting record for the health fund/medicare has been found,
.         so get the invoice details and calculate the amount outstanding.
.
MCWFX200  CALL      MCLRW000      * Output Row
          IF        DISNUMB>=50
            GOTO      MCWFX800
          ENDIF
          GOTO      MCWFX050
.
MCWFX800  CALL      LIMREC00        * Show batch limit reached message
          GOTO      MCWFX999
.
MCWFX900  CALL      TOTREC00        * Show no more records message
.
MCWFX999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse IMC (TABLE ROW)
.------------------------------------------------------------
MCLRW000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,PRECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP8,PRINDATE
          ELSE
            IF        PRINUNIQ = 0 
              GOTO      MCLRW900                 * delete claim
            ENDIF
            ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM12P2
            IF        IBCNUGST=2
              ADD       PRINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PRINDATE
          IF        !@EQUAL
            UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;PRECUNIQ,"&nbsp;</td>":
                             "<td>",PRECINVN,"&nbsp;</td>":
                             "<td>",PRECURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",PRECHOSP,PRECUNIQ,PRECINVN:
                                        PRECURNO,PRINDATE,KEY15:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=declm",KEY3:
                             " value='",PRECINVN:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      MCLRW999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in pmsectaf
.
MCLRW900  PACK      SAVKEY35,PRECHOSP,PRECFLAG,PRECHFND,PRECUNIQ,PRECINVN:
                             PRECBATN
          MOVE      SAVKEY35,KEY35
          CALL      DEPRECT1                 * delete cancelled/zero invoices
          MOVE      SAVKEY35,KEY35
          CALL      RSPRECT1
.
MCLRW999  RETURN
+
.------------------------------------------------------------
. Eclipse IMC Assessing Report Enquiry
.------------------------------------------------------------
ECLPRM00  MATCH     "1",PTCNUIMC
          GOTO      ECLPRM88 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      ECLPRM80 IF EQUAL
.
          MATCH     "H",UPDTTYPE    * Assessment Report Header
          GOTO      ECLPRM10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Assessment Report Details
          GOTO      ECLPRM20 IF EQUAL
.
          MATCH     "S",UPDTTYPE    * Assessment Report Services Header
          GOTO      ECLPRM30 IF EQUAL
.
          MATCH     "P",UPDTTYPE    * Print Assessment Report
          GOTO      ECLPRM40 IF EQUAL
.
          GOTO      ECLPRM85
.
ECLPRM10  PACK      KEY32,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,SP70
          CALL      RDPREAH1
          IF        OVRCD=1
.
            PACK      KEY32,ECPRPTCD,SP70
            CALL      RSPREAH1
ECLPRM15    CALL      RKPREAH1
            BRANCH    OVRCD,ECLPRM86
.
            PACK      ECPRPTCD,ECPRPTCD,SP70
            CMATCH    NULL,PRAHFBID
            IF        @EQUAL
              MOVE      SP70,PRAHFBID
            ENDIF
            PACK      PRAHFBID,PRAHFBID,SP70
            MATCH     ECPRPTCD,PRAHFBID
            GOTO      ECLPRM86 IF NOT EQUAL
.
            PACK      ECPRINVN,ECPRINVN,SP70
            CMATCH    NULL,PRAHARID
            IF        @EQUAL
              MOVE      SP70,PRAHARID
            ENDIF
            PACK      PRAHARID,PRAHARID,SP70
            MATCH     ECPRINVN,PRAHARID
            GOTO      ECLPRM15 IF NOT EQUAL
.
            PACK      ECPRCLID,ECPRCLID,SP70
            CMATCH    NULL,PRAHCLID
            IF        @EQUAL
              MOVE      SP70,PRAHCLID
            ENDIF
            PACK      PRAHCLID,PRAHCLID,SP70
            MATCH     ECPRCLID,PRAHCLID
            GOTO      ECLPRM15 IF NOT EQUAL
.
            PACK      ECPRREPT,ECPRREPT,SP70
            CMATCH    NULL,PRAHRPTC
            IF        @EQUAL
              MOVE      SP70,PRAHRPTC
            ENDIF
            PACK      PRAHRPTC,PRAHRPTC,SP70
            MATCH     ECPRREPT,PRAHRPTC
            GOTO      ECLPRM15 IF NOT EQUAL
.
          ENDIF
.
          GOTO      ECLPRM80
.
ECLPRM20  PACK      KEY32,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,SP70
          CALL      RDPREAH1
          IF        OVRCD=1
.
            PACK      KEY32,ECPRPTCD,SP70
            CALL      RSPREAH1
ECLPRM25    CALL      RKPREAH1
            BRANCH    OVRCD,ECLPRM86
.
            PACK      ECPRPTCD,ECPRPTCD,SP70
            CMATCH    NULL,PRAHFBID
            IF        @EQUAL
              MOVE      SP70,PRAHFBID
            ENDIF
            PACK      PRAHFBID,PRAHFBID,SP70
            MATCH     ECPRPTCD,PRAHFBID
            GOTO      ECLPRM86 IF NOT EQUAL
.
            PACK      ECPRINVN,ECPRINVN,SP70
            CMATCH    NULL,PRAHARID
            IF        @EQUAL
              MOVE      SP70,PRAHARID
            ENDIF
            PACK      PRAHARID,PRAHARID,SP70
            MATCH     ECPRINVN,PRAHARID
            GOTO      ECLPRM25 IF NOT EQUAL
.
            PACK      ECPRCLID,ECPRCLID,SP70
            CMATCH    NULL,PRAHCLID
            IF        @EQUAL
              MOVE      SP70,PRAHCLID
            ENDIF
            PACK      PRAHCLID,PRAHCLID,SP70
            MATCH     ECPRCLID,PRAHCLID
            GOTO      ECLPRM25 IF NOT EQUAL
.
            PACK      ECPRREPT,ECPRREPT,SP70
            CMATCH    NULL,PRAHRPTC
            IF        @EQUAL
              MOVE      SP70,PRAHRPTC
            ENDIF
            PACK      PRAHRPTC,PRAHRPTC,SP70
            MATCH     ECPRREPT,PRAHRPTC
            GOTO      ECLPRM25 IF NOT EQUAL
.
          ENDIF
.
          PACK      KEY39,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT:
                          ECPRCFEC,ECPREXPC,SP70
          CALL      RDPREAD1
          IF        OVRCD=1
.
            PACK      KEY39,ECPRPTCD,SP70
            CALL      RSPREAD1
ECLPRM27    CALL      RKPREAD1
            BRANCH    OVRCD,ECLPRM87
.
            PACK      ECPRPTCD,ECPRPTCD,SP70
            CMATCH    NULL,PREDFBID
            IF        @EQUAL
              MOVE      SP70,PREDFBID
            ENDIF
            PACK      PREDFBID,PREDFBID,SP70
            MATCH     ECPRPTCD,PREDFBID
            GOTO      ECLPRM87 IF NOT EQUAL
.
            PACK      ECPRINVN,ECPRINVN,SP70
            CMATCH    NULL,PREDARID
            IF        @EQUAL
              MOVE      SP70,PREDARID
            ENDIF
            PACK      PREDARID,PREDARID,SP70
            MATCH     ECPRINVN,PREDARID
            GOTO      ECLPRM27 IF NOT EQUAL
.
            PACK      ECPRCLID,ECPRCLID,SP70
            CMATCH    NULL,PREDCLID
            IF        @EQUAL
              MOVE      SP70,PREDCLID
            ENDIF
            PACK      PREDCLID,PREDCLID,SP70
            MATCH     ECPRCLID,PREDCLID
            GOTO      ECLPRM27 IF NOT EQUAL
.
            PACK      ECPRREPT,ECPRREPT,SP70
            CMATCH    NULL,PREDRPTC
            IF        @EQUAL
              MOVE      SP70,PREDRPTC
            ENDIF
            PACK      PREDRPTC,PREDRPTC,SP70
            MATCH     ECPRREPT,PREDRPTC
            GOTO      ECLPRM27 IF NOT EQUAL
.
            PACK      ECPRCFEC,ECPRCFEC,SP70
            CMATCH    NULL,PREDCFEC
            IF        @EQUAL
              MOVE      SP70,PREDCFEC
            ENDIF
            PACK      PREDCFEC,PREDCFEC,SP70
            MATCH     ECPRCFEC,PREDCFEC
            GOTO      ECLPRM27 IF NOT EQUAL
.
            PACK      ECPREXPC,ECPREXPC,SP70
            CMATCH    NULL,PREDEXPC
            IF        @EQUAL
              MOVE      SP70,PREDEXPC
            ENDIF
            PACK      PREDEXPC,PREDEXPC,SP70
            MATCH     ECPREXPC,PREDEXPC
            GOTO      ECLPRM27 IF NOT EQUAL
.
          ENDIF
.
          GOTO      ECLPRM80
.
ECLPRM30
.          PACK      KEY40,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT:
.                          ECPRITMN,ECPRSRVC,SP70
.          CALL      RDPRESH1
.          IF        OVRCD=1
.
            PACK      KEY40,ECPRPTCD,SP70
            CALL      RSPRESH1
ECLPRM35    CALL      RKPRESH1
            BRANCH    OVRCD,ECLPRM86
.
            PACK      ECPRPTCD,ECPRPTCD,SP70
            CMATCH    NULL,PRSHFBID
            IF        @EQUAL
              MOVE      SP70,PRSHFBID
            ENDIF
            PACK      PRSHFBID,PRSHFBID,SP70
            MATCH     ECPRPTCD,PRSHFBID
            GOTO      ECLPRM86 IF NOT EQUAL
.
            PACK      ECPRINVN,ECPRINVN,SP70
            CMATCH    NULL,PRSHARID
            IF        @EQUAL
              MOVE      SP70,PRSHARID
            ENDIF
            PACK      PRSHARID,PRSHARID,SP70
            MATCH     ECPRINVN,PRSHARID
            GOTO      ECLPRM35 IF NOT EQUAL
.
            PACK      ECPRCLID,ECPRCLID,SP70
            CMATCH    NULL,PRSHCLID
            IF        @EQUAL
              MOVE      SP70,PRSHCLID
            ENDIF
            PACK      PRSHCLID,PRSHCLID,SP70
            MATCH     ECPRCLID,PRSHCLID
            GOTO      ECLPRM35 IF NOT EQUAL
.
            PACK      ECPRREPT,ECPRREPT,SP70
            CMATCH    NULL,PRSHRPTC
            IF        @EQUAL
              MOVE      SP70,PRSHRPTC
            ENDIF
            PACK      PRSHRPTC,PRSHRPTC,SP70
            MATCH     ECPRREPT,PRSHRPTC
            GOTO      ECLPRM35 IF NOT EQUAL
.
            PACK      ECPRITMN,ECPRITMN,SP70
            CMATCH    NULL,PRSHITMN
            IF        @EQUAL
              MOVE      SP70,PRSHITMN
            ENDIF
            PACK      PRSHITMN,PRSHITMN,SP70
            MATCH     ECPRSCOD,PRSHITMN
            GOTO      ECLPRM35 IF NOT EQUAL
.
            PACK      ECPRSRVC,ECPRSRVC,SP70
            CMATCH    NULL,PRSHSRVC
            IF        @EQUAL
              MOVE      SP70,PRSHSRVC
            ENDIF
            PACK      PRSHSRVC,PRSHSRVC,SP70
            MATCH     ECPRSRVC,PRSHSRVC
            GOTO      ECLPRM35 IF NOT EQUAL
.
.          ENDIF
.
          GOTO      ECLPRM80
.
ECLPRM40  CALL      SEMAR000      * Schedule print Assessment Report
.
          MOVE      ZERO,EXIT
          GOTO      ECLPRM99
.
ECLPRM80  CLEAR     WEBTITLE
          MOVE      "Eclipse Assessing Report Enquiry",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ECLPRM99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      ECLPRM99
.
ECLPRM85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLPRM99
.
ECLPRM86  MOVE      "Assessment Report Header not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLPRM99
.
ECLPRM87  MOVE      "Assessment Report Details not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLPRM99
.
ECLPRM88  MOVE      "Not using Eclipse IMC Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLPRM99
.
ECLPRM99  RETURN
+
.--------------------------------------------------------------------------
.*                             SEMAR000                                   *
.*               Schedule IMC Eclipse Assessment Report (IBAPRI09)        *
.--------------------------------------------------------------------------
SEMAR000  MOVE      "IBAPRI09",SCHDPGID
          MOVE      "Eclipse IMC Assessment Report",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAPRI09",SETDFPRG
          MOVE      "9",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ASSESKEY,KEYSTARR[1]    * key for prieahaf
          MOVE      ONE,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SEMAR999  RETURN
+
.--------------------------------------------------------------------------
. Option 12 - Eclipse IMC Assessing Report Enquiry tags
.--------------------------------------------------------------------------
EMEN0000  BRANCH    FLDITMNO,EMEN0100,EMEN0200,EMEN0300,EMEN0400,EMEN0500:
                             EMEN0600,EMEN0700,EMEN0800,EMEN0900,EMEN1000:
                             EMEN1100,EMEN1200,EMEN1300,EMEN1400,EMEN1500:
                             EMEN1600,EMEN1700,EMEN1800,EMEN1900,EMEN2000:
                             EMEN2100,EMEN2200,EMEN2300
          GOTO      EMEN9999
.
EMEN0100  UNPACK    DIM127,D1,DIM1,DIM127
          MOVE      ZERO,FORM1
          MOVE      DIM1,FORM1
          BRANCH    FORM1,EMEN0110
.
          WRITE     HTMLFILE;PARTCODE;
          GOTO      EMEN9999
.
EMEN0110  PACK      KEY3,PARTCODE,SP70
          CALL      RDPTPAR1
          BRANCH    OVRCD,EMEN9999
.
          WRITE     HTMLFILE;PTPRNAME;
          GOTO      EMEN9999
.
EMEN0200  CALL      EAHM0000
          GOTO      EMEN9999
.
EMEN0300  WRITE     HTMLFILE;PRAHFBID;
          GOTO      EMEN9999
.
EMEN0400  WRITE     HTMLFILE;PRAHARID;
          GOTO      EMEN9999
.
EMEN0500  WRITE     HTMLFILE;PRAHCLID;
          GOTO      EMEN9999
.
EMEN0600  WRITE     HTMLFILE;PRAHRPTC;
          GOTO      EMEN9999
.
EMEN0700  WRITE     HTMLFILE;PRAHCPFN;
          GOTO      EMEN9999
.
EMEN0800  WRITE     HTMLFILE;PRAHCPMN;
          GOTO      EMEN9999
.
EMEN0900  WRITE     HTMLFILE;PRAHCPRN;
          GOTO      EMEN9999
.
EMEN1000  WRITE     HTMLFILE;PRAHFSCD;
          GOTO      EMEN9999
.
EMEN1100  MOVE      ZERO,FORM1
          MOVE      SP70,ASESDESC
          MOVE      PRAHCFAC,ANS
          REP       "A1R2W3C4",ANS
          MOVE      ANS,FORM1
          LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4
.
          WRITE     HTMLFILE;ASESDESC;
          GOTO      EMEN9999
.
EMEN1200  MOVE      ZERO,FORM1
          MOVE      "No Change",MEDSDESC
          MOVE      PRAHMCFC,ANS
          REP       "A1I2C3W4S5X6",ANS
          MOVE      ANS,FORM1
          LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
                                   MEDSDES5,MEDSDES6
.
          WRITE     HTMLFILE;MEDSDESC;
          GOTO      EMEN9999
.
EMEN1300  WRITE     HTMLFILE;PRAHMSCD;
          GOTO      EMEN9999
.
EMEN1400  WRITE     HTMLFILE;PRAHPSNM;
          GOTO      EMEN9999
.
EMEN1500  WRITE     HTMLFILE;PRAHPFNM;
          GOTO      EMEN9999
.
EMEN1600  WRITE     HTMLFILE;PRAHPMCN;
          GOTO      EMEN9999
.
EMEN1700  WRITE     HTMLFILE;PRAHPRFN;
          GOTO      EMEN9999
.
EMEN1800  MOVE      ZERO,FORM2
          MOVE      "UNKNOWN",PRCSDESC
          MOVE      PRAHSTAT,FORM2
          LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
                                   PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
                                   PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
                                   PRCSDE10,PRCSDE11
.
          WRITE     HTMLFILE;PRCSDESC;
          GOTO      EMEN9999
.
EMEN1900  WRITE     HTMLFILE;PRAHFTID;
          GOTO      EMEN9999
.
EMEN2000  MATCH     SP70,PRAHUDTE
          GOTO      EMEN9999 IF EQUAL
          UNPACK    PRAHUDTE,CCENT,CYEAR,CMON,CDAY  * Service Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMEN9999
.
EMEN2100  WRITE     HTMLFILE;PRAHUTIM;
          GOTO      EMEN9999
.
EMEN2200  WRITE     HTMLFILE;PRAHFBID,PRAHARID,PRAHCLID,PRAHRPTC;
          GOTO      EMEN9999
.
EMEN2300  WRITE     HTMLFILE;EXTRTYPE;
          GOTO      EMEN9999
.
EMEN9999  RETURN
+
.***************************************************************************
.*                             EAHM0000                                    *
.*   Display all imc assessment reports received from a given participant  *
.***************************************************************************
EAHM0000  MATCH     "1",PTCNUIMC
          GOTO      EAHM9999 IF NOT EQUAL
.
          MATCH     SP70,EXTRTYPE
          GOTO      EAHM9999 IF EQUAL
.
          PACK      PARTCODE,PARTCODE,SP70
.
          MATCH     "2",EXTRTYPE
          IF        !@EQUAL
            MATCH     SP70,PARTCODE
            GOTO      EAHM9999 IF EQUAL
          ENDIF
.
          PACK      KEY32,PARTCODE,SP70
          CALL      RSPREAH1                     * position in file
EAHM1000  CALL      RKPREAH1                     * read next record
          BRANCH    OVRCD,EAHM9999               * end of file
.
          MATCH     PARTCODE,PRAHFBID
          GOTO      EAHM9999 IF NOT EQUAL
.
          PACK      KEY40,PRAHFTID,SP70
          CALL      RSPRECT6
          CALL      RKPRECT6
          BRANCH    OVRCD,EAHM1000
.
          MATCH     PRAHFTID,PRECTRID
          GOTO      EAHM1000 IF NOT EQUAL
.
          MATCH     "1",EXTRTYPE
          IF        @EQUAL
            MATCH     "0",PRECEETP
            IF        !@EQUAL
              MATCH     "1",PRECEETP
              GOTO      EAHM1000 IF NOT EQUAL
            ENDIF
          ELSE
            MATCH     EXTRTYPE,PRECEETP
            GOTO      EAHM1000 IF NOT EQUAL
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      PRAHCFAC,STATKEY1
          REP       "A1R2W3C4",STATKEY1
          MOVE      STATKEY1,FORM1
          MOVE      SP70,CLAMDESC
          LOAD      CLAMDESC,FORM1,CLAMST01,CLAMST02,CLAMST03,CLAMST04
.
          MOVE      ZERO,FORM1
          MOVE      "No Change",MEDSDESC
          MOVE      PRAHMCFC,ANS
          REP       "A1I2C3W4S5X6",ANS
          MOVE      ANS,FORM1
          LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
                                   MEDSDES5,MEDSDES6
.
          MOVE      SP70,DIM11
          MATCH     SP70,PRAHUDTE
          IF        !@EQUAL & !@EOS
            UNPACK    PRAHUDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      ZERO,FORM2
          MOVE      "UNKNOWN",PRCSDESC
          MOVE      PRAHSTAT,FORM2
          LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
                                   PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
                                   PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
                                   PRCSDE10,PRCSDE11
.
          REP       " +",PRAHFBID
          REP       " +",PRAHARID
          REP       " +",PRAHCLID
          REP       " +",PRAHRPTC
.
        WRITE     HTMLFILE;"t.addRow(#"","<img src='../images/CommentIcon.gif'":
                           " class=ListIcon onclick=displayProH('":
          PRAHFBID,"','",PRAHARID,"','",PRAHCLID,"','",PRAHRPTC,"','002');> ";
.
          REP       "+ ",PRAHFBID
          REP       "+ ",PRAHARID
          REP       "+ ",PRAHCLID
          REP       "+ ",PRAHRPTC
.
          WRITE     HTMLFILE;PRAHARID,"#",";               * 0
.
          WRITE     HTMLFILE;"#"",PRAHCLID,"#",":          * 1
                             "#"",PRAHRPTC,"#",":          * 2
                             "#"",CLAMDESC,"#",":          * 3
                             "#"",PRAHCPFN,"#",":          * 4
                             "#"",PRAHCPMN,"#",":          * 5
                             "#"",PRAHCPRN,"#",":          * 6
                             "#"",PRAHFSCD,"#",":          * 7
                             "#"",MEDSDESC,"#",":          * 8
                             "#"",PRAHMSCD,"#",":          * 9
                             "#"",PRAHPSNM,"#",":          * 10
                             "#"",PRAHPFNM,"#",":          * 11
                             "#"",PRAHPMCN,"#",":          * 12
                             "#"",PRAHPRFN,"#",":          * 13
                             "#"",PRCSDESC,"#",":          * 14
                             "#"",PRAHFTID,"#",":          * 15
                             "#"",DIM11,"#",";             * 16
.
          REP       " +",PRAHFBID
          REP       " +",PRAHARID
          REP       " +",PRAHCLID
          REP       " +",PRAHRPTC
.
          WRITE     HTMLFILE;"#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=displayProH('":
          PRAHFBID,"','",PRAHARID,"','",PRAHCLID,"','",PRAHRPTC,"','003');> ":
          "#",";                                           * 6
.
          WRITE     HTMLFILE;"#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=displayProH('":
          PRAHFBID,"','",PRAHARID,"','",PRAHCLID,"','",PRAHRPTC,"','005');> ":
          "#");"                                           * 7
.
          REP       "+ ",PRAHFBID
          REP       "+ ",PRAHARID
          REP       "+ ",PRAHCLID
          REP       "+ ",PRAHRPTC
.
          GOTO      EAHM1000
.
EAHM9999  RETURN
+
.--------------------------------------------------------------------------
. Option 12 - Eclipse IMC Assessing Report Details tags
.--------------------------------------------------------------------------
EMRD0000  BRANCH    FLDITMNO,EMRD0100,EMRD0200,EMRD0300,EMRD0400,EMRD0500:
                             EMRD0600,EMRD0700,EMRD0800
          GOTO      EMRD9999
.
EMRD0100  CALL      EADM0000
          GOTO      EMRD9999
.
EMRD0200  WRITE     HTMLFILE;PREDFBID;
          GOTO      EMRD9999
.
EMRD0300  WRITE     HTMLFILE;PREDARID;
          GOTO      EMRD9999
.
EMRD0400  WRITE     HTMLFILE;PREDCLID;
          GOTO      EMRD9999
.
EMRD0500  WRITE     HTMLFILE;PREDRPTC;
          GOTO      EMRD9999
.
EMRD0600  WRITE     HTMLFILE;PREDCFEC;
          GOTO      EMRD9999
.
EMRD0700  WRITE     HTMLFILE;PREDEXPC;
          GOTO      EMRD9999
.
EMRD0800  WRITE     HTMLFILE;PREDCFET;
          GOTO      EMRD9999
.
EMRD9999  RETURN
+
.***************************************************************************
.*                             EADM0000                                    *
.*   Display imc assessment report details received for a claim            *
.***************************************************************************
EADM0000  MATCH     "1",PTCNUIMC
          GOTO      EADM9999 IF NOT EQUAL
.
          CALL      EADMH000
.
          PACK      KEY39,PRAHFBID,PRAHARID,PRAHCLID,PRAHRPTC,SP70
          CALL      RSPREAD1
EADM1000  CALL      RKPREAD1
          BRANCH    OVRCD,EADM9999
.
          MATCH     PRAHFBID,PREDFBID
          GOTO      EADM9999 IF NOT EQUAL
.
          MATCH     PRAHARID,PREDARID
          GOTO      EADM9999 IF NOT EQUAL
.
          MATCH     PRAHCLID,PREDCLID
          GOTO      EADM9999 IF NOT EQUAL
.
          MATCH     PRAHRPTC,PREDRPTC
          GOTO      EADM9999 IF NOT EQUAL
.
          CALL      EADMR000
.
          GOTO      EADM1000
.
EADM9999  RETURN
+
.------------------------------------------------------------
. EAD IMC Assessment Details (TABLE HEADING)
.------------------------------------------------------------
EADMH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Brand ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Account<br>Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation<br>Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Text&nbsp;</td>":
                             "</tr>"
.
EADMH999  RETURN
.------------------------------------------------------------
. Eclipse Assessment Details (Detail Row)
.------------------------------------------------------------
EADMR000  REP       " +",PREDFBID
          REP       " +",PREDARID
          REP       " +",PREDCLID
          REP       " +",PREDRPTC
          REP       " +",PREDCFEC
          REP       " +",PREDEXPC
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displayAssD('",PREDFBID:
                             "','",PREDARID,"','",PREDCLID,"','",PREDRPTC:
                             "','",PREDCFEC,"','",PREDEXPC,"');>&nbsp;";
          REP       "+ ",PREDFBID
          REP       "+ ",PREDARID
          REP       "+ ",PREDCLID
          REP       "+ ",PREDRPTC
          REP       "+ ",PREDCFEC
          REP       "+ ",PREDEXPC
.
          WRITE     HTMLFILE;PREDFBID,"</td>":
                             "<td>",PREDARID,"</td>":
                             "<td>",PREDCLID,"</td>":
                             "<td>",PREDCFEC,"</td>":
                             "<td>",PREDCFET,"</td>":
                             "</tr>"
.
EADMR999  RETURN
+
.--------------------------------------------------------------------------
. Option 12 - Eclipse IMC Assessing Report Services tags
.--------------------------------------------------------------------------
EMRS0000  BRANCH    FLDITMNO,EMRS0100,EMRS0200,EMRS0300,EMRS0400,EMRS0500:
                             EMRS0600,EMRS0700,EMRS0800,EMRS0900,EMRS1000:
                             EMRS1100,EMRS1200,EMRS1300,EMRS1400,EMRS1500:
                             EMRS1600
          GOTO      EMRS9999
.
EMRS0100  CALL      EMDR0000
          GOTO      EMRS9999
.
EMRS0200  WRITE     HTMLFILE;PRSHFBID;
          GOTO      EMRS9999
.
EMRS0300  WRITE     HTMLFILE;PRSHARID;
          GOTO      EMRS9999
.
EMRS0400  WRITE     HTMLFILE;PRSHCLID;
          GOTO      EMRS9999
.
EMRS0500  WRITE     HTMLFILE;PRSHRPTC;
          GOTO      EMRS9999
.
EMRS0600  WRITE     HTMLFILE;PRSHITMN;
          GOTO      EMRS9999
.
EMRS0700  WRITE     HTMLFILE;PRSHSRVC;
          GOTO      EMRS9999
.
EMRS0800  MOVE      ZERO,FORM7P2
          UNPACK    PRSHCAMT,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EMRS9999
.
EMRS0900  MOVE      ZERO,FORM7P2
          UNPACK    PRSHFBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EMRS9999
.
EMRS1000  MATCH     SP70,PRSHSDTE
          GOTO      EMRS9999 IF EQUAL
          UNPACK    PRSHSDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMRS9999
.
EMRS1100  MOVE      ZERO,FORM7P2
          UNPACK    PRSHMBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EMRS9999
.
EMRS1200  WRITE     HTMLFILE;PRSHMEXC;
          GOTO      EMRS9999
.
EMRS1300  MOVE      ZERO,FORM7P2
          UNPACK    PRSHSCHF,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EMRS9999
.
EMRS1400  MOVE      ZERO,FORM1
          MOVE      SP70,ASESDESC
          MOVE      PRSHSFAC,ANS
          REP       "A1R2W3",ANS
          MOVE      ANS,FORM1
          LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3
.
          WRITE     HTMLFILE;ASESDESC;
          GOTO      EMEN9999
.
EMRS1500  WRITE     HTMLFILE;PRSHSVID;
          GOTO      EMRS9999
.
EMRS1600  CALL      EMDD0000
          GOTO      EMRS9999
.
EMRS9999  RETURN
+
.***************************************************************************
.*                             EMDR0000                                    *
.*   Display the service report header received for an IMC claim           *
.***************************************************************************
EMDR0000  MATCH     "1",PTCNUIMC
          GOTO      EMDR9999 IF NOT EQUAL
.
          CALL      EMDRH000
.
          PACK      KEY40,PRAHFBID,PRAHARID,PRAHCLID,PRAHRPTC,SP70
          CALL      RSPRESH1
EMDR1000  CALL      RKPRESH1
          BRANCH    OVRCD,EMDR9999
.
          MATCH     PRAHFBID,PRSHFBID
          GOTO      EMDR9999 IF NOT EQUAL
.
          MATCH     PRAHARID,PRSHARID
          GOTO      EMDR9999 IF NOT EQUAL
.
          MATCH     PRAHCLID,PRSHCLID
          GOTO      EMDR9999 IF NOT EQUAL
.
          MATCH     PRAHRPTC,PRSHRPTC
          GOTO      EMDR9999 IF NOT EQUAL
.
          CALL      EMDRR000
.
          GOTO      EMDR1000
.
EMDR9999  RETURN
+
.------------------------------------------------------------
. ESH IMC Assessment Services Header (TABLE HEADING)
.------------------------------------------------------------
EMDRH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Brand ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Account<br>Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Benefit Amount</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service&nbsp;Date&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare<br>Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare<br>Explanation Code&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Schedule Fee&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Fund<br>Assessment Code&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Service ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Details</td>":
                             "</tr>"
.
EMDRH999  RETURN
.------------------------------------------------------------
. Eclipse Services Header (Detail Row)
.------------------------------------------------------------
EMDRR000  REP       " +",PRSHFBID
          REP       " +",PRSHARID
          REP       " +",PRSHCLID
          REP       " +",PRSHRPTC
          REP       " +",PRSHITMN
          REP       " +",PRSHSRVC
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",PRSHFBID:
                             "','",PRSHARID,"','",PRSHCLID,"','",PRSHRPTC:
                             "','",PRSHITMN,"','",PRSHSRVC,"','006');>&nbsp;";
          REP       "+ ",PRSHFBID
          REP       "+ ",PRSHARID
          REP       "+ ",PRSHCLID
          REP       "+ ",PRSHRPTC
          REP       "+ ",PRSHITMN
          REP       "+ ",PRSHSRVC
.
          WRITE     HTMLFILE;PRSHFBID,"</td>":
                             "<td>",PRSHARID,"</td>":
                             "<td>",PRSHCLID,"</td>":
                             "<td>",PRSHITMN,"</td>";
.
          REP       " +",PRSHFBID
          REP       " +",PRSHARID
          REP       " +",PRSHCLID
          REP       " +",PRSHRPTC
          REP       " +",PRSHITMN
          REP       " +",PRSHSRVC
.
          MOVE      ZERO,FORM7P2
          UNPACK    PRSHCAMT,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          MOVE      ZERO,FORM7P2
          UNPACK    PRSHFBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,PRSHSDTE
          IF        !@EQUAL & !@EOS
            UNPACK    PRSHSDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          MOVE      ZERO,FORM7P2
          UNPACK    PRSHMBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>"; 
.
          WRITE     HTMLFILE;"<td>",PRSHMEXC,"</td>";
.
.         MOVE      ZERO,FORM7P2
.         UNPACK    PRSHSCHF,DIM7,DIM2
.         PACK      DIM10,DIM7,DOT,DIM2
.         MOVE      DIM10,FORM7P2
.         WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          MOVE      ZERO,FORM1
          MOVE      SP70,ASESDESC
          MOVE      PRSHSFAC,ANS
          REP       "A1R2W3",ANS
          MOVE      ANS,FORM1
          LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3
          WRITE     HTMLFILE;"<td>",ASESDESC,"</td>";
.
.         WRITE     HTMLFILE;"<td>",PRSHSVID,"</td>";
.
          WRITE     HTMLFILE;"<td><img src='../images/EditIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",PRSHFBID:
                             "','",PRSHARID,"','",PRSHCLID,"','",PRSHRPTC:
                             "','",PRSHITMN,"','",PRSHSRVC,"','007');>":
                             "</td></tr>"
.
EMDRR999  RETURN
+
.***************************************************************************
.*                             EMDD0000                                    *
.*   Display the imc service report details received for a claim           *
.***************************************************************************
EMDD0000  MATCH     "1",PTCNUIMC
          GOTO      EMDD9999 IF NOT EQUAL
.
          CALL      EMDDH000
.
          PACK      KEY47,PRSHFBID,PRSHARID,PRSHCLID,PRSHRPTC:
                          PRSHITMN,PRSHSRVC,SP70
          CALL      RSPRESD1
EMDD1000  CALL      RKPRESD1
          BRANCH    OVRCD,EMDD9999
.
          MATCH     PRSHFBID,PRSDFBID
          GOTO      EMDD9999 IF NOT EQUAL
.
          MATCH     PRSHARID,PRSDARID
          GOTO      EMDD9999 IF NOT EQUAL
.
          MATCH     PRSHCLID,PRSDCLID
          GOTO      EMDD9999 IF NOT EQUAL
.
          MATCH     PRSHRPTC,PRSDRPTC
          GOTO      EMDD9999 IF NOT EQUAL
.
          MATCH     PRSHITMN,PRSDITMN
          GOTO      EMDD9999 IF NOT EQUAL
.
          MATCH     PRSHSRVC,PRSDSRVC
          GOTO      EMDD9999 IF NOT EQUAL
.
          CALL      EMDDR000
.
          GOTO      EMDD1000
.
EMDD9999  RETURN
+
.------------------------------------------------------------
. ESD IMC Assessment Services Details (TABLE HEADING)
.------------------------------------------------------------
EMDDH000  WRITE     HTMLFILE;"<tr>";
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Item<br>Number</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Service&nbsp;Code<br>Counter</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Explanation Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=15%>":
                             "Explanation<br>Counter</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=50%>":
                             "Explanation Text</td>":
                             "</tr>"
.
EMDDH999  RETURN
.------------------------------------------------------------
. Eclipse Services Details (Detail Row)
.------------------------------------------------------------
EMDDR000  WRITE     HTMLFILE;"<tr><td>",PRSDITMN,"</td>":
                             "<td>",PRSDSRVC,"</td>":
                             "<td>",PRSDSFEC,"</td>":
                             "<td>",PRSDSEXC,"</td>":
                             "<td>",PRSDSFET,"</td></tr>"
.
EMDDR999  RETURN
+
.------------------------------------------------------------
.  Redirect to REDIRECT URL with alert
.------------------------------------------------------------
REDALT00  CALL      OPENHTML
          BRANCH    EXIT,REDALT99
          WRITE     HTMLFILE;"<html><head>":
                             "<script type=#"text/javascript#">{":
                             "    alert(#"",WEBTITLE,"#");":
                             " location.href=#"",REDIRECT,"#";":
                             "}</script>":
                             "</head>":
                             "<body></body></html>"
          CALL      CLOSHTML
REDALT99  RETURN
+
.------------------------------------------------------------
. Eclipse PCS Claims Extract
.------------------------------------------------------------
PCLEXT00  MATCH     "1",PTCNUESF
          GOTO      PCLEXT91 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      PCLEXT80 IF EQUAL
.
          MATCH     "L",UPDTTYPE
          GOTO      PCLEXT10 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Extract Claims
          GOTO      PCLEXT30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Claims
          GOTO      PCLEXT40 IF EQUAL
.
          GOTO      PCLEXT85
.
PCLEXT10  CALL      PERR0000                     * reset any error records
          GOTO      PCLEXT80
.
PCLEXT30  COMPARE   ZERO,LASTDCLM
          GOTO      PCLEXT35 IF EQUAL            * any claims to delete first ?
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,PECLMARR[COUNT]
            IF        !@EQUAL
              CALL      PDEL0000                 * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      PCLEXT35 IF EQUAL
.
          CALL      ERRLST00                     * display any delete errors
.>>>>     MOVE      ONE,EXIT
.>>>>     GOTO      PCLEXT99
.
PCLEXT35  MATCH     "1",PTCNUESF                 * using edi module?
          GOTO      PCLEXT91 IF NOT EQUAL
.
          MATCH     SP70,PTCNESFO                * eclipse outbound path set?
          GOTO      PCLEXT92 IF EQUAL
.
          COMPARE   ZERO,LASTECLM
          GOTO      PCLEXT86 IF EQUAL            * no claims to extract
.
          CALL      SFCLX000                     * Extract Eclipse Claims
.
          MOVE      ZERO,EXIT
          GOTO      PCLEXT99
.
.   ************ DELETE CLAIM FUNCTION ************
.>>>>
PCLEXT40  COMPARE   ZERO,LASTDCLM
          GOTO      PCLEXT86 IF EQUAL            * no claims to delete
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,PECLMARR[COUNT]
            IF        !@EQUAL
              CALL      PDEL0000   * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      PCLEXT99 IF EQUAL
.
          CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      PCLEXT99
.
PCLEXT80  CLEAR     WEBTITLE
          MOVE      "Eclipse PCS Claims Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PCLEXT99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PCLEXT99
.
PCLEXT85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCLEXT99
.
PCLEXT86  MOVE      "No claims selected to extract.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCLEXT99
.
PCLEXT91  MOVE      "Hospital not using the PCS Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCLEXT99
.
PCLEXT92  MOVE      "Eclipse PCS Outbound Path blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCLEXT99
.
PCLEXT99  RETURN
+
.*****************************************************************************
.*                               PDEL0000                                    *
.*               Delete selected Eclipse IMC Claim records                   *
.*****************************************************************************
PDEL0000  UNPACK    PECLMARR[COUNT],KEY8,KEY1    * invoice number / module
          PACK      KEY17,KEY8,SP8,KEY1,SP70       * batch number is blank
          CALL      RDEMECT2
          BRANCH    OVRCD,PDEL8000
.
          MOVE      EMECINVN,TEMPINVN
          MOVE      EMECBATN,TEMPBATN
          MOVE      EMECUNIQ,TEMPADMN
          MOVE      EMECURNO,TEMPURNO
          MOVE      EMECPBAT,TEMPPBAT
          MOVE      EMECHOSP,TEMPHOSP
          MOVE      EMECMODL,TEMPMODL
.
          MATCH     SP70,TEMPPBAT
          GOTO      PDEL1000 IF EQUAL
          GOTO      PDEL1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,SP1,FIVE,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDEMECT1
          IF        OVRCD = 1
            GOTO      PDEL7000
          ELSE
            MOVE      SP70,EMECNBAT
            CALL      UPEMECT1
          ENDIF
.
.         Delete the selected record
.
PDEL1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN,SP70
          CALL      DEEMECT1
.
          GOTO      PDEL9999
.
PDEL7000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      PDEL9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Error updating previous claim - ",ERRORLST[ERRORCNT]
          APPEND    EMECINVN,ERRORLST[ERRORCNT]
          APPEND    "  Batch - ",ERRORLST[ERRORCNT]
          APPEND    EMECBATN,ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      PDEL9999
.
PDEL8000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      PDEL9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Record cannot be deleted.  ",ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      PDEL9999

PDEL9999  RETURN
+
.*****************************************************************************
.*                              PERR0000           Called by: PCLEXT00       *
.*             Reset error records back to zero status (Not Sent)            *
.*             just in case there were any problems with a previous          *
.*             batch and the error records were not set back to zero.        *
.*****************************************************************************
.
PERR0000  MOVE      HOSPCODE,SAVEHOSP            * initialise hospital
          MOVE      ZERO,FIRSTFLG                * initialise flag
.
          PACK      KEY30,HOSPCODE,SP1,ONE,SP70
PERR0500  CALL      RSEMECT1                     * position in file
          CALL      RKEMECT1                     * read next record
          BRANCH    OVRCD,PERR9999               * eof - finished
.
          IF        FIRSTFLG = 0
            MATCH     SP3,HOSPCODE               * all hospitals extract ?
            IF        @EQUAL
              MOVE      EMECHOSP,SAVEHOSP        * yes-load first hospital code
            ENDIF
            MOVE      ONE,FIRSTFLG               * set first flag to no
          ENDIF
.
          MATCH     SP3,HOSPCODE                 * all hospitals extract ?
          GOTO      PERR5000 IF NOT EQUAL        * no
.
.         We are running an extract for all hospitals
.
          MATCH     SAVEHOSP,EMECHOSP            * same hospital still ?
          IF        !@EQUAL
            MOVE      EMECHOSP,SAVEHOSP          * no - save new hospital code
            PACK      KEY30,EMECHOSP,SP1,ONE,SP70
            GOTO      PERR0500
          ENDIF
.
          COMPARE   ONE,EMECFLAG                 * error record still ?
          GOTO      PERR4000 IF NOT EQUAL        * no - get next hospital
.
          GOTO      PERR8000
.
PERR4000  PACK      KEY30,EMECHOSP,Z70
          GOTO      PERR0500
.
.         We are running an extract for a given hospital id
.
PERR5000  MATCH     HOSPCODE,EMECHOSP            * same hospital still ?
          GOTO      PERR9999 IF NOT EQUAL        * no - finished
.
          COMPARE   ONE,EMECFLAG                 * error record still ?
          GOTO      PERR9999 IF NOT EQUAL        * no - finished
.
.         Reset the record status to "Waiting"
.
PERR8000  PACK      SAVKEY30,EMECHOSP,EMECFLAG,EMECMODL,EMECUNIQ,EMECINVN:
                             EMECBATN
          MOVE      ZERO,EMECFLAG                * yes - reset flag to "0"
          CALL      UPEMECT1                     * update record
          MOVE      SAVKEY30,KEY30               * load key to reposition
          GOTO      PERR0500                     * get next record
.
PERR9999  RETURN
+
.--------------------------------------------------------------------------
.*                             SFCLX000                                   *
.*               Schedule Eclipse Extract (IBAEMR04)                      *
.--------------------------------------------------------------------------
SFCLX000  MOVE      "IBAEMR04",SCHDPGID
          MOVE      "Eclipse PCS Claims Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAEMR04",SETDFPRG
          MOVE      "11",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ONE,COUNT
          MOVE      HOSPCODE,KEYSTARR[COUNT]    * hospital id
          ADD       ONE,COUNT
          MOVE      ONE,KEYSTARR[COUNT]    * extract pcs (1)
.
.         COMPARE   TWO,OPTNFLAG
.         GOTO      SFCLX500 IF EQUAL
.
.         ADD       ONE,COUNT
.         MOVE      HFUNDTYP,KEYSTARR[COUNT]    * health fund
.
.         MOVE      THREE,TOTALCNT              * first 3 keyins
.         GOTO      SFCLX600
.
SFCLX500  MOVE      TWO,TOTALCNT
.
SFCLX600  ADD      ONE,COUNT
          MOVE     ONE,COUNTEC
          WHILE     COUNTEC <= LASTECLM
            MATCH     SP90,ECCLMARR[COUNTEC]
            IF        !@EQUAL
              MOVE      ECCLMARR[COUNTEC],KEYSTARR[COUNT]    * to be extracted
            ENDIF
            ADD      ONE,COUNT
            ADD      ONE,COUNTEC
          DO
.
          ADD       LASTECLM,TOTALCNT            * eclipse claims keyins
.
          PACK      KEYSTARR[COUNT],SP70         * blank record to signal exit
          ADD       ONE,COUNT
          ADD       ONE,TOTALCNT
.
          MOVE      ANSP,KEYSTARR[COUNT]         * (P)ost
.>>>>
.>>>>     ADD       ONE,COUNT
.>>>>     MOVE      ANSY,KEYSTARR[COUNT]         * (Y) to extract (if ok)
.>>>>
          ADD       ONE,COUNT
          MOVE      SP70,KEYSTARR[COUNT]         * (Enter) to exit
          ADD       ONE,COUNT
          MOVE      "\",KEYSTARR[COUNT]          * (\) to exit
.
          ADD       THREE,TOTALCNT               * add last 3 keyins (if error)
.>>>>     ADD       FOUR,TOTALCNT                * add last 4 keyins (if ok)
          MOVE      TOTALCNT,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SFCLX999  RETURN
+
.--------------------------------------------------------------------------
. Option 13 - Eclipse PCS Claims Extract tags
.--------------------------------------------------------------------------
FEXT0000  BRANCH    FLDITMNO,FEXT0100,FEXT0200,FEXT0300,FEXT0400,FEXT0500:
                             FEXT0600,FEXT0700,FEXT0800
          GOTO      FEXT9999
.
FEXT0100  MOVE      ONE,ALLHFLAG          * default to 'All'
          CALL      HOSPID00              * display Multi-hosp. selection list
          GOTO      FEXT9999
.
FEXT0200  CALL      ECSHN000              * selected Hospital Desc (Multi-hosp)
          GOTO      FEXT9999
.
FEXT0300
.         MOVE      "CL",CATEGORY         * Compensation code/Claim Type
.         MOVE      HFUNDTYP,CODE
.         CALL      CODITM00
          GOTO      FEXT9999
.
FEXT0400  CALL      FCWFX000              * Claims Waiting for Extraction
          GOTO      FEXT9999
.
FEXT0500  MATCH     SP70,UPDTTYPE
          GOTO      FEXT9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI
          GOTO      FEXT9999
.
FEXT0600
.         WRITE     HTMLFILE;CLAMTYPE;    * Claim type CGI
          GOTO      FEXT9999
.
FEXT0700  
.         MATCH     SP70,HFUNDTYP
.         GOTO      FEXT9999 IF EQUAL
.         WRITE     HTMLFILE;HFUNDTYP;    * Health Fund CGI
          GOTO      FEXT9999
.
FEXT0800  
.         WRITE     HTMLFILE;HFUNDESC;    * Health Fund Desc CGI
          GOTO      FEXT9999
.
FEXT9999  RETURN
+
.------------------------------------------------------------
. Table of all Eclipse IMC Claims Waiting For Extraction
.------------------------------------------------------------
FCWFX000  MATCH     "1",PTCNUESF
          GOTO      FCWFX999 IF NOT EQUAL
.
          MOVE      ZERO,FORM3
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY30,HOSPCODE,SP1,ZERO,SP70
FCWFX040  CALL      RSEMECT1
FCWFX050  CALL      RKEMECT1                * read next record
          BRANCH    OVRCD,FCWFX900          * end of file
.
          MATCH     SP3,HOSPCODE                 * all hospitals ?
          IF        !@EQUAL
            MATCH     HOSPCODE,EMECHOSP          * no - same hospital still ?
            GOTO      FCWFX900 IF NOT EQUAL      * no - finished
          ENDIF
.
          COMPARE   ZERO,EMECFLAG                * waiting for extract still ?
          IF        !@EQUAL
            PACK      KEY30,EMECHOSP,Z70
            GOTO      FCWFX040                   * get next record
          ENDIF
.
.         A waiting record has been found,
.         so get the invoice details and calculate the amount outstanding.
.
FCWFX200  MATCH     "1",EMECMODL
          IF        @EQUAL
            CALL      FCLR2000
          ELSE
            CALL      FCLR1000
          ENDIF
.
          IF        DISNUMB>=50
            GOTO      FCWFX800
          ENDIF
          GOTO      FCWFX050
.
FCWFX800  CALL      LIMREC00        * Show batch limit reached message
          GOTO      FCWFX999
.
FCWFX900  CALL      TOTREC00        * Show no more records message
.
FCWFX999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse PCS (TABLE ROW)
.------------------------------------------------------------
FCLR1000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP8,PRINDATE
          ELSE
            IF        PRINUNIQ = 0
              GOTO      FCLR1900                 * delete claim
            ENDIF
            ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM12P2
            IF        IBCNUGST=2
              ADD       PRINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PRINDATE
          IF        !@EQUAL
            UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;EMECUNIQ,"&nbsp;</td>":
                             "<td>",EMECINVN,"&nbsp;</td>":
                             "<td>",EMECURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",EMECHOSP,EMECUNIQ,EMECINVN:
                                  EMECURNO,PRINDATE,KEY15,EMECMODL,SP1,ZERO,SP1:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=peclm",KEY3:
                             " value='",EMECINVN,EMECMODL:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      FCLR1999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in emrectaf
.
FCLR1900  PACK      SAVKEY30,EMECHOSP,EMECFLAG,EMECMODL,EMECUNIQ,EMECINVN:
                             EMECBATN
          MOVE      SAVKEY30,KEY30
          CALL      DEEMECT1                 * delete cancelled/zero invoices
          MOVE      SAVKEY30,KEY30
          CALL      RSEMECT1
.
FCLR1999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse (TABLE ROW)
.------------------------------------------------------------
FCLR2000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,EMECINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      SP8,PINVDTE
          ELSE
            MATCH     ZEROVISN,PINVADM
            IF        @EQUAL
              GOTO      FCLR2900                 * delete claim
            ENDIF
            IF        PINVTYP =2
              GOTO      FCLR2900                 * delete claim
            ENDIF
            ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR),FORM12P2
            IF        IBCNUGST=2
              ADD       PTINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PINVDTE
          IF        !@EQUAL
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;EMECUNIQ,"&nbsp;</td>":
                             "<td>",EMECINVN,"&nbsp;</td>":
                             "<td>",EMECURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",EMECHOSP,EMECUNIQ,EMECINVN:
                                       EMECURNO,PINVDTE,KEY15,EMECMODL,SP1,ZERO,SP1:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=peclm",KEY3:
                             " value='",EMECINVN,EMECMODL:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      FCLR2999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in pmsectaf
.
FCLR2900  PACK      SAVKEY30,EMECHOSP,EMECFLAG,EMECMODL,EMECUNIQ,EMECINVN:
                             EMECBATN
          MOVE      SAVKEY30,KEY30
          CALL      DEEMECT1                 * delete cancelled/zero invoices
          MOVE      SAVKEY30,KEY30
          CALL      RSEMECT1
.
FCLR2999  RETURN
+
.------------------------------------------------------------
. Eclipse DBS Claims Extract
.------------------------------------------------------------
DBSEXT00  MATCH     "1",PTCNUEBB
          GOTO      DBSEXT91 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      DBSEXT80 IF EQUAL
.
          MATCH     "L",UPDTTYPE
          GOTO      DBSEXT10 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Extract Claims
          GOTO      DBSEXT30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Claims
          GOTO      DBSEXT40 IF EQUAL
.
          GOTO      DBSEXT85
.
DBSEXT10  CALL      BERR0000                     * reset any error records
          GOTO      DBSEXT80
.
DBSEXT30  COMPARE   ZERO,LASTDCLM
          GOTO      DBSEXT35 IF EQUAL            * any claims to delete first ?
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,PECLMARR[COUNT]
            IF        !@EQUAL
              CALL      BDEL0000                 * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      DBSEXT35 IF EQUAL
.
          CALL      ERRLST00                     * display any delete errors
.>>>>     MOVE      ONE,EXIT
.>>>>     GOTO      DBSEXT99
.
DBSEXT35  MATCH     "1",PTCNUEBB                 * using edi module?
          GOTO      DBSEXT91 IF NOT EQUAL
.
          MATCH     SP70,PTCNEDBO                * eclipse outbound path set?
          GOTO      DBSEXT92 IF EQUAL
.
          COMPARE   ZERO,LASTECLM
          GOTO      DBSEXT86 IF EQUAL            * no claims to extract
.
          CALL      DBCLX000                     * Extract Eclipse Claims
.
          MOVE      ZERO,EXIT
          GOTO      DBSEXT99
.
.   ************ DELETE CLAIM FUNCTION ************
.>>>>
DBSEXT40  COMPARE   ZERO,LASTDCLM
          GOTO      DBSEXT86 IF EQUAL            * no claims to delete
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,PECLMARR[COUNT]
            IF        !@EQUAL
              CALL      BDEL0000   * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      DBSEXT99 IF EQUAL
.
          CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      DBSEXT99
.
DBSEXT80  CLEAR     WEBTITLE
          MOVE      "Eclipse DBS Claims Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,DBSEXT99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      DBSEXT99
.
DBSEXT85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DBSEXT99
.
DBSEXT86  MOVE      "No claims selected to extract.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DBSEXT99
.
DBSEXT91  MOVE      "Hospital not using the DBS Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DBSEXT99
.
DBSEXT92  MOVE      "Eclipse DBS Outbound Path blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DBSEXT99
.
DBSEXT99  RETURN
+
.*****************************************************************************
.*                               BDEL0000                                    *
.*               Delete selected Eclipse DBS Claim records                   *
.*****************************************************************************
BDEL0000  UNPACK    PECLMARR[COUNT],KEY8,KEY1    * invoice number / module
          PACK      KEY17,KEY8,SP8,KEY1,SP70       * batch number is blank
          CALL      RDOTECT2
          BRANCH    OVRCD,BDEL8000
.
          MOVE      OTECINVN,TEMPINVN
          MOVE      OTECBATN,TEMPBATN
          MOVE      OTECUNIQ,TEMPADMN
          MOVE      OTECURNO,TEMPURNO
          MOVE      OTECPBAT,TEMPPBAT
          MOVE      OTECHOSP,TEMPHOSP
          MOVE      OTECMODL,TEMPMODL
.
          MATCH     SP70,TEMPPBAT
          GOTO      BDEL1000 IF EQUAL
          GOTO      BDEL1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,FIVE,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDOTECT1
          IF        OVRCD = 1
            GOTO      BDEL7000
          ELSE
            MOVE      SP70,OTECNBAT
            CALL      UPOTECT1
          ENDIF
.
.         Delete the selected record
.
BDEL1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN,SP70
          CALL      DEOTECT1
.
          GOTO      BDEL9999
.
BDEL7000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      BDEL9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Error updating previous claim - ",ERRORLST[ERRORCNT]
          APPEND    OTECINVN,ERRORLST[ERRORCNT]
          APPEND    "  Batch - ",ERRORLST[ERRORCNT]
          APPEND    OTECBATN,ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      BDEL9999
.
BDEL8000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      BDEL9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Record cannot be deleted.  ",ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      BDEL9999

BDEL9999  RETURN
+
.--------------------------------------------------------------------------
.*                             DBCLX000                                   *
.*               Schedule Eclipse Extract (IBAOUT04)                      *
.--------------------------------------------------------------------------
DBCLX000  MOVE      "IBAOUT04",SCHDPGID
          MOVE      "Eclipse DBS Claims Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAOUT04",SETDFPRG
          MOVE      "11",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ONE,COUNT
          MOVE      HOSPCODE,KEYSTARR[COUNT]    * hospital id
          ADD       ONE,COUNT
          MOVE      ONE,KEYSTARR[COUNT]    * extract pcs (1)
.
.         COMPARE   TWO,OPTNFLAG
.         GOTO      DBCLX500 IF EQUAL
.
.         ADD       ONE,COUNT
.         MOVE      HFUNDTYP,KEYSTARR[COUNT]    * health fund
.
.         MOVE      THREE,TOTALCNT              * first 3 keyins
.         GOTO      DBCLX600
.
DBCLX500  MOVE      TWO,TOTALCNT
.
DBCLX600  ADD      ONE,COUNT
          MOVE     ONE,COUNTEC
          WHILE     COUNTEC <= LASTECLM
            MATCH     SP90,ECCLMARR[COUNTEC]
            IF        !@EQUAL
              MOVE      ECCLMARR[COUNTEC],KEYSTARR[COUNT]    * to be extracted
            ENDIF
            ADD      ONE,COUNT
            ADD      ONE,COUNTEC
          DO
.
          ADD       LASTECLM,TOTALCNT            * eclipse claims keyins
.
          PACK      KEYSTARR[COUNT],SP70         * blank record to signal exit
          ADD       ONE,COUNT
          ADD       ONE,TOTALCNT
.
          MOVE      ANSP,KEYSTARR[COUNT]         * (P)ost
.>>>>
.>>>>     ADD       ONE,COUNT
.>>>>     MOVE      ANSY,KEYSTARR[COUNT]         * (Y) to extract (if ok)
.>>>>
          ADD       ONE,COUNT
          MOVE      SP70,KEYSTARR[COUNT]         * (Enter) to exit
          ADD       ONE,COUNT
          MOVE      "\",KEYSTARR[COUNT]          * (\) to exit
.
          ADD       THREE,TOTALCNT               * add last 3 keyins (if error)
.>>>>     ADD       FOUR,TOTALCNT                * add last 4 keyins (if ok)
          MOVE      TOTALCNT,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
DBCLX999  RETURN
+
.*****************************************************************************
.*                              BERR0000           Called by: DBSEXT00       *
.*             Reset error records back to zero status (Not Sent)            *
.*             just in case there were any problems with a previous          *
.*             batch and the error records were not set back to zero.        *
.*****************************************************************************
.
BERR0000  MOVE      HOSPCODE,SAVEHOSP            * initialise hospital
          MOVE      ZERO,FIRSTFLG                * initialise flag
.
          PACK      KEY30,HOSPCODE,SP1,ONE,SP70
BERR0500  CALL      RSOTECT1                     * position in file
          CALL      RKOTECT1                     * read next record
          BRANCH    OVRCD,BERR9999               * eof - finished
.
          IF        FIRSTFLG = 0
            MATCH     SP3,HOSPCODE               * all hospitals extract ?
            IF        @EQUAL
              MOVE      OTECHOSP,SAVEHOSP        * yes-load first hospital code
            ENDIF
            MOVE      ONE,FIRSTFLG               * set first flag to no
          ENDIF
.
          MATCH     SP3,HOSPCODE                 * all hospitals extract ?
          GOTO      BERR5000 IF NOT EQUAL        * no
.
.         We are running an extract for all hospitals
.
          MATCH     SAVEHOSP,OTECHOSP            * same hospital still ?
          IF        !@EQUAL
            MOVE      OTECHOSP,SAVEHOSP          * no - save new hospital code
            PACK      KEY30,OTECHOSP,SP1,ONE,SP70
            GOTO      BERR0500
          ENDIF
.
          COMPARE   ONE,OTECFLAG                 * error record still ?
          GOTO      BERR4000 IF NOT EQUAL        * no - get next hospital
.
          GOTO      BERR8000
.
BERR4000  PACK      KEY30,OTECHOSP,Z70
          GOTO      BERR0500
.
.         We are running an extract for a given hospital id
.
BERR5000  MATCH     HOSPCODE,OTECHOSP            * same hospital still ?
          GOTO      BERR9999 IF NOT EQUAL        * no - finished
.
          COMPARE   ONE,OTECFLAG                 * error record still ?
          GOTO      BERR9999 IF NOT EQUAL        * no - finished
.
.         Reset the record status to "Waiting"
.
BERR8000  PACK      SAVKEY30,OTECHOSP,OTECFLAG,OTECMODL,OTECUNIQ,OTECINVN:
                             OTECBATN
          MOVE      ZERO,OTECFLAG                * yes - reset flag to "0"
          CALL      UPOTECT1                     * update record
          MOVE      SAVKEY30,KEY30               * load key to reposition
          GOTO      BERR0500                     * get next record
.
BERR9999  RETURN
+
.--------------------------------------------------------------------------
. Option 14 - Eclipse DBS Claims Extract tags
.--------------------------------------------------------------------------
DEXT0000  BRANCH    FLDITMNO,DEXT0100,DEXT0200,DEXT0300,DEXT0400,DEXT0500:
                             DEXT0600,DEXT0700,DEXT0800
          GOTO      DEXT9999
.
DEXT0100  MOVE      ONE,ALLHFLAG          * default to 'All'
          CALL      HOSPID00              * display Multi-hosp. selection list
          GOTO      DEXT9999
.
DEXT0200  CALL      ECSHN000              * selected Hospital Desc (Multi-hosp)
          GOTO      DEXT9999
.
DEXT0300
.         MOVE      "CL",CATEGORY         * Compensation code/Claim Type
.         MOVE      HFUNDTYP,CODE
.         CALL      CODITM00
          GOTO      DEXT9999
.
DEXT0400  CALL      DBWFX000              * Claims Waiting for Extraction
          GOTO      DEXT9999
.
DEXT0500  MATCH     SP70,UPDTTYPE
          GOTO      DEXT9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI
          GOTO      DEXT9999
.
DEXT0600
.         WRITE     HTMLFILE;CLAMTYPE;    * Claim type CGI
          GOTO      DEXT9999
.
DEXT0700
.         MATCH     SP70,HFUNDTYP
.         GOTO      DEXT9999 IF EQUAL
.         WRITE     HTMLFILE;HFUNDTYP;    * Health Fund CGI
          GOTO      DEXT9999
.
DEXT0800
.         WRITE     HTMLFILE;HFUNDESC;    * Health Fund Desc CGI
          GOTO      DEXT9999
.
DEXT9999  RETURN
+
.------------------------------------------------------------
. Table of all Eclipse DBS Claims Waiting For Extraction
.------------------------------------------------------------
DBWFX000  MATCH     "1",PTCNUEBB
          GOTO      DBWFX999 IF NOT EQUAL
.
          MOVE      ZERO,FORM3
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY30,HOSPCODE,SP1,ZERO,SP70
DBWFX040  CALL      RSOTECT1
DBWFX050  CALL      RKOTECT1                * read next record
          BRANCH    OVRCD,DBWFX900          * end of file
.
          MATCH     SP3,HOSPCODE                 * all hospitals ?
          IF        !@EQUAL
            MATCH     HOSPCODE,OTECHOSP          * no - same hospital still ?
            GOTO      DBWFX900 IF NOT EQUAL      * no - finished
          ENDIF
.
          COMPARE   ZERO,OTECFLAG                * waiting for extract still ?
          IF        !@EQUAL
            PACK      KEY30,OTECHOSP,Z70
            GOTO      DBWFX040                   * get next record
          ENDIF
.
.         A waiting record has been found,
.         so get the invoice details and calculate the amount outstanding.
.
DBWFX200  MATCH     "1",OTECMODL
          IF        @EQUAL
.           CALL      DBLR2000
          ELSE
            MATCH     "2",OTECMODL
            IF        @EQUAL
              CALL      DBLR1000
            ELSE
              CALL      DBLR3000
            ENDIF
          ENDIF
.
          IF        DISNUMB>=50
            GOTO      DBWFX800
          ENDIF
          GOTO      DBWFX050
.
DBWFX800  CALL      LIMREC00        * Show batch limit reached message
          GOTO      DBWFX999
.
DBWFX900  CALL      TOTREC00        * Show no more records message
.
DBWFX999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse DBS (TABLE ROW)
.------------------------------------------------------------
DBLR1000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,OTECINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP8,PRINDATE
          ELSE
            IF        PRINUNIQ = 0
              GOTO      DBLR1900                 * delete claim
            ENDIF
            ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM12P2
            IF        IBCNUGST=2
              ADD       PRINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PRINDATE
          IF        !@EQUAL
            UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;OTECUNIQ,"&nbsp;</td>":
                             "<td>",OTECINVN,"&nbsp;</td>":
                             "<td>",OTECURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",OTECHOSP,OTECUNIQ,OTECINVN:
                                  OTECURNO,PRINDATE,KEY15,OTECMODL,SP1,ZERO,SP1:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=peclm",KEY3:
                             " value='",OTECINVN,OTECMODL:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      DBLR1999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in emrectaf
.
DBLR1900  PACK      SAVKEY30,OTECHOSP,OTECFLAG,OTECMODL,OTECUNIQ,OTECINVN:
                             OTECBATN
          MOVE      SAVKEY30,KEY30
          CALL      DEOTECT1                 * delete cancelled/zero invoices
          MOVE      SAVKEY30,KEY30
          CALL      RSOTECT1
.
DBLR1999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse (TABLE ROW)
.------------------------------------------------------------
DBLR3000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,OTECINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      SP8,PINVDTE
          ELSE
            MATCH     ZEROVISN,PINVADM
            IF        @EQUAL
              GOTO      DBLR3900                 * delete claim
            ENDIF
            IF        PINVTYP =2
              GOTO      DBLR3900                 * delete claim
            ENDIF
            ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR),FORM12P2
            IF        IBCNUGST=2
              ADD       PTINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PINVDTE
          IF        !@EQUAL
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;OTECUNIQ,"&nbsp;</td>":
                             "<td>",OTECINVN,"&nbsp;</td>":
                             "<td>",OTECURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",OTECHOSP,OTECUNIQ,OTECINVN:
                                   OTECURNO,PINVDTE,KEY15,OTECMODL,SP1,ZERO,SP1:
                                   OTECOKEY:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=peclm",KEY3:
                             " value='",OTECINVN,OTECMODL:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      DBLR3999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in pmsectaf
.
DBLR3900  PACK      SAVKEY30,OTECHOSP,OTECFLAG,OTECMODL,OTECUNIQ,OTECINVN:
                             OTECBATN
          MOVE      SAVKEY30,KEY30
          CALL      DEOTECT1                 * delete cancelled/zero invoices
          MOVE      SAVKEY30,KEY30
          CALL      RSOTECT1
.
DBLR3999  RETURN
+
.------------------------------------------------------------
. Eclipse DBS Processing Report Enquiry
.------------------------------------------------------------
ECLDBM00  MATCH     "1",PTCNUEBB
          GOTO      ECLDBM88 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      ECLDBM80 IF EQUAL
.
          MATCH     "H",UPDTTYPE    * Assessment Report Header
          GOTO      ECLDBM10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Assessment Report Details
          GOTO      ECLDBM20 IF EQUAL
.
          MATCH     "P",UPDTTYPE    * Print Assessment Report
          GOTO      ECLDBM40 IF EQUAL
.
          GOTO      ECLDBM85
.
ECLDBM10  PACK      KEY33,ECPRCLID,ECPRREPT,ECPRRRKY,SP70
          CALL      RDOTEAH1
          BRANCH    OVRCD,ECLDBM86
.
          GOTO      ECLDBM80
.
ECLDBM20  PACK      KEY33,ECPRCLID,ECPRREPT,ECPRRRKY,SP70
          CALL      RDOTEAH1
          BRANCH    OVRCD,ECLDBM86
.uptohere
          PACK      KEY40,ECPRCLID,ECPRREPT,ECPRSRVI,ECPRSRVC:
                          ECPRRRKY,SP70
          CALL      RDOTEAD1
          BRANCH    OVRCD,ECLDBM87
.
          GOTO      ECLDBM80
.
ECLDBM40  CALL      SEBAR000      * Schedule print Assessment Report
.
          MOVE      ZERO,EXIT
          GOTO      ECLDBM99
.
ECLDBM80  CLEAR     WEBTITLE
          MOVE      "Eclipse DBS Processing Report Enquiry",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ECLDBM99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      ECLDBM99
.
ECLDBM85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLDBM99
.
ECLDBM86  MOVE      "Processing Report Header not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLDBM99
.
ECLDBM87  MOVE      "Processing Report Details not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLDBM99
.
ECLDBM88  MOVE      "Not using Eclipse DBS Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ECLDBM99
.
ECLDBM99  RETURN
+
.--------------------------------------------------------------------------
.*                             SEBAR000                                   *
.*               Schedule DBS Eclipse Processing Report (IBAOUT09)        *
.--------------------------------------------------------------------------
SEBAR000  MOVE      "IBAOUT09",SCHDPGID
          MOVE      "Eclipse DBS Processing Report",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAOUT09",SETDFPRG
          MOVE      "9",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
. 
          MOVE      ASSESKEY,KEYSTARR[1]    * key for prieahaf
          MOVE      ONE,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SEBAR999  RETURN
+
.--------------------------------------------------------------------------
. Option 15 - Eclipse DBS Processing Report Enquiry tags
.--------------------------------------------------------------------------
EBEN0000  BRANCH    FLDITMNO,EBEN0100,EBEN0200,EBEN0300,EBEN0400,EBEN0500:
                             EBEN0600,EBEN0700,EBEN0800,EBEN0900,EBEN1000:
                             EBEN1100,EBEN1200,EBEN1300,EBEN1400,EBEN1500:
                             EBEN1600,EBEN1700,EBEN1800
          GOTO      EBEN9999
.
EBEN0100  
.         GOTO      EBEN9999
.
EBEN0200  CALL      EAHB0000
          GOTO      EBEN9999
.
EBEN0300  WRITE     HTMLFILE;OTEHCLID;
          GOTO      EBEN9999
.
EBEN0400  WRITE     HTMLFILE;OTEHRPTC;
          GOTO      EBEN9999
.
EBEN0500  MOVE      ZERO,FORM6P2
          UNPACK    OTEHCLBP,DIM6,DIM2
          PACK      DIM9,DIM6,DOT,DIM2
          MOVE      DIM9,FORM6P2
          WRITE     HTMLFILE;FORM6P2;
          GOTO      EBEN9999
.
EBEN0600  MOVE      ZERO,FORM6P2
          UNPACK    OTEHCLCA,DIM6,DIM2
          PACK      DIM9,DIM6,DOT,DIM2
          MOVE      DIM9,FORM6P2
          WRITE     HTMLFILE;FORM6P2
          GOTO      EBEN9999
.
EBEN0700  MATCH     SP70,OTEHSDAT
          GOTO      EBEN9999 IF EQUAL
          UNPACK    OTEHSDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EBEN9999
.
EBEN0800  WRITE     HTMLFILE;OTEHSNAM;
          GOTO      EBEN9999
.
EBEN0900  WRITE     HTMLFILE;OTEHFNAM;
          GOTO      EBEN9999
.
EBEN1000  MOVE      ZERO,FORM1
          MOVE      "No Change",MEDSDESC
          MOVE      OTEHMECF,ANS
          REP       "A1I2C3W4S5X6",ANS
          MOVE      ANS,FORM1
          LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
                                   MEDSDES5,MEDSDES6
.
          WRITE     HTMLFILE;MEDSDESC;
          GOTO      EBEN9999
.
EBEN1100  WRITE     HTMLFILE;OTEHMNUM;
          GOTO      EBEN9999
. 
EBEN1200  WRITE     HTMLFILE;OTEHRNUM;
          GOTO      EBEN9999
.
EBEN1300  WRITE     HTMLFILE;OTEHSRVP;
          GOTO      EBEN9999
.
EBEN1400  WRITE     HTMLFILE;OTEHCTID;
          GOTO      EBEN9999
.
EBEN1500  MATCH     SP70,OTEHUDTE
          GOTO      EBEN9999 IF EQUAL
          UNPACK    OTEHUDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EBEN9999
.
EBEN1600  WRITE     HTMLFILE;OTEHUTIM;
          GOTO      EBEN9999
.
EBEN1700  WRITE     HTMLFILE;OTEHRKEY;
          GOTO      EBEN9999
.
EBEN1800  WRITE     HTMLFILE;OTEHCLID,OTEHRPTC,OTEHRKEY;
          GOTO      EBEN9999
.
EBEN9999  RETURN
+
.***************************************************************************
.*                             EAHB0000                                    *
.*   Display all dbs assessment reports                                    *
.***************************************************************************
EAHB0000  MATCH     "1",PTCNUEBB
          GOTO      EAHB9999 IF NOT EQUAL
.
          PACK      KEY33,SP70
          CALL      RSOTEAH1                     * position in file
EAHB1000  CALL      RKOTEAH1                     * read next record
          BRANCH    OVRCD,EAHB9999               * end of file
.
          PACK      KEY40,OTEHCTID,SP70
          CALL      RSOTECT6
          CALL      RKOTECT6
          BRANCH    OVRCD,EAHB1000
.
          MATCH     OTEHCTID,OTECTRID
          GOTO      EAHB1000 IF NOT EQUAL
. 
          MOVE      SP70,DIM11
          MATCH     SP70,OTEHSDAT
          IF        !@EQUAL & !@EOS
            UNPACK    OTEHSDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      "No Change",MEDSDESC
          MOVE      OTEHMECF,ANS
          REP       "A1I2C3W4S5X6",ANS
          MOVE      ANS,FORM1
          LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
                                   MEDSDES5,MEDSDES6

.
          MOVE      ZERO,FORM6P2
          UNPACK    OTEHCLBP,DIM6,DIM2
          PACK      DIM9,DIM6,DOT,DIM2
          MOVE      DIM9,FORM6P2
.
          MOVE      SP70,DIM30
          IF        FORM6P2 = ZERO
            MOVE      "<br>[No Payment Report]",DIM30
          ENDIF
.
          MOVE      ZERO,FORM6P2A
          UNPACK    OTEHCLCA,DIM6,DIM2
          PACK      DIM9,DIM6,DOT,DIM2
          MOVE      DIM9,FORM6P2A
.
          REP       " +",OTEHCLID
          REP       " +",OTEHRPTC
          REP       " +",OTEHRKEY
.
        WRITE     HTMLFILE;"t.addRow(#"","<img src='../images/CommentIcon.gif'":
                           " class=ListIcon onclick=displayProH('":
          OTEHCLID,"','",OTEHRPTC,"','",OTEHRKEY,"','002');> ";
.
          REP       "+ ",OTEHCLID
          REP       "+ ",OTEHRPTC
          REP       "+ ",OTEHRKEY
.
          WRITE     HTMLFILE;OTEHCLID,"#",";               * 0
.
          WRITE     HTMLFILE;"#"",OTEHRPTC,"#",":          * 1
                             "#"",FORM6P2,DIM30,"#",":     * 2
                             "#"",FORM6P2A,"#",":          * 3
                             "#"",OTEHSDAT,"#",":          * 4
                             "#"",OTEHSNAM,"#",":          * 5
                             "#"",OTEHFNAM,"#",":          * 6
                             "#"",MEDSDESC,"#",":          * 7
                             "#"",OTEHMNUM,"#",":          * 8
                             "#"",OTEHRNUM,"#",":          * 9
                             "#"",OTEHSRVP,"#",":          * 10
                             "#"",OTEHCTID,"#",":          * 11
                             "#"",OTEHUDTE,"#",":          * 12
                             "#"",OTEHUTIM,"#",":          * 13
                             "#"",OTEHRKEY,"#",";          * 14
.
          REP       " +",OTEHCLID
          REP       " +",OTEHRPTC
          REP       " +",OTEHRKEY
.
          WRITE     HTMLFILE;"#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=displayProH('":
          OTEHCLID,"','",OTEHRPTC,"','",OTEHRKEY,"','003');> ":
          "#",";                                           * 6
.
          WRITE     HTMLFILE;"#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=displayProH('":
          OTEHCLID,"','",OTEHRPTC,"','",OTEHRKEY,"','005');> ":
          "#");"                                           * 7
.
          REP       "+ ",OTEHCLID
          REP       "+ ",OTEHRPTC
          REP       "+ ",OTEHRKEY
.
          GOTO      EAHB1000
.
EAHB9999  RETURN
+
.--------------------------------------------------------------------------
. Option 15 - Eclipse DBS Assessing Report Details tags
.--------------------------------------------------------------------------
EBRD0000  BRANCH    FLDITMNO,EBRD0100,EBRD0200,EBRD0300,EBRD0400,EBRD0500:
                             EBRD0600,EBRD0700,EBRD0800,EBRD0900,EBRD1000:
                             EBRD1100
          GOTO      EBRD9999
.
EBRD0100  CALL      EADB0000
          GOTO      EBRD9999
.
EBRD0200  WRITE     HTMLFILE;OTEDCLID;
          GOTO      EBRD9999
.
EBRD0300  WRITE     HTMLFILE;OTEDRPTC;
          GOTO      EBRD9999
.
EBRD0400  WRITE     HTMLFILE;OTEDSRVI;
          GOTO      EBRD9999
.
EBRD0500  WRITE     HTMLFILE;OTEDSRVC;
          GOTO      EBRD9999
.
EBRD0600  WRITE     HTMLFILE;OTEDITMN;
          GOTO      EBRD9999
.
EBRD0700  MOVE      ZERO,FORM7P2
          UNPACK    OTEDSERB,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      EBRD9999
.
EBRD0800  WRITE     HTMLFILE;OTEDNOPA;
          GOTO      EBRD9999
.
EBRD0900  WRITE     HTMLFILE;OTEDEXPC;
          GOTO      EBRD9999
.
EBRD1000  WRITE     HTMLFILE;OTEDCTID;
          GOTO      EBRD9999
.
EBRD1100  WRITE     HTMLFILE;OTEDRKEY;
          GOTO      EBRD9999
.
EBRD9999  RETURN
+
.***************************************************************************
.*                             EADB0000                                    *
.*   Display imc assessment report details received for a claim            *
.***************************************************************************
EADB0000  MATCH     "1",PTCNUEBB
          GOTO      EADB9999 IF NOT EQUAL
.
          CALL      EADBH000
.
          PACK      KEY40,OTEHCLID,OTEHRPTC,SP70
          CALL      RSOTEAD1
EADB1000  CALL      RKOTEAD1
          BRANCH    OVRCD,EADB9999
.
          MATCH     OTEHCLID,OTEDCLID
          GOTO      EADB9999 IF NOT EQUAL
.
          MATCH     OTEHRPTC,OTEDRPTC
          GOTO      EADB9999 IF NOT EQUAL
.
          CALL      EADBR000
.
          GOTO      EADB1000
.
EADB9999  RETURN
+
.------------------------------------------------------------
. EAD DBS Assessment Details (TABLE HEADING)
.------------------------------------------------------------
EADBH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "No. of Patients&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation&nbsp;</td>":
                             "</tr>"
.
EADBH999  RETURN
+
.------------------------------------------------------------
. Eclipse Assessment Details (Detail Row)
.------------------------------------------------------------
EADBR000  REP       " +",OTEDCLID
          REP       " +",OTEDRPTC
          REP       " +",OTEDSRVI
          REP       " +",OTEDSRVC
          REP       " +",OTEDRKEY
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displayAssD('",OTEDCLID:
                             "','",OTEDRPTC,"','",OTEDSRVI,"','",OTEDSRVC:
                             "','",OTEDRKEY,"');>&nbsp;";
          REP       "+ ",OTEDCLID
          REP       "+ ",OTEDRPTC
          REP       "+ ",OTEDSRVI
          REP       "+ ",OTEDSRVC
          REP       "+ ",OTEDRKEY
.
          MOVE      ZERO,FORM7P2
          UNPACK    OTEDSERB,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
.
          MOVE      SP70,HCEMDESC
.
          MATCH     SP70,OTEDEXPC
          IF        !@EQUAL & !@EOS
            PACK      KEY3,OTEDEXPC,SP70
            CALL      RDHCEMS1
            IF        OVRCD=ONE
              MOVE      "No Description in hicemsaf",HCEMDESC
              PACK      HCEMDESC,HCEMDESC,SP70
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;OTEDCLID,"</td>":
                             "<td>",OTEDSRVI,"</td>":
                             "<td>",OTEDITMN,"</td>":
                             "<td>",FORM7P2,"</td>":
                             "<td>",OTEDNOPA,"</td>":
                             "<td>",OTEDEXPC,"</td>":
                             "<td>",HCEMDESC,"</td>":
                             "</tr>"
.
EADBR999  RETURN
+
.------------------------------------------------------------
.  Outputs a selection list of Medical Practices
.----------------------------------------------------------------
MPRSEL00  PACK      KEY6,SP70
          CALL      RSPRPR1
MPRSEL10  CALL      RKPRPR1
          BRANCH    OVRCD,MPRSEL99
.
          COMPARE   ONE,PRPRSTAT
          GOTO      MPRSEL10 IF EQUAL
.
          IF        IBCNMHOS = 1
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL & !@EOS
              MATCH     SP70,PRPRREGI
              IF        !@EQUAL & !@EOS
                PACK      KEY3,PRPRREGI,SP70
                CALL      RDREGA1
                IF        OVRCD=0
                  MATCH     HOSPCODE,REGHOSP
                  GOTO      MPRSEL10 IF NOT EQUAL
                ELSE
                  GOTO      MPRSEL10
                ENDIF
              ELSE
                GOTO    MPRSEL10
              ENDIF 
            ENDIF
          ENDIF
.
          MATCH     PRACTICE,PRPRCODE    * Default Medical Records Location
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#" selected>":
                                 "(",PRPRCODE,") ",PRPRDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#">":
                                 "(",PRPRCODE,") ",PRPRDESC,"</option>"
          ENDIF
.
          GOTO    MPRSEL10
.
MPRSEL99  RETURN
+
.------------------------------------------------------------
. Eclipse IMCW Claims Extract
.------------------------------------------------------------
IMWEXT00  MATCH     "1",PTCNWSIN
          GOTO      IMWEXT91 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      IMWEXT91 IF NOT EQUAL
.
          COMPARE   ONE,IMCWINDC
          GOTO      IMWEXT91 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      IMWEXT80 IF EQUAL
.
          MATCH     "H",UPDTTYPE    * List Claims by Health Fund
          GOTO      IMWEXT10 IF EQUAL
.
          MATCH     "M",UPDTTYPE    * List Claims by Medicare
          GOTO      IMWEXT20 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Extract Claims
          GOTO      IMWEXT30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Claims
          GOTO      IMWEXT40 IF EQUAL
.
          GOTO      IMWEXT85
.
IMWEXT10  MATCH     SP70,HFUNDTYP                * no code chosen yet
          GOTO      IMWEXT80 IF EQUAL
.
          PACK      KEY14,HFUNDTYP,ZERO4,SP70
          CALL      RDFUND1                      * HF on file ?
          BRANCH    OVRCD,IMWEXT93
.
          MOVE      HFUNDTYP,KEY6
          CALL      RDPTFX11                     * hfund extension record?
          BRANCH    OVRCD,IMWEXT93
.
          COMPARE   THREE,PTFXEXTR               * using Eclipse ?
          GOTO      IMWEXT94 IF NOT EQUAL
.
          MOVE      SP70,ECLKEY3
          MATCH     SP70,PTFXECLP
          IF        @EQUAL | @EOS
            MATCH     SP3,PTHFHGRP                 * blank health fund group ?
            GOTO      IMWEXT95 IF EQUAL
            MOVE      PTHFHGRP,ECLKEY3
          ELSE
            MOVE      PTFXECLP,ECLKEY3
          ENDIF
.
          MOVE      ECLKEY3,KEY3
          CALL      RDWBPAR1                     * participant code on file ?
          BRANCH    OVRCD,IMWEXT95
.
          MOVE      ECLKEY3,KEY3
          PACK      KEY9,KEY3,ANSI,ANSM,ANSC,SP70
          CALL      RSWBPCP1                     * IMC capability ?
          CALL      RKWBPCP1
          BRANCH    OVRCD,IMWEXT87
.
          MATCH     KEY3,WBPCCODE
          GOTO      IMWEXT87 IF NOT EQUAL
.
          MATCH     "IMC",WBPCCPID
          GOTO      IMWEXT87 IF NOT EQUAL
.
          CALL      MERW0000                     * reset any error records
          GOTO      IMWEXT80
.
IMWEXT20
.         MATCH     SP70,HFUNDTYP                * no code chosen yet
.         GOTO      IMWEXT80 IF EQUAL
.
.         MATCH     SP6,CVETINS                  * insurance code for DVA?
.         GOTO      IMWEXT97 IF EQUAL
.
.         PACK      KEY6,CVETINS,SP6
.         CALL      RDINSR1                      * insurance company on file ?
.         BRANCH    OVRCD,IMWEXT90
.
.         MOVE      CVETINS,KEY3
.         CALL      RDPTPAR1                     * participant code on file ?
.         BRANCH    OVRCD,IMWEXT95
.
.         MOVE      CVETINS,KEY3
.         PACK      KEY9,KEY3,ANSI,ANSH,ANSC,SP3
.         CALL      RDPTPCP1                     * IHC capability ?
.         BRANCH    OVRCD,IMWEXT87
.
.         PACK      KEY5,ANSC,ANSL,HFUNDTYP,SP5
.         CALL      RDCODE1
.         BRANCH    OVRCD,IMWEXT98
.
.         MOVE      ZERO,FORM1
.         WHILE     FORM1 < 5
.           ADD       ONE,FORM1
.           LOAD      ANS,FORM1,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
.           MATCH     ANSV,ANS                   * DVA code ?
.           GOTO      IMWEXT25 IF EQUAL          * yes
.         DO
.
.         GOTO      IMWEXT98
.
IMWEXT25  CALL      MERW0000                     * reset any error records
          GOTO      IMWEXT80
.
IMWEXT30  COMPARE   ZERO,LASTDCLM
          GOTO      IMWEXT35 IF EQUAL            * any claims to delete first ?
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,DECLMARR[COUNT]
            IF        !@EQUAL
              CALL      MDEW0000                 * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      IMWEXT35 IF EQUAL
.
          CALL      ERRLST00                     * display any delete errors
.>>>>     MOVE      ONE,EXIT
.>>>>     GOTO      IMWEXT99
.
IMWEXT35  
.         MATCH     "1",PTCNUIMC                 * using edi module?
.         GOTO      IMWEXT91 IF NOT EQUAL
.
.         MATCH     SP70,PTCNIMCO                * eclipse outbound path set?
.         GOTO      IMWEXT92 IF EQUAL
.
          COMPARE   ZERO,LASTECLM
          GOTO      IMWEXT86 IF EQUAL            * no claims to extract
.
          CALL      SMCWX000                     * Extract Eclipse Claims
.
          MOVE      ZERO,EXIT
          GOTO      IMWEXT99
.
.   ************ DELETE CLAIM FUNCTION ************
.>>>>
IMWEXT40  COMPARE   ZERO,LASTDCLM
          GOTO      IMWEXT86 IF EQUAL            * no claims to delete
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,DECLMARR[COUNT]
            IF        !@EQUAL
              CALL      MDEW0000   * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      IMWEXT99 IF EQUAL
.
          CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT80  CLEAR     WEBTITLE
          MOVE      "Eclipse IMC Claims Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IMWEXT99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT86  MOVE      "No claims selected to extract.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT87  MOVE      "Participant cannot accept IMCs.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT90  MOVE      "Insurance code not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT91  MOVE      "Hospital not using the WebServices Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT92  MOVE      "Eclipse IMC Outbound Path blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT93  MOVE      "Health Fund or extension record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT94  MOVE      "Health Fund not using Eclipse.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT95  MOVE      "Participant code blank or not on file.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT97  MOVE      "Insurance code for DVA is blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT98  MOVE      "Claim code not DVA related.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
IMWEXT99  RETURN
+
.*****************************************************************************
.*                               MDEW0000                                    *
.*               Delete selected WebServices IMCW Claim records              *
.*****************************************************************************
MDEW0000  MOVE      DECLMARR[COUNT],KEY8    * invoice number
          PACK      KEY16,KEY8,SP70         * batch number is blank
          CALL      RDWBIMC2
          BRANCH    OVRCD,MDEW8000
.
          MOVE      WBIMINVN,TEMPINVN
          MOVE      WBIMBATN,TEMPBATN
          MOVE      WBIMUNIQ,TEMPADMN
          MOVE      WBIMURNO,TEMPURNO
          MOVE      WBIMHFND,TEMPHFND
          MOVE      WBIMPBAT,TEMPPBAT
          MOVE      WBIMHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      MDEW1000 IF EQUAL
          GOTO      MDEW1000 IF EOS
.
          PACK      KEY35,TEMPHOSP,TWENTY1,TEMPHFND,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDWBIMC1
          IF        OVRCD = 1
            GOTO      MDEW7000
          ELSE
            MOVE      SP70,WBIMNBAT
            CALL      IBACLOCK
            PACK      WBIMUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBIMUDAT
            MOVE      CTIMEIS,WBIMUTIM
            MOVE      USERID,WBIMUUID
            CALL      UPWBIMC1
          ENDIF
.
.         Delete the selected record
.
MDEW1000  PACK      KEY35,TEMPHOSP,SP1,ZERO,TEMPHFND,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEWBIMC1
.
          GOTO      MDEW9999
.
MDEW7000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      MDEW9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Error updating previous claim - ",ERRORLST[ERRORCNT]
          APPEND    WBIMINVN,ERRORLST[ERRORCNT]
          APPEND    "  Batch - ",ERRORLST[ERRORCNT]
          APPEND    WBIMBATN,ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      MDEW9999
.
MDEW8000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      MDEW9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Record cannot be deleted.  ",ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      MDEW9999

MDEW9999  RETURN
+
.*****************************************************************************
.*                              MERW0000           Called by: IMWEXT00       *
.*             Reset error records back to zero status (Not Sent)            *
.*             just in case there were any problems with a previous          *
.*             batch and the error records were not set back to zero.        *
.*****************************************************************************
.
MERW0000  MOVE      HOSPCODE,SAVEHOSP            * initialise hospital
          MOVE      ZERO,FIRSTFLG                * initialise flag
.
          PACK      KEY35,HOSPCODE,SP1,ONE,HFUNDTYP,SP30,SP10
MERW0500  CALL      RSWBIMC1                     * position in file
          CALL      RKWBIMC1                     * read next record
          BRANCH    OVRCD,MERW9999               * eof - finished
.
          IF        FIRSTFLG = 0
            MATCH     SP3,HOSPCODE               * all hospitals extract ?
            IF        @EQUAL
              MOVE      WBIMHOSP,SAVEHOSP        * yes-load first hospital code
            ENDIF
            MOVE      ONE,FIRSTFLG               * set first flag to no
          ENDIF
.
          MATCH     SP3,HOSPCODE                 * all hospitals extract ?
          GOTO      MERW5000 IF NOT EQUAL        * no
.
.         We are running an extract for all hospitals
.
          MATCH     SAVEHOSP,WBIMHOSP            * same hospital still ?
          IF        !@EQUAL
            MOVE      WBIMHOSP,SAVEHOSP          * no - save new hospital code
            PACK      KEY35,WBIMHOSP,SP1,ONE,HFUNDTYP,SP30,SP10
            GOTO      MERW0500
          ENDIF
.
          COMPARE   ONE,WBIMFLAG                 * error record still ?
          GOTO      MERW4000 IF NOT EQUAL        * no - get next hospital
.
          MATCH     HFUNDTYP,WBIMHFND            * same health fund still ?
          GOTO      MERW4000 IF NOT EQUAL        * no - finished
.
          GOTO      MERW8000
.
MERW4000  PACK      KEY35,WBIMHOSP,Z70
          GOTO      MERW0500
.
.         We are running an extract for a given hospital id
.
MERW5000  MATCH     HOSPCODE,WBIMHOSP            * same hospital still ?
          GOTO      MERW9999 IF NOT EQUAL        * no - finished
.
          COMPARE   ONE,WBIMFLAG                 * error record still ?
          GOTO      MERW9999 IF NOT EQUAL        * no - finished
.
          MATCH     HFUNDTYP,WBIMHFND            * same health fund still ?
          GOTO      MERW9999 IF NOT EQUAL        * no - finished
.
.         Reset the record status to "Waiting"
.
MERW8000  PACK      SAVKEY35,WBIMHOSP,WBIMFLAG,WBIMHFND,WBIMUNIQ,WBIMINVN:
                             WBIMBATN
          MOVE      ZERO,WBIMFLAG                * yes - reset flag to "0"

          CALL      IBACLOCK
          PACK      WBIMUDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBIMUDAT
          MOVE      CTIMEIS,WBIMUTIM
          MOVE      USERID,WBIMUUID
          CALL      UPWBIMC1                     * update record
          MOVE      SAVKEY35,KEY35               * load key to reposition
          GOTO      MERW0500                     * get next record
.
MERW9999  RETURN
+
.--------------------------------------------------------------------------
.*                             SMCWX000                                   *
.*               Schedule Eclipse Extract (IBAWEB07)                      *
.--------------------------------------------------------------------------
SMCWX000  MOVE      "IBAWEB07",SCHDPGID
          MOVE      "WebServices IMCW Claims Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAWEB07",SETDFPRG
          MOVE      "11",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ONE,COUNT
          MOVE      HOSPCODE,KEYSTARR[COUNT]    * hospital id
          ADD       ONE,COUNT
          MOVE      OPTNFLAG,KEYSTARR[COUNT]    * extract by fund(1)/medicare(2)
.
          COMPARE   TWO,OPTNFLAG
          GOTO      MWCLX500 IF EQUAL
.
.          MATCH     "1",FILTOPTN
.          IF        @EQUAL
.            MOVE      THREE,KEYSTARR[COUNT]      * Replace OPTNFLAG with zero
.            GOTO      MWCLX500                  * All extract types are selected
.         ENDIF
.
          ADD       ONE,COUNT
          MOVE      HFUNDTYP,KEYSTARR[COUNT]    * health fund
.
          MOVE      THREE,TOTALCNT              * first 3 keyins
          GOTO      MWCLX600
.
MWCLX500  MOVE      TWO,TOTALCNT
.
MWCLX600  ADD      ONE,COUNT
          MOVE     ONE,COUNTEC
          WHILE     COUNTEC <= LASTECLM
            MATCH     SP90,ECCLMARR[COUNTEC]
            IF        !@EQUAL
              MOVE      ECCLMARR[COUNTEC],KEYSTARR[COUNT]    * to be extracted
            ENDIF
            ADD      ONE,COUNT
            ADD      ONE,COUNTEC
          DO
.
          ADD       LASTECLM,TOTALCNT            * eclipse claims keyins
.
          PACK      KEYSTARR[COUNT],SP70         * blank record to signal exit
          ADD       ONE,COUNT
          ADD       ONE,TOTALCNT
.
          MOVE      ANSP,KEYSTARR[COUNT]         * (P)ost
.>>>>
.>>>>     ADD       ONE,COUNT
.>>>>     MOVE      ANSY,KEYSTARR[COUNT]         * (Y) to extract (if ok)
.>>>>
          ADD       ONE,COUNT
          MOVE      SP70,KEYSTARR[COUNT]         * (Enter) to exit
          ADD       ONE,COUNT
          MOVE      "\",KEYSTARR[COUNT]          * (\) to exit
.
          ADD       THREE,TOTALCNT               * add last 3 keyins (if error)
.>>>>     ADD       FOUR,TOTALCNT                * add last 4 keyins (if ok)
          MOVE      TOTALCNT,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SMCWX999  RETURN
+
.--------------------------------------------------------------------------
. Option 16 - WebServices IMCW Claims Extract tags
.--------------------------------------------------------------------------
MEXW0000  BRANCH    FLDITMNO,MEXW0100,MEXW0200,MEXW0300,MEXW0400,MEXW0500:
                             MEXW0600,MEXW0700,MEXW0800,MEXW0900
          GOTO      MEXW9999
.
MEXW0100  MOVE      ONE,ALLHFLAG          * default to 'All'
          CALL      HOSPID00              * display Multi-hosp. selection list
          GOTO      MEXW9999
.
MEXW0200  CALL      ECSHN000              * selected Hospital Desc (Multi-hosp)
          GOTO      MEXW9999
.
MEXW0300
.         MOVE      "CL",CATEGORY         * Compensation code/Claim Type
.         MOVE      HFUNDTYP,CODE
.         CALL      CODITM00
          GOTO      MEXW9999
.
MEXW0400  CALL      WCWFX000              * Claims Waiting for Extraction
          GOTO      MEXW9999
.
MEXW0500  MATCH     SP70,UPDTTYPE
          GOTO      MEXW9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI
          GOTO      MEXW9999
.
MEXW0600
.         WRITE     HTMLFILE;CLAMTYPE;    * Claim type CGI
          GOTO      MEXW9999
.
MEXW0700  MATCH     SP70,HFUNDTYP
          GOTO      MEXW9999 IF EQUAL
          WRITE     HTMLFILE;HFUNDTYP;    * Health Fund CGI
          GOTO      MEXW9999
.
MEXW0800  WRITE     HTMLFILE;HFUNDESC;    * Health Fund Desc CGI
          GOTO      MEXW9999
.
MEXW0900  MOVE      USERID,KEY10
          CALL      RDPRALS1
          BRANCH    OVRCD,MEXW0910
          MOVE      FILTPRAC,PRACTICE
          CALL      MPRSEL00
          GOTO      MEXW9999
.
MEXW0910  MOVE      USERID,KEY16
          CALL      RSPRSEC2
MEXW0915  CALL      RKPRSEC2
          BRANCH    OVRCD,MEXW9999
.
          MATCH     USERID,PRSEUSID
          GOTO      MEXW9999 IF NOT EQUAL
.
          MOVE      PRSEPRAC,KEY6
          CALL      RDPRPR1
          IF        OVRCD=1
            MOVE      "Unknown Practice",PRPRDESC
          ENDIF
.
          MOVE      FILTPRAC,DIM6
          MATCH     DIM6,PRPRCODE    * Default Medical Prac
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#" selected>":
                                 "(",PRPRCODE,") ",PRPRDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#">":
                                 "(",PRPRCODE,") ",PRPRDESC,"</option>"
          ENDIF
.
          GOTO      MEXW0915
.
MEXW9999  RETURN
+
.------------------------------------------------------------
. Table of all WebServices IMCW Claims Waiting For Extraction
.------------------------------------------------------------
WCWFX000  MATCH     "1",PTCNWSIN
          GOTO      WCWFX999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      WCWFX999 IF NOT EQUAL
.
          COMPARE   ONE,IMCWINDC
          GOTO      WCWFX999 IF NOT EQUAL
.
          MOVE      ZERO,FORM3
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.          MATCH     "1",FILTOPTN
.          IF        !@EQUAL
.            MATCH     HFUNDTYP,SP70           * cannot have blank code
.            GOTO      WCWFX900 IF EQUAL
.          ENDIF
.
          PACK      KEY35,HOSPCODE,SP1,ZERO,SP70
WCWFX040  CALL      RSWBIMC1
WCWFX050  CALL      RKWBIMC1                * read next record
          BRANCH    OVRCD,WCWFX900          * end of file
.
          MATCH     SP3,HOSPCODE                 * all hospitals ?
          IF        !@EQUAL
            MATCH     HOSPCODE,WBIMHOSP          * no - same hospital still ?
            GOTO      WCWFX900 IF NOT EQUAL      * no - finished
          ENDIF
.
          COMPARE   ZERO,WBIMFLAG                * waiting for extract still ?
          IF        !@EQUAL
            PACK      KEY35,WBIMHOSP,Z70
            GOTO      WCWFX040                   * get next record
          ENDIF
.
          MATCH     SP70,FILTPRAC
          IF        !@EQUAL & !@EOS
            PACK      FILTPRAC,FILTPRAC,SP70
            MATCH     FILTPRAC,WBIMPRAC
            GOTO      WCWFX050 IF NOT EQUAL
          ENDIF
.
.          MATCH     "1",FILTOPTN
.          GOTO      WCWFX200 IF EQUAL
.
.         Processing by Health Fund (option 1) or medicare (option 2)
.
          IF        OPTNFLAG = 1
            MATCH     HFUNDTYP,WBIMHFND          * same health fund ?
            GOTO      WCWFX050 IF NOT EQUAL      * no - ignore record
.
            MATCH     SP70,WBIMEETP
            GOTO      WCWFX050 IF EQUAL
.
            MATCH     "2",WBIMEETP
            GOTO      WCWFX050 IF EQUAL
.
            GOTO      WCWFX200
          ENDIF
.
.         Processing by medicare option
.
WCWFX100  MATCH     "2",WBIMEETP                 * medicare only?
          GOTO      WCWFX050 IF NOT EQUAL        * no - ignore record
.
.         A waiting record for the health fund/medicare has been found,
.         so get the invoice details and calculate the amount outstanding.
.
WCWFX200  CALL      WCLRW000      * Output Row
          IF        DISNUMB>=50
            GOTO      WCWFX800
          ENDIF
          GOTO      WCWFX050
.
WCWFX800  CALL      LIMREC00        * Show batch limit reached message
          GOTO      WCWFX999
.
WCWFX900  CALL      TOTREC00        * Show no more records message
.
WCWFX999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse IMC (TABLE ROW)
.------------------------------------------------------------
WCLRW000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,WBIMINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP8,PRINDATE
          ELSE
            IF        PRINUNIQ = 0
              GOTO      WCLRW900                 * delete claim
            ENDIF
            ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM12P2
            IF        IBCNUGST=2
              ADD       PRINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PRINDATE
          IF        !@EQUAL
            UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;WBIMUNIQ,"&nbsp;</td>":
                             "<td>",WBIMINVN,"&nbsp;</td>":
                             "<td>",WBIMURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",WBIMHOSP,WBIMUNIQ,WBIMINVN:
                                        WBIMURNO,PRINDATE,KEY15:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=declm",KEY3:
                             " value='",WBIMINVN:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      WCLRW999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in pmsectaf
.
WCLRW900  PACK      SAVKEY35,WBIMHOSP,WBIMFLAG,WBIMHFND,WBIMUNIQ,WBIMINVN:
                             WBIMBATN
          MOVE      SAVKEY35,KEY35
          CALL      DEWBIMC1                 * delete cancelled/zero invoices
          MOVE      SAVKEY35,KEY35
          CALL      RSWBIMC1
.
WCLRW999  RETURN
+
.------------------------------------------------------------
. WebServices IMCW Assessing Report Enquiry
.------------------------------------------------------------
IMWPRM00  MATCH     "1",PTCNWSIN
          GOTO      IMWPRM88 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      IMWPRM88 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      IMWPRM80 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Assessment Report 
          GOTO      IMWPRM10 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Assessment Report Medicare Event
          GOTO      IMWPRM20 IF EQUAL
.
          MATCH     "F",UPDTTYPE    * Assessment Report Medicare Services
          GOTO      IMWPRM30 IF EQUAL
.
          MATCH     "G",UPDTTYPE    * Assessment Report HF Event
          GOTO      IMWPRM40 IF EQUAL
.
          MATCH     "H",UPDTTYPE    * Assessment Report HF Services
          GOTO      IMWPRM50 IF EQUAL
.
          MATCH     "P",UPDTTYPE    * Print Assessment Report
          GOTO      IMWPRM60 IF EQUAL
.
          GOTO      IMWPRM86
.
IMWPRM10  PACK      KEY32,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,SP70
          CALL      RDWBIMD1
          BRANCH    OVRCD,IMWPRM81
.
          GOTO      IMWPRM80
.
IMWPRM20  PACK      KEY34,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,ECPREVCN,SP70
          CALL      RDWBIME1
          BRANCH    OVRCD,IMWPRM82
.
          GOTO      IMWPRM80
.
IMWPRM30  PACK      KEY38,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,ECPREVCN:
                          ECPRSVCN,SP70
          CALL      RDWBIMF1
          BRANCH    OVRCD,IMWPRM83
.
          GOTO      IMWPRM80
.
IMWPRM40  PACK      KEY34,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,ECPREVCN,SP70
          CALL      RDWBIMG1
          BRANCH    OVRCD,IMWPRM84
.
          GOTO      IMWPRM80
.
IMWPRM50  PACK      KEY38,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,ECPREVCN:
                          ECPRSVCN,SP70
          CALL      RDWBIMH1
          BRANCH    OVRCD,IMWPRM85
.
          GOTO      IMWPRM80
.
IMWPRM60  CALL      SIMCW000      * Schedule print Assessment Report
.
          MOVE      ZERO,EXIT
          GOTO      IMWPRM99
.
IMWPRM80  CLEAR     WEBTITLE
          MOVE      "Eclipse Assessing Report Enquiry",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IMWPRM99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IMWPRM99
.
IMWPRM81  MOVE      "webimdaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWPRM99
.
IMWPRM82  MOVE      "webimeaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWPRM99
.
IMWPRM83  MOVE      "webimfaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWPRM99
.
IMWPRM84  MOVE      "webimgaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWPRM99
.
IMWPRM85  MOVE      "webimhaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWPRM99
.
IMWPRM86  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWPRM99
.
IMWPRM88  MOVE      "Not using WebServices IMCW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWPRM99
.
IMWPRM99  RETURN
+
.--------------------------------------------------------------------------
.*                             SIMCW000                                   *
.*               Schedule IMCW WebServices Assessment Report (IBAWEB09)   *
.--------------------------------------------------------------------------
SIMCW000  MOVE      "IBAWEB09",SCHDPGID
          MOVE      "WebServices IMCW Assessment Report",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAWEB09",SETDFPRG
          MOVE      "9",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ASSESKEY,KEYSTARR[1]    * key for prieahaf
          MOVE      ONE,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SIMCW999  RETURN
+
.--------------------------------------------------------------------------
. Option 17 - WebServices IMCW Assessing Report Enquiry tags
.--------------------------------------------------------------------------
IMWD0000  BRANCH    FLDITMNO,IMWD0100,IMWD0200,IMWD0300,IMWD0400,IMWD0500:
                             IMWD0600,IMWD0700,IMWD0800,IMWD0900,IMWD1000:
                             IMWD1100,IMWD1200,IMWD1300,IMWD1400,IMWD1500:
                             IMWD1600,IMWD1700,IMWD1800,IMWD1900,IMWD2000:
                             IMWD2100,IMWD2200,IMWD2300
          GOTO      IMWD9999
.
IMWD0100  UNPACK    DIM127,D1,DIM1,DIM127
          MOVE      ZERO,FORM1
          MOVE      DIM1,FORM1
          BRANCH    FORM1,IMWD0110
.
          WRITE     HTMLFILE;PARTCODE;
          GOTO      IMWD9999
.
IMWD0110  PACK      KEY3,PARTCODE,SP70
          CALL      RDWBPAR1
          BRANCH    OVRCD,IMWD9999
.
          WRITE     HTMLFILE;WBPRNAME;
          GOTO      IMWD9999
.
IMWD0200  CALL      IMDM0000
          GOTO      IMWD9999
.
IMWD0300  WRITE     HTMLFILE;WBIDFBID;
          GOTO      IMWD9999
.
IMWD0400  WRITE     HTMLFILE;WBIDARID;
          GOTO      IMWD9999
.
IMWD0500  WRITE     HTMLFILE;WBIDCLID;
          GOTO      IMWD9999
.
IMWD0600  WRITE     HTMLFILE;WBIDRPTC;
          GOTO      IMWD9999
.
IMWD0700  WRITE     HTMLFILE;WBIDMCGN;
          GOTO      IMWD9999
.
IMWD0800  WRITE     HTMLFILE;WBIDMCMN;
          GOTO      IMWD9999
.
IMWD0900  WRITE     HTMLFILE;WBIDMCRN;
          GOTO      IMWD9999
.
IMWD1000  WRITE     HTMLFILE;WBIDHFEC;
          GOTO      IMWD9999
.
IMWD1100  MOVE      ZERO,FORM1
          MOVE      SP70,ASESDESC
          MOVE      WBIDHFAC,ANS
          REP       "A1R2W3C4",ANS
          MOVE      ANS,FORM1
          LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4
.
          WRITE     HTMLFILE;ASESDESC;
          GOTO      IMWD9999
.
IMWD1200  
.         MOVE      ZERO,FORM1
.         MOVE      "No Change",MEDSDESC
.         MOVE      PRAHMCFC,ANS
.         REP       "A1I2C3W4S5X6",ANS
.         MOVE      ANS,FORM1
.         LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
.                                  MEDSDES5,MEDSDES6
.
.         WRITE     HTMLFILE;MEDSDESC;
          GOTO      IMWD9999
.
IMWD1300  WRITE     HTMLFILE;WBIDMSTC;
          GOTO      IMWD9999
.
IMWD1400  WRITE     HTMLFILE;WBIDMAFN;
          GOTO      IMWD9999
.
IMWD1500  WRITE     HTMLFILE;WBIDMAGN;
          GOTO      IMWD9999
.
IMWD1600  WRITE     HTMLFILE;WBIDMAMN;
          GOTO      IMWD9999
.
IMWD1700  WRITE     HTMLFILE;WBIDMARN;
          GOTO      IMWD9999
.
IMWD1800  
.         MOVE      ZERO,FORM2
.         MOVE      "UNKNOWN",PRCSDESC
.         MOVE      PRAHSTAT,FORM2
.         LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
.                                  PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
.                                  PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
.                                  PRCSDE10,PRCSDE11
.
.         WRITE     HTMLFILE;PRCSDESC;
.         GOTO      IMWD9999
.
IMWD1900  WRITE     HTMLFILE;WBIDTRID;
          GOTO      IMWD9999
.
IMWD2000  MATCH     SP70,WBIDUDAT
          GOTO      IMWD9999 IF EQUAL
          UNPACK    WBIDUDAT,CCENT,CYEAR,CMON,CDAY  * Service Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      IMWD9999
.
IMWD2100  WRITE     HTMLFILE;WBIDUTIM;
          GOTO      IMWD9999
.
IMWD2200  WRITE     HTMLFILE;WBIDFBID,WBIDARID,WBIDCLID,WBIDRPTC;
          GOTO      IMWD9999
.
IMWD2300  WRITE     HTMLFILE;EXTRTYPE;
          GOTO      IMWD9999
.
IMWD9999  RETURN
+
.***************************************************************************
.*                             IMDM0000                                    *
.*   Display all imcw assessment reports received from a given participant *
.***************************************************************************
IMDM0000  MATCH     "1",PTCNWSIN
          GOTO      IMDM9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      IMDM9999 IF NOT EQUAL
.
          MATCH     SP70,EXTRTYPE
          GOTO      IMDM9999 IF EQUAL
.
          PACK      PARTCODE,PARTCODE,SP70
.
          MATCH     "2",EXTRTYPE
          IF        !@EQUAL
            MATCH     SP70,PARTCODE
            GOTO      IMDM9999 IF EQUAL
          ENDIF
.
          PACK      KEY32,PARTCODE,SP70
          CALL      RSWBIMD1                     * position in file
IMDM1000  CALL      RKWBIMD1                     * read next record
          BRANCH    OVRCD,IMDM9999               * end of file
.
          MATCH     PARTCODE,WBIDFBID
          GOTO      IMDM9999 IF NOT EQUAL
.
          PACK      KEY40,WBIDTRID,SP70
          CALL      RSWBIMC6
          CALL      RKWBIMC6
          BRANCH    OVRCD,IMDM1000
.
          MATCH     WBIDTRID,WBIMTRID
          GOTO      IMDM1000 IF NOT EQUAL
.
          MATCH     "1",EXTRTYPE
          IF        @EQUAL
            MATCH     "0",WBIMEETP
            IF        !@EQUAL
              MATCH     "1",WBIMEETP
              GOTO      IMDM1000 IF NOT EQUAL
            ENDIF
          ELSE
            MATCH     EXTRTYPE,WBIMEETP
            GOTO      IMDM1000 IF NOT EQUAL
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      WBIDHFAC,STATKEY1
          REP       "A1R2W3C4",STATKEY1
          MOVE      STATKEY1,FORM1
          MOVE      SP70,CLAMDESC
          LOAD      CLAMDESC,FORM1,CLAMST01,CLAMST02,CLAMST03,CLAMST04
.
.         MOVE      ZERO,FORM1
.         MOVE      "No Change",MEDSDESC
.         MOVE      PRAHMCFC,ANS
.         REP       "A1I2C3W4S5X6",ANS
.         MOVE      ANS,FORM1
.         LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
.                                  MEDSDES5,MEDSDES6
.
          PACK      MEDSDESC,WBIDMSTT,SP70
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIDMALD
          IF        !@EQUAL & !@EOS
            UNPACK    WBIDMALD,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
.         MOVE      ZERO,FORM2
.         MOVE      "UNKNOWN",PRCSDESC
.         MOVE      PRAHSTAT,FORM2
.         LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
.                                  PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
.                                  PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
.                                  PRCSDE10,PRCSDE11
.
          PACK      PRCSDESC,WBIDRPST,SP70
.
          REP       " +",WBIDFBID
          REP       " +",WBIDARID
          REP       " +",WBIDCLID
          REP       " +",WBIDRPTC
.
        WRITE     HTMLFILE;"t.addRow(#"","<img src='../images/CommentIcon.gif'":
                           " class=ListIcon onclick=displayProH('":
          WBIDFBID,"','",WBIDARID,"','",WBIDCLID,"','",WBIDRPTC,"','002');> ";
.
          REP       "+ ",WBIDFBID
          REP       "+ ",WBIDARID
          REP       "+ ",WBIDCLID
          REP       "+ ",WBIDRPTC
.
          WRITE     HTMLFILE;WBIDARID,"#",";               * 0
.
          WRITE     HTMLFILE;"#"",WBIDCLID,"#",":          * 1
                             "#"",WBIDRPTC,"#",":          * 2
                             "#"",CLAMDESC,"#",":          * 3
                             "#"",WBIDMCGN,"#",":          * 4
                             "#"",WBIDMCMN,"#",":          * 5
                             "#"",WBIDMCRN,"#",":          * 6
                             "#"",WBIDHFSC,"#",":          * 7
                             "#"",MEDSDESC,"#",":          * 8
                             "#"",WBIDMSTC,"#",":          * 9
                             "#"",WBIDMAFN,"#",":          * 10
                             "#"",WBIDMAGN,"#",":          * 11
                             "#"",WBIDMAMN,"#",":          * 12
                             "#"",WBIDMARN,"#",":          * 13
                             "#"",PRCSDESC,"#",":          * 14
                             "#"",WBIDTRID,"#",":          * 15
                             "#"",DIM11,"#",";             * 16
.
          REP       " +",WBIDFBID
          REP       " +",WBIDARID
          REP       " +",WBIDCLID
          REP       " +",WBIDRPTC
.
          WRITE     HTMLFILE;"#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=displayProE('":
          WBIDFBID,"','",WBIDARID,"','",WBIDCLID,"','",WBIDRPTC,"','003');> ":
          "#",";                                       
.
          WRITE     HTMLFILE;"#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=displayProE('":
          WBIDFBID,"','",WBIDARID,"','",WBIDCLID,"','",WBIDRPTC,"','007');> ":
          "#");"                                      
.
          REP       "+ ",WBIDFBID
          REP       "+ ",WBIDARID
          REP       "+ ",WBIDCLID
          REP       "+ ",WBIDRPTC
.
          GOTO      IMDM1000
.
IMDM9999  RETURN
+
.--------------------------------------------------------------------------
. WebServices IMCW webimeaf tags
.--------------------------------------------------------------------------
IMWE0000  BRANCH    FLDITMNO,IMWE0100,IMWE0200,IMWE0300,IMWE0400,IMWE0500:
                             IMWE0600,IMWE0700,IMWE0800,IMWE0900,IMWE1000:
                             IMWE1100,IMWE1200,IMWE1300,IMWE1400,IMWE1500:
                             IMWE1600,IMWE1700

          GOTO      IMWE9999
.
IMWE0100  CALL      IMEM0000
          GOTO      IMWE9999
.
IMWE0200  WRITE     HTMLFILE;WBIEFBID;
          GOTO      IMWE9999
.
IMWE0300  WRITE     HTMLFILE;WBIEARID;
          GOTO      IMWE9999
.
IMWE0400  WRITE     HTMLFILE;WBIECLID;
          GOTO      IMWE9999
.
IMWE0500  WRITE     HTMLFILE;WBIERPTC;
          GOTO      IMWE9999
.
IMWE0600  WRITE     HTMLFILE;WBIEMECN;
          GOTO      IMWE9999
.
IMWE0700  WRITE     HTMLFILE;WBIEMEID;
          GOTO      IMWE9999
.
IMWE0800  WRITE     HTMLFILE;WBIECFCD;
          GOTO      IMWE9999
.
IMWE0900  WRITE     HTMLFILE;WBIECPSC;
          GOTO      IMWE9999
.
IMWE1000  WRITE     HTMLFILE;WBIECPST;
          GOTO      IMWE9999
.
IMWE1100  WRITE     HTMLFILE;WBIECPST;
          GOTO      IMWE9999
.
IMWE1200  WRITE     HTMLFILE;WBIECPMN;
          GOTO      IMWE9999
.
IMWE1300  WRITE     HTMLFILE;WBIECPRN;
          GOTO      IMWE9999
.
IMWE1400  WRITE     HTMLFILE;WBIECPFN;
          GOTO      IMWE9999
.
IMWE1500  WRITE     HTMLFILE;WBIECPGN;
          GOTO      IMWE9999
.
IMWE1600  WRITE     HTMLFILE;WBIETRID;
          GOTO      IMWE9999
.
IMWE1700  WRITE     HTMLFILE;WBIEMSID;
          GOTO      IMWE9999
.
IMWE9999  RETURN
+
.***************************************************************************
.*                             IMEM0000                                    *
.*   Display imcw medicare assessment report details received for a claim  *
.***************************************************************************
IMEM0000  MATCH     "1",PTCNWSIN
          GOTO      IMEM9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      IMEM9999 IF NOT EQUAL
.
          CALL      IMEMH000
.
          PACK      KEY34,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,SP70
          CALL      RSWBIME1
IMEM1000  CALL      RKWBIME1
          BRANCH    OVRCD,IMEM9999
.
          MATCH     ECPRPTCD,WBIEFBID
          GOTO      IMEM9999 IF NOT EQUAL
.
          MATCH     ECPRINVN,WBIEARID
          GOTO      IMEM9999 IF NOT EQUAL
.
          MATCH     ECPRCLID,WBIECLID
          GOTO      IMEM9999 IF NOT EQUAL
.
          MATCH     ECPRREPT,WBIERPTC
          GOTO      IMEM9999 IF NOT EQUAL
.
          CALL      IMEMR000
.
          GOTO      IMEM1000
.
IMEM9999  RETURN
+
.------------------------------------------------------------
. IME IMCW Medicare Assessment Details (TABLE HEADING)
.------------------------------------------------------------
IMEMH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Brand ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Account<br>Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "MedicalEvent ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Card Flag Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Status Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top width=30%>":
                             "Status Text&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Member Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Member Ref Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Family Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Given Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Services&nbsp;</td>":
                             "</tr>"
.
IMEMH999  RETURN
.------------------------------------------------------------
. WebServices Medicare Assessment Details (Detail Row)
.------------------------------------------------------------
IMEMR000  REP       " +",WBIEFBID
          REP       " +",WBIEARID
          REP       " +",WBIECLID
          REP       " +",WBIERPTC
          REP       " +",WBIEMECN
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displayAssD('",WBIEFBID:
                             "','",WBIEARID,"','",WBIECLID,"','",WBIERPTC:
                             "','",WBIEMECN,"');>&nbsp;";
          REP       "+ ",WBIEFBID
          REP       "+ ",WBIEARID
          REP       "+ ",WBIECLID
          REP       "+ ",WBIERPTC
          REP       "+ ",WBIEMECN
.
          WRITE     HTMLFILE;WBIEFBID,"</td>":
                             "<td>",WBIEARID,"</td>":
                             "<td>",WBIECLID,"</td>":
                             "<td>",WBIEMEID,"</td>":
                             "<td>",WBIECFCD,"</td>":
                             "<td>",WBIECPSC,"</td>":
                             "<td>",WBIECPST,"</td>":
                             "<td>",WBIECPMN,"</td>":
                             "<td>",WBIECPRN,"</td>":
                             "<td>",WBIECPFN,"</td>":
                             "<td>",WBIECPGN,"</td>";
          REP       " +",WBIEFBID
          REP       " +",WBIEARID
          REP       " +",WBIECLID
          REP       " +",WBIERPTC
          REP       " +",WBIEMECN
          WRITE     HTMLFILE;"<td><img src='../images/EditIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",WBIEFBID:
                             "','",WBIEARID,"','",WBIECLID,"','",WBIERPTC:
                             "','",WBIEMECN,"','005');>":
                             "</td>":
                             "</tr>"
          REP       "+ ",WBIEFBID
          REP       "+ ",WBIEARID
          REP       "+ ",WBIECLID
          REP       "+ ",WBIERPTC
          REP       "+ ",WBIEMECN
.
IMEMR999  RETURN
+
.--------------------------------------------------------------------------
. WebServices IMCW Medicare Assessment Services tags webimfaf
.--------------------------------------------------------------------------
IMWF0000  BRANCH    FLDITMNO,IMWF0100,IMWF0200,IMWF0300,IMWF0400,IMWF0500:
                             IMWF0600,IMWF0700,IMWF0800,IMWF0900,IMWF1000:
                             IMWF1100,IMWF1200,IMWF1300,IMWF1400,IMWF1500 
          GOTO      IMWF9999
.
IMWF0100  CALL      IMFM0000
          GOTO      EMRS9999
.
IMWF0200  WRITE     HTMLFILE;WBIFFBID;
          GOTO      IMWF9999
.
IMWF0300  WRITE     HTMLFILE;WBIFARID;
          GOTO      IMWF9999
.
IMWF0400  WRITE     HTMLFILE;WBIFCLID;
          GOTO      IMWF9999
.
IMWF0500  WRITE     HTMLFILE;WBIFRPTC;
          GOTO      IMWF9999
.
IMWF0600  WRITE     HTMLFILE;WBIFMECN;
          GOTO      IMWF9999
.
IMWF0700  WRITE     HTMLFILE;WBIFSVCN;
          GOTO      IMWF9999
.
IMWF0800  WRITE     HTMLFILE;WBIFMEID;
          GOTO      IMWF9999
.
IMWF0900  WRITE     HTMLFILE;WBIFSVID;
          GOTO      IMWF9999
.
IMWF1000  MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIFSVBE 
          UNPACK    WBIFSVBE,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      IMWF9999
.
IMWF1100  MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIFSVCA
          UNPACK    WBIFSVCA,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2; 
          GOTO      IMWF9999
.
IMWF1200  MATCH     SP70,WBIFSVDS
          GOTO      IMWF9999 IF EQUAL
          UNPACK    WBIFSVDS,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      IMWF9999
.
IMWF1300  WRITE     HTMLFILE;WBIFSVEC;
          GOTO      IMWF9999
.
IMWF1400  WRITE     HTMLFILE;WBIFSVIN;
          GOTO      IMWF9999
.
IMWF1500  MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIFSVSF
          UNPACK    WBIFSVSF,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
.
IMWF9999  RETURN
+
.***************************************************************************
.*                             IMFM0000                                    *
.*   Display the medicare service report header received for an IMCW claim *
.***************************************************************************
IMFM0000  MATCH     "1",PTCNWSIN
          GOTO      IMFM9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      IMFM9999 IF NOT EQUAL
.
          CALL      IMFMH000
.
          PACK      KEY38,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,ECPREVCN,SP70
          CALL      RSWBIMF1
IMFM1000  CALL      RKWBIMF1
          BRANCH    OVRCD,IMFM9999
.
          MATCH     ECPRPTCD,WBIFFBID
          GOTO      IMFM9999 IF NOT EQUAL
.
          MATCH     ECPRINVN,WBIFARID
          GOTO      IMFM9999 IF NOT EQUAL
.
          MATCH     ECPRCLID,WBIFCLID
          GOTO      IMFM9999 IF NOT EQUAL
.
          MATCH     ECPRREPT,WBIFRPTC
          GOTO      IMFM9999 IF NOT EQUAL
.
          MATCH     ECPREVCN,WBIFMECN
          GOTO      IMFM9999 IF NOT EQUAL
.
          CALL      IMFMR000
.
          GOTO      IMFM1000
.
IMFM9999  RETURN
+
.------------------------------------------------------------
. IMF IMC Assessment Services Header (TABLE HEADING)
.------------------------------------------------------------
IMFMH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Brand ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Account<br>Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service&nbsp;Date&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare<br>Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Medicare<br>Explanation Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Schedule Fee&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service ID&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Report Details</td>":
                             "</tr>"
.
IMFMH999  RETURN
.------------------------------------------------------------
. Eclipse Services Header (Detail Row)
.------------------------------------------------------------
IMFMR000  REP       " +",WBIFFBID
          REP       " +",WBIFARID
          REP       " +",WBIFCLID
          REP       " +",WBIFRPTC
          REP       " +",WBIFMECN
          REP       " +",WBIFSVCN
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",WBIFFBID:
                             "','",WBIFARID,"','",WBIFCLID,"','",WBIFRPTC:
                             "','",WBIFMECN,"','",WBIFSVCN,"','006');>&nbsp;";
          REP       "+ ",WBIFFBID
          REP       "+ ",WBIFARID
          REP       "+ ",WBIFCLID
          REP       "+ ",WBIFRPTC
          REP       "+ ",WBIFMECN
          REP       "+ ",WBIFSVCN
.
          WRITE     HTMLFILE;WBIFFBID,"</td>":
                             "<td>",WBIFARID,"</td>":
                             "<td>",WBIFCLID,"</td>":
                             "<td>",WBIFSVIN,"</td>";
.
          REP       " +",WBIFFBID
          REP       " +",WBIFARID
          REP       " +",WBIFCLID
          REP       " +",WBIFRPTC
          REP       " +",WBIFMECN
          REP       " +",WBIFSVCN
.
          MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIFSVCA
          UNPACK    WBIFSVCA,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIFSVDS
          IF        !@EQUAL & !@EOS
            UNPACK    WBIFSVDS,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIFSVBE
          UNPACK    WBIFSVBE,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIFSVEC,"</td>";
.
          MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIFSVSF
          UNPACK    WBIFSVSF,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIFSVID,"</td>";
.
.         WRITE     HTMLFILE;
.                            "<td><img src='../images/EditIcon.gif'":
.                            " class=ListIcon onclick=displaySerH('",PRSHFBID:
.                            "','",PRSHARID,"','",PRSHCLID,"','",PRSHRPTC:
.                            "','",PRSHITMN,"','",PRSHSRVC,"','007');>":
.
          WRITE     HTMLFILE;"</td></tr>"
.
IMFMR999  RETURN
+
.--------------------------------------------------------------------------
. WebServices IMCW webimgaf tags
.--------------------------------------------------------------------------
IMWG0000  BRANCH    FLDITMNO,IMWG0100,IMWG0200,IMWG0300,IMWG0400,IMWG0500:
                             IMWG0600,IMWG0700,IMWG0800,IMWG0900

          GOTO      IMWG9999
.
IMWG0100  CALL      IMGM0000
          GOTO      IMWG9999
.
IMWG0200  WRITE     HTMLFILE;WBIGFBID;
          GOTO      IMWG9999
.
IMWG0300  WRITE     HTMLFILE;WBIGARID;
          GOTO      IMWG9999
.
IMWG0400  WRITE     HTMLFILE;WBIGCLID;
          GOTO      IMWG9999
.
IMWG0500  WRITE     HTMLFILE;WBIGRPTC;
          GOTO      IMWG9999
.
IMWG0600  WRITE     HTMLFILE;WBIGMECN;
          GOTO      IMWG9999
.
IMWG0700  WRITE     HTMLFILE;WBIGMEID;
          GOTO      IMWG9999
.
IMWG0800  WRITE     HTMLFILE;WBIGTRID;
          GOTO      IMWG9999
.
IMWG0900  WRITE     HTMLFILE;WBIGMSID;
          GOTO      IMWG9999
.
IMWG9999  RETURN
+
.***************************************************************************
.*                             IMGM0000                                    *
.*   Display imcw medicare assessment report details received for a claim  *
.***************************************************************************
IMGM0000  MATCH     "1",PTCNWSIN
          GOTO      IMGM9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      IMGM9999 IF NOT EQUAL
.
          CALL      IMGMH000
.
          PACK      KEY34,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,SP70
          CALL      RSWBIMG1
IMGM1000  CALL      RKWBIMG1
          BRANCH    OVRCD,IMGM9999
.
          MATCH     ECPRPTCD,WBIGFBID
          GOTO      IMGM9999 IF NOT EQUAL
.
          MATCH     ECPRINVN,WBIGARID
          GOTO      IMGM9999 IF NOT EQUAL
.
          MATCH     ECPRCLID,WBIGCLID
          GOTO      IMGM9999 IF NOT EQUAL
.
          MATCH     ECPRREPT,WBIGRPTC
          GOTO      IMGM9999 IF NOT EQUAL
.
          CALL      IMGMR000
.
          GOTO      IMGM1000
.
IMGM9999  RETURN
+
.------------------------------------------------------------
. IMG IMCW Medicare Assessment Details (TABLE HEADING)
.------------------------------------------------------------
IMGMH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Brand ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Account<br>Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "MedicalEvent ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Services&nbsp;</td>":
                             "</tr>"
.
IMGMH999  RETURN
.------------------------------------------------------------
. WebServices Medicare Assessment Details (Detail Row)
.------------------------------------------------------------
IMGMR000  REP       " +",WBIGFBID
          REP       " +",WBIGARID
          REP       " +",WBIGCLID
          REP       " +",WBIGRPTC
          REP       " +",WBIGMECN
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displayAssD('",WBIGFBID:
                             "','",WBIGARID,"','",WBIGCLID,"','",WBIGRPTC:
                             "','",WBIGMECN,"');>&nbsp;";
          REP       "+ ",WBIGFBID
          REP       "+ ",WBIGARID
          REP       "+ ",WBIGCLID
          REP       "+ ",WBIGRPTC
          REP       "+ ",WBIGMECN
.
          WRITE     HTMLFILE;WBIGFBID,"</td>":
                             "<td>",WBIGARID,"</td>":
                             "<td>",WBIGCLID,"</td>":
                             "<td>",WBIGMEID,"</td>";
          REP       " +",WBIGFBID
          REP       " +",WBIGARID
          REP       " +",WBIGCLID
          REP       " +",WBIGRPTC
          REP       " +",WBIGMECN
          WRITE     HTMLFILE;"<td><img src='../images/EditIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",WBIGFBID:
                             "','",WBIGARID,"','",WBIGCLID,"','",WBIGRPTC:
                             "','",WBIGMECN,"','009');>":
                             "</td>":
                             "</tr>"
          REP       "+ ",WBIGFBID
          REP       "+ ",WBIGARID
          REP       "+ ",WBIGCLID
          REP       "+ ",WBIGRPTC
          REP       "+ ",WBIGMECN
.
IMGMR999  RETURN
+
.--------------------------------------------------------------------------
. WebServices IMCW Medicare Assessment Services tags webimfaf
.--------------------------------------------------------------------------
IMWH0000  BRANCH    FLDITMNO,IMWH0100,IMWH0200,IMWH0300,IMWH0400,IMWH0500:
                             IMWH0600,IMWH0700,IMWH0800,IMWH0900,IMWH1000:
                             IMWH1100,IMWH1200,IMWH1300,IMWH1400,IMWH1500
          GOTO      IMWH9999
.
IMWH0100  CALL      IMHM0000
          GOTO      EMRS9999
.
IMWH0200  WRITE     HTMLFILE;WBIHFBID;
          GOTO      IMWH9999
.
IMWH0300  WRITE     HTMLFILE;WBIHARID;
          GOTO      IMWH9999
.
IMWH0400  WRITE     HTMLFILE;WBIHCLID;
          GOTO      IMWH9999
.
IMWH0500  WRITE     HTMLFILE;WBIHRPTC;
          GOTO      IMWH9999
.
IMWH0600  WRITE     HTMLFILE;WBIHMECN;
          GOTO      IMWH9999
.
IMWH0700  WRITE     HTMLFILE;WBIHSVCN;
          GOTO      IMWH9999
.
IMWH0800  WRITE     HTMLFILE;WBIHMEID;
          GOTO      IMWH9999
.
IMWH0900  WRITE     HTMLFILE;WBIHSVID;
          GOTO      IMWH9999
.
IMWH1000  WRITE     HTMLFILE;WBIHSVAC;
          GOTO      IMWH9999
.
IMWH1100  MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIHSVBE
          UNPACK    WBIHSVBE,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      IMWH9999
.
IMWH1200  MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIHSVCA
          UNPACK    WBIHSVCA,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      IMWH9999
.
IMWH1300  MATCH     SP70,WBIHSVDS
          GOTO      IMWH9999 IF EQUAL
          UNPACK    WBIHSVDS,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      IMWH9999
.
IMWH1400  WRITE     HTMLFILE;WBIHSVIT;
          GOTO      IMWH9999
.
IMWH1500  MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIHSVSF
          UNPACK    WBIHSVSF,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;FORM7P2;
          GOTO      IMWH9999
.
IMWH1600  WRITE     HTMLFILE;WBIHSVEC;
          GOTO      IMWH9999
.
IMWH1700  WRITE     HTMLFILE;WBIHSVET;
          GOTO      IMWH9999
.
IMWH1800  WRITE     HTMLFILE;WBIHTRID;
          GOTO      IMWH9999
.
IMWH1900  WRITE     HTMLFILE;WBIHMSID;
          GOTO      IMWH9999
.
IMWH9999  RETURN
+
.***************************************************************************
.*                             IMHM0000                                    *
.*   Display the medicare service report header received for an IMCW claim *
.***************************************************************************
IMHM0000  MATCH     "1",PTCNWSIN
          GOTO      IMHM9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIMCW
          GOTO      IMHM9999 IF NOT EQUAL
.
          CALL      IMHMH000
.
          PACK      KEY38,ECPRPTCD,ECPRINVN,ECPRCLID,ECPRREPT,ECPREVCN,SP70
          CALL      RSWBIMH1
IMHM1000  CALL      RKWBIMH1
          BRANCH    OVRCD,IMHM9999
.
          MATCH     ECPRPTCD,WBIHFBID
          GOTO      IMHM9999 IF NOT EQUAL
.
          MATCH     ECPRINVN,WBIHARID
          GOTO      IMHM9999 IF NOT EQUAL
.
          MATCH     ECPRCLID,WBIHCLID
          GOTO      IMHM9999 IF NOT EQUAL
.
          MATCH     ECPRREPT,WBIHRPTC
          GOTO      IMHM9999 IF NOT EQUAL
.
          MATCH     ECPREVCN,WBIHMECN
          GOTO      IMHM9999 IF NOT EQUAL
.
          CALL      IMHMR000
.
          GOTO      IMHM1000
.
IMHM9999  RETURN
+
.------------------------------------------------------------
. IMF IMC Assessment Services Header (TABLE HEADING)
.------------------------------------------------------------
IMHMH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Brand ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Account<br>Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Claim ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Item Number&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service&nbsp;Date&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Health Fund<br>Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Health Fund<br>Explanation Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Schedule Fee&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service ID&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Report Details</td>":
                             "</tr>"
.
IMHMH999  RETURN
.------------------------------------------------------------
. Eclipse Services Header (Detail Row)
.------------------------------------------------------------
IMHMR000  REP       " +",WBIHFBID
          REP       " +",WBIHARID
          REP       " +",WBIHCLID
          REP       " +",WBIHRPTC
          REP       " +",WBIHMECN
          REP       " +",WBIHSVCN
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",WBIHFBID:
                             "','",WBIHARID,"','",WBIHCLID,"','",WBIHRPTC:
                             "','",WBIHMECN,"','",WBIHSVCN,"','010');>&nbsp;";
          REP       "+ ",WBIHFBID
          REP       "+ ",WBIHARID
          REP       "+ ",WBIHCLID
          REP       "+ ",WBIHRPTC
          REP       "+ ",WBIHMECN
          REP       "+ ",WBIHSVCN
.
          WRITE     HTMLFILE;WBIHFBID,"</td>":
                             "<td>",WBIHARID,"</td>":
                             "<td>",WBIHCLID,"</td>":
                             "<td>",WBIHSVIT,"</td>";
.
          REP       " +",WBIHFBID
          REP       " +",WBIHARID
          REP       " +",WBIHCLID
          REP       " +",WBIHRPTC
          REP       " +",WBIHMECN
          REP       " +",WBIHSVCN
.
          MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIHSVCA
          UNPACK    WBIHSVCA,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIHSVDS
          IF        !@EQUAL & !@EOS
            UNPACK    WBIHSVDS,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIHSVBE
          UNPACK    WBIHSVBE,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIHSVEC,"</td>";
.
          MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIHSVSF
          UNPACK    WBIHSVSF,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIHSVID,"</td>";
.
.         WRITE     HTMLFILE;
.                            "<td><img src='../images/EditIcon.gif'":
.                            " class=ListIcon onclick=displaySerH('",PRSHFBID:
.                            "','",PRSHARID,"','",PRSHCLID,"','",PRSHRPTC:
.                            "','",PRSHITMN,"','",PRSHSRVC,"','007');>":
.
          WRITE     HTMLFILE;"</td></tr>"
.
IMHMR999  RETURN
+
.------------------------------------------------------------
. WebServices IHCW Claims Extract
.------------------------------------------------------------
IHWEXT00  MATCH     "1",PTCNWSIN
          GOTO      IHWEXT91 IF NOT EQUAL
.
          MATCH     "1",PTCNIHCW
          GOTO      IHWEXT91 IF NOT EQUAL
.
          COMPARE   ONE,IHCWINDC
          GOTO      IHWEXT91 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      IHWEXT80 IF EQUAL
.
          MATCH     "H",UPDTTYPE    * List Claims by Health Fund
          GOTO      IHWEXT10 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * List Claims by Claim Code
          GOTO      IHWEXT20 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Extract Claims
          GOTO      IHWEXT30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Claims
          GOTO      IHWEXT40 IF EQUAL
.
          GOTO      IHWEXT85
.
IHWEXT10  MATCH     SP70,HFUNDTYP                * no code chosen yet
          GOTO      IHWEXT80 IF EQUAL
.
          PACK      KEY14,HFUNDTYP,ZERO4,SP70
          CALL      RDFUND1                      * HF on file ?
          BRANCH    OVRCD,IHWEXT93
.
          MOVE      HFUNDTYP,KEY6
          CALL      RDPTFX11                     * hfund extension record?
          BRANCH    OVRCD,IHWEXT93
.
          COMPARE   THREE,PTFXEXTR               * using Eclipse ?
          GOTO      IHWEXT94 IF NOT EQUAL
.
          MOVE      SP70,ECLKEY3
          MATCH     SP70,PTFXECLP
          IF        @EQUAL | @EOS
            MATCH     SP3,PTHFHGRP                 * blank health fund group ?
            GOTO      IHWEXT95 IF EQUAL
            MOVE      PTHFHGRP,ECLKEY3
          ELSE
            MOVE      PTFXECLP,ECLKEY3
          ENDIF
.
          MOVE      ECLKEY3,KEY3
          CALL      RDWBPAR1                     * participant code on file ?
          BRANCH    OVRCD,IHWEXT95
.
          MATCH     CVETINS,ECLKEY3
          GOTO      IHWEXT96 IF EQUAL            * is the participant DVA ?
.
          MOVE      ECLKEY3,KEY3
          PACK      KEY9,KEY3,ANSI,ANSH,ANSC,SP3
          CALL      RDWBPCP1                     * IHC capability ?
          BRANCH    OVRCD,IHWEXT87
.
          CALL      WERR0000                     * reset any error records
          GOTO      IHWEXT80
.
IHWEXT20  MATCH     SP70,HFUNDTYP                * no code chosen yet
          GOTO      IHWEXT80 IF EQUAL
.
          MATCH     SP6,CVETINS                  * insurance code for DVA?
          GOTO      IHWEXT97 IF EQUAL
.
          PACK      KEY6,CVETINS,SP6
          CALL      RDINSR1                      * insurance company on file ?
          BRANCH    OVRCD,IHWEXT90
.
          MOVE      CVETINS,KEY3
          CALL      RDWBPAR1                     * participant code on file ?
          BRANCH    OVRCD,IHWEXT95
.
          MOVE      CVETINS,KEY3
          PACK      KEY9,KEY3,ANSI,ANSH,ANSC,SP3
          CALL      RDWBPCP1                     * IHC capability ?
          BRANCH    OVRCD,IHWEXT87
.
          PACK      KEY5,ANSC,ANSL,HFUNDTYP,SP5
          CALL      RDCODE1
          BRANCH    OVRCD,IHWEXT98
.
          MOVE      ZERO,FORM1
          WHILE     FORM1 < 5
            ADD       ONE,FORM1
            LOAD      ANS,FORM1,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
            MATCH     ANSV,ANS                   * DVA code ?
            GOTO      IHWEXT25 IF EQUAL          * yes
          DO
.
          GOTO      IHWEXT98
.
IHWEXT25  CALL      WERR0000                     * reset any error records
          GOTO      IHWEXT80
.
IHWEXT30  COMPARE   ZERO,LASTDCLM
          GOTO      IHWEXT35 IF EQUAL            * any claims to delete first ?
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,DECLMARR[COUNT]
            IF        !@EQUAL
              CALL      EDEH0000                 * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
          MOVE      ONE,NEXTPAGE
.
          COMPARE   ZERO,ERRORCNT
          GOTO      IHWEXT35 IF EQUAL
.
          CALL      ERRLST00                     * display any delete errors
.>>>>     MOVE      ONE,EXIT
.>>>>     GOTO      IHWEXT99
.
IHWEXT35  
.         COMPARE   ONE,PTCNUEDI                 * using edi module?
.         GOTO      IHWEXT91 IF NOT EQUAL
.
.         MATCH     SP70,PTCNECLO                * eclipse outbound path set?
.         GOTO      IHWEXT92 IF EQUAL
.
          COMPARE   ZERO,LASTECLM
          GOTO      IHWEXT86 IF EQUAL            * no claims to extract
.
          CALL      SIHWX000                     * Extract Eclipse Claims
.
          MOVE      ZERO,EXIT
          GOTO      IHWEXT99
.
.   ************ DELETE CLAIM FUNCTION ************
.>>>>
IHWEXT40  COMPARE   ZERO,LASTDCLM
          GOTO      IHWEXT86 IF EQUAL            * no claims to delete
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,DECLMARR[COUNT]
            IF        !@EQUAL
              CALL      EDEH0000   * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      IHWEXT99 IF EQUAL
.
          CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      IHWEXT99
.
IHWEXT80  CLEAR     WEBTITLE
          MOVE      "Eclipse IHC Claims Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IHWEXT99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IHWEXT99
.
IHWEXT85  MOVE      "Invalid Form Action.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT86  MOVE      "No claims selected to extract.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT87  MOVE      "Participant cannot accept IHCs.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT90  MOVE      "Insurance code not found.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT91  MOVE      "Hospital not using the WebServices Module.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT92  MOVE      "Eclipse Outbound Path blank.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT93  MOVE      "Health Fund or extension record not found.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT94  MOVE      "Health Fund not using Eclipse.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT95  MOVE      "Participant code blank or not on file.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT96  MOVE      "Process DVA claims by claim code.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT97  MOVE      "Insurance code for DVA is blank.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT98  MOVE      "Claim code not DVA related.",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      IHWEXT99
.
IHWEXT99  RETURN
+
.*****************************************************************************
.*                              WERR0000           Called by: IHWEXT00       *
.*             Reset error records back to zero status (Not Sent)            *
.*             just in case there were any problems with a previous          *
.*             batch and the error records were not set back to zero.        *
.*****************************************************************************
.
WERR0000  MOVE      HOSPCODE,SAVEHOSP            * initialise hospital
          MOVE      ZERO,FIRSTFLG                * initialise flag
.
          PACK      KEY35,HOSPCODE,SP1,ONE,HFUNDTYP,SP30,SP10
WERR0500  CALL      RSWBIHC1                     * position in file
          CALL      RKWBIHC1                     * read next record
          BRANCH    OVRCD,WERR9999               * eof - finished
.
          IF        FIRSTFLG = 0
            MATCH     SP3,HOSPCODE               * all hospitals extract ?
            IF        @EQUAL
              MOVE      WBICHOSP,SAVEHOSP        * yes-load first hospital code
            ENDIF
            MOVE      ONE,FIRSTFLG               * set first flag to no
          ENDIF
.
          MATCH     SP3,HOSPCODE                 * all hospitals extract ?
          GOTO      WERR5000 IF NOT EQUAL        * no
.
.         We are running an extract for all hospitals
.
          MATCH     SAVEHOSP,WBICHOSP            * same hospital still ?
          IF        !@EQUAL
            MOVE      WBICHOSP,SAVEHOSP          * no - save new hospital code
            PACK      KEY35,WBICHOSP,SP1,ONE,HFUNDTYP,SP30,SP10
            GOTO      WERR0500
          ENDIF
.
          COMPARE   ONE,WBICFLAG                 * error record still ?
          GOTO      WERR4000 IF NOT EQUAL        * no - get next hospital
.
          MATCH     HFUNDTYP,WBICHFND            * same health fund still ?
          GOTO      WERR4000 IF NOT EQUAL        * no - finished
.
          GOTO      WERR8000
.
WERR4000  PACK      KEY35,WBICHOSP,Z70
          GOTO      WERR0500
.
.         We are running an extract for a given hospital id
.
WERR5000  MATCH     HOSPCODE,WBICHOSP            * same hospital still ?
          GOTO      WERR9999 IF NOT EQUAL        * no - finished
.
          COMPARE   ONE,WBICFLAG                 * error record still ?
          GOTO      WERR9999 IF NOT EQUAL        * no - finished
.
          MATCH     HFUNDTYP,WBICHFND            * same health fund still ?
          GOTO      WERR9999 IF NOT EQUAL        * no - finished
.
.         Reset the record status to "Waiting"
.
WERR8000  PACK      SAVKEY35,WBICHOSP,WBICFLAG,WBICHFND,WBICADMN,WBICINVN:
                             WBICBATN
          MOVE      ZERO,WBICFLAG                * yes - reset flag to "0"

          CALL      IBACLOCK
          PACK      WBICUDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBICUDAT
          MOVE      CTIMEIS,WBICUTIM
          MOVE      USERID,WBICUUID
          CALL      UPWBIHC1                     * update record
          MOVE      SAVKEY35,KEY35               * load key to reposition
          GOTO      WERR0500                     * get next record
.
WERR9999  RETURN
+
.*****************************************************************************
.*                               EDEH0000                                    *
.*                   Delete selected Eclipse Claim records                   *
.*****************************************************************************
EDEH0000  MOVE      DECLMARR[COUNT],KEY8    * invoice number
          PACK      KEY16,KEY8,SP70         * batch number is blank
          CALL      RDWBIHC2
          BRANCH    OVRCD,EDEH8000
.
          MOVE      WBICINVN,TEMPINVN
          MOVE      WBICBATN,TEMPBATN
          MOVE      WBICADMN,TEMPADMN
          MOVE      WBICURNO,TEMPURNO
          MOVE      WBICHFND,TEMPHFND
          MOVE      WBICPBAT,TEMPPBAT
          MOVE      WBICHOSP,TEMPHOSP
.
          MATCH     SP70,TEMPPBAT
          GOTO      EDEH1000 IF EQUAL
          GOTO      EDEH1000 IF EOS
.
          PACK      KEY35,TEMPHOSP,TEN6,TEMPHFND,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDWBIHC1
          IF        OVRCD = 1
            GOTO      EDEH7000
          ELSE
            MOVE      SP70,WBICNBAT

            CALL      IBACLOCK
            PACK      WBICUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBICUDAT
            MOVE      CTIMEIS,WBICUTIM
            MOVE      USERID,WBICUUID
            CALL      UPWBIHC1
          ENDIF
.
.         Delete the selected record
.
EDEH1000  PACK      KEY35,TEMPHOSP,SP1,ZERO,TEMPHFND,TEMPADMN,TEMPINVN,TEMPBATN
          CALL      DEWBIHC1
.
          GOTO      EDEH9999
.
EDEH7000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      EDEH9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Error updating previous claim - ",ERRORLST[ERRORCNT]
          APPEND    WBICINVN,ERRORLST[ERRORCNT]
          APPEND    "  Batch - ",ERRORLST[ERRORCNT]
          APPEND    WBICBATN,ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      EDEH9999
.
EDEH8000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      EDEH9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Record cannot be deleted.  ",ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      EDEH9999

EDEH9999  RETURN
+
.--------------------------------------------------------------------------
.*                             SIHWX000                                   *
.*               Schedule Eclipse Extract (IBAWEB04)                      *
.--------------------------------------------------------------------------
SIHWX000  MOVE      "IBAWEB04",SCHDPGID
          MOVE      "WebServices Claims Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAWEB04",SETDFPRG
          MOVE      "8",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ONE,COUNT
          MOVE      HOSPCODE,KEYSTARR[COUNT]    * hospital id
          ADD       ONE,COUNT
          MOVE      OPTNFLAG,KEYSTARR[COUNT]    * extract by fund(1)/claim(2)
          ADD       ONE,COUNT
          MOVE      HFUNDTYP,KEYSTARR[COUNT]    * health fund / claim code
.
          MOVE      THREE,TOTALCNT              * first 3 keyins
.
          ADD      ONE,COUNT
          MOVE     ONE,COUNTEC
          WHILE     COUNTEC <= LASTECLM
            MATCH     SP90,ECCLMARR[COUNTEC]
            IF        !@EQUAL
              MOVE      ECCLMARR[COUNTEC],KEYSTARR[COUNT]    * to be extracted
            ENDIF
            ADD      ONE,COUNT
            ADD      ONE,COUNTEC
          DO
.
          ADD       LASTECLM,TOTALCNT            * eclipse claims keyins
.
          PACK      KEYSTARR[COUNT],SP70         * blank record to signal exit
          ADD       ONE,COUNT
          ADD       ONE,TOTALCNT
.
          MOVE      ANSP,KEYSTARR[COUNT]         * (P)ost
.>>>>
.>>>>     ADD       ONE,COUNT
.>>>>     MOVE      ANSY,KEYSTARR[COUNT]         * (Y) to extract (if ok)
.>>>>
          ADD       ONE,COUNT
          MOVE      SP70,KEYSTARR[COUNT]         * (Enter) to exit
          ADD       ONE,COUNT
          MOVE      "\",KEYSTARR[COUNT]          * (\) to exit
.
          ADD       THREE,TOTALCNT               * add last 3 keyins (if error)
.>>>>     ADD       FOUR,TOTALCNT                * add last 4 keyins (if ok)
          MOVE      TOTALCNT,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SIHWX999  RETURN
+
.--------------------------------------------------------------------------
. Option 8 - Eclipse Claims Extract tags
.--------------------------------------------------------------------------
WEXT0000  BRANCH    FLDITMNO,WEXT0100,WEXT0200,WEXT0300,WEXT0400,WEXT0500:
                             WEXT0600,WEXT0700,WEXT0800
          GOTO      WEXT9999
.
WEXT0100  MOVE      ONE,ALLHFLAG          * default to 'All'
          CALL      HOSPID00              * display Multi-hosp. selection list
          GOTO      WEXT9999
.
WEXT0200  CALL      ECSHN000              * selected Hospital Desc (Multi-hosp)
          GOTO      WEXT9999
.
WEXT0300  MOVE      "CL",CATEGORY         * Compensation code/Claim Type
          MOVE      HFUNDTYP,CODE
          CALL      CODITM00
          GOTO      WEXT9999
.
WEXT0400  CALL      WSWFX000              * Claims Waiting for Extraction
          GOTO      WEXT9999
.
WEXT0500  MATCH     SP70,UPDTTYPE
          GOTO      WEXT9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI
          GOTO      WEXT9999
.
WEXT0600  WRITE     HTMLFILE;CLAMTYPE;    * Claim type CGI
          GOTO      WEXT9999
.
WEXT0700  MATCH     SP70,HFUNDTYP
          GOTO      WEXT9999 IF EQUAL
          WRITE     HTMLFILE;HFUNDTYP;    * Health Fund CGI
          GOTO      WEXT9999
.
WEXT0800  WRITE     HTMLFILE;HFUNDESC;    * Health Fund Desc CGI
          GOTO      WEXT9999
.
WEXT9999  RETURN
+
.------------------------------------------------------------
. Table of all WebServices IHCW Claims Waiting For Extraction
.------------------------------------------------------------
WSWFX000  MOVE      ZERO,FORM3
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     HFUNDTYP,SP70           * cannot have blank code
          GOTO      WSWFX900 IF EQUAL
.
          PACK      KEY35,HOSPCODE,SP1,ZERO,SP70
WSWFX040  CALL      RSWBIHC1
WSWFX050  CALL      RKWBIHC1                * read next record
          BRANCH    OVRCD,WSWFX900          * end of file
.
          MATCH     SP3,HOSPCODE                 * all hospitals ?
          IF        !@EQUAL
            MATCH     HOSPCODE,WBICHOSP          * no - same hospital still ?
            GOTO      WSWFX900 IF NOT EQUAL      * no - finished
          ENDIF
.
          COMPARE   ZERO,WBICFLAG                * waiting for extract still ?
          IF        !@EQUAL
            PACK      KEY35,WBICHOSP,Z70
            GOTO      WSWFX040                   * get next record
          ENDIF
.
.         Processing by Health Fund (option 1) or claim code (option 2)
.
          IF        OPTNFLAG = 1
            MATCH     HFUNDTYP,WBICHFND          * same health fund ?
            GOTO      WSWFX050 IF NOT EQUAL      * no - ignore record
.
            COMPARE   ZERO,WBICEETP              * health fund claim type ?
            GOTO      WSWFX050 IF NOT EQUAL      * no - ignore record
            GOTO      WSWFX200                   * yes
          ENDIF
.
.         Processing by claim code option
.
WSWFX100  MOVE      WBICADMN,KEY8
          CALL      RDMISS1                      * admission on file ?
          BRANCH    OVRCD,WSWFX050               * no - ignore record
.
          MATCH     SP3,ACLAIM                   * blank claim code ?
          GOTO      WSWFX050 IF EQUAL            * yes - ignore record
.
.         Check we have the same claim code
.
          MATCH     CLAMTYPE,ACLAIM              * same claim code ?
          GOTO      WSWFX050 IF NOT EQUAL        * no - ignore record
.
          COMPARE   ONE,WBICEETP                 * claim code claim type ?
          GOTO      WSWFX050 IF NOT EQUAL        * no - ignore record
.
.         A waiting record for the health fund/claim code has been found,
.         so get the invoice details and calculate the amount outstanding.
.
WSWFX200  CALL      WBSRW000      * Output Row
          IF        DISNUMB>=50
            GOTO      WSWFX800
          ENDIF
          GOTO      WSWFX050
.
WSWFX800  CALL      LIMREC00        * Show batch limit reached message
          GOTO      WSWFX999
.
WSWFX900  CALL      TOTREC00        * Show no more records message
.
WSWFX999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for WebServices (TABLE ROW)
.------------------------------------------------------------
WBSRW000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,WBICINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      SP8,PINVDTE
          ELSE
            MATCH     ZEROVISN,PINVADM
            IF        @EQUAL
              GOTO      WBSRW900                 * delete claim
            ENDIF
            IF        PINVTYP =2
              GOTO      WBSRW900                 * delete claim
            ENDIF
            ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR),FORM12P2
            IF        IBCNUGST=2
              ADD       PTINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PINVDTE
          IF        !@EQUAL
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;WBICADMN,"&nbsp;</td>":
                             "<td>",WBICINVN,"&nbsp;</td>":
                             "<td>",WBICURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",WBICHOSP,WBICADMN,WBICINVN:
                                        WBICURNO,PINVDTE,KEY15:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=declm",KEY3:
                             " value='",WBICINVN:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      WBSRW999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in pmsectaf
.
WBSRW900  PACK      SAVKEY35,WBICHOSP,WBICFLAG,WBICHFND,WBICADMN,WBICINVN:
                             WBICBATN
          MOVE      SAVKEY35,KEY35
          CALL      DEWBIHC1                 * delete cancelled/zero invoices
          MOVE      SAVKEY35,KEY35
          CALL      RSWBIHC1
.
WBSRW999  RETURN
+
.------------------------------------------------------------
. WebServices IHCW Assessing Report Enquiry
.------------------------------------------------------------
IHWPRM00  MATCH     "1",PTCNWSIN
          GOTO      IHWPRM88 IF NOT EQUAL
.
          MATCH     "1",PTCNIHCW
          GOTO      IHWPRM88 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      IHWPRM80 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Assessment Report
          GOTO      IHWPRM10 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Assessment Report Claim Assessment
          GOTO      IHWPRM20 IF EQUAL
.
          MATCH     "F",UPDTTYPE    * Assessment Report Claim Assessment Exp
          GOTO      IHWPRM30 IF EQUAL
.
          MATCH     "G",UPDTTYPE    * Assessment Report Service Assessment
          GOTO      IHWPRM40 IF EQUAL
.
          MATCH     "H",UPDTTYPE    * Assessment Report Service Assessment Exp
          GOTO      IHWPRM50 IF EQUAL
.
          MATCH     "P",UPDTTYPE    * Print Assessment Report
          GOTO      IHWPRM60 IF EQUAL
.
          GOTO      IHWPRM86
.
IHWPRM10  PACK      KEY41,ECPRPTCD,ECPRINVN,ECPRFRID,ECPRREPT,SP70
          CALL      RDWBIHD1
          BRANCH    OVRCD,IHWPRM81
.
          GOTO      IHWPRM80
.
IHWPRM20  PACK      KEY43,ECPRPTCD,ECPRINVN,ECPRFRID,ECPRREPT,ECPREVCN,SP70
          CALL      RDWBIHE1
          BRANCH    OVRCD,IHWPRM82
.
          GOTO      IHWPRM80
.
IHWPRM30  PACK      KEY45,ECPRPTCD,ECPRINVN,ECPRFRID,ECPRREPT,ECPREVCN:
                          ECPRSVCN,SP70
          CALL      RDWBIHF1
          BRANCH    OVRCD,IHWPRM83
.
          GOTO      IHWPRM80
.
IHWPRM40  PACK      KEY43,ECPRPTCD,ECPRINVN,ECPRFRID,ECPRREPT,ECPREVCN,SP70
          CALL      RDWBIHG1
          BRANCH    OVRCD,IHWPRM84
.
          GOTO      IHWPRM80
.
IHWPRM50  PACK      KEY45,ECPRPTCD,ECPRINVN,ECPRFRID,ECPRREPT,ECPREVCN:
                          ECPRSVCN,SP70
          CALL      RDWBIHH1
          BRANCH    OVRCD,IHWPRM85
.
          GOTO      IHWPRM80
.
IHWPRM60  CALL      SIHCW000      * Schedule print Assessment Report
.
          MOVE      ZERO,EXIT
          GOTO      IHWPRM99
.
IHWPRM80  CLEAR     WEBTITLE
          MOVE      "WebServices IHCW Assessing Report Enquiry",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IHWPRM99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IHWPRM99
.
IHWPRM81  MOVE      "webihdaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHWPRM99
.
IHWPRM82  MOVE      "webiheaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHWPRM99
.
IHWPRM83  MOVE      "webihfaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHWPRM99
.
IHWPRM84  MOVE      "webihgaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHWPRM99
.
IHWPRM85  MOVE      "webihhaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHWPRM99
.
IHWPRM86  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHWPRM99
.
IHWPRM88  MOVE      "Not using WebServices IHCW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHWPRM99
.
IHWPRM99  RETURN
+
.--------------------------------------------------------------------------
.*                             SIHCW000                                   *
.*               Schedule IHCW WebServices Assessment Report (IBAWEB13)   *
.--------------------------------------------------------------------------
SIHCW000  MOVE      "IBAWEB13",SCHDPGID
          MOVE      "WebServices IHCW Assessment Report",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAWEB13",SETDFPRG
          MOVE      "9",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ASSE2KEY,KEYSTARR[1]    * key for webihdaf
          MOVE      ONE,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SIHCW999  RETURN
+
.--------------------------------------------------------------------------
. Option 19 - WebServices IHCW Assessing Report Enquiry tags
.--------------------------------------------------------------------------
IHWD0000  BRANCH    FLDITMNO,IHWD0100,IHWD0200,IHWD0300,IHWD0400,IHWD0500:
                             IHWD0600,IHWD0700,IHWD0800,IHWD0900,IHWD1000:
                             IHWD1100,IHWD1200,IHWD1300,IHWD1400,IHWD1500:
                             IHWD1600,IHWD1700,IHWD1800,IHWD1900,IHWD2000:
                             IHWD2100,IHWD2200,IHWD2300
          GOTO      IHWD9999
.
IHWD0100  UNPACK    DIM127,D1,DIM1,DIM127
          MOVE      ZERO,FORM1
          MOVE      DIM1,FORM1
          BRANCH    FORM1,IHWD0110
.
          WRITE     HTMLFILE;PARTCODE;
          GOTO      IHWD9999
.
IHWD0110  PACK      KEY3,PARTCODE,SP70
          CALL      RDWBPAR1
          BRANCH    OVRCD,IHWD9999
.
          WRITE     HTMLFILE;WBPRNAME;
          GOTO      IHWD9999
.
IHWD0200  CALL      IHDM0000
          GOTO      IHWD9999
.
IHWD0300  WRITE     HTMLFILE;WBIKFBID;
          GOTO      IHWD9999
.
IHWD0400  WRITE     HTMLFILE;WBIKARID;
          GOTO      IHWD9999
.
IHWD0500  WRITE     HTMLFILE;WBIKFRID;
          GOTO      IHWD9999
.
IHWD0600  WRITE     HTMLFILE;WBIKRPTC;
          GOTO      IHWD9999
.
IHWD0700  WRITE     HTMLFILE;WBIKSTAT;
          GOTO      IHWD9999
.
IHWD0800  WRITE     HTMLFILE;WBIKFSCD;
          GOTO      IHWD9999
.
IHWD0900  WRITE     HTMLFILE;WBIKFSTX;
          GOTO      IHWD9999
.
IHWD1000  WRITE     HTMLFILE;WBIKFCID;
          GOTO      IHWD9999
.
IHWD1100  MOVE      ZERO,FORM1
          MOVE      SP70,ASESDESC
          MOVE      WBIKCFAC,ANS
          REP       "A1R2W3C4",ANS
          MOVE      ANS,FORM1
          LOAD      ASESDESC,FORM1,ASESDES1,ASESDES2,ASESDES3,ASESDES4
.
          WRITE     HTMLFILE;ASESDESC;
          GOTO      IHWD9999
.
IHWD1200  MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIKCPAM
          REP       " 0",WBIKCPAM
          UNPACK    WBIKCPAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
.
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      IHWD9999
.
IHWD1300  MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIKEXAM
          REP       " 0",WBIKEXAM
          UNPACK    WBIKEXAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
.
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      IHWD9999
.
IHWD1400  MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIKTBAM
          REP       " 0",WBIKTBAM
          UNPACK    WBIKTBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
.
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      IHWD9999
.
IHWD1500  MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIKTCAM
          REP       " 0",WBIKTCAM
          UNPACK    WBIKTCAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2C
.
          WRITE     HTMLFILE;FORM7P2C;
          GOTO      IHWD9999
.
IHWD1600  WRITE     HTMLFILE;WBIKRSTA;
          GOTO      IHWD9999
.
IHWD1700  WRITE     HTMLFILE;WBIKFTID;
          GOTO      IHWD9999
.
IHWD1800
.         MOVE      ZERO,FORM2
.         MOVE      "UNKNOWN",PRCSDESC
.         MOVE      PRAHSTAT,FORM2
.         LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
.                                  PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
.                                  PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
.                                  PRCSDE10,PRCSDE11
.
.         WRITE     HTMLFILE;PRCSDESC;
.         GOTO      IHWD9999
.
IHWD1900  WRITE     HTMLFILE;WBIKMSID;
          GOTO      IHWD9999
.
IHWD2000  MATCH     SP70,WBIKUDAT
          GOTO      IHWD9999 IF EQUAL
          UNPACK    WBIKUDAT,CCENT,CYEAR,CMON,CDAY  * Service Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      IHWD9999
.
IHWD2100  WRITE     HTMLFILE;WBIKUTIM;
          GOTO      IHWD9999
.
IHWD2200  WRITE     HTMLFILE;WBIKFBID,WBIKARID,WBIKFRID,WBIKRPTC;
          GOTO      IHWD9999
.
IHWD2300  WRITE     HTMLFILE;EXTRTYPE;
          GOTO      IHWD9999
.
IHWD9999  RETURN
+
.***************************************************************************
.*                             IHDM0000                                    *
.*   Display all ihcw assessment reports received from a given participant *
.***************************************************************************
IHDM0000  MATCH     "1",PTCNWSIN
          GOTO      IHDM9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIHCW
          GOTO      IHDM9999 IF NOT EQUAL
.
.         MATCH     SP70,EXTRTYPE
.         GOTO      IHDM9999 IF EQUAL
.
          PACK      PARTCODE,PARTCODE,SP70
.
.         MATCH     "2",EXTRTYPE
.         IF        !@EQUAL
            MATCH     SP70,PARTCODE
            GOTO      IHDM9999 IF EQUAL
.         ENDIF
.
          PACK      KEY41,PARTCODE,SP70
          CALL      RSWBIHD1                     * position in file
IHDM1000  CALL      RKWBIHD1                     * read next record
          BRANCH    OVRCD,IHDM9999               * end of file
.
          MATCH     PARTCODE,WBIKFBID
          GOTO      IHDM9999 IF NOT EQUAL
.
          PACK      KEY40,WBIKFTID,SP70
          CALL      RSWBIHC6
          CALL      RKWBIHC6
          BRANCH    OVRCD,IHDM1000
.
          MATCH     WBIKFTID,WBICTRID
          GOTO      IHDM1000 IF NOT EQUAL
.
.         MATCH     "1",EXTRTYPE
.         IF        @EQUAL
.           COMPARE   ZERO,WBICEETP
.           IF        !@EQUAL
.             COMPARE   ONE,WBICEETP
.             GOTO      IHDM1000 IF NOT EQUAL
.           ENDIF
.         ELSE
.           MATCH     EXTRTYPE,DWBICEET
.           GOTO      IHDM1000 IF NOT EQUAL
.         ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      WBIKCFAC,STATKEY1
          REP       "A1R2W3C4",STATKEY1
          MOVE      STATKEY1,FORM1
          MOVE      SP70,CLAMDESC
          LOAD      CLAMDESC,FORM1,CLAMST01,CLAMST02,CLAMST03,CLAMST04
.
.         MOVE      ZERO,FORM1
.         MOVE      "No Change",MEDSDESC
.         MOVE      PRAHMCFC,ANS
.         REP       "A1I2C3W4S5X6",ANS
.         MOVE      ANS,FORM1
.         LOAD      MEDSDESC,FORM1,MEDSDES1,MEDSDES2,MEDSDES3,MEDSDES4:
.                                  MEDSDES5,MEDSDES6
.
          PACK      MEDSDESC,WBIKFSTX,SP70
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIKCDAT
          IF        !@EQUAL & !@EOS
            UNPACK    WBIKCDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
.         MOVE      ZERO,FORM2
.         MOVE      "UNKNOWN",PRCSDESC
.         MOVE      PRAHSTAT,FORM2
.         LOAD      PRCSDESC,FORM2,PRCSDESC,PRCSDESC,PRCSDESC,PRCSDES1:
.                                  PRCSDES2,PRCSDES3,PRCSDES4,PRCSDES5:
.                                  PRCSDES6,PRCSDES7,PRCSDES8,PRCSDES9:
.                                  PRCSDE10,PRCSDE11
.
          PACK      PRCSDESC,WBIKSTAT,SP70
.
          MOVE      ZERO,FORM7P2C
          RJUSTIFY  WBIKTCAM
          UNPACK    WBIKTCAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
.
          REP       " +",WBIKFBID
          REP       " +",WBIKARID
          REP       " +",WBIKFRID
          REP       " +",WBIKRPTC
.
        WRITE     HTMLFILE;"t.addRow(#"","<img src='../images/CommentIcon.gif'":
                           " class=ListIcon onclick=displayProH('":
          WBIKFBID,"','",WBIKARID,"','",WBIKFRID,"','",WBIKRPTC,"','002');> ";
.
          REP       "+ ",WBIKFBID
          REP       "+ ",WBIKARID
          REP       "+ ",WBIKFRID
          REP       "+ ",WBIKRPTC
.
          WRITE     HTMLFILE;WBIKARID,"#",";               * 0
.
          WRITE     HTMLFILE;"#"",WBIKFRID,"#",":          * 1
                             "#"",WBIKRPTC,"#",":          * 2
                             "#"",CLAMDESC,"#",":          * 3
                             "#"",DIM10,"#",":             * 4
                             "#"",DIM11,"#",":             * 5
                             "#"",WBIKFTID,"#",";          * 6
.
          REP       " +",WBIKFBID
          REP       " +",WBIKARID
          REP       " +",WBIKFRID
          REP       " +",WBIKRPTC
.
          WRITE     HTMLFILE;"#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=displayProE('":
          WBIKFBID,"','",WBIKARID,"','",WBIKFRID,"','",WBIKRPTC,"','003');> ":
          "#",";
.
          WRITE     HTMLFILE;"#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=displayProE('":
          WBIKFBID,"','",WBIKARID,"','",WBIKFRID,"','",WBIKRPTC,"','007');> ":
          "#");"
.
          REP       "+ ",WBIKFBID
          REP       "+ ",WBIKARID
          REP       "+ ",WBIKFRID
          REP       "+ ",WBIKRPTC
.
          GOTO      IHDM1000
.
IHDM9999  RETURN
+
.--------------------------------------------------------------------------
. WebServices IHCW webiheaf tags
.--------------------------------------------------------------------------
IHWE0000  BRANCH    FLDITMNO,IHWE0100,IHWE0200,IHWE0300,IHWE0400,IHWE0500:
                             IHWE0600,IHWE0700,IHWE0800,IHWE0900,IHWE1000

          GOTO      IHWE9999
.
IHWE0100  CALL      IHEM0000
          GOTO      IHWE9999
.
IHWE0200  WRITE     HTMLFILE;WBILFBID;
          GOTO      IHWE9999
.
IHWE0300  WRITE     HTMLFILE;WBILARID;
          GOTO      IHWE9999
.
IHWE0400  WRITE     HTMLFILE;WBILFRID;
          GOTO      IHWE9999
.
IHWE0500  WRITE     HTMLFILE;WBILRPTC;
          GOTO      IHWE9999
.
IHWE0600  WRITE     HTMLFILE;WBILCACN;
          GOTO      IHWE9999
.
IHWE0700  WRITE     HTMLFILE;WBILELNM;
          GOTO      IHWE9999
.
IHWE0800  WRITE     HTMLFILE;WBILMPID;
          GOTO      IHWE9999
.
IHWE0900  WRITE     HTMLFILE;WBILTRID;
          GOTO      IHWE9999
.
IHWE1000  WRITE     HTMLFILE;WBILMSID;
          GOTO      IHWE9999
.
IHWE9999  RETURN
+
.***************************************************************************
.*                             IHEM0000                                    *
.*   Display ihcw medicare assessment report details received for a claim  *
.***************************************************************************
IHEM0000  MATCH     "1",PTCNWSIN
          GOTO      IHEM9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIHCW
          GOTO      IHEM9999 IF NOT EQUAL
.
          CALL      IHEMH000
.
          PACK      KEY43,ECPRPTCD,ECPRINVN,ECPRFRID,ECPRREPT,SP70
          CALL      RSWBIHE1
IHEM1000  CALL      RKWBIHE1
          BRANCH    OVRCD,IHEM9999
.
          MATCH     ECPRPTCD,WBILFBID
          GOTO      IHEM9999 IF NOT EQUAL
.
          MATCH     ECPRINVN,WBILARID
          GOTO      IHEM9999 IF NOT EQUAL
.
          MATCH     ECPRFRID,WBILFRID
          GOTO      IHEM9999 IF NOT EQUAL
.
          MATCH     ECPRREPT,WBILRPTC
          GOTO      IHEM9999 IF NOT EQUAL
.
          CALL      IHEMR000
.
          GOTO      IHEM1000
.
IHEM9999  RETURN
+
.------------------------------------------------------------
. IHE IHCW Claim Assessment Details (TABLE HEADING)
.------------------------------------------------------------
IHEMH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Brand ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Account<br>Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Fund Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Element Name&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Message Part ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation&nbsp;</td>":
                             "</tr>"
.
IHEMH999  RETURN
+
.------------------------------------------------------------
. WebServices Claim Assessment Details (Detail Row)
.------------------------------------------------------------
IHEMR000  REP       " +",WBILFBID
          REP       " +",WBILARID
          REP       " +",WBILFRID
          REP       " +",WBILRPTC
          REP       " +",WBILCACN
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displayAssD('",WBILFBID:
                             "','",WBILARID,"','",WBILFRID,"','",WBILRPTC:
                             "','",WBILCACN,"');>&nbsp;";
          REP       "+ ",WBILFBID
          REP       "+ ",WBILARID
          REP       "+ ",WBILFRID
          REP       "+ ",WBILRPTC
          REP       "+ ",WBILCACN
.
          WRITE     HTMLFILE;WBILFBID,"</td>":
                             "<td>",WBILARID,"</td>":
                             "<td>",WBILFRID,"</td>":
                             "<td>",WBILELNM,"</td>":
                             "<td>",WBILMPID,"</td>";
          REP       " +",WBILFBID
          REP       " +",WBILARID
          REP       " +",WBILFRID
          REP       " +",WBILRPTC
          REP       " +",WBILCACN
          WRITE     HTMLFILE;"<td><img src='../images/EditIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",WBILFBID:
                             "','",WBILARID,"','",WBILFRID,"','",WBILRPTC:
                             "','",WBILCACN,"','005');>":
                             "</td>":
                             "</tr>"
          REP       "+ ",WBILFBID
          REP       "+ ",WBILARID
          REP       "+ ",WBILFRID
          REP       "+ ",WBILRPTC
          REP       "+ ",WBILCACN
.
IHEMR999  RETURN
+
.--------------------------------------------------------------------------
. WebServices IHCW Claim Assessment Explanation tags webihfaf
.--------------------------------------------------------------------------
IHWF0000  BRANCH    FLDITMNO,IHWF0100,IHWF0200,IHWF0300,IHWF0400,IHWF0500:
                             IHWF0600,IHWF0700,IHWF0800,IHWF0900
          GOTO      IHWF9999
.
IHWF0100  CALL      IHFM0000
          GOTO      EMRS9999
.
IHWF0200  WRITE     HTMLFILE;WBINFBID;
          GOTO      IHWF9999
.
IHWF0300  WRITE     HTMLFILE;WBINARID;
          GOTO      IHWF9999
.
IHWF0400  WRITE     HTMLFILE;WBINFRID;
          GOTO      IHWF9999
.
IHWF0500  WRITE     HTMLFILE;WBINRPTC;
          GOTO      IHWF9999
.
IHWF0600  WRITE     HTMLFILE;WBINCACN;
          GOTO      IHWF9999
.
IHWF0700  WRITE     HTMLFILE;WBINEXCN;
          GOTO      IHWF9999
.
IHWF0800  WRITE     HTMLFILE;WBINEXCD;
          GOTO      IHWF9999
.
IHWF0900  WRITE     HTMLFILE;WBINEXTX;
          GOTO      IHWF9999
.
IHWF9999  RETURN
+
.***************************************************************************
.*                             IHFM0000                                    *
.*   Display the claim assessment expl   header received for an IHCW claim *
.***************************************************************************
IHFM0000  MATCH     "1",PTCNWSIN
          GOTO      IHFM9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIHCW
          GOTO      IHFM9999 IF NOT EQUAL
.
          CALL      IHFMH000
.
          PACK      KEY45,ECPRPTCD,ECPRINVN,ECPRFRID,ECPRREPT,ECPREVCN,SP70
          CALL      RSWBIHF1
IHFM1000  CALL      RKWBIHF1
          BRANCH    OVRCD,IHFM9999
.
          MATCH     ECPRPTCD,WBINFBID
          GOTO      IHFM9999 IF NOT EQUAL
.
          MATCH     ECPRINVN,WBINARID
          GOTO      IHFM9999 IF NOT EQUAL
.
          MATCH     ECPRFRID,WBINFRID
          GOTO      IHFM9999 IF NOT EQUAL
.
          MATCH     ECPRREPT,WBINRPTC
          GOTO      IHFM9999 IF NOT EQUAL
.
          MATCH     ECPREVCN,WBINCACN
          GOTO      IHFM9999 IF NOT EQUAL
.
          CALL      IHFMR000
.
          GOTO      IHFM1000
.
IHFM9999  RETURN
+
.------------------------------------------------------------
. IHF IHC Claim Assessment Explanation Header (TABLE HEADING)
.------------------------------------------------------------
IHFMH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Brand ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Account<br>Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Fund Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Text&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Report Details</td>":
                             "</tr>"
.
IHFMH999  RETURN
+
.------------------------------------------------------------
. WebServices Claim Assessment Explanation Header (Detail Row)
.------------------------------------------------------------
IHFMR000  REP       " +",WBINFBID
          REP       " +",WBINARID
          REP       " +",WBINFRID
          REP       " +",WBINRPTC
          REP       " +",WBINCACN
          REP       " +",WBINEXCN
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",WBINFBID:
                             "','",WBINARID,"','",WBINFRID,"','",WBINRPTC:
                             "','",WBINCACN,"','",WBINEXCN,"','006');>&nbsp;";
          REP       "+ ",WBINFBID
          REP       "+ ",WBINARID
          REP       "+ ",WBINFRID
          REP       "+ ",WBINRPTC
          REP       "+ ",WBINCACN
          REP       "+ ",WBINEXCN
.
          WRITE     HTMLFILE;WBINFBID,"</td>":
                             "<td>",WBINARID,"</td>":
                             "<td>",WBINFRID,"</td>":
                             "<td>",WBINEXCD,"</td>";
.
          REP       " +",WBINFBID
          REP       " +",WBINARID
          REP       " +",WBINFRID
          REP       " +",WBINRPTC
          REP       " +",WBINCACN
          REP       " +",WBINEXCN
.
.         MOVE      ZERO,FORM7P2
.         RJUSTIFY  WBIFSVCA
.         UNPACK    WBIFSVCA,DIM7,DIM2
.         PACK      DIM10,DIM7,DOT,DIM2
.         MOVE      DIM10,FORM7P2
.         WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
.         MOVE      SP70,DIM11
.         MATCH     SP70,WBIFSVDS
.         IF        !@EQUAL & !@EOS
.           UNPACK    WBIFSVDS,CCENT,CYEAR,CMON,CDAY
.           MOVE      CMON,F2
.           LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.           PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.         ENDIF
.         WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
.         MOVE      ZERO,FORM7P2
.         RJUSTIFY  WBIFSVBE
.         UNPACK    WBIFSVBE,DIM7,DIM2
.         PACK      DIM10,DIM7,DOT,DIM2
.         MOVE      DIM10,FORM7P2
.         WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
.         WRITE     HTMLFILE;"<td>",WBIFSVEC,"</td>";
.
.         MOVE      ZERO,FORM7P2
.         RJUSTIFY  WBIFSVSF
.         UNPACK    WBIFSVSF,DIM7,DIM2
.         PACK      DIM10,DIM7,DOT,DIM2
.         MOVE      DIM10,FORM7P2
.         WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBINEXTX,"</td>";
.
.         WRITE     HTMLFILE;
.                            "<td><img src='../images/EditIcon.gif'":
.                            " class=ListIcon onclick=displaySerH('",PRSHFBID:
.                            "','",PRSHARID,"','",PRSHCLID,"','",PRSHRPTC:
.                            "','",PRSHITMN,"','",PRSHSRVC,"','007');>":
.
          WRITE     HTMLFILE;"</td></tr>"
.
IHFMR999  RETURN
+
.--------------------------------------------------------------------------
. WebServices IHCW webihgaf tags
.--------------------------------------------------------------------------
IHWG0000  BRANCH    FLDITMNO,IHWG0100,IHWG0200,IHWG0300,IHWG0400,IHWG0500:
                             IHWG0600,IHWG0700,IHWG0800,IHWG0900,IHWG1000:
                             IHWG1100,IHWG1200,IHWG1300,IHWG1400

          GOTO      IHWG9999
.
IHWG0100  CALL      IHGM0000
          GOTO      IHWG9999
.
IHWG0200  WRITE     HTMLFILE;WBIOFBID;
          GOTO      IHWG9999
.
IHWG0300  WRITE     HTMLFILE;WBIOARID;
          GOTO      IHWG9999
.
IHWG0400  WRITE     HTMLFILE;WBIOFRID;
          GOTO      IHWG9999
.
IHWG0500  WRITE     HTMLFILE;WBIORPTC;
          GOTO      IHWG9999
.
IHWG0600  WRITE     HTMLFILE;WBIOSECN;
          GOTO      IHWG9999
.
IHWG0700  MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIOCAMT
          UNPACK    WBIOCAMT,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
.
          WRITE     HTMLFILE;FORM7P2;
          GOTO      IHWG9999
.
IHWG0800  WRITE     HTMLFILE;WBIOSCOD;
          GOTO      IHWG9999
.
IHWG0900  WRITE     HTMLFILE;WBIOSDSC;
          GOTO      IHWG9999
.
IHWG1000  MOVE      SP70,DIM11
          MATCH     SP70,WBIOFDTE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIOFDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;DIM11;
          GOTO      IHWG9999
.
IHWG1100  WRITE     HTMLFILE;WBIONOSV;
          GOTO      IHWG9999
.
IHWG1200  MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIOFBAM
          UNPACK    WBIOFBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
.
          WRITE     HTMLFILE;FORM7P2;
          GOTO      IHWG9999
.
IHWG1300  MOVE      SP70,DIM11
          MATCH     SP70,WBIOSDTE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIOSDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;DIM11;
          GOTO      IHWG9999
.
IHWG1400  MOVE      SP70,DIM11
          MATCH     SP70,WBIOTDTE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIOTDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;DIM11;
          GOTO      IHWG9999
.
IHWG9999  RETURN
+
.***************************************************************************
.*                             IHGM0000                                    *
.*   Display ihcw medicare assessment report details received for a claim  *
.***************************************************************************
IHGM0000  MATCH     "1",PTCNWSIN
          GOTO      IHGM9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIHCW
          GOTO      IHGM9999 IF NOT EQUAL
.
          CALL      IHGMH000
.
          PACK      KEY43,ECPRPTCD,ECPRINVN,ECPRFRID,ECPRREPT,SP70
          CALL      RSWBIHG1
IHGM1000  CALL      RKWBIHG1
          BRANCH    OVRCD,IHGM9999
.
          MATCH     ECPRPTCD,WBIOFBID
          GOTO      IHGM9999 IF NOT EQUAL
.
          MATCH     ECPRINVN,WBIOARID
          GOTO      IHGM9999 IF NOT EQUAL
.
          MATCH     ECPRFRID,WBIOFRID
          GOTO      IHGM9999 IF NOT EQUAL
.
          MATCH     ECPRREPT,WBIORPTC
          GOTO      IHGM9999 IF NOT EQUAL
.
          CALL      IHGMR000
.
          GOTO      IHGM1000
.
IHGM9999  RETURN
+
.------------------------------------------------------------
. IHG IHCW Service Assessment Details (TABLE HEADING)
.------------------------------------------------------------
IHGMH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Brand ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Account<br>Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Fund Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Charge Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Description&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "From Date&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Number of Services&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Fund Benefit Amount&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Service Date&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "To Date&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation&nbsp;</td>":
                             "</tr>"
.
IHGMH999  RETURN
+
.------------------------------------------------------------
. WebServices Service Assessment Details (Detail Row)
.------------------------------------------------------------
IHGMR000  REP       " +",WBIOFBID
          REP       " +",WBIOARID
          REP       " +",WBIOFRID
          REP       " +",WBIORPTC
          REP       " +",WBIOSECN
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displayAssD('",WBIOFBID:
                             "','",WBIOARID,"','",WBIOFRID,"','",WBIORPTC:
                             "','",WBIOSECN,"');>&nbsp;";
          REP       "+ ",WBIOFBID
          REP       "+ ",WBIOARID
          REP       "+ ",WBIOFRID
          REP       "+ ",WBIORPTC
          REP       "+ ",WBIOSECN
.
          WRITE     HTMLFILE;WBIOFBID,"</td>":
                             "<td>",WBIOARID,"</td>":
                             "<td>",WBIOFRID,"</td>";
.
          MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIOCAMT
          UNPACK    WBIOCAMT,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
.
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
          WRITE     HTMLFILE;"<td>",WBIOSCOD,"</td>";
          WRITE     HTMLFILE;"<td>",WBIOSDSC,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIOFDTE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIOFDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          WRITE     HTMLFILE;"<td>",WBIONOSV,"</td>";
.
          MOVE      ZERO,FORM7P2
          RJUSTIFY  WBIOFBAM
          UNPACK    WBIOFBAM,DIM7,DIM2
          PACK      DIM10,DIM7,DOT,DIM2
          MOVE      DIM10,FORM7P2
.
          WRITE     HTMLFILE;"<td>",FORM7P2,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIOSDTE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIOSDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          MOVE      SP70,DIM11
          MATCH     SP70,WBIOTDTE
          IF        !@EQUAL & !@EOS
            UNPACK    WBIOTDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;"<td>",DIM11,"</td>";
.
          REP       " +",WBIOFBID
          REP       " +",WBIOARID
          REP       " +",WBIOFRID
          REP       " +",WBIORPTC
          REP       " +",WBIOSECN
          WRITE     HTMLFILE;"<td><img src='../images/EditIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",WBIOFBID:
                             "','",WBIOARID,"','",WBIOFRID,"','",WBIORPTC:
                             "','",WBIOSECN,"','009');>":
                             "</td>":
                             "</tr>"
          REP       "+ ",WBIOFBID
          REP       "+ ",WBIOARID
          REP       "+ ",WBIOFRID
          REP       "+ ",WBIORPTC
          REP       "+ ",WBIOSECN
.
IHGMR999  RETURN
+
.--------------------------------------------------------------------------
. WebServices IHCW Service Assessment Explanation tags webihhaf
.--------------------------------------------------------------------------
IHWH0000  BRANCH    FLDITMNO,IHWH0100,IHWH0200,IHWH0300,IHWH0400,IHWH0500:
                             IHWH0600,IHWH0700,IHWH0800,IHWH0900,IHWH1000:
                             IHWH1100
.    
          GOTO      IHWH9999
.
IHWH0100  CALL      IHHM0000
          GOTO      EMRS9999
.
IHWH0200  WRITE     HTMLFILE;WBIPFBID;
          GOTO      IHWH9999
.
IHWH0300  WRITE     HTMLFILE;WBIPARID;
          GOTO      IHWH9999
.
IHWH0400  WRITE     HTMLFILE;WBIPFRID;
          GOTO      IHWH9999
.
IHWH0500  WRITE     HTMLFILE;WBIPRPTC;
          GOTO      IHWH9999
.
IHWH0600  WRITE     HTMLFILE;WBIPSECN;
          GOTO      IHWH9999
.
IHWH0700  WRITE     HTMLFILE;WBIPEXCN;
          GOTO      IHWH9999
.
IHWH0800  WRITE     HTMLFILE;WBIPEXCD;
          GOTO      IHWH9999
.
IHWH0900  WRITE     HTMLFILE;WBIPEXTX;
          GOTO      IHWH9999
.
IHWH1000  WRITE     HTMLFILE;WBIPTRID;
          GOTO      IHWH9999
.
IHWH1100  WRITE     HTMLFILE;WBIPMSID;
          GOTO      IHWH9999
.
IHWH9999  RETURN
+
.***************************************************************************
.*                             IHHM0000                                    *
.*   Display the serv assess exp  report header received for an IHCW claim *
.***************************************************************************
IHHM0000  MATCH     "1",PTCNWSIN
          GOTO      IHHM9999 IF NOT EQUAL
.
          MATCH     "1",PTCNIHCW
          GOTO      IHHM9999 IF NOT EQUAL
.
          CALL      IHHMH000
.
          PACK      KEY45,ECPRPTCD,ECPRINVN,ECPRFRID,ECPRREPT,ECPREVCN,SP70
          CALL      RSWBIHH1
IHHM1000  CALL      RKWBIHH1
          BRANCH    OVRCD,IHHM9999
.
          MATCH     ECPRPTCD,WBIPFBID
          GOTO      IHHM9999 IF NOT EQUAL
.
          MATCH     ECPRINVN,WBIPARID
          GOTO      IHHM9999 IF NOT EQUAL
.
          MATCH     ECPRFRID,WBIPFRID
          GOTO      IHHM9999 IF NOT EQUAL
.
          MATCH     ECPRREPT,WBIPRPTC
          GOTO      IHHM9999 IF NOT EQUAL
.
          MATCH     ECPREVCN,WBIPSECN
          GOTO      IHHM9999 IF NOT EQUAL
.
          CALL      IHHMR000
.
          GOTO      IHHM1000
.
IHHM9999  RETURN
+
.------------------------------------------------------------
. IHH IHC Service Assessment Explanation Header (TABLE HEADING)
.------------------------------------------------------------
IHHMH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell valign=top>":
                             "Fund<br>Brand ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Account<br>Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Fund Reference ID&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Code&nbsp;</td>":
                             "<td class=HeadingCell valign=top>":
                             "Explanation Text&nbsp;</td>":
.                            "<td class=HeadingCell valign=top>":
.                            "Report Details</td>":
                             "</tr>"
.
IHHMH999  RETURN
+
.------------------------------------------------------------
. WebServices Service Assessment Explanation (Detail Row)
.------------------------------------------------------------
IHHMR000  REP       " +",WBIPFBID
          REP       " +",WBIPARID
          REP       " +",WBIPFRID
          REP       " +",WBIPRPTC
          REP       " +",WBIPSECN
          REP       " +",WBIPEXCN
          WRITE     HTMLFILE;"<tr><td><img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displaySerH('",WBIPFBID:
                             "','",WBIPARID,"','",WBIPFRID,"','",WBIPRPTC:
                             "','",WBIPSECN,"','",WBIPEXCN,"','010');>&nbsp;";
          REP       "+ ",WBIPFBID
          REP       "+ ",WBIPARID
          REP       "+ ",WBIPFRID
          REP       "+ ",WBIPRPTC
          REP       "+ ",WBIPSECN
          REP       "+ ",WBIPEXCN
.
          WRITE     HTMLFILE;WBIPFBID,"</td>":
                             "<td>",WBIPARID,"</td>":
                             "<td>",WBIPFRID,"</td>":
                             "<td>",WBIPEXCD,"</td>":
                             "<td>",WBIPEXTX,"</td>";
.
          REP       " +",WBIPFBID
          REP       " +",WBIPARID
          REP       " +",WBIPFRID
          REP       " +",WBIPRPTC
          REP       " +",WBIPSECN
          REP       " +",WBIPEXCN
.
.         WRITE     HTMLFILE;
.                            "<td><img src='../images/EditIcon.gif'":
.                            " class=ListIcon onclick=displaySerH('",PRSHFBID:
.                            "','",PRSHARID,"','",PRSHCLID,"','",PRSHRPTC:
.                            "','",PRSHITMN,"','",PRSHSRVC,"','007');>":
.
          WRITE     HTMLFILE;"</td></tr>"
.
IHHMR999  RETURN
+
.------------------------------------------------------------
. WebServices Transaction Requests Enquiry
.------------------------------------------------------------
WBSTRN00  MATCH     "1",PTCNWSIN
          GOTO      WBSTRN91 IF NOT EQUAL
.
          COMPARE   ONE,ETRWINDC
          GOTO      WBSTRN91 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      WBSTRN80 IF EQUAL
.
          MATCH     "T",UPDTTYPE    * Transaction Request Details Display
          GOTO      WBSTRN10 IF EQUAL
.
          MATCH     "R",UPDTTYPE    * Transaction Request Resend All Errors
          GOTO      WBSTRN20 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Transaction Request Resend Single Error
          GOTO      WBSTRN30 IF EQUAL
.  
          MATCH     "C",UPDTTYPE    * Transaction Request Resend Single Error
          GOTO      WBSTRN40 IF EQUAL
.
          GOTO      WBSTRN85
.
WBSTRN10  PACK      KEY51,ECTRSTAT,ECTRTYPE,ECTRLOCN,ECTRCDTE:
                          ECTRCTIM,ECTRTRID,SP70
          CALL      RDWBETR1
          BRANCH    OVRCD,WBSTRN86
.
          GOTO      WBSTRN80
.
WBSTRN20  PACK      KEY51,ANSE,SP70
          CALL      RSWBETR1                     * position in file
          CALL      RKWBETR1                     * read next record
          BRANCH    OVRCD,WBSTRN80               * end of file
.
          MATCH     ANSE,WBETSTAT                * still error record ?
          GOTO      WBSTRN80 IF NOT EQUAL        * no - exit
.
          MOVE      SP1,WBETSTAT            * reset fields
          MOVE      SP8,WBETUDTE
          MOVE      SP8,WBETUTIM
          MOVE      SP4,WBETEROR
     
          MOVE      USERID,WBETUUID
  
          CALL      UPWBETR1
          GOTO      WBSTRN20
.
WBSTRN30  PACK      KEY51,ECTRSTAT,ECTRTYPE,ECTRLOCN,ECTRCDTE:
                          ECTRCTIM,ECTRTRID,SP70
          CALL      RDWBETR1
          BRANCH    OVRCD,WBSTRN87
.
          MOVE      SP1,WBETSTAT            * reset fields
          MOVE      SP8,WBETUDTE
          MOVE      SP8,WBETUTIM
          MOVE      SP4,WBETEROR
  
          MOVE      USERID,WBETUUID
  
          CALL      UPWBETR1                * update record
          GOTO      WBSTRN80
.
.         Check if record exist in weberhaf 
WBSTRN40  PACK      KEY61,TRANSCID,SP70
          CALL      RSWBERH4                     * position in file
WBSTRN45  CALL      RKWBERH4                     * read next record
          BRANCH    OVRCD,WBSTRN50
.
          MATCH     TRANSCID,WBEIFTID
          IF        @EQUAL
            MATCH     SP70,WBEIRADV
            GOTO      WBSTRN50 IF EQUAL 
.
            MATCH     SP70,WBEIPNUM
            GOTO      WBSTRN50 IF EQUAL
.
            MATCH     LOCATNID,WBEIPLID
            IF        @EQUAL
              GOTO      WBSTRN70
            ELSE 
              GOTO      WBSTRN45  
            ENDIF
          ENDIF
.
          GOTO      WBSTRN50 
.
.         Write Record to webetraf                                   
WBSTRN50  MOVE      SP1,WBETSTAT
          MOVE      " 5",WBETTYPE
          MOVE      TRANSCID,WBETTRID
.
          CALL      IBACLOCK                     * get current date/time
          PACK      WBETCDTE,CCC,CYY,CMM,CDD
          REP       " 0",WBETCDTE
          MOVE      CTIMEIS,WBETCTIM
          REP       " 0",WBETCTIM
          MOVE      SP70,WBETBATN
.
          MOVE      SP70,WBETINVN
          MOVE      SP70,WBETUDTE
          MOVE      SP70,WBETUTIM
          MOVE      LOCATNID,WBETLOCN
          MOVE      SP70,WBETSNID
          MOVE      SP70,WBETFDTM
          MOVE      SP70,WBETTDTM
          MOVE      SP70,WBETEROR
          MOVE      SP70,WBETMODL
          MOVE      SP70,WBETMSID
          MOVE      SP70,WBETSTRD
          MOVE      SP70,WBETSMID
          MOVE      SP70,WBETASSN
          MOVE      SP70,WBETLODT
          MOVE      SP70,WBETPSTA
          MOVE      SP70,WBETREFR
          MOVE      SP70,WBETREPS
          MOVE      SP70,WBETRTTY
          MOVE      SP70,WBETCUID
.
          MOVE      USERID,WBETCUID
          MOVE      SP70,WBETUUID
          MOVE      SP70,WBETSPAR
          PACK      KEY51,WBETSTAT,WBETTYPE,WBETLOCN,WBETCDTE,WBETCTIM,WBETTRID:
                          SP70
          CALL      RAWBETR1 
          IF        OVRCD=1
            CALL      WRWBETR1
          ENDIF
.
          GOTO      WBSTRN99
.
WBSTRN70  CALL      WBSERR00
          MOVE      ONE,EXIT
          GOTO      WBSTRN99
.
WBSTRN80  CLEAR     WEBTITLE
          MOVE      "WebServices Transaction Requests",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,WBSTRN99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      WBSTRN99
.
WBSTRN85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBSTRN99
.
WBSTRN86  MOVE      "Transaction Request Details not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBSTRN99
.
WBSTRN87  MOVE      "Selected record could not be updated.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WBSTRN99
.
WBSTRN91  MOVE      "Hospital not using the WebServices Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IMWEXT99
.
WBSTRN99  RETURN
+
.--------------------------------------------------------------------------
. Option 20 - WebServices Transaction Request Details tags
.--------------------------------------------------------------------------
WTRD0000  BRANCH    FLDITMNO,WTRD0100,WTRD0200,WTRD0300,WTRD0400,WTRD0500:
                             WTRD0600,WTRD0700,WTRD0800,WTRD0900,WTRD1000:
                             WTRD1100,WTRD1200,WTRD1300,WTRD1400,WTRD1500:
                             WTRD1600,WTRD1700,WTRD1800,WTRD1900
          GOTO      WTRD9999
.
WTRD0100  CALL      WBTRT000
          GOTO      WTRD9999
.
WTRD0200  MOVE      WBETSTAT,DIM1
          REP       " 10213E4",DIM1
          MOVE      DIM1,F1
          MOVE      SP70,REQSTATS
          LOAD      REQSTATS,F1,REQSTS00,REQSTS01,REQSTS02,REQSTS03
          WRITE     HTMLFILE;REQSTATS;
          GOTO      WTRD9999
.
WTRD0300  MOVE      WBETTYPE,FORM2
          MOVE      REQTYW00,REQTYPDS
          LOAD      REQTYPDS,FORM2,REQTYW01,REQTYW02,REQTYW03,REQTYW04,REQTYW05:
                                   REQTYW06,REQTYW07,REQTYW08,REQTYW09,REQTYW10:
                                   REQTYW11,REQTYW12,REQTYW13,REQTYW14,REQTYW15:
                                   REQTYW16,REQTYW17,REQTYW18,REQTYW19,REQTYW20:
                                   REQTYW21
          WRITE     HTMLFILE;REQTYPDS;
          GOTO      WTRD9999
.
WTRD0400  WRITE     HTMLFILE;WBETTRID;
          GOTO      WTRD9999
.
WTRD0500  PACK      KEY11,SP70
          MATCH     SP70,WBETCDTE
          IF        !@EQUAL
            UNPACK    WBETCDTE,CCENT,CYEAR,CMON,CDAY  * Date Created
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;KEY11;
          GOTO      WTRD9999
.
WTRD0600  WRITE     HTMLFILE;WBETCTIM;
          GOTO      WTRD9999
.
WTRD0700  WRITE     HTMLFILE;WBETBATN;
          GOTO      WTRD9999
.
WTRD0800  WRITE     HTMLFILE;WBETINVN;
          GOTO      WTRD9999
.
WTRD0900  PACK      KEY11,SP70
          MATCH     SP70,WBETUDTE
          IF        !@EQUAL
            UNPACK    WBETUDTE,CCENT,CYEAR,CMON,CDAY  * Date Updated
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;KEY11;
          GOTO      WTRD9999
.
WTRD1000  WRITE     HTMLFILE;WBETUTIM;
          GOTO      WTRD9999
.
WTRD1100  WRITE     HTMLFILE;WBETLOCN;
          GOTO      WTRD9999
.
WTRD1200  WRITE     HTMLFILE;WBETSNID;
          GOTO      WTRD9999
.
WTRD1300  UNPACK    WBETFDTM,DIM8,DIM6
          PACK      KEY20,SP70
          MATCH     SP70,DIM8
          IF        !@EQUAL
            UNPACK    DIM8,CCENT,CYEAR,CMON,CDAY  * From Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            MOVE      SP8,KEY8
            MATCH     SP6,DIM6
            IF        !@EQUAL
              UNPACK    DIM6,DISPHOUR,DISPMIN,DISPSEC
              PACK      KEY8,DISPHOUR,COLON,DISPMIN,COLON,DISPSEC
              REP       " 0",KEY8
            ENDIF
            PACK      KEY20,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,KEY8
          ENDIF
          WRITE     HTMLFILE;KEY20;
          GOTO      WTRD9999
.
WTRD1400  UNPACK    WBETTDTM,DIM8,DIM6
          PACK      KEY20,SP70
          MATCH     SP70,DIM8
          IF        !@EQUAL
            UNPACK    DIM8,CCENT,CYEAR,CMON,CDAY  * From Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            MOVE      SP8,KEY8
            MATCH     SP6,DIM6
            IF        !@EQUAL
              UNPACK    DIM6,DISPHOUR,DISPMIN,DISPSEC
              PACK      KEY8,DISPHOUR,COLON,DISPMIN,COLON,DISPSEC
              REP       " 0",KEY8
            ENDIF
            PACK      KEY20,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,KEY8
          ENDIF
          WRITE     HTMLFILE;KEY20;
          GOTO      WTRD9999
.
WTRD1500  WRITE     HTMLFILE;WBETEROR;
          GOTO      WTRD9999
.
WTRD1600  CALL      PREVEC00        * Show Prev group of records
          GOTO      WTRD9999
.
WTRD1700  CALL      NEXTEC00        * Show Next group of records
          GOTO      WTRD9999
.
WTRD1800  WRITE     HTMLFILE;FILTTYPE;      * request type filter
          GOTO      WTRD9999
.
WTRD1900  WRITE     HTMLFILE;FILTSTAT;      * status filter
          GOTO      WTRD9999
.
WTRD9999  RETURN
+
.------------------------------------------------------------
. Table of all WebServices Transaction Requests (webetraf)
.------------------------------------------------------------
WBTRT000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      ONE,SHOWFLAG
.
          MOVE      ZERO,LOOPCNTR
.
          CALL      WBTRH000                * output heading
.
          IF        NORECORD=0
            MOVE      "20",NORECORD         * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      FILTSTAT,D1
          REP       " E0 10213E",D1
.
          PACK      KEY51,D1,Z70
          CALL      RSWBETR3
WBTRT100  CALL      RPWBETR3                * read next record
          BRANCH    OVRCD,WBTRT900          * end of file
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 500)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     D1,WBETSTAT
          GOTO      WBTRT900 IF NOT EQUAL   * filter by status
.
WBTRT200  MATCH     SP70,FILTTYPE
          GOTO      WBTRT300 IF EQUAL       * all selected
.
          MATCH     FILTTYPE,WBETTYPE       * filter by type
          GOTO      WBTRT100 IF NOT EQUAL
.
WBTRT300  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      WBTRT100              * If < than strt Rec then Read Next
          ENDIF
.
          CALL      WBTRW000                * Output Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      WBTRT100 IF NOT EQUAL
          MOVE      ZERO,SHOWFLAG
.
WBTRT900  CALL      NOMREC00                * Show no more records message
.
WBTRT999  RETURN
+
.------------------------------------------------------------
. WebServices Transaction Requests (TABLE HEADING)
.------------------------------------------------------------
WBTRH000  WRITE     HTMLFILE;"<tr>";
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Type Of Request</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Claim Transaction ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Request Transaction ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Error Code</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Location ID</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Date Created</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Time Created</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell width=2%>":
                             "Tran Details</td>":
                             "</tr>"
.
WBTRH999  RETURN
+
.------------------------------------------------------------
. Display WebServices Transaction Requests (TABLE ROW)
.------------------------------------------------------------
WBTRW000  IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          REP       " +",WBETSTAT
          REP       " +",WBETTYPE
          REP       " +",WBETLOCN
          REP       " +",WBETCDTE
          REP       " +",WBETCTIM
          REP       " +",WBETTRID
          WRITE     HTMLFILE;"<img src='../images/CommentIcon.gif'":
                             " class=ListIcon onclick=displayTrans('",WBETSTAT:
                             "','",WBETTYPE,"','",WBETLOCN,"','",WBETCDTE:
                             "','",WBETCTIM,"','",WBETTRID,"');>&nbsp;";
          REP       "+ ",WBETSTAT
          REP       "+ ",WBETTYPE
          REP       "+ ",WBETLOCN
          REP       "+ ",WBETCDTE
          REP       "+ ",WBETCTIM
          REP       "+ ",WBETTRID
.
          PACK      KEY11,SP70
          MATCH     SP70,WBETCDTE
          IF        !@EQUAL
            UNPACK    WBETCDTE,CCENT,CYEAR,CMON,CDAY  * Date Created
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      WBETTYPE,FORM2
          MOVE      REQTYW00,REQTYPDS
          LOAD      REQTYPDS,FORM2,REQTYW01,REQTYW02,REQTYW03,REQTYW04,REQTYW05:
                                   REQTYW06,REQTYW07,REQTYW08,REQTYW09,REQTYW10:
                                   REQTYW11,REQTYW12,REQTYW13,REQTYW14,REQTYW15:
                                   REQTYW16,REQTYW17,REQTYW18,REQTYW19,REQTYW20:
                                   REQTYW21
.
          WRITE     HTMLFILE;REQTYPDS,"&nbsp;</td>":
                             "<td>",WBETTRID,"&nbsp;</td>";
.
          WRITE     HTMLFILE;"<td>",WBETSTRD,"&nbsp;</td>";
.
          MATCH     SP70,WBETEROR
          IF        @EQUAL
            WRITE     HTMLFILE;"<td>",WBETEROR,"&nbsp;</td>";
          ELSE
            WRITE     HTMLFILE;"<td>",WBETEROR,"&nbsp;&nbsp;";
            REP       " +",WBETSTAT
            REP       " +",WBETTYPE
            REP       " +",WBETLOCN
            REP       " +",WBETCDTE
            REP       " +",WBETCTIM
            REP       " +",WBETTRID
            WRITE     HTMLFILE;"<img src='../images/MoveIcon.gif'":
                             " class=ListIcon onclick=ResendError('",WBETSTAT:
                             "','",WBETTYPE,"','",WBETLOCN,"','",WBETCDTE:
                             "','",WBETCTIM,"','",WBETTRID,"');>&nbsp;";
            REP       "+ ",WBETSTAT
            REP       "+ ",WBETTYPE
            REP       "+ ",WBETLOCN
            REP       "+ ",WBETCDTE
            REP       "+ ",WBETCTIM
            REP       "+ ",WBETTRID
          ENDIF
.
          WRITE     HTMLFILE;"<td>",WBETLOCN,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",WBETCTIM,"&nbsp;</td>";
.
          REP       " +",WBETSTRD
          WRITE     HTMLFILE;"<td>";
.
          MATCH     "12",WBETTYPE
          IF        @EQUAL
            WRITE     HTMLFILE;"<img src='../images/DocumentIcon.gif'":
                           " class=ListIcon onclick=displayJSONBPYW('",WBETSTRD:
                           "');>";
          ELSE
            MATCH     "21",WBETTYPE
            IF        @EQUAL
              WRITE     HTMLFILE;"<img src='../images/DocumentIcon.gif'":
                             " class=ListIcon onclick=displayJSONDVYW('",WBETSTRD:
                             "');>";
            ELSE
              WRITE     HTMLFILE;"<img src='../images/DocumentIcon.gif'":
                             " class=ListIcon onclick=displayJSON('",WBETSTRD:
                             "');>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</td>";
          REP       "+ ",WBETSTRD 
.
          WRITE     HTMLFILE;"</tr>"
.
          GOTO      WBTRW999
.
WBTRW999  RETURN
+
.------------------------------------------------------------
. Output HTML Error File For WebServices Transaction Request
.------------------------------------------------------------
WBSERR00  CALL      OPENHTML
          BRANCH    EXIT,WBSERR95
.
          CLEAR     WEBTITLE
          MATCH     "0",WBEISTAT
          IF        @EQUAL
            APPEND    "Received",WEBTITLE
          ENDIF
.
          MATCH     "1",WBEISTAT
          IF        @EQUAL
            APPEND    "Partial",WEBTITLE
          ENDIF
.
          MATCH     "2",WBEISTAT
          IF        @EQUAL
            APPEND    "Released",WEBTITLE
          ENDIF
.
          MATCH     "3",WBEISTAT
          IF        @EQUAL
            APPEND    "Processing",WEBTITLE
          ENDIF
.
          UNPACK    WBEIDATE,CCENT,CYEAR,CMON,CDAY
          MATCH     SP70,PTMXRDAT
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> ":
 "  var PopUpScreen = parent.document.getElementById('PopUpScreen');":
                    "alert(#"":
               "This TransactionID already exists:\n\n":
       "Payment Reference  ",WBEIPREF,"\n":
       "Run Date                  ",CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"\n":
       "Status                       ",WEBTITLE:
                    "#");":              
                    "  if (window.name.substr(0,4)=='Hide') {":
                    "    self.close();} else {":
                    "  if (PopUpScreen) {":
                    "    PopUpScreen.style.display='none'; } else {":
                    "    history.go(-1); }":
                    "}":
                    "</script>",012
. 
          RESET     WEBTITLE
          CALL      CLOSHTML     * End of Document
          GOTO      WBSERR99
.
.
WBSERR95  DISPLAY   "*** Fifo Not Found - ",FILNAM," ***"
.
WBSERR99  RETURN
+
.------------------------------------------------------------
. WebServices PCIW Claims Extract
.------------------------------------------------------------
PCWEXT00  MATCH     "1",PTCNWSIN
          GOTO      PCWEXT91 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      PCWEXT91 IF NOT EQUAL
.
          COMPARE   ONE,PCIWINDC
          GOTO      PCWEXT91 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      PCWEXT80 IF EQUAL
.
          MATCH     "L",UPDTTYPE
          GOTO      PCWEXT10 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Extract Claims
          GOTO      PCWEXT30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Claims
          GOTO      PCWEXT40 IF EQUAL
.
          GOTO      PCWEXT85
.
PCWEXT10  CALL      PERW0000                     * reset any error records
          GOTO      PCWEXT80
.
PCWEXT30  COMPARE   ZERO,LASTDCLM
          GOTO      PCWEXT35 IF EQUAL            * any claims to delete first ?
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,PECLMARR[COUNT]
            IF        !@EQUAL
              CALL      PDEW0000                 * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      PCWEXT35 IF EQUAL
.
          CALL      ERRLST00                     * display any delete errors
.>>>>     MOVE      ONE,EXIT
.>>>>     GOTO      PCWEXT99
.
PCWEXT35  
.         MATCH     "1",PTCNPCIW                 * using edi module?
.         GOTO      PCWEXT91 IF NOT EQUAL
.
.         MATCH     SP70,PTCNESFO                * eclipse outbound path set?
.         GOTO      PCWEXT92 IF EQUAL
.
          COMPARE   ZERO,LASTECLM
          GOTO      PCWEXT86 IF EQUAL            * no claims to extract
.
          CALL      SFCWX000                     * Extract Eclipse Claims
.
          MOVE      ZERO,EXIT
          GOTO      PCWEXT99
.
.   ************ DELETE CLAIM FUNCTION ************
.>>>>
PCWEXT40  COMPARE   ZERO,LASTDCLM
          GOTO      PCWEXT86 IF EQUAL            * no claims to delete
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,PECLMARR[COUNT]
            IF        !@EQUAL
              CALL      PDEW0000   * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      PCWEXT99 IF EQUAL
.
          CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      PCWEXT99
.
PCWEXT80  CLEAR     WEBTITLE
          MOVE      "WebServices PCIW Claims Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PCWEXT99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PCWEXT99
.
PCWEXT85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCWEXT99
.
PCWEXT86  MOVE      "No claims selected to extract.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCWEXT99
.
PCWEXT91  MOVE      "Hospital not using the PCIW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCWEXT99
.
PCWEXT92  MOVE      "WebServices PCIW Outbound Path blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCWEXT99
.
PCWEXT99  RETURN
+
.*****************************************************************************
.*                               PDEW0000                                    *
.*               Delete selected WebServices PCIW Claim records              *
.*****************************************************************************
PDEW0000  UNPACK    PECLMARR[COUNT],KEY8,KEY1    * invoice number / module
          PACK      KEY17,KEY8,SP8,KEY1,SP70       * batch number is blank
          CALL      RDWBPCI2
          BRANCH    OVRCD,PDEW8000
.
          MOVE      WBPIINVN,TEMPINVN
          MOVE      WBPIBATN,TEMPBATN
          MOVE      WBPIUNIQ,TEMPADMN
          MOVE      WBPIURNO,TEMPURNO
          MOVE      WBPIPBAT,TEMPPBAT
          MOVE      WBPIHOSP,TEMPHOSP
          MOVE      WBPIMODL,TEMPMODL
.
          MATCH     SP70,TEMPPBAT
          GOTO      PDEW1000 IF EQUAL
          GOTO      PDEW1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,SP1,FIVE,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDWBPCI1
          IF        OVRCD = 1
            GOTO      PDEW7000
          ELSE
            MOVE      SP70,WBPINBAT

            CALL      IBACLOCK
            PACK      WBPIUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBPIUDAT
            MOVE      CTIMEIS,WBPIUTIM
            MOVE      USERID,WBPIUUID
            CALL      UPWBPCI1
          ENDIF
.
.         Delete the selected record
.
PDEW1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN,SP70
          CALL      DEWBPCI1
.
          GOTO      PDEW9999
.
PDEW7000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      PDEW9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Error updating previous claim - ",ERRORLST[ERRORCNT]
          APPEND    WBPIINVN,ERRORLST[ERRORCNT]
          APPEND    "  Batch - ",ERRORLST[ERRORCNT]
          APPEND    WBPIBATN,ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      PDEW9999
.
PDEW8000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      PDEW9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Record cannot be deleted.  ",ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      PDEW9999

PDEW9999  RETURN
+
.--------------------------------------------------------------------------
.*                             SFCWX000                                   *
.*               Schedule WebServices PCIW Extract (IBAWEB05)             *
.--------------------------------------------------------------------------
SFCWX000  MOVE      "IBAWEB05",SCHDPGID
          MOVE      "WebServices PCIW Claims Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAWEB05",SETDFPRG
          MOVE      "11",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ONE,COUNT
          MOVE      HOSPCODE,KEYSTARR[COUNT]    * hospital id
          ADD       ONE,COUNT
          MOVE      ONE,KEYSTARR[COUNT]    * extract pcs (1)
.
.         COMPARE   TWO,OPTNFLAG
.         GOTO      SFCWX500 IF EQUAL
.
.         ADD       ONE,COUNT
.         MOVE      HFUNDTYP,KEYSTARR[COUNT]    * health fund
.
.         MOVE      THREE,TOTALCNT              * first 3 keyins
.         GOTO      SFCWX600
.
SFCWX500  MOVE      TWO,TOTALCNT
.
SFCWX600  ADD      ONE,COUNT
          MOVE     ONE,COUNTEC
          WHILE     COUNTEC <= LASTECLM
            MATCH     SP90,ECCLMARR[COUNTEC]
            IF        !@EQUAL
              MOVE      ECCLMARR[COUNTEC],KEYSTARR[COUNT]    * to be extracted
            ENDIF
            ADD      ONE,COUNT
            ADD      ONE,COUNTEC
          DO
.
          ADD       LASTECLM,TOTALCNT            * eclipse claims keyins
.
          PACK      KEYSTARR[COUNT],SP70         * blank record to signal exit
          ADD       ONE,COUNT
          ADD       ONE,TOTALCNT
.
          MOVE      ANSP,KEYSTARR[COUNT]         * (P)ost
.>>>>
.>>>>     ADD       ONE,COUNT
.>>>>     MOVE      ANSY,KEYSTARR[COUNT]         * (Y) to extract (if ok)
.>>>>
          ADD       ONE,COUNT
          MOVE      SP70,KEYSTARR[COUNT]         * (Enter) to exit
          ADD       ONE,COUNT
          MOVE      "\",KEYSTARR[COUNT]          * (\) to exit
.
          ADD       THREE,TOTALCNT               * add last 3 keyins (if error)
.>>>>     ADD       FOUR,TOTALCNT                * add last 4 keyins (if ok)
          MOVE      TOTALCNT,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SFCWX999  RETURN
+
.--------------------------------------------------------------------------
. Option 21 - WebServices PCIW Claims Extract tags
.--------------------------------------------------------------------------
PEXT0000  BRANCH    FLDITMNO,PEXT0100,PEXT0200,PEXT0300,PEXT0400,PEXT0500:
                             PEXT0600,PEXT0700,PEXT0800
          GOTO      PEXT9999
.
PEXT0100  MOVE      ONE,ALLHFLAG          * default to 'All'
          CALL      HOSPID00              * display Multi-hosp. selection list
          GOTO      PEXT9999
.
PEXT0200  CALL      ECSHN000              * selected Hospital Desc (Multi-hosp)
          GOTO      PEXT9999
.
PEXT0300
.         MOVE      "CL",CATEGORY         * Compensation code/Claim Type
.         MOVE      HFUNDTYP,CODE
.         CALL      CODITM00
          GOTO      PEXT9999
.
PEXT0400  CALL      PCWFX000              * Claims Waiting for Extraction
          GOTO      PEXT9999
.
PEXT0500  MATCH     SP70,UPDTTYPE
          GOTO      PEXT9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI
          GOTO      PEXT9999
.
PEXT0600
.         WRITE     HTMLFILE;CLAMTYPE;    * Claim type CGI
          GOTO      PEXT9999
.
PEXT0700
.         MATCH     SP70,HFUNDTYP
.         GOTO      PEXT9999 IF EQUAL
.         WRITE     HTMLFILE;HFUNDTYP;    * Health Fund CGI
          GOTO      PEXT9999
.
PEXT0800
.         WRITE     HTMLFILE;HFUNDESC;    * Health Fund Desc CGI
          GOTO      PEXT9999
.
PEXT9999  RETURN
+
.------------------------------------------------------------
. Table of all WebServices PCIW Claims Waiting For Extraction
.------------------------------------------------------------
PCWFX000  MATCH     "1",PTCNWSIN
          GOTO      PCWFX999 IF NOT EQUAL
.
          MATCH     "1",PTCNPCIW
          GOTO      PCWFX999 IF NOT EQUAL
.
          COMPARE   ONE,PCIWINDC
          GOTO      PCWFX999 IF NOT EQUAL
.
          MOVE      ZERO,FORM3
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY30,HOSPCODE,SP1,ZERO,SP70
PCWFX040  CALL      RSWBPCI1
PCWFX050  CALL      RKWBPCI1                * read next record
          BRANCH    OVRCD,PCWFX900          * end of file
.
          MATCH     SP3,HOSPCODE                 * all hospitals ?
          IF        !@EQUAL
            MATCH     HOSPCODE,WBPIHOSP          * no - same hospital still ?
            GOTO      PCWFX900 IF NOT EQUAL      * no - finished
          ENDIF
.
          COMPARE   ZERO,WBPIFLAG                * waiting for extract still ?
          IF        !@EQUAL
            PACK      KEY30,WBPIHOSP,Z70
            GOTO      PCWFX040                   * get next record
          ENDIF
.
.         A waiting record has been found,
.         so get the invoice details and calculate the amount outstanding.
.
PCWFX200  MATCH     "1",WBPIMODL
          IF        @EQUAL
            CALL      PCLR2000
          ELSE
            CALL      PCLR1000
          ENDIF
.
          IF        DISNUMB>=50
            GOTO      PCWFX800
          ENDIF
          GOTO      PCWFX050
.
PCWFX800  CALL      LIMREC00        * Show batch limit reached message
          GOTO      PCWFX999
.
PCWFX900  CALL      TOTREC00        * Show no more records message
.
PCWFX999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse PCS (TABLE ROW)
.------------------------------------------------------------
PCLR1000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,WBPIINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP8,PRINDATE
          ELSE
            IF        PRINUNIQ = 0
              GOTO      PCLR1900                 * delete claim
            ENDIF
            ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM12P2
            IF        IBCNUGST=2
              ADD       PRINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PRINDATE
          IF        !@EQUAL
            UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;WBPIUNIQ,"&nbsp;</td>":
                             "<td>",WBPIINVN,"&nbsp;</td>":
                             "<td>",WBPIURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",WBPIHOSP,WBPIUNIQ,WBPIINVN:
                                  WBPIURNO,PRINDATE,KEY15,WBPIMODL,SP1,ZERO,SP1:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=peclm",KEY3:
                             " value='",WBPIINVN,WBPIMODL:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      PCLR1999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in webpciaf
.
PCLR1900  PACK      SAVKEY30,WBPIHOSP,WBPIFLAG,WBPIMODL,WBPIUNIQ,WBPIINVN:
                             WBPIBATN
          MOVE      SAVKEY30,KEY30
          CALL      DEWBPCI1                 * delete cancelled/zero invoices
          MOVE      SAVKEY30,KEY30
          CALL      RSWBPCI1
.
PCLR1999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for WebServices (TABLE ROW)
.------------------------------------------------------------
PCLR2000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,WBPIINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      SP8,PINVDTE
          ELSE
            MATCH     ZEROVISN,PINVADM
            IF        @EQUAL
              GOTO      PCLR2900                 * delete claim
            ENDIF
            IF        PINVTYP =2
              GOTO      PCLR2900                 * delete claim
            ENDIF
            ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR),FORM12P2
            IF        IBCNUGST=2
              ADD       PTINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PINVDTE
          IF        !@EQUAL
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;WBPIUNIQ,"&nbsp;</td>":
                             "<td>",WBPIINVN,"&nbsp;</td>":
                             "<td>",WBPIURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",WBPIHOSP,WBPIUNIQ,WBPIINVN:
                                       WBPIURNO,PINVDTE,KEY15,WBPIMODL,SP1,ZERO,SP1:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=peclm",KEY3:
                             " value='",WBPIINVN,WBPIMODL:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      PCLR2999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in webpciaf
.
PCLR2900  PACK      SAVKEY30,WBPIHOSP,WBPIFLAG,WBPIMODL,WBPIUNIQ,WBPIINVN:
                             WBPIBATN
          MOVE      SAVKEY30,KEY30
          CALL      DEWBPCI1                 * delete cancelled/zero invoices
          MOVE      SAVKEY30,KEY30
          CALL      RSWBPCI1
.
PCLR2999  RETURN
+
.*****************************************************************************
.*                              PERW0000           Called by: PCLEXT00       *
.*             Reset error records back to zero status (Not Sent)            *
.*             just in case there were any problems with a previous          *
.*             batch and the error records were not set back to zero.        *
.*****************************************************************************
.
PERW0000  MOVE      HOSPCODE,SAVEHOSP            * initialise hospital
          MOVE      ZERO,FIRSTFLG                * initialise flag
.
          PACK      KEY30,HOSPCODE,SP1,ONE,SP70
PERW0500  CALL      RSWBPCI1                     * position in file
          CALL      RKWBPCI1                     * read next record
          BRANCH    OVRCD,PERW9999               * eof - finished
.
          IF        FIRSTFLG = 0
            MATCH     SP3,HOSPCODE               * all hospitals extract ?
            IF        @EQUAL
              MOVE      WBPIHOSP,SAVEHOSP        * yes-load first hospital code
            ENDIF
            MOVE      ONE,FIRSTFLG               * set first flag to no
          ENDIF
.
          MATCH     SP3,HOSPCODE                 * all hospitals extract ?
          GOTO      PERW5000 IF NOT EQUAL        * no
.
.         We are running an extract for all hospitals
.
          MATCH     SAVEHOSP,WBPIHOSP            * same hospital still ?
          IF        !@EQUAL
            MOVE      WBPIHOSP,SAVEHOSP          * no - save new hospital code
            PACK      KEY30,WBPIHOSP,SP1,ONE,SP70
            GOTO      PERW0500
          ENDIF
.
          COMPARE   ONE,WBPIFLAG                 * error record still ?
          GOTO      PERW4000 IF NOT EQUAL        * no - get next hospital
.
          GOTO      PERW8000
.
PERW4000  PACK      KEY30,WBPIHOSP,Z70
          GOTO      PERW0500
.
.         We are running an extract for a given hospital id
.
PERW5000  MATCH     HOSPCODE,WBPIHOSP            * same hospital still ?
          GOTO      PERW9999 IF NOT EQUAL        * no - finished
.
          COMPARE   ONE,WBPIFLAG                 * error record still ?
          GOTO      PERW9999 IF NOT EQUAL        * no - finished
.
.         Reset the record status to "Waiting"
.
PERW8000  PACK      SAVKEY30,WBPIHOSP,WBPIFLAG,WBPIMODL,WBPIUNIQ,WBPIINVN:
                             WBPIBATN
          MOVE      ZERO,WBPIFLAG                * yes - reset flag to "0"

          CALL      IBACLOCK
          PACK      WBPIUDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBPIUDAT
          MOVE      CTIMEIS,WBPIUTIM
          MOVE      USERID,WBPIUUID
          CALL      UPWBPCI1                     * update record
          MOVE      SAVKEY30,KEY30               * load key to reposition
          GOTO      PERW0500                     * get next record
.
PERW9999  RETURN
+
.------------------------------------------------------------
. Eclipse BBSW Claims Extract
.------------------------------------------------------------
BBWEXT00  MATCH     "1",PTCNWSIN
          GOTO      BBWEXT91 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      BBWEXT91 IF NOT EQUAL
.
          COMPARE   ONE,BBSWINDC
          GOTO      BBWEXT91 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      BBWEXT80 IF EQUAL
.
          MATCH     "L",UPDTTYPE
          GOTO      BBWEXT10 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Extract Claims
          GOTO      BBWEXT30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Claims
          GOTO      BBWEXT40 IF EQUAL
.
          GOTO      BBWEXT85
.
BBWEXT10  CALL      BERW0000                     * reset any error records
          GOTO      BBWEXT80
.
BBWEXT30  COMPARE   ZERO,LASTDCLM
          GOTO      BBWEXT35 IF EQUAL            * any claims to delete first ?
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,PECLMARR[COUNT]
            IF        !@EQUAL
              CALL      BDEW0000                 * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      BBWEXT35 IF EQUAL
.
          CALL      ERRLST00                     * display any delete errors
.>>>>     MOVE      ONE,EXIT
.>>>>     GOTO      BBWEXT99
.
BBWEXT35  
.         MATCH     "1",PTCNUEBB                 * using edi module?
.         GOTO      BBWEXT91 IF NOT EQUAL
.
.         MATCH     SP70,PTCNEDBO                * eclipse outbound path set?
.         GOTO      BBWEXT92 IF EQUAL
.
          COMPARE   ZERO,LASTECLM
          GOTO      BBWEXT86 IF EQUAL            * no claims to extract
.
          CALL      BBSWX000                     * Extract Eclipse Claims
.
          MOVE      ZERO,EXIT
          GOTO      BBWEXT99
.
.   ************ DELETE CLAIM FUNCTION ************
.>>>>
BBWEXT40  COMPARE   ZERO,LASTDCLM
          GOTO      BBWEXT86 IF EQUAL            * no claims to delete
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,PECLMARR[COUNT]
            IF        !@EQUAL
              CALL      BDEW0000   * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      BBWEXT99 IF EQUAL
.
          CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      BBWEXT99
.
BBWEXT80  CLEAR     WEBTITLE
          MOVE      "WebServices BBSW Claims Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,BBWEXT99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      BBWEXT99
.
BBWEXT85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BBWEXT99
.
BBWEXT86  MOVE      "No claims selected to extract.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BBWEXT99
.
BBWEXT91  MOVE      "Hospital not using the BBW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BBWEXT99
.
BBWEXT92  MOVE      "Eclipse BBW Outbound Path blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BBWEXT99
.
BBWEXT99  RETURN
+
.*****************************************************************************
.*                              BERW0000           Called by: DBSEXT00       *
.*             Reset error records back to zero status (Not Sent)            *
.*             just in case there were any problems with a previous          *
.*             batch and the error records were not set back to zero.        *
.*****************************************************************************
.
BERW0000  MOVE      HOSPCODE,SAVEHOSP            * initialise hospital
          MOVE      ZERO,FIRSTFLG                * initialise flag
.
          PACK      KEY30,HOSPCODE,SP1,ONE,SP70
BERW0500  CALL      RSWBBBS1                     * position in file
          CALL      RKWBBBS1                     * read next record
          BRANCH    OVRCD,BERW9999               * eof - finished
.
          IF        FIRSTFLG = 0
            MATCH     SP3,HOSPCODE               * all hospitals extract ?
            IF        @EQUAL
              MOVE      WBBSHOSP,SAVEHOSP        * yes-load first hospital code
            ENDIF
            MOVE      ONE,FIRSTFLG               * set first flag to no
          ENDIF
.
          MATCH     SP3,HOSPCODE                 * all hospitals extract ?
          GOTO      BERW5000 IF NOT EQUAL        * no
.
.         We are running an extract for all hospitals
.
          MATCH     SAVEHOSP,WBBSHOSP            * same hospital still ?
          IF        !@EQUAL
            MOVE      WBBSHOSP,SAVEHOSP          * no - save new hospital code
            PACK      KEY30,WBBSHOSP,SP1,ONE,SP70
            GOTO      BERW0500
          ENDIF
.
          COMPARE   ONE,WBBSFLAG                 * error record still ?
          GOTO      BERW4000 IF NOT EQUAL        * no - get next hospital
.
          GOTO      BERW8000
.
BERW4000  PACK      KEY30,WBBSHOSP,Z70
          GOTO      BERW0500
.
.         We are running an extract for a given hospital id
.
BERW5000  MATCH     HOSPCODE,WBBSHOSP            * same hospital still ?
          GOTO      BERW9999 IF NOT EQUAL        * no - finished
.
          COMPARE   ONE,WBBSFLAG                 * error record still ?
          GOTO      BERW9999 IF NOT EQUAL        * no - finished
.
.         Reset the record status to "Waiting"
.
BERW8000  PACK      SAVKEY30,WBBSHOSP,WBBSFLAG,WBBSMODL,WBBSUNIQ,WBBSINVN:
                             WBBSBATN
          MOVE      ZERO,WBBSFLAG                * yes - reset flag to "0"

          CALL      IBACLOCK
          PACK      WBBSUDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBBSUDAT
          MOVE      CTIMEIS,WBBSUTIM
          MOVE      USERID,WBBSUUID
          CALL      UPWBBBS1                     * update record
          MOVE      SAVKEY30,KEY30               * load key to reposition
          GOTO      BERW0500                     * get next record
.
BERW9999  RETURN
+
.*****************************************************************************
.*                               BDEW0000                                    *
.*               Delete selected Eclipse BBSW Claim records                  *
.*****************************************************************************
BDEW0000  UNPACK    PECLMARR[COUNT],KEY8,KEY1    * invoice number / module
          PACK      KEY17,KEY8,SP8,KEY1,SP70       * batch number is blank
          CALL      RDWBBBS2
          BRANCH    OVRCD,BDEW8000
.
          MOVE      WBBSINVN,TEMPINVN
          MOVE      WBBSBATN,TEMPBATN
          MOVE      WBBSUNIQ,TEMPADMN
          MOVE      WBBSURNO,TEMPURNO
          MOVE      WBBSPBAT,TEMPPBAT
          MOVE      WBBSHOSP,TEMPHOSP
          MOVE      WBBSMODL,TEMPMODL
.
          MATCH     SP70,TEMPPBAT
          GOTO      BDEW1000 IF EQUAL
          GOTO      BDEW1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,FIVE,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDWBBBS1
          IF        OVRCD = 1
            GOTO      BDEW7000
          ELSE
            MOVE      SP70,WBBSNBAT

            CALL      IBACLOCK
            PACK      WBBSUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBBSUDAT
            MOVE      CTIMEIS,WBBSUTIM
            MOVE      USERID,WBBSUUID
            CALL      UPWBBBS1
          ENDIF
.
.         Delete the selected record
.
BDEW1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN,SP70
          CALL      DEWBBBS1
.
          GOTO      BDEW9999
.
BDEW7000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      BDEW9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Error updating previous claim - ",ERRORLST[ERRORCNT]
          APPEND    WBBSINVN,ERRORLST[ERRORCNT]
          APPEND    "  Batch - ",ERRORLST[ERRORCNT]
          APPEND    WBBSBATN,ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      BDEW9999
.
BDEW8000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      BDEW9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Record cannot be deleted.  ",ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      BDEW9999

BDEW9999  RETURN
+
.--------------------------------------------------------------------------
.*                             BBSWX000                                   *
.*               Schedule Eclipse Extract (IBAWEB06)                      *
.--------------------------------------------------------------------------
BBSWX000  MOVE      "IBAWEB06",SCHDPGID
          MOVE      "Eclipse BBSW Claims Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAWEB06",SETDFPRG
          MOVE      "11",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ONE,COUNT
          MOVE      HOSPCODE,KEYSTARR[COUNT]    * hospital id
          ADD       ONE,COUNT
          MOVE      ONE,KEYSTARR[COUNT]    * extract pcs (1)
.
.         COMPARE   TWO,OPTNFLAG
.         GOTO      BBSWX500 IF EQUAL
.
.         ADD       ONE,COUNT
.         MOVE      HFUNDTYP,KEYSTARR[COUNT]    * health fund
.
.         MOVE      THREE,TOTALCNT              * first 3 keyins
.         GOTO      BBSWX600
.
BBSWX500  MOVE      TWO,TOTALCNT
.
BBSWX600  ADD      ONE,COUNT
          MOVE     ONE,COUNTEC
          WHILE     COUNTEC <= LASTECLM
            MATCH     SP90,ECCLMARR[COUNTEC]
            IF        !@EQUAL
              MOVE      ECCLMARR[COUNTEC],KEYSTARR[COUNT]    * to be extracted
            ENDIF
            ADD      ONE,COUNT
            ADD      ONE,COUNTEC
          DO
.
          ADD       LASTECLM,TOTALCNT            * eclipse claims keyins
.
          PACK      KEYSTARR[COUNT],SP70         * blank record to signal exit
          ADD       ONE,COUNT
          ADD       ONE,TOTALCNT
.
          MOVE      ANSP,KEYSTARR[COUNT]         * (P)ost
.>>>>
.>>>>     ADD       ONE,COUNT
.>>>>     MOVE      ANSY,KEYSTARR[COUNT]         * (Y) to extract (if ok)
.>>>>
          ADD       ONE,COUNT
          MOVE      SP70,KEYSTARR[COUNT]         * (Enter) to exit
          ADD       ONE,COUNT
          MOVE      "\",KEYSTARR[COUNT]          * (\) to exit
.
          ADD       THREE,TOTALCNT               * add last 3 keyins (if error)
.>>>>     ADD       FOUR,TOTALCNT                * add last 4 keyins (if ok)
          MOVE      TOTALCNT,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
BBSWX999  RETURN
+
.--------------------------------------------------------------------------
. Option 22 - Eclipse BBSW Claims Extract tags
.--------------------------------------------------------------------------
BEXT0000  BRANCH    FLDITMNO,BEXT0100,BEXT0200,BEXT0300,BEXT0400,BEXT0500:
                             BEXT0600,BEXT0700,BEXT0800
          GOTO      BEXT9999
.
BEXT0100  MOVE      ONE,ALLHFLAG          * default to 'All'
          CALL      HOSPID00              * display Multi-hosp. selection list
          GOTO      BEXT9999
.
BEXT0200  CALL      ECSHN000              * selected Hospital Desc (Multi-hosp)
          GOTO      BEXT9999
.
BEXT0300
.         MOVE      "CL",CATEGORY         * Compensation code/Claim Type
.         MOVE      HFUNDTYP,CODE
.         CALL      CODITM00
          GOTO      BEXT9999
.
BEXT0400  CALL      BBWFX000              * Claims Waiting for Extraction
          GOTO      BEXT9999
.
BEXT0500  MATCH     SP70,UPDTTYPE
          GOTO      BEXT9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI
          GOTO      BEXT9999
.
BEXT0600
.         WRITE     HTMLFILE;CLAMTYPE;    * Claim type CGI
          GOTO      BEXT9999
.
BEXT0700
.         MATCH     SP70,HFUNDTYP
.         GOTO      BEXT9999 IF EQUAL
.         WRITE     HTMLFILE;HFUNDTYP;    * Health Fund CGI
          GOTO      BEXT9999
.
BEXT0800
.         WRITE     HTMLFILE;HFUNDESC;    * Health Fund Desc CGI
          GOTO      BEXT9999
.
BEXT9999  RETURN
+
.------------------------------------------------------------
. Table of all Eclipse BBSW Claims Waiting For Extraction
.------------------------------------------------------------
BBWFX000  MATCH     "1",PTCNWSIN
          GOTO      BBWFX999 IF NOT EQUAL
.
          MATCH     "1",PTCNBBSW
          GOTO      BBWFX999 IF NOT EQUAL
.
          COMPARE   ONE,BBSWINDC
          GOTO      BBWFX999 IF NOT EQUAL
.
          MOVE      ZERO,FORM3
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY30,HOSPCODE,SP1,ZERO,SP70
BBWFX040  CALL      RSWBBBS1
BBWFX050  CALL      RKWBBBS1                * read next record
          BRANCH    OVRCD,BBWFX900          * end of file
.
          MATCH     SP3,HOSPCODE                 * all hospitals ?
          IF        !@EQUAL
            MATCH     HOSPCODE,WBBSHOSP          * no - same hospital still ?
            GOTO      BBWFX900 IF NOT EQUAL      * no - finished
          ENDIF
.
          COMPARE   ZERO,WBBSFLAG                * waiting for extract still ?
          IF        !@EQUAL
            PACK      KEY30,WBBSHOSP,Z70
            GOTO      BBWFX040                   * get next record
          ENDIF
.
.         A waiting record has been found,
.         so get the invoice details and calculate the amount outstanding.
.
BBWFX200  MATCH     "1",WBBSMODL
          IF        @EQUAL
.           CALL      BBLR2000
          ELSE
            MATCH     "2",WBBSMODL
            IF        @EQUAL
              CALL      BBLR1000
            ELSE
              CALL      BBLR3000
            ENDIF
          ENDIF
.
          IF        DISNUMB>=50
            GOTO      BBWFX800
          ENDIF
          GOTO      BBWFX050
.
BBWFX800  CALL      LIMREC00        * Show batch limit reached message
          GOTO      BBWFX999
.
BBWFX900  CALL      TOTREC00        * Show no more records message
.
BBWFX999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse BBSW (TABLE ROW)
.------------------------------------------------------------
BBLR1000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,WBBSINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP8,PRINDATE
          ELSE
            IF        PRINUNIQ = 0
              GOTO      BBLR1900                 * delete claim
            ENDIF
            ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM12P2
            IF        IBCNUGST=2
              ADD       PRINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PRINDATE
          IF        !@EQUAL
            UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;WBBSUNIQ,"&nbsp;</td>":
                             "<td>",WBBSINVN,"&nbsp;</td>":
                             "<td>",WBBSURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",WBBSHOSP,WBBSUNIQ,WBBSINVN:
                                  WBBSURNO,PRINDATE,KEY15,WBBSMODL,SP1,ZERO,SP1:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=peclm",KEY3:
                             " value='",WBBSINVN,WBBSMODL:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      BBLR1999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in webbbsaf
.
BBLR1900  PACK      SAVKEY30,WBBSHOSP,WBBSFLAG,WBBSMODL,WBBSUNIQ,WBBSINVN:
                             WBBSBATN
          MOVE      SAVKEY30,KEY30
          CALL      DEWBBBS1                 * delete cancelled/zero invoices
          MOVE      SAVKEY30,KEY30
          CALL      RSWBBBS1
.
BBLR1999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse (TABLE ROW)
.------------------------------------------------------------
BBLR3000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,WBBSINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      SP8,PINVDTE
          ELSE
            MATCH     ZEROVISN,PINVADM
            IF        @EQUAL
              GOTO      BBLR3900                 * delete claim
            ENDIF
            IF        PINVTYP =2
              GOTO      BBLR3900                 * delete claim
            ENDIF
            ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR),FORM12P2
            IF        IBCNUGST=2
              ADD       PTINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PINVDTE
          IF        !@EQUAL
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;WBBSUNIQ,"&nbsp;</td>":
                             "<td>",WBBSINVN,"&nbsp;</td>":
                             "<td>",WBBSURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",WBBSHOSP,WBBSUNIQ,WBBSINVN:
                                   WBBSURNO,PINVDTE,KEY15,WBBSMODL,SP1,ZERO,SP1:
                                   WBBSOKEY:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=peclm",KEY3:
                             " value='",WBBSINVN,WBBSMODL:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      BBLR3999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in webbbsaf
.
BBLR3900  PACK      SAVKEY30,WBBSHOSP,WBBSFLAG,WBBSMODL,WBBSUNIQ,WBBSINVN:
                             WBBSBATN
          MOVE      SAVKEY30,KEY30
          CALL      DEWBBBS1                 * delete cancelled/zero invoices
          MOVE      SAVKEY30,KEY30
          CALL      RSWBBBS1
.
BBLR3999  RETURN
+
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.------------------------------------------------------------
. Eclipse DVAW Claims Extract
.------------------------------------------------------------
DVWEXT00  MATCH     "1",PTCNWSIN
          GOTO      DVWEXT91 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      DVWEXT91 IF NOT EQUAL
.
          COMPARE   ONE,DVAWINDC
          GOTO      DVWEXT91 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      DVWEXT80 IF EQUAL
.
          MATCH     "L",UPDTTYPE
          GOTO      DVWEXT10 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Extract Claims
          GOTO      DVWEXT30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Claims
          GOTO      DVWEXT40 IF EQUAL
.
          GOTO      DVWEXT85
.
DVWEXT10  CALL      DERW0000                     * reset any error records
          GOTO      DVWEXT80
.
DVWEXT30  COMPARE   ZERO,LASTDCLM
          GOTO      DVWEXT35 IF EQUAL            * any claims to delete first ?
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,PECLMARR[COUNT]
            IF        !@EQUAL
              CALL      DDEW0000                 * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      DVWEXT35 IF EQUAL
.
          CALL      ERRLST00                     * display any delete errors
.>>>>     MOVE      ONE,EXIT
.>>>>     GOTO      DVWEXT99
.
DVWEXT35
.         MATCH     "1",PTCNUEBB                 * using edi module?
.         GOTO      DVWEXT91 IF NOT EQUAL
.
.         MATCH     SP70,PTCNEDBO                * eclipse outbound path set?
.         GOTO      DVWEXT92 IF EQUAL
.
          COMPARE   ZERO,LASTECLM
          GOTO      DVWEXT86 IF EQUAL            * no claims to extract
.
          CALL      DVAWX000                     * Extract Eclipse Claims
.
          MOVE      ZERO,EXIT
          GOTO      DVWEXT99
.
.   ************ DELETE CLAIM FUNCTION ************
.>>>>
DVWEXT40  COMPARE   ZERO,LASTDCLM
          GOTO      DVWEXT86 IF EQUAL            * no claims to delete
.
          MOVE      ZERO,ERRORCNT
          MOVE      ONE,COUNT
          WHILE     COUNT <= LASTDCLM
            MATCH     SP70,PECLMARR[COUNT]
            IF        !@EQUAL
              CALL      DDEW0000   * Delete Eclipse Claim Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ZERO,EXIT
.
          COMPARE   ZERO,ERRORCNT
          GOTO      DVWEXT99 IF EQUAL
.
          CALL      ERRLST00
          MOVE      ONE,EXIT
          GOTO      DVWEXT99
.
DVWEXT80  CLEAR     WEBTITLE
          MOVE      "WebServices DVAW Claims Extract",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,DVWEXT99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      DVWEXT99
.
DVWEXT85  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DVWEXT99
.
DVWEXT86  MOVE      "No claims selected to extract.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DVWEXT99
.
DVWEXT91  MOVE      "Hospital not using the DVW Module.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DVWEXT99
.
DVWEXT92  MOVE      "Eclipse DVW Outbound Path blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DVWEXT99
.
DVWEXT99  RETURN
+
.*****************************************************************************
.*                              DERW0000                                     *
.*             Reset error records back to zero status (Not Sent)            *
.*             just in case there were any problems with a previous          *
.*             batch and the error records were not set back to zero.        *
.*****************************************************************************
.
DERW0000  MOVE      HOSPCODE,SAVEHOSP            * initialise hospital
          MOVE      ZERO,FIRSTFLG                * initialise flag
.
          PACK      KEY30,HOSPCODE,SP1,ONE,SP70
DERW0500  CALL      RSWBDVW1                     * position in file
          CALL      RKWBDVW1                     * read next record
          BRANCH    OVRCD,DERW9999               * eof - finished
.
          IF        FIRSTFLG = 0
            MATCH     SP3,HOSPCODE               * all hospitals extract ?
            IF        @EQUAL
              MOVE      WBDWHOSP,SAVEHOSP        * yes-load first hospital code
            ENDIF
            MOVE      ONE,FIRSTFLG               * set first flag to no
          ENDIF
.
          MATCH     SP3,HOSPCODE                 * all hospitals extract ?
          GOTO      DERW5000 IF NOT EQUAL        * no
.
.         We are running an extract for all hospitals
.
          MATCH     SAVEHOSP,WBDWHOSP            * same hospital still ?
          IF        !@EQUAL
            MOVE      WBDWHOSP,SAVEHOSP          * no - save new hospital code
            PACK      KEY30,WBDWHOSP,SP1,ONE,SP70
            GOTO      DERW0500
          ENDIF
.
          COMPARE   ONE,WBDWFLAG                 * error record still ?
          GOTO      DERW4000 IF NOT EQUAL        * no - get next hospital
.
          GOTO      DERW8000
.
DERW4000  PACK      KEY30,WBDWHOSP,Z70
          GOTO      DERW0500
.
.         We are running an extract for a given hospital id
.
DERW5000  MATCH     HOSPCODE,WBDWHOSP            * same hospital still ?
          GOTO      DERW9999 IF NOT EQUAL        * no - finished
.
          COMPARE   ONE,WBDWFLAG                 * error record still ?
          GOTO      DERW9999 IF NOT EQUAL        * no - finished
.
.         Reset the record status to "Waiting"
.
DERW8000  PACK      SAVKEY30,WBDWHOSP,WBDWFLAG,WBDWMODL,WBDWUNIQ,WBDWINVN:
                             WBDWBATN
          MOVE      ZERO,WBDWFLAG                * yes - reset flag to "0"

          CALL      IBACLOCK
          PACK      WBDWUDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBDWUDAT
          MOVE      CTIMEIS,WBDWUTIM
          MOVE      USERID,WBDWUUID
          CALL      UPWBDVW1                     * update record
          MOVE      SAVKEY30,KEY30               * load key to reposition
          GOTO      DERW0500                     * get next record
.
DERW9999  RETURN
+
.*****************************************************************************
.*                               DDEW0000                                    *
.*               Delete selected Eclipse DVAW Claim records                  *
.*****************************************************************************
DDEW0000  UNPACK    PECLMARR[COUNT],KEY8,KEY1    * invoice number / module
          PACK      KEY17,KEY8,SP8,KEY1,SP70       * batch number is blank
          CALL      RDWBDVW2
          BRANCH    OVRCD,DDEW8000
.
          MOVE      WBDWINVN,TEMPINVN
          MOVE      WBDWBATN,TEMPBATN
          MOVE      WBDWUNIQ,TEMPADMN
          MOVE      WBDWURNO,TEMPURNO
          MOVE      WBDWPBAT,TEMPPBAT
          MOVE      WBDWHOSP,TEMPHOSP
          MOVE      WBDWMODL,TEMPMODL
.
          MATCH     SP70,TEMPPBAT
          GOTO      DDEW1000 IF EQUAL
          GOTO      DDEW1000 IF EOS
.
          PACK      KEY30,TEMPHOSP,FIVE,TEMPMODL,TEMPADMN,TEMPINVN,TEMPPBAT,SP70
          CALL      RDWBDVW1
          IF        OVRCD = 1
            GOTO      DDEW7000
          ELSE
            MOVE      SP70,WBDWNBAT

            CALL      IBACLOCK
            PACK      WBDWUDAT,CCC,CYY,CMM,CDD
            REP       " 0",WBDWUDAT
            MOVE      CTIMEIS,WBDWUTIM
            MOVE      USERID,WBDWUUID
            CALL      UPWBDVW1
          ENDIF
.
.         Delete the selected record
.
DDEW1000  PACK      KEY30,TEMPHOSP,SP1,ZERO,TEMPMODL,TEMPADMN,TEMPINVN,TEMPBATN,SP70
          CALL      DEWBDVW1
.
          GOTO      DDEW9999
.
DDEW7000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      DDEW9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Error updating previous claim - ",ERRORLST[ERRORCNT]
          APPEND    WBDWINVN,ERRORLST[ERRORCNT]
          APPEND    "  Batch - ",ERRORLST[ERRORCNT]
          APPEND    WBDWBATN,ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      DDEW9999
.
DDEW8000  ADD       ONE,ERRORCNT
          IF        ERRORCNT > 50
            GOTO      DDEW9999
          ENDIF
          CLEAR     ERRORLST[ERRORCNT]
          APPEND    "Record cannot be deleted.  ",ERRORLST[ERRORCNT]
          RESET     ERRORLST[ERRORCNT]
          GOTO      DDEW9999

DDEW9999  RETURN
+
.--------------------------------------------------------------------------
.*                             DVAWX000                                   *
.*               Schedule Eclipse Extract (IBAWEB08)                      *
.--------------------------------------------------------------------------
DVAWX000  MOVE      "IBAWEB08",SCHDPGID
          MOVE      "Eclipse DVAW Claims Extract",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S  ",SCHDPRNT           * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      "IBAWEB08",SETDFPRG
          MOVE      "11",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters
.
          MOVE      ONE,COUNT
          MOVE      HOSPCODE,KEYSTARR[COUNT]    * hospital id
          ADD       ONE,COUNT
          MOVE      ONE,KEYSTARR[COUNT]    * extract dvw (1)
.
.         COMPARE   TWO,OPTNFLAG
.         GOTO      DVAWX500 IF EQUAL
.
.         ADD       ONE,COUNT
.         MOVE      HFUNDTYP,KEYSTARR[COUNT]    * health fund
.
.         MOVE      THREE,TOTALCNT              * first 3 keyins
.         GOTO      DVAWX600
.
DVAWX500  MOVE      TWO,TOTALCNT
.
DVAWX600  ADD      ONE,COUNT
          MOVE     ONE,COUNTEC
          WHILE     COUNTEC <= LASTECLM
            MATCH     SP90,ECCLMARR[COUNTEC]
            IF        !@EQUAL
              MOVE      ECCLMARR[COUNTEC],KEYSTARR[COUNT]    * to be extracted
            ENDIF
            ADD      ONE,COUNT
            ADD      ONE,COUNTEC
          DO
.
          ADD       LASTECLM,TOTALCNT            * eclipse claims keyins
.
          PACK      KEYSTARR[COUNT],SP70         * blank record to signal exit
          ADD       ONE,COUNT
          ADD       ONE,TOTALCNT
.
          MOVE      ANSP,KEYSTARR[COUNT]         * (P)ost
.>>>>
.>>>>     ADD       ONE,COUNT
.>>>>     MOVE      ANSY,KEYSTARR[COUNT]         * (Y) to extract (if ok)
.>>>>
          ADD       ONE,COUNT
          MOVE      SP70,KEYSTARR[COUNT]         * (Enter) to exit
          ADD       ONE,COUNT
          MOVE      "\",KEYSTARR[COUNT]          * (\) to exit
.
          ADD       THREE,TOTALCNT               * add last 3 keyins (if error)
.>>>>     ADD       FOUR,TOTALCNT                * add last 4 keyins (if ok)
          MOVE      TOTALCNT,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
DVAWX999  RETURN
+
.--------------------------------------------------------------------------
. Option 23 - Eclipse DVAW Claims Extract tags
.--------------------------------------------------------------------------
VEXT0000  BRANCH    FLDITMNO,VEXT0100,VEXT0200,VEXT0300,VEXT0400,VEXT0500:
                             VEXT0600,VEXT0700,VEXT0800
          GOTO      VEXT9999
.
VEXT0100  MOVE      ONE,ALLHFLAG          * default to 'All'
          CALL      HOSPID00              * display Multi-hosp. selection list
          GOTO      VEXT9999
.
VEXT0200  CALL      ECSHN000              * selected Hospital Desc (Multi-hosp)
          GOTO      VEXT9999
.
VEXT0300
.         MOVE      "CL",CATEGORY         * Compensation code/Claim Type
.         MOVE      HFUNDTYP,CODE
.         CALL      CODITM00
          GOTO      VEXT9999
.
VEXT0400  CALL      DVWFX000              * Claims Waiting for Extraction
          GOTO      VEXT9999
.
VEXT0500  MATCH     SP70,UPDTTYPE
          GOTO      VEXT9999 IF EQUAL
          WRITE     HTMLFILE;UPDTTYPE;    * Update Type CGI
          GOTO      VEXT9999
.
VEXT0600
.         WRITE     HTMLFILE;CLAMTYPE;    * Claim type CGI
          GOTO      VEXT9999
.
VEXT0700
.         MATCH     SP70,HFUNDTYP
.         GOTO      VEXT9999 IF EQUAL
.         WRITE     HTMLFILE;HFUNDTYP;    * Health Fund CGI
          GOTO      VEXT9999
.
VEXT0800
.         WRITE     HTMLFILE;HFUNDESC;    * Health Fund Desc CGI
          GOTO      VEXT9999
.
VEXT9999  RETURN
+
.------------------------------------------------------------
. Table of all Eclipse DVAW Claims Waiting For Extraction
.------------------------------------------------------------
DVWFX000  MATCH     "1",PTCNWSIN
          GOTO      DVWFX999 IF NOT EQUAL
.
          MATCH     "1",PTCNDVAW
          GOTO      DVWFX999 IF NOT EQUAL
.
          COMPARE   ONE,DVAWINDC
          GOTO      DVWFX999 IF NOT EQUAL
.
          MOVE      ZERO,FORM3
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY30,HOSPCODE,SP1,ZERO,SP70
DVWFX040  CALL      RSWBDVW1
DVWFX050  CALL      RKWBDVW1                * read next record
          BRANCH    OVRCD,DVWFX900          * end of file
.
          MATCH     SP3,HOSPCODE                 * all hospitals ?
          IF        !@EQUAL
            MATCH     HOSPCODE,WBDWHOSP          * no - same hospital still ?
            GOTO      DVWFX900 IF NOT EQUAL      * no - finished
          ENDIF
.
          COMPARE   ZERO,WBDWFLAG                * waiting for extract still ?
          IF        !@EQUAL
            PACK      KEY30,WBDWHOSP,Z70
            GOTO      DVWFX040                   * get next record
          ENDIF
.
.         A waiting record has been found,
.         so get the invoice details and calculate the amount outstanding.
.
DVWFX200  MATCH     "1",WBDWMODL
          IF        @EQUAL
.           CALL      DVLR2000                   * DVAW Emergency not implemented
          ELSE
            MATCH     "2",WBDWMODL
            IF        @EQUAL
              CALL      DVLR1000                 * DVAW Private Practice
            ELSE
              CALL      DVLR3000                 * DVAW Outpatient
            ENDIF
          ENDIF
.
          IF        DISNUMB>=50
            GOTO      DVWFX800
          ENDIF
          GOTO      DVWFX050
.
DVWFX800  CALL      LIMREC00        * Show batch limit reached message
          GOTO      DVWFX999
.
DVWFX900  CALL      TOTREC00        * Show no more records message
.
DVWFX999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse DVAW (TABLE ROW)
.------------------------------------------------------------
DVLR1000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,WBDWINVN,SP70
          CALL      RDPRIN1
          IF        OVRCD=1
            MOVE      SP8,PRINDATE
          ELSE
            IF        PRINUNIQ = 0
              GOTO      DVLR1900                 * delete claim
            ENDIF
            ASSIGN    (PRINITOT+PRINPAMT+PRINHAMT+PRINIAMT+PRINMAMT+PRINVAMT+PRINOTHA+PRINJAMT+PRINCNTT),FORM12P2
            IF        IBCNUGST=2
              ADD       PRINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PRINDATE
          IF        !@EQUAL
            UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;WBDWUNIQ,"&nbsp;</td>":
                             "<td>",WBDWINVN,"&nbsp;</td>":
                             "<td>",WBDWURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",WBDWHOSP,WBDWUNIQ,WBDWINVN:
                                  WBDWURNO,PRINDATE,KEY15,WBDWMODL,SP1,ZERO,SP1:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=peclm",KEY3:
                             " value='",WBDWINVN,WBDWMODL:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      DVLR1999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in webbbsaf
.
DVLR1900  PACK      SAVKEY30,WBDWHOSP,WBDWFLAG,WBDWMODL,WBDWUNIQ,WBDWINVN:
                             WBDWBATN
          MOVE      SAVKEY30,KEY30
          CALL      DEWBDVW1                 * delete cancelled/zero invoices
          MOVE      SAVKEY30,KEY30
          CALL      RSWBDVW1
.
DVLR1999  RETURN
+
.------------------------------------------------------------
. All Invoices to be extracted for Eclipse (TABLE ROW)
.------------------------------------------------------------
DVLR3000  PACK      KEY11,SP70
          PACK      KEY15,SP70
.
          PACK      KEY8,WBDWINVN,SP70
          CALL      RDINV1
          IF        OVRCD=1
            MOVE      SP8,PINVDTE
          ELSE
            MATCH     ZEROVISN,PINVADM
            IF        @EQUAL
              GOTO      DVLR3900                 * delete claim
            ENDIF
            IF        PINVTYP =2
              GOTO      DVLR3900                 * delete claim
            ENDIF
            ASSIGN    (PINVAMT+PINVPATA+PINVHFDA+PINVOTHA+PINVJOUR),FORM12P2
            IF        IBCNUGST=2
              ADD       PTINGSTJ,FORM12P2
            ENDIF
            MOVE      FORM12P2,KEY15             * invoice amount display
          ENDIF
.
          MATCH     SP70,PINVDTE
          IF        !@EQUAL
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          IF        (DISNUMB%2) = 0
            WRITE     HTMLFILE;"<tr class=TableRowOdd><td nowrap>"
          ELSE
            WRITE     HTMLFILE;"<tr class=TableRowEven><td nowrap>"
          ENDIF
.
          ADD       ONE,FORM3
          MOVE      FORM3,KEY3
          REP       " 0",KEY3
.
          WRITE     HTMLFILE;WBDWUNIQ,"&nbsp;</td>":
                             "<td>",WBDWINVN,"&nbsp;</td>":
                             "<td>",WBDWURNO,"&nbsp;</td>":
                             "<td>",KEY11,"&nbsp;</td>":
                             "<td>",KEY15,"&nbsp;</td>":
                             "<td><input type=checkbox name=ecclm",KEY3:
                             " value='",WBDWHOSP,WBDWUNIQ,WBDWINVN:
                                   WBDWURNO,PINVDTE,KEY15,WBDWMODL,SP1,ZERO,SP1:
                                   WBDWOKEY:
                             "' checked onclick=UpdateExCol(this);></td>":
                             "<td><input type=checkbox name=peclm",KEY3:
                             " value='",WBDWINVN,WBDWMODL:
                             "' onclick=UpdateDeCol(this);></td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      DVLR3999
.
.         The current record is not going to be extracted, so delete it
.         and reposition in webbbsaf
.
DVLR3900  PACK      SAVKEY30,WBDWHOSP,WBDWFLAG,WBDWMODL,WBDWUNIQ,WBDWINVN:
                             WBDWBATN
          MOVE      SAVKEY30,KEY30
          CALL      DEWBDVW1                 * delete cancelled/zero invoices
          MOVE      SAVKEY30,KEY30
          CALL      RSWBDVW1
.
DVLR3999  RETURN
+
.------------------------------------------------------------
          INC       IBAWEBCD
          INC       WEBDATCD
          INC       RSHWEBCD
.
          INC       EMRECTIO/INC
          INC       EMRECAIO/INC
          INC       HICEMSIO/INC
.
          INC       PATDO1IO/INC   * Doctor File
          INC       PATFX1IO/INC   * Health Fund Extension
          INC       PATHSPIO/INC
          INC       PATMI1IO/INC
          INC       PATMA1IO/INC
          INC       PATVISIO/INC   * Patients Visits File
          INC       PMSVX1IO/INC   * Visit Extension File
          INC       PATALRIO/INC
          INC       OUTECTIO/INC
          INC       OUTEAHIO/INC
          INC       OUTEADIO/INC
          INC       OUTECAIO/INC
          INC       OUTSITIO/INC
          INC       OUTBOAIO/INC
          INC       OUTBB1IO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PATPR1IO/INC
          INC       PMSPX2IO/INC
          INC       PATFN1IO/INC
          INC       PATWR1IO/INC
          INC       MRTMASIO/INC
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       PATRE1IO/INC
          INC       PATDGWIO/INC
          INC       PATITMIO/INC
          INC       PATDADIO/INC
          INC       PATVADIO/INC
          INC       PATCMCIO/INC
          INC       PATASFIO/INC
          INC       PMSEAHIO/INC
          INC       PMSESHIO/INC
          INC       PMSESDIO/INC
          INC       PMSEADIO/INC
          INC       PATHGPIO/INC
          INC       PMSCCDIO/INC            * Concession Card Details
          INC       PMSHCGIO/INC
          INC       PMSHCPIO/INC
          INC       APSMASIO/INC
          INC       PATIN1IO/INC
          INC       PATDSCIO/INC
.
          INC       PATEBHIO/INC
          INC       PATINVIO/INC
          INC       PRIINVIO/INC
          INC       PATEDSIO/INC
          INC       PATEDTIO/INC
.
          INC       PATCERIO/INC
          INC       PATCLCIO/INC
          INC       PMSECTIO/INC            * Eclipse Claims Table
          INC       PRIALSIO/INC
          INC       PRIPRAIO/INC
          INC       PRISECIO/INC
          INC       PRIECTIO/INC
          INC       PRIECAIO/INC
          INC       PRIEAHIO/INC
          INC       PRIEADIO/INC
          INC       PRIESHIO/INC
          INC       PRIESDIO/INC
          INC       PMSETRIO/INC            * Eclipse Transactions Request Table
          INC       PMSPRGIO/INC
          INC       PATFACIO/INC
          INC       PATPARIO/INC            * Eclipse Participants
          INC       PATPCPIO/INC            * Eclipse Participant Capabilities
          INC       RCPREGIO/INC
          INC       VISPAYIO/INC            * Visit based Payer Details
          INC       WEBBBSIO/INC
          INC       WEBBBAIO/INC
          INC       WEBBBBIO/INC
          INC       WEBDVWIO/INC
          INC       WEBDVAIO/INC
          INC       WEBDVBIO/INC
          INC       WEBIMCIO/INC
          INC       WEBIMAIO/INC
          INC       WEBIMBIO/INC
          INC       WEBIMDIO/INC
          INC       WEBIMEIO/INC
          INC       WEBIMFIO/INC
          INC       WEBIMGIO/INC
          INC       WEBIMHIO/INC
          INC       WEBIHAIO/INC
          INC       WEBIHBIO/INC
          INC       WEBIHCIO/INC
          INC       WEBIHDIO/INC
          INC       WEBIHEIO/INC
          INC       WEBIHFIO/INC
          INC       WEBIHGIO/INC
          INC       WEBIHHIO/INC
          INC       WEBPCIIO/INC
          INC       WEBPCAIO/INC
          INC       WEBPARIO/INC 
          INC       WEBPCPIO/INC 
          INC       WEBETRIO/INC
          INC       WEBERHIO/INC
.
          INC       CLNHIMAS                * Clear nhimasaf file variables
          INC       CLPMSPX2
          INC       HSCLMSRV                * check claim statuses
          INC       PATMASTM
          INC       PATDOCTM
          INC       PMSHCGTM
          INC       PMSHCPTM
          INC       PATDSCTM
          INC       PMSPX2TM
          INC       PATMSXTM
          INC       PATCERTM
          INC       PATDOCCD
          INC       CALCAGE
          INC       NAMSTRCD
          INC       DAYOFWEK
          INC       TFILENAM

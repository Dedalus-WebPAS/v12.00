.
.          12.01.94 Robert Sumsion
.          When reading the stocktake file (stkxxxxx) the positional read would
.          read the record exactly if the rack & shelf is blank. Therefore
.          the read next wou;ld not get the correct record.
.          Therefore recompiled for changes to SINWRKCD.
.          srf 126957 & 126621 & 126506
.---- check if stocktake in progress for catalog/warehouse ----
.---- requires : KEY12  (catalog/warehouse)                ----
.---- returns  : OVRCD  (1=stocktake not in progress)      ----
.
SISIWK1
          MOVE      ZERO,SIIESTI
          CALL      RDSIIE1
          IF        SIIESTI=1
            PACK      SIWAWAR,SIIEWAR,SP70
            CALL      OPSIWK1
            IF        OVRCD=0
              UNPACK    SP70,SIWKWAR,SIWKCAT
              MOVE      "zzzzzzzzzz",KEY10
              PACK      KEY20,SIIEWAR,SIIECAT,KEY10
              CALL      RSSIWK2
              CALL      RPSIWK2
              PACK      KEY12,SIWKWAR,SIWKCAT,SP70
              MATCH     KEY12,KEY20
              IF        !@EQUAL
                MOVE      ONE,OVRCD
              ENDIF
              CLOSE     SINWRKA1
              CLOSE     SINWRKA2
            ENDIF
          ELSE
            MOVE      ONE,OVRCD
          ENDIF
          RETURN
.
.---- open file (OVRCD=1 if cant open) ----
.
OPSIWK1
          PACK      SIWKFNM,SIWKPRE,SIWAWAR,SP70
          REP       " x",SIWKFNM
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SINWRKA1,SIWKFNM
          TRAPCLR   IO
          IF        OVRCD=0
            OPEN      SINWRKA2,SIWKFNM
          ENDIF
          RETURN
.
.---- delete file (OVRCD=1 if deleted ok) ----
.
ISSIWK1
          PACK      SIWKFNM,SIWKPRE,SIWAWAR,SP70
          REP       " x",SIWKFNM
          PACK      SIWKCMD,SIWKISE,SIWKFNM
          EXECUTE   SIWKCMD,TASKID
          CALL      OPSIWK1
          RETURN
.
.---- create file (OVRCD=1 if cant create) ----
.
CRSIWK1
          CALL      ISSIWK1
          PACK      SIWKCMD,SIWKISB,SIWKFNM,SIWKKEY
          EXECUTE   SIWKCMD,TASKID
          CALL      OPSIWK1
          RETURN
.

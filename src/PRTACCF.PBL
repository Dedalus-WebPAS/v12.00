.******************************************************************************
.*                                                                            *
.*  PRTACCF - ACC Form (User Defined Stationery)                              *
.*                                                                            *
.* &&&&& Make sure the file ibavaraf is updated with the new variables &&&&&  *
.*                                                                            *
.* Modifications  :                                                           *
.*----------------------------------------------------------------------------*
.* V11.02.02 13/04/2022  Thanh T          TSK 0903453                         *
.*           Added PRACC888 to PRACC893 for identifying gender/pronoun and    *
.*           free text fields                                                 * 
.* V11.02.01 21/01/2021  Jacob Jackson  TSK 0864505                           *
.*           Add preferred name field options -                               *
.*           PRACC883, PRACC884, PRACC885, PRACC886, PRACC887                 *
.* V11.01.01 17/06/2021  Thanh T        TSK 0901286                           *
.*           Changed PRACC877-PRACC881 to use address and postcode from       *
.*           pmscexaf instead of patmx1af when the new contacts parameter is  *
.*           turned on                                                        *
.*----------------------------------------------------------------------------*
.*        V11.00.01 06/04/2020  Thanh T        TSK 0879163                    *
.*                  Changed PRACC456 for Sex category.                        *
.*                  Added PRACC882 for sex long description                   *
.*----------------------------------------------------------------------------* 
.*        V10.14.01 19/02/2019  Ebon Clements  TSK 0867703                    *
.*                  Changed NHI ethnicity file reads to use KEY5              *
.*        V10.12.01 23/04/2018  Richa Phogat   TSK 0853196                    *
.*                  Added Postal Address fields                               *
.*        V10.11.02 30/10/2017  J.Tan          TSK 0846739                    *
.*                  Added NHI fields                                          *
.*        V10.11.01 21/09/2017  Richa Phogat   CAR 0845103                    *
.*                  Added code to display more fields for 'Stationary form    *
.*                  Type 8 ACC Form'                                          *
.*        V9.08.00  24/08/2007  Jill Habasque  CAR 142467                     *
.*                  Created include                                           *
.******************************************************************************
.
.******************************************************************************
.*        Lineup Print                                                        *
.******************************************************************************
.
LINUPACC  CALL      OPNPRINT                 * open spool file
          MOVE      ONE,CURRROW              * Initialise current row counter
.
LNACC000  COMPARE   CURRROW,IBDTROW          * Current row up to required row ?
          GOTO      LNACC200 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else print 1 extra line
          ADD       ONE,CURRROW              * Increment counter
          GOTO      LNACC000                 * Check counter again
.
. ------- Read through the details file -------
.
LNACC100  CALL      RKIBDET1                 * Read next detail record
          BRANCH    OVRCD,LNACC900           * No more records - pad out form
.
          MATCH     CPIDCOD,IBDTSCOD         * Same form ?
          GOTO      LNACC900 IF NOT EQUAL    * No - pad out rest of form
.
LNACC110  COMPARE   CURRROW,IBDTROW          * Are we at required row ?
          GOTO      LNACC200 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else pad out form to req row
          ADD       ONE,CURRROW              * One more row printed
          GOTO      LNACC110                 * Check row count
.
. ------- Print actual data lines -------
.
LNACC200  BRANCH    IBDTINDC,LNACC300:       * Text field
                             LNACC400        * Data field
.
. ------- Print text field -------
.
LNACC300  PRINT     *IBDTCOL,IBDTTXFL;       * Print data
          MOVE      IBDTROW,CURRROW          * Row printed is current row
          GOTO      LNACC100                 * Read next record
.
. ------- Print data field -------
.
LNACC400  MOVE      IBDTTXFL,DIM5            * Data number 1st 3 chars of field
          MOVE      DIM5,FORM5               * Move to a FORM field for BRANCH
.
          BRANCH    FORM5,LNACC500,LNACC450,LNACC450,LNACC450,LNACC460:
                          LNACC450,LNACC470,LNACC450,LNACC450,LNACC450:    10
                          LNACC450,LNACC450,LNACC450,LNACC480,LNACC430:
                          LNACC470,LNACC450,LNACC450,LNACC450,LNACC450:    20
                          LNACC450,LNACC450,LNACC450,LNACC480,LNACC450:
                          LNACC450,LNACC450,LNACC450,LNACC450,LNACC490:    30
                          LNACC490,LNACC450,LNACC450,LNACC520,LNACC450:
                          LNACC450,LNACC450,LNACC520,LNACC450,LNACC450:    40
                          LNACC450,LNACC450,LNACC450,LNACC450,LNACC470:
                          LNACC460,LNACC450,LNACC450,LNACC450,LNACC450:    50
                          LNACC450,LNACC540,LNACC450,LNACC450,LNACC450:
                          LNACC450,LNACC450,LNACC450,LNACC450,LNACC450:    60
                          LNACC450,LNACC450,LNACC450,LNACC450,LNACC450:
                          LNACC450,LNACC450,LNACC450,LNACC450,LNACC450:    70
                          LNACC450,LNACC450,LNACC450,LNACC450,LNACC450:
                          LNACC530,LNACC450,LNACC450,LNACC450
      
.
LNACC430  MOVE      "999",VARIABLE           * Age
          GOTO      LNACC600
.
LNACC450  PACK      VARIABLE,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10,X10
          GOTO      LNACC600
.
LNACC460  MOVE      "99:99:99",VARIABLE      * Time variables
          GOTO      LNACC600
.
LNACC470  MOVE      "99/99/99",VARIABLE      * Date variables
          GOTO      LNACC600
.
LNACC475  MOVE      "99/99/9999",VARIABLE    * Date with century variables
          GOTO      LNACC600
.
LNACC480  MOVE      "9",VARIABLE             * Indicators
          GOTO      LNACC600
.
LNACC490  PACK      VARIABLE,ANSX,DOT,X10,X10      * Doctor's name
          GOTO      LNACC600
.
LNACC500  MOVE      "99999999",VARIABLE      * Admission number
          GOTO      LNACC600
.
LNACC520  CLEAR     VARIABLE                 * Address
          APPEND    X10,VARIABLE
          APPEND    X10,VARIABLE
          APPEND    X5,VARIABLE
          APPEND    COMMA,VARIABLE
          APPEND    X10,VARIABLE
          APPEND    X10,VARIABLE
          APPEND    X5,VARIABLE
          APPEND    COMMA,VARIABLE
          APPEND    " 9999",VARIABLE
          RESET     VARIABLE
          GOTO      LNACC600
.
LNACC530  MOVE      "99",VARIABLE            * Year
          GOTO      LNACC600
.
LNACC540  MOVE      "999999.99",VARIABLE     * Daily rate
          GOTO      LNACC600
.
. ------- Actual data print routine -------
.
LNACC600  RESET     VARIABLE,IBDTPLEN        * Reset pointer to required length
          LENSET    VARIABLE                 * Push logical length there
          RESET     VARIABLE                 * Reset form pointer to start
          PRINT     *IBDTCOL,*+,VARIABLE;    * Only print data between FP & LL
          MOVE      IBDTROW,CURRROW          * Move row number to one printed
          GOTO      LNACC100                 * Read next record
.
. ------- Finished all data for this form - pad out rest of form -------
.
LNACC900  COMPARE   CURRROW,IBTHLENG         * End of form ?
          GOTO      LNACC999 IF EQUAL        * Yes - exit
          PRINT     *N;                      * Otherwise pad out 1 more line
          ADD       ONE,CURRROW              * 1 more line printed
          GOTO      LNACC900                 * Test again
.
LNACC999  MOVE      FALSE,EXIT               * Set exit flag
          PACK      SAVFIL8,SPLFILE,SP70
          CALL      CLSPRINT                 * close the spool file
          RETURN                             * Finished
.
.*******************************************************************************
.*        Actual Print Routine for ACC Form                                    * .*******************************************************************************
.
PRTACCF   CALL      OPNPRINT                 * open spool file
          MOVE      ONE,CURRROW              * Initialise current row counter
.
PRACC000  COMPARE   CURRROW,IBDTROW          * Current row up to required row ?
          GOTO      PRACC200 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else print 1 extra line
          ADD       ONE,CURRROW              * Increment counter
          GOTO      PRACC000                 * Check counter again
.
. ------- Read through the details file -------
.
PRACC100  CALL      RKIBDET1                 * Read next detail record
          BRANCH    OVRCD,PRAC8000           * No more records - pad out form
.
          MATCH     CPIDCOD,IBDTSCOD         * Same form ?
          GOTO      PRAC8000 IF NOT EQUAL    * No - pad out rest of form
.
PRACC110  COMPARE   CURRROW,IBDTROW          * Are we at the required row ?
          GOTO      PRACC200 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else pad out to required row
          ADD       ONE,CURRROW              * One more row printed
          GOTO      PRACC110                 * Check row count
.
. ------- Print actual data lines -------
.
PRACC200  BRANCH    IBDTINDC,PRACC300:       * Text field
                             PRACC400        * Data field
.
. ------- Print text field -------
.
PRACC300  RESET     IBDTTXFL,IBDTPLEN
          LENSET    IBDTTXFL
          RESET     IBDTTXFL
          PRINT     *IBDTCOL,*+,IBDTTXFL;    * Print data
          MOVE      IBDTROW,CURRROW          * Row printed is current row
          GOTO      PRACC100                 * Read next record
.
. ------- Print data field -------
.
PRACC400  MOVE      IBDTTXFL,DIM5            * Data number 1st 3 chars of field
          MOVE      DIM5,FORM5               * Move to a FORM field for BRANCH
.
          PACK      VARIABLE,SP30,SP30,SP30,SP30,SP10  * Initialise variable
          BRANCH    FORM5,PRACC404,PRACC408,PRACC412,PRACC416,PRACC420:
                          PRACC424,PRACC428,PRACC432,PRACC436,PRACC440:    10
                          PRACC444,PRACC448,PRACC452,PRACC456,PRACC460:
                          PRACC464,PRACC468,PRACC472,PRACC476,PRACC480:    20
                          PRACC484,PRACC488,PRACC492,PRACC496,PRACC500:
                          PRACC504,PRACC508,PRACC512,PRACC516,PRACC520:    30
                          PRACC524,PRACC528,PRACC532,PRACC536,PRACC540:
                          PRACC544,PRACC548,PRACC552,PRACC556,PRACC560:    40
                          PRACC564,PRACC568,PRACC572,PRACC576,PRACC580:
                          PRACC584,PRACC588,PRACC592,PRACC596,PRACC600:    50
                          PRACC604,PRACC608,PRACC612,PRACC616,PRACC620:
                          PRACC624,PRACC628,PRACC632,PRACC636,PRACC640:    60
                          PRACC644,PRACC648,PRACC652,PRACC656,PRACC660:
                          PRACC664,PRACC668,PRACC672,PRACC676,PRACC680:    70
                          PRACC684,PRACC688,PRACC692,PRACC696,PRACC700:
                          PRACC704,PRACC708,PRACC712,PRACC716,PRACC720:    80
                          PRACC724,PRACC728,PRACC732,PRACC736,PRACC740:
                          PRACC744,PRACC748,PRACC752,PRACC756,PRACC760:    90
                          PRACC764,PRACC768,PRACC772,PRACC776,PRACC780:
                          PRACC784,PRACC788,PRACC792,PRACC796,PRACC800:   100
                          PRACC804,PRACC808,PRACC812,PRACC816,PRACC820:
                          PRACC824,PRACC828,PRACC832,PRACC836,PRACC840:   110
                          PRACC844,PRACC848,PRACC852,PRACC856,PRACC860:
                          PRACC864,PRACC868,PRACC872,PRACC876,PRACC877:   120
                          PRACC878,PRACC879,PRACC880,PRACC881,PRACC882:
                          PRACC883,PRACC884,PRACC885,PRACC886,PRACC887:   130
                          PRACC888,PRACC889,PRACC890,PRACC891,PRACC892:
                          PRACC893
.
          GOTO      PRACC100

PRACC404  MOVE      DPVIBILL,VARIABLE          * Admission number
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PRAC6000
.
PRACC408  MOVE      PVIURNO,VARIABLE           * U/R number
          MOVE      EIGHT,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PRAC6000
.
PRACC412  MOVE      PSNAME,VARIABLE           * Surname
          GOTO      PRAC5000
.
PRACC416  MOVE      PGNAME,VARIABLE          * Given name
          GOTO      PRAC5000
.
PRACC420  MOVE      PTITL,VARIABLE          * title
          GOTO      PRAC5000
.
PRACC424  
          GOTO      PRAC5000
.
PRACC428  
          GOTO      PRAC5000
.
PRACC432  MOVE      PADD1,VARIABLE           * Address line 1
          GOTO      PRAC5000
.
PRACC436  MOVE      PADD2,VARIABLE           * Address line 2
          GOTO      PRAC5000
.
PRACC440  MOVE      PSUBRB,VARIABLE          * Suburb
          GOTO      PRAC5000
.
PRACC444  MOVE      PADD4,VARIABLE           * Address line 4
          GOTO      PRAC5000
.
PRACC448  MOVE      PTELEP,VARIABLE          * Private telephone
          GOTO      PRAC5000
.
PRACC452  MOVE      PPOST,VARIABLE           * Postcode
          GOTO      PRAC5000
.
PRACC456  MOVE      ZERO,ANS                 * Sex
          MOVE      PSEX,DSEXCHAR
          CALL      SEXDSP00 
          MOVE      DSEXSDES,VARIABLE        * Sex short description
          GOTO      PRAC5000
.
PRACC460  CALL      LABELAGE 
          MOVE      XAGE,VARIABLE           * Age
          MOVE      THREE,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      PRAC6000
.
PRACC464  UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY   * Birth date
          CALL      PACDATE
          MOVE      CPDATE,VARIABLE
          GOTO      PRAC5000
.
PRACC468  MOVE      "C ",CATEGORY
          MOVE      PCONT,CODE
          CALL      GETCOD00
          MOVE      TDESC,VARIABLE              * Country
          GOTO      PRAC5000
.
PRACC472  MOVE      WCENAME,VARIABLE            * Employer Name
          GOTO      PRAC5000
.
PRACC476  MOVE      WCEADD1,VARIABLE            * Employer Address Line 1
          GOTO      PRAC5000
.
PRACC480  MOVE      WCEADD2,VARIABLE            * Employer Address Line 2
          GOTO      PRAC5000
.
PRACC484  MOVE      WCEADD3,VARIABLE            * Employer Address Line 3
          GOTO      PRAC5000
.
PRACC488  MOVE      WCEADD4,VARIABLE            * Employer Address Line 4
          GOTO      PRAC5000
.
PRACC492  MOVE      WCEPOST,VARIABLE            * Employer Postcode
          GOTO      PRAC5000
.
PRACC496  MOVE      WCETELE,VARIABLE            * Employer Telephone
          GOTO      PRAC5000
.
PRACC500  MATCH     SP70,WCACDAT                * Date of Accident
          GOTO      PRAC5000 IF EQUAL
          UNPACK    WCACDAT,CCENT,CYEAR,CMON,CDAY
          PACK      VARIABLE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          GOTO      PRAC5000
.
PRACC504  IF        WCACCPT=1
            MOVE      "Yes",VARIABLE            * Accepted by Insurance Company
          ELSE
            MOVE      "No",VARIABLE             * 1=Yes 0=No
          ENDIF
          MOVE      TRUE,EXIT
          GOTO      PRAC5000
.
PRACC508  MOVE      WCICODE,VARIABLE            *Insurance Company Code
          GOTO      PRAC5000
.
PRACC512  MOVE      WCCLMNO,VARIABLE            *Insurance Company Claim Number
          GOTO      PRAC5000
.
PRACC516  MOVE      WCCOMN1,VARIABLE            *Comments Line 1
          GOTO      PRAC5000
.
PRACC520  MOVE      WCCOMN2,VARIABLE            *Comments Line 2
          GOTO      PRAC5000
.
PRACC524  MOVE      INAME,VARIABLE              *Insurance Company Name
          GOTO      PRAC5000
.
PRACC528  MOVE      PMWXALOC,VARIABLE           * Accident Location
          GOTO      PRAC5000
.
PRACC532  MOVE      PMWXCINJ,VARIABLE           * Cause of Injury Code
          GOTO      PRAC5000
.
PRACC536  MOVE      CODEIK,TCODE                * Cause of Injury Description
          PACK      ACODE,PMWXCINJ,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC540  MOVE      PMWXICOD,VARIABLE           * Injury Code
          GOTO      PRAC5000
.
PRACC544  MOVE      CODEIJ,TCODE                * Injury Description
          PACK      ACODE,PMWXICOD,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC548  MOVE      PMWXCNAM,VARIABLE           * Contact Name
          GOTO      PRAC5000
.
PRACC552  MOVE      PMWXACCF,VARIABLE           * Work Related Code
          GOTO      PRAC5000
.
PRACC556  MOVE      CODEIQ,TCODE                * Work Related Description
          PACK      ACODE,PMWXACCF,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC560  MOVE      PMWXPLIN,VARIABLE           * Place Injury Occurred Code
          GOTO      PRAC5000
.
PRACC564  MOVE      CODEIP,TCODE                * Place Injury Occurred Desc
          PACK      ACODE,PMWXPLIN,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC568  MOVE      PMWXACTI,VARIABLE           * Activity when Injured Code
          GOTO      PRAC5000
.
PRACC572  MOVE      CODEIO,TCODE                * Activity when Injured Desc
          PACK      ACODE,PMWXACTI,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC576  MATCH     SP70,PMWXADTE               * ACC Decline Date
          GOTO      PRAC5000 IF EQUAL
          UNPACK    PMWXADTE,CCENT,CYEAR,CMON,CDAY
          PACK      VARIABLE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          GOTO      PRAC5000
.
PRACC580  MOVE      PMWXATME,VARIABLE
          GOTO      PRAC5000
.
PRACC584  MOVE      PMWXACLC,VARIABLE
          GOTO      PRAC5000
.
PRACC588  MOVE      CODEIM,TCODE                * Activity location desc
          PACK      ACODE,PMWXACLC,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC592  MATCH     "1",PMWXAINZ
          IF        @EQUAL
            MOVE     DYES,VARIABLE
          ELSE
            MOVE     DNO,VARIABLE
          ENDIF
          GOTO      PRAC5000
.
PRACC596  MATCH     "1",PMWXMOVV
          IF        @EQUAL
            MOVE     DYES,VARIABLE
          ELSE
            MOVE     DNO,VARIABLE
          ENDIF
          GOTO      PRAC5000
.       
PRACC600  MATCH     "1",PMWXSPTI
          IF        @EQUAL
            MOVE     DYES,VARIABLE
          ELSE
            MOVE     DNO,VARIABLE
          ENDIF
          GOTO      PRAC5000
.       
PRACC604  MOVE      PMWXSPRT,VARIABLE
          GOTO      PRAC5000
.
PRACC608  MOVE      CODEIB,TCODE                * Activity location desc
          PACK      ACODE,PMWXSPRT,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC612  MATCH     "1",PMWXRECI
          IF        @EQUAL
            MOVE     DYES,VARIABLE
          ELSE
            MOVE     DNO,VARIABLE
          ENDIF
          GOTO      PRAC5000
.       
PRACC616  MATCH     "1",PMWXTRIC
          IF        @EQUAL
            MOVE     DYES,VARIABLE
          ELSE
            MOVE     DNO,VARIABLE
          ENDIF
          GOTO      PRAC5000
.
PRACC620  MOVE      PMWXESTA,VARIABLE
          GOTO      PRAC5000
.
PRACC624  MOVE      CODEIF,TCODE                * Employment status
          PACK      ACODE,PMWXESTA,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC628  MATCH     SP70,PMWXPDDT               * Declaration Date
          GOTO      PRAC5000 IF EQUAL
          UNPACK    PMWXPDDT,CCENT,CYEAR,CMON,CDAY
          PACK      VARIABLE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          GOTO      PRAC5000
.
PRACC632  MOVE      PMWXARG1,VARIABLE
          GOTO      PRAC5000
.
PRACC636  MOVE      PMWXARG2,VARIABLE
          GOTO      PRAC5000
.
PRACC640  MOVE      PMWXARSN,VARIABLE
          GOTO      PRAC5000
.
PRACC644  MOVE      PMWXARTL,VARIABLE
          GOTO      PRAC5000
.
PRACC648  PACK      PMRLDESC,SP70
          PACK      KEY10,PMWXARRP,SP10
          CALL      RDPMREL1
.
          MOVE      PMRLDESC,VARIABLE          * Auth Rep Relationship
          GOTO      PRAC5000
.
PRACC652  MATCH     "1",PMWXASST
          IF        @EQUAL
            MOVE     DYES,VARIABLE
          ELSE
            MOVE     DNO,VARIABLE
          ENDIF
          GOTO      PRAC5000
.       
PRACC656  MATCH     "1",PMWXNEED
          IF        @EQUAL
            MOVE     DYES,VARIABLE
          ELSE
            MOVE     DNO,VARIABLE
          ENDIF
          GOTO      PRAC5000
.         
PRACC660  MATCH     "1",PMWXCONT
          IF        @EQUAL
            MOVE     DYES,VARIABLE
          ELSE
            MOVE     DNO,VARIABLE
          ENDIF
          GOTO      PRAC5000
.       
PRACC664  MATCH     "1",PMWXALTW
          IF        @EQUAL
            MOVE     DYES,VARIABLE
          ELSE
            MOVE     DNO,VARIABLE
          ENDIF
          GOTO      PRAC5000
.       
PRACC668  MOVE      PMWXTYPA,VARIABLE
          GOTO      PRAC5000
.
PRACC672  MOVE      CODEIH,TCODE                * Type of alternative work
          PACK      ACODE,PMWXTYPA,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC676  MATCH     SP70,PMWXSALT               * Start Date of alt work
          GOTO      PRAC5000 IF EQUAL
	  UNPACK    PMWXSALT,CCENT,CYEAR,CMON,CDAY
          PACK      VARIABLE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          GOTO      PRAC5000
.
PRACC680  MOVE      PMWXHPDA,VARIABLE
          GOTO      PRAC5000
.
PRACC684  MOVE      PMWXUNFD,VARIABLE
          GOTO      PRAC5000
.
PRACC688  MOVE      PMWXUNFT,VARIABLE
          GOTO      PRAC5000
.
PRACC692  MOVE      CODEIH,TCODE                * Type of alternative work
          PACK      ACODE,PMWXTYPA,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC696  MATCH     SP70,PMWXFISD               * Full incapacity start date
          GOTO      PRAC5000 IF EQUAL
          UNPACK    PMWXFISD,CCENT,CYEAR,CMON,CDAY
          PACK      VARIABLE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          GOTO      PRAC5000
.
PRACC700  MATCH     SP70,PMWXRNWD               * Return to normal work date
          GOTO      PRAC5000 IF EQUAL
          UNPACK    PMWXRNWD,CCENT,CYEAR,CMON,CDAY
          PACK      VARIABLE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          GOTO      PRAC5000
.
PRACC704  MOVE      PMWXCSTA,VARIABLE
          GOTO      PRAC5000
.       
PRACC708  MOVE      PMWXTWRK,VARIABLE
          GOTO      PRAC5000
.
PRACC712  MOVE      CODEIX,TCODE                * Type of work
          PACK      ACODE,PMWXTWRK,SP70
          CALL      GTCOD000
          MOVE      TDESC,VARIABLE
          GOTO      PRAC5000
.
PRACC716  MOVE      PMWXOEST,VARIABLE
          GOTO      PRAC5000
.
PRACC720  PACK      VARIABLE,NO     * Gradual process injury
          MATCH     "1",PMWXGRAD
          IF        @EQUAL
            PACK      VARIABLE,YES
          ENDIF
          GOTO      PRAC5000
.
PRACC724  MOVE      PMWXPORD,VARIABLE   * ACC Purchase Order
          GOTO      PRAC5000
.
PRACC728  PACK      VARIABLE,NO     * Admitted to hospital
          MATCH     "1",PMWXAHOS
          IF        @EQUAL
            PACK      VARIABLE,YES
          ENDIF
          GOTO      PRAC5000
.
PRACC732  PACK      VARIABLE,NO     * Verbal Consent Gained
          MATCH     "1",PMWXVCON
          IF        @EQUAL
            PACK      VARIABLE,YES
          ENDIF
          GOTO      PRAC5000
.
PRACC736  PACK      KEY10,PMWXAPPR,SP70   * approving HCP title
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,VARIABLE
          ENDIF
          GOTO      PRAC5000
.
PRACC740  PACK      KEY10,PMWXAPPR,SP70   * approving HCP Given name
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCGNAM,VARIABLE
          ENDIF
          GOTO      PRAC5000
.
PRACC744  PACK      KEY10,PMWXAPPR,SP70   * approving HCP Surname name
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCSNAM,VARIABLE
          ENDIF
          GOTO      PRAC5000
.
.
PRACC748  PACK      PACFNAME,SP30,SP30,SP20   * approving HCP formatted name
          PACK      KEY10,PMWXAPPR,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCSNAM,PACSNAME
            MOVE      PMHCGNAM,PACGNAME
            MOVE      PMHCTITL,PACTITLE
            MOVE      TWO,PACFRMT
            CALL      PACNAME
          ENDIF
          MOVE      PACFNAME,VARIABLE
          GOTO      PRAC5000
.
.
PRACC752  PACK      KEY3,ZERO,ZERO,ONE
          PACK      DIM3,SP1,SP1,ONE                * Injury Line 1
          GOTO      PRAC4100
.
PRACC756  PACK      KEY3,ZERO,ZERO,ONE
          PACK      DIM3,SP1,SP1,TWO                * Injury Line 2
          GOTO      PRAC4100
.
PRACC760  PACK      KEY3,ZERO,ZERO,ONE
          PACK      DIM3,SP1,SP1,THREE              * Injury Line 3
          GOTO      PRAC4100
.
PRACC764  PACK      KEY3,ZERO,ZERO,TWO
          PACK      DIM3,SP1,SP1,ONE                * Additional Injury Line1
          GOTO      PRAC4100
.
PRACC768  PACK      KEY3,ZERO,ZERO,TWO
          PACK      DIM3,SP1,SP1,TWO                * Additional Injury Line2
          GOTO      PRAC4100
.
PRACC772  PACK      KEY3,ZERO,ZERO,TWO
          PACK      DIM3,SP1,SP1,THREE              * Additional Injury Line3
          GOTO      PRAC4100
.
PRACC776  PACK      KEY3,ZERO,ZERO,THREE
          PACK      DIM3,SP1,SP1,ONE                * Alt Work Restriction Line1
          GOTO      PRAC4100
.
PRACC780  PACK      KEY3,ZERO,ZERO,THREE
          PACK      DIM3,SP1,SP1,TWO                * Alt Work Restriction Line2
          GOTO      PRAC4100
.
PRACC784  PACK      KEY3,ZERO,ZERO,THREE
          PACK      DIM3,SP1,SP1,THREE              * Alt Work Restriction Line3
          GOTO      PRAC4100
.
PRACC788  PACK      KEY3,SP1,SP1,ONE                * Diagnosis 1 Code
          MOVE      ONE,FORM2
          GOTO      PRAC4200
.
PRACC792  PACK      KEY3,SP1,SP1,ONE                * Diagnosis 1 Desc
          MOVE      TWO,FORM2
          GOTO      PRAC4200
.
PRACC796  PACK      KEY3,SP1,SP1,ONE                * Diagnosis 1 Coding System
          MOVE      THREE,FORM2
          GOTO      PRAC4200
.
PRACC800  PACK      KEY3,SP1,SP1,ONE                * Diagnosis 1 Side Desc
          MOVE      FOUR,FORM2
          GOTO      PRAC4200
.
PRACC804  PACK      KEY3,SP1,SP1,TWO                * Diagnosis 2 Code
          MOVE      FIVE,FORM2
          GOTO      PRAC4200
.
PRACC808  PACK      KEY3,SP1,SP1,TWO                * Diagnosis 2 DESC
          MOVE      SIX,FORM2
          GOTO      PRAC4200
.
PRACC812  PACK      KEY3,SP1,SP1,TWO                * Diagnosis 2 Coding System
          MOVE      SEVEN,FORM2
          GOTO      PRAC4200
.
PRACC816  PACK      KEY3,SP1,SP1,TWO                * Diagnosis 2 Side Desc
          MOVE      EIGHT,FORM2
          GOTO      PRAC4200
.
PRACC820  PACK      KEY3,SP1,SP1,THREE              * Diagnosis 3 Code
          MOVE      NINE,FORM2
          GOTO      PRAC4200
.
PRACC824  PACK      KEY3,SP1,SP1,THREE              * Diagnosis 3 Desc
          MOVE      TEN,FORM2
          GOTO      PRAC4200
.
PRACC828  PACK      KEY3,SP1,SP1,THREE              * Diagnosis 3 Coding System
          MOVE      "11",FORM2
          GOTO      PRAC4200
.
PRACC832  PACK      KEY3,SP1,SP1,THREE              * Diagnosis 3 Side Desc
          MOVE      "12",FORM2
          GOTO      PRAC4200
.
PRACC836  REP       UPPLOW,NHMARES
          PACK      VARIABLE,DNO,SP70,SP70        * NHI Residence Status
          MATCH     "Y",NHMARES
          IF        @EQUAL
            PACK      VARIABLE,DYES,SP70,SP70        * NHI Residence Status
          ENDIF
          GOTO      PRAC5000
.
PRACC840  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PRAC9999 IF NOT EQUAL
          PACK      VARIABLE,NHMAETH,SP70,SP70    * Ethnicity code (NHI only)
          GOTO      PRAC5000
.
PRACC844  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PRAC9999 IF NOT EQUAL
          MATCH     SP5,NHMAETH                   * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PRAC5000
          ENDIF
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH
          CALL      RDNHETH1
          BRANCH    OVRCD,PRAC9999
          PACK      VARIABLE,NHETDES,SP70,SP70    * Ethnicity desc.
          GOTO      PRAC5000
.
PRACC848  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PRAC9999 IF NOT EQUAL
          PACK      VARIABLE,NHMAETH2,SP70,SP70   * Ethnicity code (NHI only)
          GOTO      PRAC5000
.
PRACC852  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PRAC9999 IF NOT EQUAL
          MATCH     SP5,NHMAETH2                  * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PRAC5000
          ENDIF
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH2
          CALL      RDNHETH1
          BRANCH    OVRCD,PRAC9999
          PACK      VARIABLE,NHETDES,SP70,SP70    * Ethnicity Desc.
          GOTO      PRAC5000
.
PRACC856  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PRAC9999 IF NOT EQUAL
          PACK      VARIABLE,NHMAETH3,SP70,SP70   * Ethnicity code (NHI only)
          GOTO      PRAC5000
.
PRACC860  COMPARE   ONE,PTCNNHII                  * make sure NHI is ON
          GOTO      PRAC9999 IF NOT EQUAL
          MATCH     SP5,NHMAETH3                  * Ethnicity desc (NHI only)
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PRAC5000
          ENDIF
          OPEN      NHIETHA1,"nhiethaf"
          MOVE      SP30,NHETDES
          PACK      KEY5,NHMAETH3
          CALL      RDNHETH1
          BRANCH    OVRCD,PRAC9999
          PACK      VARIABLE,NHETDES,SP70,SP70    * Ethnicity desc.
          GOTO      PRAC5000
.
PRACC864  MOVE      PTELEB,VARIABLE                 * Patient Business Phone
          GOTO      PRAC5000
.
PRACC868  MOVE      PTMXCELL,VARIABLE               * Patient Mobile phone no
          GOTO      PRAC5000
.
PRACC872  MOVE      PUSR6,VARIABLE                  * Patient Occupation code
          GOTO      PRAC5000
.
PRACC876  MATCH     SP70,PUSR6
          IF        @EQUAL
            PACK      VARIABLE,SP70,SP70
            GOTO      PRAC5000
          ENDIF
.
          MOVE      "P6",KEY2
          PACK      KEY5,KEY2,PUSR6
          CALL      RDCODE1
          BRANCH    OVRCD,PRAC9999
          PACK      VARIABLE,TDESC,SP70,SP70        * Patient Occupation desc.
          GOTO      PRAC5000
.
PRACC877  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE                  * Postal Address
            CALL      XCON0000                      * Get extra contact details
            MOVE      PMCEADD1,VARIABLE             * Postal Address line 1
          ELSE
            MOVE      PTMXADD1,VARIABLE             * Postal Address line 1
          ENDIF
          GOTO      PRAC5000
.
PRACC878  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE                  * Postal Address
            CALL      XCON0000                      * Get extra contact details
            MOVE      PMCEADD2,VARIABLE             * Postal Address line 2
          ELSE
            MOVE      PTMXADD2,VARIABLE             * Postal Address line 2
          ENDIF
          GOTO      PRAC5000
.
PRACC879  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE                  * Postal Address
            CALL      XCON0000                      * Get extra contact details
            MOVE      PMCEADD3,VARIABLE             * Postal Address line 3
          ELSE
            MOVE      PTMXADD3,VARIABLE             * Postal Address Line 3
          ENDIF
          GOTO      PRAC5000
.
PRACC880  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE                  * Postal Address
            CALL      XCON0000                      * Get extra contact details
            MOVE      PMCEADD4,VARIABLE             * Postal Address line 4
          ELSE
            MOVE      PTMXADD4,VARIABLE             * Postal Address Line 4
          ENDIF
          GOTO      PRAC5000
.
PRACC881  MATCH     "1",PTCNNEWC
          IF        @EQUAL
            MOVE      "2",CONTTYPE                  * Postal Address
            CALL      XCON0000                      * Get extra contact details
            MOVE      PMCEPOST,VARIABLE             * Postal Address postcode
          ELSE
            MOVE      PTMXPOST,VARIABLE             * Postal Address postcode
          ENDIF
          GOTO      PRAC5000
.
PRACC882  MOVE      PSEX,DSEXCHAR	  
          CALL      SEXDSP00	      
          MOVE      DSEXLDES,VARIABLE        * Get sex long description		
          GOTO      PRAC5000     
.
PRACC883  PACK      VARIABLE,PMPXPFSN,SP70   * Preferred Surname
          GOTO      PRAC5000
.
PRACC884  PACK      VARIABLE,PMPXPFGN,SP70   * Preferred Given Name
          GOTO      PRAC5000
.
PRACC885  PACK      VARIABLE,PSNAME,SP70     * Pref Surname instead of Actual SN
          MATCH     "1",PTCNPFSN
          IF        @EQUAL
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFSN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PRAC5000
.
PRACC886  PACK      VARIABLE,PGNAME,SP70     * Pref GN instead of Actual GN
          MATCH     "1",PTCNPFGN
          IF        @EQUAL
            MATCH     SP70,PMPXPFGN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFGN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PRAC5000
.
PRACC887  PACK      VARIABLE,PTMASNAM,SP70   * Pref Surname instead of 40char SN
          MATCH     "1",PTCNPFSN
          IF        @EQUAL
            MATCH     SP70,PMPXPFSN
            IF        !@EQUAL & !@EOS
              PACK      VARIABLE,PMPXPFSN,SP70,SP10
            ENDIF
          ENDIF
          GOTO      PRAC5000
.
PRACC888  PACK      VARIABLE,PMPXUCC4,SP70       * Identify gender
          GOTO      PRAC5000
.
PRACC889  PACK      VARIABLE,SP70                * Identify gender long desc
          MOVE      SP70,PTCDLDES
          MATCH     SP70,PMPXUCC4
          IF        !@EQUAL
            MOVE      "Gi",DIM2
            PACK      KEY5,DIM2,PMPXUCC4,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PRAC5000
.
PRACC890  PACK      VARIABLE,PMPXATF1,SP70,SP70  * Identify gender Free Text
          GOTO      PRAC5000
.
PRACC891  PACK      VARIABLE,PMPXUCC5,SP70       * Identify pronoun
          GOTO      PRAC5000
.
PRACC892  PACK      VARIABLE,SP70                * Identif pronoun long desc
          MOVE      SP70,PTCDLDES
          MATCH     SP70,PMPXUCC5
          IF        !@EQUAL
            MOVE      "Gp",DIM2
            PACK      KEY5,DIM2,PMPXUCC5,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      PTCDLDES,VARIABLE
            ENDIF
          ENDIF
          GOTO      PRAC5000
.
PRACC893  PACK      VARIABLE,PMPXATF2,SP70,SP70  * Identify Pronoun Free Text
          GOTO      PRAC5000
.
PRAC4100  UNPACK    SP70,ACCMACCN,ACCMTYPE,DACCMLIN
          PACK      KEY26,WCCLMNO,KEY3,DIM3,SP70
          CALL      RDACCMT1
          BRANCH    OVRCD,PRAC4900
          MOVE      ACCMDATA,VARIABLE
          GOTO      PRAC5000

PRAC4200  UNPACK    SP70,ACDIACCN,DACDICNT
          PACK      KEY23,WCCLMNO,KEY3,SP70
          CALL      RDACDIA1
          BRANCH    OVRCD,PRAC4900
.
          IF        FORM2=1 | FORM2=5 | FORM2=9
            MOVE      ACDIDIAG,VARIABLE                  * Diagnosis Code
            GOTO      PRAC5000
          ENDIF
.
          IF        FORM2=2 | FORM2=6 | FORM2=10
            UNPACK    SP70,EMIC9COD,EMICDESC
            PACK      KEY9,ACDIDIAG,SP10
            CALL      RDEMICD1
.
            MOVE      EMICDESC,VARIABLE                  * Diagnosis Desc
            GOTO      PRAC5000
          ENDIF
.
          IF        FORM2=3 | FORM2=7 | FORM2=11
            MATCH     "1",ACDICSYC                       * Diagnosis Desc System
            IF        @EQUAL
              MOVE      "ICD9",VARIABLE
            ENDIF
.
            MATCH     "2",ACDICSYC
            IF        @EQUAL
              MOVE      "ICD10",VARIABLE
            ENDIF
.
            MATCH     "3",ACDICSYC
            IF        @EQUAL
              MOVE      "READ",VARIABLE
            ENDIF
.
            MATCH     "4",ACDICSYC
            IF        @EQUAL
              MOVE      "SNOMED CT",VARIABLE
            ENDIF
            GOTO      PRAC5000
          ENDIF
.
          IF        FORM2=4 | FORM2=8 | FORM2=12
            MATCH     "1",ACDISIDE                       * Diagnosis Side Desc
            IF        @EQUAL
              MOVE      "Left",VARIABLE
            ENDIF
.
            MATCH     "2",ACDISIDE
            IF        @EQUAL
              MOVE      "Right",VARIABLE
            ENDIF
.
            MATCH     "3",ACDISIDE
            IF        @EQUAL
              MOVE      "NA",VARIABLE
            ENDIF
.
            GOTO      PRAC5000
          ENDIF
.
          GOTO      PRAC5000
.
PRAC4900  MOVE      SP70,VARIABLE
          GOTO      PRAC5000
.
. ------- Format the variable -------
.
PRAC5000  RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      PRACC100                 * Read next record
.
. ------- Formatting for Form fields and right justified variables -------
.
PRAC6000  COMPARE   ZERO,PRNTSTRT          * Don't bump if printing full length
          GOTO      PRAC7000 IF EQUAL
.
          BUMP      VARIABLE,PRNTSTRT      * bump to starting position
.
. ------- Print the variable -------
.
PRAC7000  PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      PRACC100                 * Read next record
.
.------ end of MR10 reached ------
.
PRAC8000  MOVE      FALSE,EXIT
.
.------ print new-lines until the end of page is reached ------
.
PRAC9000  COMPARE   CURRROW,IBTHLENG          * test page length
          GOTO      PRAC9999 IF EQUAL
.
          PRINT     *N;
          ADD       ONE,CURRROW
          GOTO      PRAC9000
.
PRAC9999  MOVE      FALSE,EXIT               * Set exit flag
          PACK      SAVFIL8,SPLFILE,SP70     * Used to save the spool file
          CALL      CLSPRINT                 * close the spool file
          RETURN                             * Finished
.
...............................................................................

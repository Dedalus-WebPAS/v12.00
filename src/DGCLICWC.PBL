.************************************************************************
.*  Procedure: DGCLICWC  -  Send a Cancel a Waiting List entry          *
.*                                                                      *
.*  Author   : Mike Laming  (11/07/2001)                                *
.*                                                                      *
.*  Requires : WATTR1FD (Waiting List Patient Procedures)               *
.*             WATCONFD (Waiting List Control Record)                   *
.*                                                                      *
.*  Mods     :                                                          *
.*  V9.02.01   08/11/2001  Davin & MikeL                                *
.*             Mods to use message holding file                         *
.*                                                                      *
.*                                                                      *
.************************************************************************
          DEFPROC   DGCLICWC
.
          INC       HL7BMTFD/INC
          INC       HL7WEXFD/INC
.
. vars in here
.
DGCLI000  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,THIRTY7;*240,WTCNDGWC
.
.   check if we are using this feature
.
          COMPARE   ONE,WTCNDGWC
          GOTO      DGCLI999 IF NOT EQUAL
.
.         Open the broadcast message holding table file
.
          OPEN      HL7BMTA1,"hl7bmtaf"
.
.         Write message
.
          MOVE      "T",HLBMSTAT                * "T" - to be processed
          MOVE      "CWC",HLBMTYPE
          MOVE      SP8,HLBMURNO
          MOVE      SP8,HLBMVISN
.                                               * Key for WATTR1A1 (Key19)
          PACK      HLBMTKEY,WMURNO,WMCODE,WMCNT,SP30,SP30,SP30
          MOVE      SP1,HLBMFLAG
          PACK      HLBMSPAR,SP30,SP30
.
          CALL      DGMESSID                    * Get Message ID, Date & Time
.
.        Write the Waiting list data to HL7 Waiting List Extension file
.
          OPEN      HL7WEXA1,"hl7wexaf"         * open hl7 waiting list extn
          MOVE      HLBMMESG,HLWXMESG
          PACK      HLWXSPAR,SP70
          PACK      KEY20,HLWXMESG
          CALL      WRHLWEX1
          CLOSE     HL7WEXA1
.
          CALL      DGHLSEND                    * Send the HL7 message
.
          CLOSE     HL7BMTA1
.
DGCLI999  GOTO      DGCLIEND                    * end procedure
.
.         IO's go in here
.
          INC       DGHLCOMN
          INC       HL7BMTIO/INC
          INC       HL7WEXIO/INC
          INC       IBAOVRIO/INC
.
DGCLIEND  ENDPROC

.
.         INCLUDE NAME : IBAIOSYS.PBL
.
.         FILE  I/O REQUESTS FOR SYSTEM TRACKING 
.
.OVRCD  FORM            1             0=NOT OVER
.                                     1= OVER
.
.KEY30  DIM            30            KEY FOR IBASYSA1,2,3,4
.
.        READ      CONTROLF,TWO;*149,USERFLAG
.
.        USERFLAG = 0 FULL SYSTEM TRACKING
.        USERFLAG = 1 PORT TRACKING ONLY
.
+
.
.       FIRST SYSTEM TRACKING  I/O
.
RDSSYSA1 RESET     KEY30
         READ      IBASYSA1,KEY30;;
         RETURN  
.
RDSYSA1  MOVE      ZERO,OVRCD
         RESET     KEY30
         READ      IBASYSA1,KEY30;SYSPORT,SYSPROG,SYSUSER,SYSIDAT,SYSTIMI:
                                  SYSTIMO,SYSERROR,SYSSPARE
         GOTO      OVERCOND IF OVER
         RETURN  
.
RDKSYSA1 MOVE      ZERO,OVRCD
         READKS    IBASYSA1;SYSPORT,SYSPROG,SYSUSER,SYSIDAT,SYSTIMI:
                            SYSTIMO,SYSERROR,SYSSPARE
         GOTO      OVERCOND IF OVER
         RETURN  
.
.       THE PORT VARIABLES ARE ASSUMED TO BE WRITTEN
.
WRSYSA1  MOVE      ZERO,OVRCD
         PACK      KEY30 WITH IBAPPORT,IBAPDATE,IBAPTIME,IBAPUSER,IBAPPROG
         UNPACK    KEY30 WITH SYSPORT,SYSIDAT,SYSTIMI,SYSUSER,SYSPROG
.
.       NO LOCKING AS WE ARE PORT UNIQUE PER USER
.
         READ      IBASYSA1,KEY30;ANS
         GOTO      OVERCOND IF NOT OVER
.
         MOVE      ERROR,SYSERROR
         WRITE     IBASYSA1,KEY30;SYSPORT,SYSPROG,SYSUSER,SYSIDAT,SYSTIMI:
                                  SP8,SYSERROR,SYSSPARE
.
NOSYSA1  RETURN  
.
.    KEYS WILL NOT CHANGE      (TIME OUT WILL BE ADDED)
.
UPSYSA1  BRANCH    USERFLAG OF NOSYSA1
         MOVE      PORT,KEY2
         REP       " 0",KEY2
         CALL      RDPORT1
         BRANCH    OVRCD OF OVERCOND
.
         MATCH     SP8,IBAPDATE     *** IF CLEAR FORGET IT
         GOTO      NOSYSA1 IF EQUAL
.
         MOVE      ZERO,OVRCD
         PACK      KEY30 WITH IBAPPORT,IBAPDATE,IBAPTIME,IBAPUSER,IBAPPROG
         UNPACK    KEY30 WITH SYSPORT,SYSIDAT,SYSTIMI,SYSUSER,SYSPROG
         READ      IBASYSA1,KEY30;ANS
         GOTO      OVERCOND IF OVER
.
         CLOCK     TIME,SYSTIMO
         MOVE      ERROR,SYSERROR                   *** ERROR TRACKING
         UPDATE    IBASYSA1;*31,SYSTIMO,SYSERROR
         GOTO      ULPORT1      *** CLEAR PORT
.
.       SECOND SYSTEM TRACKING  I/O
.
RDSSYSA2 RESET     KEY30
         READ      IBASYSA2,KEY30;;
         RETURN  
.
RDSYSA2  MOVE      ZERO,OVRCD
         RESET     KEY30
         READ      IBASYSA2,KEY30;SYSPORT,SYSPROG,SYSUSER,SYSIDAT,SYSTIMI:
                                  SYSTIMO,SYSERROR,SYSSPARE
.
         GOTO      OVERCOND IF OVER
         RETURN  
.
RDKSYSA2 MOVE      ZERO,OVRCD
         READKS    IBASYSA2;SYSPORT,SYSPROG,SYSUSER,SYSIDAT,SYSTIMI:
                            SYSTIMO,SYSERROR,SYSSPARE
         GOTO      OVERCOND IF OVER
         RETURN  
.
.       THIRD SYSTEM TRACKING I/O
.
RDSSYSA3 RESET     KEY30
         READ      IBASYSA3,KEY30;;
         RETURN
.
RDSYSA3  MOVE      ZERO,OVRCD
         RESET     KEY30
         READ      IBASYSA3,KEY30;SYSPORT,SYSPROG,SYSUSER,SYSIDAT,SYSTIMI:
                                  SYSTIMO,SYSERROR,SYSSPARE
         GOTO      OVERCOND IF OVER
         RETURN  
.
RDKSYSA3 MOVE      ZERO,OVRCD
         READKS    IBASYSA3;SYSPORT,SYSPROG,SYSUSER,SYSIDAT,SYSTIMI:
                            SYSTIMO,SYSERROR,SYSSPARE
         GOTO      OVERCOND IF OVER
         RETURN  
.
.       FOURTH SYSTEM TRACKING I/O
.
RDSSYSA4 RESET     KEY30
         READ      IBASYSA4,KEY30;;
         RETURN
.
RDSYSA4  MOVE      ZERO,OVRCD
         RESET     KEY30
         READ      IBASYSA4,KEY30;SYSPORT,SYSPROG,SYSUSER,SYSIDAT,SYSTIMI:
                                  SYSTIMO,SYSERROR,SYSSPARE
         GOTO      OVERCOND IF OVER
         RETURN  
.
RDKSYSA4 MOVE      ZERO,OVRCD
         READKS    IBASYSA4;SYSPORT,SYSPROG,SYSUSER,SYSIDAT,SYSTIMI:
                            SYSTIMO,SYSERROR,SYSSPARE
         GOTO      OVERCOND IF OVER
         RETURN  
.

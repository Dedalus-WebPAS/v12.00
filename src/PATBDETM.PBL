. *----------------------------------------------------------------------
. * Include Name  :   PATBDETM.PBL
. *
. * Function      :   CGI variables for PATBDEFD - patbdeaf.dat
. *
. * V11.00.02 13/01/2021  Tracey Nguyen     TSK 0888079
. *           1)Moved spaces to PTBDE001 (Hospital Id) - CPPTBE00
. *           2)Removed check for 'PTBDETLOS > 0' (TLOS) - PTBD0090
. * V11.00.01 14/10/2020  Tracey Nguyen     TSK 0888079
. *           Created Include
. *----------------------------------------------------------------------
.------------------------------------------------------------------------
.   Clear Parameters for Billing Defaults
.------------------------------------------------------------------------
.
CPPTBE00  MOVE      SP70,PTBDE001
          MOVE      Z70,PTBDE002
          MOVE      Z70,PTBDE003
          MOVE      Z70,PTBDE004
          MOVE      Z70,PTBDE005
          MOVE      Z70,PTBDE006
          MOVE      Z70,PTBDE007
          MOVE      Z70,PTBDE008
          MOVE      ZERO,PTBDE009
          MOVE      Z70,PTBDE010
          MOVE      Z70,PTBDE011
          MOVE      Z70,PTBDE012
          MOVE      Z70,PTBDE013
          MOVE      Z70,PTBDE014
          MOVE      Z70,PTBDE015
          MOVE      Z70,PTBDE016
          MOVE      Z70,PTBDE017
          MOVE      Z70,PTBDE018
          MOVE      Z70,PTBDE019
.
CPPTBE99  RETURN
.
.------------------------------------------------------------
. Tags for Billing Defaults
.------------------------------------------------------------
PTBD0000  BRANCH    FLDITMNO,PTBD0010,PTBD0020,PTBD0030,PTBD0040,PTBD0050:
                             PTBD0060,PTBD0070,PTBD0080,PTBD0090,PTBD0100:
                             PTBD0110,PTBD0120,PTBD0130,PTBD0140,PTBD0150:
                             PTBD0160,PTBD0170,PTBD0180,PTBD0190
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      PTBD9999
.
PTBD0010  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTBD0011
          WRITE     HTMLFILE;PTBEHOSP;      * Hospital Code               
          GOTO      PTBD9999
PTBD0011  MATCH     SP70,PTBEHOSP
          GOTO      PTBD9999 IF EQUAL
          PACK      KEY3,PTBEHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,PTBD9999
          WRITE     HTMLFILE;PTHSNAME       * Hospital Name
          GOTO      PTBD9999
.
PTBD0020  MATCH     PTBESDTE,SP70
          GOTO      PTBD9999 IF EQUAL
.
          UNPACK    PTBESDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PTBD9999
.
PTBD0030  MATCH     PTBEEDTE,SP70
          GOTO      PTBD9999 IF EQUAL
.
          UNPACK    PTBEEDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PTBD9999
.
PTBD0040  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTBD0041
          WRITE     HTMLFILE;PTBEVSID;       * Value Set Id Code 
          GOTO      PTBD9999
PTBD0041  MATCH     SP70,PTBEVSID
          GOTO      PTBD9999 IF EQUAL
          PACK      KEY33,ANSB,ANSR,ANSA,PTBEVSID,SP70
          CALL      RDPMVSC1
          BRANCH    OVRCD,PTBD9999
          WRITE     HTMLFILE;PMVCPTRM;       * Value Set description
          GOTO      PTBD9999
.
PTBD0050  MOVE      "CL",CATEGORY
          MOVE      PTBECLMC,CODE            * Claim Type
          CALL      CODITM00
          GOTO      PTBD9999
.
PTBD0060  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTBD0061
          WRITE     HTMLFILE;PTBEHFND;       * Health Fund code
          GOTO      PTBD9999
PTBD0061  MATCH     SP70,PTBEHFND
          GOTO      PTBD9999 IF EQUAL
          PACK      KEY14,PTBEHFND,ZERO,ZERO,ZERO,ZERO,SP4,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,PTBD9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      PTBD9999
.
PTBD0070  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTBD0071 
          WRITE     HTMLFILE;PTBEHFTB;      * Health Fund table level code
          GOTO      PTBD9999
PTBD0071  MATCH     SP70,PTBEHFND
          GOTO      PTBD9999 IF EQUAL
          MATCH     SP70,PTBEHFTB
          GOTO      PTBD9999 IF EQUAL
          PACK      KEY14,PTBEHFND,PTBEHFTB,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,PTBD9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund table level name 
          GOTO      PTBD9999
.
PTBD0080  MOVE      "VI",CATEGORY           * Intended Length of Stay
          MOVE      PTBEILOS,CODE
          CALL      CODITM00
          GOTO      PTBD9999
.
PTBD0090  WRITE     HTMLFILE;PTBETLOS;      * Target Length of Stay
          GOTO      PTBD9999
.
PTBD0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTBD0101
          WRITE     HTMLFILE;PTBECSMX;      * Casemix Code
          GOTO      PTBD9999
PTBD0101  MATCH     SP70,PTBECSMX
          GOTO      PTBD9999 IF EQUAL
          PACK      KEY9,PTBECSMX,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,PTBD9999
          WRITE     HTMLFILE;PTCADES1;      * Casemix Code Desc
          GOTO      PTBD9999
.
PTBD0110  WRITE     HTMLFILE;PTBECPAY;
          GOTO      PTBD9999
.
PTBD0120  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTBD0121
          WRITE     HTMLFILE;PTBEDRGC;       * DRG Code         
          GOTO      PTBD9999
PTBD0121  MATCH     SP70,PTBEDRGC
          GOTO      PTBD9999 IF EQUAL
          PACK      KEY7,PTBEDRGC,PTBEDRGV,SP70
          CALL      RDPTDGW1
          BRANCH    OVRCD,PTBD9999
          WRITE     HTMLFILE;PTDWDESC;       * DRG description
          GOTO      PTBD9999
.
PTBD0130  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTBD0131
          WRITE     HTMLFILE;PTBEDRGV;       * DRG Version
          GOTO      PTBD9999
PTBD0131  MATCH     SP70,PTBEDRGV
          GOTO      PTBD9999 IF EQUAL
          PACK      KEY4,SP70
          MOVE      PTBEDRGV,FORM3
          IF        FORM3 < 100
            ASSIGN    (FORM3/10),FORM1P1
            MOVE      FORM1P1,KEY4
          ELSE
            ASSIGN    (FORM3/10),FORM2P1
            MOVE      FORM2P1,KEY4
          ENDIF
          WRITE     HTMLFILE;KEY4;            * DRG Version formatted
          GOTO      PTBD9999
.                                   
PTBD0140  MOVE      "A ",CATEGORY
          MOVE      PTBEADMN,CODE            * Admission Type
          CALL      CODITM00
          GOTO      PTBD9999
.
PTBD0150  MOVE      "CC",CATEGORY
          MOVE      PTBECARE,CODE            * Care Type
          CALL      CODITM00
          GOTO      PTBD9999
.
PTBD0160  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTBD0161
          WRITE     HTMLFILE;PTBEPRGM;      * Program Code
          GOTO      PTBD9999
PTBD0161  MOVE      SP70,PMPGDESC
          MOVE      SP70,PMPGCODE
          MATCH     SP70,PTBEPRGM
          PACK      KEY8,SP70
          CALL      RSPMPRG1
PTBD0162  CALL      RKPMPRG1
          BRANCH    OVRCD,PTBD9999
.
          MATCH     "1",PMPGACTV
          GOTO      PTBD0162 IF EQUAL        * don't display inactive codes
.
          MATCH     PTBEPRGM,PMPGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PMPGCODE,"#" selected>":
                               PMPGDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PMPGCODE,"#">":
                               PMPGDESC,"</option>"
          ENDIF
          GOTO      PTBD0162
.
PTBD0170  MOVE      "il",CATEGORY
          MOVE      PTBEPILL,CODE
          CALL      CODITM00
          GOTO      PTBD9999
.
PTBD0180  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PTBD0181
          WRITE     HTMLFILE;PTBEMBSI;        * MBS Item code
          GOTO      PTBD9999
PTBD0181  MATCH     SP70,PTBEMBSI
          GOTO      PTBD9999 IF EQUAL
          PACK      KEY17,PTBEMBSI,PTBESDTE,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,PTBD9999
          WRITE     HTMLFILE;IDESC;           * MBS Item description
          GOTO      PTBD9999
.
PTBD0190  MOVE      "az",CATEGORY
          MOVE      PTBEALER,CODE             * Billing Defaults Alerts
          CALL      CODITM00
          GOTO      PTBD9999
.
PTBD9999  RETURN
.
.------------------------------------------------------------
. Set Parameters for Billing Defaults
.------------------------------------------------------------
SPPTB000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPPTB001,SPPTB002,SPPTB003,SPPTB004,SPPTB005:
                       SPPTB006,SPPTB007,SPPTB008,SPPTB009,SPPTB010:
                       SPPTB011,SPPTB012,SPPTB013,SPPTB014,SPPTB015:
                       SPPTB016,SPPTB017,SPPTB018,SPPTB019
.
          MOVE      ONE,EXIT
          GOTO      SPPTB999
.
SPPTB001  PACK      PTBDE001,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB002  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTBDE002,CCENT,CYEAR,CMON,CDAY
          MATCH     SP70,PTBDE002
          IF        !@EQUAL
            REP       " 0",PTBDE002
          ENDIF
          GOTO      SPPTB999
.
SPPTB003  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PTBDE003,CCENT,CYEAR,CMON,CDAY
          MATCH     SP70,PTBDE003
          IF        !@EQUAL
            REP       " 0",PTBDE003
          ENDIF
          GOTO      SPPTB999
.
SPPTB004  PACK      PTBDE004,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB005  PACK      PTBDE005,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB006  PACK      PTBDE006,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB007  PACK      PTBDE007,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB008  PACK      PTBDE008,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB009  MOVE      QRYDATA,PTBDE009
          GOTO      SPPTB999
.
SPPTB010  PACK      PTBDE010,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB011  PACK      PTBDE011,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB012  PACK      PTBDE012,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB013  PACK      PTBDE013,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB014  PACK      PTBDE014,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB015  PACK      PTBDE015,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB016  PACK      PTBDE016,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB017  PACK      PTBDE017,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB018  PACK      PTBDE018,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB019  PACK      PTBDE019,QRYDATA,SP70
          GOTO      SPPTB999
.
SPPTB999  RETURN
.
.------------------------------------------------------------
.  Update cgi to file vars for Billing Defaults
.------------------------------------------------------------
MVPTBE00  MOVE      PTBDE001,PTBEHOSP
.
          MATCH     PTBDE002,Z70
          IF        !@EQUAL
            MOVE      PTBDE002,PTBESDTE
          ENDIF
.
          MATCH     PTBDE003,Z70
          IF        !@EQUAL
            MOVE      PTBDE003,PTBEEDTE
          ENDIF
.
          MATCH     PTBDE004,Z70
          IF        !@EQUAL
            MOVE      PTBDE004,PTBEVSID
          ENDIF
.
          MATCH     PTBDE005,Z70
          IF        !@EQUAL
            MOVE      PTBDE005,PTBECLMC
          ENDIF
.
          MATCH     PTBDE006,Z70
          IF        !@EQUAL
            MOVE      PTBDE006,PTBEHFND
          ENDIF
.
          MATCH     PTBDE007,Z70
          IF        !@EQUAL
            MOVE      PTBDE007,PTBEHFTB
          ENDIF
.
          MATCH     PTBDE008,Z70
          IF        !@EQUAL
            MOVE      PTBDE008,PTBEILOS
          ENDIF
.
          MOVE      PTBDE009,PTBETLOS
.
          MATCH     PTBDE010,Z70
          IF        !@EQUAL
            MOVE      PTBDE010,PTBECSMX
          ENDIF
.
          MATCH     PTBDE011,Z70
          IF        !@EQUAL
            MOVE      PTBDE011,PTBECPAY
          ENDIF
.
          MATCH     PTBDE012,Z70
          IF        !@EQUAL
            MOVE      PTBDE012,PTBEDRGC
          ENDIF
.
          MATCH     PTBDE013,Z70
          IF        !@EQUAL
            MOVE      PTBDE013,PTBEDRGV
          ENDIF
.
          MATCH     PTBDE014,Z70
          IF        !@EQUAL
            MOVE      PTBDE014,PTBEADMN
          ENDIF
.
          MATCH     PTBDE015,Z70
          IF        !@EQUAL
            MOVE      PTBDE015,PTBECARE
          ENDIF
.
          MATCH     PTBDE016,Z70
          IF        !@EQUAL
            MOVE      PTBDE016,PTBEPRGM
          ENDIF
.
          MATCH     PTBDE017,Z70
          IF        !@EQUAL
            MOVE      PTBDE017,PTBEPILL
          ENDIF
.
          MATCH     PTBDE018,Z70
          IF        !@EQUAL
            MOVE      PTBDE018,PTBEMBSI
          ENDIF
.
          MATCH     PTBDE019,Z70
          IF        !@EQUAL
            MOVE      PTBDE019,PTBEALER
          ENDIF
.
MVPTBE99  RETURN
+
